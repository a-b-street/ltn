var RS=Object.defineProperty;var BS=(r,e,t)=>e in r?RS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Wn=(r,e,t)=>(BS(r,typeof e!="symbol"?e+"":e,t),t);function FS(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const l in n)if(l!=="default"&&!(l in r)){const u=Object.getOwnPropertyDescriptor(n,l);u&&Object.defineProperty(r,l,u.get?u:{enumerable:!0,get:()=>n[l]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function n(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function It(){}function Rn(r,e){for(const t in e)r[t]=e[t];return r}function Tb(r){return r()}function Fy(){return Object.create(null)}function _n(r){r.forEach(Tb)}function xc(r){return typeof r=="function"}function jt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Rf;function En(r,e){return r===e?!0:(Rf||(Rf=document.createElement("a")),Rf.href=e,r===Rf.href)}function OS(r){return Object.keys(r).length===0}function Eb(r,...e){if(r==null){for(const n of e)n(void 0);return It}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Hi(r){let e;return Eb(r,t=>e=t)(),e}function yt(r,e,t){r.$$.on_destroy.push(Eb(e,t))}function Vr(r,e,t,n){if(r){const l=Mb(r,e,t,n);return r[0](l)}}function Mb(r,e,t,n){return r[1]&&n?Rn(t.ctx.slice(),r[1](n(e))):t.ctx}function qr(r,e,t,n){if(r[2]&&n){const l=r[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Gr(r,e,t,n,l,u){if(l){const d=Mb(e,t,n,u);r.p(d,l)}}function Wr(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function NS(r){const e={};for(const t in r)e[t]=!0;return e}function sd(r){return r??""}function Rt(r,e,t){return r.set(t),e}function Cm(r){return r&&xc(r.destroy)?r.destroy:It}const Ld=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ie(r,e){r.appendChild(e)}function be(r,e,t){r.insertBefore(e,t||null)}function ve(r){r.parentNode&&r.parentNode.removeChild(r)}function Ds(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function de(r){return document.createElement(r)}function Ps(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function tt(r){return document.createTextNode(r)}function Ue(){return tt(" ")}function $n(){return tt("")}function Et(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function wg(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Jp(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function Ee(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function Cb(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function xg(r){return r===""?null:+r}function jS(r){return Array.from(r.childNodes)}function Lr(r,e){e=""+e,r.data!==e&&(r.data=e)}function ei(r,e){r.value=e??""}function fn(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function ad(r,e,t){for(let n=0;n<r.options.length;n+=1){const l=r.options[n];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Ib(r){const e=r.querySelector(":checked");return e&&e.__value}function hi(r,e,t){r.classList.toggle(e,!!t)}function US(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let ch;function th(r){ch=r}function xh(){if(!ch)throw new Error("Function called outside component initialization");return ch}function Pd(r){xh().$$.on_mount.push(r)}function ti(r){xh().$$.on_destroy.push(r)}function us(){const r=xh();return(e,t,{cancelable:n=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=US(e,t,{cancelable:n});return l.slice().forEach(d=>{d.call(r,u)}),!u.defaultPrevented}return!0}}function Sg(r,e){return xh().$$.context.set(r,e),e}function Ab(r){return xh().$$.context.get(r)}function ur(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const fc=[],pn=[];let yc=[];const Im=[],Lb=Promise.resolve();let Am=!1;function Pb(){Am||(Am=!0,Lb.then(Db))}function zb(){return Pb(),Lb}function uh(r){yc.push(r)}function Po(r){Im.push(r)}const Yp=new Set;let ic=0;function Db(){if(ic!==0)return;const r=ch;do{try{for(;ic<fc.length;){const e=fc[ic];ic++,th(e),VS(e.$$)}}catch(e){throw fc.length=0,ic=0,e}for(th(null),fc.length=0,ic=0;pn.length;)pn.pop()();for(let e=0;e<yc.length;e+=1){const t=yc[e];Yp.has(t)||(Yp.add(t),t())}yc.length=0}while(fc.length);for(;Im.length;)Im.pop()();Am=!1,Yp.clear(),th(r)}function VS(r){if(r.fragment!==null){r.update(),_n(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(uh)}}function qS(r){const e=[],t=[];yc.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),yc=e}const qf=new Set;let Ja;function vr(){Ja={r:0,c:[],p:Ja}}function br(){Ja.r||_n(Ja.c),Ja=Ja.p}function oe(r,e){r&&r.i&&(qf.delete(r),r.i(e))}function pe(r,e,t,n){if(r&&r.o){if(qf.has(r))return;qf.add(r),Ja.c.push(()=>{qf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function Jn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function GS(r,e){pe(r,1,1,()=>{e.delete(r.key)})}function WS(r,e,t,n,l,u,d,a,_,x,k,S){let C=r.length,P=u.length,D=C;const O={};for(;D--;)O[r[D].key]=D;const z=[],B=new Map,N=new Map,G=[];for(D=P;D--;){const $=S(l,u,D),J=t($);let _e=d.get(J);_e?n&&G.push(()=>_e.p($,e)):(_e=x(J,$),_e.c()),B.set(J,z[D]=_e),J in O&&N.set(J,Math.abs(D-O[J]))}const U=new Set,te=new Set;function le($){oe($,1),$.m(a,k),d.set($.key,$),k=$.first,P--}for(;C&&P;){const $=z[P-1],J=r[C-1],_e=$.key,ze=J.key;$===J?(k=$.first,C--,P--):B.has(ze)?!d.has(_e)||U.has(_e)?le($):te.has(ze)?C--:N.get(_e)>N.get(ze)?(te.add(_e),le($)):(U.add(ze),C--):(_(J,d),C--)}for(;C--;){const $=r[C];B.has($.key)||_($,d)}for(;P;)le(z[P-1]);return _n(G),z}function Lm(r,e){const t={},n={},l={$$scope:1};let u=r.length;for(;u--;){const d=r[u],a=e[u];if(a){for(const _ in d)_ in a||(n[_]=1);for(const _ in a)l[_]||(t[_]=a[_],l[_]=1);r[u]=a}else for(const _ in d)l[_]=1}for(const d in n)d in t||(t[d]=void 0);return t}function zo(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function Ve(r){r&&r.c()}function Ne(r,e,t){const{fragment:n,after_update:l}=r.$$;n&&n.m(e,t),uh(()=>{const u=r.$$.on_mount.map(Tb).filter(xc);r.$$.on_destroy?r.$$.on_destroy.push(...u):_n(u),r.$$.on_mount=[]}),l.forEach(uh)}function je(r,e){const t=r.$$;t.fragment!==null&&(qS(t.after_update),_n(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ZS(r,e){r.$$.dirty[0]===-1&&(fc.push(r),Pb(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Zt(r,e,t,n,l,u,d=null,a=[-1]){const _=ch;th(r);const x=r.$$={fragment:null,ctx:[],props:u,update:It,not_equal:l,bound:Fy(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Fy(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(x.root);let k=!1;if(x.ctx=t?t(r,e.props||{},(S,C,...P)=>{const D=P.length?P[0]:C;return x.ctx&&l(x.ctx[S],x.ctx[S]=D)&&(!x.skip_bound&&x.bound[S]&&x.bound[S](D),k&&ZS(r,S)),C}):[],x.update(),k=!0,_n(x.before_update),x.fragment=n?n(x.ctx):!1,e.target){if(e.hydrate){const S=jS(e.target);x.fragment&&x.fragment.l(S),S.forEach(ve)}else x.fragment&&x.fragment.c();e.intro&&oe(r.$$.fragment),Ne(r,e.target,e.anchor),Db()}th(_)}class Ht{constructor(){Wn(this,"$$");Wn(this,"$$set")}$destroy(){je(this,1),this.$destroy=It}$on(e,t){if(!xc(t))return It;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!OS(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const HS="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(HS);function Oy(r){let e,t;return{c(){e=de("div"),t=tt(r[0]),Ee(e,"class","svelte-1uuov7f")},m(n,l){be(n,e,l),ie(e,t)},p(n,l){l&1&&Lr(t,n[0])},d(n){n&&ve(e)}}}function $S(r){let e,t=r[0]&&Oy(r);return{c(){t&&t.c(),e=$n()},m(n,l){t&&t.m(n,l),be(n,e,l)},p(n,[l]){n[0]?t?t.p(n,l):(t=Oy(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:It,o:It,d(n){n&&ve(e),t&&t.d(n)}}}function XS(r,e,t){let{loading:n}=e;return r.$$set=l=>{"loading"in l&&t(0,n=l.loading)},[n]}class Rb extends Ht{constructor(e){super(),Zt(this,e,XS,$S,jt,{loading:0})}}const KS=r=>({dialog:r&1}),Ny=r=>({dialog:r[0]});function JS(r){let e,t,n,l,u;const d=r[4].default,a=Vr(d,r,r[3],Ny);return{c(){e=de("dialog"),t=de("article"),a&&a.c(),e.open=!0},m(_,x){be(_,e,x),ie(e,t),a&&a.m(t,null),r[6](e),n=!0,l||(u=[Et(window,"click",r[1]),Et(window,"keydown",r[2]),Et(e,"close",r[5])],l=!0)},p(_,[x]){a&&a.p&&(!n||x&9)&&Gr(a,d,_,_[3],n?qr(d,_[3],x,KS):Wr(_[3]),Ny)},i(_){n||(oe(a,_),n=!0)},o(_){pe(a,_),n=!1},d(_){_&&ve(e),a&&a.d(_),r[6](null),l=!1,_n(u)}}}function YS(r,e,t){let{$$slots:n={},$$scope:l}=e,u;function d(k){u.open&&k.target==u&&u.close()}function a(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),u.close())}function _(k){ur.call(this,r,k)}function x(k){pn[k?"unshift":"push"](()=>{u=k,t(0,u)})}return r.$$set=k=>{"$$scope"in k&&t(3,l=k.$$scope)},[u,d,a,l,n,_,x]}class zd extends Ht{constructor(e){super(),Zt(this,e,YS,JS,jt,{})}}function jy(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function Uy(r){let e,t,n=r[1]+"",l,u,d,a=r[2]+"",_,x;return{c(){e=de("tr"),t=de("td"),l=tt(n),u=Ue(),d=de("td"),_=tt(a),x=Ue()},m(k,S){be(k,e,S),ie(e,t),ie(t,l),ie(e,u),ie(e,d),ie(d,_),ie(e,x)},p(k,S){S&1&&n!==(n=k[1]+"")&&Lr(l,n),S&1&&a!==(a=k[2]+"")&&Lr(_,a)},d(k){k&&ve(e)}}}function QS(r){let e,t,n=Jn(Object.entries(r[0])),l=[];for(let u=0;u<n.length;u+=1)l[u]=Uy(jy(r,n,u));return{c(){e=de("table"),t=de("tbody");for(let u=0;u<l.length;u+=1)l[u].c();Ee(e,"class","svelte-lh2o9l")},m(u,d){be(u,e,d),ie(e,t);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null)},p(u,[d]){if(d&1){n=Jn(Object.entries(u[0]));let a;for(a=0;a<n.length;a+=1){const _=jy(u,n,a);l[a]?l[a].p(_,d):(l[a]=Uy(_),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}},i:It,o:It,d(u){u&&ve(e),Ds(l,u)}}}function ek(r,e,t){let{properties:n}=e;return r.$$set=l=>{"properties"in l&&t(0,n=l.properties)},[n]}class Dd extends Ht{constructor(e){super(),Zt(this,e,ek,QS,jt,{properties:0})}}function ld(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function dn(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}let ct;const Bb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Bb.decode();let Hu=null;function vc(){return(Hu===null||Hu.byteLength===0)&&(Hu=new Uint8Array(ct.memory.buffer)),Hu}function Qi(r,e){return r=r>>>0,Bb.decode(vc().subarray(r,r+e))}const As=new Array(128).fill(void 0);As.push(void 0,null,!0,!1);let rh=As.length;function Ur(r){rh===As.length&&As.push(As.length+1);const e=rh;return rh=As[e],As[e]=r,e}function hr(r){return As[r]}function tk(r){r<132||(As[r]=rh,rh=r)}function Ai(r){const e=hr(r);return tk(r),e}let Wi=0;const Gf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},rk=typeof Gf.encodeInto=="function"?function(r,e){return Gf.encodeInto(r,e)}:function(r,e){const t=Gf.encode(r);return e.set(t),{read:r.length,written:t.length}};function Go(r,e,t){if(t===void 0){const a=Gf.encode(r),_=e(a.length,1)>>>0;return vc().subarray(_,_+a.length).set(a),Wi=a.length,_}let n=r.length,l=e(n,1)>>>0;const u=vc();let d=0;for(;d<n;d++){const a=r.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==n){d!==0&&(r=r.slice(d)),l=t(l,n,n=d+r.length*3,1)>>>0;const a=vc().subarray(l+d,l+n),_=rk(r,a);d+=_.written}return Wi=d,l}function dc(r){return r==null}let $u=null;function Wt(){return($u===null||$u.byteLength===0)&&($u=new Int32Array(ct.memory.buffer)),$u}let Xu=null;function Fb(){return(Xu===null||Xu.byteLength===0)&&(Xu=new Float64Array(ct.memory.buffer)),Xu}let Ku=null;function nk(){return(Ku===null||Ku.byteLength===0)&&(Ku=new BigInt64Array(ct.memory.buffer)),Ku}function Pm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=Pm(r[0]));for(let d=1;d<l;d++)u+=", "+Pm(r[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function ik(r,e){const t=e(r.length*1,1)>>>0;return vc().set(r,t/1),Wi=r.length,t}function ok(r,e){return r=r>>>0,Fb().subarray(r/8,r/8+e)}function sk(r,e){return r=r>>>0,vc().subarray(r/1,r/1+e)}function Ka(r,e){try{return r.apply(this,e)}catch(t){ct.__wbindgen_exn_store(Ur(t))}}class Ob{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();ct.__wbg_ltn_free(e)}constructor(e,t,n){try{const x=ct.__wbindgen_add_to_stack_pointer(-16),k=ik(e,ct.__wbindgen_malloc),S=Wi;var l=dc(n)?0:Go(n,ct.__wbindgen_malloc,ct.__wbindgen_realloc),u=Wi;ct.ltn_new(x,k,S,Ur(t),l,u);var d=Wt()[x/4+0],a=Wt()[x/4+1],_=Wt()[x/4+2];if(_)throw Ai(a);return this.__wbg_ptr=d>>>0,this}finally{ct.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const x=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_getInvertedBoundary(x,this.__wbg_ptr);var n=Wt()[x/4+0],l=Wt()[x/4+1],u=Wt()[x/4+2],d=Wt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,Ai(u);return e=a,t=_,Qi(a,_)}finally{ct.__wbindgen_add_to_stack_pointer(16),ct.__wbindgen_free(e,t,1)}}getBounds(){try{const l=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_getBounds(l,this.__wbg_ptr);var e=Wt()[l/4+0],t=Wt()[l/4+1],n=ok(e,t).slice();return ct.__wbindgen_free(e,t*8,8),n}finally{ct.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=Wt()[l/4+0],t=Wt()[l/4+1],n=sk(e,t).slice();return ct.__wbindgen_free(e,t*1,1),n}finally{ct.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const x=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_toRouteSnapperGj(x,this.__wbg_ptr);var n=Wt()[x/4+0],l=Wt()[x/4+1],u=Wt()[x/4+2],d=Wt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,Ai(u);return e=a,t=_,Qi(a,_)}finally{ct.__wbindgen_add_to_stack_pointer(16),ct.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const x=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_renderModalFilters(x,this.__wbg_ptr);var n=Wt()[x/4+0],l=Wt()[x/4+1],u=Wt()[x/4+2],d=Wt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,Ai(u);return e=a,t=_,Qi(a,_)}finally{ct.__wbindgen_add_to_stack_pointer(16),ct.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const x=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_renderNeighbourhood(x,this.__wbg_ptr);var n=Wt()[x/4+0],l=Wt()[x/4+1],u=Wt()[x/4+2],d=Wt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,Ai(u);return e=a,t=_,Qi(a,_)}finally{ct.__wbindgen_add_to_stack_pointer(16),ct.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const x=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_renderAutoBoundaries(x,this.__wbg_ptr);var n=Wt()[x/4+0],l=Wt()[x/4+1],u=Wt()[x/4+2],d=Wt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,Ai(u);return e=a,t=_,Qi(a,_)}finally{ct.__wbindgen_add_to_stack_pointer(16),ct.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const u=ct.__wbindgen_add_to_stack_pointer(-16),d=Go(e,ct.__wbindgen_malloc,ct.__wbindgen_realloc),a=Wi;ct.ltn_setNeighbourhoodBoundary(u,this.__wbg_ptr,d,a,Ur(t));var n=Wt()[u/4+0],l=Wt()[u/4+1];if(l)throw Ai(n)}finally{ct.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Go(e,ct.__wbindgen_malloc,ct.__wbindgen_realloc),n=Wi;ct.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Go(e,ct.__wbindgen_malloc,ct.__wbindgen_realloc),l=Wi,u=Go(t,ct.__wbindgen_malloc,ct.__wbindgen_realloc),d=Wi;ct.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,l,u,d)}setCurrentNeighbourhood(e,t){try{const u=ct.__wbindgen_add_to_stack_pointer(-16),d=Go(e,ct.__wbindgen_malloc,ct.__wbindgen_realloc),a=Wi;ct.ltn_setCurrentNeighbourhood(u,this.__wbg_ptr,d,a,t);var n=Wt()[u/4+0],l=Wt()[u/4+1];if(l)throw Ai(n)}finally{ct.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const u=ct.__wbindgen_add_to_stack_pointer(-16),d=Go(t,ct.__wbindgen_malloc,ct.__wbindgen_realloc),a=Wi;ct.ltn_addModalFilter(u,this.__wbg_ptr,Ur(e),d,a);var n=Wt()[u/4+0],l=Wt()[u/4+1];if(l)throw Ai(n)}finally{ct.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const u=ct.__wbindgen_add_to_stack_pointer(-16),d=Go(t,ct.__wbindgen_malloc,ct.__wbindgen_realloc),a=Wi;ct.ltn_addManyModalFilters(u,this.__wbg_ptr,Ur(e),d,a);var n=Wt()[u/4+0],l=Wt()[u/4+1];if(l)throw Ai(n)}finally{ct.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){ct.ltn_deleteModalFilter(this.__wbg_ptr,e)}toggleDirection(e){ct.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){ct.ltn_undo(this.__wbg_ptr)}redo(){ct.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const k=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_getShortcutsCrossingRoad(k,this.__wbg_ptr,e);var l=Wt()[k/4+0],u=Wt()[k/4+1],d=Wt()[k/4+2],a=Wt()[k/4+3],_=l,x=u;if(a)throw _=0,x=0,Ai(d);return t=_,n=x,Qi(_,x)}finally{ct.__wbindgen_add_to_stack_pointer(16),ct.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const x=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_getAllShortcuts(x,this.__wbg_ptr);var n=Wt()[x/4+0],l=Wt()[x/4+1],u=Wt()[x/4+2],d=Wt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,Ai(u);return e=a,t=_,Qi(a,_)}finally{ct.__wbindgen_add_to_stack_pointer(16),ct.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const x=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_toSavefile(x,this.__wbg_ptr);var n=Wt()[x/4+0],l=Wt()[x/4+1],u=Wt()[x/4+2],d=Wt()[x/4+3],a=n,_=l;if(d)throw a=0,_=0,Ai(u);return e=a,t=_,Qi(a,_)}finally{ct.__wbindgen_add_to_stack_pointer(16),ct.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_loadSavefile(l,this.__wbg_ptr,Ur(e));var t=Wt()[l/4+0],n=Wt()[l/4+1];if(n)throw Ai(t)}finally{ct.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,l,u){let d,a;try{const D=ct.__wbindgen_add_to_stack_pointer(-16);ct.ltn_compareRoute(D,this.__wbg_ptr,e,t,n,l,u);var _=Wt()[D/4+0],x=Wt()[D/4+1],k=Wt()[D/4+2],S=Wt()[D/4+3],C=_,P=x;if(S)throw C=0,P=0,Ai(k);return d=C,a=P,Qi(C,P)}finally{ct.__wbindgen_add_to_stack_pointer(16),ct.__wbindgen_free(d,a,1)}}}async function ak(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function lk(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Qi(e,t));return Ur(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Ai(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=hr(t),l=typeof n=="string"?n:void 0;var u=dc(l)?0:Go(l,ct.__wbindgen_malloc,ct.__wbindgen_realloc),d=Wi;Wt()[e/4+1]=d,Wt()[e/4+0]=u},r.wbg.__wbindgen_string_new=function(e,t){const n=Qi(e,t);return Ur(n)},r.wbg.__wbindgen_boolean_get=function(e){const t=hr(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof hr(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=hr(t),l=typeof n=="number"?n:void 0;Fb()[e/8+1]=dc(l)?0:l,Wt()[e/4+0]=!dc(l)},r.wbg.__wbindgen_is_object=function(e){const t=hr(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return hr(e)in hr(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return Ur(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return hr(e)===hr(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Ur(t)},r.wbg.__wbindgen_is_undefined=function(e){return hr(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return hr(e)==hr(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=hr(e);return Ur(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=hr(e)[hr(t)];return Ur(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(hr(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(hr(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(hr(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(hr(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(hr(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Ur(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=hr(t).stack,l=Go(n,ct.__wbindgen_malloc,ct.__wbindgen_realloc),u=Wi;Wt()[e/4+1]=u,Wt()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(Qi(e,t))}finally{ct.__wbindgen_free(n,l,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=hr(e).performance;return Ur(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return hr(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=hr(e)[t>>>0];return Ur(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return hr(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof hr(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Qi(e,t));return Ur(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=hr(e).next;return Ur(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Ka(function(e){const t=hr(e).next();return Ur(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return hr(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=hr(e).value;return Ur(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Ur(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Ka(function(e,t){const n=Reflect.get(hr(e),hr(t));return Ur(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return Ka(function(e,t){const n=hr(e).call(hr(t));return Ur(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return Ka(function(){const e=self.self;return Ur(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return Ka(function(){const e=window.window;return Ur(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return Ka(function(){const e=globalThis.globalThis;return Ur(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return Ka(function(){const e=global.global;return Ur(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(hr(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=hr(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(hr(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(hr(e));return Ur(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=hr(e).buffer;return Ur(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(hr(e));return Ur(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){hr(e).set(hr(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return hr(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=hr(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=hr(t),l=typeof n=="bigint"?n:void 0;nk()[e/8+1]=dc(l)?BigInt(0):l,Wt()[e/4+0]=!dc(l)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Pm(hr(t)),l=Go(n,ct.__wbindgen_malloc,ct.__wbindgen_realloc),u=Wi;Wt()[e/4+1]=u,Wt()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Qi(e,t))},r.wbg.__wbindgen_memory=function(){const e=ct.memory;return Ur(e)},r}function ck(r,e){return ct=r.exports,Nb.__wbindgen_wasm_module=e,Ku=null,Xu=null,$u=null,Hu=null,ct}async function Nb(r){if(ct!==void 0)return ct;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=lk();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ak(await r,e);return ck(t,n)}var Sh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kg(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Rd(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var l=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,l.get?l:{enumerable:!0,get:function(){return r[n]}})}),t}var jb={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(Sh,function(){var t={},n={};function l(d,a,_){if(n[d]=_,d==="index"){var x="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",k={};return n.shared(k),n.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([x],{type:"text/javascript"}))),t}}l("shared",["exports"],function(d){function a(s,i,c,f){return new(c||(c=Promise))(function(g,b){function w(L){try{I(f.next(L))}catch(F){b(F)}}function T(L){try{I(f.throw(L))}catch(F){b(F)}}function I(L){var F;L.done?g(L.value):(F=L.value,F instanceof c?F:new c(function(j){j(F)})).then(w,T)}I((f=f.apply(s,i||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var x=k;function k(s,i){this.x=s,this.y=i}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,c=s.y-this.y;return i*i+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),c=Math.sin(s),f=c*this.x+i*this.y;return this.x=i*this.x-c*this.y,this.y=f,this},_rotateAround:function(s,i){var c=Math.cos(s),f=Math.sin(s),g=i.y+f*(this.x-i.x)+c*(this.y-i.y);return this.x=i.x+c*(this.x-i.x)-f*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var S=_(x),C=P;function P(s,i,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=c,this.p2y=f}P.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<i)return c;var b=this.sampleCurveDerivativeX(c);if(Math.abs(b)<1e-6)break;c-=g/b}var w=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<i));f++)s>g?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var D=_(C);let O,z;function B(){return O==null&&(O=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),O}function N(){if(z==null&&(z=!1,B())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let f=0;f<5*5;f++){const g=4*f;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(f%5,Math.floor(f/5),1,1)}const c=i.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){z=!0;break}}}return z||!1}function G(s,i,c,f){const g=new D(s,i,c,f);return function(b){return g.solve(b)}}const U=G(.25,.1,.25,1);function te(s,i,c){return Math.min(c,Math.max(i,s))}function le(s,i,c){const f=c-i,g=((s-i)%f+f)%f+i;return g===i?c:g}function $(s,...i){for(const c of i)for(const f in c)s[f]=c[f];return s}let J=1;function _e(s,i,c){const f={};for(const g in s)f[g]=i.call(c||this,s[g],g,s);return f}function ze(s,i,c){const f={};for(const g in s)i.call(c||this,s[g],g,s)&&(f[g]=s[g]);return f}function re(s){return Array.isArray(s)?s.map(re):typeof s=="object"&&s?_e(s,re):s}const ue={};function He(s){ue[s]||(typeof console<"u"&&console.warn(s),ue[s]=!0)}function Me(s,i,c){return(c.y-s.y)*(i.x-s.x)>(i.y-s.y)*(c.x-s.x)}function ut(s){let i=0;for(let c,f,g=0,b=s.length,w=b-1;g<b;w=g++)c=s[g],f=s[w],i+=(f.x-c.x)*(c.y+f.y);return i}function At(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let Nt=null;function Je(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Kt(s,i,c,f,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(s,{timestamp:0});try{const w=b==null?void 0:b.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const T=w.startsWith("BGR"),I=new Uint8ClampedArray(f*g*4);if(yield b.copyTo(I,function(L,F,j,H,K){const Q=4*Math.max(-F,0),ae=(Math.max(0,j)-j)*H*4+Q,ge=4*H,xe=Math.max(0,F),Re=Math.max(0,j);return{rect:{x:xe,y:Re,width:Math.min(L.width,F+H)-xe,height:Math.min(L.height,j+K)-Re},layout:[{offset:ae,stride:ge}]}}(s,i,c,f,g)),T)for(let L=0;L<I.length;L+=4){const F=I[L];I[L]=I[L+2],I[L+2]=F}return I}finally{b.close()}})}let Ut,Vt;const wt="AbortError";function Yt(){return new Error(wt)}const gr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Pt(s){return gr.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const rr="global-dispatcher";class wr extends Error{constructor(i,c,f,g){super(`AJAXError: ${c} (${i}): ${f}`),this.status=i,this.statusText=c,this.url=f,this.body=g}}const mr=()=>At(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Rr=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=Pt(s.url);if(f)return f(s,i);if(At(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:rr},i)}if(!(/^file:/.test(c=s.url)||/^file:/.test(mr())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return a(this,void 0,void 0,function*(){const b=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:mr(),signal:g.signal});f.type==="json"&&b.headers.set("Accept","application/json");const w=yield fetch(b);if(!w.ok){const L=yield w.blob();throw new wr(w.status,w.statusText,f.url,L)}let T;T=f.type==="arrayBuffer"||f.type==="image"?w.arrayBuffer():f.type==="json"?w.json():w.text();const I=yield T;if(g.signal.aborted)throw Yt();return{data:I,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(s,i);if(At(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:rr},i)}var c;return function(f,g){return new Promise((b,w)=>{const T=new XMLHttpRequest;T.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(T.responseType="arraybuffer");for(const I in f.headers)T.setRequestHeader(I,f.headers[I]);f.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=f.credentials==="include",T.onerror=()=>{w(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let I=T.response;if(f.type==="json")try{I=JSON.parse(T.response)}catch(L){return void w(L)}b({data:I,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const I=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});w(new wr(T.status,T.statusText,f.url,I))}},g.signal.addEventListener("abort",()=>{T.abort(),w(Yt())}),T.send(f.body)})}(s,i)};function ht(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const i=new URL(s),c=window.location;return i.protocol===c.protocol&&i.host===c.host}function Mt(s,i,c){c[s]&&c[s].indexOf(i)!==-1||(c[s]=c[s]||[],c[s].push(i))}function De(s,i,c){if(c&&c[s]){const f=c[s].indexOf(i);f!==-1&&c[s].splice(f,1)}}class lt{constructor(i,c={}){$(this,c),this.type=i}}class nt extends lt{constructor(i,c={}){super("error",$({error:i},c))}}class xt{on(i,c){return this._listeners=this._listeners||{},Mt(i,c,this._listeners),this}off(i,c){return De(i,c,this._listeners),De(i,c,this._oneTimeListeners),this}once(i,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},Mt(i,c,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,c){typeof i=="string"&&(i=new lt(i,c||{}));const f=i.type;if(this.listens(f)){i.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,i);const b=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of b)De(f,T,this._oneTimeListeners),T.call(this,i);const w=this._eventedParent;w&&($(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(i))}else i instanceof nt&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,c){return this._eventedParent=i,this._eventedParentData=c,this}}var ne={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const nr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Be(s,i){const c={};for(const f in s)f!=="ref"&&(c[f]=s[f]);return nr.forEach(f=>{f in i&&(c[f]=i[f])}),c}function Ze(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let c=0;c<s.length;c++)if(!Ze(s[c],i[c]))return!1;return!0}if(typeof s=="object"&&s!==null&&i!==null){if(typeof i!="object"||Object.keys(s).length!==Object.keys(i).length)return!1;for(const c in s)if(!Ze(s[c],i[c]))return!1;return!0}return s===i}function bt(s,i){s.push(i)}function bn(s,i,c){bt(c,{command:"addSource",args:[s,i[s]]})}function wn(s,i,c){bt(i,{command:"removeSource",args:[s]}),c[s]=!0}function Mn(s,i,c,f){wn(s,c,f),bn(s,i,c)}function ni(s,i,c){let f;for(f in s[c])if(Object.prototype.hasOwnProperty.call(s[c],f)&&f!=="data"&&!Ze(s[c][f],i[c][f]))return!1;for(f in i[c])if(Object.prototype.hasOwnProperty.call(i[c],f)&&f!=="data"&&!Ze(s[c][f],i[c][f]))return!1;return!0}function ii(s,i,c,f,g,b){s=s||{},i=i||{};for(const w in s)Object.prototype.hasOwnProperty.call(s,w)&&(Ze(s[w],i[w])||c.push({command:b,args:[f,w,i[w],g]}));for(const w in i)Object.prototype.hasOwnProperty.call(i,w)&&!Object.prototype.hasOwnProperty.call(s,w)&&(Ze(s[w],i[w])||c.push({command:b,args:[f,w,i[w],g]}))}function $o(s){return s.id}function Jr(s,i){return s[i.id]=i,s}class st{constructor(i,c,f,g){this.message=(i?`${i}: `:"")+f,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function Xn(s,...i){for(const c of i)for(const f in c)s[f]=c[f];return s}class xn extends Error{constructor(i,c){super(c),this.message=c,this.key=i}}class Bo{constructor(i,c=[]){this.parent=i,this.bindings={};for(const[f,g]of c)this.bindings[f]=g}concat(i){return new Bo(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Or={kind:"null"},pt={kind:"number"},ir={kind:"string"},Qt={kind:"boolean"},Nr={kind:"color"},vi={kind:"object"},tr={kind:"value"},ro={kind:"collator"},an={kind:"formatted"},me={kind:"padding"},Z={kind:"resolvedImage"},X={kind:"variableAnchorOffsetCollection"};function ee(s,i){return{kind:"array",itemType:s,N:i}}function ce(s){if(s.kind==="array"){const i=ce(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}return s.kind}const Ce=[Or,pt,ir,Qt,Nr,an,vi,ee(tr),me,Z,X];function Ie(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Ie(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(const c of Ce)if(!Ie(c,i))return null}}return`Expected ${ce(s)} but found ${ce(i)} instead.`}function Pe(s,i){return i.some(c=>c.kind===s.kind)}function Se(s,i){return i.some(c=>c==="null"?s===null:c==="array"?Array.isArray(s):c==="object"?s&&!Array.isArray(s)&&typeof s=="object":c===typeof s)}function W(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}const Fe=.96422,Oe=.82521,Ge=4/29,Ke=6/29,at=3*Ke*Ke,zt=Ke*Ke*Ke,$t=Math.PI/180,ar=180/Math.PI;function _r(s){return(s%=360)<0&&(s+=360),s}function Yr([s,i,c,f]){let g,b;const w=lr((.2225045*(s=Cn(s))+.7168786*(i=Cn(i))+.0606169*(c=Cn(c)))/1);s===i&&i===c?g=b=w:(g=lr((.4360747*s+.3850649*i+.1430804*c)/Fe),b=lr((.0139322*s+.0971045*i+.7141733*c)/Oe));const T=116*w-16;return[T<0?0:T,500*(g-w),200*(w-b),f]}function Cn(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function lr(s){return s>zt?Math.pow(s,1/3):s/at+Ge}function ln([s,i,c,f]){let g=(s+16)/116,b=isNaN(i)?g:g+i/500,w=isNaN(c)?g:g-c/200;return g=1*fi(g),b=Fe*fi(b),w=Oe*fi(w),[Bn(3.1338561*b-1.6168667*g-.4906146*w),Bn(-.9787684*b+1.9161415*g+.033454*w),Bn(.0719453*b-.2289914*g+1.4052427*w),f]}function Bn(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function fi(s){return s>Ke?s*s*s:at*(s-Ge)}function bi(s){return parseInt(s.padEnd(2,s),16)/255}function Kn(s,i){return mo(i?s/100:s,0,1)}function mo(s,i,c){return Math.min(Math.max(i,s),c)}function Ih(s){return!s.some(Number.isNaN)}const Zd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Pr{constructor(i,c,f,g=1,b=!0){this.r=i,this.g=c,this.b=f,this.a=g,b||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,c,f,g]))}static parse(i){if(i instanceof Pr)return i;if(typeof i!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Zd[f];if(g){const[w,T,I]=g;return[w/255,T/255,I/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const w=f.length<6?1:2;let T=1;return[bi(f.slice(T,T+=w)),bi(f.slice(T,T+=w)),bi(f.slice(T,T+=w)),bi(f.slice(T,T+w)||"ff")]}if(f.startsWith("rgb")){const w=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[T,I,L,F,j,H,K,Q,ae,ge,xe,Re]=w,ke=[F||" ",K||" ",ge].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const Ae=[L,H,ae].join(""),Ye=Ae==="%%%"?100:Ae===""?255:0;if(Ye){const Qe=[mo(+I/Ye,0,1),mo(+j/Ye,0,1),mo(+Q/Ye,0,1),xe?Kn(+xe,Re):1];if(Ih(Qe))return Qe}}return}}const b=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[w,T,I,L,F,j,H,K,Q]=b,ae=[I||" ",F||" ",H].join("");if(ae==="  "||ae==="  /"||ae===",,"||ae===",,,"){const ge=[+T,mo(+L,0,100),mo(+j,0,100),K?Kn(+K,Q):1];if(Ih(ge))return function([xe,Re,ke,Ae]){function Ye(Qe){const Tt=(Qe+xe/30)%12,Dt=Re*Math.min(ke,1-ke);return ke-Dt*Math.max(-1,Math.min(Tt-3,9-Tt,1))}return xe=_r(xe),Re/=100,ke/=100,[Ye(0),Ye(8),Ye(4),Ae]}(ge)}}}(i);return c?new Pr(...c,!1):void 0}get rgb(){const{r:i,g:c,b:f,a:g}=this,b=g||1/0;return this.overwriteGetter("rgb",[i/b,c/b,f/b,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[c,f,g,b]=Yr(i),w=Math.sqrt(f*f+g*g);return[Math.round(1e4*w)?_r(Math.atan2(g,f)*ar):NaN,w,c,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Yr(this.rgb))}overwriteGetter(i,c){return Object.defineProperty(this,i,{value:c}),c}toString(){const[i,c,f,g]=this.rgb;return`rgba(${[i,c,f].map(b=>Math.round(255*b)).join(",")},${g})`}}Pr.black=new Pr(0,0,0,1),Pr.white=new Pr(1,1,1,1),Pr.transparent=new Pr(0,0,0,0),Pr.red=new Pr(1,0,0,1);class Fc{constructor(i,c,f){this.sensitivity=i?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,c){return this.collator.compare(i,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Oc{constructor(i,c,f,g,b){this.text=i,this.image=c,this.scale=f,this.fontStack=g,this.textColor=b}}class Ri{constructor(i){this.sections=i}static fromString(i){return new Ri([new Oc(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof Ri?i:Ri.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class wi{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof wi)return i;if(typeof i=="number")return new wi([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const c of i)if(typeof c!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new wi(i)}}toString(){return JSON.stringify(this.values)}}const ka=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class $i{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof $i)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let c=0;c<i.length;c+=2){const f=i[c],g=i[c+1];if(typeof f!="string"||!ka.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new $i(i)}}toString(){return JSON.stringify(this.values)}}class Xi{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Xi({name:i,available:!1}):null}}function js(s,i,c,f){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,i,c,f]:[s,i,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function al(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Pr||s instanceof Fc||s instanceof Ri||s instanceof wi||s instanceof $i||s instanceof Xi)return!0;if(Array.isArray(s)){for(const i of s)if(!al(i))return!1;return!0}if(typeof s=="object"){for(const i in s)if(!al(s[i]))return!1;return!0}return!1}function In(s){if(s===null)return Or;if(typeof s=="string")return ir;if(typeof s=="boolean")return Qt;if(typeof s=="number")return pt;if(s instanceof Pr)return Nr;if(s instanceof Fc)return ro;if(s instanceof Ri)return an;if(s instanceof wi)return me;if(s instanceof $i)return X;if(s instanceof Xi)return Z;if(Array.isArray(s)){const i=s.length;let c;for(const f of s){const g=In(f);if(c){if(c===g)continue;c=tr;break}c=g}return ee(c||tr,i)}return vi}function Ta(s){const i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof Pr||s instanceof Ri||s instanceof wi||s instanceof $i||s instanceof Xi?s.toString():JSON.stringify(s)}class Xo{constructor(i,c){this.type=i,this.value=c}static parse(i,c){if(i.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!al(i[1]))return c.error("invalid value");const f=i[1];let g=In(f);const b=c.expectedType;return g.kind!=="array"||g.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(g=b),new Xo(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class rn{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const ll={string:ir,number:pt,boolean:Qt,object:vi};class Bi{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");let f,g=1;const b=i[0];if(b==="array"){let T,I;if(i.length>2){const L=i[1];if(typeof L!="string"||!(L in ll)||L==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=ll[L],g++}else T=tr;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=i[2],g++}f=ee(T,I)}else{if(!ll[b])throw new Error(`Types doesn't contain name = ${b}`);f=ll[b]}const w=[];for(;g<i.length;g++){const T=c.parse(i[g],g,tr);if(!T)return null;w.push(T)}return new Bi(f,w)}evaluate(i){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(i);if(!Ie(this.type,In(f)))return f;if(c===this.args.length-1)throw new rn(`Expected value to be of type ${ce(this.type)}, but found ${ce(In(f))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const cl={"to-boolean":Qt,"to-color":Nr,"to-number":pt,"to-string":ir};class go{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const f=i[0];if(!cl[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&i.length!==2)return c.error("Expected one argument.");const g=cl[f],b=[];for(let w=1;w<i.length;w++){const T=c.parse(i[w],w,tr);if(!T)return null;b.push(T)}return new go(g,b)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let c,f;for(const g of this.args){if(c=g.evaluate(i),f=null,c instanceof Pr)return c;if(typeof c=="string"){const b=i.parseColor(c);if(b)return b}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:js(c[0],c[1],c[2],c[3]),!f))return new Pr(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new rn(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(i);const g=wi.parse(c);if(g)return g}throw new rn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(i);const g=$i.parse(c);if(g)return g}throw new rn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(i),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new rn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return Ri.fromString(Ta(this.args[0].evaluate(i)));case"resolvedImage":return Xi.fromString(Ta(this.args[0].evaluate(i)));default:return Ta(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Ea=["Unknown","Point","LineString","Polygon"];class zr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ea[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let c=this._parseColorCache[i];return c||(c=this._parseColorCache[i]=Pr.parse(i)),c}}class ul{constructor(i,c,f=[],g,b=new Bo,w=[]){this.registry=i,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=b,this.errors=w,this.expectedType=g,this._isConstant=c}parse(i,c,f,g,b={}){return c?this.concat(c,f,g)._parse(i,b):this._parse(i,b)}_parse(i,c){function f(g,b,w){return w==="assert"?new Bi(b,[g]):w==="coerce"?new go(b,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[g];if(b){let w=b.parse(i,this);if(!w)return null;if(this.expectedType){const T=this.expectedType,I=w.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||I.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(T.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(T,I))return null}else w=f(w,T,c.typeAnnotation||"coerce");else w=f(w,T,c.typeAnnotation||"coerce");else w=f(w,T,c.typeAnnotation||"coerce");else w=f(w,T,c.typeAnnotation||"assert")}if(!(w instanceof Xo)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const T=new zr;try{w=new Xo(w.type,w.evaluate(T))}catch(I){return this.error(I.message),null}}return w}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,c,f){const g=typeof i=="number"?this.path.concat(i):this.path,b=f?this.scope.concat(f):this.scope;return new ul(this.registry,this._isConstant,g,c||null,b,this.errors)}error(i,...c){const f=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new xn(f,i))}checkSubtype(i,c){const f=Ie(i,c);return f&&this.error(f),f}}class Us{constructor(i,c,f){this.type=ro,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=c}static parse(i,c){if(i.length!==2)return c.error("Expected one argument.");const f=i[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const g=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Qt);if(!g)return null;const b=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Qt);if(!b)return null;let w=null;return f.locale&&(w=c.parse(f.locale,1,ir),!w)?null:new Us(g,b,w)}evaluate(i){return new Fc(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const Ko=8192;function hl(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function Ma(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Hd(s,i){const c=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(c*g*Ko),Math.round(f*g*Ko)]}function Ah(s,i,c){const f=s[0]-i[0],g=s[1]-i[1],b=s[0]-c[0],w=s[1]-c[1];return f*w-b*g==0&&f*b<=0&&g*w<=0}function fl(s,i){let c=!1;for(let w=0,T=i.length;w<T;w++){const I=i[w];for(let L=0,F=I.length;L<F-1;L++){if(Ah(s,I[L],I[L+1]))return!1;(g=I[L])[1]>(f=s)[1]!=(b=I[L+1])[1]>f[1]&&f[0]<(b[0]-g[0])*(f[1]-g[1])/(b[1]-g[1])+g[0]&&(c=!c)}}var f,g,b;return c}function $d(s,i){for(let c=0;c<i.length;c++)if(fl(s,i[c]))return!0;return!1}function Lh(s,i,c,f){const g=f[0]-c[0],b=f[1]-c[1],w=(s[0]-c[0])*b-g*(s[1]-c[1]),T=(i[0]-c[0])*b-g*(i[1]-c[1]);return w>0&&T<0||w<0&&T>0}function Xd(s,i,c){for(const L of c)for(let F=0;F<L.length-1;++F)if((T=[(w=L[F+1])[0]-(b=L[F])[0],w[1]-b[1]])[0]*(I=[(g=i)[0]-(f=s)[0],g[1]-f[1]])[1]-T[1]*I[0]!=0&&Lh(f,g,b,w)&&Lh(b,w,f,g))return!0;var f,g,b,w,T,I;return!1}function Ph(s,i){for(let c=0;c<s.length;++c)if(!fl(s[c],i))return!1;for(let c=0;c<s.length-1;++c)if(Xd(s[c],s[c+1],i))return!1;return!0}function zh(s,i){for(let c=0;c<i.length;c++)if(Ph(s,i[c]))return!0;return!1}function dl(s,i,c){const f=[];for(let g=0;g<s.length;g++){const b=[];for(let w=0;w<s[g].length;w++){const T=Hd(s[g][w],c);hl(i,T),b.push(T)}f.push(b)}return f}function Dh(s,i,c){const f=[];for(let g=0;g<s.length;g++){const b=dl(s[g],i,c);f.push(b)}return f}function Rh(s,i,c,f){if(s[0]<c[0]||s[0]>c[2]){const g=.5*f;let b=s[0]-c[0]>g?-f:c[0]-s[0]>g?f:0;b===0&&(b=s[0]-c[2]>g?-f:c[2]-s[0]>g?f:0),s[0]+=b}hl(i,s)}function pl(s,i,c,f){const g=Math.pow(2,f.z)*Ko,b=[f.x*Ko,f.y*Ko],w=[];for(const T of s)for(const I of T){const L=[I.x+b[0],I.y+b[1]];Rh(L,i,c,g),w.push(L)}return w}function Bh(s,i,c,f){const g=Math.pow(2,f.z)*Ko,b=[f.x*Ko,f.y*Ko],w=[];for(const I of s){const L=[];for(const F of I){const j=[F.x+b[0],F.y+b[1]];hl(i,j),L.push(j)}w.push(L)}if(i[2]-i[0]<=g/2){(T=i)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of w)for(const L of I)Rh(L,i,c,g)}var T;return w}class ds{constructor(i,c){this.type=Qt,this.geojson=i,this.geometries=c}static parse(i,c){if(i.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(al(i[1])){const f=i[1];if(f.type==="FeatureCollection"){const g=[];for(const b of f.features){const{type:w,coordinates:T}=b.geometry;w==="Polygon"&&g.push(T),w==="MultiPolygon"&&g.push(...T)}if(g.length)return new ds(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new ds(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new ds(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(f.type==="Polygon"){const T=dl(f.coordinates,b,w),I=pl(c.geometry(),g,b,w);if(!Ma(g,b))return!1;for(const L of I)if(!fl(L,T))return!1}if(f.type==="MultiPolygon"){const T=Dh(f.coordinates,b,w),I=pl(c.geometry(),g,b,w);if(!Ma(g,b))return!1;for(const L of I)if(!$d(L,T))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=c.canonicalID();if(f.type==="Polygon"){const T=dl(f.coordinates,b,w),I=Bh(c.geometry(),g,b,w);if(!Ma(g,b))return!1;for(const L of I)if(!Ph(L,T))return!1}if(f.type==="MultiPolygon"){const T=Dh(f.coordinates,b,w),I=Bh(c.geometry(),g,b,w);if(!Ma(g,b))return!1;for(const L of I)if(!zh(L,T))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class ml{constructor(i,c){this.type=c.type,this.name=i,this.boundExpression=c}static parse(i,c){if(i.length!==2||typeof i[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=i[1];return c.scope.has(f)?new ml(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Fi{constructor(i,c,f,g){this.name=i,this.type=c,this._evaluate=f,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,c){const f=i[0],g=Fi.definitions[f];if(!g)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(g)?g[0]:g.type,w=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=w.filter(([L])=>!Array.isArray(L)||L.length===i.length-1);let I=null;for(const[L,F]of T){I=new ul(c.registry,Ca,c.path,null,c.scope);const j=[];let H=!1;for(let K=1;K<i.length;K++){const Q=i[K],ae=Array.isArray(L)?L[K-1]:L.type,ge=I.parse(Q,1+j.length,ae);if(!ge){H=!0;break}j.push(ge)}if(!H)if(Array.isArray(L)&&L.length!==j.length)I.error(`Expected ${L.length} arguments, but found ${j.length} instead.`);else{for(let K=0;K<j.length;K++){const Q=Array.isArray(L)?L[K]:L.type,ae=j[K];I.concat(K+1).checkSubtype(Q,ae.type)}if(I.errors.length===0)return new Fi(f,b,F,j)}}if(T.length===1)c.errors.push(...I.errors);else{const L=(T.length?T:w).map(([j])=>{return H=j,Array.isArray(H)?`(${H.map(ce).join(", ")})`:`(${ce(H.type)}...)`;var H}).join(" | "),F=[];for(let j=1;j<i.length;j++){const H=c.parse(i[j],1+F.length);if(!H)return null;F.push(ce(H.type))}c.error(`Expected arguments of type ${L}, but found (${F.join(", ")}) instead.`)}return null}static register(i,c){Fi.definitions=c;for(const f in c)i[f]=Fi}}function Ca(s){if(s instanceof ml)return Ca(s.boundExpression);if(s instanceof Fi&&s.name==="error"||s instanceof Us||s instanceof ds)return!1;const i=s instanceof go||s instanceof Bi;let c=!0;return s.eachChild(f=>{c=i?c&&Ca(f):c&&f instanceof Xo}),!!c&&gl(s)&&Aa(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function gl(s){if(s instanceof Fi&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof ds)return!1;let i=!0;return s.eachChild(c=>{i&&!gl(c)&&(i=!1)}),i}function Ia(s){if(s instanceof Fi&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(c=>{i&&!Ia(c)&&(i=!1)}),i}function Aa(s,i){if(s instanceof Fi&&i.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(f=>{c&&!Aa(f,i)&&(c=!1)}),c}function La(s,i){const c=s.length-1;let f,g,b=0,w=c,T=0;for(;b<=w;)if(T=Math.floor((b+w)/2),f=s[T],g=s[T+1],f<=i){if(T===c||i<g)return T;b=T+1}else{if(!(f>i))throw new rn("Input is not a number.");w=T-1}return 0}class Pa{constructor(i,c,f){this.type=i,this.input=c,this.labels=[],this.outputs=[];for(const[g,b]of f)this.labels.push(g),this.outputs.push(b)}static parse(i,c){if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(i[1],1,pt);if(!f)return null;const g=[];let b=null;c.expectedType&&c.expectedType.kind!=="value"&&(b=c.expectedType);for(let w=1;w<i.length;w+=2){const T=w===1?-1/0:i[w],I=i[w+1],L=w,F=w+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const j=c.parse(I,F,b);if(!j)return null;b=b||j.type,g.push([T,j])}return new Pa(b,f,g)}evaluate(i){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return f[0].evaluate(i);const b=c.length;return g>=c[b-1]?f[b-1].evaluate(i):f[La(c,g)].evaluate(i)}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Kd(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Jd=Fh;function Fh(s,i,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=c,this.p2y=f}Fh.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<i)return c;var b=this.sampleCurveDerivativeX(c);if(Math.abs(b)<1e-6)break;c-=g/b}var w=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<i));f++)s>g?w=c:T=c,c=.5*(T-w)+w;return c},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var Yd=Kd(Jd);function ps(s,i,c){return s+c*(i-s)}function _l(s,i,c){return s.map((f,g)=>ps(f,i[g],c))}const di={number:ps,color:function(s,i,c,f="rgb"){switch(f){case"rgb":{const[g,b,w,T]=_l(s.rgb,i.rgb,c);return new Pr(g,b,w,T,!1)}case"hcl":{const[g,b,w,T]=s.hcl,[I,L,F,j]=i.hcl;let H,K;if(isNaN(g)||isNaN(I))isNaN(g)?isNaN(I)?H=NaN:(H=I,w!==1&&w!==0||(K=L)):(H=g,F!==1&&F!==0||(K=b));else{let Re=I-g;I>g&&Re>180?Re-=360:I<g&&g-I>180&&(Re+=360),H=g+c*Re}const[Q,ae,ge,xe]=function([Re,ke,Ae,Ye]){return Re=isNaN(Re)?0:Re*$t,ln([Ae,Math.cos(Re)*ke,Math.sin(Re)*ke,Ye])}([H,K??ps(b,L,c),ps(w,F,c),ps(T,j,c)]);return new Pr(Q,ae,ge,xe,!1)}case"lab":{const[g,b,w,T]=ln(_l(s.lab,i.lab,c));return new Pr(g,b,w,T,!1)}}},array:_l,padding:function(s,i,c){return new wi(_l(s.values,i.values,c))},variableAnchorOffsetCollection:function(s,i,c){const f=s.values,g=i.values;if(f.length!==g.length)throw new rn(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const b=[];for(let w=0;w<f.length;w+=2){if(f[w]!==g[w])throw new rn(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${g[w]}`);b.push(f[w]);const[T,I]=f[w+1],[L,F]=g[w+1];b.push([ps(T,L,c),ps(I,F,c)])}return new $i(b)}};class oi{constructor(i,c,f,g,b){this.type=i,this.operator=c,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[w,T]of b)this.labels.push(w),this.outputs.push(T)}static interpolationFactor(i,c,f,g){let b=0;if(i.name==="exponential")b=Mr(c,i.base,f,g);else if(i.name==="linear")b=Mr(c,1,f,g);else if(i.name==="cubic-bezier"){const w=i.controlPoints;b=new Yd(w[0],w[1],w[2],w[3]).solve(Mr(c,1,f,g))}return b}static parse(i,c){let[f,g,b,...w]=i;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(F=>typeof F!="number"||F<0||F>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(i.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(b=c.parse(b,2,pt),!b)return null;const T=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=Nr:c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(let L=0;L<w.length;L+=2){const F=w[L],j=w[L+1],H=L+3,K=L+4;if(typeof F!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(T.length&&T[T.length-1][0]>=F)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const Q=c.parse(j,K,I);if(!Q)return null;I=I||Q.type,T.push([F,Q])}return W(I,pt)||W(I,Nr)||W(I,me)||W(I,X)||W(I,ee(pt))?new oi(I,f,g,b,T):c.error(`Type ${ce(I)} is not interpolatable.`)}evaluate(i){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=c[0])return f[0].evaluate(i);const b=c.length;if(g>=c[b-1])return f[b-1].evaluate(i);const w=La(c,g),T=oi.interpolationFactor(this.interpolation,g,c[w],c[w+1]),I=f[w].evaluate(i),L=f[w+1].evaluate(i);switch(this.operator){case"interpolate":return di[this.type.kind](I,L,T);case"interpolate-hcl":return di.color(I,L,T,"hcl");case"interpolate-lab":return di.color(I,L,T,"lab")}}eachChild(i){i(this.input);for(const c of this.outputs)i(c)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Mr(s,i,c,f){const g=f-c,b=s-c;return g===0?0:i===1?b/g:(Math.pow(i,b)-1)/(Math.pow(i,g)-1)}class yl{constructor(i,c){this.type=i,this.args=c}static parse(i,c){if(i.length<2)return c.error("Expectected at least one argument.");let f=null;const g=c.expectedType;g&&g.kind!=="value"&&(f=g);const b=[];for(const T of i.slice(1)){const I=c.parse(T,1+b.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,b.push(I)}if(!f)throw new Error("No output type");const w=g&&b.some(T=>Ie(g,T.type));return new yl(w?tr:f,b)}evaluate(i){let c,f=null,g=0;for(const b of this.args)if(g++,f=b.evaluate(i),f&&f instanceof Xi&&!f.available&&(c||(c=f.name),f=null,g===this.args.length&&(f=c)),f!==null)break;return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class vl{constructor(i,c){this.type=c.type,this.bindings=[].concat(i),this.result=c}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const c of this.bindings)i(c[1]);i(this.result)}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let b=1;b<i.length-1;b+=2){const w=i[b];if(typeof w!="string")return c.error(`Expected string, but found ${typeof w} instead.`,b);if(/[^a-zA-Z0-9_]/.test(w))return c.error("Variable names must contain only alphanumeric characters or '_'.",b);const T=c.parse(i[b+1],b+1);if(!T)return null;f.push([w,T])}const g=c.parse(i[i.length-1],i.length-1,c.expectedType,f);return g?new vl(f,g):null}outputDefined(){return this.result.outputDefined()}}class Nc{constructor(i,c,f){this.type=i,this.index=c,this.input=f}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=c.parse(i[1],1,pt),g=c.parse(i[2],2,ee(c.expectedType||tr));return f&&g?new Nc(g.type.itemType,f,g):null}evaluate(i){const c=this.index.evaluate(i),f=this.input.evaluate(i);if(c<0)throw new rn(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new rn(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new rn(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class jc{constructor(i,c){this.type=Qt,this.needle=i,this.haystack=c}static parse(i,c){if(i.length!==3)return c.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=c.parse(i[1],1,tr),g=c.parse(i[2],2,tr);return f&&g?Pe(f.type,[Qt,ir,pt,Or,tr])?new jc(f,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ce(f.type)} instead`):null}evaluate(i){const c=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!f)return!1;if(!Se(c,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${ce(In(c))} instead.`);if(!Se(f,["string","array"]))throw new rn(`Expected second argument to be of type array or string, but found ${ce(In(f))} instead.`);return f.indexOf(c)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class bl{constructor(i,c,f){this.type=pt,this.needle=i,this.haystack=c,this.fromIndex=f}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=c.parse(i[1],1,tr),g=c.parse(i[2],2,tr);if(!f||!g)return null;if(!Pe(f.type,[Qt,ir,pt,Or,tr]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${ce(f.type)} instead`);if(i.length===4){const b=c.parse(i[3],3,pt);return b?new bl(f,g,b):null}return new bl(f,g)}evaluate(i){const c=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!Se(c,["boolean","string","number","null"]))throw new rn(`Expected first argument to be of type boolean, string, number or null, but found ${ce(In(c))} instead.`);if(!Se(f,["string","array"]))throw new rn(`Expected second argument to be of type array or string, but found ${ce(In(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return f.indexOf(c,g)}return f.indexOf(c)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class Uc{constructor(i,c,f,g,b,w){this.inputType=i,this.type=c,this.input=f,this.cases=g,this.outputs=b,this.otherwise=w}static parse(i,c){if(i.length<5)return c.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return c.error("Expected an even number of arguments.");let f,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const b={},w=[];for(let L=2;L<i.length-1;L+=2){let F=i[L];const j=i[L+1];Array.isArray(F)||(F=[F]);const H=c.concat(L);if(F.length===0)return H.error("Expected at least one branch label.");for(const Q of F){if(typeof Q!="number"&&typeof Q!="string")return H.error("Branch labels must be numbers or strings.");if(typeof Q=="number"&&Math.abs(Q)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Q=="number"&&Math.floor(Q)!==Q)return H.error("Numeric branch labels must be integer values.");if(f){if(H.checkSubtype(f,In(Q)))return null}else f=In(Q);if(b[String(Q)]!==void 0)return H.error("Branch labels must be unique.");b[String(Q)]=w.length}const K=c.parse(j,L,g);if(!K)return null;g=g||K.type,w.push(K)}const T=c.parse(i[1],1,tr);if(!T)return null;const I=c.parse(i[i.length-1],i.length-1,g);return I?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new Uc(f,g,T,b,w,I):null}evaluate(i){const c=this.input.evaluate(i);return(In(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class Vc{constructor(i,c,f){this.type=i,this.branches=c,this.otherwise=f}static parse(i,c){if(i.length<4)return c.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const g=[];for(let w=1;w<i.length-1;w+=2){const T=c.parse(i[w],w,Qt);if(!T)return null;const I=c.parse(i[w+1],w+1,f);if(!I)return null;g.push([T,I]),f=f||I.type}const b=c.parse(i[i.length-1],i.length-1,f);if(!b)return null;if(!f)throw new Error("Can't infer output type");return new Vc(f,g,b)}evaluate(i){for(const[c,f]of this.branches)if(c.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[c,f]of this.branches)i(c),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class wl{constructor(i,c,f,g){this.type=i,this.input=c,this.beginIndex=f,this.endIndex=g}static parse(i,c){if(i.length<=2||i.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=c.parse(i[1],1,tr),g=c.parse(i[2],2,pt);if(!f||!g)return null;if(!Pe(f.type,[ee(tr),ir,tr]))return c.error(`Expected first argument to be of type array or string, but found ${ce(f.type)} instead`);if(i.length===4){const b=c.parse(i[3],3,pt);return b?new wl(f.type,f,g,b):null}return new wl(f.type,f,g)}evaluate(i){const c=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!Se(c,["string","array"]))throw new rn(`Expected first argument to be of type array or string, but found ${ce(In(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return c.slice(f,g)}return c.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function Oh(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Nh(s,i,c,f){return f.compare(i,c)===0}function Vs(s,i,c){const f=s!=="=="&&s!=="!=";return class Ub{constructor(b,w,T){this.type=Qt,this.lhs=b,this.rhs=w,this.collator=T,this.hasUntypedArgument=b.type.kind==="value"||w.type.kind==="value"}static parse(b,w){if(b.length!==3&&b.length!==4)return w.error("Expected two or three arguments.");const T=b[0];let I=w.parse(b[1],1,tr);if(!I)return null;if(!Oh(T,I.type))return w.concat(1).error(`"${T}" comparisons are not supported for type '${ce(I.type)}'.`);let L=w.parse(b[2],2,tr);if(!L)return null;if(!Oh(T,L.type))return w.concat(2).error(`"${T}" comparisons are not supported for type '${ce(L.type)}'.`);if(I.type.kind!==L.type.kind&&I.type.kind!=="value"&&L.type.kind!=="value")return w.error(`Cannot compare types '${ce(I.type)}' and '${ce(L.type)}'.`);f&&(I.type.kind==="value"&&L.type.kind!=="value"?I=new Bi(L.type,[I]):I.type.kind!=="value"&&L.type.kind==="value"&&(L=new Bi(I.type,[L])));let F=null;if(b.length===4){if(I.type.kind!=="string"&&L.type.kind!=="string"&&I.type.kind!=="value"&&L.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(F=w.parse(b[3],3,ro),!F)return null}return new Ub(I,L,F)}evaluate(b){const w=this.lhs.evaluate(b),T=this.rhs.evaluate(b);if(f&&this.hasUntypedArgument){const I=In(w),L=In(T);if(I.kind!==L.kind||I.kind!=="string"&&I.kind!=="number")throw new rn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${I.kind}, ${L.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=In(w),L=In(T);if(I.kind!=="string"||L.kind!=="string")return i(b,w,T)}return this.collator?c(b,w,T,this.collator.evaluate(b)):i(b,w,T)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const Qd=Vs("==",function(s,i,c){return i===c},Nh),ep=Vs("!=",function(s,i,c){return i!==c},function(s,i,c,f){return!Nh(0,i,c,f)}),tp=Vs("<",function(s,i,c){return i<c},function(s,i,c,f){return f.compare(i,c)<0}),rp=Vs(">",function(s,i,c){return i>c},function(s,i,c,f){return f.compare(i,c)>0}),np=Vs("<=",function(s,i,c){return i<=c},function(s,i,c,f){return f.compare(i,c)<=0}),ip=Vs(">=",function(s,i,c){return i>=c},function(s,i,c,f){return f.compare(i,c)>=0});class qc{constructor(i,c,f,g,b){this.type=ir,this.number=i,this.locale=c,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=b}static parse(i,c){if(i.length!==3)return c.error("Expected two arguments.");const f=c.parse(i[1],1,pt);if(!f)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let b=null;if(g.locale&&(b=c.parse(g.locale,1,ir),!b))return null;let w=null;if(g.currency&&(w=c.parse(g.currency,1,ir),!w))return null;let T=null;if(g["min-fraction-digits"]&&(T=c.parse(g["min-fraction-digits"],1,pt),!T))return null;let I=null;return g["max-fraction-digits"]&&(I=c.parse(g["max-fraction-digits"],1,pt),!I)?null:new qc(f,b,w,T,I)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class xl{constructor(i){this.type=an,this.sections=i}static parse(i,c){if(i.length<2)return c.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const g=[];let b=!1;for(let w=1;w<=i.length-1;++w){const T=i[w];if(b&&typeof T=="object"&&!Array.isArray(T)){b=!1;let I=null;if(T["font-scale"]&&(I=c.parse(T["font-scale"],1,pt),!I))return null;let L=null;if(T["text-font"]&&(L=c.parse(T["text-font"],1,ee(ir)),!L))return null;let F=null;if(T["text-color"]&&(F=c.parse(T["text-color"],1,Nr),!F))return null;const j=g[g.length-1];j.scale=I,j.font=L,j.textColor=F}else{const I=c.parse(i[w],1,tr);if(!I)return null;const L=I.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new xl(g)}evaluate(i){return new Ri(this.sections.map(c=>{const f=c.content.evaluate(i);return In(f)===Z?new Oc("",f,null,null,null):new Oc(Ta(f),null,c.scale?c.scale.evaluate(i):null,c.font?c.font.evaluate(i).join(","):null,c.textColor?c.textColor.evaluate(i):null)}))}eachChild(i){for(const c of this.sections)i(c.content),c.scale&&i(c.scale),c.font&&i(c.font),c.textColor&&i(c.textColor)}outputDefined(){return!1}}class Gc{constructor(i){this.type=Z,this.input=i}static parse(i,c){if(i.length!==2)return c.error("Expected two arguments.");const f=c.parse(i[1],1,ir);return f?new Gc(f):c.error("No image name provided.")}evaluate(i){const c=this.input.evaluate(i),f=Xi.fromString(c);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(c)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}}class Wc{constructor(i){this.type=pt,this.input=i}static parse(i,c){if(i.length!==2)return c.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=c.parse(i[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${ce(f.type)} instead.`):new Wc(f):null}evaluate(i){const c=this.input.evaluate(i);if(typeof c=="string"||Array.isArray(c))return c.length;throw new rn(`Expected value to be of type string or array, but found ${ce(In(c))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const qs={"==":Qd,"!=":ep,">":rp,"<":tp,">=":ip,"<=":np,array:Bi,at:Nc,boolean:Bi,case:Vc,coalesce:yl,collator:Us,format:xl,image:Gc,in:jc,"index-of":bl,interpolate:oi,"interpolate-hcl":oi,"interpolate-lab":oi,length:Wc,let:vl,literal:Xo,match:Uc,number:Bi,"number-format":qc,object:Bi,slice:wl,step:Pa,string:Bi,"to-boolean":go,"to-color":go,"to-number":go,"to-string":go,var:ml,within:ds};function jh(s,[i,c,f,g]){i=i.evaluate(s),c=c.evaluate(s),f=f.evaluate(s);const b=g?g.evaluate(s):1,w=js(i,c,f,b);if(w)throw new rn(w);return new Pr(i/255,c/255,f/255,b,!1)}function Uh(s,i){return s in i}function Zc(s,i){const c=i[s];return c===void 0?null:c}function ms(s){return{type:s}}function Vh(s){return{result:"success",value:s}}function Gs(s){return{result:"error",value:s}}function Ws(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function qh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Hc(s){return!!s.expression&&s.expression.interpolated}function Tr(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Sl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function op(s){return s}function Gh(s,i){const c=i.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",g=f||!(f||s.property!==void 0),b=s.type||(Hc(i)?"exponential":"interval");if(c||i.type==="padding"){const F=c?Pr.parse:wi.parse;(s=Xn({},s)).stops&&(s.stops=s.stops.map(j=>[j[0],F(j[1])])),s.default=F(s.default?s.default:i.default)}if(s.colorSpace&&(w=s.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var w;let T,I,L;if(b==="exponential")T=xr;else if(b==="interval")T=sp;else if(b==="categorical"){T=Sn,I=Object.create(null);for(const F of s.stops)I[F[0]]=F[1];L=typeof s.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);T=$c}if(f){const F={},j=[];for(let Q=0;Q<s.stops.length;Q++){const ae=s.stops[Q],ge=ae[0].zoom;F[ge]===void 0&&(F[ge]={zoom:ge,type:s.type,property:s.property,default:s.default,stops:[]},j.push(ge)),F[ge].stops.push([ae[0].value,ae[1]])}const H=[];for(const Q of j)H.push([F[Q].zoom,Gh(F[Q],i)]);const K={name:"linear"};return{kind:"composite",interpolationType:K,interpolationFactor:oi.interpolationFactor.bind(void 0,K),zoomStops:H.map(Q=>Q[0]),evaluate:({zoom:Q},ae)=>xr({stops:H,base:s.base},i,Q).evaluate(Q,ae)}}if(g){const F=b==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:F,interpolationFactor:oi.interpolationFactor.bind(void 0,F),zoomStops:s.stops.map(j=>j[0]),evaluate:({zoom:j})=>T(s,i,j,I,L)}}return{kind:"source",evaluate(F,j){const H=j&&j.properties?j.properties[s.property]:void 0;return H===void 0?za(s.default,i.default):T(s,i,H,I,L)}}}function za(s,i,c){return s!==void 0?s:i!==void 0?i:c!==void 0?c:void 0}function Sn(s,i,c,f,g){return za(typeof c===g?f[c]:void 0,s.default,i.default)}function sp(s,i,c){if(Tr(c)!=="number")return za(s.default,i.default);const f=s.stops.length;if(f===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[f-1][0])return s.stops[f-1][1];const g=La(s.stops.map(b=>b[0]),c);return s.stops[g][1]}function xr(s,i,c){const f=s.base!==void 0?s.base:1;if(Tr(c)!=="number")return za(s.default,i.default);const g=s.stops.length;if(g===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[g-1][0])return s.stops[g-1][1];const b=La(s.stops.map(F=>F[0]),c),w=function(F,j,H,K){const Q=K-H,ae=F-H;return Q===0?0:j===1?ae/Q:(Math.pow(j,ae)-1)/(Math.pow(j,Q)-1)}(c,f,s.stops[b][0],s.stops[b+1][0]),T=s.stops[b][1],I=s.stops[b+1][1],L=di[i.type]||op;return typeof T.evaluate=="function"?{evaluate(...F){const j=T.evaluate.apply(void 0,F),H=I.evaluate.apply(void 0,F);if(j!==void 0&&H!==void 0)return L(j,H,w,s.colorSpace)}}:L(T,I,w,s.colorSpace)}function $c(s,i,c){switch(i.type){case"color":c=Pr.parse(c);break;case"formatted":c=Ri.fromString(c.toString());break;case"resolvedImage":c=Xi.fromString(c.toString());break;case"padding":c=wi.parse(c);break;default:Tr(c)===i.type||i.type==="enum"&&i.values[c]||(c=void 0)}return za(c,s.default,i.default)}Fi.register(qs,{error:[{kind:"error"},[ir],(s,[i])=>{throw new rn(i.evaluate(s))}],typeof:[ir,[tr],(s,[i])=>ce(In(i.evaluate(s)))],"to-rgba":[ee(pt,4),[Nr],(s,[i])=>{const[c,f,g,b]=i.evaluate(s).rgb;return[255*c,255*f,255*g,b]}],rgb:[Nr,[pt,pt,pt],jh],rgba:[Nr,[pt,pt,pt,pt],jh],has:{type:Qt,overloads:[[[ir],(s,[i])=>Uh(i.evaluate(s),s.properties())],[[ir,vi],(s,[i,c])=>Uh(i.evaluate(s),c.evaluate(s))]]},get:{type:tr,overloads:[[[ir],(s,[i])=>Zc(i.evaluate(s),s.properties())],[[ir,vi],(s,[i,c])=>Zc(i.evaluate(s),c.evaluate(s))]]},"feature-state":[tr,[ir],(s,[i])=>Zc(i.evaluate(s),s.featureState||{})],properties:[vi,[],s=>s.properties()],"geometry-type":[ir,[],s=>s.geometryType()],id:[tr,[],s=>s.id()],zoom:[pt,[],s=>s.globals.zoom],"heatmap-density":[pt,[],s=>s.globals.heatmapDensity||0],"line-progress":[pt,[],s=>s.globals.lineProgress||0],accumulated:[tr,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[pt,ms(pt),(s,i)=>{let c=0;for(const f of i)c+=f.evaluate(s);return c}],"*":[pt,ms(pt),(s,i)=>{let c=1;for(const f of i)c*=f.evaluate(s);return c}],"-":{type:pt,overloads:[[[pt,pt],(s,[i,c])=>i.evaluate(s)-c.evaluate(s)],[[pt],(s,[i])=>-i.evaluate(s)]]},"/":[pt,[pt,pt],(s,[i,c])=>i.evaluate(s)/c.evaluate(s)],"%":[pt,[pt,pt],(s,[i,c])=>i.evaluate(s)%c.evaluate(s)],ln2:[pt,[],()=>Math.LN2],pi:[pt,[],()=>Math.PI],e:[pt,[],()=>Math.E],"^":[pt,[pt,pt],(s,[i,c])=>Math.pow(i.evaluate(s),c.evaluate(s))],sqrt:[pt,[pt],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[pt,[pt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[pt,[pt],(s,[i])=>Math.log(i.evaluate(s))],log2:[pt,[pt],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[pt,[pt],(s,[i])=>Math.sin(i.evaluate(s))],cos:[pt,[pt],(s,[i])=>Math.cos(i.evaluate(s))],tan:[pt,[pt],(s,[i])=>Math.tan(i.evaluate(s))],asin:[pt,[pt],(s,[i])=>Math.asin(i.evaluate(s))],acos:[pt,[pt],(s,[i])=>Math.acos(i.evaluate(s))],atan:[pt,[pt],(s,[i])=>Math.atan(i.evaluate(s))],min:[pt,ms(pt),(s,i)=>Math.min(...i.map(c=>c.evaluate(s)))],max:[pt,ms(pt),(s,i)=>Math.max(...i.map(c=>c.evaluate(s)))],abs:[pt,[pt],(s,[i])=>Math.abs(i.evaluate(s))],round:[pt,[pt],(s,[i])=>{const c=i.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[pt,[pt],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[pt,[pt],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[Qt,[ir,tr],(s,[i,c])=>s.properties()[i.value]===c.value],"filter-id-==":[Qt,[tr],(s,[i])=>s.id()===i.value],"filter-type-==":[Qt,[ir],(s,[i])=>s.geometryType()===i.value],"filter-<":[Qt,[ir,tr],(s,[i,c])=>{const f=s.properties()[i.value],g=c.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Qt,[tr],(s,[i])=>{const c=s.id(),f=i.value;return typeof c==typeof f&&c<f}],"filter->":[Qt,[ir,tr],(s,[i,c])=>{const f=s.properties()[i.value],g=c.value;return typeof f==typeof g&&f>g}],"filter-id->":[Qt,[tr],(s,[i])=>{const c=s.id(),f=i.value;return typeof c==typeof f&&c>f}],"filter-<=":[Qt,[ir,tr],(s,[i,c])=>{const f=s.properties()[i.value],g=c.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Qt,[tr],(s,[i])=>{const c=s.id(),f=i.value;return typeof c==typeof f&&c<=f}],"filter->=":[Qt,[ir,tr],(s,[i,c])=>{const f=s.properties()[i.value],g=c.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Qt,[tr],(s,[i])=>{const c=s.id(),f=i.value;return typeof c==typeof f&&c>=f}],"filter-has":[Qt,[tr],(s,[i])=>i.value in s.properties()],"filter-has-id":[Qt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Qt,[ee(ir)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[Qt,[ee(tr)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[Qt,[ir,ee(tr)],(s,[i,c])=>c.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[Qt,[ir,ee(tr)],(s,[i,c])=>function(f,g,b,w){for(;b<=w;){const T=b+w>>1;if(g[T]===f)return!0;g[T]>f?w=T-1:b=T+1}return!1}(s.properties()[i.value],c.value,0,c.value.length-1)],all:{type:Qt,overloads:[[[Qt,Qt],(s,[i,c])=>i.evaluate(s)&&c.evaluate(s)],[ms(Qt),(s,i)=>{for(const c of i)if(!c.evaluate(s))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],(s,[i,c])=>i.evaluate(s)||c.evaluate(s)],[ms(Qt),(s,i)=>{for(const c of i)if(c.evaluate(s))return!0;return!1}]]},"!":[Qt,[Qt],(s,[i])=>!i.evaluate(s)],"is-supported-script":[Qt,[ir],(s,[i])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(i.evaluate(s))}],upcase:[ir,[ir],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[ir,[ir],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[ir,ms(tr),(s,i)=>i.map(c=>Ta(c.evaluate(s))).join("")],"resolved-locale":[ir,[ro],(s,[i])=>i.evaluate(s).resolvedLocale()]});class $r{constructor(i,c){var f;this.expression=i,this._warningHistory={},this._evaluator=new zr,this._defaultValue=c?(f=c).type==="color"&&Sl(f.default)?new Pr(0,0,0,0):f.type==="color"?Pr.parse(f.default)||null:f.type==="padding"?wi.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?$i.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(i,c,f,g,b,w){return this._evaluator.globals=i,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(i,c,f,g,b,w){this._evaluator.globals=i,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new rn(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function jr(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in qs}function gs(s,i){const c=new ul(qs,Ca,[],i?function(g){const b={color:Nr,string:ir,number:pt,enum:ir,boolean:Qt,formatted:an,padding:me,resolvedImage:Z,variableAnchorOffsetCollection:X};return g.type==="array"?ee(b[g.value]||tr,g.length):b[g.type]}(i):void 0),f=c.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Vh(new $r(f,i)):Gs(c.errors)}class kl{constructor(i,c){this.kind=i,this._styleExpression=c,this.isStateDependent=i!=="constant"&&!Ia(c.expression)}evaluateWithoutErrorHandling(i,c,f,g,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,c,f,g,b,w)}evaluate(i,c,f,g,b,w){return this._styleExpression.evaluate(i,c,f,g,b,w)}}class Xc{constructor(i,c,f,g){this.kind=i,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=i!=="camera"&&!Ia(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,c,f,g,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,c,f,g,b,w)}evaluate(i,c,f,g,b,w){return this._styleExpression.evaluate(i,c,f,g,b,w)}interpolationFactor(i,c,f){return this.interpolationType?oi.interpolationFactor(this.interpolationType,i,c,f):0}}function Wh(s,i){const c=gs(s,i);if(c.result==="error")return c;const f=c.value.expression,g=gl(f);if(!g&&!Ws(i))return Gs([new xn("","data expressions not supported")]);const b=Aa(f,["zoom"]);if(!b&&!qh(i))return Gs([new xn("","zoom expressions not supported")]);const w=El(f);return w||b?w instanceof xn?Gs([w]):w instanceof oi&&!Hc(i)?Gs([new xn("",'"interpolate" expressions cannot be used with this property')]):Vh(w?new Xc(g?"camera":"composite",c.value,w.labels,w instanceof oi?w.interpolation:void 0):new kl(g?"constant":"source",c.value)):Gs([new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Tl{constructor(i,c){this._parameters=i,this._specification=c,Xn(this,Gh(this._parameters,this._specification))}static deserialize(i){return new Tl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function El(s){let i=null;if(s instanceof vl)i=El(s.result);else if(s instanceof yl){for(const c of s.args)if(i=El(c),i)break}else(s instanceof Pa||s instanceof oi)&&s.input instanceof Fi&&s.input.name==="zoom"&&(i=s);return i instanceof xn||s.eachChild(c=>{const f=El(c);f instanceof xn?i=f:!i&&f?i=new xn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new xn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Ml(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!Ml(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Zh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Cl(s){if(s==null)return{filter:()=>!0,needGeometry:!1};Ml(s)||(s=Al(s));const i=gs(s,Zh);if(i.result==="error")throw new Error(i.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,g)=>i.value.evaluate(c,f,{},g),needGeometry:Il(s)}}function Hh(s,i){return s<i?-1:s>i?1:0}function Il(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let i=1;i<s.length;i++)if(Il(s[i]))return!0;return!1}function Al(s){if(!s)return!0;const i=s[0];return s.length<=1?i!=="any":i==="=="?Kc(s[1],s[2],"=="):i==="!="?Ll(Kc(s[1],s[2],"==")):i==="<"||i===">"||i==="<="||i===">="?Kc(s[1],s[2],i):i==="any"?(c=s.slice(1),["any"].concat(c.map(Al))):i==="all"?["all"].concat(s.slice(1).map(Al)):i==="none"?["all"].concat(s.slice(1).map(Al).map(Ll)):i==="in"?$h(s[1],s.slice(2)):i==="!in"?Ll($h(s[1],s.slice(2))):i==="has"?Xh(s[1]):i==="!has"?Ll(Xh(s[1])):i!=="within"||s;var c}function Kc(s,i,c){switch(s){case"$type":return[`filter-type-${c}`,i];case"$id":return[`filter-id-${c}`,i];default:return[`filter-${c}`,s,i]}}function $h(s,i){if(i.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(c=>typeof c!=typeof i[0])?["filter-in-large",s,["literal",i.sort(Hh)]]:["filter-in-small",s,["literal",i]]}}function Xh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Ll(s){return["!",s]}function Jc(s){const i=typeof s;if(i==="number"||i==="boolean"||i==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const b of s)g+=`${Jc(b)},`;return`${g}]`}const c=Object.keys(s).sort();let f="{";for(let g=0;g<c.length;g++)f+=`${JSON.stringify(c[g])}:${Jc(s[c[g]])},`;return`${f}}`}function ap(s){let i="";for(const c of nr)i+=`/${Jc(s[c])}`;return i}function Kh(s){const i=s.value;return i?[new st(s.key,i,"constants have been deprecated as of v8")]:[]}function cn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Jo(s){if(Array.isArray(s))return s.map(Jo);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const c in s)i[c]=Jo(s[c]);return i}return cn(s)}function pi(s){const i=s.key,c=s.value,f=s.valueSpec||{},g=s.objectElementValidators||{},b=s.style,w=s.styleSpec,T=s.validateSpec;let I=[];const L=Tr(c);if(L!=="object")return[new st(i,c,`object expected, ${L} found`)];for(const F in c){const j=F.split(".")[0],H=f[j]||f["*"];let K;if(g[j])K=g[j];else if(f[j])K=T;else if(g["*"])K=g["*"];else{if(!f["*"]){I.push(new st(i,c[F],`unknown property "${F}"`));continue}K=T}I=I.concat(K({key:(i&&`${i}.`)+F,value:c[F],valueSpec:H,style:b,styleSpec:w,object:c,objectKey:F,validateSpec:T},c))}for(const F in f)g[F]||f[F].required&&f[F].default===void 0&&c[F]===void 0&&I.push(new st(i,c,`missing required property "${F}"`));return I}function Yc(s){const i=s.value,c=s.valueSpec,f=s.style,g=s.styleSpec,b=s.key,w=s.arrayElementValidator||s.validateSpec;if(Tr(i)!=="array")return[new st(b,i,`array expected, ${Tr(i)} found`)];if(c.length&&i.length!==c.length)return[new st(b,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new st(b,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let T={type:c.value,values:c.values};g.$version<7&&(T.function=c.function),Tr(c.value)==="object"&&(T=c.value);let I=[];for(let L=0;L<i.length;L++)I=I.concat(w({array:i,arrayIndex:L,value:i[L],valueSpec:T,validateSpec:s.validateSpec,style:f,styleSpec:g,key:`${b}[${L}]`}));return I}function Pl(s){const i=s.key,c=s.value,f=s.valueSpec;let g=Tr(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new st(i,c,`number expected, ${g} found`)]:"minimum"in f&&c<f.minimum?[new st(i,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new st(i,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function Jh(s){const i=s.valueSpec,c=cn(s.value.type);let f,g,b,w={};const T=c!=="categorical"&&s.value.property===void 0,I=!T,L=Tr(s.value.stops)==="array"&&Tr(s.value.stops[0])==="array"&&Tr(s.value.stops[0][0])==="object",F=pi({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(K){if(c==="identity")return[new st(K.key,K.value,'identity function may not have a "stops" property')];let Q=[];const ae=K.value;return Q=Q.concat(Yc({key:K.key,value:ae,valueSpec:K.valueSpec,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,arrayElementValidator:j})),Tr(ae)==="array"&&ae.length===0&&Q.push(new st(K.key,ae,"array must have at least one stop")),Q},default:function(K){return K.validateSpec({key:K.key,value:K.value,valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec})}}});return c==="identity"&&T&&F.push(new st(s.key,s.value,'missing required property "property"')),c==="identity"||s.value.stops||F.push(new st(s.key,s.value,'missing required property "stops"')),c==="exponential"&&s.valueSpec.expression&&!Hc(s.valueSpec)&&F.push(new st(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(I&&!Ws(s.valueSpec)?F.push(new st(s.key,s.value,"property functions not supported")):T&&!qh(s.valueSpec)&&F.push(new st(s.key,s.value,"zoom functions not supported"))),c!=="categorical"&&!L||s.value.property!==void 0||F.push(new st(s.key,s.value,'"property" property is required')),F;function j(K){let Q=[];const ae=K.value,ge=K.key;if(Tr(ae)!=="array")return[new st(ge,ae,`array expected, ${Tr(ae)} found`)];if(ae.length!==2)return[new st(ge,ae,`array length 2 expected, length ${ae.length} found`)];if(L){if(Tr(ae[0])!=="object")return[new st(ge,ae,`object expected, ${Tr(ae[0])} found`)];if(ae[0].zoom===void 0)return[new st(ge,ae,"object stop key must have zoom")];if(ae[0].value===void 0)return[new st(ge,ae,"object stop key must have value")];if(b&&b>cn(ae[0].zoom))return[new st(ge,ae[0].zoom,"stop zoom values must appear in ascending order")];cn(ae[0].zoom)!==b&&(b=cn(ae[0].zoom),g=void 0,w={}),Q=Q.concat(pi({key:`${ge}[0]`,value:ae[0],valueSpec:{zoom:{}},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec,objectElementValidators:{zoom:Pl,value:H}}))}else Q=Q.concat(H({key:`${ge}[0]`,value:ae[0],valueSpec:{},validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec},ae));return jr(Jo(ae[1]))?Q.concat([new st(`${ge}[1]`,ae[1],"expressions are not allowed in function stops.")]):Q.concat(K.validateSpec({key:`${ge}[1]`,value:ae[1],valueSpec:i,validateSpec:K.validateSpec,style:K.style,styleSpec:K.styleSpec}))}function H(K,Q){const ae=Tr(K.value),ge=cn(K.value),xe=K.value!==null?K.value:Q;if(f){if(ae!==f)return[new st(K.key,xe,`${ae} stop domain type must match previous stop domain type ${f}`)]}else f=ae;if(ae!=="number"&&ae!=="string"&&ae!=="boolean")return[new st(K.key,xe,"stop domain value must be a number, string, or boolean")];if(ae!=="number"&&c!=="categorical"){let Re=`number expected, ${ae} found`;return Ws(i)&&c===void 0&&(Re+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new st(K.key,xe,Re)]}return c!=="categorical"||ae!=="number"||isFinite(ge)&&Math.floor(ge)===ge?c!=="categorical"&&ae==="number"&&g!==void 0&&ge<g?[new st(K.key,xe,"stop domain values must appear in ascending order")]:(g=ge,c==="categorical"&&ge in w?[new st(K.key,xe,"stop domain values must be unique")]:(w[ge]=!0,[])):[new st(K.key,xe,`integer expected, found ${ge}`)]}}function Yo(s){const i=(s.expressionContext==="property"?Wh:gs)(Jo(s.value),s.valueSpec);if(i.result==="error")return i.value.map(f=>new st(`${s.key}${f.key}`,s.value,f.message));const c=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!c.outputDefined())return[new st(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!Ia(c))return[new st(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!Ia(c))return[new st(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Aa(c,["zoom","feature-state"]))return[new st(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!gl(c))return[new st(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Qo(s){const i=s.key,c=s.value,f=s.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(cn(c))===-1&&g.push(new st(i,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(cn(c))===-1&&g.push(new st(i,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function Zs(s){return Ml(Jo(s.value))?Yo(Xn({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Qc(s)}function Qc(s){const i=s.value,c=s.key;if(Tr(i)!=="array")return[new st(c,i,`array expected, ${Tr(i)} found`)];const f=s.styleSpec;let g,b=[];if(i.length<1)return[new st(c,i,"filter array must have at least 1 element")];switch(b=b.concat(Qo({key:`${c}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),cn(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&cn(i[1])==="$type"&&b.push(new st(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&b.push(new st(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=Tr(i[1]),g!=="string"&&b.push(new st(`${c}[1]`,i[1],`string expected, ${g} found`)));for(let w=2;w<i.length;w++)g=Tr(i[w]),cn(i[1])==="$type"?b=b.concat(Qo({key:`${c}[${w}]`,value:i[w],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&b.push(new st(`${c}[${w}]`,i[w],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)b=b.concat(Qc({key:`${c}[${w}]`,value:i[w],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Tr(i[1]),i.length!==2?b.push(new st(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&b.push(new st(`${c}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=Tr(i[1]),i.length!==2?b.push(new st(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&b.push(new st(`${c}[1]`,i[1],`object expected, ${g} found`))}return b}function zl(s,i){const c=s.key,f=s.validateSpec,g=s.style,b=s.styleSpec,w=s.value,T=s.objectKey,I=b[`${i}_${s.layerType}`];if(!I)return[];const L=T.match(/^(.*)-transition$/);if(i==="paint"&&L&&I[L[1]]&&I[L[1]].transition)return f({key:c,value:w,valueSpec:b.transition,style:g,styleSpec:b});const F=s.valueSpec||I[T];if(!F)return[new st(c,w,`unknown property "${T}"`)];let j;if(Tr(w)==="string"&&Ws(F)&&!F.tokens&&(j=/^{([^}]+)}$/.exec(w)))return[new st(c,w,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(j[1])} }\`.`)];const H=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&H.push(new st(c,w,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&Sl(Jo(w))&&cn(w.type)==="identity"&&H.push(new st(c,w,'"text-font" does not support identity functions'))),H.concat(f({key:s.key,value:w,valueSpec:F,style:g,styleSpec:b,expressionContext:"property",propertyType:i,propertyKey:T}))}function eu(s){return zl(s,"paint")}function tu(s){return zl(s,"layout")}function Da(s){let i=[];const c=s.value,f=s.key,g=s.style,b=s.styleSpec;c.type||c.ref||i.push(new st(f,c,'either "type" or "ref" is required'));let w=cn(c.type);const T=cn(c.ref);if(c.id){const I=cn(c.id);for(let L=0;L<s.arrayIndex;L++){const F=g.layers[L];cn(F.id)===I&&i.push(new st(f,c.id,`duplicate layer id "${c.id}", previously used at line ${F.id.__line__}`))}}if("ref"in c){let I;["type","source","source-layer","filter","layout"].forEach(L=>{L in c&&i.push(new st(f,c[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{cn(L.id)===T&&(I=L)}),I?I.ref?i.push(new st(f,c.ref,"ref cannot reference another ref layer")):w=cn(I.type):i.push(new st(f,c.ref,`ref layer "${T}" not found`))}else if(w!=="background")if(c.source){const I=g.sources&&g.sources[c.source],L=I&&cn(I.type);I?L==="vector"&&w==="raster"?i.push(new st(f,c.source,`layer "${c.id}" requires a raster source`)):L!=="raster-dem"&&w==="hillshade"?i.push(new st(f,c.source,`layer "${c.id}" requires a raster-dem source`)):L==="raster"&&w!=="raster"?i.push(new st(f,c.source,`layer "${c.id}" requires a vector source`)):L!=="vector"||c["source-layer"]?L==="raster-dem"&&w!=="hillshade"?i.push(new st(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!c.paint||!c.paint["line-gradient"]||L==="geojson"&&I.lineMetrics||i.push(new st(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new st(f,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new st(f,c.source,`source "${c.source}" not found`))}else i.push(new st(f,c,'missing required property "source"'));return i=i.concat(pi({key:f,value:c,valueSpec:b.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:c.type,valueSpec:b.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:c,objectKey:"type"}),filter:Zs,layout:I=>pi({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":L=>tu(Xn({layerType:w},L))}}),paint:I=>pi({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":L=>eu(Xn({layerType:w},L))}})}})),i}function _s(s){const i=s.value,c=s.key,f=Tr(i);return f!=="string"?[new st(c,i,`string expected, ${f} found`)]:[]}const Yh={promoteId:function({key:s,value:i}){if(Tr(i)==="string")return _s({key:s,value:i});{const c=[];for(const f in i)c.push(..._s({key:`${s}.${f}`,value:i[f]}));return c}}};function Qh(s){const i=s.value,c=s.key,f=s.styleSpec,g=s.style,b=s.validateSpec;if(!i.type)return[new st(c,i,'"type" is required')];const w=cn(i.type);let T;switch(w){case"vector":case"raster":return T=pi({key:c,value:i,valueSpec:f[`source_${w.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:Yh,validateSpec:b}),T;case"raster-dem":return T=function(I){var L;const F=(L=I.sourceName)!==null&&L!==void 0?L:"",j=I.value,H=I.styleSpec,K=H.source_raster_dem,Q=I.style;let ae=[];const ge=Tr(j);if(j===void 0)return ae;if(ge!=="object")return ae.push(new st("source_raster_dem",j,`object expected, ${ge} found`)),ae;const xe=cn(j.encoding)==="custom",Re=["redFactor","greenFactor","blueFactor","baseShift"],ke=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const Ae in j)!xe&&Re.includes(Ae)?ae.push(new st(Ae,j[Ae],`In "${F}": "${Ae}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):K[Ae]?ae=ae.concat(I.validateSpec({key:Ae,value:j[Ae],valueSpec:K[Ae],validateSpec:I.validateSpec,style:Q,styleSpec:H})):ae.push(new st(Ae,j[Ae],`unknown property "${Ae}"`));return ae}({sourceName:c,value:i,style:s.style,styleSpec:f,validateSpec:b}),T;case"geojson":if(T=pi({key:c,value:i,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:b,objectElementValidators:Yh}),i.cluster)for(const I in i.clusterProperties){const[L,F]=i.clusterProperties[I],j=typeof L=="string"?[L,["accumulated"],["get",I]]:L;T.push(...Yo({key:`${c}.${I}.map`,value:F,validateSpec:b,expressionContext:"cluster-map"})),T.push(...Yo({key:`${c}.${I}.reduce`,value:j,validateSpec:b,expressionContext:"cluster-reduce"}))}return T;case"video":return pi({key:c,value:i,valueSpec:f.source_video,style:g,validateSpec:b,styleSpec:f});case"image":return pi({key:c,value:i,valueSpec:f.source_image,style:g,validateSpec:b,styleSpec:f});case"canvas":return[new st(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Qo({key:`${c}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:b,styleSpec:f})}}function ef(s){const i=s.value,c=s.styleSpec,f=c.light,g=s.style;let b=[];const w=Tr(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new st("light",i,`object expected, ${w} found`)]),b;for(const T in i){const I=T.match(/^(.*)-transition$/);b=b.concat(I&&f[I[1]]&&f[I[1]].transition?s.validateSpec({key:T,value:i[T],valueSpec:c.transition,validateSpec:s.validateSpec,style:g,styleSpec:c}):f[T]?s.validateSpec({key:T,value:i[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new st(T,i[T],`unknown property "${T}"`)])}return b}function tf(s){const i=s.value,c=s.styleSpec,f=c.sky,g=s.style,b=Tr(i);if(i===void 0)return[];if(b!=="object")return[new st("sky",i,`object expected, ${b} found`)];let w=[];for(const T in i)w=w.concat(f[T]?_o({key:T,value:i[T],valueSpec:f[T],style:g,styleSpec:c}):[new st(T,i[T],`unknown property "${T}"`)]);return w}function Ra(s){const i=s.value,c=s.styleSpec,f=c.terrain,g=s.style;let b=[];const w=Tr(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new st("terrain",i,`object expected, ${w} found`)]),b;for(const T in i)b=b.concat(f[T]?s.validateSpec({key:T,value:i[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new st(T,i[T],`unknown property "${T}"`)]);return b}function Ba(s){let i=[];const c=s.value,f=s.key;if(Array.isArray(c)){const g=[],b=[];for(const w in c)c[w].id&&g.includes(c[w].id)&&i.push(new st(f,c,`all the sprites' ids must be unique, but ${c[w].id} is duplicated`)),g.push(c[w].id),c[w].url&&b.includes(c[w].url)&&i.push(new st(f,c,`all the sprites' URLs must be unique, but ${c[w].url} is duplicated`)),b.push(c[w].url),i=i.concat(pi({key:`${f}[${w}]`,value:c[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return _s({key:f,value:c})}const xi={"*":()=>[],array:Yc,boolean:function(s){const i=s.value,c=s.key,f=Tr(i);return f!=="boolean"?[new st(c,i,`boolean expected, ${f} found`)]:[]},number:Pl,color:function(s){const i=s.key,c=s.value,f=Tr(c);return f!=="string"?[new st(i,c,`color expected, ${f} found`)]:Pr.parse(String(c))?[]:[new st(i,c,`color expected, "${c}" found`)]},constants:Kh,enum:Qo,filter:Zs,function:Jh,layer:Da,object:pi,source:Qh,light:ef,sky:tf,terrain:Ra,string:_s,formatted:function(s){return _s(s).length===0?[]:Yo(s)},resolvedImage:function(s){return _s(s).length===0?[]:Yo(s)},padding:function(s){const i=s.key,c=s.value;if(Tr(c)==="array"){if(c.length<1||c.length>4)return[new st(i,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let g=[];for(let b=0;b<c.length;b++)g=g.concat(s.validateSpec({key:`${i}[${b}]`,value:c[b],validateSpec:s.validateSpec,valueSpec:f}));return g}return Pl({key:i,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,c=s.value,f=Tr(c),g=s.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new st(i,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let w=0;w<c.length;w+=2)b=b.concat(Qo({key:`${i}[${w}]`,value:c[w],valueSpec:g.layout_symbol["text-anchor"]})),b=b.concat(Yc({key:`${i}[${w+1}]`,value:c[w+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return b},sprite:Ba};function _o(s){const i=s.value,c=s.valueSpec,f=s.styleSpec;return s.validateSpec=_o,c.expression&&Sl(cn(i))?Jh(s):c.expression&&jr(Jo(i))?Yo(s):c.type&&xi[c.type]?xi[c.type](s):pi(Xn({},s,{valueSpec:c.type?f[c.type]:c}))}function ru(s){const i=s.value,c=s.key,f=_s(s);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new st(c,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new st(c,i,'"glyphs" url must include a "{range}" token'))),f}function no(s,i=ne){let c=[];return c=c.concat(_o({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:_o,objectElementValidators:{glyphs:ru,"*":()=>[]}})),s.constants&&(c=c.concat(Kh({key:"constants",value:s.constants,style:s,styleSpec:i,validateSpec:_o}))),Hs(c)}function yo(s){return function(i){return s({...i,validateSpec:_o})}}function Hs(s){return[].concat(s).sort((i,c)=>i.line-c.line)}function io(s){return function(...i){return Hs(s.apply(this,i))}}no.source=io(yo(Qh)),no.sprite=io(yo(Ba)),no.glyphs=io(yo(ru)),no.light=io(yo(ef)),no.sky=io(yo(tf)),no.terrain=io(yo(Ra)),no.layer=io(yo(Da)),no.filter=io(yo(Zs)),no.paintProperty=io(yo(eu)),no.layoutProperty=io(yo(tu));const ys=no,lp=ys.light,nu=ys.paintProperty,cp=ys.layoutProperty;function $s(s,i){let c=!1;if(i&&i.length)for(const f of i)s.fire(new nt(new Error(f.message))),c=!0;return c}class Fa{constructor(i,c,f){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const w=new Int32Array(this.arrayBuffer);i=w[0],this.d=(c=w[1])+2*(f=w[2]);for(let I=0;I<this.d*this.d;I++){const L=w[3+I],F=w[3+I+1];g.push(L===F?null:w.subarray(L,F))}const T=w[3+g.length+1];this.keys=w.subarray(w[3+g.length],T),this.bboxes=w.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let w=0;w<this.d*this.d;w++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=i,this.padding=f,this.scale=c/i,this.uid=0;const b=f/c*i;this.min=-b,this.max=i+b}insert(i,c,f,g,b){this._forEachCell(c,f,g,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,c,f,g,b,w){this.cells[b].push(w)}query(i,c,f,g,b){const w=this.min,T=this.max;if(i<=w&&c<=w&&T<=f&&T<=g&&!b)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(i,c,f,g,this._queryCell,I,{},b),I}}_queryCell(i,c,f,g,b,w,T,I){const L=this.cells[b];if(L!==null){const F=this.keys,j=this.bboxes;for(let H=0;H<L.length;H++){const K=L[H];if(T[K]===void 0){const Q=4*K;(I?I(j[Q+0],j[Q+1],j[Q+2],j[Q+3]):i<=j[Q+2]&&c<=j[Q+3]&&f>=j[Q+0]&&g>=j[Q+1])?(T[K]=!0,w.push(F[K])):T[K]=!1}}}}_forEachCell(i,c,f,g,b,w,T,I){const L=this._convertToCellCoord(i),F=this._convertToCellCoord(c),j=this._convertToCellCoord(f),H=this._convertToCellCoord(g);for(let K=L;K<=j;K++)for(let Q=F;Q<=H;Q++){const ae=this.d*Q+K;if((!I||I(this._convertFromCellCoord(K),this._convertFromCellCoord(Q),this._convertFromCellCoord(K+1),this._convertFromCellCoord(Q+1)))&&b.call(this,i,c,f,g,ae,w,T,I))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,c=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const g=new Int32Array(c+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let b=c;for(let w=0;w<i.length;w++){const T=i[w];g[3+w]=b,g.set(T,b),b+=T.length}return g[3+i.length]=b,g.set(this.keys,b),b+=this.keys.length,g[3+i.length+1]=b,g.set(this.bboxes,b),b+=this.bboxes.length,g.buffer}static serialize(i,c){const f=i.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(i){return new Fa(i.buffer)}}const vo={};function Ct(s,i,c={}){if(vo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),vo[s]={klass:i,omit:c.omit||[],shallow:c.shallow||[]}}Ct("Object",Object),Ct("TransferableGridIndex",Fa),Ct("Color",Pr),Ct("Error",Error),Ct("AJAXError",wr),Ct("ResolvedImage",Xi),Ct("StylePropertyFunction",Tl),Ct("StyleExpression",$r,{omit:["_evaluator"]}),Ct("ZoomDependentExpression",Xc),Ct("ZoomConstantExpression",kl),Ct("CompoundExpression",Fi,{omit:["_evaluate"]});for(const s in qs)qs[s]._classRegistryKey||Ct(`Expression_${s}`,qs[s]);function Dl(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Xs(s,i){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(Dl(s)||Je(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const c=s;return i&&i.push(c.buffer),c}if(s instanceof ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const c=[];for(const f of s)c.push(Xs(f,i));return c}if(typeof s=="object"){const c=s.constructor,f=c._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${c.name}`);if(!vo[f])throw new Error(`${f} is not registered.`);const g=c.serialize?c.serialize(s,i):{};if(c.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in s){if(!s.hasOwnProperty(b)||vo[f].omit.indexOf(b)>=0)continue;const w=s[b];g[b]=vo[f].shallow.indexOf(b)>=0?w:Xs(w,i)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof s)}function Ks(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||Dl(s)||Je(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Ks);if(typeof s=="object"){const i=s.$name||"Object";if(!vo[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:c}=vo[i];if(!c)throw new Error(`can't deserialize unregistered class ${i}`);if(c.deserialize)return c.deserialize(s);const f=Object.create(c.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const b=s[g];f[g]=vo[i].shallow.indexOf(g)>=0?b:Ks(b)}return f}throw new Error("can't deserialize object of type "+typeof s)}class rf{constructor(){this.first=!0}update(i,c){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const St={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Js(s){for(const i of s)if(Rl(i.charCodeAt(0)))return!0;return!1}function nf(s){for(const i of s)if(!of(i.charCodeAt(0)))return!1;return!0}function of(s){return!(St.Arabic(s)||St["Arabic Supplement"](s)||St["Arabic Extended-A"](s)||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s))}function Rl(s){return!(s!==746&&s!==747&&(s<4352||!(St["Bopomofo Extended"](s)||St.Bopomofo(s)||St["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||St["CJK Compatibility Ideographs"](s)||St["CJK Compatibility"](s)||St["CJK Radicals Supplement"](s)||St["CJK Strokes"](s)||!(!St["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||St["CJK Unified Ideographs Extension A"](s)||St["CJK Unified Ideographs"](s)||St["Enclosed CJK Letters and Months"](s)||St["Hangul Compatibility Jamo"](s)||St["Hangul Jamo Extended-A"](s)||St["Hangul Jamo Extended-B"](s)||St["Hangul Jamo"](s)||St["Hangul Syllables"](s)||St.Hiragana(s)||St["Ideographic Description Characters"](s)||St.Kanbun(s)||St["Kangxi Radicals"](s)||St["Katakana Phonetic Extensions"](s)||St.Katakana(s)&&s!==12540||!(!St["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!St["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||St["Unified Canadian Aboriginal Syllabics"](s)||St["Unified Canadian Aboriginal Syllabics Extended"](s)||St["Vertical Forms"](s)||St["Yijing Hexagram Symbols"](s)||St["Yi Syllables"](s)||St["Yi Radicals"](s))))}function iu(s){return!(Rl(s)||function(i){return!!(St["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||St["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||St["Letterlike Symbols"](i)||St["Number Forms"](i)||St["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||St["Control Pictures"](i)&&i!==9251||St["Optical Character Recognition"](i)||St["Enclosed Alphanumerics"](i)||St["Geometric Shapes"](i)||St["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||St["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||St["CJK Symbols and Punctuation"](i)||St.Katakana(i)||St["Private Use Area"](i)||St["CJK Compatibility Forms"](i)||St["Small Form Variants"](i)||St["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(s))}function Bl(s){return s>=1424&&s<=2303||St["Arabic Presentation Forms-A"](s)||St["Arabic Presentation Forms-B"](s)}function sf(s,i){return!(!i&&Bl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||St.Khmer(s))}function up(s){for(const i of s)if(Bl(i.charCodeAt(0)))return!0;return!1}const es=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Qr{constructor(i,c){this.zoom=i,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new rf,this.transition={})}isSupportedScript(i){return function(c,f){for(const g of c)if(!sf(g.charCodeAt(0),f))return!1;return!0}(i,es.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,c=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class Oa{constructor(i,c){this.property=i,this.value=c,this.expression=function(f,g){if(Sl(f))return new Tl(f,g);if(jr(f)){const b=Wh(f,g);if(b.result==="error")throw new Error(b.value.map(w=>`${w.key}: ${w.message}`).join(", "));return b.value}{let b=f;return g.type==="color"&&typeof f=="string"?b=Pr.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(b=$i.parse(f)):b=wi.parse(f),{kind:"constant",evaluate:()=>b}}}(c===void 0?i.specification.default:c,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,c,f){return this.property.possiblyEvaluate(this,i,c,f)}}class Fl{constructor(i){this.property=i,this.value=new Oa(i,void 0)}transitioned(i,c){return new af(this.property,this.value,c,$({},i.transition,this.transition),i.now)}untransitioned(){return new af(this.property,this.value,null,{},0)}}class ou{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return re(this._values[i].value.value)}setValue(i,c){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Fl(this._values[i].property)),this._values[i].value=new Oa(this._values[i].property,c===null?void 0:re(c))}getTransition(i){return re(this._values[i].transition)}setTransition(i,c){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Fl(this._values[i].property)),this._values[i].transition=re(c)||void 0}serialize(){const i={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(i[c]=f);const g=this.getTransition(c);g!==void 0&&(i[`${c}-transition`]=g)}return i}transitioned(i,c){const f=new lf(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(i,c._values[g]);return f}untransitioned(){const i=new lf(this._properties);for(const c of Object.keys(this._values))i._values[c]=this._values[c].untransitioned();return i}}class af{constructor(i,c,f,g,b){this.property=i,this.value=c,this.begin=b+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(i,c,f){const g=i.now||0,b=this.value.possiblyEvaluate(i,c,f),w=this.prior;if(w){if(g>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(g<this.begin)return w.possiblyEvaluate(i,c,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(i,c,f),b,function(I){if(I<=0)return 0;if(I>=1)return 1;const L=I*I,F=L*I;return 4*(I<.5?F:3*(I-L)+F-.75)}(T))}}return b}}class lf{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,c,f){const g=new Na(this._properties);for(const b of Object.keys(this._values))g._values[b]=this._values[b].possiblyEvaluate(i,c,f);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class cf{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return re(this._values[i].value)}setValue(i,c){this._values[i]=new Oa(this._values[i].property,c===null?void 0:re(c))}serialize(){const i={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(i[c]=f)}return i}possiblyEvaluate(i,c,f){const g=new Na(this._properties);for(const b of Object.keys(this._values))g._values[b]=this._values[b].possiblyEvaluate(i,c,f);return g}}class oo{constructor(i,c,f){this.property=i,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,c,f,g){return this.property.evaluate(this.value,this.parameters,i,c,f,g)}}class Na{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Ft{constructor(i){this.specification=i}possiblyEvaluate(i,c){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(c)}interpolate(i,c,f){const g=di[this.specification.type];return g?g(i,c,f):i}}class Gt{constructor(i,c){this.specification=i,this.overrides=c}possiblyEvaluate(i,c,f,g){return new oo(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(c,null,{},f,g)}:i.expression,c)}interpolate(i,c,f){if(i.value.kind!=="constant"||c.value.kind!=="constant")return i;if(i.value.value===void 0||c.value.value===void 0)return new oo(this,{kind:"constant",value:void 0},i.parameters);const g=di[this.specification.type];if(g){const b=g(i.value.value,c.value.value,f);return new oo(this,{kind:"constant",value:b},i.parameters)}return i}evaluate(i,c,f,g,b,w){return i.kind==="constant"?i.value:i.evaluate(c,f,g,b,w)}}class Ol extends Gt{possiblyEvaluate(i,c,f,g){if(i.value===void 0)return new oo(this,{kind:"constant",value:void 0},c);if(i.expression.kind==="constant"){const b=i.expression.evaluate(c,null,{},f,g),w=i.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,T=this._calculate(w,w,w,c);return new oo(this,{kind:"constant",value:T},c)}if(i.expression.kind==="camera"){const b=this._calculate(i.expression.evaluate({zoom:c.zoom-1}),i.expression.evaluate({zoom:c.zoom}),i.expression.evaluate({zoom:c.zoom+1}),c);return new oo(this,{kind:"constant",value:b},c)}return new oo(this,i.expression,c)}evaluate(i,c,f,g,b,w){if(i.kind==="source"){const T=i.evaluate(c,f,g,b,w);return this._calculate(T,T,T,c)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(c.zoom)-1},f,g),i.evaluate({zoom:Math.floor(c.zoom)},f,g),i.evaluate({zoom:Math.floor(c.zoom)+1},f,g),c):i.value}_calculate(i,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:f,to:c}}interpolate(i){return i}}class ja{constructor(i){this.specification=i}possiblyEvaluate(i,c,f,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const b=i.expression.evaluate(c,null,{},f,g);return this._calculate(b,b,b,c)}return this._calculate(i.expression.evaluate(new Qr(Math.floor(c.zoom-1),c)),i.expression.evaluate(new Qr(Math.floor(c.zoom),c)),i.expression.evaluate(new Qr(Math.floor(c.zoom+1),c)),c)}}_calculate(i,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:c}:{from:f,to:c}}interpolate(i){return i}}class su{constructor(i){this.specification=i}possiblyEvaluate(i,c,f,g){return!!i.expression.evaluate(c,null,{},f,g)}interpolate(){return!1}}class Si{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in i){const f=i[c];f.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new Oa(f,void 0),b=this.defaultTransitionablePropertyValues[c]=new Fl(f);this.defaultTransitioningPropertyValues[c]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}Ct("DataDrivenProperty",Gt),Ct("DataConstantProperty",Ft),Ct("CrossFadedDataDrivenProperty",Ol),Ct("CrossFadedProperty",ja),Ct("ColorRampProperty",su);const au="-transition";class so extends xt{constructor(i,c){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),c.layout&&(this._unevaluatedLayout=new cf(c.layout)),c.paint)){this._transitionablePaint=new ou(c.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Na(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,c,f={}){c!=null&&this._validate(cp,`layers.${this.id}.layout.${i}`,i,c,f)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,c):this.visibility=c)}getPaintProperty(i){return i.endsWith(au)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,c,f={}){if(c!=null&&this._validate(nu,`layers.${this.id}.paint.${i}`,i,c,f))return!1;if(i.endsWith(au))return this._transitionablePaint.setTransition(i.slice(0,-11),c||void 0),!1;{const g=this._transitionablePaint._values[i],b=g.property.specification["property-type"]==="cross-faded-data-driven",w=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(i,c),this._handleSpecialPaintPropertyUpdate(i);const I=this._transitionablePaint._values[i].value;return I.isDataDriven()||w||b||this._handleOverridablePaintPropertyUpdate(i,T,I)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,c,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,c){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,c)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),ze(i,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(i,c,f,g,b={}){return(!b||b.validate!==!1)&&$s(this,i.call(ys,{key:c,layerType:this.type,objectKey:f,value:g,styleSpec:ne,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const c=this.paint.get(i);if(c instanceof oo&&Ws(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const uf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ua{constructor(i,c){this._structArray=i,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class un{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,c){return i._trim(),c&&(i.isTransferred=!0,c.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const c=Object.create(this.prototype);return c.arrayBuffer=i.arrayBuffer,c.length=i.length,c.capacity=i.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function kn(s,i=1){let c=0,f=0;return{members:s.map(g=>{const b=uf[g.type].BYTES_PER_ELEMENT,w=c=hf(c,Math.max(i,b)),T=g.components||1;return f=Math.max(f,b),c+=b*T,{name:g.name,type:g.type,components:T,offset:w}}),size:hf(c,Math.max(f,i)),alignment:i}}function hf(s,i){return Math.ceil(s/i)*i}class Va extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,c)}emplace(i,c,f){const g=2*i;return this.int16[g+0]=c,this.int16[g+1]=f,i}}Va.prototype.bytesPerElement=4,Ct("StructArrayLayout2i4",Va);class Fo extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const b=3*i;return this.int16[b+0]=c,this.int16[b+1]=f,this.int16[b+2]=g,i}}Fo.prototype.bytesPerElement=6,Ct("StructArrayLayout3i6",Fo);class lu extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,c,f,g)}emplace(i,c,f,g,b){const w=4*i;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=g,this.int16[w+3]=b,i}}lu.prototype.bytesPerElement=8,Ct("StructArrayLayout4i8",lu);class cu extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,f,g,b,w)}emplace(i,c,f,g,b,w,T){const I=6*i;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=b,this.int16[I+4]=w,this.int16[I+5]=T,i}}cu.prototype.bytesPerElement=12,Ct("StructArrayLayout2i4i12",cu);class uu extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,f,g,b,w)}emplace(i,c,f,g,b,w,T){const I=4*i,L=8*i;return this.int16[I+0]=c,this.int16[I+1]=f,this.uint8[L+4]=g,this.uint8[L+5]=b,this.uint8[L+6]=w,this.uint8[L+7]=T,i}}uu.prototype.bytesPerElement=8,Ct("StructArrayLayout2i4ub8",uu);class qa extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,c)}emplace(i,c,f){const g=2*i;return this.float32[g+0]=c,this.float32[g+1]=f,i}}qa.prototype.bytesPerElement=8,Ct("StructArrayLayout2f8",qa);class Nl extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,b,w,T,I,L,F){const j=this.length;return this.resize(j+1),this.emplace(j,i,c,f,g,b,w,T,I,L,F)}emplace(i,c,f,g,b,w,T,I,L,F,j){const H=10*i;return this.uint16[H+0]=c,this.uint16[H+1]=f,this.uint16[H+2]=g,this.uint16[H+3]=b,this.uint16[H+4]=w,this.uint16[H+5]=T,this.uint16[H+6]=I,this.uint16[H+7]=L,this.uint16[H+8]=F,this.uint16[H+9]=j,i}}Nl.prototype.bytesPerElement=20,Ct("StructArrayLayout10ui20",Nl);class hu extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,b,w,T,I,L,F,j,H){const K=this.length;return this.resize(K+1),this.emplace(K,i,c,f,g,b,w,T,I,L,F,j,H)}emplace(i,c,f,g,b,w,T,I,L,F,j,H,K){const Q=12*i;return this.int16[Q+0]=c,this.int16[Q+1]=f,this.int16[Q+2]=g,this.int16[Q+3]=b,this.uint16[Q+4]=w,this.uint16[Q+5]=T,this.uint16[Q+6]=I,this.uint16[Q+7]=L,this.int16[Q+8]=F,this.int16[Q+9]=j,this.int16[Q+10]=H,this.int16[Q+11]=K,i}}hu.prototype.bytesPerElement=24,Ct("StructArrayLayout4i4ui4i24",hu);class fu extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const b=3*i;return this.float32[b+0]=c,this.float32[b+1]=f,this.float32[b+2]=g,i}}fu.prototype.bytesPerElement=12,Ct("StructArrayLayout3f12",fu);class Oo extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint32[1*i+0]=c,i}}Oo.prototype.bytesPerElement=4,Ct("StructArrayLayout1ul4",Oo);class jl extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,b,w,T,I,L){const F=this.length;return this.resize(F+1),this.emplace(F,i,c,f,g,b,w,T,I,L)}emplace(i,c,f,g,b,w,T,I,L,F){const j=10*i,H=5*i;return this.int16[j+0]=c,this.int16[j+1]=f,this.int16[j+2]=g,this.int16[j+3]=b,this.int16[j+4]=w,this.int16[j+5]=T,this.uint32[H+3]=I,this.uint16[j+8]=L,this.uint16[j+9]=F,i}}jl.prototype.bytesPerElement=20,Ct("StructArrayLayout6i1ul2ui20",jl);class Ga extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,b,w){const T=this.length;return this.resize(T+1),this.emplace(T,i,c,f,g,b,w)}emplace(i,c,f,g,b,w,T){const I=6*i;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=b,this.int16[I+4]=w,this.int16[I+5]=T,i}}Ga.prototype.bytesPerElement=12,Ct("StructArrayLayout2i2i2i12",Ga);class Ul extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,c,f,g,b){const w=this.length;return this.resize(w+1),this.emplace(w,i,c,f,g,b)}emplace(i,c,f,g,b,w){const T=4*i,I=8*i;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[I+6]=b,this.int16[I+7]=w,i}}Ul.prototype.bytesPerElement=16,Ct("StructArrayLayout2f1f2i16",Ul);class Wa extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,c,f,g)}emplace(i,c,f,g,b){const w=12*i,T=3*i;return this.uint8[w+0]=c,this.uint8[w+1]=f,this.float32[T+1]=g,this.float32[T+2]=b,i}}Wa.prototype.bytesPerElement=12,Ct("StructArrayLayout2ub2f12",Wa);class Vl extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const b=3*i;return this.uint16[b+0]=c,this.uint16[b+1]=f,this.uint16[b+2]=g,i}}Vl.prototype.bytesPerElement=6,Ct("StructArrayLayout3ui6",Vl);class Ys extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f,g,b,w,T,I,L,F,j,H,K,Q,ae,ge,xe){const Re=this.length;return this.resize(Re+1),this.emplace(Re,i,c,f,g,b,w,T,I,L,F,j,H,K,Q,ae,ge,xe)}emplace(i,c,f,g,b,w,T,I,L,F,j,H,K,Q,ae,ge,xe,Re){const ke=24*i,Ae=12*i,Ye=48*i;return this.int16[ke+0]=c,this.int16[ke+1]=f,this.uint16[ke+2]=g,this.uint16[ke+3]=b,this.uint32[Ae+2]=w,this.uint32[Ae+3]=T,this.uint32[Ae+4]=I,this.uint16[ke+10]=L,this.uint16[ke+11]=F,this.uint16[ke+12]=j,this.float32[Ae+7]=H,this.float32[Ae+8]=K,this.uint8[Ye+36]=Q,this.uint8[Ye+37]=ae,this.uint8[Ye+38]=ge,this.uint32[Ae+10]=xe,this.int16[ke+22]=Re,i}}Ys.prototype.bytesPerElement=48,Ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ys);class vs extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f,g,b,w,T,I,L,F,j,H,K,Q,ae,ge,xe,Re,ke,Ae,Ye,Qe,Tt,Dt,kt,vt,dt,Lt){const _t=this.length;return this.resize(_t+1),this.emplace(_t,i,c,f,g,b,w,T,I,L,F,j,H,K,Q,ae,ge,xe,Re,ke,Ae,Ye,Qe,Tt,Dt,kt,vt,dt,Lt)}emplace(i,c,f,g,b,w,T,I,L,F,j,H,K,Q,ae,ge,xe,Re,ke,Ae,Ye,Qe,Tt,Dt,kt,vt,dt,Lt,_t){const ot=32*i,qt=16*i;return this.int16[ot+0]=c,this.int16[ot+1]=f,this.int16[ot+2]=g,this.int16[ot+3]=b,this.int16[ot+4]=w,this.int16[ot+5]=T,this.int16[ot+6]=I,this.int16[ot+7]=L,this.uint16[ot+8]=F,this.uint16[ot+9]=j,this.uint16[ot+10]=H,this.uint16[ot+11]=K,this.uint16[ot+12]=Q,this.uint16[ot+13]=ae,this.uint16[ot+14]=ge,this.uint16[ot+15]=xe,this.uint16[ot+16]=Re,this.uint16[ot+17]=ke,this.uint16[ot+18]=Ae,this.uint16[ot+19]=Ye,this.uint16[ot+20]=Qe,this.uint16[ot+21]=Tt,this.uint16[ot+22]=Dt,this.uint32[qt+12]=kt,this.float32[qt+13]=vt,this.float32[qt+14]=dt,this.uint16[ot+30]=Lt,this.uint16[ot+31]=_t,i}}vs.prototype.bytesPerElement=64,Ct("StructArrayLayout8i15ui1ul2f2ui64",vs);class ql extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.float32[1*i+0]=c,i}}ql.prototype.bytesPerElement=4,Ct("StructArrayLayout1f4",ql);class Gl extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const b=3*i;return this.uint16[6*i+0]=c,this.float32[b+1]=f,this.float32[b+2]=g,i}}Gl.prototype.bytesPerElement=12,Ct("StructArrayLayout1ui2f12",Gl);class bs extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,c,f)}emplace(i,c,f,g){const b=4*i;return this.uint32[2*i+0]=c,this.uint16[b+2]=f,this.uint16[b+3]=g,i}}bs.prototype.bytesPerElement=8,Ct("StructArrayLayout1ul2ui8",bs);class du extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,c){const f=this.length;return this.resize(f+1),this.emplace(f,i,c)}emplace(i,c,f){const g=2*i;return this.uint16[g+0]=c,this.uint16[g+1]=f,i}}du.prototype.bytesPerElement=4,Ct("StructArrayLayout2ui4",du);class pu extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const c=this.length;return this.resize(c+1),this.emplace(c,i)}emplace(i,c){return this.uint16[1*i+0]=c,i}}pu.prototype.bytesPerElement=2,Ct("StructArrayLayout1ui2",pu);class Wl extends un{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,c,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,i,c,f,g)}emplace(i,c,f,g,b){const w=4*i;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=g,this.float32[w+3]=b,i}}Wl.prototype.bytesPerElement=16,Ct("StructArrayLayout4f16",Wl);class ff extends Ua{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}ff.prototype.size=20;class y extends jl{get(i){return new ff(this,i)}}Ct("CollisionBoxArray",y);class o extends Ua{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}o.prototype.size=48;class h extends Ys{get(i){return new o(this,i)}}Ct("PlacedSymbolArray",h);class p extends Ua{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class m extends vs{get(i){return new p(this,i)}}Ct("SymbolInstanceArray",m);class v extends ql{getoffsetX(i){return this.float32[1*i+0]}}Ct("GlyphOffsetArray",v);class E extends Fo{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Ct("SymbolLineVertexArray",E);class M extends Ua{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}M.prototype.size=12;class A extends Gl{get(i){return new M(this,i)}}Ct("TextAnchorOffsetArray",A);class R extends Ua{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}R.prototype.size=8;class V extends bs{get(i){return new R(this,i)}}Ct("FeatureIndexArray",V);class q extends Va{}class Y extends Va{}class fe extends Va{}class he extends cu{}class ye extends uu{}class se extends qa{}class Te extends Nl{}class qe extends hu{}class we extends fu{}class Le extends Oo{}class We extends Ga{}class $e extends Wa{}class Xe extends Vl{}class rt extends du{}const et=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ft}=et;class mt{constructor(i=[]){this.segments=i}prepareSegment(i,c,f,g){let b=this.segments[this.segments.length-1];return i>mt.MAX_VERTEX_ARRAY_LENGTH&&He(`Max vertices per segment is ${mt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!b||b.vertexLength+i>mt.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==g)&&(b={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(b.sortKey=g),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const i of this.segments)for(const c in i.vaos)i.vaos[c].destroy()}static simpleSegment(i,c,f,g){return new mt([{vertexOffset:i,primitiveOffset:c,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function or(s,i){return 256*(s=te(Math.floor(s),0,255))+te(Math.floor(i),0,255)}mt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct("SegmentVector",mt);const gt=kn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xt={exports:{}},sr={exports:{}};sr.exports=function(s,i){var c,f,g,b,w,T,I,L;for(f=s.length-(c=3&s.length),g=i,w=3432918353,T=461845907,L=0;L<f;)I=255&s.charCodeAt(L)|(255&s.charCodeAt(++L))<<8|(255&s.charCodeAt(++L))<<16|(255&s.charCodeAt(++L))<<24,++L,g=27492+(65535&(b=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&s.charCodeAt(L+2))<<16;case 2:I^=(255&s.charCodeAt(L+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(L)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Sr=sr.exports,er={exports:{}};er.exports=function(s,i){for(var c,f=s.length,g=i^f,b=0;f>=4;)c=1540483477*(65535&(c=255&s.charCodeAt(b)|(255&s.charCodeAt(++b))<<8|(255&s.charCodeAt(++b))<<16|(255&s.charCodeAt(++b))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++b;switch(f){case 3:g^=(255&s.charCodeAt(b+2))<<16;case 2:g^=(255&s.charCodeAt(b+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(b)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var cr=Sr,fr=er.exports;Xt.exports=cr,Xt.exports.murmur3=cr,Xt.exports.murmur2=fr;var hn=_(Xt.exports);class Dr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,c,f,g){this.ids.push(Oi(i)),this.positions.push(c,f,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Oi(i);let f=0,g=this.ids.length-1;for(;f<g;){const w=f+g>>1;this.ids[w]>=c?g=w:f=w+1}const b=[];for(;this.ids[f]===c;)b.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return b}static serialize(i,c){const f=new Float64Array(i.ids),g=new Uint32Array(i.positions);return Fn(f,g,0,f.length-1),c&&c.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(i){const c=new Dr;return c.ids=i.ids,c.positions=i.positions,c.indexed=!0,c}}function Oi(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:hn(String(s))}function Fn(s,i,c,f){for(;c<f;){const g=s[c+f>>1];let b=c-1,w=f+1;for(;;){do b++;while(s[b]<g);do w--;while(s[w]>g);if(b>=w)break;nn(s,b,w),nn(i,3*b,3*w),nn(i,3*b+1,3*w+1),nn(i,3*b+2,3*w+2)}w-c<f-w?(Fn(s,i,c,w),c=w+1):(Fn(s,i,w+1,f),f=w)}}function nn(s,i,c){const f=s[i];s[i]=s[c],s[c]=f}Ct("FeaturePositionMap",Dr);class On{constructor(i,c){this.gl=i.gl,this.location=c}}class Ni extends On{constructor(i,c){super(i,c),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class bo extends On{constructor(i,c){super(i,c),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class ts extends On{constructor(i,c){super(i,c),this.current=Pr.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Za=new Float32Array(16);function rs(s){return[or(255*s.r,255*s.g),or(255*s.b,255*s.a)]}class wo{constructor(i,c,f){this.value=i,this.uniformNames=c.map(g=>`u_${g}`),this.type=f}setUniform(i,c,f){i.set(f.constantOr(this.value))}getBinding(i,c,f){return this.type==="color"?new ts(i,c):new Ni(i,c)}}class An{constructor(i,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=i.tlbr}setUniform(i,c,f,g){const b=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&i.set(b)}getBinding(i,c,f){return f.substr(0,9)==="u_pattern"?new bo(i,c):new Ni(i,c)}}class on{constructor(i,c,f,g){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(b=>({name:`a_${b}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,c,f,g,b){const w=this.paintVertexArray.length,T=this.expression.evaluate(new Qr(0),c,{},g,[],b);this.paintVertexArray.resize(i),this._setPaintValue(w,i,T)}updatePaintArray(i,c,f,g){const b=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(i,c,b)}_setPaintValue(i,c,f){if(this.type==="color"){const g=rs(f);for(let b=i;b<c;b++)this.paintVertexArray.emplace(b,g[0],g[1])}else{for(let g=i;g<c;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class en{constructor(i,c,f,g,b,w){this.expression=i,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(i,c,f,g,b){const w=this.expression.evaluate(new Qr(this.zoom),c,{},g,[],b),T=this.expression.evaluate(new Qr(this.zoom+1),c,{},g,[],b),I=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(I,i,w,T)}updatePaintArray(i,c,f,g){const b=this.expression.evaluate({zoom:this.zoom},f,g),w=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(i,c,b,w)}_setPaintValue(i,c,f,g){if(this.type==="color"){const b=rs(f),w=rs(g);for(let T=i;T<c;T++)this.paintVertexArray.emplace(T,b[0],b[1],w[0],w[1])}else{for(let b=i;b<c;b++)this.paintVertexArray.emplace(b,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=te(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,c,f){return new Ni(i,c)}}class Ki{constructor(i,c,f,g,b,w){this.expression=i,this.type=c,this.useIntegerZoom=f,this.zoom=g,this.layerId=w,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(i,c,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(i,c,f,g,b){this._setPaintValues(i,c,f.patterns&&f.patterns[this.layerId],b)}_setPaintValues(i,c,f,g){if(!g||!f)return;const{min:b,mid:w,max:T}=f,I=g[b],L=g[w],F=g[T];if(I&&L&&F)for(let j=i;j<c;j++)this.zoomInPaintVertexArray.emplace(j,L.tl[0],L.tl[1],L.br[0],L.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],L.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(j,L.tl[0],L.tl[1],L.br[0],L.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],L.pixelRatio,F.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,gt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,gt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ln{constructor(i,c,f){this.binders={},this._buffers=[];const g=[];for(const b in i.paint._values){if(!f(b))continue;const w=i.paint.get(b);if(!(w instanceof oo&&Ws(w.property.specification)))continue;const T=Ji(b,i.type),I=w.value,L=w.property.specification.type,F=w.property.useIntegerZoom,j=w.property.specification["property-type"],H=j==="cross-faded"||j==="cross-faded-data-driven";if(I.kind==="constant")this.binders[b]=H?new An(I.value,T):new wo(I.value,T,L),g.push(`/u_${b}`);else if(I.kind==="source"||H){const K=Pn(b,L,"source");this.binders[b]=H?new Ki(I,L,F,c,K,i.id):new on(I,T,L,K),g.push(`/a_${b}`)}else{const K=Pn(b,L,"composite");this.binders[b]=new en(I,T,L,F,c,K),g.push(`/z_${b}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const c=this.binders[i];return c instanceof on||c instanceof en?c.maxValue:0}populatePaintArrays(i,c,f,g,b){for(const w in this.binders){const T=this.binders[w];(T instanceof on||T instanceof en||T instanceof Ki)&&T.populatePaintArray(i,c,f,g,b)}}setConstantPatternPositions(i,c){for(const f in this.binders){const g=this.binders[f];g instanceof An&&g.setConstantPatternPositions(i,c)}}updatePaintArrays(i,c,f,g,b){let w=!1;for(const T in i){const I=c.getPositions(T);for(const L of I){const F=f.feature(L.index);for(const j in this.binders){const H=this.binders[j];if((H instanceof on||H instanceof en||H instanceof Ki)&&H.expression.isStateDependent===!0){const K=g.paint.get(j);H.expression=K.value,H.updatePaintArray(L.start,L.end,F,i[T],b),w=!0}}}}return w}defines(){const i=[];for(const c in this.binders){const f=this.binders[c];(f instanceof wo||f instanceof An)&&i.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof on||f instanceof en)for(let g=0;g<f.paintVertexAttributes.length;g++)i.push(f.paintVertexAttributes[g].name);else if(f instanceof Ki)for(let g=0;g<gt.members.length;g++)i.push(gt.members[g].name)}return i}getBinderUniforms(){const i=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof wo||f instanceof An||f instanceof en)for(const g of f.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,c){const f=[];for(const g in this.binders){const b=this.binders[g];if(b instanceof wo||b instanceof An||b instanceof en){for(const w of b.uniformNames)if(c[w]){const T=b.getBinding(i,c[w],w);f.push({name:w,property:g,binding:T})}}}return f}setUniforms(i,c,f,g){for(const{name:b,property:w,binding:T}of c)this.binders[w].setUniform(T,g,f.get(w),b)}updatePaintBuffers(i){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(i&&f instanceof Ki){const g=i.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof on||f instanceof en)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const c in this.binders){const f=this.binders[c];(f instanceof on||f instanceof en||f instanceof Ki)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const c=this.binders[i];(c instanceof on||c instanceof en||c instanceof Ki)&&c.destroy()}}}class sn{constructor(i,c,f=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new Ln(g,c,f);this.needsUpload=!1,this._featureMap=new Dr,this._bufferOffset=0}populatePaintArrays(i,c,f,g,b,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(i,c,g,b,w);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,c,f,g){for(const b of f)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(i,this._featureMap,c,b,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Ji(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Pn(s,i,c){const f={color:{source:qa,composite:Wl},number:{source:ql,composite:qa}},g=function(b){return{"line-pattern":{source:Te,composite:Te},"fill-pattern":{source:Te,composite:Te},"fill-extrusion-pattern":{source:Te,composite:Te}}[b]}(s);return g&&g[c]||f[i][c]}Ct("ConstantBinder",wo),Ct("CrossFadedConstantBinder",An),Ct("SourceExpressionBinder",on),Ct("CrossFadedCompositeBinder",Ki),Ct("CompositeExpressionBinder",en),Ct("ProgramConfiguration",Ln,{omit:["_buffers"]}),Ct("ProgramConfigurationSet",sn);const yn=8192,mu=Math.pow(2,14)-1,df=-mu-1;function ws(s){const i=yn/s.extent,c=s.loadGeometry();for(let f=0;f<c.length;f++){const g=c[f];for(let b=0;b<g.length;b++){const w=g[b],T=Math.round(w.x*i),I=Math.round(w.y*i);w.x=te(T,df,mu),w.y=te(I,df,mu),(T<w.x||T>w.x+1||I<w.y||I>w.y+1)&&He("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function xs(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?ws(s):[]}}function Zl(s,i,c,f,g){s.emplaceBack(2*i+(f+1)/2,2*c+(g+1)/2)}class ns{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Y,this.indexArray=new Xe,this.segments=new mt,this.programConfigurations=new sn(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,f){const g=this.layers[0],b=[];let w=null,T=!1;g.type==="circle"&&(w=g.layout.get("circle-sort-key"),T=!w.isConstant());for(const{feature:I,id:L,index:F,sourceLayerIndex:j}of i){const H=this.layers[0]._featureFilter.needGeometry,K=xs(I,H);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),K,f))continue;const Q=T?w.evaluate(K,{},f):void 0,ae={id:L,properties:I.properties,type:I.type,sourceLayerIndex:j,index:F,geometry:H?K.geometry:ws(I),patterns:{},sortKey:Q};b.push(ae)}T&&b.sort((I,L)=>I.sortKey-L.sortKey);for(const I of b){const{geometry:L,index:F,sourceLayerIndex:j}=I,H=i[F].feature;this.addFeature(I,L,F,f),c.featureIndex.insert(H,L,F,j,this.index)}}update(i,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ft),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,c,f,g){for(const b of c)for(const w of b){const T=w.x,I=w.y;if(T<0||T>=yn||I<0||I>=yn)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),F=L.vertexLength;Zl(this.layoutVertexArray,T,I,-1,-1),Zl(this.layoutVertexArray,T,I,1,-1),Zl(this.layoutVertexArray,T,I,1,1),Zl(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+3,F+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},g)}}function gu(s,i){for(let c=0;c<s.length;c++)if($l(i,s[c]))return!0;for(let c=0;c<i.length;c++)if($l(s,i[c]))return!0;return!!Hl(s,i)}function pf(s,i,c){return!!$l(s,i)||!!hp(i,s,c)}function _u(s,i){if(s.length===1)return c_(i,s[0]);for(let c=0;c<i.length;c++){const f=i[c];for(let g=0;g<f.length;g++)if($l(s,f[g]))return!0}for(let c=0;c<s.length;c++)if(c_(i,s[c]))return!0;for(let c=0;c<i.length;c++)if(Hl(s,i[c]))return!0;return!1}function yu(s,i,c){if(s.length>1){if(Hl(s,i))return!0;for(let f=0;f<i.length;f++)if(hp(i[f],s,c))return!0}for(let f=0;f<s.length;f++)if(hp(s[f],i,c))return!0;return!1}function Hl(s,i){if(s.length===0||i.length===0)return!1;for(let c=0;c<s.length-1;c++){const f=s[c],g=s[c+1];for(let b=0;b<i.length-1;b++)if(vu(f,g,i[b],i[b+1]))return!0}return!1}function vu(s,i,c,f){return Me(s,c,f)!==Me(i,c,f)&&Me(s,i,c)!==Me(s,i,f)}function hp(s,i,c){const f=c*c;if(i.length===1)return s.distSqr(i[0])<f;for(let g=1;g<i.length;g++)if(l_(s,i[g-1],i[g])<f)return!0;return!1}function l_(s,i,c){const f=i.distSqr(c);if(f===0)return s.distSqr(i);const g=((s.x-i.x)*(c.x-i.x)+(s.y-i.y)*(c.y-i.y))/f;return s.distSqr(g<0?i:g>1?c:c.sub(i)._mult(g)._add(i))}function c_(s,i){let c,f,g,b=!1;for(let w=0;w<s.length;w++){c=s[w];for(let T=0,I=c.length-1;T<c.length;I=T++)f=c[T],g=c[I],f.y>i.y!=g.y>i.y&&i.x<(g.x-f.x)*(i.y-f.y)/(g.y-f.y)+f.x&&(b=!b)}return b}function $l(s,i){let c=!1;for(let f=0,g=s.length-1;f<s.length;g=f++){const b=s[f],w=s[g];b.y>i.y!=w.y>i.y&&i.x<(w.x-b.x)*(i.y-b.y)/(w.y-b.y)+b.x&&(c=!c)}return c}function Wx(s,i,c){const f=c[0],g=c[2];if(s.x<f.x&&i.x<f.x||s.x>g.x&&i.x>g.x||s.y<f.y&&i.y<f.y||s.y>g.y&&i.y>g.y)return!1;const b=Me(s,i,c[0]);return b!==Me(s,i,c[1])||b!==Me(s,i,c[2])||b!==Me(s,i,c[3])}function bu(s,i,c){const f=i.paint.get(s).value;return f.kind==="constant"?f.value:c.programConfigurations.get(i.id).getMaxValue(s)}function mf(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function gf(s,i,c,f,g){if(!i[0]&&!i[1])return s;const b=S.convert(i)._mult(g);c==="viewport"&&b._rotate(-f);const w=[];for(let T=0;T<s.length;T++)w.push(s[T].sub(b));return w}let u_,h_;Ct("CircleBucket",ns,{omit:["layers"]});var Zx={get paint(){return h_=h_||new Si({"circle-radius":new Gt(ne.paint_circle["circle-radius"]),"circle-color":new Gt(ne.paint_circle["circle-color"]),"circle-blur":new Gt(ne.paint_circle["circle-blur"]),"circle-opacity":new Gt(ne.paint_circle["circle-opacity"]),"circle-translate":new Ft(ne.paint_circle["circle-translate"]),"circle-translate-anchor":new Ft(ne.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ft(ne.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ft(ne.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(ne.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(ne.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(ne.paint_circle["circle-stroke-opacity"])})},get layout(){return u_=u_||new Si({"circle-sort-key":new Gt(ne.layout_circle["circle-sort-key"])})}},ki=1e-6,Xl=typeof Float32Array<"u"?Float32Array:Array;function fp(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function f_(s,i,c){var f=i[0],g=i[1],b=i[2],w=i[3],T=i[4],I=i[5],L=i[6],F=i[7],j=i[8],H=i[9],K=i[10],Q=i[11],ae=i[12],ge=i[13],xe=i[14],Re=i[15],ke=c[0],Ae=c[1],Ye=c[2],Qe=c[3];return s[0]=ke*f+Ae*T+Ye*j+Qe*ae,s[1]=ke*g+Ae*I+Ye*H+Qe*ge,s[2]=ke*b+Ae*L+Ye*K+Qe*xe,s[3]=ke*w+Ae*F+Ye*Q+Qe*Re,s[4]=(ke=c[4])*f+(Ae=c[5])*T+(Ye=c[6])*j+(Qe=c[7])*ae,s[5]=ke*g+Ae*I+Ye*H+Qe*ge,s[6]=ke*b+Ae*L+Ye*K+Qe*xe,s[7]=ke*w+Ae*F+Ye*Q+Qe*Re,s[8]=(ke=c[8])*f+(Ae=c[9])*T+(Ye=c[10])*j+(Qe=c[11])*ae,s[9]=ke*g+Ae*I+Ye*H+Qe*ge,s[10]=ke*b+Ae*L+Ye*K+Qe*xe,s[11]=ke*w+Ae*F+Ye*Q+Qe*Re,s[12]=(ke=c[12])*f+(Ae=c[13])*T+(Ye=c[14])*j+(Qe=c[15])*ae,s[13]=ke*g+Ae*I+Ye*H+Qe*ge,s[14]=ke*b+Ae*L+Ye*K+Qe*xe,s[15]=ke*w+Ae*F+Ye*Q+Qe*Re,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var wu,Hx=f_;function _f(s,i,c){var f=i[0],g=i[1],b=i[2],w=i[3];return s[0]=c[0]*f+c[4]*g+c[8]*b+c[12]*w,s[1]=c[1]*f+c[5]*g+c[9]*b+c[13]*w,s[2]=c[2]*f+c[6]*g+c[10]*b+c[14]*w,s[3]=c[3]*f+c[7]*g+c[11]*b+c[15]*w,s}wu=new Xl(4),Xl!=Float32Array&&(wu[0]=0,wu[1]=0,wu[2]=0,wu[3]=0);class $x extends so{constructor(i){super(i,Zx)}createBucket(i){return new ns(i)}queryRadius(i){const c=i;return bu("circle-radius",this,c)+bu("circle-stroke-width",this,c)+mf(this.paint.get("circle-translate"))}queryIntersectsFeature(i,c,f,g,b,w,T,I){const L=gf(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,T),F=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),j=this.paint.get("circle-pitch-alignment")==="map",H=j?L:function(Q,ae){return Q.map(ge=>d_(ge,ae))}(L,I),K=j?F*T:F;for(const Q of g)for(const ae of Q){const ge=j?ae:d_(ae,I);let xe=K;const Re=_f([],[ae.x,ae.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Re[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=w.cameraToCenterDistance/Re[3]),pf(H,ge,xe))return!0}return!1}}function d_(s,i){const c=_f([],[s.x,s.y,0,1],i);return new S(c[0]/c[3],c[1]/c[3])}class p_ extends ns{}let m_;Ct("HeatmapBucket",p_,{omit:["layers"]});var Xx={get paint(){return m_=m_||new Si({"heatmap-radius":new Gt(ne.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(ne.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ft(ne.paint_heatmap["heatmap-intensity"]),"heatmap-color":new su(ne.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ft(ne.paint_heatmap["heatmap-opacity"])})}};function dp(s,{width:i,height:c},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*c*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*c*f}`)}else g=new Uint8Array(i*c*f);return s.width=i,s.height=c,s.data=g,s}function g_(s,{width:i,height:c},f){if(i===s.width&&c===s.height)return;const g=dp({},{width:i,height:c},f);pp(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,c)},f),s.width=i,s.height=c,s.data=g.data}function pp(s,i,c,f,g,b){if(g.width===0||g.height===0)return i;if(g.width>s.width||g.height>s.height||c.x>s.width-g.width||c.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||f.x>i.width-g.width||f.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const w=s.data,T=i.data;if(w===T)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<g.height;I++){const L=((c.y+I)*s.width+c.x)*b,F=((f.y+I)*i.width+f.x)*b;for(let j=0;j<g.width*b;j++)T[F+j]=w[L+j]}return i}class xu{constructor(i,c){dp(this,i,1,c)}resize(i){g_(this,i,1)}clone(){return new xu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,f,g,b){pp(i,c,f,g,b,1)}}class ao{constructor(i,c){dp(this,i,4,c)}resize(i){g_(this,i,4)}replace(i,c){c?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,c,f,g,b){pp(i,c,f,g,b,4)}}function __(s){const i={},c=s.resolution||256,f=s.clips?s.clips.length:1,g=s.image||new ao({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const b=(w,T,I)=>{i[s.evaluationKey]=I;const L=s.expression.evaluate(i);g.data[w+T+0]=Math.floor(255*L.r/L.a),g.data[w+T+1]=Math.floor(255*L.g/L.a),g.data[w+T+2]=Math.floor(255*L.b/L.a),g.data[w+T+3]=Math.floor(255*L.a)};if(s.clips)for(let w=0,T=0;w<f;++w,T+=4*c)for(let I=0,L=0;I<c;I++,L+=4){const F=I/(c-1),{start:j,end:H}=s.clips[w];b(T,L,j*(1-F)+H*F)}else for(let w=0,T=0;w<c;w++,T+=4)b(0,T,w/(c-1));return g}Ct("AlphaImage",xu),Ct("RGBAImage",ao);class Kx extends so{createBucket(i){return new p_(i)}constructor(i){super(i,Xx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=__({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let y_;var Jx={get paint(){return y_=y_||new Si({"hillshade-illumination-direction":new Ft(ne.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ft(ne.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ft(ne.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ft(ne.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ft(ne.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ft(ne.paint_hillshade["hillshade-accent-color"])})}};class Yx extends so{constructor(i){super(i,Jx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Qx=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:e2}=Qx;var mp={exports:{}};function yf(s,i,c){c=c||2;var f,g,b,w,T,I,L,F=i&&i.length,j=F?i[0]*c:s.length,H=v_(s,0,j,c,!0),K=[];if(!H||H.next===H.prev)return K;if(F&&(H=function(ae,ge,xe,Re){var ke,Ae,Ye,Qe=[];for(ke=0,Ae=ge.length;ke<Ae;ke++)(Ye=v_(ae,ge[ke]*Re,ke<Ae-1?ge[ke+1]*Re:ae.length,Re,!1))===Ye.next&&(Ye.steiner=!0),Qe.push(l2(Ye));for(Qe.sort(o2),ke=0;ke<Qe.length;ke++)xe=s2(Qe[ke],xe);return xe}(s,i,H,c)),s.length>80*c){f=b=s[0],g=w=s[1];for(var Q=c;Q<j;Q+=c)(T=s[Q])<f&&(f=T),(I=s[Q+1])<g&&(g=I),T>b&&(b=T),I>w&&(w=I);L=(L=Math.max(b-f,w-g))!==0?32767/L:0}return Su(H,K,c,f,g,L,0),K}function v_(s,i,c,f,g){var b,w;if(g===yp(s,i,c,f)>0)for(b=i;b<c;b+=f)w=x_(b,s[b],s[b+1],w);else for(b=c-f;b>=i;b-=f)w=x_(b,s[b],s[b+1],w);return w&&vf(w,w.next)&&(Tu(w),w=w.next),w}function Ha(s,i){if(!s)return s;i||(i=s);var c,f=s;do if(c=!1,f.steiner||!vf(f,f.next)&&Tn(f.prev,f,f.next)!==0)f=f.next;else{if(Tu(f),(f=i=f.prev)===f.next)break;c=!0}while(c||f!==i);return i}function Su(s,i,c,f,g,b,w){if(s){!w&&b&&function(F,j,H,K){var Q=F;do Q.z===0&&(Q.z=gp(Q.x,Q.y,j,H,K)),Q.prevZ=Q.prev,Q.nextZ=Q.next,Q=Q.next;while(Q!==F);Q.prevZ.nextZ=null,Q.prevZ=null,function(ae){var ge,xe,Re,ke,Ae,Ye,Qe,Tt,Dt=1;do{for(xe=ae,ae=null,Ae=null,Ye=0;xe;){for(Ye++,Re=xe,Qe=0,ge=0;ge<Dt&&(Qe++,Re=Re.nextZ);ge++);for(Tt=Dt;Qe>0||Tt>0&&Re;)Qe!==0&&(Tt===0||!Re||xe.z<=Re.z)?(ke=xe,xe=xe.nextZ,Qe--):(ke=Re,Re=Re.nextZ,Tt--),Ae?Ae.nextZ=ke:ae=ke,ke.prevZ=Ae,Ae=ke;xe=Re}Ae.nextZ=null,Dt*=2}while(Ye>1)}(Q)}(s,f,g,b);for(var T,I,L=s;s.prev!==s.next;)if(T=s.prev,I=s.next,b?r2(s,f,g,b):t2(s))i.push(T.i/c|0),i.push(s.i/c|0),i.push(I.i/c|0),Tu(s),s=I.next,L=I.next;else if((s=I)===L){w?w===1?Su(s=n2(Ha(s),i,c),i,c,f,g,b,2):w===2&&i2(s,i,c,f,g,b):Su(Ha(s),i,c,f,g,b,1);break}}}function t2(s){var i=s.prev,c=s,f=s.next;if(Tn(i,c,f)>=0)return!1;for(var g=i.x,b=c.x,w=f.x,T=i.y,I=c.y,L=f.y,F=g<b?g<w?g:w:b<w?b:w,j=T<I?T<L?T:L:I<L?I:L,H=g>b?g>w?g:w:b>w?b:w,K=T>I?T>L?T:L:I>L?I:L,Q=f.next;Q!==i;){if(Q.x>=F&&Q.x<=H&&Q.y>=j&&Q.y<=K&&Kl(g,T,b,I,w,L,Q.x,Q.y)&&Tn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.next}return!0}function r2(s,i,c,f){var g=s.prev,b=s,w=s.next;if(Tn(g,b,w)>=0)return!1;for(var T=g.x,I=b.x,L=w.x,F=g.y,j=b.y,H=w.y,K=T<I?T<L?T:L:I<L?I:L,Q=F<j?F<H?F:H:j<H?j:H,ae=T>I?T>L?T:L:I>L?I:L,ge=F>j?F>H?F:H:j>H?j:H,xe=gp(K,Q,i,c,f),Re=gp(ae,ge,i,c,f),ke=s.prevZ,Ae=s.nextZ;ke&&ke.z>=xe&&Ae&&Ae.z<=Re;){if(ke.x>=K&&ke.x<=ae&&ke.y>=Q&&ke.y<=ge&&ke!==g&&ke!==w&&Kl(T,F,I,j,L,H,ke.x,ke.y)&&Tn(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,Ae.x>=K&&Ae.x<=ae&&Ae.y>=Q&&Ae.y<=ge&&Ae!==g&&Ae!==w&&Kl(T,F,I,j,L,H,Ae.x,Ae.y)&&Tn(Ae.prev,Ae,Ae.next)>=0))return!1;Ae=Ae.nextZ}for(;ke&&ke.z>=xe;){if(ke.x>=K&&ke.x<=ae&&ke.y>=Q&&ke.y<=ge&&ke!==g&&ke!==w&&Kl(T,F,I,j,L,H,ke.x,ke.y)&&Tn(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;Ae&&Ae.z<=Re;){if(Ae.x>=K&&Ae.x<=ae&&Ae.y>=Q&&Ae.y<=ge&&Ae!==g&&Ae!==w&&Kl(T,F,I,j,L,H,Ae.x,Ae.y)&&Tn(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.nextZ}return!0}function n2(s,i,c){var f=s;do{var g=f.prev,b=f.next.next;!vf(g,b)&&b_(g,f,f.next,b)&&ku(g,b)&&ku(b,g)&&(i.push(g.i/c|0),i.push(f.i/c|0),i.push(b.i/c|0),Tu(f),Tu(f.next),f=s=b),f=f.next}while(f!==s);return Ha(f)}function i2(s,i,c,f,g,b){var w=s;do{for(var T=w.next.next;T!==w.prev;){if(w.i!==T.i&&c2(w,T)){var I=w_(w,T);return w=Ha(w,w.next),I=Ha(I,I.next),Su(w,i,c,f,g,b,0),void Su(I,i,c,f,g,b,0)}T=T.next}w=w.next}while(w!==s)}function o2(s,i){return s.x-i.x}function s2(s,i){var c=function(g,b){var w,T=b,I=g.x,L=g.y,F=-1/0;do{if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){var j=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(j<=I&&j>F&&(F=j,w=T.x<T.next.x?T:T.next,j===I))return w}T=T.next}while(T!==b);if(!w)return null;var H,K=w,Q=w.x,ae=w.y,ge=1/0;T=w;do I>=T.x&&T.x>=Q&&I!==T.x&&Kl(L<ae?I:F,L,Q,ae,L<ae?F:I,L,T.x,T.y)&&(H=Math.abs(L-T.y)/(I-T.x),ku(T,g)&&(H<ge||H===ge&&(T.x>w.x||T.x===w.x&&a2(w,T)))&&(w=T,ge=H)),T=T.next;while(T!==K);return w}(s,i);if(!c)return i;var f=w_(c,s);return Ha(f,f.next),Ha(c,c.next)}function a2(s,i){return Tn(s.prev,s,i.prev)<0&&Tn(i.next,s,s.next)<0}function gp(s,i,c,f,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-c)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function l2(s){var i=s,c=s;do(i.x<c.x||i.x===c.x&&i.y<c.y)&&(c=i),i=i.next;while(i!==s);return c}function Kl(s,i,c,f,g,b,w,T){return(g-w)*(i-T)>=(s-w)*(b-T)&&(s-w)*(f-T)>=(c-w)*(i-T)&&(c-w)*(b-T)>=(g-w)*(f-T)}function c2(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(c,f){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==f.i&&g.next.i!==f.i&&b_(g,g.next,c,f))return!0;g=g.next}while(g!==c);return!1}(s,i)&&(ku(s,i)&&ku(i,s)&&function(c,f){var g=c,b=!1,w=(c.x+f.x)/2,T=(c.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&w<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(b=!b),g=g.next;while(g!==c);return b}(s,i)&&(Tn(s.prev,s,i.prev)||Tn(s,i.prev,i))||vf(s,i)&&Tn(s.prev,s,s.next)>0&&Tn(i.prev,i,i.next)>0)}function Tn(s,i,c){return(i.y-s.y)*(c.x-i.x)-(i.x-s.x)*(c.y-i.y)}function vf(s,i){return s.x===i.x&&s.y===i.y}function b_(s,i,c,f){var g=wf(Tn(s,i,c)),b=wf(Tn(s,i,f)),w=wf(Tn(c,f,s)),T=wf(Tn(c,f,i));return g!==b&&w!==T||!(g!==0||!bf(s,c,i))||!(b!==0||!bf(s,f,i))||!(w!==0||!bf(c,s,f))||!(T!==0||!bf(c,i,f))}function bf(s,i,c){return i.x<=Math.max(s.x,c.x)&&i.x>=Math.min(s.x,c.x)&&i.y<=Math.max(s.y,c.y)&&i.y>=Math.min(s.y,c.y)}function wf(s){return s>0?1:s<0?-1:0}function ku(s,i){return Tn(s.prev,s,s.next)<0?Tn(s,i,s.next)>=0&&Tn(s,s.prev,i)>=0:Tn(s,i,s.prev)<0||Tn(s,s.next,i)<0}function w_(s,i){var c=new _p(s.i,s.x,s.y),f=new _p(i.i,i.x,i.y),g=s.next,b=i.prev;return s.next=i,i.prev=s,c.next=g,g.prev=c,f.next=c,c.prev=f,b.next=f,f.prev=b,f}function x_(s,i,c,f){var g=new _p(s,i,c);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function Tu(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function _p(s,i,c){this.i=s,this.x=i,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yp(s,i,c,f){for(var g=0,b=i,w=c-f;b<c;b+=f)g+=(s[w]-s[b])*(s[b+1]+s[w+1]),w=b;return g}mp.exports=yf,mp.exports.default=yf,yf.deviation=function(s,i,c,f){var g=i&&i.length,b=Math.abs(yp(s,0,g?i[0]*c:s.length,c));if(g)for(var w=0,T=i.length;w<T;w++)b-=Math.abs(yp(s,i[w]*c,w<T-1?i[w+1]*c:s.length,c));var I=0;for(w=0;w<f.length;w+=3){var L=f[w]*c,F=f[w+1]*c,j=f[w+2]*c;I+=Math.abs((s[L]-s[j])*(s[F+1]-s[L+1])-(s[L]-s[F])*(s[j+1]-s[L+1]))}return b===0&&I===0?0:Math.abs((I-b)/b)},yf.flatten=function(s){for(var i=s[0][0].length,c={vertices:[],holes:[],dimensions:i},f=0,g=0;g<s.length;g++){for(var b=0;b<s[g].length;b++)for(var w=0;w<i;w++)c.vertices.push(s[g][b][w]);g>0&&c.holes.push(f+=s[g-1].length)}return c};var S_=_(mp.exports);function u2(s,i,c,f,g){k_(s,i,c||0,f||s.length-1,g||h2)}function k_(s,i,c,f,g){for(;f>c;){if(f-c>600){var b=f-c+1,w=i-c+1,T=Math.log(b),I=.5*Math.exp(2*T/3),L=.5*Math.sqrt(T*I*(b-I)/b)*(w-b/2<0?-1:1);k_(s,i,Math.max(c,Math.floor(i-w*I/b+L)),Math.min(f,Math.floor(i+(b-w)*I/b+L)),g)}var F=s[i],j=c,H=f;for(Eu(s,c,i),g(s[f],F)>0&&Eu(s,c,f);j<H;){for(Eu(s,j,H),j++,H--;g(s[j],F)<0;)j++;for(;g(s[H],F)>0;)H--}g(s[c],F)===0?Eu(s,c,H):Eu(s,++H,f),H<=i&&(c=H+1),i<=H&&(f=H-1)}}function Eu(s,i,c){var f=s[i];s[i]=s[c],s[c]=f}function h2(s,i){return s<i?-1:s>i?1:0}function vp(s,i){const c=s.length;if(c<=1)return[s];const f=[];let g,b;for(let w=0;w<c;w++){const T=ut(s[w]);T!==0&&(s[w].area=Math.abs(T),b===void 0&&(b=T<0),b===T<0?(g&&f.push(g),g=[s[w]]):g.push(s[w]))}if(g&&f.push(g),i>1)for(let w=0;w<f.length;w++)f[w].length<=i||(u2(f[w],i,1,f[w].length-1,f2),f[w]=f[w].slice(0,i));return f}function f2(s,i){return i.area-s.area}function bp(s,i,c){const f=c.patternDependencies;let g=!1;for(const b of i){const w=b.paint.get(`${s}-pattern`);w.isConstant()||(g=!0);const T=w.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function wp(s,i,c,f,g){const b=g.patternDependencies;for(const w of i){const T=w.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let I=T.evaluate({zoom:f-1},c,{},g.availableImages),L=T.evaluate({zoom:f},c,{},g.availableImages),F=T.evaluate({zoom:f+1},c,{},g.availableImages);I=I&&I.name?I.name:I,L=L&&L.name?L.name:L,F=F&&F.name?F.name:F,b[I]=!0,b[L]=!0,b[F]=!0,c.patterns[w.id]={min:I,mid:L,max:F}}}return c}class xp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new fe,this.indexArray=new Xe,this.indexArray2=new rt,this.programConfigurations=new sn(i.layers,i.zoom),this.segments=new mt,this.segments2=new mt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,f){this.hasPattern=bp("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),b=!g.isConstant(),w=[];for(const{feature:T,id:I,index:L,sourceLayerIndex:F}of i){const j=this.layers[0]._featureFilter.needGeometry,H=xs(T,j);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),H,f))continue;const K=b?g.evaluate(H,{},f,c.availableImages):void 0,Q={id:I,properties:T.properties,type:T.type,sourceLayerIndex:F,index:L,geometry:j?H.geometry:ws(T),patterns:{},sortKey:K};w.push(Q)}b&&w.sort((T,I)=>T.sortKey-I.sortKey);for(const T of w){const{geometry:I,index:L,sourceLayerIndex:F}=T;if(this.hasPattern){const j=wp("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(T,I,L,f,{});c.featureIndex.insert(i[L].feature,I,L,F,this.index)}}update(i,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,f)}addFeatures(i,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,e2),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,c,f,g,b){for(const w of vp(c,500)){let T=0;for(const K of w)T+=K.length;const I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),L=I.vertexLength,F=[],j=[];for(const K of w){if(K.length===0)continue;K!==w[0]&&j.push(F.length/2);const Q=this.segments2.prepareSegment(K.length,this.layoutVertexArray,this.indexArray2),ae=Q.vertexLength;this.layoutVertexArray.emplaceBack(K[0].x,K[0].y),this.indexArray2.emplaceBack(ae+K.length-1,ae),F.push(K[0].x),F.push(K[0].y);for(let ge=1;ge<K.length;ge++)this.layoutVertexArray.emplaceBack(K[ge].x,K[ge].y),this.indexArray2.emplaceBack(ae+ge-1,ae+ge),F.push(K[ge].x),F.push(K[ge].y);Q.vertexLength+=K.length,Q.primitiveLength+=K.length}const H=S_(F,j);for(let K=0;K<H.length;K+=3)this.indexArray.emplaceBack(L+H[K],L+H[K+1],L+H[K+2]);I.vertexLength+=T,I.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,g)}}let T_,E_;Ct("FillBucket",xp,{omit:["layers","patternFeatures"]});var d2={get paint(){return E_=E_||new Si({"fill-antialias":new Ft(ne.paint_fill["fill-antialias"]),"fill-opacity":new Gt(ne.paint_fill["fill-opacity"]),"fill-color":new Gt(ne.paint_fill["fill-color"]),"fill-outline-color":new Gt(ne.paint_fill["fill-outline-color"]),"fill-translate":new Ft(ne.paint_fill["fill-translate"]),"fill-translate-anchor":new Ft(ne.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ol(ne.paint_fill["fill-pattern"])})},get layout(){return T_=T_||new Si({"fill-sort-key":new Gt(ne.layout_fill["fill-sort-key"])})}};class p2 extends so{constructor(i){super(i,d2)}recalculate(i,c){super.recalculate(i,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new xp(i)}queryRadius(){return mf(this.paint.get("fill-translate"))}queryIntersectsFeature(i,c,f,g,b,w,T){return _u(gf(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,T),g)}isTileClipped(){return!0}}const m2=kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),g2=kn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:_2}=m2;var Qs={},y2=x,M_=Jl;function Jl(s,i,c,f,g){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=g,s.readFields(v2,this,i)}function v2(s,i,c){s==1?i.id=c.readVarint():s==2?function(f,g){for(var b=f.readVarint()+f.pos;f.pos<b;){var w=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[w]=T}}(c,i):s==3?i.type=c.readVarint():s==4&&(i._geometry=c.pos)}function b2(s){for(var i,c,f=0,g=0,b=s.length,w=b-1;g<b;w=g++)f+=((c=s[w]).x-(i=s[g]).x)*(i.y+c.y);return f}Jl.types=["Unknown","Point","LineString","Polygon"],Jl.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,c=s.readVarint()+s.pos,f=1,g=0,b=0,w=0,T=[];s.pos<c;){if(g<=0){var I=s.readVarint();f=7&I,g=I>>3}if(g--,f===1||f===2)b+=s.readSVarint(),w+=s.readSVarint(),f===1&&(i&&T.push(i),i=[]),i.push(new y2(b,w));else{if(f!==7)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&T.push(i),T},Jl.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,c=1,f=0,g=0,b=0,w=1/0,T=-1/0,I=1/0,L=-1/0;s.pos<i;){if(f<=0){var F=s.readVarint();c=7&F,f=F>>3}if(f--,c===1||c===2)(g+=s.readSVarint())<w&&(w=g),g>T&&(T=g),(b+=s.readSVarint())<I&&(I=b),b>L&&(L=b);else if(c!==7)throw new Error("unknown command "+c)}return[w,I,T,L]},Jl.prototype.toGeoJSON=function(s,i,c){var f,g,b=this.extent*Math.pow(2,c),w=this.extent*s,T=this.extent*i,I=this.loadGeometry(),L=Jl.types[this.type];function F(K){for(var Q=0;Q<K.length;Q++){var ae=K[Q];K[Q]=[360*(ae.x+w)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(ae.y+T)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var j=[];for(f=0;f<I.length;f++)j[f]=I[f][0];F(I=j);break;case 2:for(f=0;f<I.length;f++)F(I[f]);break;case 3:for(I=function(K){var Q=K.length;if(Q<=1)return[K];for(var ae,ge,xe=[],Re=0;Re<Q;Re++){var ke=b2(K[Re]);ke!==0&&(ge===void 0&&(ge=ke<0),ge===ke<0?(ae&&xe.push(ae),ae=[K[Re]]):ae.push(K[Re]))}return ae&&xe.push(ae),xe}(I),f=0;f<I.length;f++)for(g=0;g<I[f].length;g++)F(I[f][g])}I.length===1?I=I[0]:L="Multi"+L;var H={type:"Feature",geometry:{type:L,coordinates:I},properties:this.properties};return"id"in this&&(H.id=this.id),H};var w2=M_,C_=I_;function I_(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(x2,this,i),this.length=this._features.length}function x2(s,i,c){s===15?i.version=c.readVarint():s===1?i.name=c.readString():s===5?i.extent=c.readVarint():s===2?i._features.push(c.pos):s===3?i._keys.push(c.readString()):s===4&&i._values.push(function(f){for(var g=null,b=f.readVarint()+f.pos;f.pos<b;){var w=f.readVarint()>>3;g=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return g}(c))}I_.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new w2(this._pbf,i,this.extent,this._keys,this._values)};var S2=C_;function k2(s,i,c){if(s===3){var f=new S2(c,c.readVarint()+c.pos);f.length&&(i[f.name]=f)}}Qs.VectorTile=function(s,i){this.layers=s.readFields(k2,{},i)},Qs.VectorTileFeature=M_,Qs.VectorTileLayer=C_;const T2=Qs.VectorTileFeature.types,Sp=Math.pow(2,13);function Mu(s,i,c,f,g,b,w,T){s.emplaceBack(i,c,2*Math.floor(f*Sp)+w,g*Sp*2,b*Sp*2,Math.round(T))}class kp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new he,this.centroidVertexArray=new q,this.indexArray=new Xe,this.programConfigurations=new sn(i.layers,i.zoom),this.segments=new mt,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,f){this.features=[],this.hasPattern=bp("fill-extrusion",this.layers,c);for(const{feature:g,id:b,index:w,sourceLayerIndex:T}of i){const I=this.layers[0]._featureFilter.needGeometry,L=xs(g,I);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),L,f))continue;const F={id:b,sourceLayerIndex:T,index:w,geometry:I?L.geometry:ws(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(wp("fill-extrusion",this.layers,F,this.zoom,c)):this.addFeature(F,F.geometry,w,f,{}),c.featureIndex.insert(g,F.geometry,w,T,this.index,!0)}}addFeatures(i,c,f){for(const g of this.features){const{geometry:b}=g;this.addFeature(g,b,g.index,c,f)}}update(i,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,_2),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,g2.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,c,f,g,b){const w={x:0,y:0,vertexCount:0};for(const T of vp(c,500)){let I=0;for(const Q of T)I+=Q.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Q of T){if(Q.length===0||M2(Q))continue;let ae=0;for(let ge=0;ge<Q.length;ge++){const xe=Q[ge];if(ge>=1){const Re=Q[ge-1];if(!E2(xe,Re)){L.vertexLength+4>mt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ke=xe.sub(Re)._perp()._unit(),Ae=Re.dist(xe);ae+Ae>32768&&(ae=0),Mu(this.layoutVertexArray,xe.x,xe.y,ke.x,ke.y,0,0,ae),Mu(this.layoutVertexArray,xe.x,xe.y,ke.x,ke.y,0,1,ae),w.x+=2*xe.x,w.y+=2*xe.y,w.vertexCount+=2,ae+=Ae,Mu(this.layoutVertexArray,Re.x,Re.y,ke.x,ke.y,0,0,ae),Mu(this.layoutVertexArray,Re.x,Re.y,ke.x,ke.y,0,1,ae),w.x+=2*Re.x,w.y+=2*Re.y,w.vertexCount+=2;const Ye=L.vertexLength;this.indexArray.emplaceBack(Ye,Ye+2,Ye+1),this.indexArray.emplaceBack(Ye+1,Ye+2,Ye+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+I>mt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),T2[i.type]!=="Polygon")continue;const F=[],j=[],H=L.vertexLength;for(const Q of T)if(Q.length!==0){Q!==T[0]&&j.push(F.length/2);for(let ae=0;ae<Q.length;ae++){const ge=Q[ae];Mu(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),w.x+=ge.x,w.y+=ge.y,w.vertexCount+=1,F.push(ge.x),F.push(ge.y)}}const K=S_(F,j);for(let Q=0;Q<K.length;Q+=3)this.indexArray.emplaceBack(H+K[Q],H+K[Q+2],H+K[Q+1]);L.primitiveLength+=K.length/3,L.vertexLength+=I}for(let T=0;T<w.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,g)}}function E2(s,i){return s.x===i.x&&(s.x<0||s.x>yn)||s.y===i.y&&(s.y<0||s.y>yn)}function M2(s){return s.every(i=>i.x<0)||s.every(i=>i.x>yn)||s.every(i=>i.y<0)||s.every(i=>i.y>yn)}let A_;Ct("FillExtrusionBucket",kp,{omit:["layers","features"]});var C2={get paint(){return A_=A_||new Si({"fill-extrusion-opacity":new Ft(ne["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(ne["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ft(ne["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ft(ne["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ol(ne["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Gt(ne["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(ne["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ft(ne["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class I2 extends so{constructor(i){super(i,C2)}createBucket(i){return new kp(i)}queryRadius(){return mf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,c,f,g,b,w,T,I){const L=gf(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,T),F=this.paint.get("fill-extrusion-height").evaluate(c,f),j=this.paint.get("fill-extrusion-base").evaluate(c,f),H=function(Q,ae,ge,xe){const Re=[];for(const ke of Q){const Ae=[ke.x,ke.y,0,1];_f(Ae,Ae,ae),Re.push(new S(Ae[0]/Ae[3],Ae[1]/Ae[3]))}return Re}(L,I),K=function(Q,ae,ge,xe){const Re=[],ke=[],Ae=xe[8]*ae,Ye=xe[9]*ae,Qe=xe[10]*ae,Tt=xe[11]*ae,Dt=xe[8]*ge,kt=xe[9]*ge,vt=xe[10]*ge,dt=xe[11]*ge;for(const Lt of Q){const _t=[],ot=[];for(const qt of Lt){const Bt=qt.x,pr=qt.y,Xr=xe[0]*Bt+xe[4]*pr+xe[12],tn=xe[1]*Bt+xe[5]*pr+xe[13],jn=xe[2]*Bt+xe[6]*pr+xe[14],Yi=xe[3]*Bt+xe[7]*pr+xe[15],Ti=jn+Qe,zn=Yi+Tt,Yn=Xr+Dt,ai=tn+kt,Ei=jn+vt,Mi=Yi+dt,Un=new S((Xr+Ae)/zn,(tn+Ye)/zn);Un.z=Ti/zn,_t.push(Un);const Vn=new S(Yn/Mi,ai/Mi);Vn.z=Ei/Mi,ot.push(Vn)}Re.push(_t),ke.push(ot)}return[Re,ke]}(g,j,F,I);return function(Q,ae,ge){let xe=1/0;_u(ge,ae)&&(xe=L_(ge,ae[0]));for(let Re=0;Re<ae.length;Re++){const ke=ae[Re],Ae=Q[Re];for(let Ye=0;Ye<ke.length-1;Ye++){const Qe=ke[Ye],Tt=[Qe,ke[Ye+1],Ae[Ye+1],Ae[Ye],Qe];gu(ge,Tt)&&(xe=Math.min(xe,L_(ge,Tt)))}}return xe!==1/0&&xe}(K[0],K[1],H)}}function Cu(s,i){return s.x*i.x+s.y*i.y}function L_(s,i){if(s.length===1){let c=0;const f=i[c++];let g;for(;!g||f.equals(g);)if(g=i[c++],!g)return 1/0;for(;c<i.length;c++){const b=i[c],w=s[0],T=g.sub(f),I=b.sub(f),L=w.sub(f),F=Cu(T,T),j=Cu(T,I),H=Cu(I,I),K=Cu(L,T),Q=Cu(L,I),ae=F*H-j*j,ge=(H*K-j*Q)/ae,xe=(F*Q-j*K)/ae,Re=f.z*(1-ge-xe)+g.z*ge+b.z*xe;if(isFinite(Re))return Re}return 1/0}{let c=1/0;for(const f of i)c=Math.min(c,f.z);return c}}const A2=kn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:L2}=A2,P2=kn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:z2}=P2,D2=Qs.VectorTileFeature.types,R2=Math.cos(Math.PI/180*37.5),P_=Math.pow(2,14)/.5;class Tp{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(c=>c.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new ye,this.layoutVertexArray2=new se,this.indexArray=new Xe,this.programConfigurations=new sn(i.layers,i.zoom),this.segments=new mt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(i,c,f){this.hasPattern=bp("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),b=!g.isConstant(),w=[];for(const{feature:T,id:I,index:L,sourceLayerIndex:F}of i){const j=this.layers[0]._featureFilter.needGeometry,H=xs(T,j);if(!this.layers[0]._featureFilter.filter(new Qr(this.zoom),H,f))continue;const K=b?g.evaluate(H,{},f):void 0,Q={id:I,properties:T.properties,type:T.type,sourceLayerIndex:F,index:L,geometry:j?H.geometry:ws(T),patterns:{},sortKey:K};w.push(Q)}b&&w.sort((T,I)=>T.sortKey-I.sortKey);for(const T of w){const{geometry:I,index:L,sourceLayerIndex:F}=T;if(this.hasPattern){const j=wp("line",this.layers,T,this.zoom,c);this.patternFeatures.push(j)}else this.addFeature(T,I,L,f,{});c.featureIndex.insert(i[L].feature,I,L,F,this.index)}}update(i,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,c,this.stateDependentLayers,f)}addFeatures(i,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,z2)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,L2),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,c,f,g,b){const w=this.layers[0].layout,T=w.get("line-join").evaluate(i,{}),I=w.get("line-cap"),L=w.get("line-miter-limit"),F=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const j of c)this.addLine(j,i,T,I,L,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,g)}addLine(i,c,f,g,b,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<i.length-1;xe++)this.totalDistance+=i[xe].dist(i[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=D2[c.type]==="Polygon";let I=i.length;for(;I>=2&&i[I-1].equals(i[I-2]);)I--;let L=0;for(;L<I-1&&i[L].equals(i[L+1]);)L++;if(I<(T?3:2))return;f==="bevel"&&(b=1.05);const F=this.overscaling<=16?15*yn/(512*this.overscaling):0,j=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let H,K,Q,ae,ge;this.e1=this.e2=-1,T&&(H=i[I-2],ge=i[L].sub(H)._unit()._perp());for(let xe=L;xe<I;xe++){if(Q=xe===I-1?T?i[L+1]:void 0:i[xe+1],Q&&i[xe].equals(Q))continue;ge&&(ae=ge),H&&(K=H),H=i[xe],ge=Q?Q.sub(H)._unit()._perp():ae,ae=ae||ge;let Re=ae.add(ge);Re.x===0&&Re.y===0||Re._unit();const ke=ae.x*ge.x+ae.y*ge.y,Ae=Re.x*ge.x+Re.y*ge.y,Ye=Ae!==0?1/Ae:1/0,Qe=2*Math.sqrt(2-2*Ae),Tt=Ae<R2&&K&&Q,Dt=ae.x*ge.y-ae.y*ge.x>0;if(Tt&&xe>L){const dt=H.dist(K);if(dt>2*F){const Lt=H.sub(H.sub(K)._mult(F/dt)._round());this.updateDistance(K,Lt),this.addCurrentVertex(Lt,ae,0,0,j),K=Lt}}const kt=K&&Q;let vt=kt?f:T?"butt":g;if(kt&&vt==="round"&&(Ye<w?vt="miter":Ye<=2&&(vt="fakeround")),vt==="miter"&&Ye>b&&(vt="bevel"),vt==="bevel"&&(Ye>2&&(vt="flipbevel"),Ye<b&&(vt="miter")),K&&this.updateDistance(K,H),vt==="miter")Re._mult(Ye),this.addCurrentVertex(H,Re,0,0,j);else if(vt==="flipbevel"){if(Ye>100)Re=ge.mult(-1);else{const dt=Ye*ae.add(ge).mag()/ae.sub(ge).mag();Re._perp()._mult(dt*(Dt?-1:1))}this.addCurrentVertex(H,Re,0,0,j),this.addCurrentVertex(H,Re.mult(-1),0,0,j)}else if(vt==="bevel"||vt==="fakeround"){const dt=-Math.sqrt(Ye*Ye-1),Lt=Dt?dt:0,_t=Dt?0:dt;if(K&&this.addCurrentVertex(H,ae,Lt,_t,j),vt==="fakeround"){const ot=Math.round(180*Qe/Math.PI/20);for(let qt=1;qt<ot;qt++){let Bt=qt/ot;if(Bt!==.5){const Xr=Bt-.5;Bt+=Bt*Xr*(Bt-1)*((1.0904+ke*(ke*(3.55645-1.43519*ke)-3.2452))*Xr*Xr+(.848013+ke*(.215638*ke-1.06021)))}const pr=ge.sub(ae)._mult(Bt)._add(ae)._unit()._mult(Dt?-1:1);this.addHalfVertex(H,pr.x,pr.y,!1,Dt,0,j)}}Q&&this.addCurrentVertex(H,ge,-Lt,-_t,j)}else if(vt==="butt")this.addCurrentVertex(H,Re,0,0,j);else if(vt==="square"){const dt=K?1:-1;this.addCurrentVertex(H,Re,dt,dt,j)}else vt==="round"&&(K&&(this.addCurrentVertex(H,ae,0,0,j),this.addCurrentVertex(H,ae,1,1,j,!0)),Q&&(this.addCurrentVertex(H,ge,-1,-1,j,!0),this.addCurrentVertex(H,ge,0,0,j)));if(Tt&&xe<I-1){const dt=H.dist(Q);if(dt>2*F){const Lt=H.add(Q.sub(H)._mult(F/dt)._round());this.updateDistance(H,Lt),this.addCurrentVertex(Lt,ge,0,0,j),H=Lt}}}}addCurrentVertex(i,c,f,g,b,w=!1){const T=c.y*g-c.x,I=-c.y-c.x*g;this.addHalfVertex(i,c.x+c.y*f,c.y-c.x*f,w,!1,f,b),this.addHalfVertex(i,T,I,w,!0,-g,b),this.distance>P_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,c,f,g,b,w))}addHalfVertex({x:i,y:c},f,g,b,w,T,I){const L=.5*(this.lineClips?this.scaledDistance*(P_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(b?1:0),(c<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const F=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,F),I.primitiveLength++),w?this.e2=F:this.e1=F}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,c){this.distance+=i.dist(c),this.updateScaledDistance()}}let z_,D_;Ct("LineBucket",Tp,{omit:["layers","patternFeatures"]});var R_={get paint(){return D_=D_||new Si({"line-opacity":new Gt(ne.paint_line["line-opacity"]),"line-color":new Gt(ne.paint_line["line-color"]),"line-translate":new Ft(ne.paint_line["line-translate"]),"line-translate-anchor":new Ft(ne.paint_line["line-translate-anchor"]),"line-width":new Gt(ne.paint_line["line-width"]),"line-gap-width":new Gt(ne.paint_line["line-gap-width"]),"line-offset":new Gt(ne.paint_line["line-offset"]),"line-blur":new Gt(ne.paint_line["line-blur"]),"line-dasharray":new ja(ne.paint_line["line-dasharray"]),"line-pattern":new Ol(ne.paint_line["line-pattern"]),"line-gradient":new su(ne.paint_line["line-gradient"])})},get layout(){return z_=z_||new Si({"line-cap":new Ft(ne.layout_line["line-cap"]),"line-join":new Gt(ne.layout_line["line-join"]),"line-miter-limit":new Ft(ne.layout_line["line-miter-limit"]),"line-round-limit":new Ft(ne.layout_line["line-round-limit"]),"line-sort-key":new Gt(ne.layout_line["line-sort-key"])})}};class B2 extends Gt{possiblyEvaluate(i,c){return c=new Qr(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(i,c)}evaluate(i,c,f,g){return c=$({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(i,c,f,g)}}let xf;class F2 extends so{constructor(i){super(i,R_),this.gradientVersion=0,xf||(xf=new B2(R_.paint.properties["line-width"].specification),xf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof Pa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,c){super.recalculate(i,c),this.paint._values["line-floorwidth"]=xf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Tp(i)}queryRadius(i){const c=i,f=B_(bu("line-width",this,c),bu("line-gap-width",this,c)),g=bu("line-offset",this,c);return f/2+Math.abs(g)+mf(this.paint.get("line-translate"))}queryIntersectsFeature(i,c,f,g,b,w,T){const I=gf(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,T),L=T/2*B_(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),F=this.paint.get("line-offset").evaluate(c,f);return F&&(g=function(j,H){const K=[];for(let Q=0;Q<j.length;Q++){const ae=j[Q],ge=[];for(let xe=0;xe<ae.length;xe++){const Re=ae[xe-1],ke=ae[xe],Ae=ae[xe+1],Ye=xe===0?new S(0,0):ke.sub(Re)._unit()._perp(),Qe=xe===ae.length-1?new S(0,0):Ae.sub(ke)._unit()._perp(),Tt=Ye._add(Qe)._unit(),Dt=Tt.x*Qe.x+Tt.y*Qe.y;Dt!==0&&Tt._mult(1/Dt),ge.push(Tt._mult(H)._add(ke))}K.push(ge)}return K}(g,F*T)),function(j,H,K){for(let Q=0;Q<H.length;Q++){const ae=H[Q];if(j.length>=3){for(let ge=0;ge<ae.length;ge++)if($l(j,ae[ge]))return!0}if(yu(j,ae,K))return!0}return!1}(I,g,L)}isTileClipped(){return!0}}function B_(s,i){return i>0?i+2*s:s}const O2=kn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),N2=kn([{name:"a_projected_pos",components:3,type:"Float32"}],4);kn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const j2=kn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);kn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const F_=kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),U2=kn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function V2(s,i,c){return s.sections.forEach(f=>{f.text=function(g,b,w){const T=b.layout.get("text-transform").evaluate(w,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),es.applyArabicShaping&&(g=es.applyArabicShaping(g)),g}(f.text,i,c)}),s}kn([{name:"triangle",components:3,type:"Uint16"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),kn([{type:"Float32",name:"offsetX"}]),kn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),kn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Iu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Nn=24,O_=Br,N_=function(s,i,c,f,g){var b,w,T=8*g-f-1,I=(1<<T)-1,L=I>>1,F=-7,j=c?g-1:0,H=c?-1:1,K=s[i+j];for(j+=H,b=K&(1<<-F)-1,K>>=-F,F+=T;F>0;b=256*b+s[i+j],j+=H,F-=8);for(w=b&(1<<-F)-1,b>>=-F,F+=f;F>0;w=256*w+s[i+j],j+=H,F-=8);if(b===0)b=1-L;else{if(b===I)return w?NaN:1/0*(K?-1:1);w+=Math.pow(2,f),b-=L}return(K?-1:1)*w*Math.pow(2,b-f)},j_=function(s,i,c,f,g,b){var w,T,I,L=8*b-g-1,F=(1<<L)-1,j=F>>1,H=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,K=f?0:b-1,Q=f?1:-1,ae=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(T=isNaN(i)?1:0,w=F):(w=Math.floor(Math.log(i)/Math.LN2),i*(I=Math.pow(2,-w))<1&&(w--,I*=2),(i+=w+j>=1?H/I:H*Math.pow(2,1-j))*I>=2&&(w++,I/=2),w+j>=F?(T=0,w=F):w+j>=1?(T=(i*I-1)*Math.pow(2,g),w+=j):(T=i*Math.pow(2,j-1)*Math.pow(2,g),w=0));g>=8;s[c+K]=255&T,K+=Q,T/=256,g-=8);for(w=w<<g|T,L+=g;L>0;s[c+K]=255&w,K+=Q,w/=256,L-=8);s[c+K-Q]|=128*ae};function Br(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Br.Varint=0,Br.Fixed64=1,Br.Bytes=2,Br.Fixed32=5;var Ep=4294967296,U_=1/Ep,V_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Ss(s){return s.type===Br.Bytes?s.readVarint()+s.pos:s.pos+1}function Yl(s,i,c){return c?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}function q_(s,i,c){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));c.realloc(f);for(var g=c.pos-1;g>=s;g--)c.buf[g+f]=c.buf[g]}function q2(s,i){for(var c=0;c<s.length;c++)i.writeVarint(s[c])}function G2(s,i){for(var c=0;c<s.length;c++)i.writeSVarint(s[c])}function W2(s,i){for(var c=0;c<s.length;c++)i.writeFloat(s[c])}function Z2(s,i){for(var c=0;c<s.length;c++)i.writeDouble(s[c])}function H2(s,i){for(var c=0;c<s.length;c++)i.writeBoolean(s[c])}function $2(s,i){for(var c=0;c<s.length;c++)i.writeFixed32(s[c])}function X2(s,i){for(var c=0;c<s.length;c++)i.writeSFixed32(s[c])}function K2(s,i){for(var c=0;c<s.length;c++)i.writeFixed64(s[c])}function J2(s,i){for(var c=0;c<s.length;c++)i.writeSFixed64(s[c])}function Sf(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Ql(s,i,c){s[c]=i,s[c+1]=i>>>8,s[c+2]=i>>>16,s[c+3]=i>>>24}function G_(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}Br.prototype={destroy:function(){this.buf=null},readFields:function(s,i,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),g=f>>3,b=this.pos;this.type=7&f,s(g,i,this),this.pos===b&&this.skip(f)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Sf(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=G_(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Sf(this.buf,this.pos)+Sf(this.buf,this.pos+4)*Ep;return this.pos+=8,s},readSFixed64:function(){var s=Sf(this.buf,this.pos)+G_(this.buf,this.pos+4)*Ep;return this.pos+=8,s},readFloat:function(){var s=N_(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=N_(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,c,f=this.buf;return i=127&(c=f[this.pos++]),c<128?i:(i|=(127&(c=f[this.pos++]))<<7,c<128?i:(i|=(127&(c=f[this.pos++]))<<14,c<128?i:(i|=(127&(c=f[this.pos++]))<<21,c<128?i:function(g,b,w){var T,I,L=w.buf;if(T=(112&(I=L[w.pos++]))>>4,I<128||(T|=(127&(I=L[w.pos++]))<<3,I<128)||(T|=(127&(I=L[w.pos++]))<<10,I<128)||(T|=(127&(I=L[w.pos++]))<<17,I<128)||(T|=(127&(I=L[w.pos++]))<<24,I<128)||(T|=(1&(I=L[w.pos++]))<<31,I<128))return Yl(g,T,b);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(c=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&V_?function(c,f,g){return V_.decode(c.subarray(f,g))}(this.buf,i,s):function(c,f,g){for(var b="",w=f;w<g;){var T,I,L,F=c[w],j=null,H=F>239?4:F>223?3:F>191?2:1;if(w+H>g)break;H===1?F<128&&(j=F):H===2?(192&(T=c[w+1]))==128&&(j=(31&F)<<6|63&T)<=127&&(j=null):H===3?(I=c[w+2],(192&(T=c[w+1]))==128&&(192&I)==128&&((j=(15&F)<<12|(63&T)<<6|63&I)<=2047||j>=55296&&j<=57343)&&(j=null)):H===4&&(I=c[w+2],L=c[w+3],(192&(T=c[w+1]))==128&&(192&I)==128&&(192&L)==128&&((j=(15&F)<<18|(63&T)<<12|(63&I)<<6|63&L)<=65535||j>=1114112)&&(j=null)),j===null?(j=65533,H=1):j>65535&&(j-=65536,b+=String.fromCharCode(j>>>10&1023|55296),j=56320|1023&j),b+=String.fromCharCode(j),w+=H}return b}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==Br.Bytes)return s.push(this.readVarint(i));var c=Ss(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==Br.Bytes)return s.push(this.readSVarint());var i=Ss(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Br.Bytes)return s.push(this.readBoolean());var i=Ss(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Br.Bytes)return s.push(this.readFloat());var i=Ss(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Br.Bytes)return s.push(this.readDouble());var i=Ss(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Br.Bytes)return s.push(this.readFixed32());var i=Ss(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Br.Bytes)return s.push(this.readSFixed32());var i=Ss(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Br.Bytes)return s.push(this.readFixed64());var i=Ss(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Br.Bytes)return s.push(this.readSFixed64());var i=Ss(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===Br.Varint)for(;this.buf[this.pos++]>127;);else if(i===Br.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Br.Fixed32)this.pos+=4;else{if(i!==Br.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var c=new Uint8Array(i);c.set(this.buf),this.buf=c,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Ql(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Ql(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Ql(this.buf,-1&s,this.pos),Ql(this.buf,Math.floor(s*U_),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Ql(this.buf,-1&s,this.pos),Ql(this.buf,Math.floor(s*U_),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,c){var f,g;if(i>=0?(f=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(b,w,T){T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,b>>>=7,T.buf[T.pos++]=127&b|128,T.buf[T.pos]=127&(b>>>=7)}(f,0,c),function(b,w){var T=(7&b)<<4;w.buf[w.pos++]|=T|((b>>>=3)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b)))))}(g,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(f,g,b){for(var w,T,I=0;I<g.length;I++){if((w=g.charCodeAt(I))>55295&&w<57344){if(!T){w>56319||I+1===g.length?(f[b++]=239,f[b++]=191,f[b++]=189):T=w;continue}if(w<56320){f[b++]=239,f[b++]=191,f[b++]=189,T=w;continue}w=T-55296<<10|w-56320|65536,T=null}else T&&(f[b++]=239,f[b++]=191,f[b++]=189,T=null);w<128?f[b++]=w:(w<2048?f[b++]=w>>6|192:(w<65536?f[b++]=w>>12|224:(f[b++]=w>>18|240,f[b++]=w>>12&63|128),f[b++]=w>>6&63|128),f[b++]=63&w|128)}return b}(this.buf,s,this.pos);var c=this.pos-i;c>=128&&q_(i,c,this),this.pos=i-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),j_(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),j_(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var c=0;c<i;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,i){this.pos++;var c=this.pos;s(i,this);var f=this.pos-c;f>=128&&q_(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,i,c){this.writeTag(s,Br.Bytes),this.writeRawMessage(i,c)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,q2,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,G2,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,H2,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,W2,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,Z2,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,$2,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,X2,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,K2,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,J2,i)},writeBytesField:function(s,i){this.writeTag(s,Br.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,Br.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,Br.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,Br.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,Br.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,Br.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,Br.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,Br.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,Br.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,Br.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var Mp=_(O_);const Cp=3;function Y2(s,i,c){s===1&&c.readMessage(Q2,i)}function Q2(s,i,c){if(s===3){const{id:f,bitmap:g,width:b,height:w,left:T,top:I,advance:L}=c.readMessage(eS,{});i.push({id:f,bitmap:new xu({width:b+2*Cp,height:w+2*Cp},g),metrics:{width:b,height:w,left:T,top:I,advance:L}})}}function eS(s,i,c){s===1?i.id=c.readVarint():s===2?i.bitmap=c.readBytes():s===3?i.width=c.readVarint():s===4?i.height=c.readVarint():s===5?i.left=c.readSVarint():s===6?i.top=c.readSVarint():s===7&&(i.advance=c.readVarint())}const W_=Cp;function Z_(s){let i=0,c=0;for(const w of s)i+=w.w*w.h,c=Math.max(c,w.w);s.sort((w,T)=>T.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),c),h:1/0}];let g=0,b=0;for(const w of s)for(let T=f.length-1;T>=0;T--){const I=f[T];if(!(w.w>I.w||w.h>I.h)){if(w.x=I.x,w.y=I.y,b=Math.max(b,w.y+w.h),g=Math.max(g,w.x+w.w),w.w===I.w&&w.h===I.h){const L=f.pop();T<f.length&&(f[T]=L)}else w.h===I.h?(I.x+=w.w,I.w-=w.w):w.w===I.w?(I.y+=w.h,I.h-=w.h):(f.push({x:I.x+w.w,y:I.y,w:I.w-w.w,h:w.h}),I.y+=w.h,I.h-=w.h);break}}return{w:g,h:b,fill:i/(g*b)||0}}const ji=1;class Ip{constructor(i,{pixelRatio:c,version:f,stretchX:g,stretchY:b,content:w}){this.paddedRect=i,this.pixelRatio=c,this.stretchX=g,this.stretchY=b,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+ji,this.paddedRect.y+ji]}get br(){return[this.paddedRect.x+this.paddedRect.w-ji,this.paddedRect.y+this.paddedRect.h-ji]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ji)/this.pixelRatio,(this.paddedRect.h-2*ji)/this.pixelRatio]}}class H_{constructor(i,c){const f={},g={};this.haveRenderCallbacks=[];const b=[];this.addImages(i,f,b),this.addImages(c,g,b);const{w,h:T}=Z_(b),I=new ao({width:w||1,height:T||1});for(const L in i){const F=i[L],j=f[L].paddedRect;ao.copy(F.data,I,{x:0,y:0},{x:j.x+ji,y:j.y+ji},F.data)}for(const L in c){const F=c[L],j=g[L].paddedRect,H=j.x+ji,K=j.y+ji,Q=F.data.width,ae=F.data.height;ao.copy(F.data,I,{x:0,y:0},{x:H,y:K},F.data),ao.copy(F.data,I,{x:0,y:ae-1},{x:H,y:K-1},{width:Q,height:1}),ao.copy(F.data,I,{x:0,y:0},{x:H,y:K+ae},{width:Q,height:1}),ao.copy(F.data,I,{x:Q-1,y:0},{x:H-1,y:K},{width:1,height:ae}),ao.copy(F.data,I,{x:0,y:0},{x:H+Q,y:K},{width:1,height:ae})}this.image=I,this.iconPositions=f,this.patternPositions=g}addImages(i,c,f){for(const g in i){const b=i[g],w={x:0,y:0,w:b.data.width+2*ji,h:b.data.height+2*ji};f.push(w),c[g]=new Ip(w,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,c){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),c)}patchUpdatedImage(i,c,f){if(!i||!c||i.version===c.version)return;i.version=c.version;const[g,b]=i.tl;f.update(c.data,void 0,{x:g,y:b})}}var ea;Ct("ImagePosition",Ip),Ct("ImageAtlas",H_),d.ah=void 0,(ea=d.ah||(d.ah={}))[ea.none=0]="none",ea[ea.horizontal=1]="horizontal",ea[ea.vertical=2]="vertical",ea[ea.horizontalOnly=3]="horizontalOnly";const Au=-17;class Lu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,c){const f=new Lu;return f.scale=i||1,f.fontStack=c,f}static forImage(i){const c=new Lu;return c.imageName=i,c}}class ec{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,c){const f=new ec;for(let g=0;g<i.sections.length;g++){const b=i.sections[g];b.image?f.addImageSection(b):f.addTextSection(b,c)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let c="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,b=i.charCodeAt(f-1)||null;c+=g&&iu(g)&&!Iu[i[f+1]]||b&&iu(b)&&!Iu[i[f-1]]||!Iu[i[f]]?i[f]:Iu[i[f]]}return c}(this.text)}trim(){let i=0;for(let f=0;f<this.text.length&&Tf[this.text.charCodeAt(f)];f++)i++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Tf[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(i,c),this.sectionIndex=this.sectionIndex.slice(i,c)}substring(i,c){const f=new ec;return f.text=this.text.substring(i,c),f.sectionIndex=this.sectionIndex.slice(i,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,c)=>Math.max(i,this.sections[c].scale),0)}addTextSection(i,c){this.text+=i.text,this.sections.push(Lu.forText(i.scale,i.fontStack||c));const f=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(f)}addImageSection(i){const c=i.image?i.image.name:"";if(c.length===0)return void He("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Lu.forImage(c)),this.sectionIndex.push(this.sections.length-1)):He("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kf(s,i,c,f,g,b,w,T,I,L,F,j,H,K,Q,ae){const ge=ec.fromFeature(s,g);let xe;j===d.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Re,processStyledBidirectionalText:ke}=es;if(Re&&ge.sections.length===1){xe=[];const Qe=Re(ge.toString(),Ap(ge,L,b,i,f,K,Q));for(const Tt of Qe){const Dt=new ec;Dt.text=Tt,Dt.sections=ge.sections;for(let kt=0;kt<Tt.length;kt++)Dt.sectionIndex.push(0);xe.push(Dt)}}else if(ke){xe=[];const Qe=ke(ge.text,ge.sectionIndex,Ap(ge,L,b,i,f,K,Q));for(const Tt of Qe){const Dt=new ec;Dt.text=Tt[0],Dt.sectionIndex=Tt[1],Dt.sections=ge.sections,xe.push(Dt)}}else xe=function(Qe,Tt){const Dt=[],kt=Qe.text;let vt=0;for(const dt of Tt)Dt.push(Qe.substring(vt,dt)),vt=dt;return vt<kt.length&&Dt.push(Qe.substring(vt,kt.length)),Dt}(ge,Ap(ge,L,b,i,f,K,Q));const Ae=[],Ye={positionedLines:Ae,text:ge.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:j,iconsInText:!1,verticalizable:!1};return function(Qe,Tt,Dt,kt,vt,dt,Lt,_t,ot,qt,Bt,pr){let Xr=0,tn=Au,jn=0,Yi=0;const Ti=_t==="right"?1:_t==="left"?0:.5;let zn=0;for(const Un of vt){Un.trim();const Vn=Un.getMaxScale(),mi=(Vn-1)*Nn,Ci={positionedGlyphs:[],lineOffset:0};Qe.positionedLines[zn]=Ci;const gi=Ci.positionedGlyphs;let Ui=0;if(!Un.length()){tn+=dt,++zn;continue}for(let qn=0;qn<Un.length();qn++){const yr=Un.getSection(qn),_i=Un.getSectionIndex(qn),li=Un.getCharCode(qn);let Gn=0,xo=null,No=null,jo=null,ks=Nn;const So=!(ot===d.ah.horizontal||!Bt&&!Rl(li)||Bt&&(Tf[li]||(Yn=li,St.Arabic(Yn)||St["Arabic Supplement"](Yn)||St["Arabic Extended-A"](Yn)||St["Arabic Presentation Forms-A"](Yn)||St["Arabic Presentation Forms-B"](Yn))));if(yr.imageName){const co=kt[yr.imageName];if(!co)continue;jo=yr.imageName,Qe.iconsInText=Qe.iconsInText||!0,No=co.paddedRect;const qi=co.displaySize;yr.scale=yr.scale*Nn/pr,xo={width:qi[0],height:qi[1],left:ji,top:-W_,advance:So?qi[1]:qi[0]},Gn=mi+(Nn-qi[1]*yr.scale),ks=xo.advance;const Ts=So?qi[0]*yr.scale-Nn*Vn:qi[1]*yr.scale-Nn*Vn;Ts>0&&Ts>Ui&&(Ui=Ts)}else{const co=Dt[yr.fontStack],qi=co&&co[li];if(qi&&qi.rect)No=qi.rect,xo=qi.metrics;else{const Ts=Tt[yr.fontStack],Bu=Ts&&Ts[li];if(!Bu)continue;xo=Bu.metrics}Gn=(Vn-yr.scale)*Nn}So?(Qe.verticalizable=!0,gi.push({glyph:li,imageName:jo,x:Xr,y:tn+Gn,vertical:So,scale:yr.scale,fontStack:yr.fontStack,sectionIndex:_i,metrics:xo,rect:No}),Xr+=ks*yr.scale+qt):(gi.push({glyph:li,imageName:jo,x:Xr,y:tn+Gn,vertical:So,scale:yr.scale,fontStack:yr.fontStack,sectionIndex:_i,metrics:xo,rect:No}),Xr+=xo.advance*yr.scale+qt)}gi.length!==0&&(jn=Math.max(Xr-qt,jn),nS(gi,0,gi.length-1,Ti,Ui)),Xr=0;const Vi=dt*Vn+Ui;Ci.lineOffset=Math.max(Ui,mi),tn+=Vi,Yi=Math.max(Vi,Yi),++zn}var Yn;const ai=tn-Au,{horizontalAlign:Ei,verticalAlign:Mi}=Lp(Lt);(function(Un,Vn,mi,Ci,gi,Ui,Vi,qn,yr){const _i=(Vn-mi)*gi;let li=0;li=Ui!==Vi?-qn*Ci-Au:(-Ci*yr+.5)*Vi;for(const Gn of Un)for(const xo of Gn.positionedGlyphs)xo.x+=_i,xo.y+=li})(Qe.positionedLines,Ti,Ei,Mi,jn,Yi,dt,ai,vt.length),Qe.top+=-Mi*ai,Qe.bottom=Qe.top+ai,Qe.left+=-Ei*jn,Qe.right=Qe.left+jn}(Ye,i,c,f,xe,w,T,I,j,L,H,ae),!function(Qe){for(const Tt of Qe)if(Tt.positionedGlyphs.length!==0)return!1;return!0}(Ae)&&Ye}const Tf={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tS={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $_(s,i,c,f,g,b){if(i.imageName){const w=f[i.imageName];return w?w.displaySize[0]*i.scale*Nn/b+g:0}{const w=c[i.fontStack],T=w&&w[s];return T?T.metrics.advance*i.scale+g:0}}function X_(s,i,c,f){const g=Math.pow(s-i,2);return f?s<i?g/2:2*g:g+Math.abs(c)*c}function rS(s,i,c){let f=0;return s===10&&(f-=1e4),c&&(f+=150),s!==40&&s!==65288||(f+=50),i!==41&&i!==65289||(f+=50),f}function K_(s,i,c,f,g,b){let w=null,T=X_(i,c,g,b);for(const I of f){const L=X_(i-I.x,c,g,b)+I.badness;L<=T&&(w=I,T=L)}return{index:s,x:i,priorBreak:w,badness:T}}function J_(s){return s?J_(s.priorBreak).concat(s.index):[]}function Ap(s,i,c,f,g,b,w){if(b!=="point")return[];if(!s)return[];const T=[],I=function(H,K,Q,ae,ge,xe){let Re=0;for(let ke=0;ke<H.length();ke++){const Ae=H.getSection(ke);Re+=$_(H.getCharCode(ke),Ae,ae,ge,K,xe)}return Re/Math.max(1,Math.ceil(Re/Q))}(s,i,c,f,g,w),L=s.text.indexOf("")>=0;let F=0;for(let H=0;H<s.length();H++){const K=s.getSection(H),Q=s.getCharCode(H);if(Tf[Q]||(F+=$_(Q,K,f,g,i,w)),H<s.length()-1){const ae=!((j=Q)<11904||!(St["Bopomofo Extended"](j)||St.Bopomofo(j)||St["CJK Compatibility Forms"](j)||St["CJK Compatibility Ideographs"](j)||St["CJK Compatibility"](j)||St["CJK Radicals Supplement"](j)||St["CJK Strokes"](j)||St["CJK Symbols and Punctuation"](j)||St["CJK Unified Ideographs Extension A"](j)||St["CJK Unified Ideographs"](j)||St["Enclosed CJK Letters and Months"](j)||St["Halfwidth and Fullwidth Forms"](j)||St.Hiragana(j)||St["Ideographic Description Characters"](j)||St["Kangxi Radicals"](j)||St["Katakana Phonetic Extensions"](j)||St.Katakana(j)||St["Vertical Forms"](j)||St["Yi Radicals"](j)||St["Yi Syllables"](j)));(tS[Q]||ae||K.imageName)&&T.push(K_(H+1,F,I,T,rS(Q,s.getCharCode(H+1),ae&&L),!1))}}var j;return J_(K_(s.length(),F,I,T,0,!0))}function Lp(s){let i=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:i,verticalAlign:c}}function nS(s,i,c,f,g){if(!f&&!g)return;const b=s[c],w=(s[c].x+b.metrics.advance*b.scale)*f;for(let T=i;T<=c;T++)s[T].x-=w,s[T].y+=g}function iS(s,i,c){const{horizontalAlign:f,verticalAlign:g}=Lp(c),b=i[0]-s.displaySize[0]*f,w=i[1]-s.displaySize[1]*g;return{image:s,top:w,bottom:w+s.displaySize[1],left:b,right:b+s.displaySize[0]}}function Y_(s,i,c,f,g,b){const w=s.image;let T;if(w.content){const ge=w.content,xe=w.pixelRatio||1;T=[ge[0]/xe,ge[1]/xe,w.displaySize[0]-ge[2]/xe,w.displaySize[1]-ge[3]/xe]}const I=i.left*b,L=i.right*b;let F,j,H,K;c==="width"||c==="both"?(K=g[0]+I-f[3],j=g[0]+L+f[1]):(K=g[0]+(I+L-w.displaySize[0])/2,j=K+w.displaySize[0]);const Q=i.top*b,ae=i.bottom*b;return c==="height"||c==="both"?(F=g[1]+Q-f[0],H=g[1]+ae+f[2]):(F=g[1]+(Q+ae-w.displaySize[1])/2,H=F+w.displaySize[1]),{image:w,top:F,right:j,bottom:H,left:K,collisionPadding:T}}const Pu=255,is=128,ta=Pu*is;function Q_(s,i){const{expression:c}=i;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Qr(s+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=c;let b=0;for(;b<f.length&&f[b]<=s;)b++;b=Math.max(0,b-1);let w=b;for(;w<f.length&&f[w]<s+1;)w++;w=Math.min(f.length-1,w);const T=f[b],I=f[w];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:I,minSize:c.evaluate(new Qr(T)),maxSize:c.evaluate(new Qr(I)),interpolationType:g}}}function Pp(s,i,c){let f="never";const g=s.get(i);return g?f=g:s.get(c)&&(f="always"),f}const oS=Qs.VectorTileFeature.types,sS=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ef(s,i,c,f,g,b,w,T,I,L,F,j,H){const K=T?Math.min(ta,Math.round(T[0])):0,Q=T?Math.min(ta,Math.round(T[1])):0;s.emplaceBack(i,c,Math.round(32*f),Math.round(32*g),b,w,(K<<1)+(I?1:0),Q,16*L,16*F,256*j,256*H)}function zp(s,i,c){s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c),s.emplaceBack(i.x,i.y,c)}function aS(s){for(const i of s.sections)if(up(i.text))return!0;return!1}class Dp{constructor(i){this.layoutVertexArray=new qe,this.indexArray=new Xe,this.programConfigurations=i,this.segments=new mt,this.dynamicLayoutVertexArray=new we,this.opacityVertexArray=new Le,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,c,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,O2.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,N2.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,sS,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ct("SymbolBuffers",Dp);class Rp{constructor(i,c,f){this.layoutVertexArray=new i,this.layoutAttributes=c,this.indexArray=new f,this.segments=new mt,this.collisionVertexArray=new $e}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,j2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ct("CollisionBuffers",Rp);class tc{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(w=>w.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=fp([]),this.placementViewportMatrix=fp([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Q_(this.zoom,c["text-size"]),this.iconSizeData=Q_(this.zoom,c["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),b=f.get("symbol-z-order");this.canOverlap=Pp(f,"text-overlap","text-allow-overlap")!=="never"||Pp(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>d.ah[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=i.sourceID}createArrays(){this.text=new Dp(new sn(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Dp(new sn(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new v,this.lineVertexArray=new E,this.symbolInstances=new m,this.textAnchorOffsets=new A}calculateGlyphDependencies(i,c,f,g,b){for(let w=0;w<i.length;w++)if(c[i.charCodeAt(w)]=!0,(f||g)&&b){const T=Iu[i.charAt(w)];T&&(c[T.charCodeAt(0)]=!0)}}populate(i,c,f){const g=this.layers[0],b=g.layout,w=b.get("text-font"),T=b.get("text-field"),I=b.get("icon-image"),L=(T.value.kind!=="constant"||T.value.value instanceof Ri&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),F=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,j=b.get("symbol-sort-key");if(this.features=[],!L&&!F)return;const H=c.iconDependencies,K=c.glyphDependencies,Q=c.availableImages,ae=new Qr(this.zoom);for(const{feature:ge,id:xe,index:Re,sourceLayerIndex:ke}of i){const Ae=g._featureFilter.needGeometry,Ye=xs(ge,Ae);if(!g._featureFilter.filter(ae,Ye,f))continue;let Qe,Tt;if(Ae||(Ye.geometry=ws(ge)),L){const kt=g.getValueAndResolveTokens("text-field",Ye,f,Q),vt=Ri.factory(kt),dt=this.hasRTLText=this.hasRTLText||aS(vt);(!dt||es.getRTLTextPluginStatus()==="unavailable"||dt&&es.isParsed())&&(Qe=V2(vt,g,Ye))}if(F){const kt=g.getValueAndResolveTokens("icon-image",Ye,f,Q);Tt=kt instanceof Xi?kt:Xi.fromString(kt)}if(!Qe&&!Tt)continue;const Dt=this.sortFeaturesByKey?j.evaluate(Ye,{},f):void 0;if(this.features.push({id:xe,text:Qe,icon:Tt,index:Re,sourceLayerIndex:ke,geometry:Ye.geometry,properties:ge.properties,type:oS[ge.type],sortKey:Dt}),Tt&&(H[Tt.name]=!0),Qe){const kt=w.evaluate(Ye,{},f).join(","),vt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const dt of Qe.sections)if(dt.image)H[dt.image.name]=!0;else{const Lt=Js(Qe.toString()),_t=dt.fontStack||kt,ot=K[_t]=K[_t]||{};this.calculateGlyphDependencies(dt.text,ot,vt,this.allowVerticalPlacement,Lt)}}}b.get("symbol-placement")==="line"&&(this.features=function(ge){const xe={},Re={},ke=[];let Ae=0;function Ye(kt){ke.push(ge[kt]),Ae++}function Qe(kt,vt,dt){const Lt=Re[kt];return delete Re[kt],Re[vt]=Lt,ke[Lt].geometry[0].pop(),ke[Lt].geometry[0]=ke[Lt].geometry[0].concat(dt[0]),Lt}function Tt(kt,vt,dt){const Lt=xe[vt];return delete xe[vt],xe[kt]=Lt,ke[Lt].geometry[0].shift(),ke[Lt].geometry[0]=dt[0].concat(ke[Lt].geometry[0]),Lt}function Dt(kt,vt,dt){const Lt=dt?vt[0][vt[0].length-1]:vt[0][0];return`${kt}:${Lt.x}:${Lt.y}`}for(let kt=0;kt<ge.length;kt++){const vt=ge[kt],dt=vt.geometry,Lt=vt.text?vt.text.toString():null;if(!Lt){Ye(kt);continue}const _t=Dt(Lt,dt),ot=Dt(Lt,dt,!0);if(_t in Re&&ot in xe&&Re[_t]!==xe[ot]){const qt=Tt(_t,ot,dt),Bt=Qe(_t,ot,ke[qt].geometry);delete xe[_t],delete Re[ot],Re[Dt(Lt,ke[Bt].geometry,!0)]=Bt,ke[qt].geometry=null}else _t in Re?Qe(_t,ot,dt):ot in xe?Tt(_t,ot,dt):(Ye(kt),xe[_t]=Ae-1,Re[ot]=Ae-1)}return ke.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,xe)=>ge.sortKey-xe.sortKey)}update(i,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(i,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,c){const f=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(c[i.segment+1]),b=i.dist(c[i.segment]);const w={};for(let T=i.segment+1;T<c.length;T++)w[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:g},T<c.length-1&&(g+=c[T+1].dist(c[T]));for(let T=i.segment||0;T>=0;T--)w[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:b},T>0&&(b+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const I=w[T];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,c,f,g,b,w,T,I,L,F,j,H){const K=i.indexArray,Q=i.layoutVertexArray,ae=i.segments.prepareSegment(4*c.length,Q,K,this.canOverlap?w.sortKey:void 0),ge=this.glyphOffsetArray.length,xe=ae.vertexLength,Re=this.allowVerticalPlacement&&T===d.ah.vertical?Math.PI/2:0,ke=w.text&&w.text.sections;for(let Ae=0;Ae<c.length;Ae++){const{tl:Ye,tr:Qe,bl:Tt,br:Dt,tex:kt,pixelOffsetTL:vt,pixelOffsetBR:dt,minFontScaleX:Lt,minFontScaleY:_t,glyphOffset:ot,isSDF:qt,sectionIndex:Bt}=c[Ae],pr=ae.vertexLength,Xr=ot[1];Ef(Q,I.x,I.y,Ye.x,Xr+Ye.y,kt.x,kt.y,f,qt,vt.x,vt.y,Lt,_t),Ef(Q,I.x,I.y,Qe.x,Xr+Qe.y,kt.x+kt.w,kt.y,f,qt,dt.x,vt.y,Lt,_t),Ef(Q,I.x,I.y,Tt.x,Xr+Tt.y,kt.x,kt.y+kt.h,f,qt,vt.x,dt.y,Lt,_t),Ef(Q,I.x,I.y,Dt.x,Xr+Dt.y,kt.x+kt.w,kt.y+kt.h,f,qt,dt.x,dt.y,Lt,_t),zp(i.dynamicLayoutVertexArray,I,Re),K.emplaceBack(pr,pr+1,pr+2),K.emplaceBack(pr+1,pr+2,pr+3),ae.vertexLength+=4,ae.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ot[0]),Ae!==c.length-1&&Bt===c[Ae+1].sectionIndex||i.programConfigurations.populatePaintArrays(Q.length,w,w.index,{},H,ke&&ke[Bt])}i.placedSymbolArray.emplaceBack(I.x,I.y,ge,this.glyphOffsetArray.length-ge,xe,L,F,I.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,j)}_addCollisionDebugVertex(i,c,f,g,b,w){return c.emplaceBack(0,0),i.emplaceBack(f.x,f.y,g,b,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(i,c,f,g,b,w,T){const I=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),L=I.vertexLength,F=b.layoutVertexArray,j=b.collisionVertexArray,H=T.anchorX,K=T.anchorY;this._addCollisionDebugVertex(F,j,w,H,K,new S(i,c)),this._addCollisionDebugVertex(F,j,w,H,K,new S(f,c)),this._addCollisionDebugVertex(F,j,w,H,K,new S(f,g)),this._addCollisionDebugVertex(F,j,w,H,K,new S(i,g)),I.vertexLength+=4;const Q=b.indexArray;Q.emplaceBack(L,L+1),Q.emplaceBack(L+1,L+2),Q.emplaceBack(L+2,L+3),Q.emplaceBack(L+3,L),I.primitiveLength+=4}addDebugCollisionBoxes(i,c,f,g){for(let b=i;b<c;b++){const w=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,g?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rp(We,F_.members,rt),this.iconCollisionBox=new Rp(We,F_.members,rt);for(let i=0;i<this.symbolInstances.length;i++){const c=this.symbolInstances.get(i);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(i,c,f,g,b,w,T,I,L){const F={};for(let j=c;j<f;j++){const H=i.get(j);F.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.textFeatureIndex=H.featureIndex;break}for(let j=g;j<b;j++){const H=i.get(j);F.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.verticalTextFeatureIndex=H.featureIndex;break}for(let j=w;j<T;j++){const H=i.get(j);F.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.iconFeatureIndex=H.featureIndex;break}for(let j=I;j<L;j++){const H=i.get(j);F.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},F.verticalIconFeatureIndex=H.featureIndex;break}return F}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,c){const f=i.placedSymbolArray.get(c),g=f.vertexStartIndex+4*f.numGlyphs;for(let b=f.vertexStartIndex;b<g;b+=4)i.indexArray.emplaceBack(b,b+1,b+2),i.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(i),f=Math.cos(i),g=[],b=[],w=[];for(let T=0;T<this.symbolInstances.length;++T){w.push(T);const I=this.symbolInstances.get(T);g.push(0|Math.round(c*I.anchorX+f*I.anchorY)),b.push(I.featureIndex)}return w.sort((T,I)=>g[T]-g[I]||b[I]-b[T]),w}addToSortKeyRanges(i,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,b,w)=>{g>=0&&w.indexOf(g)===b&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ey,ty;Ct("SymbolBucket",tc,{omit:["layers","collisionBoxArray","features","compareText"]}),tc.MAX_GLYPHS=65535,tc.addDynamicAttributes=zp;var Bp={get paint(){return ty=ty||new Si({"icon-opacity":new Gt(ne.paint_symbol["icon-opacity"]),"icon-color":new Gt(ne.paint_symbol["icon-color"]),"icon-halo-color":new Gt(ne.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(ne.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(ne.paint_symbol["icon-halo-blur"]),"icon-translate":new Ft(ne.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ft(ne.paint_symbol["icon-translate-anchor"]),"text-opacity":new Gt(ne.paint_symbol["text-opacity"]),"text-color":new Gt(ne.paint_symbol["text-color"],{runtimeType:Nr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Gt(ne.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(ne.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(ne.paint_symbol["text-halo-blur"]),"text-translate":new Ft(ne.paint_symbol["text-translate"]),"text-translate-anchor":new Ft(ne.paint_symbol["text-translate-anchor"])})},get layout(){return ey=ey||new Si({"symbol-placement":new Ft(ne.layout_symbol["symbol-placement"]),"symbol-spacing":new Ft(ne.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ft(ne.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(ne.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ft(ne.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ft(ne.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ft(ne.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ft(ne.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ft(ne.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ft(ne.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(ne.layout_symbol["icon-size"]),"icon-text-fit":new Ft(ne.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft(ne.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(ne.layout_symbol["icon-image"]),"icon-rotate":new Gt(ne.layout_symbol["icon-rotate"]),"icon-padding":new Gt(ne.layout_symbol["icon-padding"]),"icon-keep-upright":new Ft(ne.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(ne.layout_symbol["icon-offset"]),"icon-anchor":new Gt(ne.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ft(ne.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ft(ne.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ft(ne.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(ne.layout_symbol["text-field"]),"text-font":new Gt(ne.layout_symbol["text-font"]),"text-size":new Gt(ne.layout_symbol["text-size"]),"text-max-width":new Gt(ne.layout_symbol["text-max-width"]),"text-line-height":new Ft(ne.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(ne.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(ne.layout_symbol["text-justify"]),"text-radial-offset":new Gt(ne.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ft(ne.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Gt(ne.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Gt(ne.layout_symbol["text-anchor"]),"text-max-angle":new Ft(ne.layout_symbol["text-max-angle"]),"text-writing-mode":new Ft(ne.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(ne.layout_symbol["text-rotate"]),"text-padding":new Ft(ne.layout_symbol["text-padding"]),"text-keep-upright":new Ft(ne.layout_symbol["text-keep-upright"]),"text-transform":new Gt(ne.layout_symbol["text-transform"]),"text-offset":new Gt(ne.layout_symbol["text-offset"]),"text-allow-overlap":new Ft(ne.layout_symbol["text-allow-overlap"]),"text-overlap":new Ft(ne.layout_symbol["text-overlap"]),"text-ignore-placement":new Ft(ne.layout_symbol["text-ignore-placement"]),"text-optional":new Ft(ne.layout_symbol["text-optional"])})}};class ry{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Or,this.defaultValue=i}evaluate(i){if(i.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(i.formattedSection))return c.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct("FormatSectionOverride",ry,{omit:["defaultValue"]});class Mf extends so{constructor(i){super(i,Bp)}recalculate(i,c){if(super.recalculate(i,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const b of f)g.indexOf(b)<0&&g.push(b);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,c,f,g){const b=this.layout.get(i).evaluate(c,{},f,g),w=this._unevaluatedLayout._values[i];return w.isDataDriven()||jr(w.value)||!b?b:function(T,I){return I.replace(/{([^{}]+)}/g,(L,F)=>T&&F in T?String(T[F]):"")}(c.properties,b)}createBucket(i){return new tc(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Bp.paint.overridableProperties){if(!Mf.hasPaintOverride(this.layout,i))continue;const c=this.paint.get(i),f=new ry(c),g=new $r(f,c.property.specification);let b=null;b=c.value.kind==="constant"||c.value.kind==="source"?new kl("source",g):new Xc("composite",g,c.value.zoomStops),this.paint._values[i]=new oo(c.property,b,c.parameters)}}_handleOverridablePaintPropertyUpdate(i,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&Mf.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,c){const f=i.get("text-field"),g=Bp.paint.properties[c];let b=!1;const w=T=>{for(const I of T)if(g.overrides&&g.overrides.hasOverride(I))return void(b=!0)};if(f.value.kind==="constant"&&f.value.value instanceof Ri)w(f.value.value.sections);else if(f.value.kind==="source"){const T=L=>{b||(L instanceof Xo&&In(L.value)===an?w(L.value.sections):L instanceof xl?w(L.sections):L.eachChild(T))},I=f.value;I._styleExpression&&T(I._styleExpression.expression)}return b}}let ny;var lS={get paint(){return ny=ny||new Si({"background-color":new Ft(ne.paint_background["background-color"]),"background-pattern":new ja(ne.paint_background["background-pattern"]),"background-opacity":new Ft(ne.paint_background["background-opacity"])})}};class cS extends so{constructor(i){super(i,lS)}}let iy;var uS={get paint(){return iy=iy||new Si({"raster-opacity":new Ft(ne.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ft(ne.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ft(ne.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ft(ne.paint_raster["raster-brightness-max"]),"raster-saturation":new Ft(ne.paint_raster["raster-saturation"]),"raster-contrast":new Ft(ne.paint_raster["raster-contrast"]),"raster-resampling":new Ft(ne.paint_raster["raster-resampling"]),"raster-fade-duration":new Ft(ne.paint_raster["raster-fade-duration"])})}};class hS extends so{constructor(i){super(i,uS)}}class fS extends so{constructor(i){super(i,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class dS{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Fp=63710088e-1;class ra{constructor(i,c){if(isNaN(i)||isNaN(c))throw new Error(`Invalid LngLat object: (${i}, ${c})`);if(this.lng=+i,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ra(le(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const c=Math.PI/180,f=this.lat*c,g=i.lat*c,b=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((i.lng-this.lng)*c);return Fp*Math.acos(Math.min(b,1))}static convert(i){if(i instanceof ra)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new ra(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new ra(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const oy=2*Math.PI*Fp;function sy(s){return oy*Math.cos(s*Math.PI/180)}function ay(s){return(180+s)/360}function ly(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function cy(s,i){return s/sy(i)}function Op(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Cf{constructor(i,c,f=0){this.x=+i,this.y=+c,this.z=+f}static fromLngLat(i,c=0){const f=ra.convert(i);return new Cf(ay(f.lng),ly(f.lat),cy(c,f.lat))}toLngLat(){return new ra(360*this.x-180,Op(this.y))}toAltitude(){return this.z*sy(Op(this.y))}meterInMercatorCoordinateUnits(){return 1/oy*(i=Op(this.y),1/Math.cos(i*Math.PI/180));var i}}function uy(s,i,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[s*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class Np{constructor(i,c,f){if(i<0||i>25||f<0||f>=Math.pow(2,i)||c<0||c>=Math.pow(2,i))throw new Error(`x=${c}, y=${f}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=c,this.y=f,this.key=zu(0,i,i,c,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,c,f){const g=(w=this.y,T=this.z,I=uy(256*(b=this.x),256*(w=Math.pow(2,T)-w-1),T),L=uy(256*(b+1),256*(w+1),T),I[0]+","+I[1]+","+L[0]+","+L[1]);var b,w,T,I,L;const F=function(j,H,K){let Q,ae="";for(let ge=j;ge>0;ge--)Q=1<<ge-1,ae+=(H&Q?1:0)+(K&Q?2:0);return ae}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,F).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const c=this.z-i.z;return c>0&&i.x===this.x>>c&&i.y===this.y>>c}getTilePoint(i){const c=Math.pow(2,this.z);return new S((i.x*c-this.x)*yn,(i.y*c-this.y)*yn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class hy{constructor(i,c){this.wrap=i,this.canonical=c,this.key=zu(i,c.z,c.z,c.x,c.y)}}class lo{constructor(i,c,f,g,b){if(i<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${f}`);this.overscaledZ=i,this.wrap=c,this.canonical=new Np(f,+g,+b),this.key=zu(c,i,f,g,b)}clone(){return new lo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-i;return i>this.canonical.z?new lo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new lo(i,this.wrap,i,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(i,c){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-i;return i>this.canonical.z?zu(this.wrap*+c,i,this.canonical.z,this.canonical.x,this.canonical.y):zu(this.wrap*+c,i,i,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const c=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>c&&i.canonical.y===this.canonical.y>>c}children(i){if(this.overscaledZ>=i)return[new lo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new lo(c,this.wrap,c,f,g),new lo(c,this.wrap,c,f+1,g),new lo(c,this.wrap,c,f,g+1),new lo(c,this.wrap,c,f+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new lo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new lo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new hy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Cf(i.x-this.wrap,i.y))}}function zu(s,i,c,f,g){(s*=2)<0&&(s=-1*s-1);const b=1<<c;return(b*b*s+b*g+f).toString(36)+c.toString(36)+i.toString(36)}Ct("CanonicalTileID",Np),Ct("OverscaledTileID",lo,{omit:["posMatrix"]});class fy{constructor(i,c,f,g=1,b=1,w=1,T=0){if(this.uid=i,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void He(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const I=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=b,this.blueFactor=w,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let L=0;L<I;L++)this.data[this._idx(-1,L)]=this.data[this._idx(0,L)],this.data[this._idx(I,L)]=this.data[this._idx(I-1,L)],this.data[this._idx(L,-1)]=this.data[this._idx(L,0)],this.data[this._idx(L,I)]=this.data[this._idx(L,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let L=0;L<I;L++)for(let F=0;F<I;F++){const j=this.get(L,F);j>this.max&&(this.max=j),j<this.min&&(this.min=j)}}get(i,c){const f=new Uint8Array(this.data.buffer),g=4*this._idx(i,c);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,c){if(i<-1||i>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(i+1)}unpack(i,c,f){return i*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new ao({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,c,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,b=c*this.dim+this.dim,w=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:g=b-1;break;case 1:b=g+1}switch(f){case-1:w=T-1;break;case 1:T=w+1}const I=-c*this.dim,L=-f*this.dim;for(let F=w;F<T;F++)for(let j=g;j<b;j++)this.data[this._idx(j,F)]=i.data[this._idx(j+I,F+L)]}}Ct("DEMData",fy);class dy{constructor(i){this._stringToNumber={},this._numberToString=[];for(let c=0;c<i.length;c++){const f=i[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class py{constructor(i,c,f,g,b){this.type="Feature",this._vectorTileFeature=i,i._z=c,i._x=f,i._y=g,this.properties=i.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(i[c]=this[c]);return i}}class my{constructor(i,c){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Fa(yn,16,0),this.grid3D=new Fa(yn,16,0),this.featureIndexArray=new V,this.promoteId=c}insert(i,c,f,g,b,w){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,b);const I=w?this.grid3D:this.grid;for(let L=0;L<c.length;L++){const F=c[L],j=[1/0,1/0,-1/0,-1/0];for(let H=0;H<F.length;H++){const K=F[H];j[0]=Math.min(j[0],K.x),j[1]=Math.min(j[1],K.y),j[2]=Math.max(j[2],K.x),j[3]=Math.max(j[3],K.y)}j[0]<yn&&j[1]<yn&&j[2]>=0&&j[3]>=0&&I.insert(T,j[0],j[1],j[2],j[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Qs.VectorTile(new Mp(this.rawTileData)).layers,this.sourceLayerCoder=new dy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,c,f,g){this.loadVTLayers();const b=i.params||{},w=yn/i.tileSize/i.scale,T=Cl(b.filter),I=i.queryGeometry,L=i.queryPadding*w,F=_y(I),j=this.grid.query(F.minX-L,F.minY-L,F.maxX+L,F.maxY+L),H=_y(i.cameraQueryGeometry),K=this.grid3D.query(H.minX-L,H.minY-L,H.maxX+L,H.maxY+L,(ge,xe,Re,ke)=>function(Ae,Ye,Qe,Tt,Dt){for(const vt of Ae)if(Ye<=vt.x&&Qe<=vt.y&&Tt>=vt.x&&Dt>=vt.y)return!0;const kt=[new S(Ye,Qe),new S(Ye,Dt),new S(Tt,Dt),new S(Tt,Qe)];if(Ae.length>2){for(const vt of kt)if($l(Ae,vt))return!0}for(let vt=0;vt<Ae.length-1;vt++)if(Wx(Ae[vt],Ae[vt+1],kt))return!0;return!1}(i.cameraQueryGeometry,ge-L,xe-L,Re+L,ke+L));for(const ge of K)j.push(ge);j.sort(pS);const Q={};let ae;for(let ge=0;ge<j.length;ge++){const xe=j[ge];if(xe===ae)continue;ae=xe;const Re=this.featureIndexArray.get(xe);let ke=null;this.loadMatchingFeature(Q,Re.bucketIndex,Re.sourceLayerIndex,Re.featureIndex,T,b.layers,b.availableImages,c,f,g,(Ae,Ye,Qe)=>(ke||(ke=ws(Ae)),Ye.queryIntersectsFeature(I,Ae,Qe,ke,this.z,i.transform,w,i.pixelPosMatrix)))}return Q}loadMatchingFeature(i,c,f,g,b,w,T,I,L,F,j){const H=this.bucketLayerIDs[c];if(w&&!function(ge,xe){for(let Re=0;Re<ge.length;Re++)if(xe.indexOf(ge[Re])>=0)return!0;return!1}(w,H))return;const K=this.sourceLayerCoder.decode(f),Q=this.vtLayers[K].feature(g);if(b.needGeometry){const ge=xs(Q,!0);if(!b.filter(new Qr(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!b.filter(new Qr(this.tileID.overscaledZ),Q))return;const ae=this.getId(Q,K);for(let ge=0;ge<H.length;ge++){const xe=H[ge];if(w&&w.indexOf(xe)<0)continue;const Re=I[xe];if(!Re)continue;let ke={};ae&&F&&(ke=F.getState(Re.sourceLayer||"_geojsonTileLayer",ae));const Ae=$({},L[xe]);Ae.paint=gy(Ae.paint,Re.paint,Q,ke,T),Ae.layout=gy(Ae.layout,Re.layout,Q,ke,T);const Ye=!j||j(Q,Re,ke);if(!Ye)continue;const Qe=new py(Q,this.z,this.x,this.y,ae);Qe.layer=Ae;let Tt=i[xe];Tt===void 0&&(Tt=i[xe]=[]),Tt.push({featureIndex:g,feature:Qe,intersectionZ:Ye})}}lookupSymbolFeatures(i,c,f,g,b,w,T,I){const L={};this.loadVTLayers();const F=Cl(b);for(const j of i)this.loadMatchingFeature(L,f,g,j,F,w,T,I,c);return L}hasLayer(i){for(const c of this.bucketLayerIDs)for(const f of c)if(i===f)return!0;return!1}getId(i,c){let f=i.id;return this.promoteId&&(f=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function gy(s,i,c,f,g){return _e(s,(b,w)=>{const T=i instanceof Na?i.get(w):null;return T&&T.evaluate?T.evaluate(c,f,g):T})}function _y(s){let i=1/0,c=1/0,f=-1/0,g=-1/0;for(const b of s)i=Math.min(i,b.x),c=Math.min(c,b.y),f=Math.max(f,b.x),g=Math.max(g,b.y);return{minX:i,minY:c,maxX:f,maxY:g}}function pS(s,i){return i-s}function yy(s,i,c,f,g){const b=[];for(let w=0;w<s.length;w++){const T=s[w];let I;for(let L=0;L<T.length-1;L++){let F=T[L],j=T[L+1];F.x<i&&j.x<i||(F.x<i?F=new S(i,F.y+(i-F.x)/(j.x-F.x)*(j.y-F.y))._round():j.x<i&&(j=new S(i,F.y+(i-F.x)/(j.x-F.x)*(j.y-F.y))._round()),F.y<c&&j.y<c||(F.y<c?F=new S(F.x+(c-F.y)/(j.y-F.y)*(j.x-F.x),c)._round():j.y<c&&(j=new S(F.x+(c-F.y)/(j.y-F.y)*(j.x-F.x),c)._round()),F.x>=f&&j.x>=f||(F.x>=f?F=new S(f,F.y+(f-F.x)/(j.x-F.x)*(j.y-F.y))._round():j.x>=f&&(j=new S(f,F.y+(f-F.x)/(j.x-F.x)*(j.y-F.y))._round()),F.y>=g&&j.y>=g||(F.y>=g?F=new S(F.x+(g-F.y)/(j.y-F.y)*(j.x-F.x),g)._round():j.y>=g&&(j=new S(F.x+(g-F.y)/(j.y-F.y)*(j.x-F.x),g)._round()),I&&F.equals(I[I.length-1])||(I=[F],b.push(I)),I.push(j)))))}}return b}Ct("FeatureIndex",my,{omit:["rawTileData","sourceLayerCoder"]});class na extends S{constructor(i,c,f,g){super(i,c),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new na(this.x,this.y,this.angle,this.segment)}}function vy(s,i,c,f,g){if(i.segment===void 0||c===0)return!0;let b=i,w=i.segment+1,T=0;for(;T>-c/2;){if(w--,w<0)return!1;T-=s[w].dist(b),b=s[w]}T+=s[w].dist(s[w+1]),w++;const I=[];let L=0;for(;T<c/2;){const F=s[w],j=s[w+1];if(!j)return!1;let H=s[w-1].angleTo(F)-F.angleTo(j);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:H}),L+=H;T-I[0].distance>f;)L-=I.shift().angleDelta;if(L>g)return!1;w++,T+=F.dist(j)}return!0}function by(s){let i=0;for(let c=0;c<s.length-1;c++)i+=s[c].dist(s[c+1]);return i}function wy(s,i,c){return s?.6*i*c:0}function xy(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function mS(s,i,c,f,g,b){const w=wy(c,g,b),T=xy(c,f)*b;let I=0;const L=by(s)/2;for(let F=0;F<s.length-1;F++){const j=s[F],H=s[F+1],K=j.dist(H);if(I+K>L){const Q=(L-I)/K,ae=di.number(j.x,H.x,Q),ge=di.number(j.y,H.y,Q),xe=new na(ae,ge,H.angleTo(j),F);return xe._round(),!w||vy(s,xe,T,w,i)?xe:void 0}I+=K}}function gS(s,i,c,f,g,b,w,T,I){const L=wy(f,b,w),F=xy(f,g),j=F*w,H=s[0].x===0||s[0].x===I||s[0].y===0||s[0].y===I;return i-j<i/4&&(i=j+i/4),Sy(s,H?i/2*T%i:(F/2+2*b)*w*T%i,i,L,c,j,H,!1,I)}function Sy(s,i,c,f,g,b,w,T,I){const L=b/2,F=by(s);let j=0,H=i-c,K=[];for(let Q=0;Q<s.length-1;Q++){const ae=s[Q],ge=s[Q+1],xe=ae.dist(ge),Re=ge.angleTo(ae);for(;H+c<j+xe;){H+=c;const ke=(H-j)/xe,Ae=di.number(ae.x,ge.x,ke),Ye=di.number(ae.y,ge.y,ke);if(Ae>=0&&Ae<I&&Ye>=0&&Ye<I&&H-L>=0&&H+L<=F){const Qe=new na(Ae,Ye,Re,Q);Qe._round(),f&&!vy(s,Qe,b,f,g)||K.push(Qe)}}j+=xe}return T||K.length||w||(K=Sy(s,j/2,c,f,g,b,w,!0,I)),K}Ct("Anchor",na);const rc=ji;function ky(s,i,c,f){const g=[],b=s.image,w=b.pixelRatio,T=b.paddedRect.w-2*rc,I=b.paddedRect.h-2*rc,L=s.right-s.left,F=s.bottom-s.top,j=b.stretchX||[[0,T]],H=b.stretchY||[[0,I]],K=(dt,Lt)=>dt+Lt[1]-Lt[0],Q=j.reduce(K,0),ae=H.reduce(K,0),ge=T-Q,xe=I-ae;let Re=0,ke=Q,Ae=0,Ye=ae,Qe=0,Tt=ge,Dt=0,kt=xe;if(b.content&&f){const dt=b.content;Re=If(j,0,dt[0]),Ae=If(H,0,dt[1]),ke=If(j,dt[0],dt[2]),Ye=If(H,dt[1],dt[3]),Qe=dt[0]-Re,Dt=dt[1]-Ae,Tt=dt[2]-dt[0]-ke,kt=dt[3]-dt[1]-Ye}const vt=(dt,Lt,_t,ot)=>{const qt=Af(dt.stretch-Re,ke,L,s.left),Bt=Lf(dt.fixed-Qe,Tt,dt.stretch,Q),pr=Af(Lt.stretch-Ae,Ye,F,s.top),Xr=Lf(Lt.fixed-Dt,kt,Lt.stretch,ae),tn=Af(_t.stretch-Re,ke,L,s.left),jn=Lf(_t.fixed-Qe,Tt,_t.stretch,Q),Yi=Af(ot.stretch-Ae,Ye,F,s.top),Ti=Lf(ot.fixed-Dt,kt,ot.stretch,ae),zn=new S(qt,pr),Yn=new S(tn,pr),ai=new S(tn,Yi),Ei=new S(qt,Yi),Mi=new S(Bt/w,Xr/w),Un=new S(jn/w,Ti/w),Vn=i*Math.PI/180;if(Vn){const gi=Math.sin(Vn),Ui=Math.cos(Vn),Vi=[Ui,-gi,gi,Ui];zn._matMult(Vi),Yn._matMult(Vi),Ei._matMult(Vi),ai._matMult(Vi)}const mi=dt.stretch+dt.fixed,Ci=Lt.stretch+Lt.fixed;return{tl:zn,tr:Yn,bl:Ei,br:ai,tex:{x:b.paddedRect.x+rc+mi,y:b.paddedRect.y+rc+Ci,w:_t.stretch+_t.fixed-mi,h:ot.stretch+ot.fixed-Ci},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mi,pixelOffsetBR:Un,minFontScaleX:Tt/w/L,minFontScaleY:kt/w/F,isSDF:c}};if(f&&(b.stretchX||b.stretchY)){const dt=Ty(j,ge,Q),Lt=Ty(H,xe,ae);for(let _t=0;_t<dt.length-1;_t++){const ot=dt[_t],qt=dt[_t+1];for(let Bt=0;Bt<Lt.length-1;Bt++)g.push(vt(ot,Lt[Bt],qt,Lt[Bt+1]))}}else g.push(vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return g}function If(s,i,c){let f=0;for(const g of s)f+=Math.max(i,Math.min(c,g[1]))-Math.max(i,Math.min(c,g[0]));return f}function Ty(s,i,c){const f=[{fixed:-rc,stretch:0}];for(const[g,b]of s){const w=f[f.length-1];f.push({fixed:g-w.stretch,stretch:w.stretch}),f.push({fixed:g-w.stretch,stretch:w.stretch+(b-g)})}return f.push({fixed:i+rc,stretch:c}),f}function Af(s,i,c,f){return s/i*c+f}function Lf(s,i,c,f){return s-i*c/f}class Pf{constructor(i,c,f,g,b,w,T,I,L,F){if(this.boxStartIndex=i.length,L){let j=w.top,H=w.bottom;const K=w.collisionPadding;K&&(j-=K[1],H+=K[3]);let Q=H-j;Q>0&&(Q=Math.max(10,Q),this.circleDiameter=Q)}else{let j=w.top*T-I[0],H=w.bottom*T+I[2],K=w.left*T-I[3],Q=w.right*T+I[1];const ae=w.collisionPadding;if(ae&&(K-=ae[0]*T,j-=ae[1]*T,Q+=ae[2]*T,H+=ae[3]*T),F){const ge=new S(K,j),xe=new S(Q,j),Re=new S(K,H),ke=new S(Q,H),Ae=F*Math.PI/180;ge._rotate(Ae),xe._rotate(Ae),Re._rotate(Ae),ke._rotate(Ae),K=Math.min(ge.x,xe.x,Re.x,ke.x),Q=Math.max(ge.x,xe.x,Re.x,ke.x),j=Math.min(ge.y,xe.y,Re.y,ke.y),H=Math.max(ge.y,xe.y,Re.y,ke.y)}i.emplaceBack(c.x,c.y,K,j,Q,H,f,g,b)}this.boxEndIndex=i.length}}class _S{constructor(i=[],c=yS){if(this.data=i,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:c,compare:f}=this,g=c[i];for(;i>0;){const b=i-1>>1,w=c[b];if(f(g,w)>=0)break;c[i]=w,i=b}c[i]=g}_down(i){const{data:c,compare:f}=this,g=this.length>>1,b=c[i];for(;i<g;){let w=1+(i<<1),T=c[w];const I=w+1;if(I<this.length&&f(c[I],T)<0&&(w=I,T=c[I]),f(T,b)>=0)break;c[i]=T,i=w}c[i]=b}}function yS(s,i){return s<i?-1:s>i?1:0}function vS(s,i=1,c=!1){let f=1/0,g=1/0,b=-1/0,w=-1/0;const T=s[0];for(let K=0;K<T.length;K++){const Q=T[K];(!K||Q.x<f)&&(f=Q.x),(!K||Q.y<g)&&(g=Q.y),(!K||Q.x>b)&&(b=Q.x),(!K||Q.y>w)&&(w=Q.y)}const I=Math.min(b-f,w-g);let L=I/2;const F=new _S([],bS);if(I===0)return new S(f,g);for(let K=f;K<b;K+=I)for(let Q=g;Q<w;Q+=I)F.push(new nc(K+L,Q+L,L,s));let j=function(K){let Q=0,ae=0,ge=0;const xe=K[0];for(let Re=0,ke=xe.length,Ae=ke-1;Re<ke;Ae=Re++){const Ye=xe[Re],Qe=xe[Ae],Tt=Ye.x*Qe.y-Qe.x*Ye.y;ae+=(Ye.x+Qe.x)*Tt,ge+=(Ye.y+Qe.y)*Tt,Q+=3*Tt}return new nc(ae/Q,ge/Q,0,K)}(s),H=F.length;for(;F.length;){const K=F.pop();(K.d>j.d||!j.d)&&(j=K,c&&console.log("found best %d after %d probes",Math.round(1e4*K.d)/1e4,H)),K.max-j.d<=i||(L=K.h/2,F.push(new nc(K.p.x-L,K.p.y-L,L,s)),F.push(new nc(K.p.x+L,K.p.y-L,L,s)),F.push(new nc(K.p.x-L,K.p.y+L,L,s)),F.push(new nc(K.p.x+L,K.p.y+L,L,s)),H+=4)}return c&&(console.log(`num probes: ${H}`),console.log(`best distance: ${j.d}`)),j.p}function bS(s,i){return i.max-s.max}function nc(s,i,c,f){this.p=new S(s,i),this.h=c,this.d=function(g,b){let w=!1,T=1/0;for(let I=0;I<b.length;I++){const L=b[I];for(let F=0,j=L.length,H=j-1;F<j;H=F++){const K=L[F],Q=L[H];K.y>g.y!=Q.y>g.y&&g.x<(Q.x-K.x)*(g.y-K.y)/(Q.y-K.y)+K.x&&(w=!w),T=Math.min(T,l_(g,K,Q))}}return(w?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var si;d.ap=void 0,(si=d.ap||(d.ap={}))[si.center=1]="center",si[si.left=2]="left",si[si.right=3]="right",si[si.top=4]="top",si[si.bottom=5]="bottom",si[si["top-left"]=6]="top-left",si[si["top-right"]=7]="top-right",si[si["bottom-left"]=8]="bottom-left",si[si["bottom-right"]=9]="bottom-right";const ia=7,jp=Number.POSITIVE_INFINITY;function Ey(s,i){return i[1]!==jp?function(c,f,g){let b=0,w=0;switch(f=Math.abs(f),g=Math.abs(g),c){case"top-right":case"top-left":case"top":w=g-ia;break;case"bottom-right":case"bottom-left":case"bottom":w=-g+ia}switch(c){case"top-right":case"bottom-right":case"right":b=-f;break;case"top-left":case"bottom-left":case"left":b=f}return[b,w]}(s,i[0],i[1]):function(c,f){let g=0,b=0;f<0&&(f=0);const w=f/Math.SQRT2;switch(c){case"top-right":case"top-left":b=w-ia;break;case"bottom-right":case"bottom-left":b=-w+ia;break;case"bottom":b=-f+ia;break;case"top":b=f-ia}switch(c){case"top-right":case"bottom-right":g=-w;break;case"top-left":case"bottom-left":g=w;break;case"left":g=f;break;case"right":g=-f}return[g,b]}(s,i[0])}function My(s,i,c){var f;const g=s.layout,b=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(i,{},c);if(b){const T=b.values,I=[];for(let L=0;L<T.length;L+=2){const F=I[L]=T[L],j=T[L+1].map(H=>H*Nn);F.startsWith("top")?j[1]-=ia:F.startsWith("bottom")&&(j[1]+=ia),I[L+1]=j}return new $i(I)}const w=g.get("text-variable-anchor");if(w){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},c)*Nn,jp]:g.get("text-offset").evaluate(i,{},c).map(L=>L*Nn);const I=[];for(const L of w)I.push(L,Ey(L,T));return new $i(I)}return null}function Up(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function wS(s,i,c,f,g,b,w,T,I,L,F){let j=b.textMaxSize.evaluate(i,{});j===void 0&&(j=w);const H=s.layers[0].layout,K=H.get("icon-offset").evaluate(i,{},F),Q=Iy(c.horizontal),ae=w/24,ge=s.tilePixelRatio*ae,xe=s.tilePixelRatio*j/24,Re=s.tilePixelRatio*T,ke=s.tilePixelRatio*H.get("symbol-spacing"),Ae=H.get("text-padding")*s.tilePixelRatio,Ye=function(ot,qt,Bt,pr=1){const Xr=ot.get("icon-padding").evaluate(qt,{},Bt),tn=Xr&&Xr.values;return[tn[0]*pr,tn[1]*pr,tn[2]*pr,tn[3]*pr]}(H,i,F,s.tilePixelRatio),Qe=H.get("text-max-angle")/180*Math.PI,Tt=H.get("text-rotation-alignment")!=="viewport"&&H.get("symbol-placement")!=="point",Dt=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",kt=H.get("symbol-placement"),vt=ke/2,dt=H.get("icon-text-fit");let Lt;f&&dt!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(Lt=Y_(f,c.vertical,dt,H.get("icon-text-fit-padding"),K,ae)),Q&&(f=Y_(f,Q,dt,H.get("icon-text-fit-padding"),K,ae)));const _t=(ot,qt)=>{qt.x<0||qt.x>=yn||qt.y<0||qt.y>=yn||function(Bt,pr,Xr,tn,jn,Yi,Ti,zn,Yn,ai,Ei,Mi,Un,Vn,mi,Ci,gi,Ui,Vi,qn,yr,_i,li,Gn,xo){const No=Bt.addToLineVertexArray(pr,Xr);let jo,ks,So,co,qi=0,Ts=0,Bu=0,zy=0,Xp=-1,Kp=-1;const Es={};let Dy=hn("");if(Bt.allowVerticalPlacement&&tn.vertical){const yi=zn.layout.get("text-rotate").evaluate(yr,{},Gn)+90;So=new Pf(Yn,pr,ai,Ei,Mi,tn.vertical,Un,Vn,mi,yi),Ti&&(co=new Pf(Yn,pr,ai,Ei,Mi,Ti,gi,Ui,mi,yi))}if(jn){const yi=zn.layout.get("icon-rotate").evaluate(yr,{}),uo=zn.layout.get("icon-text-fit")!=="none",$a=ky(jn,yi,li,uo),Vo=Ti?ky(Ti,yi,li,uo):void 0;ks=new Pf(Yn,pr,ai,Ei,Mi,jn,gi,Ui,!1,yi),qi=4*$a.length;const Xa=Bt.iconSizeData;let os=null;Xa.kind==="source"?(os=[is*zn.layout.get("icon-size").evaluate(yr,{})],os[0]>ta&&He(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Pu}. Reduce your "icon-size".`)):Xa.kind==="composite"&&(os=[is*_i.compositeIconSizes[0].evaluate(yr,{},Gn),is*_i.compositeIconSizes[1].evaluate(yr,{},Gn)],(os[0]>ta||os[1]>ta)&&He(`${Bt.layerIds[0]}: Value for "icon-size" is >= ${Pu}. Reduce your "icon-size".`)),Bt.addSymbols(Bt.icon,$a,os,qn,Vi,yr,d.ah.none,pr,No.lineStartIndex,No.lineLength,-1,Gn),Xp=Bt.icon.placedSymbolArray.length-1,Vo&&(Ts=4*Vo.length,Bt.addSymbols(Bt.icon,Vo,os,qn,Vi,yr,d.ah.vertical,pr,No.lineStartIndex,No.lineLength,-1,Gn),Kp=Bt.icon.placedSymbolArray.length-1)}const Ry=Object.keys(tn.horizontal);for(const yi of Ry){const uo=tn.horizontal[yi];if(!jo){Dy=hn(uo.text);const Vo=zn.layout.get("text-rotate").evaluate(yr,{},Gn);jo=new Pf(Yn,pr,ai,Ei,Mi,uo,Un,Vn,mi,Vo)}const $a=uo.positionedLines.length===1;if(Bu+=Cy(Bt,pr,uo,Yi,zn,mi,yr,Ci,No,tn.vertical?d.ah.horizontal:d.ah.horizontalOnly,$a?Ry:[yi],Es,Xp,_i,Gn),$a)break}tn.vertical&&(zy+=Cy(Bt,pr,tn.vertical,Yi,zn,mi,yr,Ci,No,d.ah.vertical,["vertical"],Es,Kp,_i,Gn));const kS=jo?jo.boxStartIndex:Bt.collisionBoxArray.length,TS=jo?jo.boxEndIndex:Bt.collisionBoxArray.length,ES=So?So.boxStartIndex:Bt.collisionBoxArray.length,MS=So?So.boxEndIndex:Bt.collisionBoxArray.length,CS=ks?ks.boxStartIndex:Bt.collisionBoxArray.length,IS=ks?ks.boxEndIndex:Bt.collisionBoxArray.length,AS=co?co.boxStartIndex:Bt.collisionBoxArray.length,LS=co?co.boxEndIndex:Bt.collisionBoxArray.length;let Uo=-1;const Df=(yi,uo)=>yi&&yi.circleDiameter?Math.max(yi.circleDiameter,uo):uo;Uo=Df(jo,Uo),Uo=Df(So,Uo),Uo=Df(ks,Uo),Uo=Df(co,Uo);const By=Uo>-1?1:0;By&&(Uo*=xo/Nn),Bt.glyphOffsetArray.length>=tc.MAX_GLYPHS&&He("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yr.sortKey!==void 0&&Bt.addToSortKeyRanges(Bt.symbolInstances.length,yr.sortKey);const PS=My(zn,yr,Gn),[zS,DS]=function(yi,uo){const $a=yi.length,Vo=uo==null?void 0:uo.values;if((Vo==null?void 0:Vo.length)>0)for(let Xa=0;Xa<Vo.length;Xa+=2){const os=Vo[Xa+1];yi.emplaceBack(d.ap[Vo[Xa]],os[0],os[1])}return[$a,yi.length]}(Bt.textAnchorOffsets,PS);Bt.symbolInstances.emplaceBack(pr.x,pr.y,Es.right>=0?Es.right:-1,Es.center>=0?Es.center:-1,Es.left>=0?Es.left:-1,Es.vertical||-1,Xp,Kp,Dy,kS,TS,ES,MS,CS,IS,AS,LS,ai,Bu,zy,qi,Ts,By,0,Un,Uo,zS,DS)}(s,qt,ot,c,f,g,Lt,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,ge,[Ae,Ae,Ae,Ae],Tt,I,Re,Ye,Dt,K,i,b,L,F,w)};if(kt==="line")for(const ot of yy(i.geometry,0,0,yn,yn)){const qt=gS(ot,ke,Qe,c.vertical||Q,f,24,xe,s.overscaling,yn);for(const Bt of qt)Q&&xS(s,Q.text,vt,Bt)||_t(ot,Bt)}else if(kt==="line-center"){for(const ot of i.geometry)if(ot.length>1){const qt=mS(ot,Qe,c.vertical||Q,f,24,xe);qt&&_t(ot,qt)}}else if(i.type==="Polygon")for(const ot of vp(i.geometry,0)){const qt=vS(ot,16);_t(ot[0],new na(qt.x,qt.y,0))}else if(i.type==="LineString")for(const ot of i.geometry)_t(ot,new na(ot[0].x,ot[0].y,0));else if(i.type==="Point")for(const ot of i.geometry)for(const qt of ot)_t([qt],new na(qt.x,qt.y,0))}function Cy(s,i,c,f,g,b,w,T,I,L,F,j,H,K,Q){const ae=function(Re,ke,Ae,Ye,Qe,Tt,Dt,kt){const vt=Ye.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,dt=[];for(const Lt of ke.positionedLines)for(const _t of Lt.positionedGlyphs){if(!_t.rect)continue;const ot=_t.rect||{};let qt=W_+1,Bt=!0,pr=1,Xr=0;const tn=(Qe||kt)&&_t.vertical,jn=_t.metrics.advance*_t.scale/2;if(kt&&ke.verticalizable&&(Xr=Lt.lineOffset/2-(_t.imageName?-(Nn-_t.metrics.width*_t.scale)/2:(_t.scale-1)*Nn)),_t.imageName){const qn=Dt[_t.imageName];Bt=qn.sdf,pr=qn.pixelRatio,qt=ji/pr}const Yi=Qe?[_t.x+jn,_t.y]:[0,0];let Ti=Qe?[0,0]:[_t.x+jn+Ae[0],_t.y+Ae[1]-Xr],zn=[0,0];tn&&(zn=Ti,Ti=[0,0]);const Yn=_t.metrics.isDoubleResolution?2:1,ai=(_t.metrics.left-qt)*_t.scale-jn+Ti[0],Ei=(-_t.metrics.top-qt)*_t.scale+Ti[1],Mi=ai+ot.w/Yn*_t.scale/pr,Un=Ei+ot.h/Yn*_t.scale/pr,Vn=new S(ai,Ei),mi=new S(Mi,Ei),Ci=new S(ai,Un),gi=new S(Mi,Un);if(tn){const qn=new S(-jn,jn-Au),yr=-Math.PI/2,_i=Nn/2-jn,li=new S(5-Au-_i,-(_t.imageName?_i:0)),Gn=new S(...zn);Vn._rotateAround(yr,qn)._add(li)._add(Gn),mi._rotateAround(yr,qn)._add(li)._add(Gn),Ci._rotateAround(yr,qn)._add(li)._add(Gn),gi._rotateAround(yr,qn)._add(li)._add(Gn)}if(vt){const qn=Math.sin(vt),yr=Math.cos(vt),_i=[yr,-qn,qn,yr];Vn._matMult(_i),mi._matMult(_i),Ci._matMult(_i),gi._matMult(_i)}const Ui=new S(0,0),Vi=new S(0,0);dt.push({tl:Vn,tr:mi,bl:Ci,br:gi,tex:ot,writingMode:ke.writingMode,glyphOffset:Yi,sectionIndex:_t.sectionIndex,isSDF:Bt,pixelOffsetTL:Ui,pixelOffsetBR:Vi,minFontScaleX:0,minFontScaleY:0})}return dt}(0,c,T,g,b,w,f,s.allowVerticalPlacement),ge=s.textSizeData;let xe=null;ge.kind==="source"?(xe=[is*g.layout.get("text-size").evaluate(w,{})],xe[0]>ta&&He(`${s.layerIds[0]}: Value for "text-size" is >= ${Pu}. Reduce your "text-size".`)):ge.kind==="composite"&&(xe=[is*K.compositeTextSizes[0].evaluate(w,{},Q),is*K.compositeTextSizes[1].evaluate(w,{},Q)],(xe[0]>ta||xe[1]>ta)&&He(`${s.layerIds[0]}: Value for "text-size" is >= ${Pu}. Reduce your "text-size".`)),s.addSymbols(s.text,ae,xe,T,b,w,L,i,I.lineStartIndex,I.lineLength,H,Q);for(const Re of F)j[Re]=s.text.placedSymbolArray.length-1;return 4*ae.length}function Iy(s){for(const i in s)return s[i];return null}function xS(s,i,c,f){const g=s.compareText;if(i in g){const b=g[i];for(let w=b.length-1;w>=0;w--)if(f.dist(b[w])<c)return!0}else g[i]=[];return g[i].push(f),!1}const Ay=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Vp{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(i,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const b=Ay[15&f];if(!b)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(i,2,1),[T]=new Uint32Array(i,4,1);return new Vp(T,w,b,i)}constructor(i,c=64,f=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const b=Ay.indexOf(this.ArrayType),w=2*i*this.ArrayType.BYTES_PER_ELEMENT,T=i*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+I,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+w+T+I),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+T+I,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=i)}add(i,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=i,this.coords[this._pos++]=c,f}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return qp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,c,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:w,nodeSize:T}=this,I=[0,b.length-1,0],L=[];for(;I.length;){const F=I.pop()||0,j=I.pop()||0,H=I.pop()||0;if(j-H<=T){for(let ge=H;ge<=j;ge++){const xe=w[2*ge],Re=w[2*ge+1];xe>=i&&xe<=f&&Re>=c&&Re<=g&&L.push(b[ge])}continue}const K=H+j>>1,Q=w[2*K],ae=w[2*K+1];Q>=i&&Q<=f&&ae>=c&&ae<=g&&L.push(b[K]),(F===0?i<=Q:c<=ae)&&(I.push(H),I.push(K-1),I.push(1-F)),(F===0?f>=Q:g>=ae)&&(I.push(K+1),I.push(j),I.push(1-F))}return L}within(i,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:b,nodeSize:w}=this,T=[0,g.length-1,0],I=[],L=f*f;for(;T.length;){const F=T.pop()||0,j=T.pop()||0,H=T.pop()||0;if(j-H<=w){for(let ge=H;ge<=j;ge++)Py(b[2*ge],b[2*ge+1],i,c)<=L&&I.push(g[ge]);continue}const K=H+j>>1,Q=b[2*K],ae=b[2*K+1];Py(Q,ae,i,c)<=L&&I.push(g[K]),(F===0?i-f<=Q:c-f<=ae)&&(T.push(H),T.push(K-1),T.push(1-F)),(F===0?i+f>=Q:c+f>=ae)&&(T.push(K+1),T.push(j),T.push(1-F))}return I}}function qp(s,i,c,f,g,b){if(g-f<=c)return;const w=f+g>>1;Ly(s,i,w,f,g,b),qp(s,i,c,f,w-1,1-b),qp(s,i,c,w+1,g,1-b)}function Ly(s,i,c,f,g,b){for(;g>f;){if(g-f>600){const L=g-f+1,F=c-f+1,j=Math.log(L),H=.5*Math.exp(2*j/3),K=.5*Math.sqrt(j*H*(L-H)/L)*(F-L/2<0?-1:1);Ly(s,i,c,Math.max(f,Math.floor(c-F*H/L+K)),Math.min(g,Math.floor(c+(L-F)*H/L+K)),b)}const w=i[2*c+b];let T=f,I=g;for(Du(s,i,f,c),i[2*g+b]>w&&Du(s,i,f,g);T<I;){for(Du(s,i,T,I),T++,I--;i[2*T+b]<w;)T++;for(;i[2*I+b]>w;)I--}i[2*f+b]===w?Du(s,i,f,I):(I++,Du(s,i,I,g)),I<=c&&(f=I+1),c<=I&&(g=I-1)}}function Du(s,i,c,f){Gp(s,c,f),Gp(i,2*c,2*f),Gp(i,2*c+1,2*f+1)}function Gp(s,i,c){const f=s[i];s[i]=s[c],s[c]=f}function Py(s,i,c,f){const g=s-c,b=i-f;return g*g+b*b}var Wp;d.bd=void 0,(Wp=d.bd||(d.bd={})).create="create",Wp.load="load",Wp.fullLoad="fullLoad";let zf=null,Ru=[];const Zp=1e3/60,Hp="loadTime",$p="fullLoadTime",SS={mark(s){performance.mark(s)},frame(s){const i=s;zf!=null&&Ru.push(i-zf),zf=i},clearMetrics(){zf=null,Ru=[],performance.clearMeasures(Hp),performance.clearMeasures($p);for(const s in d.bd)performance.clearMarks(d.bd[s])},getPerformanceMetrics(){performance.measure(Hp,d.bd.create,d.bd.load),performance.measure($p,d.bd.create,d.bd.fullLoad);const s=performance.getEntriesByName(Hp)[0].duration,i=performance.getEntriesByName($p)[0].duration,c=Ru.length,f=1/(Ru.reduce((b,w)=>b+w,0)/c/1e3),g=Ru.filter(b=>b>Zp).reduce((b,w)=>b+(w-Zp)/Zp,0);return{loadTime:s,fullLoadTime:i,fps:f,percentDroppedFrames:g/(c+g)*100,totalFrames:c}}};d.$=mt,d.A=Xl,d.B=function(s){if(Nt==null){const i=s.navigator?s.navigator.userAgent:null;Nt=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Nt},d.C=class{constructor(s,i){this.target=s,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new dS(()=>this.process()),this.subscription=function(c,f,g,b){return c.addEventListener(f,g,!1),{unsubscribe:()=>{c.removeEventListener(f,g,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=At(self)?s:window}registerMessageHandler(s,i){this.messageHandlers[s]=i}sendAsync(s,i){return new Promise((c,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:c,reject:f},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const b=[],w=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Xs(s.data,b)});this.target.postMessage(w,{transfer:b})})}receive(s){const i=s.data,c=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(At(self)||i.mustQueue)return this.tasks[c]=i,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,i)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){return a(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(i.error?g.reject(Ks(i.error)):g.resolve(Ks(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Ks(i.data),f=new AbortController;this.abortControllers[s]=f;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,c,f);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,i,c){const f=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Xs(i):null,data:Xs(c,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.D=Ft,d.E=xt,d.F=function(){var s=new Xl(16);return Xl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},d.G=rr,d.H=function(s,i,c){var f,g,b,w,T,I,L,F,j,H,K,Q,ae=c[0],ge=c[1],xe=c[2];return i===s?(s[12]=i[0]*ae+i[4]*ge+i[8]*xe+i[12],s[13]=i[1]*ae+i[5]*ge+i[9]*xe+i[13],s[14]=i[2]*ae+i[6]*ge+i[10]*xe+i[14],s[15]=i[3]*ae+i[7]*ge+i[11]*xe+i[15]):(g=i[1],b=i[2],w=i[3],T=i[4],I=i[5],L=i[6],F=i[7],j=i[8],H=i[9],K=i[10],Q=i[11],s[0]=f=i[0],s[1]=g,s[2]=b,s[3]=w,s[4]=T,s[5]=I,s[6]=L,s[7]=F,s[8]=j,s[9]=H,s[10]=K,s[11]=Q,s[12]=f*ae+T*ge+j*xe+i[12],s[13]=g*ae+I*ge+H*xe+i[13],s[14]=b*ae+L*ge+K*xe+i[14],s[15]=w*ae+F*ge+Q*xe+i[15]),s},d.I=Ip,d.J=function(s,i,c){var f=c[0],g=c[1],b=c[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*g,s[5]=i[5]*g,s[6]=i[6]*g,s[7]=i[7]*g,s[8]=i[8]*b,s[9]=i[9]*b,s[10]=i[10]*b,s[11]=i[11]*b,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},d.K=f_,d.L=function(s,i){const c={};for(let f=0;f<i.length;f++){const g=i[f];g in s&&(c[g]=s[g])}return c},d.M=ra,d.N=ay,d.O=ly,d.P=S,d.Q=lo,d.R=ao,d.S=B,d.T=ou,d.U=N,d.V=Kt,d.W=yn,d.X=kn,d.Y=Cf,d.Z=class extends lu{},d._=a,d.a=gr,d.a$=function(s,i,c){return s[0]=i[0]*c[0],s[1]=i[1]*c[1],s[2]=i[2]*c[2],s[3]=i[3]*c[3],s},d.a0=Np,d.a1=st,d.a2=s=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(c=>{i.onloadstart=()=>{c(i)};for(const f of s){const g=window.document.createElement("source");ht(f)||(i.crossOrigin="Anonymous"),g.src=f,i.appendChild(g)}})},d.a3=function(){return J++},d.a4=y,d.a5=tc,d.a6=Cl,d.a7=xs,d.a8=Qr,d.a9=py,d.aA=re,d.aB=function(s,i){if(!s)return[{command:"setStyle",args:[i]}];let c=[];try{if(!Ze(s.version,i.version))return[{command:"setStyle",args:[i]}];Ze(s.center,i.center)||c.push({command:"setCenter",args:[i.center]}),Ze(s.zoom,i.zoom)||c.push({command:"setZoom",args:[i.zoom]}),Ze(s.bearing,i.bearing)||c.push({command:"setBearing",args:[i.bearing]}),Ze(s.pitch,i.pitch)||c.push({command:"setPitch",args:[i.pitch]}),Ze(s.sprite,i.sprite)||c.push({command:"setSprite",args:[i.sprite]}),Ze(s.glyphs,i.glyphs)||c.push({command:"setGlyphs",args:[i.glyphs]}),Ze(s.transition,i.transition)||c.push({command:"setTransition",args:[i.transition]}),Ze(s.light,i.light)||c.push({command:"setLight",args:[i.light]}),Ze(s.terrain,i.terrain)||c.push({command:"setTerrain",args:[i.terrain]}),Ze(s.sky,i.sky)||c.push({command:"setSky",args:[i.sky]});const f={},g=[];(function(w,T,I,L){let F;for(F in T=T||{},w=w||{})Object.prototype.hasOwnProperty.call(w,F)&&(Object.prototype.hasOwnProperty.call(T,F)||wn(F,I,L));for(F in T)Object.prototype.hasOwnProperty.call(T,F)&&(Object.prototype.hasOwnProperty.call(w,F)?Ze(w[F],T[F])||(w[F].type==="geojson"&&T[F].type==="geojson"&&ni(w,T,F)?bt(I,{command:"setGeoJSONSourceData",args:[F,T[F].data]}):Mn(F,T,I,L)):bn(F,T,I))})(s.sources,i.sources,g,f);const b=[];s.layers&&s.layers.forEach(w=>{"source"in w&&f[w.source]?c.push({command:"removeLayer",args:[w.id]}):b.push(w)}),c=c.concat(g),function(w,T,I){T=T||[];const L=(w=w||[]).map($o),F=T.map($o),j=w.reduce(Jr,{}),H=T.reduce(Jr,{}),K=L.slice(),Q=Object.create(null);let ae,ge,xe,Re,ke;for(let Ae=0,Ye=0;Ae<L.length;Ae++)ae=L[Ae],Object.prototype.hasOwnProperty.call(H,ae)?Ye++:(bt(I,{command:"removeLayer",args:[ae]}),K.splice(K.indexOf(ae,Ye),1));for(let Ae=0,Ye=0;Ae<F.length;Ae++)ae=F[F.length-1-Ae],K[K.length-1-Ae]!==ae&&(Object.prototype.hasOwnProperty.call(j,ae)?(bt(I,{command:"removeLayer",args:[ae]}),K.splice(K.lastIndexOf(ae,K.length-Ye),1)):Ye++,Re=K[K.length-Ae],bt(I,{command:"addLayer",args:[H[ae],Re]}),K.splice(K.length-Ae,0,ae),Q[ae]=!0);for(let Ae=0;Ae<F.length;Ae++)if(ae=F[Ae],ge=j[ae],xe=H[ae],!Q[ae]&&!Ze(ge,xe))if(Ze(ge.source,xe.source)&&Ze(ge["source-layer"],xe["source-layer"])&&Ze(ge.type,xe.type)){for(ke in ii(ge.layout,xe.layout,I,ae,null,"setLayoutProperty"),ii(ge.paint,xe.paint,I,ae,null,"setPaintProperty"),Ze(ge.filter,xe.filter)||bt(I,{command:"setFilter",args:[ae,xe.filter]}),Ze(ge.minzoom,xe.minzoom)&&Ze(ge.maxzoom,xe.maxzoom)||bt(I,{command:"setLayerZoomRange",args:[ae,xe.minzoom,xe.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?ii(ge[ke],xe[ke],I,ae,ke.slice(6),"setPaintProperty"):Ze(ge[ke],xe[ke])||bt(I,{command:"setLayerProperty",args:[ae,ke,xe[ke]]}));for(ke in xe)Object.prototype.hasOwnProperty.call(xe,ke)&&!Object.prototype.hasOwnProperty.call(ge,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?ii(ge[ke],xe[ke],I,ae,ke.slice(6),"setPaintProperty"):Ze(ge[ke],xe[ke])||bt(I,{command:"setLayerProperty",args:[ae,ke,xe[ke]]}))}else bt(I,{command:"removeLayer",args:[ae]}),Re=K[K.lastIndexOf(ae)+1],bt(I,{command:"addLayer",args:[xe,Re]})}(b,i.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[i]}]}return c},d.aC=function(s){const i=[],c=s.id;return c===void 0&&i.push({message:`layers.${c}: missing required property "id"`}),s.render===void 0&&i.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&i.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),i},d.aD=function s(i,c){if(Array.isArray(i)){if(!Array.isArray(c)||i.length!==c.length)return!1;for(let f=0;f<i.length;f++)if(!s(i[f],c[f]))return!1;return!0}if(typeof i=="object"&&i!==null&&c!==null){if(typeof c!="object"||Object.keys(i).length!==Object.keys(c).length)return!1;for(const f in i)if(!s(i[f],c[f]))return!1;return!0}return i===c},d.aE=_e,d.aF=ze,d.aG=class extends On{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},d.aH=Ni,d.aI=class extends On{constructor(s,i){super(s,i),this.current=Za}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},d.aJ=bo,d.aK=class extends On{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},d.aL=class extends On{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},d.aM=ts,d.aN=function(s,i,c,f,g,b,w){var T=1/(i-c),I=1/(f-g),L=1/(b-w);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*L,s[11]=0,s[12]=(i+c)*T,s[13]=(g+f)*I,s[14]=(w+b)*L,s[15]=1,s},d.aO=Pr,d.aP=Hx,d.aQ=class extends Ul{},d.aR=U2,d.aS=class extends Vl{},d.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},d.aU=__,d.aV=q,d.aW=class extends pu{},d.aX=Xe,d.aY=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]&&s[4]===i[4]&&s[5]===i[5]&&s[6]===i[6]&&s[7]===i[7]&&s[8]===i[8]&&s[9]===i[9]&&s[10]===i[10]&&s[11]===i[11]&&s[12]===i[12]&&s[13]===i[13]&&s[14]===i[14]&&s[15]===i[15]},d.aZ=function(s,i){var c=s[0],f=s[1],g=s[2],b=s[3],w=s[4],T=s[5],I=s[6],L=s[7],F=s[8],j=s[9],H=s[10],K=s[11],Q=s[12],ae=s[13],ge=s[14],xe=s[15],Re=i[0],ke=i[1],Ae=i[2],Ye=i[3],Qe=i[4],Tt=i[5],Dt=i[6],kt=i[7],vt=i[8],dt=i[9],Lt=i[10],_t=i[11],ot=i[12],qt=i[13],Bt=i[14],pr=i[15];return Math.abs(c-Re)<=ki*Math.max(1,Math.abs(c),Math.abs(Re))&&Math.abs(f-ke)<=ki*Math.max(1,Math.abs(f),Math.abs(ke))&&Math.abs(g-Ae)<=ki*Math.max(1,Math.abs(g),Math.abs(Ae))&&Math.abs(b-Ye)<=ki*Math.max(1,Math.abs(b),Math.abs(Ye))&&Math.abs(w-Qe)<=ki*Math.max(1,Math.abs(w),Math.abs(Qe))&&Math.abs(T-Tt)<=ki*Math.max(1,Math.abs(T),Math.abs(Tt))&&Math.abs(I-Dt)<=ki*Math.max(1,Math.abs(I),Math.abs(Dt))&&Math.abs(L-kt)<=ki*Math.max(1,Math.abs(L),Math.abs(kt))&&Math.abs(F-vt)<=ki*Math.max(1,Math.abs(F),Math.abs(vt))&&Math.abs(j-dt)<=ki*Math.max(1,Math.abs(j),Math.abs(dt))&&Math.abs(H-Lt)<=ki*Math.max(1,Math.abs(H),Math.abs(Lt))&&Math.abs(K-_t)<=ki*Math.max(1,Math.abs(K),Math.abs(_t))&&Math.abs(Q-ot)<=ki*Math.max(1,Math.abs(Q),Math.abs(ot))&&Math.abs(ae-qt)<=ki*Math.max(1,Math.abs(ae),Math.abs(qt))&&Math.abs(ge-Bt)<=ki*Math.max(1,Math.abs(ge),Math.abs(Bt))&&Math.abs(xe-pr)<=ki*Math.max(1,Math.abs(xe),Math.abs(pr))},d.a_=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},d.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,g,b)=>{const w=g||b;return i[f]=!w||w.toLowerCase(),""}),i["max-age"]){const c=parseInt(i["max-age"],10);isNaN(c)?delete i["max-age"]:i["max-age"]=c}return i},d.ab=function(s,i){const c=[];for(const f in s)f in i||c.push(f);return c},d.ac=te,d.ad=function(s,i,c){var f=Math.sin(c),g=Math.cos(c),b=i[0],w=i[1],T=i[2],I=i[3],L=i[4],F=i[5],j=i[6],H=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=b*g+L*f,s[1]=w*g+F*f,s[2]=T*g+j*f,s[3]=I*g+H*f,s[4]=L*g-b*f,s[5]=F*g-w*f,s[6]=j*g-T*f,s[7]=H*g-I*f,s},d.ae=function(s){var i=new Xl(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},d.af=_f,d.ag=function(s,i){let c=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:b,maxZoom:w}=s,T=g?te(oi.interpolationFactor(g,i,b,w),0,1):0;s.kind==="camera"?f=di.number(s.minSize,s.maxSize,T):c=T}return{uSizeT:c,uSize:f}},d.ai=function(s,{uSize:i,uSizeT:c},{lowerSize:f,upperSize:g}){return s.kind==="source"?f/is:s.kind==="composite"?di.number(f/is,g/is,c):i},d.aj=zp,d.ak=function(s,i,c,f){const g=i.y-s.y,b=i.x-s.x,w=f.y-c.y,T=f.x-c.x,I=w*b-T*g;if(I===0)return null;const L=(T*(s.y-c.y)-w*(s.x-c.x))/I;return new S(s.x+L*b,s.y+L*g)},d.al=yy,d.am=gu,d.an=fp,d.ao=Nn,d.aq=Pp,d.ar=function(s,i){var c=i[0],f=i[1],g=i[2],b=i[3],w=i[4],T=i[5],I=i[6],L=i[7],F=i[8],j=i[9],H=i[10],K=i[11],Q=i[12],ae=i[13],ge=i[14],xe=i[15],Re=c*T-f*w,ke=c*I-g*w,Ae=c*L-b*w,Ye=f*I-g*T,Qe=f*L-b*T,Tt=g*L-b*I,Dt=F*ae-j*Q,kt=F*ge-H*Q,vt=F*xe-K*Q,dt=j*ge-H*ae,Lt=j*xe-K*ae,_t=H*xe-K*ge,ot=Re*_t-ke*Lt+Ae*dt+Ye*vt-Qe*kt+Tt*Dt;return ot?(s[0]=(T*_t-I*Lt+L*dt)*(ot=1/ot),s[1]=(g*Lt-f*_t-b*dt)*ot,s[2]=(ae*Tt-ge*Qe+xe*Ye)*ot,s[3]=(H*Qe-j*Tt-K*Ye)*ot,s[4]=(I*vt-w*_t-L*kt)*ot,s[5]=(c*_t-g*vt+b*kt)*ot,s[6]=(ge*Ae-Q*Tt-xe*ke)*ot,s[7]=(F*Tt-H*Ae+K*ke)*ot,s[8]=(w*Lt-T*vt+L*Dt)*ot,s[9]=(f*vt-c*Lt-b*Dt)*ot,s[10]=(Q*Qe-ae*Ae+xe*Re)*ot,s[11]=(j*Ae-F*Qe-K*Re)*ot,s[12]=(T*kt-w*dt-I*Dt)*ot,s[13]=(c*dt-f*kt+g*Dt)*ot,s[14]=(ae*ke-Q*Ye-ge*Re)*ot,s[15]=(F*Ye-j*ke+H*Re)*ot,s):null},d.as=Up,d.at=Lp,d.au=Vp,d.av=function(){const s={},i=ne.$version;for(const c in ne.$root){const f=ne.$root[c];if(f.required){let g=null;g=c==="version"?i:f.type==="array"?[]:{},g!=null&&(s[c]=g)}}return s},d.aw=rf,d.ax=mr,d.ay=function(s){s=s.slice();const i=Object.create(null);for(let c=0;c<s.length;c++)i[s[c].id]=s[c];for(let c=0;c<s.length;c++)"ref"in s[c]&&(s[c]=Be(s[c],i[s[c].ref]));return s},d.az=function(s){if(s.type==="custom")return new fS(s);switch(s.type){case"background":return new cS(s);case"circle":return new $x(s);case"fill":return new p2(s);case"fill-extrusion":return new I2(s);case"heatmap":return new Kx(s);case"hillshade":return new Yx(s);case"line":return new F2(s);case"raster":return new hS(s);case"symbol":return new Mf(s)}},d.b=Je,d.b0=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},d.b1=le,d.b2=hy,d.b3=cy,d.b4=function(s,i,c,f,g){var b,w=1/Math.tan(i/2);return s[0]=w/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=w,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+f)*(b=1/(f-g)),s[14]=2*g*f*b):(s[10]=-1,s[14]=-2*f),s},d.b5=function(s,i,c){var f=Math.sin(c),g=Math.cos(c),b=i[4],w=i[5],T=i[6],I=i[7],L=i[8],F=i[9],j=i[10],H=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=b*g+L*f,s[5]=w*g+F*f,s[6]=T*g+j*f,s[7]=I*g+H*f,s[8]=L*g-b*f,s[9]=F*g-w*f,s[10]=j*g-T*f,s[11]=H*g-I*f,s},d.b6=G,d.b7=U,d.b8=function(s){return s*Math.PI/180},d.b9=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},d.bA=es,d.ba=class extends Fo{},d.bb=Fp,d.bc=SS,d.be=wr,d.bf=function(s,i){gr.REGISTERED_PROTOCOLS[s]=i},d.bg=function(s){delete gr.REGISTERED_PROTOCOLS[s]},d.bh=function(s,i){const c={};for(let g=0;g<s.length;g++){const b=i&&i[s[g].id]||ap(s[g]);i&&(i[s[g].id]=b);let w=c[b];w||(w=c[b]=[]),w.push(s[g])}const f=[];for(const g in c)f.push(c[g]);return f},d.bi=Ct,d.bj=dy,d.bk=my,d.bl=H_,d.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=yn/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],c=i.layout,f=i._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new Qr(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Qr(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Qr(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:F}=s.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Qr(L),s.canonical),f["text-size"].possiblyEvaluate(new Qr(F),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:F}=s.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Qr(L),s.canonical),f["icon-size"].possiblyEvaluate(new Qr(F),s.canonical)]}const b=c.get("text-line-height")*Nn,w=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),I=c.get("text-size");for(const L of s.bucket.features){const F=c.get("text-font").evaluate(L,{},s.canonical).join(","),j=I.evaluate(L,{},s.canonical),H=g.layoutTextSize.evaluate(L,{},s.canonical),K=g.layoutIconSize.evaluate(L,{},s.canonical),Q={horizontal:{},vertical:void 0},ae=L.text;let ge,xe=[0,0];if(ae){const Ae=ae.toString(),Ye=c.get("text-letter-spacing").evaluate(L,{},s.canonical)*Nn,Qe=nf(Ae)?Ye:0,Tt=c.get("text-anchor").evaluate(L,{},s.canonical),Dt=My(i,L,s.canonical);if(!Dt){const _t=c.get("text-radial-offset").evaluate(L,{},s.canonical);xe=_t?Ey(Tt,[_t*Nn,jp]):c.get("text-offset").evaluate(L,{},s.canonical).map(ot=>ot*Nn)}let kt=w?"center":c.get("text-justify").evaluate(L,{},s.canonical);const vt=c.get("symbol-placement"),dt=vt==="point"?c.get("text-max-width").evaluate(L,{},s.canonical)*Nn:0,Lt=()=>{s.bucket.allowVerticalPlacement&&Js(Ae)&&(Q.vertical=kf(ae,s.glyphMap,s.glyphPositions,s.imagePositions,F,dt,b,Tt,"left",Qe,xe,d.ah.vertical,!0,vt,H,j))};if(!w&&Dt){const _t=new Set;if(kt==="auto")for(let qt=0;qt<Dt.values.length;qt+=2)_t.add(Up(Dt.values[qt]));else _t.add(kt);let ot=!1;for(const qt of _t)if(!Q.horizontal[qt])if(ot)Q.horizontal[qt]=Q.horizontal[0];else{const Bt=kf(ae,s.glyphMap,s.glyphPositions,s.imagePositions,F,dt,b,"center",qt,Qe,xe,d.ah.horizontal,!1,vt,H,j);Bt&&(Q.horizontal[qt]=Bt,ot=Bt.positionedLines.length===1)}Lt()}else{kt==="auto"&&(kt=Up(Tt));const _t=kf(ae,s.glyphMap,s.glyphPositions,s.imagePositions,F,dt,b,Tt,kt,Qe,xe,d.ah.horizontal,!1,vt,H,j);_t&&(Q.horizontal[kt]=_t),Lt(),Js(Ae)&&w&&T&&(Q.vertical=kf(ae,s.glyphMap,s.glyphPositions,s.imagePositions,F,dt,b,Tt,kt,Qe,xe,d.ah.vertical,!1,vt,H,j))}}let Re=!1;if(L.icon&&L.icon.name){const Ae=s.imageMap[L.icon.name];Ae&&(ge=iS(s.imagePositions[L.icon.name],c.get("icon-offset").evaluate(L,{},s.canonical),c.get("icon-anchor").evaluate(L,{},s.canonical)),Re=!!Ae.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Re:s.bucket.sdfIcons!==Re&&He("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ae.pixelRatio!==s.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const ke=Iy(Q.horizontal)||Q.vertical;s.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||ge)&&wS(s.bucket,L,Q,ge,s.imageMap,g,H,K,xe,Re,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},d.bn=Tp,d.bo=xp,d.bp=kp,d.bq=Qs,d.br=Mp,d.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},d.bt=function(s,i,c,f,g){return a(this,void 0,void 0,function*(){if(N())try{return yield Kt(s,i,c,f,g)}catch{}return function(b,w,T,I,L){const F=b.width,j=b.height;Ut&&Vt||(Ut=new OffscreenCanvas(F,j),Vt=Ut.getContext("2d",{willReadFrequently:!0})),Ut.width=F,Ut.height=j,Vt.drawImage(b,0,0,F,j);const H=Vt.getImageData(w,T,I,L);return Vt.clearRect(0,0,F,j),H.data}(s,i,c,f,g)})},d.bu=fy,d.bv=_,d.bw=x,d.bx=O_,d.by=gs,d.bz=function(s){return s.message===wt},d.c=Yt,d.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(i)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=$,d.f=s=>new Promise((i,c)=>{const f=new Image;f.onload=()=>{i(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Jt})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(g):Jt}),d.g=Pt,d.h=(s,i)=>Rr($(s,{type:"json"}),i),d.i=At,d.j=nt,d.k=lt,d.l=(s,i)=>Rr($(s,{type:"arrayBuffer"}),i),d.m=Rr,d.n=function(s){return new Mp(s).readFields(Y2,[])},d.o=xu,d.p=Z_,d.q=Si,d.r=lp,d.s=ht,d.t=$s,d.u=St,d.v=ne,d.w=He,d.x=ys,d.y=function([s,i,c]){return i+=90,i*=Math.PI/180,c*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(c),y:s*Math.sin(i)*Math.sin(c),z:s*Math.cos(c)}},d.z=di}),l("worker",["./shared"],function(d){class a{constructor(Z){this.keyCache={},Z&&this.replace(Z)}replace(Z){this._layerConfigs={},this._layers={},this.update(Z,[])}update(Z,X){for(const ce of Z){this._layerConfigs[ce.id]=ce;const Ce=this._layers[ce.id]=d.az(ce);Ce._featureFilter=d.a6(Ce.filter),this.keyCache[ce.id]&&delete this.keyCache[ce.id]}for(const ce of X)delete this.keyCache[ce],delete this._layerConfigs[ce],delete this._layers[ce];this.familiesBySource={};const ee=d.bh(Object.values(this._layerConfigs),this.keyCache);for(const ce of ee){const Ce=ce.map(Oe=>this._layers[Oe.id]),Ie=Ce[0];if(Ie.visibility==="none")continue;const Pe=Ie.source||"";let Se=this.familiesBySource[Pe];Se||(Se=this.familiesBySource[Pe]={});const W=Ie.sourceLayer||"_geojsonTileLayer";let Fe=Se[W];Fe||(Fe=Se[W]=[]),Fe.push(Ce)}}}class _{constructor(Z){const X={},ee=[];for(const Pe in Z){const Se=Z[Pe],W=X[Pe]={};for(const Fe in Se){const Oe=Se[+Fe];if(!Oe||Oe.bitmap.width===0||Oe.bitmap.height===0)continue;const Ge={x:0,y:0,w:Oe.bitmap.width+2,h:Oe.bitmap.height+2};ee.push(Ge),W[Fe]={rect:Ge,metrics:Oe.metrics}}}const{w:ce,h:Ce}=d.p(ee),Ie=new d.o({width:ce||1,height:Ce||1});for(const Pe in Z){const Se=Z[Pe];for(const W in Se){const Fe=Se[+W];if(!Fe||Fe.bitmap.width===0||Fe.bitmap.height===0)continue;const Oe=X[Pe][W].rect;d.o.copy(Fe.bitmap,Ie,{x:0,y:0},{x:Oe.x+1,y:Oe.y+1},Fe.bitmap)}}this.image=Ie,this.positions=X}}d.bi("GlyphAtlas",_);class x{constructor(Z){this.tileID=new d.Q(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.uid=Z.uid,this.zoom=Z.zoom,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.returnDependencies=!!Z.returnDependencies,this.promoteId=Z.promoteId,this.inFlightDependencies=[]}parse(Z,X,ee,ce){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=Z,this.collisionBoxArray=new d.a4;const Ce=new d.bj(Object.keys(Z.layers).sort()),Ie=new d.bk(this.tileID,this.promoteId);Ie.bucketLayerIDs=[];const Pe={},Se={featureIndex:Ie,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ee},W=X.familiesBySource[this.source];for(const lr in W){const ln=Z.layers[lr];if(!ln)continue;ln.version===1&&d.w(`Vector tile source "${this.source}" layer "${lr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bn=Ce.encode(lr),fi=[];for(let bi=0;bi<ln.length;bi++){const Kn=ln.feature(bi),mo=Ie.getId(Kn,lr);fi.push({feature:Kn,id:mo,index:bi,sourceLayerIndex:Bn})}for(const bi of W[lr]){const Kn=bi[0];Kn.source!==this.source&&d.w(`layer.source = ${Kn.source} does not equal this.source = ${this.source}`),Kn.minzoom&&this.zoom<Math.floor(Kn.minzoom)||Kn.maxzoom&&this.zoom>=Kn.maxzoom||Kn.visibility!=="none"&&(k(bi,this.zoom,ee),(Pe[Kn.id]=Kn.createBucket({index:Ie.bucketLayerIDs.length,layers:bi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bn,sourceID:this.source})).populate(fi,Se,this.tileID.canonical),Ie.bucketLayerIDs.push(bi.map(mo=>mo.id)))}}const Fe=d.aE(Se.glyphDependencies,lr=>Object.keys(lr).map(Number));this.inFlightDependencies.forEach(lr=>lr==null?void 0:lr.abort()),this.inFlightDependencies=[];let Oe=Promise.resolve({});if(Object.keys(Fe).length){const lr=new AbortController;this.inFlightDependencies.push(lr),Oe=ce.sendAsync({type:"GG",data:{stacks:Fe,source:this.source,tileID:this.tileID,type:"glyphs"}},lr)}const Ge=Object.keys(Se.iconDependencies);let Ke=Promise.resolve({});if(Ge.length){const lr=new AbortController;this.inFlightDependencies.push(lr),Ke=ce.sendAsync({type:"GI",data:{icons:Ge,source:this.source,tileID:this.tileID,type:"icons"}},lr)}const at=Object.keys(Se.patternDependencies);let zt=Promise.resolve({});if(at.length){const lr=new AbortController;this.inFlightDependencies.push(lr),zt=ce.sendAsync({type:"GI",data:{icons:at,source:this.source,tileID:this.tileID,type:"patterns"}},lr)}const[$t,ar,_r]=yield Promise.all([Oe,Ke,zt]),Yr=new _($t),Cn=new d.bl(ar,_r);for(const lr in Pe){const ln=Pe[lr];ln instanceof d.a5?(k(ln.layers,this.zoom,ee),d.bm({bucket:ln,glyphMap:$t,glyphPositions:Yr.positions,imageMap:ar,imagePositions:Cn.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ln.hasPattern&&(ln instanceof d.bn||ln instanceof d.bo||ln instanceof d.bp)&&(k(ln.layers,this.zoom,ee),ln.addFeatures(Se,this.tileID.canonical,Cn.patternPositions))}return this.status="done",{buckets:Object.values(Pe).filter(lr=>!lr.isEmpty()),featureIndex:Ie,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yr.image,imageAtlas:Cn,glyphMap:this.returnDependencies?$t:null,iconMap:this.returnDependencies?ar:null,glyphPositions:this.returnDependencies?Yr.positions:null}})}}function k(me,Z,X){const ee=new d.a8(Z);for(const ce of me)ce.recalculate(ee,X)}class S{constructor(Z,X,ee){this.actor=Z,this.layerIndex=X,this.availableImages=ee,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Z,X){return d._(this,void 0,void 0,function*(){const ee=yield d.l(Z.request,X);try{return{vectorTile:new d.bq.VectorTile(new d.br(ee.data)),rawData:ee.data,cacheControl:ee.cacheControl,expires:ee.expires}}catch(ce){const Ce=new Uint8Array(ee.data);let Ie=`Unable to parse the tile at ${Z.request.url}, `;throw Ie+=Ce[0]===31&&Ce[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ce.messge}`,new Error(Ie)}})}loadTile(Z){return d._(this,void 0,void 0,function*(){const X=Z.uid,ee=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new d.bs(Z.request),ce=new x(Z);this.loading[X]=ce;const Ce=new AbortController;ce.abort=Ce;try{const Ie=yield this.loadVectorTile(Z,Ce);if(delete this.loading[X],!Ie)return null;const Pe=Ie.rawData,Se={};Ie.expires&&(Se.expires=Ie.expires),Ie.cacheControl&&(Se.cacheControl=Ie.cacheControl);const W={};if(ee){const Oe=ee.finish();Oe&&(W.resourceTiming=JSON.parse(JSON.stringify(Oe)))}ce.vectorTile=Ie.vectorTile;const Fe=ce.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[X]=ce,this.fetching[X]={rawTileData:Pe,cacheControl:Se,resourceTiming:W};try{const Oe=yield Fe;return d.e({rawTileData:Pe.slice(0)},Oe,Se,W)}finally{delete this.fetching[X]}}catch(Ie){throw delete this.loading[X],ce.status="done",this.loaded[X]=ce,Ie}})}reloadTile(Z){return d._(this,void 0,void 0,function*(){const X=Z.uid;if(!this.loaded||!this.loaded[X])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ee=this.loaded[X];if(ee.showCollisionBoxes=Z.showCollisionBoxes,ee.status==="parsing"){const ce=yield ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ce;if(this.fetching[X]){const{rawTileData:Ie,cacheControl:Pe,resourceTiming:Se}=this.fetching[X];delete this.fetching[X],Ce=d.e({rawTileData:Ie.slice(0)},ce,Pe,Se)}else Ce=ce;return Ce}if(ee.status==="done"&&ee.vectorTile)return ee.parse(ee.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(Z){return d._(this,void 0,void 0,function*(){const X=this.loading,ee=Z.uid;X&&X[ee]&&X[ee].abort&&(X[ee].abort.abort(),delete X[ee])})}removeTile(Z){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Z.uid]&&delete this.loaded[Z.uid]})}}class C{constructor(){this.loaded={}}loadTile(Z){return d._(this,void 0,void 0,function*(){const{uid:X,encoding:ee,rawImageData:ce,redFactor:Ce,greenFactor:Ie,blueFactor:Pe,baseShift:Se}=Z,W=ce.width+2,Fe=ce.height+2,Oe=d.b(ce)?new d.R({width:W,height:Fe},yield d.bt(ce,-1,-1,W,Fe)):ce,Ge=new d.bu(X,Oe,ee,Ce,Ie,Pe,Se);return this.loaded=this.loaded||{},this.loaded[X]=Ge,Ge})}removeTile(Z){const X=this.loaded,ee=Z.uid;X&&X[ee]&&delete X[ee]}}function P(me,Z){if(me.length!==0){D(me[0],Z);for(var X=1;X<me.length;X++)D(me[X],!Z)}}function D(me,Z){for(var X=0,ee=0,ce=0,Ce=me.length,Ie=Ce-1;ce<Ce;Ie=ce++){var Pe=(me[ce][0]-me[Ie][0])*(me[Ie][1]+me[ce][1]),Se=X+Pe;ee+=Math.abs(X)>=Math.abs(Pe)?X-Se+Pe:Pe-Se+X,X=Se}X+ee>=0!=!!Z&&me.reverse()}var O=d.bv(function me(Z,X){var ee,ce=Z&&Z.type;if(ce==="FeatureCollection")for(ee=0;ee<Z.features.length;ee++)me(Z.features[ee],X);else if(ce==="GeometryCollection")for(ee=0;ee<Z.geometries.length;ee++)me(Z.geometries[ee],X);else if(ce==="Feature")me(Z.geometry,X);else if(ce==="Polygon")P(Z.coordinates,X);else if(ce==="MultiPolygon")for(ee=0;ee<Z.coordinates.length;ee++)P(Z.coordinates[ee],X);return Z});const z=d.bq.VectorTileFeature.prototype.toGeoJSON;var B={exports:{}},N=d.bw,G=d.bq.VectorTileFeature,U=te;function te(me,Z){this.options=Z||{},this.features=me,this.length=me.length}function le(me,Z){this.id=typeof me.id=="number"?me.id:void 0,this.type=me.type,this.rawGeometry=me.type===1?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=Z||4096}te.prototype.feature=function(me){return new le(this.features[me],this.options.extent)},le.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var Z=0;Z<me.length;Z++){for(var X=me[Z],ee=[],ce=0;ce<X.length;ce++)ee.push(new N(X[ce][0],X[ce][1]));this.geometry.push(ee)}return this.geometry},le.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,Z=1/0,X=-1/0,ee=1/0,ce=-1/0,Ce=0;Ce<me.length;Ce++)for(var Ie=me[Ce],Pe=0;Pe<Ie.length;Pe++){var Se=Ie[Pe];Z=Math.min(Z,Se.x),X=Math.max(X,Se.x),ee=Math.min(ee,Se.y),ce=Math.max(ce,Se.y)}return[Z,ee,X,ce]},le.prototype.toGeoJSON=G.prototype.toGeoJSON;var $=d.bx,J=U;function _e(me){var Z=new $;return function(X,ee){for(var ce in X.layers)ee.writeMessage(3,ze,X.layers[ce])}(me,Z),Z.finish()}function ze(me,Z){var X;Z.writeVarintField(15,me.version||1),Z.writeStringField(1,me.name||""),Z.writeVarintField(5,me.extent||4096);var ee={keys:[],values:[],keycache:{},valuecache:{}};for(X=0;X<me.length;X++)ee.feature=me.feature(X),Z.writeMessage(2,re,ee);var ce=ee.keys;for(X=0;X<ce.length;X++)Z.writeStringField(3,ce[X]);var Ce=ee.values;for(X=0;X<Ce.length;X++)Z.writeMessage(4,At,Ce[X])}function re(me,Z){var X=me.feature;X.id!==void 0&&Z.writeVarintField(1,X.id),Z.writeMessage(2,ue,me),Z.writeVarintField(3,X.type),Z.writeMessage(4,ut,X)}function ue(me,Z){var X=me.feature,ee=me.keys,ce=me.values,Ce=me.keycache,Ie=me.valuecache;for(var Pe in X.properties){var Se=X.properties[Pe],W=Ce[Pe];if(Se!==null){W===void 0&&(ee.push(Pe),Ce[Pe]=W=ee.length-1),Z.writeVarint(W);var Fe=typeof Se;Fe!=="string"&&Fe!=="boolean"&&Fe!=="number"&&(Se=JSON.stringify(Se));var Oe=Fe+":"+Se,Ge=Ie[Oe];Ge===void 0&&(ce.push(Se),Ie[Oe]=Ge=ce.length-1),Z.writeVarint(Ge)}}}function He(me,Z){return(Z<<3)+(7&me)}function Me(me){return me<<1^me>>31}function ut(me,Z){for(var X=me.loadGeometry(),ee=me.type,ce=0,Ce=0,Ie=X.length,Pe=0;Pe<Ie;Pe++){var Se=X[Pe],W=1;ee===1&&(W=Se.length),Z.writeVarint(He(1,W));for(var Fe=ee===3?Se.length-1:Se.length,Oe=0;Oe<Fe;Oe++){Oe===1&&ee!==1&&Z.writeVarint(He(2,Fe-1));var Ge=Se[Oe].x-ce,Ke=Se[Oe].y-Ce;Z.writeVarint(Me(Ge)),Z.writeVarint(Me(Ke)),ce+=Ge,Ce+=Ke}ee===3&&Z.writeVarint(He(7,1))}}function At(me,Z){var X=typeof me;X==="string"?Z.writeStringField(1,me):X==="boolean"?Z.writeBooleanField(7,me):X==="number"&&(me%1!=0?Z.writeDoubleField(3,me):me<0?Z.writeSVarintField(6,me):Z.writeVarintField(5,me))}B.exports=_e,B.exports.fromVectorTileJs=_e,B.exports.fromGeojsonVt=function(me,Z){Z=Z||{};var X={};for(var ee in me)X[ee]=new J(me[ee].features,Z),X[ee].name=ee,X[ee].version=Z.version,X[ee].extent=Z.extent;return _e({layers:X})},B.exports.GeoJSONWrapper=J;var Nt=d.bv(B.exports);const Je={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},Jt=Math.fround||(Kt=new Float32Array(1),me=>(Kt[0]=+me,Kt[0]));var Kt;const Ut=3,Vt=5,wt=6;class Yt{constructor(Z){this.options=Object.assign(Object.create(Je),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:X,minZoom:ee,maxZoom:ce}=this.options;X&&console.time("total time");const Ce=`prepare ${Z.length} points`;X&&console.time(Ce),this.points=Z;const Ie=[];for(let Se=0;Se<Z.length;Se++){const W=Z[Se];if(!W.geometry)continue;const[Fe,Oe]=W.geometry.coordinates,Ge=Jt(rr(Fe)),Ke=Jt(wr(Oe));Ie.push(Ge,Ke,1/0,Se,-1,1),this.options.reduce&&Ie.push(0)}let Pe=this.trees[ce+1]=this._createTree(Ie);X&&console.timeEnd(Ce);for(let Se=ce;Se>=ee;Se--){const W=+Date.now();Pe=this.trees[Se]=this._createTree(this._cluster(Pe,Se)),X&&console.log("z%d: %d clusters in %dms",Se,Pe.numItems,+Date.now()-W)}return X&&console.timeEnd("total time"),this}getClusters(Z,X){let ee=((Z[0]+180)%360+360)%360-180;const ce=Math.max(-90,Math.min(90,Z[1]));let Ce=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)ee=-180,Ce=180;else if(ee>Ce){const Oe=this.getClusters([ee,ce,180,Ie],X),Ge=this.getClusters([-180,ce,Ce,Ie],X);return Oe.concat(Ge)}const Pe=this.trees[this._limitZoom(X)],Se=Pe.range(rr(ee),wr(Ie),rr(Ce),wr(ce)),W=Pe.data,Fe=[];for(const Oe of Se){const Ge=this.stride*Oe;Fe.push(W[Ge+Vt]>1?gr(W,Ge,this.clusterProps):this.points[W[Ge+Ut]])}return Fe}getChildren(Z){const X=this._getOriginId(Z),ee=this._getOriginZoom(Z),ce="No cluster with the specified id.",Ce=this.trees[ee];if(!Ce)throw new Error(ce);const Ie=Ce.data;if(X*this.stride>=Ie.length)throw new Error(ce);const Pe=this.options.radius/(this.options.extent*Math.pow(2,ee-1)),Se=Ce.within(Ie[X*this.stride],Ie[X*this.stride+1],Pe),W=[];for(const Fe of Se){const Oe=Fe*this.stride;Ie[Oe+4]===Z&&W.push(Ie[Oe+Vt]>1?gr(Ie,Oe,this.clusterProps):this.points[Ie[Oe+Ut]])}if(W.length===0)throw new Error(ce);return W}getLeaves(Z,X,ee){const ce=[];return this._appendLeaves(ce,Z,X=X||10,ee=ee||0,0),ce}getTile(Z,X,ee){const ce=this.trees[this._limitZoom(Z)],Ce=Math.pow(2,Z),{extent:Ie,radius:Pe}=this.options,Se=Pe/Ie,W=(ee-Se)/Ce,Fe=(ee+1+Se)/Ce,Oe={features:[]};return this._addTileFeatures(ce.range((X-Se)/Ce,W,(X+1+Se)/Ce,Fe),ce.data,X,ee,Ce,Oe),X===0&&this._addTileFeatures(ce.range(1-Se/Ce,W,1,Fe),ce.data,Ce,ee,Ce,Oe),X===Ce-1&&this._addTileFeatures(ce.range(0,W,Se/Ce,Fe),ce.data,-1,ee,Ce,Oe),Oe.features.length?Oe:null}getClusterExpansionZoom(Z){let X=this._getOriginZoom(Z)-1;for(;X<=this.options.maxZoom;){const ee=this.getChildren(Z);if(X++,ee.length!==1)break;Z=ee[0].properties.cluster_id}return X}_appendLeaves(Z,X,ee,ce,Ce){const Ie=this.getChildren(X);for(const Pe of Ie){const Se=Pe.properties;if(Se&&Se.cluster?Ce+Se.point_count<=ce?Ce+=Se.point_count:Ce=this._appendLeaves(Z,Se.cluster_id,ee,ce,Ce):Ce<ce?Ce++:Z.push(Pe),Z.length===ee)break}return Ce}_createTree(Z){const X=new d.au(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ee=0;ee<Z.length;ee+=this.stride)X.add(Z[ee],Z[ee+1]);return X.finish(),X.data=Z,X}_addTileFeatures(Z,X,ee,ce,Ce,Ie){for(const Pe of Z){const Se=Pe*this.stride,W=X[Se+Vt]>1;let Fe,Oe,Ge;if(W)Fe=Pt(X,Se,this.clusterProps),Oe=X[Se],Ge=X[Se+1];else{const zt=this.points[X[Se+Ut]];Fe=zt.properties;const[$t,ar]=zt.geometry.coordinates;Oe=rr($t),Ge=wr(ar)}const Ke={type:1,geometry:[[Math.round(this.options.extent*(Oe*Ce-ee)),Math.round(this.options.extent*(Ge*Ce-ce))]],tags:Fe};let at;at=W||this.options.generateId?X[Se+Ut]:this.points[X[Se+Ut]].id,at!==void 0&&(Ke.id=at),Ie.features.push(Ke)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,X){const{radius:ee,extent:ce,reduce:Ce,minPoints:Ie}=this.options,Pe=ee/(ce*Math.pow(2,X)),Se=Z.data,W=[],Fe=this.stride;for(let Oe=0;Oe<Se.length;Oe+=Fe){if(Se[Oe+2]<=X)continue;Se[Oe+2]=X;const Ge=Se[Oe],Ke=Se[Oe+1],at=Z.within(Se[Oe],Se[Oe+1],Pe),zt=Se[Oe+Vt];let $t=zt;for(const ar of at){const _r=ar*Fe;Se[_r+2]>X&&($t+=Se[_r+Vt])}if($t>zt&&$t>=Ie){let ar,_r=Ge*zt,Yr=Ke*zt,Cn=-1;const lr=((Oe/Fe|0)<<5)+(X+1)+this.points.length;for(const ln of at){const Bn=ln*Fe;if(Se[Bn+2]<=X)continue;Se[Bn+2]=X;const fi=Se[Bn+Vt];_r+=Se[Bn]*fi,Yr+=Se[Bn+1]*fi,Se[Bn+4]=lr,Ce&&(ar||(ar=this._map(Se,Oe,!0),Cn=this.clusterProps.length,this.clusterProps.push(ar)),Ce(ar,this._map(Se,Bn)))}Se[Oe+4]=lr,W.push(_r/$t,Yr/$t,1/0,lr,-1,$t),Ce&&W.push(Cn)}else{for(let ar=0;ar<Fe;ar++)W.push(Se[Oe+ar]);if($t>1)for(const ar of at){const _r=ar*Fe;if(!(Se[_r+2]<=X)){Se[_r+2]=X;for(let Yr=0;Yr<Fe;Yr++)W.push(Se[_r+Yr])}}}}return W}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,X,ee){if(Z[X+Vt]>1){const Ie=this.clusterProps[Z[X+wt]];return ee?Object.assign({},Ie):Ie}const ce=this.points[Z[X+Ut]].properties,Ce=this.options.map(ce);return ee&&Ce===ce?Object.assign({},Ce):Ce}}function gr(me,Z,X){return{type:"Feature",id:me[Z+Ut],properties:Pt(me,Z,X),geometry:{type:"Point",coordinates:[(ee=me[Z],360*(ee-.5)),mr(me[Z+1])]}};var ee}function Pt(me,Z,X){const ee=me[Z+Vt],ce=ee>=1e4?`${Math.round(ee/1e3)}k`:ee>=1e3?Math.round(ee/100)/10+"k":ee,Ce=me[Z+wt],Ie=Ce===-1?{}:Object.assign({},X[Ce]);return Object.assign(Ie,{cluster:!0,cluster_id:me[Z+Ut],point_count:ee,point_count_abbreviated:ce})}function rr(me){return me/360+.5}function wr(me){const Z=Math.sin(me*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function mr(me){const Z=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}function Rr(me,Z,X,ee){for(var ce,Ce=ee,Ie=X-Z>>1,Pe=X-Z,Se=me[Z],W=me[Z+1],Fe=me[X],Oe=me[X+1],Ge=Z+3;Ge<X;Ge+=3){var Ke=ht(me[Ge],me[Ge+1],Se,W,Fe,Oe);if(Ke>Ce)ce=Ge,Ce=Ke;else if(Ke===Ce){var at=Math.abs(Ge-Ie);at<Pe&&(ce=Ge,Pe=at)}}Ce>ee&&(ce-Z>3&&Rr(me,Z,ce,ee),me[ce+2]=Ce,X-ce>3&&Rr(me,ce,X,ee))}function ht(me,Z,X,ee,ce,Ce){var Ie=ce-X,Pe=Ce-ee;if(Ie!==0||Pe!==0){var Se=((me-X)*Ie+(Z-ee)*Pe)/(Ie*Ie+Pe*Pe);Se>1?(X=ce,ee=Ce):Se>0&&(X+=Ie*Se,ee+=Pe*Se)}return(Ie=me-X)*Ie+(Pe=Z-ee)*Pe}function Mt(me,Z,X,ee){var ce={id:me===void 0?null:me,type:Z,geometry:X,tags:ee,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ce){var Ie=Ce.geometry,Pe=Ce.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")De(Ce,Ie);else if(Pe==="Polygon"||Pe==="MultiLineString")for(var Se=0;Se<Ie.length;Se++)De(Ce,Ie[Se]);else if(Pe==="MultiPolygon")for(Se=0;Se<Ie.length;Se++)for(var W=0;W<Ie[Se].length;W++)De(Ce,Ie[Se][W])}(ce),ce}function De(me,Z){for(var X=0;X<Z.length;X+=3)me.minX=Math.min(me.minX,Z[X]),me.minY=Math.min(me.minY,Z[X+1]),me.maxX=Math.max(me.maxX,Z[X]),me.maxY=Math.max(me.maxY,Z[X+1])}function lt(me,Z,X,ee){if(Z.geometry){var ce=Z.geometry.coordinates,Ce=Z.geometry.type,Ie=Math.pow(X.tolerance/((1<<X.maxZoom)*X.extent),2),Pe=[],Se=Z.id;if(X.promoteId?Se=Z.properties[X.promoteId]:X.generateId&&(Se=ee||0),Ce==="Point")nt(ce,Pe);else if(Ce==="MultiPoint")for(var W=0;W<ce.length;W++)nt(ce[W],Pe);else if(Ce==="LineString")xt(ce,Pe,Ie,!1);else if(Ce==="MultiLineString"){if(X.lineMetrics){for(W=0;W<ce.length;W++)xt(ce[W],Pe=[],Ie,!1),me.push(Mt(Se,"LineString",Pe,Z.properties));return}ne(ce,Pe,Ie,!1)}else if(Ce==="Polygon")ne(ce,Pe,Ie,!0);else{if(Ce!=="MultiPolygon"){if(Ce==="GeometryCollection"){for(W=0;W<Z.geometry.geometries.length;W++)lt(me,{id:Se,geometry:Z.geometry.geometries[W],properties:Z.properties},X,ee);return}throw new Error("Input data is not a valid GeoJSON object.")}for(W=0;W<ce.length;W++){var Fe=[];ne(ce[W],Fe,Ie,!0),Pe.push(Fe)}}me.push(Mt(Se,Ce,Pe,Z.properties))}}function nt(me,Z){Z.push(nr(me[0])),Z.push(Be(me[1])),Z.push(0)}function xt(me,Z,X,ee){for(var ce,Ce,Ie=0,Pe=0;Pe<me.length;Pe++){var Se=nr(me[Pe][0]),W=Be(me[Pe][1]);Z.push(Se),Z.push(W),Z.push(0),Pe>0&&(Ie+=ee?(ce*W-Se*Ce)/2:Math.sqrt(Math.pow(Se-ce,2)+Math.pow(W-Ce,2))),ce=Se,Ce=W}var Fe=Z.length-3;Z[2]=1,Rr(Z,0,Fe,X),Z[Fe+2]=1,Z.size=Math.abs(Ie),Z.start=0,Z.end=Z.size}function ne(me,Z,X,ee){for(var ce=0;ce<me.length;ce++){var Ce=[];xt(me[ce],Ce,X,ee),Z.push(Ce)}}function nr(me){return me/360+.5}function Be(me){var Z=Math.sin(me*Math.PI/180),X=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return X<0?0:X>1?1:X}function Ze(me,Z,X,ee,ce,Ce,Ie,Pe){if(ee/=Z,Ce>=(X/=Z)&&Ie<ee)return me;if(Ie<X||Ce>=ee)return null;for(var Se=[],W=0;W<me.length;W++){var Fe=me[W],Oe=Fe.geometry,Ge=Fe.type,Ke=ce===0?Fe.minX:Fe.minY,at=ce===0?Fe.maxX:Fe.maxY;if(Ke>=X&&at<ee)Se.push(Fe);else if(!(at<X||Ke>=ee)){var zt=[];if(Ge==="Point"||Ge==="MultiPoint")bt(Oe,zt,X,ee,ce);else if(Ge==="LineString")bn(Oe,zt,X,ee,ce,!1,Pe.lineMetrics);else if(Ge==="MultiLineString")Mn(Oe,zt,X,ee,ce,!1);else if(Ge==="Polygon")Mn(Oe,zt,X,ee,ce,!0);else if(Ge==="MultiPolygon")for(var $t=0;$t<Oe.length;$t++){var ar=[];Mn(Oe[$t],ar,X,ee,ce,!0),ar.length&&zt.push(ar)}if(zt.length){if(Pe.lineMetrics&&Ge==="LineString"){for($t=0;$t<zt.length;$t++)Se.push(Mt(Fe.id,Ge,zt[$t],Fe.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(zt.length===1?(Ge="LineString",zt=zt[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=zt.length===3?"Point":"MultiPoint"),Se.push(Mt(Fe.id,Ge,zt,Fe.tags))}}}return Se.length?Se:null}function bt(me,Z,X,ee,ce){for(var Ce=0;Ce<me.length;Ce+=3){var Ie=me[Ce+ce];Ie>=X&&Ie<=ee&&(Z.push(me[Ce]),Z.push(me[Ce+1]),Z.push(me[Ce+2]))}}function bn(me,Z,X,ee,ce,Ce,Ie){for(var Pe,Se,W=wn(me),Fe=ce===0?ii:$o,Oe=me.start,Ge=0;Ge<me.length-3;Ge+=3){var Ke=me[Ge],at=me[Ge+1],zt=me[Ge+2],$t=me[Ge+3],ar=me[Ge+4],_r=ce===0?Ke:at,Yr=ce===0?$t:ar,Cn=!1;Ie&&(Pe=Math.sqrt(Math.pow(Ke-$t,2)+Math.pow(at-ar,2))),_r<X?Yr>X&&(Se=Fe(W,Ke,at,$t,ar,X),Ie&&(W.start=Oe+Pe*Se)):_r>ee?Yr<ee&&(Se=Fe(W,Ke,at,$t,ar,ee),Ie&&(W.start=Oe+Pe*Se)):ni(W,Ke,at,zt),Yr<X&&_r>=X&&(Se=Fe(W,Ke,at,$t,ar,X),Cn=!0),Yr>ee&&_r<=ee&&(Se=Fe(W,Ke,at,$t,ar,ee),Cn=!0),!Ce&&Cn&&(Ie&&(W.end=Oe+Pe*Se),Z.push(W),W=wn(me)),Ie&&(Oe+=Pe)}var lr=me.length-3;Ke=me[lr],at=me[lr+1],zt=me[lr+2],(_r=ce===0?Ke:at)>=X&&_r<=ee&&ni(W,Ke,at,zt),lr=W.length-3,Ce&&lr>=3&&(W[lr]!==W[0]||W[lr+1]!==W[1])&&ni(W,W[0],W[1],W[2]),W.length&&Z.push(W)}function wn(me){var Z=[];return Z.size=me.size,Z.start=me.start,Z.end=me.end,Z}function Mn(me,Z,X,ee,ce,Ce){for(var Ie=0;Ie<me.length;Ie++)bn(me[Ie],Z,X,ee,ce,Ce,!1)}function ni(me,Z,X,ee){me.push(Z),me.push(X),me.push(ee)}function ii(me,Z,X,ee,ce,Ce){var Ie=(Ce-Z)/(ee-Z);return me.push(Ce),me.push(X+(ce-X)*Ie),me.push(1),Ie}function $o(me,Z,X,ee,ce,Ce){var Ie=(Ce-X)/(ce-X);return me.push(Z+(ee-Z)*Ie),me.push(Ce),me.push(1),Ie}function Jr(me,Z){for(var X=[],ee=0;ee<me.length;ee++){var ce,Ce=me[ee],Ie=Ce.type;if(Ie==="Point"||Ie==="MultiPoint"||Ie==="LineString")ce=st(Ce.geometry,Z);else if(Ie==="MultiLineString"||Ie==="Polygon"){ce=[];for(var Pe=0;Pe<Ce.geometry.length;Pe++)ce.push(st(Ce.geometry[Pe],Z))}else if(Ie==="MultiPolygon")for(ce=[],Pe=0;Pe<Ce.geometry.length;Pe++){for(var Se=[],W=0;W<Ce.geometry[Pe].length;W++)Se.push(st(Ce.geometry[Pe][W],Z));ce.push(Se)}X.push(Mt(Ce.id,Ie,ce,Ce.tags))}return X}function st(me,Z){var X=[];X.size=me.size,me.start!==void 0&&(X.start=me.start,X.end=me.end);for(var ee=0;ee<me.length;ee+=3)X.push(me[ee]+Z,me[ee+1],me[ee+2]);return X}function Xn(me,Z){if(me.transformed)return me;var X,ee,ce,Ce=1<<me.z,Ie=me.x,Pe=me.y;for(X=0;X<me.features.length;X++){var Se=me.features[X],W=Se.geometry,Fe=Se.type;if(Se.geometry=[],Fe===1)for(ee=0;ee<W.length;ee+=2)Se.geometry.push(xn(W[ee],W[ee+1],Z,Ce,Ie,Pe));else for(ee=0;ee<W.length;ee++){var Oe=[];for(ce=0;ce<W[ee].length;ce+=2)Oe.push(xn(W[ee][ce],W[ee][ce+1],Z,Ce,Ie,Pe));Se.geometry.push(Oe)}}return me.transformed=!0,me}function xn(me,Z,X,ee,ce,Ce){return[Math.round(X*(me*ee-ce)),Math.round(X*(Z*ee-Ce))]}function Bo(me,Z,X,ee,ce){for(var Ce=Z===ce.maxZoom?0:ce.tolerance/((1<<Z)*ce.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:X,y:ee,z:Z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Pe=0;Pe<me.length;Pe++){Ie.numFeatures++,Or(Ie,me[Pe],Ce,ce);var Se=me[Pe].minX,W=me[Pe].minY,Fe=me[Pe].maxX,Oe=me[Pe].maxY;Se<Ie.minX&&(Ie.minX=Se),W<Ie.minY&&(Ie.minY=W),Fe>Ie.maxX&&(Ie.maxX=Fe),Oe>Ie.maxY&&(Ie.maxY=Oe)}return Ie}function Or(me,Z,X,ee){var ce=Z.geometry,Ce=Z.type,Ie=[];if(Ce==="Point"||Ce==="MultiPoint")for(var Pe=0;Pe<ce.length;Pe+=3)Ie.push(ce[Pe]),Ie.push(ce[Pe+1]),me.numPoints++,me.numSimplified++;else if(Ce==="LineString")pt(Ie,ce,me,X,!1,!1);else if(Ce==="MultiLineString"||Ce==="Polygon")for(Pe=0;Pe<ce.length;Pe++)pt(Ie,ce[Pe],me,X,Ce==="Polygon",Pe===0);else if(Ce==="MultiPolygon")for(var Se=0;Se<ce.length;Se++){var W=ce[Se];for(Pe=0;Pe<W.length;Pe++)pt(Ie,W[Pe],me,X,!0,Pe===0)}if(Ie.length){var Fe=Z.tags||null;if(Ce==="LineString"&&ee.lineMetrics){for(var Oe in Fe={},Z.tags)Fe[Oe]=Z.tags[Oe];Fe.mapbox_clip_start=ce.start/ce.size,Fe.mapbox_clip_end=ce.end/ce.size}var Ge={geometry:Ie,type:Ce==="Polygon"||Ce==="MultiPolygon"?3:Ce==="LineString"||Ce==="MultiLineString"?2:1,tags:Fe};Z.id!==null&&(Ge.id=Z.id),me.features.push(Ge)}}function pt(me,Z,X,ee,ce,Ce){var Ie=ee*ee;if(ee>0&&Z.size<(ce?Ie:ee))X.numPoints+=Z.length/3;else{for(var Pe=[],Se=0;Se<Z.length;Se+=3)(ee===0||Z[Se+2]>Ie)&&(X.numSimplified++,Pe.push(Z[Se]),Pe.push(Z[Se+1])),X.numPoints++;ce&&function(W,Fe){for(var Oe=0,Ge=0,Ke=W.length,at=Ke-2;Ge<Ke;at=Ge,Ge+=2)Oe+=(W[Ge]-W[at])*(W[Ge+1]+W[at+1]);if(Oe>0===Fe)for(Ge=0,Ke=W.length;Ge<Ke/2;Ge+=2){var zt=W[Ge],$t=W[Ge+1];W[Ge]=W[Ke-2-Ge],W[Ge+1]=W[Ke-1-Ge],W[Ke-2-Ge]=zt,W[Ke-1-Ge]=$t}}(Pe,Ce),me.push(Pe)}}function ir(me,Z){var X=(Z=this.options=function(ce,Ce){for(var Ie in Ce)ce[Ie]=Ce[Ie];return ce}(Object.create(this.options),Z)).debug;if(X&&console.time("preprocess data"),Z.maxZoom<0||Z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Z.promoteId&&Z.generateId)throw new Error("promoteId and generateId cannot be used together.");var ee=function(ce,Ce){var Ie=[];if(ce.type==="FeatureCollection")for(var Pe=0;Pe<ce.features.length;Pe++)lt(Ie,ce.features[Pe],Ce,Pe);else lt(Ie,ce.type==="Feature"?ce:{geometry:ce},Ce);return Ie}(me,Z);this.tiles={},this.tileCoords=[],X&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Z.indexMaxZoom,Z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ee=function(ce,Ce){var Ie=Ce.buffer/Ce.extent,Pe=ce,Se=Ze(ce,1,-1-Ie,Ie,0,-1,2,Ce),W=Ze(ce,1,1-Ie,2+Ie,0,-1,2,Ce);return(Se||W)&&(Pe=Ze(ce,1,-Ie,1+Ie,0,-1,2,Ce)||[],Se&&(Pe=Jr(Se,1).concat(Pe)),W&&(Pe=Pe.concat(Jr(W,-1)))),Pe}(ee,Z),ee.length&&this.splitTile(ee,0,0,0),X&&(ee.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qt(me,Z,X){return 32*((1<<me)*X+Z)+me}function Nr(me,Z){return Z?me.properties[Z]:me.id}function vi(me,Z){if(me==null)return!0;if(me.type==="Feature")return Nr(me,Z)!=null;if(me.type==="FeatureCollection"){const X=new Set;for(const ee of me.features){const ce=Nr(ee,Z);if(ce==null||X.has(ce))return!1;X.add(ce)}return!0}return!1}function tr(me,Z){const X=new Map;if(me!=null)if(me.type==="Feature")X.set(Nr(me,Z),me);else for(const ee of me.features)X.set(Nr(ee,Z),ee);return X}ir.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ir.prototype.splitTile=function(me,Z,X,ee,ce,Ce,Ie){for(var Pe=[me,Z,X,ee],Se=this.options,W=Se.debug;Pe.length;){ee=Pe.pop(),X=Pe.pop(),Z=Pe.pop(),me=Pe.pop();var Fe=1<<Z,Oe=Qt(Z,X,ee),Ge=this.tiles[Oe];if(!Ge&&(W>1&&console.time("creation"),Ge=this.tiles[Oe]=Bo(me,Z,X,ee,Se),this.tileCoords.push({z:Z,x:X,y:ee}),W)){W>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Z,X,ee,Ge.numFeatures,Ge.numPoints,Ge.numSimplified),console.timeEnd("creation"));var Ke="z"+Z;this.stats[Ke]=(this.stats[Ke]||0)+1,this.total++}if(Ge.source=me,ce){if(Z===Se.maxZoom||Z===ce)continue;var at=1<<ce-Z;if(X!==Math.floor(Ce/at)||ee!==Math.floor(Ie/at))continue}else if(Z===Se.indexMaxZoom||Ge.numPoints<=Se.indexMaxPoints)continue;if(Ge.source=null,me.length!==0){W>1&&console.time("clipping");var zt,$t,ar,_r,Yr,Cn,lr=.5*Se.buffer/Se.extent,ln=.5-lr,Bn=.5+lr,fi=1+lr;zt=$t=ar=_r=null,Yr=Ze(me,Fe,X-lr,X+Bn,0,Ge.minX,Ge.maxX,Se),Cn=Ze(me,Fe,X+ln,X+fi,0,Ge.minX,Ge.maxX,Se),me=null,Yr&&(zt=Ze(Yr,Fe,ee-lr,ee+Bn,1,Ge.minY,Ge.maxY,Se),$t=Ze(Yr,Fe,ee+ln,ee+fi,1,Ge.minY,Ge.maxY,Se),Yr=null),Cn&&(ar=Ze(Cn,Fe,ee-lr,ee+Bn,1,Ge.minY,Ge.maxY,Se),_r=Ze(Cn,Fe,ee+ln,ee+fi,1,Ge.minY,Ge.maxY,Se),Cn=null),W>1&&console.timeEnd("clipping"),Pe.push(zt||[],Z+1,2*X,2*ee),Pe.push($t||[],Z+1,2*X,2*ee+1),Pe.push(ar||[],Z+1,2*X+1,2*ee),Pe.push(_r||[],Z+1,2*X+1,2*ee+1)}}},ir.prototype.getTile=function(me,Z,X){var ee=this.options,ce=ee.extent,Ce=ee.debug;if(me<0||me>24)return null;var Ie=1<<me,Pe=Qt(me,Z=(Z%Ie+Ie)%Ie,X);if(this.tiles[Pe])return Xn(this.tiles[Pe],ce);Ce>1&&console.log("drilling down to z%d-%d-%d",me,Z,X);for(var Se,W=me,Fe=Z,Oe=X;!Se&&W>0;)W--,Fe=Math.floor(Fe/2),Oe=Math.floor(Oe/2),Se=this.tiles[Qt(W,Fe,Oe)];return Se&&Se.source?(Ce>1&&console.log("found parent tile z%d-%d-%d",W,Fe,Oe),Ce>1&&console.time("drilling down"),this.splitTile(Se.source,W,Fe,Oe,me,Z,X),Ce>1&&console.timeEnd("drilling down"),this.tiles[Pe]?Xn(this.tiles[Pe],ce):null):null};class ro extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Z,X){return d._(this,void 0,void 0,function*(){const ee=Z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ce=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!ce)return null;const Ce=new class{constructor(Pe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.W,this.length=Pe.length,this._features=Pe}feature(Pe){return new class{constructor(Se){this._feature=Se,this.extent=d.W,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){const Se=[];for(const W of this._feature.geometry)Se.push([new d.P(W[0],W[1])]);return Se}{const Se=[];for(const W of this._feature.geometry){const Fe=[];for(const Oe of W)Fe.push(new d.P(Oe[0],Oe[1]));Se.push(Fe)}return Se}}toGeoJSON(Se,W,Fe){return z.call(this,Se,W,Fe)}}(this._features[Pe])}}(ce.features);let Ie=Nt(Ce);return Ie.byteOffset===0&&Ie.byteLength===Ie.buffer.byteLength||(Ie=new Uint8Array(Ie)),{vectorTile:Ce,rawData:Ie.buffer}})}loadData(Z){return d._(this,void 0,void 0,function*(){var X;(X=this._pendingRequest)===null||X===void 0||X.abort();const ee=!!(Z&&Z.request&&Z.request.collectResourceTiming)&&new d.bs(Z.request);this._pendingRequest=new AbortController;try{let ce=yield this.loadGeoJSON(Z,this._pendingRequest);if(delete this._pendingRequest,typeof ce!="object")throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(O(ce,!0),Z.filter){const Ie=d.by(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));ce={type:"FeatureCollection",features:ce.features.filter(Se=>Ie.value.evaluate({zoom:0},Se))}}this._geoJSONIndex=Z.cluster?new Yt(function({superclusterOptions:Ie,clusterProperties:Pe}){if(!Pe||!Ie)return Ie;const Se={},W={},Fe={accumulated:null,zoom:0},Oe={properties:null},Ge=Object.keys(Pe);for(const Ke of Ge){const[at,zt]=Pe[Ke],$t=d.by(zt),ar=d.by(typeof at=="string"?[at,["accumulated"],["get",Ke]]:at);Se[Ke]=$t.value,W[Ke]=ar.value}return Ie.map=Ke=>{Oe.properties=Ke;const at={};for(const zt of Ge)at[zt]=Se[zt].evaluate(Fe,Oe);return at},Ie.reduce=(Ke,at)=>{Oe.properties=at;for(const zt of Ge)Fe.accumulated=Ke[zt],Ke[zt]=W[zt].evaluate(Fe,Oe)},Ie}(Z)).load(ce.features):function(Ie,Pe){return new ir(Ie,Pe)}(ce,Z.geojsonVtOptions),this.loaded={};const Ce={};if(ee){const Ie=ee.finish();Ie&&(Ce.resourceTiming={},Ce.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Ie)))}return Ce}catch(ce){if(delete this._pendingRequest,d.bz(ce))return{abandoned:!0};throw ce}})}reloadTile(Z){const X=this.loaded;return X&&X[Z.uid]?super.reloadTile(Z):this.loadTile(Z)}loadGeoJSON(Z,X){return d._(this,void 0,void 0,function*(){const{promoteId:ee}=Z;if(Z.request){const ce=yield d.h(Z.request,X);return this._dataUpdateable=vi(ce.data,ee)?tr(ce.data,ee):void 0,ce.data}if(typeof Z.data=="string")try{const ce=JSON.parse(Z.data);return this._dataUpdateable=vi(ce,ee)?tr(ce,ee):void 0,ce}catch{throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`)}if(!Z.dataDiff)throw new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Z.source}`);return function(ce,Ce,Ie){var Pe,Se,W,Fe;if(Ce.removeAll&&ce.clear(),Ce.remove)for(const Oe of Ce.remove)ce.delete(Oe);if(Ce.add)for(const Oe of Ce.add){const Ge=Nr(Oe,Ie);Ge!=null&&ce.set(Ge,Oe)}if(Ce.update)for(const Oe of Ce.update){let Ge=ce.get(Oe.id);if(Ge==null)continue;const Ke=!Oe.removeAllProperties&&(((Pe=Oe.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0||((Se=Oe.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if((Oe.newGeometry||Oe.removeAllProperties||Ke)&&(Ge=Object.assign({},Ge),ce.set(Oe.id,Ge),Ke&&(Ge.properties=Object.assign({},Ge.properties))),Oe.newGeometry&&(Ge.geometry=Oe.newGeometry),Oe.removeAllProperties)Ge.properties={};else if(((W=Oe.removeProperties)===null||W===void 0?void 0:W.length)>0)for(const at of Oe.removeProperties)Object.prototype.hasOwnProperty.call(Ge.properties,at)&&delete Ge.properties[at];if(((Fe=Oe.addOrUpdateProperties)===null||Fe===void 0?void 0:Fe.length)>0)for(const{key:at,value:zt}of Oe.addOrUpdateProperties)Ge.properties[at]=zt}}(this._dataUpdateable,Z.dataDiff,ee),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Z){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Z){return this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId)}getClusterChildren(Z){return this._geoJSONIndex.getChildren(Z.clusterId)}getClusterLeaves(Z){return this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset)}}class an{constructor(Z){this.self=Z,this.actor=new d.C(Z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(X,ee)=>{if(this.externalWorkerSourceTypes[X])throw new Error(`Worker source with name "${X}" already registered.`);this.externalWorkerSourceTypes[X]=ee},this.self.addProtocol=d.bf,this.self.removeProtocol=d.bg,this.self.registerRTLTextPlugin=X=>{if(d.bA.isParsed())throw new Error("RTL text plugin already registered.");d.bA.setMethods(X)},this.actor.registerMessageHandler("LDT",(X,ee)=>this._getDEMWorkerSource(X,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RDT",(X,ee)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(X,ee.source).removeTile(ee)})),this.actor.registerMessageHandler("GCEZ",(X,ee)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ee.type,ee.source).getClusterExpansionZoom(ee)})),this.actor.registerMessageHandler("GCC",(X,ee)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ee.type,ee.source).getClusterChildren(ee)})),this.actor.registerMessageHandler("GCL",(X,ee)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(X,ee.type,ee.source).getClusterLeaves(ee)})),this.actor.registerMessageHandler("LD",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).loadData(ee)),this.actor.registerMessageHandler("LT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).loadTile(ee)),this.actor.registerMessageHandler("RT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).reloadTile(ee)),this.actor.registerMessageHandler("AT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).abortTile(ee)),this.actor.registerMessageHandler("RMT",(X,ee)=>this._getWorkerSource(X,ee.type,ee.source).removeTile(ee)),this.actor.registerMessageHandler("RS",(X,ee)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[X]||!this.workerSources[X][ee.type]||!this.workerSources[X][ee.type][ee.source])return;const ce=this.workerSources[X][ee.type][ee.source];delete this.workerSources[X][ee.type][ee.source],ce.removeSource!==void 0&&ce.removeSource(ee)})),this.actor.registerMessageHandler("RM",X=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[X],delete this.availableImages[X],delete this.workerSources[X],delete this.demWorkerSources[X]})),this.actor.registerMessageHandler("SR",(X,ee)=>d._(this,void 0,void 0,function*(){this.referrer=ee})),this.actor.registerMessageHandler("SRPS",(X,ee)=>this._syncRTLPluginState(X,ee)),this.actor.registerMessageHandler("IS",(X,ee)=>d._(this,void 0,void 0,function*(){this.self.importScripts(ee)})),this.actor.registerMessageHandler("SI",(X,ee)=>this._setImages(X,ee)),this.actor.registerMessageHandler("UL",(X,ee)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(X).update(ee.layers,ee.removedIds)})),this.actor.registerMessageHandler("SL",(X,ee)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(X).replace(ee)}))}_setImages(Z,X){return d._(this,void 0,void 0,function*(){this.availableImages[Z]=X;for(const ee in this.workerSources[Z]){const ce=this.workerSources[Z][ee];for(const Ce in ce)ce[Ce].availableImages=X}})}_syncRTLPluginState(Z,X){return d._(this,void 0,void 0,function*(){if(d.bA.isParsed())return d.bA.getState();if(X.pluginStatus!=="loading")return d.bA.setState(X),X;const ee=X.pluginURL;if(this.self.importScripts(ee),d.bA.isParsed()){const ce={pluginStatus:"loaded",pluginURL:ee};return d.bA.setState(ce),ce}throw d.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ee}`)})}_getAvailableImages(Z){let X=this.availableImages[Z];return X||(X=[]),X}_getLayerIndex(Z){let X=this.layerIndexes[Z];return X||(X=this.layerIndexes[Z]=new a),X}_getWorkerSource(Z,X,ee){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][X]||(this.workerSources[Z][X]={}),!this.workerSources[Z][X][ee]){const ce={sendAsync:(Ce,Ie)=>(Ce.targetMapId=Z,this.actor.sendAsync(Ce,Ie))};switch(X){case"vector":this.workerSources[Z][X][ee]=new S(ce,this._getLayerIndex(Z),this._getAvailableImages(Z));break;case"geojson":this.workerSources[Z][X][ee]=new ro(ce,this._getLayerIndex(Z),this._getAvailableImages(Z));break;default:this.workerSources[Z][X][ee]=new this.externalWorkerSourceTypes[X](ce,this._getLayerIndex(Z),this._getAvailableImages(Z))}}return this.workerSources[Z][X][ee]}_getDEMWorkerSource(Z,X){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][X]||(this.demWorkerSources[Z][X]=new C),this.demWorkerSources[Z][X]}}return d.i(self)&&(self.worker=new an(self)),an}),l("index",["exports","./shared"],function(d,a){var _="4.1.3";let x,k;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((o,h)=>{const p=requestAnimationFrame(o);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(y,o=0){return this.getImageCanvasContext(y).getImageData(-o,-o,y.width+2*o,y.height+2*o)},getImageCanvasContext(y){const o=window.document.createElement("canvas"),h=o.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return o.width=y.width,o.height=y.height,h.drawImage(y,0,0,y.width,y.height),h},resolveURL:y=>(x||(x=document.createElement("a")),x.href=y,x.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class C{static testProp(o){if(!C.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in C.docStyle)return o[h];return o[0]}static create(o,h,p){const m=window.document.createElement(o);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){C.docStyle&&C.selectProp&&(C.userSelect=C.docStyle[C.selectProp],C.docStyle[C.selectProp]="none")}static enableDrag(){C.docStyle&&C.selectProp&&(C.docStyle[C.selectProp]=C.userSelect)}static setTransform(o,h){o.style[C.transformProp]=h}static addEventListener(o,h,p,m={}){o.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(o,h,p,m={}){o.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",C.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",C.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",C.suppressClickInternal,!0)},0)}static getScale(o){const h=o.getBoundingClientRect();return{x:h.width/o.offsetWidth||1,y:h.height/o.offsetHeight||1,boundingClientRect:h}}static getPoint(o,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-o.clientLeft,(p.clientY-m.top)/h.y-o.clientTop)}static mousePos(o,h){const p=C.getScale(o);return C.getPoint(o,p,h)}static touchPos(o,h){const p=[],m=C.getScale(o);for(let v=0;v<h.length;v++)p.push(C.getPoint(o,m,h[v]));return p}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}C.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,C.selectProp=C.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),C.transformProp=C.testProp(["transform","WebkitTransform"]);const P={supported:!1,testSupport:function(y){!z&&O&&(B?N(y):D=y)}};let D,O,z=!1,B=!1;function N(y){const o=y.createTexture();y.bindTexture(y.TEXTURE_2D,o);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,O),y.isContextLost())return;P.supported=!0}catch{}y.deleteTexture(o),z=!0}var G;typeof document<"u"&&(O=document.createElement("img"),O.onload=function(){D&&N(D),D=null,B=!0},O.onerror=function(){z=!0,D=null},O.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let o,h,p,m;y.resetRequestQueue=()=>{o=[],h=0,p=0,m={}},y.addThrottleControl=A=>{const R=p++;return m[R]=A,R},y.removeThrottleControl=A=>{delete m[A],E()},y.getImage=(A,R,V=!0)=>new Promise((q,Y)=>{P.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*"),a.e(A,{type:"image"}),o.push({abortController:R,requestParameters:A,supportImageRefresh:V,state:"queued",onError:fe=>{Y(fe)},onSuccess:fe=>{q(fe)}}),E()});const v=A=>a._(this,void 0,void 0,function*(){A.state="running";const{requestParameters:R,supportImageRefresh:V,onError:q,onSuccess:Y,abortController:fe}=A,he=V===!1&&!a.i(self)&&!a.g(R.url)&&(!R.headers||Object.keys(R.headers).reduce((Te,qe)=>Te&&qe==="accept",!0));h++;const ye=he?M(R,fe):a.m(R,fe);try{const Te=yield ye;delete A.abortController,A.state="completed",Te.data instanceof HTMLImageElement||a.b(Te.data)?Y(Te):Te.data&&Y({data:yield(se=Te.data,typeof createImageBitmap=="function"?a.d(se):a.f(se)),cacheControl:Te.cacheControl,expires:Te.expires})}catch(Te){delete A.abortController,q(Te)}finally{h--,E()}var se}),E=()=>{const A=(()=>{for(const R of Object.keys(m))if(m[R]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let R=h;R<A&&o.length>0;R++){const V=o.shift();V.abortController.signal.aborted?R--:v(V)}},M=(A,R)=>new Promise((V,q)=>{const Y=new Image,fe=A.url,he=A.credentials;he&&he==="include"?Y.crossOrigin="use-credentials":(he&&he==="same-origin"||!a.s(fe))&&(Y.crossOrigin="anonymous"),R.signal.addEventListener("abort",()=>{Y.src="",q(a.c())}),Y.fetchPriority="high",Y.onload=()=>{Y.onerror=Y.onload=null,V({data:Y})},Y.onerror=()=>{Y.onerror=Y.onload=null,R.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Y.src=fe})}(G||(G={})),G.resetRequestQueue();class U{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,p){const m=function(v){const E=v.match(te);if(!E)throw new Error(`Unable to parse URL "${v}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(o);return m.path+=`${h}${p}`,function(v){const E=v.params.length?`?${v.params.join("&")}`:"";return`${v.protocol}://${v.authority}${v.path}${E}`}(m)}setTransformRequest(o){this._transformRequestFn=o}}const te=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function le(y){var o=new a.A(3);return o[0]=y[0],o[1]=y[1],o[2]=y[2],o}var $,J=function(y,o,h){return y[0]=o[0]-h[0],y[1]=o[1]-h[1],y[2]=o[2]-h[2],y};$=new a.A(3),a.A!=Float32Array&&($[0]=0,$[1]=0,$[2]=0);var _e=function(y){var o=y[0],h=y[1];return o*o+h*h};function ze(y){const o=[];if(typeof y=="string")o.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:p,url:m}of y){const v=`${p}${m}`;h.indexOf(v)===-1&&(h.push(v),o.push({id:p,url:m}))}}return o}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class re{constructor(o,h,p,m){this.context=o,this.format=p,this.texture=o.gl.createTexture(),this.update(h,m)}update(o,h,p){const{width:m,height:v}=o,E=!(this.size&&this.size[0]===m&&this.size[1]===v||p),{context:M}=this,{gl:A}=M;if(this.useMipmap=!!(h&&h.useMipmap),A.bindTexture(A.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===A.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[m,v],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?A.texImage2D(A.TEXTURE_2D,0,this.format,this.format,A.UNSIGNED_BYTE,o):A.texImage2D(A.TEXTURE_2D,0,this.format,m,v,0,this.format,A.UNSIGNED_BYTE,o.data);else{const{x:R,y:V}=p||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||a.b(o)?A.texSubImage2D(A.TEXTURE_2D,0,R,V,A.RGBA,A.UNSIGNED_BYTE,o):A.texSubImage2D(A.TEXTURE_2D,0,R,V,m,v,A.RGBA,A.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&A.generateMipmap(A.TEXTURE_2D)}bind(o,h,p){const{context:m}=this,{gl:v}=m;v.bindTexture(v.TEXTURE_2D,this.texture),p!==v.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=v.LINEAR),o!==this.filter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,o),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,p||o),this.filter=o),h!==this.wrap&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,h),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function ue(y){const{userImage:o}=y;return!!(o&&o.render&&o.render())&&(y.data.replace(new Uint8Array(o.data.buffer)),!0)}class He extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(o){const h=this.images[o];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${o}" has invalid "content" value`))),p=!1),p}_validateStretch(o,h){if(!o)return!0;let p=0;for(const m of o){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(o,h){if(!o)return!0;if(o.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,v=p&&p.height||h.data.height;return!(o[0]<0||m<o[0]||o[1]<0||v<o[1]||o[2]<0||m<o[2]||o[3]<0||v<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,h,p=!0){const m=this.getImage(o);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const v of o)this.images[v]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:h})})}_getImagesForIds(o){const h={};for(const p of o){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],p=this.getImage(o);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},v=new a.I(m,p);this.patterns[o]={bin:m,position:v}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new re(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const v in this.patterns)o.push(this.patterns[v].bin);const{w:h,h:p}=a.p(o),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const v in this.patterns){const{bin:E}=this.patterns[v],M=E.x+1,A=E.y+1,R=this.getImage(v).data,V=R.width,q=R.height;a.R.copy(R,m,{x:0,y:0},{x:M,y:A},{width:V,height:q}),a.R.copy(R,m,{x:0,y:q-1},{x:M,y:A-1},{width:V,height:1}),a.R.copy(R,m,{x:0,y:0},{x:M,y:A+q},{width:V,height:1}),a.R.copy(R,m,{x:V-1,y:0},{x:M-1,y:A},{width:1,height:q}),a.R.copy(R,m,{x:0,y:0},{x:M+V,y:A},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),ue(p)&&this.updateImage(h,p)}}}const Me=1e20;function ut(y,o,h,p,m,v,E,M,A){for(let R=o;R<o+p;R++)At(y,h*v+R,v,m,E,M,A);for(let R=h;R<h+m;R++)At(y,R*v+o,1,p,E,M,A)}function At(y,o,h,p,m,v,E){v[0]=0,E[0]=-Me,E[1]=Me,m[0]=y[o];for(let M=1,A=0,R=0;M<p;M++){m[M]=y[o+M*h];const V=M*M;do{const q=v[A];R=(m[M]-m[q]+V-q*q)/(M-q)/2}while(R<=E[A]&&--A>-1);A++,v[A]=M,E[A]=R,E[A+1]=Me}for(let M=0,A=0;M<p;M++){for(;E[A+1]<M;)A++;const R=v[A],V=M-R;y[o+M*h]=m[R]+V*V}}class Nt{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return a._(this,void 0,void 0,function*(){const h=[];for(const v in o)for(const E of o[v])h.push(this._getAndCacheGlyphsPromise(v,E));const p=yield Promise.all(h),m={};for(const{stack:v,id:E,glyph:M}of p)m[v]||(m[v]={}),m[v][E]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return m})}_getAndCacheGlyphsPromise(o,h){return a._(this,void 0,void 0,function*(){let p=this.entries[o];p||(p=this.entries[o]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:o,id:h,glyph:m};if(m=this._tinySDF(p,o,h),m)return p.glyphs[h]=m,{stack:o,id:h,glyph:m};const v=Math.floor(h/256);if(256*v>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[v])return{stack:o,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[v]){const M=Nt.loadGlyphRange(o,v,this.url,this.requestManager);p.requests[v]=M}const E=yield p.requests[v];for(const M in E)this._doesCharSupportLocalGlyph(+M)||(p.glyphs[+M]=E[+M]);return p.ranges[v]=!0,{stack:o,id:h,glyph:E[h]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](o)||a.u["Hangul Syllables"](o)||a.u.Hiragana(o)||a.u.Katakana(o))}_tinySDF(o,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let v=o.tinySDF;if(!v){let M="400";/bold/i.test(h)?M="900":/medium/i.test(h)?M="500":/light/i.test(h)&&(M="200"),v=o.tinySDF=new Nt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:M})}const E=v.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}Nt.loadGlyphRange=function(y,o,h,p){return a._(this,void 0,void 0,function*(){const m=256*o,v=m+255,E=p.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${m}-${v}`),"Glyphs"),M=yield a.l(E,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${o}, ${m}-${v}`);const A={};for(const R of a.n(M.data))A[R.id]=R;return A})},Nt.TinySDF=class{constructor({fontSize:y=24,buffer:o=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:v="normal",fontStyle:E="normal"}={}){this.buffer=o,this.cutoff=p,this.radius=h;const M=this.size=y+4*o,A=this._createCanvas(M),R=this.ctx=A.getContext("2d",{willReadFrequently:!0});R.font=`${E} ${v} ${y}px ${m}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(y){const o=document.createElement("canvas");return o.width=o.height=y,o}draw(y){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:v}=this.ctx.measureText(y),E=Math.ceil(h),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(v-m))),A=Math.min(this.size-this.buffer,E+Math.ceil(p)),R=M+2*this.buffer,V=A+2*this.buffer,q=Math.max(R*V,0),Y=new Uint8ClampedArray(q),fe={data:Y,width:R,height:V,glyphWidth:M,glyphHeight:A,glyphTop:E,glyphLeft:0,glyphAdvance:o};if(M===0||A===0)return fe;const{ctx:he,buffer:ye,gridInner:se,gridOuter:Te}=this;he.clearRect(ye,ye,M,A),he.fillText(y,ye,ye+E);const qe=he.getImageData(ye,ye,M,A);Te.fill(Me,0,q),se.fill(0,0,q);for(let we=0;we<A;we++)for(let Le=0;Le<M;Le++){const We=qe.data[4*(we*M+Le)+3]/255;if(We===0)continue;const $e=(we+ye)*R+Le+ye;if(We===1)Te[$e]=0,se[$e]=Me;else{const Xe=.5-We;Te[$e]=Xe>0?Xe*Xe:0,se[$e]=Xe<0?Xe*Xe:0}}ut(Te,0,0,R,V,R,this.f,this.v,this.z),ut(se,ye,ye,M,A,R,this.f,this.v,this.z);for(let we=0;we<q;we++){const Le=Math.sqrt(Te[we])-Math.sqrt(se[we]);Y[we]=Math.round(255-255*(Le/this.radius+this.cutoff))}return fe}};class Je{constructor(){this.specification=a.v.light.position}possiblyEvaluate(o,h){return a.y(o.expression.evaluate(h))}interpolate(o,h,p){return{x:a.z.number(o.x,h.x,p),y:a.z.number(o.y,h.y,p),z:a.z.number(o.z,h.z,p)}}}let Jt;class Kt extends a.E{constructor(o){super(),Jt=Jt||new a.q({anchor:new a.D(a.v.light.anchor),position:new Je,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Jt),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(a.r,o,h))for(const p in o){const m=o[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,p){return(!p||p.validate!==!1)&&a.t(this,o.call(a.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class Ut{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const p=o.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(o,h)),this.dashEntry[p]}getDashRanges(o,h,p){const m=[];let v=o.length%2==1?-o[o.length-1]*p:0,E=o[0]*p,M=!0;m.push({left:v,right:E,isDash:M,zeroLength:o[0]===0});let A=o[0];for(let R=1;R<o.length;R++){M=!M;const V=o[R];v=A*p,A+=V,E=A*p,m.push({left:v,right:E,isDash:M,zeroLength:V===0})}return m}addRoundDash(o,h,p){const m=h/2;for(let v=-p;v<=p;v++){const E=this.width*(this.nextRow+p+v);let M=0,A=o[M];for(let R=0;R<this.width;R++){R/A.right>1&&(A=o[++M]);const V=Math.abs(R-A.left),q=Math.abs(R-A.right),Y=Math.min(V,q);let fe;const he=v/p*(m+1);if(A.isDash){const ye=m-Math.abs(he);fe=Math.sqrt(Y*Y+ye*ye)}else fe=m-Math.sqrt(Y*Y+he*he);this.data[E+R]=Math.max(0,Math.min(255,fe+128))}}}addRegularDash(o){for(let M=o.length-1;M>=0;--M){const A=o[M],R=o[M+1];A.zeroLength?o.splice(M,1):R&&R.isDash===A.isDash&&(R.left=A.left,o.splice(M,1))}const h=o[0],p=o[o.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let v=0,E=o[v];for(let M=0;M<this.width;M++){M/E.right>1&&(E=o[++v]);const A=Math.abs(M-E.left),R=Math.abs(M-E.right),V=Math.min(A,R);this.data[m+M]=Math.max(0,Math.min(255,(E.isDash?V:-V)+128))}}addDash(o,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let v=0;for(let M=0;M<o.length;M++)v+=o[M];if(v!==0){const M=this.width/v,A=this.getDashRanges(o,this.width,M);h?this.addRoundDash(A,M,p):this.addRegularDash(A)}const E={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:v};return this.nextRow+=m,this.dirty=!0,E}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const Vt="maplibre_preloaded_worker_pool";class wt{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<wt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Vt]}numActive(){return Object.keys(this.active).length}}const Yt=Math.floor(S.hardwareConcurrency/2);let gr,Pt;function rr(){return gr||(gr=new wt),gr}wt.workerCount=a.B(globalThis)?Math.max(Math.min(Yt,3),1):1;class wr{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const v=new a.C(p[m],h);v.name=`Worker ${m}`,this.actors.push(v)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:o,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,h){for(const p of this.actors)p.registerMessageHandler(o,h)}}function mr(){return Pt||(Pt=new wr(rr(),a.G),Pt.registerMessageHandler("GR",(y,o,h)=>a.m(o,h))),Pt}function Rr(y,o){const h=a.F();return a.H(h,h,[1,1,0]),a.J(h,h,[.5*y.width,.5*y.height,1]),a.K(h,h,y.calculatePosMatrix(o.toUnwrapped()))}function ht(y,o,h,p,m,v){const E=function(q,Y,fe){if(q)for(const he of q){const ye=Y[he];if(ye&&ye.source===fe&&ye.type==="fill-extrusion")return!0}else for(const he in Y){const ye=Y[he];if(ye.source===fe&&ye.type==="fill-extrusion")return!0}return!1}(m&&m.layers,o,y.id),M=v.maxPitchScaleFactor(),A=y.tilesIn(p,M,E);A.sort(Mt);const R=[];for(const q of A)R.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(o,h,y._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,m,v,M,Rr(y.transform,q.tileID))});const V=function(q){const Y={},fe={};for(const he of q){const ye=he.queryResults,se=he.wrappedTileID,Te=fe[se]=fe[se]||{};for(const qe in ye){const we=ye[qe],Le=Te[qe]=Te[qe]||{},We=Y[qe]=Y[qe]||[];for(const $e of we)Le[$e.featureIndex]||(Le[$e.featureIndex]=!0,We.push($e))}}return Y}(R);for(const q in V)V[q].forEach(Y=>{const fe=Y.feature,he=y.getFeatureState(fe.layer["source-layer"],fe.id);fe.source=fe.layer.source,fe.layer["source-layer"]&&(fe.sourceLayer=fe.layer["source-layer"]),fe.state=he});return V}function Mt(y,o){const h=y.tileID,p=o.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function De(y,o,h){return a._(this,void 0,void 0,function*(){let p=y;if(y.url?p=(yield a.h(o.transformRequest(y.url,"Source"),h)).data:yield S.frameAsync(h),!p)return null;const m=a.L(a.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(v=>v.id)),m})}class lt{constructor(o,h){o&&(h?this.setSouthWest(o).setNorthEast(h):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof a.M?new a.M(o.lng,o.lat):a.M.convert(o),this}setSouthWest(o){return this._sw=o instanceof a.M?new a.M(o.lng,o.lat):a.M.convert(o),this}extend(o){const h=this._sw,p=this._ne;let m,v;if(o instanceof a.M)m=o,v=o;else{if(!(o instanceof lt))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(lt.convert(o)):this.extend(a.M.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(a.M.convert(o)):this;if(m=o._sw,v=o._ne,!m||!v)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(v.lng,p.lng),p.lat=Math.max(v.lat,p.lat)):(this._sw=new a.M(m.lng,m.lat),this._ne=new a.M(v.lng,v.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:h,lat:p}=a.M.convert(o);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(o){return o instanceof lt?o:o&&new lt(o)}static fromLngLat(o,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*o.lat);return new lt(new a.M(o.lng-m,o.lat-p),new a.M(o.lng+m,o.lat+p))}}class nt{constructor(o,h,p){this.bounds=lt.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),p=Math.floor(a.N(this.bounds.getWest())*h),m=Math.floor(a.O(this.bounds.getNorth())*h),v=Math.ceil(a.N(this.bounds.getEast())*h),E=Math.ceil(a.O(this.bounds.getSouth())*h);return o.x>=p&&o.x<v&&o.y>=m&&o.y<E}}class xt extends a.E{constructor(o,h,p,m){if(super(),this.id=o,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield De(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(a.e(this,o),o.bounds&&(this.tileBounds=new nt(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((v,E)=>{o.reloadPromise={resolve:v,reject:E}})}else o.actor=this.dispatcher.getActor(),m="LT";o.abortController=new AbortController;try{const v=yield o.actor.sendAsync({type:m,data:p},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,v)}catch(v){if(delete o.abortController,o.aborted)return;if(v&&v.status!==404)throw v;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,h){if(h&&h.resourceTiming&&(o.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&o.setExpiryData(h),o.loadVectorData(h,this.map.painter),o.reloadPromise){const p=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(p.resolve).catch(p.reject)}}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class ne extends a.E{constructor(o,h,p,m){super(),this.id=o,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.L(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield De(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(a.e(this,o),o.bounds&&(this.tileBounds=new nt(o.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new a.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return a.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const p=yield G.getImage(this.map._requestManager.transformRequest(h,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&o.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,v=m.gl,E=p.data;o.texture=this.map.painter.getTileTexture(E.width),o.texture?o.texture.update(E,{useMipmap:!0}):(o.texture=new re(m,E,v.RGBA,{useMipmap:!0}),o.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE,v.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&v.texParameterf(v.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),o.state="loaded"}}catch(p){if(delete o.abortController,o.aborted)o.state="unloaded";else if(p)throw o.state="errored",p}})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class nr extends ne{constructor(o,h,p,m){super(o,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const m=yield G.getImage(p,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(m&&m.data){const v=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&o.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const E=a.b(v)&&a.S()?v:yield this.readImageNow(v),M={type:this.type,uid:o.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const A=yield o.actor.sendAsync({type:"LDT",data:M});o.dem=A,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(m){if(delete o.abortController,o.aborted)o.state="unloaded";else if(m)throw o.state="errored",m}})}readImageNow(o){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const h=o.width+2,p=o.height+2;try{return new a.R({width:h,height:p},yield a.V(o,-1,-1,h,p))}catch{}}return S.getImageData(o,1)})}_getNeighboringTiles(o){const h=o.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,v=h.x===0?o.wrap-1:o.wrap,E=(h.x+1+p)%p,M=h.x+1===p?o.wrap+1:o.wrap,A={};return A[new a.Q(o.overscaledZ,v,h.z,m,h.y).key]={backfilled:!1},A[new a.Q(o.overscaledZ,M,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(A[new a.Q(o.overscaledZ,v,h.z,m,h.y-1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,M,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<p&&(A[new a.Q(o.overscaledZ,v,h.z,m,h.y+1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},A[new a.Q(o.overscaledZ,M,h.z,E,h.y+1).key]={backfilled:!1}),A}unloadTile(o){return a._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class Be extends a.E{constructor(o,h,p,m){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const v=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*v,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*v,extent:a.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.W,radius:(h.clusterRadius||50)*v,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:h,offset:p}})}_updateWorkerData(o){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);o?h.dataDiff=o:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const v={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(v,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},v),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(o){return a._(this,void 0,void 0,function*(){const h=o.actor?"RT":"LT";o.actor=this.actor;const p={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(o){return a._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return a._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ze=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class bt extends a.E{constructor(o,h,p,m){super(),this.id=o,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(o){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield G.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,o&&(this.coordinates=o),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const h=o.map(a.Y.fromLngLat);this.tileID=function(m){let v=1/0,E=1/0,M=-1/0,A=-1/0;for(const Y of m)v=Math.min(v,Y.x),E=Math.min(E,Y.y),M=Math.max(M,Y.x),A=Math.max(A,Y.y);const R=Math.max(M-v,A-E),V=Math.max(0,Math.floor(-Math.log(R)/Math.LN2)),q=Math.pow(2,V);return new a.a0(V,Math.floor((v+M)/2*q),Math.floor((E+A)/2*q))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ze.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new re(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class bn extends bt{constructor(o,h,p,m){super(o,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Ze.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new re(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const v=this.tiles[m];v.state!=="loaded"&&(v.state="loaded",v.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class wn extends bt{constructor(o,h,p,m){super(o,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a1(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Ze.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new re(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const v in this.tiles){const E=this.tiles[v];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Mn={},ni=y=>{switch(y){case"geojson":return Be;case"image":return bt;case"raster":return ne;case"raster-dem":return nr;case"vector":return xt;case"video":return bn;case"canvas":return wn}return Mn[y]},ii="RTLPluginLoaded";class $o extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=mr()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=S.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(ii))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Jr=null;function st(){return Jr||(Jr=new $o),Jr}class Xn{constructor(o,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=a.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,v){const E={};if(!v)return E;for(const M of m){const A=M.layerIds.map(R=>v.getLayer(R)).filter(Boolean);if(A.length!==0){M.layers=A,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(R=>A.filter(V=>V.id===R)[0]));for(const R of A)E[R.id]=M}}return E}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a5){if(this.hasSymbolBuckets=!0,!p)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const v=this.buckets[m];if(v instanceof a.a5&&v.hasRTLText){this.hasRTLText=!0,st().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const v=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(v))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new re(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new re(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,p,m,v,E,M,A,R,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:v,scale:E,tileSize:this.tileSize,pixelPosMatrix:V,transform:A,params:M,queryPadding:this.queryPadding*R},o,h,p):{}}querySourceFeatures(o,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),v=h&&h.sourceLayer?h.sourceLayer:"",E=m._geojsonTileLayer||m[v];if(!E)return;const M=a.a6(h&&h.filter),{z:A,x:R,y:V}=this.tileID.canonical,q={z:A,x:R,y:V};for(let Y=0;Y<E.length;Y++){const fe=E.feature(Y);if(M.needGeometry){const se=a.a7(fe,!0);if(!M.filter(new a.a8(this.tileID.overscaledZ),se,this.tileID.canonical))continue}else if(!M.filter(new a.a8(this.tileID.overscaledZ),fe))continue;const he=p.getId(fe,v),ye=new a.a9(fe,A,R,V,he);ye.tile=q,o.push(ye)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const p=a.aa(o.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const v=this.expirationTime-h;v?this.expirationTime=p+Math.max(v,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const v=this.buckets[m],E=v.layers[0].sourceLayer||"_geojsonTileLayer",M=p[E],A=o[E];if(!M||!A||Object.keys(A).length===0)continue;v.update(A,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const R=h&&h.style&&h.style.getLayer(m);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(v)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=S.now()+o}setDependencies(o,h){const p={};for(const m of h)p[m]=!0;this.dependencies[o]=p}hasDependency(o,h){for(const p of o){const m=this.dependencies[p];if(m){for(const v of h)if(m[v])return!0}}return!1}}class xn{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,p){const m=o.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const v={value:h,timeout:void 0};if(p!==void 0&&(v.timeout=setTimeout(()=>{this.remove(o,v)},p)),this.data[m].push(v),this.order.push(m),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const p=o.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),v=this.data[p][m];return this.data[p].splice(m,1),v.timeout&&clearTimeout(v.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(v.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const p in this.data)for(const m of this.data[p])o(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class Bo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,p){const m=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},a.e(this.stateChanges[o][m],p),this.deletedStates[o]===null){this.deletedStates[o]={};for(const v in this.state[o])v!==m&&(this.deletedStates[o][v]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][m]===null){this.deletedStates[o][m]={};for(const v in this.state[o][m])p[v]||(this.deletedStates[o][m][v]=null)}else for(const v in p)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][v]===null&&delete this.deletedStates[o][m][v]}removeFeatureState(o,h,p){if(this.deletedStates[o]===null)return;const m=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},p&&h!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][p]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(p in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][p]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,h){const p=String(h),m=a.e({},(this.state[o]||{})[p],(this.stateChanges[o]||{})[p]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const v=this.deletedStates[o][h];if(v===null)return{};for(const E in v)delete m[E]}return m}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const v={};for(const E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),a.e(this.state[m][E],this.stateChanges[m][E]),v[E]=this.state[m][E];p[m]=v}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const v={};if(this.deletedStates[m]===null)for(const E in this.state[m])v[E]={},this.state[m][E]={};else for(const E in this.deletedStates[m]){if(this.deletedStates[m][E]===null)this.state[m][E]={};else for(const M of Object.keys(this.deletedStates[m][E]))delete this.state[m][E][M];v[E]=this.state[m][E]}p[m]=p[m]||{},a.e(p[m],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in o)o[m].setFeatureState(p,h)}}class Or extends a.E{constructor(o,h,p){super(),this.id=o,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,v,E,M)=>{const A=new(ni(v.type))(m,v,E,M);if(A.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${A.id}`);return A})(o,h,p,this),this._tiles={},this._cache=new xn(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Bo,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,h,p)}catch(m){o.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new a.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(o),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(pt).map(o=>o.key)}getRenderableIds(o){const h=[];for(const p in this._tiles)this._isIdRenderable(p,o)&&h.push(this._tiles[p]);return o?h.sort((p,m)=>{const v=p.tileID,E=m.tileID,M=new a.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),A=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-E.overscaledZ||A.y-M.y||A.x-M.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(pt).map(p=>p.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[o];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,o,h))})}_tileLoaded(o,h,p){o.timeAdded=S.now(),p==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const v=h[m];if(o.neighboringTiles&&o.neighboringTiles[v]){const E=this.getTileByID(v);p(o,E),p(E,o)}}function p(m,v){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let E=v.tileID.canonical.x-m.tileID.canonical.x;const M=v.tileID.canonical.y-m.tileID.canonical.y,A=Math.pow(2,m.tileID.canonical.z),R=v.tileID.key;E===0&&M===0||Math.abs(M)>1||(Math.abs(E)>1&&(Math.abs(E+A)===1?E+=A:Math.abs(E-A)===1&&(E-=A)),v.dem&&m.dem&&(m.dem.backfillBorder(v.dem,E,M),m.neighboringTiles&&m.neighboringTiles[R]&&(m.neighboringTiles[R].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,p,m){for(const v in this._tiles){let E=this._tiles[v];if(m[v]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>p)continue;let M=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const R=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[R.key],E&&E.hasData()&&(M=R)}let A=M;for(;A.overscaledZ>h;)if(A=A.scaledTo(A.overscaledZ-1),o[A.key]){m[M.key]=M;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const p=this._loadedParentTiles[o.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=o.overscaledZ-1;p>=h;p--){const m=o.scaledTo(p),v=this._getLoadedTile(m);if(v)return v}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,p=Math.ceil(o.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),v=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(v)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const p={};for(const m in this._tiles){const v=this._tiles[m];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+h),p[v.tileID.key]=v}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(o,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=o,this.terrain=h,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(V=>new a.Q(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)):(p=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter(V=>this._source.hasTile(V)))):p=[];const m=o.coveringZoomLevel(this._source),v=Math.max(m-Or.maxOverzooming,this._source.minzoom),E=Math.max(m+Or.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const V={};for(const q of p)if(q.canonical.z>this._source.minzoom){const Y=q.scaledTo(q.canonical.z-1);V[Y.key]=Y;const fe=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));V[fe.key]=fe}p=p.concat(Object.values(V))}const M=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const A=this._updateRetainedTiles(p,m);if(ir(this._source.type)){const V={},q={},Y=Object.keys(A),fe=S.now();for(const he of Y){const ye=A[he],se=this._tiles[he];if(!se||se.fadeEndTime!==0&&se.fadeEndTime<=fe)continue;const Te=this.findLoadedParent(ye,v);Te&&(this._addTile(Te.tileID),V[Te.tileID.key]=Te.tileID),q[he]=ye}this._retainLoadedChildren(q,m,E,A);for(const he in V)A[he]||(this._coveredTiles[he]=!0,A[he]=V[he]);if(h){const he={},ye={};for(const se of p)this._tiles[se.key].hasData()?he[se.key]=se:ye[se.key]=se;for(const se in ye){const Te=ye[se].children(this._source.maxzoom);this._tiles[Te[0].key]&&this._tiles[Te[1].key]&&this._tiles[Te[2].key]&&this._tiles[Te[3].key]&&(he[Te[0].key]=A[Te[0].key]=Te[0],he[Te[1].key]=A[Te[1].key]=Te[1],he[Te[2].key]=A[Te[2].key]=Te[2],he[Te[3].key]=A[Te[3].key]=Te[3],delete ye[se])}for(const se in ye){const Te=this.findLoadedParent(ye[se],this._source.minzoom);if(Te){he[Te.tileID.key]=A[Te.tileID.key]=Te.tileID;for(const qe in he)he[qe].isChildOf(Te.tileID)&&delete he[qe]}}for(const se in this._tiles)he[se]||(this._coveredTiles[se]=!0)}}for(const V in A)this._tiles[V].clearFadeHold();const R=a.ab(this._tiles,A);for(const V of R){const q=this._tiles[V];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile(V)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const p={},m={},v=Math.max(h-Or.maxOverzooming,this._source.minzoom),E=Math.max(h+Or.maxUnderzooming,this._source.minzoom),M={};for(const A of o){const R=this._addTile(A);p[A.key]=A,R.hasData()||h<this._source.maxzoom&&(M[A.key]=A)}this._retainLoadedChildren(M,h,E,p);for(const A of o){let R=this._tiles[A.key];if(R.hasData())continue;if(h+1>this._source.maxzoom){const q=A.children(this._source.maxzoom)[0],Y=this.getTile(q);if(Y&&Y.hasData()){p[q.key]=q;continue}}else{const q=A.children(this._source.maxzoom);if(p[q[0].key]&&p[q[1].key]&&p[q[2].key]&&p[q[3].key])continue}let V=R.wasRequested();for(let q=A.overscaledZ-1;q>=v;--q){const Y=A.scaledTo(q);if(m[Y.key])break;if(m[Y.key]=!0,R=this.getTile(Y),!R&&V&&(R=this._addTile(Y)),R){const fe=R.hasData();if((V||fe)&&(p[Y.key]=Y),V=R.wasRequested(),fe)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let p,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const v=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(v),p)break;m=v}for(const v of h)this._loadedParentTiles[v]=p}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const p=h;return h||(h=new Xn(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,o.key,h.state)),h.uses++,this._tiles[o.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const p=h.getExpiryTimeout();p&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},p))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(o){const h=o.sourceDataType;o.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,p){const m=[],v=this.transform;if(!v)return m;const E=p?v.getCameraQueryGeometry(o):o,M=o.map(he=>v.pointCoordinate(he,this.terrain)),A=E.map(he=>v.pointCoordinate(he,this.terrain)),R=this.getIds();let V=1/0,q=1/0,Y=-1/0,fe=-1/0;for(const he of A)V=Math.min(V,he.x),q=Math.min(q,he.y),Y=Math.max(Y,he.x),fe=Math.max(fe,he.y);for(let he=0;he<R.length;he++){const ye=this._tiles[R[he]];if(ye.holdingForFade())continue;const se=ye.tileID,Te=Math.pow(2,v.zoom-ye.tileID.overscaledZ),qe=h*ye.queryPadding*a.W/ye.tileSize/Te,we=[se.getTilePoint(new a.Y(V,q)),se.getTilePoint(new a.Y(Y,fe))];if(we[0].x-qe<a.W&&we[0].y-qe<a.W&&we[1].x+qe>=0&&we[1].y+qe>=0){const Le=M.map($e=>se.getTilePoint($e)),We=A.map($e=>se.getTilePoint($e));m.push({tile:ye,tileID:se,queryGeometry:Le,cameraQueryGeometry:We,scale:Te})}}return m}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(ir(this._source.type)){const o=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=o)return!0}return!1}setFeatureState(o,h,p){this._state.updateState(o=o||"_geojsonTileLayer",h,p)}removeFeatureState(o,h,p){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,p)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,p){const m=this._tiles[o];m&&m.setDependencies(h,p)}reloadTilesForDependencies(o,h){for(const p in this._tiles)this._tiles[p].hasDependency(o,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(o,h))}}function pt(y,o){const h=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*o.wrap)-+(o.wrap<0);return y.overscaledZ-o.overscaledZ||p-h||o.canonical.y-y.canonical.y||o.canonical.x-y.canonical.x}function ir(y){return y==="raster"||y==="image"||y==="video"}Or.maxOverzooming=10,Or.maxUnderzooming=3;class Qt{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=a.ac(o,0,1);let h=1,p=this._distances[h];const m=o*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const v=h-1,E=this._distances[v],M=p-E,A=M>0?(m-E)/M:0;return this.points[v].mult(1-A).add(this.points[h].mult(A))}}function Nr(y,o){let h=!0;return y==="always"||y!=="never"&&o!=="never"||(h=!1),h}class vi{constructor(o,h,p){const m=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(o/p),this.yCellCount=Math.ceil(h/p);for(let E=0;E<this.xCellCount*this.yCellCount;E++)m.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,p,m,v){this._forEachCell(h,p,m,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(v)}insertCircle(o,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(o,h,p,m,v,E){this.boxCells[v].push(E)}_insertCircleCell(o,h,p,m,v,E){this.circleCells[v].push(E)}_query(o,h,p,m,v,E,M){if(p<0||o>this.width||m<0||h>this.height)return[];const A=[];if(o<=0&&h<=0&&this.width<=p&&this.height<=m){if(v)return[{key:null,x1:o,y1:h,x2:p,y2:m}];for(let R=0;R<this.boxKeys.length;R++)A.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const V=this.circles[3*R],q=this.circles[3*R+1],Y=this.circles[3*R+2];A.push({key:this.circleKeys[R],x1:V-Y,y1:q-Y,x2:V+Y,y2:q+Y})}}else this._forEachCell(o,h,p,m,this._queryCell,A,{hitTest:v,overlapMode:E,seenUids:{box:{},circle:{}}},M);return A}query(o,h,p,m){return this._query(o,h,p,m,!1,null)}hitTest(o,h,p,m,v,E){return this._query(o,h,p,m,!0,v,E).length>0}hitTestCircle(o,h,p,m,v){const E=o-p,M=o+p,A=h-p,R=h+p;if(M<0||E>this.width||R<0||A>this.height)return!1;const V=[];return this._forEachCell(E,A,M,R,this._queryCellCircle,V,{hitTest:!0,overlapMode:m,circle:{x:o,y:h,radius:p},seenUids:{box:{},circle:{}}},v),V.length>0}_queryCell(o,h,p,m,v,E,M,A){const{seenUids:R,hitTest:V,overlapMode:q}=M,Y=this.boxCells[v];if(Y!==null){const he=this.bboxes;for(const ye of Y)if(!R.box[ye]){R.box[ye]=!0;const se=4*ye,Te=this.boxKeys[ye];if(o<=he[se+2]&&h<=he[se+3]&&p>=he[se+0]&&m>=he[se+1]&&(!A||A(Te))&&(!V||!Nr(q,Te.overlapMode))&&(E.push({key:Te,x1:he[se],y1:he[se+1],x2:he[se+2],y2:he[se+3]}),V))return!0}}const fe=this.circleCells[v];if(fe!==null){const he=this.circles;for(const ye of fe)if(!R.circle[ye]){R.circle[ye]=!0;const se=3*ye,Te=this.circleKeys[ye];if(this._circleAndRectCollide(he[se],he[se+1],he[se+2],o,h,p,m)&&(!A||A(Te))&&(!V||!Nr(q,Te.overlapMode))){const qe=he[se],we=he[se+1],Le=he[se+2];if(E.push({key:Te,x1:qe-Le,y1:we-Le,x2:qe+Le,y2:we+Le}),V)return!0}}}return!1}_queryCellCircle(o,h,p,m,v,E,M,A){const{circle:R,seenUids:V,overlapMode:q}=M,Y=this.boxCells[v];if(Y!==null){const he=this.bboxes;for(const ye of Y)if(!V.box[ye]){V.box[ye]=!0;const se=4*ye,Te=this.boxKeys[ye];if(this._circleAndRectCollide(R.x,R.y,R.radius,he[se+0],he[se+1],he[se+2],he[se+3])&&(!A||A(Te))&&!Nr(q,Te.overlapMode))return E.push(!0),!0}}const fe=this.circleCells[v];if(fe!==null){const he=this.circles;for(const ye of fe)if(!V.circle[ye]){V.circle[ye]=!0;const se=3*ye,Te=this.circleKeys[ye];if(this._circlesCollide(he[se],he[se+1],he[se+2],R.x,R.y,R.radius)&&(!A||A(Te))&&!Nr(q,Te.overlapMode))return E.push(!0),!0}}}_forEachCell(o,h,p,m,v,E,M,A){const R=this._convertToXCellCoord(o),V=this._convertToYCellCoord(h),q=this._convertToXCellCoord(p),Y=this._convertToYCellCoord(m);for(let fe=R;fe<=q;fe++)for(let he=V;he<=Y;he++)if(v.call(this,o,h,p,m,this.xCellCount*he+fe,E,M,A))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,p,m,v,E){const M=m-o,A=v-h,R=p+E;return R*R>M*M+A*A}_circleAndRectCollide(o,h,p,m,v,E,M){const A=(E-m)/2,R=Math.abs(o-(m+A));if(R>A+p)return!1;const V=(M-v)/2,q=Math.abs(h-(v+V));if(q>V+p)return!1;if(R<=A||q<=V)return!0;const Y=R-A,fe=q-V;return Y*Y+fe*fe<=p*p}}function tr(y,o,h,p,m){const v=a.F();return o?(a.J(v,v,[1/m,1/m,1]),h||a.ad(v,v,p.angle)):a.K(v,p.labelPlaneMatrix,y),v}function ro(y,o,h,p,m){if(o){const v=a.ae(y);return a.J(v,v,[m,m,1]),h||a.ad(v,v,-p.angle),v}return p.glCoordMatrix}function an(y,o,h){let p;h?(p=[y.x,y.y,h(y.x,y.y),1],a.af(p,p,o)):(p=[y.x,y.y,0,1],Ke(p,p,o));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function me(y,o){return .5+y/o*.5}function Z(y,o){const h=y[0]/y[3],p=y[1]/y[3];return h>=-o[0]&&h<=o[0]&&p>=-o[1]&&p<=o[1]}function X(y,o,h,p,m,v,E,M,A,R){const V=p?y.textSizeData:y.iconSizeData,q=a.ag(V,h.transform.zoom),Y=[256/h.width*2+1,256/h.height*2+1],fe=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;fe.clear();const he=y.lineVertexArray,ye=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,se=h.transform.width/h.transform.height;let Te=!1;for(let qe=0;qe<ye.length;qe++){const we=ye.get(qe);if(we.hidden||we.writingMode===a.ah.vertical&&!Te){Ge(we.numGlyphs,fe);continue}let Le;if(Te=!1,R?(Le=[we.anchorX,we.anchorY,R(we.anchorX,we.anchorY),1],a.af(Le,Le,o)):(Le=[we.anchorX,we.anchorY,0,1],Ke(Le,Le,o)),!Z(Le,Y)){Ge(we.numGlyphs,fe);continue}const We=me(h.transform.cameraToCenterDistance,Le[3]),$e=a.ai(V,q,we),Xe=E?$e/We:$e*We,rt=new a.P(we.anchorX,we.anchorY),et=an(rt,m,R).point,ft={projections:{},offsets:{}},mt=Ce(we,Xe,!1,M,o,m,v,y.glyphOffsetArray,he,fe,et,rt,ft,se,A,R);Te=mt.useVertical,(mt.notEnoughRoom||Te||mt.needsFlipping&&Ce(we,Xe,!0,M,o,m,v,y.glyphOffsetArray,he,fe,et,rt,ft,se,A,R).notEnoughRoom)&&Ge(we.numGlyphs,fe)}p?y.text.dynamicLayoutVertexBuffer.updateData(fe):y.icon.dynamicLayoutVertexBuffer.updateData(fe)}function ee(y,o,h,p,m,v,E,M,A,R,V,q,Y){const fe=M.glyphStartIndex+M.numGlyphs,he=M.lineStartIndex,ye=M.lineStartIndex+M.lineLength,se=o.getoffsetX(M.glyphStartIndex),Te=o.getoffsetX(fe-1),qe=Fe(y*se,h,p,m,v,E,M.segment,he,ye,A,R,V,q,Y);if(!qe)return null;const we=Fe(y*Te,h,p,m,v,E,M.segment,he,ye,A,R,V,q,Y);return we?{first:qe,last:we}:null}function ce(y,o,h,p){return y===a.ah.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*p?{useVertical:!0}:(y===a.ah.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function Ce(y,o,h,p,m,v,E,M,A,R,V,q,Y,fe,he,ye){const se=o/24,Te=y.lineOffsetX*se,qe=y.lineOffsetY*se;let we;if(y.numGlyphs>1){const Le=y.glyphStartIndex+y.numGlyphs,We=y.lineStartIndex,$e=y.lineStartIndex+y.lineLength,Xe=ee(se,M,Te,qe,h,V,q,y,A,v,Y,he,ye);if(!Xe)return{notEnoughRoom:!0};const rt=an(Xe.first.point,E,ye).point,et=an(Xe.last.point,E,ye).point;if(p&&!h){const ft=ce(y.writingMode,rt,et,fe);if(ft)return ft}we=[Xe.first];for(let ft=y.glyphStartIndex+1;ft<Le-1;ft++)we.push(Fe(se*M.getoffsetX(ft),Te,qe,h,V,q,y.segment,We,$e,A,v,Y,he,ye));we.push(Xe.last)}else{if(p&&!h){const We=an(q,m,ye).point,$e=y.lineStartIndex+y.segment+1,Xe=new a.P(A.getx($e),A.gety($e)),rt=an(Xe,m,ye),et=rt.signedDistanceFromCamera>0?rt.point:Ie(q,Xe,We,1,m,ye),ft=ce(y.writingMode,We,et,fe);if(ft)return ft}const Le=Fe(se*M.getoffsetX(y.glyphStartIndex),Te,qe,h,V,q,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,A,v,Y,he,ye);if(!Le)return{notEnoughRoom:!0};we=[Le]}for(const Le of we)a.aj(R,Le.point,Le.angle);return{}}function Ie(y,o,h,p,m,v){const E=an(y.add(y.sub(o)._unit()),m,v).point,M=h.sub(E);return h.add(M._mult(p/M.mag()))}function Pe(y,o){const{projectionCache:h,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:v,distanceFromAnchor:E,getElevation:M,previousVertex:A,direction:R,absOffsetX:V}=o;if(h.projections[y])return h.projections[y];const q=new a.P(p.getx(y),p.gety(y)),Y=an(q,m,M);if(Y.signedDistanceFromCamera>0)return h.projections[y]=Y.point,Y.point;const fe=y-R;return Ie(E===0?v:new a.P(p.getx(fe),p.gety(fe)),q,A,V-E+1,m,M)}function Se(y,o,h){return y._unit()._perp()._mult(o*h)}function W(y,o,h,p,m,v,E,M){const{projectionCache:A,direction:R}=M;if(A.offsets[y])return A.offsets[y];const V=h.add(o);if(y+R<p||y+R>=m)return A.offsets[y]=V,V;const q=Pe(y+R,M),Y=Se(q.sub(h),E,R),fe=h.add(Y),he=q.add(Y);return A.offsets[y]=a.ak(v,V,fe,he)||V,A.offsets[y]}function Fe(y,o,h,p,m,v,E,M,A,R,V,q,Y,fe){const he=p?y-o:y+o;let ye=he>0?1:-1,se=0;p&&(ye*=-1,se=Math.PI),ye<0&&(se+=Math.PI);let Te,qe,we=ye>0?M+E:M+E+1,Le=m,We=m,$e=0,Xe=0;const rt=Math.abs(he),et=[];let ft;for(;$e+Xe<=rt;){if(we+=ye,we<M||we>=A)return null;$e+=Xe,We=Le,qe=Te;const gt={projectionCache:q,lineVertexArray:R,labelPlaneMatrix:V,tileAnchorPoint:v,distanceFromAnchor:$e,getElevation:fe,previousVertex:We,direction:ye,absOffsetX:rt};if(Le=Pe(we,gt),h===0)et.push(We),ft=Le.sub(We);else{let Xt;const sr=Le.sub(We);Xt=sr.mag()===0?Se(Pe(we+ye,gt).sub(Le),h,ye):Se(sr,h,ye),qe||(qe=We.add(Xt)),Te=W(we,Xt,Le,M,A,qe,h,gt),et.push(qe),ft=Te.sub(qe)}Xe=ft.mag()}const mt=ft._mult((rt-$e)/Xe)._add(qe||We),or=se+Math.atan2(Le.y-We.y,Le.x-We.x);return et.push(mt),{point:mt,angle:Y?or:0,path:et}}const Oe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ge(y,o){for(let h=0;h<y;h++){const p=o.length;o.resize(p+4),o.float32.set(Oe,3*p)}}function Ke(y,o,h){const p=o[0],m=o[1];return y[0]=h[0]*p+h[4]*m+h[12],y[1]=h[1]*p+h[5]*m+h[13],y[3]=h[3]*p+h[7]*m+h[15],y}const at=100;class zt{constructor(o,h=new vi(o.width+200,o.height+200,25),p=new vi(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+at,this.screenBottomBoundary=o.height+at,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,p,m,v,E){const M=this.projectAndGetPerspectiveRatio(m,o.anchorPointX,o.anchorPointY,E),A=p*M.perspectiveRatio,R=o.x1*A+M.point.x,V=o.y1*A+M.point.y,q=o.x2*A+M.point.x,Y=o.y2*A+M.point.y;return!this.isInsideGrid(R,V,q,Y)||h!=="always"&&this.grid.hitTest(R,V,q,Y,h,v)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[R,V,q,Y],offscreen:this.isOffscreen(R,V,q,Y)}}placeCollisionCircles(o,h,p,m,v,E,M,A,R,V,q,Y,fe,he){const ye=[],se=new a.P(h.anchorX,h.anchorY),Te=an(se,E,he),qe=me(this.transform.cameraToCenterDistance,Te.signedDistanceFromCamera),we=(V?v/qe:v*qe)/a.ao,Le=an(se,M,he).point,We=ee(we,m,h.lineOffsetX*we,h.lineOffsetY*we,!1,Le,se,h,p,M,{projections:{},offsets:{}},!1,he);let $e=!1,Xe=!1,rt=!0;if(We){const et=.5*Y*qe+fe,ft=new a.P(-100,-100),mt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),or=new Qt,gt=We.first,Xt=We.last;let sr=[];for(let cr=gt.path.length-1;cr>=1;cr--)sr.push(gt.path[cr]);for(let cr=1;cr<Xt.path.length;cr++)sr.push(Xt.path[cr]);const Sr=2.5*et;if(A){const cr=sr.map(fr=>an(fr,A,he));sr=cr.some(fr=>fr.signedDistanceFromCamera<=0)?[]:cr.map(fr=>fr.point)}let er=[];if(sr.length>0){const cr=sr[0].clone(),fr=sr[0].clone();for(let hn=1;hn<sr.length;hn++)cr.x=Math.min(cr.x,sr[hn].x),cr.y=Math.min(cr.y,sr[hn].y),fr.x=Math.max(fr.x,sr[hn].x),fr.y=Math.max(fr.y,sr[hn].y);er=cr.x>=ft.x&&fr.x<=mt.x&&cr.y>=ft.y&&fr.y<=mt.y?[sr]:fr.x<ft.x||cr.x>mt.x||fr.y<ft.y||cr.y>mt.y?[]:a.al([sr],ft.x,ft.y,mt.x,mt.y)}for(const cr of er){or.reset(cr,.25*et);let fr=0;fr=or.length<=.5*et?1:Math.ceil(or.paddedLength/Sr)+1;for(let hn=0;hn<fr;hn++){const Dr=hn/Math.max(fr-1,1),Oi=or.lerp(Dr),Fn=Oi.x+at,nn=Oi.y+at;ye.push(Fn,nn,et,0);const On=Fn-et,Ni=nn-et,bo=Fn+et,ts=nn+et;if(rt=rt&&this.isOffscreen(On,Ni,bo,ts),Xe=Xe||this.isInsideGrid(On,Ni,bo,ts),o!=="always"&&this.grid.hitTestCircle(Fn,nn,et,o,q)&&($e=!0,!R))return{circles:[],offscreen:!1,collisionDetected:$e}}}}return{circles:!R&&$e||!Xe||qe<this.perspectiveRatioCutoff?[]:ye,offscreen:rt,collisionDetected:$e}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,v=-1/0,E=-1/0;for(const V of o){const q=new a.P(V.x+at,V.y+at);p=Math.min(p,q.x),m=Math.min(m,q.y),v=Math.max(v,q.x),E=Math.max(E,q.y),h.push(q)}const M=this.grid.query(p,m,v,E).concat(this.ignoredGrid.query(p,m,v,E)),A={},R={};for(const V of M){const q=V.key;if(A[q.bucketInstanceId]===void 0&&(A[q.bucketInstanceId]={}),A[q.bucketInstanceId][q.featureIndex])continue;const Y=[new a.P(V.x1,V.y1),new a.P(V.x2,V.y1),new a.P(V.x2,V.y2),new a.P(V.x1,V.y2)];a.am(h,Y)&&(A[q.bucketInstanceId][q.featureIndex]=!0,R[q.bucketInstanceId]===void 0&&(R[q.bucketInstanceId]=[]),R[q.bucketInstanceId].push(q.featureIndex))}return R}insertCollisionBox(o,h,p,m,v,E){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:v,collisionGroupID:E,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,p,m,v,E){const M=p?this.ignoredGrid:this.grid,A={bucketInstanceId:m,featureIndex:v,collisionGroupID:E,overlapMode:h};for(let R=0;R<o.length;R+=4)M.insertCircle(A,o[R],o[R+1],o[R+2])}projectAndGetPerspectiveRatio(o,h,p,m){let v;return m?(v=[h,p,m(h,p),1],a.af(v,v,o)):(v=[h,p,0,1],Ke(v,v,o)),{point:new a.P((v[0]/v[3]+1)/2*this.transform.width+at,(-v[1]/v[3]+1)/2*this.transform.height+at),perspectiveRatio:.5+this.transform.cameraToCenterDistance/v[3]*.5}}isOffscreen(o,h,p,m){return p<at||o>=this.screenRightBoundary||m<at||h>this.screenBottomBoundary}isInsideGrid(o,h,p,m){return p>=0&&o<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=a.an([]);return a.H(o,o,[-100,-100,0]),o}}function $t(y,o,h){return o*(a.W/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class ar{constructor(o,h,p,m){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class _r{constructor(o,h,p,m,v){this.text=new ar(o?o.text:null,h,p,v),this.icon=new ar(o?o.icon:null,h,m,v)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yr{constructor(o,h,p){this.text=o,this.icon=h,this.skipFade=p}}class Cn{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class lr{constructor(o,h,p,m,v){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=v}}class ln{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[o]}}function Bn(y,o,h,p,m){const{horizontalAlign:v,verticalAlign:E}=a.at(y);return new a.P(-(v-.5)*o+p[0]*m,-(E-.5)*h+p[1]*m)}function fi(y,o,h,p,m,v){const{x1:E,x2:M,y1:A,y2:R,anchorPointX:V,anchorPointY:q}=y,Y=new a.P(o,h);return p&&Y._rotate(m?v:-v),{x1:E+Y.x,y1:A+Y.y,x2:M+Y.x,y2:R+Y.y,anchorPointX:V,anchorPointY:q}}class bi{constructor(o,h,p,m,v){this.transform=o.clone(),this.terrain=h,this.collisionIndex=new zt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new ln(m),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,p,m){const v=p.getBucket(h),E=p.latestFeatureIndex;if(!v||!E||h.id!==v.layerIds[0])return;const M=p.collisionBoxArray,A=v.layers[0].layout,R=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/a.W,q=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),Y=A.get("text-pitch-alignment")==="map",fe=A.get("text-rotation-alignment")==="map",he=$t(p,1,this.transform.zoom),ye=tr(q,Y,fe,this.transform,he);let se=null;if(Y){const qe=ro(q,Y,fe,this.transform,he);se=a.K([],this.transform.labelPlaneMatrix,qe)}this.retainedQueryData[v.bucketInstanceId]=new lr(v.bucketInstanceId,E,v.sourceLayerIndex,v.index,p.tileID);const Te={bucket:v,layout:A,posMatrix:q,textLabelPlaneMatrix:ye,labelToScreenMatrix:se,scale:R,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.ag(v.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(v.sourceID)};if(m)for(const qe of v.sortKeyRanges){const{sortKey:we,symbolInstanceStart:Le,symbolInstanceEnd:We}=qe;o.push({sortKey:we,symbolInstanceStart:Le,symbolInstanceEnd:We,parameters:Te})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:Te})}attemptAnchorPlacement(o,h,p,m,v,E,M,A,R,V,q,Y,fe,he,ye,se){const Te=a.ap[o.textAnchor],qe=[o.textOffset0,o.textOffset1],we=Bn(Te,p,m,qe,v),Le=this.collisionIndex.placeCollisionBox(fi(h,we.x,we.y,E,M,this.transform.angle),q,A,R,V.predicate,se);if((!ye||this.collisionIndex.placeCollisionBox(fi(ye,we.x,we.y,E,M,this.transform.angle),q,A,R,V.predicate,se).box.length!==0)&&Le.box.length>0){let We;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID]&&this.prevPlacement.placements[Y.crossTileID].text&&(We=this.prevPlacement.variableOffsets[Y.crossTileID].anchor),Y.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Y.crossTileID]={textOffset:qe,width:p,height:m,anchor:Te,textBoxScale:v,prevAnchor:We},this.markUsedJustification(fe,Te,Y,he),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,he,Y),this.placedOrientations[Y.crossTileID]=he),{shift:we,placedGlyphBoxes:Le}}}placeLayerBucketPart(o,h,p){const{bucket:m,layout:v,posMatrix:E,textLabelPlaneMatrix:M,labelToScreenMatrix:A,textPixelRatio:R,holdingForFade:V,collisionBoxArray:q,partiallyEvaluatedTextSize:Y,collisionGroup:fe}=o.parameters,he=v.get("text-optional"),ye=v.get("icon-optional"),se=a.aq(v,"text-overlap","text-allow-overlap"),Te=se==="always",qe=a.aq(v,"icon-overlap","icon-allow-overlap"),we=qe==="always",Le=v.get("text-rotation-alignment")==="map",We=v.get("text-pitch-alignment")==="map",$e=v.get("icon-text-fit")!=="none",Xe=v.get("symbol-z-order")==="viewport-y",rt=Te&&(we||!m.hasIconData()||ye),et=we&&(Te||!m.hasTextData()||he);!m.collisionArrays&&q&&m.deserializeCollisionBoxes(q);const ft=this.retainedQueryData[m.bucketInstanceId].tileID,mt=this.terrain?(gt,Xt)=>this.terrain.getElevation(ft,gt,Xt):null,or=(gt,Xt)=>{var sr,Sr;if(h[gt.crossTileID])return;if(V)return void(this.placements[gt.crossTileID]=new Yr(!1,!1,!1));let er=!1,cr=!1,fr=!0,hn=null,Dr={box:null,offscreen:null},Oi={box:null,offscreen:null},Fn=null,nn=null,On=null,Ni=0,bo=0,ts=0;Xt.textFeatureIndex?Ni=Xt.textFeatureIndex:gt.useRuntimeCollisionCircles&&(Ni=gt.featureIndex),Xt.verticalTextFeatureIndex&&(bo=Xt.verticalTextFeatureIndex);const Za=Xt.textBox;if(Za){const An=Ln=>{let sn=a.ah.horizontal;if(m.allowVerticalPlacement&&!Ln&&this.prevPlacement){const Ji=this.prevPlacement.placedOrientations[gt.crossTileID];Ji&&(this.placedOrientations[gt.crossTileID]=Ji,sn=Ji,this.markUsedOrientation(m,sn,gt))}return sn},on=(Ln,sn)=>{if(m.allowVerticalPlacement&&gt.numVerticalGlyphVertices>0&&Xt.verticalTextBox){for(const Ji of m.writingModes)if(Ji===a.ah.vertical?(Dr=sn(),Oi=Dr):Dr=Ln(),Dr&&Dr.box&&Dr.box.length)break}else Dr=Ln()},en=gt.textAnchorOffsetStartIndex,Ki=gt.textAnchorOffsetEndIndex;if(Ki===en){const Ln=(sn,Ji)=>{const Pn=this.collisionIndex.placeCollisionBox(sn,se,R,E,fe.predicate,mt);return Pn&&Pn.box&&Pn.box.length&&(this.markUsedOrientation(m,Ji,gt),this.placedOrientations[gt.crossTileID]=Ji),Pn};on(()=>Ln(Za,a.ah.horizontal),()=>{const sn=Xt.verticalTextBox;return m.allowVerticalPlacement&&gt.numVerticalGlyphVertices>0&&sn?Ln(sn,a.ah.vertical):{box:null,offscreen:null}}),An(Dr&&Dr.box&&Dr.box.length)}else{let Ln=a.ap[(Sr=(sr=this.prevPlacement)===null||sr===void 0?void 0:sr.variableOffsets[gt.crossTileID])===null||Sr===void 0?void 0:Sr.anchor];const sn=(Pn,yn,mu)=>{const df=Pn.x2-Pn.x1,ws=Pn.y2-Pn.y1,xs=gt.textBoxScale,Zl=$e&&qe==="never"?yn:null;let ns={box:[],offscreen:!1},gu=se==="never"?1:2,pf="never";Ln&&gu++;for(let _u=0;_u<gu;_u++){for(let yu=en;yu<Ki;yu++){const Hl=m.textAnchorOffsets.get(yu);if(Ln&&Hl.textAnchor!==Ln)continue;const vu=this.attemptAnchorPlacement(Hl,Pn,df,ws,xs,Le,We,R,E,fe,pf,gt,m,mu,Zl,mt);if(vu&&(ns=vu.placedGlyphBoxes,ns&&ns.box&&ns.box.length))return er=!0,hn=vu.shift,ns}Ln?Ln=null:pf=se}return ns};on(()=>sn(Za,Xt.iconBox,a.ah.horizontal),()=>{const Pn=Xt.verticalTextBox;return m.allowVerticalPlacement&&!(Dr&&Dr.box&&Dr.box.length)&&gt.numVerticalGlyphVertices>0&&Pn?sn(Pn,Xt.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),Dr&&(er=Dr.box,fr=Dr.offscreen);const Ji=An(Dr&&Dr.box);if(!er&&this.prevPlacement){const Pn=this.prevPlacement.variableOffsets[gt.crossTileID];Pn&&(this.variableOffsets[gt.crossTileID]=Pn,this.markUsedJustification(m,Pn.anchor,gt,Ji))}}}if(Fn=Dr,er=Fn&&Fn.box&&Fn.box.length>0,fr=Fn&&Fn.offscreen,gt.useRuntimeCollisionCircles){const An=m.text.placedSymbolArray.get(gt.centerJustifiedTextSymbolIndex),on=a.ai(m.textSizeData,Y,An),en=v.get("text-padding");nn=this.collisionIndex.placeCollisionCircles(se,An,m.lineVertexArray,m.glyphOffsetArray,on,E,M,A,p,We,fe.predicate,gt.collisionCircleDiameter,en,mt),nn.circles.length&&nn.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),er=Te||nn.circles.length>0&&!nn.collisionDetected,fr=fr&&nn.offscreen}if(Xt.iconFeatureIndex&&(ts=Xt.iconFeatureIndex),Xt.iconBox){const An=on=>{const en=$e&&hn?fi(on,hn.x,hn.y,Le,We,this.transform.angle):on;return this.collisionIndex.placeCollisionBox(en,qe,R,E,fe.predicate,mt)};Oi&&Oi.box&&Oi.box.length&&Xt.verticalIconBox?(On=An(Xt.verticalIconBox),cr=On.box.length>0):(On=An(Xt.iconBox),cr=On.box.length>0),fr=fr&&On.offscreen}const rs=he||gt.numHorizontalGlyphVertices===0&&gt.numVerticalGlyphVertices===0,wo=ye||gt.numIconVertices===0;if(rs||wo?wo?rs||(cr=cr&&er):er=cr&&er:cr=er=cr&&er,er&&Fn&&Fn.box&&this.collisionIndex.insertCollisionBox(Fn.box,se,v.get("text-ignore-placement"),m.bucketInstanceId,Oi&&Oi.box&&bo?bo:Ni,fe.ID),cr&&On&&this.collisionIndex.insertCollisionBox(On.box,qe,v.get("icon-ignore-placement"),m.bucketInstanceId,ts,fe.ID),nn&&(er&&this.collisionIndex.insertCollisionCircles(nn.circles,se,v.get("text-ignore-placement"),m.bucketInstanceId,Ni,fe.ID),p)){const An=m.bucketInstanceId;let on=this.collisionCircleArrays[An];on===void 0&&(on=this.collisionCircleArrays[An]=new Cn);for(let en=0;en<nn.circles.length;en+=4)on.circles.push(nn.circles[en+0]),on.circles.push(nn.circles[en+1]),on.circles.push(nn.circles[en+2]),on.circles.push(nn.collisionDetected?1:0)}if(gt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[gt.crossTileID]=new Yr(er||rt,cr||et,fr||m.justReloaded),h[gt.crossTileID]=!0};if(Xe){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const gt=m.getSortedSymbolIndexes(this.transform.angle);for(let Xt=gt.length-1;Xt>=0;--Xt){const sr=gt[Xt];or(m.symbolInstances.get(sr),m.collisionArrays[sr])}}else for(let gt=o.symbolInstanceStart;gt<o.symbolInstanceEnd;gt++)or(m.symbolInstances.get(gt),m.collisionArrays[gt]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const gt=this.collisionCircleArrays[m.bucketInstanceId];a.ar(gt.invProjMatrix,E),gt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(o,h,p,m){let v;v=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.as(h)];const E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const M of E)M>=0&&(o.text.placedSymbolArray.get(M).crossTileID=v>=0&&M!==v?0:p.crossTileID)}markUsedOrientation(o,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,v=h===a.ah.vertical?h:0,E=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const M of E)o.text.placedSymbolArray.get(M).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=v)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(o):1,v=h?h.opacities:{},E=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const A in this.placements){const R=this.placements[A],V=v[A];V?(this.opacities[A]=new _r(V,m,R.text,R.icon),p=p||R.text!==V.text.placed||R.icon!==V.icon.placed):(this.opacities[A]=new _r(null,m,R.text,R.icon,R.skipFade),p=p||R.text||R.icon)}for(const A in v){const R=v[A];if(!this.opacities[A]){const V=new _r(R,m,!1,!1);V.isHidden()||(this.opacities[A]=V,p=p||R.text.placed||R.icon.placed)}}for(const A in E)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=E[A]);for(const A in M)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=M[A]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const p={};for(const m of h){const v=m.getBucket(o);v&&m.latestFeatureIndex&&o.id===v.layerIds[0]&&this.updateBucketOpacities(v,p,m.collisionBoxArray)}}updateBucketOpacities(o,h,p){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const m=o.layers[0],v=m.layout,E=new _r(null,0,!1,!1,!0),M=v.get("text-allow-overlap"),A=v.get("icon-allow-overlap"),R=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),V=v.get("text-rotation-alignment")==="map",q=v.get("text-pitch-alignment")==="map",Y=v.get("icon-text-fit")!=="none",fe=new _r(null,0,M&&(A||!o.hasIconData()||v.get("icon-optional")),A&&(M||!o.hasTextData()||v.get("text-optional")),!0);!o.collisionArrays&&p&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(p);const he=(ye,se,Te)=>{for(let qe=0;qe<se/4;qe++)ye.opacityVertexArray.emplaceBack(Te);ye.hasVisibleVertices=ye.hasVisibleVertices||Te!==ka};for(let ye=0;ye<o.symbolInstances.length;ye++){const se=o.symbolInstances.get(ye),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:qe,crossTileID:we}=se;let Le=this.opacities[we];h[we]?Le=E:Le||(Le=fe,this.opacities[we]=Le),h[we]=!0;const We=se.numIconVertices>0,$e=this.placedOrientations[se.crossTileID],Xe=$e===a.ah.vertical,rt=$e===a.ah.horizontal||$e===a.ah.horizontalOnly;if(Te>0||qe>0){const et=wi(Le.text);he(o.text,Te,Xe?ka:et),he(o.text,qe,rt?ka:et);const ft=Le.text.isHidden();[se.rightJustifiedTextSymbolIndex,se.centerJustifiedTextSymbolIndex,se.leftJustifiedTextSymbolIndex].forEach(gt=>{gt>=0&&(o.text.placedSymbolArray.get(gt).hidden=ft||Xe?1:0)}),se.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(se.verticalPlacedTextSymbolIndex).hidden=ft||rt?1:0);const mt=this.variableOffsets[se.crossTileID];mt&&this.markUsedJustification(o,mt.anchor,se,$e);const or=this.placedOrientations[se.crossTileID];or&&(this.markUsedJustification(o,"left",se,or),this.markUsedOrientation(o,or,se))}if(We){const et=wi(Le.icon),ft=!(Y&&se.verticalPlacedIconSymbolIndex&&Xe);se.placedIconSymbolIndex>=0&&(he(o.icon,se.numIconVertices,ft?et:ka),o.icon.placedSymbolArray.get(se.placedIconSymbolIndex).hidden=Le.icon.isHidden()),se.verticalPlacedIconSymbolIndex>=0&&(he(o.icon,se.numVerticalIconVertices,ft?ka:et),o.icon.placedSymbolArray.get(se.verticalPlacedIconSymbolIndex).hidden=Le.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const et=o.collisionArrays[ye];if(et){let ft=new a.P(0,0);if(et.textBox||et.verticalTextBox){let or=!0;if(R){const gt=this.variableOffsets[we];gt?(ft=Bn(gt.anchor,gt.width,gt.height,gt.textOffset,gt.textBoxScale),V&&ft._rotate(q?this.transform.angle:-this.transform.angle)):or=!1}et.textBox&&Kn(o.textCollisionBox.collisionVertexArray,Le.text.placed,!or||Xe,ft.x,ft.y),et.verticalTextBox&&Kn(o.textCollisionBox.collisionVertexArray,Le.text.placed,!or||rt,ft.x,ft.y)}const mt=!!(!rt&&et.verticalIconBox);et.iconBox&&Kn(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,mt,Y?ft.x:0,Y?ft.y:0),et.verticalIconBox&&Kn(o.iconCollisionBox.collisionVertexArray,Le.icon.placed,!mt,Y?ft.x:0,Y?ft.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=ye.invProjMatrix,o.placementViewportMatrix=ye.viewportMatrix,o.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>o}setStale(){this.stale=!0}}function Kn(y,o,h,p,m){y.emplaceBack(o?1:0,h?1:0,p||0,m||0),y.emplaceBack(o?1:0,h?1:0,p||0,m||0),y.emplaceBack(o?1:0,h?1:0,p||0,m||0),y.emplaceBack(o?1:0,h?1:0,p||0,m||0)}const mo=Math.pow(2,25),Ih=Math.pow(2,24),Zd=Math.pow(2,17),Pr=Math.pow(2,16),Fc=Math.pow(2,9),Oc=Math.pow(2,8),Ri=Math.pow(2,1);function wi(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const o=y.placed?1:0,h=Math.floor(127*y.opacity);return h*mo+o*Ih+h*Zd+o*Pr+h*Fc+o*Oc+h*Ri+o}const ka=0;class $i{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,p,m,v){const E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(E,m,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((M,A)=>M.sortKey-A.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,v())return!0;return!1}}class Xi{constructor(o,h,p,m,v,E,M,A){this.placement=new bi(o,h,E,M,A),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,h,p){const m=S.now(),v=()=>!this._forceFullPlacement&&S.now()-m>2;for(;this._currentPlacementIndex>=0;){const E=h[o[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=M)&&(!E.maxzoom||E.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new $i(E)),this._inProgressLayer.continuePlacement(p[E.source],this.placement,this._showCollisionBoxes,E,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const js=512/a.W/2;class al{constructor(o,h,p){this.tileID=o,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let v=0;v<h.length;v++){const E=h.get(v),M=E.key,A=m.get(M);A?A.push(E):m.set(M,[E])}for(const[v,E]of m){const M={positions:E.map(A=>({x:Math.floor(A.anchorX*js),y:Math.floor(A.anchorY*js)})),crossTileIDs:E.map(A=>A.crossTileID)};if(M.positions.length>128){const A=new a.au(M.positions.length,16,Uint16Array);for(const{x:R,y:V}of M.positions)A.add(R,V);A.finish(),delete M.positions,M.index=A}this._symbolsByKey[v]=M}}getScaledCoordinates(o,h){const{x:p,y:m,z:v}=this.tileID.canonical,{x:E,y:M,z:A}=h.canonical,R=js/Math.pow(2,A-v),V=(M*a.W+o.anchorY)*R,q=m*a.W*js;return{x:Math.floor((E*a.W+o.anchorX)*R-p*a.W*js),y:Math.floor(V-q)}}findMatches(o,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let v=0;v<o.length;v++){const E=o.get(v);if(E.crossTileID)continue;const M=this._symbolsByKey[E.key];if(!M)continue;const A=this.getScaledCoordinates(E,h);if(M.index){const R=M.index.range(A.x-m,A.y-m,A.x+m,A.y+m).sort();for(const V of R){const q=M.crossTileIDs[V];if(!p[q]){p[q]=!0,E.crossTileID=q;break}}}else if(M.positions)for(let R=0;R<M.positions.length;R++){const V=M.positions[R],q=M.crossTileIDs[R];if(Math.abs(V.x-A.x)<=m&&Math.abs(V.y-A.y)<=m&&!p[q]){p[q]=!0,E.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class In{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ta{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],v={};for(const E in m){const M=m[E];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),v[M.tileID.key]=M}this.indexes[p]=v}this.lng=o}addBucket(o,h,p){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let v=0;v<h.symbolInstances.length;v++)h.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const m=this.usedCrossTileIDs[o.overscaledZ];for(const v in this.indexes){const E=this.indexes[v];if(Number(v)>o.overscaledZ)for(const M in E){const A=E[M];A.tileID.isChildOf(o)&&A.findMatches(h.symbolInstances,o,m)}else{const M=E[o.scaledTo(Number(v)).key];M&&M.findMatches(h.symbolInstances,o,m)}}for(let v=0;v<h.symbolInstances.length;v++){const E=h.symbolInstances.get(v);E.crossTileID||(E.crossTileID=p.generate(),m[E.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new al(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[o][m]}removeStaleBuckets(o){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const v in m)o[m[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[v]),delete m[v],h=!0)}return h}}class Xo{constructor(){this.layerIndexes={},this.crossTileIDs=new In,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,p){let m=this.layerIndexes[o.id];m===void 0&&(m=this.layerIndexes[o.id]=new Ta);let v=!1;const E={};m.handleWrapJump(p);for(const M of h){const A=M.getBucket(o);A&&o.id===A.layerIds[0]&&(A.bucketInstanceId||(A.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(M.tileID,A,this.crossTileIDs)&&(v=!0),E[A.bucketInstanceId]=!0)}return m.removeStaleBuckets(E)&&(v=!0),v}pruneUnusedLayers(o){const h={};o.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const rn=(y,o)=>a.t(y,o&&o.filter(h=>h.identifier!=="source.canvas")),ll=a.av();class Bi extends a.E{constructor(o,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=o,this.dispatcher=new wr(rr(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new He,this.imageManager.setEventedParent(this),this.glyphManager=new Nt(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ut(256,512),this.crossTileSymbolIndex=new Xo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),st().on(ii,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const v=m.getSource();if(v&&v.vectorLayerIds)for(const E in this._layers){const M=this._layers[E];M.source===v.id&&this._validateLayer(M)}})}loadURL(o,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController,a.h(m,this._loadStyleRequest).then(v=>{this._loadStyleRequest=null,this._load(v.data,h,p)}).catch(v=>{this._loadStyleRequest=null,v&&this.fire(new a.j(v))})}loadJSON(o,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(o,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(ll,{validate:!1})}_load(o,h,p){var m;const v=h.transformStyle?h.transformStyle(p,o):o;if(!h.validate||!rn(this,a.x(v))){this._loaded=!0,this.stylesheet=v;for(const E in v.sources)this.addSource(E,v.sources[E],{validate:!1});v.sprite?this._loadSprite(v.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(v.glyphs),this._createLayers(),this.light=new Kt(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const o=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of o){const p=a.az(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(o,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(v,E,M,A){return a._(this,void 0,void 0,function*(){const R=ze(v),V=M>1?"@2x":"",q={},Y={};for(const{id:fe,url:he}of R){const ye=E.transformRequest(E.normalizeSpriteURL(he,V,".json"),"SpriteJSON");q[fe]=a.h(ye,A);const se=E.transformRequest(E.normalizeSpriteURL(he,V,".png"),"SpriteImage");Y[fe]=G.getImage(se,A)}return yield Promise.all([...Object.values(q),...Object.values(Y)]),function(fe,he){return a._(this,void 0,void 0,function*(){const ye={};for(const se in fe){ye[se]={};const Te=S.getImageCanvasContext((yield he[se]).data),qe=(yield fe[se]).data;for(const we in qe){const{width:Le,height:We,x:$e,y:Xe,sdf:rt,pixelRatio:et,stretchX:ft,stretchY:mt,content:or}=qe[we];ye[se][we]={data:null,pixelRatio:et,sdf:rt,stretchX:ft,stretchY:mt,content:or,spriteData:{width:Le,height:We,x:$e,y:Xe,context:Te}}}}return ye})}(q,Y)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(v=>{if(this._spriteRequest=null,v)for(const E in v){this._spritesImagesIds[E]=[];const M=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(A=>!(A in v)):[];for(const A of M)this.imageManager.removeImage(A),this._changedImages[A]=!0;for(const A in v[E]){const R=E==="default"?A:`${E}:${A}`;this._spritesImagesIds[E].push(R),R in this.imageManager.images?this.imageManager.updateImage(R,v[E][A],!1):this.imageManager.addImage(R,v[E][A]),h&&(this._changedImages[R]=!0)}}}).catch(v=>{this._spriteRequest=null,m=v,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const p=o.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const h=this._serializedAllLayers();if(!o||o.length===0)return Object.values(h);const p=[];for(const m of o)h[m]&&p.push(h[m]);return p}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(o[p]=m.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),v=Object.keys(this._removedLayers);(m.length||v.length)&&this._updateWorkerLayers(m,v);for(const E in this._updatedSources){const M=this._updatedSources[E];if(M==="reload")this._reloadSource(E);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const v=this.sourceCaches[m];p[m]=v.used,v.used=!1}for(const m of this._order){const v=this._layers[m];v.recalculate(o,this._availableImages),!v.isHidden(o.zoom)&&v.source&&(this.sourceCaches[v.source].used=!0)}for(const m in p){const v=this.sourceCaches[m];!!p[m]!=!!v.used&&v.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,h={}){var p;this._checkLoaded();const m=this.serialize();if(o=h.transformStyle?h.transformStyle(m,o):o,((p=h.validate)===null||p===void 0||p)&&rn(this,a.x(o)))return!1;(o=a.aA(o)).layers=a.ay(o.layers);const v=a.aB(m,o),E=this._getOperationsToPerform(v);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const M of E.operations)M();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const h=[],p=[];for(const m of o)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(o,h){if(this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new a.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,p={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.x.source,`sources.${o}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[o]=new Or(o,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:o})),m.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===o)return this.fire(new a.j(new Error(`Source "${o}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const p=this.sourceCaches[o].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,p={}){this._checkLoaded();const m=o.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let v;if(o.type==="custom"){if(rn(this,a.aC(o)))return;v=a.az(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(m,o.source),o=a.aA(o),o=a.e(o,{source:m})),this._validate(a.x.layer,`layers.${m}`,o,{arrayIndex:-1},p))return;v=a.az(o),this._validateLayer(v),v.setEventedParent(this,{layer:{id:m}})}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,m),this._layerOrderChanged=!0,this._layers[m]=v,this._removedLayers[m]&&v.source&&v.type!=="custom"){const M=this._removedLayers[m];delete this._removedLayers[m],M.type!==v.type?this._updatedSources[v.source]="clear":(this._updatedSources[v.source]="reload",this.sourceCaches[v.source].pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new a.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const p=this._order.indexOf(o);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(m,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const p=this._order.indexOf(o);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,p){this._checkLoaded();const m=this.getLayer(o);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,p={}){this._checkLoaded();const m=this.getLayer(o);if(m){if(!a.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.x.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aA(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return a.aA(this.getLayer(o).filter)}setLayoutProperty(o,h,p,m={}){this._checkLoaded();const v=this.getLayer(o);v?a.aD(v.getLayoutProperty(h),p)||(v.setLayoutProperty(h,p,m),this._updateLayer(v)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const p=this.getLayer(o);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,p,m={}){this._checkLoaded();const v=this.getLayer(o);v?a.aD(v.getPaintProperty(h),p)||(v.setPaintProperty(h,p,m)&&this._updateLayer(v),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const p=o.source,m=o.sourceLayer,v=this.sourceCaches[p];if(v===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const E=v.getSource().type;E==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||m?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),v.setFeatureState(m,o.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const p=o.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const v=m.getSource().type,E=v==="vector"?o.sourceLayer:void 0;v!=="vector"||E?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(E,o.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,p=o.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(o.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,o.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=a.aE(this.sourceCaches,v=>v.serialize()),h=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:o,layers:h,terrain:p},v=>v!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=E=>this._layers[E].type==="fill-extrusion",p={},m=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(h(M)){p[M]=E;for(const A of o){const R=A[M];if(R)for(const V of R)m.push(V)}}}m.sort((E,M)=>M.intersectionZ-E.intersectionZ);const v=[];for(let E=this._order.length-1;E>=0;E--){const M=this._order[E];if(h(M))for(let A=m.length-1;A>=0;A--){const R=m[A].feature;if(p[R.layer.id]<E)break;v.push(R),m.pop()}else for(const A of o){const R=A[M];if(R)for(const V of R)v.push(V.feature)}}return v}queryRenderedFeatures(o,h,p){h&&h.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const M of h.layers){const A=this._layers[M];if(!A)return this.fire(new a.j(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];m[A.source]=!0}}const v=[];h.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const M in this.sourceCaches)h.layers&&!m[M]||v.push(ht(this.sourceCaches[M],this._layers,E,o,h,p));return this.placement&&v.push(function(M,A,R,V,q,Y,fe){const he={},ye=Y.queryRenderedSymbols(V),se=[];for(const Te of Object.keys(ye).map(Number))se.push(fe[Te]);se.sort(Mt);for(const Te of se){const qe=Te.featureIndex.lookupSymbolFeatures(ye[Te.bucketInstanceId],A,Te.bucketIndex,Te.sourceLayerIndex,q.filter,q.layers,q.availableImages,M);for(const we in qe){const Le=he[we]=he[we]||[],We=qe[we];We.sort(($e,Xe)=>{const rt=Te.featureSortOrder;if(rt){const et=rt.indexOf($e.featureIndex);return rt.indexOf(Xe.featureIndex)-et}return Xe.featureIndex-$e.featureIndex});for(const $e of We)Le.push($e)}}for(const Te in he)he[Te].forEach(qe=>{const we=qe.feature,Le=R[M[Te].source].getFeatureState(we.layer["source-layer"],we.id);we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]),we.state=Le});return he}(this._layers,E,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(v)}querySourceFeatures(o,h){h&&h.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[o];return p?function(m,v){const E=m.getRenderableIds().map(R=>m.getTileByID(R)),M=[],A={};for(let R=0;R<E.length;R++){const V=E[R],q=V.tileID.canonical.key;A[q]||(A[q]=!0,V.querySourceFeatures(M,v))}return M}(p,h):[]}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const E in o)if(!a.aD(o[E],p[E])){m=!0;break}if(!m)return;const v={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(v)}_validate(o,h,p,m,v={}){return(!v||v.validate!==!1)&&rn(this,o.call(a.x,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),st().off(ii,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,p,m,v=!1){let E=!1,M=!1;const A={};for(const R of this._order){const V=this._layers[R];if(V.type!=="symbol")continue;if(!A[V.source]){const Y=this.sourceCaches[V.source];A[V.source]=Y.getRenderableIds(!0).map(fe=>Y.getTileByID(fe)).sort((fe,he)=>he.tileID.overscaledZ-fe.tileID.overscaledZ||(fe.tileID.isLessThan(he.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer(V,A[V.source],o.center.lng);E=E||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((v=v||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),o.zoom))&&(this.pauseablePlacement=new Xi(o,this.map.terrain,this._order,v,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),M=!0),E&&this.pauseablePlacement.placement.setStale()),M||E)for(const R of this._order){const V=this._layers[R];V.type==="symbol"&&this.placement.updateLayerOpacities(V,A[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(o,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,h={}){this._checkLoaded(),o&&this._validate(a.x.glyphs,"glyphs",o,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,h,p={},m){this._checkLoaded();const v=[{id:o,url:h}],E=[...ze(this.stylesheet.sprite),...v];this._validate(a.x.sprite,"sprite",E,null,p)||(this.stylesheet.sprite=E,this._loadSprite(v,!0,m))}removeSprite(o){this._checkLoaded();const h=ze(this.stylesheet.sprite);if(h.find(p=>p.id===o)){if(this._spritesImagesIds[o])for(const p of this._spritesImagesIds[o])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===o),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return ze(this.stylesheet.sprite)}setSprite(o,h={},p){this._checkLoaded(),o&&this._validate(a.x.sprite,"sprite",o,null,h)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,p):(this._unloadSprite(),p&&p(null)))}}var cl=a.X([{name:"a_pos",type:"Int16",components:2}]),go="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ea={prelude:zr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:zr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:zr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:zr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:zr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:zr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:zr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:zr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:zr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:zr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:zr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:zr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:zr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:zr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:zr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:zr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:zr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:zr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:zr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:zr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:zr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:zr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",go),terrainDepth:zr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",go),terrainCoords:zr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",go)};function zr(y,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=o.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),v=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=v?v.concat(m):m,M={};return{fragmentSource:y=y.replace(h,(A,R,V,q,Y)=>(M[Y]=!0,R==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
varying ${V} ${q} ${Y};
#else
uniform ${V} ${q} u_${Y};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Y}
    ${V} ${q} ${Y} = u_${Y};
#endif
`)),vertexSource:o=o.replace(h,(A,R,V,q,Y)=>{const fe=q==="float"?"vec2":"vec4",he=Y.match(/color/)?"color":fe;return M[Y]?R==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${V} ${fe} a_${Y};
varying ${V} ${q} ${Y};
#else
uniform ${V} ${q} u_${Y};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = a_${Y};
#else
    ${V} ${q} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${Y} = unpack_mix_${he}(a_${Y}, u_${Y}_t);
#else
    ${V} ${q} ${Y} = u_${Y};
#endif
`:R==="define"?`
#ifndef HAS_UNIFORM_u_${Y}
uniform lowp float u_${Y}_t;
attribute ${V} ${fe} a_${Y};
#else
uniform ${V} ${q} u_${Y};
#endif
`:he==="vec4"?`
#ifndef HAS_UNIFORM_u_${Y}
    ${V} ${q} ${Y} = a_${Y};
#else
    ${V} ${q} ${Y} = u_${Y};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Y}
    ${V} ${q} ${Y} = unpack_mix_${he}(a_${Y}, u_${Y}_t);
#else
    ${V} ${q} ${Y} = u_${Y};
#endif
`}),staticAttributes:p,staticUniforms:E}}class ul{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,p,m,v,E,M,A,R){this.context=o;let V=this.boundPaintVertexBuffers.length!==m.length;for(let q=0;!V&&q<m.length;q++)this.boundPaintVertexBuffers[q]!==m[q]&&(V=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||V||this.boundIndexBuffer!==v||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==A||this.boundDynamicVertexBuffer3!==R?this.freshBind(h,p,m,v,E,M,A,R):(o.bindVertexArray.set(this.vao),M&&M.bind(),v&&v.dynamicDraw&&v.bind(),A&&A.bind(),R&&R.bind())}freshBind(o,h,p,m,v,E,M,A){const R=o.numAttributes,V=this.context,q=V.gl;this.vao&&this.destroy(),this.vao=V.createVertexArray(),V.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=v,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=A,h.enableAttributes(q,o);for(const Y of p)Y.enableAttributes(q,o);E&&E.enableAttributes(q,o),M&&M.enableAttributes(q,o),A&&A.enableAttributes(q,o),h.bind(),h.setVertexAttribPointers(q,o,v);for(const Y of p)Y.bind(),Y.setVertexAttribPointers(q,o,v);E&&(E.bind(),E.setVertexAttribPointers(q,o,v)),m&&m.bind(),M&&(M.bind(),M.setVertexAttribPointers(q,o,v)),A&&(A.bind(),A.setVertexAttribPointers(q,o,v)),V.currentNumAttributes=R}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Us(y){const o=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const p=y[h].split(" ");o.push(p.pop())}return o}class Ko{constructor(o,h,p,m,v,E){const M=o.gl;this.program=M.createProgram();const A=Us(h.staticAttributes),R=p?p.getBinderAttributes():[],V=A.concat(R),q=Ea.prelude.staticUniforms?Us(Ea.prelude.staticUniforms):[],Y=h.staticUniforms?Us(h.staticUniforms):[],fe=p?p.getBinderUniforms():[],he=q.concat(Y).concat(fe),ye=[];for(const $e of he)ye.indexOf($e)<0&&ye.push($e);const se=p?p.defines():[];v&&se.push("#define OVERDRAW_INSPECTOR;"),E&&se.push("#define TERRAIN3D;");const Te=se.concat(Ea.prelude.fragmentSource,h.fragmentSource).join(`
`),qe=se.concat(Ea.prelude.vertexSource,h.vertexSource).join(`
`),we=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(we,Te),M.compileShader(we),!M.getShaderParameter(we,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(we)}`);M.attachShader(this.program,we);const Le=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(Le,qe),M.compileShader(Le),!M.getShaderParameter(Le,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(Le)}`);M.attachShader(this.program,Le),this.attributes={};const We={};this.numAttributes=V.length;for(let $e=0;$e<this.numAttributes;$e++)V[$e]&&(M.bindAttribLocation(this.program,$e,V[$e]),this.attributes[V[$e]]=$e);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(Le),M.deleteShader(we);for(let $e=0;$e<ye.length;$e++){const Xe=ye[$e];if(Xe&&!We[Xe]){const rt=M.getUniformLocation(this.program,Xe);rt&&(We[Xe]=rt)}}this.fixedUniforms=m(o,We),this.terrainUniforms=(($e,Xe)=>({u_depth:new a.aG($e,Xe.u_depth),u_terrain:new a.aG($e,Xe.u_terrain),u_terrain_dim:new a.aH($e,Xe.u_terrain_dim),u_terrain_matrix:new a.aI($e,Xe.u_terrain_matrix),u_terrain_unpack:new a.aJ($e,Xe.u_terrain_unpack),u_terrain_exaggeration:new a.aH($e,Xe.u_terrain_exaggeration)}))(o,We),this.binderUniforms=p?p.getUniforms(o,We):[]}draw(o,h,p,m,v,E,M,A,R,V,q,Y,fe,he,ye,se,Te,qe){const we=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(p),o.setStencilMode(m),o.setColorMode(v),o.setCullFace(E),A){o.activeTexture.set(we.TEXTURE2),we.bindTexture(we.TEXTURE_2D,A.depthTexture),o.activeTexture.set(we.TEXTURE3),we.bindTexture(we.TEXTURE_2D,A.texture);for(const We in this.terrainUniforms)this.terrainUniforms[We].set(A[We])}for(const We in this.fixedUniforms)this.fixedUniforms[We].set(M[We]);ye&&ye.setUniforms(o,this.binderUniforms,fe,{zoom:he});let Le=0;switch(h){case we.LINES:Le=2;break;case we.TRIANGLES:Le=3;break;case we.LINE_STRIP:Le=1}for(const We of Y.get()){const $e=We.vaos||(We.vaos={});($e[R]||($e[R]=new ul)).bind(o,this,V,ye?ye.getPaintVertexBuffers():[],q,We.vertexOffset,se,Te,qe),we.drawElements(h,We.primitiveLength*Le,we.UNSIGNED_SHORT,We.primitiveOffset*Le*2)}}}function hl(y,o,h){const p=1/$t(h,1,o.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),v=h.tileSize*Math.pow(2,o.transform.tileZoom)/m,E=v*(h.tileID.canonical.x+h.tileID.wrap*m),M=v*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[E>>16,M>>16],u_pixel_coord_lower:[65535&E,65535&M]}}const Ma=(y,o,h,p)=>{const m=o.style.light,v=m.properties.get("position"),E=[v.x,v.y,v.z],M=function(){var R=new a.A(9);return a.A!=Float32Array&&(R[1]=0,R[2]=0,R[3]=0,R[5]=0,R[6]=0,R[7]=0),R[0]=1,R[4]=1,R[8]=1,R}();m.properties.get("anchor")==="viewport"&&function(R,V){var q=Math.sin(V),Y=Math.cos(V);R[0]=Y,R[1]=q,R[2]=0,R[3]=-q,R[4]=Y,R[5]=0,R[6]=0,R[7]=0,R[8]=1}(M,-o.transform.angle),function(R,V,q){var Y=V[0],fe=V[1],he=V[2];R[0]=Y*q[0]+fe*q[3]+he*q[6],R[1]=Y*q[1]+fe*q[4]+he*q[7],R[2]=Y*q[2]+fe*q[5]+he*q[8]}(E,E,M);const A=m.properties.get("color");return{u_matrix:y,u_lightpos:E,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[A.r,A.g,A.b],u_vertical_gradient:+h,u_opacity:p}},Hd=(y,o,h,p,m,v,E)=>a.e(Ma(y,o,h,p),hl(v,o,E),{u_height_factor:-Math.pow(2,m.overscaledZ)/E.tileSize/8}),Ah=y=>({u_matrix:y}),fl=(y,o,h,p)=>a.e(Ah(y),hl(h,o,p)),$d=(y,o)=>({u_matrix:y,u_world:o}),Lh=(y,o,h,p,m)=>a.e(fl(y,o,h,p),{u_world:m}),Xd=(y,o,h,p)=>{const m=y.transform;let v,E;if(p.paint.get("circle-pitch-alignment")==="map"){const M=$t(h,1,m.zoom);v=!0,E=[M,M]}else v=!1,E=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(o.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+v,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:E}},Ph=(y,o,h)=>{const p=$t(h,1,o.zoom),m=Math.pow(2,o.zoom-h.tileID.overscaledZ),v=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[o.pixelsToGLUnits[0]/(p*m),o.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:v}},zh=(y,o,h=1)=>({u_matrix:y,u_color:o,u_overlay:0,u_overlay_scale:h}),dl=y=>({u_matrix:y}),Dh=(y,o,h,p)=>({u_matrix:y,u_extrude_scale:$t(o,1,h),u_intensity:p});function Rh(y,o){const h=Math.pow(2,o.canonical.z),p=o.canonical.y;return[new a.Y(0,p/h).toLngLat().lat,new a.Y(0,(p+1)/h).toLngLat().lat]}const pl=(y,o,h,p)=>{const m=y.transform;return{u_matrix:Ca(y,o,h,p),u_ratio:1/$t(o,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Bh=(y,o,h,p,m)=>a.e(pl(y,o,h,m),{u_image:0,u_image_height:p}),ds=(y,o,h,p,m)=>{const v=y.transform,E=Fi(o,v);return{u_matrix:Ca(y,o,h,m),u_texsize:o.imageAtlasTexture.size,u_ratio:1/$t(o,1,v.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[E,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},ml=(y,o,h,p,m,v)=>{const E=y.lineAtlas,M=Fi(o,y.transform),A=h.layout.get("line-cap")==="round",R=E.getDash(p.from,A),V=E.getDash(p.to,A),q=R.width*m.fromScale,Y=V.width*m.toScale;return a.e(pl(y,o,h,v),{u_patternscale_a:[M/q,-R.height/2],u_patternscale_b:[M/Y,-V.height/2],u_sdfgamma:E.width/(256*Math.min(q,Y)*y.pixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:V.y,u_mix:m.t})};function Fi(y,o){return 1/$t(y,1,o.tileZoom)}function Ca(y,o,h,p){return y.translatePosMatrix(p?p.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const gl=(y,o,h,p,m)=>{return{u_matrix:y,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(E=m.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(v=m.paint.get("raster-contrast"),v>0?1/(1-v):1+v),u_spin_weights:Ia(m.paint.get("raster-hue-rotate"))};var v,E};function Ia(y){y*=Math.PI/180;const o=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Aa=(y,o,h,p,m,v,E,M,A,R)=>{const V=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:V.cameraToCenterDistance,u_pitch:V.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:V.width/V.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:E,u_coord_matrix:M,u_is_text:+A,u_pitch_with_map:+p,u_texsize:R,u_texture:0}},La=(y,o,h,p,m,v,E,M,A,R,V)=>{const q=m.transform;return a.e(Aa(y,o,h,p,m,v,E,M,A,R),{u_gamma_scale:p?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+V})},Pa=(y,o,h,p,m,v,E,M,A,R)=>a.e(La(y,o,h,p,m,v,E,M,!0,A,!0),{u_texsize_icon:R,u_texture_icon:1}),Kd=(y,o,h)=>({u_matrix:y,u_opacity:o,u_color:h}),Jd=(y,o,h,p,m,v)=>a.e(function(E,M,A,R){const V=A.imageManager.getPattern(E.from.toString()),q=A.imageManager.getPattern(E.to.toString()),{width:Y,height:fe}=A.imageManager.getPixelSize(),he=Math.pow(2,R.tileID.overscaledZ),ye=R.tileSize*Math.pow(2,A.transform.tileZoom)/he,se=ye*(R.tileID.canonical.x+R.tileID.wrap*he),Te=ye*R.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[Y,fe],u_mix:M.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/$t(R,1,A.transform.tileZoom),u_pixel_coord_upper:[se>>16,Te>>16],u_pixel_coord_lower:[65535&se,65535&Te]}}(p,v,h,m),{u_matrix:y,u_opacity:o}),Fh={fillExtrusion:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_lightpos:new a.aK(y,o.u_lightpos),u_lightintensity:new a.aH(y,o.u_lightintensity),u_lightcolor:new a.aK(y,o.u_lightcolor),u_vertical_gradient:new a.aH(y,o.u_vertical_gradient),u_opacity:new a.aH(y,o.u_opacity)}),fillExtrusionPattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_lightpos:new a.aK(y,o.u_lightpos),u_lightintensity:new a.aH(y,o.u_lightintensity),u_lightcolor:new a.aK(y,o.u_lightcolor),u_vertical_gradient:new a.aH(y,o.u_vertical_gradient),u_height_factor:new a.aH(y,o.u_height_factor),u_image:new a.aG(y,o.u_image),u_texsize:new a.aL(y,o.u_texsize),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade),u_opacity:new a.aH(y,o.u_opacity)}),fill:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix)}),fillPattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_image:new a.aG(y,o.u_image),u_texsize:new a.aL(y,o.u_texsize),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade)}),fillOutline:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_world:new a.aL(y,o.u_world)}),fillOutlinePattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_world:new a.aL(y,o.u_world),u_image:new a.aG(y,o.u_image),u_texsize:new a.aL(y,o.u_texsize),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade)}),circle:(y,o)=>({u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_scale_with_map:new a.aG(y,o.u_scale_with_map),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_extrude_scale:new a.aL(y,o.u_extrude_scale),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_matrix:new a.aI(y,o.u_matrix)}),collisionBox:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(y,o.u_pixels_to_tile_units),u_extrude_scale:new a.aL(y,o.u_extrude_scale),u_overscale_factor:new a.aH(y,o.u_overscale_factor)}),collisionCircle:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_inv_matrix:new a.aI(y,o.u_inv_matrix),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_viewport_size:new a.aL(y,o.u_viewport_size)}),debug:(y,o)=>({u_color:new a.aM(y,o.u_color),u_matrix:new a.aI(y,o.u_matrix),u_overlay:new a.aG(y,o.u_overlay),u_overlay_scale:new a.aH(y,o.u_overlay_scale)}),clippingMask:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix)}),heatmap:(y,o)=>({u_extrude_scale:new a.aH(y,o.u_extrude_scale),u_intensity:new a.aH(y,o.u_intensity),u_matrix:new a.aI(y,o.u_matrix)}),heatmapTexture:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_world:new a.aL(y,o.u_world),u_image:new a.aG(y,o.u_image),u_color_ramp:new a.aG(y,o.u_color_ramp),u_opacity:new a.aH(y,o.u_opacity)}),hillshade:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_image:new a.aG(y,o.u_image),u_latrange:new a.aL(y,o.u_latrange),u_light:new a.aL(y,o.u_light),u_shadow:new a.aM(y,o.u_shadow),u_highlight:new a.aM(y,o.u_highlight),u_accent:new a.aM(y,o.u_accent)}),hillshadePrepare:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_image:new a.aG(y,o.u_image),u_dimension:new a.aL(y,o.u_dimension),u_zoom:new a.aH(y,o.u_zoom),u_unpack:new a.aJ(y,o.u_unpack)}),line:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels)}),lineGradient:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels),u_image:new a.aG(y,o.u_image),u_image_height:new a.aH(y,o.u_image_height)}),linePattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_texsize:new a.aL(y,o.u_texsize),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_image:new a.aG(y,o.u_image),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels),u_scale:new a.aK(y,o.u_scale),u_fade:new a.aH(y,o.u_fade)}),lineSDF:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ratio:new a.aH(y,o.u_ratio),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,o.u_units_to_pixels),u_patternscale_a:new a.aL(y,o.u_patternscale_a),u_patternscale_b:new a.aL(y,o.u_patternscale_b),u_sdfgamma:new a.aH(y,o.u_sdfgamma),u_image:new a.aG(y,o.u_image),u_tex_y_a:new a.aH(y,o.u_tex_y_a),u_tex_y_b:new a.aH(y,o.u_tex_y_b),u_mix:new a.aH(y,o.u_mix)}),raster:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_tl_parent:new a.aL(y,o.u_tl_parent),u_scale_parent:new a.aH(y,o.u_scale_parent),u_buffer_scale:new a.aH(y,o.u_buffer_scale),u_fade_t:new a.aH(y,o.u_fade_t),u_opacity:new a.aH(y,o.u_opacity),u_image0:new a.aG(y,o.u_image0),u_image1:new a.aG(y,o.u_image1),u_brightness_low:new a.aH(y,o.u_brightness_low),u_brightness_high:new a.aH(y,o.u_brightness_high),u_saturation_factor:new a.aH(y,o.u_saturation_factor),u_contrast_factor:new a.aH(y,o.u_contrast_factor),u_spin_weights:new a.aK(y,o.u_spin_weights)}),symbolIcon:(y,o)=>({u_is_size_zoom_constant:new a.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,o.u_is_size_feature_constant),u_size_t:new a.aH(y,o.u_size_t),u_size:new a.aH(y,o.u_size),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pitch:new a.aH(y,o.u_pitch),u_rotate_symbol:new a.aG(y,o.u_rotate_symbol),u_aspect_ratio:new a.aH(y,o.u_aspect_ratio),u_fade_change:new a.aH(y,o.u_fade_change),u_matrix:new a.aI(y,o.u_matrix),u_label_plane_matrix:new a.aI(y,o.u_label_plane_matrix),u_coord_matrix:new a.aI(y,o.u_coord_matrix),u_is_text:new a.aG(y,o.u_is_text),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_texsize:new a.aL(y,o.u_texsize),u_texture:new a.aG(y,o.u_texture)}),symbolSDF:(y,o)=>({u_is_size_zoom_constant:new a.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,o.u_is_size_feature_constant),u_size_t:new a.aH(y,o.u_size_t),u_size:new a.aH(y,o.u_size),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pitch:new a.aH(y,o.u_pitch),u_rotate_symbol:new a.aG(y,o.u_rotate_symbol),u_aspect_ratio:new a.aH(y,o.u_aspect_ratio),u_fade_change:new a.aH(y,o.u_fade_change),u_matrix:new a.aI(y,o.u_matrix),u_label_plane_matrix:new a.aI(y,o.u_label_plane_matrix),u_coord_matrix:new a.aI(y,o.u_coord_matrix),u_is_text:new a.aG(y,o.u_is_text),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_texsize:new a.aL(y,o.u_texsize),u_texture:new a.aG(y,o.u_texture),u_gamma_scale:new a.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_is_halo:new a.aG(y,o.u_is_halo)}),symbolTextAndIcon:(y,o)=>({u_is_size_zoom_constant:new a.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,o.u_is_size_feature_constant),u_size_t:new a.aH(y,o.u_size_t),u_size:new a.aH(y,o.u_size),u_camera_to_center_distance:new a.aH(y,o.u_camera_to_center_distance),u_pitch:new a.aH(y,o.u_pitch),u_rotate_symbol:new a.aG(y,o.u_rotate_symbol),u_aspect_ratio:new a.aH(y,o.u_aspect_ratio),u_fade_change:new a.aH(y,o.u_fade_change),u_matrix:new a.aI(y,o.u_matrix),u_label_plane_matrix:new a.aI(y,o.u_label_plane_matrix),u_coord_matrix:new a.aI(y,o.u_coord_matrix),u_is_text:new a.aG(y,o.u_is_text),u_pitch_with_map:new a.aG(y,o.u_pitch_with_map),u_texsize:new a.aL(y,o.u_texsize),u_texsize_icon:new a.aL(y,o.u_texsize_icon),u_texture:new a.aG(y,o.u_texture),u_texture_icon:new a.aG(y,o.u_texture_icon),u_gamma_scale:new a.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,o.u_device_pixel_ratio),u_is_halo:new a.aG(y,o.u_is_halo)}),background:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_opacity:new a.aH(y,o.u_opacity),u_color:new a.aM(y,o.u_color)}),backgroundPattern:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_opacity:new a.aH(y,o.u_opacity),u_image:new a.aG(y,o.u_image),u_pattern_tl_a:new a.aL(y,o.u_pattern_tl_a),u_pattern_br_a:new a.aL(y,o.u_pattern_br_a),u_pattern_tl_b:new a.aL(y,o.u_pattern_tl_b),u_pattern_br_b:new a.aL(y,o.u_pattern_br_b),u_texsize:new a.aL(y,o.u_texsize),u_mix:new a.aH(y,o.u_mix),u_pattern_size_a:new a.aL(y,o.u_pattern_size_a),u_pattern_size_b:new a.aL(y,o.u_pattern_size_b),u_scale_a:new a.aH(y,o.u_scale_a),u_scale_b:new a.aH(y,o.u_scale_b),u_pixel_coord_upper:new a.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,o.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(y,o.u_tile_units_to_pixels)}),terrain:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_texture:new a.aG(y,o.u_texture),u_ele_delta:new a.aH(y,o.u_ele_delta)}),terrainDepth:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_ele_delta:new a.aH(y,o.u_ele_delta)}),terrainCoords:(y,o)=>({u_matrix:new a.aI(y,o.u_matrix),u_texture:new a.aG(y,o.u_texture),u_terrain_coords_id:new a.aH(y,o.u_terrain_coords_id),u_ele_delta:new a.aH(y,o.u_ele_delta)})};class Yd{constructor(o,h,p){this.context=o;const m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ps={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class _l{constructor(o,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=o;const v=o.gl;this.buffer=v.createBuffer(),o.bindVertexBuffer.set(this.buffer),v.bufferData(v.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&o.enableVertexAttribArray(m)}}setVertexAttribPointers(o,h,p){for(let m=0;m<this.attributes.length;m++){const v=this.attributes[m],E=h.attributes[v.name];E!==void 0&&o.vertexAttribPointer(E,v.components,o[ps[v.type]],!1,this.itemSize,v.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const di=new WeakMap;function oi(y){var o;if(di.has(y))return di.get(y);{const h=(o=y.getParameter(y.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return di.set(y,h),h}}class Mr{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class yl extends Mr{getDefault(){return a.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class vl extends Mr{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Nc extends Mr{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class jc extends Mr{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class bl extends Mr{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Uc extends Mr{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Vc extends Mr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class wl extends Mr{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Oh extends Mr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class Nh extends Mr{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Vs extends Mr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Qd extends Mr{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class ep extends Mr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class tp extends Mr{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class rp extends Mr{getDefault(){return a.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class np extends Mr{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class ip extends Mr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class qc extends Mr{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class xl extends Mr{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class Gc extends Mr{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Wc extends Mr{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class qs extends Mr{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class jh extends Mr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Uh extends Mr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Zc extends Mr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class ms extends Mr{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Vh extends Mr{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Gs extends Mr{getDefault(){return null}set(o){var h;if(o===this.current&&!this.dirty)return;const p=this.gl;oi(p)?p.bindVertexArray(o):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Ws extends Mr{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class qh extends Mr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Hc extends Mr{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Tr extends Mr{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class Sl extends Tr{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class op extends Tr{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Gh extends Tr{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class za{constructor(o,h,p,m,v){this.context=o,this.width=h,this.height=p;const E=o.gl,M=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new Sl(o,M),m)this.depthAttachment=v?new Gh(o,M):new op(o,M);else if(v)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&o.deleteRenderbuffer(p)}o.deleteFramebuffer(this.framebuffer)}}class Sn{constructor(o,h,p){this.blendFunction=o,this.blendColor=h,this.mask=p}}Sn.Replace=[1,0],Sn.disabled=new Sn(Sn.Replace,a.aO.transparent,[!1,!1,!1,!1]),Sn.unblended=new Sn(Sn.Replace,a.aO.transparent,[!0,!0,!0,!0]),Sn.alphaBlended=new Sn([1,771],a.aO.transparent,[!0,!0,!0,!0]);class sp{constructor(o){var h,p;if(this.gl=o,this.clearColor=new yl(this),this.clearDepth=new vl(this),this.clearStencil=new Nc(this),this.colorMask=new jc(this),this.depthMask=new bl(this),this.stencilMask=new Uc(this),this.stencilFunc=new Vc(this),this.stencilOp=new wl(this),this.stencilTest=new Oh(this),this.depthRange=new Nh(this),this.depthTest=new Vs(this),this.depthFunc=new Qd(this),this.blend=new ep(this),this.blendFunc=new tp(this),this.blendColor=new rp(this),this.blendEquation=new np(this),this.cullFace=new ip(this),this.cullFaceSide=new qc(this),this.frontFace=new xl(this),this.program=new Gc(this),this.activeTexture=new Wc(this),this.viewport=new qs(this),this.bindFramebuffer=new jh(this),this.bindRenderbuffer=new Uh(this),this.bindTexture=new Zc(this),this.bindVertexBuffer=new ms(this),this.bindElementBuffer=new Vh(this),this.bindVertexArray=new Gs(this),this.pixelStoreUnpack=new Ws(this),this.pixelStoreUnpackPremultiplyAlpha=new qh(this),this.pixelStoreUnpackFlipY=new Hc(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),oi(o)){this.HALF_FLOAT=o.HALF_FLOAT;const m=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=o.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=o.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const m=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new Yd(this,o,h)}createVertexBuffer(o,h,p){return new _l(this,o,h,p)}createRenderbuffer(o,h,p){const m=this.gl,v=m.createRenderbuffer();return this.bindRenderbuffer.set(v),m.renderbufferStorage(m.RENDERBUFFER,o,h,p),this.bindRenderbuffer.set(null),v}createFramebuffer(o,h,p,m){return new za(this,o,h,p,m)}clear({color:o,depth:h,stencil:p}){const m=this.gl;let v=0;o&&(v|=m.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(v|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(v|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(v)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){a.aD(o.blendFunction,Sn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return oi(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var h;return oi(this.gl)?this.gl.deleteVertexArray(o):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class xr{constructor(o,h,p){this.func=o,this.mask=h,this.range=p}}xr.ReadOnly=!1,xr.ReadWrite=!0,xr.disabled=new xr(519,xr.ReadOnly,[0,1]);const $c=7680;class $r{constructor(o,h,p,m,v,E){this.test=o,this.ref=h,this.mask=p,this.fail=m,this.depthFail=v,this.pass=E}}$r.disabled=new $r({func:519,mask:0},0,0,$c,$c,$c);class jr{constructor(o,h,p){this.enable=o,this.mode=h,this.frontFace=p}}let gs;function kl(y,o,h,p,m,v,E){const M=y.context,A=M.gl,R=y.useProgram("collisionBox"),V=[];let q=0,Y=0;for(let we=0;we<p.length;we++){const Le=p[we],We=o.getTile(Le),$e=We.getBucket(h);if(!$e)continue;let Xe=Le.posMatrix;m[0]===0&&m[1]===0||(Xe=y.translatePosMatrix(Le.posMatrix,We,m,v));const rt=E?$e.textCollisionBox:$e.iconCollisionBox,et=$e.collisionCircleArray;if(et.length>0){const ft=a.F(),mt=Xe;a.aP(ft,$e.placementInvProjMatrix,y.transform.glCoordMatrix),a.aP(ft,ft,$e.placementViewportMatrix),V.push({circleArray:et,circleOffset:Y,transform:mt,invTransform:ft,coord:Le}),q+=et.length/4,Y=q}rt&&R.draw(M,A.LINES,xr.disabled,$r.disabled,y.colorModeForRenderPass(),jr.disabled,Ph(Xe,y.transform,We),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Le),h.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,null,y.transform.zoom,null,null,rt.collisionVertexBuffer)}if(!E||!V.length)return;const fe=y.useProgram("collisionCircle"),he=new a.aQ;he.resize(4*q),he._trim();let ye=0;for(const we of V)for(let Le=0;Le<we.circleArray.length/4;Le++){const We=4*Le,$e=we.circleArray[We+0],Xe=we.circleArray[We+1],rt=we.circleArray[We+2],et=we.circleArray[We+3];he.emplace(ye++,$e,Xe,rt,et,0),he.emplace(ye++,$e,Xe,rt,et,1),he.emplace(ye++,$e,Xe,rt,et,2),he.emplace(ye++,$e,Xe,rt,et,3)}(!gs||gs.length<2*q)&&(gs=function(we){const Le=2*we,We=new a.aS;We.resize(Le),We._trim();for(let $e=0;$e<Le;$e++){const Xe=6*$e;We.uint16[Xe+0]=4*$e+0,We.uint16[Xe+1]=4*$e+1,We.uint16[Xe+2]=4*$e+2,We.uint16[Xe+3]=4*$e+2,We.uint16[Xe+4]=4*$e+3,We.uint16[Xe+5]=4*$e+0}return We}(q));const se=M.createIndexBuffer(gs,!0),Te=M.createVertexBuffer(he,a.aR.members,!0);for(const we of V){const Le={u_matrix:we.transform,u_inv_matrix:we.invTransform,u_camera_to_center_distance:(qe=y.transform).cameraToCenterDistance,u_viewport_size:[qe.width,qe.height]};fe.draw(M,A.TRIANGLES,xr.disabled,$r.disabled,y.colorModeForRenderPass(),jr.disabled,Le,y.style.map.terrain&&y.style.map.terrain.getTerrainData(we.coord),h.id,Te,se,a.$.simpleSegment(0,2*we.circleOffset,we.circleArray.length,we.circleArray.length/2),null,y.transform.zoom,null,null,null)}var qe;Te.destroy(),se.destroy()}jr.disabled=new jr(!1,1029,2305),jr.backCCW=new jr(!0,1029,2305);const Xc=a.an(new Float32Array(16));function Wh(y,o,h,p,m,v){const{horizontalAlign:E,verticalAlign:M}=a.at(y);return new a.P((-(E-.5)*o/m+p[0])*v,(-(M-.5)*h/m+p[1])*v)}function Tl(y,o,h,p,m,v,E,M,A,R,V){const q=y.text.placedSymbolArray,Y=y.text.dynamicLayoutVertexArray,fe=y.icon.dynamicLayoutVertexArray,he={};Y.clear();for(let ye=0;ye<q.length;ye++){const se=q.get(ye),Te=se.hidden||!se.crossTileID||y.allowVerticalPlacement&&!se.placedOrientation?null:p[se.crossTileID];if(Te){const qe=new a.P(se.anchorX,se.anchorY),we=an(qe,h?E:v,V),Le=me(m.cameraToCenterDistance,we.signedDistanceFromCamera);let We=a.ai(y.textSizeData,A,se)*Le/a.ao;h&&(We*=y.tilePixelRatio/M);const{width:$e,height:Xe,anchor:rt,textOffset:et,textBoxScale:ft}=Te,mt=Wh(rt,$e,Xe,et,ft,We),or=h?an(qe.add(mt),v,V).point:we.point.add(o?mt.rotate(-m.angle):mt),gt=y.allowVerticalPlacement&&se.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let Xt=0;Xt<se.numGlyphs;Xt++)a.aj(Y,or,gt);R&&se.associatedIconIndex>=0&&(he[se.associatedIconIndex]={shiftedAnchor:or,angle:gt})}else Ge(se.numGlyphs,Y)}if(R){fe.clear();const ye=y.icon.placedSymbolArray;for(let se=0;se<ye.length;se++){const Te=ye.get(se);if(Te.hidden)Ge(Te.numGlyphs,fe);else{const qe=he[se];if(qe)for(let we=0;we<Te.numGlyphs;we++)a.aj(fe,qe.shiftedAnchor,qe.angle);else Ge(Te.numGlyphs,fe)}}y.icon.dynamicLayoutVertexBuffer.updateData(fe)}y.text.dynamicLayoutVertexBuffer.updateData(Y)}function El(y,o,h){return h.iconsInText&&o?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Ml(y,o,h,p,m,v,E,M,A,R,V,q){const Y=y.context,fe=Y.gl,he=y.transform,ye=M==="map",se=A==="map",Te=M!=="viewport"&&h.layout.get("symbol-placement")!=="point",qe=ye&&!se&&!Te,we=!h.layout.get("symbol-sort-key").isConstant();let Le=!1;const We=y.depthModeForSublayer(0,xr.ReadOnly),$e=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Xe=[];for(const rt of p){const et=o.getTile(rt),ft=et.getBucket(h);if(!ft)continue;const mt=m?ft.text:ft.icon;if(!mt||!mt.segments.get().length||!mt.hasVisibleVertices)continue;const or=mt.programConfigurations.get(h.id),gt=m||ft.sdfIcons,Xt=m?ft.textSizeData:ft.iconSizeData,sr=se||he.pitch!==0,Sr=y.useProgram(El(gt,m,ft),or),er=a.ag(Xt,he.zoom),cr=y.style.map.terrain&&y.style.map.terrain.getTerrainData(rt);let fr,hn,Dr,Oi,Fn=[0,0],nn=null;if(m)hn=et.glyphAtlasTexture,Dr=fe.LINEAR,fr=et.glyphAtlasTexture.size,ft.iconsInText&&(Fn=et.imageAtlasTexture.size,nn=et.imageAtlasTexture,Oi=sr||y.options.rotating||y.options.zooming||Xt.kind==="composite"||Xt.kind==="camera"?fe.LINEAR:fe.NEAREST);else{const Ln=h.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear;hn=et.imageAtlasTexture,Dr=gt||y.options.rotating||y.options.zooming||Ln||sr?fe.LINEAR:fe.NEAREST,fr=et.imageAtlasTexture.size}const On=$t(et,1,y.transform.zoom),Ni=tr(rt.posMatrix,se,ye,y.transform,On),bo=ro(rt.posMatrix,se,ye,y.transform,On),ts=$e&&ft.hasTextData(),Za=h.layout.get("icon-text-fit")!=="none"&&ts&&ft.hasIconData();if(Te){const Ln=y.style.map.terrain?(Ji,Pn)=>y.style.map.terrain.getElevation(rt,Ji,Pn):null,sn=h.layout.get("text-rotation-alignment")==="map";X(ft,rt.posMatrix,y,m,Ni,bo,se,R,sn,Ln)}const rs=y.translatePosMatrix(rt.posMatrix,et,v,E),wo=Te||m&&$e||Za?Xc:Ni,An=y.translatePosMatrix(bo,et,v,E,!0),on=gt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let en;en=gt?ft.iconsInText?Pa(Xt.kind,er,qe,se,y,rs,wo,An,fr,Fn):La(Xt.kind,er,qe,se,y,rs,wo,An,m,fr,!0):Aa(Xt.kind,er,qe,se,y,rs,wo,An,m,fr);const Ki={program:Sr,buffers:mt,uniformValues:en,atlasTexture:hn,atlasTextureIcon:nn,atlasInterpolation:Dr,atlasInterpolationIcon:Oi,isSDF:gt,hasHalo:on};if(we&&ft.canOverlap){Le=!0;const Ln=mt.segments.get();for(const sn of Ln)Xe.push({segments:new a.$([sn]),sortKey:sn.sortKey,state:Ki,terrainData:cr})}else Xe.push({segments:mt.segments,sortKey:0,state:Ki,terrainData:cr})}Le&&Xe.sort((rt,et)=>rt.sortKey-et.sortKey);for(const rt of Xe){const et=rt.state;if(Y.activeTexture.set(fe.TEXTURE0),et.atlasTexture.bind(et.atlasInterpolation,fe.CLAMP_TO_EDGE),et.atlasTextureIcon&&(Y.activeTexture.set(fe.TEXTURE1),et.atlasTextureIcon&&et.atlasTextureIcon.bind(et.atlasInterpolationIcon,fe.CLAMP_TO_EDGE)),et.isSDF){const ft=et.uniformValues;et.hasHalo&&(ft.u_is_halo=1,Zh(et.buffers,rt.segments,h,y,et.program,We,V,q,ft,rt.terrainData)),ft.u_is_halo=0}Zh(et.buffers,rt.segments,h,y,et.program,We,V,q,et.uniformValues,rt.terrainData)}}function Zh(y,o,h,p,m,v,E,M,A,R){const V=p.context;m.draw(V,V.gl.TRIANGLES,v,E,M,jr.disabled,A,R,h.id,y.layoutVertexBuffer,y.indexBuffer,o,h.paint,p.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Cl(y,o,h,p,m){if(!h||!p||!p.imageAtlas)return;const v=p.imageAtlas.patternPositions;let E=v[h.to.toString()],M=v[h.from.toString()];if(!E&&M&&(E=M),!M&&E&&(M=E),!E||!M){const A=m.getPaintProperty(o);E=v[A],M=v[A]}E&&M&&y.setConstantPatternPositions(E,M)}function Hh(y,o,h,p,m,v,E){const M=y.context.gl,A="fill-pattern",R=h.paint.get(A),V=R&&R.constantOr(1),q=h.getCrossfadeParameters();let Y,fe,he,ye,se;E?(fe=V&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Y=M.LINES):(fe=V?"fillPattern":"fill",Y=M.TRIANGLES);const Te=R.constantOr(null);for(const qe of p){const we=o.getTile(qe);if(V&&!we.patternsLoaded())continue;const Le=we.getBucket(h);if(!Le)continue;const We=Le.programConfigurations.get(h.id),$e=y.useProgram(fe,We),Xe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(qe);V&&(y.context.activeTexture.set(M.TEXTURE0),we.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),We.updatePaintBuffers(q)),Cl(We,A,Te,we,h);const rt=Xe?qe:null,et=y.translatePosMatrix(rt?rt.posMatrix:qe.posMatrix,we,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){ye=Le.indexBuffer2,se=Le.segments2;const ft=[M.drawingBufferWidth,M.drawingBufferHeight];he=fe==="fillOutlinePattern"&&V?Lh(et,y,q,we,ft):$d(et,ft)}else ye=Le.indexBuffer,se=Le.segments,he=V?fl(et,y,q,we):Ah(et);$e.draw(y.context,Y,m,y.stencilModeForClipping(qe),v,jr.disabled,he,Xe,h.id,Le.layoutVertexBuffer,ye,se,h.paint,y.transform.zoom,We)}}function Il(y,o,h,p,m,v,E){const M=y.context,A=M.gl,R="fill-extrusion-pattern",V=h.paint.get(R),q=V.constantOr(1),Y=h.getCrossfadeParameters(),fe=h.paint.get("fill-extrusion-opacity"),he=V.constantOr(null);for(const ye of p){const se=o.getTile(ye),Te=se.getBucket(h);if(!Te)continue;const qe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(ye),we=Te.programConfigurations.get(h.id),Le=y.useProgram(q?"fillExtrusionPattern":"fillExtrusion",we);q&&(y.context.activeTexture.set(A.TEXTURE0),se.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),we.updatePaintBuffers(Y)),Cl(we,R,he,se,h);const We=y.translatePosMatrix(ye.posMatrix,se,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),$e=h.paint.get("fill-extrusion-vertical-gradient"),Xe=q?Hd(We,y,$e,fe,ye,Y,se):Ma(We,y,$e,fe);Le.draw(M,M.gl.TRIANGLES,m,v,E,jr.backCCW,Xe,qe,h.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,h.paint,y.transform.zoom,we,y.style.map.terrain&&Te.centroidVertexBuffer)}}function Al(y,o,h,p,m,v,E){const M=y.context,A=M.gl,R=h.fbo;if(!R)return;const V=y.useProgram("hillshade"),q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,R.colorAttachment.get()),V.draw(M,A.TRIANGLES,m,v,E,jr.disabled,((Y,fe,he,ye)=>{const se=he.paint.get("hillshade-shadow-color"),Te=he.paint.get("hillshade-highlight-color"),qe=he.paint.get("hillshade-accent-color");let we=he.paint.get("hillshade-illumination-direction")*(Math.PI/180);he.paint.get("hillshade-illumination-anchor")==="viewport"&&(we-=Y.transform.angle);const Le=!Y.options.moving;return{u_matrix:ye?ye.posMatrix:Y.transform.calculatePosMatrix(fe.tileID.toUnwrapped(),Le),u_image:0,u_latrange:Rh(0,fe.tileID),u_light:[he.paint.get("hillshade-exaggeration"),we],u_shadow:se,u_highlight:Te,u_accent:qe}})(y,h,p,q?o:null),q,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function Kc(y,o,h,p,m,v){const E=y.context,M=E.gl,A=o.dem;if(A&&A.data){const R=A.dim,V=A.stride,q=A.getPixels();if(E.activeTexture.set(M.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||y.getTileTexture(V),o.demTexture){const fe=o.demTexture;fe.update(q,{premultiply:!1}),fe.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else o.demTexture=new re(E,q,M.RGBA,{premultiply:!1}),o.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);E.activeTexture.set(M.TEXTURE0);let Y=o.fbo;if(!Y){const fe=new re(E,{width:R,height:R,data:null},M.RGBA);fe.bind(M.LINEAR,M.CLAMP_TO_EDGE),Y=o.fbo=E.createFramebuffer(R,R,!0,!1),Y.colorAttachment.set(fe.texture)}E.bindFramebuffer.set(Y.framebuffer),E.viewport.set([0,0,R,R]),y.useProgram("hillshadePrepare").draw(E,M.TRIANGLES,p,m,v,jr.disabled,((fe,he)=>{const ye=he.stride,se=a.F();return a.aN(se,0,a.W,-a.W,0,0,1),a.H(se,se,[0,-a.W,0]),{u_matrix:se,u_image:1,u_dimension:[ye,ye],u_zoom:fe.overscaledZ,u_unpack:he.getUnpackVector()}})(o.tileID,A),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function $h(y,o,h,p,m,v){const E=p.paint.get("raster-fade-duration");if(!v&&E>0){const M=S.now(),A=(M-y.timeAdded)/E,R=o?(M-o.timeAdded)/E:-1,V=h.getSource(),q=m.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),Y=!o||Math.abs(o.tileID.overscaledZ-q)>Math.abs(y.tileID.overscaledZ-q),fe=Y&&y.refreshedUponExpiration?1:a.ac(Y?A:1-R,0,1);return y.refreshedUponExpiration&&A>=1&&(y.refreshedUponExpiration=!1),o?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}const Xh=new a.aO(1,0,0,1),Ll=new a.aO(0,1,0,1),Jc=new a.aO(0,0,1,1),ap=new a.aO(1,0,1,1),Kh=new a.aO(0,1,1,1);function cn(y,o,h,p){pi(y,0,o+h/2,y.transform.width,h,p)}function Jo(y,o,h,p){pi(y,o-h/2,0,h,y.transform.height,p)}function pi(y,o,h,p,m,v){const E=y.context,M=E.gl;M.enable(M.SCISSOR_TEST),M.scissor(o*y.pixelRatio,h*y.pixelRatio,p*y.pixelRatio,m*y.pixelRatio),E.clear({color:v}),M.disable(M.SCISSOR_TEST)}function Yc(y,o,h){const p=y.context,m=p.gl,v=h.posMatrix,E=y.useProgram("debug"),M=xr.disabled,A=$r.disabled,R=y.colorModeForRenderPass(),V="$debug",q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const Y=o.getTileByID(h.key).latestRawTileData,fe=Math.floor((Y&&Y.byteLength||0)/1024),he=o.getTile(h).tileSize,ye=512/Math.min(he,512)*(h.overscaledZ/y.transform.zoom)*.5;let se=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(se+=` => ${h.overscaledZ}`),function(Te,qe){Te.initDebugOverlayCanvas();const we=Te.debugOverlayCanvas,Le=Te.context.gl,We=Te.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,we.width,we.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText(qe,5,5),We.strokeText(qe,5,5),Te.debugOverlayTexture.update(we),Te.debugOverlayTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE)}(y,`${se} ${fe}kB`),E.draw(p,m.TRIANGLES,M,A,Sn.alphaBlended,jr.disabled,zh(v,a.aO.transparent,ye),null,V,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),E.draw(p,m.LINE_STRIP,M,A,R,jr.disabled,zh(v,a.aO.red),q,V,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Pl(y,o,h){const p=y.context,m=p.gl,v=y.colorModeForRenderPass(),E=new xr(m.LEQUAL,xr.ReadWrite,y.depthRangeFor3D),M=y.useProgram("terrain"),A=o.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const R of h){const V=y.renderToTexture.getTexture(R),q=o.getTerrainData(R.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,V.texture);const Y={u_matrix:y.transform.calculatePosMatrix(R.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(y.transform.zoom)};M.draw(p,m.TRIANGLES,E,$r.disabled,v,jr.backCCW,Y,q,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}class Jh{constructor(o,h){this.context=new sp(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Or.maxUnderzooming+Or.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Xo}resize(o,h,p){if(this.width=Math.floor(o*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const o=this.context,h=new a.aV;h.emplaceBack(0,0),h.emplaceBack(a.W,0),h.emplaceBack(0,a.W),h.emplaceBack(a.W,a.W),this.tileExtentBuffer=o.createVertexBuffer(h,cl.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const p=new a.aV;p.emplaceBack(0,0),p.emplaceBack(a.W,0),p.emplaceBack(0,a.W),p.emplaceBack(a.W,a.W),this.debugBuffer=o.createVertexBuffer(p,cl.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const m=new a.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(a.W,0,a.W,0),m.emplaceBack(0,a.W,0,a.W),m.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=o.createVertexBuffer(m,Ze.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const v=new a.aV;v.emplaceBack(0,0),v.emplaceBack(1,0),v.emplaceBack(0,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,cl.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const E=new a.aW;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(E);const M=new a.aX;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(M);const A=this.context.gl;this.stencilClearMode=new $r({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.F();a.aN(p,0,this.width,this.height,0,0,1),a.J(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,xr.disabled,this.stencilClearMode,Sn.disabled,jr.disabled,dl(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(Sn.disabled),p.setDepthMode(xr.disabled);const v=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const M=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);v.draw(p,m.TRIANGLES,xr.disabled,new $r({func:m.ALWAYS,mask:0},M,255,m.KEEP,m.KEEP,m.REPLACE),Sn.disabled,jr.disabled,dl(E.posMatrix),A,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new $r({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new $r({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,p=o.sort((E,M)=>M.overscaledZ-E.overscaledZ),m=p[p.length-1].overscaledZ,v=p[0].overscaledZ-m+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const E={};for(let M=0;M<v;M++)E[M+m]=new $r({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=v,[E,p]}return[{[m]:$r.disabled},p]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Sn([o.CONSTANT_COLOR,o.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Sn.unblended:Sn.alphaBlended}depthModeForSublayer(o,h,p){if(!this.opaquePassEnabledForLayer())return xr.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new xr(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,v={},E={},M={};for(const A in m){const R=m[A];R.used&&R.prepare(this.context),v[A]=R.getVisibleCoordinates(),E[A]=v[A].slice().reverse(),M[A]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of p){const R=this.style._layers[A];if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const V=E[R.source];(R.type==="custom"||V.length)&&this.renderLayer(this,m[R.source],R,V)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],R=m[A.source],V=v[A.source];this._renderTileClippingMasks(A,V),this.renderLayer(this,R,A,V)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],R=m[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A))continue;const V=(A.type==="symbol"?M:E)[A.source];this._renderTileClippingMasks(A,v[A.source]),this.renderLayer(this,R,A,V)}if(this.options.showTileBoundaries){const A=function(R,V){let q=null;const Y=Object.values(R._layers).flatMap(se=>se.source&&!se.isHidden(V)?[R.sourceCaches[se.source]]:[]),fe=Y.filter(se=>se.getSource().type==="vector"),he=Y.filter(se=>se.getSource().type!=="vector"),ye=se=>{(!q||q.getSource().maxzoom<se.getSource().maxzoom)&&(q=se)};return fe.forEach(se=>ye(se)),q||he.forEach(se=>ye(se)),q}(this.style,this.transform.zoom);A&&function(R,V,q){for(let Y=0;Y<q.length;Y++)Yc(R,V,q[Y])}(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const R=A.transform.padding;cn(A,A.transform.height-(R.top||0),3,Xh),cn(A,R.bottom||0,3,Ll),Jo(A,R.left||0,3,Jc),Jo(A,A.transform.width-(R.right||0),3,ap);const V=A.transform.centerPoint;(function(q,Y,fe,he){pi(q,Y-1,fe-10,2,20,he),pi(q,Y-10,fe-1,20,2,he)})(A,V.x,A.transform.height-V.y,Kh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=o?!a.aY(h,p):!a.aZ(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.a_(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(v,E){const M=v.context,A=M.gl,R=Sn.unblended,V=new xr(A.LEQUAL,xr.ReadWrite,[0,1]),q=E.getTerrainMesh(),Y=E.sourceCache.getRenderableTiles(),fe=v.useProgram("terrainDepth");M.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1});for(const he of Y){const ye=E.getTerrainData(he.tileID),se={u_matrix:v.transform.calculatePosMatrix(he.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};fe.draw(M,A.TRIANGLES,V,$r.disabled,R,jr.backCCW,se,ye,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain),function(v,E){const M=v.context,A=M.gl,R=Sn.unblended,V=new xr(A.LEQUAL,xr.ReadWrite,[0,1]),q=E.getTerrainMesh(),Y=E.getCoordsTexture(),fe=E.sourceCache.getRenderableTiles(),he=v.useProgram("terrainCoords");M.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,v.width/devicePixelRatio,v.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1}),E.coordsIndex=[];for(const ye of fe){const se=E.getTerrainData(ye.tileID);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,Y.texture);const Te={u_matrix:v.transform.calculatePosMatrix(ye.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(v.transform.zoom)};he.draw(M,A.TRIANGLES,V,$r.disabled,R,jr.backCCW,Te,se,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),E.coordsIndex.push(ye.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,v.width,v.height])}(this,this.style.map.terrain))}renderLayer(o,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(v,E,M,A,R){if(v.renderPass!=="translucent")return;const V=$r.disabled,q=v.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Y,fe,he,ye,se,Te,qe){const we=fe.transform,Le=se==="map",We=Te==="map";for(const $e of Y){const Xe=ye.getTile($e),rt=Xe.getBucket(he);if(!rt||!rt.text||!rt.text.segments.get().length)continue;const et=a.ag(rt.textSizeData,we.zoom),ft=$t(Xe,1,fe.transform.zoom),mt=tr($e.posMatrix,We,Le,fe.transform,ft),or=he.layout.get("icon-text-fit")!=="none"&&rt.hasIconData();if(et){const gt=Math.pow(2,we.zoom-Xe.tileID.overscaledZ);Tl(rt,Le,We,qe,we,mt,$e.posMatrix,gt,et,or,fe.style.map.terrain?(Xt,sr)=>fe.style.map.terrain.getElevation($e,Xt,sr):null)}}}(A,v,M,E,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),R),M.paint.get("icon-opacity").constantOr(1)!==0&&Ml(v,E,M,A,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),V,q),M.paint.get("text-opacity").constantOr(1)!==0&&Ml(v,E,M,A,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),V,q),E.map.showCollisionBoxes&&(kl(v,E,M,A,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),!0),kl(v,E,M,A,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),!1))})(o,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(v,E,M,A){if(v.renderPass!=="translucent")return;const R=M.paint.get("circle-opacity"),V=M.paint.get("circle-stroke-width"),q=M.paint.get("circle-stroke-opacity"),Y=!M.layout.get("circle-sort-key").isConstant();if(R.constantOr(1)===0&&(V.constantOr(1)===0||q.constantOr(1)===0))return;const fe=v.context,he=fe.gl,ye=v.depthModeForSublayer(0,xr.ReadOnly),se=$r.disabled,Te=v.colorModeForRenderPass(),qe=[];for(let we=0;we<A.length;we++){const Le=A[we],We=E.getTile(Le),$e=We.getBucket(M);if(!$e)continue;const Xe=$e.programConfigurations.get(M.id),rt=v.useProgram("circle",Xe),et=$e.layoutVertexBuffer,ft=$e.indexBuffer,mt=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Le),or={programConfiguration:Xe,program:rt,layoutVertexBuffer:et,indexBuffer:ft,uniformValues:Xd(v,Le,We,M),terrainData:mt};if(Y){const gt=$e.segments.get();for(const Xt of gt)qe.push({segments:new a.$([Xt]),sortKey:Xt.sortKey,state:or})}else qe.push({segments:$e.segments,sortKey:0,state:or})}Y&&qe.sort((we,Le)=>we.sortKey-Le.sortKey);for(const we of qe){const{programConfiguration:Le,program:We,layoutVertexBuffer:$e,indexBuffer:Xe,uniformValues:rt,terrainData:et}=we.state;We.draw(fe,he.TRIANGLES,ye,se,Te,jr.disabled,rt,et,M.id,$e,Xe,we.segments,M.paint,v.transform.zoom,Le)}})(o,h,p,m);break;case"heatmap":(function(v,E,M,A){if(M.paint.get("heatmap-opacity")!==0)if(v.renderPass==="offscreen"){const R=v.context,V=R.gl,q=$r.disabled,Y=new Sn([V.ONE,V.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(fe,he,ye){const se=fe.gl;fe.activeTexture.set(se.TEXTURE1),fe.viewport.set([0,0,he.width/4,he.height/4]);let Te=ye.heatmapFbo;if(Te)se.bindTexture(se.TEXTURE_2D,Te.colorAttachment.get()),fe.bindFramebuffer.set(Te.framebuffer);else{const qe=se.createTexture();se.bindTexture(se.TEXTURE_2D,qe),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_S,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_WRAP_T,se.CLAMP_TO_EDGE),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MIN_FILTER,se.LINEAR),se.texParameteri(se.TEXTURE_2D,se.TEXTURE_MAG_FILTER,se.LINEAR),Te=ye.heatmapFbo=fe.createFramebuffer(he.width/4,he.height/4,!1,!1),function(we,Le,We,$e){var Xe,rt;const et=we.gl,ft=(Xe=we.HALF_FLOAT)!==null&&Xe!==void 0?Xe:et.UNSIGNED_BYTE,mt=(rt=we.RGBA16F)!==null&&rt!==void 0?rt:et.RGBA;et.texImage2D(et.TEXTURE_2D,0,mt,Le.width/4,Le.height/4,0,et.RGBA,ft,null),$e.colorAttachment.set(We)}(fe,he,qe,Te)}})(R,v,M),R.clear({color:a.aO.transparent});for(let fe=0;fe<A.length;fe++){const he=A[fe];if(E.hasRenderableParent(he))continue;const ye=E.getTile(he),se=ye.getBucket(M);if(!se)continue;const Te=se.programConfigurations.get(M.id),qe=v.useProgram("heatmap",Te),{zoom:we}=v.transform;qe.draw(R,V.TRIANGLES,xr.disabled,q,Y,jr.disabled,Dh(he.posMatrix,ye,we,M.paint.get("heatmap-intensity")),null,M.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,M.paint,v.transform.zoom,Te)}R.viewport.set([0,0,v.width,v.height])}else v.renderPass==="translucent"&&(v.context.setColorMode(v.colorModeForRenderPass()),function(R,V){const q=R.context,Y=q.gl,fe=V.heatmapFbo;if(!fe)return;q.activeTexture.set(Y.TEXTURE0),Y.bindTexture(Y.TEXTURE_2D,fe.colorAttachment.get()),q.activeTexture.set(Y.TEXTURE1);let he=V.colorRampTexture;he||(he=V.colorRampTexture=new re(q,V.colorRamp,Y.RGBA)),he.bind(Y.LINEAR,Y.CLAMP_TO_EDGE),R.useProgram("heatmapTexture").draw(q,Y.TRIANGLES,xr.disabled,$r.disabled,R.colorModeForRenderPass(),jr.disabled,((ye,se,Te,qe)=>{const we=a.F();a.aN(we,0,ye.width,ye.height,0,0,1);const Le=ye.context.gl;return{u_matrix:we,u_world:[Le.drawingBufferWidth,Le.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:se.paint.get("heatmap-opacity")}})(R,V),null,V.id,R.viewportBuffer,R.quadTriangleIndexBuffer,R.viewportSegments,V.paint,R.transform.zoom)}(v,M))})(o,h,p,m);break;case"line":(function(v,E,M,A){if(v.renderPass!=="translucent")return;const R=M.paint.get("line-opacity"),V=M.paint.get("line-width");if(R.constantOr(1)===0||V.constantOr(1)===0)return;const q=v.depthModeForSublayer(0,xr.ReadOnly),Y=v.colorModeForRenderPass(),fe=M.paint.get("line-dasharray"),he=M.paint.get("line-pattern"),ye=he.constantOr(1),se=M.paint.get("line-gradient"),Te=M.getCrossfadeParameters(),qe=ye?"linePattern":fe?"lineSDF":se?"lineGradient":"line",we=v.context,Le=we.gl;let We=!0;for(const $e of A){const Xe=E.getTile($e);if(ye&&!Xe.patternsLoaded())continue;const rt=Xe.getBucket(M);if(!rt)continue;const et=rt.programConfigurations.get(M.id),ft=v.context.program.get(),mt=v.useProgram(qe,et),or=We||mt.program!==ft,gt=v.style.map.terrain&&v.style.map.terrain.getTerrainData($e),Xt=he.constantOr(null);if(Xt&&Xe.imageAtlas){const er=Xe.imageAtlas,cr=er.patternPositions[Xt.to.toString()],fr=er.patternPositions[Xt.from.toString()];cr&&fr&&et.setConstantPatternPositions(cr,fr)}const sr=gt?$e:null,Sr=ye?ds(v,Xe,M,Te,sr):fe?ml(v,Xe,M,fe,Te,sr):se?Bh(v,Xe,M,rt.lineClipsArray.length,sr):pl(v,Xe,M,sr);if(ye)we.activeTexture.set(Le.TEXTURE0),Xe.imageAtlasTexture.bind(Le.LINEAR,Le.CLAMP_TO_EDGE),et.updatePaintBuffers(Te);else if(fe&&(or||v.lineAtlas.dirty))we.activeTexture.set(Le.TEXTURE0),v.lineAtlas.bind(we);else if(se){const er=rt.gradients[M.id];let cr=er.texture;if(M.gradientVersion!==er.version){let fr=256;if(M.stepInterpolant){const hn=E.getSource().maxzoom,Dr=$e.canonical.z===hn?Math.ceil(1<<v.transform.maxZoom-$e.canonical.z):1;fr=a.ac(a.aT(rt.maxLineLength/a.W*1024*Dr),256,we.maxTextureSize)}er.gradient=a.aU({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:fr,image:er.gradient||void 0,clips:rt.lineClipsArray}),er.texture?er.texture.update(er.gradient):er.texture=new re(we,er.gradient,Le.RGBA),er.version=M.gradientVersion,cr=er.texture}we.activeTexture.set(Le.TEXTURE0),cr.bind(M.stepInterpolant?Le.NEAREST:Le.LINEAR,Le.CLAMP_TO_EDGE)}mt.draw(we,Le.TRIANGLES,q,v.stencilModeForClipping($e),Y,jr.disabled,Sr,gt,M.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,M.paint,v.transform.zoom,et,rt.layoutVertexBuffer2),We=!1}})(o,h,p,m);break;case"fill":(function(v,E,M,A){const R=M.paint.get("fill-color"),V=M.paint.get("fill-opacity");if(V.constantOr(1)===0)return;const q=v.colorModeForRenderPass(),Y=M.paint.get("fill-pattern"),fe=v.opaquePassEnabledForLayer()&&!Y.constantOr(1)&&R.constantOr(a.aO.transparent).a===1&&V.constantOr(0)===1?"opaque":"translucent";if(v.renderPass===fe){const he=v.depthModeForSublayer(1,v.renderPass==="opaque"?xr.ReadWrite:xr.ReadOnly);Hh(v,E,M,A,he,q,!1)}if(v.renderPass==="translucent"&&M.paint.get("fill-antialias")){const he=v.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,xr.ReadOnly);Hh(v,E,M,A,he,q,!0)}})(o,h,p,m);break;case"fill-extrusion":(function(v,E,M,A){const R=M.paint.get("fill-extrusion-opacity");if(R!==0&&v.renderPass==="translucent"){const V=new xr(v.context.gl.LEQUAL,xr.ReadWrite,v.depthRangeFor3D);if(R!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))Il(v,E,M,A,V,$r.disabled,Sn.disabled),Il(v,E,M,A,V,v.stencilModeFor3D(),v.colorModeForRenderPass());else{const q=v.colorModeForRenderPass();Il(v,E,M,A,V,$r.disabled,q)}}})(o,h,p,m);break;case"hillshade":(function(v,E,M,A){if(v.renderPass!=="offscreen"&&v.renderPass!=="translucent")return;const R=v.context,V=v.depthModeForSublayer(0,xr.ReadOnly),q=v.colorModeForRenderPass(),[Y,fe]=v.renderPass==="translucent"?v.stencilConfigForOverlap(A):[{},A];for(const he of fe){const ye=E.getTile(he);ye.needsHillshadePrepare!==void 0&&ye.needsHillshadePrepare&&v.renderPass==="offscreen"?Kc(v,ye,M,V,$r.disabled,q):v.renderPass==="translucent"&&Al(v,he,ye,M,V,Y[he.overscaledZ],q)}R.viewport.set([0,0,v.width,v.height])})(o,h,p,m);break;case"raster":(function(v,E,M,A){if(v.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!A.length)return;const R=v.context,V=R.gl,q=E.getSource(),Y=v.useProgram("raster"),fe=v.colorModeForRenderPass(),[he,ye]=q instanceof bt?[{},A]:v.stencilConfigForOverlap(A),se=ye[ye.length-1].overscaledZ,Te=!v.options.moving;for(const qe of ye){const we=v.depthModeForSublayer(qe.overscaledZ-se,M.paint.get("raster-opacity")===1?xr.ReadWrite:xr.ReadOnly,V.LESS),Le=E.getTile(qe);Le.registerFadeDuration(M.paint.get("raster-fade-duration"));const We=E.findLoadedParent(qe,0),$e=$h(Le,We,E,M,v.transform,v.style.map.terrain);let Xe,rt;const et=M.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;R.activeTexture.set(V.TEXTURE0),Le.texture.bind(et,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),R.activeTexture.set(V.TEXTURE1),We?(We.texture.bind(et,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),Xe=Math.pow(2,We.tileID.overscaledZ-Le.tileID.overscaledZ),rt=[Le.tileID.canonical.x*Xe%1,Le.tileID.canonical.y*Xe%1]):Le.texture.bind(et,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const ft=v.style.map.terrain&&v.style.map.terrain.getTerrainData(qe),mt=ft?qe:null,or=mt?mt.posMatrix:v.transform.calculatePosMatrix(qe.toUnwrapped(),Te),gt=gl(or,rt||[0,0],Xe||1,$e,M);q instanceof bt?Y.draw(R,V.TRIANGLES,we,$r.disabled,fe,jr.disabled,gt,ft,M.id,q.boundsBuffer,v.quadTriangleIndexBuffer,q.boundsSegments):Y.draw(R,V.TRIANGLES,we,he[qe.overscaledZ],fe,jr.disabled,gt,ft,M.id,v.rasterBoundsBuffer,v.quadTriangleIndexBuffer,v.rasterBoundsSegments)}})(o,h,p,m);break;case"background":(function(v,E,M,A){const R=M.paint.get("background-color"),V=M.paint.get("background-opacity");if(V===0)return;const q=v.context,Y=q.gl,fe=v.transform,he=fe.tileSize,ye=M.paint.get("background-pattern");if(v.isPatternMissing(ye))return;const se=!ye&&R.a===1&&V===1&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==se)return;const Te=$r.disabled,qe=v.depthModeForSublayer(0,se==="opaque"?xr.ReadWrite:xr.ReadOnly),we=v.colorModeForRenderPass(),Le=v.useProgram(ye?"backgroundPattern":"background"),We=A||fe.coveringTiles({tileSize:he,terrain:v.style.map.terrain});ye&&(q.activeTexture.set(Y.TEXTURE0),v.imageManager.bind(v.context));const $e=M.getCrossfadeParameters();for(const Xe of We){const rt=A?Xe.posMatrix:v.transform.calculatePosMatrix(Xe.toUnwrapped()),et=ye?Jd(rt,V,v,ye,{tileID:Xe,tileSize:he},$e):Kd(rt,V,R),ft=v.style.map.terrain&&v.style.map.terrain.getTerrainData(Xe);Le.draw(q,Y.TRIANGLES,qe,Te,we,jr.disabled,et,ft,M.id,v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}})(o,0,p,m);break;case"custom":(function(v,E,M){const A=v.context,R=M.implementation;if(v.renderPass==="offscreen"){const V=R.prerender;V&&(v.setCustomLayerDefaults(),A.setColorMode(v.colorModeForRenderPass()),V.call(R,A.gl,v.transform.customLayerMatrix()),A.setDirty(),v.setBaseState())}else if(v.renderPass==="translucent"){v.setCustomLayerDefaults(),A.setColorMode(v.colorModeForRenderPass()),A.setStencilMode($r.disabled);const V=R.renderingMode==="3d"?new xr(v.context.gl.LEQUAL,xr.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,xr.ReadOnly);A.setDepthMode(V),R.render(A.gl,v.transform.customLayerMatrix()),A.setDirty(),v.setBaseState(),A.bindFramebuffer.set(null)}})(o,0,p)}}translatePosMatrix(o,h,p,m,v){if(!p[0]&&!p[1])return o;const E=v?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(E){const R=Math.sin(E),V=Math.cos(E);p=[p[0]*V-p[1]*R,p[0]*R+p[1]*V]}const M=[v?p[0]:$t(h,p[0],this.transform.zoom),v?p[1]:$t(h,p[1],this.transform.zoom),0],A=new Float32Array(16);return a.H(A,o,M),A}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),p=this.imageManager.getPattern(o.to.toString());return!h||!p}useProgram(o,h){this.cache=this.cache||{};const p=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Ko(this.context,Ea[o],h,Fh[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new re(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:h}=this.context.gl;return this.width!==o||this.height!==h}}class Yo{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,p){const m=Math.pow(2,p),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const A=1/(M=a.af([],M,o))[3]/h*m;return a.a$(M,M,[A,A,1/M[3],A])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const A=function(Y,fe){var he=fe[0],ye=fe[1],se=fe[2],Te=he*he+ye*ye+se*se;return Te>0&&(Te=1/Math.sqrt(Te)),Y[0]=fe[0]*Te,Y[1]=fe[1]*Te,Y[2]=fe[2]*Te,Y}([],function(Y,fe,he){var ye=fe[0],se=fe[1],Te=fe[2],qe=he[0],we=he[1],Le=he[2];return Y[0]=se*Le-Te*we,Y[1]=Te*qe-ye*Le,Y[2]=ye*we-se*qe,Y}([],J([],v[M[0]],v[M[1]]),J([],v[M[2]],v[M[1]]))),R=-((V=A)[0]*(q=v[M[1]])[0]+V[1]*q[1]+V[2]*q[2]);var V,q;return A.concat(R)});return new Yo(v,E)}}class Qo{constructor(o,h){this.min=o,this.max=h,this.center=function(p,m,v){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,v){return p[0]=m[0]+v[0],p[1]=m[1]+v[1],p[2]=m[2]+v[2],p}([],this.min,this.max))}quadrant(o){const h=[o%2==0,o<2],p=le(this.min),m=le(this.max);for(let v=0;v<h.length;v++)p[v]=h[v]?this.min[v]:this.center[v],m[v]=h[v]?this.center[v]:this.max[v];return m[2]=this.max[2],new Qo(p,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<o.planes.length;m++){const v=o.planes[m];let E=0;for(let M=0;M<h.length;M++)a.b0(v,h[M])>=0&&E++;if(E===0)return 0;E!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let v=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let M=0;M<o.points.length;M++){const A=o.points[M][m]-this.min[m];v=Math.min(v,A),E=Math.max(E,A)}if(E<0||v>this.max[m]-this.min[m])return 0}return 1}}class Zs{constructor(o=0,h=0,p=0,m=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=p,this.right=m}interpolate(o,h,p){return h.top!=null&&o.top!=null&&(this.top=a.z.number(o.top,h.top,p)),h.bottom!=null&&o.bottom!=null&&(this.bottom=a.z.number(o.bottom,h.bottom,p)),h.left!=null&&o.left!=null&&(this.left=a.z.number(o.left,h.left,p)),h.right!=null&&o.right!=null&&(this.right=a.z.number(o.right,h.right,p)),this}getCenter(o,h){const p=a.ac((this.left+o-this.right)/2,0,o),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Zs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Qc=85.051129;class zl{constructor(o,h,p,m,v){this.tileSize=512,this._renderWorldCopies=v===void 0||!!v,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Zs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new zl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-a.b1(o,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,v){var E=m[0],M=m[1],A=m[2],R=m[3],V=Math.sin(v),q=Math.cos(v);p[0]=E*q+A*V,p[1]=M*q+R*V,p[2]=E*-V+A*q,p[3]=M*-V+R*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=a.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,p){this._unmodified=!1,this._edgeInsets.interpolate(o,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new a.b2(0,o)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),v=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),M=Math.floor(Math.min(p.x,m.x,v.x,E.x)),A=Math.floor(Math.max(p.x,m.x,v.x,E.x)),R=1;for(let V=M-R;V<=A+R;V++)V!==0&&h.push(new a.b2(V,o))}return h}coveringTiles(o){var h,p;let m=this.coveringZoomLevel(o);const v=m;if(o.minzoom!==void 0&&m<o.minzoom)return[];o.maxzoom!==void 0&&m>o.maxzoom&&(m=o.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),M=a.Y.fromLngLat(this.center),A=Math.pow(2,m),R=[A*E.x,A*E.y,0],V=[A*M.x,A*M.y,0],q=Yo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let Y=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Y=m);const fe=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,he=we=>({aabb:new Qo([we*A,0,0],[(we+1)*A,A,0]),zoom:0,x:0,y:0,wrap:we,fullyVisible:!1}),ye=[],se=[],Te=m,qe=o.reparseOverscaled?v:m;if(this._renderWorldCopies)for(let we=1;we<=3;we++)ye.push(he(-we)),ye.push(he(we));for(ye.push(he(0));ye.length>0;){const we=ye.pop(),Le=we.x,We=we.y;let $e=we.fullyVisible;if(!$e){const mt=we.aabb.intersects(q);if(mt===0)continue;$e=mt===2}const Xe=o.terrain?R:V,rt=we.aabb.distanceX(Xe),et=we.aabb.distanceY(Xe),ft=Math.max(Math.abs(rt),Math.abs(et));if(we.zoom===Te||ft>fe+(1<<Te-we.zoom)-2&&we.zoom>=Y){const mt=Te-we.zoom,or=R[0]-.5-(Le<<mt),gt=R[1]-.5-(We<<mt);se.push({tileID:new a.Q(we.zoom===Te?qe:we.zoom,we.wrap,we.zoom,Le,We),distanceSq:_e([V[0]-.5-Le,V[1]-.5-We]),tileDistanceToCamera:Math.sqrt(or*or+gt*gt)})}else for(let mt=0;mt<4;mt++){const or=(Le<<1)+mt%2,gt=(We<<1)+(mt>>1),Xt=we.zoom+1;let sr=we.aabb.quadrant(mt);if(o.terrain){const Sr=new a.Q(Xt,we.wrap,Xt,or,gt),er=o.terrain.getMinMaxElevation(Sr),cr=(h=er.minElevation)!==null&&h!==void 0?h:this.elevation,fr=(p=er.maxElevation)!==null&&p!==void 0?p:this.elevation;sr=new Qo([sr.min[0],sr.min[1],cr],[sr.max[0],sr.max[1],fr])}ye.push({aabb:sr,zoom:Xt,x:or,y:gt,wrap:we.wrap,fullyVisible:$e})}}return se.sort((we,Le)=>we.distanceSq-Le.distanceSq).map(we=>we.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=a.ac(o.lat,-85.051129,Qc);return new a.P(a.N(o.lng)*this.worldSize,a.O(h)*this.worldSize)}unproject(o){return new a.Y(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,o),v=o.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-v))return;const E=p+h-v,M=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b3(1,m.lat),A=this.scaleZoom(M/this.tileSize);this._elevation=v,this._center=m,this.zoom=A}setLocationAtPoint(o,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),v=this.locationCoordinate(o),E=new a.Y(v.x-(p.x-m.x),v.y-(p.y-m.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),h.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return a.Y.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const Y=h.pointCoordinate(o);if(Y!=null)return Y}const p=[o.x,o.y,0,1],m=[o.x,o.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const v=p[3],E=m[3],M=p[1]/v,A=m[1]/E,R=p[2]/v,V=m[2]/E,q=R===V?0:(0-R)/(V-R);return new a.Y(a.z.number(p[0]/v,m[0]/E,q)/this.worldSize,a.z.number(M,A,q)/this.worldSize)}coordinatePoint(o,h=0,p=this.pixelMatrix){const m=[o.x*this.worldSize,o.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new lt().extend(this.pointLocation(new a.P(0,o))).extend(this.pointLocation(new a.P(this.width,o))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new lt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Qc])}calculatePosMatrix(o,h=!1){const p=o.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const v=o.canonical,E=this.worldSize/this.zoomScale(v.z),M=v.x+Math.pow(2,v.z)*o.wrap,A=a.an(new Float64Array(16));return a.H(A,A,[M*E,v.y*E,0]),a.J(A,A,[E/a.W,E/a.W,1]),a.K(A,h?this.alignedProjMatrix:this.projMatrix,A),m[p]=new Float32Array(A),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.M(o.lng,o.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const we=179.9999999999;m=[-we,we]}const v=this.tileSize*this.zoomScale(p.zoom);let E=0,M=v,A=0,R=v,V=0,q=0;const{x:Y,y:fe}=this.size;if(this.latRange){const we=this.latRange;E=a.O(we[1])*v,M=a.O(we[0])*v,M-E<fe&&(V=fe/(M-E))}m&&(A=a.b1(a.N(m[0])*v,0,v),R=a.b1(a.N(m[1])*v,0,v),R<A&&(R+=v),R-A<Y&&(q=Y/(R-A)));const{x:he,y:ye}=this.project.call({worldSize:v},o);let se,Te;const qe=Math.max(q||0,V||0);if(qe){const we=new a.P(q?(R+A)/2:he,V?(M+E)/2:ye);return p.center=this.unproject.call({worldSize:v},we).wrap(),p.zoom+=this.scaleZoom(qe),p}if(this.latRange){const we=fe/2;ye-we<E&&(Te=E+we),ye+we>M&&(Te=M-we)}if(m){const we=(A+R)/2;let Le=he;this._renderWorldCopies&&(Le=a.b1(he,we-v/2,we+v/2));const We=Y/2;Le-We<A&&(se=A+We),Le+We>R&&(se=R-We)}if(se!==void 0||Te!==void 0){const we=new a.P(se??he,Te??ye);p.center=this.unproject.call({worldSize:v},we).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.J(m,m,[this.width/2,-this.height/2,1]),a.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.J(m,m,[1,-1,1]),a.H(m,m,[-1,-1,0]),a.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const v=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),M=v-E*this._pixelPerMeter/Math.cos(this._pitch),A=E<0?M:v,R=Math.PI/2+this._pitch,V=this._fov*(.5+o.y/this.height),q=Math.sin(V)*A/Math.sin(a.ac(Math.PI-R-V,.01,Math.PI-.01)),Y=this.getHorizon(),fe=2*Math.atan(Y/this.cameraToCenterDistance)*(.5+o.y/(2*Y)),he=Math.sin(fe)*A/Math.sin(a.ac(Math.PI-R-fe,.01,Math.PI-.01)),ye=Math.min(q,he),se=1.01*(Math.cos(Math.PI/2-this._pitch)*ye+A),Te=this.height/50;m=new Float64Array(16),a.b4(m,this._fov,this.width/this.height,Te,se),m[8]=2*-o.x/this.width,m[9]=2*o.y/this.height,a.J(m,m,[1,-1,1]),a.H(m,m,[0,0,-this.cameraToCenterDistance]),a.b5(m,m,this._pitch),a.ad(m,m,this.angle),a.H(m,m,[-h,-p,0]),this.mercatorMatrix=a.J([],m,[this.worldSize,this.worldSize,this.worldSize]),a.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,m),a.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.ar([],m),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,m);const qe=this.width%2/2,we=this.height%2/2,Le=Math.cos(this.angle),We=Math.sin(this.angle),$e=h-Math.round(h)+Le*qe+We*we,Xe=p-Math.round(p)+Le*we+We*qe,rt=new Float64Array(m);if(a.H(rt,rt,[$e>.5?$e-1:$e,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=rt,m=a.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new a.P(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let p=h.x,m=h.y,v=h.x,E=h.y;for(const M of o)p=Math.min(p,M.x),m=Math.min(m,M.y),v=Math.max(v,M.x),E=Math.max(E,M.y);return[new a.P(p,m),new a.P(v,m),new a.P(v,E),new a.P(p,E),new a.P(p,m)]}}lngLatToCameraDepth(o,h){const p=this.locationCoordinate(o),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.projMatrix),m[2]/m[3]}}function eu(y,o){let h,p=!1,m=null,v=null;const E=()=>{m=null,p&&(y.apply(v,h),m=setTimeout(E,o),p=!1)};return(...M)=>(p=!0,v=this,h=M,m||E(),m)}class tu{constructor(o){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=eu(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,m),E=Math.round(h.lng*v)/v,M=Math.round(h.lat*v)/v,A=this._map.getBearing(),R=this._map.getPitch();let V="";if(V+=o?`/${E}/${M}/${p}`:`${p}/${M}/${E}`,(A||R)&&(V+="/"+Math.round(10*A)/10),R&&(V+=`/${Math.round(R)}`),this._hashName){const q=this._hashName;let Y=!1;const fe=window.location.hash.slice(1).split("&").map(he=>{const ye=he.split("=")[0];return ye===q?(Y=!0,`${ye}=${V}`):he}).filter(he=>he);return Y||fe.push(`${q}=${V}`),`#${fe.join("&")}`}return`#${V}`}}const Da={linearity:.3,easing:a.b6(0,0,.3,1)},_s=a.e({deceleration:2500,maxSpeed:1400},Da),Yh=a.e({deceleration:20,maxSpeed:1400},Da),Qh=a.e({deceleration:1e3,maxSpeed:360},Da),ef=a.e({deceleration:1e3,maxSpeed:90},Da);class tf{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=S.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)h.zoom+=v.zoomDelta||0,h.bearing+=v.bearingDelta||0,h.pitch+=v.pitchDelta||0,v.panDelta&&h.pan._add(v.panDelta),v.around&&(h.around=v.around),v.pinchAround&&(h.pinchAround=v.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const v=Ba(h.pan.mag(),p,a.e({},_s,o||{}));m.offset=h.pan.mult(v.amount/h.pan.mag()),m.center=this._map.transform.center,Ra(m,v)}if(h.zoom){const v=Ba(h.zoom,p,Yh);m.zoom=this._map.transform.zoom+v.amount,Ra(m,v)}if(h.bearing){const v=Ba(h.bearing,p,Qh);m.bearing=this._map.transform.bearing+a.ac(v.amount,-179,179),Ra(m,v)}if(h.pitch){const v=Ba(h.pitch,p,ef);m.pitch=this._map.transform.pitch+v.amount,Ra(m,v)}if(m.zoom||m.bearing){const v=h.pinchAround===void 0?h.around:h.pinchAround;m.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function Ra(y,o){(!y.duration||y.duration<o.duration)&&(y.duration=o.duration,y.easing=o.easing)}function Ba(y,o,h){const{maxSpeed:p,linearity:m,deceleration:v}=h,E=a.ac(y*m/(o/1e3),-p,p),M=Math.abs(E)/(v*m);return{easing:h.easing,duration:1e3*M,amount:E*(M/2)}}class xi extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p,m={}){const v=C.mousePos(h.getCanvas(),p),E=h.unproject(v);super(o,a.e({point:v,lngLat:E,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class _o extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p){const m=o==="touchend"?p.changedTouches:p.touches,v=C.touchPos(h.getCanvasContainer(),m),E=v.map(A=>h.unproject(A)),M=v.reduce((A,R,V,q)=>A.add(R.div(q.length)),new a.P(0,0));super(o,{points:v,point:M,lngLats:E,lngLat:h.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class ru extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,p){super(o,{originalEvent:p}),this._defaultPrevented=!1}}class no{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new ru(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new xi(o.type,this._map,o))}mouseup(o){this._map.fire(new xi(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new xi(o.type,this._map,o))}dblclick(o){return this._firePreventable(new xi(o.type,this._map,o))}mouseover(o){this._map.fire(new xi(o.type,this._map,o))}mouseout(o){this._map.fire(new xi(o.type,this._map,o))}touchstart(o){return this._firePreventable(new _o(o.type,this._map,o))}touchmove(o){this._map.fire(new _o(o.type,this._map,o))}touchend(o){this._map.fire(new _o(o.type,this._map,o))}touchcancel(o){this._map.fire(new _o(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yo{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new xi(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new xi(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hs{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(a.P.convert(o),this._map.terrain)}}class io{constructor(o,h){this._map=o,this._tr=new Hs(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(C.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=C.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const v=Math.min(m.x,p.x),E=Math.max(m.x,p.x),M=Math.min(m.y,p.y),A=Math.max(m.y,p.y);C.setTransform(this._box,`translate(${v}px,${M}px)`),this._box.style.width=E-v+"px",this._box.style.height=A-M+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const p=this._startPos,m=h;if(this.reset(),C.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:o})),{cameraAnimation:v=>v.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(C.remove(this._box),this._box=null),C.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new a.k(o,{originalEvent:h}))}}function ys(y,o){if(y.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${o.length}`);const h={};for(let p=0;p<y.length;p++)h[y[p].identifier]=o[p];return h}class lp{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const v=new a.P(0,0);for(const E of m)v._add(E);return v.div(m.length)}(h),this.touches=ys(p,h)))}touchmove(o,h,p){if(this.aborted||!this.centroid)return;const m=ys(p,h);for(const v in this.touches){const E=m[v];(!E||E.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(o,h,p){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class nu{constructor(o){this.singleTap=new lp(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,p){this.singleTap.touchstart(o,h,p)}touchmove(o,h,p){this.singleTap.touchmove(o,h,p)}touchend(o,h,p){const m=this.singleTap.touchend(o,h,p);if(m){const v=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(m)<30;if(v&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class cp{constructor(o){this._tr=new Hs(o),this._zoomIn=new nu({numTouches:1,numTaps:2}),this._zoomOut=new nu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,p){this._zoomIn.touchstart(o,h,p),this._zoomOut.touchstart(o,h,p)}touchmove(o,h,p){this._zoomIn.touchmove(o,h,p),this._zoomOut.touchmove(o,h,p)}touchend(o,h,p){const m=this._zoomIn.touchend(o,h,p),v=this._zoomOut.touchend(o,h,p),E=this._tr;return m?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(m)},{originalEvent:o})}):v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(v)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $s{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const h=this._moveFunction(...o);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(o,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&C.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Fa={0:1,2:2};class vo{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const h=C.mouseButton(o);this._eventButton=h}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(h,p){const m=Fa[p];return h.buttons===void 0||(h.buttons&m)!==m}(o,this._eventButton)}isValidEndEvent(o){return C.mouseButton(o)===this._eventButton}}class Ct{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const Dl=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(o){o.preventDefault()}},Xs=({enable:y,clickTolerance:o,bearingDegreesPerPixelMoved:h=.8})=>{const p=new vo({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new $s({clickTolerance:o,move:(m,v)=>({bearingDelta:(v.x-m.x)*h}),moveStateManager:p,enable:y,assignEvents:Dl})},Ks=({enable:y,clickTolerance:o,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new vo({checkCorrectEvent:m=>C.mouseButton(m)===0&&m.ctrlKey||C.mouseButton(m)===2});return new $s({clickTolerance:o,move:(m,v)=>({pitchDelta:(v.y-m.y)*h}),moveStateManager:p,enable:y,assignEvents:Dl})};class rf{constructor(o,h){this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(o,h,p){return this._calculateTransform(o,h,p)}touchmove(o,h,p){if(this._active&&!(p.length<this.minTouchs()))return o.preventDefault(),this._calculateTransform(o,h,p)}touchend(o,h,p){this._calculateTransform(o,h,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,p){p.length>0&&(this._active=!0);const m=ys(p,h),v=new a.P(0,0),E=new a.P(0,0);let M=0;for(const R in m){const V=m[R],q=this._touches[R];q&&(v._add(V),E._add(V.sub(q)),M++,m[R]=V)}if(this._touches=m,M<this.minTouchs()||!E.mag())return;const A=E.div(M);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(M),panDelta:A}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class St{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,p){if(!this._firstTwoTouches)return;o.preventDefault();const[m,v]=this._firstTwoTouches,E=Js(p,h,m),M=Js(p,h,v);if(!E||!M)return;const A=this._aroundCenter?null:E.add(M).div(2);return this._move([E,M],A,o)}touchend(o,h,p){if(!this._firstTwoTouches)return;const[m,v]=this._firstTwoTouches,E=Js(p,h,m),M=Js(p,h,v);E&&M||(this._active&&C.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Js(y,o,h){for(let p=0;p<y.length;p++)if(y[p].identifier===h)return o[p]}function nf(y,o){return Math.log(y/o)/Math.LN2}class of extends St{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const p=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(nf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:nf(this._distance,p),pinchAround:h}}}function Rl(y,o){return 180*y.angleWith(o)/Math.PI}class iu extends St{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h,p){const m=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Rl(this._vector,m),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,p=Rl(o,this._startVector);return Math.abs(p)<h}}function Bl(y){return Math.abs(y.y)>Math.abs(y.x)}class sf extends St{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,p){super.touchstart(o,h,p),this._currentTouchCount=p.length}_start(o){this._lastPoints=o,Bl(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=o[0].sub(this._lastPoints[0]),v=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,v,p.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(m.y+v.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,p){if(this._valid!==void 0)return this._valid;const m=o.mag()>=2,v=h.mag()>=2;if(!m&&!v)return;if(!m||!v)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const E=o.y>0==h.y>0;return Bl(o)&&Bl(h)&&E}}const up={panStep:100,bearingStep:15,pitchStep:10};class es{constructor(o){this._tr=new Hs(o);const h=up;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,p=0,m=0,v=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?p=-1:(o.preventDefault(),v=-1);break;case 39:o.shiftKey?p=1:(o.preventDefault(),v=1);break;case 38:o.shiftKey?m=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?m=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:M=>{const A=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Qr,zoom:h?Math.round(A.zoom)+h*(o.shiftKey?2:1):A.zoom,bearing:A.bearing+p*this._bearingStep,pitch:A.pitch+m*this._pitchStep,offset:[-v*this._panStep,-E*this._panStep],center:A.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qr(y){return y*(2-y)}const Oa=4.000244140625;class Fl{constructor(o,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=o,this._tr=new Hs(o),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!o[this._map.cooperativeGestures._bypassKey])return;let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const p=S.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%Oa==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=C.mousePos(this._map.getCanvas(),o),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.M.convert(this._aroundCenter?p.center:p.unproject(h)):a.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>Oa?this._wheelZoomRate:this._defaultZoomRate;let A=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&A!==0&&(A=1/A);const R=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(R*A))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,p=this._startZoom,m=this._easing;let v,E=!1;if(this._type==="wheel"&&p&&m){const M=Math.min((S.now()-this._lastWheelEventTime)/200,1),A=m(M);v=a.z.number(p,h,A),M<1?this._frameId||(this._frameId=!0):E=!0}else v=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:v-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=a.b7;if(this._prevEase){const p=this._prevEase,m=(S.now()-p.start)/p.duration,v=p.easing(m+.01)-p.easing(m),E=.27/Math.sqrt(v*v+1e-4)*.01,M=Math.sqrt(.0729-E*E);h=a.b6(E,M,.25,1)}return this._prevEase={start:S.now(),duration:o,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ou{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class af{constructor(o){this._tr=new Hs(o),this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lf{constructor(){this._tap=new nu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],v=o.timeStamp-this._tapTime<500,E=this._tapPoint.dist(m)<30;v&&E?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(o,h,p)}touchmove(o,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],v=m.y-this._swipePoint.y;return this._swipePoint=m,o.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(o,h,p)}touchend(o,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(o,h,p);m&&(this._tapTime=o.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class cf{constructor(o,h,p){this._el=o,this._mousePan=h,this._touchPan=p}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class oo{constructor(o,h,p){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Na{constructor(o,h,p,m){this._el=o,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ft{constructor(o,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=C.create("div","maplibregl-cooperative-gesture-screen",o);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const v=document.createElement("div");v.className="maplibregl-mobile-message",v.textContent=p,this._container.appendChild(v),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(C.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(o){this._onCooperativeGesture(o.touches.length===1)}wheel(o){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!o[this._bypassKey])}_onCooperativeGesture(o){this._enabled&&o&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Gt=y=>y.zoom||y.drag||y.pitch||y.rotate;class Ol extends a.k{}function ja(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class su{constructor(o,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,v)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=m.type==="renderFrame"?void 0:m,M={needsRenderFrame:!1},A={},R={},V=m.touches,q=V?this._getMapTouches(V):void 0,Y=q?C.touchPos(this._map.getCanvas(),q):C.mousePos(this._map.getCanvas(),m);for(const{handlerName:ye,handler:se,allowed:Te}of this._handlers){if(!se.isEnabled())continue;let qe;this._blockedByActive(R,Te,ye)?se.reset():se[v||m.type]&&(qe=se[v||m.type](m,Y,q),this.mergeHandlerResult(M,A,qe,ye,E),qe&&qe.needsRenderFrame&&this._triggerRenderFrame()),(qe||se.isActive())&&(R[ye]=se)}const fe={};for(const ye in this._previousActiveHandlers)R[ye]||(fe[ye]=E);this._previousActiveHandlers=R,(Object.keys(fe).length||ja(M))&&(this._changes.push([M,A,fe]),this._triggerRenderFrame()),(Object.keys(R).length||ja(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:he}=M;he&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],he(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new tf(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,v,E]of this._listeners)C.addEventListener(m,v,m===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[o,h,p]of this._listeners)C.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(o){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new no(h,o));const m=h.boxZoom=new io(h,o);this._add("boxZoom",m),o.interactive&&o.boxZoom&&m.enable();const v=h.cooperativeGestures=new Ft(h,o.cooperativeGestures);this._add("cooperativeGestures",v),o.cooperativeGestures&&v.enable();const E=new cp(h),M=new af(h);h.doubleClickZoom=new ou(M,E),this._add("tapZoom",E),this._add("clickZoom",M),o.interactive&&o.doubleClickZoom&&h.doubleClickZoom.enable();const A=new lf;this._add("tapDragZoom",A);const R=h.touchPitch=new sf(h);this._add("touchPitch",R),o.interactive&&o.touchPitch&&h.touchPitch.enable(o.touchPitch);const V=Xs(o),q=Ks(o);h.dragRotate=new oo(o,V,q),this._add("mouseRotate",V,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]),o.interactive&&o.dragRotate&&h.dragRotate.enable();const Y=(({enable:qe,clickTolerance:we})=>{const Le=new vo({checkCorrectEvent:We=>C.mouseButton(We)===0&&!We.ctrlKey});return new $s({clickTolerance:we,move:(We,$e)=>({around:$e,panDelta:$e.sub(We)}),activateOnStart:!0,moveStateManager:Le,enable:qe,assignEvents:Dl})})(o),fe=new rf(o,h);h.dragPan=new cf(p,Y,fe),this._add("mousePan",Y),this._add("touchPan",fe,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&h.dragPan.enable(o.dragPan);const he=new iu,ye=new of;h.touchZoomRotate=new Na(p,ye,he,A),this._add("touchRotate",he,["touchPan","touchZoom"]),this._add("touchZoom",ye,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&h.touchZoomRotate.enable(o.touchZoomRotate);const se=h.scrollZoom=new Fl(h,()=>this._triggerRenderFrame());this._add("scrollZoom",se,["mousePan"]),o.interactive&&o.scrollZoom&&h.scrollZoom.enable(o.scrollZoom);const Te=h.keyboard=new es(h);this._add("keyboard",Te),o.interactive&&o.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new yo(h))}_add(o,h,p){this._handlers.push({handlerName:o,handler:h,allowed:p}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gt(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,p){for(const m in o)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(o){const h=[];for(const p of o)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(o,h,p,m,v){if(!p)return;a.e(o,p);const E={handlerName:m,originalEvent:p.originalEvent||v};p.zoomDelta!==void 0&&(h.zoom=E),p.panDelta!==void 0&&(h.drag=E),p.pitchDelta!==void 0&&(h.pitch=E),p.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const o={},h={},p={};for(const[m,v,E]of this._changes)m.panDelta&&(o.panDelta=(o.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(o.around=m.around),m.pinchAround!==void 0&&(o.pinchAround=m.pinchAround),m.noInertia&&(o.noInertia=m.noInertia),a.e(h,v),a.e(p,E);this._updateMapTransform(o,h,p),this._changes=[]}_updateMapTransform(o,h,p){const m=this._map,v=m._getTransformForUpdate(),E=m.terrain;if(!(ja(o)||E&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:M,zoomDelta:A,bearingDelta:R,pitchDelta:V,around:q,pinchAround:Y}=o;Y!==void 0&&(q=Y),m._stop(!0),q=q||m.transform.centerPoint;const fe=v.pointLocation(M?q.sub(M):q);R&&(v.bearing+=R),V&&(v.pitch+=V),A&&(v.zoom+=A),E?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?v.center=v.pointLocation(v.centerPoint.sub(M)):v.setLocationAtPoint(fe,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,v.setLocationAtPoint(fe,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,v.recalculateZoom(m.terrain)})):v.setLocationAtPoint(fe,q),m._applyUpdatedTransform(v),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,p,!0)}_fireEvents(o,h,p){const m=Gt(this._eventsInProgress),v=Gt(o),E={};for(const V in o){const{originalEvent:q}=o[V];this._eventsInProgress[V]||(E[`${V}start`]=q),this._eventsInProgress[V]=o[V]}!m&&v&&this._fireEvent("movestart",v.originalEvent);for(const V in E)this._fireEvent(V,E[V]);v&&this._fireEvent("move",v.originalEvent);for(const V in o){const{originalEvent:q}=o[V];this._fireEvent(V,q)}const M={};let A;for(const V in this._eventsInProgress){const{handlerName:q,originalEvent:Y}=this._eventsInProgress[V];this._handlersById[q].isActive()||(delete this._eventsInProgress[V],A=h[q]||Y,M[`${V}end`]=A)}for(const V in M)this._fireEvent(V,M[V]);const R=Gt(this._eventsInProgress);if(p&&(m||v)&&!R){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=Y=>Y!==0&&-this._bearingSnap<Y&&Y<this._bearingSnap;!V||!V.essential&&S.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:A})),q(this._map.getBearing())&&this._map.resetNorth()):(q(V.bearing||this._map.getBearing())&&(V.bearing=0),V.freezeElevation=!0,this._map.easeTo(V,{originalEvent:A})),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new a.k(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Ol("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Si extends a.E{constructor(o,h){super(),this._renderFrameCallback=()=>{const p=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,p){return o=a.P.convert(o).mult(-1),this.panTo(this.transform.center,a.e({offset:o},h),p)}panTo(o,h,p){return this.easeTo(a.e({center:o},h),p)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,p){return this.easeTo(a.e({zoom:o},h),p)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,p){return this.easeTo(a.e({bearing:o},h),p)}resetNorth(o,h){return this.rotateTo(0,a.e({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=lt.convert(o);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),p,h)}_cameraForBoxAndBearing(o,h,p,m){const v={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:v,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const mt=m.padding;m.padding={top:mt,bottom:mt,right:mt,left:mt}}m.padding=a.e(v,m.padding);const E=this.transform,M=E.padding,A=new lt(o,h),R=E.project(A.getNorthWest()),V=E.project(A.getNorthEast()),q=E.project(A.getSouthEast()),Y=E.project(A.getSouthWest()),fe=a.b8(-p),he=R.rotate(fe),ye=V.rotate(fe),se=q.rotate(fe),Te=Y.rotate(fe),qe=new a.P(Math.max(he.x,ye.x,Te.x,se.x),Math.max(he.y,ye.y,Te.y,se.y)),we=new a.P(Math.min(he.x,ye.x,Te.x,se.x),Math.min(he.y,ye.y,Te.y,se.y)),Le=qe.sub(we),We=(E.width-(M.left+M.right+m.padding.left+m.padding.right))/Le.x,$e=(E.height-(M.top+M.bottom+m.padding.top+m.padding.bottom))/Le.y;if($e<0||We<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Xe=Math.min(E.scaleZoom(E.scale*Math.min(We,$e)),m.maxZoom),rt=a.P.convert(m.offset),et=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.b8(p)),ft=rt.add(et).mult(E.scale/E.zoomScale(Xe));return{center:E.unproject(R.add(q).div(2).sub(ft)),zoom:Xe,bearing:p}}fitBounds(o,h,p){return this._fitInternal(this.cameraForBounds(o,h),h,p)}fitScreenCoordinates(o,h,p,m,v){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(o)),this.transform.pointLocation(a.P.convert(h)),p,m),m,v)}_fitInternal(o,h,p){return o?(delete(h=a.e(o,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(o,h){this.stop();const p=this._getTransformForUpdate();let m=!1,v=!1,E=!1;return"zoom"in o&&p.zoom!==+o.zoom&&(m=!0,p.zoom=+o.zoom),o.center!==void 0&&(p.center=a.M.convert(o.center)),"bearing"in o&&p.bearing!==+o.bearing&&(v=!0,p.bearing=+o.bearing),"pitch"in o&&p.pitch!==+o.pitch&&(E=!0,p.pitch=+o.pitch),o.padding==null||p.isPaddingEqual(o.padding)||(p.padding=o.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),v&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),E&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(o,h,p,m=0){const v=a.Y.fromLngLat(o,h),E=a.Y.fromLngLat(p,m),M=E.x-v.x,A=E.y-v.y,R=E.z-v.z,V=Math.hypot(M,A,R);if(V===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(M,A),Y=this.transform.scaleZoom(this.transform.cameraToCenterDistance/V/this.transform.tileSize),fe=180*Math.atan2(M,-A)/Math.PI;let he=180*Math.acos(q/V)/Math.PI;return he=R<0?90-he:90+he,{center:E.toLngLat(),zoom:Y,pitch:he,bearing:fe}}easeTo(o,h){var p;this._stop(!1,o.easeId),((o=a.e({offset:[0,0],duration:500,easing:a.b7},o)).animate===!1||!o.essential&&S.prefersReducedMotion)&&(o.duration=0);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),M=this.getPitch(),A=this.getPadding(),R="bearing"in o?this._normalizeBearing(o.bearing,E):E,V="pitch"in o?+o.pitch:M,q="padding"in o?o.padding:m.padding,Y=a.P.convert(o.offset);let fe=m.centerPoint.add(Y);const he=m.pointLocation(fe),{center:ye,zoom:se}=m.getConstrained(a.M.convert(o.center||he),(p=o.zoom)!==null&&p!==void 0?p:v);this._normalizeCenter(ye);const Te=m.project(he),qe=m.project(ye).sub(Te),we=m.zoomScale(se-v);let Le,We;o.around&&(Le=a.M.convert(o.around),We=m.locationPoint(Le));const $e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||se!==v,this._rotating=this._rotating||E!==R,this._pitching=this._pitching||V!==M,this._padding=!m.isPaddingEqual(q),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,$e),this.terrain&&this._prepareElevation(ye),this._ease(Xe=>{if(this._zooming&&(m.zoom=a.z.number(v,se,Xe)),this._rotating&&(m.bearing=a.z.number(E,R,Xe)),this._pitching&&(m.pitch=a.z.number(M,V,Xe)),this._padding&&(m.interpolatePadding(A,q,Xe),fe=m.centerPoint.add(Y)),this.terrain&&!o.freezeElevation&&this._updateElevation(Xe),Le)m.setLocationAtPoint(Le,We);else{const rt=m.zoomScale(m.zoom-v),et=se>v?Math.min(2,we):Math.max(.5,we),ft=Math.pow(et,1-Xe),mt=m.unproject(Te.add(qe.mult(Xe*ft)).mult(rt));m.setLocationAtPoint(m.renderWorldCopies?mt.wrap():mt,fe)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Xe=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Xe)},o),this}_prepareEase(o,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",o)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",o)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",o)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(p-(h-(p*o+this._elevationStart))/(1-o)),this._elevationTarget=h}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const h=o.clone(),{center:p,zoom:m,pitch:v,bearing:E,elevation:M}=this.transformCameraUpdate(h);p&&(h.center=p),m!==void 0&&(h.zoom=m),v!==void 0&&(h.pitch=v),E!==void 0&&(h.bearing=E),M!==void 0&&(h.elevation=M),this.transform.apply(h)}_fireMoveEvents(o){this.fire(new a.k("move",o)),this._zooming&&this.fire(new a.k("zoom",o)),this._rotating&&this.fire(new a.k("rotate",o)),this._pitching&&this.fire(new a.k("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",o)),m&&this.fire(new a.k("rotateend",o)),v&&this.fire(new a.k("pitchend",o)),this.fire(new a.k("moveend",o))}flyTo(o,h){var p;if(!o.essential&&S.prefersReducedMotion){const Sr=a.L(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Sr,h)}this.stop(),o=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},o);const m=this._getTransformForUpdate(),v=this.getZoom(),E=this.getBearing(),M=this.getPitch(),A=this.getPadding(),R="bearing"in o?this._normalizeBearing(o.bearing,E):E,V="pitch"in o?+o.pitch:M,q="padding"in o?o.padding:m.padding,Y=a.P.convert(o.offset);let fe=m.centerPoint.add(Y);const he=m.pointLocation(fe),{center:ye,zoom:se}=m.getConstrained(a.M.convert(o.center||he),(p=o.zoom)!==null&&p!==void 0?p:v);this._normalizeCenter(ye);const Te=m.zoomScale(se-v),qe=m.project(he),we=m.project(ye).sub(qe);let Le=o.curve;const We=Math.max(m.width,m.height),$e=We/Te,Xe=we.mag();if("minZoom"in o){const Sr=a.ac(Math.min(o.minZoom,v,se),m.minZoom,m.maxZoom),er=We/m.zoomScale(Sr-v);Le=Math.sqrt(er/Xe*2)}const rt=Le*Le;function et(Sr){const er=($e*$e-We*We+(Sr?-1:1)*rt*rt*Xe*Xe)/(2*(Sr?$e:We)*rt*Xe);return Math.log(Math.sqrt(er*er+1)-er)}function ft(Sr){return(Math.exp(Sr)-Math.exp(-Sr))/2}function mt(Sr){return(Math.exp(Sr)+Math.exp(-Sr))/2}const or=et(!1);let gt=function(Sr){return mt(or)/mt(or+Le*Sr)},Xt=function(Sr){return We*((mt(or)*(ft(er=or+Le*Sr)/mt(er))-ft(or))/rt)/Xe;var er},sr=(et(!0)-or)/Le;if(Math.abs(Xe)<1e-6||!isFinite(sr)){if(Math.abs(We-$e)<1e-6)return this.easeTo(o,h);const Sr=$e<We?-1:1;sr=Math.abs(Math.log($e/We))/Le,Xt=function(){return 0},gt=function(er){return Math.exp(Sr*Le*er)}}return o.duration="duration"in o?+o.duration:1e3*sr/("screenSpeed"in o?+o.screenSpeed/Le:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=E!==R,this._pitching=V!==M,this._padding=!m.isPaddingEqual(q),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ye),this._ease(Sr=>{const er=Sr*sr,cr=1/gt(er);m.zoom=Sr===1?se:v+m.scaleZoom(cr),this._rotating&&(m.bearing=a.z.number(E,R,Sr)),this._pitching&&(m.pitch=a.z.number(M,V,Sr)),this._padding&&(m.interpolatePadding(A,q,Sr),fe=m.centerPoint.add(Y)),this.terrain&&!o.freezeElevation&&this._updateElevation(Sr);const fr=Sr===1?ye:m.unproject(qe.add(we.mult(Xt(er))).mult(cr));m.setLocationAtPoint(m.renderWorldCopies?fr.wrap():fr,fe),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!o){const p=this.handlers;p&&p.stop(!1)}return this}_ease(o,h,p){p.animate===!1||p.duration===0?(o(1),h()):(this._easeStart=S.now(),this._easeOptions=p,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,h){o=a.b1(o,-180,180);const p=Math.abs(o-h);return Math.abs(o-360-h)<p&&(o-=360),Math.abs(o+360-h)<p&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=o.lng-h.center.lng;o.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const au={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class so{constructor(o=au){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=C.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=C.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=C.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){C.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const p=this._map._getUIString(`AttributionControl.${h}`);o.title=p,o.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const v=h[m];if(v.used||v.usedForTerrain){const E=v.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o=o.filter(m=>String(m).trim()),o.sort((m,v)=>m.length-v.length),o=o.filter((m,v)=>{for(let E=v+1;E<o.length;E++)if(o[E].indexOf(m)>=0)return!1;return!0});const p=o.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,o.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class uf{constructor(o={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=C.create("div","maplibregl-ctrl");const h=C.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){C.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ua{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===o)return void(m.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var un=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class kn extends a.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];const p={};for(const m of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aN(m.posMatrix,0,a.W,0,a.W,0,1),this._tiles[m.key]=new Xn(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(o){for(const h in this._tiles){const p=this._tiles[h];(!o||p.tileID.equals(o)||p.tileID.isChildOf(o)||o.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16),a.aN(v.posMatrix,0,a.W,0,a.W,0,1),h[p]=v}else if(m.canonical.isChildOf(o.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const E=m.canonical.z-o.canonical.z,M=m.canonical.x-(m.canonical.x>>E<<E),A=m.canonical.y-(m.canonical.y>>E<<E),R=a.W>>E;a.aN(v.posMatrix,0,R,0,R,0,1),a.H(v.posMatrix,v.posMatrix,[-M*R,-A*R,0]),h[p]=v}else if(o.canonical.isChildOf(m.canonical)){const v=o.clone();v.posMatrix=new Float64Array(16);const E=o.canonical.z-m.canonical.z,M=o.canonical.x-(o.canonical.x>>E<<E),A=o.canonical.y-(o.canonical.y>>E<<E),R=a.W>>E;a.aN(v.posMatrix,0,a.W,0,a.W,0,1),a.H(v.posMatrix,v.posMatrix,[M*R,A*R,0]),a.J(v.posMatrix,v.posMatrix,[1/2**E,1/2**E,0]),h[p]=v}}return h}getSourceTile(o,h){const p=this.sourceCache._source;let m=o.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(m).key);let v=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!v||!v.dem)&&h)for(;m>=p.minzoom&&(!v||!v.dem);)v=this.sourceCache.getTileByID(o.scaledTo(m--).key);return v}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=o)}}class hf{constructor(o,h,p){this.painter=o,this.sourceCache=new kn(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,h,p,m=a.W){var v;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const E=this.getTerrainData(o),M=(v=E.tile)===null||v===void 0?void 0:v.dem;if(!M)return 0;const A=function(he,ye,se){var Te=ye[0],qe=ye[1];return he[0]=se[0]*Te+se[4]*qe+se[12],he[1]=se[1]*Te+se[5]*qe+se[13],he}([],[h/m*a.W,p/m*a.W],E.u_terrain_matrix),R=[A[0]*M.dim,A[1]*M.dim],V=Math.floor(R[0]),q=Math.floor(R[1]),Y=R[0]-V,fe=R[1]-q;return M.get(V,q)*(1-Y)*(1-fe)+M.get(V+1,q)*Y*(1-fe)+M.get(V,q+1)*(1-Y)*fe+M.get(V+1,q+1)*Y*fe}getElevationForLngLatZoom(o,h){const{tileID:p,mercatorX:m,mercatorY:v}=this._getOverscaledTileIDFromLngLatZoom(o,h);return this.getElevation(p,m%a.W,v%a.W,a.W)}getElevation(o,h,p,m=a.W){return this.getDEMElevation(o,h,p,m)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const m=this.painter.context,v=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new re(m,v,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new re(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new re(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+o.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let v=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=m?v=o.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=o.canonical.x-(o.canonical.x>>v<<v),M=o.canonical.y-(o.canonical.y>>v<<v),A=a.b9(new Float64Array(16),[1/(a.W<<v),1/(a.W<<v),0]);a.H(A,A,[E*a.W,M*a.W,0]),this._demMatrixCache[o.key]={matrix:A,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(o){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new re(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new re(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let v=0,E=0;v<this._coordsTextureSize;v++)for(let M=0;M<this._coordsTextureSize;M++,E+=4)h[E+0]=255&M,h[E+1]=255&v,h[E+2]=M>>8<<4|v>>8,h[E+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new re(o,p,o.gl.RGBA,{premultiply:!1});return m.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,v=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(v,M-E-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const A=h[0]+(h[2]>>4<<8),R=h[1]+((15&h[2])<<8),V=this.coordsIndex[255-h[3]],q=V&&this.sourceCache.getTileByID(V);if(!q)return null;const Y=this._coordsTextureSize,fe=(1<<q.tileID.canonical.z)*Y;return new a.Y((q.tileID.canonical.x*Y+A)/fe+q.tileID.wrap,(q.tileID.canonical.y*Y+R)/fe,this.getElevation(q.tileID,A,R,Y))}depthAtPoint(o){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,h=new a.ba,p=new a.aX,m=this.meshSize,v=a.W/m,E=m*m;for(let q=0;q<=m;q++)for(let Y=0;Y<=m;Y++)h.emplaceBack(Y*v,q*v,0);for(let q=0;q<E;q+=m+1)for(let Y=0;Y<m;Y++)p.emplaceBack(Y+q,m+Y+q+1,m+Y+q+2),p.emplaceBack(Y+q,m+Y+q+2,Y+q+1);const M=h.length,A=M+2*(m+1);for(const q of[0,1])for(let Y=0;Y<=m;Y++)for(const fe of[0,1])h.emplaceBack(Y*v,q*a.W,fe);for(let q=0;q<2*m;q+=2)p.emplaceBack(A+q,A+q+1,A+q+3),p.emplaceBack(A+q,A+q+3,A+q+2),p.emplaceBack(M+q,M+q+3,M+q+1),p.emplaceBack(M+q,M+q+2,M+q+3);const R=h.length,V=R+2*(m+1);for(const q of[0,1])for(let Y=0;Y<=m;Y++)for(const fe of[0,1])h.emplaceBack(q*a.W,Y*v,fe);for(let q=0;q<2*m;q+=2)p.emplaceBack(R+q,R+q+1,R+q+3),p.emplaceBack(R+q,R+q+3,R+q+2),p.emplaceBack(V+q,V+q+3,V+q+1),p.emplaceBack(V+q,V+q+2,V+q+3);return this._mesh={indexBuffer:o.createIndexBuffer(p),vertexBuffer:o.createVertexBuffer(h,un.members),segments:a.$.simpleSegment(0,0,h.length,p.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*a.bb/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(o,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(o,h){const p=a.Y.fromLngLat(o.wrap()),m=(1<<h)*a.W,v=p.x*m,E=p.y*m,M=Math.floor(v/a.W),A=Math.floor(E/a.W);return{tileID:new a.Q(h,0,h,M,A),mercatorX:v,mercatorY:E}}}class Va{constructor(o,h,p){this._context=o,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new re(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:o,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>o.id!==h),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const Fo={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class lu{constructor(o,h){this.painter=o,this.terrain=h,this.pool=new Va(o.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(p=>!o._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in o.sourceCaches){this._coordsDescendingInv[p]={};const m=o.sourceCaches[p].getVisibleCoordinates();for(const v of m){const E=this.terrain.sourceCache.getTerrainCoords(v);for(const M in E)this._coordsDescendingInv[p][M]||(this._coordsDescendingInv[p][M]=[]),this._coordsDescendingInv[p][M].push(E[M])}}this._coordsDescendingInvStr={};for(const p of o._order){const m=o._layers[p],v=m.source;if(Fo[m.type]&&!this._coordsDescendingInvStr[v]){this._coordsDescendingInvStr[v]={};for(const E in this._coordsDescendingInv[v])this._coordsDescendingInvStr[v][E]=this._coordsDescendingInv[v][E].map(M=>M.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const v=this._coordsDescendingInvStr[m][p.tileID.key];v&&v!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const h=o.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Fo[h]&&(this._prevType&&Fo[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(o.id),!m))return!0;if(Fo[this._prevType]||Fo[h]&&m){this._prevType=h;const v=this._stacks.length-1,E=this._stacks[v]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(Pl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[v]){const R=this.pool.getObjectForId(M.rtt[v].id);if(R.stamp===M.rtt[v].stamp){this.pool.useObject(R);continue}}const A=this.pool.getOrCreateFreeObject();this.pool.useObject(A),this.pool.stampObject(A),M.rtt[v]={id:A.id,stamp:A.stamp},p.context.bindFramebuffer.set(A.fbo.framebuffer),p.context.clear({color:a.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let R=0;R<E.length;R++){const V=p.style._layers[E[R]],q=V.source?this._coordsDescendingInv[V.source][M.tileID.key]:[M.tileID];p.context.viewport.set([0,0,A.fbo.width,A.fbo.height]),p._renderTileClippingMasks(V,q),p.renderLayer(p,p.style.sourceCaches[V.source],V,q),V.source&&(M.rttCoords[V.source]=this._coordsDescendingInvStr[V.source][M.tileID.key])}}return Pl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Fo[h]}return!1}}const cu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},uu=_,qa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:au,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Nl=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},hu={showCompass:!0,showZoom:!0,visualizePitch:!1};class fu{constructor(o,h,p=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),C.mousePos(this.element,E)),C.addEventListener(window,"mousemove",this.mousemove),C.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,C.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=C.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),C.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=C.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=o.dragRotate._mouseRotate.getClickTolerance(),v=o.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Xs({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:M,bearingDegreesPerPixelMoved:A=.8})=>{const R=new Ct;return new $s({clickTolerance:M,move:(V,q)=>({bearingDelta:(q.x-V.x)*A}),moveStateManager:R,enable:E,assignEvents:Nl})})({clickTolerance:m,enable:!0}),this.map=o,p&&(this.mousePitch=Ks({clickTolerance:v,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:M,pitchDegreesPerPixelMoved:A=-.5})=>{const R=new Ct;return new $s({clickTolerance:M,move:(V,q)=>({pitchDelta:(q.y-V.y)*A}),moveStateManager:R,enable:E,assignEvents:Nl})})({clickTolerance:v,enable:!0})),C.addEventListener(h,"mousedown",this.mousedown),C.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),C.addEventListener(h,"touchcancel",this.reset)}startMouse(o,h){this.mouseRotate.dragStart(o,h),this.mousePitch&&this.mousePitch.dragStart(o,h),C.disableDrag()}startTouch(o,h){this.touchRotate.dragStart(o,h),this.touchPitch&&this.touchPitch.dragStart(o,h),C.disableDrag()}moveMouse(o,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(o,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:v}=this.mousePitch.dragMove(o,h)||{};v&&p.setPitch(p.getPitch()+v)}}moveTouch(o,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(o,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:v}=this.touchPitch.dragMove(o,h)||{};v&&p.setPitch(p.getPitch()+v)}}off(){const o=this.element;C.removeEventListener(o,"mousedown",this.mousedown),C.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend),C.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){C.enableDrag(),C.removeEventListener(window,"mousemove",this.mousemove),C.removeEventListener(window,"mouseup",this.mouseup),C.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),C.removeEventListener(window,"touchend",this.touchend)}}let Oo;function jl(y,o,h){const p=new a.M(y.lng,y.lat);if(y=new a.M(y.lng,y.lat),o){const m=new a.M(y.lng-360,y.lat),v=new a.M(y.lng+360,y.lat),E=h.locationPoint(y).distSqr(o);h.locationPoint(m).distSqr(o)<E?y=m:h.locationPoint(v).distSqr(o)<E&&(y=v)}for(;Math.abs(y.lng-h.center.lng)>180;){const m=h.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&h.locationPoint(y).y>h.height/2-h.getHorizon()?y:p}const Ga={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ul(y,o,h){const p=y.classList;for(const m in Ga)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${o}`)}class Wa extends a.E{constructor(o){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?jl(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let v="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?v=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(v=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),C.setTransform(this._element,`${Ga[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${v}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=a.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=C.create("div"),this._element.setAttribute("aria-label","Map marker");const h=C.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const v=C.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"stroke","none"),v.setAttributeNS(null,"stroke-width","1"),v.setAttributeNS(null,"fill","none"),v.setAttributeNS(null,"fill-rule","evenodd");const E=C.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const M=C.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Te of A){const qe=C.createNS("http://www.w3.org/2000/svg","ellipse");qe.setAttributeNS(null,"opacity","0.04"),qe.setAttributeNS(null,"cx","10.5"),qe.setAttributeNS(null,"cy","5.80029008"),qe.setAttributeNS(null,"rx",Te.rx),qe.setAttributeNS(null,"ry",Te.ry),M.appendChild(qe)}const R=C.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"fill",this._color);const V=C.createNS("http://www.w3.org/2000/svg","path");V.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),R.appendChild(V);const q=C.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const Y=C.createNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(Y);const fe=C.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),fe.setAttributeNS(null,"fill","#FFFFFF");const he=C.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ye=C.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#000000"),ye.setAttributeNS(null,"opacity","0.25"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962");const se=C.createNS("http://www.w3.org/2000/svg","circle");se.setAttributeNS(null,"fill","#FFFFFF"),se.setAttributeNS(null,"cx","5.5"),se.setAttributeNS(null,"cy","5.5"),se.setAttributeNS(null,"r","5.4999962"),he.appendChild(ye),he.appendChild(se),E.appendChild(M),E.appendChild(R),E.appendChild(q),E.appendChild(fe),E.appendChild(he),h.appendChild(E),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Ul(this._element,this._anchor,"marker"),o&&o.className)for(const h of o.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),C.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=a.M.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const m=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,v=m.terrain.depthAtPoint(this._pos),E=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,E)-v<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/m.transform._pixelPerMeter,A=Math.sin(m.getPitch()*Math.PI/180)*M,R=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),V=m.transform.lngLatToCameraDepth(this._lngLat,E+A)-R>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&V&&this._popup.remove(),this._element.style.opacity=V?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=a.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,h){return o===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Vl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ys=0,vs=!1;const ql={maxWidth:100,unit:"metric"};function Gl(y,o,h){const p=h&&h.maxWidth||100,m=y._container.clientHeight/2,v=y.unproject([0,m]),E=y.unproject([p,m]),M=v.distanceTo(E);if(h&&h.unit==="imperial"){const A=3.2808*M;A>5280?bs(o,p,A/5280,y._getUIString("ScaleControl.Miles")):bs(o,p,A,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?bs(o,p,M/1852,y._getUIString("ScaleControl.NauticalMiles")):M>=1e3?bs(o,p,M/1e3,y._getUIString("ScaleControl.Kilometers")):bs(o,p,M,y._getUIString("ScaleControl.Meters"))}function bs(y,o,h,p){const m=function(v){const E=Math.pow(10,`${Math.floor(v)}`.length-1);let M=v/E;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(A){const R=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*R)/R}(M),E*M}(h);y.style.width=o*(m/h)+"px",y.innerHTML=`${m}&nbsp;${p}`}const du={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},pu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wl(y){if(y){if(typeof y=="number"){const o=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(o,o),"top-right":new a.P(-o,o),bottom:new a.P(0,-y),"bottom-left":new a.P(o,-o),"bottom-right":new a.P(-o,-o),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const o=a.P.convert(y);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return Wl(new a.P(0,0))}const ff=_;d.AJAXError=a.be,d.Evented=a.E,d.LngLat=a.M,d.MercatorCoordinate=a.Y,d.Point=a.P,d.addProtocol=a.bf,d.config=a.a,d.removeProtocol=a.bg,d.AttributionControl=so,d.BoxZoomHandler=io,d.CanvasSource=wn,d.CooperativeGesturesHandler=Ft,d.DoubleClickZoomHandler=ou,d.DragPanHandler=cf,d.DragRotateHandler=oo,d.EdgeInsets=Zs,d.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var o;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=h==null?void 0:h.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){C.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=C.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);C.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Be,d.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const h=new a.M(o.coords.longitude,o.coords.latitude),p=o.coords.accuracy,m=this._map.getBearing(),v=a.e({bearing:m},this.options.fitBoundsOptions),E=lt.fromLngLat(h,p);this._map.fitBounds(E,v,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const h=new a.M(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&vs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=C.create("button","maplibregl-ctrl-geolocate",this._container),C.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",o===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=C.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Wa({element:this._dotElement}),this._circleElement=C.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},Vl,y)}onAdd(y){return this._map=y,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(o=!1){if(Oo!==void 0&&!o)return Oo;if(window.navigator.permissions===void 0)return Oo=!!window.navigator.geolocation,Oo;try{Oo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Oo=!!window.navigator.geolocation}return Oo})}().then(o=>this._setupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),C.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ys=0,vs=!1}_isOutOfMapMaxBounds(y){const o=this._map.getMaxBounds(),h=y.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),o=y.getSouthEast(),h=y.getNorthEast(),p=o.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ys--,vs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ys++,Ys>1?(y={maximumAge:6e5,timeout:0},vs=!0):(y=this.options.positionOptions,vs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=tu,d.ImageSource=bt,d.KeyboardHandler=es,d.LngLatBounds=lt,d.LogoControl=uf,d.Map=class extends Si{constructor(y){if(a.bc.mark(a.bd.create),(y=a.e({},qa,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new zl(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Ua,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},cu,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=G.addThrottleControl(()=>this.isMoving()),this._requestManager=new U(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const h=eu(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{o?h(p):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new su(this,y),this._hash=y.hash&&new tu(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new so(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new uf,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new a.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new a.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new a.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(y,o){if(o===void 0&&(o=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[o];return o.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(y);return o>-1&&this._controls.splice(o,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,o,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,o,h,p)}resize(y){var o;const h=this._containerDimensions(),p=h[0],m=h[1],v=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,v),this.painter.resize(p,m,v),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const A=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,A),this.painter.resize(p,m,A)}this.transform.resize(p,m),(o=this._requestedCameraState)===null||o===void 0||o.resize(p,m);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),E&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,o){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),v=y*m,E=o*m;return Math.min(v>h?h/v:1,E>p?p/E:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(lt.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(a.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,o,h){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:v=>{const E=this.getLayer(o)?this.queryRenderedFeatures(v.point,{layers:[o]}):[];E.length?p||(p=!0,h.call(this,new xi(y,this,v.originalEvent,{features:E}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:o,listener:h,delegates:{mousemove:E=>{(this.getLayer(o)?this.queryRenderedFeatures(E.point,{layers:[o]}):[]).length?p=!0:p&&(p=!1,h.call(this,new xi(y,this,E.originalEvent)))},mouseout:E=>{p&&(p=!1,h.call(this,new xi(y,this,E.originalEvent)))}}}}{const p=m=>{const v=this.getLayer(o)?this.queryRenderedFeatures(m.point,{layers:[o]}):[];v.length&&(m.features=v,h.call(this,m),delete m.features)};return{layer:o,listener:h,delegates:{[y]:p}}}}on(y,o,h){if(h===void 0)return super.on(y,o);const p=this._createDelegatedListener(y,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(y,o,h){if(h===void 0)return super.once(y,o);const p=this._createDelegatedListener(y,o,h);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(y,o,h){return h===void 0?super.off(y,o):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const m=this._delegatedListeners[y];for(let v=0;v<m.length;v++){const E=m[v];if(E.layer===o&&E.listener===h){for(const M in E.delegates)this.off(M,E.delegates[M]);return m.splice(v,1),this}}})(),this)}queryRenderedFeatures(y,o){if(!this.style)return[];let h;const p=y instanceof a.P||Array.isArray(y),m=p?y:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(p?{}:y)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const v=a.P.convert(m[0]),E=a.P.convert(m[1]);h=[v,new a.P(E.x,v.y),E,new a.P(v.x,E.y),v]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(y,o){return this.style.querySourceFeatures(y,o)}setStyle(y,o){return(o=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(y,o))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const o=this._locale[y];if(o==null)throw new Error(`Missing UI string '${y}'`);return o}_updateStyle(y,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,o));const h=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Bi(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,o,h):this.style.loadJSON(y,o,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Bi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,o){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,o)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof y=="object"&&this._updateDiff(y,o)}_updateDiff(y,o){try{this.style.setState(y,o)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,o){return this._lazyInitEmptyStyle(),this.style.addSource(y,o),this._update(!0)}isSourceLoaded(y){const o=this.style&&this.style.sourceCaches[y];if(o!==void 0)return o.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const o=this.style.sourceCaches[y.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&o.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new hf(this.painter,o,y),this.painter.renderToTexture=new lu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,o;return(o=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const o in y){const h=y[o]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,o,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:v,stretchY:E,content:M}=h;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||a.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:A,height:R,data:V}=o,q=o;return this.style.addImage(y,{data:new a.R({width:A,height:R},new Uint8Array(V)),pixelRatio:p,stretchX:v,stretchY:E,content:M,sdf:m,version:0,userImage:q}),q.onAdd&&q.onAdd(this,y),this}}{const{width:A,height:R,data:V}=S.getImageData(o);this.style.addImage(y,{data:new a.R({width:A,height:R},V),pixelRatio:p,stretchX:v,stretchY:E,content:M,sdf:m,version:0})}}updateImage(y,o){const h=this.style.getImage(y);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=o instanceof HTMLImageElement||a.b(o)?S.getImageData(o):o,{width:m,height:v,data:E}=p;if(m===void 0||v===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||v!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(o instanceof HTMLImageElement||a.b(o));return h.data.replace(E,M),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return G.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,o){return this._lazyInitEmptyStyle(),this.style.addLayer(y,o),this._update(!0)}moveLayer(y,o){return this.style.moveLayer(y,o),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,o,h){return this.style.setLayerZoomRange(y,o,h),this._update(!0)}setFilter(y,o,h={}){return this.style.setFilter(y,o,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,o,h,p={}){return this.style.setPaintProperty(y,o,h,p),this._update(!0)}getPaintProperty(y,o){return this.style.getPaintProperty(y,o)}setLayoutProperty(y,o,h,p={}){return this.style.setLayoutProperty(y,o,h,p),this._update(!0)}getLayoutProperty(y,o){return this.style.getLayoutProperty(y,o)}setGlyphs(y,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,o,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,o,h,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,o,h=>{h||this._update(!0)}),this}setLight(y,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,o){return this.style.setFeatureState(y,o),this._update()}removeFeatureState(y,o){return this.style.removeFeatureState(y,o),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,o=0;return this._container&&(y=this._container.clientWidth||400,o=this._container.clientHeight||300),[y,o]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const o=this._canvasContainer=C.create("div","maplibregl-canvas-container",y);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=C.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=C.create("div","maplibregl-control-container",y),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{v[E]=C.create("div",`maplibregl-ctrl-${E} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,o,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*o),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{o={requestedAttributes:y},p&&(o.statusMessage=p.statusMessage,o.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const p="Failed to initialize WebGL";throw o?(o.message=p,new Error(JSON.stringify(o))):new Error(p)}this.painter=new Jh(h,this.transform),P.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,v=S.now();this.style.zoomHistory.update(m,v);const E=new a.a8(m,{now:v,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=E.crossFadingFactor();M===1&&M===this._crossFadingFactor||(h=!0,this._crossFadingFactor=M),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),G.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),C.remove(this._canvasContainer),C.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(y=>{a.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return uu}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=xi,d.MapTouchEvent=_o,d.MapWheelEvent=ru,d.Marker=Wa,d.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const o=this._map.getZoom(),h=o===this._map.getMaxZoom(),p=o===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);o.title=p,o.setAttribute("aria-label",p)},this.options=a.e({},hu,y),this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),C.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),C.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=C.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){C.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,o){const h=C.create("button",y,this._container);return h.type="button",h.addEventListener("click",o),h}},d.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&C.remove(this._content),this._container&&(C.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=C.create("div","maplibregl-popup",this._map.getContainer()),this._tip=C.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?jl(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!o)return;const p=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const v=Wl(this.options.offset);if(!m){const M=this._container.offsetWidth,A=this._container.offsetHeight;let R;R=p.y+v.bottom.y<A?["top"]:p.y>this._map.transform.height-A?["bottom"]:[],p.x<M/2?R.push("left"):p.x>this._map.transform.width-M/2&&R.push("right"),m=R.length===0?"bottom":R.join("-")}let E=p.add(v[m]);this.options.subpixelPositioning||(E=E.round()),C.setTransform(this._container,`${Ga[m]} translate(${E.x}px,${E.y}px)`),Ul(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(du),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const o=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=y;p=h.firstChild,p;)o.appendChild(p);return this.setDOMContent(o)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=C.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=C.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(pu);y&&y.focus()}},d.RasterDEMTileSource=nr,d.RasterTileSource=ne,d.ScaleControl=class{constructor(y){this._onMove=()=>{Gl(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Gl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},ql),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){C.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=Fl,d.Style=Bi,d.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=C.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=C.create("button","maplibregl-ctrl-terrain",this._container),C.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){C.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=sf,d.TwoFingersTouchRotateHandler=iu,d.TwoFingersTouchZoomHandler=of,d.TwoFingersTouchZoomRotateHandler=Na,d.VectorTileSource=xt,d.VideoSource=bn,d.addSourceType=(y,o)=>a._(void 0,void 0,void 0,function*(){if(ni(y))throw new Error(`A source type called "${y}" already exists.`);((h,p)=>{Mn[h]=p})(y,o)}),d.clearPrewarmedResources=function(){const y=gr;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Vt),gr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return st().getRTLTextPluginStatus()},d.getVersion=function(){return ff},d.getWorkerCount=function(){return wt.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(y){return mr().broadcast("IS",y)},d.prewarm=function(){rr().acquire(Vt)},d.setMaxParallelImageRequests=function(y){a.a.MAX_PARALLEL_IMAGE_REQUESTS=y},d.setRTLTextPlugin=function(y,o){return st().setRTLTextPlugin(y,o)},d.setWorkerCount=function(y){wt.workerCount=y},d.setWorkerUrl=function(y){a.a.WORKER_URL=y}});var u=t;return u})})(jb);var Pc=jb.exports;const to=kg(Pc),uk=FS({__proto__:null,default:to},[Pc]),oc=[];function Qp(r,e){return{subscribe:Er(r,e).subscribe}}function Er(r,e=It){let t;const n=new Set;function l(a){if(jt(r,a)&&(r=a,t)){const _=!oc.length;for(const x of n)x[1](),oc.push(x,r);if(_){for(let x=0;x<oc.length;x+=2)oc[x][0](oc[x+1]);oc.length=0}}}function u(a){l(a(r))}function d(a,_=It){const x=[a,_];return n.add(x),n.size===1&&(t=e(l,u)||It),a(r),()=>{n.delete(x),n.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:d}}let Ot;const Vb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Vb.decode();let Ju=null;function nh(){return(Ju===null||Ju.byteLength===0)&&(Ju=new Uint8Array(Ot.memory.buffer)),Ju}function Eo(r,e){return r=r>>>0,Vb.decode(nh().subarray(r,r+e))}const Ls=new Array(128).fill(void 0);Ls.push(void 0,null,!0,!1);let ih=Ls.length;function Dn(r){ih===Ls.length&&Ls.push(Ls.length+1);const e=ih;return ih=Ls[e],Ls[e]=r,e}function kr(r){return Ls[r]}function hk(r){r<132||(Ls[r]=ih,ih=r)}function pc(r){const e=kr(r);return hk(r),e}function em(r){return r==null}let Yu=null;function fk(){return(Yu===null||Yu.byteLength===0)&&(Yu=new Float64Array(Ot.memory.buffer)),Yu}let Qu=null;function Ir(){return(Qu===null||Qu.byteLength===0)&&(Qu=new Int32Array(Ot.memory.buffer)),Qu}let aa=0;const Wf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},dk=typeof Wf.encodeInto=="function"?function(r,e){return Wf.encodeInto(r,e)}:function(r,e){const t=Wf.encode(r);return e.set(t),{read:r.length,written:t.length}};function Bf(r,e,t){if(t===void 0){const a=Wf.encode(r),_=e(a.length,1)>>>0;return nh().subarray(_,_+a.length).set(a),aa=a.length,_}let n=r.length,l=e(n,1)>>>0;const u=nh();let d=0;for(;d<n;d++){const a=r.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==n){d!==0&&(r=r.slice(d)),l=t(l,n,n=d+r.length*3,1)>>>0;const a=nh().subarray(l+d,l+n),_=dk(r,a);d+=_.written}return aa=d,l}function zm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const l=r.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=r.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(r)){const l=r.length;let u="[";l>0&&(u+=zm(r[0]));for(let d=1;d<l;d++)u+=", "+zm(r[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function pk(r,e){const t=e(r.length*1,1)>>>0;return nh().set(r,t/1),aa=r.length,t}function tm(r,e){try{return r.apply(this,e)}catch(t){Ot.__wbindgen_exn_store(Dn(t))}}class cd{static __wrap(e){e=e>>>0;const t=Object.create(cd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ot.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=Ot.__wbindgen_add_to_stack_pointer(-16),d=pk(e,Ot.__wbindgen_malloc),a=aa;Ot.jsroutesnapper_new(u,d,a);var t=Ir()[u/4+0],n=Ir()[u/4+1],l=Ir()[u/4+2];if(l)throw pc(n);return cd.__wrap(t)}finally{Ot.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Ot.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Dn(e))}setAreaMode(){Ot.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=Ot.__wbindgen_add_to_stack_pointer(-16);Ot.jsroutesnapper_getConfig(u,this.__wbg_ptr);var n=Ir()[u/4+0],l=Ir()[u/4+1];return e=n,t=l,Eo(n,l)}finally{Ot.__wbindgen_add_to_stack_pointer(16),Ot.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=Ot.__wbindgen_add_to_stack_pointer(-16);Ot.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Ir()[n/4+0],t=Ir()[n/4+1];let l;return e!==0&&(l=Eo(e,t).slice(),Ot.__wbindgen_free(e,t*1)),l}finally{Ot.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=Ot.__wbindgen_add_to_stack_pointer(-16);Ot.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var n=Ir()[u/4+0],l=Ir()[u/4+1];return e=n,t=l,Eo(n,l)}finally{Ot.__wbindgen_add_to_stack_pointer(16),Ot.__wbindgen_free(e,t,1)}}toggleSnapMode(){Ot.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return Ot.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){Ot.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Ot.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Ot.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Ot.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=Ot.__wbindgen_add_to_stack_pointer(-16);Ot.jsroutesnapper_editExisting(l,this.__wbg_ptr,Dn(e));var t=Ir()[l/4+0],n=Ir()[l/4+1];if(n)throw pc(t)}finally{Ot.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=Ot.__wbindgen_add_to_stack_pointer(-16);Ot.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var n=Ir()[u/4+0],l=Ir()[u/4+1];return e=n,t=l,Eo(n,l)}finally{Ot.__wbindgen_add_to_stack_pointer(16),Ot.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=Ot.__wbindgen_add_to_stack_pointer(-16);Ot.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var n=Ir()[u/4+0],l=Ir()[u/4+1];return e=n,t=l,Eo(n,l)}finally{Ot.__wbindgen_add_to_stack_pointer(16),Ot.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const k=Ot.__wbindgen_add_to_stack_pointer(-16);Ot.jsroutesnapper_routeNameForWaypoints(k,this.__wbg_ptr,Dn(e));var l=Ir()[k/4+0],u=Ir()[k/4+1],d=Ir()[k/4+2],a=Ir()[k/4+3],_=l,x=u;if(a)throw _=0,x=0,pc(d);return t=_,n=x,Eo(_,x)}finally{Ot.__wbindgen_add_to_stack_pointer(16),Ot.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){Ot.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){Ot.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const k=Ot.__wbindgen_add_to_stack_pointer(-16);Ot.jsroutesnapper_calculateRoute(k,this.__wbg_ptr,Dn(e));var l=Ir()[k/4+0],u=Ir()[k/4+1],d=Ir()[k/4+2],a=Ir()[k/4+3],_=l,x=u;if(a)throw _=0,x=0,pc(d);return t=_,n=x,Eo(_,x)}finally{Ot.__wbindgen_add_to_stack_pointer(16),Ot.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,l;try{const S=Ot.__wbindgen_add_to_stack_pointer(-16);Ot.jsroutesnapper_getExtraNodes(S,this.__wbg_ptr,Dn(e),Dn(t));var u=Ir()[S/4+0],d=Ir()[S/4+1],a=Ir()[S/4+2],_=Ir()[S/4+3],x=u,k=d;if(_)throw x=0,k=0,pc(a);return n=x,l=k,Eo(x,k)}finally{Ot.__wbindgen_add_to_stack_pointer(16),Ot.__wbindgen_free(n,l,1)}}}async function mk(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function gk(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Eo(e,t);return Dn(n)},r.wbg.__wbindgen_object_drop_ref=function(e){pc(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Eo(e,t));return Dn(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=kr(t),l=typeof n=="number"?n:void 0;fk()[e/8+1]=em(l)?0:l,Ir()[e/4+0]=!em(l)},r.wbg.__wbindgen_is_object=function(e){const t=kr(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return kr(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return kr(e)in kr(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=kr(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return kr(e)==kr(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=kr(t),l=typeof n=="string"?n:void 0;var u=em(l)?0:Bf(l,Ot.__wbindgen_malloc,Ot.__wbindgen_realloc),d=aa;Ir()[e/4+1]=d,Ir()[e/4+0]=u},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(kr(t)),l=Bf(n,Ot.__wbindgen_malloc,Ot.__wbindgen_realloc),u=aa;Ir()[e/4+1]=u,Ir()[e/4+0]=l},r.wbg.__wbindgen_object_clone_ref=function(e){const t=kr(e);return Dn(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=kr(e)[kr(t)];return Dn(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Dn(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=kr(t).stack,l=Bf(n,Ot.__wbindgen_malloc,Ot.__wbindgen_realloc),u=aa;Ir()[e/4+1]=u,Ir()[e/4+0]=l},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,l;try{n=e,l=t,console.error(Eo(e,t))}finally{Ot.__wbindgen_free(n,l,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(kr(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(kr(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(kr(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(kr(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(kr(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=kr(e)[t>>>0];return Dn(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return kr(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof kr(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=kr(e).next;return Dn(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return tm(function(e){const t=kr(e).next();return Dn(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return kr(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=kr(e).value;return Dn(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Dn(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return tm(function(e,t){const n=Reflect.get(kr(e),kr(t));return Dn(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return tm(function(e,t){const n=kr(e).call(kr(t));return Dn(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(kr(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=kr(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=kr(e).buffer;return Dn(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(kr(e));return Dn(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){kr(e).set(kr(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return kr(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=kr(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=zm(kr(t)),l=Bf(n,Ot.__wbindgen_malloc,Ot.__wbindgen_realloc),u=aa;Ir()[e/4+1]=u,Ir()[e/4+0]=l},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Eo(e,t))},r.wbg.__wbindgen_memory=function(){const e=Ot.memory;return Dn(e)},r}function _k(r,e){return Ot=r.exports,qb.__wbindgen_wasm_module=e,Yu=null,Qu=null,Ju=null,Ot}async function qb(r){if(Ot!==void 0)return Ot;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=gk();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await mk(await r,e);return _k(t,n)}var Li=63710088e-1,Tg={centimeters:Li*100,centimetres:Li*100,degrees:Li/111325,feet:Li*3.28084,inches:Li*39.37,kilometers:Li/1e3,kilometres:Li/1e3,meters:Li,metres:Li,miles:Li/1609.344,millimeters:Li*1e3,millimetres:Li*1e3,nauticalmiles:Li/1852,radians:1,yards:Li*1.0936},yk={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Li,yards:1.0936133},Dm={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Do(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function vk(r,e,t){switch(r){case"Point":return eo(e).geometry;case"LineString":return Co(e).geometry;case"Polygon":return Eg(e).geometry;case"MultiPoint":return Wb(e).geometry;case"MultiLineString":return Gb(e).geometry;case"MultiPolygon":return Zb(e).geometry;default:throw new Error(r+" is invalid")}}function eo(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ud(r[0])||!ud(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Do(n,e,t)}function bk(r,e,t){return t===void 0&&(t={}),tl(r.map(function(n){return eo(n,e)}),t)}function Eg(r,e,t){t===void 0&&(t={});for(var n=0,l=r;n<l.length;n++){var u=l[n];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<u[u.length-1].length;d++)if(u[u.length-1][d]!==u[0][d])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return Do(a,e,t)}function wk(r,e,t){return t===void 0&&(t={}),tl(r.map(function(n){return Eg(n,e)}),t)}function Co(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Do(n,e,t)}function xk(r,e,t){return t===void 0&&(t={}),tl(r.map(function(n){return Co(n,e)}),t)}function tl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Gb(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return Do(n,e,t)}function Wb(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return Do(n,e,t)}function Zb(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return Do(n,e,t)}function Sk(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return Do(n,e,t)}function kk(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Mg(r,e){e===void 0&&(e="kilometers");var t=Tg[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Bd(r,e){e===void 0&&(e="kilometers");var t=Tg[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Tk(r,e){return hh(Bd(r,e))}function Ek(r){var e=r%360;return e<0&&(e+=360),e}function hh(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Io(r){var e=r%360;return e*Math.PI/180}function Mk(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Mg(Bd(r,e),t)}function Ck(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Dm[e];if(!n)throw new Error("invalid original units");var l=Dm[t];if(!l)throw new Error("invalid final units");return r/n*l}function ud(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Cg(r){return!!r&&r.constructor===Object}function Ik(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!ud(e))throw new Error("bbox must only contain numbers")})}function Ak(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Lk=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Dm,bearingToAzimuth:Ek,convertArea:Ck,convertLength:Mk,degreesToRadians:Io,earthRadius:Li,factors:Tg,feature:Do,featureCollection:tl,geometry:vk,geometryCollection:Sk,isNumber:ud,isObject:Cg,lengthToDegrees:Tk,lengthToRadians:Bd,lineString:Co,lineStrings:xk,multiLineString:Gb,multiPoint:Wb,multiPolygon:Zb,point:eo,points:bk,polygon:Eg,polygons:wk,radiansToDegrees:hh,radiansToLength:Mg,round:kk,unitsFactors:yk,validateBBox:Ik,validateId:Ak},Symbol.toStringTag,{value:"Module"}));function fh(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Sc(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Fu(r,e,t){t===void 0&&(t={});var n=fh(r),l=fh(e),u=Io(l[1]-n[1]),d=Io(l[0]-n[0]),a=Io(n[1]),_=Io(l[1]),x=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return Mg(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),t.units)}function kh(r,e,t){if(r!==null)for(var n,l,u,d,a,_,x,k=0,S=0,C,P=r.type,D=P==="FeatureCollection",O=P==="Feature",z=D?r.features.length:1,B=0;B<z;B++){x=D?r.features[B].geometry:O?r.geometry:r,C=x?x.type==="GeometryCollection":!1,a=C?x.geometries.length:1;for(var N=0;N<a;N++){var G=0,U=0;if(d=C?x.geometries[N]:x,d!==null){_=d.coordinates;var te=d.type;switch(k=t&&(te==="Polygon"||te==="MultiPolygon")?1:0,te){case null:break;case"Point":if(e(_,S,B,G,U)===!1)return!1;S++,G++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],S,B,G,U)===!1)return!1;S++,te==="MultiPoint"&&G++}te==="LineString"&&G++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-k;l++){if(e(_[n][l],S,B,G,U)===!1)return!1;S++}te==="MultiLineString"&&G++,te==="Polygon"&&U++}te==="Polygon"&&G++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(U=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-k;u++){if(e(_[n][l][u],S,B,G,U)===!1)return!1;S++}U++}G++}break;case"GeometryCollection":for(n=0;n<d.geometries.length;n++)if(kh(d.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Pk(r,e,t,n){var l=t;return kh(r,function(u,d,a,_,x){d===0&&t===void 0?l=u:l=e(l,u,d,a,_,x)},n),l}function Hb(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function zk(r,e,t){var n=t;return Hb(r,function(l,u){u===0&&t===void 0?n=l:n=e(n,l,u)}),n}function hd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Dk(r,e,t){var n=t;return hd(r,function(l,u){u===0&&t===void 0?n=l:n=e(n,l,u)}),n}function Rk(r){var e=[];return kh(r,function(t){e.push(t)}),e}function Ig(r,e){var t,n,l,u,d,a,_,x,k,S,C=0,P=r.type==="FeatureCollection",D=r.type==="Feature",O=P?r.features.length:1;for(t=0;t<O;t++){for(a=P?r.features[t].geometry:D?r.geometry:r,x=P?r.features[t].properties:D?r.properties:{},k=P?r.features[t].bbox:D?r.bbox:void 0,S=P?r.features[t].id:D?r.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,C,x,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,C,x,k,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],C,x,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function Bk(r,e,t){var n=t;return Ig(r,function(l,u,d,a,_){u===0&&t===void 0?n=l:n=e(n,l,u,d,a,_)}),n}function zc(r,e){Ig(r,function(t,n,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Do(t,l,{bbox:u,id:d}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<t.coordinates.length;x++){var k=t.coordinates[x],S={type:_,coordinates:k};if(e(Do(S,l),n,x)===!1)return!1}})}function Fk(r,e,t){var n=t;return zc(r,function(l,u,d){u===0&&d===0&&t===void 0?n=l:n=e(n,l,u,d)}),n}function $b(r,e){zc(r,function(t,n,l){var u=0;if(t.geometry){var d=t.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var a,_=0,x=0,k=0;if(kh(t,function(S,C,P,D,O){if(a===void 0||n>_||D>x||O>k){a=S,_=n,x=D,k=O,u=0;return}var z=Co([a,S],t.properties);if(e(z,n,l,O,u)===!1)return!1;u++,a=S})===!1)return!1}}})}function Ok(r,e,t){var n=t,l=!1;return $b(r,function(u,d,a,_,x){l===!1&&t===void 0?n=u:n=e(n,u,d,a,_,x),l=!0}),n}function Xb(r,e){if(!r)throw new Error("geojson is required");zc(r,function(t,n,l){if(t.geometry!==null){var u=t.geometry.type,d=t.geometry.coordinates;switch(u){case"LineString":if(e(t,n,l,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<d.length;a++)if(e(Co(d[a],t.properties),n,l,a)===!1)return!1;break}}})}function Nk(r,e,t){var n=t;return Xb(r,function(l,u,d,a){u===0&&t===void 0?n=l:n=e(n,l,u,d,a)}),n}function jk(r,e){if(e=e||{},!Cg(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.segmentIndex||0,d=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),d=d||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":d=d||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),Co([_[u],_[u+1]],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u-1),Co([_[l][u],_[l][u+1]],d,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u-1),Co([_[n][u],_[n][u+1]],d,e);case"MultiPolygon":return n<0&&(n=_.length+n),l<0&&(l=_[n].length+l),u<0&&(u=_[n][l].length-u-1),Co([_[n][l][u],_[n][l][u+1]],d,e)}throw new Error("geojson is invalid")}function Uk(r,e){if(e=e||{},!Cg(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.coordIndex||0,d=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),d=d||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":d=d||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return eo(_,d,e);case"MultiPoint":return n<0&&(n=_.length+n),eo(_[n],d,e);case"LineString":return u<0&&(u=_.length+u),eo(_[u],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u),eo(_[l][u],d,e);case"MultiLineString":return n<0&&(n=_.length+n),u<0&&(u=_[n].length+u),eo(_[n][u],d,e);case"MultiPolygon":return n<0&&(n=_.length+n),l<0&&(l=_[n].length+l),u<0&&(u=_[n][l].length-u),eo(_[n][l][u],d,e)}throw new Error("geojson is invalid")}const Vk=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Rk,coordEach:kh,coordReduce:Pk,featureEach:hd,featureReduce:Dk,findPoint:Uk,findSegment:jk,flattenEach:zc,flattenReduce:Fk,geomEach:Ig,geomReduce:Bk,lineEach:Xb,lineReduce:Nk,propEach:Hb,propReduce:zk,segmentEach:$b,segmentReduce:Ok},Symbol.toStringTag,{value:"Module"}));function Kb(r,e,t){if(t===void 0&&(t={}),t.final===!0)return qk(r,e);var n=fh(r),l=fh(e),u=Io(n[0]),d=Io(l[0]),a=Io(n[1]),_=Io(l[1]),x=Math.sin(d-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return hh(Math.atan2(x,k))}function qk(r,e){var t=Kb(e,r);return t=(t+180)%360,t}function Vy(r,e,t,n){n===void 0&&(n={});var l=fh(r),u=Io(l[0]),d=Io(l[1]),a=Io(t),_=Bd(e,n.units),x=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(x)),S=hh(k),C=hh(x);return eo([S,C],n.properties)}function qy(r){if(!r)throw new Error("geojson is required");var e=[];return zc(r,function(t){Gk(t,e)}),tl(e)}function Gk(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Sc(n);break;case"LineString":t=[Sc(n)]}t.forEach(function(l){var u=Wk(l,r.properties);u.forEach(function(d){d.id=e.length,e.push(d)})})}}function Wk(r,e){var t=[];return r.reduce(function(n,l){var u=Co([n,l],e);return u.bbox=Zk(n,l),t.push(u),l}),t}function Zk(r,e){var t=r[0],n=r[1],l=e[0],u=e[1],d=t<l?t:l,a=n<u?n:u,_=t>l?t:l,x=n>u?n:u;return[d,a,_,x]}var Ag={exports:{}},Jb={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Sh,function(){function t(N,G,U,te,le){(function $(J,_e,ze,re,ue){for(;re>ze;){if(re-ze>600){var He=re-ze+1,Me=_e-ze+1,ut=Math.log(He),At=.5*Math.exp(2*ut/3),Nt=.5*Math.sqrt(ut*At*(He-At)/He)*(Me-He/2<0?-1:1),Je=Math.max(ze,Math.floor(_e-Me*At/He+Nt)),Jt=Math.min(re,Math.floor(_e+(He-Me)*At/He+Nt));$(J,_e,Je,Jt,ue)}var Kt=J[_e],Ut=ze,Vt=re;for(n(J,ze,_e),ue(J[re],Kt)>0&&n(J,ze,re);Ut<Vt;){for(n(J,Ut,Vt),Ut++,Vt--;ue(J[Ut],Kt)<0;)Ut++;for(;ue(J[Vt],Kt)>0;)Vt--}ue(J[ze],Kt)===0?n(J,ze,Vt):n(J,++Vt,re),Vt<=_e&&(ze=Vt+1),_e<=Vt&&(re=Vt-1)}})(N,G,U||0,te||N.length-1,le||l)}function n(N,G,U){var te=N[G];N[G]=N[U],N[U]=te}function l(N,G){return N<G?-1:N>G?1:0}var u=function(N){N===void 0&&(N=9),this._maxEntries=Math.max(4,N),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function d(N,G,U){if(!U)return G.indexOf(N);for(var te=0;te<G.length;te++)if(U(N,G[te]))return te;return-1}function a(N,G){_(N,0,N.children.length,G,N)}function _(N,G,U,te,le){le||(le=z(null)),le.minX=1/0,le.minY=1/0,le.maxX=-1/0,le.maxY=-1/0;for(var $=G;$<U;$++){var J=N.children[$];x(le,N.leaf?te(J):J)}return le}function x(N,G){return N.minX=Math.min(N.minX,G.minX),N.minY=Math.min(N.minY,G.minY),N.maxX=Math.max(N.maxX,G.maxX),N.maxY=Math.max(N.maxY,G.maxY),N}function k(N,G){return N.minX-G.minX}function S(N,G){return N.minY-G.minY}function C(N){return(N.maxX-N.minX)*(N.maxY-N.minY)}function P(N){return N.maxX-N.minX+(N.maxY-N.minY)}function D(N,G){return N.minX<=G.minX&&N.minY<=G.minY&&G.maxX<=N.maxX&&G.maxY<=N.maxY}function O(N,G){return G.minX<=N.maxX&&G.minY<=N.maxY&&G.maxX>=N.minX&&G.maxY>=N.minY}function z(N){return{children:N,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function B(N,G,U,te,le){for(var $=[G,U];$.length;)if(!((U=$.pop())-(G=$.pop())<=te)){var J=G+Math.ceil((U-G)/te/2)*te;t(N,J,G,U,le),$.push(G,J,J,U)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(N){var G=this.data,U=[];if(!O(N,G))return U;for(var te=this.toBBox,le=[];G;){for(var $=0;$<G.children.length;$++){var J=G.children[$],_e=G.leaf?te(J):J;O(N,_e)&&(G.leaf?U.push(J):D(N,_e)?this._all(J,U):le.push(J))}G=le.pop()}return U},u.prototype.collides=function(N){var G=this.data;if(!O(N,G))return!1;for(var U=[];G;){for(var te=0;te<G.children.length;te++){var le=G.children[te],$=G.leaf?this.toBBox(le):le;if(O(N,$)){if(G.leaf||D(N,$))return!0;U.push(le)}}G=U.pop()}return!1},u.prototype.load=function(N){if(!N||!N.length)return this;if(N.length<this._minEntries){for(var G=0;G<N.length;G++)this.insert(N[G]);return this}var U=this._build(N.slice(),0,N.length-1,0);if(this.data.children.length)if(this.data.height===U.height)this._splitRoot(this.data,U);else{if(this.data.height<U.height){var te=this.data;this.data=U,U=te}this._insert(U,this.data.height-U.height-1,!0)}else this.data=U;return this},u.prototype.insert=function(N){return N&&this._insert(N,this.data.height-1),this},u.prototype.clear=function(){return this.data=z([]),this},u.prototype.remove=function(N,G){if(!N)return this;for(var U,te,le,$=this.data,J=this.toBBox(N),_e=[],ze=[];$||_e.length;){if($||($=_e.pop(),te=_e[_e.length-1],U=ze.pop(),le=!0),$.leaf){var re=d(N,$.children,G);if(re!==-1)return $.children.splice(re,1),_e.push($),this._condense(_e),this}le||$.leaf||!D($,J)?te?(U++,$=te.children[U],le=!1):$=null:(_e.push($),ze.push(U),U=0,te=$,$=$.children[0])}return this},u.prototype.toBBox=function(N){return N},u.prototype.compareMinX=function(N,G){return N.minX-G.minX},u.prototype.compareMinY=function(N,G){return N.minY-G.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(N){return this.data=N,this},u.prototype._all=function(N,G){for(var U=[];N;)N.leaf?G.push.apply(G,N.children):U.push.apply(U,N.children),N=U.pop();return G},u.prototype._build=function(N,G,U,te){var le,$=U-G+1,J=this._maxEntries;if($<=J)return a(le=z(N.slice(G,U+1)),this.toBBox),le;te||(te=Math.ceil(Math.log($)/Math.log(J)),J=Math.ceil($/Math.pow(J,te-1))),(le=z([])).leaf=!1,le.height=te;var _e=Math.ceil($/J),ze=_e*Math.ceil(Math.sqrt(J));B(N,G,U,ze,this.compareMinX);for(var re=G;re<=U;re+=ze){var ue=Math.min(re+ze-1,U);B(N,re,ue,_e,this.compareMinY);for(var He=re;He<=ue;He+=_e){var Me=Math.min(He+_e-1,ue);le.children.push(this._build(N,He,Me,te-1))}}return a(le,this.toBBox),le},u.prototype._chooseSubtree=function(N,G,U,te){for(;te.push(G),!G.leaf&&te.length-1!==U;){for(var le=1/0,$=1/0,J=void 0,_e=0;_e<G.children.length;_e++){var ze=G.children[_e],re=C(ze),ue=(He=N,Me=ze,(Math.max(Me.maxX,He.maxX)-Math.min(Me.minX,He.minX))*(Math.max(Me.maxY,He.maxY)-Math.min(Me.minY,He.minY))-re);ue<$?($=ue,le=re<le?re:le,J=ze):ue===$&&re<le&&(le=re,J=ze)}G=J||G.children[0]}var He,Me;return G},u.prototype._insert=function(N,G,U){var te=U?N:this.toBBox(N),le=[],$=this._chooseSubtree(te,this.data,G,le);for($.children.push(N),x($,te);G>=0&&le[G].children.length>this._maxEntries;)this._split(le,G),G--;this._adjustParentBBoxes(te,le,G)},u.prototype._split=function(N,G){var U=N[G],te=U.children.length,le=this._minEntries;this._chooseSplitAxis(U,le,te);var $=this._chooseSplitIndex(U,le,te),J=z(U.children.splice($,U.children.length-$));J.height=U.height,J.leaf=U.leaf,a(U,this.toBBox),a(J,this.toBBox),G?N[G-1].children.push(J):this._splitRoot(U,J)},u.prototype._splitRoot=function(N,G){this.data=z([N,G]),this.data.height=N.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(N,G,U){for(var te,le,$,J,_e,ze,re,ue=1/0,He=1/0,Me=G;Me<=U-G;Me++){var ut=_(N,0,Me,this.toBBox),At=_(N,Me,U,this.toBBox),Nt=(le=ut,$=At,J=void 0,_e=void 0,ze=void 0,re=void 0,J=Math.max(le.minX,$.minX),_e=Math.max(le.minY,$.minY),ze=Math.min(le.maxX,$.maxX),re=Math.min(le.maxY,$.maxY),Math.max(0,ze-J)*Math.max(0,re-_e)),Je=C(ut)+C(At);Nt<ue?(ue=Nt,te=Me,He=Je<He?Je:He):Nt===ue&&Je<He&&(He=Je,te=Me)}return te||U-G},u.prototype._chooseSplitAxis=function(N,G,U){var te=N.leaf?this.compareMinX:k,le=N.leaf?this.compareMinY:S;this._allDistMargin(N,G,U,te)<this._allDistMargin(N,G,U,le)&&N.children.sort(te)},u.prototype._allDistMargin=function(N,G,U,te){N.children.sort(te);for(var le=this.toBBox,$=_(N,0,G,le),J=_(N,U-G,U,le),_e=P($)+P(J),ze=G;ze<U-G;ze++){var re=N.children[ze];x($,N.leaf?le(re):re),_e+=P($)}for(var ue=U-G-1;ue>=G;ue--){var He=N.children[ue];x(J,N.leaf?le(He):He),_e+=P(J)}return _e},u.prototype._adjustParentBBoxes=function(N,G,U){for(var te=U;te>=0;te--)x(G[te],N)},u.prototype._condense=function(N){for(var G=N.length-1,U=void 0;G>=0;G--)N[G].children.length===0?G>0?(U=N[G-1].children).splice(U.indexOf(N[G]),1):this.clear():a(N[G],this.toBBox)},u})})(Jb);var Hk=Jb.exports;const $k=Rd(Lk),Xk=Rd(Vk);function Yb(r,e,t){if(r!==null)for(var n,l,u,d,a,_,x,k=0,S=0,C,P=r.type,D=P==="FeatureCollection",O=P==="Feature",z=D?r.features.length:1,B=0;B<z;B++){x=D?r.features[B].geometry:O?r.geometry:r,C=x?x.type==="GeometryCollection":!1,a=C?x.geometries.length:1;for(var N=0;N<a;N++){var G=0,U=0;if(d=C?x.geometries[N]:x,d!==null){_=d.coordinates;var te=d.type;switch(k=t&&(te==="Polygon"||te==="MultiPolygon")?1:0,te){case null:break;case"Point":if(e(_,S,B,G,U)===!1)return!1;S++,G++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],S,B,G,U)===!1)return!1;S++,te==="MultiPoint"&&G++}te==="LineString"&&G++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-k;l++){if(e(_[n][l],S,B,G,U)===!1)return!1;S++}te==="MultiLineString"&&G++,te==="Polygon"&&U++}te==="Polygon"&&G++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(U=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-k;u++){if(e(_[n][l][u],S,B,G,U)===!1)return!1;S++}U++}G++}break;case"GeometryCollection":for(n=0;n<d.geometries.length;n++)if(Yb(d.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Qb(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Yb(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var Kk=Qb;const Jk=Object.freeze(Object.defineProperty({__proto__:null,bbox:Qb,default:Kk},Symbol.toStringTag,{value:"Module"})),Yk=Rd(Jk);var ss=Hk,ew=$k,tw=Xk,sc=Yk.default,Qk=tw.featureEach;tw.coordEach;ew.polygon;var Gy=ew.featureCollection;function rw(r){var e=new ss(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:sc(t),ss.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:sc(l),n.push(l)}):Qk(t,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:sc(l),n.push(l)}),ss.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:sc(t),ss.prototype.remove.call(this,t,n)},e.clear=function(){return ss.prototype.clear.call(this)},e.search=function(t){var n=ss.prototype.search.call(this,this.toBBox(t));return Gy(n)},e.collides=function(t){return ss.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=ss.prototype.all.call(this);return Gy(t)},e.toJSON=function(){return ss.prototype.toJSON.call(this)},e.fromJSON=function(t){return ss.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=sc(t);else if(t.type==="FeatureCollection")n=sc(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Ag.exports=rw;Ag.exports.default=rw;var e4=Ag.exports;const t4=kg(e4);function r4(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Do(r)),e.type==="LineString"&&(e=Do(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=Wy(r,e);return l&&n.push(l),tl(n)}var u=t4();return u.load(qy(e)),hd(qy(r),function(d){hd(u.search(d),function(a){var _=Wy(d,a);if(_){var x=Sc(_).join(",");t[x]||(t[x]=!0,n.push(_))}})}),tl(n)}function Wy(r,e){var t=Sc(r),n=Sc(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=t[0][0],u=t[0][1],d=t[1][0],a=t[1][1],_=n[0][0],x=n[0][1],k=n[1][0],S=n[1][1],C=(S-x)*(d-l)-(k-_)*(a-u),P=(k-_)*(u-x)-(S-x)*(l-_),D=(d-l)*(u-x)-(a-u)*(l-_);if(C===0)return null;var O=P/C,z=D/C;if(O>=0&&O<=1&&z>=0&&z<=1){var B=l+O*(d-l),N=u+O*(a-u);return eo([B,N])}return null}function n4(r,e,t){t===void 0&&(t={});var n=eo([1/0,1/0],{dist:1/0}),l=0;return zc(r,function(u){for(var d=Sc(u),a=0;a<d.length-1;a++){var _=eo(d[a]);_.properties.dist=Fu(e,_,t);var x=eo(d[a+1]);x.properties.dist=Fu(e,x,t);var k=Fu(_,x,t),S=Math.max(_.properties.dist,x.properties.dist),C=Kb(_,x),P=Vy(e,S,C+90,t),D=Vy(e,S,C-90,t),O=r4(Co([P.geometry.coordinates,D.geometry.coordinates]),Co([_.geometry.coordinates,x.geometry.coordinates])),z=null;O.features.length>0&&(z=O.features[0],z.properties.dist=Fu(e,z,t),z.properties.location=l+Fu(_,z,t)),_.properties.dist<n.properties.dist&&(n=_,n.properties.index=a,n.properties.location=l),x.properties.dist<n.properties.dist&&(n=x,n.properties.index=a+1,n.properties.location=l+k),z&&z.properties.dist<n.properties.dist&&(n=z,n.properties.index=a),l+=k}}),n}const i4=30;class o4{constructor(e,t,n,l,u){this.onMouseMove=d=>{if(!this.active)return;const a=[d.point.x-i4,d.point.y],_=this.map.unproject(d.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(d.lngLat.lng,d.lngLat.lat,_)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=d=>{this.active&&(d.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||d.key=="Escape"&&(d.stopPropagation(),this.cancel())},this.onKeyPress=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||(d.key=="Enter"?(d.stopPropagation(),this.finish()):d.key=="s"||d.key=="S"?(d.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):d.key=="z"&&d.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new cd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Rm="MZEJTanw3WpxRvt7qDfo";let ls=Er(null),Bm=Er("streets-v2"),dh=Er(!1),ha=Er(""),fd=Er(!0),ri=Er(null),Fm=Er(new Pc.LngLat(0,0)),Om=Er(new Pc.LngLat(0,0)),Zy=Er(1),Is=Er(1),dr=Er({mode:"title"}),Nm=Er("walk_cycle_only"),Hy=Er(!1),ph=Er(!1);function kc(){let r=Hi(ha);r||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(r,Hi(ri).toSavefile())}function $y(r){let e,t;return e=new zd({props:{$$slots:{default:[s4,({dialog:n})=>({3:n}),({dialog:n})=>n?8:0]},$$scope:{ctx:r}}}),e.$on("close",r[2]),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&24&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function s4(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D;function O(){return r[1](r[3])}return{c(){e=de("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=Ue(),n=de("p"),n.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=Ue(),u=de("p"),u.textContent="To use this tool, you need to:",d=Ue(),a=de("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=Ue(),x=de("p"),x.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,k=Ue(),S=de("center"),C=de("button"),C.textContent="Start!"},m(z,B){be(z,e,B),be(z,t,B),be(z,n,B),be(z,l,B),be(z,u,B),be(z,d,B),be(z,a,B),be(z,_,B),be(z,x,B),be(z,k,B),be(z,S,B),ie(S,C),P||(D=Et(C,"click",O),P=!0)},p(z,B){r=z},d(z){z&&(ve(e),ve(t),ve(n),ve(l),ve(u),ve(d),ve(a),ve(_),ve(x),ve(k),ve(S)),P=!1,D()}}}function a4(r){let e,t,n=r[0]&&$y(r);return{c(){n&&n.c(),e=$n()},m(l,u){n&&n.m(l,u),be(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=$y(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){pe(n),t=!1},d(l){l&&ve(e),n&&n.d(l)}}}function l4(r,e,t){let n;return yt(r,fd,d=>t(0,n=d)),[n,d=>dn(d).close(),()=>Rt(fd,n=!1,n)]}class c4 extends Ht{constructor(e){super(),Zt(this,e,l4,a4,jt,{})}}const u4="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",h4="/ltn/assets/logo-97f2d067.svg";let f4=Date.now();function Dc(r){return`${r}-${f4++}`}const Lg=Symbol.for("svelte-maplibre");function il(){return Ab(Lg)}function d4(r){let e=new WeakMap;return t=>{var d;let n=e.get(t.originalEvent);if(n!==void 0)return n;let u=(d=t.target.queryRenderedFeatures(t.point).find(a=>{var _;return(_=r.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:d.layer.id;return e.set(t.originalEvent,u),u}}function p4(){let r=new Map;return Sg(Lg,{map:Er(null),source:Qp(null),layer:Qp(null),popupTarget:Qp(null),cluster:Er(),loadedImages:Er(new Set),minzoom:Er(0),maxzoom:Er(24),layerEvent:Er(null),layerInfo:r,eventTopMost:d4(r),markerClickManager:new v4})}function Xy(r){return{subscribe:r.subscribe}}function Pg({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let l=il(),u=Er(null),d=Xy(u),a={...l,[r]:Xy(u)};if(e&&(a.popupTarget=d),n){let _=Er(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=Er()),Sg(Lg,a),{...l,self:u}}function m4(){return Pg({key:"source",setCluster:!0})}function g4(r=!0){return Pg({key:"layer",setPopupTarget:r,setMouseEvent:r})}function _4(){return Pg({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function y4(r){return"layerType"in r&&r.layerType==="deckgl"}class v4{constructor(){Wn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Ky(r){let e;return t=>{if(t)for(let n in t){let l=e==null?void 0:e[n],u=t[n];l!==u&&r(n,u,l)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function b4(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function w4(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function rl(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var nl=x4;function x4(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var l=r[n];l!=null&&e.push(l)}return e}if(typeof r=="object"){e={};var u=Object.keys(r);for(t=u.length,n=0;n<t;n++){var d=u[n],a=r[d];a!=null&&(e[d]=a)}return e}}}function Jy(r){let e=r[0],t,n,l=Yy(r);return{c(){l.c(),t=$n()},m(u,d){l.m(u,d),be(u,t,d),n=!0},p(u,d){d[0]&1&&jt(e,e=u[0])?(vr(),pe(l,1,1,It),br(),l=Yy(u),l.c(),oe(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(oe(l),n=!0)},o(u){pe(l),n=!1},d(u){u&&ve(t),l.d(u)}}}function Yy(r){let e;const t=r[36].default,n=Vr(t,r,r[35],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[1]&16)&&Gr(n,t,l,l[35],e?qr(t,l[35],u,null):Wr(l[35]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function S4(r){let e,t,n=r[0]&&Jy(r);return{c(){n&&n.c(),e=$n()},m(l,u){n&&n.m(l,u),be(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u[0]&1&&oe(n,1)):(n=Jy(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){pe(n),t=!1},d(l){l&&ve(e),n&&n.d(l)}}}function k4(r,e,t){let n,l,u,d,a,_,x,k,S,C,P,D,{$$slots:O={},$$scope:z}=e,{id:B=Dc("layer")}=e,{source:N=void 0}=e,{sourceLayer:G=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:te=void 0}=e,{type:le}=e,{paint:$=void 0}=e,{layout:J=void 0}=e,{filter:_e=void 0}=e,{applyToClusters:ze=void 0}=e,{minzoom:re=void 0}=e,{maxzoom:ue=void 0}=e,{manageHoverState:He=!1}=e,{hovered:Me=null}=e,{interactive:ut=!0}=e,{hoverCursor:At=void 0}=e,{eventsIfTopMost:Nt=!1}=e;const Je=us(),{map:Jt,source:Kt,self:Ut,minzoom:Vt,maxzoom:wt,eventTopMost:Yt,layerInfo:gr}=g4();yt(r,Jt,De=>t(31,S=De)),yt(r,Kt,De=>t(32,C=De)),yt(r,Ut,De=>t(0,k=De)),yt(r,Vt,De=>t(34,D=De)),yt(r,wt,De=>t(33,P=De)),ti(()=>{k&&S&&(gr.delete(k),S==null||S.removeLayer(k))});let Pt;function rr(De){var ne,nr;if(!ut||!k||!S||Nt&&Yt(De)!==k)return;let lt=De.features??[],nt=(nr=(ne=lt[0])==null?void 0:ne.properties)==null?void 0:nr.cluster_id,xt={event:De,map:S,clusterId:nt,layer:k,source:a,features:lt};Je(De.type,xt)}function wr(De){var ne,nr;if(!ut||!k||!S||Nt&&Yt(De)!==k)return;At&&(S.getCanvas().style.cursor=At);let lt=De.features??[];t(6,Me=lt[0]??null);let nt=(nr=(ne=lt[0])==null?void 0:ne.properties)==null?void 0:nr.cluster_id;Je("mouseenter",{event:De,map:S,clusterId:nt,layer:k,source:a,features:lt})}function mr(De){var ne,nr,Be;if(!ut||!S)return;if(Nt&&Yt(De)!==k){t(6,Me=null),He&&Pt!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:G,id:Pt},{hover:!1}),Pt=void 0);return}S.getCanvas().style.cursor=At;let lt=De.features??[],nt=(nr=(ne=lt[0])==null?void 0:ne.properties)==null?void 0:nr.cluster_id,xt=(Be=lt[0])==null?void 0:Be.id;xt!==Pt&&(He&&(Pt!==void 0&&(S==null||S.setFeatureState({source:a,id:Pt,sourceLayer:G},{hover:!1})),S==null||S.setFeatureState({source:a,id:xt,sourceLayer:G},{hover:!0})),Pt=xt,t(6,Me=lt[0]??null)),Je("mousemove",{event:De,map:S,clusterId:nt,layer:k,source:a,features:lt})}function Rr(De){if(!(!ut||!k||!S)){if(At&&(S.getCanvas().style.cursor=""),t(6,Me=null),He&&Pt!==void 0){const lt={source:a,id:Pt,sourceLayer:G};S==null||S.setFeatureState(lt,{hover:!1}),Pt=void 0}Je("mouseleave",{map:S,layer:k,source:a})}}let ht=!0;function Mt(De){S&&(S.off("click",De,rr),S.off("dblclick",De,rr),S.off("contextmenu",De,rr),S.off("mouseenter",De,wr),S.off("mousemove",De,mr),S.off("mouseleave",De,Rr))}return ti(()=>{S&&k&&Mt(k)}),r.$$set=De=>{"id"in De&&t(7,B=De.id),"source"in De&&t(8,N=De.source),"sourceLayer"in De&&t(9,G=De.sourceLayer),"beforeId"in De&&t(10,U=De.beforeId),"beforeLayerType"in De&&t(11,te=De.beforeLayerType),"type"in De&&t(12,le=De.type),"paint"in De&&t(13,$=De.paint),"layout"in De&&t(14,J=De.layout),"filter"in De&&t(15,_e=De.filter),"applyToClusters"in De&&t(16,ze=De.applyToClusters),"minzoom"in De&&t(17,re=De.minzoom),"maxzoom"in De&&t(18,ue=De.maxzoom),"manageHoverState"in De&&t(19,He=De.manageHoverState),"hovered"in De&&t(6,Me=De.hovered),"interactive"in De&&t(20,ut=De.interactive),"hoverCursor"in De&&t(21,At=De.hoverCursor),"eventsIfTopMost"in De&&t(22,Nt=De.eventsIfTopMost),"$$scope"in De&&t(35,z=De.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=w4(ze)),r.$$.dirty[0]&1073774592&&t(24,l=b4("all",n,_e)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,u=re??D),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,d=ue??P),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=N||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&S&&k!==B&&a){k&&(Mt(k),gr.delete(k));let De=U;if(!U&&te){let lt=S.getStyle().layers,nt=typeof te=="function"?te:ne=>ne.type===te,xt=lt==null?void 0:lt.find(nt);xt&&(De=xt.id)}Rt(Ut,k=B,k),S.addLayer(nl({id:k,type:le,source:a,"source-layer":G,filter:l,paint:$,layout:J,minzoom:u,maxzoom:d}),De),t(23,ht=!0),S.on("click",k,rr),S.on("dblclick",k,rr),S.on("contextmenu",k,rr),S.on("mouseenter",k,wr),S.on("mousemove",k,mr),S.on("mouseleave",k,Rr)}r.$$.dirty[0]&1048577&&k&&gr.set(k,{interactive:ut}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,_=k?Ky((De,lt)=>{S!=null&&S.style._loaded?S.setPaintProperty(k,De,lt):S==null||S.once("styledata",()=>S==null?void 0:S.setPaintProperty(k,De,lt))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,x=k?Ky((De,lt)=>{S!=null&&S.style._loaded?S.setLayoutProperty(k,De,lt):S==null||S.once("styledata",()=>S==null?void 0:S.setLayoutProperty(k,De,lt))}):void 0),r.$$.dirty[0]&268443648&&(_==null||_($)),r.$$.dirty[0]&134234112&&(x==null||x(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,d)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(ht?t(23,ht=!1):S==null||S.setFilter(k,l))},[k,Jt,Kt,Ut,Vt,wt,Me,B,N,G,U,te,le,$,J,_e,ze,re,ue,He,ut,At,Nt,ht,l,d,u,x,_,a,n,S,C,P,D,z,O]}let Fd=class extends Ht{constructor(e){super(),Zt(this,e,k4,S4,jt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function T4(r){let e;const t=r[16].default,n=Vr(t,r,r[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Gr(n,t,l,l[24],e?qr(t,l[24],u,null):Wr(l[24]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function E4(r){let e,t,n;function l(d){r[17](d)}let u={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[T4]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Fd({props:u}),pn.push(()=>zo(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ve(e.$$.fragment)},m(d,a){Ne(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Po(()=>t=!1)),e.$set(_)},i(d){n||(oe(e.$$.fragment,d),n=!0)},o(d){pe(e.$$.fragment,d),n=!1},d(d){je(e,d)}}}function M4(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Dc("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:O=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:U=!0}=e;function te(ue){N=ue,t(0,N)}function le(ue){ur.call(this,r,ue)}function $(ue){ur.call(this,r,ue)}function J(ue){ur.call(this,r,ue)}function _e(ue){ur.call(this,r,ue)}function ze(ue){ur.call(this,r,ue)}function re(ue){ur.call(this,r,ue)}return r.$$set=ue=>{"id"in ue&&t(1,u=ue.id),"source"in ue&&t(2,d=ue.source),"sourceLayer"in ue&&t(3,a=ue.sourceLayer),"beforeId"in ue&&t(4,_=ue.beforeId),"beforeLayerType"in ue&&t(5,x=ue.beforeLayerType),"paint"in ue&&t(6,k=ue.paint),"layout"in ue&&t(7,S=ue.layout),"filter"in ue&&t(8,C=ue.filter),"applyToClusters"in ue&&t(9,P=ue.applyToClusters),"minzoom"in ue&&t(10,D=ue.minzoom),"maxzoom"in ue&&t(11,O=ue.maxzoom),"hoverCursor"in ue&&t(12,z=ue.hoverCursor),"manageHoverState"in ue&&t(13,B=ue.manageHoverState),"hovered"in ue&&t(0,N=ue.hovered),"eventsIfTopMost"in ue&&t(14,G=ue.eventsIfTopMost),"interactive"in ue&&t(15,U=ue.interactive),"$$scope"in ue&&t(24,l=ue.$$scope)},[N,u,d,a,_,x,k,S,C,P,D,O,z,B,G,U,n,te,le,$,J,_e,ze,re,l]}let zg=class extends Ht{constructor(e){super(),Zt(this,e,M4,E4,jt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function C4(r){let e;const t=r[15].default,n=Vr(t,r,r[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Gr(n,t,l,l[23],e?qr(t,l[23],u,null):Wr(l[23]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function I4(r){let e,t,n;function l(d){r[16](d)}let u={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[C4]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Fd({props:u}),pn.push(()=>zo(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ve(e.$$.fragment)},m(d,a){Ne(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Po(()=>t=!1)),e.$set(_)},i(d){n||(oe(e.$$.fragment,d),n=!0)},o(d){pe(e.$$.fragment,d),n=!1},d(d){je(e,d)}}}function A4(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Dc("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:O=void 0}=e,{manageHoverState:z=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:G=!0}=e;function U(re){B=re,t(0,B)}function te(re){ur.call(this,r,re)}function le(re){ur.call(this,r,re)}function $(re){ur.call(this,r,re)}function J(re){ur.call(this,r,re)}function _e(re){ur.call(this,r,re)}function ze(re){ur.call(this,r,re)}return r.$$set=re=>{"id"in re&&t(1,u=re.id),"source"in re&&t(2,d=re.source),"sourceLayer"in re&&t(3,a=re.sourceLayer),"beforeId"in re&&t(4,_=re.beforeId),"beforeLayerType"in re&&t(5,x=re.beforeLayerType),"paint"in re&&t(6,k=re.paint),"layout"in re&&t(7,S=re.layout),"filter"in re&&t(8,C=re.filter),"minzoom"in re&&t(9,P=re.minzoom),"maxzoom"in re&&t(10,D=re.maxzoom),"hoverCursor"in re&&t(11,O=re.hoverCursor),"manageHoverState"in re&&t(12,z=re.manageHoverState),"hovered"in re&&t(0,B=re.hovered),"eventsIfTopMost"in re&&t(13,N=re.eventsIfTopMost),"interactive"in re&&t(14,G=re.interactive),"$$scope"in re&&t(23,l=re.$$scope)},[B,u,d,a,_,x,k,S,C,P,D,O,z,N,G,n,U,te,le,$,J,_e,ze,l]}let ma=class extends Ht{constructor(e){super(),Zt(this,e,A4,I4,jt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function L4(r,e,t){let n;const{map:l}=il();yt(r,l,_=>t(4,n=_));let{position:u="top-left"}=e,{container:d=void 0}=e,a=null;return ti(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),r.$$set=_=>{"position"in _&&t(1,u=_.position),"container"in _&&t(2,d=_.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!a){let _;typeof d=="string"?_=document.querySelector(d)??void 0:_=d,t(3,a=new to.FullscreenControl({container:_})),n.addControl(a,u)}},[l,u,d,a,n]}class P4 extends Ht{constructor(e){super(),Zt(this,e,L4,null,jt,{position:1,container:2})}}function z4(r,e,t,n,l){let u=!1;r.getSource(e)&&(u=!0,r.removeSource(e));const d=()=>{n(e)&&(r.addSource(e,t),l())};if(u){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):d())};a()}else d()}function D4(r,e,t){zb().then(()=>{let n=Hi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Qy(r){let e=r[0],t,n,l=e0(r);return{c(){l.c(),t=$n()},m(u,d){l.m(u,d),be(u,t,d),n=!0},p(u,d){d&1&&jt(e,e=u[0])?(vr(),pe(l,1,1,It),br(),l=e0(u),l.c(),oe(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(oe(l),n=!0)},o(u){pe(l),n=!1},d(u){u&&ve(t),l.d(u)}}}function e0(r){let e;const t=r[19].default,n=Vr(t,r,r[18],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&262144)&&Gr(n,t,l,l[18],e?qr(t,l[18],u,null):Wr(l[18]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function R4(r){let e,t,n=r[0]&&Qy(r);return{c(){n&&n.c(),e=$n()},m(l,u){n&&n.m(l,u),be(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=Qy(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){pe(n),t=!1},d(l){l&&ve(e),n&&n.d(l)}}}function B4(r,e,t){let n,l,u,{$$slots:d={},$$scope:a}=e,{id:_=Dc("geojson")}=e,{data:x}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:C=void 0}=e,{lineMetrics:P=void 0}=e,{cluster:D=void 0}=e,{maxzoom:O=void 0}=e,{attribution:z=void 0}=e,{buffer:B=void 0}=e,{tolerance:N=void 0}=e;const{map:G,cluster:U,self:te}=m4();yt(r,G,J=>t(17,l=J)),yt(r,U,J=>t(20,u=J)),yt(r,te,J=>t(0,n=J));let le,$=!0;return ti(()=>{n&&le&&l&&(D4(G,n,le),Rt(te,n=null,n),t(15,le=void 0))}),r.$$set=J=>{"id"in J&&t(4,_=J.id),"data"in J&&t(5,x=J.data),"generateId"in J&&t(6,k=J.generateId),"promoteId"in J&&t(7,S=J.promoteId),"filter"in J&&t(8,C=J.filter),"lineMetrics"in J&&t(9,P=J.lineMetrics),"cluster"in J&&t(10,D=J.cluster),"maxzoom"in J&&t(11,O=J.maxzoom),"attribution"in J&&t(12,z=J.attribution),"buffer"in J&&t(13,B=J.buffer),"tolerance"in J&&t(14,N=J.tolerance),"$$scope"in J&&t(18,a=J.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Rt(U,u=D,u),r.$$.dirty&196593&&l&&n!==_&&(Rt(te,n=_,n),z4(l,n,nl({type:"geojson",data:x,filter:C,lineMetrics:P,generateId:k,promoteId:S,cluster:!!D,clusterMinPoints:D==null?void 0:D.minPoints,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius,clusterProperties:D==null?void 0:D.properties,maxzoom:O,attribution:z,buffer:B,tolerance:N}),J=>l&&J===n,()=>{n&&(t(15,le=l==null?void 0:l.getSource(n)),t(16,$=!0))})),r.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,le=l==null?void 0:l.getSource(_))})),r.$$.dirty&98336&&le&&($?t(16,$=!1):le.setData(x)),r.$$.dirty&33792&&(le==null||le.setClusterOptions(nl({cluster:!!D,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius})))},[n,G,U,te,_,x,k,S,C,P,D,O,z,B,N,le,$,l,a,d]}let Pi=class extends Ht{constructor(e){super(),Zt(this,e,B4,R4,jt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function F4(r,e,t){let n;const{map:l}=il();yt(r,l,C=>t(8,n=C));let{position:u="top-left"}=e,{positionOptions:d=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:x=!0}=e,{showUserLocation:k=!0}=e,{control:S=null}=e;return ti(()=>{n!=null&&n.loaded()&&S&&n.removeControl(S)}),r.$$set=C=>{"position"in C&&t(2,u=C.position),"positionOptions"in C&&t(3,d=C.positionOptions),"fitBoundsOptions"in C&&t(4,a=C.fitBoundsOptions),"trackUserLocation"in C&&t(5,_=C.trackUserLocation),"showAccuracyCircle"in C&&t(6,x=C.showAccuracyCircle),"showUserLocation"in C&&t(7,k=C.showUserLocation),"control"in C&&t(1,S=C.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!S&&(t(1,S=new to.GeolocateControl({positionOptions:d,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:x,showUserLocation:k})),n.addControl(S,u))},[l,S,u,d,a,_,x,k,n]}class O4 extends Ht{constructor(e){super(),Zt(this,e,F4,null,jt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function N4(r){let e;const t=r[15].default,n=Vr(t,r,r[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Gr(n,t,l,l[23],e?qr(t,l[23],u,null):Wr(l[23]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function j4(r){let e,t,n;function l(d){r[16](d)}let u={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[N4]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Fd({props:u}),pn.push(()=>zo(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ve(e.$$.fragment)},m(d,a){Ne(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Po(()=>t=!1)),e.$set(_)},i(d){n||(oe(e.$$.fragment,d),n=!0)},o(d){pe(e.$$.fragment,d),n=!1},d(d){je(e,d)}}}function U4(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Dc("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:O=void 0}=e,{manageHoverState:z=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:G=!0}=e;function U(re){B=re,t(0,B)}function te(re){ur.call(this,r,re)}function le(re){ur.call(this,r,re)}function $(re){ur.call(this,r,re)}function J(re){ur.call(this,r,re)}function _e(re){ur.call(this,r,re)}function ze(re){ur.call(this,r,re)}return r.$$set=re=>{"id"in re&&t(1,u=re.id),"source"in re&&t(2,d=re.source),"sourceLayer"in re&&t(3,a=re.sourceLayer),"beforeId"in re&&t(4,_=re.beforeId),"beforeLayerType"in re&&t(5,x=re.beforeLayerType),"paint"in re&&t(6,k=re.paint),"layout"in re&&t(7,S=re.layout),"filter"in re&&t(8,C=re.filter),"minzoom"in re&&t(9,P=re.minzoom),"maxzoom"in re&&t(10,D=re.maxzoom),"hoverCursor"in re&&t(11,O=re.hoverCursor),"manageHoverState"in re&&t(12,z=re.manageHoverState),"hovered"in re&&t(0,B=re.hovered),"eventsIfTopMost"in re&&t(13,N=re.eventsIfTopMost),"interactive"in re&&t(14,G=re.interactive),"$$scope"in re&&t(23,l=re.$$scope)},[B,u,d,a,_,x,k,S,C,P,D,O,z,N,G,n,U,te,le,$,J,_e,ze,l]}let cs=class extends Ht{constructor(e){super(),Zt(this,e,U4,j4,jt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function V4(r,e,t){let n;const l=us();let{layer:u=void 0}=e;const{map:d}=il();yt(r,d,k=>t(2,n=k));function a(k){l(k.type,{...k,map:d})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],x=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ti(()=>{if(n)if(u)for(const k of _)n.off(k,u,a);else for(const k of x)n.off(k,a)}),r.$$set=k=>{"layer"in k&&t(1,u=k.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(u)for(const k of _)n.on(k,u,a);else for(const k of x)n.on(k,a)},[d,u,n]}class q4 extends Ht{constructor(e){super(),Zt(this,e,V4,null,jt,{layer:1})}}function G4(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,n),u=Math.round(e.lat*l)/l,d=Math.round(e.lng*l)/l,a=`${t}/${u}/${d}`,_=r.getBearing(),x=r.getPitch();return(_||x)&&(a+=`/${Math.round(_*10)/10}`),x&&(a+=`/${Math.round(x)}`),`#${a}`}function W4(r){return r.replace("#","").split("/").map(parseFloat)}var ac=Dg;function Dg(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?t0(r,e):{}.toString.call(r)=="[object Set]"?t0(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?H4(r,e):Z4(r,e)}function Z4(r,e){return r.toString()===e.toString()}function t0(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Dg(r[n],e[n]))return!1;return!0}function H4(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var l=0;l<n;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&Dg(r[u],e[u])))return!1}return!0}function $4(r,e,t){let n;const{map:l}=il();yt(r,l,k=>t(6,n=k));let{position:u="top-left"}=e,{showCompass:d=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,x=null;return ti(()=>{n!=null&&n.loaded()&&x&&n.removeControl(x)}),r.$$set=k=>{"position"in k&&t(1,u=k.position),"showCompass"in k&&t(2,d=k.showCompass),"showZoom"in k&&t(3,a=k.showZoom),"visualizePitch"in k&&t(4,_=k.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!x&&(t(5,x=new to.NavigationControl({showCompass:d,showZoom:a,visualizePitch:_})),n.addControl(x,u))},[l,u,d,a,_,x,n]}class X4 extends Ht{constructor(e){super(),Zt(this,e,$4,null,jt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function K4(r,e,t){let n;const{map:l}=il();yt(r,l,x=>t(5,n=x));let{position:u="bottom-left"}=e,{maxWidth:d=void 0}=e,{unit:a="metric"}=e,_=null;return ti(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),r.$$set=x=>{"position"in x&&t(1,u=x.position),"maxWidth"in x&&t(2,d=x.maxWidth),"unit"in x&&t(3,a=x.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!_&&(t(4,_=new to.ScaleControl({maxWidth:d,unit:a})),n.addControl(_,u))},[l,u,d,a,_,n]}class J4 extends Ht{constructor(e){super(),Zt(this,e,K4,null,jt,{position:1,maxWidth:2,unit:3})}}const{window:Y4}=Ld,Q4=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),r0=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function n0(r){let e,t,n=r[3]&&i0(r);const l=r[46].default,u=Vr(l,r,r[45],r0);return{c(){n&&n.c(),e=Ue(),u&&u.c()},m(d,a){n&&n.m(d,a),be(d,e,a),u&&u.m(d,a),t=!0},p(d,a){d[3]?n?(n.p(d,a),a[0]&8&&oe(n,1)):(n=i0(d),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&Gr(u,l,d,d[45],t?qr(l,d[45],a,Q4):Wr(d[45]),r0)},i(d){t||(oe(n),oe(u,d),t=!0)},o(d){pe(n),pe(u,d),t=!1},d(d){d&&ve(e),n&&n.d(d),u&&u.d(d)}}}function i0(r){let e,t,n,l,u,d,a,_;return e=new X4({props:{position:r[7]}}),n=new O4({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),u=new P4({props:{position:r[7]}}),a=new J4({props:{position:r[7]}}),{c(){Ve(e.$$.fragment),t=Ue(),Ve(n.$$.fragment),l=Ue(),Ve(u.$$.fragment),d=Ue(),Ve(a.$$.fragment)},m(x,k){Ne(e,x,k),be(x,t,k),Ne(n,x,k),be(x,l,k),Ne(u,x,k),be(x,d,k),Ne(a,x,k),_=!0},p(x,k){const S={};k[0]&128&&(S.position=x[7]),e.$set(S);const C={};k[0]&128&&(C.position=x[7]),n.$set(C);const P={};k[0]&128&&(P.position=x[7]),u.$set(P);const D={};k[0]&128&&(D.position=x[7]),a.$set(D)},i(x){_||(oe(e.$$.fragment,x),oe(n.$$.fragment,x),oe(u.$$.fragment,x),oe(a.$$.fragment,x),_=!0)},o(x){pe(e.$$.fragment,x),pe(n.$$.fragment,x),pe(u.$$.fragment,x),pe(a.$$.fragment,x),_=!1},d(x){x&&(ve(t),ve(l),ve(d)),je(e,x),je(n,x),je(u,x),je(a,x)}}}function e3(r){let e,t,n,l,u,d=r[4]&&r[0]&&n0(r);return{c(){e=de("div"),d&&d.c(),Ee(e,"class",t=sd(r[2])+" svelte-p00lfq"),Ee(e,"data-testid","map-container"),hi(e,"expand-map",!r[2])},m(a,_){be(a,e,_),d&&d.m(e,null),r[47](e),n=!0,l||(u=[Et(Y4,"hashchange",r[11]),Cm(r[10].call(null,e))],l=!0)},p(a,_){a[4]&&a[0]?d?(d.p(a,_),_[0]&17&&oe(d,1)):(d=n0(a),d.c(),oe(d,1),d.m(e,null)):d&&(vr(),pe(d,1,1,()=>{d=null}),br()),(!n||_[0]&4&&t!==(t=sd(a[2])+" svelte-p00lfq"))&&Ee(e,"class",t),(!n||_[0]&4)&&hi(e,"expand-map",!a[2])},i(a){n||(oe(d),n=!0)},o(a){pe(d),n=!1},d(a){a&&ve(e),d&&d.d(),r[47](null),l=!1,_n(u)}}}function t3(r,e,t){let n,l,u,d,{$$slots:a={},$$scope:_}=e,{map:x=null}=e,{mapContainer:k=void 0}=e,{class:S=void 0}=e,{style:C}=e,{diffStyleUpdates:P=!1}=e,{center:D=void 0}=e,{zoom:O=void 0}=e,{pitch:z=0}=e,{bearing:B=0}=e,{bounds:N=void 0}=e,{hash:G=!1}=e,{updateHash:U=Be=>{window.history.replaceState(window.history.state,"",Be)}}=e,{loaded:te=!1}=e,{minZoom:le=0}=e,{maxZoom:$=22}=e,{minPitch:J=0}=e,{maxPitch:_e=60}=e,{renderWorldCopies:ze=void 0}=e,{dragPan:re=void 0}=e,{dragRotate:ue=void 0}=e,{pitchWithRotate:He=void 0}=e,{antialias:Me=void 0}=e,{zoomOnDoubleClick:ut=!0}=e,{locale:At=void 0}=e,{interactive:Nt=!0}=e,{attributionControl:Je=!0}=e,{cooperativeGestures:Jt=!1}=e,{preserveDrawingBuffer:Kt=!1}=e,{maxBounds:Ut=void 0}=e,{images:Vt=[]}=e,{standardControls:wt=!1}=e,{filterLayers:Yt=void 0}=e,{transformRequest:gr=void 0}=e;const Pt=us(),{map:rr,loadedImages:wr}=p4();yt(r,rr,Be=>t(4,u=Be)),yt(r,wr,Be=>t(5,d=Be));let mr=new Set;async function Rr(Be,Ze=!1){if(u&&!(!u.loaded()&&!Ze))if("url"in Be){mr.add(Be.id);try{let bt=await u.loadImage(Be.url);u==null||u.addImage(Be.id,bt.data,Be.options),d.add(Be.id),wr.set(d)}catch(bt){Pt("error",bt)}finally{mr.delete(Be.id)}}else u.addImage(Be.id,Be.data,Be.options),d.add(Be.id),wr.set(d)}let ht,Mt,De,lt;function nt(Be){return ne(),Rt(rr,u=new to.Map(nl({container:Be,style:C,locale:At,center:D,zoom:O,pitch:z,bearing:B,minZoom:le,maxZoom:$,minPitch:J,maxPitch:_e,renderWorldCopies:ze,dragPan:re,dragRotate:ue,pitchWithRotate:He,antialias:Me,interactive:Nt,preserveDrawingBuffer:Kt,maxBounds:Ut,bounds:N,attributionControl:Je,transformRequest:gr,cooperativeGestures:Jt})),u),u.on("load",Ze=>{Ze.target.getContainer().setAttribute("data-testid","map"),Ze.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,te=!0),Pt("load",u)}),u.on("error",Ze=>Pt("error",{...Ze,map:u})),u.on("movestart",Ze=>Pt("movestart",{...Ze,map:u})),u.on("moveend",Ze=>{if(t(12,D=Ze.target.getCenter()),t(13,O=Ze.target.getZoom()),t(14,z=Ze.target.getPitch()),t(15,B=Ze.target.getBearing()),t(16,N=Ze.target.getBounds()),Pt("moveend",{...Ze,map:u}),G){let bt=new URL(window.location.href.replace(/(#.+)?$/,G4(u)));U(bt)}}),u.on("click",Ze=>Pt("click",{...Ze,map:u})),u.on("dblclick",Ze=>Pt("dblclick",{...Ze,map:u})),u.on("contextmenu",Ze=>Pt("contextmenu",{...Ze,map:u})),u.on("zoomstart",Ze=>Pt("zoomstart",{...Ze,map:u})),u.on("zoom",Ze=>{Pt("zoom",{...Ze,map:u})}),u.on("zoomend",Ze=>{Pt("zoomend",{...Ze,map:u})}),u.on("style.load",()=>{if(u){const Ze=u.getStyle();if(t(42,ht=Ze.layers.map(bt=>bt.id)),t(43,Mt=Object.keys(Ze.sources)),lt)for(const[bt,bn]of Object.entries(lt))u.addSource(bt,bn);if(De)for(const bt of De)u.addLayer(bt);for(const bt of Vt)Rr(bt,!0)}}),u.on("styledata",Ze=>{if(u&&Yt){const bt=u.getStyle().layers;if(bt)for(let bn of bt)Yt(bn)||u.setLayoutProperty(bn.id,"visibility","none")}Pt("styledata",{...Ze,map:u})}),{destroy(){t(0,te=!1),u==null||u.remove(),Rt(rr,u=null,u)}}}let xt=C;function ne(){if(G){let Be=W4(window.location.hash);Be.length>=3&&(t(13,O=Be[0]),t(12,D=[Be[2],Be[1]])),Be.length==5&&(t(15,B=Be[3]),t(14,z=Be[4]))}}function nr(Be){pn[Be?"unshift":"push"](()=>{k=Be,t(1,k)})}return r.$$set=Be=>{"map"in Be&&t(17,x=Be.map),"mapContainer"in Be&&t(1,k=Be.mapContainer),"class"in Be&&t(2,S=Be.class),"style"in Be&&t(18,C=Be.style),"diffStyleUpdates"in Be&&t(19,P=Be.diffStyleUpdates),"center"in Be&&t(12,D=Be.center),"zoom"in Be&&t(13,O=Be.zoom),"pitch"in Be&&t(14,z=Be.pitch),"bearing"in Be&&t(15,B=Be.bearing),"bounds"in Be&&t(16,N=Be.bounds),"hash"in Be&&t(20,G=Be.hash),"updateHash"in Be&&t(21,U=Be.updateHash),"loaded"in Be&&t(0,te=Be.loaded),"minZoom"in Be&&t(22,le=Be.minZoom),"maxZoom"in Be&&t(23,$=Be.maxZoom),"minPitch"in Be&&t(24,J=Be.minPitch),"maxPitch"in Be&&t(25,_e=Be.maxPitch),"renderWorldCopies"in Be&&t(26,ze=Be.renderWorldCopies),"dragPan"in Be&&t(27,re=Be.dragPan),"dragRotate"in Be&&t(28,ue=Be.dragRotate),"pitchWithRotate"in Be&&t(29,He=Be.pitchWithRotate),"antialias"in Be&&t(30,Me=Be.antialias),"zoomOnDoubleClick"in Be&&t(31,ut=Be.zoomOnDoubleClick),"locale"in Be&&t(32,At=Be.locale),"interactive"in Be&&t(33,Nt=Be.interactive),"attributionControl"in Be&&t(34,Je=Be.attributionControl),"cooperativeGestures"in Be&&t(35,Jt=Be.cooperativeGestures),"preserveDrawingBuffer"in Be&&t(36,Kt=Be.preserveDrawingBuffer),"maxBounds"in Be&&t(37,Ut=Be.maxBounds),"images"in Be&&t(38,Vt=Be.images),"standardControls"in Be&&t(3,wt=Be.standardControls),"filterLayers"in Be&&t(39,Yt=Be.filterLayers),"transformRequest"in Be&&t(40,gr=Be.transformRequest),"$$scope"in Be&&t(45,_=Be.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof wt=="boolean"?void 0:wt),r.$$.dirty[0]&16&&t(17,x=u),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&u&&!ac(C,xt)){const Be=u.getStyle();if(ht&&(De=Be.layers.filter(Ze=>!ht.includes(Ze.id))),Mt){const Ze=Object.keys(Be.sources).filter(bt=>!Mt.includes(bt));lt={};for(const bt of Ze)lt[bt]=Be.sources[bt]}t(44,xt=C),u.setStyle(C,{diff:P}),Rt(wr,d=new Set,d),t(41,mr=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&te&&u!=null&&u.loaded())for(let Be of Vt)!d.has(Be.id)&&!mr.has(Be.id)&&!u.hasImage(Be.id)&&Rr(Be);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,l=Vt.every(Be=>d.has(Be.id))),r.$$.dirty[0]&61456&&u){let Be={};D!=null&&!ac(D,u==null?void 0:u.getCenter())&&(Be.center=D),O!=null&&!ac(O,u==null?void 0:u.getZoom())&&(Be.zoom=O),B!=null&&!ac(B,u==null?void 0:u.getBearing())&&(Be.bearing=B),z!=null&&!ac(z,u==null?void 0:u.getPitch())&&(Be.pitch=z),Object.keys(Be).length&&u.easeTo(Be)}r.$$.dirty[0]&65552&&N&&!ac(N,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(N)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(ut?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[te,k,S,wt,u,d,l,n,rr,wr,nt,ne,D,O,z,B,N,x,C,P,G,U,le,$,J,_e,ze,re,ue,He,Me,ut,At,Nt,Je,Jt,Kt,Ut,Vt,Yt,gr,mr,ht,Mt,xt,_,a,nr]}class r3 extends Ht{constructor(e){super(),Zt(this,e,t3,e3,jt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const n3=r=>({marker:r&8}),o0=r=>({marker:r[3]});function i3(r){let e,t,n,l,u,d,a;const _=r[19].default,x=Vr(_,r,r[18],o0);return{c(){e=de("div"),x&&x.c(),Ee(e,"tabindex",t=r[1]?0:void 0),Ee(e,"role",n=r[1]?"button":void 0),fn(e,"z-index",r[2])},m(k,S){be(k,e,S),x&&x.m(e,null),u=!0,d||(a=[Cm(r[7].call(null,e)),Cm(l=o3.call(null,e,r[0])),Et(e,"click",Jp(r[20])),Et(e,"dblclick",Jp(r[21])),Et(e,"contextmenu",Jp(wg(r[22]))),Et(e,"mouseenter",r[23]),Et(e,"mouseleave",r[24]),Et(e,"mousemove",r[25]),Et(e,"keydown",r[8])],d=!0)},p(k,[S]){x&&x.p&&(!u||S&262152)&&Gr(x,_,k,k[18],u?qr(_,k[18],S,n3):Wr(k[18]),o0),(!u||S&2&&t!==(t=k[1]?0:void 0))&&Ee(e,"tabindex",t),(!u||S&2&&n!==(n=k[1]?"button":void 0))&&Ee(e,"role",n),l&&xc(l.update)&&S&1&&l.update.call(null,k[0]),S&4&&fn(e,"z-index",k[2])},i(k){u||(oe(x,k),u=!0)},o(k){pe(x,k),u=!1},d(k){k&&ve(e),x&&x.d(k),d=!1,_n(a)}}}function o3(r,e){const t=r.className;function n(l){l?r.className=`${t} ${l}`:r.className=t}return n(e),{update:n}}function s3(r,e,t){let n,l,u,{$$slots:d={},$$scope:a}=e,{marker:_=void 0}=e,{lngLat:x}=e,{class:k=void 0}=e,{interactive:S=!0}=e,{asButton:C=!1}=e,{draggable:P=!1}=e,{feature:D=null}=e,{offset:O=void 0}=e,{zIndex:z=void 0}=e,{rotation:B=0}=e,{opacity:N=1}=e;const G=us(),{map:U,layerEvent:te,self:le,markerClickManager:$}=_4();yt(r,U,Je=>t(27,u=Je)),yt(r,te,Je=>t(26,n=Je)),yt(r,le,Je=>t(3,l=Je));function J(Je){Rt(le,l=new to.Marker({element:Je,rotation:B,draggable:P,offset:O,opacity:N.toString()}).setLngLat(x).addTo(u),l),t(11,_=l);const Jt=()=>re("dragstart"),Kt=()=>{_e(),re("drag")},Ut=()=>{_e(),re("dragend")};return P&&(l.on("dragstart",Jt),l.on("drag",Kt),l.on("dragend",Ut)),{destroy(){P&&(l==null||l.off("dragstart",Jt),l==null||l.off("drag",Kt),l==null||l.off("dragend",Ut)),t(11,_=void 0),l==null||l.remove()}}}function _e(){let Je=l==null?void 0:l.getLngLat();Je&&(Array.isArray(x)?t(10,x=[Je.lng,Je.lat]):x&&"lon"in x?t(10,x={lon:Je.lng,lat:Je.lat}):t(10,x=Je))}function ze(Je){Je.key===" "&&(Je.preventDefault(),Je.stopPropagation(),re("click"))}function re(Je){if(!S)return;let Jt=l==null?void 0:l.getLngLat();if(!Jt)return;const Kt=[Jt.lng,Jt.lat];let Ut={map:u,marker:l,lngLat:Kt,features:[{type:"Feature",properties:(D==null?void 0:D.properties)??{},geometry:{type:"Point",coordinates:Kt}}]};(Je==="click"||Je==="contextmenu")&&$.handleClick(Ut),Rt(te,n={...Ut,layerType:"marker",type:Je},n),G(Je,Ut)}const ue=()=>re("click"),He=()=>re("dblclick"),Me=()=>{re("contextmenu")},ut=()=>{re("mouseenter")},At=()=>{re("mouseleave")},Nt=()=>re("mousemove");return r.$$set=Je=>{"marker"in Je&&t(11,_=Je.marker),"lngLat"in Je&&t(10,x=Je.lngLat),"class"in Je&&t(0,k=Je.class),"interactive"in Je&&t(12,S=Je.interactive),"asButton"in Je&&t(1,C=Je.asButton),"draggable"in Je&&t(13,P=Je.draggable),"feature"in Je&&t(14,D=Je.feature),"offset"in Je&&t(15,O=Je.offset),"zIndex"in Je&&t(2,z=Je.zIndex),"rotation"in Je&&t(16,B=Je.rotation),"opacity"in Je&&t(17,N=Je.opacity),"$$scope"in Je&&t(18,a=Je.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(l==null||l.setLngLat(x)),r.$$.dirty&32776&&(l==null||l.setOffset(O??[0,0])),r.$$.dirty&65544&&(l==null||l.setRotation(B)),r.$$.dirty&131080&&(l==null||l.setOpacity(N.toString()))},[k,C,z,l,U,te,le,J,ze,re,x,_,S,P,D,O,B,N,a,d,ue,He,Me,ut,At,Nt]}class dd extends Ht{constructor(e){super(),Zt(this,e,s3,i3,jt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const a3=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),s0=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function a0(r){var l;let e,t,n=(((l=r[4])==null?void 0:l.length)||r[3]instanceof to.Marker)&&l0(r);return{c(){e=de("div"),n&&n.c()},m(u,d){be(u,e,d),n&&n.m(e,null),r[32](e),t=!0},p(u,d){var a;(a=u[4])!=null&&a.length||u[3]instanceof to.Marker?n?(n.p(u,d),d[0]&24&&oe(n,1)):(n=l0(u),n.c(),oe(n,1),n.m(e,null)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(u){t||(oe(n),t=!0)},o(u){pe(n),t=!1},d(u){u&&ve(e),n&&n.d(),r[32](null)}}}function l0(r){let e;const t=r[30].default,n=Vr(t,r,r[29],s0);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[0]&536870933)&&Gr(n,t,l,l[29],e?qr(t,l[29],u,a3):Wr(l[29]),s0)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function l3(r){let e,t,n=r[9].default&&a0(r);return{c(){n&&n.c(),e=$n()},m(l,u){n&&n.m(l,u),be(l,e,u),t=!0},p(l,u){l[9].default?n?(n.p(l,u),u[0]&512&&oe(n,1)):(n=a0(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){pe(n),t=!1},d(l){l&&ve(e),n&&n.d(l)}}}function c3(r,e,t){let n,l,u,d,a,_,{$$slots:x={},$$scope:k}=e;const S=NS(x);let{closeButton:C=void 0}=e,{closeOnClickOutside:P=!0}=e,{closeOnClickInside:D=!1}=e,{closeOnMove:O=!1}=e,{openOn:z="click"}=e,{openIfTopMost:B=!0}=e,{focusAfterOpen:N=!0}=e,{anchor:G=void 0}=e,{offset:U=void 0}=e,{popupClass:te=void 0}=e,{maxWidth:le=void 0}=e,{lngLat:$=void 0}=e,{html:J=void 0}=e,{open:_e=!1}=e;const ze=us(),{map:re,popupTarget:ue,layerEvent:He,layer:Me,eventTopMost:ut,markerClickManager:At}=il();yt(r,re,ne=>t(2,u=ne)),yt(r,ue,ne=>t(3,a=ne)),yt(r,He,ne=>t(28,d=ne)),yt(r,Me,ne=>t(35,_=ne));const Nt=["click","dblclick","contextmenu"];let Je,Jt=!1,Kt;function Ut(){if(!Je)return;let ne=Je.getElement();!ne||ne===Kt||(Kt=ne,z==="hover"&&(Kt.style.pointerEvents="none"),Kt.addEventListener("mouseenter",()=>{t(24,Jt=!0)},{passive:!0}),Kt.addEventListener("mouseleave",()=>{t(24,Jt=!1)},{passive:!0}),Kt.addEventListener("click",()=>{D&&t(0,_e=!1)},{passive:!0}))}Pd(()=>{if(u)return u.on("click",Mt),u.on("contextmenu",Mt),At.add(De),typeof a=="string"&&(u.on("click",a,Pt),u.on("dblclick",a,Pt),u.on("contextmenu",a,Pt),u.on("mousemove",a,ht),u.on("mouseleave",a,Rr),u.on("touchstart",a,wr),u.on("touchend",a,mr)),()=>{u!=null&&u.loaded()&&(Je==null||Je.remove(),u.off("click",Mt),u.off("contextmenu",Mt),At.remove(De),a instanceof to.Marker?a.getPopup()===Je&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,Pt),u.off("dblclick",a,Pt),u.off("contextmenu",a,Pt),u.off("mousemove",a,ht),u.off("mouseleave",a,Rr),u.off("touchstart",a,wr),u.off("touchend",a,mr)))}});function Vt(ne){return B?!("marker"in ne)&&!y4(ne)&&ut(ne)!==_:!1}let wt=null,Yt="normal";function gr(ne){"layerType"in ne&&ne.layerType==="deckgl"?(t(10,$=ne.coordinate),t(4,wt=ne.object?[ne.object]:null)):(t(10,$=ne.lngLat),t(4,wt=ne.features??[]))}function Pt(ne){ne.type!==z||Vt(ne)||(gr(ne),setTimeout(()=>t(0,_e=!0)))}let rr=null;function wr(ne){rr=ne.point}function mr(ne){if(!rr||z!=="hover")return;let nr=rr.dist(ne.point);rr=null,nr<3&&(t(10,$=ne.lngLat),t(4,wt=ne.features??[]),Je.isOpen()?t(25,Yt="justOpened"):(t(25,Yt="opening"),t(0,_e=!0)))}function Rr(ne){z!=="hover"||rr||Yt!=="normal"||(t(0,_e=!1),t(4,wt=null))}function ht(ne){if(!(z!=="hover"||rr||Yt!=="normal")){if(Vt(ne)){t(0,_e=!1),t(4,wt=null);return}t(0,_e=!0),t(4,wt=ne.features??[]),t(10,$=ne.lngLat)}}function Mt(ne){if(Yt==="justOpened"){t(25,Yt="normal");return}if(!P)return;let nr=[Kt,a instanceof to.Marker?a==null?void 0:a.getElement():null];_e&&Je.isOpen()&&!nr.some(Be=>Be==null?void 0:Be.contains(ne.originalEvent.target))&&(ne.type==="contextmenu"&&z==="contextmenu"||ne.type!=="contextmenu")&&t(0,_e=!1)}function De(ne){P&&_e&&Je.isOpen()&&ne.marker!==a&&t(0,_e=!1)}ti(()=>{u&&(Je!=null&&Je.isOpen())&&Je.remove()});let lt;const nt=()=>t(0,_e=!1);function xt(ne){pn[ne?"unshift":"push"](()=>{lt=ne,t(1,lt)})}return r.$$set=ne=>{"closeButton"in ne&&t(11,C=ne.closeButton),"closeOnClickOutside"in ne&&t(12,P=ne.closeOnClickOutside),"closeOnClickInside"in ne&&t(13,D=ne.closeOnClickInside),"closeOnMove"in ne&&t(14,O=ne.closeOnMove),"openOn"in ne&&t(15,z=ne.openOn),"openIfTopMost"in ne&&t(16,B=ne.openIfTopMost),"focusAfterOpen"in ne&&t(17,N=ne.focusAfterOpen),"anchor"in ne&&t(18,G=ne.anchor),"offset"in ne&&t(19,U=ne.offset),"popupClass"in ne&&t(20,te=ne.popupClass),"maxWidth"in ne&&t(21,le=ne.maxWidth),"lngLat"in ne&&t(10,$=ne.lngLat),"html"in ne&&t(22,J=ne.html),"open"in ne&&t(0,_e=ne.open),"$$scope"in ne&&t(29,k=ne.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=C??(!P&&!D)),r.$$.dirty[0]&146685952&&(Je||(t(23,Je=new to.Popup({closeButton:n,closeOnClick:!1,closeOnMove:O,focusAfterOpen:N,maxWidth:le,className:te,anchor:G,offset:U})),Kt=Je.getElement(),Je.on("open",()=>{t(0,_e=!0),Ut(),ze("open",Je)}),Je.on("close",()=>{t(0,_e=!1),ze("close",Je)}),Je.on("hover",()=>{ze("hover",Je)}))),r.$$.dirty[0]&8421384&&Je&&a instanceof to.Marker&&(z==="click"?a.setPopup(Je):a.getPopup()===Je&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&Nt.includes(z)&&(d==null?void 0:d.type)===z&&(Pt(d),Rt(He,d=null,d)),r.$$.dirty[0]&268468224&&t(26,l=z==="hover"&&((d==null?void 0:d.type)==="mousemove"||(d==null?void 0:d.type)==="mouseenter")),r.$$.dirty[0]&352354304&&z==="hover"&&He&&(l&&d&&gr(d),t(0,_e=(l||Jt)??!1)),r.$$.dirty[0]&12582914&&(lt?Je.setDOMContent(lt):J&&Je.setHTML(J)),r.$$.dirty[0]&8389632&&$&&Je.setLngLat($),r.$$.dirty[0]&41943045&&u){let ne=Je.isOpen();_e&&!ne?(Je.addTo(u),Yt==="opening"&&t(25,Yt="justOpened")):!_e&&ne&&Je.remove()}},[_e,lt,u,a,wt,re,ue,He,Me,S,$,C,P,D,O,z,B,N,G,U,te,le,J,Je,Jt,Yt,l,n,d,k,x,nt,xt]}class u3 extends Ht{constructor(e){super(),Zt(this,e,c3,l3,jt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var Th=Uint8Array,nw=Uint16Array,h3=Int32Array,f3=new Th([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),d3=new Th([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),iw=function(r,e){for(var t=new nw(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var l=new h3(t[30]),n=1;n<30;++n)for(var u=t[n];u<t[n+1];++u)l[u]=u-t[n]<<5|n;return{b:t,r:l}},ow=iw(f3,2),p3=ow.b,m3=ow.r;p3[28]=258,m3[258]=28;iw(d3,0);var g3=new nw(32768);for(Fr=0;Fr<32768;++Fr)Ms=(Fr&43690)>>1|(Fr&21845)<<1,Ms=(Ms&52428)>>2|(Ms&13107)<<2,Ms=(Ms&61680)>>4|(Ms&3855)<<4,g3[Fr]=((Ms&65280)>>8|(Ms&255)<<8)>>1;var Ms,Fr,Od=new Th(288);for(Fr=0;Fr<144;++Fr)Od[Fr]=8;var Fr;for(Fr=144;Fr<256;++Fr)Od[Fr]=9;var Fr;for(Fr=256;Fr<280;++Fr)Od[Fr]=7;var Fr;for(Fr=280;Fr<288;++Fr)Od[Fr]=8;var Fr,_3=new Th(32);for(Fr=0;Fr<32;++Fr)_3[Fr]=5;var Fr,y3=new Th(0),v3=typeof TextDecoder<"u"&&new TextDecoder,b3=0;try{v3.decode(y3,{stream:!0}),b3=1}catch{}function w3(r){let e;const t=r[16].default,n=Vr(t,r,r[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Gr(n,t,l,l[24],e?qr(t,l[24],u,null):Wr(l[24]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function x3(r){let e,t,n;function l(d){r[17](d)}let u={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[w3]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new Fd({props:u}),pn.push(()=>zo(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ve(e.$$.fragment)},m(d,a){Ne(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Po(()=>t=!1)),e.$set(_)},i(d){n||(oe(e.$$.fragment,d),n=!0)},o(d){pe(e.$$.fragment,d),n=!1},d(d){je(e,d)}}}function S3(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Dc("symbol")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k=void 0}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:O=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:U=!0}=e;function te(ue){N=ue,t(0,N)}function le(ue){ur.call(this,r,ue)}function $(ue){ur.call(this,r,ue)}function J(ue){ur.call(this,r,ue)}function _e(ue){ur.call(this,r,ue)}function ze(ue){ur.call(this,r,ue)}function re(ue){ur.call(this,r,ue)}return r.$$set=ue=>{"id"in ue&&t(1,u=ue.id),"source"in ue&&t(2,d=ue.source),"sourceLayer"in ue&&t(3,a=ue.sourceLayer),"beforeId"in ue&&t(4,_=ue.beforeId),"beforeLayerType"in ue&&t(5,x=ue.beforeLayerType),"paint"in ue&&t(6,k=ue.paint),"layout"in ue&&t(7,S=ue.layout),"filter"in ue&&t(8,C=ue.filter),"applyToClusters"in ue&&t(9,P=ue.applyToClusters),"minzoom"in ue&&t(10,D=ue.minzoom),"maxzoom"in ue&&t(11,O=ue.maxzoom),"hoverCursor"in ue&&t(12,z=ue.hoverCursor),"manageHoverState"in ue&&t(13,B=ue.manageHoverState),"hovered"in ue&&t(0,N=ue.hovered),"eventsIfTopMost"in ue&&t(14,G=ue.eventsIfTopMost),"interactive"in ue&&t(15,U=ue.interactive),"$$scope"in ue&&t(24,l=ue.$$scope)},[N,u,d,a,_,x,k,S,C,P,D,O,z,B,G,U,n,te,le,$,J,_e,ze,re,l]}class sw extends Ht{constructor(e){super(),Zt(this,e,S3,x3,jt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var k3=Object.defineProperty,aw=r=>{throw TypeError(r)},T3=(r,e,t)=>e in r?k3(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fo=(r,e,t)=>T3(r,typeof e!="symbol"?e+"":e,t),lw=(r,e,t)=>e.has(r)||aw("Cannot "+t),Qn=(r,e,t)=>(lw(r,e,"read from private field"),t?t.call(r):e.get(r)),c0=(r,e,t)=>e.has(r)?aw("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),u0=(r,e,t,n)=>(lw(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function mn(){}function E3(r,e){for(const t in e)r[t]=e[t];return r}function cw(r){return r()}function h0(){return Object.create(null)}function Fs(r){r.forEach(cw)}function uw(r){return typeof r=="function"}function ga(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Ff;function zi(r,e){return r===e?!0:(Ff||(Ff=document.createElement("a")),Ff.href=e,r===Ff.href)}function M3(r){return Object.keys(r).length===0}function C3(r,e,t,n){if(r){const l=hw(r,e,t,n);return r[0](l)}}function hw(r,e,t,n){return r[1]&&n?E3(t.ctx.slice(),r[1](n(e))):t.ctx}function I3(r,e,t,n){if(r[2]&&n){const l=r[2](n(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function A3(r,e,t,n,l,u){if(l){const d=hw(e,t,n,u);r.p(d,l)}}function L3(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function f0(r){return r??""}function Ar(r,e){r.appendChild(e)}function vn(r,e,t){r.insertBefore(e,t||null)}function gn(r){r.parentNode&&r.parentNode.removeChild(r)}function Kr(r){return document.createElement(r)}function Zo(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function fa(r){return document.createTextNode(r)}function po(){return fa(" ")}function P3(){return fa("")}function Zi(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function z3(r){return function(e){return e.preventDefault(),r.call(this,e)}}function it(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function D3(r){return Array.from(r.childNodes)}function mh(r,e){e=""+e,r.data!==e&&(r.data=e)}function d0(r,e){r.value=e??""}function Ao(r,e,t){r.classList.toggle(e,!!t)}function R3(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let gh;function oh(r){gh=r}function fw(){if(!gh)throw new Error("Function called outside component initialization");return gh}function B3(r){fw().$$.on_destroy.push(r)}function F3(){const r=fw();return(e,t,{cancelable:n=!1}={})=>{const l=r.$$.callbacks[e];if(l){const u=R3(e,t,{cancelable:n});return l.slice().forEach(d=>{d.call(r,u)}),!u.defaultPrevented}return!0}}function p0(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const mc=[],jm=[];let bc=[];const m0=[],O3=Promise.resolve();let Um=!1;function N3(){Um||(Um=!0,O3.then(dw))}function Vm(r){bc.push(r)}const rm=new Set;let lc=0;function dw(){if(lc!==0)return;const r=gh;do{try{for(;lc<mc.length;){const e=mc[lc];lc++,oh(e),j3(e.$$)}}catch(e){throw mc.length=0,lc=0,e}for(oh(null),mc.length=0,lc=0;jm.length;)jm.pop()();for(let e=0;e<bc.length;e+=1){const t=bc[e];rm.has(t)||(rm.add(t),t())}bc.length=0}while(mc.length);for(;m0.length;)m0.pop()();Um=!1,rm.clear(),oh(r)}function j3(r){if(r.fragment!==null){r.update(),Fs(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(Vm)}}function U3(r){const e=[],t=[];bc.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),bc=e}const Zf=new Set;let Ya;function Hf(){Ya={r:0,c:[],p:Ya}}function $f(){Ya.r||Fs(Ya.c),Ya=Ya.p}function Zn(r,e){r&&r.i&&(Zf.delete(r),r.i(e))}function ui(r,e,t,n){if(r&&r.o){if(Zf.has(r))return;Zf.add(r),Ya.c.push(()=>{Zf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function g0(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function V3(r,e){ui(r,1,1,()=>{e.delete(r.key)})}function q3(r,e,t,n,l,u,d,a,_,x,k,S){let C=r.length,P=u.length,D=C;const O={};for(;D--;)O[r[D].key]=D;const z=[],B=new Map,N=new Map,G=[];for(D=P;D--;){const $=S(l,u,D),J=t($);let _e=d.get(J);_e?G.push(()=>_e.p($,e)):(_e=x(J,$),_e.c()),B.set(J,z[D]=_e),J in O&&N.set(J,Math.abs(D-O[J]))}const U=new Set,te=new Set;function le($){Zn($,1),$.m(a,k),d.set($.key,$),k=$.first,P--}for(;C&&P;){const $=z[P-1],J=r[C-1],_e=$.key,ze=J.key;$===J?(k=$.first,C--,P--):B.has(ze)?!d.has(_e)||U.has(_e)?le($):te.has(ze)?C--:N.get(_e)>N.get(ze)?(te.add(_e),le($)):(U.add(ze),C--):(_(J,d),C--)}for(;C--;){const $=r[C];B.has($.key)||_($,d)}for(;P;)le(z[P-1]);return Fs(G),z}function da(r){r&&r.c()}function Rs(r,e,t){const{fragment:n,after_update:l}=r.$$;n&&n.m(e,t),Vm(()=>{const u=r.$$.on_mount.map(cw).filter(uw);r.$$.on_destroy?r.$$.on_destroy.push(...u):Fs(u),r.$$.on_mount=[]}),l.forEach(Vm)}function Bs(r,e){const t=r.$$;t.fragment!==null&&(U3(t.after_update),Fs(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function G3(r,e){r.$$.dirty[0]===-1&&(mc.push(r),N3(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function _a(r,e,t,n,l,u,d=null,a=[-1]){const _=gh;oh(r);const x=r.$$={fragment:null,ctx:[],props:u,update:mn,not_equal:l,bound:h0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:h0(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(x.root);let k=!1;if(x.ctx=t?t(r,e.props||{},(S,C,...P)=>{const D=P.length?P[0]:C;return x.ctx&&l(x.ctx[S],x.ctx[S]=D)&&(!x.skip_bound&&x.bound[S]&&x.bound[S](D),k&&G3(r,S)),C}):[],x.update(),k=!0,Fs(x.before_update),x.fragment=n?n(x.ctx):!1,e.target){if(e.hydrate){const S=D3(e.target);x.fragment&&x.fragment.l(S),S.forEach(gn)}else x.fragment&&x.fragment.c();e.intro&&Zn(r.$$.fragment),Rs(r,e.target,e.anchor),dw()}oh(_)}class ya{constructor(){fo(this,"$$"),fo(this,"$$set")}$destroy(){Bs(this,1),this.$destroy=mn}$on(e,t){if(!uw(t))return mn;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const l=n.indexOf(t);l!==-1&&n.splice(l,1)}}$set(e){this.$$set&&!M3(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const W3="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(W3);function Z3(r){let e,t;return{c(){e=Zo("svg"),t=Zo("path"),it(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),it(e,"viewBox","0 0 14 14"),it(e,"width","13"),it(e,"height","13"),it(e,"class","svelte-en2qvf")},m(n,l){vn(n,e,l),Ar(e,t)},p:mn,i:mn,o:mn,d(n){n&&gn(e)}}}class pw extends ya{constructor(e){super(),_a(this,e,null,Z3,ga,{})}}function H3(r){let e,t;return{c(){e=Zo("svg"),t=Zo("path"),it(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),it(e,"viewBox","0 0 30 30"),it(e,"fill","none"),it(e,"xmlns","http://www.w3.org/2000/svg"),it(e,"class","svelte-d2loi5")},m(n,l){vn(n,e,l),Ar(e,t)},p:mn,i:mn,o:mn,d(n){n&&gn(e)}}}class mw extends ya{constructor(e){super(),_a(this,e,null,H3,ga,{})}}function $3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"area.svg")||it(e,"src",t),it(e,"alt",r[6]),it(e,"class","svelte-ltkwvy")},m(n,l){vn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"area.svg")&&it(e,"src",t),l&64&&it(e,"alt",n[6])},d(n){n&&gn(e)}}}function X3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"reverse.svg")||it(e,"src",t),it(e,"alt",r[6]),it(e,"class","svelte-ltkwvy")},m(n,l){vn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"reverse.svg")&&it(e,"src",t),l&64&&it(e,"alt",n[6])},d(n){n&&gn(e)}}}function K3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"poi.svg")||it(e,"src",t),it(e,"alt",r[6]),it(e,"class","svelte-ltkwvy")},m(n,l){vn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"poi.svg")&&it(e,"src",t),l&64&&it(e,"alt",n[6])},d(n){n&&gn(e)}}}function J3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"postal_code.svg")||it(e,"src",t),it(e,"alt",r[6]),it(e,"class","svelte-ltkwvy")},m(n,l){vn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"postal_code.svg")&&it(e,"src",t),l&64&&it(e,"alt",n[6])},d(n){n&&gn(e)}}}function Y3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"street.svg")||it(e,"src",t),it(e,"alt",r[6]),it(e,"class","svelte-ltkwvy")},m(n,l){vn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"street.svg")&&it(e,"src",t),l&64&&it(e,"alt",n[6])},d(n){n&&gn(e)}}}function Q3(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"road.svg")||it(e,"src",t),it(e,"alt",r[6]),it(e,"class","svelte-ltkwvy")},m(n,l){vn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"road.svg")&&it(e,"src",t),l&64&&it(e,"alt",n[6])},d(n){n&&gn(e)}}}function eT(r){let e,t;return{c(){e=Kr("img"),zi(e.src,t=r[3]+"housenumber.svg")||it(e,"src",t),it(e,"alt",r[6]),it(e,"class","svelte-ltkwvy")},m(n,l){vn(n,e,l)},p(n,l){l&8&&!zi(e.src,t=n[3]+"housenumber.svg")&&it(e,"src",t),l&64&&it(e,"alt",n[6])},d(n){n&&gn(e)}}}function tT(r){let e,t,n,l;return{c(){e=Kr("img"),zi(e.src,t=r[5])||it(e,"src",t),it(e,"alt",r[4]),it(e,"class","svelte-ltkwvy")},m(u,d){vn(u,e,d),n||(l=Zi(e,"error",r[14]),n=!0)},p(u,d){d&32&&!zi(e.src,t=u[5])&&it(e,"src",t),d&16&&it(e,"alt",u[4])},d(u){u&&gn(e),n=!1,l()}}}function _0(r){let e,t;return{c(){e=Kr("span"),t=fa(r[6]),it(e,"class","secondary svelte-ltkwvy")},m(n,l){vn(n,e,l),Ar(e,t)},p(n,l){l&64&&mh(t,n[6])},d(n){n&&gn(e)}}}function rT(r){let e,t,n,l,u,d,a,_,x,k=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,C,P=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],D,O,z=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,G;function U(J,_e){return _e&1&&(t=null),_e&1&&(n=null),_e&1&&(l=null),_e&1&&(u=null),J[5]?tT:J[0].address?eT:(t==null&&(t=!!J[0].id.startsWith("road.")),t?Q3:(n==null&&(n=!!J[0].id.startsWith("address.")),n?Y3:(l==null&&(l=!!J[0].id.startsWith("postal_code.")),l?J3:(u==null&&(u=!!J[0].id.startsWith("poi.")),u?K3:J[7]?X3:$3))))}let te=U(r,-1),le=te(r),$=P&&_0(r);return{c(){e=Kr("li"),le.c(),d=po(),a=Kr("span"),_=Kr("span"),x=Kr("span"),S=fa(k),C=po(),$&&$.c(),D=po(),O=Kr("span"),B=fa(z),it(x,"class","primary svelte-ltkwvy"),it(_,"class","svelte-ltkwvy"),it(O,"class","line2 svelte-ltkwvy"),it(a,"class","texts svelte-ltkwvy"),it(e,"tabindex","0"),it(e,"data-selected",r[1]),it(e,"class","svelte-ltkwvy"),Ao(e,"selected",r[1])},m(J,_e){vn(J,e,_e),le.m(e,null),Ar(e,d),Ar(e,a),Ar(a,_),Ar(_,x),Ar(x,S),Ar(_,C),$&&$.m(_,null),Ar(a,D),Ar(a,O),Ar(O,B),N||(G=[Zi(e,"mouseenter",r[12]),Zi(e,"focus",r[13])],N=!0)},p(J,[_e]){te===(te=U(J,_e))&&le?le.p(J,_e):(le.d(1),le=te(J),le&&(le.c(),le.m(e,d))),_e&1&&k!==(k=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&mh(S,k),_e&37&&(P=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),P?$?$.p(J,_e):($=_0(J),$.c(),$.m(_,null)):$&&($.d(1),$=null),_e&1&&z!==(z=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&mh(B,z),_e&2&&it(e,"data-selected",J[1]),_e&2&&Ao(e,"selected",J[1])},i:mn,o:mn,d(J){J&&gn(e),le.d(),$&&$.d(),N=!1,Fs(G)}}}function nT(r,e,t){var n;let l,u,{feature:d}=e,{selected:a=!1}=e,{showPlaceType:_}=e,{missingIconsCache:x}=e,{iconsBaseUrl:k}=e;const S=(n=d.properties)==null?void 0:n.categories;let C,P,D=0,O=d.place_type[0]==="reverse";function z(){P&&x.add(P),t(10,D++,D)}function B(U){p0.call(this,r,U)}function N(U){p0.call(this,r,U)}const G=()=>z();return r.$$set=U=>{"feature"in U&&t(0,d=U.feature),"selected"in U&&t(1,a=U.selected),"showPlaceType"in U&&t(2,_=U.showPlaceType),"missingIconsCache"in U&&t(9,x=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,k=U.iconsBaseUrl)},r.$$.update=()=>{var U,te,le,$;if(r.$$.dirty&3640)do t(11,l--,l),t(4,C=S==null?void 0:S[l]),t(5,P=C?k+C.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!P||x.has(P)));r.$$.dirty&1&&t(6,u=((te=(U=d.properties)==null?void 0:U.categories)==null?void 0:te.join(", "))??(($=(le=d.properties)==null?void 0:le.place_type_name)==null?void 0:$[0])??d.place_type[0])},t(11,l=(S==null?void 0:S.length)??0),[d,a,_,k,C,P,u,O,z,x,D,l,B,N,G]}class iT extends ya{constructor(e){super(),_a(this,e,nT,rT,ga,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function oT(r){let e;return{c(){e=Kr("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',it(e,"class","svelte-7cmwmc")},m(t,n){vn(t,e,n)},p:mn,i:mn,o:mn,d(t){t&&gn(e)}}}class sT extends ya{constructor(e){super(),_a(this,e,null,oT,ga,{})}}function aT(r){let e,t,n;return{c(){e=Zo("svg"),t=Zo("path"),it(t,"stroke-width","4"),it(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),it(t,"class","svelte-gzo3ar"),it(e,"width",n=r[0]==="list"?20:void 0),it(e,"viewBox","0 0 70 85"),it(e,"fill","none"),it(e,"class","svelte-gzo3ar"),Ao(e,"in-map",r[0]!=="list"),Ao(e,"list-icon",r[0]==="list")},m(l,u){vn(l,e,u),Ar(e,t)},p(l,[u]){u&1&&n!==(n=l[0]==="list"?20:void 0)&&it(e,"width",n),u&1&&Ao(e,"in-map",l[0]!=="list"),u&1&&Ao(e,"list-icon",l[0]==="list")},i:mn,o:mn,d(l){l&&gn(e)}}}function lT(r,e,t){let{displayIn:n}=e;return r.$$set=l=>{"displayIn"in l&&t(0,n=l.displayIn)},[n]}class cT extends ya{constructor(e){super(),_a(this,e,lT,aT,ga,{displayIn:0})}}function uT(r){let e,t;return{c(){e=Zo("svg"),t=Zo("path"),it(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),it(e,"viewBox","0 0 60.006 21.412"),it(e,"width","14"),it(e,"height","20"),it(e,"class","svelte-en2qvf")},m(n,l){vn(n,e,l),Ar(e,t)},p:mn,i:mn,o:mn,d(n){n&&gn(e)}}}class hT extends ya{constructor(e){super(),_a(this,e,null,uT,ga,{})}}function fT(r){let e,t,n;return{c(){e=Zo("svg"),t=Zo("circle"),n=Zo("path"),it(t,"cx","4.789"),it(t,"cy","4.787"),it(t,"r","3.85"),it(t,"class","svelte-1aq105l"),it(n,"d","M12.063 12.063 7.635 7.635"),it(n,"class","svelte-1aq105l"),it(e,"xmlns","http://www.w3.org/2000/svg"),it(e,"width","13"),it(e,"height","13"),it(e,"viewBox","0 0 13 13"),it(e,"class","svelte-1aq105l")},m(l,u){vn(l,e,u),Ar(e,t),Ar(e,n)},p:mn,i:mn,o:mn,d(l){l&&gn(e)}}}class dT extends ya{constructor(e){super(),_a(this,e,null,fT,ga,{})}}function pT(r,e,t){const n=e[1],l=e[0],u=n-l;return r===n&&t?r:((r-l)%u+u)%u+l}function pd(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Ou;async function mT(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Ou&&l.cachedLocationExpiry&&Ou.time+l.cachedLocationExpiry>Date.now()){if(!Ou.coords)break e;return Ou.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(Ou={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const gT=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,y0=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,v0=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,b0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,w0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,x0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function _T(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),d=t>0?"N":"S",a=n>0?"E":"W";let _;r=="DD"&&(_=`${l} ${d}, ${u} ${a}`);const x=Math.floor(l),k=Math.floor(u),S=(l-x)*60,C=(u-k)*60;if(r=="DM"){let P=S0(S,3).toFixed(3).padStart(6,"0"),D=S0(C,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&D.endsWith(".000")&&(P=P.replace(/\.000$/,""),D=D.replace(/\.000$/,"")),_=`${x} ${P}' ${d}, ${k} ${D}' ${a}`}if(r=="DMS"){const P=Math.floor(S),D=Math.floor(C);let O=((S-P)*60).toFixed(1).padStart(4,"0"),z=((C-D)*60).toFixed(1).padStart(4,"0");const B=P.toString().padStart(2,"0"),N=D.toString().padStart(2,"0");O.endsWith(".0")&&z.endsWith(".0")&&(O=O.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),_=`${x} ${B}' ${O}" ${d}, ${k} ${N}' ${z}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function S0(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Rg(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",d=null,a=[],_=!1;if(gT.test(r))throw new Error("invalid coordinate value");if(y0.test(r))if(a=y0.exec(r),_=Nu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),d="DM";else throw new Error("invalid coordinate format");else if(v0.test(r))if(a=v0.exec(r),_=Nu(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(b0.test(r))if(a=b0.exec(r),_=Nu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(w0.test(r))if(a=w0.exec(r),_=Nu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(x0.test(r)){if(a=x0.exec(r),_=Nu(a),a.filter(x=>x).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let x=/S|SOUTH/i;x.test(l)&&t>0&&(t=-1*t),x=/W|WEST/i,x.test(u)&&n>0&&(n=-1*n);const k=a[0].trim();let S,C;const P=/[,/;\u0020]/g,D=k.match(P);if(D==null){const B=Math.floor(r.length/2);S=k.substring(0,B).trim(),C=k.substring(B).trim()}else{let B;D.length%2==1?B=Math.floor(D.length/2):B=D.length/2-1;let N=0;if(B==0)N=k.indexOf(D[0]),S=k.substring(0,N).trim(),C=k.substring(N+1).trim();else{let G=0,U=0;for(;G<=B;)N=k.indexOf(D[G],U),U=N+1,G++;S=k.substring(0,N).trim(),C=k.substring(N+1).trim()}}const O=S.split(".");if(O.length==2&&O[1]==0&&O[1].length!=2)throw new Error("invalid coordinates format");const z=C.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:C,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:d,closeEnough:yT,toCoordinateFormat:_T})}else throw new Error("coordinates pattern match failed")}function Nu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),x=n.test(d)&&n.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||x||k)continue;return!1}}return!0}function k0(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function yT(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return k0(this.decimalLatitude,Number(e[0]))&&k0(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const vT=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Rg.to=vT;const bT=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],wT={decimalLatitude:40.123,decimalLongitude:-74.123},xT=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],ST=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function kT(){const r=[];return bT.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...wT})}),[...r,...xT,...ST]}const TT=kT();Rg.formats=TT.map(r=>r.verbatimCoordinates);const ET=Rg;function T0(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function E0(r){let e,t;return e=new sT({}),{c(){da(e.$$.fragment)},m(n,l){Rs(e,n,l),t=!0},i(n){t||(Zn(e.$$.fragment,n),t=!0)},o(n){ui(e.$$.fragment,n),t=!1},d(n){Bs(e,n)}}}function M0(r){let e,t,n,l,u;return t=new hT({}),{c(){e=Kr("button"),da(t.$$.fragment),it(e,"type","button"),it(e,"title",r[9]),it(e,"class","svelte-bz0zu3"),Ao(e,"active",r[0])},m(d,a){vn(d,e,a),Rs(t,e,null),n=!0,l||(u=Zi(e,"click",r[69]),l=!0)},p(d,a){(!n||a[0]&512)&&it(e,"title",d[9]),(!n||a[0]&1)&&Ao(e,"active",d[0])},i(d){n||(Zn(t.$$.fragment,d),n=!0)},o(d){ui(t.$$.fragment,d),n=!1},d(d){d&&gn(e),Bs(t),l=!1,u()}}}function MT(r){let e,t=[],n=new Map,l,u,d,a=g0(r[14]);const _=x=>x[84].id+(x[84].address?","+x[84].address:"");for(let x=0;x<a.length;x+=1){let k=T0(r,a,x),S=_(k);n.set(S,t[x]=C0(S,k))}return{c(){e=Kr("ul");for(let x=0;x<t.length;x+=1)t[x].c();it(e,"class","options svelte-bz0zu3")},m(x,k){vn(x,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[Zi(e,"mouseleave",r[73]),Zi(e,"blur",r[74])],u=!0)},p(x,k){k[0]&17880064&&(a=g0(x[14]),Hf(),t=q3(t,k,_,1,x,a,n,e,V3,C0,null,T0),$f())},i(x){if(!l){for(let k=0;k<a.length;k+=1)Zn(t[k]);l=!0}},o(x){for(let k=0;k<t.length;k+=1)ui(t[k]);l=!1},d(x){x&&gn(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,Fs(d)}}}function CT(r){let e,t,n,l,u,d;return t=new mw({}),{c(){e=Kr("div"),da(t.$$.fragment),n=po(),l=Kr("div"),u=fa(r[7]),it(l,"class","svelte-bz0zu3"),it(e,"class","no-results svelte-bz0zu3")},m(a,_){vn(a,e,_),Rs(t,e,null),Ar(e,n),Ar(e,l),Ar(l,u),d=!0},p(a,_){(!d||_[0]&128)&&mh(u,a[7])},i(a){d||(Zn(t.$$.fragment,a),d=!0)},o(a){ui(t.$$.fragment,a),d=!1},d(a){a&&gn(e),Bs(t)}}}function IT(r){let e="",t;return{c(){t=fa(e)},m(n,l){vn(n,t,l)},p:mn,i:mn,o:mn,d(n){n&&gn(t)}}}function AT(r){let e,t,n,l,u,d,a,_,x,k,S;return t=new mw({}),_=new pw({}),{c(){e=Kr("div"),da(t.$$.fragment),n=po(),l=Kr("div"),u=fa(r[6]),d=po(),a=Kr("button"),da(_.$$.fragment),it(l,"class","svelte-bz0zu3"),it(a,"class","svelte-bz0zu3"),it(e,"class","error svelte-bz0zu3")},m(C,P){vn(C,e,P),Rs(t,e,null),Ar(e,n),Ar(e,l),Ar(l,u),Ar(e,d),Ar(e,a),Rs(_,a,null),x=!0,k||(S=Zi(a,"click",r[70]),k=!0)},p(C,P){(!x||P[0]&64)&&mh(u,C[6])},i(C){x||(Zn(t.$$.fragment,C),Zn(_.$$.fragment,C),x=!0)},o(C){ui(t.$$.fragment,C),ui(_.$$.fragment,C),x=!1},d(C){C&&gn(e),Bs(t),Bs(_),k=!1,S()}}}function C0(r,e){let t,n,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return n=new iT({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",d),{key:r,first:null,c(){t=P3(),da(n.$$.fragment),this.first=t},m(a,_){vn(a,t,_),Rs(n,a,_),l=!0},p(a,_){e=a;const x={};_[0]&16384&&(x.feature=e[84]),_[0]&1024&&(x.showPlaceType=e[10]),_[0]&49152&&(x.selected=e[15]===e[86]),_[0]&4096&&(x.iconsBaseUrl=e[12]),n.$set(x)},i(a){l||(Zn(n.$$.fragment,a),l=!0)},o(a){ui(n.$$.fragment,a),l=!1},d(a){a&&gn(t),Bs(n,a)}}}function LT(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D,O,z,B,N,G,U,te,le=!1;u=new dT({}),S=new pw({});let $=r[19]&&E0(),J=r[5]==="button"&&M0(r);const _e=r[61].default,ze=C3(_e,r,r[60],null),re=[AT,IT,CT,MT],ue=[];function He(Me,ut){var At,Nt;return Me[18]?0:Me[16]?((At=Me[14])==null?void 0:At.length)===0?2:Me[16]&&(Nt=Me[14])!=null&&Nt.length?3:-1:1}return~(z=He(r))&&(B=ue[z]=re[z](r)),{c(){e=po(),t=Kr("form"),n=Kr("div"),l=Kr("button"),da(u.$$.fragment),d=po(),a=Kr("input"),_=po(),x=Kr("div"),k=Kr("button"),da(S.$$.fragment),C=po(),$&&$.c(),P=po(),J&&J.c(),D=po(),ze&&ze.c(),O=po(),B&&B.c(),it(l,"class","search-button svelte-bz0zu3"),it(l,"type","button"),it(a,"placeholder",r[8]),it(a,"aria-label",r[8]),it(a,"class","svelte-bz0zu3"),it(k,"type","button"),it(k,"title",r[3]),it(k,"class","svelte-bz0zu3"),it(x,"class","clear-button-container svelte-bz0zu3"),Ao(x,"displayable",r[1]!==""),it(n,"class","input-group svelte-bz0zu3"),it(t,"tabindex","0"),it(t,"class",N=f0(r[2])+" svelte-bz0zu3"),Ao(t,"can-collapse",r[4]&&r[1]==="")},m(Me,ut){vn(Me,e,ut),vn(Me,t,ut),Ar(t,n),Ar(n,l),Rs(u,l,null),Ar(n,d),Ar(n,a),r[63](a),d0(a,r[1]),Ar(n,_),Ar(n,x),Ar(x,k),Rs(S,k,null),Ar(x,C),$&&$.m(x,null),Ar(n,P),J&&J.m(n,null),Ar(n,D),ze&&ze.m(n,null),Ar(t,O),~z&&ue[z].m(t,null),G=!0,U||(te=[Zi(l,"click",r[62]),Zi(a,"input",r[64]),Zi(a,"focus",r[65]),Zi(a,"blur",r[66]),Zi(a,"keydown",r[22]),Zi(a,"input",r[67]),Zi(k,"click",r[68]),Zi(t,"submit",z3(r[21]))],U=!0)},p(Me,ut){(!G||ut[0]&256)&&it(a,"placeholder",Me[8]),(!G||ut[0]&256)&&it(a,"aria-label",Me[8]),ut[0]&2&&a.value!==Me[1]&&d0(a,Me[1]),(!G||ut[0]&8)&&it(k,"title",Me[3]),Me[19]?$?ut[0]&524288&&Zn($,1):($=E0(),$.c(),Zn($,1),$.m(x,null)):$&&(Hf(),ui($,1,1,()=>{$=null}),$f()),(!G||ut[0]&2)&&Ao(x,"displayable",Me[1]!==""),Me[5]==="button"?J?(J.p(Me,ut),ut[0]&32&&Zn(J,1)):(J=M0(Me),J.c(),Zn(J,1),J.m(n,D)):J&&(Hf(),ui(J,1,1,()=>{J=null}),$f()),ze&&ze.p&&(!G||ut[1]&536870912)&&A3(ze,_e,Me,Me[60],G?I3(_e,Me[60],ut,null):L3(Me[60]),null);let At=z;z=He(Me),z===At?~z&&ue[z].p(Me,ut):(B&&(Hf(),ui(ue[At],1,1,()=>{ue[At]=null}),$f()),~z?(B=ue[z],B?B.p(Me,ut):(B=ue[z]=re[z](Me),B.c()),Zn(B,1),B.m(t,null)):B=null),(!G||ut[0]&4&&N!==(N=f0(Me[2])+" svelte-bz0zu3"))&&it(t,"class",N),(!G||ut[0]&22)&&Ao(t,"can-collapse",Me[4]&&Me[1]==="")},i(Me){G||(Zn(le),Zn(u.$$.fragment,Me),Zn(S.$$.fragment,Me),Zn($),Zn(J),Zn(ze,Me),Zn(B),G=!0)},o(Me){ui(le),ui(u.$$.fragment,Me),ui(S.$$.fragment,Me),ui($),ui(J),ui(ze,Me),ui(B),G=!1},d(Me){Me&&(gn(e),gn(t)),Bs(u),r[63](null),Bs(S),$&&$.d(),J&&J.d(),ze&&ze.d(Me),~z&&ue[z].d(),U=!1,Fs(te)}}}function PT(r,e,t){let n,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:x}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:P=!1}=e,{country:D=void 0}=e,{debounceSearch:O=200}=e,{enableReverse:z="never"}=e,{errorMessage:B="Something went wrong"}=e,{filter:N=()=>!0}=e,{flyTo:G=!0}=e,{fuzzyMatch:U=!0}=e,{language:te=void 0}=e,{limit:le=void 0}=e,{mapController:$=void 0}=e,{minLength:J=2}=e,{noResultsMessage:_e="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ze="Search"}=e,{proximity:re=[{type:"server-geolocation"}]}=e,{reverseActive:ue=z==="always"}=e,{reverseButtonTitle:He="toggle reverse geocoding"}=e,{searchValue:Me=""}=e,{pickedResultStyle:ut="full-geometry"}=e,{showPlaceType:At="if-needed"}=e,{showResultsWhileTyping:Nt=!0}=e,{selectFirst:Je=!0}=e,{flyToSelected:Jt=!1}=e,{markerOnSelected:Kt=!0}=e,{types:Ut=void 0}=e,{exhaustiveReverseGeocoding:Vt=!1}=e,{excludeTypes:wt=!1}=e,{zoom:Yt=a}=e,{apiUrl:gr="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Pt={}}=e,{iconsBaseUrl:rr="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:wr=()=>{}}=e;function mr(){Be.focus()}function Rr(){Be.blur()}function ht(W,Fe=!0,Oe=!1){t(1,Me=W),Fe?(t(15,Ze=-1),st()):(Qt(!Oe,Oe),setTimeout(()=>{Be.focus(),Be.select()}))}function Mt(){t(14,nt=void 0),t(56,ne=void 0),t(15,Ze=-1)}function De(){t(55,xt=[]),t(56,ne=void 0)}let lt=!1,nt,xt,ne,nr="",Be,Ze=-1,bt,bn=[],wn,Mn,ni,ii;const $o=new Set,Jr=F3();B3(()=>{$&&($.setEventHandler(void 0),$.indicateReverse(!1),$.setSelectedMarker(-1),$.setFeatures(void 0,void 0,!1))});function st(W){if(Mn&&(clearTimeout(Mn),Mn=void 0),Ze>-1&&nt)t(56,ne=nt[Ze]),t(1,Me=ne.place_type[0]==="reverse"?ne.place_name:ne.place_name.replace(/,.*/,"")),t(18,bt=void 0),t(55,xt=void 0),t(15,Ze=-1);else if(Me){const Fe=W||!Xn(Me);xn(Me,{exact:!0}).then(()=>{t(55,xt=nt),t(56,ne=void 0),Fe&&Bo()}).catch(Oe=>t(18,bt=Oe))}}function Xn(W){try{return ET(W,6)}catch{return!1}}async function xn(W,{byId:Fe=!1,exact:Oe=!1}={}){t(18,bt=void 0),wn==null||wn.abort();const Ge=new AbortController;t(19,wn=Ge);try{const Ke=Xn(W),at=new URLSearchParams;if(te!==void 0&&at.set("language",Array.isArray(te)?te.join(","):te??""),Ut&&at.set("types",Ut.join(",")),wt&&at.set("excludeTypes",String(wt)),k&&at.set("bbox",k.map(_r=>_r.toFixed(6)).join(",")),D&&at.set("country",Array.isArray(D)?D.join(","):D),!Fe&&!Ke){const _r=await mT($,re,Ge);_r&&at.set("proximity",_r),(Oe||!Nt)&&at.set("autocomplete","false"),at.set("fuzzyMatch",String(U))}le!==void 0&&(Vt||!Ke||(Ut==null?void 0:Ut.length)===1)&&at.set("limit",String(le)),at.set("key",x),wr(at);const zt=gr+"/"+encodeURIComponent(Ke?Ke.decimalLongitude+","+Ke.decimalLatitude:W)+".json?"+at.toString();if(zt===nr){Fe?(t(14,nt=void 0),t(56,ne=bn[0])):t(14,nt=bn);return}nr=zt;const $t=await fetch(zt,{signal:Ge.signal,...Pt});if(!$t.ok)throw new Error(await $t.text());const ar=await $t.json();Jr("response",{url:zt,featureCollection:ar}),Fe?(t(14,nt=void 0),t(56,ne=ar.features[0]),bn=[ne]):(t(14,nt=ar.features.filter(N)),Ke&&nt.unshift({type:"Feature",properties:{},id:"reverse_"+Ke.decimalLongitude+"_"+Ke.decimalLatitude,text:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_name:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_type:["reverse"],center:[Ke.decimalLongitude,Ke.decimalLatitude],bbox:[Ke.decimalLongitude,Ke.decimalLatitude,Ke.decimalLongitude,Ke.decimalLatitude],geometry:{type:"Point",coordinates:[Ke.decimalLongitude,Ke.decimalLatitude]}}),bn=nt,Ke&&Be.focus())}catch(Ke){if(Ke&&typeof Ke=="object"&&"name"in Ke&&Ke.name==="AbortError")return;throw Ke}finally{Ge===wn&&t(19,wn=void 0)}}function Bo(){var W;if(!(xt!=null&&xt.length)||!G)return;const Fe=[180,90,-180,-90],Oe=!xt.some(Ke=>!Ke.matching_text);let Ge;for(const Ke of xt){const at=Or(Ke);if(Ge=Ge===void 0?at:at===void 0?Ge:Math.max(Ge,at),Oe||!Ke.matching_text)for(const zt of[0,1,2,3])Fe[zt]=Math[zt<2?"min":"max"](Fe[zt],((W=Ke.bbox)==null?void 0:W[zt])??Ke.center[zt%2])}$&&xt.length>0&&(ne&&Fe[0]===Fe[2]&&Fe[1]===Fe[3]?$.flyTo(ne.center,Or(ne)):$.fitBounds(pd(Fe),50,Ge))}function Or(W){var Fe;if(!W.bbox||W.bbox[0]!==W.bbox[2]&&W.bbox[1]!==W.bbox[3])return;const Oe=W.id.replace(/\..*/,"");return(Array.isArray((Fe=W.properties)==null?void 0:Fe.categories)?W.properties.categories.reduce((Ge,Ke)=>{const at=Yt[Oe+"."+Ke];return Ge===void 0?at:at===void 0?Ge:Math.max(Ge,at)},void 0):void 0)??Yt[Oe]}function pt(W){t(0,ue=z==="always"),t(14,nt=void 0),t(56,ne=void 0),t(15,Ze=-1),ht(W[1].toFixed(6)+", "+pT(W[0],[-180,180],!0).toFixed(6),!1,!0)}function ir(W){if(!nt)return;let Fe=W.key==="ArrowDown"?1:W.key==="ArrowUp"?-1:0;Fe&&(Ze===(Je?0:-1)&&Fe===-1&&t(15,Ze=nt.length),t(15,Ze+=Fe),Ze>=nt.length&&t(15,Ze=-1),Ze<0&&Je&&t(15,Ze=0),W.preventDefault())}function Qt(W=!0,Fe=!1){if(t(18,bt=void 0),Nt||Fe){if(Mn&&clearTimeout(Mn),Me.length<J)return;const Oe=Me;Mn=window.setTimeout(()=>{xn(Oe).catch(Ge=>t(18,bt=Ge))},W?O:0)}else t(14,nt=void 0),t(18,bt=void 0)}function Nr(W){t(56,ne=W),t(1,Me=W.place_name),t(15,Ze=-1)}const vi=()=>Be.focus();function tr(W){jm[W?"unshift":"push"](()=>{Be=W,t(17,Be)})}function ro(){Me=this.value,t(1,Me),t(13,lt),t(28,C)}const an=()=>t(13,lt=!0),me=()=>t(13,lt=!1),Z=()=>Qt(),X=()=>{t(1,Me=""),Be.focus()},ee=()=>t(0,ue=!ue),ce=()=>t(18,bt=void 0),Ce=W=>t(15,Ze=W),Ie=W=>Nr(W),Pe=()=>{Je||t(15,Ze=-1)},Se=()=>{};return r.$$set=W=>{"class"in W&&t(2,_=W.class),"apiKey"in W&&t(26,x=W.apiKey),"bbox"in W&&t(27,k=W.bbox),"clearButtonTitle"in W&&t(3,S=W.clearButtonTitle),"clearOnBlur"in W&&t(28,C=W.clearOnBlur),"collapsed"in W&&t(4,P=W.collapsed),"country"in W&&t(29,D=W.country),"debounceSearch"in W&&t(30,O=W.debounceSearch),"enableReverse"in W&&t(5,z=W.enableReverse),"errorMessage"in W&&t(6,B=W.errorMessage),"filter"in W&&t(31,N=W.filter),"flyTo"in W&&t(32,G=W.flyTo),"fuzzyMatch"in W&&t(33,U=W.fuzzyMatch),"language"in W&&t(34,te=W.language),"limit"in W&&t(35,le=W.limit),"mapController"in W&&t(36,$=W.mapController),"minLength"in W&&t(37,J=W.minLength),"noResultsMessage"in W&&t(7,_e=W.noResultsMessage),"placeholder"in W&&t(8,ze=W.placeholder),"proximity"in W&&t(38,re=W.proximity),"reverseActive"in W&&t(0,ue=W.reverseActive),"reverseButtonTitle"in W&&t(9,He=W.reverseButtonTitle),"searchValue"in W&&t(1,Me=W.searchValue),"pickedResultStyle"in W&&t(39,ut=W.pickedResultStyle),"showPlaceType"in W&&t(10,At=W.showPlaceType),"showResultsWhileTyping"in W&&t(40,Nt=W.showResultsWhileTyping),"selectFirst"in W&&t(11,Je=W.selectFirst),"flyToSelected"in W&&t(41,Jt=W.flyToSelected),"markerOnSelected"in W&&t(42,Kt=W.markerOnSelected),"types"in W&&t(43,Ut=W.types),"exhaustiveReverseGeocoding"in W&&t(44,Vt=W.exhaustiveReverseGeocoding),"excludeTypes"in W&&t(45,wt=W.excludeTypes),"zoom"in W&&t(46,Yt=W.zoom),"apiUrl"in W&&t(47,gr=W.apiUrl),"fetchParameters"in W&&t(48,Pt=W.fetchParameters),"iconsBaseUrl"in W&&t(12,rr=W.iconsBaseUrl),"adjustUrlQuery"in W&&t(49,wr=W.adjustUrlQuery),"$$scope"in W&&t(60,d=W.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ue=z==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,ni=lt),C&&!lt&&t(1,Me="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&Me.length<J&&(t(56,ne=void 0),t(14,nt=void 0),t(18,bt=void 0),t(55,xt=nt)),r.$$.dirty[1]&33554688&&ut!=="marker-only"&&ne&&!ne.address&&ne.geometry.type==="Point"&&ne.place_type[0]!=="reverse"&&xn(ne.id,{byId:!0}).catch(W=>t(18,bt=W)),r.$$.dirty[1]&100663330&&($&&ne&&ne.id!==ii&&G&&(!ne.bbox||ne.bbox[0]===ne.bbox[2]&&ne.bbox[1]===ne.bbox[3]?$.flyTo(ne.center,Or(ne)):$.fitBounds(pd(ne.bbox),50,Or(ne)),t(14,nt=void 0),t(55,xt=void 0),t(15,Ze=-1)),t(57,ii=ne==null?void 0:ne.id)),r.$$.dirty[0]&18432&&Je&&nt!=null&&nt.length&&t(15,Ze=0),r.$$.dirty[0]&2&&t(15,Ze=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&xt!==nt&&t(55,xt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&$&&$.setEventHandler(W=>{switch(W.type){case"mapClick":ue&&pt(W.coordinates);break;case"markerClick":{const Fe=nt==null?void 0:nt.find(Oe=>Oe.id===W.id);Fe&&Nr(Fe)}break;case"markerMouseEnter":xt&&t(15,Ze=ni?(nt==null?void 0:nt.findIndex(Fe=>Fe.id===W.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,Ze=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=nt==null?void 0:nt[Ze]),r.$$.dirty[1]&134218786&&$&&l&&G&&Jt&&$.flyTo(l.center,Or(l)),r.$$.dirty[1]&256&&t(59,n=ut==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Kt||$==null||$.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&$&&Kt&&!xt&&($.setFeatures(l?[l]:void 0,void 0,n),$.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&$&&$.setFeatures(xt,ne,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&xt&&$&&$.setSelectedMarker(Ze),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&$){const W=Xn(Me);$.setReverseMarker(W?[W.decimalLongitude,W.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Jr("select",{feature:l}),r.$$.dirty[1]&33554432&&Jr("pick",{feature:ne}),r.$$.dirty[0]&81920&&Jr("optionsvisibilitychange",{optionsVisible:ni&&!!nt}),r.$$.dirty[0]&16384&&Jr("featureslisted",{features:nt}),r.$$.dirty[1]&16777216&&Jr("featuresmarked",{features:xt}),r.$$.dirty[0]&1&&Jr("reversetoggle",{reverse:ue}),r.$$.dirty[0]&2&&Jr("querychange",{query:Me}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&$&&$.indicateReverse(ue)},[ue,Me,_,S,P,z,B,_e,ze,He,At,Je,rr,lt,nt,Ze,ni,Be,bt,wn,$o,st,ir,Qt,Nr,a,x,k,C,D,O,N,G,U,te,le,$,J,re,ut,Nt,Jt,Kt,Ut,Vt,wt,Yt,gr,Pt,wr,mr,Rr,ht,Mt,De,xt,ne,ii,l,n,d,u,vi,tr,ro,an,me,Z,X,ee,ce,Ce,Ie,Pe,Se]}let zT=class extends ya{constructor(r){super(),_a(this,r,PT,LT,ga,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function _h(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Bg(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<n[n.length-1].length;l++)if(n[n.length-1][l]!==n[0][l])throw new Error("First and last Position are not equivalent.")}return _h({type:"Polygon",coordinates:r},e,t)}function yh(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function gw(r,e,t={}){return _h({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function DT(r,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},n,l,u,d;return d={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function a(x){return function(k){return _([x,k])}}function _(x){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,l&&(u=x[0]&2?l.return:x[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,x[1])).done)return u;switch(l=0,u&&(x=[x[0]&2,u.value]),x[0]){case 0:case 1:u=x;break;case 4:return t.label++,{value:x[1],done:!1};case 5:t.label++,l=x[1],x=[0];continue;case 7:x=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(x[0]===6||x[0]===2)){t=0;continue}if(x[0]===3&&(!u||x[1]>u[0]&&x[1]<u[3])){t.label=x[1];break}if(x[0]===6&&t.label<u[1]){t.label=u[1],u=x;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(x);break}u[2]&&t.ops.pop(),t.trys.pop();continue}x=e.call(r,t)}catch(k){x=[6,k],l=0}finally{n=u=0}if(x[0]&5)throw x[1];return{value:x[0]?x[1]:void 0,done:!0}}}var pa=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function RT(r,e){return r>e?1:r<e?-1:0}function sa(r,e,t){for(var n=new pa(null,null),l=n,u=n;;){var d=t(r,e.key);if(d<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(d>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=n.right,e.right=n.left,e}function nm(r,e,t,n){var l=new pa(r,e);if(t===null)return l.left=l.right=null,l;t=sa(r,t,n);var u=n(r,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function I0(r,e,t){var n=null,l=null;if(e){e=sa(r,e,t);var u=t(e.key,r);u===0?(n=e.left,l=e.right):u<0?(l=e.right,e.right=null,n=e):(n=e.left,e.left=null,l=e)}return{left:n,right:l}}function BT(r,e,t){return e===null?r:(r===null||(e=sa(r.key,e,t),e.left=r),e)}function qm(r,e,t,n,l){if(r){n(""+e+(t?" ":" ")+l(r)+`
`);var u=e+(t?"    ":"   ");r.left&&qm(r.left,u,!1,n,l),r.right&&qm(r.right,u,!0,n,l)}}var Fg=function(){function r(e){e===void 0&&(e=RT),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=nm(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new pa(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var l=this._comparator,u=sa(e,this._root,l),d=l(e,u.key);return d===0?this._root=u:(d<0?(n.left=u.left,n.right=u,u.left=null):d>0&&(n.right=u.right,n.left=u,u.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var l;if(t===null)return null;t=sa(e,t,n);var u=n(e,t.key);return u===0?(t.left===null?l=t.right:(l=sa(e,t.left,n),l.right=t.right),this._size--,l):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=sa(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=sa(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var l=n(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,l=[],u=!1;!u;)n!==null?(l.push(n),n=n.left):l.length!==0?(n=l.pop(),e.call(t,n),n=n.right):u=!0;return this},r.prototype.range=function(e,t,n,l){for(var u=[],d=this._comparator,a=this._root,_;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),_=d(a.key,t),_>0)break;if(d(a.key,e)>=0&&n.call(l,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,l=0,u=[];!n;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return OT(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var l=e.length,u=this._comparator;if(n&&Zm(e,t,0,l-1,u),this._root===null)this._root=Gm(e,t,0,l),this._size=l;else{var d=NT(this.toList(),FT(e,t),u);l=this._size+l,this._root=Wm({head:d},0,l)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return qm(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var l=this._comparator,u=I0(e,this._root,l),d=u.left,a=u.right;l(e,t)<0?a=nm(t,n,a,l):d=nm(t,n,d,l),this._root=BT(d,a,l)},r.prototype.split=function(e){return I0(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return DT(this,function(l){switch(l.label){case 0:e=this._root,t=[],n=!1,l.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:n=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function Gm(r,e,t,n){var l=n-t;if(l>0){var u=t+Math.floor(l/2),d=r[u],a=e[u],_=new pa(d,a);return _.left=Gm(r,e,t,u),_.right=Gm(r,e,u+1,n),_}return null}function FT(r,e){for(var t=new pa(null,null),n=t,l=0;l<r.length;l++)n=n.next=new pa(r[l],e[l]);return n.next=null,t.next}function OT(r){for(var e=r,t=[],n=!1,l=new pa(null,null),u=l;!n;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):n=!0;return u.next=null,l.next}function Wm(r,e,t){var n=t-e;if(n>0){var l=e+Math.floor(n/2),u=Wm(r,e,l),d=r.head;return d.left=u,r.head=r.head.next,d.right=Wm(r,l+1,t),d}return null}function NT(r,e,t){for(var n=new pa(null,null),l=n,u=r,d=e;u!==null&&d!==null;)t(u.key,d.key)<0?(l.next=u,u=u.next):(l.next=d,d=d.next),l=l.next;return u!==null?l.next=u:d!==null&&(l.next=d),n.next}function Zm(r,e,t,n,l){if(!(t>=n)){for(var u=r[t+n>>1],d=t-1,a=n+1;;){do d++;while(l(r[d],u)<0);do a--;while(l(r[a],u)>0);if(d>=a)break;var _=r[d];r[d]=r[a],r[a]=_,_=e[d],e[d]=e[a],e[a]=_}Zm(r,e,t,a,l),Zm(r,e,a+1,n,l)}}const zs=11102230246251565e-32,Ii=134217729,jT=(3+8*zs)*zs;function im(r,e,t,n,l){let u,d,a,_,x=e[0],k=n[0],S=0,C=0;k>x==k>-x?(u=x,x=e[++S]):(u=k,k=n[++C]);let P=0;if(S<r&&C<t)for(k>x==k>-x?(d=x+u,a=u-(d-x),x=e[++S]):(d=k+u,a=u-(d-k),k=n[++C]),u=d,a!==0&&(l[P++]=a);S<r&&C<t;)k>x==k>-x?(d=u+x,_=d-u,a=u-(d-_)+(x-_),x=e[++S]):(d=u+k,_=d-u,a=u-(d-_)+(k-_),k=n[++C]),u=d,a!==0&&(l[P++]=a);for(;S<r;)d=u+x,_=d-u,a=u-(d-_)+(x-_),x=e[++S],u=d,a!==0&&(l[P++]=a);for(;C<t;)d=u+k,_=d-u,a=u-(d-_)+(k-_),k=n[++C],u=d,a!==0&&(l[P++]=a);return(u!==0||P===0)&&(l[P++]=u),P}function UT(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function Eh(r){return new Float64Array(r)}const VT=(3+16*zs)*zs,qT=(2+12*zs)*zs,GT=(9+64*zs)*zs*zs,cc=Eh(4),A0=Eh(8),L0=Eh(12),P0=Eh(16),Gi=Eh(4);function WT(r,e,t,n,l,u,d){let a,_,x,k,S,C,P,D,O,z,B,N,G,U,te,le,$,J;const _e=r-l,ze=t-l,re=e-u,ue=n-u;U=_e*ue,C=Ii*_e,P=C-(C-_e),D=_e-P,C=Ii*ue,O=C-(C-ue),z=ue-O,te=D*z-(U-P*O-D*O-P*z),le=re*ze,C=Ii*re,P=C-(C-re),D=re-P,C=Ii*ze,O=C-(C-ze),z=ze-O,$=D*z-(le-P*O-D*O-P*z),B=te-$,S=te-B,cc[0]=te-(B+S)+(S-$),N=U+B,S=N-U,G=U-(N-S)+(B-S),B=G-le,S=G-B,cc[1]=G-(B+S)+(S-le),J=N+B,S=J-N,cc[2]=N-(J-S)+(B-S),cc[3]=J;let He=UT(4,cc),Me=qT*d;if(He>=Me||-He>=Me||(S=r-_e,a=r-(_e+S)+(S-l),S=t-ze,x=t-(ze+S)+(S-l),S=e-re,_=e-(re+S)+(S-u),S=n-ue,k=n-(ue+S)+(S-u),a===0&&_===0&&x===0&&k===0)||(Me=GT*d+jT*Math.abs(He),He+=_e*k+ue*a-(re*x+ze*_),He>=Me||-He>=Me))return He;U=a*ue,C=Ii*a,P=C-(C-a),D=a-P,C=Ii*ue,O=C-(C-ue),z=ue-O,te=D*z-(U-P*O-D*O-P*z),le=_*ze,C=Ii*_,P=C-(C-_),D=_-P,C=Ii*ze,O=C-(C-ze),z=ze-O,$=D*z-(le-P*O-D*O-P*z),B=te-$,S=te-B,Gi[0]=te-(B+S)+(S-$),N=U+B,S=N-U,G=U-(N-S)+(B-S),B=G-le,S=G-B,Gi[1]=G-(B+S)+(S-le),J=N+B,S=J-N,Gi[2]=N-(J-S)+(B-S),Gi[3]=J;const ut=im(4,cc,4,Gi,A0);U=_e*k,C=Ii*_e,P=C-(C-_e),D=_e-P,C=Ii*k,O=C-(C-k),z=k-O,te=D*z-(U-P*O-D*O-P*z),le=re*x,C=Ii*re,P=C-(C-re),D=re-P,C=Ii*x,O=C-(C-x),z=x-O,$=D*z-(le-P*O-D*O-P*z),B=te-$,S=te-B,Gi[0]=te-(B+S)+(S-$),N=U+B,S=N-U,G=U-(N-S)+(B-S),B=G-le,S=G-B,Gi[1]=G-(B+S)+(S-le),J=N+B,S=J-N,Gi[2]=N-(J-S)+(B-S),Gi[3]=J;const At=im(ut,A0,4,Gi,L0);U=a*k,C=Ii*a,P=C-(C-a),D=a-P,C=Ii*k,O=C-(C-k),z=k-O,te=D*z-(U-P*O-D*O-P*z),le=_*x,C=Ii*_,P=C-(C-_),D=_-P,C=Ii*x,O=C-(C-x),z=x-O,$=D*z-(le-P*O-D*O-P*z),B=te-$,S=te-B,Gi[0]=te-(B+S)+(S-$),N=U+B,S=N-U,G=U-(N-S)+(B-S),B=G-le,S=G-B,Gi[1]=G-(B+S)+(S-le),J=N+B,S=J-N,Gi[2]=N-(J-S)+(B-S),Gi[3]=J;const Nt=im(At,L0,4,Gi,P0);return P0[Nt-1]}function ZT(r,e,t,n,l,u){const d=(e-u)*(t-l),a=(r-l)*(n-u),_=d-a,x=Math.abs(d+a);return Math.abs(_)>=VT*x?_:-WT(r,e,t,n,l,u,x)}const ju=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,Hm=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,l=r.ll.y<e.ll.y?e.ll.y:r.ll.y,u=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:n,y:u}}};let la=Number.EPSILON;la===void 0&&(la=Math.pow(2,-52));const HT=la*la,z0=(r,e)=>{if(-la<r&&r<la&&-la<e&&e<la)return 0;const t=r-e;return t*t<HT*r*e?0:r<e?-1:1};class $T{constructor(){this.reset()}reset(){this.xRounder=new D0,this.yRounder=new D0}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class D0{constructor(){this.tree=new Fg,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&z0(t.key,n.key)===0)return this.tree.remove(e),n.key;const l=this.tree.next(t);return l!==null&&z0(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const vh=new $T,Xf=(r,e)=>r.x*e.y-r.y*e.x,_w=(r,e)=>r.x*e.x+r.y*e.y,R0=(r,e,t)=>{const n=ZT(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},md=r=>Math.sqrt(_w(r,r)),XT=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return Xf(l,n)/md(l)/md(n)},KT=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},l={x:t.x-r.x,y:t.y-r.y};return _w(l,n)/md(l)/md(n)},B0=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},F0=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},JT=(r,e,t,n)=>{if(e.x===0)return F0(t,n,r.x);if(n.x===0)return F0(r,e,t.x);if(e.y===0)return B0(t,n,r.y);if(n.y===0)return B0(r,e,t.y);const l=Xf(e,n);if(l==0)return null;const u={x:t.x-r.x,y:t.y-r.y},d=Xf(u,e)/l,a=Xf(u,n)/l,_=r.x+a*e.x,x=t.x+d*n.x,k=r.y+a*e.y,S=t.y+d*n.y,C=(_+x)/2,P=(k+S)/2;return{x:C,y:P}};class Mo{static compare(e,t){const n=Mo.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:ua.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,l=t.length;n<l;n++){const u=t[n];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&n.otherSE.point.events===u.otherSE.point.events&&n.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,n=l=>{const u=l.otherSE;t.set(l,{sine:XT(this.point,e.point,u.point),cosine:KT(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||n(l),t.has(u)||n(u);const{sine:d,cosine:a}=t.get(l),{sine:_,cosine:x}=t.get(u);return d>=0&&_>=0?a<x?1:a>x?-1:0:d<0&&_<0?a<x?-1:a>x?1:0:_<d?-1:_>d?1:0}}}let YT=0;class ua{static compare(e,t){const n=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,d=t.rightSE.point.x;if(d<n)return 1;if(u<l)return-1;const a=e.leftSE.point.y,_=t.leftSE.point.y,x=e.rightSE.point.y,k=t.rightSE.point.y;if(n<l){if(_<a&&_<x)return 1;if(_>a&&_>x)return-1;const S=e.comparePoint(t.leftSE.point);if(S<0)return 1;if(S>0)return-1;const C=t.comparePoint(e.rightSE.point);return C!==0?C:-1}if(n>l){if(a<_&&a<k)return-1;if(a>_&&a>k)return 1;const S=t.comparePoint(e.leftSE.point);if(S!==0)return S;const C=e.comparePoint(t.rightSE.point);return C<0?1:C>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(u<d){const S=t.comparePoint(e.rightSE.point);if(S!==0)return S}if(u>d){const S=e.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(u!==d){const S=x-a,C=u-n,P=k-_,D=d-l;if(S>C&&P<D)return 1;if(S<C&&P>D)return-1}return u>d?1:u<d||x<k?-1:x>k?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,l){this.id=++YT,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=l}static fromRing(e,t,n){let l,u,d;const a=Mo.comparePoints(e,t);if(a<0)l=e,u=t,d=1;else if(a>0)l=t,u=e,d=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new Mo(l,!0),x=new Mo(u,!1);return new ua(_,x,[n],[d])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,l=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,d=t.x+u*l.x;if(e.x===d)return 0;const a=(e.x-t.x)/l.x,_=t.y+a*l.y;return e.y===_?0:e.y<_?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),l=Hm(t,n);if(l===null)return null;const u=this.leftSE.point,d=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,x=ju(t,a)&&this.comparePoint(a)===0,k=ju(n,u)&&e.comparePoint(u)===0,S=ju(t,_)&&this.comparePoint(_)===0,C=ju(n,d)&&e.comparePoint(d)===0;if(k&&x)return C&&!S?d:!C&&S?_:null;if(k)return S&&u.x===_.x&&u.y===_.y?null:u;if(x)return C&&d.x===a.x&&d.y===a.y?null:a;if(C&&S)return null;if(C)return d;if(S)return _;const P=JT(u,this.vector(),a,e.vector());return P===null||!ju(l,P)?null:vh.round(P.x,P.y)}split(e){const t=[],n=e.events!==void 0,l=new Mo(e,!0),u=new Mo(e,!1),d=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const a=new ua(l,d,this.rings.slice(),this.windings.slice());return Mo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Mo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const l=ua.compare(t,n);if(l!==0){if(l>0){const u=t;t=n,n=u}if(t.prev===n){const u=t;t=n,n=u}for(let u=0,d=n.rings.length;u<d;u++){const a=n.rings[u],_=n.windings[u],x=t.rings.indexOf(a);x===-1?(t.rings.push(a),t.windings.push(_)):t.windings[x]+=_}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,l=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const x=this.rings[a],k=this.windings[a],S=t.indexOf(x);S===-1?(t.push(x),n.push(k)):n[S]+=k}const u=[],d=[];for(let a=0,_=t.length;a<_;a++){if(n[a]===0)continue;const x=t[a],k=x.poly;if(d.indexOf(k)===-1)if(x.isExterior)u.push(k);else{d.indexOf(k)===-1&&d.push(k);const S=u.indexOf(x.poly);S!==-1&&u.splice(S,1)}}for(let a=0,_=u.length;a<_;a++){const x=u[a].multiPoly;l.indexOf(x)===-1&&l.push(x)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Wo.type){case"union":{const n=e.length===0,l=t.length===0;this._isInResult=n!==l;break}case"intersection":{let n,l;e.length<t.length?(n=e.length,l=t.length):(n=t.length,l=e.length),this._isInResult=l===Wo.numMultiPolys&&n<l;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=l=>l.length===1&&l[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${Wo.type}`)}return this._isInResult}}class O0{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=vh.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let d=1,a=e.length;d<a;d++){if(typeof e[d][0]!="number"||typeof e[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let _=vh.round(e[d][0],e[d][1]);_.x===u.x&&_.y===u.y||(this.segments.push(ua.fromRing(u,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),u=_)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(ua.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class QT{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new O0(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,l=e.length;n<l;n++){const u=new O0(e[n],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class N0{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,l=e.length;n<l;n++){const u=new QT(e[n],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class gd{static factory(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.isInResult()||u.ringOut)continue;let d=null,a=u.leftSE,_=u.rightSE;const x=[a],k=a.point,S=[];for(;d=a,a=_,x.push(a),a.point!==k;)for(;;){const C=a.getAvailableLinkedEvents();if(C.length===0){const O=x[0].point,z=x[x.length-1].point;throw new Error(`Unable to complete output ring starting at [${O.x}, ${O.y}]. Last matching segment found ends at [${z.x}, ${z.y}].`)}if(C.length===1){_=C[0].otherSE;break}let P=null;for(let O=0,z=S.length;O<z;O++)if(S[O].point===a.point){P=O;break}if(P!==null){const O=S.splice(P)[0],z=x.splice(O.index);z.unshift(z[0].otherSE),t.push(new gd(z.reverse()));continue}S.push({index:x.length,point:a.point});const D=a.getLeftmostComparator(d);_=C.sort(D)[0].otherSE;break}t.push(new gd(x))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let x=1,k=this.events.length-1;x<k;x++){const S=this.events[x].point,C=this.events[x+1].point;R0(S,e,C)!==0&&(t.push(S),e=S)}if(t.length===1)return null;const n=t[0],l=t[1];R0(n,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,_=[];for(let x=d;x!=a;x+=u)_.push([t[x].x,t[x].y]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const d=this.events[l];Mo.compare(e,d)>0&&(e=d)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class j0{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class eE{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let n=0,l=e.length;n<l;n++){const u=e[n];if(!u.poly)if(u.isExteriorRing())t.push(new j0(u));else{const d=u.enclosingRing();d.poly||t.push(new j0(d)),d.poly.addInterior(u)}}return t}}class tE{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ua.compare;this.queue=e,this.tree=new Fg(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,d=l,a,_;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;_===void 0;)d=this.tree.next(d),d===null?_=null:d.key.consumedBy===void 0&&(_=d.key);if(e.isLeft){let x=null;if(a){const S=a.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(x=S),!a.isAnEndpoint(S))){const C=this._splitSafely(a,S);for(let P=0,D=C.length;P<D;P++)n.push(C[P])}}let k=null;if(_){const S=_.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(k=S),!_.isAnEndpoint(S))){const C=this._splitSafely(_,S);for(let P=0,D=C.length;P<D;P++)n.push(C[P])}}if(x!==null||k!==null){let S=null;x===null?S=k:k===null?S=x:S=Mo.comparePoints(x,k)<=0?x:k,this.queue.remove(t.rightSE),n.push(t.rightSE);const C=t.split(S);for(let P=0,D=C.length;P<D;P++)n.push(C[P])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&_){const x=a.getIntersection(_);if(x!==null){if(!a.isAnEndpoint(x)){const k=this._splitSafely(a,x);for(let S=0,C=k.length;S<C;S++)n.push(k[S])}if(!_.isAnEndpoint(x)){const k=this._splitSafely(_,x);for(let S=0,C=k.length;S<C;S++)n.push(k[S])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const l=e.split(t);return l.push(n),e.consumedBy===void 0&&this.tree.add(e),l}}const U0=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,rE=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class nE{run(e,t,n){Wo.type=e,vh.reset();const l=[new N0(t,!0)];for(let k=0,S=n.length;k<S;k++)l.push(new N0(n[k],!1));if(Wo.numMultiPolys=l.length,Wo.type==="difference"){const k=l[0];let S=1;for(;S<l.length;)Hm(l[S].bbox,k.bbox)!==null?S++:l.splice(S,1)}if(Wo.type==="intersection")for(let k=0,S=l.length;k<S;k++){const C=l[k];for(let P=k+1,D=l.length;P<D;P++)if(Hm(C.bbox,l[P].bbox)===null)return[]}const u=new Fg(Mo.compare);for(let k=0,S=l.length;k<S;k++){const C=l[k].getSweepEvents();for(let P=0,D=C.length;P<D;P++)if(u.insert(C[P]),u.size>U0)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const d=new tE(u);let a=u.size,_=u.pop();for(;_;){const k=_.key;if(u.size===a){const C=k.segment;throw new Error(`Unable to pop() ${k.isLeft?"left":"right"} SweepEvent [${k.point.x}, ${k.point.y}] from segment #${C.id} [${C.leftSE.point.x}, ${C.leftSE.point.y}] -> [${C.rightSE.point.x}, ${C.rightSE.point.y}] from queue.`)}if(u.size>U0)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(d.segments.length>rE)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=d.process(k);for(let C=0,P=S.length;C<P;C++){const D=S[C];D.consumedBy===void 0&&u.insert(D)}a=u.size,_=u.pop()}vh.reset();const x=gd.factory(d.segments);return new eE(x).getGeom()}}const Wo=new nE,iE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Wo.run("union",r,t)},oE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Wo.run("intersection",r,t)},sE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Wo.run("xor",r,t)},aE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return Wo.run("difference",r,t)};var yw={union:iE,intersection:oE,xor:sE,difference:aE};function vw(r,e,t){if(r!==null)for(var n,l,u,d,a,_,x,k=0,S=0,C,P=r.type,D=P==="FeatureCollection",O=P==="Feature",z=D?r.features.length:1,B=0;B<z;B++){x=D?r.features[B].geometry:O?r.geometry:r,C=x?x.type==="GeometryCollection":!1,a=C?x.geometries.length:1;for(var N=0;N<a;N++){var G=0,U=0;if(d=C?x.geometries[N]:x,d!==null){_=d.coordinates;var te=d.type;switch(k=0,te){case null:break;case"Point":if(e(_,S,B,G,U)===!1)return!1;S++,G++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(e(_[n],S,B,G,U)===!1)return!1;S++,te==="MultiPoint"&&G++}te==="LineString"&&G++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(l=0;l<_[n].length-k;l++){if(e(_[n][l],S,B,G,U)===!1)return!1;S++}te==="MultiLineString"&&G++,te==="Polygon"&&U++}te==="Polygon"&&G++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(U=0,l=0;l<_[n].length;l++){for(u=0;u<_[n][l].length-k;u++){if(e(_[n][l][u],S,B,G,U)===!1)return!1;S++}U++}G++}break;case"GeometryCollection":for(n=0;n<d.geometries.length;n++)if(vw(d.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Og(r,e){var t,n,l,u,d,a,_,x,k,S,C=0,P=r.type==="FeatureCollection",D=r.type==="Feature",O=P?r.features.length:1;for(t=0;t<O;t++){for(a=P?r.features[t].geometry:D?r.geometry:r,x=P?r.features[t].properties:D?r.properties:{},k=P?r.features[t].bbox:D?r.bbox:void 0,S=P?r.features[t].id:D?r.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,C,x,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,C,x,k,S)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<u.geometries.length;n++)if(e(u.geometries[n],C,x,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}C++}}function lE(r,e){Og(r,function(t,n,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(_h(t,l,{bbox:u,id:d}),n,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var x=0;x<t.coordinates.length;x++){var k=t.coordinates[x],S={type:_,coordinates:k};if(e(_h(S,l),n,x)===!1)return!1}})}function cE(r,e={}){const t=[];if(Og(r,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=yw.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?Bg(n[0],e.properties):gw(n,e.properties)}var bw=cE;function uE(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return vw(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var V0=uE;function hE(r){const e=[];if(Og(r,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=yw.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?Bg(n[0],t):gw(n,t)}var fE=hE;function dE(r){if(!r)throw new Error("geojson is required");var e=[];return lE(r,function(t){e.push(t)}),yh(e)}var pE=dE;function q0(r,e){const t=fE(yh([Bg([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=pd(V0(r)),l=(n[2]-n[0])/360/1e3,u=n[0]<-180,d=n[2]>180,a=pE(r);if(a.features.length>1&&(u||d))for(const _ of a.features){const x=pd(V0(_));if(d&&x[0]<-180+l)for(const k of _.geometry.coordinates)for(const S of k)S[0]+=360-l;if(u&&x[2]>180-l)for(const k of _.geometry.coordinates)for(const S of k)S[0]-=360-l}e(yh([a.features.length<2?r:bw(a)??r,t]))}const G0={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Of="mtlr-gc-full-geom",W0="mtlr-gc-full-geom-fill",Z0="mtlr-gc-full-geom-line";function ww(r,e,t=!0,n=!0,l={},u={},d=G0){let a;const _=[];let x,k,S;function C(){if(!r.loaded){r.once("load",C);return}const z=d?d===!0?G0:d:void 0;if(!(z!=null&&z.fill)&&!(z!=null&&z.line))return;const B=r.getSource(Of);if(B)B.setData(S??yh([]));else if(S)r.addSource(Of,{type:"geojson",data:S});else return;!r.getLayer(W0)&&z!=null&&z.fill&&r.addLayer({...z==null?void 0:z.fill,id:W0,type:"fill",source:Of}),!r.getLayer(Z0)&&z!=null&&z.line&&r.addLayer({...z==null?void 0:z.line,id:Z0,type:"line",source:Of})}function P(z){S=z,C()}r.on("styledata",()=>{setTimeout(()=>{S&&C()})});const D=z=>{a==null||a({type:"mapClick",coordinates:[z.lngLat.lng,z.lngLat.lat]})};function O(z=!1){if(!e)throw new Error;const B=document.createElement("div");return z&&B.classList.add("marker-interactive"),new cT({props:{displayIn:"maplibre"},target:B}),new e.Marker({element:B,offset:[1,-13]})}return{setEventHandler(z){z?(a=z,r.on("click",D)):(a=void 0,r.off("click",D))},flyTo(z,B){r.flyTo({center:z,...B?{zoom:B}:{},...l})},fitBounds(z,B,N){r.fitBounds([[z[0],z[1]],[z[2],z[3]]],{padding:B,...N?{maxZoom:N}:{},...u})},indicateReverse(z){r.getCanvasContainer().style.cursor=z?"crosshair":""},setReverseMarker(z){!e||!t||(k?z?k.setLngLat(z):(k.remove(),k=void 0):z&&(t instanceof Function?k=t(r)??void 0:(k=(typeof t=="object"?new e.Marker(t):O()).setLngLat(z).addTo(r),k.getElement().classList.add("marker-reverse"))))},setFeatures(z,B,N){for(const G of _)G.remove();if(_.length=0,P(void 0),!!e){if(B){let G=!1;if(B.geometry.type==="GeometryCollection"){const U=B.geometry.geometries.filter(te=>te.type==="Polygon"||te.type==="MultiPolygon");e:if(U.length>0){const te=bw(yh(U.map(le=>_h(le))));if(!te)break e;q0({...B,geometry:te.geometry},P),G=!0}else{const te=B.geometry.geometries.filter(le=>le.type==="LineString"||le.type==="MultiLineString");te.length>0&&(P({...B,geometry:{type:"GeometryCollection",geometries:te}}),G=!0)}}if(!G){if(B.geometry.type==="Polygon"||B.geometry.type==="MultiPolygon")q0(B,P);else if(B.geometry.type==="LineString"||B.geometry.type==="MultiLineString"){P(B);return}}if(!N&&B.geometry.type!=="Point")return;if(t instanceof Function){const U=t(r,B);U&&_.push(U)}else t&&_.push(typeof t=="object"?new e.Marker(t):O().setLngLat(B.center).addTo(r))}if(n)for(const G of z??[]){if(G===B)continue;let U;if(n instanceof Function){if(U=n(r,G),!U)continue}else U=(typeof n=="object"?new e.Marker(n):O(!0)).setLngLat(G.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(G.place_type[0]==="reverse"?G.place_name:G.place_name.replace(/,.*/,""))).addTo(r);const te=U.getElement();te.addEventListener("click",le=>{le.stopPropagation(),a==null||a({type:"markerClick",id:G.id})}),te.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:G.id}),U.togglePopup()}),te.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:G.id}),U.togglePopup()}),_.push(U)}}},setSelectedMarker(z){x&&x.getElement().classList.toggle("marker-selected",!1),x=z>-1?_[z]:void 0,x==null||x.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const z=r.getCenter();return[r.getZoom(),z.lng,z.lat]}}}function mE(r,e,t){var n,l;class u{constructor(z,B){fo(this,"type"),fo(this,"target"),this.type=B,this.target=z}}class d extends u{constructor(z,B){super(z,"select"),fo(this,"feature"),Object.assign(this,B)}}class a extends u{constructor(z,B){super(z,"featureslisted"),fo(this,"features"),this.features=B}}class _ extends u{constructor(z,B){super(z,"featuresmarked"),fo(this,"features"),this.features=B}}class x extends u{constructor(z,B){super(z,"optionsvisibilitychange"),fo(this,"optionsVisible"),this.optionsVisible=B}}class k extends u{constructor(z,B){super(z,"pick"),fo(this,"feature"),this.feature=B}}class S extends u{constructor(z,B){super(z,"querychange"),fo(this,"query"),this.query=B}}class C extends u{constructor(z,B,N){super(z,"response"),fo(this,"url"),fo(this,"featureCollection"),this.url=B,this.featureCollection=N}}class P extends u{constructor(z,B){super(z,"reversetoggle"),fo(this,"reverse"),this.reverse=B}}class D extends r{constructor(z={}){super(),c0(this,n),c0(this,l),u0(this,l,z)}onAddInt(z){const B=document.createElement("div");B.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:N,showResultMarkers:G,flyTo:U,fullGeometryStyle:te,...le}=Qn(this,l),$=typeof U=="boolean"?{}:U,J={mapController:ww(z,e,N,G,$,$,te),flyTo:U===void 0?!0:!!U,apiKey:"",...t==null?void 0:t(z,B),...le};if(!J.apiKey)throw new Error("no apiKey provided");return u0(this,n,new zT({target:B,props:J})),Qn(this,n).$on("select",_e=>{this.fire(new d(this,_e.detail))}),Qn(this,n).$on("pick",_e=>{this.fire(new k(this,_e.detail.feature))}),Qn(this,n).$on("featureslisted",_e=>{this.fire(new a(this,_e.detail.features))}),Qn(this,n).$on("featuresmarked",_e=>{this.fire(new _(this,_e.detail.features))}),Qn(this,n).$on("response",_e=>{this.fire(new C(this,_e.detail.url,_e.detail.featureCollection))}),Qn(this,n).$on("optionsvisibilitychange",_e=>{this.fire(new x(this,_e.detail.optionsVisible))}),Qn(this,n).$on("reversetoggle",_e=>{this.fire(new P(this,_e.detail.reverse))}),Qn(this,n).$on("querychange",_e=>{this.fire(new S(this,_e.detail.query))}),B}on(z,B){return super.on(z,B)}once(z,B){return super.once(z,B)}off(z,B){return super.off(z,B)}listens(z){return super.listens(z)}setOptions(z){var B;Object.assign(Qn(this,l),z);const{marker:N,showResultMarkers:G,flyTo:U,fullGeometryStyle:te,...le}=Qn(this,l);(B=Qn(this,n))==null||B.$set(le)}setQuery(z,B=!0){var N;(N=Qn(this,n))==null||N.setQuery(z,B)}clearMap(){var z;(z=Qn(this,n))==null||z.clearMap()}clearList(){var z;(z=Qn(this,n))==null||z.clearList()}setReverseMode(z){var B;(B=Qn(this,n))==null||B.$set({reverseActive:z})}focus(){var z;(z=Qn(this,n))==null||z.focus()}blur(){var z;(z=Qn(this,n))==null||z.blur()}onRemove(){var z;(z=Qn(this,n))==null||z.$destroy()}}return n=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:D,events:{SelectEvent:d,FeaturesListedEvent:a,FeaturesMarkedEvent:_,OptionsVisibilityChangeEvent:x,PickEvent:k,QueryChangeEvent:S,ResponseEvent:C,ReverseToggleEvent:P}}}const{MapLibreBasedGeocodingControl:ND,events:va}=mE(Pc.Evented,uk);va.SelectEvent;va.FeaturesListedEvent;va.FeaturesMarkedEvent;va.OptionsVisibilityChangeEvent;va.PickEvent;va.QueryChangeEvent;va.ResponseEvent;va.ReverseToggleEvent;function gE(r){let e,t;return{c(){e=Ps("svg"),t=Ps("path"),Ee(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Ee(e,"viewBox","0 0 14 14"),Ee(e,"width","13"),Ee(e,"height","13"),Ee(e,"class","svelte-en2qvf")},m(n,l){be(n,e,l),ie(e,t)},p:It,i:It,o:It,d(n){n&&ve(e)}}}class xw extends Ht{constructor(e){super(),Zt(this,e,null,gE,jt,{})}}function _E(r){let e,t;return{c(){e=Ps("svg"),t=Ps("path"),Ee(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Ee(e,"viewBox","0 0 30 30"),Ee(e,"fill","none"),Ee(e,"xmlns","http://www.w3.org/2000/svg"),Ee(e,"class","svelte-d2loi5")},m(n,l){be(n,e,l),ie(e,t)},p:It,i:It,o:It,d(n){n&&ve(e)}}}class Sw extends Ht{constructor(e){super(),Zt(this,e,null,_E,jt,{})}}function yE(r){let e,t;return{c(){e=de("img"),En(e.src,t=r[3]+"area.svg")||Ee(e,"src",t),Ee(e,"alt",r[6]),Ee(e,"class","svelte-ltkwvy")},m(n,l){be(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"area.svg")&&Ee(e,"src",t),l&64&&Ee(e,"alt",n[6])},d(n){n&&ve(e)}}}function vE(r){let e,t;return{c(){e=de("img"),En(e.src,t=r[3]+"reverse.svg")||Ee(e,"src",t),Ee(e,"alt",r[6]),Ee(e,"class","svelte-ltkwvy")},m(n,l){be(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"reverse.svg")&&Ee(e,"src",t),l&64&&Ee(e,"alt",n[6])},d(n){n&&ve(e)}}}function bE(r){let e,t;return{c(){e=de("img"),En(e.src,t=r[3]+"poi.svg")||Ee(e,"src",t),Ee(e,"alt",r[6]),Ee(e,"class","svelte-ltkwvy")},m(n,l){be(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"poi.svg")&&Ee(e,"src",t),l&64&&Ee(e,"alt",n[6])},d(n){n&&ve(e)}}}function wE(r){let e,t;return{c(){e=de("img"),En(e.src,t=r[3]+"postal_code.svg")||Ee(e,"src",t),Ee(e,"alt",r[6]),Ee(e,"class","svelte-ltkwvy")},m(n,l){be(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"postal_code.svg")&&Ee(e,"src",t),l&64&&Ee(e,"alt",n[6])},d(n){n&&ve(e)}}}function xE(r){let e,t;return{c(){e=de("img"),En(e.src,t=r[3]+"street.svg")||Ee(e,"src",t),Ee(e,"alt",r[6]),Ee(e,"class","svelte-ltkwvy")},m(n,l){be(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"street.svg")&&Ee(e,"src",t),l&64&&Ee(e,"alt",n[6])},d(n){n&&ve(e)}}}function SE(r){let e,t;return{c(){e=de("img"),En(e.src,t=r[3]+"road.svg")||Ee(e,"src",t),Ee(e,"alt",r[6]),Ee(e,"class","svelte-ltkwvy")},m(n,l){be(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"road.svg")&&Ee(e,"src",t),l&64&&Ee(e,"alt",n[6])},d(n){n&&ve(e)}}}function kE(r){let e,t;return{c(){e=de("img"),En(e.src,t=r[3]+"housenumber.svg")||Ee(e,"src",t),Ee(e,"alt",r[6]),Ee(e,"class","svelte-ltkwvy")},m(n,l){be(n,e,l)},p(n,l){l&8&&!En(e.src,t=n[3]+"housenumber.svg")&&Ee(e,"src",t),l&64&&Ee(e,"alt",n[6])},d(n){n&&ve(e)}}}function TE(r){let e,t,n,l;return{c(){e=de("img"),En(e.src,t=r[5])||Ee(e,"src",t),Ee(e,"alt",r[4]),Ee(e,"class","svelte-ltkwvy")},m(u,d){be(u,e,d),n||(l=Et(e,"error",r[14]),n=!0)},p(u,d){d&32&&!En(e.src,t=u[5])&&Ee(e,"src",t),d&16&&Ee(e,"alt",u[4])},d(u){u&&ve(e),n=!1,l()}}}function H0(r){let e,t;return{c(){e=de("span"),t=tt(r[6]),Ee(e,"class","secondary svelte-ltkwvy")},m(n,l){be(n,e,l),ie(e,t)},p(n,l){l&64&&Lr(t,n[6])},d(n){n&&ve(e)}}}function EE(r){let e,t,n,l,u,d,a,_,x,k=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",S,C,P=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],D,O,z=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,N,G;function U(J,_e){return _e&1&&(t=null),_e&1&&(n=null),_e&1&&(l=null),_e&1&&(u=null),J[5]?TE:J[0].address?kE:(t==null&&(t=!!J[0].id.startsWith("road.")),t?SE:(n==null&&(n=!!J[0].id.startsWith("address.")),n?xE:(l==null&&(l=!!J[0].id.startsWith("postal_code.")),l?wE:(u==null&&(u=!!J[0].id.startsWith("poi.")),u?bE:J[7]?vE:yE))))}let te=U(r,-1),le=te(r),$=P&&H0(r);return{c(){e=de("li"),le.c(),d=Ue(),a=de("span"),_=de("span"),x=de("span"),S=tt(k),C=Ue(),$&&$.c(),D=Ue(),O=de("span"),B=tt(z),Ee(x,"class","primary svelte-ltkwvy"),Ee(_,"class","svelte-ltkwvy"),Ee(O,"class","line2 svelte-ltkwvy"),Ee(a,"class","texts svelte-ltkwvy"),Ee(e,"tabindex","0"),Ee(e,"data-selected",r[1]),Ee(e,"class","svelte-ltkwvy"),hi(e,"selected",r[1])},m(J,_e){be(J,e,_e),le.m(e,null),ie(e,d),ie(e,a),ie(a,_),ie(_,x),ie(x,S),ie(_,C),$&&$.m(_,null),ie(a,D),ie(a,O),ie(O,B),N||(G=[Et(e,"mouseenter",r[12]),Et(e,"focus",r[13])],N=!0)},p(J,[_e]){te===(te=U(J,_e))&&le?le.p(J,_e):(le.d(1),le=te(J),le&&(le.c(),le.m(e,d))),_e&1&&k!==(k=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&Lr(S,k),_e&37&&(P=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),P?$?$.p(J,_e):($=H0(J),$.c(),$.m(_,null)):$&&($.d(1),$=null),_e&1&&z!==(z=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Lr(B,z),_e&2&&Ee(e,"data-selected",J[1]),_e&2&&hi(e,"selected",J[1])},i:It,o:It,d(J){J&&ve(e),le.d(),$&&$.d(),N=!1,_n(G)}}}function ME(r,e,t){var G;let n,l,{feature:u}=e,{selected:d=!1}=e,{showPlaceType:a}=e,{missingIconsCache:_}=e,{iconsBaseUrl:x}=e;const k=(G=u.properties)==null?void 0:G.categories;let S,C,P=0,D=u.place_type[0]==="reverse";function O(){C&&_.add(C),t(10,P++,P)}function z(U){ur.call(this,r,U)}function B(U){ur.call(this,r,U)}const N=()=>O();return r.$$set=U=>{"feature"in U&&t(0,u=U.feature),"selected"in U&&t(1,d=U.selected),"showPlaceType"in U&&t(2,a=U.showPlaceType),"missingIconsCache"in U&&t(9,_=U.missingIconsCache),"iconsBaseUrl"in U&&t(3,x=U.iconsBaseUrl)},r.$$.update=()=>{var U,te,le,$;if(r.$$.dirty&3640)do t(11,n--,n),t(4,S=k==null?void 0:k[n]),t(5,C=S?x+S.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!C||_.has(C)));r.$$.dirty&1&&t(6,l=((te=(U=u.properties)==null?void 0:U.categories)==null?void 0:te.join(", "))??(($=(le=u.properties)==null?void 0:le.place_type_name)==null?void 0:$[0])??u.place_type[0])},t(11,n=(k==null?void 0:k.length)??0),[u,d,a,x,S,C,l,D,O,_,P,n,z,B,N]}class CE extends Ht{constructor(e){super(),Zt(this,e,ME,EE,jt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function IE(r){let e;return{c(){e=de("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Ee(e,"class","svelte-7cmwmc")},m(t,n){be(t,e,n)},p:It,i:It,o:It,d(t){t&&ve(e)}}}class AE extends Ht{constructor(e){super(),Zt(this,e,null,IE,jt,{})}}function LE(r){let e,t;return{c(){e=Ps("svg"),t=Ps("path"),Ee(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Ee(e,"viewBox","0 0 60.006 21.412"),Ee(e,"width","14"),Ee(e,"height","20"),Ee(e,"class","svelte-en2qvf")},m(n,l){be(n,e,l),ie(e,t)},p:It,i:It,o:It,d(n){n&&ve(e)}}}class PE extends Ht{constructor(e){super(),Zt(this,e,null,LE,jt,{})}}function zE(r){let e,t,n;return{c(){e=Ps("svg"),t=Ps("circle"),n=Ps("path"),Ee(t,"cx","4.789"),Ee(t,"cy","4.787"),Ee(t,"r","3.85"),Ee(t,"class","svelte-1aq105l"),Ee(n,"d","M12.063 12.063 7.635 7.635"),Ee(n,"class","svelte-1aq105l"),Ee(e,"xmlns","http://www.w3.org/2000/svg"),Ee(e,"width","13"),Ee(e,"height","13"),Ee(e,"viewBox","0 0 13 13"),Ee(e,"class","svelte-1aq105l")},m(l,u){be(l,e,u),ie(e,t),ie(e,n)},p:It,i:It,o:It,d(l){l&&ve(e)}}}class DE extends Ht{constructor(e){super(),Zt(this,e,null,zE,jt,{})}}function RE(r,e,t){const n=e[1],l=e[0],u=n-l;return r===n&&t?r:((r-l)%u+u)%u+l}function $0(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Uu;async function BE(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const l of e??[])if(!(n&&(l.minZoom!=null&&l.minZoom>n[0]||l.maxZoom!=null&&l.maxZoom<n[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(Uu&&l.cachedLocationExpiry&&Uu.time+l.cachedLocationExpiry>Date.now()){if(!Uu.coords)break e;return Uu.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(x=>x.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(Uu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(n&&l.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const FE=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,X0=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,K0=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,J0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,Y0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,Q0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function OE(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(P=>Number(P.trim())),t=Number(e[0]),n=Number(e[1]),l=Math.abs(t),u=Math.abs(n),d=t>0?"N":"S",a=n>0?"E":"W";let _;r=="DD"&&(_=`${l} ${d}, ${u} ${a}`);const x=Math.floor(l),k=Math.floor(u),S=(l-x)*60,C=(u-k)*60;if(r=="DM"){let P=e1(S,3).toFixed(3).padStart(6,"0"),D=e1(C,3).toFixed(3).padStart(6,"0");P.endsWith(".000")&&D.endsWith(".000")&&(P=P.replace(/\.000$/,""),D=D.replace(/\.000$/,"")),_=`${x} ${P}' ${d}, ${k} ${D}' ${a}`}if(r=="DMS"){const P=Math.floor(S),D=Math.floor(C);let O=((S-P)*60).toFixed(1).padStart(4,"0"),z=((C-D)*60).toFixed(1).padStart(4,"0");const B=P.toString().padStart(2,"0"),N=D.toString().padStart(2,"0");O.endsWith(".0")&&z.endsWith(".0")&&(O=O.replace(/\.0$/,""),z=z.replace(/\.0$/,"")),_=`${x} ${B}' ${O}" ${d}, ${k} ${N}' ${z}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function e1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Ng(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,l="",u="",d=null,a=[],_=!1;if(FE.test(r))throw new Error("invalid coordinate value");if(X0.test(r))if(a=X0.exec(r),_=Vu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),d="DM";else throw new Error("invalid coordinate format");else if(K0.test(r))if(a=K0.exec(r),_=Vu(a),_){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(J0.test(r))if(a=J0.exec(r),_=Vu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(Y0.test(r))if(a=Y0.exec(r),_=Vu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(Q0.test(r)){if(a=Q0.exec(r),_=Vu(a),a.filter(x=>x).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let x=/S|SOUTH/i;x.test(l)&&t>0&&(t=-1*t),x=/W|WEST/i,x.test(u)&&n>0&&(n=-1*n);const k=a[0].trim();let S,C;const P=/[,/;\u0020]/g,D=k.match(P);if(D==null){const B=Math.floor(r.length/2);S=k.substring(0,B).trim(),C=k.substring(B).trim()}else{let B;D.length%2==1?B=Math.floor(D.length/2):B=D.length/2-1;let N=0;if(B==0)N=k.indexOf(D[0]),S=k.substring(0,N).trim(),C=k.substring(N+1).trim();else{let G=0,U=0;for(;G<=B;)N=k.indexOf(D[G],U),U=N+1,G++;S=k.substring(0,N).trim(),C=k.substring(N+1).trim()}}const O=S.split(".");if(O.length==2&&O[1]==0&&O[1].length!=2)throw new Error("invalid coordinates format");const z=C.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(C))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:C,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:d,closeEnough:NE,toCoordinateFormat:OE})}else throw new Error("coordinates pattern match failed")}function Vu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),x=n.test(d)&&n.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||x||k)continue;return!1}}return!0}function t1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function NE(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return t1(this.decimalLatitude,Number(e[0]))&&t1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const jE=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Ng.to=jE;const UE=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],VE={decimalLatitude:40.123,decimalLongitude:-74.123},qE=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],GE=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function WE(){const r=[];return UE.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...VE})}),[...r,...qE,...GE]}const ZE=WE();Ng.formats=ZE.map(r=>r.verbatimCoordinates);const HE=Ng;function r1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function n1(r){let e,t;return e=new AE({}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function i1(r){let e,t,n,l,u;return t=new PE({}),{c(){e=de("button"),Ve(t.$$.fragment),Ee(e,"type","button"),Ee(e,"title",r[9]),Ee(e,"class","svelte-bz0zu3"),hi(e,"active",r[0])},m(d,a){be(d,e,a),Ne(t,e,null),n=!0,l||(u=Et(e,"click",r[69]),l=!0)},p(d,a){(!n||a[0]&512)&&Ee(e,"title",d[9]),(!n||a[0]&1)&&hi(e,"active",d[0])},i(d){n||(oe(t.$$.fragment,d),n=!0)},o(d){pe(t.$$.fragment,d),n=!1},d(d){d&&ve(e),je(t),l=!1,u()}}}function $E(r){let e,t=[],n=new Map,l,u,d,a=Jn(r[14]);const _=x=>x[84].id+(x[84].address?","+x[84].address:"");for(let x=0;x<a.length;x+=1){let k=r1(r,a,x),S=_(k);n.set(S,t[x]=o1(S,k))}return{c(){e=de("ul");for(let x=0;x<t.length;x+=1)t[x].c();Ee(e,"class","options svelte-bz0zu3")},m(x,k){be(x,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[Et(e,"mouseleave",r[73]),Et(e,"blur",r[74])],u=!0)},p(x,k){k[0]&17880064&&(a=Jn(x[14]),vr(),t=WS(t,k,_,1,x,a,n,e,GS,o1,null,r1),br())},i(x){if(!l){for(let k=0;k<a.length;k+=1)oe(t[k]);l=!0}},o(x){for(let k=0;k<t.length;k+=1)pe(t[k]);l=!1},d(x){x&&ve(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,_n(d)}}}function XE(r){let e,t,n,l,u,d;return t=new Sw({}),{c(){e=de("div"),Ve(t.$$.fragment),n=Ue(),l=de("div"),u=tt(r[7]),Ee(l,"class","svelte-bz0zu3"),Ee(e,"class","no-results svelte-bz0zu3")},m(a,_){be(a,e,_),Ne(t,e,null),ie(e,n),ie(e,l),ie(l,u),d=!0},p(a,_){(!d||_[0]&128)&&Lr(u,a[7])},i(a){d||(oe(t.$$.fragment,a),d=!0)},o(a){pe(t.$$.fragment,a),d=!1},d(a){a&&ve(e),je(t)}}}function KE(r){let e="",t;return{c(){t=tt(e)},m(n,l){be(n,t,l)},p:It,i:It,o:It,d(n){n&&ve(t)}}}function JE(r){let e,t,n,l,u,d,a,_,x,k,S;return t=new Sw({}),_=new xw({}),{c(){e=de("div"),Ve(t.$$.fragment),n=Ue(),l=de("div"),u=tt(r[6]),d=Ue(),a=de("button"),Ve(_.$$.fragment),Ee(l,"class","svelte-bz0zu3"),Ee(a,"class","svelte-bz0zu3"),Ee(e,"class","error svelte-bz0zu3")},m(C,P){be(C,e,P),Ne(t,e,null),ie(e,n),ie(e,l),ie(l,u),ie(e,d),ie(e,a),Ne(_,a,null),x=!0,k||(S=Et(a,"click",r[70]),k=!0)},p(C,P){(!x||P[0]&64)&&Lr(u,C[6])},i(C){x||(oe(t.$$.fragment,C),oe(_.$$.fragment,C),x=!0)},o(C){pe(t.$$.fragment,C),pe(_.$$.fragment,C),x=!1},d(C){C&&ve(e),je(t),je(_),k=!1,S()}}}function o1(r,e){let t,n,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return n=new CE({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",u),n.$on("focus",d),{key:r,first:null,c(){t=$n(),Ve(n.$$.fragment),this.first=t},m(a,_){be(a,t,_),Ne(n,a,_),l=!0},p(a,_){e=a;const x={};_[0]&16384&&(x.feature=e[84]),_[0]&1024&&(x.showPlaceType=e[10]),_[0]&49152&&(x.selected=e[15]===e[86]),_[0]&4096&&(x.iconsBaseUrl=e[12]),n.$set(x)},i(a){l||(oe(n.$$.fragment,a),l=!0)},o(a){pe(n.$$.fragment,a),l=!1},d(a){a&&ve(t),je(n,a)}}}function YE(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D,O,z,B,N,G,U,te,le=!1;u=new DE({}),S=new xw({});let $=r[19]&&n1(),J=r[5]==="button"&&i1(r);const _e=r[61].default,ze=Vr(_e,r,r[60],null),re=[JE,KE,XE,$E],ue=[];function He(Me,ut){var At,Nt;return Me[18]?0:Me[16]?((At=Me[14])==null?void 0:At.length)===0?2:Me[16]&&((Nt=Me[14])!=null&&Nt.length)?3:-1:1}return~(z=He(r))&&(B=ue[z]=re[z](r)),{c(){e=Ue(),t=de("form"),n=de("div"),l=de("button"),Ve(u.$$.fragment),d=Ue(),a=de("input"),_=Ue(),x=de("div"),k=de("button"),Ve(S.$$.fragment),C=Ue(),$&&$.c(),P=Ue(),J&&J.c(),D=Ue(),ze&&ze.c(),O=Ue(),B&&B.c(),Ee(l,"class","search-button svelte-bz0zu3"),Ee(l,"type","button"),Ee(a,"placeholder",r[8]),Ee(a,"aria-label",r[8]),Ee(a,"class","svelte-bz0zu3"),Ee(k,"type","button"),Ee(k,"title",r[3]),Ee(k,"class","svelte-bz0zu3"),Ee(x,"class","clear-button-container svelte-bz0zu3"),hi(x,"displayable",r[1]!==""),Ee(n,"class","input-group svelte-bz0zu3"),Ee(t,"tabindex","0"),Ee(t,"class",N=sd(r[2])+" svelte-bz0zu3"),hi(t,"can-collapse",r[4]&&r[1]==="")},m(Me,ut){be(Me,e,ut),be(Me,t,ut),ie(t,n),ie(n,l),Ne(u,l,null),ie(n,d),ie(n,a),r[63](a),ei(a,r[1]),ie(n,_),ie(n,x),ie(x,k),Ne(S,k,null),ie(x,C),$&&$.m(x,null),ie(n,P),J&&J.m(n,null),ie(n,D),ze&&ze.m(n,null),ie(t,O),~z&&ue[z].m(t,null),G=!0,U||(te=[Et(l,"click",r[62]),Et(a,"input",r[64]),Et(a,"focus",r[65]),Et(a,"blur",r[66]),Et(a,"keydown",r[22]),Et(a,"input",r[67]),Et(k,"click",r[68]),Et(t,"submit",wg(r[21]))],U=!0)},p(Me,ut){(!G||ut[0]&256)&&Ee(a,"placeholder",Me[8]),(!G||ut[0]&256)&&Ee(a,"aria-label",Me[8]),ut[0]&2&&a.value!==Me[1]&&ei(a,Me[1]),(!G||ut[0]&8)&&Ee(k,"title",Me[3]),Me[19]?$?ut[0]&524288&&oe($,1):($=n1(),$.c(),oe($,1),$.m(x,null)):$&&(vr(),pe($,1,1,()=>{$=null}),br()),(!G||ut[0]&2)&&hi(x,"displayable",Me[1]!==""),Me[5]==="button"?J?(J.p(Me,ut),ut[0]&32&&oe(J,1)):(J=i1(Me),J.c(),oe(J,1),J.m(n,D)):J&&(vr(),pe(J,1,1,()=>{J=null}),br()),ze&&ze.p&&(!G||ut[1]&536870912)&&Gr(ze,_e,Me,Me[60],G?qr(_e,Me[60],ut,null):Wr(Me[60]),null);let At=z;z=He(Me),z===At?~z&&ue[z].p(Me,ut):(B&&(vr(),pe(ue[At],1,1,()=>{ue[At]=null}),br()),~z?(B=ue[z],B?B.p(Me,ut):(B=ue[z]=re[z](Me),B.c()),oe(B,1),B.m(t,null)):B=null),(!G||ut[0]&4&&N!==(N=sd(Me[2])+" svelte-bz0zu3"))&&Ee(t,"class",N),(!G||ut[0]&22)&&hi(t,"can-collapse",Me[4]&&Me[1]==="")},i(Me){G||(oe(le),oe(u.$$.fragment,Me),oe(S.$$.fragment,Me),oe($),oe(J),oe(ze,Me),oe(B),G=!0)},o(Me){pe(le),pe(u.$$.fragment,Me),pe(S.$$.fragment,Me),pe($),pe(J),pe(ze,Me),pe(B),G=!1},d(Me){Me&&(ve(e),ve(t)),je(u),r[63](null),je(S),$&&$.d(),J&&J.d(),ze&&ze.d(Me),~z&&ue[z].d(),U=!1,_n(te)}}}function QE(r,e,t){let n,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:x}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:C=!1}=e,{collapsed:P=!1}=e,{country:D=void 0}=e,{debounceSearch:O=200}=e,{enableReverse:z="never"}=e,{errorMessage:B="Something went wrong"}=e,{filter:N=()=>!0}=e,{flyTo:G=!0}=e,{fuzzyMatch:U=!0}=e,{language:te=void 0}=e,{limit:le=void 0}=e,{mapController:$=void 0}=e,{minLength:J=2}=e,{noResultsMessage:_e="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ze="Search"}=e,{proximity:re=[{type:"server-geolocation"}]}=e,{reverseActive:ue=z==="always"}=e,{reverseButtonTitle:He="toggle reverse geocoding"}=e,{searchValue:Me=""}=e,{pickedResultStyle:ut="full-geometry"}=e,{showPlaceType:At="if-needed"}=e,{showResultsWhileTyping:Nt=!0}=e,{selectFirst:Je=!0}=e,{flyToSelected:Jt=!1}=e,{markerOnSelected:Kt=!0}=e,{types:Ut=void 0}=e,{exhaustiveReverseGeocoding:Vt=!1}=e,{excludeTypes:wt=!1}=e,{zoom:Yt=a}=e,{apiUrl:gr="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Pt={}}=e,{iconsBaseUrl:rr="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:wr=()=>{}}=e;function mr(){Be.focus()}function Rr(){Be.blur()}function ht(W,Fe=!0,Oe=!1){t(1,Me=W),Fe?(t(15,Ze=-1),st()):(Qt(!Oe,Oe),setTimeout(()=>{Be.focus(),Be.select()}))}function Mt(){t(14,nt=void 0),t(56,ne=void 0),t(15,Ze=-1)}function De(){t(55,xt=[]),t(56,ne=void 0)}let lt=!1,nt,xt,ne,nr="",Be,Ze=-1,bt,bn=[],wn,Mn,ni,ii;const $o=new Set,Jr=us();ti(()=>{$&&($.setEventHandler(void 0),$.indicateReverse(!1),$.setSelectedMarker(-1),$.setFeatures(void 0,void 0,!1))});function st(W){if(Mn&&(clearTimeout(Mn),Mn=void 0),Ze>-1&&nt)t(56,ne=nt[Ze]),t(1,Me=ne.place_type[0]==="reverse"?ne.place_name:ne.place_name.replace(/,.*/,"")),t(18,bt=void 0),t(55,xt=void 0),t(15,Ze=-1);else if(Me){const Fe=W||!Xn(Me);xn(Me,{exact:!0}).then(()=>{t(55,xt=nt),t(56,ne=void 0),Fe&&Bo()}).catch(Oe=>t(18,bt=Oe))}}function Xn(W){try{return HE(W,6)}catch{return!1}}async function xn(W,{byId:Fe=!1,exact:Oe=!1}={}){t(18,bt=void 0),wn==null||wn.abort();const Ge=new AbortController;t(19,wn=Ge);try{const Ke=Xn(W),at=new URLSearchParams;if(te!==void 0&&at.set("language",Array.isArray(te)?te.join(","):te??""),Ut&&at.set("types",Ut.join(",")),wt&&at.set("excludeTypes",String(wt)),k&&at.set("bbox",k.map(_r=>_r.toFixed(6)).join(",")),D&&at.set("country",Array.isArray(D)?D.join(","):D),!Fe&&!Ke){const _r=await BE($,re,Ge);_r&&at.set("proximity",_r),(Oe||!Nt)&&at.set("autocomplete","false"),at.set("fuzzyMatch",String(U))}le!==void 0&&(Vt||!Ke||(Ut==null?void 0:Ut.length)===1)&&at.set("limit",String(le)),at.set("key",x),wr(at);const zt=gr+"/"+encodeURIComponent(Ke?Ke.decimalLongitude+","+Ke.decimalLatitude:W)+".json?"+at.toString();if(zt===nr){Fe?(t(14,nt=void 0),t(56,ne=bn[0])):t(14,nt=bn);return}nr=zt;const $t=await fetch(zt,{signal:Ge.signal,...Pt});if(!$t.ok)throw new Error(await $t.text());const ar=await $t.json();Jr("response",{url:zt,featureCollection:ar}),Fe?(t(14,nt=void 0),t(56,ne=ar.features[0]),bn=[ne]):(t(14,nt=ar.features.filter(N)),Ke&&nt.unshift({type:"Feature",properties:{},id:"reverse_"+Ke.decimalLongitude+"_"+Ke.decimalLatitude,text:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_name:Ke.decimalLatitude+", "+Ke.decimalLongitude,place_type:["reverse"],center:[Ke.decimalLongitude,Ke.decimalLatitude],bbox:[Ke.decimalLongitude,Ke.decimalLatitude,Ke.decimalLongitude,Ke.decimalLatitude],geometry:{type:"Point",coordinates:[Ke.decimalLongitude,Ke.decimalLatitude]}}),bn=nt,Ke&&Be.focus())}catch(Ke){if(Ke&&typeof Ke=="object"&&"name"in Ke&&Ke.name==="AbortError")return;throw Ke}finally{Ge===wn&&t(19,wn=void 0)}}function Bo(){var Ge;if(!(xt!=null&&xt.length)||!G)return;const W=[180,90,-180,-90],Fe=!xt.some(Ke=>!Ke.matching_text);let Oe;for(const Ke of xt){const at=Or(Ke);if(Oe=Oe===void 0?at:at===void 0?Oe:Math.max(Oe,at),Fe||!Ke.matching_text)for(const zt of[0,1,2,3])W[zt]=Math[zt<2?"min":"max"](W[zt],((Ge=Ke.bbox)==null?void 0:Ge[zt])??Ke.center[zt%2])}$&&xt.length>0&&(ne&&W[0]===W[2]&&W[1]===W[3]?$.flyTo(ne.center,Or(ne)):$.fitBounds($0(W),50,Oe))}function Or(W){var Oe;if(!W.bbox||W.bbox[0]!==W.bbox[2]&&W.bbox[1]!==W.bbox[3])return;const Fe=W.id.replace(/\..*/,"");return(Array.isArray((Oe=W.properties)==null?void 0:Oe.categories)?W.properties.categories.reduce((Ge,Ke)=>{const at=Yt[Fe+"."+Ke];return Ge===void 0?at:at===void 0?Ge:Math.max(Ge,at)},void 0):void 0)??Yt[Fe]}function pt(W){t(0,ue=z==="always"),t(14,nt=void 0),t(56,ne=void 0),t(15,Ze=-1),ht(W[1].toFixed(6)+", "+RE(W[0],[-180,180],!0).toFixed(6),!1,!0)}function ir(W){if(!nt)return;let Fe=W.key==="ArrowDown"?1:W.key==="ArrowUp"?-1:0;Fe&&(Ze===(Je?0:-1)&&Fe===-1&&t(15,Ze=nt.length),t(15,Ze+=Fe),Ze>=nt.length&&t(15,Ze=-1),Ze<0&&Je&&t(15,Ze=0),W.preventDefault())}function Qt(W=!0,Fe=!1){if(t(18,bt=void 0),Nt||Fe){if(Mn&&clearTimeout(Mn),Me.length<J)return;const Oe=Me;Mn=window.setTimeout(()=>{xn(Oe).catch(Ge=>t(18,bt=Ge))},W?O:0)}else t(14,nt=void 0),t(18,bt=void 0)}function Nr(W){t(56,ne=W),t(1,Me=W.place_name),t(15,Ze=-1)}const vi=()=>Be.focus();function tr(W){pn[W?"unshift":"push"](()=>{Be=W,t(17,Be)})}function ro(){Me=this.value,t(1,Me),t(13,lt),t(28,C)}const an=()=>t(13,lt=!0),me=()=>t(13,lt=!1),Z=()=>Qt(),X=()=>{t(1,Me=""),Be.focus()},ee=()=>t(0,ue=!ue),ce=()=>t(18,bt=void 0),Ce=W=>t(15,Ze=W),Ie=W=>Nr(W),Pe=()=>{Je||t(15,Ze=-1)},Se=()=>{};return r.$$set=W=>{"class"in W&&t(2,_=W.class),"apiKey"in W&&t(26,x=W.apiKey),"bbox"in W&&t(27,k=W.bbox),"clearButtonTitle"in W&&t(3,S=W.clearButtonTitle),"clearOnBlur"in W&&t(28,C=W.clearOnBlur),"collapsed"in W&&t(4,P=W.collapsed),"country"in W&&t(29,D=W.country),"debounceSearch"in W&&t(30,O=W.debounceSearch),"enableReverse"in W&&t(5,z=W.enableReverse),"errorMessage"in W&&t(6,B=W.errorMessage),"filter"in W&&t(31,N=W.filter),"flyTo"in W&&t(32,G=W.flyTo),"fuzzyMatch"in W&&t(33,U=W.fuzzyMatch),"language"in W&&t(34,te=W.language),"limit"in W&&t(35,le=W.limit),"mapController"in W&&t(36,$=W.mapController),"minLength"in W&&t(37,J=W.minLength),"noResultsMessage"in W&&t(7,_e=W.noResultsMessage),"placeholder"in W&&t(8,ze=W.placeholder),"proximity"in W&&t(38,re=W.proximity),"reverseActive"in W&&t(0,ue=W.reverseActive),"reverseButtonTitle"in W&&t(9,He=W.reverseButtonTitle),"searchValue"in W&&t(1,Me=W.searchValue),"pickedResultStyle"in W&&t(39,ut=W.pickedResultStyle),"showPlaceType"in W&&t(10,At=W.showPlaceType),"showResultsWhileTyping"in W&&t(40,Nt=W.showResultsWhileTyping),"selectFirst"in W&&t(11,Je=W.selectFirst),"flyToSelected"in W&&t(41,Jt=W.flyToSelected),"markerOnSelected"in W&&t(42,Kt=W.markerOnSelected),"types"in W&&t(43,Ut=W.types),"exhaustiveReverseGeocoding"in W&&t(44,Vt=W.exhaustiveReverseGeocoding),"excludeTypes"in W&&t(45,wt=W.excludeTypes),"zoom"in W&&t(46,Yt=W.zoom),"apiUrl"in W&&t(47,gr=W.apiUrl),"fetchParameters"in W&&t(48,Pt=W.fetchParameters),"iconsBaseUrl"in W&&t(12,rr=W.iconsBaseUrl),"adjustUrlQuery"in W&&t(49,wr=W.adjustUrlQuery),"$$scope"in W&&t(60,d=W.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ue=z==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,ni=lt),C&&!lt&&t(1,Me="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&Me.length<J&&(t(56,ne=void 0),t(14,nt=void 0),t(18,bt=void 0),t(55,xt=nt)),r.$$.dirty[1]&33554688&&ut!=="marker-only"&&ne&&!ne.address&&ne.geometry.type==="Point"&&ne.place_type[0]!=="reverse"&&xn(ne.id,{byId:!0}).catch(W=>t(18,bt=W)),r.$$.dirty[1]&100663330&&($&&ne&&ne.id!==ii&&G&&(!ne.bbox||ne.bbox[0]===ne.bbox[2]&&ne.bbox[1]===ne.bbox[3]?$.flyTo(ne.center,Or(ne)):$.fitBounds($0(ne.bbox),50,Or(ne)),t(14,nt=void 0),t(55,xt=void 0),t(15,Ze=-1)),t(57,ii=ne==null?void 0:ne.id)),r.$$.dirty[0]&18432&&Je&&nt!=null&&nt.length&&t(15,Ze=0),r.$$.dirty[0]&2&&t(15,Ze=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&xt!==nt&&t(55,xt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&$&&$.setEventHandler(W=>{switch(W.type){case"mapClick":ue&&pt(W.coordinates);break;case"markerClick":{const Fe=nt==null?void 0:nt.find(Oe=>Oe.id===W.id);Fe&&Nr(Fe)}break;case"markerMouseEnter":xt&&t(15,Ze=ni?(nt==null?void 0:nt.findIndex(Fe=>Fe.id===W.id))??-1:-1);break;case"markerMouseLeave":xt&&t(15,Ze=-1);break}}),r.$$.dirty[0]&49152&&t(58,l=nt==null?void 0:nt[Ze]),r.$$.dirty[1]&134218786&&$&&l&&G&&Jt&&$.flyTo(l.center,Or(l)),r.$$.dirty[1]&256&&t(59,n=ut==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Kt||$==null||$.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&$&&Kt&&!xt&&($.setFeatures(l?[l]:void 0,void 0,n),$.setSelectedMarker(l?0:-1)),r.$$.dirty[1]&318767136&&$&&$.setFeatures(xt,ne,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&xt&&$&&$.setSelectedMarker(Ze),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&$){const W=Xn(Me);$.setReverseMarker(W?[W.decimalLongitude,W.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Jr("select",{feature:l}),r.$$.dirty[1]&33554432&&Jr("pick",{feature:ne}),r.$$.dirty[0]&81920&&Jr("optionsvisibilitychange",{optionsVisible:ni&&!!nt}),r.$$.dirty[0]&16384&&Jr("featureslisted",{features:nt}),r.$$.dirty[1]&16777216&&Jr("featuresmarked",{features:xt}),r.$$.dirty[0]&1&&Jr("reversetoggle",{reverse:ue}),r.$$.dirty[0]&2&&Jr("querychange",{query:Me}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&$&&$.indicateReverse(ue)},[ue,Me,_,S,P,z,B,_e,ze,He,At,Je,rr,lt,nt,Ze,ni,Be,bt,wn,$o,st,ir,Qt,Nr,a,x,k,C,D,O,N,G,U,te,le,$,J,re,ut,Nt,Jt,Kt,Ut,Vt,wt,Yt,gr,Pt,wr,mr,Rr,ht,Mt,De,xt,ne,ii,l,n,d,u,vi,tr,ro,an,me,Z,X,ee,ce,Ce,Ie,Pe,Se]}class e5 extends Ht{constructor(e){super(),Zt(this,e,QE,YE,jt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function s1(r){let e,t,n;return t=new e5({props:{mapController:r[1],apiKey:r[0],proximity:[{type:"map-center"}]}}),{c(){e=de("div"),Ve(t.$$.fragment),Ee(e,"class","svelte-ixhnie")},m(l,u){be(l,e,u),Ne(t,e,null),n=!0},p(l,u){const d={};u&2&&(d.mapController=l[1]),u&1&&(d.apiKey=l[0]),t.$set(d)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){pe(t.$$.fragment,l),n=!1},d(l){l&&ve(e),je(t)}}}function t5(r){let e,t,n=r[1]&&s1(r);return{c(){n&&n.c(),e=$n()},m(l,u){n&&n.m(l,u),be(l,e,u),t=!0},p(l,[u]){l[1]?n?(n.p(l,u),u&2&&oe(n,1)):(n=s1(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){pe(n),t=!1},d(l){l&&ve(e),n&&n.d(l)}}}function r5(r,e,t){let n,{apiKey:l}=e,{map:u}=e;function d(a){return a?ww(a,to,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=a=>{"apiKey"in a&&t(0,l=a.apiKey),"map"in a&&t(2,u=a.map)},r.$$.update=()=>{r.$$.dirty&4&&t(1,n=d(u))},[l,n,u]}class n5 extends Ht{constructor(e){super(),Zt(this,e,r5,t5,jt,{apiKey:0,map:2})}}const i5=["==",["geometry-type"],"Polygon"],o5=["==",["geometry-type"],"LineString"];function s5(r,e,t){let n=["match",r];for(let[l,u]of Object.entries(e))n.push(l),n.push(u);return n.push(t),n}function Kf(){return{type:"FeatureCollection",features:[]}}const a5=r=>({}),a1=r=>({}),l5=r=>({}),l1=r=>({}),c5=r=>({}),c1=r=>({});function u5(r){let e,t,n,l,u,d;const a=r[1].top,_=Vr(a,r,r[0],c1),x=r[1].left,k=Vr(x,r,r[0],l1),S=r[1].main,C=Vr(S,r,r[0],a1);return{c(){e=de("div"),_&&_.c(),t=Ue(),n=de("div"),k&&k.c(),l=Ue(),u=de("div"),C&&C.c(),Ee(e,"class","top svelte-mpick2"),Ee(n,"class","left svelte-mpick2"),Ee(u,"class","main svelte-mpick2")},m(P,D){be(P,e,D),_&&_.m(e,null),be(P,t,D),be(P,n,D),k&&k.m(n,null),be(P,l,D),be(P,u,D),C&&C.m(u,null),d=!0},p(P,[D]){_&&_.p&&(!d||D&1)&&Gr(_,a,P,P[0],d?qr(a,P[0],D,c5):Wr(P[0]),c1),k&&k.p&&(!d||D&1)&&Gr(k,x,P,P[0],d?qr(x,P[0],D,l5):Wr(P[0]),l1),C&&C.p&&(!d||D&1)&&Gr(C,S,P,P[0],d?qr(S,P[0],D,a5):Wr(P[0]),a1)},i(P){d||(oe(_,P),oe(k,P),oe(C,P),d=!0)},o(P){pe(_,P),pe(k,P),pe(C,P),d=!1},d(P){P&&(ve(e),ve(t),ve(n),ve(l),ve(u)),_&&_.d(P),k&&k.d(P),C&&C.d(P)}}}function h5(r,e,t){let{$$slots:n={},$$scope:l}=e;return r.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,n]}class f5 extends Ht{constructor(e){super(),Zt(this,e,h5,u5,jt,{})}}const d5=r=>({}),u1=r=>({}),p5=r=>({}),h1=r=>({}),m5=r=>({}),f1=r=>({});function g5(r){let e,t,n,l,u,d;const a=r[4].top,_=Vr(a,r,r[3],f1),x=r[4].sidebar,k=Vr(x,r,r[3],h1),S=r[4].map,C=Vr(S,r,r[3],u1);return{c(){e=de("div"),_&&_.c(),t=Ue(),n=de("div"),k&&k.c(),l=Ue(),u=de("div"),C&&C.c()},m(P,D){be(P,e,D),_&&_.m(e,null),r[5](e),be(P,t,D),be(P,n,D),k&&k.m(n,null),r[6](n),be(P,l,D),be(P,u,D),C&&C.m(u,null),r[7](u),d=!0},p(P,[D]){_&&_.p&&(!d||D&8)&&Gr(_,a,P,P[3],d?qr(a,P[3],D,m5):Wr(P[3]),f1),k&&k.p&&(!d||D&8)&&Gr(k,x,P,P[3],d?qr(x,P[3],D,p5):Wr(P[3]),h1),C&&C.p&&(!d||D&8)&&Gr(C,S,P,P[3],d?qr(S,P[3],D,d5):Wr(P[3]),u1)},i(P){d||(oe(_,P),oe(k,P),oe(C,P),d=!0)},o(P){pe(_,P),pe(k,P),pe(C,P),d=!1},d(P){P&&(ve(e),ve(t),ve(n),ve(l),ve(u)),_&&_.d(P),r[5](null),k&&k.d(P),r[6](null),C&&C.d(P),r[7](null)}}}function _5(r,e,t){let n,l,u;yt(r,$m,S=>t(0,n=S)),yt(r,Xm,S=>t(1,l=S)),yt(r,Km,S=>t(2,u=S));let{$$slots:d={},$$scope:a}=e;function _(S){pn[S?"unshift":"push"](()=>{n=S,$m.set(n)})}function x(S){pn[S?"unshift":"push"](()=>{l=S,Xm.set(l)})}function k(S){pn[S?"unshift":"push"](()=>{u=S,Km.set(u)})}return r.$$set=S=>{"$$scope"in S&&t(3,a=S.$$scope)},[n,l,u,a,d,_,x,k]}class Os extends Ht{constructor(e){super(),Zt(this,e,_5,g5,jt,{})}}let $m=Er(null),Xm=Er(null),Km=Er(null);function y5(r){let e,t,n,l,u,d,a,_,x;return{c(){e=de("label"),t=tt(`Basemap:
  `),n=de("select"),l=de("option"),l.textContent="MapTiler Dataviz",u=de("option"),u.textContent="MapTiler Streets",d=de("option"),d.textContent="MapTiler Satellite",a=de("option"),a.textContent="OS Open Zoomstack",l.__value="dataviz",ei(l,l.__value),u.__value="streets-v2",ei(u,u.__value),d.__value="hybrid",ei(d,d.__value),a.__value="uk-openzoomstack-light",ei(a,a.__value),r[0]===void 0&&uh(()=>r[1].call(n))},m(k,S){be(k,e,S),ie(e,t),ie(e,n),ie(n,l),ie(n,u),ie(n,d),ie(n,a),ad(n,r[0],!0),_||(x=Et(n,"change",r[1]),_=!0)},p(k,[S]){S&1&&ad(n,k[0])},i:It,o:It,d(k){k&&ve(e),_=!1,x()}}}function v5(r,e,t){let n;yt(r,Bm,u=>t(0,n=u));function l(){n=Ib(this),Bm.set(n)}return[n,l]}class b5 extends Ht{constructor(e){super(),Zt(this,e,v5,y5,jt,{})}}let Jf=Er(!0);function w5(r){let e,t;return e=new ma({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.layout={visibility:n[0]?"none":"visible"}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function x5(r){let e,t;return e=new Pi({props:{data:r[1],$$slots:{default:[w5]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&5&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function S5(r,e,t){let n;return yt(r,Jf,u=>t(0,n=u)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class k5 extends Ht{constructor(e){super(),Zt(this,e,S5,x5,jt,{})}}const T5="/ltn/assets/help-d011708a.svg";function d1(r){let e,t;return e=new zd({props:{$$slots:{default:[E5]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function E5(r){let e,t,n;const l=r[1].default,u=Vr(l,r,r[4],null);return{c(){e=de("h2"),e.textContent="Help",t=Ue(),u&&u.c()},m(d,a){be(d,e,a),be(d,t,a),u&&u.m(d,a),n=!0},p(d,a){u&&u.p&&(!n||a&16)&&Gr(u,l,d,d[4],n?qr(l,d[4],a,null):Wr(d[4]),null)},i(d){n||(oe(u,d),n=!0)},o(d){pe(u,d),n=!1},d(d){d&&(ve(e),ve(t)),u&&u.d(d)}}}function M5(r){let e,t,n,l,u,d,a=r[0]&&d1(r);return{c(){e=de("button"),e.innerHTML=`<img src="${T5}" title="Help" alt="Help"/>`,t=Ue(),a&&a.c(),n=$n(),Ee(e,"class","svelte-gb6dzm")},m(_,x){be(_,e,x),be(_,t,x),a&&a.m(_,x),be(_,n,x),l=!0,u||(d=Et(e,"click",r[2]),u=!0)},p(_,[x]){_[0]?a?(a.p(_,x),x&1&&oe(a,1)):(a=d1(_),a.c(),oe(a,1),a.m(n.parentNode,n)):a&&(vr(),pe(a,1,1,()=>{a=null}),br())},i(_){l||(oe(a),l=!0)},o(_){pe(a),l=!1},d(_){_&&(ve(e),ve(t),ve(n)),a&&a.d(_),u=!1,d()}}}function C5(r,e,t){let{$$slots:n={},$$scope:l}=e,u=!1;const d=()=>t(0,u=!0),a=()=>t(0,u=!1);return r.$$set=_=>{"$$scope"in _&&t(4,l=_.$$scope)},[u,n,d,a,l]}class jg extends Ht{constructor(e){super(),Zt(this,e,C5,M5,jt,{})}}function I5(r){let e,t,n,l;const u=r[1].default,d=Vr(u,r,r[0],null);return{c(){e=de("a"),d&&d.c(),Ee(e,"href","#")},m(a,_){be(a,e,_),d&&d.m(e,null),t=!0,n||(l=Et(e,"click",wg(r[2])),n=!0)},p(a,[_]){d&&d.p&&(!t||_&1)&&Gr(d,u,a,a[0],t?qr(u,a[0],_,null):Wr(a[0]),null)},i(a){t||(oe(d,a),t=!0)},o(a){pe(d,a),t=!1},d(a){a&&ve(e),d&&d.d(a),n=!1,l()}}}function A5(r,e,t){let{$$slots:n={},$$scope:l}=e;function u(d){ur.call(this,r,d)}return r.$$set=d=>{"$$scope"in d&&t(0,l=d.$$scope)},[l,n,u]}class Zr extends Ht{constructor(e){super(),Zt(this,e,A5,I5,jt,{})}}const L5=r=>({props:r&8}),p1=r=>({props:D5(r[3])});function P5(r){let e;const t=r[1].default,n=Vr(t,r,r[2],p1);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&12)&&Gr(n,t,l,l[2],e?qr(t,l[2],u,L5):Wr(l[2]),p1)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function z5(r){let e,t;return e=new u3({props:{openOn:r[0],popupClass:"popup",$$slots:{default:[P5,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.openOn=n[0]),l&12&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function D5(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function R5(r,e,t){let{$$slots:n={},$$scope:l}=e,{openOn:u="hover"}=e;return r.$$set=d=>{"openOn"in d&&t(0,u=d.openOn),"$$scope"in d&&t(2,l=d.$$scope)},[u,n,l]}class Ns extends Ht{constructor(e){super(),Zt(this,e,R5,z5,jt,{openOn:0})}}function B5(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:F5}=Ld;function O5(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D,O;return P=Cb(r[8][0]),{c(){e=de("button"),e.textContent="Stop StreetView",t=Ue(),n=de("fieldset"),l=de("legend"),l.textContent="Source:",u=Ue(),d=de("label"),a=de("input"),_=tt(`
      Google Street View`),x=Ue(),k=de("label"),S=de("input"),C=tt(`
      Bing Streetside`),Ee(e,"class","secondary"),Ee(a,"type","radio"),a.__value="google",ei(a,a.__value),Ee(S,"type","radio"),S.__value="bing",ei(S,S.__value),P.p(a,S)},m(z,B){be(z,e,B),be(z,t,B),be(z,n,B),ie(n,l),ie(n,u),ie(n,d),ie(d,a),a.checked=a.__value===r[0],ie(d,_),ie(n,x),ie(n,k),ie(k,S),S.checked=S.__value===r[0],ie(k,C),D||(O=[Et(e,"click",r[3]),Et(a,"change",r[7]),Et(S,"change",r[9])],D=!0)},p(z,B){B&1&&(a.checked=a.__value===z[0]),B&1&&(S.checked=S.__value===z[0])},d(z){z&&(ve(e),ve(t),ve(n)),P.r(),D=!1,_n(O)}}}function N5(r){let e,t,n;return{c(){e=de("button"),e.textContent="StreetView",Ee(e,"class","secondary")},m(l,u){be(l,e,u),t||(n=Et(e,"click",r[2]),t=!0)},p:It,d(l){l&&ve(e),t=!1,n()}}}function j5(r){let e,t,n;function l(a,_){return a[1]?N5:O5}let u=l(r),d=u(r);return{c(){d.c(),e=$n()},m(a,_){d.m(a,_),be(a,e,_),t||(n=Et(F5,"keydown",r[4]),t=!0)},p(a,[_]){u===(u=l(a))&&d?d.p(a,_):(d.d(1),d=u(a),d&&(d.c(),d.m(e.parentNode,e)))},i:It,o:It,d(a){a&&ve(e),d.d(a),t=!1,n()}}}function U5(r,e,t){let n;yt(r,Jf,O=>t(1,n=O));let{map:l}=e,{maptilerBasemap:u}=e,d="google",a=[];function _(){Rt(Jf,n=!1,n),l.on("click",k),l.getCanvas().style.cursor="crosshair";for(let O of B5(l,u))a.push([O,l.getPaintProperty(O,"line-color")]),l.setPaintProperty(O,"line-color","cyan")}function x(){Rt(Jf,n=!0,n),l.off("click",k),l.getCanvas().style.cursor="inherit";for(let[O,z]of a)l.setPaintProperty(O,"line-color",z);a=[]}ti(x);function k(O){let z=O.lngLat.lng,B=O.lngLat.lat;d=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${B},${z}&cbp=11,0,0,0,0`,"_blank"):d=="bing"&&window.open(`https://www.bing.com/maps?cp=${B}~${z}&style=x`,"_blank")}function S(O){!n&&O.key=="Escape"&&(O.stopPropagation(),x())}const C=[[]];function P(){d=this.__value,t(0,d)}function D(){d=this.__value,t(0,d)}return r.$$set=O=>{"map"in O&&t(5,l=O.map),"maptilerBasemap"in O&&t(6,u=O.maptilerBasemap)},[d,n,_,x,S,l,u,P,C,D]}class V5 extends Ht{constructor(e){super(),Zt(this,e,U5,j5,jt,{map:5,maptilerBasemap:6})}}function Hn(r,e=!0){return{id:r,beforeId:q5(r),eventsIfTopMost:e}}function q5(r){let e=Hi(ls);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let l=m1.length-1;l>=0;l--){let u=m1[l];if(u==r){n=!0;break}e.getLayer(u)&&(t=u)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let om=r=>r,sm=r=>r;const m1=[om(sm("Background")),"neighbourhood-boundaries",om("Ferry line"),"debug-borders","debug-crosses","debug-filters","cells","interior-roads-outlines","interior-roads","compare-route","shortcuts","shortcuts-focus",sm("Building"),"draw-area-lines","draw-area-preview","one-ways",sm("Road labels"),om("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function G5(r){let e;return{c(){e=tt("Back")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function W5(r){let e,t,n,l;return e=new Zr({props:{$$slots:{default:[G5]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0,n||(l=Et(window,"keydown",r[1]),n=!0)},p(u,[d]){const a={};d&8&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u),n=!1,l()}}}function Z5(r){let e=us();function t(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class Nd extends Ht{constructor(e){super(),Zt(this,e,Z5,W5,jt,{})}}function H5(r){let e,t;const n=[Hn("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}}];let l={};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new sw({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,[d]){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}class $5 extends Ht{constructor(e){super(),Zt(this,e,null,H5,jt,{})}}function Jm(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind=="cell"&&(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}const X5=r=>({}),g1=r=>({}),K5=r=>({}),_1=r=>({});function J5(r){let e,t;const n=[Hn("neighbourhood-boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new ma({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function y1(r){let e;const t=r[6]["line-popup"],n=Vr(t,r,r[8],_1);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&256)&&Gr(n,t,l,l[8],e?qr(t,l[8],u,K5):Wr(l[8]),_1)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function Y5(r){let e,t,n=r[0]&&y1(r);return{c(){n&&n.c(),e=$n()},m(l,u){n&&n.m(l,u),be(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=y1(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){pe(n),t=!1},d(l){l&&ve(e),n&&n.d(l)}}}function Q5(r){let e,t,n,l,u,d,a,_,x,k,S;e=new Pi({props:{data:v1(r[3]),$$slots:{default:[J5]},$$scope:{ctx:r}}});const C=[Hn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let P={};for(let U=0;U<C.length;U+=1)P=Rn(P,C[U]);n=new ma({props:P});const D=[Hn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5+ko,10,1+ko,12,1.5+ko,14,4+ko,16,7+ko,20,24+ko],"line-color":"black"}}];let O={};for(let U=0;U<D.length;U+=1)O=Rn(O,D[U]);u=new cs({props:O});const z=[Hn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,10,1,12,1.5,14,4,16,7,20,24],"line-color":r[2],"line-opacity":rl(1,.5)}},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let B={$$slots:{default:[Y5]},$$scope:{ctx:r}};for(let U=0;U<z.length;U+=1)B=Rn(B,z[U]);a=new cs({props:B}),a.$on("click",r[7]),x=new $5({});const N=r[6]["more-layers"],G=Vr(N,r,r[8],g1);return{c(){Ve(e.$$.fragment),t=Ue(),Ve(n.$$.fragment),l=Ue(),Ve(u.$$.fragment),d=Ue(),Ve(a.$$.fragment),_=Ue(),Ve(x.$$.fragment),k=Ue(),G&&G.c()},m(U,te){Ne(e,U,te),be(U,t,te),Ne(n,U,te),be(U,l,te),Ne(u,U,te),be(U,d,te),Ne(a,U,te),be(U,_,te),Ne(x,U,te),be(U,k,te),G&&G.m(U,te),S=!0},p(U,te){const le={};te&8&&(le.data=v1(U[3])),te&256&&(le.$$scope={dirty:te,ctx:U}),e.$set(le);const $={};n.$set($);const J=te&0?Lm(D,[D[0],D[1],{paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5+ko,10,1+ko,12,1.5+ko,14,4+ko,16,7+ko,20,24+ko],"line-color":"black"}}]):{};u.$set(J);const _e=te&5?Lm(z,[z[0],z[1],te&4&&{paint:{"line-width":["interpolate",["linear"],["zoom"],5,.5,10,1,12,1.5,14,4,16,7,20,24],"line-color":U[2],"line-opacity":rl(1,.5)}},te&1&&{manageHoverState:U[0]},te&1&&{hoverCursor:U[0]?"pointer":void 0}]):{};te&257&&(_e.$$scope={dirty:te,ctx:U}),a.$set(_e),G&&G.p&&(!S||te&256)&&Gr(G,N,U,U[8],S?qr(N,U[8],te,X5):Wr(U[8]),g1)},i(U){S||(oe(e.$$.fragment,U),oe(n.$$.fragment,U),oe(u.$$.fragment,U),oe(a.$$.fragment,U),oe(x.$$.fragment,U),oe(G,U),S=!0)},o(U){pe(e.$$.fragment,U),pe(n.$$.fragment,U),pe(u.$$.fragment,U),pe(a.$$.fragment,U),pe(x.$$.fragment,U),pe(G,U),S=!1},d(U){U&&(ve(t),ve(l),ve(d),ve(_),ve(k)),je(e,U),je(n,U),je(u,U),je(a,U),je(x,U),G&&G.d(U)}}}function eM(r){let e,t;return e=new Pi({props:{data:r[3],generateId:!0,$$slots:{default:[Q5]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&8&&(u.data=n[3]),l&271&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}let ko=2;function v1(r){let e=r.features.find(t=>t.properties.kind=="boundary");return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]],e.geometry.coordinates[0]]}}}function tM(r,e,t){let n,l,u,{$$slots:d={},$$scope:a}=e,{gjInput:_}=e,{interactive:x=!0}=e,{onClickLine:k=(C,P)=>{}}=e;const S=C=>x&&k(C.detail.features[0],C.detail.event.lngLat);return r.$$set=C=>{"gjInput"in C&&t(4,_=C.gjInput),"interactive"in C&&t(0,x=C.interactive),"onClickLine"in C&&t(1,k=C.onClickLine),"$$scope"in C&&t(8,a=C.$$scope)},r.$$.update=()=>{r.$$.dirty&16&&t(3,n=Jm(_)),r.$$.dirty&16&&t(5,l=Math.max(..._.features.map(C=>C.properties.kind=="interior_road"?C.properties.shortcuts:0))??0),r.$$.dirty&32&&t(2,u=l>2?rl(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",l,"#A32015"],"blue"):rl("white","blue"))},[x,k,u,n,_,l,d,S,a]}class jd extends Ht{constructor(e){super(),Zt(this,e,tM,eM,jt,{gjInput:4,interactive:0,onClickLine:1})}}function rM(r){let e;return{c(){e=tt("Choose project")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function nM(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function iM(r){let e;return{c(){e=tt("Editing")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function oM(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D;return u=new Zr({props:{$$slots:{default:[rM]},$$scope:{ctx:r}}}),u.$on("click",r[4]),_=new Zr({props:{$$slots:{default:[nM]},$$scope:{ctx:r}}}),_.$on("click",r[5]),S=new Zr({props:{$$slots:{default:[iM]},$$scope:{ctx:r}}}),S.$on("click",r[6]),{c(){e=de("div"),t=de("nav"),n=de("ul"),l=de("li"),Ve(u.$$.fragment),d=Ue(),a=de("li"),Ve(_.$$.fragment),x=Ue(),k=de("li"),Ve(S.$$.fragment),C=Ue(),P=de("li"),P.textContent="Debug mode",Ee(t,"aria-label","breadcrumb"),Ee(e,"slot","top")},m(O,z){be(O,e,z),ie(e,t),ie(t,n),ie(n,l),Ne(u,l,null),ie(n,d),ie(n,a),Ne(_,a,null),ie(n,x),ie(n,k),Ne(S,k,null),ie(n,C),ie(n,P),D=!0},p(O,z){const B={};z&256&&(B.$$scope={dirty:z,ctx:O}),u.$set(B);const N={};z&256&&(N.$$scope={dirty:z,ctx:O}),_.$set(N);const G={};z&256&&(G.$$scope={dirty:z,ctx:O}),S.$set(G)},i(O){D||(oe(u.$$.fragment,O),oe(_.$$.fragment,O),oe(S.$$.fragment,O),D=!0)},o(O){pe(u.$$.fragment,O),pe(_.$$.fragment,O),pe(S.$$.fragment,O),D=!1},d(O){O&&ve(e),je(u),je(_),je(S)}}}function sM(r){let e,t,n;return t=new Nd({}),t.$on("click",r[3]),{c(){e=de("div"),Ve(t.$$.fragment),Ee(e,"slot","sidebar")},m(l,u){be(l,e,u),Ne(t,e,null),n=!0},p:It,i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){pe(t.$$.fragment,l),n=!1},d(l){l&&ve(e),je(t)}}}function aM(r){let e,t;return e=new Dd({props:{properties:r[7]}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function lM(r){let e,t,n;return t=new Ns({props:{openOn:"hover",$$slots:{default:[aM,({props:l})=>({7:l}),({props:l})=>l?128:0]},$$scope:{ctx:r}}}),{c(){e=de("div"),Ve(t.$$.fragment),Ee(e,"slot","line-popup")},m(l,u){be(l,e,u),Ne(t,e,null),n=!0},p(l,u){const d={};u&384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){pe(t.$$.fragment,l),n=!1},d(l){l&&ve(e),je(t)}}}function cM(r){let e,t;return e=new Dd({props:{properties:r[7]}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function uM(r){let e,t;return e=new Ns({props:{openOn:"hover",$$slots:{default:[cM,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function hM(r){let e,t;return e=new Dd({props:{properties:r[7]}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function fM(r){let e,t;return e=new Ns({props:{openOn:"hover",$$slots:{default:[hM,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function dM(r){let e,t,n,l;const u=[Hn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let d={$$slots:{default:[uM]},$$scope:{ctx:r}};for(let x=0;x<u.length;x+=1)d=Rn(d,u[x]);e=new zg({props:d});const a=[Hn("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let _={$$slots:{default:[fM]},$$scope:{ctx:r}};for(let x=0;x<a.length;x+=1)_=Rn(_,a[x]);return n=new cs({props:_}),{c(){Ve(e.$$.fragment),t=Ue(),Ve(n.$$.fragment)},m(x,k){Ne(e,x,k),be(x,t,k),Ne(n,x,k),l=!0},p(x,k){const S={};k&256&&(S.$$scope={dirty:k,ctx:x}),e.$set(S);const C={};k&256&&(C.$$scope={dirty:k,ctx:x}),n.$set(C)},i(x){l||(oe(e.$$.fragment,x),oe(n.$$.fragment,x),l=!0)},o(x){pe(e.$$.fragment,x),pe(n.$$.fragment,x),l=!1},d(x){x&&ve(t),je(e,x),je(n,x)}}}function pM(r){let e,t;return e=new Dd({props:{properties:r[7]}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&128&&(u.properties=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function mM(r){let e,t;return e=new Ns({props:{openOn:"hover",$$slots:{default:[pM,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function gM(r){let e,t;const n=[Hn("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let l={$$slots:{default:[mM]},$$scope:{ctx:r}};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new zg({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};d&256&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function _M(r){let e,t,n,l,u;return t=new jd({props:{gjInput:JSON.parse(dn(r[0]).renderNeighbourhood()),interactive:!0,onClickLine:r[2],$$slots:{"more-layers":[dM],"line-popup":[lM]},$$scope:{ctx:r}}}),l=new Pi({props:{data:JSON.parse(dn(r[0]).renderModalFilters()),generateId:!0,$$slots:{default:[gM]},$$scope:{ctx:r}}}),{c(){e=de("div"),Ve(t.$$.fragment),n=Ue(),Ve(l.$$.fragment),Ee(e,"slot","map")},m(d,a){be(d,e,a),Ne(t,e,null),ie(e,n),Ne(l,e,null),u=!0},p(d,a){const _={};a&1&&(_.gjInput=JSON.parse(dn(d[0]).renderNeighbourhood())),a&256&&(_.$$scope={dirty:a,ctx:d}),t.$set(_);const x={};a&1&&(x.data=JSON.parse(dn(d[0]).renderModalFilters())),a&256&&(x.$$scope={dirty:a,ctx:d}),l.$set(x)},i(d){u||(oe(t.$$.fragment,d),oe(l.$$.fragment,d),u=!0)},o(d){pe(t.$$.fragment,d),pe(l.$$.fragment,d),u=!1},d(d){d&&ve(e),je(t),je(l)}}}function yM(r){let e,t;return e=new Os({props:{$$slots:{map:[_M],sidebar:[sM],top:[oM]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&259&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function vM(r,e,t){let n,l;return yt(r,ri,k=>t(0,n=k)),yt(r,dr,k=>t(1,l=k)),[n,l,(k,S)=>window.open(dn(k.properties).way,"_blank"),()=>Rt(dr,l={mode:"neighbourhood"},l),()=>Rt(dr,l={mode:"title"},l),()=>Rt(dr,l={mode:"network"},l),()=>Rt(dr,l={mode:"neighbourhood"},l)]}class bM extends Ht{constructor(e){super(),Zt(this,e,vM,yM,jt,{})}}function b1(r,e,t){const n=r.slice();return n[7]=e[t][0],n[8]=e[t][1],n[9]=e[t][2],n}function w1(r){let e,t,n,l,u,d,a=r[8]+"",_,x,k,S,C;function P(){return r[3](r[7])}return{c(){e=de("button"),t=de("img"),l=Ue(),u=de("br"),d=Ue(),_=tt(a),x=Ue(),En(t.src,n=`/ltn//filters/${r[7]}_icon.gif`)||Ee(t,"src",n),Ee(t,"width","80"),Ee(t,"alt",r[8]),Ee(e,"class","outline"),fn(e,"width","100%"),e.disabled=k=r[0]==r[7]},m(D,O){be(D,e,O),ie(e,t),ie(e,l),ie(e,u),ie(e,d),ie(e,_),ie(e,x),S||(C=Et(e,"click",P),S=!0)},p(D,O){r=D,O&1&&k!==(k=r[0]==r[7])&&(e.disabled=k)},d(D){D&&ve(e),S=!1,C()}}}function wM(r){let e,t,n,l,u,d,a,_,x,k,S,C,P=r[1][2]+"",D,O,z,B,N,G,U=Jn(r[2]),te=[];for(let $=0;$<U.length;$+=1)te[$]=w1(b1(r,U,$));function le(){return r[4](r[6])}return{c(){e=de("h3"),e.textContent="Choose a modal filter to place on streets",t=Ue(),n=de("table"),l=de("tr"),u=de("td");for(let $=0;$<te.length;$+=1)te[$].c();d=Ue(),a=de("td"),_=de("img"),S=Ue(),C=de("p"),D=tt(P),O=Ue(),z=de("center"),B=de("button"),B.textContent="Confirm",En(_.src,x=`/ltn//filters/${r[0]}.gif`)||Ee(_,"src",x),Ee(_,"height","300"),Ee(_,"alt",k=r[1][1])},m($,J){be($,e,J),be($,t,J),be($,n,J),ie(n,l),ie(l,u);for(let _e=0;_e<te.length;_e+=1)te[_e]&&te[_e].m(u,null);ie(l,d),ie(l,a),ie(a,_),ie(a,S),ie(a,C),ie(C,D),be($,O,J),be($,z,J),ie(z,B),N||(G=Et(B,"click",le),N=!0)},p($,J){if(r=$,J&5){U=Jn(r[2]);let _e;for(_e=0;_e<U.length;_e+=1){const ze=b1(r,U,_e);te[_e]?te[_e].p(ze,J):(te[_e]=w1(ze),te[_e].c(),te[_e].m(u,null))}for(;_e<te.length;_e+=1)te[_e].d(1);te.length=U.length}J&1&&!En(_.src,x=`/ltn//filters/${r[0]}.gif`)&&Ee(_,"src",x),J&2&&k!==(k=r[1][1])&&Ee(_,"alt",k),J&2&&P!==(P=r[1][2]+"")&&Lr(D,P)},d($){$&&(ve(e),ve(t),ve(n),ve(O),ve(z)),Ds(te,$),N=!1,G()}}}function xM(r){let e,t;return e=new zd({props:{$$slots:{default:[wM,({dialog:n})=>({6:n}),({dialog:n})=>n?64:0]},$$scope:{ctx:r}}}),e.$on("close",r[5]),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&4163&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function SM(r,e,t){let n,l;yt(r,Nm,x=>t(0,l=x));let u=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const d=x=>Rt(Nm,l=x,l),a=x=>dn(x).close();function _(x){ur.call(this,r,x)}return r.$$.update=()=>{r.$$.dirty&1&&t(1,n=u.find(x=>x[0]==l))},[l,n,u,d,a,_]}class kM extends Ht{constructor(e){super(),Zt(this,e,SM,xM,jt,{})}}function x1(r){let e,t;return e=new Pi({props:{data:r[0],$$slots:{default:[TM]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.data=n[0]),l&64&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function TM(r){let e,t;const n=[Hn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new cs({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function EM(r){let e,t,n=r[0]&&x1(r);return{c(){n&&n.c(),e=$n()},m(l,u){n&&n.m(l,u),be(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=x1(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){pe(n),t=!1},d(l){l&&ve(e),n&&n.d(l)}}}function MM(r,e,t){let{map:n}=e,l=null;const u=us();n.on("dragstart",d),n.on("mousemove",a),n.on("mouseup",_),ti(()=>{n.dragPan.enable(),n.off("dragstart",d),n.off("mousemove",a),n.off("mouseup",_)});function d(){n.dragPan.disable(),t(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(x){l&&(l.geometry.coordinates.push(x.lngLat.toArray()),t(0,l))}function _(){l&&(u("done",l),t(0,l=null))}return r.$$set=x=>{"map"in x&&t(1,n=x.map)},[l,n]}class CM extends Ht{constructor(e){super(),Zt(this,e,MM,EM,jt,{map:1})}}function IM(r){let e;const t=r[3].default,n=Vr(t,r,r[5],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&32)&&Gr(n,t,l,l[5],e?qr(t,l[5],u,null):Wr(l[5]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function AM(r){let e,t;const n=[Hn("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let l={$$slots:{default:[IM]},$$scope:{ctx:r}};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new sw({props:l}),e.$on("click",r[4]),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};d&32&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function LM(r){let e,t;return e=new Pi({props:{data:r[0],generateId:!0,$$slots:{default:[AM]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&32&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function PM(r,e,t){let n,l,u;yt(r,ri,x=>t(1,l=x)),yt(r,Is,x=>t(2,u=x));let{$$slots:d={},$$scope:a}=e;function _(x){ur.call(this,r,x)}return r.$$set=x=>{"$$scope"in x&&t(5,a=x.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=u>0?JSON.parse(l.renderModalFilters()):null)},[n,l,u,d,_,a]}class Ud extends Ht{constructor(e){super(),Zt(this,e,PM,LM,jt,{})}}var S1=Object.prototype.toString,kw=function(e){var t=S1.call(e),n=t==="[object Arguments]";return n||(n=t!=="[object Array]"&&e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&S1.call(e.callee)==="[object Function]"),n},am,k1;function zM(){if(k1)return am;k1=1;var r;if(!Object.keys){var e=Object.prototype.hasOwnProperty,t=Object.prototype.toString,n=kw,l=Object.prototype.propertyIsEnumerable,u=!l.call({toString:null},"toString"),d=l.call(function(){},"prototype"),a=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],_=function(C){var P=C.constructor;return P&&P.prototype===C},x={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},k=function(){if(typeof window>"u")return!1;for(var C in window)try{if(!x["$"+C]&&e.call(window,C)&&window[C]!==null&&typeof window[C]=="object")try{_(window[C])}catch{return!0}}catch{return!0}return!1}(),S=function(C){if(typeof window>"u"||!k)return _(C);try{return _(C)}catch{return!1}};r=function(P){var D=P!==null&&typeof P=="object",O=t.call(P)==="[object Function]",z=n(P),B=D&&t.call(P)==="[object String]",N=[];if(!D&&!O&&!z)throw new TypeError("Object.keys called on a non-object");var G=d&&O;if(B&&P.length>0&&!e.call(P,0))for(var U=0;U<P.length;++U)N.push(String(U));if(z&&P.length>0)for(var te=0;te<P.length;++te)N.push(String(te));else for(var le in P)!(G&&le==="prototype")&&e.call(P,le)&&N.push(String(le));if(u)for(var $=S(P),J=0;J<a.length;++J)!($&&a[J]==="constructor")&&e.call(P,a[J])&&N.push(a[J]);return N}}return am=r,am}var DM=Array.prototype.slice,RM=kw,T1=Object.keys,Yf=T1?function(e){return T1(e)}:zM(),E1=Object.keys;Yf.shim=function(){if(Object.keys){var e=function(){var t=Object.keys(arguments);return t&&t.length===arguments.length}(1,2);e||(Object.keys=function(n){return RM(n)?E1(DM.call(n)):E1(n)})}else Object.keys=Yf;return Object.keys||Yf};var Ug=Yf,BM=Error,FM=EvalError,OM=RangeError,NM=ReferenceError,Tw=SyntaxError,ba=TypeError,jM=URIError,Vd=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),n=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(n)!=="[object Symbol]")return!1;var l=42;e[t]=l;for(t in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var u=Object.getOwnPropertySymbols(e);if(u.length!==1||u[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var d=Object.getOwnPropertyDescriptor(e,t);if(d.value!==l||d.enumerable!==!0)return!1}return!0},M1=typeof Symbol<"u"&&Symbol,UM=Vd,Vg=function(){return typeof M1!="function"||typeof Symbol!="function"||typeof M1("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:UM()},lm={__proto__:null,foo:{}},VM=Object,qM=function(){return{__proto__:lm}.foo===lm.foo&&!(lm instanceof VM)},GM="Function.prototype.bind called on incompatible ",WM=Object.prototype.toString,ZM=Math.max,HM="[object Function]",C1=function(e,t){for(var n=[],l=0;l<e.length;l+=1)n[l]=e[l];for(var u=0;u<t.length;u+=1)n[u+e.length]=t[u];return n},$M=function(e,t){for(var n=[],l=t||0,u=0;l<e.length;l+=1,u+=1)n[u]=e[l];return n},XM=function(r,e){for(var t="",n=0;n<r.length;n+=1)t+=r[n],n+1<r.length&&(t+=e);return t},KM=function(e){var t=this;if(typeof t!="function"||WM.apply(t)!==HM)throw new TypeError(GM+t);for(var n=$M(arguments,1),l,u=function(){if(this instanceof l){var k=t.apply(this,C1(n,arguments));return Object(k)===k?k:this}return t.apply(e,C1(n,arguments))},d=ZM(0,t.length-n.length),a=[],_=0;_<d;_++)a[_]="$"+_;if(l=Function("binder","return function ("+XM(a,",")+"){ return binder.apply(this,arguments); }")(u),t.prototype){var x=function(){};x.prototype=t.prototype,l.prototype=new x,x.prototype=null}return l},JM=KM,qg=Function.prototype.bind||JM,YM=Function.prototype.call,QM=Object.prototype.hasOwnProperty,eC=qg,Ew=eC.call(YM,QM),Cr,tC=BM,rC=FM,nC=OM,iC=NM,Tc=Tw,wc=ba,oC=jM,Mw=Function,cm=function(r){try{return Mw('"use strict"; return ('+r+").constructor;")()}catch{}},Qa=Object.getOwnPropertyDescriptor;if(Qa)try{Qa({},"")}catch{Qa=null}var um=function(){throw new wc},sC=Qa?function(){try{return arguments.callee,um}catch{try{return Qa(arguments,"callee").get}catch{return um}}}():um,uc=Vg(),aC=qM(),ci=Object.getPrototypeOf||(aC?function(r){return r.__proto__}:null),gc={},lC=typeof Uint8Array>"u"||!ci?Cr:ci(Uint8Array),el={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?Cr:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Cr:ArrayBuffer,"%ArrayIteratorPrototype%":uc&&ci?ci([][Symbol.iterator]()):Cr,"%AsyncFromSyncIteratorPrototype%":Cr,"%AsyncFunction%":gc,"%AsyncGenerator%":gc,"%AsyncGeneratorFunction%":gc,"%AsyncIteratorPrototype%":gc,"%Atomics%":typeof Atomics>"u"?Cr:Atomics,"%BigInt%":typeof BigInt>"u"?Cr:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?Cr:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?Cr:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Cr:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":tC,"%eval%":eval,"%EvalError%":rC,"%Float32Array%":typeof Float32Array>"u"?Cr:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Cr:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Cr:FinalizationRegistry,"%Function%":Mw,"%GeneratorFunction%":gc,"%Int8Array%":typeof Int8Array>"u"?Cr:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Cr:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Cr:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":uc&&ci?ci(ci([][Symbol.iterator]())):Cr,"%JSON%":typeof JSON=="object"?JSON:Cr,"%Map%":typeof Map>"u"?Cr:Map,"%MapIteratorPrototype%":typeof Map>"u"||!uc||!ci?Cr:ci(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Cr:Promise,"%Proxy%":typeof Proxy>"u"?Cr:Proxy,"%RangeError%":nC,"%ReferenceError%":iC,"%Reflect%":typeof Reflect>"u"?Cr:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Cr:Set,"%SetIteratorPrototype%":typeof Set>"u"||!uc||!ci?Cr:ci(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Cr:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":uc&&ci?ci(""[Symbol.iterator]()):Cr,"%Symbol%":uc?Symbol:Cr,"%SyntaxError%":Tc,"%ThrowTypeError%":sC,"%TypedArray%":lC,"%TypeError%":wc,"%Uint8Array%":typeof Uint8Array>"u"?Cr:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Cr:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Cr:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Cr:Uint32Array,"%URIError%":oC,"%WeakMap%":typeof WeakMap>"u"?Cr:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Cr:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Cr:WeakSet};if(ci)try{null.error}catch(r){var cC=ci(ci(r));el["%Error.prototype%"]=cC}var uC=function r(e){var t;if(e==="%AsyncFunction%")t=cm("async function () {}");else if(e==="%GeneratorFunction%")t=cm("function* () {}");else if(e==="%AsyncGeneratorFunction%")t=cm("async function* () {}");else if(e==="%AsyncGenerator%"){var n=r("%AsyncGeneratorFunction%");n&&(t=n.prototype)}else if(e==="%AsyncIteratorPrototype%"){var l=r("%AsyncGenerator%");l&&ci&&(t=ci(l.prototype))}return el[e]=t,t},I1={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Mh=qg,_d=Ew,hC=Mh.call(Function.call,Array.prototype.concat),fC=Mh.call(Function.apply,Array.prototype.splice),A1=Mh.call(Function.call,String.prototype.replace),yd=Mh.call(Function.call,String.prototype.slice),dC=Mh.call(Function.call,RegExp.prototype.exec),pC=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,mC=/\\(\\)?/g,gC=function(e){var t=yd(e,0,1),n=yd(e,-1);if(t==="%"&&n!=="%")throw new Tc("invalid intrinsic syntax, expected closing `%`");if(n==="%"&&t!=="%")throw new Tc("invalid intrinsic syntax, expected opening `%`");var l=[];return A1(e,pC,function(u,d,a,_){l[l.length]=a?A1(_,mC,"$1"):d||u}),l},_C=function(e,t){var n=e,l;if(_d(I1,n)&&(l=I1[n],n="%"+l[0]+"%"),_d(el,n)){var u=el[n];if(u===gc&&(u=uC(n)),typeof u>"u"&&!t)throw new wc("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:l,name:n,value:u}}throw new Tc("intrinsic "+e+" does not exist!")},hs=function(e,t){if(typeof e!="string"||e.length===0)throw new wc("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof t!="boolean")throw new wc('"allowMissing" argument must be a boolean');if(dC(/^%?[^%]*%?$/,e)===null)throw new Tc("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=gC(e),l=n.length>0?n[0]:"",u=_C("%"+l+"%",t),d=u.name,a=u.value,_=!1,x=u.alias;x&&(l=x[0],fC(n,hC([0,1],x)));for(var k=1,S=!0;k<n.length;k+=1){var C=n[k],P=yd(C,0,1),D=yd(C,-1);if((P==='"'||P==="'"||P==="`"||D==='"'||D==="'"||D==="`")&&P!==D)throw new Tc("property names with quotes must have matching quotes");if((C==="constructor"||!S)&&(_=!0),l+="."+C,d="%"+l+"%",_d(el,d))a=el[d];else if(a!=null){if(!(C in a)){if(!t)throw new wc("base intrinsic for "+e+" exists, but the property is not available.");return}if(Qa&&k+1>=n.length){var O=Qa(a,C);S=!!O,S&&"get"in O&&!("originalValue"in O.get)?a=O.get:a=a[C]}else S=_d(a,C),a=a[C];S&&!_&&(el[d]=a)}}return a},hm,L1;function Gg(){if(L1)return hm;L1=1;var r=hs,e=r("%Object.defineProperty%",!0)||!1;if(e)try{e({},"a",{value:1})}catch{e=!1}return hm=e,hm}var yC=hs,Qf=yC("%Object.getOwnPropertyDescriptor%",!0);if(Qf)try{Qf([],"length")}catch{Qf=null}var Wg=Qf,P1=Gg(),vC=Tw,hc=ba,z1=Wg,Zg=function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new hc("`obj` must be an object or a function`");if(typeof t!="string"&&typeof t!="symbol")throw new hc("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new hc("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new hc("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new hc("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new hc("`loose`, if provided, must be a boolean");var l=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,d=arguments.length>5?arguments[5]:null,a=arguments.length>6?arguments[6]:!1,_=!!z1&&z1(e,t);if(P1)P1(e,t,{configurable:d===null&&_?_.configurable:!d,enumerable:l===null&&_?_.enumerable:!l,value:n,writable:u===null&&_?_.writable:!u});else if(a||!l&&!u&&!d)e[t]=n;else throw new vC("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Ym=Gg(),Cw=function(){return!!Ym};Cw.hasArrayLengthDefineBug=function(){if(!Ym)return null;try{return Ym([],"length",{value:1}).length!==1}catch{return!0}};var Hg=Cw,bC=Ug,wC=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",xC=Object.prototype.toString,SC=Array.prototype.concat,D1=Zg,kC=function(r){return typeof r=="function"&&xC.call(r)==="[object Function]"},Iw=Hg(),TC=function(r,e,t,n){if(e in r){if(n===!0){if(r[e]===t)return}else if(!kC(n)||!n())return}Iw?D1(r,e,t,!0):D1(r,e,t)},Aw=function(r,e){var t=arguments.length>2?arguments[2]:{},n=bC(e);wC&&(n=SC.call(n,Object.getOwnPropertySymbols(e)));for(var l=0;l<n.length;l+=1)TC(r,n[l],e[n[l]],t[n[l]])};Aw.supportsDescriptors=!!Iw;var ol=Aw,Lw={exports:{}},EC=hs,R1=Zg,MC=Hg(),B1=Wg,F1=ba,CC=EC("%Math.floor%"),IC=function(e,t){if(typeof e!="function")throw new F1("`fn` is not a function");if(typeof t!="number"||t<0||t>4294967295||CC(t)!==t)throw new F1("`length` must be a positive 32-bit integer");var n=arguments.length>2&&!!arguments[2],l=!0,u=!0;if("length"in e&&B1){var d=B1(e,"length");d&&!d.configurable&&(l=!1),d&&!d.writable&&(u=!1)}return(l||u||!n)&&(MC?R1(e,"length",t,!0,!0):R1(e,"length",t)),e};(function(r){var e=qg,t=hs,n=IC,l=ba,u=t("%Function.prototype.apply%"),d=t("%Function.prototype.call%"),a=t("%Reflect.apply%",!0)||e.call(d,u),_=Gg(),x=t("%Math.max%");r.exports=function(C){if(typeof C!="function")throw new l("a function is required");var P=a(e,d,arguments);return n(P,1+x(0,C.length-(arguments.length-1)),!0)};var k=function(){return a(e,u,arguments)};_?_(r.exports,"apply",{value:k}):r.exports.apply=k})(Lw);var Rc=Lw.exports,Pw=hs,zw=Rc,AC=zw(Pw("String.prototype.indexOf")),Ro=function(e,t){var n=Pw(e,!!t);return typeof n=="function"&&AC(e,".prototype.")>-1?zw(n):n},LC=Ug,Dw=Vd(),Rw=Ro,O1=Object,PC=Rw("Array.prototype.push"),N1=Rw("Object.prototype.propertyIsEnumerable"),zC=Dw?Object.getOwnPropertySymbols:null,Bw=function(e,t){if(e==null)throw new TypeError("target must be an object");var n=O1(e);if(arguments.length===1)return n;for(var l=1;l<arguments.length;++l){var u=O1(arguments[l]),d=LC(u),a=Dw&&(Object.getOwnPropertySymbols||zC);if(a)for(var _=a(u),x=0;x<_.length;++x){var k=_[x];N1(u,k)&&PC(d,k)}for(var S=0;S<d.length;++S){var C=d[S];if(N1(u,C)){var P=u[C];n[C]=P}}}return n},fm=Bw,DC=function(){if(!Object.assign)return!1;for(var r="abcdefghijklmnopqrst",e=r.split(""),t={},n=0;n<e.length;++n)t[e[n]]=e[n];var l=Object.assign({},t),u="";for(var d in l)u+=d;return r!==u},RC=function(){if(!Object.assign||!Object.preventExtensions)return!1;var r=Object.preventExtensions({1:2});try{Object.assign(r,"xy")}catch{return r[1]==="y"}return!1},Fw=function(){return!Object.assign||DC()||RC()?fm:Object.assign},BC=ol,FC=Fw,OC=function(){var e=FC();return BC(Object,{assign:e},{assign:function(){return Object.assign!==e}}),e},NC=ol,jC=Rc,UC=Bw,Ow=Fw,VC=OC,qC=jC.apply(Ow()),Nw=function(e,t){return qC(Object,arguments)};NC(Nw,{getPolyfill:Ow,implementation:UC,shim:VC});var GC=Nw,bh=function(){return typeof(function(){}).name=="string"},sh=Object.getOwnPropertyDescriptor;if(sh)try{sh([],"length")}catch{sh=null}bh.functionsHaveConfigurableNames=function(){if(!bh()||!sh)return!1;var e=sh(function(){},"name");return!!e&&!!e.configurable};var WC=Function.prototype.bind;bh.boundFunctionsHaveNames=function(){return bh()&&typeof WC=="function"&&(function(){}).bind().name!==""};var ZC=bh,j1=Zg,HC=Hg(),$C=ZC.functionsHaveConfigurableNames(),XC=ba,KC=function(e,t){if(typeof e!="function")throw new XC("`fn` is not a function");var n=arguments.length>2&&!!arguments[2];return(!n||$C)&&(HC?j1(e,"name",t,!0,!0):j1(e,"name",t)),e},JC=KC,YC=ba,QC=Object,jw=JC(function(){if(this==null||this!==QC(this))throw new YC("RegExp.prototype.flags getter called on non-object");var e="";return this.hasIndices&&(e+="d"),this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),this.dotAll&&(e+="s"),this.unicode&&(e+="u"),this.unicodeSets&&(e+="v"),this.sticky&&(e+="y"),e},"get flags",!0),eI=jw,tI=ol.supportsDescriptors,rI=Object.getOwnPropertyDescriptor,Uw=function(){if(tI&&/a/mig.flags==="gim"){var e=rI(RegExp.prototype,"flags");if(e&&typeof e.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var t="",n={};if(Object.defineProperty(n,"hasIndices",{get:function(){t+="d"}}),Object.defineProperty(n,"sticky",{get:function(){t+="y"}}),t==="dy")return e.get}}return eI},nI=ol.supportsDescriptors,iI=Uw,oI=Object.getOwnPropertyDescriptor,sI=Object.defineProperty,aI=TypeError,U1=Object.getPrototypeOf,lI=/a/,cI=function(){if(!nI||!U1)throw new aI("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var e=iI(),t=U1(lI),n=oI(t,"flags");return(!n||n.get!==e)&&sI(t,"flags",{configurable:!0,enumerable:!1,get:e}),e},uI=ol,hI=Rc,fI=jw,Vw=Uw,dI=cI,qw=hI(Vw());uI(qw,{getPolyfill:Vw,implementation:fI,shim:dI});var pI=qw,ed={exports:{}},mI=Vd,sl=function(){return mI()&&!!Symbol.toStringTag},gI=sl(),_I=Ro,Qm=_I("Object.prototype.toString"),qd=function(e){return gI&&e&&typeof e=="object"&&Symbol.toStringTag in e?!1:Qm(e)==="[object Arguments]"},Gw=function(e){return qd(e)?!0:e!==null&&typeof e=="object"&&typeof e.length=="number"&&e.length>=0&&Qm(e)!=="[object Array]"&&Qm(e.callee)==="[object Function]"},yI=function(){return qd(arguments)}();qd.isLegacyArguments=Gw;var Ww=yI?qd:Gw;const vI={},bI=Object.freeze(Object.defineProperty({__proto__:null,default:vI},Symbol.toStringTag,{value:"Module"})),wI=Rd(bI);var $g=typeof Map=="function"&&Map.prototype,dm=Object.getOwnPropertyDescriptor&&$g?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,vd=$g&&dm&&typeof dm.get=="function"?dm.get:null,V1=$g&&Map.prototype.forEach,Xg=typeof Set=="function"&&Set.prototype,pm=Object.getOwnPropertyDescriptor&&Xg?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,bd=Xg&&pm&&typeof pm.get=="function"?pm.get:null,q1=Xg&&Set.prototype.forEach,xI=typeof WeakMap=="function"&&WeakMap.prototype,ah=xI?WeakMap.prototype.has:null,SI=typeof WeakSet=="function"&&WeakSet.prototype,lh=SI?WeakSet.prototype.has:null,kI=typeof WeakRef=="function"&&WeakRef.prototype,G1=kI?WeakRef.prototype.deref:null,TI=Boolean.prototype.valueOf,EI=Object.prototype.toString,MI=Function.prototype.toString,CI=String.prototype.match,Kg=String.prototype.slice,ca=String.prototype.replace,II=String.prototype.toUpperCase,W1=String.prototype.toLowerCase,Zw=RegExp.prototype.test,Z1=Array.prototype.concat,as=Array.prototype.join,AI=Array.prototype.slice,H1=Math.floor,eg=typeof BigInt=="function"?BigInt.prototype.valueOf:null,mm=Object.getOwnPropertySymbols,tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ec=typeof Symbol=="function"&&typeof Symbol.iterator=="object",Di=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ec||"symbol")?Symbol.toStringTag:null,Hw=Object.prototype.propertyIsEnumerable,$1=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(r){return r.__proto__}:null);function X1(r,e){if(r===1/0||r===-1/0||r!==r||r&&r>-1e3&&r<1e3||Zw.call(/e/,e))return e;var t=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof r=="number"){var n=r<0?-H1(-r):H1(r);if(n!==r){var l=String(n),u=Kg.call(e,l.length+1);return ca.call(l,t,"$&_")+"."+ca.call(ca.call(u,/([0-9]{3})/g,"$&_"),/_$/,"")}}return ca.call(e,t,"$&_")}var rg=wI,K1=rg.custom,J1=Xw(K1)?K1:null,LI=function r(e,t,n,l){var u=t||{};if(oa(u,"quoteStyle")&&u.quoteStyle!=="single"&&u.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(oa(u,"maxStringLength")&&(typeof u.maxStringLength=="number"?u.maxStringLength<0&&u.maxStringLength!==1/0:u.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var d=oa(u,"customInspect")?u.customInspect:!0;if(typeof d!="boolean"&&d!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(oa(u,"indent")&&u.indent!==null&&u.indent!=="	"&&!(parseInt(u.indent,10)===u.indent&&u.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(oa(u,"numericSeparator")&&typeof u.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=u.numericSeparator;if(typeof e>"u")return"undefined";if(e===null)return"null";if(typeof e=="boolean")return e?"true":"false";if(typeof e=="string")return Jw(e,u);if(typeof e=="number"){if(e===0)return 1/0/e>0?"0":"-0";var _=String(e);return a?X1(e,_):_}if(typeof e=="bigint"){var x=String(e)+"n";return a?X1(e,x):x}var k=typeof u.depth>"u"?5:u.depth;if(typeof n>"u"&&(n=0),n>=k&&k>0&&typeof e=="object")return ng(e)?"[Array]":"[Object]";var S=XI(u,n);if(typeof l>"u")l=[];else if(Kw(l,e)>=0)return"[Circular]";function C(He,Me,ut){if(Me&&(l=AI.call(l),l.push(Me)),ut){var At={depth:u.depth};return oa(u,"quoteStyle")&&(At.quoteStyle=u.quoteStyle),r(He,At,n+1,l)}return r(He,u,n+1,l)}if(typeof e=="function"&&!Y1(e)){var P=jI(e),D=Nf(e,C);return"[Function"+(P?": "+P:" (anonymous)")+"]"+(D.length>0?" { "+as.call(D,", ")+" }":"")}if(Xw(e)){var O=Ec?ca.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):tg.call(e);return typeof e=="object"&&!Ec?qu(O):O}if(ZI(e)){for(var z="<"+W1.call(String(e.nodeName)),B=e.attributes||[],N=0;N<B.length;N++)z+=" "+B[N].name+"="+$w(PI(B[N].value),"double",u);return z+=">",e.childNodes&&e.childNodes.length&&(z+="..."),z+="</"+W1.call(String(e.nodeName))+">",z}if(ng(e)){if(e.length===0)return"[]";var G=Nf(e,C);return S&&!$I(G)?"["+ig(G,S)+"]":"[ "+as.call(G,", ")+" ]"}if(DI(e)){var U=Nf(e,C);return!("cause"in Error.prototype)&&"cause"in e&&!Hw.call(e,"cause")?"{ ["+String(e)+"] "+as.call(Z1.call("[cause]: "+C(e.cause),U),", ")+" }":U.length===0?"["+String(e)+"]":"{ ["+String(e)+"] "+as.call(U,", ")+" }"}if(typeof e=="object"&&d){if(J1&&typeof e[J1]=="function"&&rg)return rg(e,{depth:k-n});if(d!=="symbol"&&typeof e.inspect=="function")return e.inspect()}if(UI(e)){var te=[];return V1&&V1.call(e,function(He,Me){te.push(C(Me,e,!0)+" => "+C(He,e))}),Q1("Map",vd.call(e),te,S)}if(GI(e)){var le=[];return q1&&q1.call(e,function(He){le.push(C(He,e))}),Q1("Set",bd.call(e),le,S)}if(VI(e))return gm("WeakMap");if(WI(e))return gm("WeakSet");if(qI(e))return gm("WeakRef");if(BI(e))return qu(C(Number(e)));if(OI(e))return qu(C(eg.call(e)));if(FI(e))return qu(TI.call(e));if(RI(e))return qu(C(String(e)));if(typeof window<"u"&&e===window)return"{ [object Window] }";if(e===Sh)return"{ [object globalThis] }";if(!zI(e)&&!Y1(e)){var $=Nf(e,C),J=$1?$1(e)===Object.prototype:e instanceof Object||e.constructor===Object,_e=e instanceof Object?"":"null prototype",ze=!J&&Di&&Object(e)===e&&Di in e?Kg.call(wa(e),8,-1):_e?"Object":"",re=J||typeof e.constructor!="function"?"":e.constructor.name?e.constructor.name+" ":"",ue=re+(ze||_e?"["+as.call(Z1.call([],ze||[],_e||[]),": ")+"] ":"");return $.length===0?ue+"{}":S?ue+"{"+ig($,S)+"}":ue+"{ "+as.call($,", ")+" }"}return String(e)};function $w(r,e,t){var n=(t.quoteStyle||e)==="double"?'"':"'";return n+r+n}function PI(r){return ca.call(String(r),/"/g,"&quot;")}function ng(r){return wa(r)==="[object Array]"&&(!Di||!(typeof r=="object"&&Di in r))}function zI(r){return wa(r)==="[object Date]"&&(!Di||!(typeof r=="object"&&Di in r))}function Y1(r){return wa(r)==="[object RegExp]"&&(!Di||!(typeof r=="object"&&Di in r))}function DI(r){return wa(r)==="[object Error]"&&(!Di||!(typeof r=="object"&&Di in r))}function RI(r){return wa(r)==="[object String]"&&(!Di||!(typeof r=="object"&&Di in r))}function BI(r){return wa(r)==="[object Number]"&&(!Di||!(typeof r=="object"&&Di in r))}function FI(r){return wa(r)==="[object Boolean]"&&(!Di||!(typeof r=="object"&&Di in r))}function Xw(r){if(Ec)return r&&typeof r=="object"&&r instanceof Symbol;if(typeof r=="symbol")return!0;if(!r||typeof r!="object"||!tg)return!1;try{return tg.call(r),!0}catch{}return!1}function OI(r){if(!r||typeof r!="object"||!eg)return!1;try{return eg.call(r),!0}catch{}return!1}var NI=Object.prototype.hasOwnProperty||function(r){return r in this};function oa(r,e){return NI.call(r,e)}function wa(r){return EI.call(r)}function jI(r){if(r.name)return r.name;var e=CI.call(MI.call(r),/^function\s*([\w$]+)/);return e?e[1]:null}function Kw(r,e){if(r.indexOf)return r.indexOf(e);for(var t=0,n=r.length;t<n;t++)if(r[t]===e)return t;return-1}function UI(r){if(!vd||!r||typeof r!="object")return!1;try{vd.call(r);try{bd.call(r)}catch{return!0}return r instanceof Map}catch{}return!1}function VI(r){if(!ah||!r||typeof r!="object")return!1;try{ah.call(r,ah);try{lh.call(r,lh)}catch{return!0}return r instanceof WeakMap}catch{}return!1}function qI(r){if(!G1||!r||typeof r!="object")return!1;try{return G1.call(r),!0}catch{}return!1}function GI(r){if(!bd||!r||typeof r!="object")return!1;try{bd.call(r);try{vd.call(r)}catch{return!0}return r instanceof Set}catch{}return!1}function WI(r){if(!lh||!r||typeof r!="object")return!1;try{lh.call(r,lh);try{ah.call(r,ah)}catch{return!0}return r instanceof WeakSet}catch{}return!1}function ZI(r){return!r||typeof r!="object"?!1:typeof HTMLElement<"u"&&r instanceof HTMLElement?!0:typeof r.nodeName=="string"&&typeof r.getAttribute=="function"}function Jw(r,e){if(r.length>e.maxStringLength){var t=r.length-e.maxStringLength,n="... "+t+" more character"+(t>1?"s":"");return Jw(Kg.call(r,0,e.maxStringLength),e)+n}var l=ca.call(ca.call(r,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,HI);return $w(l,"single",e)}function HI(r){var e=r.charCodeAt(0),t={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return t?"\\"+t:"\\x"+(e<16?"0":"")+II.call(e.toString(16))}function qu(r){return"Object("+r+")"}function gm(r){return r+" { ? }"}function Q1(r,e,t,n){var l=n?ig(t,n):as.call(t,", ");return r+" ("+e+") {"+l+"}"}function $I(r){for(var e=0;e<r.length;e++)if(Kw(r[e],`
`)>=0)return!1;return!0}function XI(r,e){var t;if(r.indent==="	")t="	";else if(typeof r.indent=="number"&&r.indent>0)t=as.call(Array(r.indent+1)," ");else return null;return{base:t,prev:as.call(Array(e+1),t)}}function ig(r,e){if(r.length===0)return"";var t=`
`+e.prev+e.base;return t+as.call(r,","+t)+`
`+e.prev}function Nf(r,e){var t=ng(r),n=[];if(t){n.length=r.length;for(var l=0;l<r.length;l++)n[l]=oa(r,l)?e(r[l],r):""}var u=typeof mm=="function"?mm(r):[],d;if(Ec){d={};for(var a=0;a<u.length;a++)d["$"+u[a]]=u[a]}for(var _ in r)oa(r,_)&&(t&&String(Number(_))===_&&_<r.length||Ec&&d["$"+_]instanceof Symbol||(Zw.call(/[^\w$]/,_)?n.push(e(_,r)+": "+e(r[_],r)):n.push(_+": "+e(r[_],r))));if(typeof mm=="function")for(var x=0;x<u.length;x++)Hw.call(r,u[x])&&n.push("["+e(u[x])+"]: "+e(r[u[x]],r));return n}var Yw=hs,Bc=Ro,KI=LI,JI=ba,jf=Yw("%WeakMap%",!0),Uf=Yw("%Map%",!0),YI=Bc("WeakMap.prototype.get",!0),QI=Bc("WeakMap.prototype.set",!0),eA=Bc("WeakMap.prototype.has",!0),tA=Bc("Map.prototype.get",!0),rA=Bc("Map.prototype.set",!0),nA=Bc("Map.prototype.has",!0),Jg=function(r,e){for(var t=r,n;(n=t.next)!==null;t=n)if(n.key===e)return t.next=n.next,n.next=r.next,r.next=n,n},iA=function(r,e){var t=Jg(r,e);return t&&t.value},oA=function(r,e,t){var n=Jg(r,e);n?n.value=t:r.next={key:e,next:r.next,value:t}},sA=function(r,e){return!!Jg(r,e)},Qw=function(){var e,t,n,l={assert:function(u){if(!l.has(u))throw new JI("Side channel does not contain "+KI(u))},get:function(u){if(jf&&u&&(typeof u=="object"||typeof u=="function")){if(e)return YI(e,u)}else if(Uf){if(t)return tA(t,u)}else if(n)return iA(n,u)},has:function(u){if(jf&&u&&(typeof u=="object"||typeof u=="function")){if(e)return eA(e,u)}else if(Uf){if(t)return nA(t,u)}else if(n)return sA(n,u);return!1},set:function(u,d){jf&&u&&(typeof u=="object"||typeof u=="function")?(e||(e=new jf),QI(e,u,d)):Uf?(t||(t=new Uf),rA(t,u,d)):(n||(n={key:{},next:null}),oA(n,u,d))}};return l},aA=Ew,Gu=Qw(),Cs=ba,Yg={assert:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Cs("`O` is not an object");if(typeof e!="string")throw new Cs("`slot` must be a string");if(Gu.assert(r),!Yg.has(r,e))throw new Cs("`"+e+"` is not present on `O`")},get:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Cs("`O` is not an object");if(typeof e!="string")throw new Cs("`slot` must be a string");var t=Gu.get(r);return t&&t["$"+e]},has:function(r,e){if(!r||typeof r!="object"&&typeof r!="function")throw new Cs("`O` is not an object");if(typeof e!="string")throw new Cs("`slot` must be a string");var t=Gu.get(r);return!!t&&aA(t,"$"+e)},set:function(r,e,t){if(!r||typeof r!="object"&&typeof r!="function")throw new Cs("`O` is not an object");if(typeof e!="string")throw new Cs("`slot` must be a string");var n=Gu.get(r);n||(n={},Gu.set(r,n)),n["$"+e]=t}};Object.freeze&&Object.freeze(Yg);var lA=Yg,Wu=lA,cA=SyntaxError,ev=typeof StopIteration=="object"?StopIteration:null,uA=function(e){if(!ev)throw new cA("this environment lacks StopIteration");Wu.set(e,"[[Done]]",!1);var t={next:function(){var l=Wu.get(this,"[[Iterator]]"),u=Wu.get(l,"[[Done]]");try{return{done:u,value:u?void 0:l.next()}}catch(d){if(Wu.set(l,"[[Done]]",!0),d!==ev)throw d;return{done:!0,value:void 0}}}};return Wu.set(t,"[[Iterator]]",e),t},hA={}.toString,ex=Array.isArray||function(r){return hA.call(r)=="[object Array]"},fA=String.prototype.valueOf,dA=function(e){try{return fA.call(e),!0}catch{return!1}},pA=Object.prototype.toString,mA="[object String]",gA=sl(),tx=function(e){return typeof e=="string"?!0:typeof e!="object"?!1:gA?dA(e):pA.call(e)===mA},Qg=typeof Map=="function"&&Map.prototype?Map:null,_A=typeof Set=="function"&&Set.prototype?Set:null,wd;Qg||(wd=function(e){return!1});var rx=Qg?Map.prototype.has:null,tv=_A?Set.prototype.has:null;!wd&&!rx&&(wd=function(e){return!1});var nx=wd||function(e){if(!e||typeof e!="object")return!1;try{if(rx.call(e),tv)try{tv.call(e)}catch{return!0}return e instanceof Qg}catch{}return!1},yA=typeof Map=="function"&&Map.prototype?Map:null,e_=typeof Set=="function"&&Set.prototype?Set:null,xd;e_||(xd=function(e){return!1});var rv=yA?Map.prototype.has:null,ix=e_?Set.prototype.has:null;!xd&&!ix&&(xd=function(e){return!1});var ox=xd||function(e){if(!e||typeof e!="object")return!1;try{if(ix.call(e),rv)try{rv.call(e)}catch{return!0}return e instanceof e_}catch{}return!1},nv=Ww,iv=uA;if(Vg()||Vd()){var _m=Symbol.iterator;ed.exports=function(e){if(e!=null&&typeof e[_m]<"u")return e[_m]();if(nv(e))return Array.prototype[_m].call(e)}}else{var vA=ex,bA=tx,ov=hs,wA=ov("%Map%",!0),xA=ov("%Set%",!0),qo=Ro,sv=qo("Array.prototype.push"),av=qo("String.prototype.charCodeAt"),SA=qo("String.prototype.slice"),kA=function(e,t){var n=e.length;if(t+1>=n)return t+1;var l=av(e,t);if(l<55296||l>56319)return t+1;var u=av(e,t+1);return u<56320||u>57343?t+1:t+2},ym=function(e){var t=0;return{next:function(){var l=t>=e.length,u;return l||(u=e[t],t+=1),{done:l,value:u}}}},lv=function(e,t){if(vA(e)||nv(e))return ym(e);if(bA(e)){var n=0;return{next:function(){var u=kA(e,n),d=SA(e,n,u);return n=u,{done:u>e.length,value:d}}}}if(t&&typeof e["_es6-shim iterator_"]<"u")return e["_es6-shim iterator_"]()};if(!wA&&!xA)ed.exports=function(e){if(e!=null)return lv(e,!0)};else{var TA=nx,EA=ox,cv=qo("Map.prototype.forEach",!0),uv=qo("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var hv=qo("Map.prototype.iterator",!0),fv=qo("Set.prototype.iterator",!0);var dv=qo("Map.prototype.@@iterator",!0)||qo("Map.prototype._es6-shim iterator_",!0),pv=qo("Set.prototype.@@iterator",!0)||qo("Set.prototype._es6-shim iterator_",!0),MA=function(e){if(TA(e)){if(hv)return iv(hv(e));if(dv)return dv(e);if(cv){var t=[];return cv(e,function(l,u){sv(t,[u,l])}),ym(t)}}if(EA(e)){if(fv)return iv(fv(e));if(pv)return pv(e);if(uv){var n=[];return uv(e,function(l){sv(n,l)}),ym(n)}}};ed.exports=function(e){return MA(e)||lv(e)}}}var CA=ed.exports,mv=function(r){return r!==r},sx=function(e,t){return e===0&&t===0?1/e===1/t:!!(e===t||mv(e)&&mv(t))},IA=sx,ax=function(){return typeof Object.is=="function"?Object.is:IA},AA=ax,LA=ol,PA=function(){var e=AA();return LA(Object,{is:e},{is:function(){return Object.is!==e}}),e},zA=ol,DA=Rc,RA=sx,lx=ax,BA=PA,cx=DA(lx(),Object);zA(cx,{getPolyfill:lx,implementation:RA,shim:BA});var FA=cx,OA=Rc,ux=Ro,NA=hs,og=NA("%ArrayBuffer%",!0),td=ux("ArrayBuffer.prototype.byteLength",!0),jA=ux("Object.prototype.toString"),gv=!!og&&!td&&new og(0).slice,_v=!!gv&&OA(gv),hx=td||_v?function(e){if(!e||typeof e!="object")return!1;try{return td?td(e):_v(e,0),!0}catch{return!1}}:og?function(e){return jA(e)==="[object ArrayBuffer]"}:function(e){return!1},UA=Date.prototype.getDay,VA=function(e){try{return UA.call(e),!0}catch{return!1}},qA=Object.prototype.toString,GA="[object Date]",WA=sl(),ZA=function(e){return typeof e!="object"||e===null?!1:WA?VA(e):qA.call(e)===GA},sg=Ro,fx=sl(),dx,px,ag,lg;if(fx){dx=sg("Object.prototype.hasOwnProperty"),px=sg("RegExp.prototype.exec"),ag={};var vm=function(){throw ag};lg={toString:vm,valueOf:vm},typeof Symbol.toPrimitive=="symbol"&&(lg[Symbol.toPrimitive]=vm)}var HA=sg("Object.prototype.toString"),$A=Object.getOwnPropertyDescriptor,XA="[object RegExp]",KA=fx?function(e){if(!e||typeof e!="object")return!1;var t=$A(e,"lastIndex"),n=t&&dx(t,"value");if(!n)return!1;try{px(e,lg)}catch(l){return l===ag}}:function(e){return!e||typeof e!="object"&&typeof e!="function"?!1:HA(e)===XA},JA=Ro,yv=JA("SharedArrayBuffer.prototype.byteLength",!0),YA=yv?function(e){if(!e||typeof e!="object")return!1;try{return yv(e),!0}catch{return!1}}:function(e){return!1},QA=Number.prototype.toString,eL=function(e){try{return QA.call(e),!0}catch{return!1}},tL=Object.prototype.toString,rL="[object Number]",nL=sl(),iL=function(e){return typeof e=="number"?!0:typeof e!="object"?!1:nL?eL(e):tL.call(e)===rL},mx=Ro,oL=mx("Boolean.prototype.toString"),sL=mx("Object.prototype.toString"),aL=function(e){try{return oL(e),!0}catch{return!1}},lL="[object Boolean]",cL=sl(),uL=function(e){return typeof e=="boolean"?!0:e===null||typeof e!="object"?!1:cL&&Symbol.toStringTag in e?aL(e):sL(e)===lL},cg={exports:{}},hL=Object.prototype.toString,fL=Vg();if(fL){var dL=Symbol.prototype.toString,pL=/^Symbol\(.*\)$/,mL=function(e){return typeof e.valueOf()!="symbol"?!1:pL.test(dL.call(e))};cg.exports=function(e){if(typeof e=="symbol")return!0;if(hL.call(e)!=="[object Symbol]")return!1;try{return mL(e)}catch{return!1}}}else cg.exports=function(e){return!1};var gL=cg.exports,ug={exports:{}},vv=typeof BigInt<"u"&&BigInt,_L=function(){return typeof vv=="function"&&typeof BigInt=="function"&&typeof vv(42)=="bigint"&&typeof BigInt(42)=="bigint"},yL=_L();if(yL){var vL=BigInt.prototype.valueOf,bL=function(e){try{return vL.call(e),!0}catch{}return!1};ug.exports=function(e){return e===null||typeof e>"u"||typeof e=="boolean"||typeof e=="string"||typeof e=="number"||typeof e=="symbol"||typeof e=="function"?!1:typeof e=="bigint"?!0:bL(e)}}else ug.exports=function(e){return!1};var wL=ug.exports,xL=tx,SL=iL,kL=uL,TL=gL,EL=wL,ML=function(e){if(e==null||typeof e!="object"&&typeof e!="function")return null;if(xL(e))return"String";if(SL(e))return"Number";if(kL(e))return"Boolean";if(TL(e))return"Symbol";if(EL(e))return"BigInt"},Sd=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,bv=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,kd;Sd||(kd=function(e){return!1});var hg=Sd?Sd.prototype.has:null,bm=bv?bv.prototype.has:null;!kd&&!hg&&(kd=function(e){return!1});var CL=kd||function(e){if(!e||typeof e!="object")return!1;try{if(hg.call(e,hg),bm)try{bm.call(e,bm)}catch{return!0}return e instanceof Sd}catch{}return!1},fg={exports:{}},IL=hs,gx=Ro,AL=IL("%WeakSet%",!0),wm=gx("WeakSet.prototype.has",!0);if(wm){var xm=gx("WeakMap.prototype.has",!0);fg.exports=function(e){if(!e||typeof e!="object")return!1;try{if(wm(e,wm),xm)try{xm(e,xm)}catch{return!0}return e instanceof AL}catch{}return!1}}else fg.exports=function(e){return!1};var LL=fg.exports,PL=nx,zL=ox,DL=CL,RL=LL,BL=function(e){if(e&&typeof e=="object"){if(PL(e))return"Map";if(zL(e))return"Set";if(DL(e))return"WeakMap";if(RL(e))return"WeakSet"}return!1},_x=Function.prototype.toString,_c=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,dg,rd;if(typeof _c=="function"&&typeof Object.defineProperty=="function")try{dg=Object.defineProperty({},"length",{get:function(){throw rd}}),rd={},_c(function(){throw 42},null,dg)}catch(r){r!==rd&&(_c=null)}else _c=null;var FL=/^\s*class\b/,pg=function(e){try{var t=_x.call(e);return FL.test(t)}catch{return!1}},Sm=function(e){try{return pg(e)?!1:(_x.call(e),!0)}catch{return!1}},nd=Object.prototype.toString,OL="[object Object]",NL="[object Function]",jL="[object GeneratorFunction]",UL="[object HTMLAllCollection]",VL="[object HTML document.all class]",qL="[object HTMLCollection]",GL=typeof Symbol=="function"&&!!Symbol.toStringTag,WL=!(0 in[,]),mg=function(){return!1};if(typeof document=="object"){var ZL=document.all;nd.call(ZL)===nd.call(document.all)&&(mg=function(e){if((WL||!e)&&(typeof e>"u"||typeof e=="object"))try{var t=nd.call(e);return(t===UL||t===VL||t===qL||t===OL)&&e("")==null}catch{}return!1})}var HL=_c?function(e){if(mg(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;try{_c(e,null,dg)}catch(t){if(t!==rd)return!1}return!pg(e)&&Sm(e)}:function(e){if(mg(e))return!0;if(!e||typeof e!="function"&&typeof e!="object")return!1;if(GL)return Sm(e);if(pg(e))return!1;var t=nd.call(e);return t!==NL&&t!==jL&&!/^\[object HTML/.test(t)?!1:Sm(e)},$L=HL,XL=Object.prototype.toString,yx=Object.prototype.hasOwnProperty,KL=function(e,t,n){for(var l=0,u=e.length;l<u;l++)yx.call(e,l)&&(n==null?t(e[l],l,e):t.call(n,e[l],l,e))},JL=function(e,t,n){for(var l=0,u=e.length;l<u;l++)n==null?t(e.charAt(l),l,e):t.call(n,e.charAt(l),l,e)},YL=function(e,t,n){for(var l in e)yx.call(e,l)&&(n==null?t(e[l],l,e):t.call(n,e[l],l,e))},QL=function(e,t,n){if(!$L(t))throw new TypeError("iterator must be a function");var l;arguments.length>=3&&(l=n),XL.call(e)==="[object Array]"?KL(e,t,l):typeof e=="string"?JL(e,t,l):YL(e,t,l)},eP=QL,tP=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],km=tP,rP=typeof globalThis>"u"?Sh:globalThis,nP=function(){for(var e=[],t=0;t<km.length;t++)typeof rP[km[t]]=="function"&&(e[e.length]=km[t]);return e},Td=eP,iP=nP,wv=Rc,t_=Ro,id=Wg,oP=t_("Object.prototype.toString"),vx=sl(),xv=typeof globalThis>"u"?Sh:globalThis,gg=iP(),r_=t_("String.prototype.slice"),Tm=Object.getPrototypeOf,sP=t_("Array.prototype.indexOf",!0)||function(e,t){for(var n=0;n<e.length;n+=1)if(e[n]===t)return n;return-1},Ed={__proto__:null};vx&&id&&Tm?Td(gg,function(r){var e=new xv[r];if(Symbol.toStringTag in e){var t=Tm(e),n=id(t,Symbol.toStringTag);if(!n){var l=Tm(t);n=id(l,Symbol.toStringTag)}Ed["$"+r]=wv(n.get)}}):Td(gg,function(r){var e=new xv[r],t=e.slice||e.set;t&&(Ed["$"+r]=wv(t))});var aP=function(e){var t=!1;return Td(Ed,function(n,l){if(!t)try{"$"+n(e)===l&&(t=r_(l,1))}catch{}}),t},lP=function(e){var t=!1;return Td(Ed,function(n,l){if(!t)try{n(e),t=r_(l,1)}catch{}}),t},cP=function(e){if(!e||typeof e!="object")return!1;if(!vx){var t=r_(oP(e),8,-1);return sP(gg,t)>-1?t:t!=="Object"?!1:lP(e)}return id?aP(e):null},uP=Ro,Sv=uP("ArrayBuffer.prototype.byteLength",!0),hP=hx,fP=function(e){return hP(e)?Sv?Sv(e):e.byteLength:NaN},bx=GC,fs=Ro,kv=pI,dP=hs,Mc=CA,pP=Qw,Tv=FA,Ev=Ww,Mv=ex,Cv=hx,Iv=ZA,Av=KA,Lv=YA,Pv=Ug,zv=ML,Dv=BL,Rv=cP,Bv=fP,Fv=fs("SharedArrayBuffer.prototype.byteLength",!0),Ov=fs("Date.prototype.getTime"),Em=Object.getPrototypeOf,Nv=fs("Object.prototype.toString"),Md=dP("%Set%",!0),_g=fs("Map.prototype.has",!0),Cd=fs("Map.prototype.get",!0),jv=fs("Map.prototype.size",!0),Id=fs("Set.prototype.add",!0),wx=fs("Set.prototype.delete",!0),Ad=fs("Set.prototype.has",!0),od=fs("Set.prototype.size",!0);function Uv(r,e,t,n){for(var l=Mc(r),u;(u=l.next())&&!u.done;)if(Ho(e,u.value,t,n))return wx(r,u.value),!0;return!1}function xx(r){if(typeof r>"u")return null;if(typeof r!="object")return typeof r=="symbol"?!1:typeof r=="string"||typeof r=="number"?+r==+r:!0}function mP(r,e,t,n,l,u){var d=xx(t);if(d!=null)return d;var a=Cd(e,d),_=bx({},l,{strict:!1});return typeof a>"u"&&!_g(e,d)||!Ho(n,a,_,u)?!1:!_g(r,d)&&Ho(n,a,_,u)}function gP(r,e,t){var n=xx(t);return n??(Ad(e,n)&&!Ad(r,n))}function Vv(r,e,t,n,l,u){for(var d=Mc(r),a,_;(a=d.next())&&!a.done;)if(_=a.value,Ho(t,_,l,u)&&Ho(n,Cd(e,_),l,u))return wx(r,_),!0;return!1}function Ho(r,e,t,n){var l=t||{};if(l.strict?Tv(r,e):r===e)return!0;var u=zv(r),d=zv(e);if(u!==d)return!1;if(!r||!e||typeof r!="object"&&typeof e!="object")return l.strict?Tv(r,e):r==e;var a=n.has(r),_=n.has(e),x;if(a&&_){if(n.get(r)===n.get(e))return!0}else x={};return a||n.set(r,x),_||n.set(e,x),vP(r,e,l,n)}function qv(r){return!r||typeof r!="object"||typeof r.length!="number"||typeof r.copy!="function"||typeof r.slice!="function"||r.length>0&&typeof r[0]!="number"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function _P(r,e,t,n){if(od(r)!==od(e))return!1;for(var l=Mc(r),u=Mc(e),d,a,_;(d=l.next())&&!d.done;)if(d.value&&typeof d.value=="object")_||(_=new Md),Id(_,d.value);else if(!Ad(e,d.value)){if(t.strict||!gP(r,e,d.value))return!1;_||(_=new Md),Id(_,d.value)}if(_){for(;(a=u.next())&&!a.done;)if(a.value&&typeof a.value=="object"){if(!Uv(_,a.value,t.strict,n))return!1}else if(!t.strict&&!Ad(r,a.value)&&!Uv(_,a.value,t.strict,n))return!1;return od(_)===0}return!0}function yP(r,e,t,n){if(jv(r)!==jv(e))return!1;for(var l=Mc(r),u=Mc(e),d,a,_,x,k,S;(d=l.next())&&!d.done;)if(x=d.value[0],k=d.value[1],x&&typeof x=="object")_||(_=new Md),Id(_,x);else if(S=Cd(e,x),typeof S>"u"&&!_g(e,x)||!Ho(k,S,t,n)){if(t.strict||!mP(r,e,x,k,t,n))return!1;_||(_=new Md),Id(_,x)}if(_){for(;(a=u.next())&&!a.done;)if(x=a.value[0],S=a.value[1],x&&typeof x=="object"){if(!Vv(_,r,x,S,t,n))return!1}else if(!t.strict&&(!r.has(x)||!Ho(Cd(r,x),S,t,n))&&!Vv(_,r,x,S,bx({},t,{strict:!1}),n))return!1;return od(_)===0}return!0}function vP(r,e,t,n){var l,u;if(typeof r!=typeof e||r==null||e==null||Nv(r)!==Nv(e)||Ev(r)!==Ev(e))return!1;var d=Mv(r),a=Mv(e);if(d!==a)return!1;var _=r instanceof Error,x=e instanceof Error;if(_!==x||(_||x)&&(r.name!==e.name||r.message!==e.message))return!1;var k=Av(r),S=Av(e);if(k!==S||(k||S)&&(r.source!==e.source||kv(r)!==kv(e)))return!1;var C=Iv(r),P=Iv(e);if(C!==P||(C||P)&&Ov(r)!==Ov(e)||t.strict&&Em&&Em(r)!==Em(e))return!1;var D=Rv(r),O=Rv(e);if(D!==O)return!1;if(D||O){if(r.length!==e.length)return!1;for(l=0;l<r.length;l++)if(r[l]!==e[l])return!1;return!0}var z=qv(r),B=qv(e);if(z!==B)return!1;if(z||B){if(r.length!==e.length)return!1;for(l=0;l<r.length;l++)if(r[l]!==e[l])return!1;return!0}var N=Cv(r),G=Cv(e);if(N!==G)return!1;if(N||G)return Bv(r)!==Bv(e)?!1:typeof Uint8Array=="function"&&Ho(new Uint8Array(r),new Uint8Array(e),t,n);var U=Lv(r),te=Lv(e);if(U!==te)return!1;if(U||te)return Fv(r)!==Fv(e)?!1:typeof Uint8Array=="function"&&Ho(new Uint8Array(r),new Uint8Array(e),t,n);if(typeof r!=typeof e)return!1;var le=Pv(r),$=Pv(e);if(le.length!==$.length)return!1;for(le.sort(),$.sort(),l=le.length-1;l>=0;l--)if(le[l]!=$[l])return!1;for(l=le.length-1;l>=0;l--)if(u=le[l],!Ho(r[u],e[u],t,n))return!1;var J=Dv(r),_e=Dv(e);return J!==_e?!1:J==="Set"||_e==="Set"?_P(r,e,t,n):J==="Map"?yP(r,e,t,n):!0}var bP=function(e,t,n){return Ho(e,t,n,pP())};const wP=kg(bP);var xP=Object.defineProperty,Hr=(r,e)=>xP(r,"name",{value:e,configurable:!0}),SP=class{constructor(e){this.direction=!1,this.compareProperties=!0;var t,n,l;this.precision=10**-((t=e==null?void 0:e.precision)!=null?t:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(l=e==null?void 0:e.compareProperties)!=null?l:!0}compare(e,t){if(e.type!==t.type||!eh(e,t))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,t.coordinates);case"LineString":return this.compareLine(e.coordinates,t.coordinates);case"Polygon":return this.comparePolygon(e,t);case"GeometryCollection":return this.compareGeometryCollection(e,t);case"Feature":return this.compareFeature(e,t);case"FeatureCollection":return this.compareFeatureCollection(e,t);default:if(e.type.startsWith("Multi")){const n=yg(e),l=yg(t);return n.every(u=>l.some(d=>this.compare(u,d)))}}return!1}compareCoord(e,t){return e.length===t.length&&e.every((n,l)=>Math.abs(n-t[l])<this.precision)}compareLine(e,t,n=0,l=!1){if(!eh(e,t))return!1;const u=e;let d=t;if(l&&!this.compareCoord(u[0],d[0])){const _=this.fixStartIndex(d,u);if(_)d=_;else return!1}const a=this.compareCoord(u[n],d[n]);return this.direction||a?this.comparePath(u,d):this.compareCoord(u[n],d[d.length-(1+n)])?this.comparePath(u.slice().reverse(),d):!1}fixStartIndex(e,t){let n,l=-1;for(let u=0;u<e.length;u++)if(this.compareCoord(e[u],t[0])){l=u;break}return l>=0&&(n=[].concat(e.slice(l,e.length),e.slice(1,l+1))),n}comparePath(e,t){return e.every((n,l)=>this.compareCoord(n,t[l]))}comparePolygon(e,t){if(this.compareLine(e.coordinates[0],t.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),l=t.coordinates.slice(1,t.coordinates.length);return n.every(u=>l.some(d=>this.compareLine(u,d,1,!0)))}return!1}compareGeometryCollection(e,t){return eh(e.geometries,t.geometries)&&this.compareBBox(e,t)&&e.geometries.every((n,l)=>this.compare(n,t.geometries[l]))}compareFeature(e,t){return e.id===t.id&&(this.compareProperties?wP(e.properties,t.properties):!0)&&this.compareBBox(e,t)&&this.compare(e.geometry,t.geometry)}compareFeatureCollection(e,t){return eh(e.features,t.features)&&this.compareBBox(e,t)&&e.features.every((n,l)=>this.compare(n,t.features[l]))}compareBBox(e,t){return!e.bbox&&!t.bbox||(e.bbox&&t.bbox?this.compareCoord(e.bbox,t.bbox):!1)}};Hr(SP,"GeojsonEquality");function eh(r,e){return r.coordinates?r.coordinates.length===e.coordinates.length:r.length===e.length}Hr(eh,"sameLength");function yg(r){return r.coordinates.map(e=>({type:r.type.replace("Multi",""),coordinates:e}))}Hr(yg,"explode");var ho=63710088e-1,Sx={centimeters:ho*100,centimetres:ho*100,degrees:360/(2*Math.PI),feet:ho*3.28084,inches:ho*39.37,kilometers:ho/1e3,kilometres:ho/1e3,meters:ho,metres:ho,miles:ho/1609.344,millimeters:ho*1e3,millimetres:ho*1e3,nauticalmiles:ho/1852,radians:1,yards:ho*1.0936},Gv={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function xa(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}Hr(xa,"feature");function kP(r,e,t={}){switch(r){case"Point":return Cc(e).geometry;case"LineString":return i_(e).geometry;case"Polygon":return n_(e).geometry;case"MultiPoint":return Tx(e).geometry;case"MultiLineString":return kx(e).geometry;case"MultiPolygon":return Ex(e).geometry;default:throw new Error(r+" is invalid")}}Hr(kP,"geometry");function Cc(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ic(r[0])||!Ic(r[1]))throw new Error("coordinates must contain numbers");return xa({type:"Point",coordinates:r},e,t)}Hr(Cc,"point");function TP(r,e,t={}){return Gd(r.map(n=>Cc(n,e)),t)}Hr(TP,"points");function n_(r,e,t={}){for(const l of r){if(l.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(l[l.length-1].length!==l[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<l[l.length-1].length;u++)if(l[l.length-1][u]!==l[0][u])throw new Error("First and last Position are not equivalent.")}return xa({type:"Polygon",coordinates:r},e,t)}Hr(n_,"polygon");function EP(r,e,t={}){return Gd(r.map(n=>n_(n,e)),t)}Hr(EP,"polygons");function i_(r,e,t={}){if(r.length<2)throw new Error("coordinates must be an array of two or more positions");return xa({type:"LineString",coordinates:r},e,t)}Hr(i_,"lineString");function MP(r,e,t={}){return Gd(r.map(n=>i_(n,e)),t)}Hr(MP,"lineStrings");function Gd(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}Hr(Gd,"featureCollection");function kx(r,e,t={}){return xa({type:"MultiLineString",coordinates:r},e,t)}Hr(kx,"multiLineString");function Tx(r,e,t={}){return xa({type:"MultiPoint",coordinates:r},e,t)}Hr(Tx,"multiPoint");function Ex(r,e,t={}){return xa({type:"MultiPolygon",coordinates:r},e,t)}Hr(Ex,"multiPolygon");function CP(r,e,t={}){return xa({type:"GeometryCollection",geometries:r},e,t)}Hr(CP,"geometryCollection");function IP(r,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const t=Math.pow(10,e||0);return Math.round(r*t)/t}Hr(IP,"round");function o_(r,e="kilometers"){const t=Sx[e];if(!t)throw new Error(e+" units is invalid");return r*t}Hr(o_,"radiansToLength");function Wd(r,e="kilometers"){const t=Sx[e];if(!t)throw new Error(e+" units is invalid");return r/t}Hr(Wd,"lengthToRadians");function AP(r,e){return wh(Wd(r,e))}Hr(AP,"lengthToDegrees");function LP(r){let e=r%360;return e<0&&(e+=360),e}Hr(LP,"bearingToAzimuth");function wh(r){return r%(2*Math.PI)*180/Math.PI}Hr(wh,"radiansToDegrees");function Lo(r){return r%360*Math.PI/180}Hr(Lo,"degreesToRadians");function PP(r,e="kilometers",t="kilometers"){if(!(r>=0))throw new Error("length must be a positive number");return o_(Wd(r,e),t)}Hr(PP,"convertLength");function zP(r,e="meters",t="kilometers"){if(!(r>=0))throw new Error("area must be a positive number");const n=Gv[e];if(!n)throw new Error("invalid original units");const l=Gv[t];if(!l)throw new Error("invalid final units");return r/n*l}Hr(zP,"convertArea");function Ic(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}Hr(Ic,"isNumber");function DP(r){return r!==null&&typeof r=="object"&&!Array.isArray(r)}Hr(DP,"isObject");function RP(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(e=>{if(!Ic(e))throw new Error("bbox must only contain numbers")})}Hr(RP,"validateBBox");function BP(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}Hr(BP,"validateId");var FP=Object.defineProperty,Sa=(r,e)=>FP(r,"name",{value:e,configurable:!0});function Ac(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Sa(Ac,"getCoord");function OP(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Sa(OP,"getCoords");function Mx(r){if(r.length>1&&Ic(r[0])&&Ic(r[1]))return!0;if(Array.isArray(r[0])&&r[0].length)return Mx(r[0]);throw new Error("coordinates must only contain numbers")}Sa(Mx,"containsNumber");function NP(r,e,t){if(!e||!t)throw new Error("type and name required");if(!r||r.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.type)}Sa(NP,"geojsonType");function jP(r,e,t){if(!r)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+r.geometry.type)}Sa(jP,"featureOf");function UP(r,e,t){if(!r)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!r||r.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(const n of r.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+t+": must be a "+e+", given "+n.geometry.type)}}Sa(UP,"collectionOf");function Cx(r){return r.type==="Feature"?r.geometry:r}Sa(Cx,"getGeom");function VP(r,e){return r.type==="FeatureCollection"?"FeatureCollection":r.type==="GeometryCollection"?"GeometryCollection":r.type==="Feature"&&r.geometry!==null?r.geometry.type:r.type}Sa(VP,"getType");var qP=Object.defineProperty,Ix=(r,e)=>qP(r,"name",{value:e,configurable:!0});function s_(r,e,t={}){if(t.final===!0)return Ax(r,e);const n=Ac(r),l=Ac(e),u=Lo(n[0]),d=Lo(l[0]),a=Lo(n[1]),_=Lo(l[1]),x=Math.sin(d-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return wh(Math.atan2(x,k))}Ix(s_,"bearing");function Ax(r,e){let t=s_(e,r);return t=(t+180)%360,t}Ix(Ax,"calculateFinalBearing");var GP=Object.defineProperty,WP=(r,e)=>GP(r,"name",{value:e,configurable:!0});function Lx(r,e,t,n={}){const l=Ac(r),u=Lo(l[0]),d=Lo(l[1]),a=Lo(t),_=Wd(e,n.units),x=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(x)),S=wh(k),C=wh(x);return Cc([S,C],n.properties)}WP(Lx,"destination");var ZP=Object.defineProperty,HP=(r,e)=>ZP(r,"name",{value:e,configurable:!0});function Px(r,e,t={}){var n=Ac(r),l=Ac(e),u=Lo(l[1]-n[1]),d=Lo(l[0]-n[0]),a=Lo(n[1]),_=Lo(l[1]),x=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return o_(2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x)),t.units)}HP(Px,"distance");var $P=Object.defineProperty,XP=(r,e)=>$P(r,"name",{value:e,configurable:!0});function zx(r,e,t={}){const l=Cx(r).coordinates;let u=0;for(let d=0;d<l.length&&!(e>=u&&d===l.length-1);d++)if(u>=e){const a=e-u;if(a){const _=s_(l[d],l[d-1])-180;return Lx(l[d],a,_,t)}else return Cc(l[d])}else u+=Px(l[d],l[d+1],t);return Cc(l[l.length-1])}XP(zx,"along");var KP=zx;function JP(r){let e,t;const n=[Hn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new zg({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function YP(r){let e,t;return e=new Pi({props:{data:r[0],$$slots:{default:[JP]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&1024&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}let QP=50,e6=100,t6=.01;function r6(r,e,t){let{paths:n}=e,l=_(),u=x(),d=S(),a=setInterval(C,e6);ti(()=>clearInterval(a));function _(){return n.features.map(P=>1/P.properties.directness).reduce((P,D)=>P+D,0)}function x(){return n.features.length==0?[]:Array.from({length:QP},k)}function k(){let P=Math.random()*l,D=0;for(let[O,z]of n.features.entries())if(D+=1/z.properties.directness,P<D)return{idx:O,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function S(){return{type:"FeatureCollection",features:u.map(({idx:P,distance:D})=>KP(n.features[P],D,{units:"kilometers"}))}}function C(){for(let[P,D]of u.entries())D.distance+=t6,D.distance>=n.features[D.idx].properties.length_meters/1e3&&(u[P]=k());t(0,d=S())}return r.$$set=P=>{"paths"in P&&t(1,n=P.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(l=_(),u=x())},[d,n]}class n6 extends Ht{constructor(e){super(),Zt(this,e,r6,YP,jt,{paths:1})}}function i6(r){let e;return{c(){e=tt("Choose project")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function o6(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function s6(r){let e;return{c(){e=de("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function a6(r){let e;return{c(){e=tt("View shortcuts")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function l6(r){let e;return{c(){e=tt("Route")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function c6(r){let e;return{c(){e=tt("Change this boundary")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function u6(r){let e;return{c(){e=tt("Debug")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function h6(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D,O,z,B,N,G,U,te,le,$,J,_e,ze,re;return u=new Zr({props:{$$slots:{default:[i6]},$$scope:{ctx:r}}}),u.$on("click",r[28]),_=new Zr({props:{$$slots:{default:[o6]},$$scope:{ctx:r}}}),_.$on("click",r[29]),C=new jg({props:{$$slots:{default:[s6]},$$scope:{ctx:r}}}),B=new Zr({props:{$$slots:{default:[a6]},$$scope:{ctx:r}}}),B.$on("click",r[30]),U=new Zr({props:{$$slots:{default:[l6]},$$scope:{ctx:r}}}),U.$on("click",r[31]),$=new Zr({props:{$$slots:{default:[c6]},$$scope:{ctx:r}}}),$.$on("click",r[32]),ze=new Zr({props:{$$slots:{default:[u6]},$$scope:{ctx:r}}}),ze.$on("click",r[33]),{c(){e=de("div"),t=de("nav"),n=de("ul"),l=de("li"),Ve(u.$$.fragment),d=Ue(),a=de("li"),Ve(_.$$.fragment),x=Ue(),k=de("li"),S=tt(`Editing
          `),Ve(C.$$.fragment),P=Ue(),D=de("nav"),O=de("ul"),z=de("li"),Ve(B.$$.fragment),N=Ue(),G=de("li"),Ve(U.$$.fragment),te=Ue(),le=de("li"),Ve($.$$.fragment),J=Ue(),_e=de("li"),Ve(ze.$$.fragment),Ee(t,"aria-label","breadcrumb"),Ee(e,"slot","top"),fn(e,"display","flex"),fn(e,"justify-content","space-between")},m(ue,He){be(ue,e,He),ie(e,t),ie(t,n),ie(n,l),Ne(u,l,null),ie(n,d),ie(n,a),Ne(_,a,null),ie(n,x),ie(n,k),ie(k,S),Ne(C,k,null),ie(e,P),ie(e,D),ie(D,O),ie(O,z),Ne(B,z,null),ie(O,N),ie(O,G),Ne(U,G,null),ie(O,te),ie(O,le),Ne($,le,null),ie(O,J),ie(O,_e),Ne(ze,_e,null),re=!0},p(ue,He){const Me={};He[1]&64&&(Me.$$scope={dirty:He,ctx:ue}),u.$set(Me);const ut={};He[1]&64&&(ut.$$scope={dirty:He,ctx:ue}),_.$set(ut);const At={};He[1]&64&&(At.$$scope={dirty:He,ctx:ue}),C.$set(At);const Nt={};He[1]&64&&(Nt.$$scope={dirty:He,ctx:ue}),B.$set(Nt);const Je={};He[1]&64&&(Je.$$scope={dirty:He,ctx:ue}),U.$set(Je);const Jt={};He[1]&64&&(Jt.$$scope={dirty:He,ctx:ue}),$.$set(Jt);const Kt={};He[1]&64&&(Kt.$$scope={dirty:He,ctx:ue}),ze.$set(Kt)},i(ue){re||(oe(u.$$.fragment,ue),oe(_.$$.fragment,ue),oe(C.$$.fragment,ue),oe(B.$$.fragment,ue),oe(U.$$.fragment,ue),oe($.$$.fragment,ue),oe(ze.$$.fragment,ue),re=!0)},o(ue){pe(u.$$.fragment,ue),pe(_.$$.fragment,ue),pe(C.$$.fragment,ue),pe(B.$$.fragment,ue),pe(U.$$.fragment,ue),pe($.$$.fragment,ue),pe(ze.$$.fragment,ue),re=!1},d(ue){ue&&ve(e),je(u),je(_),je(C),je(B),je(U),je($),je(ze)}}}function Wv(r){let e;return{c(){e=de("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function f6(r){let e,t,n;return{c(){e=tt("Undo ("),t=tt(r[4]),n=tt(")")},m(l,u){be(l,e,u),be(l,t,u),be(l,n,u)},p(l,u){u[0]&16&&Lr(t,l[4])},d(l){l&&(ve(e),ve(t),ve(n))}}}function d6(r){let e;return{c(){e=tt("Undo")},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function p6(r){let e,t,n;return{c(){e=tt("Redo ("),t=tt(r[5]),n=tt(")")},m(l,u){be(l,e,u),be(l,t,u),be(l,n,u)},p(l,u){u[0]&32&&Lr(t,l[5])},d(l){l&&(ve(e),ve(t),ve(n))}}}function m6(r){let e;return{c(){e=tt("Redo")},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function Zv(r){let e,t;return e=new kM({}),e.$on("close",r[27]),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function g6(r){let e,t,n,l,u=dn(r[6]).properties.name+"",d,a,_=r[1].area_km2.toFixed(1)+"",x,k,S,C,P,D,O,z,B,N,G,U,te,le,$,J,_e,ze,re,ue,He,Me,ut,At,Nt,Je,Jt,Kt,Ut,Vt,wt,Yt,gr,Pt,rr,wr,mr,Rr,ht,Mt=r[8]>0&&Wv();function De(Ze,bt){return Ze[4]==0?d6:f6}let lt=De(r),nt=lt(r);function xt(Ze,bt){return Ze[5]==0?m6:p6}let ne=xt(r),nr=ne(r),Be=r[3]&&Zv(r);return{c(){e=de("div"),t=de("p"),n=tt("Editing neighbourhood "),l=de("u"),d=tt(u),a=tt(`
      , with an area of `),x=tt(_),k=tt(" km"),S=Ue(),Mt&&Mt.c(),C=Ue(),P=de("div"),D=de("button"),O=de("img"),B=tt(`
        Add a modal filter`),G=Ue(),U=de("button"),te=tt("Add many modal filters along line"),$=Ue(),J=de("button"),_e=tt("Reverse directions"),re=Ue(),ue=de("button"),ue.textContent="Change modal filter type",He=Ue(),Me=de("label"),ut=de("input"),At=tt(`
      Animate shortcuts`),Nt=Ue(),Je=de("label"),Jt=de("input"),Kt=tt(`
      Include perimeter roads`),Ut=Ue(),Vt=de("div"),wt=de("button"),nt.c(),gr=Ue(),Pt=de("button"),nr.c(),wr=Ue(),Be&&Be.c(),En(O.src,z=`/ltn//filters/${r[9]}_icon.gif`)||Ee(O,"src",z),Ee(O,"width","30"),Ee(O,"alt","Add a modal filter"),D.disabled=N=r[0]=="filter",Ee(D,"data-tooltip","hotkey 1"),U.disabled=le=r[0]=="freehand-filters",Ee(U,"data-tooltip","hotkey 2"),J.disabled=ze=r[0]=="oneway",Ee(J,"data-tooltip","hotkey 3"),fn(P,"display","flex"),fn(P,"justify-content","space-between"),Ee(ut,"type","checkbox"),Ee(Jt,"type","checkbox"),wt.disabled=Yt=r[4]==0,Ee(wt,"data-tooltip","Ctrl+Z"),Pt.disabled=rr=r[5]==0,Ee(Pt,"data-tooltip","Ctrl+Y"),fn(Vt,"display","flex"),fn(Vt,"justify-content","space-between"),Ee(e,"slot","sidebar")},m(Ze,bt){be(Ze,e,bt),ie(e,t),ie(t,n),ie(t,l),ie(l,d),ie(t,a),ie(t,x),ie(t,k),ie(e,S),Mt&&Mt.m(e,null),ie(e,C),ie(e,P),ie(P,D),ie(D,O),ie(D,B),ie(P,G),ie(P,U),ie(U,te),ie(P,$),ie(P,J),ie(J,_e),ie(e,re),ie(e,ue),ie(e,He),ie(e,Me),ie(Me,ut),ut.checked=r[11],ie(Me,At),ie(e,Nt),ie(e,Je),ie(Je,Jt),Jt.checked=r[10],ie(Je,Kt),ie(e,Ut),ie(e,Vt),ie(Vt,wt),nt.m(wt,null),ie(Vt,gr),ie(Vt,Pt),nr.m(Pt,null),ie(e,wr),Be&&Be.m(e,null),mr=!0,Rr||(ht=[Et(D,"click",r[21]),Et(U,"click",r[22]),Et(J,"click",r[23]),Et(ue,"click",r[24]),Et(ut,"change",r[25]),Et(Jt,"change",r[26]),Et(Jt,"change",r[13]),Et(wt,"click",r[17]),Et(Pt,"click",r[18])],Rr=!0)},p(Ze,bt){(!mr||bt[0]&64)&&u!==(u=dn(Ze[6]).properties.name+"")&&Lr(d,u),(!mr||bt[0]&2)&&_!==(_=Ze[1].area_km2.toFixed(1)+"")&&Lr(x,_),Ze[8]>0?Mt||(Mt=Wv(),Mt.c(),Mt.m(e,C)):Mt&&(Mt.d(1),Mt=null),(!mr||bt[0]&512&&!En(O.src,z=`/ltn//filters/${Ze[9]}_icon.gif`))&&Ee(O,"src",z),(!mr||bt[0]&1&&N!==(N=Ze[0]=="filter"))&&(D.disabled=N),(!mr||bt[0]&1&&le!==(le=Ze[0]=="freehand-filters"))&&(U.disabled=le),(!mr||bt[0]&1&&ze!==(ze=Ze[0]=="oneway"))&&(J.disabled=ze),bt[0]&2048&&(ut.checked=Ze[11]),bt[0]&1024&&(Jt.checked=Ze[10]),lt===(lt=De(Ze))&&nt?nt.p(Ze,bt):(nt.d(1),nt=lt(Ze),nt&&(nt.c(),nt.m(wt,null))),(!mr||bt[0]&16&&Yt!==(Yt=Ze[4]==0))&&(wt.disabled=Yt),ne===(ne=xt(Ze))&&nr?nr.p(Ze,bt):(nr.d(1),nr=ne(Ze),nr&&(nr.c(),nr.m(Pt,null))),(!mr||bt[0]&32&&rr!==(rr=Ze[5]==0))&&(Pt.disabled=rr),Ze[3]?Be?(Be.p(Ze,bt),bt[0]&8&&oe(Be,1)):(Be=Zv(Ze),Be.c(),oe(Be,1),Be.m(e,null)):Be&&(vr(),pe(Be,1,1,()=>{Be=null}),br())},i(Ze){mr||(oe(Be),mr=!0)},o(Ze){pe(Be),mr=!1},d(Ze){Ze&&ve(e),Mt&&Mt.d(),nt.d(),nr.d(),Be&&Be.d(),Rr=!1,_n(ht)}}}function _6(r){let e;return{c(){e=de("p"),e.textContent="Click to change direction"},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function y6(r){let e,t,n,l;return{c(){e=de("div"),t=de("img"),l=tt(`
              Click to add modal filter`),En(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||Ee(t,"src",n),Ee(t,"width","20"),Ee(t,"alt","Add modal filter")},m(u,d){be(u,e,d),ie(e,t),ie(e,l)},p(u,d){d[0]&512&&!En(t.src,n=`/ltn//filters/${u[9]}_icon.gif`)&&Ee(t,"src",n)},d(u){u&&ve(e)}}}function v6(r){let e,t=r[36].shortcuts+"",n,l,u=(r[36].name??"unnamed road")+"",d,a,_;function x(C,P){return C[0]=="filter"?y6:_6}let k=x(r),S=k(r);return{c(){e=de("p"),n=tt(t),l=tt(" shortcuts through "),d=tt(u),a=Ue(),S.c(),_=$n()},m(C,P){be(C,e,P),ie(e,n),ie(e,l),ie(e,d),be(C,a,P),S.m(C,P),be(C,_,P)},p(C,P){P[1]&32&&t!==(t=C[36].shortcuts+"")&&Lr(n,t),P[1]&32&&u!==(u=(C[36].name??"unnamed road")+"")&&Lr(d,u),k===(k=x(C))&&S?S.p(C,P):(S.d(1),S=k(C),S&&(S.c(),S.m(_.parentNode,_)))},d(C){C&&(ve(e),ve(a),ve(_)),S.d(C)}}}function b6(r){let e,t,n;return t=new Ns({props:{openOn:"hover",$$slots:{default:[v6,({props:l})=>({36:l}),({props:l})=>[0,l?32:0]]},$$scope:{ctx:r}}}),{c(){e=de("div"),Ve(t.$$.fragment),Ee(e,"slot","line-popup")},m(l,u){be(l,e,u),Ne(t,e,null),n=!0},p(l,u){const d={};u[0]&513|u[1]&96&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){pe(t.$$.fragment,l),n=!1},d(l){l&&ve(e),je(t)}}}function Hv(r){let e,t;return e=new n6({props:{paths:r[7]}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l[0]&128&&(u.paths=n[7]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function w6(r){let e;return{c(){e=tt("Click to delete")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function x6(r){let e,t;return e=new Ns({props:{openOn:"hover",$$slots:{default:[w6]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l[1]&64&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function $v(r){let e,t;return e=new CM({props:{map:dn(r[2])}}),e.$on("done",r[19]),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l[0]&4&&(u.map=dn(n[2])),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function S6(r){let e,t,n,l,u,d,a;t=new jd({props:{gjInput:r[1],interactive:r[0]=="filter"||r[0]=="oneway",onClickLine:r[14],$$slots:{"line-popup":[b6]},$$scope:{ctx:r}}});let _=r[11]&&Hv(r);u=new Ud({props:{$$slots:{default:[x6]},$$scope:{ctx:r}}}),u.$on("click",r[15]);let x=r[0]=="freehand-filters"&&$v(r);return{c(){e=de("div"),Ve(t.$$.fragment),n=Ue(),_&&_.c(),l=Ue(),Ve(u.$$.fragment),d=Ue(),x&&x.c(),Ee(e,"slot","map")},m(k,S){be(k,e,S),Ne(t,e,null),ie(e,n),_&&_.m(e,null),ie(e,l),Ne(u,e,null),ie(e,d),x&&x.m(e,null),a=!0},p(k,S){const C={};S[0]&2&&(C.gjInput=k[1]),S[0]&1&&(C.interactive=k[0]=="filter"||k[0]=="oneway"),S[0]&513|S[1]&64&&(C.$$scope={dirty:S,ctx:k}),t.$set(C),k[11]?_?(_.p(k,S),S[0]&2048&&oe(_,1)):(_=Hv(k),_.c(),oe(_,1),_.m(e,l)):_&&(vr(),pe(_,1,1,()=>{_=null}),br());const P={};S[1]&64&&(P.$$scope={dirty:S,ctx:k}),u.$set(P),k[0]=="freehand-filters"?x?(x.p(k,S),S[0]&1&&oe(x,1)):(x=$v(k),x.c(),oe(x,1),x.m(e,null)):x&&(vr(),pe(x,1,1,()=>{x=null}),br())},i(k){a||(oe(t.$$.fragment,k),oe(_),oe(u.$$.fragment,k),oe(x),a=!0)},o(k){pe(t.$$.fragment,k),pe(_),pe(u.$$.fragment,k),pe(x),a=!1},d(k){k&&ve(e),je(t),_&&_.d(),je(u),x&&x.d()}}}function k6(r){let e,t,n,l;return e=new Os({props:{$$slots:{map:[S6],sidebar:[g6],top:[h6]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0,n||(l=Et(window,"keydown",r[16]),n=!0)},p(u,d){const a={};d[0]&8191|d[1]&64&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u),n=!1,l()}}}function T6(r,e,t){let n,l,u,d,a,_,x,k;yt(r,Is,wt=>t(20,l=wt)),yt(r,Nm,wt=>t(9,u=wt)),yt(r,ri,wt=>t(34,d=wt)),yt(r,ph,wt=>t(10,a=wt)),yt(r,ls,wt=>t(2,_=wt)),yt(r,Hy,wt=>t(11,x=wt)),yt(r,dr,wt=>t(12,k=wt));let S="filter",C=!1,P=0,D=0,O,z,B=JSON.parse(d.getAllShortcuts());ti(()=>{_.doubleClickZoom.enable()});function N(wt){t(1,z=JSON.parse(d.renderNeighbourhood())),t(6,O=z.features.find(Yt=>Yt.properties.kind=="boundary")),t(4,P=z.undo_length),t(5,D=z.redo_length),t(7,B=JSON.parse(d.getAllShortcuts())),kc()}function G(){d.setCurrentNeighbourhood(O.properties.name,a),Rt(Is,l++,l)}function U(wt,Yt){S=="filter"?(d.addModalFilter(Yt,u),Rt(Is,l++,l)):S=="oneway"&&(d.toggleDirection(wt.properties.road),Rt(Is,l++,l))}function te(wt){let Yt=wt.detail.features[0];d.deleteModalFilter(Yt.properties.road),Rt(Is,l++,l)}function le(wt){wt.target.tagName!="INPUT"&&(wt.ctrlKey&&wt.key=="z"&&$(),wt.ctrlKey&&wt.key=="y"&&J(),wt.key=="1"&&t(0,S="filter"),wt.key=="2"&&t(0,S="freehand-filters"),wt.key=="3"&&t(0,S="oneway"))}function $(){d.undo(),Rt(Is,l++,l)}function J(){d.redo(),Rt(Is,l++,l)}function _e(wt){let Yt=wt.detail;Yt&&(d.addManyModalFilters(Yt,u),Rt(Is,l++,l)),t(0,S="filter")}const ze=()=>t(0,S="filter"),re=()=>t(0,S="freehand-filters"),ue=()=>t(0,S="oneway"),He=()=>t(3,C=!0);function Me(){x=this.checked,Hy.set(x)}function ut(){a=this.checked,ph.set(a)}const At=()=>t(3,C=!1),Nt=()=>Rt(dr,k={mode:"title"},k),Je=()=>Rt(dr,k={mode:"network"},k),Jt=()=>Rt(dr,k={mode:"view-shortcuts"},k),Kt=()=>Rt(dr,k={mode:"route",prevMode:"neighbourhood"},k),Ut=()=>Rt(dr,k={mode:"set-boundary",name:dn(O).properties.name,existing:O},k),Vt=()=>Rt(dr,k={mode:"debug"},k);return r.$$.update=()=>{r.$$.dirty[0]&5&&(S=="oneway"?_.doubleClickZoom.disable():_.doubleClickZoom.enable()),r.$$.dirty[0]&1048576&&N(),r.$$.dirty[0]&2&&t(8,n=z.features.filter(wt=>wt.properties.kind=="cell"&&wt.properties.cell_color=="disconnected").length)},[S,z,_,C,P,D,O,B,n,u,a,x,k,G,U,te,le,$,J,_e,l,ze,re,ue,He,Me,ut,At,Nt,Je,Jt,Kt,Ut,Vt]}class E6 extends Ht{constructor(e){super(),Zt(this,e,T6,k6,jt,{},null,[-1,-1])}}const Dx="/ltn/assets/delete-ec75e756.svg",Rx="/ltn/assets/edit-f3f51206.svg";function vg(r,e,t){let n=new Set(JSON.parse(r.toSavefile()).features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,t);if(!l)return null;if(n.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function Xv(r,e,t){const n=r.slice();return n[20]=e[t],n}function M6(r){let e;return{c(){e=tt("Choose project")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function C6(r){let e;return{c(){e=de("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function I6(r){let e;return{c(){e=tt("Route")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function A6(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D,O;return u=new Zr({props:{$$slots:{default:[M6]},$$scope:{ctx:r}}}),u.$on("click",r[16]),x=new jg({props:{$$slots:{default:[C6]},$$scope:{ctx:r}}}),D=new Zr({props:{$$slots:{default:[I6]},$$scope:{ctx:r}}}),D.$on("click",r[17]),{c(){e=de("div"),t=de("nav"),n=de("ul"),l=de("li"),Ve(u.$$.fragment),d=Ue(),a=de("li"),_=tt(`Pick neighbourhood
          `),Ve(x.$$.fragment),k=Ue(),S=de("nav"),C=de("ul"),P=de("li"),Ve(D.$$.fragment),Ee(t,"aria-label","breadcrumb"),Ee(e,"slot","top"),fn(e,"display","flex"),fn(e,"justify-content","space-between")},m(z,B){be(z,e,B),ie(e,t),ie(t,n),ie(n,l),Ne(u,l,null),ie(n,d),ie(n,a),ie(a,_),Ne(x,a,null),ie(e,k),ie(e,S),ie(S,C),ie(C,P),Ne(D,P,null),O=!0},p(z,B){const N={};B&8388608&&(N.$$scope={dirty:B,ctx:z}),u.$set(N);const G={};B&8388608&&(G.$$scope={dirty:B,ctx:z}),x.$set(G);const U={};B&8388608&&(U.$$scope={dirty:B,ctx:z}),D.$set(U)},i(z){O||(oe(u.$$.fragment,z),oe(x.$$.fragment,z),oe(D.$$.fragment,z),O=!0)},o(z){pe(u.$$.fragment,z),pe(x.$$.fragment,z),pe(D.$$.fragment,z),O=!1},d(z){z&&ve(e),je(u),je(x),je(D)}}}function L6(r){let e;return{c(){e=tt("Draw a new boundary")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function P6(r){let e;return{c(){e=tt("Use an auto-generated boundary")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function z6(r){let e=r[20]+"",t;return{c(){t=tt(e)},m(n,l){be(n,t,l)},p(n,l){l&2&&e!==(e=n[20]+"")&&Lr(t,e)},d(n){n&&ve(t)}}}function Kv(r){let e,t,n,l,u,d,a,_,x,k,S;function C(){return r[13](r[20])}n=new Zr({props:{$$slots:{default:[z6]},$$scope:{ctx:r}}}),n.$on("click",C);function P(){return r[14](r[20])}function D(){return r[15](r[20])}return{c(){e=de("li"),t=de("span"),Ve(n.$$.fragment),l=Ue(),u=de("button"),u.innerHTML=`<img src="${Rx}" alt="Rename neighbourhood"/>`,d=Ue(),a=de("button"),a.innerHTML=`<img src="${Dx}" alt="Delete neighbourhood"/>`,_=Ue(),Ee(u,"class","secondary"),Ee(a,"class","secondary"),fn(t,"display","flex"),fn(t,"justify-content","space-between")},m(O,z){be(O,e,z),ie(e,t),Ne(n,t,null),ie(t,l),ie(t,u),ie(t,d),ie(t,a),ie(e,_),x=!0,k||(S=[Et(u,"click",P),Et(a,"click",D)],k=!0)},p(O,z){r=O;const B={};z&8388610&&(B.$$scope={dirty:z,ctx:r}),n.$set(B)},i(O){x||(oe(n.$$.fragment,O),x=!0)},o(O){pe(n.$$.fragment,O),x=!1},d(O){O&&ve(e),je(n),k=!1,_n(S)}}}function D6(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D,O,z,B,N,G,U,te;n=new Zr({props:{$$slots:{default:[L6]},$$scope:{ctx:r}}}),n.$on("click",r[7]),d=new Zr({props:{$$slots:{default:[P6]},$$scope:{ctx:r}}}),d.$on("click",r[12]);let le=Jn(r[1]),$=[];for(let _e=0;_e<le.length;_e+=1)$[_e]=Kv(Xv(r,le,_e));const J=_e=>pe($[_e],1,1,()=>{$[_e]=null});return{c(){e=de("div"),t=de("div"),Ve(n.$$.fragment),l=Ue(),u=de("div"),Ve(d.$$.fragment),a=Ue(),_=de("ul");for(let _e=0;_e<$.length;_e+=1)$[_e].c();x=Ue(),k=de("hr"),S=Ue(),C=de("p"),P=tt("Current project: "),D=tt(r[2]),O=Ue(),z=de("button"),z.textContent="Export project to GeoJSON",B=Ue(),N=de("button"),N.textContent="Debug route-snapper",Ee(N,"class","secondary"),Ee(e,"slot","sidebar")},m(_e,ze){be(_e,e,ze),ie(e,t),Ne(n,t,null),ie(e,l),ie(e,u),Ne(d,u,null),ie(e,a),ie(e,_);for(let re=0;re<$.length;re+=1)$[re]&&$[re].m(_,null);ie(e,x),ie(e,k),ie(e,S),ie(e,C),ie(C,P),ie(C,D),ie(e,O),ie(e,z),ie(e,B),ie(e,N),G=!0,U||(te=[Et(z,"click",r[8]),Et(N,"click",r[9])],U=!0)},p(_e,ze){const re={};ze&8388608&&(re.$$scope={dirty:ze,ctx:_e}),n.$set(re);const ue={};if(ze&8388608&&(ue.$$scope={dirty:ze,ctx:_e}),d.$set(ue),ze&114){le=Jn(_e[1]);let He;for(He=0;He<le.length;He+=1){const Me=Xv(_e,le,He);$[He]?($[He].p(Me,ze),oe($[He],1)):($[He]=Kv(Me),$[He].c(),oe($[He],1),$[He].m(_,null))}for(vr(),He=le.length;He<$.length;He+=1)J(He);br()}(!G||ze&4)&&Lr(D,_e[2])},i(_e){if(!G){oe(n.$$.fragment,_e),oe(d.$$.fragment,_e);for(let ze=0;ze<le.length;ze+=1)oe($[ze]);G=!0}},o(_e){pe(n.$$.fragment,_e),pe(d.$$.fragment,_e),$=$.filter(Boolean);for(let ze=0;ze<$.length;ze+=1)pe($[ze]);G=!1},d(_e){_e&&ve(e),je(n),je(d),Ds($,_e),U=!1,_n(te)}}}function R6(r){let e,t=r[19].name+"",n;return{c(){e=de("p"),n=tt(t)},m(l,u){be(l,e,u),ie(e,n)},p(l,u){u&524288&&t!==(t=l[19].name+"")&&Lr(n,t)},d(l){l&&ve(e)}}}function B6(r){let e,t;return e=new Ns({props:{openOn:"hover",$$slots:{default:[R6,({props:n})=>({19:n}),({props:n})=>n?524288:0]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&8912896&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function F6(r){let e,t;const n=[Hn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"red","fill-opacity":rl(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[B6]},$$scope:{ctx:r}};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new ma({props:l}),e.$on("click",r[11]),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};d&8388608&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function O6(r){let e,t,n,l,u;return t=new Pi({props:{data:r[0],generateId:!0,$$slots:{default:[F6]},$$scope:{ctx:r}}}),l=new Ud({}),{c(){e=de("div"),Ve(t.$$.fragment),n=Ue(),Ve(l.$$.fragment),Ee(e,"slot","map")},m(d,a){be(d,e,a),Ne(t,e,null),ie(e,n),Ne(l,e,null),u=!0},p(d,a){const _={};a&1&&(_.data=d[0]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(oe(t.$$.fragment,d),oe(l.$$.fragment,d),u=!0)},o(d){pe(t.$$.fragment,d),pe(l.$$.fragment,d),u=!1},d(d){d&&ve(e),je(t),je(l)}}}function N6(r){let e,t;return e=new Os({props:{$$slots:{map:[O6],sidebar:[D6],top:[A6]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&8388623&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function j6(r,e,t){let n,l,u,d,a,_;yt(r,ri,le=>t(10,u=le)),yt(r,ha,le=>t(2,d=le)),yt(r,dr,le=>t(3,a=le)),yt(r,ph,le=>t(18,_=le));function x(le){u.setCurrentNeighbourhood(le,_),Rt(dr,a={mode:"neighbourhood"},a)}function k(le){window.confirm(`Really delete neighbourhood ${le}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(le),kc(),t(0,n=JSON.parse(u.toSavefile())))}function S(le){let $=vg(u,`Rename neighbourhood ${le} to what?`,le);$&&(u.renameNeighbourhoodBoundary(le,$),kc(),t(0,n=JSON.parse(u.toSavefile())))}function C(){let le=vg(u,"What do you want to name the neighbourhood?","");le&&Rt(dr,a={mode:"set-boundary",name:le,existing:null},a)}function P(){ld(d+".geojson",u.toSavefile())}function D(){ld("debug_route_snapper.geojson",u.toRouteSnapperGj())}const O=le=>x(dn(le.detail.features[0].properties).name),z=()=>Rt(dr,a={mode:"auto-boundaries"},a),B=le=>x(le),N=le=>S(le),G=le=>k(le),U=()=>Rt(dr,a={mode:"title"},a),te=()=>Rt(dr,a={mode:"route",prevMode:"network"},a);return r.$$.update=()=>{r.$$.dirty&1024&&t(0,n=JSON.parse(u.toSavefile())),r.$$.dirty&1&&t(1,l=n.features.filter(le=>le.properties.kind=="boundary").map(le=>le.properties.name))},[n,l,d,a,x,k,S,C,P,D,u,O,z,B,N,G,U,te]}class U6 extends Ht{constructor(e){super(),Zt(this,e,j6,N6,jt,{})}}function V6(r){let e;return{c(){e=tt("Choose project")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function q6(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function Jv(r){let e,t,n;return t=new Zr({props:{$$slots:{default:[G6]},$$scope:{ctx:r}}}),t.$on("click",r[13]),{c(){e=de("li"),Ve(t.$$.fragment)},m(l,u){be(l,e,u),Ne(t,e,null),n=!0},p(l,u){const d={};u&16384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){pe(t.$$.fragment,l),n=!1},d(l){l&&ve(e),je(t)}}}function G6(r){let e;return{c(){e=tt("Editing")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function W6(r){let e,t,n,l,u,d,a,_,x,k,S,C;u=new Zr({props:{$$slots:{default:[V6]},$$scope:{ctx:r}}}),u.$on("click",r[11]),_=new Zr({props:{$$slots:{default:[q6]},$$scope:{ctx:r}}}),_.$on("click",r[12]);let P=r[0]=="neighbourhood"&&Jv(r);return{c(){e=de("div"),t=de("nav"),n=de("ul"),l=de("li"),Ve(u.$$.fragment),d=Ue(),a=de("li"),Ve(_.$$.fragment),x=Ue(),P&&P.c(),k=Ue(),S=de("li"),S.textContent="Routing",Ee(t,"aria-label","breadcrumb"),Ee(e,"slot","top")},m(D,O){be(D,e,O),ie(e,t),ie(t,n),ie(n,l),Ne(u,l,null),ie(n,d),ie(n,a),Ne(_,a,null),ie(n,x),P&&P.m(n,null),ie(n,k),ie(n,S),C=!0},p(D,O){const z={};O&16384&&(z.$$scope={dirty:O,ctx:D}),u.$set(z);const B={};O&16384&&(B.$$scope={dirty:O,ctx:D}),_.$set(B),D[0]=="neighbourhood"?P?(P.p(D,O),O&1&&oe(P,1)):(P=Jv(D),P.c(),oe(P,1),P.m(n,k)):P&&(vr(),pe(P,1,1,()=>{P=null}),br())},i(D){C||(oe(u.$$.fragment,D),oe(_.$$.fragment,D),oe(P),C=!0)},o(D){pe(u.$$.fragment,D),pe(_.$$.fragment,D),pe(P),C=!1},d(D){D&&ve(e),je(u),je(_),P&&P.d()}}}function Z6(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D,O,z,B;return t=new Nd({}),t.$on("click",r[7]),{c(){e=de("div"),Ve(t.$$.fragment),n=Ue(),l=de("p"),l.textContent="Drag markers for a route",u=Ue(),d=de("p"),d.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,a=Ue(),_=de("label"),x=tt("Slow-down factor for main roads: "),k=tt(r[1]),S=Ue(),C=de("input"),P=Ue(),D=de("i"),D.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Ee(C,"type","range"),Ee(C,"min","1.0"),Ee(C,"max","5.0"),Ee(C,"step","0.1"),Ee(e,"slot","sidebar")},m(N,G){be(N,e,G),Ne(t,e,null),ie(e,n),ie(e,l),ie(e,u),ie(e,d),ie(e,a),ie(e,_),ie(_,x),ie(_,k),ie(_,S),ie(_,C),ei(C,r[1]),ie(e,P),ie(e,D),O=!0,z||(B=[Et(C,"change",r[10]),Et(C,"input",r[10])],z=!0)},p(N,G){(!O||G&2)&&Lr(k,N[1]),G&2&&ei(C,N[1])},i(N){O||(oe(t.$$.fragment,N),O=!0)},o(N){pe(t.$$.fragment,N),O=!1},d(N){N&&ve(e),je(t),z=!1,_n(B)}}}function Yv(r){let e,t;return e=new jd({props:{gjInput:JSON.parse(dn(r[4]).renderNeighbourhood()),interactive:!1}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.gjInput=JSON.parse(dn(n[4]).renderNeighbourhood())),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function H6(r){let e,t;const n=[Hn("compare-route"),{paint:{"line-width":10,"line-color":s5(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new cs({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function $6(r){let e;return{c(){e=de("span"),e.textContent="A",Ee(e,"class","dot svelte-1gcxp27")},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function X6(r){let e;return{c(){e=de("span"),e.textContent="B",Ee(e,"class","dot svelte-1gcxp27")},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function K6(r){let e,t,n,l,u,d,a,_,x,k,S,C,P=r[0]=="neighbourhood"&&Yv(r);n=new Ud({}),u=new Pi({props:{data:r[5],$$slots:{default:[H6]},$$scope:{ctx:r}}});function D(N){r[8](N)}let O={draggable:!0,$$slots:{default:[$6]},$$scope:{ctx:r}};r[3]!==void 0&&(O.lngLat=r[3]),a=new dd({props:O}),pn.push(()=>zo(a,"lngLat",D));function z(N){r[9](N)}let B={draggable:!0,$$slots:{default:[X6]},$$scope:{ctx:r}};return r[2]!==void 0&&(B.lngLat=r[2]),k=new dd({props:B}),pn.push(()=>zo(k,"lngLat",z)),{c(){e=de("div"),P&&P.c(),t=Ue(),Ve(n.$$.fragment),l=Ue(),Ve(u.$$.fragment),d=Ue(),Ve(a.$$.fragment),x=Ue(),Ve(k.$$.fragment),Ee(e,"slot","map")},m(N,G){be(N,e,G),P&&P.m(e,null),ie(e,t),Ne(n,e,null),ie(e,l),Ne(u,e,null),ie(e,d),Ne(a,e,null),ie(e,x),Ne(k,e,null),C=!0},p(N,G){N[0]=="neighbourhood"?P?(P.p(N,G),G&1&&oe(P,1)):(P=Yv(N),P.c(),oe(P,1),P.m(e,t)):P&&(vr(),pe(P,1,1,()=>{P=null}),br());const U={};G&32&&(U.data=N[5]),G&16384&&(U.$$scope={dirty:G,ctx:N}),u.$set(U);const te={};G&16384&&(te.$$scope={dirty:G,ctx:N}),!_&&G&8&&(_=!0,te.lngLat=N[3],Po(()=>_=!1)),a.$set(te);const le={};G&16384&&(le.$$scope={dirty:G,ctx:N}),!S&&G&4&&(S=!0,le.lngLat=N[2],Po(()=>S=!1)),k.$set(le)},i(N){C||(oe(P),oe(n.$$.fragment,N),oe(u.$$.fragment,N),oe(a.$$.fragment,N),oe(k.$$.fragment,N),C=!0)},o(N){pe(P),pe(n.$$.fragment,N),pe(u.$$.fragment,N),pe(a.$$.fragment,N),pe(k.$$.fragment,N),C=!1},d(N){N&&ve(e),P&&P.d(),je(n),je(u),je(a),je(k)}}}function J6(r){let e,t;return e=new Os({props:{$$slots:{map:[K6],sidebar:[Z6],top:[W6]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&16511&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function Y6(r,e,t){let n,l,u,d,a,_;yt(r,dr,B=>t(6,l=B)),yt(r,Zy,B=>t(1,u=B)),yt(r,Om,B=>t(2,d=B)),yt(r,Fm,B=>t(3,a=B)),yt(r,ri,B=>t(4,_=B));let{prevMode:x}=e;function k(){Rt(dr,l={mode:x},l)}function S(B){a=B,Fm.set(a)}function C(B){d=B,Om.set(d)}function P(){u=xg(this.value),Zy.set(u)}const D=()=>Rt(dr,l={mode:"title"},l),O=()=>Rt(dr,l={mode:"network"},l),z=()=>Rt(dr,l={mode:"neighbourhood"},l);return r.$$set=B=>{"prevMode"in B&&t(0,x=B.prevMode)},r.$$.update=()=>{r.$$.dirty&30&&t(5,n=JSON.parse(_.compareRoute(a.lng,a.lat,d.lng,d.lat,u)))},[x,u,d,a,_,n,l,k,S,C,P,D,O,z]}class Q6 extends Ht{constructor(e){super(),Zt(this,e,Y6,J6,jt,{prevMode:0})}}const ez="/ltn/assets/settings-342fb430.svg";function Qv(r){let e,t;return e=new zd({props:{$$slots:{default:[tz]},$$scope:{ctx:r}}}),e.$on("close",r[3]),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&17&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function tz(r){let e,t,n,l,u,d,a,_,x;return n=new b5({}),{c(){e=de("h1"),e.textContent="Settings",t=Ue(),Ve(n.$$.fragment),l=Ue(),u=de("center"),d=de("button"),d.textContent="Confirm"},m(k,S){be(k,e,S),be(k,t,S),Ne(n,k,S),be(k,l,S),be(k,u,S),ie(u,d),a=!0,_||(x=Et(d,"click",r[2]),_=!0)},p:It,i(k){a||(oe(n.$$.fragment,k),a=!0)},o(k){pe(n.$$.fragment,k),a=!1},d(k){k&&(ve(e),ve(t),ve(l),ve(u)),je(n,k),_=!1,x()}}}function rz(r){let e,t,n,l,u,d,a=r[0]&&Qv(r);return{c(){e=de("button"),e.innerHTML=`<img src="${ez}" alt="Settings"/>`,t=Ue(),a&&a.c(),n=$n(),Ee(e,"class","outline")},m(_,x){be(_,e,x),be(_,t,x),a&&a.m(_,x),be(_,n,x),l=!0,u||(d=Et(e,"click",r[1]),u=!0)},p(_,[x]){_[0]?a?(a.p(_,x),x&1&&oe(a,1)):(a=Qv(_),a.c(),oe(a,1),a.m(n.parentNode,n)):a&&(vr(),pe(a,1,1,()=>{a=null}),br())},i(_){l||(oe(a),l=!0)},o(_){pe(a),l=!1},d(_){_&&(ve(e),ve(t),ve(n)),a&&a.d(_),u=!1,d()}}}function nz(r,e,t){let n=!1;return[n,()=>t(0,n=!0),()=>t(0,n=!1),()=>t(0,n=!1)]}class iz extends Ht{constructor(e){super(),Zt(this,e,nz,rz,jt,{})}}let Lc=Er(null);const To=Er([]);function Bx(r){if(r.length<3)return JSON.parse(Hi(Lc).inner.calculateRoute(r));let e=JSON.parse(JSON.stringify(r));e.push(e[0]);let t=JSON.parse(Hi(Lc).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:oz}=Ld,sz=r=>({}),eb=r=>({}),az=r=>({}),tb=r=>({});function rb(r,e,t){const n=r.slice();return n[44]=e[t],n[45]=e,n[46]=t,n}function nb(r,e,t){const n=r.slice();return n[47]=e[t],n[48]=e,n[49]=t,n}function lz(r){let e,t;const n=r[24]["extra-top"],l=Vr(n,r,r[38],eb);return{c(){e=de("div"),l&&l.c(),Ee(e,"slot","top")},m(u,d){be(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d[1]&128)&&Gr(l,n,u,u[38],t?qr(n,u[38],d,sz):Wr(u[38]),eb)},i(u){t||(oe(l,u),t=!0)},o(u){pe(l,u),t=!1},d(u){u&&ve(e),l&&l.d(u)}}}function cz(r){let e,t,n,l,u;return{c(){e=de("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=Ue(),n=de("p"),n.textContent="Keyboard shortcuts:",l=Ue(),u=de("ul"),u.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(d,a){be(d,e,a),be(d,t,a),be(d,n,a),be(d,l,a),be(d,u,a)},p:It,d(d){d&&(ve(e),ve(t),ve(n),ve(l),ve(u))}}}function uz(r){let e,t=r[8].length+"",n,l;return{c(){e=tt("Undo ("),n=tt(t),l=tt(")")},m(u,d){be(u,e,d),be(u,n,d),be(u,l,d)},p(u,d){d[0]&256&&t!==(t=u[8].length+"")&&Lr(n,t)},d(u){u&&(ve(e),ve(n),ve(l))}}}function hz(r){let e;return{c(){e=tt("Undo")},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function fz(r){let e;return{c(){e=de("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function dz(r){let e,t,n,l,u,d,a,_,x,k,S,C,P;return S=Cb(r[36][0]),{c(){e=de("fieldset"),t=de("label"),n=de("input"),l=tt(`
          Snap to roads`),u=Ue(),d=de("label"),a=de("input"),_=tt(`
          Draw anywhere`),x=Ue(),k=de("p"),k.textContent="Click to add at least 3 points",Ee(n,"type","radio"),n.__value="snap",ei(n,n.__value),Ee(a,"type","radio"),a.__value="free",ei(a,a.__value),S.p(n,a)},m(D,O){be(D,e,O),ie(e,t),ie(t,n),n.checked=n.__value===r[7],ie(t,l),ie(e,u),ie(e,d),ie(d,a),a.checked=a.__value===r[7],ie(d,_),be(D,x,O),be(D,k,O),C||(P=[Et(n,"change",r[35]),Et(a,"change",r[37])],C=!0)},p(D,O){O[0]&128&&(n.checked=n.__value===D[7]),O[0]&128&&(a.checked=a.__value===D[7])},d(D){D&&(ve(e),ve(x),ve(k)),S.r(),C=!1,_n(P)}}}function pz(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D,O,z,B;const N=r[24]["extra-sidebar"],G=Vr(N,r,r[38],tb);k=new jg({props:{$$slots:{default:[cz]},$$scope:{ctx:r}}});function U(ze,re){return ze[8].length==0?hz:uz}let te=U(r),le=te(r);function $(ze,re){return ze[5].length<3?dz:fz}let J=$(r),_e=J(r);return{c(){e=de("div"),G&&G.c(),t=Ue(),n=de("div"),l=de("button"),u=tt("Finish"),a=Ue(),_=de("button"),_.textContent="Cancel",x=Ue(),Ve(k.$$.fragment),S=Ue(),C=de("button"),le.c(),D=Ue(),_e.c(),l.disabled=d=r[5].length<3,Ee(_,"class","secondary"),fn(n,"display","flex"),Ee(C,"class","secondary"),C.disabled=P=r[8].length==0,Ee(e,"slot","sidebar")},m(ze,re){be(ze,e,re),G&&G.m(e,null),ie(e,t),ie(e,n),ie(n,l),ie(l,u),ie(n,a),ie(n,_),ie(n,x),Ne(k,n,null),ie(e,S),ie(e,C),le.m(C,null),ie(e,D),_e.m(e,null),O=!0,z||(B=[Et(l,"click",function(){xc(r[0])&&r[0].apply(this,arguments)}),Et(_,"click",function(){xc(r[1])&&r[1].apply(this,arguments)}),Et(C,"click",r[11])],z=!0)},p(ze,re){r=ze,G&&G.p&&(!O||re[1]&128)&&Gr(G,N,r,r[38],O?qr(N,r[38],re,az):Wr(r[38]),tb),(!O||re[0]&32&&d!==(d=r[5].length<3))&&(l.disabled=d);const ue={};re[1]&128&&(ue.$$scope={dirty:re,ctx:r}),k.$set(ue),te===(te=U(r))&&le?le.p(r,re):(le.d(1),le=te(r),le&&(le.c(),le.m(C,null))),(!O||re[0]&256&&P!==(P=r[8].length==0))&&(C.disabled=P),J===(J=$(r))&&_e?_e.p(r,re):(_e.d(1),_e=J(r),_e&&(_e.c(),_e.m(e,null)))},i(ze){O||(oe(G,ze),oe(k.$$.fragment,ze),O=!0)},o(ze){pe(G,ze),pe(k.$$.fragment,ze),O=!1},d(ze){ze&&ve(e),G&&G.d(ze),je(k),le.d(),_e.d(),z=!1,_n(B)}}}function mz(r){let e;return{c(){e=de("span"),Ee(e,"class","dot svelte-1cj4rwq"),hi(e,"snapped-node",r[47].snapped),hi(e,"free-node",!r[47].snapped),hi(e,"hide",r[4])},m(t,n){be(t,e,n)},p(t,n){n[0]&512&&hi(e,"snapped-node",t[47].snapped),n[0]&512&&hi(e,"free-node",!t[47].snapped),n[0]&16&&hi(e,"hide",t[4])},d(t){t&&ve(e)}}}function ib(r){let e,t,n;function l(x){r[25](x,r[47])}function u(){return r[26](r[47])}function d(){return r[27](r[47])}function a(){return r[28](r[47])}let _={draggable:!0,zIndex:0,$$slots:{default:[mz]},$$scope:{ctx:r}};return r[47].point!==void 0&&(_.lngLat=r[47].point),e=new dd({props:_}),pn.push(()=>zo(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",d),e.$on("dragend",r[19]),e.$on("click",a),{c(){Ve(e.$$.fragment)},m(x,k){Ne(e,x,k),n=!0},p(x,k){r=x;const S={};k[0]&528|k[1]&128&&(S.$$scope={dirty:k,ctx:r}),!t&&k[0]&512&&(t=!0,S.lngLat=r[47].point,Po(()=>t=!1)),e.$set(S)},i(x){n||(oe(e.$$.fragment,x),n=!0)},o(x){pe(e.$$.fragment,x),n=!1},d(x){je(e,x)}}}function gz(r){let e;return{c(){e=de("span"),e.textContent=`${r[46]+1}`,Ee(e,"class","dot svelte-1cj4rwq"),hi(e,"snapped",r[44].snapped)},m(t,n){be(t,e,n)},p(t,n){n[0]&32&&hi(e,"snapped",t[44].snapped)},d(t){t&&ve(e)}}}function ob(r){let e,t,n;function l(_){r[29](_,r[44])}function u(){return r[30](r[46])}function d(){return r[31](r[46])}let a={draggable:!0,zIndex:1,$$slots:{default:[gz]},$$scope:{ctx:r}};return r[44].point!==void 0&&(a.lngLat=r[44].point),e=new dd({props:a}),pn.push(()=>zo(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",d),e.$on("mouseenter",r[32]),e.$on("mouseleave",r[33]),e.$on("dragstart",r[21]),e.$on("dragend",r[34]),{c(){Ve(e.$$.fragment)},m(_,x){Ne(e,_,x),n=!0},p(_,x){r=_;const k={};x[0]&32|x[1]&128&&(k.$$scope={dirty:x,ctx:r}),!t&&x[0]&32&&(t=!0,k.lngLat=r[44].point,Po(()=>t=!1)),e.$set(k)},i(_){n||(oe(e.$$.fragment,_),n=!0)},o(_){pe(e.$$.fragment,_),n=!1},d(_){je(e,_)}}}function _z(r){let e,t,n,l;const u=[Hn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let d={};for(let x=0;x<u.length;x+=1)d=Rn(d,u[x]);e=new cs({props:d});const a=[Hn("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let _={};for(let x=0;x<a.length;x+=1)_=Rn(_,a[x]);return n=new ma({props:_}),{c(){Ve(e.$$.fragment),t=Ue(),Ve(n.$$.fragment)},m(x,k){Ne(e,x,k),be(x,t,k),Ne(n,x,k),l=!0},p(x,k){const S={};e.$set(S);const C={};n.$set(C)},i(x){l||(oe(e.$$.fragment,x),oe(n.$$.fragment,x),l=!0)},o(x){pe(e.$$.fragment,x),pe(n.$$.fragment,x),l=!1},d(x){x&&ve(t),je(e,x),je(n,x)}}}function yz(r){let e,t;return e=new cs({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function vz(r){let e,t,n,l,u,d,a,_,x;t=new q4({}),t.$on("click",r[12]),t.$on("mousemove",r[13]);let k=Jn(r[9]),S=[];for(let z=0;z<k.length;z+=1)S[z]=ib(nb(r,k,z));const C=z=>pe(S[z],1,1,()=>{S[z]=null});let P=Jn(r[5]),D=[];for(let z=0;z<P.length;z+=1)D[z]=ob(rb(r,P,z));const O=z=>pe(D[z],1,1,()=>{D[z]=null});return d=new Pi({props:{data:r[16](r[6],r[5]),generateId:!0,$$slots:{default:[_z]},$$scope:{ctx:r}}}),_=new Pi({props:{data:r[10],$$slots:{default:[yz]},$$scope:{ctx:r}}}),{c(){e=de("div"),Ve(t.$$.fragment),n=Ue();for(let z=0;z<S.length;z+=1)S[z].c();l=Ue();for(let z=0;z<D.length;z+=1)D[z].c();u=Ue(),Ve(d.$$.fragment),a=Ue(),Ve(_.$$.fragment),Ee(e,"slot","map")},m(z,B){be(z,e,B),Ne(t,e,null),ie(e,n);for(let N=0;N<S.length;N+=1)S[N]&&S[N].m(e,null);ie(e,l);for(let N=0;N<D.length;N+=1)D[N]&&D[N].m(e,null);ie(e,u),Ne(d,e,null),ie(e,a),Ne(_,e,null),x=!0},p(z,B){if(B[0]&918032){k=Jn(z[9]);let U;for(U=0;U<k.length;U+=1){const te=nb(z,k,U);S[U]?(S[U].p(te,B),oe(S[U],1)):(S[U]=ib(te),S[U].c(),oe(S[U],1),S[U].m(e,l))}for(vr(),U=k.length;U<S.length;U+=1)C(U);br()}if(B[0]&2146348){P=Jn(z[5]);let U;for(U=0;U<P.length;U+=1){const te=rb(z,P,U);D[U]?(D[U].p(te,B),oe(D[U],1)):(D[U]=ob(te),D[U].c(),oe(D[U],1),D[U].m(e,u))}for(vr(),U=P.length;U<D.length;U+=1)O(U);br()}const N={};B[0]&96&&(N.data=z[16](z[6],z[5])),B[1]&128&&(N.$$scope={dirty:B,ctx:z}),d.$set(N);const G={};B[0]&1024&&(G.data=z[10]),B[1]&128&&(G.$$scope={dirty:B,ctx:z}),_.$set(G)},i(z){if(!x){oe(t.$$.fragment,z);for(let B=0;B<k.length;B+=1)oe(S[B]);for(let B=0;B<P.length;B+=1)oe(D[B]);oe(d.$$.fragment,z),oe(_.$$.fragment,z),x=!0}},o(z){pe(t.$$.fragment,z),S=S.filter(Boolean);for(let B=0;B<S.length;B+=1)pe(S[B]);D=D.filter(Boolean);for(let B=0;B<D.length;B+=1)pe(D[B]);pe(d.$$.fragment,z),pe(_.$$.fragment,z),x=!1},d(z){z&&ve(e),je(t),Ds(S,z),Ds(D,z),je(d),je(_)}}}function bz(r){let e,t,n,l;return e=new Os({props:{$$slots:{map:[vz],sidebar:[pz],top:[lz]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0,n||(l=Et(oz,"keydown",r[20]),n=!0)},p(u,d){const a={};d[0]&2047|d[1]&128&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u),n=!1,l()}}}function wz(r,e,t){let n,l,u;yt(r,To,ht=>t(5,l=ht)),yt(r,Lc,ht=>t(6,u=ht));let{$$slots:d={},$$scope:a}=e,{map:_}=e,{finish:x}=e,{cancel:k}=e;ti(()=>{Rt(To,l=[],l),u==null||u.stop(),_.getCanvas().style.cursor="inherit"});let S="snap",C=[],P=[],D=null,O=!1,z=!1,B=!1;function N(ht){let Mt=ht.length==0?"crosshair":"inherit";_.getCanvas().style.cursor=Mt}function G(){let ht=C.pop();t(8,C),ht&&Rt(To,l=ht,l)}function U(){C.length==100&&C.shift(),t(8,C=[...C,JSON.parse(JSON.stringify(l))])}function te(){t(7,S=S=="snap"?"free":"snap"),D&&t(23,D.snapped=S=="snap",D)}function le(ht){l.length>=3||(U(),To.update(Mt=>(Mt.push({point:ht.detail.lngLat.toArray(),snapped:S=="snap"}),Mt)))}function $(ht){t(23,D={point:ht.detail.lngLat.toArray(),snapped:S=="snap"})}function J(ht){U(),To.update(Mt=>(Mt[ht].snapped=!Mt[ht].snapped,Mt))}function _e(ht){U(),To.update(Mt=>(Mt.splice(ht,1),Mt)),t(2,O=!1)}function ze(ht,Mt){try{if(ht)return Bx(Mt)}catch{}return Kf()}function re(ht,Mt,De,lt){if(lt||Mt.length>=3)return Kf();try{if(ht&&Mt.length>0&&De)return JSON.parse(ht.inner.calculateRoute([Mt[Mt.length-1],De]))}catch{}return Kf()}function ue(ht,Mt,De){if(De)return;if(!ht||Mt.length<3){t(9,P=[]);return}let lt=[],nt=1,xt=JSON.parse(JSON.stringify(Mt));xt.push(xt[0]);for(let ne=0;ne<xt.length-1;ne++){let nr=JSON.parse(ht.inner.getExtraNodes(xt[ne],xt[ne+1]));for(let[Be,Ze,bt]of nr)lt.push({point:[Be,Ze],snapped:bt,insertIdx:nt});nt++}t(9,P=lt)}function He(ht){U(),To.update(Mt=>(Mt.splice(ht.insertIdx,0,{point:ht.point,snapped:ht.snapped}),Mt)),t(4,B=!0)}function Me(ht){To.update(Mt=>(Mt[ht.insertIdx].point=ht.point,Mt))}function ut(){t(4,B=!1)}function At(ht){let Mt=ht.target.tagName,De=Mt=="INPUT"||Mt=="TEXTAREA";ht.key=="Enter"&&!De||ht.key=="Escape"?(ht.stopPropagation(),l.length>=3?x():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):ht.key=="s"&&!De?te():ht.key=="z"&&ht.ctrlKey&&(ht.stopPropagation(),G())}function Nt(){U(),t(3,z=!0)}const Je=[[]];function Jt(ht,Mt){r.$$.not_equal(Mt.point,ht)&&(Mt.point=ht,t(9,P))}const Kt=ht=>He(ht),Ut=ht=>Me(ht),Vt=ht=>{He(ht),t(4,B=!1)};function wt(ht,Mt){r.$$.not_equal(Mt.point,ht)&&(Mt.point=ht,To.set(l))}const Yt=ht=>J(ht),gr=ht=>_e(ht),Pt=()=>t(2,O=!0),rr=()=>t(2,O=!1),wr=()=>t(3,z=!1);function mr(){S=this.__value,t(7,S)}function Rr(){S=this.__value,t(7,S)}return r.$$set=ht=>{"map"in ht&&t(22,_=ht.map),"finish"in ht&&t(0,x=ht.finish),"cancel"in ht&&t(1,k=ht.cancel),"$$scope"in ht&&t(38,a=ht.$$scope)},r.$$.update=()=>{r.$$.dirty[0]&112&&ue(u,l,B),r.$$.dirty[0]&8388716&&t(10,n=re(u,l,D,O||z)),r.$$.dirty[0]&32&&N(l)},[x,k,O,z,B,l,u,S,C,P,n,G,le,$,J,_e,ze,He,Me,ut,At,Nt,_,D,d,Jt,Kt,Ut,Vt,wt,Yt,gr,Pt,rr,wr,mr,Je,Rr,a]}class xz extends Ht{constructor(e){super(),Zt(this,e,wz,bz,jt,{map:22,finish:0,cancel:1},null,[-1,-1])}}function Sz(r){let e;return{c(){e=tt("Choose project")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function kz(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function Tz(r){let e;return{c(){e=de("li"),e.textContent="Creating new neighbourhood boundary"},m(t,n){be(t,e,n)},p:It,i:It,o:It,d(t){t&&ve(e)}}}function Ez(r){let e,t,n,l,u;return t=new Zr({props:{$$slots:{default:[Mz]},$$scope:{ctx:r}}}),t.$on("click",r[8]),{c(){e=de("li"),Ve(t.$$.fragment),n=Ue(),l=de("li"),l.textContent="Changing neighbourhood boundary"},m(d,a){be(d,e,a),Ne(t,e,null),be(d,n,a),be(d,l,a),u=!0},p(d,a){const _={};a&4096&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(oe(t.$$.fragment,d),u=!0)},o(d){pe(t.$$.fragment,d),u=!1},d(d){d&&(ve(e),ve(n),ve(l)),je(t)}}}function Mz(r){let e;return{c(){e=tt("Editing")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function Cz(r){let e,t,n,l,u,d,a,_,x,k,S,C;u=new Zr({props:{$$slots:{default:[Sz]},$$scope:{ctx:r}}}),u.$on("click",r[6]),_=new Zr({props:{$$slots:{default:[kz]},$$scope:{ctx:r}}}),_.$on("click",r[7]);const P=[Ez,Tz],D=[];function O(z,B){return z[1]?0:1}return k=O(r),S=D[k]=P[k](r),{c(){e=de("div"),t=de("nav"),n=de("ul"),l=de("li"),Ve(u.$$.fragment),d=Ue(),a=de("li"),Ve(_.$$.fragment),x=Ue(),S.c(),Ee(t,"aria-label","breadcrumb"),Ee(e,"slot","extra-top")},m(z,B){be(z,e,B),ie(e,t),ie(t,n),ie(n,l),Ne(u,l,null),ie(n,d),ie(n,a),Ne(_,a,null),ie(n,x),D[k].m(n,null),C=!0},p(z,B){const N={};B&4096&&(N.$$scope={dirty:B,ctx:z}),u.$set(N);const G={};B&4096&&(G.$$scope={dirty:B,ctx:z}),_.$set(G);let U=k;k=O(z),k===U?D[k].p(z,B):(vr(),pe(D[U],1,1,()=>{D[U]=null}),br(),S=D[k],S?S.p(z,B):(S=D[k]=P[k](z),S.c()),oe(S,1),S.m(n,null))},i(z){C||(oe(u.$$.fragment,z),oe(_.$$.fragment,z),oe(S),C=!0)},o(z){pe(u.$$.fragment,z),pe(_.$$.fragment,z),pe(S),C=!1},d(z){z&&ve(e),je(u),je(_),D[k].d()}}}function Iz(r){let e,t,n,l;return{c(){e=de("div"),t=de("h1"),n=tt("Draw your neighbourhood boundary for "),l=tt(r[0]),Ee(e,"slot","extra-sidebar")},m(u,d){be(u,e,d),ie(e,t),ie(t,n),ie(t,l)},p(u,d){d&1&&Lr(l,u[0])},d(u){u&&ve(e)}}}function Az(r){let e,t;return e=new xz({props:{map:dn(r[3]),finish:r[4],cancel:r[5],$$slots:{"extra-sidebar":[Iz],"extra-top":[Cz]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&8&&(u.map=dn(n[3])),l&4103&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function Lz(r,e,t){let n,l,u,d,a;yt(r,dr,O=>t(2,n=O)),yt(r,ph,O=>t(9,l=O)),yt(r,ri,O=>t(10,u=O)),yt(r,To,O=>t(11,d=O)),yt(r,ls,O=>t(3,a=O));let{name:_}=e,{existing:x}=e;x&&(x.properties.waypoints?Rt(To,d=x.properties.waypoints.map(O=>({point:[O.lon,O.lat],snapped:O.snapped})),d):Rt(To,d=x.geometry.coordinates[0].slice(1).map(O=>({point:O,snapped:!1})),d));function k(){if(d.length>=3)try{let O=Bx(d);u.setNeighbourhoodBoundary(_,O),kc(),u.setCurrentNeighbourhood(_,l),Rt(dr,n={mode:"neighbourhood"},n)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),S()}}function S(){x?Rt(dr,n={mode:"neighbourhood"},n):Rt(dr,n={mode:"network"},n)}const C=()=>Rt(dr,n={mode:"title"},n),P=()=>Rt(dr,n={mode:"network"},n),D=()=>Rt(dr,n={mode:"neighbourhood"},n);return r.$$set=O=>{"name"in O&&t(0,_=O.name),"existing"in O&&t(1,x=O.existing)},[_,x,n,a,k,S,C,P,D]}class Pz extends Ht{constructor(e){super(),Zt(this,e,Lz,Az,jt,{name:0,existing:1})}}function zz(r){let e;return{c(){e=tt("Choose project")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function Dz(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function Rz(r){let e,t,n,l,u,d,a,_,x,k,S;return u=new Zr({props:{$$slots:{default:[zz]},$$scope:{ctx:r}}}),u.$on("click",r[10]),_=new Zr({props:{$$slots:{default:[Dz]},$$scope:{ctx:r}}}),_.$on("click",r[11]),{c(){e=de("div"),t=de("nav"),n=de("ul"),l=de("li"),Ve(u.$$.fragment),d=Ue(),a=de("li"),Ve(_.$$.fragment),x=Ue(),k=de("li"),k.textContent="Use an auto-generated boundary",Ee(t,"aria-label","breadcrumb"),Ee(e,"slot","top")},m(C,P){be(C,e,P),ie(e,t),ie(t,n),ie(n,l),Ne(u,l,null),ie(n,d),ie(n,a),Ne(_,a,null),ie(n,x),ie(n,k),S=!0},p(C,P){const D={};P&32768&&(D.$$scope={dirty:P,ctx:C}),u.$set(D);const O={};P&32768&&(O.$$scope={dirty:P,ctx:C}),_.$set(O)},i(C){S||(oe(u.$$.fragment,C),oe(_.$$.fragment,C),S=!0)},o(C){pe(u.$$.fragment,C),pe(_.$$.fragment,C),S=!1},d(C){C&&ve(e),je(u),je(_)}}}function Bz(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D,O,z,B;return t=new Nd({}),t.$on("click",r[7]),{c(){e=de("div"),Ve(t.$$.fragment),n=Ue(),l=de("p"),l.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,u=Ue(),d=de("button"),d.textContent="Export to GeoJSON",a=Ue(),_=de("label"),x=tt(`Minimum area (km)
      `),k=de("input"),S=Ue(),C=de("label"),P=de("input"),D=tt(`
      Remove areas not touching a big road`),Ee(d,"class","secondary"),Ee(k,"type","number"),Ee(k,"min","0"),Ee(k,"max","1"),Ee(k,"step","0.01"),Ee(P,"type","checkbox"),Ee(e,"slot","sidebar")},m(N,G){be(N,e,G),Ne(t,e,null),ie(e,n),ie(e,l),ie(e,u),ie(e,d),ie(e,a),ie(e,_),ie(_,x),ie(_,k),ei(k,r[0]),ie(e,S),ie(e,C),ie(C,P),P.checked=r[1],ie(C,D),O=!0,z||(B=[Et(d,"click",r[5]),Et(k,"input",r[8]),Et(P,"change",r[9])],z=!0)},p(N,G){G&1&&xg(k.value)!==N[0]&&ei(k,N[0]),G&2&&(P.checked=N[1])},i(N){O||(oe(t.$$.fragment,N),O=!0)},o(N){pe(t.$$.fragment,N),O=!1},d(N){N&&ve(e),je(t),z=!1,_n(B)}}}function Fz(r){let e,t,n=r[14].area_km2.toFixed(1)+"",l,u,d,a,_,x=r[14].touches_big_road+"",k,S,C=r[14].touches_railway+"",P,D,O=r[14].touches_waterway+"",z;return{c(){e=de("p"),t=tt("Area: "),l=tt(n),u=tt(" km"),d=Ue(),a=de("p"),_=tt("Borders roads = "),k=tt(x),S=tt(", railway = "),P=tt(C),D=tt(`,
            water = `),z=tt(O)},m(B,N){be(B,e,N),ie(e,t),ie(e,l),ie(e,u),be(B,d,N),be(B,a,N),ie(a,_),ie(a,k),ie(a,S),ie(a,P),ie(a,D),ie(a,z)},p(B,N){N&16384&&n!==(n=B[14].area_km2.toFixed(1)+"")&&Lr(l,n),N&16384&&x!==(x=B[14].touches_big_road+"")&&Lr(k,x),N&16384&&C!==(C=B[14].touches_railway+"")&&Lr(P,C),N&16384&&O!==(O=B[14].touches_waterway+"")&&Lr(z,O)},d(B){B&&(ve(e),ve(d),ve(a))}}}function Oz(r){let e,t;return e=new Ns({props:{openOn:"hover",$$slots:{default:[Fz,({props:n})=>({14:n}),({props:n})=>n?16384:0]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&49152&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function Nz(r){let e,t,n,l;const u=[Hn("auto-boundaries-areas"),{filter:r[6](r[0],r[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":rl(.3,.7)}},{hoverCursor:"pointer"}];let d={$$slots:{default:[Oz]},$$scope:{ctx:r}};for(let x=0;x<u.length;x+=1)d=Rn(d,u[x]);e=new ma({props:d}),e.$on("click",r[4]);const a=[Hn("auto-boundaries-severances"),{filter:o5},{manageHoverState:!0},{paint:{"line-color":rl("black","red"),"line-width":3}}];let _={};for(let x=0;x<a.length;x+=1)_=Rn(_,a[x]);return n=new cs({props:_}),{c(){Ve(e.$$.fragment),t=Ue(),Ve(n.$$.fragment)},m(x,k){Ne(e,x,k),be(x,t,k),Ne(n,x,k),l=!0},p(x,k){const S=k&67?Lm(u,[u[0],{filter:x[6](x[0],x[1])},u[2],u[3],u[4]]):{};k&32768&&(S.$$scope={dirty:k,ctx:x}),e.$set(S);const C={};n.$set(C)},i(x){l||(oe(e.$$.fragment,x),oe(n.$$.fragment,x),l=!0)},o(x){pe(e.$$.fragment,x),pe(n.$$.fragment,x),l=!1},d(x){x&&ve(t),je(e,x),je(n,x)}}}function jz(r){let e,t,n;return t=new Pi({props:{data:r[3],generateId:!0,$$slots:{default:[Nz]},$$scope:{ctx:r}}}),{c(){e=de("div"),Ve(t.$$.fragment),Ee(e,"slot","map")},m(l,u){be(l,e,u),Ne(t,e,null),n=!0},p(l,u){const d={};u&32771&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){pe(t.$$.fragment,l),n=!1},d(l){l&&ve(e),je(t)}}}function Uz(r){let e,t;return e=new Os({props:{$$slots:{map:[jz],sidebar:[Bz],top:[Rz]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&32775&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function Vz(r,e,t){let n,l,u;yt(r,dr,B=>t(2,n=B)),yt(r,ph,B=>t(12,l=B)),yt(r,ri,B=>t(13,u=B));let d=JSON.parse(u.renderAutoBoundaries()),a=0,_=!0;function x(B){let N=vg(u,"What do you want to name the neighbourhood?","");if(N)try{let G={type:"Feature",properties:{},geometry:d.features[B.detail.features[0].id].geometry};u.setNeighbourhoodBoundary(N,G),kc(),u.setCurrentNeighbourhood(N,l),Rt(dr,n={mode:"neighbourhood"},n)}catch(G){console.log(G),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function k(){ld("auto_boundaries.geojson",JSON.stringify(d,null,"  "))}function S(B,N){let G=["all",i5,[">=",["get","area_km2"],B]];return N&&G.push(["get","touches_big_road"]),G}const C=()=>Rt(dr,n={mode:"network"},n);function P(){a=xg(this.value),t(0,a)}function D(){_=this.checked,t(1,_)}return[a,_,n,d,x,k,S,C,P,D,()=>Rt(dr,n={mode:"title"},n),()=>Rt(dr,n={mode:"network"},n)]}class qz extends Ht{constructor(e){super(),Zt(this,e,Vz,Uz,jt,{})}}const Gz=["==",["geometry-type"],"Polygon"],Wz=["==",["geometry-type"],"LineString"],Zz=["==",["geometry-type"],"Point"];function Fx(){return{type:"FeatureCollection",features:[]}}function Mm(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Ox(r)}}}function Ox(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Nx=Er(Fx()),jx=Er(0),Hz=100;class $z{constructor(e){Wn(this,"map");Wn(this,"active");Wn(this,"eventListenersSuccess");Wn(this,"eventListenersUpdated");Wn(this,"eventListenersFailure");Wn(this,"points");Wn(this,"cursor");Wn(this,"hover");Wn(this,"dragFrom");Wn(this,"previousStates");Wn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=t,l[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Wn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(sb(this.points).forEach((n,l)=>{t.push([l+1,n4(n,this.cursor).properties.dist])}),t.sort((n,l)=>n[1]-l[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Wn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Mm(e.lngLat.toArray()),this.onClick(e),this.finish())});Wn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Wn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Wn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Wn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Fx();this.points.forEach((l,u)=>{let d=Mm(l);d.properties.hover=this.hover==u,d.properties.idx=u,e.features.push(d)}),e.features=e.features.concat(sb(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Nx.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,jx.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Mm(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(Ox),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>Hz&&this.previousStates.shift()}}function sb(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function Xz(r){let e,t,n;return{c(){e=tt("Undo ("),t=tt(r[1]),n=tt(")")},m(l,u){be(l,e,u),be(l,t,u),be(l,n,u)},p(l,u){u&2&&Lr(t,l[1])},d(l){l&&(ve(e),ve(t),ve(n))}}}function Kz(r){let e;return{c(){e=tt("Undo")},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function Jz(r){let e,t,n,l,u,d,a,_,x,k,S;function C(O,z){return O[1]==0?Kz:Xz}let P=C(r),D=P(r);return{c(){e=de("div"),t=de("button"),t.textContent="Finish",n=Ue(),l=de("button"),l.textContent="Cancel",u=Ue(),d=de("button"),D.c(),_=Ue(),x=de("ul"),x.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,d.disabled=a=r[1]==0,fn(e,"display","flex"),fn(e,"justify-content","space-between")},m(O,z){be(O,e,z),ie(e,t),ie(e,n),ie(e,l),ie(e,u),ie(e,d),D.m(d,null),be(O,_,z),be(O,x,z),k||(S=[Et(t,"click",r[2]),Et(l,"click",r[3]),Et(d,"click",r[4])],k=!0)},p(O,[z]){P===(P=C(O))&&D?D.p(O,z):(D.d(1),D=P(O),D&&(D.c(),D.m(d,null))),z&2&&a!==(a=O[1]==0)&&(d.disabled=a)},i:It,o:It,d(O){O&&(ve(e),ve(_),ve(x)),D.d(),k=!1,_n(S)}}}function Yz(r,e,t){let n;yt(r,jx,_=>t(1,n=_));let{polygonTool:l}=e;const u=()=>l.finish(),d=()=>l.cancel(),a=()=>l.undo();return r.$$set=_=>{"polygonTool"in _&&t(0,l=_.polygonTool)},[l,n,u,d,a]}class Qz extends Ht{constructor(e){super(),Zt(this,e,Yz,Jz,jt,{polygonTool:0})}}let e8=Date.now();function Ch(r){return`${r}-${e8++}`}const Ux=Symbol.for("svelte-maplibre");function t8(){return Ab(Ux)}function ab(r){return{subscribe:r.subscribe}}function Vx({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let l=t8(),u=Er(null),d=ab(u),a={...l,[r]:ab(u)};if(e&&(a.popupTarget=d),n){let _=Er(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=Er()),Sg(Ux,a),{...l,self:u}}function r8(){return Vx({key:"source",setCluster:!0})}function n8(r=!0){return Vx({key:"layer",setPopupTarget:r,setMouseEvent:r})}function lb(r){let e;return t=>{if(t)for(let n in t){let l=e==null?void 0:e[n],u=t[n];l!==u&&r(n,u,l)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function i8(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function o8(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function cb(r){let e=r[0],t,n,l=ub(r);return{c(){l.c(),t=$n()},m(u,d){l.m(u,d),be(u,t,d),n=!0},p(u,d){d[0]&1&&jt(e,e=u[0])?(vr(),pe(l,1,1,It),br(),l=ub(u),l.c(),oe(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(oe(l),n=!0)},o(u){pe(l),n=!1},d(u){u&&ve(t),l.d(u)}}}function ub(r){let e;const t=r[36].default,n=Vr(t,r,r[35],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u[1]&16)&&Gr(n,t,l,l[35],e?qr(t,l[35],u,null):Wr(l[35]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function s8(r){let e,t,n=r[0]&&cb(r);return{c(){n&&n.c(),e=$n()},m(l,u){n&&n.m(l,u),be(l,e,u),t=!0},p(l,u){l[0]?n?(n.p(l,u),u[0]&1&&oe(n,1)):(n=cb(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){pe(n),t=!1},d(l){l&&ve(e),n&&n.d(l)}}}function a8(r,e,t){let n,l,u,d,a,_,x,k,S,C,P,D,{$$slots:O={},$$scope:z}=e,{id:B=Ch("layer")}=e,{source:N=void 0}=e,{sourceLayer:G=void 0}=e,{beforeId:U=void 0}=e,{beforeLayerType:te=void 0}=e,{type:le}=e,{paint:$=void 0}=e,{layout:J=void 0}=e,{filter:_e=void 0}=e,{applyToClusters:ze=void 0}=e,{minzoom:re=void 0}=e,{maxzoom:ue=void 0}=e,{manageHoverState:He=!1}=e,{hovered:Me=null}=e,{interactive:ut=!0}=e,{hoverCursor:At=void 0}=e,{eventsIfTopMost:Nt=!1}=e;const Je=us(),{map:Jt,source:Kt,self:Ut,minzoom:Vt,maxzoom:wt,eventTopMost:Yt,layerInfo:gr}=n8();yt(r,Jt,De=>t(31,S=De)),yt(r,Kt,De=>t(32,C=De)),yt(r,Ut,De=>t(0,k=De)),yt(r,Vt,De=>t(34,D=De)),yt(r,wt,De=>t(33,P=De)),ti(()=>{k&&S&&(gr.delete(k),S==null||S.removeLayer(k))});let Pt;function rr(De){var ne,nr;if(!ut||!k||!S||Nt&&Yt(De)!==k)return;let lt=De.features??[],nt=(nr=(ne=lt[0])==null?void 0:ne.properties)==null?void 0:nr.cluster_id,xt={event:De,map:S,clusterId:nt,layer:k,source:a,features:lt};Je(De.type,xt)}function wr(De){var ne,nr;if(!ut||!k||!S||Nt&&Yt(De)!==k)return;At&&(S.getCanvas().style.cursor=At);let lt=De.features??[];t(6,Me=lt[0]??null);let nt=(nr=(ne=lt[0])==null?void 0:ne.properties)==null?void 0:nr.cluster_id;Je("mouseenter",{event:De,map:S,clusterId:nt,layer:k,source:a,features:lt})}function mr(De){var ne,nr,Be;if(!ut||!S)return;if(Nt&&Yt(De)!==k){t(6,Me=null),He&&Pt!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:G,id:Pt},{hover:!1}),Pt=void 0);return}S.getCanvas().style.cursor=At;let lt=De.features??[],nt=(nr=(ne=lt[0])==null?void 0:ne.properties)==null?void 0:nr.cluster_id,xt=(Be=lt[0])==null?void 0:Be.id;xt!==Pt&&(He&&(Pt!==void 0&&(S==null||S.setFeatureState({source:a,id:Pt,sourceLayer:G},{hover:!1})),S==null||S.setFeatureState({source:a,id:xt,sourceLayer:G},{hover:!0})),Pt=xt,t(6,Me=lt[0]??null)),Je("mousemove",{event:De,map:S,clusterId:nt,layer:k,source:a,features:lt})}function Rr(De){if(!(!ut||!k||!S)){if(At&&(S.getCanvas().style.cursor=""),t(6,Me=null),He&&Pt!==void 0){const lt={source:a,id:Pt,sourceLayer:G};S==null||S.setFeatureState(lt,{hover:!1}),Pt=void 0}Je("mouseleave",{map:S,layer:k,source:a})}}let ht=!0;function Mt(De){S&&(S.off("click",De,rr),S.off("dblclick",De,rr),S.off("contextmenu",De,rr),S.off("mouseenter",De,wr),S.off("mousemove",De,mr),S.off("mouseleave",De,Rr))}return ti(()=>{S&&k&&Mt(k)}),r.$$set=De=>{"id"in De&&t(7,B=De.id),"source"in De&&t(8,N=De.source),"sourceLayer"in De&&t(9,G=De.sourceLayer),"beforeId"in De&&t(10,U=De.beforeId),"beforeLayerType"in De&&t(11,te=De.beforeLayerType),"type"in De&&t(12,le=De.type),"paint"in De&&t(13,$=De.paint),"layout"in De&&t(14,J=De.layout),"filter"in De&&t(15,_e=De.filter),"applyToClusters"in De&&t(16,ze=De.applyToClusters),"minzoom"in De&&t(17,re=De.minzoom),"maxzoom"in De&&t(18,ue=De.maxzoom),"manageHoverState"in De&&t(19,He=De.manageHoverState),"hovered"in De&&t(6,Me=De.hovered),"interactive"in De&&t(20,ut=De.interactive),"hoverCursor"in De&&t(21,At=De.hoverCursor),"eventsIfTopMost"in De&&t(22,Nt=De.eventsIfTopMost),"$$scope"in De&&t(35,z=De.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=o8(ze)),r.$$.dirty[0]&1073774592&&t(24,l=i8("all",n,_e)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,u=re??D),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,d=ue??P),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=N||C),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&S&&k!==B&&a){k&&(Mt(k),gr.delete(k));let De=U;if(!U&&te){let lt=S.getStyle().layers,nt=typeof te=="function"?te:ne=>ne.type===te,xt=lt==null?void 0:lt.find(nt);xt&&(De=xt.id)}Rt(Ut,k=B,k),S.addLayer(nl({id:k,type:le,source:a,"source-layer":G,filter:l,paint:$,layout:J,minzoom:u,maxzoom:d}),De),t(23,ht=!0),S.on("click",k,rr),S.on("dblclick",k,rr),S.on("contextmenu",k,rr),S.on("mouseenter",k,wr),S.on("mousemove",k,mr),S.on("mouseleave",k,Rr)}r.$$.dirty[0]&1048577&&k&&gr.set(k,{interactive:ut}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,_=k?lb((De,lt)=>S==null?void 0:S.setPaintProperty(k,De,lt)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,x=k?lb((De,lt)=>S==null?void 0:S.setLayoutProperty(k,De,lt)):void 0),r.$$.dirty[0]&268443648&&(_==null||_($)),r.$$.dirty[0]&134234112&&(x==null||x(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,d)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&k&&(ht?t(23,ht=!1):S==null||S.setFilter(k,l))},[k,Jt,Kt,Ut,Vt,wt,Me,B,N,G,U,te,le,$,J,_e,ze,re,ue,He,ut,At,Nt,ht,l,d,u,x,_,a,n,S,C,P,D,z,O]}class a_ extends Ht{constructor(e){super(),Zt(this,e,a8,s8,jt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function l8(r){let e;const t=r[16].default,n=Vr(t,r,r[24],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16777216)&&Gr(n,t,l,l[24],e?qr(t,l[24],u,null):Wr(l[24]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function c8(r){let e,t,n;function l(d){r[17](d)}let u={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[l8]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new a_({props:u}),pn.push(()=>zo(e,"hovered",l)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){Ve(e.$$.fragment)},m(d,a){Ne(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Po(()=>t=!1)),e.$set(_)},i(d){n||(oe(e.$$.fragment,d),n=!0)},o(d){pe(e.$$.fragment,d),n=!1},d(d){je(e,d)}}}function u8(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Ch("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{applyToClusters:P=void 0}=e,{minzoom:D=void 0}=e,{maxzoom:O=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:B=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:G=!1}=e,{interactive:U=!0}=e;function te(ue){N=ue,t(0,N)}function le(ue){ur.call(this,r,ue)}function $(ue){ur.call(this,r,ue)}function J(ue){ur.call(this,r,ue)}function _e(ue){ur.call(this,r,ue)}function ze(ue){ur.call(this,r,ue)}function re(ue){ur.call(this,r,ue)}return r.$$set=ue=>{"id"in ue&&t(1,u=ue.id),"source"in ue&&t(2,d=ue.source),"sourceLayer"in ue&&t(3,a=ue.sourceLayer),"beforeId"in ue&&t(4,_=ue.beforeId),"beforeLayerType"in ue&&t(5,x=ue.beforeLayerType),"paint"in ue&&t(6,k=ue.paint),"layout"in ue&&t(7,S=ue.layout),"filter"in ue&&t(8,C=ue.filter),"applyToClusters"in ue&&t(9,P=ue.applyToClusters),"minzoom"in ue&&t(10,D=ue.minzoom),"maxzoom"in ue&&t(11,O=ue.maxzoom),"hoverCursor"in ue&&t(12,z=ue.hoverCursor),"manageHoverState"in ue&&t(13,B=ue.manageHoverState),"hovered"in ue&&t(0,N=ue.hovered),"eventsIfTopMost"in ue&&t(14,G=ue.eventsIfTopMost),"interactive"in ue&&t(15,U=ue.interactive),"$$scope"in ue&&t(24,l=ue.$$scope)},[N,u,d,a,_,x,k,S,C,P,D,O,z,B,G,U,n,te,le,$,J,_e,ze,re,l]}class h8 extends Ht{constructor(e){super(),Zt(this,e,u8,c8,jt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function f8(r){let e;const t=r[15].default,n=Vr(t,r,r[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Gr(n,t,l,l[23],e?qr(t,l[23],u,null):Wr(l[23]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function d8(r){let e,t,n;function l(d){r[16](d)}let u={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[f8]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new a_({props:u}),pn.push(()=>zo(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ve(e.$$.fragment)},m(d,a){Ne(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Po(()=>t=!1)),e.$set(_)},i(d){n||(oe(e.$$.fragment,d),n=!0)},o(d){pe(e.$$.fragment,d),n=!1},d(d){je(e,d)}}}function p8(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Ch("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:O=void 0}=e,{manageHoverState:z=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:G=!0}=e;function U(re){B=re,t(0,B)}function te(re){ur.call(this,r,re)}function le(re){ur.call(this,r,re)}function $(re){ur.call(this,r,re)}function J(re){ur.call(this,r,re)}function _e(re){ur.call(this,r,re)}function ze(re){ur.call(this,r,re)}return r.$$set=re=>{"id"in re&&t(1,u=re.id),"source"in re&&t(2,d=re.source),"sourceLayer"in re&&t(3,a=re.sourceLayer),"beforeId"in re&&t(4,_=re.beforeId),"beforeLayerType"in re&&t(5,x=re.beforeLayerType),"paint"in re&&t(6,k=re.paint),"layout"in re&&t(7,S=re.layout),"filter"in re&&t(8,C=re.filter),"minzoom"in re&&t(9,P=re.minzoom),"maxzoom"in re&&t(10,D=re.maxzoom),"hoverCursor"in re&&t(11,O=re.hoverCursor),"manageHoverState"in re&&t(12,z=re.manageHoverState),"hovered"in re&&t(0,B=re.hovered),"eventsIfTopMost"in re&&t(13,N=re.eventsIfTopMost),"interactive"in re&&t(14,G=re.interactive),"$$scope"in re&&t(23,l=re.$$scope)},[B,u,d,a,_,x,k,S,C,P,D,O,z,N,G,n,U,te,le,$,J,_e,ze,l]}class m8 extends Ht{constructor(e){super(),Zt(this,e,p8,d8,jt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function g8(r,e,t,n,l){let u=!1;r.getSource(e)&&(u=!0,r.removeSource(e));const d=()=>{n(e)&&(r.addSource(e,t),l())};if(u){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):d())};a()}else d()}function _8(r,e,t){zb().then(()=>{let n=Hi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function hb(r){let e=r[0],t,n,l=fb(r);return{c(){l.c(),t=$n()},m(u,d){l.m(u,d),be(u,t,d),n=!0},p(u,d){d&1&&jt(e,e=u[0])?(vr(),pe(l,1,1,It),br(),l=fb(u),l.c(),oe(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){n||(oe(l),n=!0)},o(u){pe(l),n=!1},d(u){u&&ve(t),l.d(u)}}}function fb(r){let e;const t=r[15].default,n=Vr(t,r,r[14],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&16384)&&Gr(n,t,l,l[14],e?qr(t,l[14],u,null):Wr(l[14]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function y8(r){let e,t,n=r[0]&&hb(r);return{c(){n&&n.c(),e=$n()},m(l,u){n&&n.m(l,u),be(l,e,u),t=!0},p(l,[u]){l[0]?n?(n.p(l,u),u&1&&oe(n,1)):(n=hb(l),n.c(),oe(n,1),n.m(e.parentNode,e)):n&&(vr(),pe(n,1,1,()=>{n=null}),br())},i(l){t||(oe(n),t=!0)},o(l){pe(n),t=!1},d(l){l&&ve(e),n&&n.d(l)}}}function v8(r,e,t){let n,l,u,{$$slots:d={},$$scope:a}=e,{id:_=Ch("geojson")}=e,{data:x}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:C=void 0}=e,{lineMetrics:P=void 0}=e,{cluster:D=void 0}=e;const{map:O,cluster:z,self:B}=r8();yt(r,O,U=>t(13,l=U)),yt(r,z,U=>t(16,u=U)),yt(r,B,U=>t(0,n=U));let N,G=!0;return ti(()=>{n&&N&&l&&(_8(O,n,N),Rt(B,n=null,n),t(11,N=void 0))}),r.$$set=U=>{"id"in U&&t(4,_=U.id),"data"in U&&t(5,x=U.data),"generateId"in U&&t(6,k=U.generateId),"promoteId"in U&&t(7,S=U.promoteId),"filter"in U&&t(8,C=U.filter),"lineMetrics"in U&&t(9,P=U.lineMetrics),"cluster"in U&&t(10,D=U.cluster),"$$scope"in U&&t(14,a=U.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Rt(z,u=D,u),r.$$.dirty&12273&&l&&n!==_&&(Rt(B,n=_,n),g8(l,n,nl({type:"geojson",data:x,filter:C,lineMetrics:P,generateId:k,promoteId:S,cluster:!!D,clusterMinPoints:D==null?void 0:D.minPoints,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius,clusterProperties:D==null?void 0:D.properties}),U=>l&&U===n,()=>{n&&(t(11,N=l==null?void 0:l.getSource(n)),t(12,G=!0))})),r.$$.dirty&8208&&(l==null||l.on("style.load",()=>{t(11,N=l==null?void 0:l.getSource(_))})),r.$$.dirty&6176&&N&&(G?t(12,G=!1):N.setData(x)),r.$$.dirty&3072&&(N==null||N.setClusterOptions(nl({cluster:!!D,clusterMaxZoom:D==null?void 0:D.maxZoom,clusterRadius:D==null?void 0:D.radius})))},[n,O,z,B,_,x,k,S,C,P,D,N,G,l,a,d]}class b8 extends Ht{constructor(e){super(),Zt(this,e,v8,y8,jt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function w8(r){let e;const t=r[15].default,n=Vr(t,r,r[23],null);return{c(){n&&n.c()},m(l,u){n&&n.m(l,u),e=!0},p(l,u){n&&n.p&&(!e||u&8388608)&&Gr(n,t,l,l[23],e?qr(t,l[23],u,null):Wr(l[23]),null)},i(l){e||(oe(n,l),e=!0)},o(l){pe(n,l),e=!1},d(l){n&&n.d(l)}}}function x8(r){let e,t,n;function l(d){r[16](d)}let u={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[w8]},$$scope:{ctx:r}};return r[0]!==void 0&&(u.hovered=r[0]),e=new a_({props:u}),pn.push(()=>zo(e,"hovered",l)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){Ve(e.$$.fragment)},m(d,a){Ne(e,d,a),n=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Po(()=>t=!1)),e.$set(_)},i(d){n||(oe(e.$$.fragment,d),n=!0)},o(d){pe(e.$$.fragment,d),n=!1},d(d){je(e,d)}}}function S8(r,e,t){let{$$slots:n={},$$scope:l}=e,{id:u=Ch("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:x=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:C=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:O=void 0}=e,{manageHoverState:z=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:G=!0}=e;function U(re){B=re,t(0,B)}function te(re){ur.call(this,r,re)}function le(re){ur.call(this,r,re)}function $(re){ur.call(this,r,re)}function J(re){ur.call(this,r,re)}function _e(re){ur.call(this,r,re)}function ze(re){ur.call(this,r,re)}return r.$$set=re=>{"id"in re&&t(1,u=re.id),"source"in re&&t(2,d=re.source),"sourceLayer"in re&&t(3,a=re.sourceLayer),"beforeId"in re&&t(4,_=re.beforeId),"beforeLayerType"in re&&t(5,x=re.beforeLayerType),"paint"in re&&t(6,k=re.paint),"layout"in re&&t(7,S=re.layout),"filter"in re&&t(8,C=re.filter),"minzoom"in re&&t(9,P=re.minzoom),"maxzoom"in re&&t(10,D=re.maxzoom),"hoverCursor"in re&&t(11,O=re.hoverCursor),"manageHoverState"in re&&t(12,z=re.manageHoverState),"hovered"in re&&t(0,B=re.hovered),"eventsIfTopMost"in re&&t(13,N=re.eventsIfTopMost),"interactive"in re&&t(14,G=re.interactive),"$$scope"in re&&t(23,l=re.$$scope)},[B,u,d,a,_,x,k,S,C,P,D,O,z,N,G,n,U,te,le,$,J,_e,ze,l]}class k8 extends Ht{constructor(e){super(),Zt(this,e,S8,x8,jt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function T8(r){let e,t,n,l,u,d;return e=new m8({props:{id:"edit-polygon-fill",filter:Gz,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new k8({props:{id:"edit-polygon-lines",filter:Wz,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),u=new h8({props:{id:"edit-polygon-vertices",filter:Zz,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){Ve(e.$$.fragment),t=Ue(),Ve(n.$$.fragment),l=Ue(),Ve(u.$$.fragment)},m(a,_){Ne(e,a,_),be(a,t,_),Ne(n,a,_),be(a,l,_),Ne(u,a,_),d=!0},p:It,i(a){d||(oe(e.$$.fragment,a),oe(n.$$.fragment,a),oe(u.$$.fragment,a),d=!0)},o(a){pe(e.$$.fragment,a),pe(n.$$.fragment,a),pe(u.$$.fragment,a),d=!1},d(a){a&&(ve(t),ve(l)),je(e,a),je(n,a),je(u,a)}}}function E8(r){let e,t;return e=new b8({props:{data:r[0],$$slots:{default:[T8]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&1&&(u.data=n[0]),l&2&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function M8(r,e,t){let n;return yt(r,Nx,l=>t(0,n=l)),[n]}class C8 extends Ht{constructor(e){super(),Zt(this,e,M8,E8,jt,{})}}function I8(r){let e,t,n,l,u,d,a;return{c(){e=de("button"),e.textContent="Import current view",t=Ue(),n=de("i"),n.textContent="or...",l=Ue(),u=de("button"),u.textContent="Draw an area to import on the map",Ee(e,"type","button"),Ee(u,"type","button")},m(_,x){be(_,e,x),be(_,t,x),be(_,n,x),be(_,l,x),be(_,u,x),d||(a=[Et(e,"click",r[2]),Et(u,"click",r[3])],d=!0)},p:It,i:It,o:It,d(_){_&&(ve(e),ve(t),ve(n),ve(l),ve(u)),d=!1,_n(a)}}}function A8(r){let e,t;return e=new Qz({props:{polygonTool:r[0]}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&1&&(u.polygonTool=n[0]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function L8(r){let e,t,n,l,u,d,a,_,x;const k=[A8,I8],S=[];function C(P,D){return P[0]?0:1}return e=C(r),t=S[e]=k[e](r),{c(){t.c(),n=Ue(),l=de("label"),u=de("input"),d=tt(`Save a copy of the osm.xml
  after importing`),Ee(u,"type","checkbox")},m(P,D){S[e].m(P,D),be(P,n,D),be(P,l,D),ie(l,u),u.checked=r[1],ie(l,d),a=!0,_||(x=Et(u,"change",r[5]),_=!0)},p(P,[D]){let O=e;e=C(P),e===O?S[e].p(P,D):(vr(),pe(S[O],1,1,()=>{S[O]=null}),br(),t=S[e],t?t.p(P,D):(t=S[e]=k[e](P),t.c()),oe(t,1),t.m(n.parentNode,n)),D&2&&(u.checked=P[1])},i(P){a||(oe(t),a=!0)},o(P){pe(t),a=!1},d(P){P&&(ve(n),ve(l)),S[e].d(P),_=!1,x()}}}function Zu(r){return[r.lng,r.lat]}function P8(r,e,t){let{map:n}=e;const l=us();let u=null,d=!1;async function a(C){try{l("loading","Loading from Overpass");let D=await(await fetch(qx(C))).text();d&&ld("osm.xml",D),l("gotXml",{xml:D,boundary:C})}catch(P){l("error",P.toString())}}function _(){let C=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Zu(C.getSouthWest()),Zu(C.getNorthWest()),Zu(C.getNorthEast()),Zu(C.getSouthEast()),Zu(C.getSouthWest())]],type:"Polygon"}}}async function x(){if(n){if(n.getZoom()<13){l("error","Zoom in more to import");return}await a(_())}}function k(){n&&(t(0,u=new $z(n)),u.startNew(),u.addEventListenerSuccess(async C=>{t(0,u=null),await a(C)}),u.addEventListenerFailure(()=>{t(0,u=null)}))}function S(){d=this.checked,t(1,d)}return r.$$set=C=>{"map"in C&&t(4,n=C.map)},[u,d,x,k,n,S]}class z8 extends Ht{constructor(e){super(),Zt(this,e,P8,L8,jt,{map:4})}}function qx(r){let e='poly:"';for(let[n,l]of r.geometry.coordinates[0])e+=`${l} ${n} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}async function bg(r){ha.set(r);try{let e=JSON.parse(window.localStorage.getItem(r));console.time("get OSM input");let[t,n]=await D8(e);console.timeEnd("get OSM input"),console.time("load"),ri.set(new Ob(new Uint8Array(t),n,e.study_area_name||void 0)),Hi(ri).loadSavefile(e),console.timeEnd("load"),Gx()}catch(e){window.alert(`Couldn't open project: ${e}`),ha.set("")}}async function D8(r){if(r.study_area_name){let e=Hi(dh)?`/osm/${r.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${r.study_area_name}.pbf`;console.log(`Grabbing ${e}`);let n=await(await fetch(e)).arrayBuffer(),l=Hi(dh)?`/boundaries/${r.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${r.study_area_name}.geojson`,d=await(await fetch(l)).json();return[n,d]}else{console.log("Grabbing from Overpass");let e=r.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await fetch(qx(e))).arrayBuffer(),e]}}function Gx(){dr.set({mode:"network"}),Lc.set(new o4(Hi(ls),Hi(ri).toRouteSnapper(),Er(Kf()),Er(!0),Er(0))),Hi(ls).fitBounds(Array.from(Hi(ri).getBounds()),{animate:!1}),Fm.set(db()),Om.set(db())}function db(){let r=Hi(ri).getBounds(),e=r[0]+Math.random()*(r[2]-r[0]),t=r[1]+Math.random()*(r[3]-r[1]);return new Pc.LngLat(e,t)}function pb(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function mb(r,e,t){const n=r.slice();return n[22]=e[t],n}function R8(r){let e;return{c(){e=de("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',Ee(e,"slot","top")},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function B8(r){let e;return{c(){e=de("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){be(t,e,n)},p:It,i:It,o:It,d(t){t&&ve(e)}}}function F8(r){let e,t,n,l,u,d,a,_,x,k,S,C,P;t=new Zr({props:{$$slots:{default:[O8]},$$scope:{ctx:r}}}),t.$on("click",r[10]);let D=Jn(r[2].entries()),O=[];for(let B=0;B<D.length;B+=1)O[B]=_b(pb(r,D,B));const z=B=>pe(O[B],1,1,()=>{O[B]=null});return{c(){e=de("div"),Ve(t.$$.fragment),n=Ue(),l=de("p"),l.textContent="Load a saved project:",u=Ue(),d=de("ul");for(let B=0;B<O.length;B+=1)O[B].c();a=Ue(),_=de("label"),x=tt(`Load a project from a file
        `),k=de("input"),Ee(k,"type","file")},m(B,N){be(B,e,N),Ne(t,e,null),be(B,n,N),be(B,l,N),be(B,u,N),be(B,d,N);for(let G=0;G<O.length;G+=1)O[G]&&O[G].m(d,null);be(B,a,N),be(B,_,N),ie(_,x),ie(_,k),r[14](k),S=!0,C||(P=Et(k,"change",r[6]),C=!0)},p(B,N){const G={};if(N&33554432&&(G.$$scope={dirty:N,ctx:B}),t.$set(G),N&900){D=Jn(B[2].entries());let U;for(U=0;U<D.length;U+=1){const te=pb(B,D,U);O[U]?(O[U].p(te,N),oe(O[U],1)):(O[U]=_b(te),O[U].c(),oe(O[U],1),O[U].m(d,null))}for(vr(),U=D.length;U<O.length;U+=1)z(U);br()}},i(B){if(!S){oe(t.$$.fragment,B);for(let N=0;N<D.length;N+=1)oe(O[N]);S=!0}},o(B){pe(t.$$.fragment,B),O=O.filter(Boolean);for(let N=0;N<O.length;N+=1)pe(O[N]);S=!1},d(B){B&&(ve(e),ve(n),ve(l),ve(u),ve(d),ve(a),ve(_)),je(t),Ds(O,B),r[14](null),C=!1,P()}}}function O8(r){let e;return{c(){e=tt("New project")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function N8(r){let e=r[22].slice(4)+"",t;return{c(){t=tt(e)},m(n,l){be(n,t,l)},p(n,l){l&4&&e!==(e=n[22].slice(4)+"")&&Lr(t,e)},d(n){n&&ve(t)}}}function gb(r){let e,t,n,l,u,d,a,_,x,k,S;function C(){return r[11](r[22])}n=new Zr({props:{$$slots:{default:[N8]},$$scope:{ctx:r}}}),n.$on("click",C);function P(){return r[12](r[22])}function D(){return r[13](r[22])}return{c(){e=de("li"),t=de("span"),Ve(n.$$.fragment),l=Ue(),u=de("button"),u.innerHTML=`<img src="${Rx}" alt="Rename project"/>`,d=Ue(),a=de("button"),a.innerHTML=`<img src="${Dx}" alt="Delete project"/>`,_=Ue(),Ee(u,"class","secondary"),Ee(a,"class","secondary"),fn(t,"display","flex"),fn(t,"justify-content","space-between")},m(O,z){be(O,e,z),ie(e,t),Ne(n,t,null),ie(t,l),ie(t,u),ie(t,d),ie(t,a),ie(e,_),x=!0,k||(S=[Et(u,"click",P),Et(a,"click",D)],k=!0)},p(O,z){r=O;const B={};z&33554436&&(B.$$scope={dirty:z,ctx:r}),n.$set(B)},i(O){x||(oe(n.$$.fragment,O),x=!0)},o(O){pe(n.$$.fragment,O),x=!1},d(O){O&&ve(e),je(n),k=!1,_n(S)}}}function _b(r){let e,t=(r[18]??"custom area")+"",n,l,u,d,a=Jn(r[19]),_=[];for(let k=0;k<a.length;k+=1)_[k]=gb(mb(r,a,k));const x=k=>pe(_[k],1,1,()=>{_[k]=null});return{c(){e=de("u"),n=tt(t),l=Ue();for(let k=0;k<_.length;k+=1)_[k].c();u=$n()},m(k,S){be(k,e,S),ie(e,n),be(k,l,S);for(let C=0;C<_.length;C+=1)_[C]&&_[C].m(k,S);be(k,u,S),d=!0},p(k,S){if((!d||S&4)&&t!==(t=(k[18]??"custom area")+"")&&Lr(n,t),S&900){a=Jn(k[19]);let C;for(C=0;C<a.length;C+=1){const P=mb(k,a,C);_[C]?(_[C].p(P,S),oe(_[C],1)):(_[C]=gb(P),_[C].c(),oe(_[C],1),_[C].m(u.parentNode,u))}for(vr(),C=a.length;C<_.length;C+=1)x(C);br()}},i(k){if(!d){for(let S=0;S<a.length;S+=1)oe(_[S]);d=!0}},o(k){_=_.filter(Boolean);for(let S=0;S<_.length;S+=1)pe(_[S]);d=!1},d(k){k&&(ve(e),ve(l),ve(u)),Ds(_,k)}}}function j8(r){let e,t,n,l;const u=[F8,B8],d=[];function a(_,x){return _[4]&&_[0]?0:1}return t=a(r),n=d[t]=u[t](r),{c(){e=de("div"),n.c(),Ee(e,"slot","sidebar")},m(_,x){be(_,e,x),d[t].m(e,null),l=!0},p(_,x){let k=t;t=a(_),t===k?d[t].p(_,x):(vr(),pe(d[k],1,1,()=>{d[k]=null}),br(),n=d[t],n?n.p(_,x):(n=d[t]=u[t](_),n.c()),oe(n,1),n.m(e,null))},i(_){l||(oe(n),l=!0)},o(_){pe(n),l=!1},d(_){_&&ve(e),d[t].d()}}}function U8(r){let e,t,n,l;return e=new Rb({props:{loading:r[1]}}),n=new Os({props:{$$slots:{sidebar:[j8],top:[R8]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment),t=Ue(),Ve(n.$$.fragment)},m(u,d){Ne(e,u,d),be(u,t,d),Ne(n,u,d),l=!0},p(u,[d]){const a={};d&2&&(a.loading=u[1]),e.$set(a);const _={};d&33554493&&(_.$$scope={dirty:d,ctx:u}),n.$set(_)},i(u){l||(oe(e.$$.fragment,u),oe(n.$$.fragment,u),l=!0)},o(u){pe(e.$$.fragment,u),pe(n.$$.fragment,u),l=!1},d(u){u&&ve(t),je(e,u),je(n,u)}}}function Vf(){let r=new Map;for(let e=0;e<window.localStorage.length;e++){let t=window.localStorage.key(e);if(t.startsWith("ltn_")){let n="";try{n=JSON.parse(window.localStorage.getItem(t)).study_area_name}catch{}r.has(n)||r.set(n,[]),r.get(n).push(t)}}return r}function V8(r,e,t){let n,l,u,d,a;yt(r,ha,te=>t(15,n=te)),yt(r,Lc,te=>t(16,l=te)),yt(r,ri,te=>t(17,u=te)),yt(r,ls,te=>t(4,d=te)),yt(r,dr,te=>t(5,a=te));let{wasmReady:_}=e,x="";Rt(ri,u=null,u),Rt(Lc,l=null,l),Rt(ha,n="",n);let k=Vf(),S;async function C(te){let le="ltn_"+S.files[0].name;t(1,x=`Loading from file ${le}`),window.localStorage.setItem(le,await S.files[0].text()),t(2,k=Vf()),await bg(le),t(1,x="")}function P(te){window.confirm(`Really delete project ${te}? You can't undo this.`)&&(window.localStorage.removeItem(te),t(2,k=Vf()))}function D(te){let le=window.prompt(`Rename project ${te} to what?`,te);if(le){le.startsWith("ltn_")||(le=`ltn_${le}`);let $=window.localStorage.getItem(te);window.localStorage.setItem(le,$),window.localStorage.removeItem(te),t(2,k=Vf())}}async function O(te){t(1,x=`Loading project ${te}`),await bg(te),t(1,x="")}const z=()=>Rt(dr,a={mode:"new-project"},a),B=te=>O(te),N=te=>D(te),G=te=>P(te);function U(te){pn[te?"unshift":"push"](()=>{S=te,t(3,S)})}return r.$$set=te=>{"wasmReady"in te&&t(0,_=te.wasmReady)},[_,x,k,S,d,a,C,P,D,O,z,B,N,G,U]}class q8 extends Ht{constructor(e){super(),Zt(this,e,V8,U8,jt,{wasmReady:0})}}function yb(r,e,t){const n=r.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function vb(r,e,t){const n=r.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function G8(r){let e;return{c(){e=tt("Choose project")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function W8(r){let e,t,n,l,u,d,a,_;return u=new Zr({props:{$$slots:{default:[G8]},$$scope:{ctx:r}}}),u.$on("click",r[13]),{c(){e=de("div"),t=de("nav"),n=de("ul"),l=de("li"),Ve(u.$$.fragment),d=Ue(),a=de("li"),a.textContent="New project",Ee(t,"aria-label","breadcrumb"),Ee(e,"slot","top")},m(x,k){be(x,e,k),ie(e,t),ie(t,n),ie(n,l),Ne(u,l,null),ie(n,d),ie(n,a),_=!0},p(x,k){const S={};k&33554432&&(S.$$scope={dirty:k,ctx:x}),u.$set(S)},i(x){_||(oe(u.$$.fragment,x),_=!0)},o(x){pe(u.$$.fragment,x),_=!1},d(x){x&&ve(e),je(u)}}}function bb(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D;e=new Rb({props:{loading:r[4]}});let O=Jn(r[3]),z=[];for(let B=0;B<O.length;B+=1)z[B]=xb(yb(r,O,B));return S=new z8({props:{map:r[5]}}),S.$on("gotXml",r[7]),S.$on("loading",r[11]),S.$on("error",r[12]),{c(){Ve(e.$$.fragment),t=Ue(),n=de("label"),l=tt(`Load a built-in area:
        `),u=de("select"),d=de("option");for(let B=0;B<z.length;B+=1)z[B].c();a=Ue(),_=de("i"),_.textContent="or...",x=Ue(),k=de("div"),Ve(S.$$.fragment),d.__value="",ei(d,d.__value),r[2]===void 0&&uh(()=>r[9].call(u))},m(B,N){Ne(e,B,N),be(B,t,N),be(B,n,N),ie(n,l),ie(n,u),ie(u,d);for(let G=0;G<z.length;G+=1)z[G]&&z[G].m(u,null);ad(u,r[2],!0),be(B,a,N),be(B,_,N),be(B,x,N),be(B,k,N),Ne(S,k,null),C=!0,P||(D=[Et(u,"change",r[9]),Et(u,"change",r[10])],P=!0)},p(B,N){const G={};if(N&16&&(G.loading=B[4]),e.$set(G),N&8){O=Jn(B[3]);let te;for(te=0;te<O.length;te+=1){const le=yb(B,O,te);z[te]?z[te].p(le,N):(z[te]=xb(le),z[te].c(),z[te].m(u,null))}for(;te<z.length;te+=1)z[te].d(1);z.length=O.length}N&12&&ad(u,B[2]);const U={};N&32&&(U.map=B[5]),S.$set(U)},i(B){C||(oe(e.$$.fragment,B),oe(S.$$.fragment,B),C=!0)},o(B){pe(e.$$.fragment,B),pe(S.$$.fragment,B),C=!1},d(B){B&&(ve(t),ve(n),ve(a),ve(_),ve(x),ve(k)),je(e,B),Ds(z,B),je(S),P=!1,_n(D)}}}function wb(r){let e,t=r[22]+"",n,l;return{c(){e=de("option"),n=tt(t),e.__value=l=r[21],ei(e,e.__value)},m(u,d){be(u,e,d),ie(e,n)},p(u,d){d&8&&t!==(t=u[22]+"")&&Lr(n,t),d&8&&l!==(l=u[21])&&(e.__value=l,ei(e,e.__value))},d(u){u&&ve(e)}}}function xb(r){let e,t,n=Jn(r[18]),l=[];for(let u=0;u<n.length;u+=1)l[u]=wb(vb(r,n,u));return{c(){e=de("optgroup");for(let u=0;u<l.length;u+=1)l[u].c();Ee(e,"label",t=r[17])},m(u,d){be(u,e,d);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(u,d){if(d&8){n=Jn(u[18]);let a;for(a=0;a<n.length;a+=1){const _=vb(u,n,a);l[a]?l[a].p(_,d):(l[a]=wb(_),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}d&8&&t!==(t=u[17])&&Ee(e,"label",t)},d(u){u&&ve(e),Ds(l,u)}}}function Z8(r){let e,t,n,l,u,d,a,_,x,k=r[1]&&bb(r);return{c(){e=de("div"),t=de("div"),n=de("label"),l=tt(`Project name:
        `),u=de("input"),d=Ue(),k&&k.c(),Ee(u,"type","text"),Ee(e,"slot","sidebar")},m(S,C){be(S,e,C),ie(e,t),ie(t,n),ie(n,l),ie(n,u),ei(u,r[1]),ie(e,d),k&&k.m(e,null),a=!0,_||(x=Et(u,"input",r[8]),_=!0)},p(S,C){C&2&&u.value!==S[1]&&ei(u,S[1]),S[1]?k?(k.p(S,C),C&2&&oe(k,1)):(k=bb(S),k.c(),oe(k,1),k.m(e,null)):k&&(vr(),pe(k,1,1,()=>{k=null}),br())},i(S){a||(oe(k),a=!0)},o(S){pe(k),a=!1},d(S){S&&ve(e),k&&k.d(),_=!1,x()}}}function H8(r){let e,t,n;return t=new C8({}),{c(){e=de("div"),Ve(t.$$.fragment),Ee(e,"slot","map")},m(l,u){be(l,e,u),Ne(t,e,null),n=!0},p:It,i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){pe(t.$$.fragment,l),n=!1},d(l){l&&ve(e),je(t)}}}function $8(r){let e,t;return e=new Os({props:{$$slots:{map:[H8],sidebar:[Z8],top:[W8]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,[l]){const u={};l&33554558&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function X8(r,e,t){let n,l,u,d,a;yt(r,ha,U=>t(14,n=U)),yt(r,ri,U=>t(15,l=U)),yt(r,dh,U=>t(16,u=U)),yt(r,ls,U=>t(5,d=U)),yt(r,dr,U=>t(6,a=U));let _="",x="",k=[],S="";Pd(async()=>{let U=await fetch(u?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");t(3,k=await U.json())});function C(U){t(4,S="Loading OSM");try{Rt(ri,l=new Ob(new TextEncoder().encode(U.detail.xml),U.detail.boundary,void 0),l),Rt(ha,n=`ltn_${_}`,n),Gx(),kc()}catch(te){window.alert(`Couldn't import from Overpass: ${te}`)}t(4,S="")}async function P(){if(x=="")return;let U=`ltn_${_}`;window.localStorage.setItem(U,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:x})),t(4,S=`Loading pre-clipped OSM area ${x}`),await bg(U),t(4,S="")}function D(){_=this.value,t(1,_)}function O(){x=Ib(this),t(2,x),t(3,k)}return[P,_,x,k,S,d,a,C,D,O,()=>P(),U=>t(4,S=U.detail),U=>window.alert(U.detail),()=>Rt(dr,a={mode:"title"},a)]}class K8 extends Ht{constructor(e){super(),Zt(this,e,X8,$8,jt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const{window:J8}=Ld;function Y8(r){let e;return{c(){e=tt("Choose project")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function Q8(r){let e;return{c(){e=tt("Pick neighbourhood")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function eD(r){let e;return{c(){e=tt("Editing")},m(t,n){be(t,e,n)},d(t){t&&ve(e)}}}function tD(r){let e,t,n,l,u,d,a,_,x,k,S,C,P,D;return u=new Zr({props:{$$slots:{default:[Y8]},$$scope:{ctx:r}}}),u.$on("click",r[9]),_=new Zr({props:{$$slots:{default:[Q8]},$$scope:{ctx:r}}}),_.$on("click",r[10]),S=new Zr({props:{$$slots:{default:[eD]},$$scope:{ctx:r}}}),S.$on("click",r[5]),{c(){e=de("div"),t=de("nav"),n=de("ul"),l=de("li"),Ve(u.$$.fragment),d=Ue(),a=de("li"),Ve(_.$$.fragment),x=Ue(),k=de("li"),Ve(S.$$.fragment),C=Ue(),P=de("li"),P.textContent="Viewing shortcuts",Ee(t,"aria-label","breadcrumb"),Ee(e,"slot","top")},m(O,z){be(O,e,z),ie(e,t),ie(t,n),ie(n,l),Ne(u,l,null),ie(n,d),ie(n,a),Ne(_,a,null),ie(n,x),ie(n,k),Ne(S,k,null),ie(n,C),ie(n,P),D=!0},p(O,z){const B={};z&8192&&(B.$$scope={dirty:z,ctx:O}),u.$set(B);const N={};z&8192&&(N.$$scope={dirty:z,ctx:O}),_.$set(N);const G={};z&8192&&(G.$$scope={dirty:z,ctx:O}),S.$set(G)},i(O){D||(oe(u.$$.fragment,O),oe(_.$$.fragment,O),oe(S.$$.fragment,O),D=!0)},o(O){pe(u.$$.fragment,O),pe(_.$$.fragment,O),pe(S.$$.fragment,O),D=!1},d(O){O&&ve(e),je(u),je(_),je(S)}}}function rD(r){let e,t,n,l,u,d,a,_,x,k=r[0].shortcutIndex+1+"",S,C,P=r[0].gj.features.length+"",D,O,z,B,N,G,U,te,le,$=dn(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",J,_e,ze,re,ue;return{c(){e=de("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=Ue(),n=de("button"),n.textContent="Pick a different road",l=Ue(),u=de("div"),d=de("button"),a=tt("Previous"),x=Ue(),S=tt(k),C=tt(" / "),D=tt(P),O=Ue(),z=de("button"),B=tt("Next"),G=Ue(),U=de("p"),te=tt("This shortcut is "),le=de("b"),J=tt($),_e=tt("x"),ze=tt(`
        the length of the shortest route using all roads, not just this neighbourhood`),d.disabled=_=r[0].shortcutIndex==0,Ee(d,"data-tooltip","Left"),z.disabled=N=r[0].shortcutIndex==r[0].gj.features.length-1,Ee(z,"data-tooltip","Right"),fn(u,"display","flex"),fn(u,"justify-content","space-between")},m(He,Me){be(He,e,Me),be(He,t,Me),be(He,n,Me),be(He,l,Me),be(He,u,Me),ie(u,d),ie(d,a),ie(u,x),ie(u,S),ie(u,C),ie(u,D),ie(u,O),ie(u,z),ie(z,B),be(He,G,Me),be(He,U,Me),ie(U,te),ie(U,le),ie(le,J),ie(le,_e),ie(U,ze),re||(ue=[Et(n,"click",r[8]),Et(d,"click",r[6]),Et(z,"click",r[7])],re=!0)},p(He,Me){Me&1&&_!==(_=He[0].shortcutIndex==0)&&(d.disabled=_),Me&1&&k!==(k=He[0].shortcutIndex+1+"")&&Lr(S,k),Me&1&&P!==(P=He[0].gj.features.length+"")&&Lr(D,P),Me&1&&N!==(N=He[0].shortcutIndex==He[0].gj.features.length-1)&&(z.disabled=N),Me&1&&$!==($=dn(He[0].gj.features[He[0].shortcutIndex].properties).directness.toFixed(1)+"")&&Lr(J,$)},d(He){He&&(ve(e),ve(t),ve(n),ve(l),ve(u),ve(G),ve(U)),re=!1,_n(ue)}}}function nD(r){let e;return{c(){e=de("p"),e.textContent="Click a road to see shortcuts"},m(t,n){be(t,e,n)},p:It,d(t){t&&ve(e)}}}function iD(r){let e,t,n,l;t=new Nd({}),t.$on("click",r[5]);function u(_,x){if(_[0].state=="neutral")return nD;if(_[0].state=="chose-road")return rD}let d=u(r),a=d&&d(r);return{c(){e=de("div"),Ve(t.$$.fragment),n=Ue(),a&&a.c(),Ee(e,"slot","sidebar")},m(_,x){be(_,e,x),Ne(t,e,null),ie(e,n),a&&a.m(e,null),l=!0},p(_,x){d===(d=u(_))&&a?a.p(_,x):(a&&a.d(1),a=d&&d(_),a&&(a.c(),a.m(e,null)))},i(_){l||(oe(t.$$.fragment,_),l=!0)},o(_){pe(t.$$.fragment,_),l=!1},d(_){_&&ve(e),je(t),a&&a.d()}}}function oD(r){let e,t,n,l,u,d;return e=new Pi({props:{data:Jm(JSON.parse(dn(r[2]).renderNeighbourhood())),$$slots:{default:[aD]},$$scope:{ctx:r}}}),n=new Pi({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[lD]},$$scope:{ctx:r}}}),u=new Pi({props:{data:r[0].roadGj,$$slots:{default:[cD]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment),t=Ue(),Ve(n.$$.fragment),l=Ue(),Ve(u.$$.fragment)},m(a,_){Ne(e,a,_),be(a,t,_),Ne(n,a,_),be(a,l,_),Ne(u,a,_),d=!0},p(a,_){const x={};_&4&&(x.data=Jm(JSON.parse(dn(a[2]).renderNeighbourhood()))),_&8192&&(x.$$scope={dirty:_,ctx:a}),e.$set(x);const k={};_&1&&(k.data=a[0].gj.features[a[0].shortcutIndex]),_&8192&&(k.$$scope={dirty:_,ctx:a}),n.$set(k);const S={};_&1&&(S.data=a[0].roadGj),_&8192&&(S.$$scope={dirty:_,ctx:a}),u.$set(S)},i(a){d||(oe(e.$$.fragment,a),oe(n.$$.fragment,a),oe(u.$$.fragment,a),d=!0)},o(a){pe(e.$$.fragment,a),pe(n.$$.fragment,a),pe(u.$$.fragment,a),d=!1},d(a){a&&(ve(t),ve(l)),je(e,a),je(n,a),je(u,a)}}}function sD(r){let e,t;return e=new jd({props:{gjInput:JSON.parse(dn(r[2]).renderNeighbourhood()),onClickLine:r[3],$$slots:{"line-popup":[hD]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&4&&(u.gjInput=JSON.parse(dn(n[2]).renderNeighbourhood())),l&8192&&(u.$$scope={dirty:l,ctx:n}),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function aD(r){let e,t;const n=[Hn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new ma({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function lD(r){let e,t;const n=[Hn("shortcuts"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new cs({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function cD(r){let e,t;const n=[Hn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new cs({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function uD(r){let e,t=r[12].shortcuts+"",n,l,u=(r[12].name??"unnamed road")+"",d;return{c(){e=de("p"),n=tt(t),l=tt(" shortcuts through "),d=tt(u)},m(a,_){be(a,e,_),ie(e,n),ie(e,l),ie(e,d)},p(a,_){_&4096&&t!==(t=a[12].shortcuts+"")&&Lr(n,t),_&4096&&u!==(u=(a[12].name??"unnamed road")+"")&&Lr(d,u)},d(a){a&&ve(e)}}}function hD(r){let e,t,n;return t=new Ns({props:{openOn:"hover",$$slots:{default:[uD,({props:l})=>({12:l}),({props:l})=>l?4096:0]},$$scope:{ctx:r}}}),{c(){e=de("div"),Ve(t.$$.fragment),Ee(e,"slot","line-popup")},m(l,u){be(l,e,u),Ne(t,e,null),n=!0},p(l,u){const d={};u&12288&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){n||(oe(t.$$.fragment,l),n=!0)},o(l){pe(t.$$.fragment,l),n=!1},d(l){l&&ve(e),je(t)}}}function fD(r){let e,t,n,l,u,d;const a=[sD,oD],_=[];function x(k,S){return k[0].state=="neutral"?0:k[0].state=="chose-road"?1:-1}return~(t=x(r))&&(n=_[t]=a[t](r)),u=new Ud({}),{c(){e=de("div"),n&&n.c(),l=Ue(),Ve(u.$$.fragment),Ee(e,"slot","map")},m(k,S){be(k,e,S),~t&&_[t].m(e,null),ie(e,l),Ne(u,e,null),d=!0},p(k,S){let C=t;t=x(k),t===C?~t&&_[t].p(k,S):(n&&(vr(),pe(_[C],1,1,()=>{_[C]=null}),br()),~t?(n=_[t],n?n.p(k,S):(n=_[t]=a[t](k),n.c()),oe(n,1),n.m(e,l)):n=null)},i(k){d||(oe(n),oe(u.$$.fragment,k),d=!0)},o(k){pe(n),pe(u.$$.fragment,k),d=!1},d(k){k&&ve(e),~t&&_[t].d(),je(u)}}}function dD(r){let e,t,n,l;return e=new Os({props:{$$slots:{map:[fD],sidebar:[iD],top:[tD]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0,n||(l=Et(J8,"keydown",r[4]),n=!0)},p(u,[d]){const a={};d&8199&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u),n=!1,l()}}}function pD(r,e,t){let n,l,u;yt(r,dr,O=>t(1,n=O)),yt(r,ls,O=>t(11,l=O)),yt(r,ri,O=>t(2,u=O));let d={state:"neutral"};function a(O,z){let B=JSON.parse(u.getShortcutsCrossingRoad(O.properties.id));if(B.features.length==0){window.alert("No shortcuts here");return}t(0,d={state:"chose-road",roadGj:O,gj:B,shortcutIndex:0})}Pd(()=>{l==null||l.keyboard.disable()}),ti(()=>{l==null||l.keyboard.enable()});function _(O){d.state=="chose-road"&&(O.key=="ArrowLeft"&&d.shortcutIndex>0&&(O.stopPropagation(),t(0,d.shortcutIndex--,d)),O.key=="ArrowRight"&&(O.stopPropagation(),d.shortcutIndex!=d.gj.features.length-1&&t(0,d.shortcutIndex++,d)))}function x(){Rt(dr,n={mode:"neighbourhood"},n)}function k(){d.state=="chose-road"&&t(0,d.shortcutIndex--,d)}function S(){d.state=="chose-road"&&t(0,d.shortcutIndex++,d)}return[d,n,u,a,_,x,k,S,()=>t(0,d={state:"neutral"}),()=>Rt(dr,n={mode:"title"},n),()=>Rt(dr,n={mode:"network"},n)]}class mD extends Ht{constructor(e){super(),Zt(this,e,pD,dD,jt,{})}}function gD(r){let e,t,n,l,u,d,a,_,x;return l=new iz({}),{c(){e=de("div"),t=de("button"),t.innerHTML=`<img src="${h4}" style="height: 6vh;" alt="A/B Street logo"/>`,n=Ue(),Ve(l.$$.fragment),u=Ue(),d=de("span"),Ee(t,"class","outline"),fn(d,"width","100%"),Ee(e,"slot","top"),fn(e,"display","flex")},m(k,S){be(k,e,S),ie(e,t),ie(e,n),Ne(l,e,null),ie(e,u),ie(e,d),r[19](d),a=!0,_||(x=Et(t,"click",r[18]),_=!0)},p:It,i(k){a||(oe(l.$$.fragment,k),a=!0)},o(k){pe(l.$$.fragment,k),a=!1},d(k){k&&ve(e),je(l),r[19](null),_=!1,x()}}}function Sb(r){let e,t,n,l,u,d;return n=new V5({props:{map:dn(r[6]),maptilerBasemap:r[7]}}),{c(){e=de("button"),e.textContent="Zoom to fit study area",t=Ue(),Ve(n.$$.fragment),Ee(e,"class","secondary")},m(a,_){be(a,e,_),be(a,t,_),Ne(n,a,_),l=!0,u||(d=Et(e,"click",r[10]),u=!0)},p(a,_){const x={};_&64&&(x.map=dn(a[6])),_&128&&(x.maptilerBasemap=a[7]),n.$set(x)},i(a){l||(oe(n.$$.fragment,a),l=!0)},o(a){pe(n.$$.fragment,a),l=!1},d(a){a&&(ve(e),ve(t)),je(n,a),u=!1,d()}}}function _D(r){let e,t,n,l,u,d,a=r[5]&&Sb(r);return{c(){e=de("div"),t=de("div"),n=Ue(),l=de("hr"),u=Ue(),a&&a.c(),Ee(e,"slot","left")},m(_,x){be(_,e,x),ie(e,t),r[17](t),ie(e,n),ie(e,l),ie(e,u),a&&a.m(e,null),d=!0},p(_,x){_[5]?a?(a.p(_,x),x&32&&oe(a,1)):(a=Sb(_),a.c(),oe(a,1),a.m(e,null)):a&&(vr(),pe(a,1,1,()=>{a=null}),br())},i(_){d||(oe(a),d=!0)},o(_){pe(a),d=!1},d(_){_&&ve(e),r[17](null),a&&a.d()}}}function yD(r){let e,t;return e=new K8({}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function vD(r){let e,t;return e=new q8({props:{wasmReady:r[4]}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&16&&(u.wasmReady=n[4]),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function kb(r){let e,t,n,l,u,d;e=new Pi({props:{data:JSON.parse(r[5].getInvertedBoundary()),$$slots:{default:[bD]},$$scope:{ctx:r}}});const a=[MD,ED,TD,kD,SD,xD,wD],_=[];function x(k,S){return k[8].mode=="network"?0:k[8].mode=="set-boundary"?1:k[8].mode=="auto-boundaries"?2:k[8].mode=="neighbourhood"?3:k[8].mode=="view-shortcuts"?4:k[8].mode=="route"?5:k[8].mode=="debug"?6:-1}return~(n=x(r))&&(l=_[n]=a[n](r)),{c(){Ve(e.$$.fragment),t=Ue(),l&&l.c(),u=$n()},m(k,S){Ne(e,k,S),be(k,t,S),~n&&_[n].m(k,S),be(k,u,S),d=!0},p(k,S){const C={};S&32&&(C.data=JSON.parse(k[5].getInvertedBoundary())),S&2097152&&(C.$$scope={dirty:S,ctx:k}),e.$set(C);let P=n;n=x(k),n===P?~n&&_[n].p(k,S):(l&&(vr(),pe(_[P],1,1,()=>{_[P]=null}),br()),~n?(l=_[n],l?l.p(k,S):(l=_[n]=a[n](k),l.c()),oe(l,1),l.m(u.parentNode,u)):l=null)},i(k){d||(oe(e.$$.fragment,k),oe(l),d=!0)},o(k){pe(e.$$.fragment,k),pe(l),d=!1},d(k){k&&(ve(t),ve(u)),je(e,k),~n&&_[n].d(k)}}}function bD(r){let e,t;const n=[Hn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<n.length;u+=1)l=Rn(l,n[u]);return e=new ma({props:l}),{c(){Ve(e.$$.fragment)},m(u,d){Ne(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(oe(e.$$.fragment,u),t=!0)},o(u){pe(e.$$.fragment,u),t=!1},d(u){je(e,u)}}}function wD(r){let e,t;return e=new bM({}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function xD(r){let e,t;return e=new Q6({props:{prevMode:r[8].prevMode}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&256&&(u.prevMode=n[8].prevMode),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function SD(r){let e,t;return e=new mD({}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function kD(r){let e,t;return e=new E6({}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function TD(r){let e,t;return e=new qz({}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function ED(r){let e,t;return e=new Pz({props:{name:r[8].name,existing:r[8].existing}}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p(n,l){const u={};l&256&&(u.name=n[8].name),l&256&&(u.existing=n[8].existing),e.$set(u)},i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function MD(r){let e,t;return e=new U6({}),{c(){Ve(e.$$.fragment)},m(n,l){Ne(e,n,l),t=!0},p:It,i(n){t||(oe(e.$$.fragment,n),t=!0)},o(n){pe(e.$$.fragment,n),t=!1},d(n){je(e,n)}}}function CD(r){let e,t,n,l,u,d,a,_,x,k;e=new n5({props:{map:r[0],apiKey:Rm}});const S=[vD,yD],C=[];function P(O,z){return O[8].mode=="title"?0:O[8].mode=="new-project"?1:-1}~(u=P(r))&&(d=C[u]=S[u](r));let D=r[5]&&kb(r);return x=new k5({}),{c(){Ve(e.$$.fragment),t=Ue(),n=de("div"),l=Ue(),d&&d.c(),a=Ue(),D&&D.c(),_=Ue(),Ve(x.$$.fragment)},m(O,z){Ne(e,O,z),be(O,t,z),be(O,n,z),r[14](n),be(O,l,z),~u&&C[u].m(O,z),be(O,a,z),D&&D.m(O,z),be(O,_,z),Ne(x,O,z),k=!0},p(O,z){const B={};z&1&&(B.map=O[0]),e.$set(B);let N=u;u=P(O),u===N?~u&&C[u].p(O,z):(d&&(vr(),pe(C[N],1,1,()=>{C[N]=null}),br()),~u?(d=C[u],d?d.p(O,z):(d=C[u]=S[u](O),d.c()),oe(d,1),d.m(a.parentNode,a)):d=null),O[5]?D?(D.p(O,z),z&32&&oe(D,1)):(D=kb(O),D.c(),oe(D,1),D.m(_.parentNode,_)):D&&(vr(),pe(D,1,1,()=>{D=null}),br())},i(O){k||(oe(e.$$.fragment,O),oe(d),oe(D),oe(x.$$.fragment,O),k=!0)},o(O){pe(e.$$.fragment,O),pe(d),pe(D),pe(x.$$.fragment,O),k=!1},d(O){O&&(ve(t),ve(n),ve(l),ve(a),ve(_)),je(e,O),r[14](null),~u&&C[u].d(O),D&&D.d(O),je(x,O)}}}function ID(r){let e,t,n,l;function u(a){r[15](a)}let d={style:`https://api.maptiler.com/maps/${r[7]}/style.json?key=${Rm}`,standardControls:!0,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:u4}],$$slots:{default:[CD]},$$scope:{ctx:r}};return r[0]!==void 0&&(d.map=r[0]),t=new r3({props:d}),pn.push(()=>zo(t,"map",u)),t.$on("error",r[16]),{c(){e=de("div"),Ve(t.$$.fragment),Ee(e,"slot","main"),fn(e,"position","relative"),fn(e,"width","100%"),fn(e,"height","100%")},m(a,_){be(a,e,_),Ne(t,e,null),l=!0},p(a,_){const x={};_&128&&(x.style=`https://api.maptiler.com/maps/${a[7]}/style.json?key=${Rm}`),_&2097465&&(x.$$scope={dirty:_,ctx:a}),!n&&_&1&&(n=!0,x.map=a[0],Po(()=>n=!1)),t.$set(x)},i(a){l||(oe(t.$$.fragment,a),l=!0)},o(a){pe(t.$$.fragment,a),l=!1},d(a){a&&ve(e),je(t)}}}function AD(r){let e,t,n,l;return e=new c4({}),n=new f5({props:{$$slots:{main:[ID],left:[_D],top:[gD]},$$scope:{ctx:r}}}),{c(){Ve(e.$$.fragment),t=Ue(),Ve(n.$$.fragment)},m(u,d){Ne(e,u,d),be(u,t,d),Ne(n,u,d),l=!0},p(u,[d]){const a={};d&2098175&&(a.$$scope={dirty:d,ctx:u}),n.$set(a)},i(u){l||(oe(e.$$.fragment,u),oe(n.$$.fragment,u),l=!0)},o(u){pe(e.$$.fragment,u),pe(n.$$.fragment,u),l=!1},d(u){u&&ve(t),je(e,u),je(n,u)}}}function LD(r,e,t){let n,l,u,d,a,_,x,k,S;yt(r,Km,J=>t(11,n=J)),yt(r,Xm,J=>t(12,l=J)),yt(r,$m,J=>t(13,u=J)),yt(r,ri,J=>t(5,d=J)),yt(r,ls,J=>t(6,a=J)),yt(r,dh,J=>t(20,_=J)),yt(r,Bm,J=>t(7,x=J)),yt(r,dr,J=>t(8,k=J)),yt(r,fd,J=>t(9,S=J));let C=!1;Pd(async()=>{await Nb(),await qb(),t(4,C=!0);try{(await fetch("/osm/areas.json")).ok&&(Rt(dh,_=!0,_),console.log("Using local cache, not od2net.org"))}catch{}});let P;function D(){a.fitBounds(Array.from(d.getBounds()),{animate:!1})}let O,z,B;function N(J){pn[J?"unshift":"push"](()=>{B=J,t(3,B),t(11,n)})}function G(J){P=J,t(0,P)}const U=J=>{console.log(J.detail.error)};function te(J){pn[J?"unshift":"push"](()=>{z=J,t(2,z),t(12,l)})}const le=()=>Rt(fd,S=!0,S);function $(J){pn[J?"unshift":"push"](()=>{O=J,t(1,O),t(13,u)})}return r.$$.update=()=>{r.$$.dirty&1&&P&&ls.set(P),r.$$.dirty&8194&&O&&u&&(t(1,O.innerHTML="",O),O.appendChild(u)),r.$$.dirty&4100&&z&&l&&(t(2,z.innerHTML="",z),z.appendChild(l)),r.$$.dirty&2056&&B&&n&&(t(3,B.innerHTML="",B),B.appendChild(n))},[P,O,z,B,C,d,a,x,k,S,D,n,l,u,N,G,U,te,le,$]}class PD extends Ht{constructor(e){super(),Zt(this,e,LD,AD,jt,{})}}new PD({target:document.getElementById("app")});
