var XA=Object.defineProperty;var KA=(r,e,t)=>e in r?XA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var er=(r,e,t)=>(KA(r,typeof e!="symbol"?e+"":e,t),t);function JA(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function ft(){}function It(r,e){for(const t in e)r[t]=e[t];return r}function Xb(r){return r()}function j0(){return Object.create(null)}function hr(r){r.forEach(Xb)}function ua(r){return typeof r=="function"}function wt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let bd;function Sr(r,e){return r===e?!0:(bd||(bd=document.createElement("a")),bd.href=e,r===bd.href)}function YA(r){return Object.keys(r).length===0}function Sg(r,...e){if(r==null){for(const n of e)n(void 0);return ft}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function hi(r){let e;return Sg(r,t=>e=t)(),e}function st(r,e,t){r.$$.on_destroy.push(Sg(e,t))}function vn(r,e,t,n){if(r){const i=Kb(r,e,t,n);return r[0](i)}}function Kb(r,e,t,n){return r[1]&&n?It(t.ctx.slice(),r[1](n(e))):t.ctx}function bn(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function wn(r,e,t,n,i,o){if(i){const u=Kb(e,t,n,o);r.p(u,i)}}function xn(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function fr(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function U0(r,e){const t={};e=new Set(e);for(const n in r)!e.has(n)&&n[0]!=="$"&&(t[n]=r[n]);return t}function Cg(r){const e={};for(const t in r)e[t]=!0;return e}function Yu(r){return r??""}function cn(r,e,t){return r.set(t),e}function $m(r){return r&&ua(r.destroy)?r.destroy:ft}const Jb=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function R(r,e){r.appendChild(e)}function W(r,e,t){r.insertBefore(e,t||null)}function G(r){r.parentNode&&r.parentNode.removeChild(r)}function di(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function U(r){return document.createElement(r)}function ys(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Te(r){return document.createTextNode(r)}function ie(){return Te(" ")}function rr(){return Te("")}function Lt(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Tg(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Sf(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function fe(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function Hd(r,e){for(const t in e)fe(r,t,e[t])}function QA(r,e,t){const n=new Set;for(let i=0;i<r.length;i+=1)r[i].checked&&n.add(r[i].__value);return t||n.delete(e),Array.from(n)}function Mg(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function Pl(r){return r===""?null:+r}function ek(r){return Array.from(r.childNodes)}function At(r,e){e=""+e,r.data!==e&&(r.data=e)}function Kn(r,e){r.value=e??""}function Ye(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function Wi(r,e,t){for(let n=0;n<r.options.length;n+=1){const i=r.options[n];if(i.__value===e){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function za(r){const e=r.querySelector(":checked");return e&&e.__value}function Gt(r,e,t){r.classList.toggle(e,!!t)}function tk(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let Of;function Cf(r){Of=r}function Xf(){if(!Of)throw new Error("Function called outside component initialization");return Of}function ws(r){Xf().$$.on_mount.push(r)}function ei(r){Xf().$$.on_destroy.push(r)}function $s(){const r=Xf();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=tk(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function op(r,e){return Xf().$$.context.set(r,e),e}function Kf(r){return Xf().$$.context.get(r)}function Sn(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Uu=[],pn=[];let Zu=[];const Nm=[],Yb=Promise.resolve();let jm=!1;function Qb(){jm||(jm=!0,Yb.then(tw))}function ew(){return Qb(),Yb}function ms(r){Zu.push(r)}function zn(r){Nm.push(r)}const wm=new Set;let Du=0;function tw(){if(Du!==0)return;const r=Of;do{try{for(;Du<Uu.length;){const e=Uu[Du];Du++,Cf(e),nk(e.$$)}}catch(e){throw Uu.length=0,Du=0,e}for(Cf(null),Uu.length=0,Du=0;pn.length;)pn.pop()();for(let e=0;e<Zu.length;e+=1){const t=Zu[e];wm.has(t)||(wm.add(t),t())}Zu.length=0}while(Uu.length);for(;Nm.length;)Nm.pop()();jm=!1,wm.clear(),Cf(r)}function nk(r){if(r.fragment!==null){r.update(),hr(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ms)}}function rk(r){const e=[],t=[];Zu.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Zu=e}const Pd=new Set;let Ml;function Kt(){Ml={r:0,c:[],p:Ml}}function Jt(){Ml.r||hr(Ml.c),Ml=Ml.p}function N(r,e){r&&r.i&&(Pd.delete(r),r.i(e))}function V(r,e,t,n){if(r&&r.o){if(Pd.has(r))return;Pd.add(r),Ml.c.push(()=>{Pd.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function On(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function ik(r,e){V(r,1,1,()=>{e.delete(r.key)})}function ok(r,e,t,n,i,o,u,s,d,p,g,_){let x=r.length,C=o.length,T=x;const z={};for(;T--;)z[r[T].key]=T;const L=[],E=new Map,I=new Map,O=[];for(T=C;T--;){const q=_(i,o,T),J=t(q);let he=u.get(J);he?n&&O.push(()=>he.p(q,e)):(he=p(J,q),he.c()),E.set(J,L[T]=he),J in z&&I.set(J,Math.abs(T-z[J]))}const B=new Set,K=new Set;function H(q){N(q,1),q.m(s,g),u.set(q.key,q),g=q.first,C--}for(;x&&C;){const q=L[C-1],J=r[x-1],he=q.key,Ee=J.key;q===J?(g=q.first,x--,C--):E.has(Ee)?!u.has(he)||B.has(he)?H(q):K.has(Ee)?x--:I.get(he)>I.get(Ee)?(K.add(he),H(q)):(B.add(Ee),x--):(d(J,u),x--)}for(;x--;){const q=r[x];E.has(q.key)||d(q,u)}for(;C;)H(L[C-1]);return hr(O),L}function Mn(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const u=r[o],s=e[o];if(s){for(const d in u)d in s||(n[d]=1);for(const d in s)i[d]||(t[d]=s[d],i[d]=1);r[o]=s}else for(const d in u)i[d]=1}for(const u in n)u in t||(t[u]=void 0);return t}function uo(r){return typeof r=="object"&&r!==null?r:{}}function Dn(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function ue(r){r&&r.c()}function ae(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),ms(()=>{const o=r.$$.on_mount.map(Xb).filter(ua);r.$$.on_destroy?r.$$.on_destroy.push(...o):hr(o),r.$$.on_mount=[]}),i.forEach(ms)}function le(r,e){const t=r.$$;t.fragment!==null&&(rk(t.after_update),hr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function sk(r,e){r.$$.dirty[0]===-1&&(Uu.push(r),Qb(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ct(r,e,t,n,i,o,u=null,s=[-1]){const d=Of;Cf(r);const p=r.$$={fragment:null,ctx:[],props:o,update:ft,not_equal:i,bound:j0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:j0(),dirty:s,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(_,x,...C)=>{const T=C.length?C[0]:x;return p.ctx&&i(p.ctx[_],p.ctx[_]=T)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](T),g&&sk(r,_)),x}):[],p.update(),g=!0,hr(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=ek(e.target);p.fragment&&p.fragment.l(_),_.forEach(G)}else p.fragment&&p.fragment.c();e.intro&&N(r.$$.fragment),ae(r,e.target,e.anchor),tw()}Cf(d)}class Tt{constructor(){er(this,"$$");er(this,"$$set")}$destroy(){le(this,1),this.$destroy=ft}$on(e,t){if(!ua(t))return ft;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!YA(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ak="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ak);const lk="/ltn/assets/arrow-big-up-4ad5891e.png",uk="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",ck="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==",nw="/ltn/assets/no_left_turn-dabd0fc9.png",Eg="/ltn/assets/no_right_turn-74f14f9d.png",rw="/ltn/assets/no_straight_turn-b5273de3.png",iw="/ltn/assets/no_u_left_to_right_turn-59028775.png",ow="/ltn/assets/no_u_right_to_left_turn-1ad8fc8a.png",fk="/ltn/assets/logo-97f2d067.svg",sw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function hk(r){let e,t,n,i,o;const u=r[5].default,s=vn(u,r,r[4],null);return{c(){e=U("dialog"),t=U("article"),s&&s.c()},m(d,p){W(d,e,p),R(e,t),s&&s.m(t,null),r[6](e),n=!0,i||(o=[Lt(e,"click",Sf(r[1])),Lt(e,"keydown",r[2])],i=!0)},p(d,[p]){s&&s.p&&(!n||p&16)&&wn(s,u,d,d[4],n?bn(u,d[4],p,null):xn(d[4]),null)},i(d){n||(N(s,d),n=!0)},o(d){V(s,d),n=!1},d(d){d&&G(e),s&&s.d(d),r[6](null),i=!1,hr(o)}}}function dk(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,u;function s(g){g.target==u&&t(3,o=!1)}function d(g){(g.key=="Escape"||g.key=="Enter")&&(g.stopPropagation(),t(3,o=!1))}function p(g){pn[g?"unshift":"push"](()=>{u=g,t(0,u)})}return r.$$set=g=>{"show"in g&&t(3,o=g.show),"$$scope"in g&&t(4,i=g.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&u&&(o?u.showModal():u.close())},[u,s,d,o,i,n,p]}class Lg extends Tt{constructor(e){super(),Ct(this,e,dk,hk,wt,{show:3})}}function V0(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function q0(r){let e,t,n=r[1]+"",i,o,u,s=r[2]+"",d,p;return{c(){e=U("tr"),t=U("td"),i=Te(n),o=ie(),u=U("td"),d=Te(s),p=ie()},m(g,_){W(g,e,_),R(e,t),R(t,i),R(e,o),R(e,u),R(u,d),R(e,p)},p(g,_){_&1&&n!==(n=g[1]+"")&&At(i,n),_&1&&s!==(s=g[2]+"")&&At(d,s)},d(g){g&&G(e)}}}function pk(r){let e,t,n=On(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=q0(V0(r,n,o));return{c(){e=U("table"),t=U("tbody");for(let o=0;o<i.length;o+=1)i[o].c();fe(e,"class","svelte-lh2o9l")},m(o,u){W(o,e,u),R(e,t);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(t,null)},p(o,[u]){if(u&1){n=On(Object.entries(o[0]));let s;for(s=0;s<n.length;s+=1){const d=V0(o,n,s);i[s]?i[s].p(d,u):(i[s]=q0(d),i[s].c(),i[s].m(t,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}},i:ft,o:ft,d(o){o&&G(e),di(i,o)}}}function mk(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class Jf extends Tt{constructor(e){super(),Ct(this,e,mk,pk,wt,{properties:0})}}function H0(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function G0(r){let e,t,n,i,o=r[4]+"",u,s;return{c(){e=U("div"),t=U("span"),i=ie(),u=Te(o),s=ie(),fe(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),Ye(t,"background",r[5]),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"gap","6px")},m(d,p){W(d,e,p),R(e,t),R(e,i),R(e,u),R(e,s)},p(d,p){p&2&&n!==(n="color-swatch "+d[1]+" svelte-1enycr6")&&fe(t,"class",n),p&1&&Ye(t,"background",d[5]),p&1&&o!==(o=d[4]+"")&&At(u,o)},d(d){d&&G(e)}}}function gk(r){let e,t=On(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=G0(H0(r,t,i));return{c(){e=U("div");for(let i=0;i<n.length;i+=1)n[i].c();Ye(e,"display","grid"),Ye(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),Ye(e,"gap","10px")},m(i,o){W(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){if(o&3){t=On(Object.entries(i[0]));let u;for(u=0;u<t.length;u+=1){const s=H0(i,t,u);n[u]?n[u].p(s,o):(n[u]=G0(s),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},i:ft,o:ft,d(i){i&&G(e),di(n,i)}}}function _k(r,e,t){let{labelColors:n}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e,u=`${100/o}%`;return r.$$set=s=>{"labelColors"in s&&t(0,n=s.labelColors),"swatchClass"in s&&t(1,i=s.swatchClass),"itemsPerRow"in s&&t(3,o=s.itemsPerRow)},[n,i,u,o]}class Ig extends Tt{constructor(e){super(),Ct(this,e,_k,gk,wt,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function W0(r,e,t){const n=r.slice();return n[6]=e[t],n}function Z0(r,e,t){const n=r.slice();return n[9]=e[t],n}function X0(r){let e,t;return{c(){e=U("span"),t=Te("Â "),fe(e,"class","bucket svelte-3plrz9"),Ye(e,"background",r[9])},m(n,i){W(n,e,i),R(e,t)},p(n,i){i&1&&Ye(e,"background",n[9])},d(n){n&&G(e)}}}function K0(r){let e;return{c(){e=U("span"),e.textContent=`${r[6]}`,fe(e,"class","svelte-3plrz9")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function yk(r){let e,t,n,i,o=On(r[0]),u=[];for(let p=0;p<o.length;p+=1)u[p]=X0(Z0(r,o,p));let s=On(r[3]),d=[];for(let p=0;p<s.length;p+=1)d[p]=K0(W0(r,s,p));return{c(){e=U("div"),t=U("div");for(let p=0;p<u.length;p+=1)u[p].c();n=ie(),i=U("div");for(let p=0;p<d.length;p+=1)d[p].c();fe(t,"class","colors svelte-3plrz9"),fe(i,"class","labels svelte-3plrz9"),fe(e,"class","svelte-3plrz9"),Gt(e,"full-width-bucket-legend",r[2]),Gt(e,"bucketed",r[1].hasOwnProperty("buckets")),Gt(e,"limits",r[1].hasOwnProperty("limits"))},m(p,g){W(p,e,g),R(e,t);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(t,null);R(e,n),R(e,i);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(i,null)},p(p,[g]){if(g&1){o=On(p[0]);let _;for(_=0;_<o.length;_+=1){const x=Z0(p,o,_);u[_]?u[_].p(x,g):(u[_]=X0(x),u[_].c(),u[_].m(t,null))}for(;_<u.length;_+=1)u[_].d(1);u.length=o.length}if(g&8){s=On(p[3]);let _;for(_=0;_<s.length;_+=1){const x=W0(p,s,_);d[_]?d[_].p(x,g):(d[_]=K0(x),d[_].c(),d[_].m(i,null))}for(;_<d.length;_+=1)d[_].d(1);d.length=s.length}g&4&&Gt(e,"full-width-bucket-legend",p[2]),g&2&&Gt(e,"bucketed",p[1].hasOwnProperty("buckets")),g&2&&Gt(e,"limits",p[1].hasOwnProperty("limits"))},i:ft,o:ft,d(p){p&&G(e),di(u,p),di(d,p)}}}function vk(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:u=!1}=e,s=[];"limits"in i?s=i.limits:s=i.buckets;let d=s.map(p=>typeof p=="number"?o>0?p.toFixed(o):p.toLocaleString():p);return r.$$set=p=>{"colorScale"in p&&t(0,n=p.colorScale),"labels"in p&&t(1,i=p.labels),"decimalPlaces"in p&&t(4,o=p.decimalPlaces),"fullWidthBucketLegend"in p&&t(2,u=p.fullWidthBucketLegend)},[n,i,u,d,o]}class wo extends Tt{constructor(e){super(),Ct(this,e,vk,yk,wt,{colorScale:0,labels:1,decimalPlaces:4,fullWidthBucketLegend:2})}}function sp(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function _r(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var aw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Pg(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var uw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(aw,function(){var t={},n={};function i(u,s,d){if(n[u]=d,u==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",g={};return n.shared(g),n.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function s(c,a,f,m){return new(f||(f=Promise))(function(b,k){function S(j){try{F(m.next(j))}catch(X){k(X)}}function M(j){try{F(m.throw(j))}catch(X){k(X)}}function F(j){var X;j.done?b(j.value):(X=j.value,X instanceof f?X:new f(function(Q){Q(X)})).then(S,M)}F((m=m.apply(c,a||[])).next())})}function d(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(c,a){this.x=c,this.y=a}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x,f=c.y-this.y;return a*a+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=a,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var a=Math.cos(c),f=Math.sin(c),m=f*this.x+a*this.y;return this.x=a*this.x-f*this.y,this.y=m,this},_rotateAround:function(c,a){var f=Math.cos(c),m=Math.sin(c),b=a.y+m*(this.x-a.x)+f*(this.y-a.y);return this.x=a.x+f*(this.x-a.x)-m*(this.y-a.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c};var _=d(p),x=C;function C(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}C.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var k=this.sampleCurveDerivativeX(f);if(Math.abs(k)<1e-6)break;f-=b/k}var S=0,M=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?S=f:M=f,f=.5*(M-S)+S;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var T=d(x);let z,L;function E(){return z==null&&(z=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),z}function I(){if(L==null&&(L=!1,E())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let m=0;m<5*5;m++){const b=4*m;a.fillStyle=`rgb(${b},${b+1},${b+2})`,a.fillRect(m%5,Math.floor(m/5),1,1)}const f=a.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&f[m]!==m){L=!0;break}}}return L||!1}function O(c,a,f,m){const b=new T(c,a,f,m);return function(k){return b.solve(k)}}const B=O(.25,.1,.25,1);function K(c,a,f){return Math.min(f,Math.max(a,c))}function H(c,a,f){const m=f-a,b=((c-a)%m+m)%m+a;return b===a?f:b}function q(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}let J=1;function he(c,a,f){const m={};for(const b in c)m[b]=a.call(f||this,c[b],b,c);return m}function Ee(c,a,f){const m={};for(const b in c)a.call(f||this,c[b],b,c)&&(m[b]=c[b]);return m}function Y(c){return Array.isArray(c)?c.map(Y):typeof c=="object"&&c?he(c,Y):c}const oe={};function ke(c){oe[c]||(typeof console<"u"&&console.warn(c),oe[c]=!0)}function ye(c,a,f){return(f.y-c.y)*(a.x-c.x)>(a.y-c.y)*(f.x-c.x)}function Ne(c){let a=0;for(let f,m,b=0,k=c.length,S=k-1;b<k;S=b++)f=c[b],m=c[S],a+=(m.x-f.x)*(f.y+m.y);return a}function Ue(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let De=null;function Le(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const lt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ze(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const k=new VideoFrame(c,{timestamp:0});try{const S=k==null?void 0:k.format;if(!S||!S.startsWith("BGR")&&!S.startsWith("RGB"))throw new Error(`Unrecognized format ${S}`);const M=S.startsWith("BGR"),F=new Uint8ClampedArray(m*b*4);if(yield k.copyTo(F,function(j,X,Q,se,pe){const _e=4*Math.max(-X,0),be=(Math.max(0,Q)-Q)*se*4+_e,Ce=4*se,Pe=Math.max(0,X),We=Math.max(0,Q);return{rect:{x:Pe,y:We,width:Math.min(j.width,X+se)-Pe,height:Math.min(j.height,Q+pe)-We},layout:[{offset:be,stride:Ce}]}}(c,a,f,m,b)),M)for(let j=0;j<F.length;j+=4){const X=F[j];F[j]=F[j+2],F[j+2]=X}return F}finally{k.close()}})}let at,dt;const pt="AbortError";function Je(){return new Error(pt)}const xt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Mt(c){return xt.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const Ot="global-dispatcher";class Yt extends Error{constructor(a,f,m,b){super(`AJAXError: ${f} (${a}): ${m}`),this.status=a,this.statusText=f,this.url=m,this.body=b}}const nn=()=>Ue(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Qt=function(c,a){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const m=Mt(c.url);if(m)return m(c,a);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:Ot},a)}if(!(/^file:/.test(f=c.url)||/^file:/.test(nn())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,b){return s(this,void 0,void 0,function*(){const k=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:nn(),signal:b.signal});m.type==="json"&&k.headers.set("Accept","application/json");const S=yield fetch(k);if(!S.ok){const j=yield S.blob();throw new Yt(S.status,S.statusText,m.url,j)}let M;M=m.type==="arrayBuffer"||m.type==="image"?S.arrayBuffer():m.type==="json"?S.json():S.text();const F=yield M;if(b.signal.aborted)throw Je();return{data:F,cacheControl:S.headers.get("Cache-Control"),expires:S.headers.get("Expires")}})}(c,a);if(Ue(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:Ot},a)}var f;return function(m,b){return new Promise((k,S)=>{const M=new XMLHttpRequest;M.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(M.responseType="arraybuffer");for(const F in m.headers)M.setRequestHeader(F,m.headers[F]);m.type==="json"&&(M.responseType="text",M.setRequestHeader("Accept","application/json")),M.withCredentials=m.credentials==="include",M.onerror=()=>{S(new Error(M.statusText))},M.onload=()=>{if(!b.signal.aborted)if((M.status>=200&&M.status<300||M.status===0)&&M.response!==null){let F=M.response;if(m.type==="json")try{F=JSON.parse(M.response)}catch(j){return void S(j)}k({data:F,cacheControl:M.getResponseHeader("Cache-Control"),expires:M.getResponseHeader("Expires")})}else{const F=new Blob([M.response],{type:M.getResponseHeader("Content-Type")});S(new Yt(M.status,M.statusText,m.url,F))}},b.signal.addEventListener("abort",()=>{M.abort(),S(Je())}),M.send(m.body)})}(c,a)};function fn(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const a=new URL(c),f=window.location;return a.protocol===f.protocol&&a.host===f.host}function mn(c,a,f){f[c]&&f[c].indexOf(a)!==-1||(f[c]=f[c]||[],f[c].push(a))}function qe(c,a,f){if(f&&f[c]){const m=f[c].indexOf(a);m!==-1&&f[c].splice(m,1)}}class Ge{constructor(a,f={}){q(this,f),this.type=a}}class gt extends Ge{constructor(a,f={}){super("error",q({error:a},f))}}class et{on(a,f){return this._listeners=this._listeners||{},mn(a,f,this._listeners),this}off(a,f){return qe(a,f,this._listeners),qe(a,f,this._oneTimeListeners),this}once(a,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},mn(a,f,this._oneTimeListeners),this):new Promise(m=>this.once(a,m))}fire(a,f){typeof a=="string"&&(a=new Ge(a,f||{}));const m=a.type;if(this.listens(m)){a.target=this;const b=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const M of b)M.call(this,a);const k=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const M of k)qe(m,M,this._oneTimeListeners),M.call(this,a);const S=this._eventedParent;S&&(q(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),S.fire(a))}else a instanceof gt&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,f){return this._eventedParent=a,this._eventedParentData=f,this}}var de={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const en=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Xe(c,a){const f={};for(const m in c)m!=="ref"&&(f[m]=c[m]);return en.forEach(m=>{m in a&&(f[m]=a[m])}),f}function it(c,a){if(Array.isArray(c)){if(!Array.isArray(a)||c.length!==a.length)return!1;for(let f=0;f<c.length;f++)if(!it(c[f],a[f]))return!1;return!0}if(typeof c=="object"&&c!==null&&a!==null){if(typeof a!="object"||Object.keys(c).length!==Object.keys(a).length)return!1;for(const f in c)if(!it(c[f],a[f]))return!1;return!0}return c===a}function Ut(c,a){c.push(a)}function Hn(c,a,f){Ut(f,{command:"addSource",args:[c,a[c]]})}function jn(c,a,f){Ut(a,{command:"removeSource",args:[c]}),f[c]=!0}function Nn(c,a,f,m){jn(c,f,m),Hn(c,a,f)}function Wt(c,a,f){let m;for(m in c[f])if(Object.prototype.hasOwnProperty.call(c[f],m)&&m!=="data"&&!it(c[f][m],a[f][m]))return!1;for(m in a[f])if(Object.prototype.hasOwnProperty.call(a[f],m)&&m!=="data"&&!it(c[f][m],a[f][m]))return!1;return!0}function An(c,a,f,m,b,k){c=c||{},a=a||{};for(const S in c)Object.prototype.hasOwnProperty.call(c,S)&&(it(c[S],a[S])||f.push({command:k,args:[m,S,a[S],b]}));for(const S in a)Object.prototype.hasOwnProperty.call(a,S)&&!Object.prototype.hasOwnProperty.call(c,S)&&(it(c[S],a[S])||f.push({command:k,args:[m,S,a[S],b]}))}function ti(c){return c.id}function Bn(c,a){return c[a.id]=a,c}class yt{constructor(a,f,m,b){this.message=(a?`${a}: `:"")+m,b&&(this.identifier=b),f!=null&&f.__line__&&(this.line=f.__line__)}}function mr(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}class or extends Error{constructor(a,f){super(f),this.message=f,this.key=a}}class gi{constructor(a,f=[]){this.parent=a,this.bindings={};for(const[m,b]of f)this.bindings[m]=b}concat(a){return new gi(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Un={kind:"null"},Fe={kind:"number"},mt={kind:"string"},vt={kind:"boolean"},Dt={kind:"color"},rn={kind:"object"},tn={kind:"value"},br={kind:"collator"},sr={kind:"formatted"},Se={kind:"padding"},ne={kind:"resolvedImage"},ce={kind:"variableAnchorOffsetCollection"};function ge(c,a){return{kind:"array",itemType:c,N:a}}function we(c){if(c.kind==="array"){const a=we(c.itemType);return typeof c.N=="number"?`array<${a}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${a}>`}return c.kind}const Oe=[Un,Fe,mt,vt,Dt,sr,rn,ge(tn),Se,ne,ce];function $e(c,a){if(a.kind==="error")return null;if(c.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!$e(c.itemType,a.itemType))&&(typeof c.N!="number"||c.N===a.N))return null}else{if(c.kind===a.kind)return null;if(c.kind==="value"){for(const f of Oe)if(!$e(f,a))return null}}return`Expected ${we(c)} but found ${we(a)} instead.`}function Ve(c,a){return a.some(f=>f.kind===c.kind)}function ze(c,a){return a.some(f=>f==="null"?c===null:f==="array"?Array.isArray(c):f==="object"?c&&!Array.isArray(c)&&typeof c=="object":f===typeof c)}function re(c,a){return c.kind==="array"&&a.kind==="array"?c.itemType.kind===a.itemType.kind&&typeof c.N=="number":c.kind===a.kind}const Ke=.96422,Qe=.82521,nt=4/29,ct=6/29,zt=3*ct*ct,on=ct*ct*ct,gn=Math.PI/180,En=180/Math.PI;function Vn(c){return(c%=360)<0&&(c+=360),c}function Cr([c,a,f,m]){let b,k;const S=Ln((.2225045*(c=Gr(c))+.7168786*(a=Gr(a))+.0606169*(f=Gr(f)))/1);c===a&&a===f?b=k=S:(b=Ln((.4360747*c+.3850649*a+.1430804*f)/Ke),k=Ln((.0139322*c+.0971045*a+.7141733*f)/Qe));const M=116*S-16;return[M<0?0:M,500*(b-S),200*(S-k),m]}function Gr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Ln(c){return c>on?Math.pow(c,1/3):c/zt+nt}function Rr([c,a,f,m]){let b=(c+16)/116,k=isNaN(a)?b:b+a/500,S=isNaN(f)?b:b-f/200;return b=1*Ci(b),k=Ke*Ci(k),S=Qe*Ci(S),[ni(3.1338561*k-1.6168667*b-.4906146*S),ni(-.9787684*k+1.9161415*b+.033454*S),ni(.0719453*k-.2289914*b+1.4052427*S),m]}function ni(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Ci(c){return c>ct?c*c*c:zt*(c-nt)}function Ri(c){return parseInt(c.padEnd(2,c),16)/255}function mi(c,a){return jo(a?c/100:c,0,1)}function jo(c,a,f){return Math.min(Math.max(a,c),f)}function mh(c){return!c.some(Number.isNaN)}const gp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ar{constructor(a,f,m,b=1,k=!0){this.r=a,this.g=f,this.b=m,this.a=b,k||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[a,f,m,b]))}static parse(a){if(a instanceof ar)return a;if(typeof a!="string")return;const f=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=gp[m];if(b){const[S,M,F]=b;return[S/255,M/255,F/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const S=m.length<6?1:2;let M=1;return[Ri(m.slice(M,M+=S)),Ri(m.slice(M,M+=S)),Ri(m.slice(M,M+=S)),Ri(m.slice(M,M+S)||"ff")]}if(m.startsWith("rgb")){const S=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[M,F,j,X,Q,se,pe,_e,be,Ce,Pe,We]=S,Re=[X||" ",pe||" ",Ce].join("");if(Re==="  "||Re==="  /"||Re===",,"||Re===",,,"){const je=[j,se,be].join(""),ht=je==="%%%"?100:je===""?255:0;if(ht){const _t=[jo(+F/ht,0,1),jo(+Q/ht,0,1),jo(+_e/ht,0,1),Pe?mi(+Pe,We):1];if(mh(_t))return _t}}return}}const k=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[S,M,F,j,X,Q,se,pe,_e]=k,be=[F||" ",X||" ",se].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const Ce=[+M,jo(+j,0,100),jo(+Q,0,100),pe?mi(+pe,_e):1];if(mh(Ce))return function([Pe,We,Re,je]){function ht(_t){const Ht=(_t+Pe/30)%12,sn=We*Math.min(Re,1-Re);return Re-sn*Math.max(-1,Math.min(Ht-3,9-Ht,1))}return Pe=Vn(Pe),We/=100,Re/=100,[ht(0),ht(8),ht(4),je]}(Ce)}}}(a);return f?new ar(...f,!1):void 0}get rgb(){const{r:a,g:f,b:m,a:b}=this,k=b||1/0;return this.overwriteGetter("rgb",[a/k,f/k,m/k,b])}get hcl(){return this.overwriteGetter("hcl",function(a){const[f,m,b,k]=Cr(a),S=Math.sqrt(m*m+b*b);return[Math.round(1e4*S)?Vn(Math.atan2(b,m)*En):NaN,S,f,k]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Cr(this.rgb))}overwriteGetter(a,f){return Object.defineProperty(this,a,{value:f}),f}toString(){const[a,f,m,b]=this.rgb;return`rgba(${[a,f,m].map(k=>Math.round(255*k)).join(",")},${b})`}}ar.black=new ar(0,0,0,1),ar.white=new ar(1,1,1,1),ar.transparent=new ar(0,0,0,0),ar.red=new ar(1,0,0,1);class uc{constructor(a,f,m){this.sensitivity=a?f?"variant":"case":f?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,f){return this.collator.compare(a,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class cc{constructor(a,f,m,b,k){this.text=a,this.image=f,this.scale=m,this.fontStack=b,this.textColor=k}}class Yi{constructor(a){this.sections=a}static fromString(a){return new Yi([new cc(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof Yi?a:Yi.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class Bi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Bi)return a;if(typeof a=="number")return new Bi([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const f of a)if(typeof f!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new Bi(a)}}toString(){return JSON.stringify(this.values)}}const Qa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class fo{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof fo)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let f=0;f<a.length;f+=2){const m=a[f],b=a[f+1];if(typeof m!="string"||!Qa.has(m)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new fo(a)}}toString(){return JSON.stringify(this.values)}}class ho{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new ho({name:a,available:!1}):null}}function fa(c,a,f,m){return typeof c=="number"&&c>=0&&c<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof f=="number"&&f>=0&&f<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,a,f,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,a,f,m]:[c,a,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fl(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof ar||c instanceof uc||c instanceof Yi||c instanceof Bi||c instanceof fo||c instanceof ho)return!0;if(Array.isArray(c)){for(const a of c)if(!Fl(a))return!1;return!0}if(typeof c=="object"){for(const a in c)if(!Fl(c[a]))return!1;return!0}return!1}function Wr(c){if(c===null)return Un;if(typeof c=="string")return mt;if(typeof c=="boolean")return vt;if(typeof c=="number")return Fe;if(c instanceof ar)return Dt;if(c instanceof uc)return br;if(c instanceof Yi)return sr;if(c instanceof Bi)return Se;if(c instanceof fo)return ce;if(c instanceof ho)return ne;if(Array.isArray(c)){const a=c.length;let f;for(const m of c){const b=Wr(m);if(f){if(f===b)continue;f=tn;break}f=b}return ge(f||tn,a)}return rn}function el(c){const a=typeof c;return c===null?"":a==="string"||a==="number"||a==="boolean"?String(c):c instanceof ar||c instanceof Yi||c instanceof Bi||c instanceof fo||c instanceof ho?c.toString():JSON.stringify(c)}class xs{constructor(a,f){this.type=a,this.value=f}static parse(a,f){if(a.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Fl(a[1]))return f.error("invalid value");const m=a[1];let b=Wr(m);const k=f.expectedType;return b.kind!=="array"||b.N!==0||!k||k.kind!=="array"||typeof k.N=="number"&&k.N!==0||(b=k),new xs(b,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ir{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const Ol={string:mt,number:Fe,boolean:vt,object:rn};class Qi{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");let m,b=1;const k=a[0];if(k==="array"){let M,F;if(a.length>2){const j=a[1];if(typeof j!="string"||!(j in Ol)||j==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);M=Ol[j],b++}else M=tn;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return f.error('The length argument to "array" must be a positive integer literal',2);F=a[2],b++}m=ge(M,F)}else{if(!Ol[k])throw new Error(`Types doesn't contain name = ${k}`);m=Ol[k]}const S=[];for(;b<a.length;b++){const M=f.parse(a[b],b,tn);if(!M)return null;S.push(M)}return new Qi(m,S)}evaluate(a){for(let f=0;f<this.args.length;f++){const m=this.args[f].evaluate(a);if(!$e(this.type,Wr(m)))return m;if(f===this.args.length-1)throw new Ir(`Expected value to be of type ${we(this.type)}, but found ${we(Wr(m))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const $l={"to-boolean":vt,"to-color":Dt,"to-number":Fe,"to-string":mt};class Uo{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[0];if(!$l[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&a.length!==2)return f.error("Expected one argument.");const b=$l[m],k=[];for(let S=1;S<a.length;S++){const M=f.parse(a[S],S,tn);if(!M)return null;k.push(M)}return new Uo(b,k)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let f,m;for(const b of this.args){if(f=b.evaluate(a),m=null,f instanceof ar)return f;if(typeof f=="string"){const k=a.parseColor(f);if(k)return k}else if(Array.isArray(f)&&(m=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:fa(f[0],f[1],f[2],f[3]),!m))return new ar(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Ir(m||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const m of this.args){f=m.evaluate(a);const b=Bi.parse(f);if(b)return b}throw new Ir(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const m of this.args){f=m.evaluate(a);const b=fo.parse(f);if(b)return b}throw new Ir(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const m of this.args){if(f=m.evaluate(a),f===null)return 0;const b=Number(f);if(!isNaN(b))return b}throw new Ir(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return Yi.fromString(el(this.args[0].evaluate(a)));case"resolvedImage":return ho.fromString(el(this.args[0].evaluate(a)));default:return el(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const tl=["Unknown","Point","LineString","Polygon"];class lr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?tl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let f=this._parseColorCache[a];return f||(f=this._parseColorCache[a]=ar.parse(a)),f}}class Nl{constructor(a,f,m=[],b,k=new gi,S=[]){this.registry=a,this.path=m,this.key=m.map(M=>`[${M}]`).join(""),this.scope=k,this.errors=S,this.expectedType=b,this._isConstant=f}parse(a,f,m,b,k={}){return f?this.concat(f,m,b)._parse(a,k):this._parse(a,k)}_parse(a,f){function m(b,k,S){return S==="assert"?new Qi(k,[b]):S==="coerce"?new Uo(k,[b]):b}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=a[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const k=this.registry[b];if(k){let S=k.parse(a,this);if(!S)return null;if(this.expectedType){const M=this.expectedType,F=S.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||F.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||F.kind!=="value"&&F.kind!=="string")if(M.kind!=="padding"||F.kind!=="value"&&F.kind!=="number"&&F.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||F.kind!=="value"&&F.kind!=="array"){if(this.checkSubtype(M,F))return null}else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"coerce");else S=m(S,M,f.typeAnnotation||"assert")}if(!(S instanceof xs)&&S.type.kind!=="resolvedImage"&&this._isConstant(S)){const M=new lr;try{S=new xs(S.type,S.evaluate(M))}catch(F){return this.error(F.message),null}}return S}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,f,m){const b=typeof a=="number"?this.path.concat(a):this.path,k=m?this.scope.concat(m):this.scope;return new Nl(this.registry,this._isConstant,b,f||null,k,this.errors)}error(a,...f){const m=`${this.key}${f.map(b=>`[${b}]`).join("")}`;this.errors.push(new or(m,a))}checkSubtype(a,f){const m=$e(a,f);return m&&this.error(m),m}}class ha{constructor(a,f,m){this.type=br,this.locale=m,this.caseSensitive=a,this.diacriticSensitive=f}static parse(a,f){if(a.length!==2)return f.error("Expected one argument.");const m=a[1];if(typeof m!="object"||Array.isArray(m))return f.error("Collator options argument must be an object.");const b=f.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,vt);if(!b)return null;const k=f.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,vt);if(!k)return null;let S=null;return m.locale&&(S=f.parse(m.locale,1,mt),!S)?null:new ha(b,k,S)}evaluate(a){return new uc(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}const As=8192;function jl(c,a){c[0]=Math.min(c[0],a[0]),c[1]=Math.min(c[1],a[1]),c[2]=Math.max(c[2],a[0]),c[3]=Math.max(c[3],a[1])}function nl(c,a){return!(c[0]<=a[0]||c[2]>=a[2]||c[1]<=a[1]||c[3]>=a[3])}function _p(c,a){const f=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,b=Math.pow(2,a.z);return[Math.round(f*b*As),Math.round(m*b*As)]}function gh(c,a,f){const m=c[0]-a[0],b=c[1]-a[1],k=c[0]-f[0],S=c[1]-f[1];return m*S-k*b==0&&m*k<=0&&b*S<=0}function Ul(c,a){let f=!1;for(let S=0,M=a.length;S<M;S++){const F=a[S];for(let j=0,X=F.length;j<X-1;j++){if(gh(c,F[j],F[j+1]))return!1;(b=F[j])[1]>(m=c)[1]!=(k=F[j+1])[1]>m[1]&&m[0]<(k[0]-b[0])*(m[1]-b[1])/(k[1]-b[1])+b[0]&&(f=!f)}}var m,b,k;return f}function yp(c,a){for(let f=0;f<a.length;f++)if(Ul(c,a[f]))return!0;return!1}function _h(c,a,f,m){const b=m[0]-f[0],k=m[1]-f[1],S=(c[0]-f[0])*k-b*(c[1]-f[1]),M=(a[0]-f[0])*k-b*(a[1]-f[1]);return S>0&&M<0||S<0&&M>0}function vp(c,a,f){for(const j of f)for(let X=0;X<j.length-1;++X)if((M=[(S=j[X+1])[0]-(k=j[X])[0],S[1]-k[1]])[0]*(F=[(b=a)[0]-(m=c)[0],b[1]-m[1]])[1]-M[1]*F[0]!=0&&_h(m,b,k,S)&&_h(k,S,m,b))return!0;var m,b,k,S,M,F;return!1}function yh(c,a){for(let f=0;f<c.length;++f)if(!Ul(c[f],a))return!1;for(let f=0;f<c.length-1;++f)if(vp(c[f],c[f+1],a))return!1;return!0}function vh(c,a){for(let f=0;f<a.length;f++)if(yh(c,a[f]))return!0;return!1}function Vl(c,a,f){const m=[];for(let b=0;b<c.length;b++){const k=[];for(let S=0;S<c[b].length;S++){const M=_p(c[b][S],f);jl(a,M),k.push(M)}m.push(k)}return m}function bh(c,a,f){const m=[];for(let b=0;b<c.length;b++){const k=Vl(c[b],a,f);m.push(k)}return m}function wh(c,a,f,m){if(c[0]<f[0]||c[0]>f[2]){const b=.5*m;let k=c[0]-f[0]>b?-m:f[0]-c[0]>b?m:0;k===0&&(k=c[0]-f[2]>b?-m:f[2]-c[0]>b?m:0),c[0]+=k}jl(a,c)}function ql(c,a,f,m){const b=Math.pow(2,m.z)*As,k=[m.x*As,m.y*As],S=[];for(const M of c)for(const F of M){const j=[F.x+k[0],F.y+k[1]];wh(j,a,f,b),S.push(j)}return S}function xh(c,a,f,m){const b=Math.pow(2,m.z)*As,k=[m.x*As,m.y*As],S=[];for(const F of c){const j=[];for(const X of F){const Q=[X.x+k[0],X.y+k[1]];jl(a,Q),j.push(Q)}S.push(j)}if(a[2]-a[0]<=b/2){(M=a)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const F of S)for(const j of F)wh(j,a,f,b)}var M;return S}class js{constructor(a,f){this.type=vt,this.geojson=a,this.geometries=f}static parse(a,f){if(a.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Fl(a[1])){const m=a[1];if(m.type==="FeatureCollection"){const b=[];for(const k of m.features){const{type:S,coordinates:M}=k.geometry;S==="Polygon"&&b.push(M),S==="MultiPolygon"&&b.push(...M)}if(b.length)return new js(m,{type:"MultiPolygon",coordinates:b})}else if(m.type==="Feature"){const b=m.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new js(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new js(m,m)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],S=f.canonicalID();if(m.type==="Polygon"){const M=Vl(m.coordinates,k,S),F=ql(f.geometry(),b,k,S);if(!nl(b,k))return!1;for(const j of F)if(!Ul(j,M))return!1}if(m.type==="MultiPolygon"){const M=bh(m.coordinates,k,S),F=ql(f.geometry(),b,k,S);if(!nl(b,k))return!1;for(const j of F)if(!yp(j,M))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],k=[1/0,1/0,-1/0,-1/0],S=f.canonicalID();if(m.type==="Polygon"){const M=Vl(m.coordinates,k,S),F=xh(f.geometry(),b,k,S);if(!nl(b,k))return!1;for(const j of F)if(!yh(j,M))return!1}if(m.type==="MultiPolygon"){const M=bh(m.coordinates,k,S),F=xh(f.geometry(),b,k,S);if(!nl(b,k))return!1;for(const j of F)if(!vh(j,M))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Hl{constructor(a,f){this.type=f.type,this.name=a,this.boundExpression=f}static parse(a,f){if(a.length!==2||typeof a[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const m=a[1];return f.scope.has(m)?new Hl(m,f.scope.get(m)):f.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class eo{constructor(a,f,m,b){this.name=a,this.type=f,this._evaluate=m,this.args=b}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,f){const m=a[0],b=eo.definitions[m];if(!b)return f.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const k=Array.isArray(b)?b[0]:b.type,S=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,M=S.filter(([j])=>!Array.isArray(j)||j.length===a.length-1);let F=null;for(const[j,X]of M){F=new Nl(f.registry,rl,f.path,null,f.scope);const Q=[];let se=!1;for(let pe=1;pe<a.length;pe++){const _e=a[pe],be=Array.isArray(j)?j[pe-1]:j.type,Ce=F.parse(_e,1+Q.length,be);if(!Ce){se=!0;break}Q.push(Ce)}if(!se)if(Array.isArray(j)&&j.length!==Q.length)F.error(`Expected ${j.length} arguments, but found ${Q.length} instead.`);else{for(let pe=0;pe<Q.length;pe++){const _e=Array.isArray(j)?j[pe]:j.type,be=Q[pe];F.concat(pe+1).checkSubtype(_e,be.type)}if(F.errors.length===0)return new eo(m,k,X,Q)}}if(M.length===1)f.errors.push(...F.errors);else{const j=(M.length?M:S).map(([Q])=>{return se=Q,Array.isArray(se)?`(${se.map(we).join(", ")})`:`(${we(se.type)}...)`;var se}).join(" | "),X=[];for(let Q=1;Q<a.length;Q++){const se=f.parse(a[Q],1+X.length);if(!se)return null;X.push(we(se.type))}f.error(`Expected arguments of type ${j}, but found (${X.join(", ")}) instead.`)}return null}static register(a,f){eo.definitions=f;for(const m in f)a[m]=eo}}function rl(c){if(c instanceof Hl)return rl(c.boundExpression);if(c instanceof eo&&c.name==="error"||c instanceof ha||c instanceof js)return!1;const a=c instanceof Uo||c instanceof Qi;let f=!0;return c.eachChild(m=>{f=a?f&&rl(m):f&&m instanceof xs}),!!f&&Gl(c)&&ol(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Gl(c){if(c instanceof eo&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof js)return!1;let a=!0;return c.eachChild(f=>{a&&!Gl(f)&&(a=!1)}),a}function il(c){if(c instanceof eo&&c.name==="feature-state")return!1;let a=!0;return c.eachChild(f=>{a&&!il(f)&&(a=!1)}),a}function ol(c,a){if(c instanceof eo&&a.indexOf(c.name)>=0)return!1;let f=!0;return c.eachChild(m=>{f&&!ol(m,a)&&(f=!1)}),f}function sl(c,a){const f=c.length-1;let m,b,k=0,S=f,M=0;for(;k<=S;)if(M=Math.floor((k+S)/2),m=c[M],b=c[M+1],m<=a){if(M===f||a<b)return M;k=M+1}else{if(!(m>a))throw new Ir("Input is not a number.");S=M-1}return 0}class al{constructor(a,f,m){this.type=a,this.input=f,this.labels=[],this.outputs=[];for(const[b,k]of m)this.labels.push(b),this.outputs.push(k)}static parse(a,f){if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");const m=f.parse(a[1],1,Fe);if(!m)return null;const b=[];let k=null;f.expectedType&&f.expectedType.kind!=="value"&&(k=f.expectedType);for(let S=1;S<a.length;S+=2){const M=S===1?-1/0:a[S],F=a[S+1],j=S,X=S+1;if(typeof M!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(b.length&&b[b.length-1][0]>=M)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);const Q=f.parse(F,X,k);if(!Q)return null;k=k||Q.type,b.push([M,Q])}return new al(k,m,b)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const k=f.length;return b>=f[k-1]?m[k-1].evaluate(a):m[sl(f,b)].evaluate(a)}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function bp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var wp=Ah;function Ah(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}Ah.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var k=this.sampleCurveDerivativeX(f);if(Math.abs(k)<1e-6)break;f-=b/k}var S=0,M=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?S=f:M=f,f=.5*(M-S)+S;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var xp=bp(wp);function Us(c,a,f){return c+f*(a-c)}function Wl(c,a,f){return c.map((m,b)=>Us(m,a[b],f))}const Ti={number:Us,color:function(c,a,f,m="rgb"){switch(m){case"rgb":{const[b,k,S,M]=Wl(c.rgb,a.rgb,f);return new ar(b,k,S,M,!1)}case"hcl":{const[b,k,S,M]=c.hcl,[F,j,X,Q]=a.hcl;let se,pe;if(isNaN(b)||isNaN(F))isNaN(b)?isNaN(F)?se=NaN:(se=F,S!==1&&S!==0||(pe=j)):(se=b,X!==1&&X!==0||(pe=k));else{let We=F-b;F>b&&We>180?We-=360:F<b&&b-F>180&&(We+=360),se=b+f*We}const[_e,be,Ce,Pe]=function([We,Re,je,ht]){return We=isNaN(We)?0:We*gn,Rr([je,Math.cos(We)*Re,Math.sin(We)*Re,ht])}([se,pe??Us(k,j,f),Us(S,X,f),Us(M,Q,f)]);return new ar(_e,be,Ce,Pe,!1)}case"lab":{const[b,k,S,M]=Rr(Wl(c.lab,a.lab,f));return new ar(b,k,S,M,!1)}}},array:Wl,padding:function(c,a,f){return new Bi(Wl(c.values,a.values,f))},variableAnchorOffsetCollection:function(c,a,f){const m=c.values,b=a.values;if(m.length!==b.length)throw new Ir(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${a.toString()}`);const k=[];for(let S=0;S<m.length;S+=2){if(m[S]!==b[S])throw new Ir(`Cannot interpolate values containing mismatched anchors. from[${S}]: ${m[S]}, to[${S}]: ${b[S]}`);k.push(m[S]);const[M,F]=m[S+1],[j,X]=b[S+1];k.push([Us(M,j,f),Us(F,X,f)])}return new fo(k)}};class wi{constructor(a,f,m,b,k){this.type=a,this.operator=f,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(const[S,M]of k)this.labels.push(S),this.outputs.push(M)}static interpolationFactor(a,f,m,b){let k=0;if(a.name==="exponential")k=Qn(f,a.base,m,b);else if(a.name==="linear")k=Qn(f,1,m,b);else if(a.name==="cubic-bezier"){const S=a.controlPoints;k=new xp(S[0],S[1],S[2],S[3]).solve(Qn(f,1,m,b))}return k}static parse(a,f){let[m,b,k,...S]=a;if(!Array.isArray(b)||b.length===0)return f.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const j=b[1];if(typeof j!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:j}}else{if(b[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const j=b.slice(1);if(j.length!==4||j.some(X=>typeof X!="number"||X<0||X>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:j}}}if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(k=f.parse(k,2,Fe),!k)return null;const M=[];let F=null;m==="interpolate-hcl"||m==="interpolate-lab"?F=Dt:f.expectedType&&f.expectedType.kind!=="value"&&(F=f.expectedType);for(let j=0;j<S.length;j+=2){const X=S[j],Q=S[j+1],se=j+3,pe=j+4;if(typeof X!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(M.length&&M[M.length-1][0]>=X)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);const _e=f.parse(Q,pe,F);if(!_e)return null;F=F||_e.type,M.push([X,_e])}return re(F,Fe)||re(F,Dt)||re(F,Se)||re(F,ce)||re(F,ge(Fe))?new wi(F,m,b,k,M):f.error(`Type ${we(F)} is not interpolatable.`)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const k=f.length;if(b>=f[k-1])return m[k-1].evaluate(a);const S=sl(f,b),M=wi.interpolationFactor(this.interpolation,b,f[S],f[S+1]),F=m[S].evaluate(a),j=m[S+1].evaluate(a);switch(this.operator){case"interpolate":return Ti[this.type.kind](F,j,M);case"interpolate-hcl":return Ti.color(F,j,M,"hcl");case"interpolate-lab":return Ti.color(F,j,M,"lab")}}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Qn(c,a,f,m){const b=m-f,k=c-f;return b===0?0:a===1?k/b:(Math.pow(a,k)-1)/(Math.pow(a,b)-1)}class Zl{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expectected at least one argument.");let m=null;const b=f.expectedType;b&&b.kind!=="value"&&(m=b);const k=[];for(const M of a.slice(1)){const F=f.parse(M,1+k.length,m,void 0,{typeAnnotation:"omit"});if(!F)return null;m=m||F.type,k.push(F)}if(!m)throw new Error("No output type");const S=b&&k.some(M=>$e(b,M.type));return new Zl(S?tn:m,k)}evaluate(a){let f,m=null,b=0;for(const k of this.args)if(b++,m=k.evaluate(a),m&&m instanceof ho&&!m.available&&(f||(f=m.name),m=null,b===this.args.length&&(m=f)),m!==null)break;return m}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}class Xl{constructor(a,f){this.type=f.type,this.bindings=[].concat(a),this.result=f}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const f of this.bindings)a(f[1]);a(this.result)}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const m=[];for(let k=1;k<a.length-1;k+=2){const S=a[k];if(typeof S!="string")return f.error(`Expected string, but found ${typeof S} instead.`,k);if(/[^a-zA-Z0-9_]/.test(S))return f.error("Variable names must contain only alphanumeric characters or '_'.",k);const M=f.parse(a[k+1],k+1);if(!M)return null;m.push([S,M])}const b=f.parse(a[a.length-1],a.length-1,f.expectedType,m);return b?new Xl(m,b):null}outputDefined(){return this.result.outputDefined()}}class fc{constructor(a,f,m){this.type=a,this.index=f,this.input=m}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Fe),b=f.parse(a[2],2,ge(f.expectedType||tn));return m&&b?new fc(b.type.itemType,m,b):null}evaluate(a){const f=this.index.evaluate(a),m=this.input.evaluate(a);if(f<0)throw new Ir(`Array index out of bounds: ${f} < 0.`);if(f>=m.length)throw new Ir(`Array index out of bounds: ${f} > ${m.length-1}.`);if(f!==Math.floor(f))throw new Ir(`Array index must be an integer, but found ${f} instead.`);return m[f]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class hc{constructor(a,f){this.type=vt,this.needle=a,this.haystack=f}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,tn),b=f.parse(a[2],2,tn);return m&&b?Ve(m.type,[vt,mt,Fe,Un,tn])?new hc(m,b):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`):null}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!m)return!1;if(!ze(f,["boolean","string","number","null"]))throw new Ir(`Expected first argument to be of type boolean, string, number or null, but found ${we(Wr(f))} instead.`);if(!ze(m,["string","array"]))throw new Ir(`Expected second argument to be of type array or string, but found ${we(Wr(m))} instead.`);return m.indexOf(f)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class Kl{constructor(a,f,m){this.type=Fe,this.needle=a,this.haystack=f,this.fromIndex=m}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,tn),b=f.parse(a[2],2,tn);if(!m||!b)return null;if(!Ve(m.type,[vt,mt,Fe,Un,tn]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`);if(a.length===4){const k=f.parse(a[3],3,Fe);return k?new Kl(m,b,k):null}return new Kl(m,b)}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!ze(f,["boolean","string","number","null"]))throw new Ir(`Expected first argument to be of type boolean, string, number or null, but found ${we(Wr(f))} instead.`);if(!ze(m,["string","array"]))throw new Ir(`Expected second argument to be of type array or string, but found ${we(Wr(m))} instead.`);if(this.fromIndex){const b=this.fromIndex.evaluate(a);return m.indexOf(f,b)}return m.indexOf(f)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class dc{constructor(a,f,m,b,k,S){this.inputType=a,this.type=f,this.input=m,this.cases=b,this.outputs=k,this.otherwise=S}static parse(a,f){if(a.length<5)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return f.error("Expected an even number of arguments.");let m,b;f.expectedType&&f.expectedType.kind!=="value"&&(b=f.expectedType);const k={},S=[];for(let j=2;j<a.length-1;j+=2){let X=a[j];const Q=a[j+1];Array.isArray(X)||(X=[X]);const se=f.concat(j);if(X.length===0)return se.error("Expected at least one branch label.");for(const _e of X){if(typeof _e!="number"&&typeof _e!="string")return se.error("Branch labels must be numbers or strings.");if(typeof _e=="number"&&Math.abs(_e)>Number.MAX_SAFE_INTEGER)return se.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof _e=="number"&&Math.floor(_e)!==_e)return se.error("Numeric branch labels must be integer values.");if(m){if(se.checkSubtype(m,Wr(_e)))return null}else m=Wr(_e);if(k[String(_e)]!==void 0)return se.error("Branch labels must be unique.");k[String(_e)]=S.length}const pe=f.parse(Q,j,b);if(!pe)return null;b=b||pe.type,S.push(pe)}const M=f.parse(a[1],1,tn);if(!M)return null;const F=f.parse(a[a.length-1],a.length-1,b);return F?M.type.kind!=="value"&&f.concat(1).checkSubtype(m,M.type)?null:new dc(m,b,M,k,S,F):null}evaluate(a){const f=this.input.evaluate(a);return(Wr(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class pc{constructor(a,f,m){this.type=a,this.branches=f,this.otherwise=m}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return f.error("Expected an odd number of arguments.");let m;f.expectedType&&f.expectedType.kind!=="value"&&(m=f.expectedType);const b=[];for(let S=1;S<a.length-1;S+=2){const M=f.parse(a[S],S,vt);if(!M)return null;const F=f.parse(a[S+1],S+1,m);if(!F)return null;b.push([M,F]),m=m||F.type}const k=f.parse(a[a.length-1],a.length-1,m);if(!k)return null;if(!m)throw new Error("Can't infer output type");return new pc(m,b,k)}evaluate(a){for(const[f,m]of this.branches)if(f.evaluate(a))return m.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[f,m]of this.branches)a(f),a(m);a(this.otherwise)}outputDefined(){return this.branches.every(([a,f])=>f.outputDefined())&&this.otherwise.outputDefined()}}class Jl{constructor(a,f,m,b){this.type=a,this.input=f,this.beginIndex=m,this.endIndex=b}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,tn),b=f.parse(a[2],2,Fe);if(!m||!b)return null;if(!Ve(m.type,[ge(tn),mt,tn]))return f.error(`Expected first argument to be of type array or string, but found ${we(m.type)} instead`);if(a.length===4){const k=f.parse(a[3],3,Fe);return k?new Jl(m.type,m,b,k):null}return new Jl(m.type,m,b)}evaluate(a){const f=this.input.evaluate(a),m=this.beginIndex.evaluate(a);if(!ze(f,["string","array"]))throw new Ir(`Expected first argument to be of type array or string, but found ${we(Wr(f))} instead.`);if(this.endIndex){const b=this.endIndex.evaluate(a);return f.slice(m,b)}return f.slice(m)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function kh(c,a){return c==="=="||c==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Sh(c,a,f,m){return m.compare(a,f)===0}function da(c,a,f){const m=c!=="=="&&c!=="!=";return class cw{constructor(k,S,M){this.type=vt,this.lhs=k,this.rhs=S,this.collator=M,this.hasUntypedArgument=k.type.kind==="value"||S.type.kind==="value"}static parse(k,S){if(k.length!==3&&k.length!==4)return S.error("Expected two or three arguments.");const M=k[0];let F=S.parse(k[1],1,tn);if(!F)return null;if(!kh(M,F.type))return S.concat(1).error(`"${M}" comparisons are not supported for type '${we(F.type)}'.`);let j=S.parse(k[2],2,tn);if(!j)return null;if(!kh(M,j.type))return S.concat(2).error(`"${M}" comparisons are not supported for type '${we(j.type)}'.`);if(F.type.kind!==j.type.kind&&F.type.kind!=="value"&&j.type.kind!=="value")return S.error(`Cannot compare types '${we(F.type)}' and '${we(j.type)}'.`);m&&(F.type.kind==="value"&&j.type.kind!=="value"?F=new Qi(j.type,[F]):F.type.kind!=="value"&&j.type.kind==="value"&&(j=new Qi(F.type,[j])));let X=null;if(k.length===4){if(F.type.kind!=="string"&&j.type.kind!=="string"&&F.type.kind!=="value"&&j.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(X=S.parse(k[3],3,br),!X)return null}return new cw(F,j,X)}evaluate(k){const S=this.lhs.evaluate(k),M=this.rhs.evaluate(k);if(m&&this.hasUntypedArgument){const F=Wr(S),j=Wr(M);if(F.kind!==j.kind||F.kind!=="string"&&F.kind!=="number")throw new Ir(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${F.kind}, ${j.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const F=Wr(S),j=Wr(M);if(F.kind!=="string"||j.kind!=="string")return a(k,S,M)}return this.collator?f(k,S,M,this.collator.evaluate(k)):a(k,S,M)}eachChild(k){k(this.lhs),k(this.rhs),this.collator&&k(this.collator)}outputDefined(){return!0}}}const Ap=da("==",function(c,a,f){return a===f},Sh),kp=da("!=",function(c,a,f){return a!==f},function(c,a,f,m){return!Sh(0,a,f,m)}),Sp=da("<",function(c,a,f){return a<f},function(c,a,f,m){return m.compare(a,f)<0}),Cp=da(">",function(c,a,f){return a>f},function(c,a,f,m){return m.compare(a,f)>0}),Tp=da("<=",function(c,a,f){return a<=f},function(c,a,f,m){return m.compare(a,f)<=0}),Mp=da(">=",function(c,a,f){return a>=f},function(c,a,f,m){return m.compare(a,f)>=0});class mc{constructor(a,f,m,b,k){this.type=mt,this.number=a,this.locale=f,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=k}static parse(a,f){if(a.length!==3)return f.error("Expected two arguments.");const m=f.parse(a[1],1,Fe);if(!m)return null;const b=a[2];if(typeof b!="object"||Array.isArray(b))return f.error("NumberFormat options argument must be an object.");let k=null;if(b.locale&&(k=f.parse(b.locale,1,mt),!k))return null;let S=null;if(b.currency&&(S=f.parse(b.currency,1,mt),!S))return null;let M=null;if(b["min-fraction-digits"]&&(M=f.parse(b["min-fraction-digits"],1,Fe),!M))return null;let F=null;return b["max-fraction-digits"]&&(F=f.parse(b["max-fraction-digits"],1,Fe),!F)?null:new mc(m,k,S,M,F)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class Yl{constructor(a){this.type=sr,this.sections=a}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[1];if(!Array.isArray(m)&&typeof m=="object")return f.error("First argument must be an image or text section.");const b=[];let k=!1;for(let S=1;S<=a.length-1;++S){const M=a[S];if(k&&typeof M=="object"&&!Array.isArray(M)){k=!1;let F=null;if(M["font-scale"]&&(F=f.parse(M["font-scale"],1,Fe),!F))return null;let j=null;if(M["text-font"]&&(j=f.parse(M["text-font"],1,ge(mt)),!j))return null;let X=null;if(M["text-color"]&&(X=f.parse(M["text-color"],1,Dt),!X))return null;const Q=b[b.length-1];Q.scale=F,Q.font=j,Q.textColor=X}else{const F=f.parse(a[S],1,tn);if(!F)return null;const j=F.type.kind;if(j!=="string"&&j!=="value"&&j!=="null"&&j!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");k=!0,b.push({content:F,scale:null,font:null,textColor:null})}}return new Yl(b)}evaluate(a){return new Yi(this.sections.map(f=>{const m=f.content.evaluate(a);return Wr(m)===ne?new cc("",m,null,null,null):new cc(el(m),null,f.scale?f.scale.evaluate(a):null,f.font?f.font.evaluate(a).join(","):null,f.textColor?f.textColor.evaluate(a):null)}))}eachChild(a){for(const f of this.sections)a(f.content),f.scale&&a(f.scale),f.font&&a(f.font),f.textColor&&a(f.textColor)}outputDefined(){return!1}}class gc{constructor(a){this.type=ne,this.input=a}static parse(a,f){if(a.length!==2)return f.error("Expected two arguments.");const m=f.parse(a[1],1,mt);return m?new gc(m):f.error("No image name provided.")}evaluate(a){const f=this.input.evaluate(a),m=ho.fromString(f);return m&&a.availableImages&&(m.available=a.availableImages.indexOf(f)>-1),m}eachChild(a){a(this.input)}outputDefined(){return!1}}class _c{constructor(a){this.type=Fe,this.input=a}static parse(a,f){if(a.length!==2)return f.error(`Expected 1 argument, but found ${a.length-1} instead.`);const m=f.parse(a[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${we(m.type)} instead.`):new _c(m):null}evaluate(a){const f=this.input.evaluate(a);if(typeof f=="string"||Array.isArray(f))return f.length;throw new Ir(`Expected value to be of type string or array, but found ${we(Wr(f))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const pa={"==":Ap,"!=":kp,">":Cp,"<":Sp,">=":Mp,"<=":Tp,array:Qi,at:fc,boolean:Qi,case:pc,coalesce:Zl,collator:ha,format:Yl,image:gc,in:hc,"index-of":Kl,interpolate:wi,"interpolate-hcl":wi,"interpolate-lab":wi,length:_c,let:Xl,literal:xs,match:dc,number:Qi,"number-format":mc,object:Qi,slice:Jl,step:al,string:Qi,"to-boolean":Uo,"to-color":Uo,"to-number":Uo,"to-string":Uo,var:Hl,within:js};function Ch(c,[a,f,m,b]){a=a.evaluate(c),f=f.evaluate(c),m=m.evaluate(c);const k=b?b.evaluate(c):1,S=fa(a,f,m,k);if(S)throw new Ir(S);return new ar(a/255,f/255,m/255,k,!1)}function Th(c,a){return c in a}function yc(c,a){const f=a[c];return f===void 0?null:f}function Vs(c){return{type:c}}function Mh(c){return{result:"success",value:c}}function ma(c){return{result:"error",value:c}}function ga(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Eh(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function vc(c){return!!c.expression&&c.expression.interpolated}function Jn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Ql(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Ep(c){return c}function Lh(c,a){const f=a.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",b=m||!(m||c.property!==void 0),k=c.type||(vc(a)?"exponential":"interval");if(f||a.type==="padding"){const X=f?ar.parse:Bi.parse;(c=mr({},c)).stops&&(c.stops=c.stops.map(Q=>[Q[0],X(Q[1])])),c.default=X(c.default?c.default:a.default)}if(c.colorSpace&&(S=c.colorSpace)!=="rgb"&&S!=="hcl"&&S!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var S;let M,F,j;if(k==="exponential")M=Gn;else if(k==="interval")M=Lp;else if(k==="categorical"){M=Vr,F=Object.create(null);for(const X of c.stops)F[X[0]]=X[1];j=typeof c.stops[0][0]}else{if(k!=="identity")throw new Error(`Unknown function type "${k}"`);M=bc}if(m){const X={},Q=[];for(let _e=0;_e<c.stops.length;_e++){const be=c.stops[_e],Ce=be[0].zoom;X[Ce]===void 0&&(X[Ce]={zoom:Ce,type:c.type,property:c.property,default:c.default,stops:[]},Q.push(Ce)),X[Ce].stops.push([be[0].value,be[1]])}const se=[];for(const _e of Q)se.push([X[_e].zoom,Lh(X[_e],a)]);const pe={name:"linear"};return{kind:"composite",interpolationType:pe,interpolationFactor:wi.interpolationFactor.bind(void 0,pe),zoomStops:se.map(_e=>_e[0]),evaluate:({zoom:_e},be)=>Gn({stops:se,base:c.base},a,_e).evaluate(_e,be)}}if(b){const X=k==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:X,interpolationFactor:wi.interpolationFactor.bind(void 0,X),zoomStops:c.stops.map(Q=>Q[0]),evaluate:({zoom:Q})=>M(c,a,Q,F,j)}}return{kind:"source",evaluate(X,Q){const se=Q&&Q.properties?Q.properties[c.property]:void 0;return se===void 0?ll(c.default,a.default):M(c,a,se,F,j)}}}function ll(c,a,f){return c!==void 0?c:a!==void 0?a:f!==void 0?f:void 0}function Vr(c,a,f,m,b){return ll(typeof f===b?m[f]:void 0,c.default,a.default)}function Lp(c,a,f){if(Jn(f)!=="number")return ll(c.default,a.default);const m=c.stops.length;if(m===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[m-1][0])return c.stops[m-1][1];const b=sl(c.stops.map(k=>k[0]),f);return c.stops[b][1]}function Gn(c,a,f){const m=c.base!==void 0?c.base:1;if(Jn(f)!=="number")return ll(c.default,a.default);const b=c.stops.length;if(b===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[b-1][0])return c.stops[b-1][1];const k=sl(c.stops.map(X=>X[0]),f),S=function(X,Q,se,pe){const _e=pe-se,be=X-se;return _e===0?0:Q===1?be/_e:(Math.pow(Q,be)-1)/(Math.pow(Q,_e)-1)}(f,m,c.stops[k][0],c.stops[k+1][0]),M=c.stops[k][1],F=c.stops[k+1][1],j=Ti[a.type]||Ep;return typeof M.evaluate=="function"?{evaluate(...X){const Q=M.evaluate.apply(void 0,X),se=F.evaluate.apply(void 0,X);if(Q!==void 0&&se!==void 0)return j(Q,se,S,c.colorSpace)}}:j(M,F,S,c.colorSpace)}function bc(c,a,f){switch(a.type){case"color":f=ar.parse(f);break;case"formatted":f=Yi.fromString(f.toString());break;case"resolvedImage":f=ho.fromString(f.toString());break;case"padding":f=Bi.parse(f);break;default:Jn(f)===a.type||a.type==="enum"&&a.values[f]||(f=void 0)}return ll(f,c.default,a.default)}eo.register(pa,{error:[{kind:"error"},[mt],(c,[a])=>{throw new Ir(a.evaluate(c))}],typeof:[mt,[tn],(c,[a])=>we(Wr(a.evaluate(c)))],"to-rgba":[ge(Fe,4),[Dt],(c,[a])=>{const[f,m,b,k]=a.evaluate(c).rgb;return[255*f,255*m,255*b,k]}],rgb:[Dt,[Fe,Fe,Fe],Ch],rgba:[Dt,[Fe,Fe,Fe,Fe],Ch],has:{type:vt,overloads:[[[mt],(c,[a])=>Th(a.evaluate(c),c.properties())],[[mt,rn],(c,[a,f])=>Th(a.evaluate(c),f.evaluate(c))]]},get:{type:tn,overloads:[[[mt],(c,[a])=>yc(a.evaluate(c),c.properties())],[[mt,rn],(c,[a,f])=>yc(a.evaluate(c),f.evaluate(c))]]},"feature-state":[tn,[mt],(c,[a])=>yc(a.evaluate(c),c.featureState||{})],properties:[rn,[],c=>c.properties()],"geometry-type":[mt,[],c=>c.geometryType()],id:[tn,[],c=>c.id()],zoom:[Fe,[],c=>c.globals.zoom],"heatmap-density":[Fe,[],c=>c.globals.heatmapDensity||0],"line-progress":[Fe,[],c=>c.globals.lineProgress||0],accumulated:[tn,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Fe,Vs(Fe),(c,a)=>{let f=0;for(const m of a)f+=m.evaluate(c);return f}],"*":[Fe,Vs(Fe),(c,a)=>{let f=1;for(const m of a)f*=m.evaluate(c);return f}],"-":{type:Fe,overloads:[[[Fe,Fe],(c,[a,f])=>a.evaluate(c)-f.evaluate(c)],[[Fe],(c,[a])=>-a.evaluate(c)]]},"/":[Fe,[Fe,Fe],(c,[a,f])=>a.evaluate(c)/f.evaluate(c)],"%":[Fe,[Fe,Fe],(c,[a,f])=>a.evaluate(c)%f.evaluate(c)],ln2:[Fe,[],()=>Math.LN2],pi:[Fe,[],()=>Math.PI],e:[Fe,[],()=>Math.E],"^":[Fe,[Fe,Fe],(c,[a,f])=>Math.pow(a.evaluate(c),f.evaluate(c))],sqrt:[Fe,[Fe],(c,[a])=>Math.sqrt(a.evaluate(c))],log10:[Fe,[Fe],(c,[a])=>Math.log(a.evaluate(c))/Math.LN10],ln:[Fe,[Fe],(c,[a])=>Math.log(a.evaluate(c))],log2:[Fe,[Fe],(c,[a])=>Math.log(a.evaluate(c))/Math.LN2],sin:[Fe,[Fe],(c,[a])=>Math.sin(a.evaluate(c))],cos:[Fe,[Fe],(c,[a])=>Math.cos(a.evaluate(c))],tan:[Fe,[Fe],(c,[a])=>Math.tan(a.evaluate(c))],asin:[Fe,[Fe],(c,[a])=>Math.asin(a.evaluate(c))],acos:[Fe,[Fe],(c,[a])=>Math.acos(a.evaluate(c))],atan:[Fe,[Fe],(c,[a])=>Math.atan(a.evaluate(c))],min:[Fe,Vs(Fe),(c,a)=>Math.min(...a.map(f=>f.evaluate(c)))],max:[Fe,Vs(Fe),(c,a)=>Math.max(...a.map(f=>f.evaluate(c)))],abs:[Fe,[Fe],(c,[a])=>Math.abs(a.evaluate(c))],round:[Fe,[Fe],(c,[a])=>{const f=a.evaluate(c);return f<0?-Math.round(-f):Math.round(f)}],floor:[Fe,[Fe],(c,[a])=>Math.floor(a.evaluate(c))],ceil:[Fe,[Fe],(c,[a])=>Math.ceil(a.evaluate(c))],"filter-==":[vt,[mt,tn],(c,[a,f])=>c.properties()[a.value]===f.value],"filter-id-==":[vt,[tn],(c,[a])=>c.id()===a.value],"filter-type-==":[vt,[mt],(c,[a])=>c.geometryType()===a.value],"filter-<":[vt,[mt,tn],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<b}],"filter-id-<":[vt,[tn],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<m}],"filter->":[vt,[mt,tn],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>b}],"filter-id->":[vt,[tn],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>m}],"filter-<=":[vt,[mt,tn],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<=b}],"filter-id-<=":[vt,[tn],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<=m}],"filter->=":[vt,[mt,tn],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>=b}],"filter-id->=":[vt,[tn],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>=m}],"filter-has":[vt,[tn],(c,[a])=>a.value in c.properties()],"filter-has-id":[vt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[vt,[ge(mt)],(c,[a])=>a.value.indexOf(c.geometryType())>=0],"filter-id-in":[vt,[ge(tn)],(c,[a])=>a.value.indexOf(c.id())>=0],"filter-in-small":[vt,[mt,ge(tn)],(c,[a,f])=>f.value.indexOf(c.properties()[a.value])>=0],"filter-in-large":[vt,[mt,ge(tn)],(c,[a,f])=>function(m,b,k,S){for(;k<=S;){const M=k+S>>1;if(b[M]===m)return!0;b[M]>m?S=M-1:k=M+1}return!1}(c.properties()[a.value],f.value,0,f.value.length-1)],all:{type:vt,overloads:[[[vt,vt],(c,[a,f])=>a.evaluate(c)&&f.evaluate(c)],[Vs(vt),(c,a)=>{for(const f of a)if(!f.evaluate(c))return!1;return!0}]]},any:{type:vt,overloads:[[[vt,vt],(c,[a,f])=>a.evaluate(c)||f.evaluate(c)],[Vs(vt),(c,a)=>{for(const f of a)if(f.evaluate(c))return!0;return!1}]]},"!":[vt,[vt],(c,[a])=>!a.evaluate(c)],"is-supported-script":[vt,[mt],(c,[a])=>{const f=c.globals&&c.globals.isSupportedScript;return!f||f(a.evaluate(c))}],upcase:[mt,[mt],(c,[a])=>a.evaluate(c).toUpperCase()],downcase:[mt,[mt],(c,[a])=>a.evaluate(c).toLowerCase()],concat:[mt,Vs(tn),(c,a)=>a.map(f=>el(f.evaluate(c))).join("")],"resolved-locale":[mt,[br],(c,[a])=>a.evaluate(c).resolvedLocale()]});class wr{constructor(a,f){var m;this.expression=a,this._warningHistory={},this._evaluator=new lr,this._defaultValue=f?(m=f).type==="color"&&Ql(m.default)?new ar(0,0,0,0):m.type==="color"?ar.parse(m.default)||null:m.type==="padding"?Bi.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?fo.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._evaluator.globals=a,this._evaluator.feature=f,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=S,this.expression.evaluate(this._evaluator)}evaluate(a,f,m,b,k,S){this._evaluator.globals=a,this._evaluator.feature=f||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=k||null,this._evaluator.formattedSection=S||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Ir(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function gr(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in pa}function qs(c,a){const f=new Nl(pa,rl,[],a?function(b){const k={color:Dt,string:mt,number:Fe,enum:mt,boolean:vt,formatted:sr,padding:Se,resolvedImage:ne,variableAnchorOffsetCollection:ce};return b.type==="array"?ge(k[b.value]||tn,b.length):k[b.type]}(a):void 0),m=f.parse(c,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Mh(new wr(m,a)):ma(f.errors)}class eu{constructor(a,f){this.kind=a,this._styleExpression=f,this.isStateDependent=a!=="constant"&&!il(f.expression)}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,k,S)}evaluate(a,f,m,b,k,S){return this._styleExpression.evaluate(a,f,m,b,k,S)}}class wc{constructor(a,f,m,b){this.kind=a,this.zoomStops=m,this._styleExpression=f,this.isStateDependent=a!=="camera"&&!il(f.expression),this.interpolationType=b}evaluateWithoutErrorHandling(a,f,m,b,k,S){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,k,S)}evaluate(a,f,m,b,k,S){return this._styleExpression.evaluate(a,f,m,b,k,S)}interpolationFactor(a,f,m){return this.interpolationType?wi.interpolationFactor(this.interpolationType,a,f,m):0}}function Ih(c,a){const f=qs(c,a);if(f.result==="error")return f;const m=f.value.expression,b=Gl(m);if(!b&&!ga(a))return ma([new or("","data expressions not supported")]);const k=ol(m,["zoom"]);if(!k&&!Eh(a))return ma([new or("","zoom expressions not supported")]);const S=nu(m);return S||k?S instanceof or?ma([S]):S instanceof wi&&!vc(a)?ma([new or("",'"interpolate" expressions cannot be used with this property')]):Mh(S?new wc(b?"camera":"composite",f.value,S.labels,S instanceof wi?S.interpolation:void 0):new eu(b?"constant":"source",f.value)):ma([new or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class tu{constructor(a,f){this._parameters=a,this._specification=f,mr(this,Lh(this._parameters,this._specification))}static deserialize(a){return new tu(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function nu(c){let a=null;if(c instanceof Xl)a=nu(c.result);else if(c instanceof Zl){for(const f of c.args)if(a=nu(f),a)break}else(c instanceof al||c instanceof wi)&&c.input instanceof eo&&c.input.name==="zoom"&&(a=c);return a instanceof or||c.eachChild(f=>{const m=nu(f);m instanceof or?a=m:!a&&m?a=new or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&m&&a!==m&&(a=new or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function ru(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const a of c.slice(1))if(!ru(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Ph={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function iu(c){if(c==null)return{filter:()=>!0,needGeometry:!1};ru(c)||(c=su(c));const a=qs(c,Ph);if(a.result==="error")throw new Error(a.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,m,b)=>a.value.evaluate(f,m,{},b),needGeometry:ou(c)}}function zh(c,a){return c<a?-1:c>a?1:0}function ou(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let a=1;a<c.length;a++)if(ou(c[a]))return!0;return!1}function su(c){if(!c)return!0;const a=c[0];return c.length<=1?a!=="any":a==="=="?xc(c[1],c[2],"=="):a==="!="?au(xc(c[1],c[2],"==")):a==="<"||a===">"||a==="<="||a===">="?xc(c[1],c[2],a):a==="any"?(f=c.slice(1),["any"].concat(f.map(su))):a==="all"?["all"].concat(c.slice(1).map(su)):a==="none"?["all"].concat(c.slice(1).map(su).map(au)):a==="in"?Dh(c[1],c.slice(2)):a==="!in"?au(Dh(c[1],c.slice(2))):a==="has"?Rh(c[1]):a==="!has"?au(Rh(c[1])):a!=="within"||c;var f}function xc(c,a,f){switch(c){case"$type":return[`filter-type-${f}`,a];case"$id":return[`filter-id-${f}`,a];default:return[`filter-${f}`,c,a]}}function Dh(c,a){if(a.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(f=>typeof f!=typeof a[0])?["filter-in-large",c,["literal",a.sort(zh)]]:["filter-in-small",c,["literal",a]]}}function Rh(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function au(c){return["!",c]}function Ac(c){const a=typeof c;if(a==="number"||a==="boolean"||a==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let b="[";for(const k of c)b+=`${Ac(k)},`;return`${b}]`}const f=Object.keys(c).sort();let m="{";for(let b=0;b<f.length;b++)m+=`${JSON.stringify(f[b])}:${Ac(c[f[b]])},`;return`${m}}`}function Ip(c){let a="";for(const f of en)a+=`/${Ac(c[f])}`;return a}function Bh(c){const a=c.value;return a?[new yt(c.key,a,"constants have been deprecated as of v8")]:[]}function Br(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function ks(c){if(Array.isArray(c))return c.map(ks);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const a={};for(const f in c)a[f]=ks(c[f]);return a}return Br(c)}function Mi(c){const a=c.key,f=c.value,m=c.valueSpec||{},b=c.objectElementValidators||{},k=c.style,S=c.styleSpec,M=c.validateSpec;let F=[];const j=Jn(f);if(j!=="object")return[new yt(a,f,`object expected, ${j} found`)];for(const X in f){const Q=X.split(".")[0],se=m[Q]||m["*"];let pe;if(b[Q])pe=b[Q];else if(m[Q])pe=M;else if(b["*"])pe=b["*"];else{if(!m["*"]){F.push(new yt(a,f[X],`unknown property "${X}"`));continue}pe=M}F=F.concat(pe({key:(a&&`${a}.`)+X,value:f[X],valueSpec:se,style:k,styleSpec:S,object:f,objectKey:X,validateSpec:M},f))}for(const X in m)b[X]||m[X].required&&m[X].default===void 0&&f[X]===void 0&&F.push(new yt(a,f,`missing required property "${X}"`));return F}function kc(c){const a=c.value,f=c.valueSpec,m=c.style,b=c.styleSpec,k=c.key,S=c.arrayElementValidator||c.validateSpec;if(Jn(a)!=="array")return[new yt(k,a,`array expected, ${Jn(a)} found`)];if(f.length&&a.length!==f.length)return[new yt(k,a,`array length ${f.length} expected, length ${a.length} found`)];if(f["min-length"]&&a.length<f["min-length"])return[new yt(k,a,`array length at least ${f["min-length"]} expected, length ${a.length} found`)];let M={type:f.value,values:f.values};b.$version<7&&(M.function=f.function),Jn(f.value)==="object"&&(M=f.value);let F=[];for(let j=0;j<a.length;j++)F=F.concat(S({array:a,arrayIndex:j,value:a[j],valueSpec:M,validateSpec:c.validateSpec,style:m,styleSpec:b,key:`${k}[${j}]`}));return F}function lu(c){const a=c.key,f=c.value,m=c.valueSpec;let b=Jn(f);return b==="number"&&f!=f&&(b="NaN"),b!=="number"?[new yt(a,f,`number expected, ${b} found`)]:"minimum"in m&&f<m.minimum?[new yt(a,f,`${f} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&f>m.maximum?[new yt(a,f,`${f} is greater than the maximum value ${m.maximum}`)]:[]}function Fh(c){const a=c.valueSpec,f=Br(c.value.type);let m,b,k,S={};const M=f!=="categorical"&&c.value.property===void 0,F=!M,j=Jn(c.value.stops)==="array"&&Jn(c.value.stops[0])==="array"&&Jn(c.value.stops[0][0])==="object",X=Mi({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(pe){if(f==="identity")return[new yt(pe.key,pe.value,'identity function may not have a "stops" property')];let _e=[];const be=pe.value;return _e=_e.concat(kc({key:pe.key,value:be,valueSpec:pe.valueSpec,validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec,arrayElementValidator:Q})),Jn(be)==="array"&&be.length===0&&_e.push(new yt(pe.key,be,"array must have at least one stop")),_e},default:function(pe){return pe.validateSpec({key:pe.key,value:pe.value,valueSpec:a,validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec})}}});return f==="identity"&&M&&X.push(new yt(c.key,c.value,'missing required property "property"')),f==="identity"||c.value.stops||X.push(new yt(c.key,c.value,'missing required property "stops"')),f==="exponential"&&c.valueSpec.expression&&!vc(c.valueSpec)&&X.push(new yt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(F&&!ga(c.valueSpec)?X.push(new yt(c.key,c.value,"property functions not supported")):M&&!Eh(c.valueSpec)&&X.push(new yt(c.key,c.value,"zoom functions not supported"))),f!=="categorical"&&!j||c.value.property!==void 0||X.push(new yt(c.key,c.value,'"property" property is required')),X;function Q(pe){let _e=[];const be=pe.value,Ce=pe.key;if(Jn(be)!=="array")return[new yt(Ce,be,`array expected, ${Jn(be)} found`)];if(be.length!==2)return[new yt(Ce,be,`array length 2 expected, length ${be.length} found`)];if(j){if(Jn(be[0])!=="object")return[new yt(Ce,be,`object expected, ${Jn(be[0])} found`)];if(be[0].zoom===void 0)return[new yt(Ce,be,"object stop key must have zoom")];if(be[0].value===void 0)return[new yt(Ce,be,"object stop key must have value")];if(k&&k>Br(be[0].zoom))return[new yt(Ce,be[0].zoom,"stop zoom values must appear in ascending order")];Br(be[0].zoom)!==k&&(k=Br(be[0].zoom),b=void 0,S={}),_e=_e.concat(Mi({key:`${Ce}[0]`,value:be[0],valueSpec:{zoom:{}},validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec,objectElementValidators:{zoom:lu,value:se}}))}else _e=_e.concat(se({key:`${Ce}[0]`,value:be[0],valueSpec:{},validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec},be));return gr(ks(be[1]))?_e.concat([new yt(`${Ce}[1]`,be[1],"expressions are not allowed in function stops.")]):_e.concat(pe.validateSpec({key:`${Ce}[1]`,value:be[1],valueSpec:a,validateSpec:pe.validateSpec,style:pe.style,styleSpec:pe.styleSpec}))}function se(pe,_e){const be=Jn(pe.value),Ce=Br(pe.value),Pe=pe.value!==null?pe.value:_e;if(m){if(be!==m)return[new yt(pe.key,Pe,`${be} stop domain type must match previous stop domain type ${m}`)]}else m=be;if(be!=="number"&&be!=="string"&&be!=="boolean")return[new yt(pe.key,Pe,"stop domain value must be a number, string, or boolean")];if(be!=="number"&&f!=="categorical"){let We=`number expected, ${be} found`;return ga(a)&&f===void 0&&(We+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yt(pe.key,Pe,We)]}return f!=="categorical"||be!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?f!=="categorical"&&be==="number"&&b!==void 0&&Ce<b?[new yt(pe.key,Pe,"stop domain values must appear in ascending order")]:(b=Ce,f==="categorical"&&Ce in S?[new yt(pe.key,Pe,"stop domain values must be unique")]:(S[Ce]=!0,[])):[new yt(pe.key,Pe,`integer expected, found ${Ce}`)]}}function Ss(c){const a=(c.expressionContext==="property"?Ih:qs)(ks(c.value),c.valueSpec);if(a.result==="error")return a.value.map(m=>new yt(`${c.key}${m.key}`,c.value,m.message));const f=a.value.expression||a.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!f.outputDefined())return[new yt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!il(f))return[new yt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!il(f))return[new yt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!ol(f,["zoom","feature-state"]))return[new yt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Gl(f))return[new yt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cs(c){const a=c.key,f=c.value,m=c.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(Br(f))===-1&&b.push(new yt(a,f,`expected one of [${m.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(m.values).indexOf(Br(f))===-1&&b.push(new yt(a,f,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(f)} found`)),b}function _a(c){return ru(ks(c.value))?Ss(mr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Sc(c)}function Sc(c){const a=c.value,f=c.key;if(Jn(a)!=="array")return[new yt(f,a,`array expected, ${Jn(a)} found`)];const m=c.styleSpec;let b,k=[];if(a.length<1)return[new yt(f,a,"filter array must have at least 1 element")];switch(k=k.concat(Cs({key:`${f}[0]`,value:a[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),Br(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Br(a[1])==="$type"&&k.push(new yt(f,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&k.push(new yt(f,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(b=Jn(a[1]),b!=="string"&&k.push(new yt(`${f}[1]`,a[1],`string expected, ${b} found`)));for(let S=2;S<a.length;S++)b=Jn(a[S]),Br(a[1])==="$type"?k=k.concat(Cs({key:`${f}[${S}]`,value:a[S],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&k.push(new yt(`${f}[${S}]`,a[S],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let S=1;S<a.length;S++)k=k.concat(Sc({key:`${f}[${S}]`,value:a[S],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=Jn(a[1]),a.length!==2?k.push(new yt(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="string"&&k.push(new yt(`${f}[1]`,a[1],`string expected, ${b} found`));break;case"within":b=Jn(a[1]),a.length!==2?k.push(new yt(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="object"&&k.push(new yt(`${f}[1]`,a[1],`object expected, ${b} found`))}return k}function uu(c,a){const f=c.key,m=c.validateSpec,b=c.style,k=c.styleSpec,S=c.value,M=c.objectKey,F=k[`${a}_${c.layerType}`];if(!F)return[];const j=M.match(/^(.*)-transition$/);if(a==="paint"&&j&&F[j[1]]&&F[j[1]].transition)return m({key:f,value:S,valueSpec:k.transition,style:b,styleSpec:k});const X=c.valueSpec||F[M];if(!X)return[new yt(f,S,`unknown property "${M}"`)];let Q;if(Jn(S)==="string"&&ga(X)&&!X.tokens&&(Q=/^{([^}]+)}$/.exec(S)))return[new yt(f,S,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Q[1])} }\`.`)];const se=[];return c.layerType==="symbol"&&(M==="text-field"&&b&&!b.glyphs&&se.push(new yt(f,S,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&Ql(ks(S))&&Br(S.type)==="identity"&&se.push(new yt(f,S,'"text-font" does not support identity functions'))),se.concat(m({key:c.key,value:S,valueSpec:X,style:b,styleSpec:k,expressionContext:"property",propertyType:a,propertyKey:M}))}function Cc(c){return uu(c,"paint")}function Tc(c){return uu(c,"layout")}function ul(c){let a=[];const f=c.value,m=c.key,b=c.style,k=c.styleSpec;f.type||f.ref||a.push(new yt(m,f,'either "type" or "ref" is required'));let S=Br(f.type);const M=Br(f.ref);if(f.id){const F=Br(f.id);for(let j=0;j<c.arrayIndex;j++){const X=b.layers[j];Br(X.id)===F&&a.push(new yt(m,f.id,`duplicate layer id "${f.id}", previously used at line ${X.id.__line__}`))}}if("ref"in f){let F;["type","source","source-layer","filter","layout"].forEach(j=>{j in f&&a.push(new yt(m,f[j],`"${j}" is prohibited for ref layers`))}),b.layers.forEach(j=>{Br(j.id)===M&&(F=j)}),F?F.ref?a.push(new yt(m,f.ref,"ref cannot reference another ref layer")):S=Br(F.type):a.push(new yt(m,f.ref,`ref layer "${M}" not found`))}else if(S!=="background")if(f.source){const F=b.sources&&b.sources[f.source],j=F&&Br(F.type);F?j==="vector"&&S==="raster"?a.push(new yt(m,f.source,`layer "${f.id}" requires a raster source`)):j!=="raster-dem"&&S==="hillshade"?a.push(new yt(m,f.source,`layer "${f.id}" requires a raster-dem source`)):j==="raster"&&S!=="raster"?a.push(new yt(m,f.source,`layer "${f.id}" requires a vector source`)):j!=="vector"||f["source-layer"]?j==="raster-dem"&&S!=="hillshade"?a.push(new yt(m,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):S!=="line"||!f.paint||!f.paint["line-gradient"]||j==="geojson"&&F.lineMetrics||a.push(new yt(m,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new yt(m,f,`layer "${f.id}" must specify a "source-layer"`)):a.push(new yt(m,f.source,`source "${f.source}" not found`))}else a.push(new yt(m,f,'missing required property "source"'));return a=a.concat(Mi({key:m,value:f,valueSpec:k.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:f.type,valueSpec:k.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:f,objectKey:"type"}),filter:_a,layout:F=>Mi({layer:f,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":j=>Tc(mr({layerType:S},j))}}),paint:F=>Mi({layer:f,key:F.key,value:F.value,style:F.style,styleSpec:F.styleSpec,validateSpec:F.validateSpec,objectElementValidators:{"*":j=>Cc(mr({layerType:S},j))}})}})),a}function Hs(c){const a=c.value,f=c.key,m=Jn(a);return m!=="string"?[new yt(f,a,`string expected, ${m} found`)]:[]}const Oh={promoteId:function({key:c,value:a}){if(Jn(a)==="string")return Hs({key:c,value:a});{const f=[];for(const m in a)f.push(...Hs({key:`${c}.${m}`,value:a[m]}));return f}}};function $h(c){const a=c.value,f=c.key,m=c.styleSpec,b=c.style,k=c.validateSpec;if(!a.type)return[new yt(f,a,'"type" is required')];const S=Br(a.type);let M;switch(S){case"vector":case"raster":return M=Mi({key:f,value:a,valueSpec:m[`source_${S.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:Oh,validateSpec:k}),M;case"raster-dem":return M=function(F){var j;const X=(j=F.sourceName)!==null&&j!==void 0?j:"",Q=F.value,se=F.styleSpec,pe=se.source_raster_dem,_e=F.style;let be=[];const Ce=Jn(Q);if(Q===void 0)return be;if(Ce!=="object")return be.push(new yt("source_raster_dem",Q,`object expected, ${Ce} found`)),be;const Pe=Br(Q.encoding)==="custom",We=["redFactor","greenFactor","blueFactor","baseShift"],Re=F.value.encoding?`"${F.value.encoding}"`:"Default";for(const je in Q)!Pe&&We.includes(je)?be.push(new yt(je,Q[je],`In "${X}": "${je}" is only valid when "encoding" is set to "custom". ${Re} encoding found`)):pe[je]?be=be.concat(F.validateSpec({key:je,value:Q[je],valueSpec:pe[je],validateSpec:F.validateSpec,style:_e,styleSpec:se})):be.push(new yt(je,Q[je],`unknown property "${je}"`));return be}({sourceName:f,value:a,style:c.style,styleSpec:m,validateSpec:k}),M;case"geojson":if(M=Mi({key:f,value:a,valueSpec:m.source_geojson,style:b,styleSpec:m,validateSpec:k,objectElementValidators:Oh}),a.cluster)for(const F in a.clusterProperties){const[j,X]=a.clusterProperties[F],Q=typeof j=="string"?[j,["accumulated"],["get",F]]:j;M.push(...Ss({key:`${f}.${F}.map`,value:X,validateSpec:k,expressionContext:"cluster-map"})),M.push(...Ss({key:`${f}.${F}.reduce`,value:Q,validateSpec:k,expressionContext:"cluster-reduce"}))}return M;case"video":return Mi({key:f,value:a,valueSpec:m.source_video,style:b,validateSpec:k,styleSpec:m});case"image":return Mi({key:f,value:a,valueSpec:m.source_image,style:b,validateSpec:k,styleSpec:m});case"canvas":return[new yt(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cs({key:`${f}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:k,styleSpec:m})}}function Nh(c){const a=c.value,f=c.styleSpec,m=f.light,b=c.style;let k=[];const S=Jn(a);if(a===void 0)return k;if(S!=="object")return k=k.concat([new yt("light",a,`object expected, ${S} found`)]),k;for(const M in a){const F=M.match(/^(.*)-transition$/);k=k.concat(F&&m[F[1]]&&m[F[1]].transition?c.validateSpec({key:M,value:a[M],valueSpec:f.transition,validateSpec:c.validateSpec,style:b,styleSpec:f}):m[M]?c.validateSpec({key:M,value:a[M],valueSpec:m[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new yt(M,a[M],`unknown property "${M}"`)])}return k}function jh(c){const a=c.value,f=c.styleSpec,m=f.sky,b=c.style,k=Jn(a);if(a===void 0)return[];if(k!=="object")return[new yt("sky",a,`object expected, ${k} found`)];let S=[];for(const M in a)S=S.concat(m[M]?Vo({key:M,value:a[M],valueSpec:m[M],style:b,styleSpec:f}):[new yt(M,a[M],`unknown property "${M}"`)]);return S}function cl(c){const a=c.value,f=c.styleSpec,m=f.terrain,b=c.style;let k=[];const S=Jn(a);if(a===void 0)return k;if(S!=="object")return k=k.concat([new yt("terrain",a,`object expected, ${S} found`)]),k;for(const M in a)k=k.concat(m[M]?c.validateSpec({key:M,value:a[M],valueSpec:m[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new yt(M,a[M],`unknown property "${M}"`)]);return k}function fl(c){let a=[];const f=c.value,m=c.key;if(Array.isArray(f)){const b=[],k=[];for(const S in f)f[S].id&&b.includes(f[S].id)&&a.push(new yt(m,f,`all the sprites' ids must be unique, but ${f[S].id} is duplicated`)),b.push(f[S].id),f[S].url&&k.includes(f[S].url)&&a.push(new yt(m,f,`all the sprites' URLs must be unique, but ${f[S].url} is duplicated`)),k.push(f[S].url),a=a.concat(Mi({key:`${m}[${S}]`,value:f[S],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return a}return Hs({key:m,value:f})}const Fi={"*":()=>[],array:kc,boolean:function(c){const a=c.value,f=c.key,m=Jn(a);return m!=="boolean"?[new yt(f,a,`boolean expected, ${m} found`)]:[]},number:lu,color:function(c){const a=c.key,f=c.value,m=Jn(f);return m!=="string"?[new yt(a,f,`color expected, ${m} found`)]:ar.parse(String(f))?[]:[new yt(a,f,`color expected, "${f}" found`)]},constants:Bh,enum:Cs,filter:_a,function:Fh,layer:ul,object:Mi,source:$h,light:Nh,sky:jh,terrain:cl,string:Hs,formatted:function(c){return Hs(c).length===0?[]:Ss(c)},resolvedImage:function(c){return Hs(c).length===0?[]:Ss(c)},padding:function(c){const a=c.key,f=c.value;if(Jn(f)==="array"){if(f.length<1||f.length>4)return[new yt(a,f,`padding requires 1 to 4 values; ${f.length} values found`)];const m={type:"number"};let b=[];for(let k=0;k<f.length;k++)b=b.concat(c.validateSpec({key:`${a}[${k}]`,value:f[k],validateSpec:c.validateSpec,valueSpec:m}));return b}return lu({key:a,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const a=c.key,f=c.value,m=Jn(f),b=c.styleSpec;if(m!=="array"||f.length<1||f.length%2!=0)return[new yt(a,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let k=[];for(let S=0;S<f.length;S+=2)k=k.concat(Cs({key:`${a}[${S}]`,value:f[S],valueSpec:b.layout_symbol["text-anchor"]})),k=k.concat(kc({key:`${a}[${S+1}]`,value:f[S+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:b}));return k},sprite:fl};function Vo(c){const a=c.value,f=c.valueSpec,m=c.styleSpec;return c.validateSpec=Vo,f.expression&&Ql(Br(a))?Fh(c):f.expression&&gr(ks(a))?Ss(c):f.type&&Fi[f.type]?Fi[f.type](c):Mi(mr({},c,{valueSpec:f.type?m[f.type]:f}))}function Mc(c){const a=c.value,f=c.key,m=Hs(c);return m.length||(a.indexOf("{fontstack}")===-1&&m.push(new yt(f,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&m.push(new yt(f,a,'"glyphs" url must include a "{range}" token'))),m}function Ao(c,a=de){let f=[];return f=f.concat(Vo({key:"",value:c,valueSpec:a.$root,styleSpec:a,style:c,validateSpec:Vo,objectElementValidators:{glyphs:Mc,"*":()=>[]}})),c.constants&&(f=f.concat(Bh({key:"constants",value:c.constants,style:c,styleSpec:a,validateSpec:Vo}))),ya(f)}function qo(c){return function(a){return c({...a,validateSpec:Vo})}}function ya(c){return[].concat(c).sort((a,f)=>a.line-f.line)}function ko(c){return function(...a){return ya(c.apply(this,a))}}Ao.source=ko(qo($h)),Ao.sprite=ko(qo(fl)),Ao.glyphs=ko(qo(Mc)),Ao.light=ko(qo(Nh)),Ao.sky=ko(qo(jh)),Ao.terrain=ko(qo(cl)),Ao.layer=ko(qo(ul)),Ao.filter=ko(qo(_a)),Ao.paintProperty=ko(qo(Cc)),Ao.layoutProperty=ko(qo(Tc));const Gs=Ao,Pp=Gs.light,Ec=Gs.paintProperty,zp=Gs.layoutProperty;function va(c,a){let f=!1;if(a&&a.length)for(const m of a)c.fire(new gt(new Error(m.message))),f=!0;return f}class hl{constructor(a,f,m){const b=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const S=new Int32Array(this.arrayBuffer);a=S[0],this.d=(f=S[1])+2*(m=S[2]);for(let F=0;F<this.d*this.d;F++){const j=S[3+F],X=S[3+F+1];b.push(j===X?null:S.subarray(j,X))}const M=S[3+b.length+1];this.keys=S.subarray(S[3+b.length],M),this.bboxes=S.subarray(M),this.insert=this._insertReadonly}else{this.d=f+2*m;for(let S=0;S<this.d*this.d;S++)b.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=a,this.padding=m,this.scale=f/a,this.uid=0;const k=m/f*a;this.min=-k,this.max=a+k}insert(a,f,m,b,k){this._forEachCell(f,m,b,k,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(k)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,f,m,b,k,S){this.cells[k].push(S)}query(a,f,m,b,k){const S=this.min,M=this.max;if(a<=S&&f<=S&&M<=m&&M<=b&&!k)return Array.prototype.slice.call(this.keys);{const F=[];return this._forEachCell(a,f,m,b,this._queryCell,F,{},k),F}}_queryCell(a,f,m,b,k,S,M,F){const j=this.cells[k];if(j!==null){const X=this.keys,Q=this.bboxes;for(let se=0;se<j.length;se++){const pe=j[se];if(M[pe]===void 0){const _e=4*pe;(F?F(Q[_e+0],Q[_e+1],Q[_e+2],Q[_e+3]):a<=Q[_e+2]&&f<=Q[_e+3]&&m>=Q[_e+0]&&b>=Q[_e+1])?(M[pe]=!0,S.push(X[pe])):M[pe]=!1}}}}_forEachCell(a,f,m,b,k,S,M,F){const j=this._convertToCellCoord(a),X=this._convertToCellCoord(f),Q=this._convertToCellCoord(m),se=this._convertToCellCoord(b);for(let pe=j;pe<=Q;pe++)for(let _e=X;_e<=se;_e++){const be=this.d*_e+pe;if((!F||F(this._convertFromCellCoord(pe),this._convertFromCellCoord(_e),this._convertFromCellCoord(pe+1),this._convertFromCellCoord(_e+1)))&&k.call(this,a,f,m,b,be,S,M,F))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,f=3+this.cells.length+1+1;let m=0;for(let S=0;S<this.cells.length;S++)m+=this.cells[S].length;const b=new Int32Array(f+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let k=f;for(let S=0;S<a.length;S++){const M=a[S];b[3+S]=k,b.set(M,k),k+=M.length}return b[3+a.length]=k,b.set(this.keys,k),k+=this.keys.length,b[3+a.length+1]=k,b.set(this.bboxes,k),k+=this.bboxes.length,b.buffer}static serialize(a,f){const m=a.toArrayBuffer();return f&&f.push(m),{buffer:m}}static deserialize(a){return new hl(a.buffer)}}const Ho={};function Zt(c,a,f={}){if(Ho[c])throw new Error(`${c} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:c,writeable:!1}),Ho[c]={klass:a,omit:f.omit||[],shallow:f.shallow||[]}}Zt("Object",Object),Zt("TransferableGridIndex",hl),Zt("Color",ar),Zt("Error",Error),Zt("AJAXError",Yt),Zt("ResolvedImage",ho),Zt("StylePropertyFunction",tu),Zt("StyleExpression",wr,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",wc),Zt("ZoomConstantExpression",eu),Zt("CompoundExpression",eo,{omit:["_evaluate"]});for(const c in pa)pa[c]._classRegistryKey||Zt(`Expression_${c}`,pa[c]);function cu(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function ba(c,a){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(cu(c)||Le(c))return a&&a.push(c),c;if(ArrayBuffer.isView(c)){const f=c;return a&&a.push(f.buffer),f}if(c instanceof ImageData)return a&&a.push(c.data.buffer),c;if(Array.isArray(c)){const f=[];for(const m of c)f.push(ba(m,a));return f}if(typeof c=="object"){const f=c.constructor,m=f._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${f.name}`);if(!Ho[m])throw new Error(`${m} is not registered.`);const b=f.serialize?f.serialize(c,a):{};if(f.serialize){if(a&&b===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const k in c){if(!c.hasOwnProperty(k)||Ho[m].omit.indexOf(k)>=0)continue;const S=c[k];b[k]=Ho[m].shallow.indexOf(k)>=0?S:ba(S,a)}c instanceof Error&&(b.message=c.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(b.$name=m),b}throw new Error("can't serialize object of type "+typeof c)}function wa(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||cu(c)||Le(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(wa);if(typeof c=="object"){const a=c.$name||"Object";if(!Ho[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:f}=Ho[a];if(!f)throw new Error(`can't deserialize unregistered class ${a}`);if(f.deserialize)return f.deserialize(c);const m=Object.create(f.prototype);for(const b of Object.keys(c)){if(b==="$name")continue;const k=c[b];m[b]=Ho[a].shallow.indexOf(b)>=0?k:wa(k)}return m}throw new Error("can't deserialize object of type "+typeof c)}class Uh{constructor(){this.first=!0}update(a,f){const m=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=f),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=m,!0))}}const Vt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function xa(c){for(const a of c)if(fu(a.charCodeAt(0)))return!0;return!1}function Vh(c){for(const a of c)if(!qh(a.charCodeAt(0)))return!1;return!0}function qh(c){return!(Vt.Arabic(c)||Vt["Arabic Supplement"](c)||Vt["Arabic Extended-A"](c)||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c))}function fu(c){return!(c!==746&&c!==747&&(c<4352||!(Vt["Bopomofo Extended"](c)||Vt.Bopomofo(c)||Vt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Vt["CJK Compatibility Ideographs"](c)||Vt["CJK Compatibility"](c)||Vt["CJK Radicals Supplement"](c)||Vt["CJK Strokes"](c)||!(!Vt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Vt["CJK Unified Ideographs Extension A"](c)||Vt["CJK Unified Ideographs"](c)||Vt["Enclosed CJK Letters and Months"](c)||Vt["Hangul Compatibility Jamo"](c)||Vt["Hangul Jamo Extended-A"](c)||Vt["Hangul Jamo Extended-B"](c)||Vt["Hangul Jamo"](c)||Vt["Hangul Syllables"](c)||Vt.Hiragana(c)||Vt["Ideographic Description Characters"](c)||Vt.Kanbun(c)||Vt["Kangxi Radicals"](c)||Vt["Katakana Phonetic Extensions"](c)||Vt.Katakana(c)&&c!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Vt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](c)||Vt["Unified Canadian Aboriginal Syllabics Extended"](c)||Vt["Vertical Forms"](c)||Vt["Yijing Hexagram Symbols"](c)||Vt["Yi Syllables"](c)||Vt["Yi Radicals"](c))))}function Lc(c){return!(fu(c)||function(a){return!!(Vt["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Vt["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Vt["Letterlike Symbols"](a)||Vt["Number Forms"](a)||Vt["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Vt["Control Pictures"](a)&&a!==9251||Vt["Optical Character Recognition"](a)||Vt["Enclosed Alphanumerics"](a)||Vt["Geometric Shapes"](a)||Vt["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Vt["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Vt["CJK Symbols and Punctuation"](a)||Vt.Katakana(a)||Vt["Private Use Area"](a)||Vt["CJK Compatibility Forms"](a)||Vt["Small Form Variants"](a)||Vt["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(c))}function hu(c){return c>=1424&&c<=2303||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c)}function Hh(c,a){return!(!a&&hu(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Vt.Khmer(c))}function Dp(c){for(const a of c)if(hu(a.charCodeAt(0)))return!0;return!1}const Ts=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Tr{constructor(a,f){this.zoom=a,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Uh,this.transition={})}isSupportedScript(a){return function(f,m){for(const b of f)if(!Hh(b.charCodeAt(0),m))return!1;return!0}(a,Ts.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,f=a-Math.floor(a),m=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*f}}}class dl{constructor(a,f){this.property=a,this.value=f,this.expression=function(m,b){if(Ql(m))return new tu(m,b);if(gr(m)){const k=Ih(m,b);if(k.result==="error")throw new Error(k.value.map(S=>`${S.key}: ${S.message}`).join(", "));return k.value}{let k=m;return b.type==="color"&&typeof m=="string"?k=ar.parse(m):b.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(k=fo.parse(m)):k=Bi.parse(m),{kind:"constant",evaluate:()=>k}}}(f===void 0?a.specification.default:f,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,f,m){return this.property.possiblyEvaluate(this,a,f,m)}}class du{constructor(a){this.property=a,this.value=new dl(a,void 0)}transitioned(a,f){return new Gh(this.property,this.value,f,q({},a.transition,this.transition),a.now)}untransitioned(){return new Gh(this.property,this.value,null,{},0)}}class Ic{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return Y(this._values[a].value.value)}setValue(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new du(this._values[a].property)),this._values[a].value=new dl(this._values[a].property,f===null?void 0:Y(f))}getTransition(a){return Y(this._values[a].transition)}setTransition(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new du(this._values[a].property)),this._values[a].transition=Y(f)||void 0}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m);const b=this.getTransition(f);b!==void 0&&(a[`${f}-transition`]=b)}return a}transitioned(a,f){const m=new Wh(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(a,f._values[b]);return m}untransitioned(){const a=new Wh(this._properties);for(const f of Object.keys(this._values))a._values[f]=this._values[f].untransitioned();return a}}class Gh{constructor(a,f,m,b,k){this.property=a,this.value=f,this.begin=k+b.delay||0,this.end=this.begin+b.duration||0,a.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(a,f,m){const b=a.now||0,k=this.value.possiblyEvaluate(a,f,m),S=this.prior;if(S){if(b>this.end)return this.prior=null,k;if(this.value.isDataDriven())return this.prior=null,k;if(b<this.begin)return S.possiblyEvaluate(a,f,m);{const M=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(a,f,m),k,function(F){if(F<=0)return 0;if(F>=1)return 1;const j=F*F,X=j*F;return 4*(F<.5?X:3*(F-j)+X-.75)}(M))}}return k}}class Wh{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,f,m){const b=new pl(this._properties);for(const k of Object.keys(this._values))b._values[k]=this._values[k].possiblyEvaluate(a,f,m);return b}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Zh{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return Y(this._values[a].value)}setValue(a,f){this._values[a]=new dl(this._values[a].property,f===null?void 0:Y(f))}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m)}return a}possiblyEvaluate(a,f,m){const b=new pl(this._properties);for(const k of Object.keys(this._values))b._values[k]=this._values[k].possiblyEvaluate(a,f,m);return b}}class So{constructor(a,f,m){this.property=a,this.value=f,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,f,m,b){return this.property.evaluate(this.value,this.parameters,a,f,m,b)}}class pl{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class ln{constructor(a){this.specification=a}possiblyEvaluate(a,f){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(f)}interpolate(a,f,m){const b=Ti[this.specification.type];return b?b(a,f,m):a}}class dn{constructor(a,f){this.specification=a,this.overrides=f}possiblyEvaluate(a,f,m,b){return new So(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(f,null,{},m,b)}:a.expression,f)}interpolate(a,f,m){if(a.value.kind!=="constant"||f.value.kind!=="constant")return a;if(a.value.value===void 0||f.value.value===void 0)return new So(this,{kind:"constant",value:void 0},a.parameters);const b=Ti[this.specification.type];if(b){const k=b(a.value.value,f.value.value,m);return new So(this,{kind:"constant",value:k},a.parameters)}return a}evaluate(a,f,m,b,k,S){return a.kind==="constant"?a.value:a.evaluate(f,m,b,k,S)}}class pu extends dn{possiblyEvaluate(a,f,m,b){if(a.value===void 0)return new So(this,{kind:"constant",value:void 0},f);if(a.expression.kind==="constant"){const k=a.expression.evaluate(f,null,{},m,b),S=a.property.specification.type==="resolvedImage"&&typeof k!="string"?k.name:k,M=this._calculate(S,S,S,f);return new So(this,{kind:"constant",value:M},f)}if(a.expression.kind==="camera"){const k=this._calculate(a.expression.evaluate({zoom:f.zoom-1}),a.expression.evaluate({zoom:f.zoom}),a.expression.evaluate({zoom:f.zoom+1}),f);return new So(this,{kind:"constant",value:k},f)}return new So(this,a.expression,f)}evaluate(a,f,m,b,k,S){if(a.kind==="source"){const M=a.evaluate(f,m,b,k,S);return this._calculate(M,M,M,f)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(f.zoom)-1},m,b),a.evaluate({zoom:Math.floor(f.zoom)},m,b),a.evaluate({zoom:Math.floor(f.zoom)+1},m,b),f):a.value}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class ml{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){if(a.value!==void 0){if(a.expression.kind==="constant"){const k=a.expression.evaluate(f,null,{},m,b);return this._calculate(k,k,k,f)}return this._calculate(a.expression.evaluate(new Tr(Math.floor(f.zoom-1),f)),a.expression.evaluate(new Tr(Math.floor(f.zoom),f)),a.expression.evaluate(new Tr(Math.floor(f.zoom+1),f)),f)}}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class Pc{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){return!!a.expression.evaluate(f,null,{},m,b)}interpolate(){return!1}}class Oi{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in a){const m=a[f];m.specification.overridable&&this.overridableProperties.push(f);const b=this.defaultPropertyValues[f]=new dl(m,void 0),k=this.defaultTransitionablePropertyValues[f]=new du(m);this.defaultTransitioningPropertyValues[f]=k.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=b.possiblyEvaluate({})}}}Zt("DataDrivenProperty",dn),Zt("DataConstantProperty",ln),Zt("CrossFadedDataDrivenProperty",pu),Zt("CrossFadedProperty",ml),Zt("ColorRampProperty",Pc);const zc="-transition";class Co extends et{constructor(a,f){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),f.layout&&(this._unevaluatedLayout=new Zh(f.layout)),f.paint)){this._transitionablePaint=new Ic(f.paint);for(const m in a.paint)this.setPaintProperty(m,a.paint[m],{validate:!1});for(const m in a.layout)this.setLayoutProperty(m,a.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pl(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,f,m={}){f!=null&&this._validate(zp,`layers.${this.id}.layout.${a}`,a,f,m)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,f):this.visibility=f)}getPaintProperty(a){return a.endsWith(zc)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,f,m={}){if(f!=null&&this._validate(Ec,`layers.${this.id}.paint.${a}`,a,f,m))return!1;if(a.endsWith(zc))return this._transitionablePaint.setTransition(a.slice(0,-11),f||void 0),!1;{const b=this._transitionablePaint._values[a],k=b.property.specification["property-type"]==="cross-faded-data-driven",S=b.value.isDataDriven(),M=b.value;this._transitionablePaint.setValue(a,f),this._handleSpecialPaintPropertyUpdate(a);const F=this._transitionablePaint._values[a].value;return F.isDataDriven()||S||k||this._handleOverridablePaintPropertyUpdate(a,M,F)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,f,m){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,f){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,f)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Ee(a,(f,m)=>!(f===void 0||m==="layout"&&!Object.keys(f).length||m==="paint"&&!Object.keys(f).length))}_validate(a,f,m,b,k={}){return(!k||k.validate!==!1)&&va(this,a.call(Gs,{key:f,layerType:this.type,objectKey:m,value:b,styleSpec:de,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const f=this.paint.get(a);if(f instanceof So&&ga(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const Xh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gl{constructor(a,f){this._structArray=a,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Fr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,f){return a._trim(),f&&(a.isTransferred=!0,f.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const f=Object.create(this.prototype);return f.arrayBuffer=a.arrayBuffer,f.length=a.length,f.capacity=a.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function qr(c,a=1){let f=0,m=0;return{members:c.map(b=>{const k=Xh[b.type].BYTES_PER_ELEMENT,S=f=Kh(f,Math.max(a,k)),M=b.components||1;return m=Math.max(m,k),f+=k*M,{name:b.name,type:b.type,components:M,offset:S}}),size:Kh(f,Math.max(m,a)),alignment:a}}function Kh(c,a){return Math.ceil(c/a)*a}class _l extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.int16[b+0]=f,this.int16[b+1]=m,a}}_l.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",_l);class as extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.int16[k+0]=f,this.int16[k+1]=m,this.int16[k+2]=b,a}}as.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",as);class Dc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=4*a;return this.int16[S+0]=f,this.int16[S+1]=m,this.int16[S+2]=b,this.int16[S+3]=k,a}}Dc.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",Dc);class Rc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const F=6*a;return this.int16[F+0]=f,this.int16[F+1]=m,this.int16[F+2]=b,this.int16[F+3]=k,this.int16[F+4]=S,this.int16[F+5]=M,a}}Rc.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",Rc);class Bc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const F=4*a,j=8*a;return this.int16[F+0]=f,this.int16[F+1]=m,this.uint8[j+4]=b,this.uint8[j+5]=k,this.uint8[j+6]=S,this.uint8[j+7]=M,a}}Bc.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",Bc);class yl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.float32[b+0]=f,this.float32[b+1]=m,a}}yl.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",yl);class mu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,j,X){const Q=this.length;return this.resize(Q+1),this.emplace(Q,a,f,m,b,k,S,M,F,j,X)}emplace(a,f,m,b,k,S,M,F,j,X,Q){const se=10*a;return this.uint16[se+0]=f,this.uint16[se+1]=m,this.uint16[se+2]=b,this.uint16[se+3]=k,this.uint16[se+4]=S,this.uint16[se+5]=M,this.uint16[se+6]=F,this.uint16[se+7]=j,this.uint16[se+8]=X,this.uint16[se+9]=Q,a}}mu.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",mu);class Fc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,j,X,Q,se){const pe=this.length;return this.resize(pe+1),this.emplace(pe,a,f,m,b,k,S,M,F,j,X,Q,se)}emplace(a,f,m,b,k,S,M,F,j,X,Q,se,pe){const _e=12*a;return this.int16[_e+0]=f,this.int16[_e+1]=m,this.int16[_e+2]=b,this.int16[_e+3]=k,this.uint16[_e+4]=S,this.uint16[_e+5]=M,this.uint16[_e+6]=F,this.uint16[_e+7]=j,this.int16[_e+8]=X,this.int16[_e+9]=Q,this.int16[_e+10]=se,this.int16[_e+11]=pe,a}}Fc.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",Fc);class Oc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.float32[k+0]=f,this.float32[k+1]=m,this.float32[k+2]=b,a}}Oc.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",Oc);class ls extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint32[1*a+0]=f,a}}ls.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",ls);class gu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,j){const X=this.length;return this.resize(X+1),this.emplace(X,a,f,m,b,k,S,M,F,j)}emplace(a,f,m,b,k,S,M,F,j,X){const Q=10*a,se=5*a;return this.int16[Q+0]=f,this.int16[Q+1]=m,this.int16[Q+2]=b,this.int16[Q+3]=k,this.int16[Q+4]=S,this.int16[Q+5]=M,this.uint32[se+3]=F,this.uint16[Q+8]=j,this.uint16[Q+9]=X,a}}gu.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",gu);class vl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S){const M=this.length;return this.resize(M+1),this.emplace(M,a,f,m,b,k,S)}emplace(a,f,m,b,k,S,M){const F=6*a;return this.int16[F+0]=f,this.int16[F+1]=m,this.int16[F+2]=b,this.int16[F+3]=k,this.int16[F+4]=S,this.int16[F+5]=M,a}}vl.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",vl);class _u extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k){const S=this.length;return this.resize(S+1),this.emplace(S,a,f,m,b,k)}emplace(a,f,m,b,k,S){const M=4*a,F=8*a;return this.float32[M+0]=f,this.float32[M+1]=m,this.float32[M+2]=b,this.int16[F+6]=k,this.int16[F+7]=S,a}}_u.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",_u);class bl extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=12*a,M=3*a;return this.uint8[S+0]=f,this.uint8[S+1]=m,this.float32[M+1]=b,this.float32[M+2]=k,a}}bl.prototype.bytesPerElement=12,Zt("StructArrayLayout2ub2f12",bl);class yu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.uint16[k+0]=f,this.uint16[k+1]=m,this.uint16[k+2]=b,a}}yu.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",yu);class Aa extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,j,X,Q,se,pe,_e,be,Ce,Pe){const We=this.length;return this.resize(We+1),this.emplace(We,a,f,m,b,k,S,M,F,j,X,Q,se,pe,_e,be,Ce,Pe)}emplace(a,f,m,b,k,S,M,F,j,X,Q,se,pe,_e,be,Ce,Pe,We){const Re=24*a,je=12*a,ht=48*a;return this.int16[Re+0]=f,this.int16[Re+1]=m,this.uint16[Re+2]=b,this.uint16[Re+3]=k,this.uint32[je+2]=S,this.uint32[je+3]=M,this.uint32[je+4]=F,this.uint16[Re+10]=j,this.uint16[Re+11]=X,this.uint16[Re+12]=Q,this.float32[je+7]=se,this.float32[je+8]=pe,this.uint8[ht+36]=_e,this.uint8[ht+37]=be,this.uint8[ht+38]=Ce,this.uint32[je+10]=Pe,this.int16[Re+22]=We,a}}Aa.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Aa);class Ws extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,k,S,M,F,j,X,Q,se,pe,_e,be,Ce,Pe,We,Re,je,ht,_t,Ht,sn,qt,jt,Bt,Xt){const Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,a,f,m,b,k,S,M,F,j,X,Q,se,pe,_e,be,Ce,Pe,We,Re,je,ht,_t,Ht,sn,qt,jt,Bt,Xt)}emplace(a,f,m,b,k,S,M,F,j,X,Q,se,pe,_e,be,Ce,Pe,We,Re,je,ht,_t,Ht,sn,qt,jt,Bt,Xt,Nt){const Pt=32*a,hn=16*a;return this.int16[Pt+0]=f,this.int16[Pt+1]=m,this.int16[Pt+2]=b,this.int16[Pt+3]=k,this.int16[Pt+4]=S,this.int16[Pt+5]=M,this.int16[Pt+6]=F,this.int16[Pt+7]=j,this.uint16[Pt+8]=X,this.uint16[Pt+9]=Q,this.uint16[Pt+10]=se,this.uint16[Pt+11]=pe,this.uint16[Pt+12]=_e,this.uint16[Pt+13]=be,this.uint16[Pt+14]=Ce,this.uint16[Pt+15]=Pe,this.uint16[Pt+16]=We,this.uint16[Pt+17]=Re,this.uint16[Pt+18]=je,this.uint16[Pt+19]=ht,this.uint16[Pt+20]=_t,this.uint16[Pt+21]=Ht,this.uint16[Pt+22]=sn,this.uint32[hn+12]=qt,this.float32[hn+13]=jt,this.float32[hn+14]=Bt,this.uint16[Pt+30]=Xt,this.uint16[Pt+31]=Nt,a}}Ws.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",Ws);class vu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.float32[1*a+0]=f,a}}vu.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",vu);class bu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=3*a;return this.uint16[6*a+0]=f,this.float32[k+1]=m,this.float32[k+2]=b,a}}bu.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",bu);class Zs extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const k=4*a;return this.uint32[2*a+0]=f,this.uint16[k+2]=m,this.uint16[k+3]=b,a}}Zs.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",Zs);class $c extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.uint16[b+0]=f,this.uint16[b+1]=m,a}}$c.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",$c);class Nc extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint16[1*a+0]=f,a}}Nc.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",Nc);class wu extends Fr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const k=this.length;return this.resize(k+1),this.emplace(k,a,f,m,b)}emplace(a,f,m,b,k){const S=4*a;return this.float32[S+0]=f,this.float32[S+1]=m,this.float32[S+2]=b,this.float32[S+3]=k,a}}wu.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",wu);class Jh extends gl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _(this.anchorPointX,this.anchorPointY)}}Jh.prototype.size=20;class w extends gu{get(a){return new Jh(this,a)}}Zt("CollisionBoxArray",w);class l extends gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class h extends Aa{get(a){return new l(this,a)}}Zt("PlacedSymbolArray",h);class y extends gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}y.prototype.size=64;class v extends Ws{get(a){return new y(this,a)}}Zt("SymbolInstanceArray",v);class A extends vu{getoffsetX(a){return this.float32[1*a+0]}}Zt("GlyphOffsetArray",A);class P extends as{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}Zt("SymbolLineVertexArray",P);class D extends gl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}D.prototype.size=12;class $ extends bu{get(a){return new D(this,a)}}Zt("TextAnchorOffsetArray",$);class Z extends gl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Z.prototype.size=8;class ee extends Zs{get(a){return new Z(this,a)}}Zt("FeatureIndexArray",ee);class te extends _l{}class me extends _l{}class Ae extends _l{}class xe extends Rc{}class Me extends Bc{}class ve extends yl{}class Be extends mu{}class tt extends Fc{}class Ie extends Oc{}class He extends ls{}class rt extends vl{}class ot extends bl{}class ut extends yu{}class kt extends $c{}const bt=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rt}=bt;class Ft{constructor(a=[]){this.segments=a}prepareSegment(a,f,m,b){let k=this.segments[this.segments.length-1];return a>Ft.MAX_VERTEX_ARRAY_LENGTH&&ke(`Max vertices per segment is ${Ft.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!k||k.vertexLength+a>Ft.MAX_VERTEX_ARRAY_LENGTH||k.sortKey!==b)&&(k={vertexOffset:f.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},b!==void 0&&(k.sortKey=b),this.segments.push(k)),k}get(){return this.segments}destroy(){for(const a of this.segments)for(const f in a.vaos)a.vaos[f].destroy()}static simpleSegment(a,f,m,b){return new Ft([{vertexOffset:a,primitiveOffset:f,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function Cn(c,a){return 256*(c=K(Math.floor(c),0,255))+K(Math.floor(a),0,255)}Ft.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",Ft);const $t=qr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var _n={exports:{}},Tn={exports:{}};Tn.exports=function(c,a){var f,m,b,k,S,M,F,j;for(m=c.length-(f=3&c.length),b=a,S=3432918353,M=461845907,j=0;j<m;)F=255&c.charCodeAt(j)|(255&c.charCodeAt(++j))<<8|(255&c.charCodeAt(++j))<<16|(255&c.charCodeAt(++j))<<24,++j,b=27492+(65535&(k=5*(65535&(b=(b^=F=(65535&(F=(F=(65535&F)*S+(((F>>>16)*S&65535)<<16)&4294967295)<<15|F>>>17))*M+(((F>>>16)*M&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(k>>>16)&65535)<<16);switch(F=0,f){case 3:F^=(255&c.charCodeAt(j+2))<<16;case 2:F^=(255&c.charCodeAt(j+1))<<8;case 1:b^=F=(65535&(F=(F=(65535&(F^=255&c.charCodeAt(j)))*S+(((F>>>16)*S&65535)<<16)&4294967295)<<15|F>>>17))*M+(((F>>>16)*M&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var Wn=Tn.exports,kn={exports:{}};kn.exports=function(c,a){for(var f,m=c.length,b=a^m,k=0;m>=4;)f=1540483477*(65535&(f=255&c.charCodeAt(k)|(255&c.charCodeAt(++k))<<8|(255&c.charCodeAt(++k))<<16|(255&c.charCodeAt(++k))<<24))+((1540483477*(f>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),m-=4,++k;switch(m){case 3:b^=(255&c.charCodeAt(k+2))<<16;case 2:b^=(255&c.charCodeAt(k+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(k)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var In=Wn,Rn=kn.exports;_n.exports=In,_n.exports.murmur3=In,_n.exports.murmur2=Rn;var Or=d(_n.exports);class ur{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,f,m,b){this.ids.push(to(a)),this.positions.push(f,m,b)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=to(a);let m=0,b=this.ids.length-1;for(;m<b;){const S=m+b>>1;this.ids[S]>=f?b=S:m=S+1}const k=[];for(;this.ids[m]===f;)k.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return k}static serialize(a,f){const m=new Float64Array(a.ids),b=new Uint32Array(a.positions);return ri(m,b,0,m.length-1),f&&f.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(a){const f=new ur;return f.ids=a.ids,f.positions=a.positions,f.indexed=!0,f}}function to(c){const a=+c;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:Or(String(c))}function ri(c,a,f,m){for(;f<m;){const b=c[f+m>>1];let k=f-1,S=m+1;for(;;){do k++;while(c[k]<b);do S--;while(c[S]>b);if(k>=S)break;Pr(c,k,S),Pr(a,3*k,3*S),Pr(a,3*k+1,3*S+1),Pr(a,3*k+2,3*S+2)}S-f<m-S?(ri(c,a,f,S),f=S+1):(ri(c,a,S+1,m),m=S)}}function Pr(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}Zt("FeaturePositionMap",ur);class ii{constructor(a,f){this.gl=a.gl,this.location=f}}class no extends ii{constructor(a,f){super(a,f),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Go extends ii{constructor(a,f){super(a,f),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class Ms extends ii{constructor(a,f){super(a,f),this.current=ar.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const wl=new Float32Array(16);function Es(c){return[Cn(255*c.r,255*c.g),Cn(255*c.b,255*c.a)]}class Wo{constructor(a,f,m){this.value=a,this.uniformNames=f.map(b=>`u_${b}`),this.type=m}setUniform(a,f,m){a.set(m.constantOr(this.value))}getBinding(a,f,m){return this.type==="color"?new Ms(a,f):new no(a,f)}}class Zr{constructor(a,f){this.uniformNames=f.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=a.tlbr}setUniform(a,f,m,b){const k=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;k&&a.set(k)}getBinding(a,f,m){return m.substr(0,9)==="u_pattern"?new Go(a,f):new no(a,f)}}class zr{constructor(a,f,m,b){this.expression=a,this.type=m,this.maxValue=0,this.paintVertexAttributes=f.map(k=>({name:`a_${k}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(a,f,m,b,k){const S=this.paintVertexArray.length,M=this.expression.evaluate(new Tr(0),f,{},b,[],k);this.paintVertexArray.resize(a),this._setPaintValue(S,a,M)}updatePaintArray(a,f,m,b){const k=this.expression.evaluate({zoom:0},m,b);this._setPaintValue(a,f,k)}_setPaintValue(a,f,m){if(this.type==="color"){const b=Es(m);for(let k=a;k<f;k++)this.paintVertexArray.emplace(k,b[0],b[1])}else{for(let b=a;b<f;b++)this.paintVertexArray.emplace(b,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Mr{constructor(a,f,m,b,k,S){this.expression=a,this.uniformNames=f.map(M=>`u_${M}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=k,this.maxValue=0,this.paintVertexAttributes=f.map(M=>({name:`a_${M}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(a,f,m,b,k){const S=this.expression.evaluate(new Tr(this.zoom),f,{},b,[],k),M=this.expression.evaluate(new Tr(this.zoom+1),f,{},b,[],k),F=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(F,a,S,M)}updatePaintArray(a,f,m,b){const k=this.expression.evaluate({zoom:this.zoom},m,b),S=this.expression.evaluate({zoom:this.zoom+1},m,b);this._setPaintValue(a,f,k,S)}_setPaintValue(a,f,m,b){if(this.type==="color"){const k=Es(m),S=Es(b);for(let M=a;M<f;M++)this.paintVertexArray.emplace(M,k[0],k[1],S[0],S[1])}else{for(let k=a;k<f;k++)this.paintVertexArray.emplace(k,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,f){const m=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,b=K(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);a.set(b)}getBinding(a,f,m){return new no(a,f)}}class po{constructor(a,f,m,b,k,S){this.expression=a,this.type=f,this.useIntegerZoom=m,this.zoom=b,this.layerId=S,this.zoomInPaintVertexArray=new k,this.zoomOutPaintVertexArray=new k}populatePaintArray(a,f,m){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(b,a,f.patterns&&f.patterns[this.layerId],m)}updatePaintArray(a,f,m,b,k){this._setPaintValues(a,f,m.patterns&&m.patterns[this.layerId],k)}_setPaintValues(a,f,m,b){if(!b||!m)return;const{min:k,mid:S,max:M}=m,F=b[k],j=b[S],X=b[M];if(F&&j&&X)for(let Q=a;Q<f;Q++)this.zoomInPaintVertexArray.emplace(Q,j.tl[0],j.tl[1],j.br[0],j.br[1],F.tl[0],F.tl[1],F.br[0],F.br[1],j.pixelRatio,F.pixelRatio),this.zoomOutPaintVertexArray.emplace(Q,j.tl[0],j.tl[1],j.br[0],j.br[1],X.tl[0],X.tl[1],X.br[0],X.br[1],j.pixelRatio,X.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,$t.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,$t.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Xr{constructor(a,f,m){this.binders={},this._buffers=[];const b=[];for(const k in a.paint._values){if(!m(k))continue;const S=a.paint.get(k);if(!(S instanceof So&&ga(S.property.specification)))continue;const M=mo(k,a.type),F=S.value,j=S.property.specification.type,X=S.property.useIntegerZoom,Q=S.property.specification["property-type"],se=Q==="cross-faded"||Q==="cross-faded-data-driven";if(F.kind==="constant")this.binders[k]=se?new Zr(F.value,M):new Wo(F.value,M,j),b.push(`/u_${k}`);else if(F.kind==="source"||se){const pe=Kr(k,j,"source");this.binders[k]=se?new po(F,j,X,f,pe,a.id):new zr(F,M,j,pe),b.push(`/a_${k}`)}else{const pe=Kr(k,j,"composite");this.binders[k]=new Mr(F,M,j,X,f,pe),b.push(`/z_${k}`)}}this.cacheKey=b.sort().join("")}getMaxValue(a){const f=this.binders[a];return f instanceof zr||f instanceof Mr?f.maxValue:0}populatePaintArrays(a,f,m,b,k){for(const S in this.binders){const M=this.binders[S];(M instanceof zr||M instanceof Mr||M instanceof po)&&M.populatePaintArray(a,f,m,b,k)}}setConstantPatternPositions(a,f){for(const m in this.binders){const b=this.binders[m];b instanceof Zr&&b.setConstantPatternPositions(a,f)}}updatePaintArrays(a,f,m,b,k){let S=!1;for(const M in a){const F=f.getPositions(M);for(const j of F){const X=m.feature(j.index);for(const Q in this.binders){const se=this.binders[Q];if((se instanceof zr||se instanceof Mr||se instanceof po)&&se.expression.isStateDependent===!0){const pe=b.paint.get(Q);se.expression=pe.value,se.updatePaintArray(j.start,j.end,X,a[M],k),S=!0}}}}return S}defines(){const a=[];for(const f in this.binders){const m=this.binders[f];(m instanceof Wo||m instanceof Zr)&&a.push(...m.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return a}getBinderAttributes(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof zr||m instanceof Mr)for(let b=0;b<m.paintVertexAttributes.length;b++)a.push(m.paintVertexAttributes[b].name);else if(m instanceof po)for(let b=0;b<$t.members.length;b++)a.push($t.members[b].name)}return a}getBinderUniforms(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Wo||m instanceof Zr||m instanceof Mr)for(const b of m.uniformNames)a.push(b)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,f){const m=[];for(const b in this.binders){const k=this.binders[b];if(k instanceof Wo||k instanceof Zr||k instanceof Mr){for(const S of k.uniformNames)if(f[S]){const M=k.getBinding(a,f[S],S);m.push({name:S,property:b,binding:M})}}}return m}setUniforms(a,f,m,b){for(const{name:k,property:S,binding:M}of f)this.binders[S].setUniform(M,b,m.get(S),k)}updatePaintBuffers(a){this._buffers=[];for(const f in this.binders){const m=this.binders[f];if(a&&m instanceof po){const b=a.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(m instanceof zr||m instanceof Mr)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(a){for(const f in this.binders){const m=this.binders[f];(m instanceof zr||m instanceof Mr||m instanceof po)&&m.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const f=this.binders[a];(f instanceof zr||f instanceof Mr||f instanceof po)&&f.destroy()}}}class Dr{constructor(a,f,m=()=>!0){this.programConfigurations={};for(const b of a)this.programConfigurations[b.id]=new Xr(b,f,m);this.needsUpload=!1,this._featureMap=new ur,this._bufferOffset=0}populatePaintArrays(a,f,m,b,k,S){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(a,f,b,k,S);f.id!==void 0&&this._featureMap.add(f.id,m,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,f,m,b){for(const k of m)this.needsUpload=this.programConfigurations[k.id].updatePaintArrays(a,this._featureMap,f,k,b)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function mo(c,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${a}-`,"").replace(/-/g,"_")]}function Kr(c,a,f){const m={color:{source:yl,composite:wu},number:{source:vu,composite:yl}},b=function(k){return{"line-pattern":{source:Be,composite:Be},"fill-pattern":{source:Be,composite:Be},"fill-extrusion-pattern":{source:Be,composite:Be}}[k]}(c);return b&&b[f]||m[a][f]}Zt("ConstantBinder",Wo),Zt("CrossFadedConstantBinder",Zr),Zt("SourceExpressionBinder",zr),Zt("CrossFadedCompositeBinder",po),Zt("CompositeExpressionBinder",Mr),Zt("ProgramConfiguration",Xr,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",Dr);const jr=8192,jc=Math.pow(2,14)-1,Yh=-jc-1;function Xs(c){const a=jr/c.extent,f=c.loadGeometry();for(let m=0;m<f.length;m++){const b=f[m];for(let k=0;k<b.length;k++){const S=b[k],M=Math.round(S.x*a),F=Math.round(S.y*a);S.x=K(M,Yh,jc),S.y=K(F,Yh,jc),(M<S.x||M>S.x+1||F<S.y||F>S.y+1)&&ke("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function Ks(c,a){return{type:c.type,id:c.id,properties:c.properties,geometry:a?Xs(c):[]}}function xu(c,a,f,m,b){c.emplaceBack(2*a+(m+1)/2,2*f+(b+1)/2)}class Ls{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new me,this.indexArray=new ut,this.segments=new Ft,this.programConfigurations=new Dr(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){const b=this.layers[0],k=[];let S=null,M=!1;b.type==="circle"&&(S=b.layout.get("circle-sort-key"),M=!S.isConstant());for(const{feature:F,id:j,index:X,sourceLayerIndex:Q}of a){const se=this.layers[0]._featureFilter.needGeometry,pe=Ks(F,se);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),pe,m))continue;const _e=M?S.evaluate(pe,{},m):void 0,be={id:j,properties:F.properties,type:F.type,sourceLayerIndex:Q,index:X,geometry:se?pe.geometry:Xs(F),patterns:{},sortKey:_e};k.push(be)}M&&k.sort((F,j)=>F.sortKey-j.sortKey);for(const F of k){const{geometry:j,index:X,sourceLayerIndex:Q}=F,se=a[X].feature;this.addFeature(F,j,X,m),f.featureIndex.insert(se,j,X,Q,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Rt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,f,m,b){for(const k of f)for(const S of k){const M=S.x,F=S.y;if(M<0||M>=jr||F<0||F>=jr)continue;const j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),X=j.vertexLength;xu(this.layoutVertexArray,M,F,-1,-1),xu(this.layoutVertexArray,M,F,1,-1),xu(this.layoutVertexArray,M,F,1,1),xu(this.layoutVertexArray,M,F,-1,1),this.indexArray.emplaceBack(X,X+1,X+2),this.indexArray.emplaceBack(X,X+3,X+2),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{},b)}}function Uc(c,a){for(let f=0;f<c.length;f++)if(ku(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(ku(c,a[f]))return!0;return!!Au(c,a)}function Qh(c,a,f){return!!ku(c,a)||!!Rp(a,c,f)}function Vc(c,a){if(c.length===1)return d_(a,c[0]);for(let f=0;f<a.length;f++){const m=a[f];for(let b=0;b<m.length;b++)if(ku(c,m[b]))return!0}for(let f=0;f<c.length;f++)if(d_(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(Au(c,a[f]))return!0;return!1}function qc(c,a,f){if(c.length>1){if(Au(c,a))return!0;for(let m=0;m<a.length;m++)if(Rp(a[m],c,f))return!0}for(let m=0;m<c.length;m++)if(Rp(c[m],a,f))return!0;return!1}function Au(c,a){if(c.length===0||a.length===0)return!1;for(let f=0;f<c.length-1;f++){const m=c[f],b=c[f+1];for(let k=0;k<a.length-1;k++)if(Hc(m,b,a[k],a[k+1]))return!0}return!1}function Hc(c,a,f,m){return ye(c,f,m)!==ye(a,f,m)&&ye(c,a,f)!==ye(c,a,m)}function Rp(c,a,f){const m=f*f;if(a.length===1)return c.distSqr(a[0])<m;for(let b=1;b<a.length;b++)if(h_(c,a[b-1],a[b])<m)return!0;return!1}function h_(c,a,f){const m=a.distSqr(f);if(m===0)return c.distSqr(a);const b=((c.x-a.x)*(f.x-a.x)+(c.y-a.y)*(f.y-a.y))/m;return c.distSqr(b<0?a:b>1?f:f.sub(a)._mult(b)._add(a))}function d_(c,a){let f,m,b,k=!1;for(let S=0;S<c.length;S++){f=c[S];for(let M=0,F=f.length-1;M<f.length;F=M++)m=f[M],b=f[F],m.y>a.y!=b.y>a.y&&a.x<(b.x-m.x)*(a.y-m.y)/(b.y-m.y)+m.x&&(k=!k)}return k}function ku(c,a){let f=!1;for(let m=0,b=c.length-1;m<c.length;b=m++){const k=c[m],S=c[b];k.y>a.y!=S.y>a.y&&a.x<(S.x-k.x)*(a.y-k.y)/(S.y-k.y)+k.x&&(f=!f)}return f}function ox(c,a,f){const m=f[0],b=f[2];if(c.x<m.x&&a.x<m.x||c.x>b.x&&a.x>b.x||c.y<m.y&&a.y<m.y||c.y>b.y&&a.y>b.y)return!1;const k=ye(c,a,f[0]);return k!==ye(c,a,f[1])||k!==ye(c,a,f[2])||k!==ye(c,a,f[3])}function Gc(c,a,f){const m=a.paint.get(c).value;return m.kind==="constant"?m.value:f.programConfigurations.get(a.id).getMaxValue(c)}function ed(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function td(c,a,f,m,b){if(!a[0]&&!a[1])return c;const k=_.convert(a)._mult(b);f==="viewport"&&k._rotate(-m);const S=[];for(let M=0;M<c.length;M++)S.push(c[M].sub(k));return S}let p_,m_;Zt("CircleBucket",Ls,{omit:["layers"]});var sx={get paint(){return m_=m_||new Oi({"circle-radius":new dn(de.paint_circle["circle-radius"]),"circle-color":new dn(de.paint_circle["circle-color"]),"circle-blur":new dn(de.paint_circle["circle-blur"]),"circle-opacity":new dn(de.paint_circle["circle-opacity"]),"circle-translate":new ln(de.paint_circle["circle-translate"]),"circle-translate-anchor":new ln(de.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ln(de.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ln(de.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new dn(de.paint_circle["circle-stroke-width"]),"circle-stroke-color":new dn(de.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new dn(de.paint_circle["circle-stroke-opacity"])})},get layout(){return p_=p_||new Oi({"circle-sort-key":new dn(de.layout_circle["circle-sort-key"])})}},$i=1e-6,Su=typeof Float32Array<"u"?Float32Array:Array;function Bp(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function g_(c,a,f){var m=a[0],b=a[1],k=a[2],S=a[3],M=a[4],F=a[5],j=a[6],X=a[7],Q=a[8],se=a[9],pe=a[10],_e=a[11],be=a[12],Ce=a[13],Pe=a[14],We=a[15],Re=f[0],je=f[1],ht=f[2],_t=f[3];return c[0]=Re*m+je*M+ht*Q+_t*be,c[1]=Re*b+je*F+ht*se+_t*Ce,c[2]=Re*k+je*j+ht*pe+_t*Pe,c[3]=Re*S+je*X+ht*_e+_t*We,c[4]=(Re=f[4])*m+(je=f[5])*M+(ht=f[6])*Q+(_t=f[7])*be,c[5]=Re*b+je*F+ht*se+_t*Ce,c[6]=Re*k+je*j+ht*pe+_t*Pe,c[7]=Re*S+je*X+ht*_e+_t*We,c[8]=(Re=f[8])*m+(je=f[9])*M+(ht=f[10])*Q+(_t=f[11])*be,c[9]=Re*b+je*F+ht*se+_t*Ce,c[10]=Re*k+je*j+ht*pe+_t*Pe,c[11]=Re*S+je*X+ht*_e+_t*We,c[12]=(Re=f[12])*m+(je=f[13])*M+(ht=f[14])*Q+(_t=f[15])*be,c[13]=Re*b+je*F+ht*se+_t*Ce,c[14]=Re*k+je*j+ht*pe+_t*Pe,c[15]=Re*S+je*X+ht*_e+_t*We,c}Math.hypot||(Math.hypot=function(){for(var c=0,a=arguments.length;a--;)c+=arguments[a]*arguments[a];return Math.sqrt(c)});var Wc,ax=g_;function nd(c,a,f){var m=a[0],b=a[1],k=a[2],S=a[3];return c[0]=f[0]*m+f[4]*b+f[8]*k+f[12]*S,c[1]=f[1]*m+f[5]*b+f[9]*k+f[13]*S,c[2]=f[2]*m+f[6]*b+f[10]*k+f[14]*S,c[3]=f[3]*m+f[7]*b+f[11]*k+f[15]*S,c}Wc=new Su(4),Su!=Float32Array&&(Wc[0]=0,Wc[1]=0,Wc[2]=0,Wc[3]=0);class lx extends Co{constructor(a){super(a,sx)}createBucket(a){return new Ls(a)}queryRadius(a){const f=a;return Gc("circle-radius",this,f)+Gc("circle-stroke-width",this,f)+ed(this.paint.get("circle-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M,F){const j=td(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),S.angle,M),X=this.paint.get("circle-radius").evaluate(f,m)+this.paint.get("circle-stroke-width").evaluate(f,m),Q=this.paint.get("circle-pitch-alignment")==="map",se=Q?j:function(_e,be){return _e.map(Ce=>__(Ce,be))}(j,F),pe=Q?X*M:X;for(const _e of b)for(const be of _e){const Ce=Q?be:__(be,F);let Pe=pe;const We=nd([],[be.x,be.y,0,1],F);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=We[3]/S.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=S.cameraToCenterDistance/We[3]),Qh(se,Ce,Pe))return!0}return!1}}function __(c,a){const f=nd([],[c.x,c.y,0,1],a);return new _(f[0]/f[3],f[1]/f[3])}class y_ extends Ls{}let v_;Zt("HeatmapBucket",y_,{omit:["layers"]});var ux={get paint(){return v_=v_||new Oi({"heatmap-radius":new dn(de.paint_heatmap["heatmap-radius"]),"heatmap-weight":new dn(de.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ln(de.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pc(de.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ln(de.paint_heatmap["heatmap-opacity"])})}};function Fp(c,{width:a,height:f},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==a*f*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${a*f*m}`)}else b=new Uint8Array(a*f*m);return c.width=a,c.height=f,c.data=b,c}function b_(c,{width:a,height:f},m){if(a===c.width&&f===c.height)return;const b=Fp({},{width:a,height:f},m);Op(c,b,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,a),height:Math.min(c.height,f)},m),c.width=a,c.height=f,c.data=b.data}function Op(c,a,f,m,b,k){if(b.width===0||b.height===0)return a;if(b.width>c.width||b.height>c.height||f.x>c.width-b.width||f.y>c.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>a.width||b.height>a.height||m.x>a.width-b.width||m.y>a.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const S=c.data,M=a.data;if(S===M)throw new Error("srcData equals dstData, so image is already copied");for(let F=0;F<b.height;F++){const j=((f.y+F)*c.width+f.x)*k,X=((m.y+F)*a.width+m.x)*k;for(let Q=0;Q<b.width*k;Q++)M[X+Q]=S[j+Q]}return a}class Zc{constructor(a,f){Fp(this,a,1,f)}resize(a){b_(this,a,1)}clone(){return new Zc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,k){Op(a,f,m,b,k,1)}}class To{constructor(a,f){Fp(this,a,4,f)}resize(a){b_(this,a,4)}replace(a,f){f?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new To({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,k){Op(a,f,m,b,k,4)}}function w_(c){const a={},f=c.resolution||256,m=c.clips?c.clips.length:1,b=c.image||new To({width:f,height:m});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const k=(S,M,F)=>{a[c.evaluationKey]=F;const j=c.expression.evaluate(a);b.data[S+M+0]=Math.floor(255*j.r/j.a),b.data[S+M+1]=Math.floor(255*j.g/j.a),b.data[S+M+2]=Math.floor(255*j.b/j.a),b.data[S+M+3]=Math.floor(255*j.a)};if(c.clips)for(let S=0,M=0;S<m;++S,M+=4*f)for(let F=0,j=0;F<f;F++,j+=4){const X=F/(f-1),{start:Q,end:se}=c.clips[S];k(M,j,Q*(1-X)+se*X)}else for(let S=0,M=0;S<f;S++,M+=4)k(0,M,S/(f-1));return b}Zt("AlphaImage",Zc),Zt("RGBAImage",To);class cx extends Co{createBucket(a){return new y_(a)}constructor(a){super(a,ux),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=w_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let x_;var fx={get paint(){return x_=x_||new Oi({"hillshade-illumination-direction":new ln(de.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ln(de.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ln(de.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ln(de.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ln(de.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ln(de.paint_hillshade["hillshade-accent-color"])})}};class hx extends Co{constructor(a){super(a,fx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const dx=qr([{name:"a_pos",components:2,type:"Int16"}],4),{members:px}=dx;var $p={exports:{}};function rd(c,a,f){f=f||2;var m,b,k,S,M,F,j,X=a&&a.length,Q=X?a[0]*f:c.length,se=A_(c,0,Q,f,!0),pe=[];if(!se||se.next===se.prev)return pe;if(X&&(se=function(be,Ce,Pe,We){var Re,je,ht,_t=[];for(Re=0,je=Ce.length;Re<je;Re++)(ht=A_(be,Ce[Re]*We,Re<je-1?Ce[Re+1]*We:be.length,We,!1))===ht.next&&(ht.steiner=!0),_t.push(xx(ht));for(_t.sort(vx),Re=0;Re<_t.length;Re++)Pe=bx(_t[Re],Pe);return Pe}(c,a,se,f)),c.length>80*f){m=k=c[0],b=S=c[1];for(var _e=f;_e<Q;_e+=f)(M=c[_e])<m&&(m=M),(F=c[_e+1])<b&&(b=F),M>k&&(k=M),F>S&&(S=F);j=(j=Math.max(k-m,S-b))!==0?32767/j:0}return Xc(se,pe,f,m,b,j,0),pe}function A_(c,a,f,m,b){var k,S;if(b===Up(c,a,f,m)>0)for(k=a;k<f;k+=m)S=C_(k,c[k],c[k+1],S);else for(k=f-m;k>=a;k-=m)S=C_(k,c[k],c[k+1],S);return S&&id(S,S.next)&&(Jc(S),S=S.next),S}function xl(c,a){if(!c)return c;a||(a=c);var f,m=c;do if(f=!1,m.steiner||!id(m,m.next)&&Hr(m.prev,m,m.next)!==0)m=m.next;else{if(Jc(m),(m=a=m.prev)===m.next)break;f=!0}while(f||m!==a);return a}function Xc(c,a,f,m,b,k,S){if(c){!S&&k&&function(X,Q,se,pe){var _e=X;do _e.z===0&&(_e.z=Np(_e.x,_e.y,Q,se,pe)),_e.prevZ=_e.prev,_e.nextZ=_e.next,_e=_e.next;while(_e!==X);_e.prevZ.nextZ=null,_e.prevZ=null,function(be){var Ce,Pe,We,Re,je,ht,_t,Ht,sn=1;do{for(Pe=be,be=null,je=null,ht=0;Pe;){for(ht++,We=Pe,_t=0,Ce=0;Ce<sn&&(_t++,We=We.nextZ);Ce++);for(Ht=sn;_t>0||Ht>0&&We;)_t!==0&&(Ht===0||!We||Pe.z<=We.z)?(Re=Pe,Pe=Pe.nextZ,_t--):(Re=We,We=We.nextZ,Ht--),je?je.nextZ=Re:be=Re,Re.prevZ=je,je=Re;Pe=We}je.nextZ=null,sn*=2}while(ht>1)}(_e)}(c,m,b,k);for(var M,F,j=c;c.prev!==c.next;)if(M=c.prev,F=c.next,k?gx(c,m,b,k):mx(c))a.push(M.i/f|0),a.push(c.i/f|0),a.push(F.i/f|0),Jc(c),c=F.next,j=F.next;else if((c=F)===j){S?S===1?Xc(c=_x(xl(c),a,f),a,f,m,b,k,2):S===2&&yx(c,a,f,m,b,k):Xc(xl(c),a,f,m,b,k,1);break}}}function mx(c){var a=c.prev,f=c,m=c.next;if(Hr(a,f,m)>=0)return!1;for(var b=a.x,k=f.x,S=m.x,M=a.y,F=f.y,j=m.y,X=b<k?b<S?b:S:k<S?k:S,Q=M<F?M<j?M:j:F<j?F:j,se=b>k?b>S?b:S:k>S?k:S,pe=M>F?M>j?M:j:F>j?F:j,_e=m.next;_e!==a;){if(_e.x>=X&&_e.x<=se&&_e.y>=Q&&_e.y<=pe&&Cu(b,M,k,F,S,j,_e.x,_e.y)&&Hr(_e.prev,_e,_e.next)>=0)return!1;_e=_e.next}return!0}function gx(c,a,f,m){var b=c.prev,k=c,S=c.next;if(Hr(b,k,S)>=0)return!1;for(var M=b.x,F=k.x,j=S.x,X=b.y,Q=k.y,se=S.y,pe=M<F?M<j?M:j:F<j?F:j,_e=X<Q?X<se?X:se:Q<se?Q:se,be=M>F?M>j?M:j:F>j?F:j,Ce=X>Q?X>se?X:se:Q>se?Q:se,Pe=Np(pe,_e,a,f,m),We=Np(be,Ce,a,f,m),Re=c.prevZ,je=c.nextZ;Re&&Re.z>=Pe&&je&&je.z<=We;){if(Re.x>=pe&&Re.x<=be&&Re.y>=_e&&Re.y<=Ce&&Re!==b&&Re!==S&&Cu(M,X,F,Q,j,se,Re.x,Re.y)&&Hr(Re.prev,Re,Re.next)>=0||(Re=Re.prevZ,je.x>=pe&&je.x<=be&&je.y>=_e&&je.y<=Ce&&je!==b&&je!==S&&Cu(M,X,F,Q,j,se,je.x,je.y)&&Hr(je.prev,je,je.next)>=0))return!1;je=je.nextZ}for(;Re&&Re.z>=Pe;){if(Re.x>=pe&&Re.x<=be&&Re.y>=_e&&Re.y<=Ce&&Re!==b&&Re!==S&&Cu(M,X,F,Q,j,se,Re.x,Re.y)&&Hr(Re.prev,Re,Re.next)>=0)return!1;Re=Re.prevZ}for(;je&&je.z<=We;){if(je.x>=pe&&je.x<=be&&je.y>=_e&&je.y<=Ce&&je!==b&&je!==S&&Cu(M,X,F,Q,j,se,je.x,je.y)&&Hr(je.prev,je,je.next)>=0)return!1;je=je.nextZ}return!0}function _x(c,a,f){var m=c;do{var b=m.prev,k=m.next.next;!id(b,k)&&k_(b,m,m.next,k)&&Kc(b,k)&&Kc(k,b)&&(a.push(b.i/f|0),a.push(m.i/f|0),a.push(k.i/f|0),Jc(m),Jc(m.next),m=c=k),m=m.next}while(m!==c);return xl(m)}function yx(c,a,f,m,b,k){var S=c;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&Ax(S,M)){var F=S_(S,M);return S=xl(S,S.next),F=xl(F,F.next),Xc(S,a,f,m,b,k,0),void Xc(F,a,f,m,b,k,0)}M=M.next}S=S.next}while(S!==c)}function vx(c,a){return c.x-a.x}function bx(c,a){var f=function(b,k){var S,M=k,F=b.x,j=b.y,X=-1/0;do{if(j<=M.y&&j>=M.next.y&&M.next.y!==M.y){var Q=M.x+(j-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(Q<=F&&Q>X&&(X=Q,S=M.x<M.next.x?M:M.next,Q===F))return S}M=M.next}while(M!==k);if(!S)return null;var se,pe=S,_e=S.x,be=S.y,Ce=1/0;M=S;do F>=M.x&&M.x>=_e&&F!==M.x&&Cu(j<be?F:X,j,_e,be,j<be?X:F,j,M.x,M.y)&&(se=Math.abs(j-M.y)/(F-M.x),Kc(M,b)&&(se<Ce||se===Ce&&(M.x>S.x||M.x===S.x&&wx(S,M)))&&(S=M,Ce=se)),M=M.next;while(M!==pe);return S}(c,a);if(!f)return a;var m=S_(f,c);return xl(m,m.next),xl(f,f.next)}function wx(c,a){return Hr(c.prev,c,a.prev)<0&&Hr(a.next,c,c.next)<0}function Np(c,a,f,m,b){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-f)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-m)*b|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function xx(c){var a=c,f=c;do(a.x<f.x||a.x===f.x&&a.y<f.y)&&(f=a),a=a.next;while(a!==c);return f}function Cu(c,a,f,m,b,k,S,M){return(b-S)*(a-M)>=(c-S)*(k-M)&&(c-S)*(m-M)>=(f-S)*(a-M)&&(f-S)*(k-M)>=(b-S)*(m-M)}function Ax(c,a){return c.next.i!==a.i&&c.prev.i!==a.i&&!function(f,m){var b=f;do{if(b.i!==f.i&&b.next.i!==f.i&&b.i!==m.i&&b.next.i!==m.i&&k_(b,b.next,f,m))return!0;b=b.next}while(b!==f);return!1}(c,a)&&(Kc(c,a)&&Kc(a,c)&&function(f,m){var b=f,k=!1,S=(f.x+m.x)/2,M=(f.y+m.y)/2;do b.y>M!=b.next.y>M&&b.next.y!==b.y&&S<(b.next.x-b.x)*(M-b.y)/(b.next.y-b.y)+b.x&&(k=!k),b=b.next;while(b!==f);return k}(c,a)&&(Hr(c.prev,c,a.prev)||Hr(c,a.prev,a))||id(c,a)&&Hr(c.prev,c,c.next)>0&&Hr(a.prev,a,a.next)>0)}function Hr(c,a,f){return(a.y-c.y)*(f.x-a.x)-(a.x-c.x)*(f.y-a.y)}function id(c,a){return c.x===a.x&&c.y===a.y}function k_(c,a,f,m){var b=sd(Hr(c,a,f)),k=sd(Hr(c,a,m)),S=sd(Hr(f,m,c)),M=sd(Hr(f,m,a));return b!==k&&S!==M||!(b!==0||!od(c,f,a))||!(k!==0||!od(c,m,a))||!(S!==0||!od(f,c,m))||!(M!==0||!od(f,a,m))}function od(c,a,f){return a.x<=Math.max(c.x,f.x)&&a.x>=Math.min(c.x,f.x)&&a.y<=Math.max(c.y,f.y)&&a.y>=Math.min(c.y,f.y)}function sd(c){return c>0?1:c<0?-1:0}function Kc(c,a){return Hr(c.prev,c,c.next)<0?Hr(c,a,c.next)>=0&&Hr(c,c.prev,a)>=0:Hr(c,a,c.prev)<0||Hr(c,c.next,a)<0}function S_(c,a){var f=new jp(c.i,c.x,c.y),m=new jp(a.i,a.x,a.y),b=c.next,k=a.prev;return c.next=a,a.prev=c,f.next=b,b.prev=f,m.next=f,f.prev=m,k.next=m,m.prev=k,m}function C_(c,a,f,m){var b=new jp(c,a,f);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function Jc(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function jp(c,a,f){this.i=c,this.x=a,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Up(c,a,f,m){for(var b=0,k=a,S=f-m;k<f;k+=m)b+=(c[S]-c[k])*(c[k+1]+c[S+1]),S=k;return b}$p.exports=rd,$p.exports.default=rd,rd.deviation=function(c,a,f,m){var b=a&&a.length,k=Math.abs(Up(c,0,b?a[0]*f:c.length,f));if(b)for(var S=0,M=a.length;S<M;S++)k-=Math.abs(Up(c,a[S]*f,S<M-1?a[S+1]*f:c.length,f));var F=0;for(S=0;S<m.length;S+=3){var j=m[S]*f,X=m[S+1]*f,Q=m[S+2]*f;F+=Math.abs((c[j]-c[Q])*(c[X+1]-c[j+1])-(c[j]-c[X])*(c[Q+1]-c[j+1]))}return k===0&&F===0?0:Math.abs((F-k)/k)},rd.flatten=function(c){for(var a=c[0][0].length,f={vertices:[],holes:[],dimensions:a},m=0,b=0;b<c.length;b++){for(var k=0;k<c[b].length;k++)for(var S=0;S<a;S++)f.vertices.push(c[b][k][S]);b>0&&f.holes.push(m+=c[b-1].length)}return f};var T_=d($p.exports);function kx(c,a,f,m,b){M_(c,a,f||0,m||c.length-1,b||Sx)}function M_(c,a,f,m,b){for(;m>f;){if(m-f>600){var k=m-f+1,S=a-f+1,M=Math.log(k),F=.5*Math.exp(2*M/3),j=.5*Math.sqrt(M*F*(k-F)/k)*(S-k/2<0?-1:1);M_(c,a,Math.max(f,Math.floor(a-S*F/k+j)),Math.min(m,Math.floor(a+(k-S)*F/k+j)),b)}var X=c[a],Q=f,se=m;for(Yc(c,f,a),b(c[m],X)>0&&Yc(c,f,m);Q<se;){for(Yc(c,Q,se),Q++,se--;b(c[Q],X)<0;)Q++;for(;b(c[se],X)>0;)se--}b(c[f],X)===0?Yc(c,f,se):Yc(c,++se,m),se<=a&&(f=se+1),a<=se&&(m=se-1)}}function Yc(c,a,f){var m=c[a];c[a]=c[f],c[f]=m}function Sx(c,a){return c<a?-1:c>a?1:0}function Vp(c,a){const f=c.length;if(f<=1)return[c];const m=[];let b,k;for(let S=0;S<f;S++){const M=Ne(c[S]);M!==0&&(c[S].area=Math.abs(M),k===void 0&&(k=M<0),k===M<0?(b&&m.push(b),b=[c[S]]):b.push(c[S]))}if(b&&m.push(b),a>1)for(let S=0;S<m.length;S++)m[S].length<=a||(kx(m[S],a,1,m[S].length-1,Cx),m[S]=m[S].slice(0,a));return m}function Cx(c,a){return a.area-c.area}function qp(c,a,f){const m=f.patternDependencies;let b=!1;for(const k of a){const S=k.paint.get(`${c}-pattern`);S.isConstant()||(b=!0);const M=S.constantOr(null);M&&(b=!0,m[M.to]=!0,m[M.from]=!0)}return b}function Hp(c,a,f,m,b){const k=b.patternDependencies;for(const S of a){const M=S.paint.get(`${c}-pattern`).value;if(M.kind!=="constant"){let F=M.evaluate({zoom:m-1},f,{},b.availableImages),j=M.evaluate({zoom:m},f,{},b.availableImages),X=M.evaluate({zoom:m+1},f,{},b.availableImages);F=F&&F.name?F.name:F,j=j&&j.name?j.name:j,X=X&&X.name?X.name:X,k[F]=!0,k[j]=!0,k[X]=!0,f.patterns[S.id]={min:F,mid:j,max:X}}}return f}class Gp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ae,this.indexArray=new ut,this.indexArray2=new kt,this.programConfigurations=new Dr(a.layers,a.zoom),this.segments=new Ft,this.segments2=new Ft,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=qp("fill",this.layers,f);const b=this.layers[0].layout.get("fill-sort-key"),k=!b.isConstant(),S=[];for(const{feature:M,id:F,index:j,sourceLayerIndex:X}of a){const Q=this.layers[0]._featureFilter.needGeometry,se=Ks(M,Q);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),se,m))continue;const pe=k?b.evaluate(se,{},m,f.availableImages):void 0,_e={id:F,properties:M.properties,type:M.type,sourceLayerIndex:X,index:j,geometry:Q?se.geometry:Xs(M),patterns:{},sortKey:pe};S.push(_e)}k&&S.sort((M,F)=>M.sortKey-F.sortKey);for(const M of S){const{geometry:F,index:j,sourceLayerIndex:X}=M;if(this.hasPattern){const Q=Hp("fill",this.layers,M,this.zoom,f);this.patternFeatures.push(Q)}else this.addFeature(M,F,j,m,{});f.featureIndex.insert(a[j].feature,F,j,X,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,px),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,f,m,b,k){for(const S of Vp(f,500)){let M=0;for(const pe of S)M+=pe.length;const F=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),j=F.vertexLength,X=[],Q=[];for(const pe of S){if(pe.length===0)continue;pe!==S[0]&&Q.push(X.length/2);const _e=this.segments2.prepareSegment(pe.length,this.layoutVertexArray,this.indexArray2),be=_e.vertexLength;this.layoutVertexArray.emplaceBack(pe[0].x,pe[0].y),this.indexArray2.emplaceBack(be+pe.length-1,be),X.push(pe[0].x),X.push(pe[0].y);for(let Ce=1;Ce<pe.length;Ce++)this.layoutVertexArray.emplaceBack(pe[Ce].x,pe[Ce].y),this.indexArray2.emplaceBack(be+Ce-1,be+Ce),X.push(pe[Ce].x),X.push(pe[Ce].y);_e.vertexLength+=pe.length,_e.primitiveLength+=pe.length}const se=T_(X,Q);for(let pe=0;pe<se.length;pe+=3)this.indexArray.emplaceBack(j+se[pe],j+se[pe+1],j+se[pe+2]);F.vertexLength+=M,F.primitiveLength+=se.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}}let E_,L_;Zt("FillBucket",Gp,{omit:["layers","patternFeatures"]});var Tx={get paint(){return L_=L_||new Oi({"fill-antialias":new ln(de.paint_fill["fill-antialias"]),"fill-opacity":new dn(de.paint_fill["fill-opacity"]),"fill-color":new dn(de.paint_fill["fill-color"]),"fill-outline-color":new dn(de.paint_fill["fill-outline-color"]),"fill-translate":new ln(de.paint_fill["fill-translate"]),"fill-translate-anchor":new ln(de.paint_fill["fill-translate-anchor"]),"fill-pattern":new pu(de.paint_fill["fill-pattern"])})},get layout(){return E_=E_||new Oi({"fill-sort-key":new dn(de.layout_fill["fill-sort-key"])})}};class Mx extends Co{constructor(a){super(a,Tx)}recalculate(a,f){super.recalculate(a,f);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Gp(a)}queryRadius(){return ed(this.paint.get("fill-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M){return Vc(td(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),S.angle,M),b)}isTileClipped(){return!0}}const Ex=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Lx=qr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ix}=Ex;var ka={},Px=p,I_=Tu;function Tu(c,a,f,m,b){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=b,c.readFields(zx,this,a)}function zx(c,a,f){c==1?a.id=f.readVarint():c==2?function(m,b){for(var k=m.readVarint()+m.pos;m.pos<k;){var S=b._keys[m.readVarint()],M=b._values[m.readVarint()];b.properties[S]=M}}(f,a):c==3?a.type=f.readVarint():c==4&&(a._geometry=f.pos)}function Dx(c){for(var a,f,m=0,b=0,k=c.length,S=k-1;b<k;S=b++)m+=((f=c[S]).x-(a=c[b]).x)*(a.y+f.y);return m}Tu.types=["Unknown","Point","LineString","Polygon"],Tu.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var a,f=c.readVarint()+c.pos,m=1,b=0,k=0,S=0,M=[];c.pos<f;){if(b<=0){var F=c.readVarint();m=7&F,b=F>>3}if(b--,m===1||m===2)k+=c.readSVarint(),S+=c.readSVarint(),m===1&&(a&&M.push(a),a=[]),a.push(new Px(k,S));else{if(m!==7)throw new Error("unknown command "+m);a&&a.push(a[0].clone())}}return a&&M.push(a),M},Tu.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var a=c.readVarint()+c.pos,f=1,m=0,b=0,k=0,S=1/0,M=-1/0,F=1/0,j=-1/0;c.pos<a;){if(m<=0){var X=c.readVarint();f=7&X,m=X>>3}if(m--,f===1||f===2)(b+=c.readSVarint())<S&&(S=b),b>M&&(M=b),(k+=c.readSVarint())<F&&(F=k),k>j&&(j=k);else if(f!==7)throw new Error("unknown command "+f)}return[S,F,M,j]},Tu.prototype.toGeoJSON=function(c,a,f){var m,b,k=this.extent*Math.pow(2,f),S=this.extent*c,M=this.extent*a,F=this.loadGeometry(),j=Tu.types[this.type];function X(pe){for(var _e=0;_e<pe.length;_e++){var be=pe[_e];pe[_e]=[360*(be.x+S)/k-180,360/Math.PI*Math.atan(Math.exp((180-360*(be.y+M)/k)*Math.PI/180))-90]}}switch(this.type){case 1:var Q=[];for(m=0;m<F.length;m++)Q[m]=F[m][0];X(F=Q);break;case 2:for(m=0;m<F.length;m++)X(F[m]);break;case 3:for(F=function(pe){var _e=pe.length;if(_e<=1)return[pe];for(var be,Ce,Pe=[],We=0;We<_e;We++){var Re=Dx(pe[We]);Re!==0&&(Ce===void 0&&(Ce=Re<0),Ce===Re<0?(be&&Pe.push(be),be=[pe[We]]):be.push(pe[We]))}return be&&Pe.push(be),Pe}(F),m=0;m<F.length;m++)for(b=0;b<F[m].length;b++)X(F[m][b])}F.length===1?F=F[0]:j="Multi"+j;var se={type:"Feature",geometry:{type:j,coordinates:F},properties:this.properties};return"id"in this&&(se.id=this.id),se};var Rx=I_,P_=z_;function z_(c,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Bx,this,a),this.length=this._features.length}function Bx(c,a,f){c===15?a.version=f.readVarint():c===1?a.name=f.readString():c===5?a.extent=f.readVarint():c===2?a._features.push(f.pos):c===3?a._keys.push(f.readString()):c===4&&a._values.push(function(m){for(var b=null,k=m.readVarint()+m.pos;m.pos<k;){var S=m.readVarint()>>3;b=S===1?m.readString():S===2?m.readFloat():S===3?m.readDouble():S===4?m.readVarint64():S===5?m.readVarint():S===6?m.readSVarint():S===7?m.readBoolean():null}return b}(f))}z_.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var a=this._pbf.readVarint()+this._pbf.pos;return new Rx(this._pbf,a,this.extent,this._keys,this._values)};var Fx=P_;function Ox(c,a,f){if(c===3){var m=new Fx(f,f.readVarint()+f.pos);m.length&&(a[m.name]=m)}}ka.VectorTile=function(c,a){this.layers=c.readFields(Ox,{},a)},ka.VectorTileFeature=I_,ka.VectorTileLayer=P_;const $x=ka.VectorTileFeature.types,Wp=Math.pow(2,13);function Qc(c,a,f,m,b,k,S,M){c.emplaceBack(a,f,2*Math.floor(m*Wp)+S,b*Wp*2,k*Wp*2,Math.round(M))}class Zp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new xe,this.centroidVertexArray=new te,this.indexArray=new ut,this.programConfigurations=new Dr(a.layers,a.zoom),this.segments=new Ft,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.features=[],this.hasPattern=qp("fill-extrusion",this.layers,f);for(const{feature:b,id:k,index:S,sourceLayerIndex:M}of a){const F=this.layers[0]._featureFilter.needGeometry,j=Ks(b,F);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),j,m))continue;const X={id:k,sourceLayerIndex:M,index:S,geometry:F?j.geometry:Xs(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(Hp("fill-extrusion",this.layers,X,this.zoom,f)):this.addFeature(X,X.geometry,S,m,{}),f.featureIndex.insert(b,X.geometry,S,M,this.index,!0)}}addFeatures(a,f,m){for(const b of this.features){const{geometry:k}=b;this.addFeature(b,k,b.index,f,m)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ix),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Lx.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,f,m,b,k){const S={x:0,y:0,vertexCount:0};for(const M of Vp(f,500)){let F=0;for(const _e of M)F+=_e.length;let j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const _e of M){if(_e.length===0||jx(_e))continue;let be=0;for(let Ce=0;Ce<_e.length;Ce++){const Pe=_e[Ce];if(Ce>=1){const We=_e[Ce-1];if(!Nx(Pe,We)){j.vertexLength+4>Ft.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Re=Pe.sub(We)._perp()._unit(),je=We.dist(Pe);be+je>32768&&(be=0),Qc(this.layoutVertexArray,Pe.x,Pe.y,Re.x,Re.y,0,0,be),Qc(this.layoutVertexArray,Pe.x,Pe.y,Re.x,Re.y,0,1,be),S.x+=2*Pe.x,S.y+=2*Pe.y,S.vertexCount+=2,be+=je,Qc(this.layoutVertexArray,We.x,We.y,Re.x,Re.y,0,0,be),Qc(this.layoutVertexArray,We.x,We.y,Re.x,Re.y,0,1,be),S.x+=2*We.x,S.y+=2*We.y,S.vertexCount+=2;const ht=j.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),j.vertexLength+=4,j.primitiveLength+=2}}}}if(j.vertexLength+F>Ft.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(F,this.layoutVertexArray,this.indexArray)),$x[a.type]!=="Polygon")continue;const X=[],Q=[],se=j.vertexLength;for(const _e of M)if(_e.length!==0){_e!==M[0]&&Q.push(X.length/2);for(let be=0;be<_e.length;be++){const Ce=_e[be];Qc(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),S.x+=Ce.x,S.y+=Ce.y,S.vertexCount+=1,X.push(Ce.x),X.push(Ce.y)}}const pe=T_(X,Q);for(let _e=0;_e<pe.length;_e+=3)this.indexArray.emplaceBack(se+pe[_e],se+pe[_e+2],se+pe[_e+1]);j.primitiveLength+=pe.length/3,j.vertexLength+=F}for(let M=0;M<S.vertexCount;M++)this.centroidVertexArray.emplaceBack(Math.floor(S.x/S.vertexCount),Math.floor(S.y/S.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}}function Nx(c,a){return c.x===a.x&&(c.x<0||c.x>jr)||c.y===a.y&&(c.y<0||c.y>jr)}function jx(c){return c.every(a=>a.x<0)||c.every(a=>a.x>jr)||c.every(a=>a.y<0)||c.every(a=>a.y>jr)}let D_;Zt("FillExtrusionBucket",Zp,{omit:["layers","features"]});var Ux={get paint(){return D_=D_||new Oi({"fill-extrusion-opacity":new ln(de["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new dn(de["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ln(de["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ln(de["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pu(de["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new dn(de["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new dn(de["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ln(de["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Vx extends Co{constructor(a){super(a,Ux)}createBucket(a){return new Zp(a)}queryRadius(){return ed(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,f,m,b,k,S,M,F){const j=td(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),S.angle,M),X=this.paint.get("fill-extrusion-height").evaluate(f,m),Q=this.paint.get("fill-extrusion-base").evaluate(f,m),se=function(_e,be,Ce,Pe){const We=[];for(const Re of _e){const je=[Re.x,Re.y,0,1];nd(je,je,be),We.push(new _(je[0]/je[3],je[1]/je[3]))}return We}(j,F),pe=function(_e,be,Ce,Pe){const We=[],Re=[],je=Pe[8]*be,ht=Pe[9]*be,_t=Pe[10]*be,Ht=Pe[11]*be,sn=Pe[8]*Ce,qt=Pe[9]*Ce,jt=Pe[10]*Ce,Bt=Pe[11]*Ce;for(const Xt of _e){const Nt=[],Pt=[];for(const hn of Xt){const an=hn.x,Fn=hn.y,xr=Pe[0]*an+Pe[4]*Fn+Pe[12],Er=Pe[1]*an+Pe[5]*Fn+Pe[13],si=Pe[2]*an+Pe[6]*Fn+Pe[14],go=Pe[3]*an+Pe[7]*Fn+Pe[15],Ni=si+_t,Jr=go+Ht,_i=xr+sn,Ai=Er+qt,ji=si+jt,Ui=go+Bt,ai=new _((xr+je)/Jr,(Er+ht)/Jr);ai.z=Ni/Jr,Nt.push(ai);const li=new _(_i/Ui,Ai/Ui);li.z=ji/Ui,Pt.push(li)}We.push(Nt),Re.push(Pt)}return[We,Re]}(b,Q,X,F);return function(_e,be,Ce){let Pe=1/0;Vc(Ce,be)&&(Pe=R_(Ce,be[0]));for(let We=0;We<be.length;We++){const Re=be[We],je=_e[We];for(let ht=0;ht<Re.length-1;ht++){const _t=Re[ht],Ht=[_t,Re[ht+1],je[ht+1],je[ht],_t];Uc(Ce,Ht)&&(Pe=Math.min(Pe,R_(Ce,Ht)))}}return Pe!==1/0&&Pe}(pe[0],pe[1],se)}}function ef(c,a){return c.x*a.x+c.y*a.y}function R_(c,a){if(c.length===1){let f=0;const m=a[f++];let b;for(;!b||m.equals(b);)if(b=a[f++],!b)return 1/0;for(;f<a.length;f++){const k=a[f],S=c[0],M=b.sub(m),F=k.sub(m),j=S.sub(m),X=ef(M,M),Q=ef(M,F),se=ef(F,F),pe=ef(j,M),_e=ef(j,F),be=X*se-Q*Q,Ce=(se*pe-Q*_e)/be,Pe=(X*_e-Q*pe)/be,We=m.z*(1-Ce-Pe)+b.z*Ce+k.z*Pe;if(isFinite(We))return We}return 1/0}{let f=1/0;for(const m of a)f=Math.min(f,m.z);return f}}const qx=qr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Hx}=qx,Gx=qr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Wx}=Gx,Zx=ka.VectorTileFeature.types,Xx=Math.cos(Math.PI/180*37.5),B_=Math.pow(2,14)/.5;class Xp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new Me,this.layoutVertexArray2=new ve,this.indexArray=new ut,this.programConfigurations=new Dr(a.layers,a.zoom),this.segments=new Ft,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=qp("line",this.layers,f);const b=this.layers[0].layout.get("line-sort-key"),k=!b.isConstant(),S=[];for(const{feature:M,id:F,index:j,sourceLayerIndex:X}of a){const Q=this.layers[0]._featureFilter.needGeometry,se=Ks(M,Q);if(!this.layers[0]._featureFilter.filter(new Tr(this.zoom),se,m))continue;const pe=k?b.evaluate(se,{},m):void 0,_e={id:F,properties:M.properties,type:M.type,sourceLayerIndex:X,index:j,geometry:Q?se.geometry:Xs(M),patterns:{},sortKey:pe};S.push(_e)}k&&S.sort((M,F)=>M.sortKey-F.sortKey);for(const M of S){const{geometry:F,index:j,sourceLayerIndex:X}=M;if(this.hasPattern){const Q=Hp("line",this.layers,M,this.zoom,f);this.patternFeatures.push(Q)}else this.addFeature(M,F,j,m,{});f.featureIndex.insert(a[j].feature,F,j,X,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Wx)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Hx),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,f,m,b,k){const S=this.layers[0].layout,M=S.get("line-join").evaluate(a,{}),F=S.get("line-cap"),j=S.get("line-miter-limit"),X=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const Q of f)this.addLine(Q,a,M,F,j,X);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,k,b)}addLine(a,f,m,b,k,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<a.length-1;Pe++)this.totalDistance+=a[Pe].dist(a[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Zx[f.type]==="Polygon";let F=a.length;for(;F>=2&&a[F-1].equals(a[F-2]);)F--;let j=0;for(;j<F-1&&a[j].equals(a[j+1]);)j++;if(F<(M?3:2))return;m==="bevel"&&(k=1.05);const X=this.overscaling<=16?15*jr/(512*this.overscaling):0,Q=this.segments.prepareSegment(10*F,this.layoutVertexArray,this.indexArray);let se,pe,_e,be,Ce;this.e1=this.e2=-1,M&&(se=a[F-2],Ce=a[j].sub(se)._unit()._perp());for(let Pe=j;Pe<F;Pe++){if(_e=Pe===F-1?M?a[j+1]:void 0:a[Pe+1],_e&&a[Pe].equals(_e))continue;Ce&&(be=Ce),se&&(pe=se),se=a[Pe],Ce=_e?_e.sub(se)._unit()._perp():be,be=be||Ce;let We=be.add(Ce);We.x===0&&We.y===0||We._unit();const Re=be.x*Ce.x+be.y*Ce.y,je=We.x*Ce.x+We.y*Ce.y,ht=je!==0?1/je:1/0,_t=2*Math.sqrt(2-2*je),Ht=je<Xx&&pe&&_e,sn=be.x*Ce.y-be.y*Ce.x>0;if(Ht&&Pe>j){const Bt=se.dist(pe);if(Bt>2*X){const Xt=se.sub(se.sub(pe)._mult(X/Bt)._round());this.updateDistance(pe,Xt),this.addCurrentVertex(Xt,be,0,0,Q),pe=Xt}}const qt=pe&&_e;let jt=qt?m:M?"butt":b;if(qt&&jt==="round"&&(ht<S?jt="miter":ht<=2&&(jt="fakeround")),jt==="miter"&&ht>k&&(jt="bevel"),jt==="bevel"&&(ht>2&&(jt="flipbevel"),ht<k&&(jt="miter")),pe&&this.updateDistance(pe,se),jt==="miter")We._mult(ht),this.addCurrentVertex(se,We,0,0,Q);else if(jt==="flipbevel"){if(ht>100)We=Ce.mult(-1);else{const Bt=ht*be.add(Ce).mag()/be.sub(Ce).mag();We._perp()._mult(Bt*(sn?-1:1))}this.addCurrentVertex(se,We,0,0,Q),this.addCurrentVertex(se,We.mult(-1),0,0,Q)}else if(jt==="bevel"||jt==="fakeround"){const Bt=-Math.sqrt(ht*ht-1),Xt=sn?Bt:0,Nt=sn?0:Bt;if(pe&&this.addCurrentVertex(se,be,Xt,Nt,Q),jt==="fakeround"){const Pt=Math.round(180*_t/Math.PI/20);for(let hn=1;hn<Pt;hn++){let an=hn/Pt;if(an!==.5){const xr=an-.5;an+=an*xr*(an-1)*((1.0904+Re*(Re*(3.55645-1.43519*Re)-3.2452))*xr*xr+(.848013+Re*(.215638*Re-1.06021)))}const Fn=Ce.sub(be)._mult(an)._add(be)._unit()._mult(sn?-1:1);this.addHalfVertex(se,Fn.x,Fn.y,!1,sn,0,Q)}}_e&&this.addCurrentVertex(se,Ce,-Xt,-Nt,Q)}else if(jt==="butt")this.addCurrentVertex(se,We,0,0,Q);else if(jt==="square"){const Bt=pe?1:-1;this.addCurrentVertex(se,We,Bt,Bt,Q)}else jt==="round"&&(pe&&(this.addCurrentVertex(se,be,0,0,Q),this.addCurrentVertex(se,be,1,1,Q,!0)),_e&&(this.addCurrentVertex(se,Ce,-1,-1,Q,!0),this.addCurrentVertex(se,Ce,0,0,Q)));if(Ht&&Pe<F-1){const Bt=se.dist(_e);if(Bt>2*X){const Xt=se.add(_e.sub(se)._mult(X/Bt)._round());this.updateDistance(se,Xt),this.addCurrentVertex(Xt,Ce,0,0,Q),se=Xt}}}}addCurrentVertex(a,f,m,b,k,S=!1){const M=f.y*b-f.x,F=-f.y-f.x*b;this.addHalfVertex(a,f.x+f.y*m,f.y-f.x*m,S,!1,m,k),this.addHalfVertex(a,M,F,S,!0,-b,k),this.distance>B_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,f,m,b,k,S))}addHalfVertex({x:a,y:f},m,b,k,S,M,F){const j=.5*(this.lineClips?this.scaledDistance*(B_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(k?1:0),(f<<1)+(S?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(M===0?0:M<0?-1:1)|(63&j)<<2,j>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const X=F.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,X),F.primitiveLength++),S?this.e2=X:this.e1=X}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,f){this.distance+=a.dist(f),this.updateScaledDistance()}}let F_,O_;Zt("LineBucket",Xp,{omit:["layers","patternFeatures"]});var $_={get paint(){return O_=O_||new Oi({"line-opacity":new dn(de.paint_line["line-opacity"]),"line-color":new dn(de.paint_line["line-color"]),"line-translate":new ln(de.paint_line["line-translate"]),"line-translate-anchor":new ln(de.paint_line["line-translate-anchor"]),"line-width":new dn(de.paint_line["line-width"]),"line-gap-width":new dn(de.paint_line["line-gap-width"]),"line-offset":new dn(de.paint_line["line-offset"]),"line-blur":new dn(de.paint_line["line-blur"]),"line-dasharray":new ml(de.paint_line["line-dasharray"]),"line-pattern":new pu(de.paint_line["line-pattern"]),"line-gradient":new Pc(de.paint_line["line-gradient"])})},get layout(){return F_=F_||new Oi({"line-cap":new ln(de.layout_line["line-cap"]),"line-join":new dn(de.layout_line["line-join"]),"line-miter-limit":new ln(de.layout_line["line-miter-limit"]),"line-round-limit":new ln(de.layout_line["line-round-limit"]),"line-sort-key":new dn(de.layout_line["line-sort-key"])})}};class Kx extends dn{possiblyEvaluate(a,f){return f=new Tr(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(a,f)}evaluate(a,f,m,b){return f=q({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(a,f,m,b)}}let ad;class Jx extends Co{constructor(a){super(a,$_),this.gradientVersion=0,ad||(ad=new Kx($_.paint.properties["line-width"].specification),ad.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof al,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,f){super.recalculate(a,f),this.paint._values["line-floorwidth"]=ad.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Xp(a)}queryRadius(a){const f=a,m=N_(Gc("line-width",this,f),Gc("line-gap-width",this,f)),b=Gc("line-offset",this,f);return m/2+Math.abs(b)+ed(this.paint.get("line-translate"))}queryIntersectsFeature(a,f,m,b,k,S,M){const F=td(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),S.angle,M),j=M/2*N_(this.paint.get("line-width").evaluate(f,m),this.paint.get("line-gap-width").evaluate(f,m)),X=this.paint.get("line-offset").evaluate(f,m);return X&&(b=function(Q,se){const pe=[];for(let _e=0;_e<Q.length;_e++){const be=Q[_e],Ce=[];for(let Pe=0;Pe<be.length;Pe++){const We=be[Pe-1],Re=be[Pe],je=be[Pe+1],ht=Pe===0?new _(0,0):Re.sub(We)._unit()._perp(),_t=Pe===be.length-1?new _(0,0):je.sub(Re)._unit()._perp(),Ht=ht._add(_t)._unit(),sn=Ht.x*_t.x+Ht.y*_t.y;sn!==0&&Ht._mult(1/sn),Ce.push(Ht._mult(se)._add(Re))}pe.push(Ce)}return pe}(b,X*M)),function(Q,se,pe){for(let _e=0;_e<se.length;_e++){const be=se[_e];if(Q.length>=3){for(let Ce=0;Ce<be.length;Ce++)if(ku(Q,be[Ce]))return!0}if(qc(Q,be,pe))return!0}return!1}(F,b,j)}isTileClipped(){return!0}}function N_(c,a){return a>0?a+2*c:c}const Yx=qr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Qx=qr([{name:"a_projected_pos",components:3,type:"Float32"}],4);qr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const eA=qr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);qr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const j_=qr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tA=qr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function nA(c,a,f){return c.sections.forEach(m=>{m.text=function(b,k,S){const M=k.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?b=b.toLocaleUpperCase():M==="lowercase"&&(b=b.toLocaleLowerCase()),Ts.applyArabicShaping&&(b=Ts.applyArabicShaping(b)),b}(m.text,a,f)}),c}qr([{name:"triangle",components:3,type:"Uint16"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),qr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),qr([{type:"Float32",name:"offsetX"}]),qr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),qr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const tf={"!":"ï¸","#":"ï¼",$:"ï¼","%":"ï¼","&":"ï¼","(":"ï¸µ",")":"ï¸¶","*":"ï¼","+":"ï¼",",":"ï¸","-":"ï¸²",".":"ã»","/":"ï¼",":":"ï¸",";":"ï¸","<":"ï¸¿","=":"ï¼",">":"ï¹","?":"ï¸","@":"ï¼ ","[":"ï¹","\\":"ï¼¼","]":"ï¹","^":"ï¼¾",_:"ï¸³","`":"ï½","{":"ï¸·","|":"â","}":"ï¸¸","~":"ï½","Â¢":"ï¿ ","Â£":"ï¿¡","Â¥":"ï¿¥","Â¦":"ï¿¤","Â¬":"ï¿¢","Â¯":"ï¿£","â":"ï¸²","â":"ï¸±","â":"ï¹","â":"ï¹","â":"ï¹","â":"ï¹","â¦":"ï¸","â§":"ã»","â©":"ï¿¦","ã":"ï¸","ã":"ï¸","ã":"ï¸¿","ã":"ï¹","ã":"ï¸½","ã":"ï¸¾","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¹","ã":"ï¸»","ã":"ï¸¼","ã":"ï¸¹","ã":"ï¸º","ã":"ï¸","ã":"ï¸","ï¼":"ï¸","ï¼":"ï¸µ","ï¼":"ï¸¶","ï¼":"ï¸","ï¼":"ï¸²","ï¼":"ã»","ï¼":"ï¸","ï¼":"ï¸","ï¼":"ï¸¿","ï¼":"ï¹","ï¼":"ï¸","ï¼»":"ï¹","ï¼½":"ï¹","ï¼¿":"ï¸³","ï½":"ï¸·","ï½":"â","ï½":"ï¸¸","ï½":"ï¸µ","ï½ ":"ï¸¶","ï½¡":"ï¸","ï½¢":"ï¹","ï½£":"ï¹"};var oi=24,U_=dr,V_=function(c,a,f,m,b){var k,S,M=8*b-m-1,F=(1<<M)-1,j=F>>1,X=-7,Q=f?b-1:0,se=f?-1:1,pe=c[a+Q];for(Q+=se,k=pe&(1<<-X)-1,pe>>=-X,X+=M;X>0;k=256*k+c[a+Q],Q+=se,X-=8);for(S=k&(1<<-X)-1,k>>=-X,X+=m;X>0;S=256*S+c[a+Q],Q+=se,X-=8);if(k===0)k=1-j;else{if(k===F)return S?NaN:1/0*(pe?-1:1);S+=Math.pow(2,m),k-=j}return(pe?-1:1)*S*Math.pow(2,k-m)},q_=function(c,a,f,m,b,k){var S,M,F,j=8*k-b-1,X=(1<<j)-1,Q=X>>1,se=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,pe=m?0:k-1,_e=m?1:-1,be=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,S=X):(S=Math.floor(Math.log(a)/Math.LN2),a*(F=Math.pow(2,-S))<1&&(S--,F*=2),(a+=S+Q>=1?se/F:se*Math.pow(2,1-Q))*F>=2&&(S++,F/=2),S+Q>=X?(M=0,S=X):S+Q>=1?(M=(a*F-1)*Math.pow(2,b),S+=Q):(M=a*Math.pow(2,Q-1)*Math.pow(2,b),S=0));b>=8;c[f+pe]=255&M,pe+=_e,M/=256,b-=8);for(S=S<<b|M,j+=b;j>0;c[f+pe]=255&S,pe+=_e,S/=256,j-=8);c[f+pe-_e]|=128*be};function dr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}dr.Varint=0,dr.Fixed64=1,dr.Bytes=2,dr.Fixed32=5;var Kp=4294967296,H_=1/Kp,G_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Js(c){return c.type===dr.Bytes?c.readVarint()+c.pos:c.pos+1}function Mu(c,a,f){return f?4294967296*a+(c>>>0):4294967296*(a>>>0)+(c>>>0)}function W_(c,a,f){var m=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));f.realloc(m);for(var b=f.pos-1;b>=c;b--)f.buf[b+m]=f.buf[b]}function rA(c,a){for(var f=0;f<c.length;f++)a.writeVarint(c[f])}function iA(c,a){for(var f=0;f<c.length;f++)a.writeSVarint(c[f])}function oA(c,a){for(var f=0;f<c.length;f++)a.writeFloat(c[f])}function sA(c,a){for(var f=0;f<c.length;f++)a.writeDouble(c[f])}function aA(c,a){for(var f=0;f<c.length;f++)a.writeBoolean(c[f])}function lA(c,a){for(var f=0;f<c.length;f++)a.writeFixed32(c[f])}function uA(c,a){for(var f=0;f<c.length;f++)a.writeSFixed32(c[f])}function cA(c,a){for(var f=0;f<c.length;f++)a.writeFixed64(c[f])}function fA(c,a){for(var f=0;f<c.length;f++)a.writeSFixed64(c[f])}function ld(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+16777216*c[a+3]}function Eu(c,a,f){c[f]=a,c[f+1]=a>>>8,c[f+2]=a>>>16,c[f+3]=a>>>24}function Z_(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+(c[a+3]<<24)}dr.prototype={destroy:function(){this.buf=null},readFields:function(c,a,f){for(f=f||this.length;this.pos<f;){var m=this.readVarint(),b=m>>3,k=this.pos;this.type=7&m,c(b,a,this),this.pos===k&&this.skip(m)}return a},readMessage:function(c,a){return this.readFields(c,a,this.readVarint()+this.pos)},readFixed32:function(){var c=ld(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=Z_(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=ld(this.buf,this.pos)+ld(this.buf,this.pos+4)*Kp;return this.pos+=8,c},readSFixed64:function(){var c=ld(this.buf,this.pos)+Z_(this.buf,this.pos+4)*Kp;return this.pos+=8,c},readFloat:function(){var c=V_(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=V_(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var a,f,m=this.buf;return a=127&(f=m[this.pos++]),f<128?a:(a|=(127&(f=m[this.pos++]))<<7,f<128?a:(a|=(127&(f=m[this.pos++]))<<14,f<128?a:(a|=(127&(f=m[this.pos++]))<<21,f<128?a:function(b,k,S){var M,F,j=S.buf;if(M=(112&(F=j[S.pos++]))>>4,F<128||(M|=(127&(F=j[S.pos++]))<<3,F<128)||(M|=(127&(F=j[S.pos++]))<<10,F<128)||(M|=(127&(F=j[S.pos++]))<<17,F<128)||(M|=(127&(F=j[S.pos++]))<<24,F<128)||(M|=(1&(F=j[S.pos++]))<<31,F<128))return Mu(b,M,k);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(f=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,a=this.pos;return this.pos=c,c-a>=12&&G_?function(f,m,b){return G_.decode(f.subarray(m,b))}(this.buf,a,c):function(f,m,b){for(var k="",S=m;S<b;){var M,F,j,X=f[S],Q=null,se=X>239?4:X>223?3:X>191?2:1;if(S+se>b)break;se===1?X<128&&(Q=X):se===2?(192&(M=f[S+1]))==128&&(Q=(31&X)<<6|63&M)<=127&&(Q=null):se===3?(F=f[S+2],(192&(M=f[S+1]))==128&&(192&F)==128&&((Q=(15&X)<<12|(63&M)<<6|63&F)<=2047||Q>=55296&&Q<=57343)&&(Q=null)):se===4&&(F=f[S+2],j=f[S+3],(192&(M=f[S+1]))==128&&(192&F)==128&&(192&j)==128&&((Q=(15&X)<<18|(63&M)<<12|(63&F)<<6|63&j)<=65535||Q>=1114112)&&(Q=null)),Q===null?(Q=65533,se=1):Q>65535&&(Q-=65536,k+=String.fromCharCode(Q>>>10&1023|55296),Q=56320|1023&Q),k+=String.fromCharCode(Q),S+=se}return k}(this.buf,a,c)},readBytes:function(){var c=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,c);return this.pos=c,a},readPackedVarint:function(c,a){if(this.type!==dr.Bytes)return c.push(this.readVarint(a));var f=Js(this);for(c=c||[];this.pos<f;)c.push(this.readVarint(a));return c},readPackedSVarint:function(c){if(this.type!==dr.Bytes)return c.push(this.readSVarint());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==dr.Bytes)return c.push(this.readBoolean());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==dr.Bytes)return c.push(this.readFloat());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==dr.Bytes)return c.push(this.readDouble());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==dr.Bytes)return c.push(this.readFixed32());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==dr.Bytes)return c.push(this.readSFixed32());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==dr.Bytes)return c.push(this.readFixed64());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==dr.Bytes)return c.push(this.readSFixed64());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed64());return c},skip:function(c){var a=7&c;if(a===dr.Varint)for(;this.buf[this.pos++]>127;);else if(a===dr.Bytes)this.pos=this.readVarint()+this.pos;else if(a===dr.Fixed32)this.pos+=4;else{if(a!==dr.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(c,a){this.writeVarint(c<<3|a)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var f=new Uint8Array(a);f.set(this.buf),this.buf=f,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Eu(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Eu(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Eu(this.buf,-1&c,this.pos),Eu(this.buf,Math.floor(c*H_),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Eu(this.buf,-1&c,this.pos),Eu(this.buf,Math.floor(c*H_),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(a,f){var m,b;if(a>=0?(m=a%4294967296|0,b=a/4294967296|0):(b=~(-a/4294967296),4294967295^(m=~(-a%4294967296))?m=m+1|0:(m=0,b=b+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(k,S,M){M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,k>>>=7,M.buf[M.pos++]=127&k|128,M.buf[M.pos]=127&(k>>>=7)}(m,0,f),function(k,S){var M=(7&k)<<4;S.buf[S.pos++]|=M|((k>>>=3)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k|((k>>>=7)?128:0),k&&(S.buf[S.pos++]=127&k)))))}(b,f)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var a=this.pos;this.pos=function(m,b,k){for(var S,M,F=0;F<b.length;F++){if((S=b.charCodeAt(F))>55295&&S<57344){if(!M){S>56319||F+1===b.length?(m[k++]=239,m[k++]=191,m[k++]=189):M=S;continue}if(S<56320){m[k++]=239,m[k++]=191,m[k++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(m[k++]=239,m[k++]=191,m[k++]=189,M=null);S<128?m[k++]=S:(S<2048?m[k++]=S>>6|192:(S<65536?m[k++]=S>>12|224:(m[k++]=S>>18|240,m[k++]=S>>12&63|128),m[k++]=S>>6&63|128),m[k++]=63&S|128)}return k}(this.buf,c,this.pos);var f=this.pos-a;f>=128&&W_(a,f,this),this.pos=a-1,this.writeVarint(f),this.pos+=f},writeFloat:function(c){this.realloc(4),q_(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),q_(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var f=0;f<a;f++)this.buf[this.pos++]=c[f]},writeRawMessage:function(c,a){this.pos++;var f=this.pos;c(a,this);var m=this.pos-f;m>=128&&W_(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,a,f){this.writeTag(c,dr.Bytes),this.writeRawMessage(a,f)},writePackedVarint:function(c,a){a.length&&this.writeMessage(c,rA,a)},writePackedSVarint:function(c,a){a.length&&this.writeMessage(c,iA,a)},writePackedBoolean:function(c,a){a.length&&this.writeMessage(c,aA,a)},writePackedFloat:function(c,a){a.length&&this.writeMessage(c,oA,a)},writePackedDouble:function(c,a){a.length&&this.writeMessage(c,sA,a)},writePackedFixed32:function(c,a){a.length&&this.writeMessage(c,lA,a)},writePackedSFixed32:function(c,a){a.length&&this.writeMessage(c,uA,a)},writePackedFixed64:function(c,a){a.length&&this.writeMessage(c,cA,a)},writePackedSFixed64:function(c,a){a.length&&this.writeMessage(c,fA,a)},writeBytesField:function(c,a){this.writeTag(c,dr.Bytes),this.writeBytes(a)},writeFixed32Field:function(c,a){this.writeTag(c,dr.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(c,a){this.writeTag(c,dr.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(c,a){this.writeTag(c,dr.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(c,a){this.writeTag(c,dr.Fixed64),this.writeSFixed64(a)},writeVarintField:function(c,a){this.writeTag(c,dr.Varint),this.writeVarint(a)},writeSVarintField:function(c,a){this.writeTag(c,dr.Varint),this.writeSVarint(a)},writeStringField:function(c,a){this.writeTag(c,dr.Bytes),this.writeString(a)},writeFloatField:function(c,a){this.writeTag(c,dr.Fixed32),this.writeFloat(a)},writeDoubleField:function(c,a){this.writeTag(c,dr.Fixed64),this.writeDouble(a)},writeBooleanField:function(c,a){this.writeVarintField(c,!!a)}};var Jp=d(U_);const Yp=3;function hA(c,a,f){c===1&&f.readMessage(dA,a)}function dA(c,a,f){if(c===3){const{id:m,bitmap:b,width:k,height:S,left:M,top:F,advance:j}=f.readMessage(pA,{});a.push({id:m,bitmap:new Zc({width:k+2*Yp,height:S+2*Yp},b),metrics:{width:k,height:S,left:M,top:F,advance:j}})}}function pA(c,a,f){c===1?a.id=f.readVarint():c===2?a.bitmap=f.readBytes():c===3?a.width=f.readVarint():c===4?a.height=f.readVarint():c===5?a.left=f.readSVarint():c===6?a.top=f.readSVarint():c===7&&(a.advance=f.readVarint())}const X_=Yp;function K_(c){let a=0,f=0;for(const S of c)a+=S.w*S.h,f=Math.max(f,S.w);c.sort((S,M)=>M.h-S.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),f),h:1/0}];let b=0,k=0;for(const S of c)for(let M=m.length-1;M>=0;M--){const F=m[M];if(!(S.w>F.w||S.h>F.h)){if(S.x=F.x,S.y=F.y,k=Math.max(k,S.y+S.h),b=Math.max(b,S.x+S.w),S.w===F.w&&S.h===F.h){const j=m.pop();M<m.length&&(m[M]=j)}else S.h===F.h?(F.x+=S.w,F.w-=S.w):S.w===F.w?(F.y+=S.h,F.h-=S.h):(m.push({x:F.x+S.w,y:F.y,w:F.w-S.w,h:S.h}),F.y+=S.h,F.h-=S.h);break}}return{w:b,h:k,fill:a/(b*k)||0}}const ro=1;class Qp{constructor(a,{pixelRatio:f,version:m,stretchX:b,stretchY:k,content:S}){this.paddedRect=a,this.pixelRatio=f,this.stretchX=b,this.stretchY=k,this.content=S,this.version=m}get tl(){return[this.paddedRect.x+ro,this.paddedRect.y+ro]}get br(){return[this.paddedRect.x+this.paddedRect.w-ro,this.paddedRect.y+this.paddedRect.h-ro]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ro)/this.pixelRatio,(this.paddedRect.h-2*ro)/this.pixelRatio]}}class J_{constructor(a,f){const m={},b={};this.haveRenderCallbacks=[];const k=[];this.addImages(a,m,k),this.addImages(f,b,k);const{w:S,h:M}=K_(k),F=new To({width:S||1,height:M||1});for(const j in a){const X=a[j],Q=m[j].paddedRect;To.copy(X.data,F,{x:0,y:0},{x:Q.x+ro,y:Q.y+ro},X.data)}for(const j in f){const X=f[j],Q=b[j].paddedRect,se=Q.x+ro,pe=Q.y+ro,_e=X.data.width,be=X.data.height;To.copy(X.data,F,{x:0,y:0},{x:se,y:pe},X.data),To.copy(X.data,F,{x:0,y:be-1},{x:se,y:pe-1},{width:_e,height:1}),To.copy(X.data,F,{x:0,y:0},{x:se,y:pe+be},{width:_e,height:1}),To.copy(X.data,F,{x:_e-1,y:0},{x:se-1,y:pe},{width:1,height:be}),To.copy(X.data,F,{x:0,y:0},{x:se+_e,y:pe},{width:1,height:be})}this.image=F,this.iconPositions=m,this.patternPositions=b}addImages(a,f,m){for(const b in a){const k=a[b],S={x:0,y:0,w:k.data.width+2*ro,h:k.data.height+2*ro};m.push(S),f[b]=new Qp(S,k),k.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(a,f){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in a.updatedImages)this.patchUpdatedImage(this.iconPositions[m],a.getImage(m),f),this.patchUpdatedImage(this.patternPositions[m],a.getImage(m),f)}patchUpdatedImage(a,f,m){if(!a||!f||a.version===f.version)return;a.version=f.version;const[b,k]=a.tl;m.update(f.data,void 0,{x:b,y:k})}}var Sa;Zt("ImagePosition",Qp),Zt("ImageAtlas",J_),u.ah=void 0,(Sa=u.ah||(u.ah={}))[Sa.none=0]="none",Sa[Sa.horizontal=1]="horizontal",Sa[Sa.vertical=2]="vertical",Sa[Sa.horizontalOnly=3]="horizontalOnly";const nf=-17;class rf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,f){const m=new rf;return m.scale=a||1,m.fontStack=f,m}static forImage(a){const f=new rf;return f.imageName=a,f}}class Lu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,f){const m=new Lu;for(let b=0;b<a.sections.length;b++){const k=a.sections[b];k.image?m.addImageSection(k):m.addTextSection(k,f)}return m}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let f="";for(let m=0;m<a.length;m++){const b=a.charCodeAt(m+1)||null,k=a.charCodeAt(m-1)||null;f+=b&&Lc(b)&&!tf[a[m+1]]||k&&Lc(k)&&!tf[a[m-1]]||!tf[a[m]]?a[m]:tf[a[m]]}return f}(this.text)}trim(){let a=0;for(let m=0;m<this.text.length&&cd[this.text.charCodeAt(m)];m++)a++;let f=this.text.length;for(let m=this.text.length-1;m>=0&&m>=a&&cd[this.text.charCodeAt(m)];m--)f--;this.text=this.text.substring(a,f),this.sectionIndex=this.sectionIndex.slice(a,f)}substring(a,f){const m=new Lu;return m.text=this.text.substring(a,f),m.sectionIndex=this.sectionIndex.slice(a,f),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,f)=>Math.max(a,this.sections[f].scale),0)}addTextSection(a,f){this.text+=a.text,this.sections.push(rf.forText(a.scale,a.fontStack||f));const m=this.sections.length-1;for(let b=0;b<a.text.length;++b)this.sectionIndex.push(m)}addImageSection(a){const f=a.image?a.image.name:"";if(f.length===0)return void ke("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(rf.forImage(f)),this.sectionIndex.push(this.sections.length-1)):ke("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ud(c,a,f,m,b,k,S,M,F,j,X,Q,se,pe,_e,be){const Ce=Lu.fromFeature(c,b);let Pe;Q===u.ah.vertical&&Ce.verticalizePunctuation();const{processBidirectionalText:We,processStyledBidirectionalText:Re}=Ts;if(We&&Ce.sections.length===1){Pe=[];const _t=We(Ce.toString(),em(Ce,j,k,a,m,pe,_e));for(const Ht of _t){const sn=new Lu;sn.text=Ht,sn.sections=Ce.sections;for(let qt=0;qt<Ht.length;qt++)sn.sectionIndex.push(0);Pe.push(sn)}}else if(Re){Pe=[];const _t=Re(Ce.text,Ce.sectionIndex,em(Ce,j,k,a,m,pe,_e));for(const Ht of _t){const sn=new Lu;sn.text=Ht[0],sn.sectionIndex=Ht[1],sn.sections=Ce.sections,Pe.push(sn)}}else Pe=function(_t,Ht){const sn=[],qt=_t.text;let jt=0;for(const Bt of Ht)sn.push(_t.substring(jt,Bt)),jt=Bt;return jt<qt.length&&sn.push(_t.substring(jt,qt.length)),sn}(Ce,em(Ce,j,k,a,m,pe,_e));const je=[],ht={positionedLines:je,text:Ce.toString(),top:X[1],bottom:X[1],left:X[0],right:X[0],writingMode:Q,iconsInText:!1,verticalizable:!1};return function(_t,Ht,sn,qt,jt,Bt,Xt,Nt,Pt,hn,an,Fn){let xr=0,Er=nf,si=0,go=0;const Ni=Nt==="right"?1:Nt==="left"?0:.5;let Jr=0;for(const ai of jt){ai.trim();const li=ai.getMaxScale(),Ei=(li-1)*oi,Vi={positionedGlyphs:[],lineOffset:0};_t.positionedLines[Jr]=Vi;const Li=Vi.positionedGlyphs;let io=0;if(!ai.length()){Er+=Bt,++Jr;continue}for(let ui=0;ui<ai.length();ui++){const qn=ai.getSection(ui),Ii=ai.getSectionIndex(ui),ki=ai.getCharCode(ui);let ci=0,Zo=null,us=null,cs=null,Ys=oi;const Xo=!(Pt===u.ah.horizontal||!an&&!fu(ki)||an&&(cd[ki]||(_i=ki,Vt.Arabic(_i)||Vt["Arabic Supplement"](_i)||Vt["Arabic Extended-A"](_i)||Vt["Arabic Presentation Forms-A"](_i)||Vt["Arabic Presentation Forms-B"](_i))));if(qn.imageName){const Eo=qt[qn.imageName];if(!Eo)continue;cs=qn.imageName,_t.iconsInText=_t.iconsInText||!0,us=Eo.paddedRect;const so=Eo.displaySize;qn.scale=qn.scale*oi/Fn,Zo={width:so[0],height:so[1],left:ro,top:-X_,advance:Xo?so[1]:so[0]},ci=Ei+(oi-so[1]*qn.scale),Ys=Zo.advance;const Qs=Xo?so[0]*qn.scale-oi*li:so[1]*qn.scale-oi*li;Qs>0&&Qs>io&&(io=Qs)}else{const Eo=sn[qn.fontStack],so=Eo&&Eo[ki];if(so&&so.rect)us=so.rect,Zo=so.metrics;else{const Qs=Ht[qn.fontStack],uf=Qs&&Qs[ki];if(!uf)continue;Zo=uf.metrics}ci=(li-qn.scale)*oi}Xo?(_t.verticalizable=!0,Li.push({glyph:ki,imageName:cs,x:xr,y:Er+ci,vertical:Xo,scale:qn.scale,fontStack:qn.fontStack,sectionIndex:Ii,metrics:Zo,rect:us}),xr+=Ys*qn.scale+hn):(Li.push({glyph:ki,imageName:cs,x:xr,y:Er+ci,vertical:Xo,scale:qn.scale,fontStack:qn.fontStack,sectionIndex:Ii,metrics:Zo,rect:us}),xr+=Zo.advance*qn.scale+hn)}Li.length!==0&&(si=Math.max(xr-hn,si),_A(Li,0,Li.length-1,Ni,io)),xr=0;const oo=Bt*li+io;Vi.lineOffset=Math.max(io,Ei),Er+=oo,go=Math.max(oo,go),++Jr}var _i;const Ai=Er-nf,{horizontalAlign:ji,verticalAlign:Ui}=tm(Xt);(function(ai,li,Ei,Vi,Li,io,oo,ui,qn){const Ii=(li-Ei)*Li;let ki=0;ki=io!==oo?-ui*Vi-nf:(-Vi*qn+.5)*oo;for(const ci of ai)for(const Zo of ci.positionedGlyphs)Zo.x+=Ii,Zo.y+=ki})(_t.positionedLines,Ni,ji,Ui,si,go,Bt,Ai,jt.length),_t.top+=-Ui*Ai,_t.bottom=_t.top+Ai,_t.left+=-ji*si,_t.right=_t.left+si}(ht,a,f,m,Pe,S,M,F,Q,j,se,be),!function(_t){for(const Ht of _t)if(Ht.positionedGlyphs.length!==0)return!1;return!0}(je)&&ht}const cd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mA={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Y_(c,a,f,m,b,k){if(a.imageName){const S=m[a.imageName];return S?S.displaySize[0]*a.scale*oi/k+b:0}{const S=f[a.fontStack],M=S&&S[c];return M?M.metrics.advance*a.scale+b:0}}function Q_(c,a,f,m){const b=Math.pow(c-a,2);return m?c<a?b/2:2*b:b+Math.abs(f)*f}function gA(c,a,f){let m=0;return c===10&&(m-=1e4),f&&(m+=150),c!==40&&c!==65288||(m+=50),a!==41&&a!==65289||(m+=50),m}function e0(c,a,f,m,b,k){let S=null,M=Q_(a,f,b,k);for(const F of m){const j=Q_(a-F.x,f,b,k)+F.badness;j<=M&&(S=F,M=j)}return{index:c,x:a,priorBreak:S,badness:M}}function t0(c){return c?t0(c.priorBreak).concat(c.index):[]}function em(c,a,f,m,b,k,S){if(k!=="point")return[];if(!c)return[];const M=[],F=function(se,pe,_e,be,Ce,Pe){let We=0;for(let Re=0;Re<se.length();Re++){const je=se.getSection(Re);We+=Y_(se.getCharCode(Re),je,be,Ce,pe,Pe)}return We/Math.max(1,Math.ceil(We/_e))}(c,a,f,m,b,S),j=c.text.indexOf("â")>=0;let X=0;for(let se=0;se<c.length();se++){const pe=c.getSection(se),_e=c.getCharCode(se);if(cd[_e]||(X+=Y_(_e,pe,m,b,a,S)),se<c.length()-1){const be=!((Q=_e)<11904||!(Vt["Bopomofo Extended"](Q)||Vt.Bopomofo(Q)||Vt["CJK Compatibility Forms"](Q)||Vt["CJK Compatibility Ideographs"](Q)||Vt["CJK Compatibility"](Q)||Vt["CJK Radicals Supplement"](Q)||Vt["CJK Strokes"](Q)||Vt["CJK Symbols and Punctuation"](Q)||Vt["CJK Unified Ideographs Extension A"](Q)||Vt["CJK Unified Ideographs"](Q)||Vt["Enclosed CJK Letters and Months"](Q)||Vt["Halfwidth and Fullwidth Forms"](Q)||Vt.Hiragana(Q)||Vt["Ideographic Description Characters"](Q)||Vt["Kangxi Radicals"](Q)||Vt["Katakana Phonetic Extensions"](Q)||Vt.Katakana(Q)||Vt["Vertical Forms"](Q)||Vt["Yi Radicals"](Q)||Vt["Yi Syllables"](Q)));(mA[_e]||be||pe.imageName)&&M.push(e0(se+1,X,F,M,gA(_e,c.getCharCode(se+1),be&&j),!1))}}var Q;return t0(e0(c.length(),X,F,M,0,!0))}function tm(c){let a=.5,f=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:a,verticalAlign:f}}function _A(c,a,f,m,b){if(!m&&!b)return;const k=c[f],S=(c[f].x+k.metrics.advance*k.scale)*m;for(let M=a;M<=f;M++)c[M].x-=S,c[M].y+=b}function yA(c,a,f){const{horizontalAlign:m,verticalAlign:b}=tm(f),k=a[0]-c.displaySize[0]*m,S=a[1]-c.displaySize[1]*b;return{image:c,top:S,bottom:S+c.displaySize[1],left:k,right:k+c.displaySize[0]}}function n0(c,a,f,m,b,k){const S=c.image;let M;if(S.content){const Ce=S.content,Pe=S.pixelRatio||1;M=[Ce[0]/Pe,Ce[1]/Pe,S.displaySize[0]-Ce[2]/Pe,S.displaySize[1]-Ce[3]/Pe]}const F=a.left*k,j=a.right*k;let X,Q,se,pe;f==="width"||f==="both"?(pe=b[0]+F-m[3],Q=b[0]+j+m[1]):(pe=b[0]+(F+j-S.displaySize[0])/2,Q=pe+S.displaySize[0]);const _e=a.top*k,be=a.bottom*k;return f==="height"||f==="both"?(X=b[1]+_e-m[0],se=b[1]+be+m[2]):(X=b[1]+(_e+be-S.displaySize[1])/2,se=X+S.displaySize[1]),{image:S,top:X,right:Q,bottom:se,left:pe,collisionPadding:M}}const of=255,Is=128,Ca=of*Is;function r0(c,a){const{expression:f}=a;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Tr(c+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:b}=f;let k=0;for(;k<m.length&&m[k]<=c;)k++;k=Math.max(0,k-1);let S=k;for(;S<m.length&&m[S]<c+1;)S++;S=Math.min(m.length-1,S);const M=m[k],F=m[S];return f.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:F,interpolationType:b}:{kind:"camera",minZoom:M,maxZoom:F,minSize:f.evaluate(new Tr(M)),maxSize:f.evaluate(new Tr(F)),interpolationType:b}}}function nm(c,a,f){let m="never";const b=c.get(a);return b?m=b:c.get(f)&&(m="always"),m}const vA=ka.VectorTileFeature.types,bA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function fd(c,a,f,m,b,k,S,M,F,j,X,Q,se){const pe=M?Math.min(Ca,Math.round(M[0])):0,_e=M?Math.min(Ca,Math.round(M[1])):0;c.emplaceBack(a,f,Math.round(32*m),Math.round(32*b),k,S,(pe<<1)+(F?1:0),_e,16*j,16*X,256*Q,256*se)}function rm(c,a,f){c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f)}function wA(c){for(const a of c.sections)if(Dp(a.text))return!0;return!1}class im{constructor(a){this.layoutVertexArray=new tt,this.indexArray=new ut,this.programConfigurations=a,this.segments=new Ft,this.dynamicLayoutVertexArray=new Ie,this.opacityVertexArray=new He,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,f,m,b){this.isEmpty()||(m&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Yx.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Qx.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,bA,!0),this.opacityVertexBuffer.itemSize=1),(m||b)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",im);class om{constructor(a,f,m){this.layoutVertexArray=new a,this.layoutAttributes=f,this.indexArray=new m,this.segments=new Ft,this.collisionVertexArray=new ot}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,eA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",om);class Iu{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(S=>S.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bp([]),this.placementViewportMatrix=Bp([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=r0(this.zoom,f["text-size"]),this.iconSizeData=r0(this.zoom,f["icon-size"]);const m=this.layers[0].layout,b=m.get("symbol-sort-key"),k=m.get("symbol-z-order");this.canOverlap=nm(m,"text-overlap","text-allow-overlap")!=="never"||nm(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=k!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(k==="viewport-y"||k==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(S=>u.ah[S])),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=a.sourceID}createArrays(){this.text=new im(new Dr(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new im(new Dr(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new A,this.lineVertexArray=new P,this.symbolInstances=new v,this.textAnchorOffsets=new $}calculateGlyphDependencies(a,f,m,b,k){for(let S=0;S<a.length;S++)if(f[a.charCodeAt(S)]=!0,(m||b)&&k){const M=tf[a.charAt(S)];M&&(f[M.charCodeAt(0)]=!0)}}populate(a,f,m){const b=this.layers[0],k=b.layout,S=k.get("text-font"),M=k.get("text-field"),F=k.get("icon-image"),j=(M.value.kind!=="constant"||M.value.value instanceof Yi&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(S.value.kind!=="constant"||S.value.value.length>0),X=F.value.kind!=="constant"||!!F.value.value||Object.keys(F.parameters).length>0,Q=k.get("symbol-sort-key");if(this.features=[],!j&&!X)return;const se=f.iconDependencies,pe=f.glyphDependencies,_e=f.availableImages,be=new Tr(this.zoom);for(const{feature:Ce,id:Pe,index:We,sourceLayerIndex:Re}of a){const je=b._featureFilter.needGeometry,ht=Ks(Ce,je);if(!b._featureFilter.filter(be,ht,m))continue;let _t,Ht;if(je||(ht.geometry=Xs(Ce)),j){const qt=b.getValueAndResolveTokens("text-field",ht,m,_e),jt=Yi.factory(qt),Bt=this.hasRTLText=this.hasRTLText||wA(jt);(!Bt||Ts.getRTLTextPluginStatus()==="unavailable"||Bt&&Ts.isParsed())&&(_t=nA(jt,b,ht))}if(X){const qt=b.getValueAndResolveTokens("icon-image",ht,m,_e);Ht=qt instanceof ho?qt:ho.fromString(qt)}if(!_t&&!Ht)continue;const sn=this.sortFeaturesByKey?Q.evaluate(ht,{},m):void 0;if(this.features.push({id:Pe,text:_t,icon:Ht,index:We,sourceLayerIndex:Re,geometry:ht.geometry,properties:Ce.properties,type:vA[Ce.type],sortKey:sn}),Ht&&(se[Ht.name]=!0),_t){const qt=S.evaluate(ht,{},m).join(","),jt=k.get("text-rotation-alignment")!=="viewport"&&k.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const Bt of _t.sections)if(Bt.image)se[Bt.image.name]=!0;else{const Xt=xa(_t.toString()),Nt=Bt.fontStack||qt,Pt=pe[Nt]=pe[Nt]||{};this.calculateGlyphDependencies(Bt.text,Pt,jt,this.allowVerticalPlacement,Xt)}}}k.get("symbol-placement")==="line"&&(this.features=function(Ce){const Pe={},We={},Re=[];let je=0;function ht(qt){Re.push(Ce[qt]),je++}function _t(qt,jt,Bt){const Xt=We[qt];return delete We[qt],We[jt]=Xt,Re[Xt].geometry[0].pop(),Re[Xt].geometry[0]=Re[Xt].geometry[0].concat(Bt[0]),Xt}function Ht(qt,jt,Bt){const Xt=Pe[jt];return delete Pe[jt],Pe[qt]=Xt,Re[Xt].geometry[0].shift(),Re[Xt].geometry[0]=Bt[0].concat(Re[Xt].geometry[0]),Xt}function sn(qt,jt,Bt){const Xt=Bt?jt[0][jt[0].length-1]:jt[0][0];return`${qt}:${Xt.x}:${Xt.y}`}for(let qt=0;qt<Ce.length;qt++){const jt=Ce[qt],Bt=jt.geometry,Xt=jt.text?jt.text.toString():null;if(!Xt){ht(qt);continue}const Nt=sn(Xt,Bt),Pt=sn(Xt,Bt,!0);if(Nt in We&&Pt in Pe&&We[Nt]!==Pe[Pt]){const hn=Ht(Nt,Pt,Bt),an=_t(Nt,Pt,Re[hn].geometry);delete Pe[Nt],delete We[Pt],We[sn(Xt,Re[an].geometry,!0)]=an,Re[hn].geometry=null}else Nt in We?_t(Nt,Pt,Bt):Pt in Pe?Ht(Nt,Pt,Bt):(ht(qt),Pe[Nt]=je-1,We[Pt]=je-1)}return Re.filter(qt=>qt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Pe)=>Ce.sortKey-Pe.sortKey)}update(a,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,f,this.layers,m),this.icon.programConfigurations.updatePaintArrays(a,f,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,f){const m=this.lineVertexArray.length;if(a.segment!==void 0){let b=a.dist(f[a.segment+1]),k=a.dist(f[a.segment]);const S={};for(let M=a.segment+1;M<f.length;M++)S[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:b},M<f.length-1&&(b+=f[M+1].dist(f[M]));for(let M=a.segment||0;M>=0;M--)S[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:k},M>0&&(k+=f[M-1].dist(f[M]));for(let M=0;M<f.length;M++){const F=S[M];this.lineVertexArray.emplaceBack(F.x,F.y,F.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(a,f,m,b,k,S,M,F,j,X,Q,se){const pe=a.indexArray,_e=a.layoutVertexArray,be=a.segments.prepareSegment(4*f.length,_e,pe,this.canOverlap?S.sortKey:void 0),Ce=this.glyphOffsetArray.length,Pe=be.vertexLength,We=this.allowVerticalPlacement&&M===u.ah.vertical?Math.PI/2:0,Re=S.text&&S.text.sections;for(let je=0;je<f.length;je++){const{tl:ht,tr:_t,bl:Ht,br:sn,tex:qt,pixelOffsetTL:jt,pixelOffsetBR:Bt,minFontScaleX:Xt,minFontScaleY:Nt,glyphOffset:Pt,isSDF:hn,sectionIndex:an}=f[je],Fn=be.vertexLength,xr=Pt[1];fd(_e,F.x,F.y,ht.x,xr+ht.y,qt.x,qt.y,m,hn,jt.x,jt.y,Xt,Nt),fd(_e,F.x,F.y,_t.x,xr+_t.y,qt.x+qt.w,qt.y,m,hn,Bt.x,jt.y,Xt,Nt),fd(_e,F.x,F.y,Ht.x,xr+Ht.y,qt.x,qt.y+qt.h,m,hn,jt.x,Bt.y,Xt,Nt),fd(_e,F.x,F.y,sn.x,xr+sn.y,qt.x+qt.w,qt.y+qt.h,m,hn,Bt.x,Bt.y,Xt,Nt),rm(a.dynamicLayoutVertexArray,F,We),pe.emplaceBack(Fn,Fn+1,Fn+2),pe.emplaceBack(Fn+1,Fn+2,Fn+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Pt[0]),je!==f.length-1&&an===f[je+1].sectionIndex||a.programConfigurations.populatePaintArrays(_e.length,S,S.index,{},se,Re&&Re[an])}a.placedSymbolArray.emplaceBack(F.x,F.y,Ce,this.glyphOffsetArray.length-Ce,Pe,j,X,F.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],M,0,!1,0,Q)}_addCollisionDebugVertex(a,f,m,b,k,S){return f.emplaceBack(0,0),a.emplaceBack(m.x,m.y,b,k,Math.round(S.x),Math.round(S.y))}addCollisionDebugVertices(a,f,m,b,k,S,M){const F=k.segments.prepareSegment(4,k.layoutVertexArray,k.indexArray),j=F.vertexLength,X=k.layoutVertexArray,Q=k.collisionVertexArray,se=M.anchorX,pe=M.anchorY;this._addCollisionDebugVertex(X,Q,S,se,pe,new _(a,f)),this._addCollisionDebugVertex(X,Q,S,se,pe,new _(m,f)),this._addCollisionDebugVertex(X,Q,S,se,pe,new _(m,b)),this._addCollisionDebugVertex(X,Q,S,se,pe,new _(a,b)),F.vertexLength+=4;const _e=k.indexArray;_e.emplaceBack(j,j+1),_e.emplaceBack(j+1,j+2),_e.emplaceBack(j+2,j+3),_e.emplaceBack(j+3,j),F.primitiveLength+=4}addDebugCollisionBoxes(a,f,m,b){for(let k=a;k<f;k++){const S=this.collisionBoxArray.get(k);this.addCollisionDebugVertices(S.x1,S.y1,S.x2,S.y2,b?this.textCollisionBox:this.iconCollisionBox,S.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new om(rt,j_.members,kt),this.iconCollisionBox=new om(rt,j_.members,kt);for(let a=0;a<this.symbolInstances.length;a++){const f=this.symbolInstances.get(a);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(a,f,m,b,k,S,M,F,j){const X={};for(let Q=f;Q<m;Q++){const se=a.get(Q);X.textBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.textFeatureIndex=se.featureIndex;break}for(let Q=b;Q<k;Q++){const se=a.get(Q);X.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.verticalTextFeatureIndex=se.featureIndex;break}for(let Q=S;Q<M;Q++){const se=a.get(Q);X.iconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.iconFeatureIndex=se.featureIndex;break}for(let Q=F;Q<j;Q++){const se=a.get(Q);X.verticalIconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},X.verticalIconFeatureIndex=se.featureIndex;break}return X}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,f){const m=a.placedSymbolArray.get(f),b=m.vertexStartIndex+4*m.numGlyphs;for(let k=m.vertexStartIndex;k<b;k+=4)a.indexArray.emplaceBack(k,k+1,k+2),a.indexArray.emplaceBack(k+1,k+2,k+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(a),m=Math.cos(a),b=[],k=[],S=[];for(let M=0;M<this.symbolInstances.length;++M){S.push(M);const F=this.symbolInstances.get(M);b.push(0|Math.round(f*F.anchorX+m*F.anchorY)),k.push(F.featureIndex)}return S.sort((M,F)=>b[M]-b[F]||k[F]-k[M]),S}addToSortKeyRanges(a,f){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===f?m.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const m=this.symbolInstances.get(f);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((b,k,S)=>{b>=0&&S.indexOf(b)===k&&this.addIndicesForPlacedSymbol(this.text,b)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let i0,o0;Zt("SymbolBucket",Iu,{omit:["layers","collisionBoxArray","features","compareText"]}),Iu.MAX_GLYPHS=65535,Iu.addDynamicAttributes=rm;var sm={get paint(){return o0=o0||new Oi({"icon-opacity":new dn(de.paint_symbol["icon-opacity"]),"icon-color":new dn(de.paint_symbol["icon-color"]),"icon-halo-color":new dn(de.paint_symbol["icon-halo-color"]),"icon-halo-width":new dn(de.paint_symbol["icon-halo-width"]),"icon-halo-blur":new dn(de.paint_symbol["icon-halo-blur"]),"icon-translate":new ln(de.paint_symbol["icon-translate"]),"icon-translate-anchor":new ln(de.paint_symbol["icon-translate-anchor"]),"text-opacity":new dn(de.paint_symbol["text-opacity"]),"text-color":new dn(de.paint_symbol["text-color"],{runtimeType:Dt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new dn(de.paint_symbol["text-halo-color"]),"text-halo-width":new dn(de.paint_symbol["text-halo-width"]),"text-halo-blur":new dn(de.paint_symbol["text-halo-blur"]),"text-translate":new ln(de.paint_symbol["text-translate"]),"text-translate-anchor":new ln(de.paint_symbol["text-translate-anchor"])})},get layout(){return i0=i0||new Oi({"symbol-placement":new ln(de.layout_symbol["symbol-placement"]),"symbol-spacing":new ln(de.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ln(de.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new dn(de.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ln(de.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ln(de.layout_symbol["icon-allow-overlap"]),"icon-overlap":new ln(de.layout_symbol["icon-overlap"]),"icon-ignore-placement":new ln(de.layout_symbol["icon-ignore-placement"]),"icon-optional":new ln(de.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ln(de.layout_symbol["icon-rotation-alignment"]),"icon-size":new dn(de.layout_symbol["icon-size"]),"icon-text-fit":new ln(de.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ln(de.layout_symbol["icon-text-fit-padding"]),"icon-image":new dn(de.layout_symbol["icon-image"]),"icon-rotate":new dn(de.layout_symbol["icon-rotate"]),"icon-padding":new dn(de.layout_symbol["icon-padding"]),"icon-keep-upright":new ln(de.layout_symbol["icon-keep-upright"]),"icon-offset":new dn(de.layout_symbol["icon-offset"]),"icon-anchor":new dn(de.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ln(de.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ln(de.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ln(de.layout_symbol["text-rotation-alignment"]),"text-field":new dn(de.layout_symbol["text-field"]),"text-font":new dn(de.layout_symbol["text-font"]),"text-size":new dn(de.layout_symbol["text-size"]),"text-max-width":new dn(de.layout_symbol["text-max-width"]),"text-line-height":new ln(de.layout_symbol["text-line-height"]),"text-letter-spacing":new dn(de.layout_symbol["text-letter-spacing"]),"text-justify":new dn(de.layout_symbol["text-justify"]),"text-radial-offset":new dn(de.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ln(de.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new dn(de.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new dn(de.layout_symbol["text-anchor"]),"text-max-angle":new ln(de.layout_symbol["text-max-angle"]),"text-writing-mode":new ln(de.layout_symbol["text-writing-mode"]),"text-rotate":new dn(de.layout_symbol["text-rotate"]),"text-padding":new ln(de.layout_symbol["text-padding"]),"text-keep-upright":new ln(de.layout_symbol["text-keep-upright"]),"text-transform":new dn(de.layout_symbol["text-transform"]),"text-offset":new dn(de.layout_symbol["text-offset"]),"text-allow-overlap":new ln(de.layout_symbol["text-allow-overlap"]),"text-overlap":new ln(de.layout_symbol["text-overlap"]),"text-ignore-placement":new ln(de.layout_symbol["text-ignore-placement"]),"text-optional":new ln(de.layout_symbol["text-optional"])})}};class s0{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:Un,this.defaultValue=a}evaluate(a){if(a.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(a.formattedSection))return f.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",s0,{omit:["defaultValue"]});class hd extends Co{constructor(a){super(a,sm)}recalculate(a,f){if(super.recalculate(a,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const b=[];for(const k of m)b.indexOf(k)<0&&b.push(k);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,f,m,b){const k=this.layout.get(a).evaluate(f,{},m,b),S=this._unevaluatedLayout._values[a];return S.isDataDriven()||gr(S.value)||!k?k:function(M,F){return F.replace(/{([^{}]+)}/g,(j,X)=>M&&X in M?String(M[X]):"")}(f.properties,k)}createBucket(a){return new Iu(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of sm.paint.overridableProperties){if(!hd.hasPaintOverride(this.layout,a))continue;const f=this.paint.get(a),m=new s0(f),b=new wr(m,f.property.specification);let k=null;k=f.value.kind==="constant"||f.value.kind==="source"?new eu("source",b):new wc("composite",b,f.value.zoomStops),this.paint._values[a]=new So(f.property,k,f.parameters)}}_handleOverridablePaintPropertyUpdate(a,f,m){return!(!this.layout||f.isDataDriven()||m.isDataDriven())&&hd.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,f){const m=a.get("text-field"),b=sm.paint.properties[f];let k=!1;const S=M=>{for(const F of M)if(b.overrides&&b.overrides.hasOverride(F))return void(k=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Yi)S(m.value.value.sections);else if(m.value.kind==="source"){const M=j=>{k||(j instanceof xs&&Wr(j.value)===sr?S(j.value.sections):j instanceof Yl?S(j.sections):j.eachChild(M))},F=m.value;F._styleExpression&&M(F._styleExpression.expression)}return k}}let a0;var xA={get paint(){return a0=a0||new Oi({"background-color":new ln(de.paint_background["background-color"]),"background-pattern":new ml(de.paint_background["background-pattern"]),"background-opacity":new ln(de.paint_background["background-opacity"])})}};class AA extends Co{constructor(a){super(a,xA)}}let l0;var kA={get paint(){return l0=l0||new Oi({"raster-opacity":new ln(de.paint_raster["raster-opacity"]),"raster-hue-rotate":new ln(de.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ln(de.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ln(de.paint_raster["raster-brightness-max"]),"raster-saturation":new ln(de.paint_raster["raster-saturation"]),"raster-contrast":new ln(de.paint_raster["raster-contrast"]),"raster-resampling":new ln(de.paint_raster["raster-resampling"]),"raster-fade-duration":new ln(de.paint_raster["raster-fade-duration"])})}};class SA extends Co{constructor(a){super(a,kA)}}class CA extends Co{constructor(a){super(a,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class TA{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const am=63710088e-1;class Ta{constructor(a,f){if(isNaN(a)||isNaN(f))throw new Error(`Invalid LngLat object: (${a}, ${f})`);if(this.lng=+a,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ta(H(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const f=Math.PI/180,m=this.lat*f,b=a.lat*f,k=Math.sin(m)*Math.sin(b)+Math.cos(m)*Math.cos(b)*Math.cos((a.lng-this.lng)*f);return am*Math.acos(Math.min(k,1))}static convert(a){if(a instanceof Ta)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Ta(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Ta(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const u0=2*Math.PI*am;function c0(c){return u0*Math.cos(c*Math.PI/180)}function f0(c){return(180+c)/360}function h0(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function d0(c,a){return c/c0(a)}function lm(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class dd{constructor(a,f,m=0){this.x=+a,this.y=+f,this.z=+m}static fromLngLat(a,f=0){const m=Ta.convert(a);return new dd(f0(m.lng),h0(m.lat),d0(f,m.lat))}toLngLat(){return new Ta(360*this.x-180,lm(this.y))}toAltitude(){return this.z*c0(lm(this.y))}meterInMercatorCoordinateUnits(){return 1/u0*(a=lm(this.y),1/Math.cos(a*Math.PI/180));var a}}function p0(c,a,f){var m=2*Math.PI*6378137/256/Math.pow(2,f);return[c*m-2*Math.PI*6378137/2,a*m-2*Math.PI*6378137/2]}class um{constructor(a,f,m){if(a<0||a>25||m<0||m>=Math.pow(2,a)||f<0||f>=Math.pow(2,a))throw new Error(`x=${f}, y=${m}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=f,this.y=m,this.key=sf(0,a,a,f,m)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,f,m){const b=(S=this.y,M=this.z,F=p0(256*(k=this.x),256*(S=Math.pow(2,M)-S-1),M),j=p0(256*(k+1),256*(S+1),M),F[0]+","+F[1]+","+j[0]+","+j[1]);var k,S,M,F,j;const X=function(Q,se,pe){let _e,be="";for(let Ce=Q;Ce>0;Ce--)_e=1<<Ce-1,be+=(se&_e?1:0)+(pe&_e?2:0);return be}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,X).replace(/{bbox-epsg-3857}/g,b)}isChildOf(a){const f=this.z-a.z;return f>0&&a.x===this.x>>f&&a.y===this.y>>f}getTilePoint(a){const f=Math.pow(2,this.z);return new _((a.x*f-this.x)*jr,(a.y*f-this.y)*jr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class m0{constructor(a,f){this.wrap=a,this.canonical=f,this.key=sf(a,f.z,f.z,f.x,f.y)}}class Mo{constructor(a,f,m,b,k){if(a<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${m}`);this.overscaledZ=a,this.wrap=f,this.canonical=new um(m,+b,+k),this.key=sf(f,a,m,b,k)}clone(){return new Mo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-a;return a>this.canonical.z?new Mo(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Mo(a,this.wrap,a,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(a,f){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-a;return a>this.canonical.z?sf(this.wrap*+f,a,this.canonical.z,this.canonical.x,this.canonical.y):sf(this.wrap*+f,a,a,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const f=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>f&&a.canonical.y===this.canonical.y>>f}children(a){if(this.overscaledZ>=a)return[new Mo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,m=2*this.canonical.x,b=2*this.canonical.y;return[new Mo(f,this.wrap,f,m,b),new Mo(f,this.wrap,f,m+1,b),new Mo(f,this.wrap,f,m,b+1),new Mo(f,this.wrap,f,m+1,b+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Mo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Mo(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new m0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new dd(a.x-this.wrap,a.y))}}function sf(c,a,f,m,b){(c*=2)<0&&(c=-1*c-1);const k=1<<f;return(k*k*c+k*b+m).toString(36)+f.toString(36)+a.toString(36)}Zt("CanonicalTileID",um),Zt("OverscaledTileID",Mo,{omit:["posMatrix"]});class g0{constructor(a,f,m,b=1,k=1,S=1,M=0){if(this.uid=a,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void ke(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const F=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=k,this.blueFactor=S,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let j=0;j<F;j++)this.data[this._idx(-1,j)]=this.data[this._idx(0,j)],this.data[this._idx(F,j)]=this.data[this._idx(F-1,j)],this.data[this._idx(j,-1)]=this.data[this._idx(j,0)],this.data[this._idx(j,F)]=this.data[this._idx(j,F-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(F,-1)]=this.data[this._idx(F-1,0)],this.data[this._idx(-1,F)]=this.data[this._idx(0,F-1)],this.data[this._idx(F,F)]=this.data[this._idx(F-1,F-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let j=0;j<F;j++)for(let X=0;X<F;X++){const Q=this.get(j,X);Q>this.max&&(this.max=Q),Q<this.min&&(this.min=Q)}}get(a,f){const m=new Uint8Array(this.data.buffer),b=4*this._idx(a,f);return this.unpack(m[b],m[b+1],m[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,f){if(a<-1||a>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(a+1)}unpack(a,f,m){return a*this.redFactor+f*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new To({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,f,m){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let b=f*this.dim,k=f*this.dim+this.dim,S=m*this.dim,M=m*this.dim+this.dim;switch(f){case-1:b=k-1;break;case 1:k=b+1}switch(m){case-1:S=M-1;break;case 1:M=S+1}const F=-f*this.dim,j=-m*this.dim;for(let X=S;X<M;X++)for(let Q=b;Q<k;Q++)this.data[this._idx(Q,X)]=a.data[this._idx(Q+F,X+j)]}}Zt("DEMData",g0);class _0{constructor(a){this._stringToNumber={},this._numberToString=[];for(let f=0;f<a.length;f++){const m=a[f];this._stringToNumber[m]=f,this._numberToString[f]=m}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class y0{constructor(a,f,m,b,k){this.type="Feature",this._vectorTileFeature=a,a._z=f,a._x=m,a._y=b,this.properties=a.properties,this.id=k}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(a[f]=this[f]);return a}}class v0{constructor(a,f){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new hl(jr,16,0),this.grid3D=new hl(jr,16,0),this.featureIndexArray=new ee,this.promoteId=f}insert(a,f,m,b,k,S){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,b,k);const F=S?this.grid3D:this.grid;for(let j=0;j<f.length;j++){const X=f[j],Q=[1/0,1/0,-1/0,-1/0];for(let se=0;se<X.length;se++){const pe=X[se];Q[0]=Math.min(Q[0],pe.x),Q[1]=Math.min(Q[1],pe.y),Q[2]=Math.max(Q[2],pe.x),Q[3]=Math.max(Q[3],pe.y)}Q[0]<jr&&Q[1]<jr&&Q[2]>=0&&Q[3]>=0&&F.insert(M,Q[0],Q[1],Q[2],Q[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ka.VectorTile(new Jp(this.rawTileData)).layers,this.sourceLayerCoder=new _0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,f,m,b){this.loadVTLayers();const k=a.params||{},S=jr/a.tileSize/a.scale,M=iu(k.filter),F=a.queryGeometry,j=a.queryPadding*S,X=w0(F),Q=this.grid.query(X.minX-j,X.minY-j,X.maxX+j,X.maxY+j),se=w0(a.cameraQueryGeometry),pe=this.grid3D.query(se.minX-j,se.minY-j,se.maxX+j,se.maxY+j,(Ce,Pe,We,Re)=>function(je,ht,_t,Ht,sn){for(const jt of je)if(ht<=jt.x&&_t<=jt.y&&Ht>=jt.x&&sn>=jt.y)return!0;const qt=[new _(ht,_t),new _(ht,sn),new _(Ht,sn),new _(Ht,_t)];if(je.length>2){for(const jt of qt)if(ku(je,jt))return!0}for(let jt=0;jt<je.length-1;jt++)if(ox(je[jt],je[jt+1],qt))return!0;return!1}(a.cameraQueryGeometry,Ce-j,Pe-j,We+j,Re+j));for(const Ce of pe)Q.push(Ce);Q.sort(MA);const _e={};let be;for(let Ce=0;Ce<Q.length;Ce++){const Pe=Q[Ce];if(Pe===be)continue;be=Pe;const We=this.featureIndexArray.get(Pe);let Re=null;this.loadMatchingFeature(_e,We.bucketIndex,We.sourceLayerIndex,We.featureIndex,M,k.layers,k.availableImages,f,m,b,(je,ht,_t)=>(Re||(Re=Xs(je)),ht.queryIntersectsFeature(F,je,_t,Re,this.z,a.transform,S,a.pixelPosMatrix)))}return _e}loadMatchingFeature(a,f,m,b,k,S,M,F,j,X,Q){const se=this.bucketLayerIDs[f];if(S&&!function(Ce,Pe){for(let We=0;We<Ce.length;We++)if(Pe.indexOf(Ce[We])>=0)return!0;return!1}(S,se))return;const pe=this.sourceLayerCoder.decode(m),_e=this.vtLayers[pe].feature(b);if(k.needGeometry){const Ce=Ks(_e,!0);if(!k.filter(new Tr(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!k.filter(new Tr(this.tileID.overscaledZ),_e))return;const be=this.getId(_e,pe);for(let Ce=0;Ce<se.length;Ce++){const Pe=se[Ce];if(S&&S.indexOf(Pe)<0)continue;const We=F[Pe];if(!We)continue;let Re={};be&&X&&(Re=X.getState(We.sourceLayer||"_geojsonTileLayer",be));const je=q({},j[Pe]);je.paint=b0(je.paint,We.paint,_e,Re,M),je.layout=b0(je.layout,We.layout,_e,Re,M);const ht=!Q||Q(_e,We,Re);if(!ht)continue;const _t=new y0(_e,this.z,this.x,this.y,be);_t.layer=je;let Ht=a[Pe];Ht===void 0&&(Ht=a[Pe]=[]),Ht.push({featureIndex:b,feature:_t,intersectionZ:ht})}}lookupSymbolFeatures(a,f,m,b,k,S,M,F){const j={};this.loadVTLayers();const X=iu(k);for(const Q of a)this.loadMatchingFeature(j,m,b,Q,X,S,M,F,f);return j}hasLayer(a){for(const f of this.bucketLayerIDs)for(const m of f)if(a===m)return!0;return!1}getId(a,f){let m=a.id;return this.promoteId&&(m=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof m=="boolean"&&(m=Number(m))),m}}function b0(c,a,f,m,b){return he(c,(k,S)=>{const M=a instanceof pl?a.get(S):null;return M&&M.evaluate?M.evaluate(f,m,b):M})}function w0(c){let a=1/0,f=1/0,m=-1/0,b=-1/0;for(const k of c)a=Math.min(a,k.x),f=Math.min(f,k.y),m=Math.max(m,k.x),b=Math.max(b,k.y);return{minX:a,minY:f,maxX:m,maxY:b}}function MA(c,a){return a-c}function x0(c,a,f,m,b){const k=[];for(let S=0;S<c.length;S++){const M=c[S];let F;for(let j=0;j<M.length-1;j++){let X=M[j],Q=M[j+1];X.x<a&&Q.x<a||(X.x<a?X=new _(a,X.y+(a-X.x)/(Q.x-X.x)*(Q.y-X.y))._round():Q.x<a&&(Q=new _(a,X.y+(a-X.x)/(Q.x-X.x)*(Q.y-X.y))._round()),X.y<f&&Q.y<f||(X.y<f?X=new _(X.x+(f-X.y)/(Q.y-X.y)*(Q.x-X.x),f)._round():Q.y<f&&(Q=new _(X.x+(f-X.y)/(Q.y-X.y)*(Q.x-X.x),f)._round()),X.x>=m&&Q.x>=m||(X.x>=m?X=new _(m,X.y+(m-X.x)/(Q.x-X.x)*(Q.y-X.y))._round():Q.x>=m&&(Q=new _(m,X.y+(m-X.x)/(Q.x-X.x)*(Q.y-X.y))._round()),X.y>=b&&Q.y>=b||(X.y>=b?X=new _(X.x+(b-X.y)/(Q.y-X.y)*(Q.x-X.x),b)._round():Q.y>=b&&(Q=new _(X.x+(b-X.y)/(Q.y-X.y)*(Q.x-X.x),b)._round()),F&&X.equals(F[F.length-1])||(F=[X],k.push(F)),F.push(Q)))))}}return k}Zt("FeatureIndex",v0,{omit:["rawTileData","sourceLayerCoder"]});class Ma extends _{constructor(a,f,m,b){super(a,f),this.angle=m,b!==void 0&&(this.segment=b)}clone(){return new Ma(this.x,this.y,this.angle,this.segment)}}function A0(c,a,f,m,b){if(a.segment===void 0||f===0)return!0;let k=a,S=a.segment+1,M=0;for(;M>-f/2;){if(S--,S<0)return!1;M-=c[S].dist(k),k=c[S]}M+=c[S].dist(c[S+1]),S++;const F=[];let j=0;for(;M<f/2;){const X=c[S],Q=c[S+1];if(!Q)return!1;let se=c[S-1].angleTo(X)-X.angleTo(Q);for(se=Math.abs((se+3*Math.PI)%(2*Math.PI)-Math.PI),F.push({distance:M,angleDelta:se}),j+=se;M-F[0].distance>m;)j-=F.shift().angleDelta;if(j>b)return!1;S++,M+=X.dist(Q)}return!0}function k0(c){let a=0;for(let f=0;f<c.length-1;f++)a+=c[f].dist(c[f+1]);return a}function S0(c,a,f){return c?.6*a*f:0}function C0(c,a){return Math.max(c?c.right-c.left:0,a?a.right-a.left:0)}function EA(c,a,f,m,b,k){const S=S0(f,b,k),M=C0(f,m)*k;let F=0;const j=k0(c)/2;for(let X=0;X<c.length-1;X++){const Q=c[X],se=c[X+1],pe=Q.dist(se);if(F+pe>j){const _e=(j-F)/pe,be=Ti.number(Q.x,se.x,_e),Ce=Ti.number(Q.y,se.y,_e),Pe=new Ma(be,Ce,se.angleTo(Q),X);return Pe._round(),!S||A0(c,Pe,M,S,a)?Pe:void 0}F+=pe}}function LA(c,a,f,m,b,k,S,M,F){const j=S0(m,k,S),X=C0(m,b),Q=X*S,se=c[0].x===0||c[0].x===F||c[0].y===0||c[0].y===F;return a-Q<a/4&&(a=Q+a/4),T0(c,se?a/2*M%a:(X/2+2*k)*S*M%a,a,j,f,Q,se,!1,F)}function T0(c,a,f,m,b,k,S,M,F){const j=k/2,X=k0(c);let Q=0,se=a-f,pe=[];for(let _e=0;_e<c.length-1;_e++){const be=c[_e],Ce=c[_e+1],Pe=be.dist(Ce),We=Ce.angleTo(be);for(;se+f<Q+Pe;){se+=f;const Re=(se-Q)/Pe,je=Ti.number(be.x,Ce.x,Re),ht=Ti.number(be.y,Ce.y,Re);if(je>=0&&je<F&&ht>=0&&ht<F&&se-j>=0&&se+j<=X){const _t=new Ma(je,ht,We,_e);_t._round(),m&&!A0(c,_t,k,m,b)||pe.push(_t)}}Q+=Pe}return M||pe.length||S||(pe=T0(c,Q/2,f,m,b,k,S,!0,F)),pe}Zt("Anchor",Ma);const Pu=ro;function M0(c,a,f,m){const b=[],k=c.image,S=k.pixelRatio,M=k.paddedRect.w-2*Pu,F=k.paddedRect.h-2*Pu,j=c.right-c.left,X=c.bottom-c.top,Q=k.stretchX||[[0,M]],se=k.stretchY||[[0,F]],pe=(Bt,Xt)=>Bt+Xt[1]-Xt[0],_e=Q.reduce(pe,0),be=se.reduce(pe,0),Ce=M-_e,Pe=F-be;let We=0,Re=_e,je=0,ht=be,_t=0,Ht=Ce,sn=0,qt=Pe;if(k.content&&m){const Bt=k.content;We=pd(Q,0,Bt[0]),je=pd(se,0,Bt[1]),Re=pd(Q,Bt[0],Bt[2]),ht=pd(se,Bt[1],Bt[3]),_t=Bt[0]-We,sn=Bt[1]-je,Ht=Bt[2]-Bt[0]-Re,qt=Bt[3]-Bt[1]-ht}const jt=(Bt,Xt,Nt,Pt)=>{const hn=md(Bt.stretch-We,Re,j,c.left),an=gd(Bt.fixed-_t,Ht,Bt.stretch,_e),Fn=md(Xt.stretch-je,ht,X,c.top),xr=gd(Xt.fixed-sn,qt,Xt.stretch,be),Er=md(Nt.stretch-We,Re,j,c.left),si=gd(Nt.fixed-_t,Ht,Nt.stretch,_e),go=md(Pt.stretch-je,ht,X,c.top),Ni=gd(Pt.fixed-sn,qt,Pt.stretch,be),Jr=new _(hn,Fn),_i=new _(Er,Fn),Ai=new _(Er,go),ji=new _(hn,go),Ui=new _(an/S,xr/S),ai=new _(si/S,Ni/S),li=a*Math.PI/180;if(li){const Li=Math.sin(li),io=Math.cos(li),oo=[io,-Li,Li,io];Jr._matMult(oo),_i._matMult(oo),ji._matMult(oo),Ai._matMult(oo)}const Ei=Bt.stretch+Bt.fixed,Vi=Xt.stretch+Xt.fixed;return{tl:Jr,tr:_i,bl:ji,br:Ai,tex:{x:k.paddedRect.x+Pu+Ei,y:k.paddedRect.y+Pu+Vi,w:Nt.stretch+Nt.fixed-Ei,h:Pt.stretch+Pt.fixed-Vi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ui,pixelOffsetBR:ai,minFontScaleX:Ht/S/j,minFontScaleY:qt/S/X,isSDF:f}};if(m&&(k.stretchX||k.stretchY)){const Bt=E0(Q,Ce,_e),Xt=E0(se,Pe,be);for(let Nt=0;Nt<Bt.length-1;Nt++){const Pt=Bt[Nt],hn=Bt[Nt+1];for(let an=0;an<Xt.length-1;an++)b.push(jt(Pt,Xt[an],hn,Xt[an+1]))}}else b.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:F+1}));return b}function pd(c,a,f){let m=0;for(const b of c)m+=Math.max(a,Math.min(f,b[1]))-Math.max(a,Math.min(f,b[0]));return m}function E0(c,a,f){const m=[{fixed:-Pu,stretch:0}];for(const[b,k]of c){const S=m[m.length-1];m.push({fixed:b-S.stretch,stretch:S.stretch}),m.push({fixed:b-S.stretch,stretch:S.stretch+(k-b)})}return m.push({fixed:a+Pu,stretch:f}),m}function md(c,a,f,m){return c/a*f+m}function gd(c,a,f,m){return c-a*f/m}class _d{constructor(a,f,m,b,k,S,M,F,j,X){if(this.boxStartIndex=a.length,j){let Q=S.top,se=S.bottom;const pe=S.collisionPadding;pe&&(Q-=pe[1],se+=pe[3]);let _e=se-Q;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{let Q=S.top*M-F[0],se=S.bottom*M+F[2],pe=S.left*M-F[3],_e=S.right*M+F[1];const be=S.collisionPadding;if(be&&(pe-=be[0]*M,Q-=be[1]*M,_e+=be[2]*M,se+=be[3]*M),X){const Ce=new _(pe,Q),Pe=new _(_e,Q),We=new _(pe,se),Re=new _(_e,se),je=X*Math.PI/180;Ce._rotate(je),Pe._rotate(je),We._rotate(je),Re._rotate(je),pe=Math.min(Ce.x,Pe.x,We.x,Re.x),_e=Math.max(Ce.x,Pe.x,We.x,Re.x),Q=Math.min(Ce.y,Pe.y,We.y,Re.y),se=Math.max(Ce.y,Pe.y,We.y,Re.y)}a.emplaceBack(f.x,f.y,pe,Q,_e,se,m,b,k)}this.boxEndIndex=a.length}}class IA{constructor(a=[],f=PA){if(this.data=a,this.length=this.data.length,this.compare=f,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const a=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:f,compare:m}=this,b=f[a];for(;a>0;){const k=a-1>>1,S=f[k];if(m(b,S)>=0)break;f[a]=S,a=k}f[a]=b}_down(a){const{data:f,compare:m}=this,b=this.length>>1,k=f[a];for(;a<b;){let S=1+(a<<1),M=f[S];const F=S+1;if(F<this.length&&m(f[F],M)<0&&(S=F,M=f[F]),m(M,k)>=0)break;f[a]=M,a=S}f[a]=k}}function PA(c,a){return c<a?-1:c>a?1:0}function zA(c,a=1,f=!1){let m=1/0,b=1/0,k=-1/0,S=-1/0;const M=c[0];for(let pe=0;pe<M.length;pe++){const _e=M[pe];(!pe||_e.x<m)&&(m=_e.x),(!pe||_e.y<b)&&(b=_e.y),(!pe||_e.x>k)&&(k=_e.x),(!pe||_e.y>S)&&(S=_e.y)}const F=Math.min(k-m,S-b);let j=F/2;const X=new IA([],DA);if(F===0)return new _(m,b);for(let pe=m;pe<k;pe+=F)for(let _e=b;_e<S;_e+=F)X.push(new zu(pe+j,_e+j,j,c));let Q=function(pe){let _e=0,be=0,Ce=0;const Pe=pe[0];for(let We=0,Re=Pe.length,je=Re-1;We<Re;je=We++){const ht=Pe[We],_t=Pe[je],Ht=ht.x*_t.y-_t.x*ht.y;be+=(ht.x+_t.x)*Ht,Ce+=(ht.y+_t.y)*Ht,_e+=3*Ht}return new zu(be/_e,Ce/_e,0,pe)}(c),se=X.length;for(;X.length;){const pe=X.pop();(pe.d>Q.d||!Q.d)&&(Q=pe,f&&console.log("found best %d after %d probes",Math.round(1e4*pe.d)/1e4,se)),pe.max-Q.d<=a||(j=pe.h/2,X.push(new zu(pe.p.x-j,pe.p.y-j,j,c)),X.push(new zu(pe.p.x+j,pe.p.y-j,j,c)),X.push(new zu(pe.p.x-j,pe.p.y+j,j,c)),X.push(new zu(pe.p.x+j,pe.p.y+j,j,c)),se+=4)}return f&&(console.log(`num probes: ${se}`),console.log(`best distance: ${Q.d}`)),Q.p}function DA(c,a){return a.max-c.max}function zu(c,a,f,m){this.p=new _(c,a),this.h=f,this.d=function(b,k){let S=!1,M=1/0;for(let F=0;F<k.length;F++){const j=k[F];for(let X=0,Q=j.length,se=Q-1;X<Q;se=X++){const pe=j[X],_e=j[se];pe.y>b.y!=_e.y>b.y&&b.x<(_e.x-pe.x)*(b.y-pe.y)/(_e.y-pe.y)+pe.x&&(S=!S),M=Math.min(M,h_(b,pe,_e))}}return(S?1:-1)*Math.sqrt(M)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var xi;u.ap=void 0,(xi=u.ap||(u.ap={}))[xi.center=1]="center",xi[xi.left=2]="left",xi[xi.right=3]="right",xi[xi.top=4]="top",xi[xi.bottom=5]="bottom",xi[xi["top-left"]=6]="top-left",xi[xi["top-right"]=7]="top-right",xi[xi["bottom-left"]=8]="bottom-left",xi[xi["bottom-right"]=9]="bottom-right";const Ea=7,cm=Number.POSITIVE_INFINITY;function L0(c,a){return a[1]!==cm?function(f,m,b){let k=0,S=0;switch(m=Math.abs(m),b=Math.abs(b),f){case"top-right":case"top-left":case"top":S=b-Ea;break;case"bottom-right":case"bottom-left":case"bottom":S=-b+Ea}switch(f){case"top-right":case"bottom-right":case"right":k=-m;break;case"top-left":case"bottom-left":case"left":k=m}return[k,S]}(c,a[0],a[1]):function(f,m){let b=0,k=0;m<0&&(m=0);const S=m/Math.SQRT2;switch(f){case"top-right":case"top-left":k=S-Ea;break;case"bottom-right":case"bottom-left":k=-S+Ea;break;case"bottom":k=-m+Ea;break;case"top":k=m-Ea}switch(f){case"top-right":case"bottom-right":b=-S;break;case"top-left":case"bottom-left":b=S;break;case"left":b=m;break;case"right":b=-m}return[b,k]}(c,a[0])}function I0(c,a,f){var m;const b=c.layout,k=(m=b.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(a,{},f);if(k){const M=k.values,F=[];for(let j=0;j<M.length;j+=2){const X=F[j]=M[j],Q=M[j+1].map(se=>se*oi);X.startsWith("top")?Q[1]-=Ea:X.startsWith("bottom")&&(Q[1]+=Ea),F[j+1]=Q}return new fo(F)}const S=b.get("text-variable-anchor");if(S){let M;M=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(a,{},f)*oi,cm]:b.get("text-offset").evaluate(a,{},f).map(j=>j*oi);const F=[];for(const j of S)F.push(j,L0(j,M));return new fo(F)}return null}function fm(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function RA(c,a,f,m,b,k,S,M,F,j,X){let Q=k.textMaxSize.evaluate(a,{});Q===void 0&&(Q=S);const se=c.layers[0].layout,pe=se.get("icon-offset").evaluate(a,{},X),_e=z0(f.horizontal),be=S/24,Ce=c.tilePixelRatio*be,Pe=c.tilePixelRatio*Q/24,We=c.tilePixelRatio*M,Re=c.tilePixelRatio*se.get("symbol-spacing"),je=se.get("text-padding")*c.tilePixelRatio,ht=function(Pt,hn,an,Fn=1){const xr=Pt.get("icon-padding").evaluate(hn,{},an),Er=xr&&xr.values;return[Er[0]*Fn,Er[1]*Fn,Er[2]*Fn,Er[3]*Fn]}(se,a,X,c.tilePixelRatio),_t=se.get("text-max-angle")/180*Math.PI,Ht=se.get("text-rotation-alignment")!=="viewport"&&se.get("symbol-placement")!=="point",sn=se.get("icon-rotation-alignment")==="map"&&se.get("symbol-placement")!=="point",qt=se.get("symbol-placement"),jt=Re/2,Bt=se.get("icon-text-fit");let Xt;m&&Bt!=="none"&&(c.allowVerticalPlacement&&f.vertical&&(Xt=n0(m,f.vertical,Bt,se.get("icon-text-fit-padding"),pe,be)),_e&&(m=n0(m,_e,Bt,se.get("icon-text-fit-padding"),pe,be)));const Nt=(Pt,hn)=>{hn.x<0||hn.x>=jr||hn.y<0||hn.y>=jr||function(an,Fn,xr,Er,si,go,Ni,Jr,_i,Ai,ji,Ui,ai,li,Ei,Vi,Li,io,oo,ui,qn,Ii,ki,ci,Zo){const us=an.addToLineVertexArray(Fn,xr);let cs,Ys,Xo,Eo,so=0,Qs=0,uf=0,F0=0,vm=-1,bm=-1;const ea={};let O0=Or("");if(an.allowVerticalPlacement&&Er.vertical){const Pi=Jr.layout.get("text-rotate").evaluate(qn,{},ci)+90;Xo=new _d(_i,Fn,Ai,ji,Ui,Er.vertical,ai,li,Ei,Pi),Ni&&(Eo=new _d(_i,Fn,Ai,ji,Ui,Ni,Li,io,Ei,Pi))}if(si){const Pi=Jr.layout.get("icon-rotate").evaluate(qn,{}),Lo=Jr.layout.get("icon-text-fit")!=="none",Al=M0(si,Pi,ki,Lo),hs=Ni?M0(Ni,Pi,ki,Lo):void 0;Ys=new _d(_i,Fn,Ai,ji,Ui,si,Li,io,!1,Pi),so=4*Al.length;const kl=an.iconSizeData;let Ps=null;kl.kind==="source"?(Ps=[Is*Jr.layout.get("icon-size").evaluate(qn,{})],Ps[0]>Ca&&ke(`${an.layerIds[0]}: Value for "icon-size" is >= ${of}. Reduce your "icon-size".`)):kl.kind==="composite"&&(Ps=[Is*Ii.compositeIconSizes[0].evaluate(qn,{},ci),Is*Ii.compositeIconSizes[1].evaluate(qn,{},ci)],(Ps[0]>Ca||Ps[1]>Ca)&&ke(`${an.layerIds[0]}: Value for "icon-size" is >= ${of}. Reduce your "icon-size".`)),an.addSymbols(an.icon,Al,Ps,ui,oo,qn,u.ah.none,Fn,us.lineStartIndex,us.lineLength,-1,ci),vm=an.icon.placedSymbolArray.length-1,hs&&(Qs=4*hs.length,an.addSymbols(an.icon,hs,Ps,ui,oo,qn,u.ah.vertical,Fn,us.lineStartIndex,us.lineLength,-1,ci),bm=an.icon.placedSymbolArray.length-1)}const $0=Object.keys(Er.horizontal);for(const Pi of $0){const Lo=Er.horizontal[Pi];if(!cs){O0=Or(Lo.text);const hs=Jr.layout.get("text-rotate").evaluate(qn,{},ci);cs=new _d(_i,Fn,Ai,ji,Ui,Lo,ai,li,Ei,hs)}const Al=Lo.positionedLines.length===1;if(uf+=P0(an,Fn,Lo,go,Jr,Ei,qn,Vi,us,Er.vertical?u.ah.horizontal:u.ah.horizontalOnly,Al?$0:[Pi],ea,vm,Ii,ci),Al)break}Er.vertical&&(F0+=P0(an,Fn,Er.vertical,go,Jr,Ei,qn,Vi,us,u.ah.vertical,["vertical"],ea,bm,Ii,ci));const OA=cs?cs.boxStartIndex:an.collisionBoxArray.length,$A=cs?cs.boxEndIndex:an.collisionBoxArray.length,NA=Xo?Xo.boxStartIndex:an.collisionBoxArray.length,jA=Xo?Xo.boxEndIndex:an.collisionBoxArray.length,UA=Ys?Ys.boxStartIndex:an.collisionBoxArray.length,VA=Ys?Ys.boxEndIndex:an.collisionBoxArray.length,qA=Eo?Eo.boxStartIndex:an.collisionBoxArray.length,HA=Eo?Eo.boxEndIndex:an.collisionBoxArray.length;let fs=-1;const vd=(Pi,Lo)=>Pi&&Pi.circleDiameter?Math.max(Pi.circleDiameter,Lo):Lo;fs=vd(cs,fs),fs=vd(Xo,fs),fs=vd(Ys,fs),fs=vd(Eo,fs);const N0=fs>-1?1:0;N0&&(fs*=Zo/oi),an.glyphOffsetArray.length>=Iu.MAX_GLYPHS&&ke("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),qn.sortKey!==void 0&&an.addToSortKeyRanges(an.symbolInstances.length,qn.sortKey);const GA=I0(Jr,qn,ci),[WA,ZA]=function(Pi,Lo){const Al=Pi.length,hs=Lo==null?void 0:Lo.values;if((hs==null?void 0:hs.length)>0)for(let kl=0;kl<hs.length;kl+=2){const Ps=hs[kl+1];Pi.emplaceBack(u.ap[hs[kl]],Ps[0],Ps[1])}return[Al,Pi.length]}(an.textAnchorOffsets,GA);an.symbolInstances.emplaceBack(Fn.x,Fn.y,ea.right>=0?ea.right:-1,ea.center>=0?ea.center:-1,ea.left>=0?ea.left:-1,ea.vertical||-1,vm,bm,O0,OA,$A,NA,jA,UA,VA,qA,HA,Ai,uf,F0,so,Qs,N0,0,ai,fs,WA,ZA)}(c,hn,Pt,f,m,b,Xt,c.layers[0],c.collisionBoxArray,a.index,a.sourceLayerIndex,c.index,Ce,[je,je,je,je],Ht,F,We,ht,sn,pe,a,k,j,X,S)};if(qt==="line")for(const Pt of x0(a.geometry,0,0,jr,jr)){const hn=LA(Pt,Re,_t,f.vertical||_e,m,24,Pe,c.overscaling,jr);for(const an of hn)_e&&BA(c,_e.text,jt,an)||Nt(Pt,an)}else if(qt==="line-center"){for(const Pt of a.geometry)if(Pt.length>1){const hn=EA(Pt,_t,f.vertical||_e,m,24,Pe);hn&&Nt(Pt,hn)}}else if(a.type==="Polygon")for(const Pt of Vp(a.geometry,0)){const hn=zA(Pt,16);Nt(Pt[0],new Ma(hn.x,hn.y,0))}else if(a.type==="LineString")for(const Pt of a.geometry)Nt(Pt,new Ma(Pt[0].x,Pt[0].y,0));else if(a.type==="Point")for(const Pt of a.geometry)for(const hn of Pt)Nt([hn],new Ma(hn.x,hn.y,0))}function P0(c,a,f,m,b,k,S,M,F,j,X,Q,se,pe,_e){const be=function(We,Re,je,ht,_t,Ht,sn,qt){const jt=ht.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,Bt=[];for(const Xt of Re.positionedLines)for(const Nt of Xt.positionedGlyphs){if(!Nt.rect)continue;const Pt=Nt.rect||{};let hn=X_+1,an=!0,Fn=1,xr=0;const Er=(_t||qt)&&Nt.vertical,si=Nt.metrics.advance*Nt.scale/2;if(qt&&Re.verticalizable&&(xr=Xt.lineOffset/2-(Nt.imageName?-(oi-Nt.metrics.width*Nt.scale)/2:(Nt.scale-1)*oi)),Nt.imageName){const ui=sn[Nt.imageName];an=ui.sdf,Fn=ui.pixelRatio,hn=ro/Fn}const go=_t?[Nt.x+si,Nt.y]:[0,0];let Ni=_t?[0,0]:[Nt.x+si+je[0],Nt.y+je[1]-xr],Jr=[0,0];Er&&(Jr=Ni,Ni=[0,0]);const _i=Nt.metrics.isDoubleResolution?2:1,Ai=(Nt.metrics.left-hn)*Nt.scale-si+Ni[0],ji=(-Nt.metrics.top-hn)*Nt.scale+Ni[1],Ui=Ai+Pt.w/_i*Nt.scale/Fn,ai=ji+Pt.h/_i*Nt.scale/Fn,li=new _(Ai,ji),Ei=new _(Ui,ji),Vi=new _(Ai,ai),Li=new _(Ui,ai);if(Er){const ui=new _(-si,si-nf),qn=-Math.PI/2,Ii=oi/2-si,ki=new _(5-nf-Ii,-(Nt.imageName?Ii:0)),ci=new _(...Jr);li._rotateAround(qn,ui)._add(ki)._add(ci),Ei._rotateAround(qn,ui)._add(ki)._add(ci),Vi._rotateAround(qn,ui)._add(ki)._add(ci),Li._rotateAround(qn,ui)._add(ki)._add(ci)}if(jt){const ui=Math.sin(jt),qn=Math.cos(jt),Ii=[qn,-ui,ui,qn];li._matMult(Ii),Ei._matMult(Ii),Vi._matMult(Ii),Li._matMult(Ii)}const io=new _(0,0),oo=new _(0,0);Bt.push({tl:li,tr:Ei,bl:Vi,br:Li,tex:Pt,writingMode:Re.writingMode,glyphOffset:go,sectionIndex:Nt.sectionIndex,isSDF:an,pixelOffsetTL:io,pixelOffsetBR:oo,minFontScaleX:0,minFontScaleY:0})}return Bt}(0,f,M,b,k,S,m,c.allowVerticalPlacement),Ce=c.textSizeData;let Pe=null;Ce.kind==="source"?(Pe=[Is*b.layout.get("text-size").evaluate(S,{})],Pe[0]>Ca&&ke(`${c.layerIds[0]}: Value for "text-size" is >= ${of}. Reduce your "text-size".`)):Ce.kind==="composite"&&(Pe=[Is*pe.compositeTextSizes[0].evaluate(S,{},_e),Is*pe.compositeTextSizes[1].evaluate(S,{},_e)],(Pe[0]>Ca||Pe[1]>Ca)&&ke(`${c.layerIds[0]}: Value for "text-size" is >= ${of}. Reduce your "text-size".`)),c.addSymbols(c.text,be,Pe,M,k,S,j,a,F.lineStartIndex,F.lineLength,se,_e);for(const We of X)Q[We]=c.text.placedSymbolArray.length-1;return 4*be.length}function z0(c){for(const a in c)return c[a];return null}function BA(c,a,f,m){const b=c.compareText;if(a in b){const k=b[a];for(let S=k.length-1;S>=0;S--)if(m.dist(k[S])<f)return!0}else b[a]=[];return b[a].push(m),!1}const D0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hm{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,m]=new Uint8Array(a,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=m>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const k=D0[15&m];if(!k)throw new Error("Unrecognized array type.");const[S]=new Uint16Array(a,2,1),[M]=new Uint32Array(a,4,1);return new hm(M,S,k,a)}constructor(a,f=64,m=Float64Array,b){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=m,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const k=D0.indexOf(this.ArrayType),S=2*a*this.ArrayType.BYTES_PER_ELEMENT,M=a*this.IndexArrayType.BYTES_PER_ELEMENT,F=(8-M%8)%8;if(k<0)throw new Error(`Unexpected typed array class: ${m}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+F,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+S+M+F),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+M+F,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+k]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=a)}add(a,f){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=a,this.coords[this._pos++]=f,m}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return dm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,f,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:k,coords:S,nodeSize:M}=this,F=[0,k.length-1,0],j=[];for(;F.length;){const X=F.pop()||0,Q=F.pop()||0,se=F.pop()||0;if(Q-se<=M){for(let Ce=se;Ce<=Q;Ce++){const Pe=S[2*Ce],We=S[2*Ce+1];Pe>=a&&Pe<=m&&We>=f&&We<=b&&j.push(k[Ce])}continue}const pe=se+Q>>1,_e=S[2*pe],be=S[2*pe+1];_e>=a&&_e<=m&&be>=f&&be<=b&&j.push(k[pe]),(X===0?a<=_e:f<=be)&&(F.push(se),F.push(pe-1),F.push(1-X)),(X===0?m>=_e:b>=be)&&(F.push(pe+1),F.push(Q),F.push(1-X))}return j}within(a,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:k,nodeSize:S}=this,M=[0,b.length-1,0],F=[],j=m*m;for(;M.length;){const X=M.pop()||0,Q=M.pop()||0,se=M.pop()||0;if(Q-se<=S){for(let Ce=se;Ce<=Q;Ce++)B0(k[2*Ce],k[2*Ce+1],a,f)<=j&&F.push(b[Ce]);continue}const pe=se+Q>>1,_e=k[2*pe],be=k[2*pe+1];B0(_e,be,a,f)<=j&&F.push(b[pe]),(X===0?a-m<=_e:f-m<=be)&&(M.push(se),M.push(pe-1),M.push(1-X)),(X===0?a+m>=_e:f+m>=be)&&(M.push(pe+1),M.push(Q),M.push(1-X))}return F}}function dm(c,a,f,m,b,k){if(b-m<=f)return;const S=m+b>>1;R0(c,a,S,m,b,k),dm(c,a,f,m,S-1,1-k),dm(c,a,f,S+1,b,1-k)}function R0(c,a,f,m,b,k){for(;b>m;){if(b-m>600){const j=b-m+1,X=f-m+1,Q=Math.log(j),se=.5*Math.exp(2*Q/3),pe=.5*Math.sqrt(Q*se*(j-se)/j)*(X-j/2<0?-1:1);R0(c,a,f,Math.max(m,Math.floor(f-X*se/j+pe)),Math.min(b,Math.floor(f+(j-X)*se/j+pe)),k)}const S=a[2*f+k];let M=m,F=b;for(af(c,a,m,f),a[2*b+k]>S&&af(c,a,m,b);M<F;){for(af(c,a,M,F),M++,F--;a[2*M+k]<S;)M++;for(;a[2*F+k]>S;)F--}a[2*m+k]===S?af(c,a,m,F):(F++,af(c,a,F,b)),F<=f&&(m=F+1),f<=F&&(b=F-1)}}function af(c,a,f,m){pm(c,f,m),pm(a,2*f,2*m),pm(a,2*f+1,2*m+1)}function pm(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}function B0(c,a,f,m){const b=c-f,k=a-m;return b*b+k*k}var mm;u.bd=void 0,(mm=u.bd||(u.bd={})).create="create",mm.load="load",mm.fullLoad="fullLoad";let yd=null,lf=[];const gm=1e3/60,_m="loadTime",ym="fullLoadTime",FA={mark(c){performance.mark(c)},frame(c){const a=c;yd!=null&&lf.push(a-yd),yd=a},clearMetrics(){yd=null,lf=[],performance.clearMeasures(_m),performance.clearMeasures(ym);for(const c in u.bd)performance.clearMarks(u.bd[c])},getPerformanceMetrics(){performance.measure(_m,u.bd.create,u.bd.load),performance.measure(ym,u.bd.create,u.bd.fullLoad);const c=performance.getEntriesByName(_m)[0].duration,a=performance.getEntriesByName(ym)[0].duration,f=lf.length,m=1/(lf.reduce((k,S)=>k+S,0)/f/1e3),b=lf.filter(k=>k>gm).reduce((k,S)=>k+(S-gm)/gm,0);return{loadTime:c,fullLoadTime:a,fps:m,percentDroppedFrames:b/(f+b)*100,totalFrames:f}}};u.$=Ft,u.A=Su,u.B=function(c){if(De==null){const a=c.navigator?c.navigator.userAgent:null;De=!!c.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return De},u.C=class{constructor(c,a){this.target=c,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new TA(()=>this.process()),this.subscription=function(f,m,b,k){return f.addEventListener(m,b,!1),{unsubscribe:()=>{f.removeEventListener(m,b,!1)}}}(this.target,"message",f=>this.receive(f)),this.globalScope=Ue(self)?c:window}registerMessageHandler(c,a){this.messageHandlers[c]=a}sendAsync(c,a){return new Promise((f,m)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:f,reject:m},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const M={id:b,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},{once:!0});const k=[],S=Object.assign(Object.assign({},c),{id:b,sourceMapId:this.mapId,origin:location.origin,data:ba(c.data,k)});this.target.postMessage(S,{transfer:k})})}receive(c){const a=c.data,f=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[f];const m=this.abortControllers[f];return delete this.abortControllers[f],void(m&&m.abort())}if(Ue(self)||a.mustQueue)return this.tasks[f]=a,this.taskQueue.push(f),void this.invoker.trigger();this.processTask(f,a)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),a=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(c,a)}processTask(c,a){return s(this,void 0,void 0,function*(){if(a.type==="<response>"){const b=this.resolveRejects[c];return delete this.resolveRejects[c],b?void(a.error?b.reject(wa(a.error)):b.resolve(wa(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const f=wa(a.data),m=new AbortController;this.abortControllers[c]=m;try{const b=yield this.messageHandlers[a.type](a.sourceMapId,f,m);this.completeTask(c,null,b)}catch(b){this.completeTask(c,b)}})}completeTask(c,a,f){const m=[];delete this.abortControllers[c];const b={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?ba(a):null,data:ba(f,m)};this.target.postMessage(b,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=ln,u.E=et,u.F=function(){var c=new Su(16);return Su!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.G=Ot,u.H=function(c,a,f){var m,b,k,S,M,F,j,X,Q,se,pe,_e,be=f[0],Ce=f[1],Pe=f[2];return a===c?(c[12]=a[0]*be+a[4]*Ce+a[8]*Pe+a[12],c[13]=a[1]*be+a[5]*Ce+a[9]*Pe+a[13],c[14]=a[2]*be+a[6]*Ce+a[10]*Pe+a[14],c[15]=a[3]*be+a[7]*Ce+a[11]*Pe+a[15]):(b=a[1],k=a[2],S=a[3],M=a[4],F=a[5],j=a[6],X=a[7],Q=a[8],se=a[9],pe=a[10],_e=a[11],c[0]=m=a[0],c[1]=b,c[2]=k,c[3]=S,c[4]=M,c[5]=F,c[6]=j,c[7]=X,c[8]=Q,c[9]=se,c[10]=pe,c[11]=_e,c[12]=m*be+M*Ce+Q*Pe+a[12],c[13]=b*be+F*Ce+se*Pe+a[13],c[14]=k*be+j*Ce+pe*Pe+a[14],c[15]=S*be+X*Ce+_e*Pe+a[15]),c},u.I=Qp,u.J=function(c,a,f){var m=f[0],b=f[1],k=f[2];return c[0]=a[0]*m,c[1]=a[1]*m,c[2]=a[2]*m,c[3]=a[3]*m,c[4]=a[4]*b,c[5]=a[5]*b,c[6]=a[6]*b,c[7]=a[7]*b,c[8]=a[8]*k,c[9]=a[9]*k,c[10]=a[10]*k,c[11]=a[11]*k,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.K=g_,u.L=function(c,a){const f={};for(let m=0;m<a.length;m++){const b=a[m];b in c&&(f[b]=c[b])}return f},u.M=Ta,u.N=f0,u.O=h0,u.P=_,u.Q=Mo,u.R=To,u.S=E,u.T=Ic,u.U=I,u.V=Ze,u.W=jr,u.X=qr,u.Y=dd,u.Z=class extends Dc{},u._=s,u.a=xt,u.a$=function(c,a,f){return c[0]=a[0]*f[0],c[1]=a[1]*f[1],c[2]=a[2]*f[2],c[3]=a[3]*f[3],c},u.a0=um,u.a1=yt,u.a2=c=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(f=>{a.onloadstart=()=>{f(a)};for(const m of c){const b=window.document.createElement("source");fn(m)||(a.crossOrigin="Anonymous"),b.src=m,a.appendChild(b)}})},u.a3=function(){return J++},u.a4=w,u.a5=Iu,u.a6=iu,u.a7=Ks,u.a8=Tr,u.a9=y0,u.aA=Y,u.aB=function(c,a){if(!c)return[{command:"setStyle",args:[a]}];let f=[];try{if(!it(c.version,a.version))return[{command:"setStyle",args:[a]}];it(c.center,a.center)||f.push({command:"setCenter",args:[a.center]}),it(c.zoom,a.zoom)||f.push({command:"setZoom",args:[a.zoom]}),it(c.bearing,a.bearing)||f.push({command:"setBearing",args:[a.bearing]}),it(c.pitch,a.pitch)||f.push({command:"setPitch",args:[a.pitch]}),it(c.sprite,a.sprite)||f.push({command:"setSprite",args:[a.sprite]}),it(c.glyphs,a.glyphs)||f.push({command:"setGlyphs",args:[a.glyphs]}),it(c.transition,a.transition)||f.push({command:"setTransition",args:[a.transition]}),it(c.light,a.light)||f.push({command:"setLight",args:[a.light]}),it(c.terrain,a.terrain)||f.push({command:"setTerrain",args:[a.terrain]}),it(c.sky,a.sky)||f.push({command:"setSky",args:[a.sky]});const m={},b=[];(function(S,M,F,j){let X;for(X in M=M||{},S=S||{})Object.prototype.hasOwnProperty.call(S,X)&&(Object.prototype.hasOwnProperty.call(M,X)||jn(X,F,j));for(X in M)Object.prototype.hasOwnProperty.call(M,X)&&(Object.prototype.hasOwnProperty.call(S,X)?it(S[X],M[X])||(S[X].type==="geojson"&&M[X].type==="geojson"&&Wt(S,M,X)?Ut(F,{command:"setGeoJSONSourceData",args:[X,M[X].data]}):Nn(X,M,F,j)):Hn(X,M,F))})(c.sources,a.sources,b,m);const k=[];c.layers&&c.layers.forEach(S=>{"source"in S&&m[S.source]?f.push({command:"removeLayer",args:[S.id]}):k.push(S)}),f=f.concat(b),function(S,M,F){M=M||[];const j=(S=S||[]).map(ti),X=M.map(ti),Q=S.reduce(Bn,{}),se=M.reduce(Bn,{}),pe=j.slice(),_e=Object.create(null);let be,Ce,Pe,We,Re;for(let je=0,ht=0;je<j.length;je++)be=j[je],Object.prototype.hasOwnProperty.call(se,be)?ht++:(Ut(F,{command:"removeLayer",args:[be]}),pe.splice(pe.indexOf(be,ht),1));for(let je=0,ht=0;je<X.length;je++)be=X[X.length-1-je],pe[pe.length-1-je]!==be&&(Object.prototype.hasOwnProperty.call(Q,be)?(Ut(F,{command:"removeLayer",args:[be]}),pe.splice(pe.lastIndexOf(be,pe.length-ht),1)):ht++,We=pe[pe.length-je],Ut(F,{command:"addLayer",args:[se[be],We]}),pe.splice(pe.length-je,0,be),_e[be]=!0);for(let je=0;je<X.length;je++)if(be=X[je],Ce=Q[be],Pe=se[be],!_e[be]&&!it(Ce,Pe))if(it(Ce.source,Pe.source)&&it(Ce["source-layer"],Pe["source-layer"])&&it(Ce.type,Pe.type)){for(Re in An(Ce.layout,Pe.layout,F,be,null,"setLayoutProperty"),An(Ce.paint,Pe.paint,F,be,null,"setPaintProperty"),it(Ce.filter,Pe.filter)||Ut(F,{command:"setFilter",args:[be,Pe.filter]}),it(Ce.minzoom,Pe.minzoom)&&it(Ce.maxzoom,Pe.maxzoom)||Ut(F,{command:"setLayerZoomRange",args:[be,Pe.minzoom,Pe.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?An(Ce[Re],Pe[Re],F,be,Re.slice(6),"setPaintProperty"):it(Ce[Re],Pe[Re])||Ut(F,{command:"setLayerProperty",args:[be,Re,Pe[Re]]}));for(Re in Pe)Object.prototype.hasOwnProperty.call(Pe,Re)&&!Object.prototype.hasOwnProperty.call(Ce,Re)&&Re!=="layout"&&Re!=="paint"&&Re!=="filter"&&Re!=="metadata"&&Re!=="minzoom"&&Re!=="maxzoom"&&(Re.indexOf("paint.")===0?An(Ce[Re],Pe[Re],F,be,Re.slice(6),"setPaintProperty"):it(Ce[Re],Pe[Re])||Ut(F,{command:"setLayerProperty",args:[be,Re,Pe[Re]]}))}else Ut(F,{command:"removeLayer",args:[be]}),We=pe[pe.lastIndexOf(be)+1],Ut(F,{command:"addLayer",args:[Pe,We]})}(k,a.layers,f)}catch(m){console.warn("Unable to compute style diff:",m),f=[{command:"setStyle",args:[a]}]}return f},u.aC=function(c){const a=[],f=c.id;return f===void 0&&a.push({message:`layers.${f}: missing required property "id"`}),c.render===void 0&&a.push({message:`layers.${f}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&a.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),a},u.aD=function c(a,f){if(Array.isArray(a)){if(!Array.isArray(f)||a.length!==f.length)return!1;for(let m=0;m<a.length;m++)if(!c(a[m],f[m]))return!1;return!0}if(typeof a=="object"&&a!==null&&f!==null){if(typeof f!="object"||Object.keys(a).length!==Object.keys(f).length)return!1;for(const m in a)if(!c(a[m],f[m]))return!1;return!0}return a===f},u.aE=he,u.aF=Ee,u.aG=class extends ii{constructor(c,a){super(c,a),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aH=no,u.aI=class extends ii{constructor(c,a){super(c,a),this.current=wl}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let a=1;a<16;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aJ=Go,u.aK=class extends ii{constructor(c,a){super(c,a),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aL=class extends ii{constructor(c,a){super(c,a),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aM=Ms,u.aN=function(c,a,f,m,b,k,S){var M=1/(a-f),F=1/(m-b),j=1/(k-S);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*F,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*j,c[11]=0,c[12]=(a+f)*M,c[13]=(b+m)*F,c[14]=(S+k)*j,c[15]=1,c},u.aO=ar,u.aP=ax,u.aQ=class extends _u{},u.aR=tA,u.aS=class extends yu{},u.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aU=w_,u.aV=te,u.aW=class extends Nc{},u.aX=ut,u.aY=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]},u.aZ=function(c,a){var f=c[0],m=c[1],b=c[2],k=c[3],S=c[4],M=c[5],F=c[6],j=c[7],X=c[8],Q=c[9],se=c[10],pe=c[11],_e=c[12],be=c[13],Ce=c[14],Pe=c[15],We=a[0],Re=a[1],je=a[2],ht=a[3],_t=a[4],Ht=a[5],sn=a[6],qt=a[7],jt=a[8],Bt=a[9],Xt=a[10],Nt=a[11],Pt=a[12],hn=a[13],an=a[14],Fn=a[15];return Math.abs(f-We)<=$i*Math.max(1,Math.abs(f),Math.abs(We))&&Math.abs(m-Re)<=$i*Math.max(1,Math.abs(m),Math.abs(Re))&&Math.abs(b-je)<=$i*Math.max(1,Math.abs(b),Math.abs(je))&&Math.abs(k-ht)<=$i*Math.max(1,Math.abs(k),Math.abs(ht))&&Math.abs(S-_t)<=$i*Math.max(1,Math.abs(S),Math.abs(_t))&&Math.abs(M-Ht)<=$i*Math.max(1,Math.abs(M),Math.abs(Ht))&&Math.abs(F-sn)<=$i*Math.max(1,Math.abs(F),Math.abs(sn))&&Math.abs(j-qt)<=$i*Math.max(1,Math.abs(j),Math.abs(qt))&&Math.abs(X-jt)<=$i*Math.max(1,Math.abs(X),Math.abs(jt))&&Math.abs(Q-Bt)<=$i*Math.max(1,Math.abs(Q),Math.abs(Bt))&&Math.abs(se-Xt)<=$i*Math.max(1,Math.abs(se),Math.abs(Xt))&&Math.abs(pe-Nt)<=$i*Math.max(1,Math.abs(pe),Math.abs(Nt))&&Math.abs(_e-Pt)<=$i*Math.max(1,Math.abs(_e),Math.abs(Pt))&&Math.abs(be-hn)<=$i*Math.max(1,Math.abs(be),Math.abs(hn))&&Math.abs(Ce-an)<=$i*Math.max(1,Math.abs(Ce),Math.abs(an))&&Math.abs(Pe-Fn)<=$i*Math.max(1,Math.abs(Pe),Math.abs(Fn))},u.a_=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.aa=function(c){const a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,m,b,k)=>{const S=b||k;return a[m]=!S||S.toLowerCase(),""}),a["max-age"]){const f=parseInt(a["max-age"],10);isNaN(f)?delete a["max-age"]:a["max-age"]=f}return a},u.ab=function(c,a){const f=[];for(const m in c)m in a||f.push(m);return f},u.ac=K,u.ad=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),k=a[0],S=a[1],M=a[2],F=a[3],j=a[4],X=a[5],Q=a[6],se=a[7];return a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=k*b+j*m,c[1]=S*b+X*m,c[2]=M*b+Q*m,c[3]=F*b+se*m,c[4]=j*b-k*m,c[5]=X*b-S*m,c[6]=Q*b-M*m,c[7]=se*b-F*m,c},u.ae=function(c){var a=new Su(16);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},u.af=nd,u.ag=function(c,a){let f=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:b,minZoom:k,maxZoom:S}=c,M=b?K(wi.interpolationFactor(b,a,k,S),0,1):0;c.kind==="camera"?m=Ti.number(c.minSize,c.maxSize,M):f=M}return{uSizeT:f,uSize:m}},u.ai=function(c,{uSize:a,uSizeT:f},{lowerSize:m,upperSize:b}){return c.kind==="source"?m/Is:c.kind==="composite"?Ti.number(m/Is,b/Is,f):a},u.aj=rm,u.ak=function(c,a,f,m){const b=a.y-c.y,k=a.x-c.x,S=m.y-f.y,M=m.x-f.x,F=S*k-M*b;if(F===0)return null;const j=(M*(c.y-f.y)-S*(c.x-f.x))/F;return new _(c.x+j*k,c.y+j*b)},u.al=x0,u.am=Uc,u.an=Bp,u.ao=oi,u.aq=nm,u.ar=function(c,a){var f=a[0],m=a[1],b=a[2],k=a[3],S=a[4],M=a[5],F=a[6],j=a[7],X=a[8],Q=a[9],se=a[10],pe=a[11],_e=a[12],be=a[13],Ce=a[14],Pe=a[15],We=f*M-m*S,Re=f*F-b*S,je=f*j-k*S,ht=m*F-b*M,_t=m*j-k*M,Ht=b*j-k*F,sn=X*be-Q*_e,qt=X*Ce-se*_e,jt=X*Pe-pe*_e,Bt=Q*Ce-se*be,Xt=Q*Pe-pe*be,Nt=se*Pe-pe*Ce,Pt=We*Nt-Re*Xt+je*Bt+ht*jt-_t*qt+Ht*sn;return Pt?(c[0]=(M*Nt-F*Xt+j*Bt)*(Pt=1/Pt),c[1]=(b*Xt-m*Nt-k*Bt)*Pt,c[2]=(be*Ht-Ce*_t+Pe*ht)*Pt,c[3]=(se*_t-Q*Ht-pe*ht)*Pt,c[4]=(F*jt-S*Nt-j*qt)*Pt,c[5]=(f*Nt-b*jt+k*qt)*Pt,c[6]=(Ce*je-_e*Ht-Pe*Re)*Pt,c[7]=(X*Ht-se*je+pe*Re)*Pt,c[8]=(S*Xt-M*jt+j*sn)*Pt,c[9]=(m*jt-f*Xt-k*sn)*Pt,c[10]=(_e*_t-be*je+Pe*We)*Pt,c[11]=(Q*je-X*_t-pe*We)*Pt,c[12]=(M*qt-S*Bt-F*sn)*Pt,c[13]=(f*Bt-m*qt+b*sn)*Pt,c[14]=(be*Re-_e*ht-Ce*We)*Pt,c[15]=(X*ht-Q*Re+se*We)*Pt,c):null},u.as=fm,u.at=tm,u.au=hm,u.av=function(){const c={},a=de.$version;for(const f in de.$root){const m=de.$root[f];if(m.required){let b=null;b=f==="version"?a:m.type==="array"?[]:{},b!=null&&(c[f]=b)}}return c},u.aw=Uh,u.ax=nn,u.ay=function(c){c=c.slice();const a=Object.create(null);for(let f=0;f<c.length;f++)a[c[f].id]=c[f];for(let f=0;f<c.length;f++)"ref"in c[f]&&(c[f]=Xe(c[f],a[c[f].ref]));return c},u.az=function(c){if(c.type==="custom")return new CA(c);switch(c.type){case"background":return new AA(c);case"circle":return new lx(c);case"fill":return new Mx(c);case"fill-extrusion":return new Vx(c);case"heatmap":return new cx(c);case"hillshade":return new hx(c);case"line":return new Jx(c);case"raster":return new SA(c);case"symbol":return new hd(c)}},u.b=Le,u.b0=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},u.b1=H,u.b2=m0,u.b3=d0,u.b4=function(c,a,f,m,b){var k,S=1/Math.tan(a/2);return c[0]=S/f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=S,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,b!=null&&b!==1/0?(c[10]=(b+m)*(k=1/(m-b)),c[14]=2*b*m*k):(c[10]=-1,c[14]=-2*m),c},u.b5=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),k=a[4],S=a[5],M=a[6],F=a[7],j=a[8],X=a[9],Q=a[10],se=a[11];return a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[4]=k*b+j*m,c[5]=S*b+X*m,c[6]=M*b+Q*m,c[7]=F*b+se*m,c[8]=j*b-k*m,c[9]=X*b-S*m,c[10]=Q*b-M*m,c[11]=se*b-F*m,c},u.b6=O,u.b7=B,u.b8=function(c){return c*Math.PI/180},u.b9=function(c,a){return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bA=Ts,u.ba=class extends as{},u.bb=am,u.bc=FA,u.be=Yt,u.bf=function(c,a){xt.REGISTERED_PROTOCOLS[c]=a},u.bg=function(c){delete xt.REGISTERED_PROTOCOLS[c]},u.bh=function(c,a){const f={};for(let b=0;b<c.length;b++){const k=a&&a[c[b].id]||Ip(c[b]);a&&(a[c[b].id]=k);let S=f[k];S||(S=f[k]=[]),S.push(c[b])}const m=[];for(const b in f)m.push(f[b]);return m},u.bi=Zt,u.bj=_0,u.bk=v0,u.bl=J_,u.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=jr/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const a=c.bucket.layers[0],f=a.layout,m=a._unevaluatedLayout._values,b={layoutIconSize:m["icon-size"].possiblyEvaluate(new Tr(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Tr(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Tr(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=c.bucket.textSizeData;b.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Tr(j),c.canonical),m["text-size"].possiblyEvaluate(new Tr(X),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:X}=c.bucket.iconSizeData;b.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Tr(j),c.canonical),m["icon-size"].possiblyEvaluate(new Tr(X),c.canonical)]}const k=f.get("text-line-height")*oi,S=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",M=f.get("text-keep-upright"),F=f.get("text-size");for(const j of c.bucket.features){const X=f.get("text-font").evaluate(j,{},c.canonical).join(","),Q=F.evaluate(j,{},c.canonical),se=b.layoutTextSize.evaluate(j,{},c.canonical),pe=b.layoutIconSize.evaluate(j,{},c.canonical),_e={horizontal:{},vertical:void 0},be=j.text;let Ce,Pe=[0,0];if(be){const je=be.toString(),ht=f.get("text-letter-spacing").evaluate(j,{},c.canonical)*oi,_t=Vh(je)?ht:0,Ht=f.get("text-anchor").evaluate(j,{},c.canonical),sn=I0(a,j,c.canonical);if(!sn){const Nt=f.get("text-radial-offset").evaluate(j,{},c.canonical);Pe=Nt?L0(Ht,[Nt*oi,cm]):f.get("text-offset").evaluate(j,{},c.canonical).map(Pt=>Pt*oi)}let qt=S?"center":f.get("text-justify").evaluate(j,{},c.canonical);const jt=f.get("symbol-placement"),Bt=jt==="point"?f.get("text-max-width").evaluate(j,{},c.canonical)*oi:0,Xt=()=>{c.bucket.allowVerticalPlacement&&xa(je)&&(_e.vertical=ud(be,c.glyphMap,c.glyphPositions,c.imagePositions,X,Bt,k,Ht,"left",_t,Pe,u.ah.vertical,!0,jt,se,Q))};if(!S&&sn){const Nt=new Set;if(qt==="auto")for(let hn=0;hn<sn.values.length;hn+=2)Nt.add(fm(sn.values[hn]));else Nt.add(qt);let Pt=!1;for(const hn of Nt)if(!_e.horizontal[hn])if(Pt)_e.horizontal[hn]=_e.horizontal[0];else{const an=ud(be,c.glyphMap,c.glyphPositions,c.imagePositions,X,Bt,k,"center",hn,_t,Pe,u.ah.horizontal,!1,jt,se,Q);an&&(_e.horizontal[hn]=an,Pt=an.positionedLines.length===1)}Xt()}else{qt==="auto"&&(qt=fm(Ht));const Nt=ud(be,c.glyphMap,c.glyphPositions,c.imagePositions,X,Bt,k,Ht,qt,_t,Pe,u.ah.horizontal,!1,jt,se,Q);Nt&&(_e.horizontal[qt]=Nt),Xt(),xa(je)&&S&&M&&(_e.vertical=ud(be,c.glyphMap,c.glyphPositions,c.imagePositions,X,Bt,k,Ht,qt,_t,Pe,u.ah.vertical,!1,jt,se,Q))}}let We=!1;if(j.icon&&j.icon.name){const je=c.imageMap[j.icon.name];je&&(Ce=yA(c.imagePositions[j.icon.name],f.get("icon-offset").evaluate(j,{},c.canonical),f.get("icon-anchor").evaluate(j,{},c.canonical)),We=!!je.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=We:c.bucket.sdfIcons!==We&&ke("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(je.pixelRatio!==c.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const Re=z0(_e.horizontal)||_e.vertical;c.bucket.iconsInText=!!Re&&Re.iconsInText,(Re||Ce)&&RA(c.bucket,j,_e,Ce,c.imageMap,b,se,pe,Pe,We,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bn=Xp,u.bo=Gp,u.bp=Zp,u.bq=ka,u.br=Jp,u.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bt=function(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(I())try{return yield Ze(c,a,f,m,b)}catch{}return function(k,S,M,F,j){const X=k.width,Q=k.height;at&&dt||(at=new OffscreenCanvas(X,Q),dt=at.getContext("2d",{willReadFrequently:!0})),at.width=X,at.height=Q,dt.drawImage(k,0,0,X,Q);const se=dt.getImageData(S,M,F,j);return dt.clearRect(0,0,X,Q),se.data}(c,a,f,m,b)})},u.bu=g0,u.bv=d,u.bw=p,u.bx=U_,u.by=qs,u.bz=function(c){return c.message===pt},u.c=Je,u.d=c=>s(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(a)}catch(f){throw new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=q,u.f=c=>new Promise((a,f)=>{const m=new Image;m.onload=()=>{a(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=lt})},m.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(c)],{type:"image/png"});m.src=c.byteLength?URL.createObjectURL(b):lt}),u.g=Mt,u.h=(c,a)=>Qt(q(c,{type:"json"}),a),u.i=Ue,u.j=gt,u.k=Ge,u.l=(c,a)=>Qt(q(c,{type:"arrayBuffer"}),a),u.m=Qt,u.n=function(c){return new Jp(c).readFields(hA,[])},u.o=Zc,u.p=K_,u.q=Oi,u.r=Pp,u.s=fn,u.t=va,u.u=Vt,u.v=de,u.w=ke,u.x=Gs,u.y=function([c,a,f]){return a+=90,a*=Math.PI/180,f*=Math.PI/180,{x:c*Math.cos(a)*Math.sin(f),y:c*Math.sin(a)*Math.sin(f),z:c*Math.cos(f)}},u.z=Ti}),i("worker",["./shared"],function(u){class s{constructor(ne){this.keyCache={},ne&&this.replace(ne)}replace(ne){this._layerConfigs={},this._layers={},this.update(ne,[])}update(ne,ce){for(const we of ne){this._layerConfigs[we.id]=we;const Oe=this._layers[we.id]=u.az(we);Oe._featureFilter=u.a6(Oe.filter),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of ce)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ge=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const we of ge){const Oe=we.map(Qe=>this._layers[Qe.id]),$e=Oe[0];if($e.visibility==="none")continue;const Ve=$e.source||"";let ze=this.familiesBySource[Ve];ze||(ze=this.familiesBySource[Ve]={});const re=$e.sourceLayer||"_geojsonTileLayer";let Ke=ze[re];Ke||(Ke=ze[re]=[]),Ke.push(Oe)}}}class d{constructor(ne){const ce={},ge=[];for(const Ve in ne){const ze=ne[Ve],re=ce[Ve]={};for(const Ke in ze){const Qe=ze[+Ke];if(!Qe||Qe.bitmap.width===0||Qe.bitmap.height===0)continue;const nt={x:0,y:0,w:Qe.bitmap.width+2,h:Qe.bitmap.height+2};ge.push(nt),re[Ke]={rect:nt,metrics:Qe.metrics}}}const{w:we,h:Oe}=u.p(ge),$e=new u.o({width:we||1,height:Oe||1});for(const Ve in ne){const ze=ne[Ve];for(const re in ze){const Ke=ze[+re];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const Qe=ce[Ve][re].rect;u.o.copy(Ke.bitmap,$e,{x:0,y:0},{x:Qe.x+1,y:Qe.y+1},Ke.bitmap)}}this.image=$e,this.positions=ce}}u.bi("GlyphAtlas",d);class p{constructor(ne){this.tileID=new u.Q(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.uid=ne.uid,this.zoom=ne.zoom,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.returnDependencies=!!ne.returnDependencies,this.promoteId=ne.promoteId,this.inFlightDependencies=[]}parse(ne,ce,ge,we){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=ne,this.collisionBoxArray=new u.a4;const Oe=new u.bj(Object.keys(ne.layers).sort()),$e=new u.bk(this.tileID,this.promoteId);$e.bucketLayerIDs=[];const Ve={},ze={featureIndex:$e,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ge},re=ce.familiesBySource[this.source];for(const Ln in re){const Rr=ne.layers[Ln];if(!Rr)continue;Rr.version===1&&u.w(`Vector tile source "${this.source}" layer "${Ln}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ni=Oe.encode(Ln),Ci=[];for(let Ri=0;Ri<Rr.length;Ri++){const mi=Rr.feature(Ri),jo=$e.getId(mi,Ln);Ci.push({feature:mi,id:jo,index:Ri,sourceLayerIndex:ni})}for(const Ri of re[Ln]){const mi=Ri[0];mi.source!==this.source&&u.w(`layer.source = ${mi.source} does not equal this.source = ${this.source}`),mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility!=="none"&&(g(Ri,this.zoom,ge),(Ve[mi.id]=mi.createBucket({index:$e.bucketLayerIDs.length,layers:Ri,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ni,sourceID:this.source})).populate(Ci,ze,this.tileID.canonical),$e.bucketLayerIDs.push(Ri.map(jo=>jo.id)))}}const Ke=u.aE(ze.glyphDependencies,Ln=>Object.keys(Ln).map(Number));this.inFlightDependencies.forEach(Ln=>Ln==null?void 0:Ln.abort()),this.inFlightDependencies=[];let Qe=Promise.resolve({});if(Object.keys(Ke).length){const Ln=new AbortController;this.inFlightDependencies.push(Ln),Qe=we.sendAsync({type:"GG",data:{stacks:Ke,source:this.source,tileID:this.tileID,type:"glyphs"}},Ln)}const nt=Object.keys(ze.iconDependencies);let ct=Promise.resolve({});if(nt.length){const Ln=new AbortController;this.inFlightDependencies.push(Ln),ct=we.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"icons"}},Ln)}const zt=Object.keys(ze.patternDependencies);let on=Promise.resolve({});if(zt.length){const Ln=new AbortController;this.inFlightDependencies.push(Ln),on=we.sendAsync({type:"GI",data:{icons:zt,source:this.source,tileID:this.tileID,type:"patterns"}},Ln)}const[gn,En,Vn]=yield Promise.all([Qe,ct,on]),Cr=new d(gn),Gr=new u.bl(En,Vn);for(const Ln in Ve){const Rr=Ve[Ln];Rr instanceof u.a5?(g(Rr.layers,this.zoom,ge),u.bm({bucket:Rr,glyphMap:gn,glyphPositions:Cr.positions,imageMap:En,imagePositions:Gr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Rr.hasPattern&&(Rr instanceof u.bn||Rr instanceof u.bo||Rr instanceof u.bp)&&(g(Rr.layers,this.zoom,ge),Rr.addFeatures(ze,this.tileID.canonical,Gr.patternPositions))}return this.status="done",{buckets:Object.values(Ve).filter(Ln=>!Ln.isEmpty()),featureIndex:$e,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Cr.image,imageAtlas:Gr,glyphMap:this.returnDependencies?gn:null,iconMap:this.returnDependencies?En:null,glyphPositions:this.returnDependencies?Cr.positions:null}})}}function g(Se,ne,ce){const ge=new u.a8(ne);for(const we of Se)we.recalculate(ge,ce)}class _{constructor(ne,ce,ge){this.actor=ne,this.layerIndex=ce,this.availableImages=ge,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ne,ce){return u._(this,void 0,void 0,function*(){const ge=yield u.l(ne.request,ce);try{return{vectorTile:new u.bq.VectorTile(new u.br(ge.data)),rawData:ge.data,cacheControl:ge.cacheControl,expires:ge.expires}}catch(we){const Oe=new Uint8Array(ge.data);let $e=`Unable to parse the tile at ${ne.request.url}, `;throw $e+=Oe[0]===31&&Oe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${we.messge}`,new Error($e)}})}loadTile(ne){return u._(this,void 0,void 0,function*(){const ce=ne.uid,ge=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bs(ne.request),we=new p(ne);this.loading[ce]=we;const Oe=new AbortController;we.abort=Oe;try{const $e=yield this.loadVectorTile(ne,Oe);if(delete this.loading[ce],!$e)return null;const Ve=$e.rawData,ze={};$e.expires&&(ze.expires=$e.expires),$e.cacheControl&&(ze.cacheControl=$e.cacheControl);const re={};if(ge){const Qe=ge.finish();Qe&&(re.resourceTiming=JSON.parse(JSON.stringify(Qe)))}we.vectorTile=$e.vectorTile;const Ke=we.parse($e.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ce]=we,this.fetching[ce]={rawTileData:Ve,cacheControl:ze,resourceTiming:re};try{const Qe=yield Ke;return u.e({rawTileData:Ve.slice(0)},Qe,ze,re)}finally{delete this.fetching[ce]}}catch($e){throw delete this.loading[ce],we.status="done",this.loaded[ce]=we,$e}})}reloadTile(ne){return u._(this,void 0,void 0,function*(){const ce=ne.uid;if(!this.loaded||!this.loaded[ce])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ge=this.loaded[ce];if(ge.showCollisionBoxes=ne.showCollisionBoxes,ge.status==="parsing"){const we=yield ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor);let Oe;if(this.fetching[ce]){const{rawTileData:$e,cacheControl:Ve,resourceTiming:ze}=this.fetching[ce];delete this.fetching[ce],Oe=u.e({rawTileData:$e.slice(0)},we,Ve,ze)}else Oe=we;return Oe}if(ge.status==="done"&&ge.vectorTile)return ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(ne){return u._(this,void 0,void 0,function*(){const ce=this.loading,ge=ne.uid;ce&&ce[ge]&&ce[ge].abort&&(ce[ge].abort.abort(),delete ce[ge])})}removeTile(ne){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ne.uid]&&delete this.loaded[ne.uid]})}}class x{constructor(){this.loaded={}}loadTile(ne){return u._(this,void 0,void 0,function*(){const{uid:ce,encoding:ge,rawImageData:we,redFactor:Oe,greenFactor:$e,blueFactor:Ve,baseShift:ze}=ne,re=we.width+2,Ke=we.height+2,Qe=u.b(we)?new u.R({width:re,height:Ke},yield u.bt(we,-1,-1,re,Ke)):we,nt=new u.bu(ce,Qe,ge,Oe,$e,Ve,ze);return this.loaded=this.loaded||{},this.loaded[ce]=nt,nt})}removeTile(ne){const ce=this.loaded,ge=ne.uid;ce&&ce[ge]&&delete ce[ge]}}function C(Se,ne){if(Se.length!==0){T(Se[0],ne);for(var ce=1;ce<Se.length;ce++)T(Se[ce],!ne)}}function T(Se,ne){for(var ce=0,ge=0,we=0,Oe=Se.length,$e=Oe-1;we<Oe;$e=we++){var Ve=(Se[we][0]-Se[$e][0])*(Se[$e][1]+Se[we][1]),ze=ce+Ve;ge+=Math.abs(ce)>=Math.abs(Ve)?ce-ze+Ve:Ve-ze+ce,ce=ze}ce+ge>=0!=!!ne&&Se.reverse()}var z=u.bv(function Se(ne,ce){var ge,we=ne&&ne.type;if(we==="FeatureCollection")for(ge=0;ge<ne.features.length;ge++)Se(ne.features[ge],ce);else if(we==="GeometryCollection")for(ge=0;ge<ne.geometries.length;ge++)Se(ne.geometries[ge],ce);else if(we==="Feature")Se(ne.geometry,ce);else if(we==="Polygon")C(ne.coordinates,ce);else if(we==="MultiPolygon")for(ge=0;ge<ne.coordinates.length;ge++)C(ne.coordinates[ge],ce);return ne});const L=u.bq.VectorTileFeature.prototype.toGeoJSON;var E={exports:{}},I=u.bw,O=u.bq.VectorTileFeature,B=K;function K(Se,ne){this.options=ne||{},this.features=Se,this.length=Se.length}function H(Se,ne){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=ne||4096}K.prototype.feature=function(Se){return new H(this.features[Se],this.options.extent)},H.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Se.length;ne++){for(var ce=Se[ne],ge=[],we=0;we<ce.length;we++)ge.push(new I(ce[we][0],ce[we][1]));this.geometry.push(ge)}return this.geometry},H.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,ne=1/0,ce=-1/0,ge=1/0,we=-1/0,Oe=0;Oe<Se.length;Oe++)for(var $e=Se[Oe],Ve=0;Ve<$e.length;Ve++){var ze=$e[Ve];ne=Math.min(ne,ze.x),ce=Math.max(ce,ze.x),ge=Math.min(ge,ze.y),we=Math.max(we,ze.y)}return[ne,ge,ce,we]},H.prototype.toGeoJSON=O.prototype.toGeoJSON;var q=u.bx,J=B;function he(Se){var ne=new q;return function(ce,ge){for(var we in ce.layers)ge.writeMessage(3,Ee,ce.layers[we])}(Se,ne),ne.finish()}function Ee(Se,ne){var ce;ne.writeVarintField(15,Se.version||1),ne.writeStringField(1,Se.name||""),ne.writeVarintField(5,Se.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<Se.length;ce++)ge.feature=Se.feature(ce),ne.writeMessage(2,Y,ge);var we=ge.keys;for(ce=0;ce<we.length;ce++)ne.writeStringField(3,we[ce]);var Oe=ge.values;for(ce=0;ce<Oe.length;ce++)ne.writeMessage(4,Ue,Oe[ce])}function Y(Se,ne){var ce=Se.feature;ce.id!==void 0&&ne.writeVarintField(1,ce.id),ne.writeMessage(2,oe,Se),ne.writeVarintField(3,ce.type),ne.writeMessage(4,Ne,ce)}function oe(Se,ne){var ce=Se.feature,ge=Se.keys,we=Se.values,Oe=Se.keycache,$e=Se.valuecache;for(var Ve in ce.properties){var ze=ce.properties[Ve],re=Oe[Ve];if(ze!==null){re===void 0&&(ge.push(Ve),Oe[Ve]=re=ge.length-1),ne.writeVarint(re);var Ke=typeof ze;Ke!=="string"&&Ke!=="boolean"&&Ke!=="number"&&(ze=JSON.stringify(ze));var Qe=Ke+":"+ze,nt=$e[Qe];nt===void 0&&(we.push(ze),$e[Qe]=nt=we.length-1),ne.writeVarint(nt)}}}function ke(Se,ne){return(ne<<3)+(7&Se)}function ye(Se){return Se<<1^Se>>31}function Ne(Se,ne){for(var ce=Se.loadGeometry(),ge=Se.type,we=0,Oe=0,$e=ce.length,Ve=0;Ve<$e;Ve++){var ze=ce[Ve],re=1;ge===1&&(re=ze.length),ne.writeVarint(ke(1,re));for(var Ke=ge===3?ze.length-1:ze.length,Qe=0;Qe<Ke;Qe++){Qe===1&&ge!==1&&ne.writeVarint(ke(2,Ke-1));var nt=ze[Qe].x-we,ct=ze[Qe].y-Oe;ne.writeVarint(ye(nt)),ne.writeVarint(ye(ct)),we+=nt,Oe+=ct}ge===3&&ne.writeVarint(ke(7,1))}}function Ue(Se,ne){var ce=typeof Se;ce==="string"?ne.writeStringField(1,Se):ce==="boolean"?ne.writeBooleanField(7,Se):ce==="number"&&(Se%1!=0?ne.writeDoubleField(3,Se):Se<0?ne.writeSVarintField(6,Se):ne.writeVarintField(5,Se))}E.exports=he,E.exports.fromVectorTileJs=he,E.exports.fromGeojsonVt=function(Se,ne){ne=ne||{};var ce={};for(var ge in Se)ce[ge]=new J(Se[ge].features,ne),ce[ge].name=ge,ce[ge].version=ne.version,ce[ge].extent=ne.extent;return he({layers:ce})},E.exports.GeoJSONWrapper=J;var De=u.bv(E.exports);const Le={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},lt=Math.fround||(Ze=new Float32Array(1),Se=>(Ze[0]=+Se,Ze[0]));var Ze;const at=3,dt=5,pt=6;class Je{constructor(ne){this.options=Object.assign(Object.create(Le),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ce,minZoom:ge,maxZoom:we}=this.options;ce&&console.time("total time");const Oe=`prepare ${ne.length} points`;ce&&console.time(Oe),this.points=ne;const $e=[];for(let ze=0;ze<ne.length;ze++){const re=ne[ze];if(!re.geometry)continue;const[Ke,Qe]=re.geometry.coordinates,nt=lt(Ot(Ke)),ct=lt(Yt(Qe));$e.push(nt,ct,1/0,ze,-1,1),this.options.reduce&&$e.push(0)}let Ve=this.trees[we+1]=this._createTree($e);ce&&console.timeEnd(Oe);for(let ze=we;ze>=ge;ze--){const re=+Date.now();Ve=this.trees[ze]=this._createTree(this._cluster(Ve,ze)),ce&&console.log("z%d: %d clusters in %dms",ze,Ve.numItems,+Date.now()-re)}return ce&&console.timeEnd("total time"),this}getClusters(ne,ce){let ge=((ne[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,ne[1]));let Oe=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const $e=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ge=-180,Oe=180;else if(ge>Oe){const Qe=this.getClusters([ge,we,180,$e],ce),nt=this.getClusters([-180,we,Oe,$e],ce);return Qe.concat(nt)}const Ve=this.trees[this._limitZoom(ce)],ze=Ve.range(Ot(ge),Yt($e),Ot(Oe),Yt(we)),re=Ve.data,Ke=[];for(const Qe of ze){const nt=this.stride*Qe;Ke.push(re[nt+dt]>1?xt(re,nt,this.clusterProps):this.points[re[nt+at]])}return Ke}getChildren(ne){const ce=this._getOriginId(ne),ge=this._getOriginZoom(ne),we="No cluster with the specified id.",Oe=this.trees[ge];if(!Oe)throw new Error(we);const $e=Oe.data;if(ce*this.stride>=$e.length)throw new Error(we);const Ve=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),ze=Oe.within($e[ce*this.stride],$e[ce*this.stride+1],Ve),re=[];for(const Ke of ze){const Qe=Ke*this.stride;$e[Qe+4]===ne&&re.push($e[Qe+dt]>1?xt($e,Qe,this.clusterProps):this.points[$e[Qe+at]])}if(re.length===0)throw new Error(we);return re}getLeaves(ne,ce,ge){const we=[];return this._appendLeaves(we,ne,ce=ce||10,ge=ge||0,0),we}getTile(ne,ce,ge){const we=this.trees[this._limitZoom(ne)],Oe=Math.pow(2,ne),{extent:$e,radius:Ve}=this.options,ze=Ve/$e,re=(ge-ze)/Oe,Ke=(ge+1+ze)/Oe,Qe={features:[]};return this._addTileFeatures(we.range((ce-ze)/Oe,re,(ce+1+ze)/Oe,Ke),we.data,ce,ge,Oe,Qe),ce===0&&this._addTileFeatures(we.range(1-ze/Oe,re,1,Ke),we.data,Oe,ge,Oe,Qe),ce===Oe-1&&this._addTileFeatures(we.range(0,re,ze/Oe,Ke),we.data,-1,ge,Oe,Qe),Qe.features.length?Qe:null}getClusterExpansionZoom(ne){let ce=this._getOriginZoom(ne)-1;for(;ce<=this.options.maxZoom;){const ge=this.getChildren(ne);if(ce++,ge.length!==1)break;ne=ge[0].properties.cluster_id}return ce}_appendLeaves(ne,ce,ge,we,Oe){const $e=this.getChildren(ce);for(const Ve of $e){const ze=Ve.properties;if(ze&&ze.cluster?Oe+ze.point_count<=we?Oe+=ze.point_count:Oe=this._appendLeaves(ne,ze.cluster_id,ge,we,Oe):Oe<we?Oe++:ne.push(Ve),ne.length===ge)break}return Oe}_createTree(ne){const ce=new u.au(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ne.length;ge+=this.stride)ce.add(ne[ge],ne[ge+1]);return ce.finish(),ce.data=ne,ce}_addTileFeatures(ne,ce,ge,we,Oe,$e){for(const Ve of ne){const ze=Ve*this.stride,re=ce[ze+dt]>1;let Ke,Qe,nt;if(re)Ke=Mt(ce,ze,this.clusterProps),Qe=ce[ze],nt=ce[ze+1];else{const on=this.points[ce[ze+at]];Ke=on.properties;const[gn,En]=on.geometry.coordinates;Qe=Ot(gn),nt=Yt(En)}const ct={type:1,geometry:[[Math.round(this.options.extent*(Qe*Oe-ge)),Math.round(this.options.extent*(nt*Oe-we))]],tags:Ke};let zt;zt=re||this.options.generateId?ce[ze+at]:this.points[ce[ze+at]].id,zt!==void 0&&(ct.id=zt),$e.features.push(ct)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ce){const{radius:ge,extent:we,reduce:Oe,minPoints:$e}=this.options,Ve=ge/(we*Math.pow(2,ce)),ze=ne.data,re=[],Ke=this.stride;for(let Qe=0;Qe<ze.length;Qe+=Ke){if(ze[Qe+2]<=ce)continue;ze[Qe+2]=ce;const nt=ze[Qe],ct=ze[Qe+1],zt=ne.within(ze[Qe],ze[Qe+1],Ve),on=ze[Qe+dt];let gn=on;for(const En of zt){const Vn=En*Ke;ze[Vn+2]>ce&&(gn+=ze[Vn+dt])}if(gn>on&&gn>=$e){let En,Vn=nt*on,Cr=ct*on,Gr=-1;const Ln=((Qe/Ke|0)<<5)+(ce+1)+this.points.length;for(const Rr of zt){const ni=Rr*Ke;if(ze[ni+2]<=ce)continue;ze[ni+2]=ce;const Ci=ze[ni+dt];Vn+=ze[ni]*Ci,Cr+=ze[ni+1]*Ci,ze[ni+4]=Ln,Oe&&(En||(En=this._map(ze,Qe,!0),Gr=this.clusterProps.length,this.clusterProps.push(En)),Oe(En,this._map(ze,ni)))}ze[Qe+4]=Ln,re.push(Vn/gn,Cr/gn,1/0,Ln,-1,gn),Oe&&re.push(Gr)}else{for(let En=0;En<Ke;En++)re.push(ze[Qe+En]);if(gn>1)for(const En of zt){const Vn=En*Ke;if(!(ze[Vn+2]<=ce)){ze[Vn+2]=ce;for(let Cr=0;Cr<Ke;Cr++)re.push(ze[Vn+Cr])}}}}return re}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ce,ge){if(ne[ce+dt]>1){const $e=this.clusterProps[ne[ce+pt]];return ge?Object.assign({},$e):$e}const we=this.points[ne[ce+at]].properties,Oe=this.options.map(we);return ge&&Oe===we?Object.assign({},Oe):Oe}}function xt(Se,ne,ce){return{type:"Feature",id:Se[ne+at],properties:Mt(Se,ne,ce),geometry:{type:"Point",coordinates:[(ge=Se[ne],360*(ge-.5)),nn(Se[ne+1])]}};var ge}function Mt(Se,ne,ce){const ge=Se[ne+dt],we=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Oe=Se[ne+pt],$e=Oe===-1?{}:Object.assign({},ce[Oe]);return Object.assign($e,{cluster:!0,cluster_id:Se[ne+at],point_count:ge,point_count_abbreviated:we})}function Ot(Se){return Se/360+.5}function Yt(Se){const ne=Math.sin(Se*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function nn(Se){const ne=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function Qt(Se,ne,ce,ge){for(var we,Oe=ge,$e=ce-ne>>1,Ve=ce-ne,ze=Se[ne],re=Se[ne+1],Ke=Se[ce],Qe=Se[ce+1],nt=ne+3;nt<ce;nt+=3){var ct=fn(Se[nt],Se[nt+1],ze,re,Ke,Qe);if(ct>Oe)we=nt,Oe=ct;else if(ct===Oe){var zt=Math.abs(nt-$e);zt<Ve&&(we=nt,Ve=zt)}}Oe>ge&&(we-ne>3&&Qt(Se,ne,we,ge),Se[we+2]=Oe,ce-we>3&&Qt(Se,we,ce,ge))}function fn(Se,ne,ce,ge,we,Oe){var $e=we-ce,Ve=Oe-ge;if($e!==0||Ve!==0){var ze=((Se-ce)*$e+(ne-ge)*Ve)/($e*$e+Ve*Ve);ze>1?(ce=we,ge=Oe):ze>0&&(ce+=$e*ze,ge+=Ve*ze)}return($e=Se-ce)*$e+(Ve=ne-ge)*Ve}function mn(Se,ne,ce,ge){var we={id:Se===void 0?null:Se,type:ne,geometry:ce,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Oe){var $e=Oe.geometry,Ve=Oe.type;if(Ve==="Point"||Ve==="MultiPoint"||Ve==="LineString")qe(Oe,$e);else if(Ve==="Polygon"||Ve==="MultiLineString")for(var ze=0;ze<$e.length;ze++)qe(Oe,$e[ze]);else if(Ve==="MultiPolygon")for(ze=0;ze<$e.length;ze++)for(var re=0;re<$e[ze].length;re++)qe(Oe,$e[ze][re])}(we),we}function qe(Se,ne){for(var ce=0;ce<ne.length;ce+=3)Se.minX=Math.min(Se.minX,ne[ce]),Se.minY=Math.min(Se.minY,ne[ce+1]),Se.maxX=Math.max(Se.maxX,ne[ce]),Se.maxY=Math.max(Se.maxY,ne[ce+1])}function Ge(Se,ne,ce,ge){if(ne.geometry){var we=ne.geometry.coordinates,Oe=ne.geometry.type,$e=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),Ve=[],ze=ne.id;if(ce.promoteId?ze=ne.properties[ce.promoteId]:ce.generateId&&(ze=ge||0),Oe==="Point")gt(we,Ve);else if(Oe==="MultiPoint")for(var re=0;re<we.length;re++)gt(we[re],Ve);else if(Oe==="LineString")et(we,Ve,$e,!1);else if(Oe==="MultiLineString"){if(ce.lineMetrics){for(re=0;re<we.length;re++)et(we[re],Ve=[],$e,!1),Se.push(mn(ze,"LineString",Ve,ne.properties));return}de(we,Ve,$e,!1)}else if(Oe==="Polygon")de(we,Ve,$e,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(re=0;re<ne.geometry.geometries.length;re++)Ge(Se,{id:ze,geometry:ne.geometry.geometries[re],properties:ne.properties},ce,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(re=0;re<we.length;re++){var Ke=[];de(we[re],Ke,$e,!0),Ve.push(Ke)}}Se.push(mn(ze,Oe,Ve,ne.properties))}}function gt(Se,ne){ne.push(en(Se[0])),ne.push(Xe(Se[1])),ne.push(0)}function et(Se,ne,ce,ge){for(var we,Oe,$e=0,Ve=0;Ve<Se.length;Ve++){var ze=en(Se[Ve][0]),re=Xe(Se[Ve][1]);ne.push(ze),ne.push(re),ne.push(0),Ve>0&&($e+=ge?(we*re-ze*Oe)/2:Math.sqrt(Math.pow(ze-we,2)+Math.pow(re-Oe,2))),we=ze,Oe=re}var Ke=ne.length-3;ne[2]=1,Qt(ne,0,Ke,ce),ne[Ke+2]=1,ne.size=Math.abs($e),ne.start=0,ne.end=ne.size}function de(Se,ne,ce,ge){for(var we=0;we<Se.length;we++){var Oe=[];et(Se[we],Oe,ce,ge),ne.push(Oe)}}function en(Se){return Se/360+.5}function Xe(Se){var ne=Math.sin(Se*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function it(Se,ne,ce,ge,we,Oe,$e,Ve){if(ge/=ne,Oe>=(ce/=ne)&&$e<ge)return Se;if($e<ce||Oe>=ge)return null;for(var ze=[],re=0;re<Se.length;re++){var Ke=Se[re],Qe=Ke.geometry,nt=Ke.type,ct=we===0?Ke.minX:Ke.minY,zt=we===0?Ke.maxX:Ke.maxY;if(ct>=ce&&zt<ge)ze.push(Ke);else if(!(zt<ce||ct>=ge)){var on=[];if(nt==="Point"||nt==="MultiPoint")Ut(Qe,on,ce,ge,we);else if(nt==="LineString")Hn(Qe,on,ce,ge,we,!1,Ve.lineMetrics);else if(nt==="MultiLineString")Nn(Qe,on,ce,ge,we,!1);else if(nt==="Polygon")Nn(Qe,on,ce,ge,we,!0);else if(nt==="MultiPolygon")for(var gn=0;gn<Qe.length;gn++){var En=[];Nn(Qe[gn],En,ce,ge,we,!0),En.length&&on.push(En)}if(on.length){if(Ve.lineMetrics&&nt==="LineString"){for(gn=0;gn<on.length;gn++)ze.push(mn(Ke.id,nt,on[gn],Ke.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(on.length===1?(nt="LineString",on=on[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=on.length===3?"Point":"MultiPoint"),ze.push(mn(Ke.id,nt,on,Ke.tags))}}}return ze.length?ze:null}function Ut(Se,ne,ce,ge,we){for(var Oe=0;Oe<Se.length;Oe+=3){var $e=Se[Oe+we];$e>=ce&&$e<=ge&&(ne.push(Se[Oe]),ne.push(Se[Oe+1]),ne.push(Se[Oe+2]))}}function Hn(Se,ne,ce,ge,we,Oe,$e){for(var Ve,ze,re=jn(Se),Ke=we===0?An:ti,Qe=Se.start,nt=0;nt<Se.length-3;nt+=3){var ct=Se[nt],zt=Se[nt+1],on=Se[nt+2],gn=Se[nt+3],En=Se[nt+4],Vn=we===0?ct:zt,Cr=we===0?gn:En,Gr=!1;$e&&(Ve=Math.sqrt(Math.pow(ct-gn,2)+Math.pow(zt-En,2))),Vn<ce?Cr>ce&&(ze=Ke(re,ct,zt,gn,En,ce),$e&&(re.start=Qe+Ve*ze)):Vn>ge?Cr<ge&&(ze=Ke(re,ct,zt,gn,En,ge),$e&&(re.start=Qe+Ve*ze)):Wt(re,ct,zt,on),Cr<ce&&Vn>=ce&&(ze=Ke(re,ct,zt,gn,En,ce),Gr=!0),Cr>ge&&Vn<=ge&&(ze=Ke(re,ct,zt,gn,En,ge),Gr=!0),!Oe&&Gr&&($e&&(re.end=Qe+Ve*ze),ne.push(re),re=jn(Se)),$e&&(Qe+=Ve)}var Ln=Se.length-3;ct=Se[Ln],zt=Se[Ln+1],on=Se[Ln+2],(Vn=we===0?ct:zt)>=ce&&Vn<=ge&&Wt(re,ct,zt,on),Ln=re.length-3,Oe&&Ln>=3&&(re[Ln]!==re[0]||re[Ln+1]!==re[1])&&Wt(re,re[0],re[1],re[2]),re.length&&ne.push(re)}function jn(Se){var ne=[];return ne.size=Se.size,ne.start=Se.start,ne.end=Se.end,ne}function Nn(Se,ne,ce,ge,we,Oe){for(var $e=0;$e<Se.length;$e++)Hn(Se[$e],ne,ce,ge,we,Oe,!1)}function Wt(Se,ne,ce,ge){Se.push(ne),Se.push(ce),Se.push(ge)}function An(Se,ne,ce,ge,we,Oe){var $e=(Oe-ne)/(ge-ne);return Se.push(Oe),Se.push(ce+(we-ce)*$e),Se.push(1),$e}function ti(Se,ne,ce,ge,we,Oe){var $e=(Oe-ce)/(we-ce);return Se.push(ne+(ge-ne)*$e),Se.push(Oe),Se.push(1),$e}function Bn(Se,ne){for(var ce=[],ge=0;ge<Se.length;ge++){var we,Oe=Se[ge],$e=Oe.type;if($e==="Point"||$e==="MultiPoint"||$e==="LineString")we=yt(Oe.geometry,ne);else if($e==="MultiLineString"||$e==="Polygon"){we=[];for(var Ve=0;Ve<Oe.geometry.length;Ve++)we.push(yt(Oe.geometry[Ve],ne))}else if($e==="MultiPolygon")for(we=[],Ve=0;Ve<Oe.geometry.length;Ve++){for(var ze=[],re=0;re<Oe.geometry[Ve].length;re++)ze.push(yt(Oe.geometry[Ve][re],ne));we.push(ze)}ce.push(mn(Oe.id,$e,we,Oe.tags))}return ce}function yt(Se,ne){var ce=[];ce.size=Se.size,Se.start!==void 0&&(ce.start=Se.start,ce.end=Se.end);for(var ge=0;ge<Se.length;ge+=3)ce.push(Se[ge]+ne,Se[ge+1],Se[ge+2]);return ce}function mr(Se,ne){if(Se.transformed)return Se;var ce,ge,we,Oe=1<<Se.z,$e=Se.x,Ve=Se.y;for(ce=0;ce<Se.features.length;ce++){var ze=Se.features[ce],re=ze.geometry,Ke=ze.type;if(ze.geometry=[],Ke===1)for(ge=0;ge<re.length;ge+=2)ze.geometry.push(or(re[ge],re[ge+1],ne,Oe,$e,Ve));else for(ge=0;ge<re.length;ge++){var Qe=[];for(we=0;we<re[ge].length;we+=2)Qe.push(or(re[ge][we],re[ge][we+1],ne,Oe,$e,Ve));ze.geometry.push(Qe)}}return Se.transformed=!0,Se}function or(Se,ne,ce,ge,we,Oe){return[Math.round(ce*(Se*ge-we)),Math.round(ce*(ne*ge-Oe))]}function gi(Se,ne,ce,ge,we){for(var Oe=ne===we.maxZoom?0:we.tolerance/((1<<ne)*we.extent),$e={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:ge,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ve=0;Ve<Se.length;Ve++){$e.numFeatures++,Un($e,Se[Ve],Oe,we);var ze=Se[Ve].minX,re=Se[Ve].minY,Ke=Se[Ve].maxX,Qe=Se[Ve].maxY;ze<$e.minX&&($e.minX=ze),re<$e.minY&&($e.minY=re),Ke>$e.maxX&&($e.maxX=Ke),Qe>$e.maxY&&($e.maxY=Qe)}return $e}function Un(Se,ne,ce,ge){var we=ne.geometry,Oe=ne.type,$e=[];if(Oe==="Point"||Oe==="MultiPoint")for(var Ve=0;Ve<we.length;Ve+=3)$e.push(we[Ve]),$e.push(we[Ve+1]),Se.numPoints++,Se.numSimplified++;else if(Oe==="LineString")Fe($e,we,Se,ce,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(Ve=0;Ve<we.length;Ve++)Fe($e,we[Ve],Se,ce,Oe==="Polygon",Ve===0);else if(Oe==="MultiPolygon")for(var ze=0;ze<we.length;ze++){var re=we[ze];for(Ve=0;Ve<re.length;Ve++)Fe($e,re[Ve],Se,ce,!0,Ve===0)}if($e.length){var Ke=ne.tags||null;if(Oe==="LineString"&&ge.lineMetrics){for(var Qe in Ke={},ne.tags)Ke[Qe]=ne.tags[Qe];Ke.mapbox_clip_start=we.start/we.size,Ke.mapbox_clip_end=we.end/we.size}var nt={geometry:$e,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:Ke};ne.id!==null&&(nt.id=ne.id),Se.features.push(nt)}}function Fe(Se,ne,ce,ge,we,Oe){var $e=ge*ge;if(ge>0&&ne.size<(we?$e:ge))ce.numPoints+=ne.length/3;else{for(var Ve=[],ze=0;ze<ne.length;ze+=3)(ge===0||ne[ze+2]>$e)&&(ce.numSimplified++,Ve.push(ne[ze]),Ve.push(ne[ze+1])),ce.numPoints++;we&&function(re,Ke){for(var Qe=0,nt=0,ct=re.length,zt=ct-2;nt<ct;zt=nt,nt+=2)Qe+=(re[nt]-re[zt])*(re[nt+1]+re[zt+1]);if(Qe>0===Ke)for(nt=0,ct=re.length;nt<ct/2;nt+=2){var on=re[nt],gn=re[nt+1];re[nt]=re[ct-2-nt],re[nt+1]=re[ct-1-nt],re[ct-2-nt]=on,re[ct-1-nt]=gn}}(Ve,Oe),Se.push(Ve)}}function mt(Se,ne){var ce=(ne=this.options=function(we,Oe){for(var $e in Oe)we[$e]=Oe[$e];return we}(Object.create(this.options),ne)).debug;if(ce&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(we,Oe){var $e=[];if(we.type==="FeatureCollection")for(var Ve=0;Ve<we.features.length;Ve++)Ge($e,we.features[Ve],Oe,Ve);else Ge($e,we.type==="Feature"?we:{geometry:we},Oe);return $e}(Se,ne);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(we,Oe){var $e=Oe.buffer/Oe.extent,Ve=we,ze=it(we,1,-1-$e,$e,0,-1,2,Oe),re=it(we,1,1-$e,2+$e,0,-1,2,Oe);return(ze||re)&&(Ve=it(we,1,-$e,1+$e,0,-1,2,Oe)||[],ze&&(Ve=Bn(ze,1).concat(Ve)),re&&(Ve=Ve.concat(Bn(re,-1)))),Ve}(ge,ne),ge.length&&this.splitTile(ge,0,0,0),ce&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vt(Se,ne,ce){return 32*((1<<Se)*ce+ne)+Se}function Dt(Se,ne){return ne?Se.properties[ne]:Se.id}function rn(Se,ne){if(Se==null)return!0;if(Se.type==="Feature")return Dt(Se,ne)!=null;if(Se.type==="FeatureCollection"){const ce=new Set;for(const ge of Se.features){const we=Dt(ge,ne);if(we==null||ce.has(we))return!1;ce.add(we)}return!0}return!1}function tn(Se,ne){const ce=new Map;if(Se!=null)if(Se.type==="Feature")ce.set(Dt(Se,ne),Se);else for(const ge of Se.features)ce.set(Dt(ge,ne),ge);return ce}mt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},mt.prototype.splitTile=function(Se,ne,ce,ge,we,Oe,$e){for(var Ve=[Se,ne,ce,ge],ze=this.options,re=ze.debug;Ve.length;){ge=Ve.pop(),ce=Ve.pop(),ne=Ve.pop(),Se=Ve.pop();var Ke=1<<ne,Qe=vt(ne,ce,ge),nt=this.tiles[Qe];if(!nt&&(re>1&&console.time("creation"),nt=this.tiles[Qe]=gi(Se,ne,ce,ge,ze),this.tileCoords.push({z:ne,x:ce,y:ge}),re)){re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,ce,ge,nt.numFeatures,nt.numPoints,nt.numSimplified),console.timeEnd("creation"));var ct="z"+ne;this.stats[ct]=(this.stats[ct]||0)+1,this.total++}if(nt.source=Se,we){if(ne===ze.maxZoom||ne===we)continue;var zt=1<<we-ne;if(ce!==Math.floor(Oe/zt)||ge!==Math.floor($e/zt))continue}else if(ne===ze.indexMaxZoom||nt.numPoints<=ze.indexMaxPoints)continue;if(nt.source=null,Se.length!==0){re>1&&console.time("clipping");var on,gn,En,Vn,Cr,Gr,Ln=.5*ze.buffer/ze.extent,Rr=.5-Ln,ni=.5+Ln,Ci=1+Ln;on=gn=En=Vn=null,Cr=it(Se,Ke,ce-Ln,ce+ni,0,nt.minX,nt.maxX,ze),Gr=it(Se,Ke,ce+Rr,ce+Ci,0,nt.minX,nt.maxX,ze),Se=null,Cr&&(on=it(Cr,Ke,ge-Ln,ge+ni,1,nt.minY,nt.maxY,ze),gn=it(Cr,Ke,ge+Rr,ge+Ci,1,nt.minY,nt.maxY,ze),Cr=null),Gr&&(En=it(Gr,Ke,ge-Ln,ge+ni,1,nt.minY,nt.maxY,ze),Vn=it(Gr,Ke,ge+Rr,ge+Ci,1,nt.minY,nt.maxY,ze),Gr=null),re>1&&console.timeEnd("clipping"),Ve.push(on||[],ne+1,2*ce,2*ge),Ve.push(gn||[],ne+1,2*ce,2*ge+1),Ve.push(En||[],ne+1,2*ce+1,2*ge),Ve.push(Vn||[],ne+1,2*ce+1,2*ge+1)}}},mt.prototype.getTile=function(Se,ne,ce){var ge=this.options,we=ge.extent,Oe=ge.debug;if(Se<0||Se>24)return null;var $e=1<<Se,Ve=vt(Se,ne=(ne%$e+$e)%$e,ce);if(this.tiles[Ve])return mr(this.tiles[Ve],we);Oe>1&&console.log("drilling down to z%d-%d-%d",Se,ne,ce);for(var ze,re=Se,Ke=ne,Qe=ce;!ze&&re>0;)re--,Ke=Math.floor(Ke/2),Qe=Math.floor(Qe/2),ze=this.tiles[vt(re,Ke,Qe)];return ze&&ze.source?(Oe>1&&console.log("found parent tile z%d-%d-%d",re,Ke,Qe),Oe>1&&console.time("drilling down"),this.splitTile(ze.source,re,Ke,Qe,Se,ne,ce),Oe>1&&console.timeEnd("drilling down"),this.tiles[Ve]?mr(this.tiles[Ve],we):null):null};class br extends _{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ne,ce){return u._(this,void 0,void 0,function*(){const ge=ne.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const we=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!we)return null;const Oe=new class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=Ve.length,this._features=Ve}feature(Ve){return new class{constructor(ze){this._feature=ze,this.extent=u.W,this.type=ze.type,this.properties=ze.tags,"id"in ze&&!isNaN(ze.id)&&(this.id=parseInt(ze.id,10))}loadGeometry(){if(this._feature.type===1){const ze=[];for(const re of this._feature.geometry)ze.push([new u.P(re[0],re[1])]);return ze}{const ze=[];for(const re of this._feature.geometry){const Ke=[];for(const Qe of re)Ke.push(new u.P(Qe[0],Qe[1]));ze.push(Ke)}return ze}}toGeoJSON(ze,re,Ke){return L.call(this,ze,re,Ke)}}(this._features[Ve])}}(we.features);let $e=De(Oe);return $e.byteOffset===0&&$e.byteLength===$e.buffer.byteLength||($e=new Uint8Array($e)),{vectorTile:Oe,rawData:$e.buffer}})}loadData(ne){return u._(this,void 0,void 0,function*(){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.abort();const ge=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bs(ne.request);this._pendingRequest=new AbortController;try{let we=yield this.loadGeoJSON(ne,this._pendingRequest);if(delete this._pendingRequest,typeof we!="object")throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(z(we,!0),ne.filter){const $e=u.by(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if($e.result==="error")throw new Error($e.value.map(ze=>`${ze.key}: ${ze.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(ze=>$e.value.evaluate({zoom:0},ze))}}this._geoJSONIndex=ne.cluster?new Je(function({superclusterOptions:$e,clusterProperties:Ve}){if(!Ve||!$e)return $e;const ze={},re={},Ke={accumulated:null,zoom:0},Qe={properties:null},nt=Object.keys(Ve);for(const ct of nt){const[zt,on]=Ve[ct],gn=u.by(on),En=u.by(typeof zt=="string"?[zt,["accumulated"],["get",ct]]:zt);ze[ct]=gn.value,re[ct]=En.value}return $e.map=ct=>{Qe.properties=ct;const zt={};for(const on of nt)zt[on]=ze[on].evaluate(Ke,Qe);return zt},$e.reduce=(ct,zt)=>{Qe.properties=zt;for(const on of nt)Ke.accumulated=ct[on],ct[on]=re[on].evaluate(Ke,Qe)},$e}(ne)).load(we.features):function($e,Ve){return new mt($e,Ve)}(we,ne.geojsonVtOptions),this.loaded={};const Oe={};if(ge){const $e=ge.finish();$e&&(Oe.resourceTiming={},Oe.resourceTiming[ne.source]=JSON.parse(JSON.stringify($e)))}return Oe}catch(we){if(delete this._pendingRequest,u.bz(we))return{abandoned:!0};throw we}})}reloadTile(ne){const ce=this.loaded;return ce&&ce[ne.uid]?super.reloadTile(ne):this.loadTile(ne)}loadGeoJSON(ne,ce){return u._(this,void 0,void 0,function*(){const{promoteId:ge}=ne;if(ne.request){const we=yield u.h(ne.request,ce);return this._dataUpdateable=rn(we.data,ge)?tn(we.data,ge):void 0,we.data}if(typeof ne.data=="string")try{const we=JSON.parse(ne.data);return this._dataUpdateable=rn(we,ge)?tn(we,ge):void 0,we}catch{throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`)}if(!ne.dataDiff)throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ne.source}`);return function(we,Oe,$e){var Ve,ze,re,Ke;if(Oe.removeAll&&we.clear(),Oe.remove)for(const Qe of Oe.remove)we.delete(Qe);if(Oe.add)for(const Qe of Oe.add){const nt=Dt(Qe,$e);nt!=null&&we.set(nt,Qe)}if(Oe.update)for(const Qe of Oe.update){let nt=we.get(Qe.id);if(nt==null)continue;const ct=!Qe.removeAllProperties&&(((Ve=Qe.removeProperties)===null||Ve===void 0?void 0:Ve.length)>0||((ze=Qe.addOrUpdateProperties)===null||ze===void 0?void 0:ze.length)>0);if((Qe.newGeometry||Qe.removeAllProperties||ct)&&(nt=Object.assign({},nt),we.set(Qe.id,nt),ct&&(nt.properties=Object.assign({},nt.properties))),Qe.newGeometry&&(nt.geometry=Qe.newGeometry),Qe.removeAllProperties)nt.properties={};else if(((re=Qe.removeProperties)===null||re===void 0?void 0:re.length)>0)for(const zt of Qe.removeProperties)Object.prototype.hasOwnProperty.call(nt.properties,zt)&&delete nt.properties[zt];if(((Ke=Qe.addOrUpdateProperties)===null||Ke===void 0?void 0:Ke.length)>0)for(const{key:zt,value:on}of Qe.addOrUpdateProperties)nt.properties[zt]=on}}(this._dataUpdateable,ne.dataDiff,ge),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ne){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ne){return this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId)}getClusterChildren(ne){return this._geoJSONIndex.getChildren(ne.clusterId)}getClusterLeaves(ne){return this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset)}}class sr{constructor(ne){this.self=ne,this.actor=new u.C(ne),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ce,ge)=>{if(this.externalWorkerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.externalWorkerSourceTypes[ce]=ge},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=ce=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(ce)},this.actor.registerMessageHandler("LDT",(ce,ge)=>this._getDEMWorkerSource(ce,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RDT",(ce,ge)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ce,ge.source).removeTile(ge)})),this.actor.registerMessageHandler("GCEZ",(ce,ge)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterExpansionZoom(ge)})),this.actor.registerMessageHandler("GCC",(ce,ge)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterChildren(ge)})),this.actor.registerMessageHandler("GCL",(ce,ge)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterLeaves(ge)})),this.actor.registerMessageHandler("LD",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).loadData(ge)),this.actor.registerMessageHandler("LT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).reloadTile(ge)),this.actor.registerMessageHandler("AT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).abortTile(ge)),this.actor.registerMessageHandler("RMT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).removeTile(ge)),this.actor.registerMessageHandler("RS",(ce,ge)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[ce]||!this.workerSources[ce][ge.type]||!this.workerSources[ce][ge.type][ge.source])return;const we=this.workerSources[ce][ge.type][ge.source];delete this.workerSources[ce][ge.type][ge.source],we.removeSource!==void 0&&we.removeSource(ge)})),this.actor.registerMessageHandler("RM",ce=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce]})),this.actor.registerMessageHandler("SR",(ce,ge)=>u._(this,void 0,void 0,function*(){this.referrer=ge})),this.actor.registerMessageHandler("SRPS",(ce,ge)=>this._syncRTLPluginState(ce,ge)),this.actor.registerMessageHandler("IS",(ce,ge)=>u._(this,void 0,void 0,function*(){this.self.importScripts(ge)})),this.actor.registerMessageHandler("SI",(ce,ge)=>this._setImages(ce,ge)),this.actor.registerMessageHandler("UL",(ce,ge)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).update(ge.layers,ge.removedIds)})),this.actor.registerMessageHandler("SL",(ce,ge)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).replace(ge)}))}_setImages(ne,ce){return u._(this,void 0,void 0,function*(){this.availableImages[ne]=ce;for(const ge in this.workerSources[ne]){const we=this.workerSources[ne][ge];for(const Oe in we)we[Oe].availableImages=ce}})}_syncRTLPluginState(ne,ce){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(ce.pluginStatus!=="loading")return u.bA.setState(ce),ce;const ge=ce.pluginURL;if(this.self.importScripts(ge),u.bA.isParsed()){const we={pluginStatus:"loaded",pluginURL:ge};return u.bA.setState(we),we}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ge}`)})}_getAvailableImages(ne){let ce=this.availableImages[ne];return ce||(ce=[]),ce}_getLayerIndex(ne){let ce=this.layerIndexes[ne];return ce||(ce=this.layerIndexes[ne]=new s),ce}_getWorkerSource(ne,ce,ge){if(this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][ce]||(this.workerSources[ne][ce]={}),!this.workerSources[ne][ce][ge]){const we={sendAsync:(Oe,$e)=>(Oe.targetMapId=ne,this.actor.sendAsync(Oe,$e))};switch(ce){case"vector":this.workerSources[ne][ce][ge]=new _(we,this._getLayerIndex(ne),this._getAvailableImages(ne));break;case"geojson":this.workerSources[ne][ce][ge]=new br(we,this._getLayerIndex(ne),this._getAvailableImages(ne));break;default:this.workerSources[ne][ce][ge]=new this.externalWorkerSourceTypes[ce](we,this._getLayerIndex(ne),this._getAvailableImages(ne))}}return this.workerSources[ne][ce][ge]}_getDEMWorkerSource(ne,ce){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][ce]||(this.demWorkerSources[ne][ce]=new x),this.demWorkerSources[ne][ce]}}return u.i(self)&&(self.worker=new sr(self)),sr}),i("index",["exports","./shared"],function(u,s){var d="4.1.3";let p,g;const _={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((l,h)=>{const y=requestAnimationFrame(l);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),h(s.c())})}),getImageData(w,l=0){return this.getImageCanvasContext(w).getImageData(-l,-l,w.width+2*l,w.height+2*l)},getImageCanvasContext(w){const l=window.document.createElement("canvas"),h=l.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return l.width=w.width,l.height=w.height,h.drawImage(w,0,0,w.width,w.height),h},resolveURL:w=>(p||(p=document.createElement("a")),p.href=w,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class x{static testProp(l){if(!x.docStyle)return l[0];for(let h=0;h<l.length;h++)if(l[h]in x.docStyle)return l[h];return l[0]}static create(l,h,y){const v=window.document.createElement(l);return h!==void 0&&(v.className=h),y&&y.appendChild(v),v}static createNS(l,h){return window.document.createElementNS(l,h)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(l,h){l.style[x.transformProp]=h}static addEventListener(l,h,y,v={}){l.addEventListener(h,y,"passive"in v?v:v.capture)}static removeEventListener(l,h,y,v={}){l.removeEventListener(h,y,"passive"in v?v:v.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static getScale(l){const h=l.getBoundingClientRect();return{x:h.width/l.offsetWidth||1,y:h.height/l.offsetHeight||1,boundingClientRect:h}}static getPoint(l,h,y){const v=h.boundingClientRect;return new s.P((y.clientX-v.left)/h.x-l.clientLeft,(y.clientY-v.top)/h.y-l.clientTop)}static mousePos(l,h){const y=x.getScale(l);return x.getPoint(l,y,h)}static touchPos(l,h){const y=[],v=x.getScale(l);for(let A=0;A<h.length;A++)y.push(x.getPoint(l,v,h[A]));return y}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(w){!L&&z&&(E?I(w):T=w)}};let T,z,L=!1,E=!1;function I(w){const l=w.createTexture();w.bindTexture(w.TEXTURE_2D,l);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,z),w.isContextLost())return;C.supported=!0}catch{}w.deleteTexture(l),L=!0}var O;typeof document<"u"&&(z=document.createElement("img"),z.onload=function(){T&&I(T),T=null,E=!0},z.onerror=function(){L=!0,T=null},z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let l,h,y,v;w.resetRequestQueue=()=>{l=[],h=0,y=0,v={}},w.addThrottleControl=$=>{const Z=y++;return v[Z]=$,Z},w.removeThrottleControl=$=>{delete v[$],P()},w.getImage=($,Z,ee=!0)=>new Promise((te,me)=>{C.supported&&($.headers||($.headers={}),$.headers.accept="image/webp,*/*"),s.e($,{type:"image"}),l.push({abortController:Z,requestParameters:$,supportImageRefresh:ee,state:"queued",onError:Ae=>{me(Ae)},onSuccess:Ae=>{te(Ae)}}),P()});const A=$=>s._(this,void 0,void 0,function*(){$.state="running";const{requestParameters:Z,supportImageRefresh:ee,onError:te,onSuccess:me,abortController:Ae}=$,xe=ee===!1&&!s.i(self)&&!s.g(Z.url)&&(!Z.headers||Object.keys(Z.headers).reduce((Be,tt)=>Be&&tt==="accept",!0));h++;const Me=xe?D(Z,Ae):s.m(Z,Ae);try{const Be=yield Me;delete $.abortController,$.state="completed",Be.data instanceof HTMLImageElement||s.b(Be.data)?me(Be):Be.data&&me({data:yield(ve=Be.data,typeof createImageBitmap=="function"?s.d(ve):s.f(ve)),cacheControl:Be.cacheControl,expires:Be.expires})}catch(Be){delete $.abortController,te(Be)}finally{h--,P()}var ve}),P=()=>{const $=(()=>{for(const Z of Object.keys(v))if(v[Z]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Z=h;Z<$&&l.length>0;Z++){const ee=l.shift();ee.abortController.signal.aborted?Z--:A(ee)}},D=($,Z)=>new Promise((ee,te)=>{const me=new Image,Ae=$.url,xe=$.credentials;xe&&xe==="include"?me.crossOrigin="use-credentials":(xe&&xe==="same-origin"||!s.s(Ae))&&(me.crossOrigin="anonymous"),Z.signal.addEventListener("abort",()=>{me.src="",te(s.c())}),me.fetchPriority="high",me.onload=()=>{me.onerror=me.onload=null,ee({data:me})},me.onerror=()=>{me.onerror=me.onload=null,Z.signal.aborted||te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},me.src=Ae})}(O||(O={})),O.resetRequestQueue();class B{constructor(l){this._transformRequestFn=l}transformRequest(l,h){return this._transformRequestFn&&this._transformRequestFn(l,h)||{url:l}}normalizeSpriteURL(l,h,y){const v=function(A){const P=A.match(K);if(!P)throw new Error(`Unable to parse URL "${A}"`);return{protocol:P[1],authority:P[2],path:P[3]||"/",params:P[4]?P[4].split("&"):[]}}(l);return v.path+=`${h}${y}`,function(A){const P=A.params.length?`?${A.params.join("&")}`:"";return`${A.protocol}://${A.authority}${A.path}${P}`}(v)}setTransformRequest(l){this._transformRequestFn=l}}const K=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function H(w){var l=new s.A(3);return l[0]=w[0],l[1]=w[1],l[2]=w[2],l}var q,J=function(w,l,h){return w[0]=l[0]-h[0],w[1]=l[1]-h[1],w[2]=l[2]-h[2],w};q=new s.A(3),s.A!=Float32Array&&(q[0]=0,q[1]=0,q[2]=0);var he=function(w){var l=w[0],h=w[1];return l*l+h*h};function Ee(w){const l=[];if(typeof w=="string")l.push({id:"default",url:w});else if(w&&w.length>0){const h=[];for(const{id:y,url:v}of w){const A=`${y}${v}`;h.indexOf(A)===-1&&(h.push(A),l.push({id:y,url:v}))}}return l}(function(){var w=new s.A(2);s.A!=Float32Array&&(w[0]=0,w[1]=0)})();class Y{constructor(l,h,y,v){this.context=l,this.format=y,this.texture=l.gl.createTexture(),this.update(h,v)}update(l,h,y){const{width:v,height:A}=l,P=!(this.size&&this.size[0]===v&&this.size[1]===A||y),{context:D}=this,{gl:$}=D;if(this.useMipmap=!!(h&&h.useMipmap),$.bindTexture($.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===$.RGBA&&(!h||h.premultiply!==!1)),P)this.size=[v,A],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?$.texImage2D($.TEXTURE_2D,0,this.format,this.format,$.UNSIGNED_BYTE,l):$.texImage2D($.TEXTURE_2D,0,this.format,v,A,0,this.format,$.UNSIGNED_BYTE,l.data);else{const{x:Z,y:ee}=y||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?$.texSubImage2D($.TEXTURE_2D,0,Z,ee,$.RGBA,$.UNSIGNED_BYTE,l):$.texSubImage2D($.TEXTURE_2D,0,Z,ee,v,A,$.RGBA,$.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&$.generateMipmap($.TEXTURE_2D)}bind(l,h,y){const{context:v}=this,{gl:A}=v;A.bindTexture(A.TEXTURE_2D,this.texture),y!==A.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=A.LINEAR),l!==this.filter&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MAG_FILTER,l),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_MIN_FILTER,y||l),this.filter=l),h!==this.wrap&&(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_S,h),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function oe(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class ke extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:h,promiseResolve:y}of this.requestors)y(this._getImagesForIds(h));this.requestors=[]}}getImage(l){const h=this.images[l];if(h&&!h.data&&h.spriteData){const y=h.spriteData;h.data=new s.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),h.spriteData=null}return h}addImage(l,h){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,h)&&(this.images[l]=h)}_validate(l,h){let y=!0;const v=h.data||h.spriteData;return this._validateStretch(h.stretchX,v&&v.width)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,v&&v.height)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,h){if(!l)return!0;let y=0;for(const v of l){if(v[0]<y||v[1]<v[0]||h<v[1])return!1;y=v[1]}return!0}_validateContent(l,h){if(!l)return!0;if(l.length!==4)return!1;const y=h.spriteData,v=y&&y.width||h.data.width,A=y&&y.height||h.data.height;return!(l[0]<0||v<l[0]||l[1]<0||A<l[1]||l[2]<0||v<l[2]||l[3]<0||A<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,h,y=!0){const v=this.getImage(l);if(y&&(v.data.width!==h.data.width||v.data.height!==h.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=v.version+1,this.images[l]=h,this.updatedImages[l]=!0}removeImage(l){const h=this.images[l];delete this.images[l],delete this.patterns[l],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((h,y)=>{let v=!0;if(!this.isLoaded())for(const A of l)this.images[A]||(v=!1);this.isLoaded()||v?h(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:h})})}_getImagesForIds(l){const h={};for(const y of l){let v=this.getImage(y);v||(this.fire(new s.k("styleimagemissing",{id:y})),v=this.getImage(y)),v?h[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:l,height:h}=this.atlasImage;return{width:l,height:h}}getPattern(l){const h=this.patterns[l],y=this.getImage(l);if(!y)return null;if(h&&h.position.version===y.version)return h.position;if(h)h.position.version=y.version;else{const v={w:y.data.width+2,h:y.data.height+2,x:0,y:0},A=new s.I(v,y);this.patterns[l]={bin:v,position:A}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const h=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Y(l,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const A in this.patterns)l.push(this.patterns[A].bin);const{w:h,h:y}=s.p(l),v=this.atlasImage;v.resize({width:h||1,height:y||1});for(const A in this.patterns){const{bin:P}=this.patterns[A],D=P.x+1,$=P.y+1,Z=this.getImage(A).data,ee=Z.width,te=Z.height;s.R.copy(Z,v,{x:0,y:0},{x:D,y:$},{width:ee,height:te}),s.R.copy(Z,v,{x:0,y:te-1},{x:D,y:$-1},{width:ee,height:1}),s.R.copy(Z,v,{x:0,y:0},{x:D,y:$+te},{width:ee,height:1}),s.R.copy(Z,v,{x:ee-1,y:0},{x:D-1,y:$},{width:1,height:te}),s.R.copy(Z,v,{x:0,y:0},{x:D+ee,y:$},{width:1,height:te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const h of l){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const y=this.getImage(h);y||s.w(`Image with ID: "${h}" was not found`),oe(y)&&this.updateImage(h,y)}}}const ye=1e20;function Ne(w,l,h,y,v,A,P,D,$){for(let Z=l;Z<l+y;Z++)Ue(w,h*A+Z,A,v,P,D,$);for(let Z=h;Z<h+v;Z++)Ue(w,Z*A+l,1,y,P,D,$)}function Ue(w,l,h,y,v,A,P){A[0]=0,P[0]=-ye,P[1]=ye,v[0]=w[l];for(let D=1,$=0,Z=0;D<y;D++){v[D]=w[l+D*h];const ee=D*D;do{const te=A[$];Z=(v[D]-v[te]+ee-te*te)/(D-te)/2}while(Z<=P[$]&&--$>-1);$++,A[$]=D,P[$]=Z,P[$+1]=ye}for(let D=0,$=0;D<y;D++){for(;P[$+1]<D;)$++;const Z=A[$],ee=D-Z;w[l+D*h]=v[Z]+ee*ee}}class De{constructor(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return s._(this,void 0,void 0,function*(){const h=[];for(const A in l)for(const P of l[A])h.push(this._getAndCacheGlyphsPromise(A,P));const y=yield Promise.all(h),v={};for(const{stack:A,id:P,glyph:D}of y)v[A]||(v[A]={}),v[A][P]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return v})}_getAndCacheGlyphsPromise(l,h){return s._(this,void 0,void 0,function*(){let y=this.entries[l];y||(y=this.entries[l]={glyphs:{},requests:{},ranges:{}});let v=y.glyphs[h];if(v!==void 0)return{stack:l,id:h,glyph:v};if(v=this._tinySDF(y,l,h),v)return y.glyphs[h]=v,{stack:l,id:h,glyph:v};const A=Math.floor(h/256);if(256*A>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[A])return{stack:l,id:h,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[A]){const D=De.loadGlyphRange(l,A,this.url,this.requestManager);y.requests[A]=D}const P=yield y.requests[A];for(const D in P)this._doesCharSupportLocalGlyph(+D)||(y.glyphs[+D]=P[+D]);return y.ranges[A]=!0,{stack:l,id:h,glyph:P[h]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](l)||s.u["Hangul Syllables"](l)||s.u.Hiragana(l)||s.u.Katakana(l))}_tinySDF(l,h,y){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(y))return;let A=l.tinySDF;if(!A){let D="400";/bold/i.test(h)?D="900":/medium/i.test(h)?D="500":/light/i.test(h)&&(D="200"),A=l.tinySDF=new De.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:D})}const P=A.draw(String.fromCharCode(y));return{id:y,bitmap:new s.o({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}De.loadGlyphRange=function(w,l,h,y){return s._(this,void 0,void 0,function*(){const v=256*l,A=v+255,P=y.transformRequest(h.replace("{fontstack}",w).replace("{range}",`${v}-${A}`),"Glyphs"),D=yield s.l(P,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${l}, ${v}-${A}`);const $={};for(const Z of s.n(D.data))$[Z.id]=Z;return $})},De.TinySDF=class{constructor({fontSize:w=24,buffer:l=3,radius:h=8,cutoff:y=.25,fontFamily:v="sans-serif",fontWeight:A="normal",fontStyle:P="normal"}={}){this.buffer=l,this.cutoff=y,this.radius=h;const D=this.size=w+4*l,$=this._createCanvas(D),Z=this.ctx=$.getContext("2d",{willReadFrequently:!0});Z.font=`${P} ${A} ${w}px ${v}`,Z.textBaseline="alphabetic",Z.textAlign="left",Z.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(w){const l=document.createElement("canvas");return l.width=l.height=w,l}draw(w){const{width:l,actualBoundingBoxAscent:h,actualBoundingBoxDescent:y,actualBoundingBoxLeft:v,actualBoundingBoxRight:A}=this.ctx.measureText(w),P=Math.ceil(h),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(A-v))),$=Math.min(this.size-this.buffer,P+Math.ceil(y)),Z=D+2*this.buffer,ee=$+2*this.buffer,te=Math.max(Z*ee,0),me=new Uint8ClampedArray(te),Ae={data:me,width:Z,height:ee,glyphWidth:D,glyphHeight:$,glyphTop:P,glyphLeft:0,glyphAdvance:l};if(D===0||$===0)return Ae;const{ctx:xe,buffer:Me,gridInner:ve,gridOuter:Be}=this;xe.clearRect(Me,Me,D,$),xe.fillText(w,Me,Me+P);const tt=xe.getImageData(Me,Me,D,$);Be.fill(ye,0,te),ve.fill(0,0,te);for(let Ie=0;Ie<$;Ie++)for(let He=0;He<D;He++){const rt=tt.data[4*(Ie*D+He)+3]/255;if(rt===0)continue;const ot=(Ie+Me)*Z+He+Me;if(rt===1)Be[ot]=0,ve[ot]=ye;else{const ut=.5-rt;Be[ot]=ut>0?ut*ut:0,ve[ot]=ut<0?ut*ut:0}}Ne(Be,0,0,Z,ee,Z,this.f,this.v,this.z),Ne(ve,Me,Me,D,$,Z,this.f,this.v,this.z);for(let Ie=0;Ie<te;Ie++){const He=Math.sqrt(Be[Ie])-Math.sqrt(ve[Ie]);me[Ie]=Math.round(255-255*(He/this.radius+this.cutoff))}return Ae}};class Le{constructor(){this.specification=s.v.light.position}possiblyEvaluate(l,h){return s.y(l.expression.evaluate(h))}interpolate(l,h,y){return{x:s.z.number(l.x,h.x,y),y:s.z.number(l.y,h.y,y),z:s.z.number(l.z,h.z,y)}}}let lt;class Ze extends s.E{constructor(l){super(),lt=lt||new s.q({anchor:new s.D(s.v.light.anchor),position:new Le,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(lt),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,h={}){if(!this._validate(s.r,l,h))for(const y in l){const v=l[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),v):this._transitionable.setValue(y,v)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,y){return(!y||y.validate!==!1)&&s.t(this,l.call(s.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class at{constructor(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,h){const y=l.join(",")+String(h);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(l,h)),this.dashEntry[y]}getDashRanges(l,h,y){const v=[];let A=l.length%2==1?-l[l.length-1]*y:0,P=l[0]*y,D=!0;v.push({left:A,right:P,isDash:D,zeroLength:l[0]===0});let $=l[0];for(let Z=1;Z<l.length;Z++){D=!D;const ee=l[Z];A=$*y,$+=ee,P=$*y,v.push({left:A,right:P,isDash:D,zeroLength:ee===0})}return v}addRoundDash(l,h,y){const v=h/2;for(let A=-y;A<=y;A++){const P=this.width*(this.nextRow+y+A);let D=0,$=l[D];for(let Z=0;Z<this.width;Z++){Z/$.right>1&&($=l[++D]);const ee=Math.abs(Z-$.left),te=Math.abs(Z-$.right),me=Math.min(ee,te);let Ae;const xe=A/y*(v+1);if($.isDash){const Me=v-Math.abs(xe);Ae=Math.sqrt(me*me+Me*Me)}else Ae=v-Math.sqrt(me*me+xe*xe);this.data[P+Z]=Math.max(0,Math.min(255,Ae+128))}}}addRegularDash(l){for(let D=l.length-1;D>=0;--D){const $=l[D],Z=l[D+1];$.zeroLength?l.splice(D,1):Z&&Z.isDash===$.isDash&&(Z.left=$.left,l.splice(D,1))}const h=l[0],y=l[l.length-1];h.isDash===y.isDash&&(h.left=y.left-this.width,y.right=h.right+this.width);const v=this.width*this.nextRow;let A=0,P=l[A];for(let D=0;D<this.width;D++){D/P.right>1&&(P=l[++A]);const $=Math.abs(D-P.left),Z=Math.abs(D-P.right),ee=Math.min($,Z);this.data[v+D]=Math.max(0,Math.min(255,(P.isDash?ee:-ee)+128))}}addDash(l,h){const y=h?7:0,v=2*y+1;if(this.nextRow+v>this.height)return s.w("LineAtlas out of space"),null;let A=0;for(let D=0;D<l.length;D++)A+=l[D];if(A!==0){const D=this.width/A,$=this.getDashRanges(l,this.width,D);h?this.addRoundDash($,D,y):this.addRegularDash($)}const P={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:A};return this.nextRow+=v,this.dirty=!0,P}bind(l){const h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const dt="maplibre_preloaded_worker_pool";class pt{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<pt.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[dt]}numActive(){return Object.keys(this.active).length}}const Je=Math.floor(_.hardwareConcurrency/2);let xt,Mt;function Ot(){return xt||(xt=new pt),xt}pt.workerCount=s.B(globalThis)?Math.max(Math.min(Je,3),1):1;class Yt{constructor(l,h){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=h;const y=this.workerPool.acquire(h);for(let v=0;v<y.length;v++){const A=new s.C(y[v],h);A.name=`Worker ${v}`,this.actors.push(A)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,h){const y=[];for(const v of this.actors)y.push(v.sendAsync({type:l,data:h}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,h){for(const y of this.actors)y.registerMessageHandler(l,h)}}function nn(){return Mt||(Mt=new Yt(Ot(),s.G),Mt.registerMessageHandler("GR",(w,l,h)=>s.m(l,h))),Mt}function Qt(w,l){const h=s.F();return s.H(h,h,[1,1,0]),s.J(h,h,[.5*w.width,.5*w.height,1]),s.K(h,h,w.calculatePosMatrix(l.toUnwrapped()))}function fn(w,l,h,y,v,A){const P=function(te,me,Ae){if(te)for(const xe of te){const Me=me[xe];if(Me&&Me.source===Ae&&Me.type==="fill-extrusion")return!0}else for(const xe in me){const Me=me[xe];if(Me.source===Ae&&Me.type==="fill-extrusion")return!0}return!1}(v&&v.layers,l,w.id),D=A.maxPitchScaleFactor(),$=w.tilesIn(y,D,P);$.sort(mn);const Z=[];for(const te of $)Z.push({wrappedTileID:te.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(l,h,w._state,te.queryGeometry,te.cameraQueryGeometry,te.scale,v,A,D,Qt(w.transform,te.tileID))});const ee=function(te){const me={},Ae={};for(const xe of te){const Me=xe.queryResults,ve=xe.wrappedTileID,Be=Ae[ve]=Ae[ve]||{};for(const tt in Me){const Ie=Me[tt],He=Be[tt]=Be[tt]||{},rt=me[tt]=me[tt]||[];for(const ot of Ie)He[ot.featureIndex]||(He[ot.featureIndex]=!0,rt.push(ot))}}return me}(Z);for(const te in ee)ee[te].forEach(me=>{const Ae=me.feature,xe=w.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=xe});return ee}function mn(w,l){const h=w.tileID,y=l.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}function qe(w,l,h){return s._(this,void 0,void 0,function*(){let y=w;if(w.url?y=(yield s.h(l.transformRequest(w.url,"Source"),h)).data:yield _.frameAsync(h),!y)return null;const v=s.L(s.e(y,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(v.vectorLayerIds=y.vector_layers.map(A=>A.id)),v})}class Ge{constructor(l,h){l&&(h?this.setSouthWest(l).setNorthEast(h):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}extend(l){const h=this._sw,y=this._ne;let v,A;if(l instanceof s.M)v=l,A=l;else{if(!(l instanceof Ge))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Ge.convert(l)):this.extend(s.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(s.M.convert(l)):this;if(v=l._sw,A=l._ne,!v||!A)return this}return h||y?(h.lng=Math.min(v.lng,h.lng),h.lat=Math.min(v.lat,h.lat),y.lng=Math.max(A.lng,y.lng),y.lat=Math.max(A.lat,y.lat)):(this._sw=new s.M(v.lng,v.lat),this._ne=new s.M(A.lng,A.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:h,lat:y}=s.M.convert(l);let v=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&v}static convert(l){return l instanceof Ge?l:l&&new Ge(l)}static fromLngLat(l,h=0){const y=360*h/40075017,v=y/Math.cos(Math.PI/180*l.lat);return new Ge(new s.M(l.lng-v,l.lat-y),new s.M(l.lng+v,l.lat+y))}}class gt{constructor(l,h,y){this.bounds=Ge.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const h=Math.pow(2,l.z),y=Math.floor(s.N(this.bounds.getWest())*h),v=Math.floor(s.O(this.bounds.getNorth())*h),A=Math.ceil(s.N(this.bounds.getEast())*h),P=Math.ceil(s.O(this.bounds.getSouth())*h);return l.x>=y&&l.x<A&&l.y>=v&&l.y<P}}class et extends s.E{constructor(l,h,y,v){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(h,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(s.e(this,l),l.bounds&&(this.tileBounds=new gt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(h,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((A,P)=>{l.reloadPromise={resolve:A,reject:P}})}else l.actor=this.dispatcher.getActor(),v="LT";l.abortController=new AbortController;try{const A=yield l.actor.sendAsync({type:v,data:y},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,A)}catch(A){if(delete l.abortController,l.aborted)return;if(A&&A.status!==404)throw A;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,h){if(h&&h.resourceTiming&&(l.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&l.setExpiryData(h),l.loadVectorData(h,this.map.painter),l.reloadPromise){const y=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(y.resolve).catch(y.reject)}}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class de extends s.E{constructor(l,h,y,v){super(),this.id=l,this.dispatcher=y,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},h),s.e(this,s.L(h,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(s.e(this,l),l.bounds&&(this.tileBounds=new gt(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return s.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const y=yield O.getImage(this.map._requestManager.transformRequest(h,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&l.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const v=this.map.painter.context,A=v.gl,P=y.data;l.texture=this.map.painter.getTileTexture(P.width),l.texture?l.texture.update(P,{useMipmap:!0}):(l.texture=new Y(v,P,A.RGBA,{useMipmap:!0}),l.texture.bind(A.LINEAR,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),v.extTextureFilterAnisotropic&&A.texParameterf(A.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(y){if(delete l.abortController,l.aborted)l.state="unloaded";else if(y)throw l.state="errored",y}})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class en extends de{constructor(l,h,y,v){super(l,h,y,v),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(h,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const v=yield O.getImage(y,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(v&&v.data){const A=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&l.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const P=s.b(A)&&s.S()?A:yield this.readImageNow(A),D={type:this.type,uid:l.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const $=yield l.actor.sendAsync({type:"LDT",data:D});l.dem=$,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(v){if(delete l.abortController,l.aborted)l.state="unloaded";else if(v)throw l.state="errored",v}})}readImageNow(l){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const h=l.width+2,y=l.height+2;try{return new s.R({width:h,height:y},yield s.V(l,-1,-1,h,y))}catch{}}return _.getImageData(l,1)})}_getNeighboringTiles(l){const h=l.canonical,y=Math.pow(2,h.z),v=(h.x-1+y)%y,A=h.x===0?l.wrap-1:l.wrap,P=(h.x+1+y)%y,D=h.x+1===y?l.wrap+1:l.wrap,$={};return $[new s.Q(l.overscaledZ,A,h.z,v,h.y).key]={backfilled:!1},$[new s.Q(l.overscaledZ,D,h.z,P,h.y).key]={backfilled:!1},h.y>0&&($[new s.Q(l.overscaledZ,A,h.z,v,h.y-1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,l.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,D,h.z,P,h.y-1).key]={backfilled:!1}),h.y+1<y&&($[new s.Q(l.overscaledZ,A,h.z,v,h.y+1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,l.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},$[new s.Q(l.overscaledZ,D,h.z,P,h.y+1).key]={backfilled:!1}),$}unloadTile(l){return s._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Xe extends s.E{constructor(l,h,y,v){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(v),this._data=h.data,this._options=s.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const A=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*A,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*A,extent:s.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:s.W,radius:(h.clusterRadius||50)*A,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,h,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:h,offset:y}})}_updateWorkerData(l){return s._(this,void 0,void 0,function*(){const h=s.e({type:this.type},this.workerOptions);l?h.dataDiff=l:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(_.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let v=null;y.resourceTiming&&y.resourceTiming[this.id]&&(v=y.resourceTiming[this.id].slice(0));const A={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&s.e(A,{resourceTiming:v}),this.fire(new s.k("data",Object.assign(Object.assign({},A),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},A),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.actor?"RT":"LT";l.actor=this.actor;const y={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const v=yield this.actor.sendAsync({type:h,data:y},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(v,this.map.painter,h==="RT")})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var it=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Ut extends s.E{constructor(l,h,y,v){super(),this.id=l,this.dispatcher=y,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h}load(l){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield O.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,l&&(this.coordinates=l),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new s.j(h))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const h=l.map(s.Y.fromLngLat);this.tileID=function(v){let A=1/0,P=1/0,D=-1/0,$=-1/0;for(const me of v)A=Math.min(A,me.x),P=Math.min(P,me.y),D=Math.max(D,me.x),$=Math.max($,me.y);const Z=Math.max(D-A,$-P),ee=Math.max(0,Math.floor(-Math.log(Z)/Math.LN2)),te=Math.pow(2,ee);return new s.a0(ee,Math.floor((A+D)/2*te),Math.floor((P+$)/2*te))}(h),this.minzoom=this.maxzoom=this.tileID.z;const y=h.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,s.W,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,s.W),this._boundsArray.emplaceBack(y[2].x,y[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,h=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Y(l,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const A=this.tiles[v];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Hn extends Ut{constructor(l,h,y,v){super(l,h,y,v),this.roundZoom=!0,this.type="video",this.options=h}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const h of l.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield s.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new s.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const h=this.video.seekable;l<h.start(0)||l>h.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,h=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new Y(l,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const A=this.tiles[v];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class jn extends Ut{constructor(l,h,y,v){super(l,h,y,v),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(A=>!Array.isArray(A)||A.length!==2||A.some(P=>typeof P!="number"))||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,y=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,it.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Y(h,this.canvas,y.RGBA,{premultiply:!0});let v=!1;for(const A in this.tiles){const P=this.tiles[A];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,v=!0)}v&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const Nn={},Wt=w=>{switch(w){case"geojson":return Xe;case"image":return Ut;case"raster":return de;case"raster-dem":return en;case"vector":return et;case"video":return Hn;case"canvas":return jn}return Nn[w]},An="RTLPluginLoaded";class ti extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=nn()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return s._(this,arguments,void 0,function*(h,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=_.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(An))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Bn=null;function yt(){return Bn||(Bn=new ti),Bn}class mr{constructor(l,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=s.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const h=l+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,h,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(v,A){const P={};if(!A)return P;for(const D of v){const $=D.layerIds.map(Z=>A.getLayer(Z)).filter(Boolean);if($.length!==0){D.layers=$,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(Z=>$.filter(ee=>ee.id===Z)[0]));for(const Z of $)P[Z.id]=D}}return P}(l.buckets,h.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const A=this.buckets[v];if(A instanceof s.a5){if(this.hasSymbolBuckets=!0,!y)break;A.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const A=this.buckets[v];if(A instanceof s.a5&&A.hasRTLText){this.hasRTLText=!0,yt().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const A=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(v).queryRadius(A))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const y in this.buckets){const v=this.buckets[y];v.uploadPending()&&v.upload(l)}const h=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Y(l,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Y(l,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,h,y,v,A,P,D,$,Z,ee){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:A,scale:P,tileSize:this.tileSize,pixelPosMatrix:ee,transform:$,params:D,queryPadding:this.queryPadding*Z},l,h,y):{}}querySourceFeatures(l,h){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const v=y.loadVTLayers(),A=h&&h.sourceLayer?h.sourceLayer:"",P=v._geojsonTileLayer||v[A];if(!P)return;const D=s.a6(h&&h.filter),{z:$,x:Z,y:ee}=this.tileID.canonical,te={z:$,x:Z,y:ee};for(let me=0;me<P.length;me++){const Ae=P.feature(me);if(D.needGeometry){const ve=s.a7(Ae,!0);if(!D.filter(new s.a8(this.tileID.overscaledZ),ve,this.tileID.canonical))continue}else if(!D.filter(new s.a8(this.tileID.overscaledZ),Ae))continue;const xe=y.getId(Ae,A),Me=new s.a9(Ae,$,Z,ee,xe);Me.tile=te,l.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const h=this.expirationTime;if(l.cacheControl){const y=s.aa(l.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const y=Date.now();let v=!1;if(this.expirationTime>y)v=!1;else if(h)if(this.expirationTime<h)v=!0;else{const A=this.expirationTime-h;A?this.expirationTime=y+Math.max(A,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!h.style.hasLayer(v))continue;const A=this.buckets[v],P=A.layers[0].sourceLayer||"_geojsonTileLayer",D=y[P],$=l[P];if(!D||!$||Object.keys($).length===0)continue;A.update($,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Z=h&&h.style&&h.style.getLayer(v);Z&&(this.queryPadding=Math.max(this.queryPadding,Z.queryRadius(A)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=_.now()+l}setDependencies(l,h){const y={};for(const v of h)y[v]=!0;this.dependencies[l]=y}hasDependency(l,h){for(const y of l){const v=this.dependencies[y];if(v){for(const A of h)if(v[A])return!0}}return!1}}class or{constructor(l,h){this.max=l,this.onRemove=h,this.reset()}reset(){for(const l in this.data)for(const h of this.data[l])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(l,h,y){const v=l.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const A={value:h,timeout:void 0};if(y!==void 0&&(A.timeout=setTimeout(()=>{this.remove(l,A)},y)),this.data[v].push(A),this.order.push(v),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value}getByKey(l){const h=this.data[l];return h?h[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,h){if(!this.has(l))return this;const y=l.wrapped().key,v=h===void 0?0:this.data[y].indexOf(h),A=this.data[y][v];return this.data[y].splice(v,1),A.timeout&&clearTimeout(A.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(A.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(l){const h=[];for(const y in this.data)for(const v of this.data[y])l(v.value)||h.push(v);for(const y of h)this.remove(y.value.tileID,y)}}class gi{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,h,y){const v=String(h);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][v]=this.stateChanges[l][v]||{},s.e(this.stateChanges[l][v],y),this.deletedStates[l]===null){this.deletedStates[l]={};for(const A in this.state[l])A!==v&&(this.deletedStates[l][A]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][v]===null){this.deletedStates[l][v]={};for(const A in this.state[l][v])y[A]||(this.deletedStates[l][v][A]=null)}else for(const A in y)this.deletedStates[l]&&this.deletedStates[l][v]&&this.deletedStates[l][v][A]===null&&delete this.deletedStates[l][v][A]}removeFeatureState(l,h,y){if(this.deletedStates[l]===null)return;const v=String(h);if(this.deletedStates[l]=this.deletedStates[l]||{},y&&h!==void 0)this.deletedStates[l][v]!==null&&(this.deletedStates[l][v]=this.deletedStates[l][v]||{},this.deletedStates[l][v][y]=null);else if(h!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][v])for(y in this.deletedStates[l][v]={},this.stateChanges[l][v])this.deletedStates[l][v][y]=null;else this.deletedStates[l][v]=null;else this.deletedStates[l]=null}getState(l,h){const y=String(h),v=s.e({},(this.state[l]||{})[y],(this.stateChanges[l]||{})[y]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const A=this.deletedStates[l][h];if(A===null)return{};for(const P in A)delete v[P]}return v}initializeTileState(l,h){l.setFeatureState(this.state,h)}coalesceChanges(l,h){const y={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const A={};for(const P in this.stateChanges[v])this.state[v][P]||(this.state[v][P]={}),s.e(this.state[v][P],this.stateChanges[v][P]),A[P]=this.state[v][P];y[v]=A}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const A={};if(this.deletedStates[v]===null)for(const P in this.state[v])A[P]={},this.state[v][P]={};else for(const P in this.deletedStates[v]){if(this.deletedStates[v][P]===null)this.state[v][P]={};else for(const D of Object.keys(this.deletedStates[v][P]))delete this.state[v][P][D];A[P]=this.state[v][P]}y[v]=y[v]||{},s.e(y[v],A)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const v in l)l[v].setFeatureState(y,h)}}class Un extends s.E{constructor(l,h,y){super(),this.id=l,this.dispatcher=y,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,A,P,D)=>{const $=new(Wt(A.type))(v,A,P,D);if($.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${$.id}`);return $})(l,h,y,this),this._tiles={},this._cache=new or(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new gi,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const h=this._tiles[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,h,y){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,h,y)}catch(v){l.state="errored",v.status!==404?this._source.fire(new s.j(v,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new s.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const y=this._tiles[h];y.upload(l),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Fe).map(l=>l.key)}getRenderableIds(l){const h=[];for(const y in this._tiles)this._isIdRenderable(y,l)&&h.push(this._tiles[y]);return l?h.sort((y,v)=>{const A=y.tileID,P=v.tileID,D=new s.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),$=new s.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-P.overscaledZ||$.y-D.y||$.x-D.x}).map(y=>y.tileID.key):h.map(y=>y.tileID).sort(Fe).map(y=>y.key)}hasRenderableParent(l){const h=this.findLoadedParent(l,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(l,h){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(h||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,h){return s._(this,void 0,void 0,function*(){const y=this._tiles[l];y&&(y.state!=="loading"&&(y.state=h),yield this._loadTile(y,l,h))})}_tileLoaded(l,h,y){l.timeAdded=_.now(),y==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(h,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const h=this.getRenderableIds();for(let v=0;v<h.length;v++){const A=h[v];if(l.neighboringTiles&&l.neighboringTiles[A]){const P=this.getTileByID(A);y(l,P),y(P,l)}}function y(v,A){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let P=A.tileID.canonical.x-v.tileID.canonical.x;const D=A.tileID.canonical.y-v.tileID.canonical.y,$=Math.pow(2,v.tileID.canonical.z),Z=A.tileID.key;P===0&&D===0||Math.abs(D)>1||(Math.abs(P)>1&&(Math.abs(P+$)===1?P+=$:Math.abs(P-$)===1&&(P-=$)),A.dem&&v.dem&&(v.dem.backfillBorder(A.dem,P,D),v.neighboringTiles&&v.neighboringTiles[Z]&&(v.neighboringTiles[Z].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,h,y,v){for(const A in this._tiles){let P=this._tiles[A];if(v[A]||!P.hasData()||P.tileID.overscaledZ<=h||P.tileID.overscaledZ>y)continue;let D=P.tileID;for(;P&&P.tileID.overscaledZ>h+1;){const Z=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[Z.key],P&&P.hasData()&&(D=Z)}let $=D;for(;$.overscaledZ>h;)if($=$.scaledTo($.overscaledZ-1),l[$.key]){v[D.key]=D;break}}}findLoadedParent(l,h){if(l.key in this._loadedParentTiles){const y=this._loadedParentTiles[l.key];return y&&y.tileID.overscaledZ>=h?y:null}for(let y=l.overscaledZ-1;y>=h;y--){const v=l.scaledTo(y),A=this._getLoadedTile(v);if(A)return A}}_getLoadedTile(l){const h=this._tiles[l.key];return h&&h.hasData()?h:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const h=Math.ceil(l.width/this._source.tileSize)+1,y=Math.ceil(l.height/this._source.tileSize)+1,v=Math.floor(h*y*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(A)}handleWrapJump(l){const h=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,h){const y={};for(const v in this._tiles){const A=this._tiles[v];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+h),y[A.tileID.key]=A}this._tiles=y;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(l,h){if(!this._sourceLoaded||this._paused)return;let y;this.transform=l,this.terrain=h,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(ee=>new s.Q(ee.canonical.z,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y)):(y=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(y=y.filter(ee=>this._source.hasTile(ee)))):y=[];const v=l.coveringZoomLevel(this._source),A=Math.max(v-Un.maxOverzooming,this._source.minzoom),P=Math.max(v+Un.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const ee={};for(const te of y)if(te.canonical.z>this._source.minzoom){const me=te.scaledTo(te.canonical.z-1);ee[me.key]=me;const Ae=te.scaledTo(Math.max(this._source.minzoom,Math.min(te.canonical.z,5)));ee[Ae.key]=Ae}y=y.concat(Object.values(ee))}const D=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const $=this._updateRetainedTiles(y,v);if(mt(this._source.type)){const ee={},te={},me=Object.keys($),Ae=_.now();for(const xe of me){const Me=$[xe],ve=this._tiles[xe];if(!ve||ve.fadeEndTime!==0&&ve.fadeEndTime<=Ae)continue;const Be=this.findLoadedParent(Me,A);Be&&(this._addTile(Be.tileID),ee[Be.tileID.key]=Be.tileID),te[xe]=Me}this._retainLoadedChildren(te,v,P,$);for(const xe in ee)$[xe]||(this._coveredTiles[xe]=!0,$[xe]=ee[xe]);if(h){const xe={},Me={};for(const ve of y)this._tiles[ve.key].hasData()?xe[ve.key]=ve:Me[ve.key]=ve;for(const ve in Me){const Be=Me[ve].children(this._source.maxzoom);this._tiles[Be[0].key]&&this._tiles[Be[1].key]&&this._tiles[Be[2].key]&&this._tiles[Be[3].key]&&(xe[Be[0].key]=$[Be[0].key]=Be[0],xe[Be[1].key]=$[Be[1].key]=Be[1],xe[Be[2].key]=$[Be[2].key]=Be[2],xe[Be[3].key]=$[Be[3].key]=Be[3],delete Me[ve])}for(const ve in Me){const Be=this.findLoadedParent(Me[ve],this._source.minzoom);if(Be){xe[Be.tileID.key]=$[Be.tileID.key]=Be.tileID;for(const tt in xe)xe[tt].isChildOf(Be.tileID)&&delete xe[tt]}}for(const ve in this._tiles)xe[ve]||(this._coveredTiles[ve]=!0)}}for(const ee in $)this._tiles[ee].clearFadeHold();const Z=s.ab(this._tiles,$);for(const ee of Z){const te=this._tiles[ee];te.hasSymbolBuckets&&!te.holdingForFade()?te.setHoldDuration(this.map._fadeDuration):te.hasSymbolBuckets&&!te.symbolFadeFinished()||this._removeTile(ee)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,h){const y={},v={},A=Math.max(h-Un.maxOverzooming,this._source.minzoom),P=Math.max(h+Un.maxUnderzooming,this._source.minzoom),D={};for(const $ of l){const Z=this._addTile($);y[$.key]=$,Z.hasData()||h<this._source.maxzoom&&(D[$.key]=$)}this._retainLoadedChildren(D,h,P,y);for(const $ of l){let Z=this._tiles[$.key];if(Z.hasData())continue;if(h+1>this._source.maxzoom){const te=$.children(this._source.maxzoom)[0],me=this.getTile(te);if(me&&me.hasData()){y[te.key]=te;continue}}else{const te=$.children(this._source.maxzoom);if(y[te[0].key]&&y[te[1].key]&&y[te[2].key]&&y[te[3].key])continue}let ee=Z.wasRequested();for(let te=$.overscaledZ-1;te>=A;--te){const me=$.scaledTo(te);if(v[me.key])break;if(v[me.key]=!0,Z=this.getTile(me),!Z&&ee&&(Z=this._addTile(me)),Z){const Ae=Z.hasData();if((ee||Ae)&&(y[me.key]=me),ee=Z.wasRequested(),Ae)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const h=[];let y,v=this._tiles[l].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){y=this._loadedParentTiles[v.key];break}h.push(v.key);const A=v.scaledTo(v.overscaledZ-1);if(y=this._getLoadedTile(A),y)break;v=A}for(const A of h)this._loadedParentTiles[A]=y}}_addTile(l){let h=this._tiles[l.key];if(h)return h;h=this._cache.getAndRemove(l),h&&(this._setTileReloadTimer(l.key,h),h.tileID=l,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,h)));const y=h;return h||(h=new mr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(h,l.key,h.state)),h.uses++,this._tiles[l.key]=h,y||this._source.fire(new s.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(l,h){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const y=h.getExpiryTimeout();y&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},y))}_removeTile(l){const h=this._tiles[l];h&&(h.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(l){const h=l.sourceDataType;l.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,h,y){const v=[],A=this.transform;if(!A)return v;const P=y?A.getCameraQueryGeometry(l):l,D=l.map(xe=>A.pointCoordinate(xe,this.terrain)),$=P.map(xe=>A.pointCoordinate(xe,this.terrain)),Z=this.getIds();let ee=1/0,te=1/0,me=-1/0,Ae=-1/0;for(const xe of $)ee=Math.min(ee,xe.x),te=Math.min(te,xe.y),me=Math.max(me,xe.x),Ae=Math.max(Ae,xe.y);for(let xe=0;xe<Z.length;xe++){const Me=this._tiles[Z[xe]];if(Me.holdingForFade())continue;const ve=Me.tileID,Be=Math.pow(2,A.zoom-Me.tileID.overscaledZ),tt=h*Me.queryPadding*s.W/Me.tileSize/Be,Ie=[ve.getTilePoint(new s.Y(ee,te)),ve.getTilePoint(new s.Y(me,Ae))];if(Ie[0].x-tt<s.W&&Ie[0].y-tt<s.W&&Ie[1].x+tt>=0&&Ie[1].y+tt>=0){const He=D.map(ot=>ve.getTilePoint(ot)),rt=$.map(ot=>ve.getTilePoint(ot));v.push({tile:Me,tileID:ve,queryGeometry:He,cameraQueryGeometry:rt,scale:Be})}}return v}getVisibleCoordinates(l){const h=this.getRenderableIds(l).map(y=>this._tiles[y].tileID);for(const y of h)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(mt(this._source.type)){const l=_.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=l)return!0}return!1}setFeatureState(l,h,y){this._state.updateState(l=l||"_geojsonTileLayer",h,y)}removeFeatureState(l,h,y){this._state.removeFeatureState(l=l||"_geojsonTileLayer",h,y)}getFeatureState(l,h){return this._state.getState(l=l||"_geojsonTileLayer",h)}setDependencies(l,h,y){const v=this._tiles[l];v&&v.setDependencies(h,y)}reloadTilesForDependencies(l,h){for(const y in this._tiles)this._tiles[y].hasDependency(l,h)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(l,h))}}function Fe(w,l){const h=Math.abs(2*w.wrap)-+(w.wrap<0),y=Math.abs(2*l.wrap)-+(l.wrap<0);return w.overscaledZ-l.overscaledZ||y-h||l.canonical.y-w.canonical.y||l.canonical.x-w.canonical.x}function mt(w){return w==="raster"||w==="image"||w==="video"}Un.maxOverzooming=10,Un.maxUnderzooming=3;class vt{constructor(l,h){this.reset(l,h)}reset(l,h){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.ac(l,0,1);let h=1,y=this._distances[h];const v=l*this.paddedLength+this.padding;for(;y<v&&h<this._distances.length;)y=this._distances[++h];const A=h-1,P=this._distances[A],D=y-P,$=D>0?(v-P)/D:0;return this.points[A].mult(1-$).add(this.points[h].mult($))}}function Dt(w,l){let h=!0;return w==="always"||w!=="never"&&l!=="never"||(h=!1),h}class rn{constructor(l,h,y){const v=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(h/y);for(let P=0;P<this.xCellCount*this.yCellCount;P++)v.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,h,y,v,A){this._forEachCell(h,y,v,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(v),this.bboxes.push(A)}insertCircle(l,h,y,v){this._forEachCell(h-v,y-v,h+v,y+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(y),this.circles.push(v)}_insertBoxCell(l,h,y,v,A,P){this.boxCells[A].push(P)}_insertCircleCell(l,h,y,v,A,P){this.circleCells[A].push(P)}_query(l,h,y,v,A,P,D){if(y<0||l>this.width||v<0||h>this.height)return[];const $=[];if(l<=0&&h<=0&&this.width<=y&&this.height<=v){if(A)return[{key:null,x1:l,y1:h,x2:y,y2:v}];for(let Z=0;Z<this.boxKeys.length;Z++)$.push({key:this.boxKeys[Z],x1:this.bboxes[4*Z],y1:this.bboxes[4*Z+1],x2:this.bboxes[4*Z+2],y2:this.bboxes[4*Z+3]});for(let Z=0;Z<this.circleKeys.length;Z++){const ee=this.circles[3*Z],te=this.circles[3*Z+1],me=this.circles[3*Z+2];$.push({key:this.circleKeys[Z],x1:ee-me,y1:te-me,x2:ee+me,y2:te+me})}}else this._forEachCell(l,h,y,v,this._queryCell,$,{hitTest:A,overlapMode:P,seenUids:{box:{},circle:{}}},D);return $}query(l,h,y,v){return this._query(l,h,y,v,!1,null)}hitTest(l,h,y,v,A,P){return this._query(l,h,y,v,!0,A,P).length>0}hitTestCircle(l,h,y,v,A){const P=l-y,D=l+y,$=h-y,Z=h+y;if(D<0||P>this.width||Z<0||$>this.height)return!1;const ee=[];return this._forEachCell(P,$,D,Z,this._queryCellCircle,ee,{hitTest:!0,overlapMode:v,circle:{x:l,y:h,radius:y},seenUids:{box:{},circle:{}}},A),ee.length>0}_queryCell(l,h,y,v,A,P,D,$){const{seenUids:Z,hitTest:ee,overlapMode:te}=D,me=this.boxCells[A];if(me!==null){const xe=this.bboxes;for(const Me of me)if(!Z.box[Me]){Z.box[Me]=!0;const ve=4*Me,Be=this.boxKeys[Me];if(l<=xe[ve+2]&&h<=xe[ve+3]&&y>=xe[ve+0]&&v>=xe[ve+1]&&(!$||$(Be))&&(!ee||!Dt(te,Be.overlapMode))&&(P.push({key:Be,x1:xe[ve],y1:xe[ve+1],x2:xe[ve+2],y2:xe[ve+3]}),ee))return!0}}const Ae=this.circleCells[A];if(Ae!==null){const xe=this.circles;for(const Me of Ae)if(!Z.circle[Me]){Z.circle[Me]=!0;const ve=3*Me,Be=this.circleKeys[Me];if(this._circleAndRectCollide(xe[ve],xe[ve+1],xe[ve+2],l,h,y,v)&&(!$||$(Be))&&(!ee||!Dt(te,Be.overlapMode))){const tt=xe[ve],Ie=xe[ve+1],He=xe[ve+2];if(P.push({key:Be,x1:tt-He,y1:Ie-He,x2:tt+He,y2:Ie+He}),ee)return!0}}}return!1}_queryCellCircle(l,h,y,v,A,P,D,$){const{circle:Z,seenUids:ee,overlapMode:te}=D,me=this.boxCells[A];if(me!==null){const xe=this.bboxes;for(const Me of me)if(!ee.box[Me]){ee.box[Me]=!0;const ve=4*Me,Be=this.boxKeys[Me];if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,xe[ve+0],xe[ve+1],xe[ve+2],xe[ve+3])&&(!$||$(Be))&&!Dt(te,Be.overlapMode))return P.push(!0),!0}}const Ae=this.circleCells[A];if(Ae!==null){const xe=this.circles;for(const Me of Ae)if(!ee.circle[Me]){ee.circle[Me]=!0;const ve=3*Me,Be=this.circleKeys[Me];if(this._circlesCollide(xe[ve],xe[ve+1],xe[ve+2],Z.x,Z.y,Z.radius)&&(!$||$(Be))&&!Dt(te,Be.overlapMode))return P.push(!0),!0}}}_forEachCell(l,h,y,v,A,P,D,$){const Z=this._convertToXCellCoord(l),ee=this._convertToYCellCoord(h),te=this._convertToXCellCoord(y),me=this._convertToYCellCoord(v);for(let Ae=Z;Ae<=te;Ae++)for(let xe=ee;xe<=me;xe++)if(A.call(this,l,h,y,v,this.xCellCount*xe+Ae,P,D,$))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,h,y,v,A,P){const D=v-l,$=A-h,Z=y+P;return Z*Z>D*D+$*$}_circleAndRectCollide(l,h,y,v,A,P,D){const $=(P-v)/2,Z=Math.abs(l-(v+$));if(Z>$+y)return!1;const ee=(D-A)/2,te=Math.abs(h-(A+ee));if(te>ee+y)return!1;if(Z<=$||te<=ee)return!0;const me=Z-$,Ae=te-ee;return me*me+Ae*Ae<=y*y}}function tn(w,l,h,y,v){const A=s.F();return l?(s.J(A,A,[1/v,1/v,1]),h||s.ad(A,A,y.angle)):s.K(A,y.labelPlaneMatrix,w),A}function br(w,l,h,y,v){if(l){const A=s.ae(w);return s.J(A,A,[v,v,1]),h||s.ad(A,A,-y.angle),A}return y.glCoordMatrix}function sr(w,l,h){let y;h?(y=[w.x,w.y,h(w.x,w.y),1],s.af(y,y,l)):(y=[w.x,w.y,0,1],ct(y,y,l));const v=y[3];return{point:new s.P(y[0]/v,y[1]/v),signedDistanceFromCamera:v}}function Se(w,l){return .5+w/l*.5}function ne(w,l){const h=w[0]/w[3],y=w[1]/w[3];return h>=-l[0]&&h<=l[0]&&y>=-l[1]&&y<=l[1]}function ce(w,l,h,y,v,A,P,D,$,Z){const ee=y?w.textSizeData:w.iconSizeData,te=s.ag(ee,h.transform.zoom),me=[256/h.width*2+1,256/h.height*2+1],Ae=y?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;Ae.clear();const xe=w.lineVertexArray,Me=y?w.text.placedSymbolArray:w.icon.placedSymbolArray,ve=h.transform.width/h.transform.height;let Be=!1;for(let tt=0;tt<Me.length;tt++){const Ie=Me.get(tt);if(Ie.hidden||Ie.writingMode===s.ah.vertical&&!Be){nt(Ie.numGlyphs,Ae);continue}let He;if(Be=!1,Z?(He=[Ie.anchorX,Ie.anchorY,Z(Ie.anchorX,Ie.anchorY),1],s.af(He,He,l)):(He=[Ie.anchorX,Ie.anchorY,0,1],ct(He,He,l)),!ne(He,me)){nt(Ie.numGlyphs,Ae);continue}const rt=Se(h.transform.cameraToCenterDistance,He[3]),ot=s.ai(ee,te,Ie),ut=P?ot/rt:ot*rt,kt=new s.P(Ie.anchorX,Ie.anchorY),bt=sr(kt,v,Z).point,Rt={projections:{},offsets:{}},Ft=Oe(Ie,ut,!1,D,l,v,A,w.glyphOffsetArray,xe,Ae,bt,kt,Rt,ve,$,Z);Be=Ft.useVertical,(Ft.notEnoughRoom||Be||Ft.needsFlipping&&Oe(Ie,ut,!0,D,l,v,A,w.glyphOffsetArray,xe,Ae,bt,kt,Rt,ve,$,Z).notEnoughRoom)&&nt(Ie.numGlyphs,Ae)}y?w.text.dynamicLayoutVertexBuffer.updateData(Ae):w.icon.dynamicLayoutVertexBuffer.updateData(Ae)}function ge(w,l,h,y,v,A,P,D,$,Z,ee,te,me){const Ae=D.glyphStartIndex+D.numGlyphs,xe=D.lineStartIndex,Me=D.lineStartIndex+D.lineLength,ve=l.getoffsetX(D.glyphStartIndex),Be=l.getoffsetX(Ae-1),tt=Ke(w*ve,h,y,v,A,P,D.segment,xe,Me,$,Z,ee,te,me);if(!tt)return null;const Ie=Ke(w*Be,h,y,v,A,P,D.segment,xe,Me,$,Z,ee,te,me);return Ie?{first:tt,last:Ie}:null}function we(w,l,h,y){return w===s.ah.horizontal&&Math.abs(h.y-l.y)>Math.abs(h.x-l.x)*y?{useVertical:!0}:(w===s.ah.vertical?l.y<h.y:l.x>h.x)?{needsFlipping:!0}:null}function Oe(w,l,h,y,v,A,P,D,$,Z,ee,te,me,Ae,xe,Me){const ve=l/24,Be=w.lineOffsetX*ve,tt=w.lineOffsetY*ve;let Ie;if(w.numGlyphs>1){const He=w.glyphStartIndex+w.numGlyphs,rt=w.lineStartIndex,ot=w.lineStartIndex+w.lineLength,ut=ge(ve,D,Be,tt,h,ee,te,w,$,A,me,xe,Me);if(!ut)return{notEnoughRoom:!0};const kt=sr(ut.first.point,P,Me).point,bt=sr(ut.last.point,P,Me).point;if(y&&!h){const Rt=we(w.writingMode,kt,bt,Ae);if(Rt)return Rt}Ie=[ut.first];for(let Rt=w.glyphStartIndex+1;Rt<He-1;Rt++)Ie.push(Ke(ve*D.getoffsetX(Rt),Be,tt,h,ee,te,w.segment,rt,ot,$,A,me,xe,Me));Ie.push(ut.last)}else{if(y&&!h){const rt=sr(te,v,Me).point,ot=w.lineStartIndex+w.segment+1,ut=new s.P($.getx(ot),$.gety(ot)),kt=sr(ut,v,Me),bt=kt.signedDistanceFromCamera>0?kt.point:$e(te,ut,rt,1,v,Me),Rt=we(w.writingMode,rt,bt,Ae);if(Rt)return Rt}const He=Ke(ve*D.getoffsetX(w.glyphStartIndex),Be,tt,h,ee,te,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,$,A,me,xe,Me);if(!He)return{notEnoughRoom:!0};Ie=[He]}for(const He of Ie)s.aj(Z,He.point,He.angle);return{}}function $e(w,l,h,y,v,A){const P=sr(w.add(w.sub(l)._unit()),v,A).point,D=h.sub(P);return h.add(D._mult(y/D.mag()))}function Ve(w,l){const{projectionCache:h,lineVertexArray:y,labelPlaneMatrix:v,tileAnchorPoint:A,distanceFromAnchor:P,getElevation:D,previousVertex:$,direction:Z,absOffsetX:ee}=l;if(h.projections[w])return h.projections[w];const te=new s.P(y.getx(w),y.gety(w)),me=sr(te,v,D);if(me.signedDistanceFromCamera>0)return h.projections[w]=me.point,me.point;const Ae=w-Z;return $e(P===0?A:new s.P(y.getx(Ae),y.gety(Ae)),te,$,ee-P+1,v,D)}function ze(w,l,h){return w._unit()._perp()._mult(l*h)}function re(w,l,h,y,v,A,P,D){const{projectionCache:$,direction:Z}=D;if($.offsets[w])return $.offsets[w];const ee=h.add(l);if(w+Z<y||w+Z>=v)return $.offsets[w]=ee,ee;const te=Ve(w+Z,D),me=ze(te.sub(h),P,Z),Ae=h.add(me),xe=te.add(me);return $.offsets[w]=s.ak(A,ee,Ae,xe)||ee,$.offsets[w]}function Ke(w,l,h,y,v,A,P,D,$,Z,ee,te,me,Ae){const xe=y?w-l:w+l;let Me=xe>0?1:-1,ve=0;y&&(Me*=-1,ve=Math.PI),Me<0&&(ve+=Math.PI);let Be,tt,Ie=Me>0?D+P:D+P+1,He=v,rt=v,ot=0,ut=0;const kt=Math.abs(xe),bt=[];let Rt;for(;ot+ut<=kt;){if(Ie+=Me,Ie<D||Ie>=$)return null;ot+=ut,rt=He,tt=Be;const $t={projectionCache:te,lineVertexArray:Z,labelPlaneMatrix:ee,tileAnchorPoint:A,distanceFromAnchor:ot,getElevation:Ae,previousVertex:rt,direction:Me,absOffsetX:kt};if(He=Ve(Ie,$t),h===0)bt.push(rt),Rt=He.sub(rt);else{let _n;const Tn=He.sub(rt);_n=Tn.mag()===0?ze(Ve(Ie+Me,$t).sub(He),h,Me):ze(Tn,h,Me),tt||(tt=rt.add(_n)),Be=re(Ie,_n,He,D,$,tt,h,$t),bt.push(tt),Rt=Be.sub(tt)}ut=Rt.mag()}const Ft=Rt._mult((kt-ot)/ut)._add(tt||rt),Cn=ve+Math.atan2(He.y-rt.y,He.x-rt.x);return bt.push(Ft),{point:Ft,angle:me?Cn:0,path:bt}}const Qe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(w,l){for(let h=0;h<w;h++){const y=l.length;l.resize(y+4),l.float32.set(Qe,3*y)}}function ct(w,l,h){const y=l[0],v=l[1];return w[0]=h[0]*y+h[4]*v+h[12],w[1]=h[1]*y+h[5]*v+h[13],w[3]=h[3]*y+h[7]*v+h[15],w}const zt=100;class on{constructor(l,h=new rn(l.width+200,l.height+200,25),y=new rn(l.width+200,l.height+200,25)){this.transform=l,this.grid=h,this.ignoredGrid=y,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+zt,this.screenBottomBoundary=l.height+zt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,h,y,v,A,P){const D=this.projectAndGetPerspectiveRatio(v,l.anchorPointX,l.anchorPointY,P),$=y*D.perspectiveRatio,Z=l.x1*$+D.point.x,ee=l.y1*$+D.point.y,te=l.x2*$+D.point.x,me=l.y2*$+D.point.y;return!this.isInsideGrid(Z,ee,te,me)||h!=="always"&&this.grid.hitTest(Z,ee,te,me,h,A)||D.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[Z,ee,te,me],offscreen:this.isOffscreen(Z,ee,te,me)}}placeCollisionCircles(l,h,y,v,A,P,D,$,Z,ee,te,me,Ae,xe){const Me=[],ve=new s.P(h.anchorX,h.anchorY),Be=sr(ve,P,xe),tt=Se(this.transform.cameraToCenterDistance,Be.signedDistanceFromCamera),Ie=(ee?A/tt:A*tt)/s.ao,He=sr(ve,D,xe).point,rt=ge(Ie,v,h.lineOffsetX*Ie,h.lineOffsetY*Ie,!1,He,ve,h,y,D,{projections:{},offsets:{}},!1,xe);let ot=!1,ut=!1,kt=!0;if(rt){const bt=.5*me*tt+Ae,Rt=new s.P(-100,-100),Ft=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Cn=new vt,$t=rt.first,_n=rt.last;let Tn=[];for(let In=$t.path.length-1;In>=1;In--)Tn.push($t.path[In]);for(let In=1;In<_n.path.length;In++)Tn.push(_n.path[In]);const Wn=2.5*bt;if($){const In=Tn.map(Rn=>sr(Rn,$,xe));Tn=In.some(Rn=>Rn.signedDistanceFromCamera<=0)?[]:In.map(Rn=>Rn.point)}let kn=[];if(Tn.length>0){const In=Tn[0].clone(),Rn=Tn[0].clone();for(let Or=1;Or<Tn.length;Or++)In.x=Math.min(In.x,Tn[Or].x),In.y=Math.min(In.y,Tn[Or].y),Rn.x=Math.max(Rn.x,Tn[Or].x),Rn.y=Math.max(Rn.y,Tn[Or].y);kn=In.x>=Rt.x&&Rn.x<=Ft.x&&In.y>=Rt.y&&Rn.y<=Ft.y?[Tn]:Rn.x<Rt.x||In.x>Ft.x||Rn.y<Rt.y||In.y>Ft.y?[]:s.al([Tn],Rt.x,Rt.y,Ft.x,Ft.y)}for(const In of kn){Cn.reset(In,.25*bt);let Rn=0;Rn=Cn.length<=.5*bt?1:Math.ceil(Cn.paddedLength/Wn)+1;for(let Or=0;Or<Rn;Or++){const ur=Or/Math.max(Rn-1,1),to=Cn.lerp(ur),ri=to.x+zt,Pr=to.y+zt;Me.push(ri,Pr,bt,0);const ii=ri-bt,no=Pr-bt,Go=ri+bt,Ms=Pr+bt;if(kt=kt&&this.isOffscreen(ii,no,Go,Ms),ut=ut||this.isInsideGrid(ii,no,Go,Ms),l!=="always"&&this.grid.hitTestCircle(ri,Pr,bt,l,te)&&(ot=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:ot}}}}return{circles:!Z&&ot||!ut||tt<this.perspectiveRatioCutoff?[]:Me,offscreen:kt,collisionDetected:ot}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let y=1/0,v=1/0,A=-1/0,P=-1/0;for(const ee of l){const te=new s.P(ee.x+zt,ee.y+zt);y=Math.min(y,te.x),v=Math.min(v,te.y),A=Math.max(A,te.x),P=Math.max(P,te.y),h.push(te)}const D=this.grid.query(y,v,A,P).concat(this.ignoredGrid.query(y,v,A,P)),$={},Z={};for(const ee of D){const te=ee.key;if($[te.bucketInstanceId]===void 0&&($[te.bucketInstanceId]={}),$[te.bucketInstanceId][te.featureIndex])continue;const me=[new s.P(ee.x1,ee.y1),new s.P(ee.x2,ee.y1),new s.P(ee.x2,ee.y2),new s.P(ee.x1,ee.y2)];s.am(h,me)&&($[te.bucketInstanceId][te.featureIndex]=!0,Z[te.bucketInstanceId]===void 0&&(Z[te.bucketInstanceId]=[]),Z[te.bucketInstanceId].push(te.featureIndex))}return Z}insertCollisionBox(l,h,y,v,A,P){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:A,collisionGroupID:P,overlapMode:h},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,h,y,v,A,P){const D=y?this.ignoredGrid:this.grid,$={bucketInstanceId:v,featureIndex:A,collisionGroupID:P,overlapMode:h};for(let Z=0;Z<l.length;Z+=4)D.insertCircle($,l[Z],l[Z+1],l[Z+2])}projectAndGetPerspectiveRatio(l,h,y,v){let A;return v?(A=[h,y,v(h,y),1],s.af(A,A,l)):(A=[h,y,0,1],ct(A,A,l)),{point:new s.P((A[0]/A[3]+1)/2*this.transform.width+zt,(-A[1]/A[3]+1)/2*this.transform.height+zt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/A[3]*.5}}isOffscreen(l,h,y,v){return y<zt||l>=this.screenRightBoundary||v<zt||h>this.screenBottomBoundary}isInsideGrid(l,h,y,v){return y>=0&&l<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const l=s.an([]);return s.H(l,l,[-100,-100,0]),l}}function gn(w,l,h){return l*(s.W/(w.tileSize*Math.pow(2,h-w.tileID.overscaledZ)))}class En{constructor(l,h,y,v){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):v&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Vn{constructor(l,h,y,v,A){this.text=new En(l?l.text:null,h,y,A),this.icon=new En(l?l.icon:null,h,v,A)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Cr{constructor(l,h,y){this.text=l,this.icon=h,this.skipFade=y}}class Gr{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class Ln{constructor(l,h,y,v,A){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=v,this.tileID=A}}class Rr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[l]}}function ni(w,l,h,y,v){const{horizontalAlign:A,verticalAlign:P}=s.at(w);return new s.P(-(A-.5)*l+y[0]*v,-(P-.5)*h+y[1]*v)}function Ci(w,l,h,y,v,A){const{x1:P,x2:D,y1:$,y2:Z,anchorPointX:ee,anchorPointY:te}=w,me=new s.P(l,h);return y&&me._rotate(v?A:-A),{x1:P+me.x,y1:$+me.y,x2:D+me.x,y2:Z+me.y,anchorPointX:ee,anchorPointY:te}}class Ri{constructor(l,h,y,v,A){this.transform=l.clone(),this.terrain=h,this.collisionIndex=new on(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new Rr(v),this.collisionCircleArrays={},this.prevPlacement=A,A&&(A.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,h,y,v){const A=y.getBucket(h),P=y.latestFeatureIndex;if(!A||!P||h.id!==A.layerIds[0])return;const D=y.collisionBoxArray,$=A.layers[0].layout,Z=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),ee=y.tileSize/s.W,te=this.transform.calculatePosMatrix(y.tileID.toUnwrapped()),me=$.get("text-pitch-alignment")==="map",Ae=$.get("text-rotation-alignment")==="map",xe=gn(y,1,this.transform.zoom),Me=tn(te,me,Ae,this.transform,xe);let ve=null;if(me){const tt=br(te,me,Ae,this.transform,xe);ve=s.K([],this.transform.labelPlaneMatrix,tt)}this.retainedQueryData[A.bucketInstanceId]=new Ln(A.bucketInstanceId,P,A.sourceLayerIndex,A.index,y.tileID);const Be={bucket:A,layout:$,posMatrix:te,textLabelPlaneMatrix:Me,labelToScreenMatrix:ve,scale:Z,textPixelRatio:ee,holdingForFade:y.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:s.ag(A.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(v)for(const tt of A.sortKeyRanges){const{sortKey:Ie,symbolInstanceStart:He,symbolInstanceEnd:rt}=tt;l.push({sortKey:Ie,symbolInstanceStart:He,symbolInstanceEnd:rt,parameters:Be})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:Be})}attemptAnchorPlacement(l,h,y,v,A,P,D,$,Z,ee,te,me,Ae,xe,Me,ve){const Be=s.ap[l.textAnchor],tt=[l.textOffset0,l.textOffset1],Ie=ni(Be,y,v,tt,A),He=this.collisionIndex.placeCollisionBox(Ci(h,Ie.x,Ie.y,P,D,this.transform.angle),te,$,Z,ee.predicate,ve);if((!Me||this.collisionIndex.placeCollisionBox(Ci(Me,Ie.x,Ie.y,P,D,this.transform.angle),te,$,Z,ee.predicate,ve).box.length!==0)&&He.box.length>0){let rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID].text&&(rt=this.prevPlacement.variableOffsets[me.crossTileID].anchor),me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[me.crossTileID]={textOffset:tt,width:y,height:v,anchor:Be,textBoxScale:A,prevAnchor:rt},this.markUsedJustification(Ae,Be,me,xe),Ae.allowVerticalPlacement&&(this.markUsedOrientation(Ae,xe,me),this.placedOrientations[me.crossTileID]=xe),{shift:Ie,placedGlyphBoxes:He}}}placeLayerBucketPart(l,h,y){const{bucket:v,layout:A,posMatrix:P,textLabelPlaneMatrix:D,labelToScreenMatrix:$,textPixelRatio:Z,holdingForFade:ee,collisionBoxArray:te,partiallyEvaluatedTextSize:me,collisionGroup:Ae}=l.parameters,xe=A.get("text-optional"),Me=A.get("icon-optional"),ve=s.aq(A,"text-overlap","text-allow-overlap"),Be=ve==="always",tt=s.aq(A,"icon-overlap","icon-allow-overlap"),Ie=tt==="always",He=A.get("text-rotation-alignment")==="map",rt=A.get("text-pitch-alignment")==="map",ot=A.get("icon-text-fit")!=="none",ut=A.get("symbol-z-order")==="viewport-y",kt=Be&&(Ie||!v.hasIconData()||Me),bt=Ie&&(Be||!v.hasTextData()||xe);!v.collisionArrays&&te&&v.deserializeCollisionBoxes(te);const Rt=this.retainedQueryData[v.bucketInstanceId].tileID,Ft=this.terrain?($t,_n)=>this.terrain.getElevation(Rt,$t,_n):null,Cn=($t,_n)=>{var Tn,Wn;if(h[$t.crossTileID])return;if(ee)return void(this.placements[$t.crossTileID]=new Cr(!1,!1,!1));let kn=!1,In=!1,Rn=!0,Or=null,ur={box:null,offscreen:null},to={box:null,offscreen:null},ri=null,Pr=null,ii=null,no=0,Go=0,Ms=0;_n.textFeatureIndex?no=_n.textFeatureIndex:$t.useRuntimeCollisionCircles&&(no=$t.featureIndex),_n.verticalTextFeatureIndex&&(Go=_n.verticalTextFeatureIndex);const wl=_n.textBox;if(wl){const Zr=Xr=>{let Dr=s.ah.horizontal;if(v.allowVerticalPlacement&&!Xr&&this.prevPlacement){const mo=this.prevPlacement.placedOrientations[$t.crossTileID];mo&&(this.placedOrientations[$t.crossTileID]=mo,Dr=mo,this.markUsedOrientation(v,Dr,$t))}return Dr},zr=(Xr,Dr)=>{if(v.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&_n.verticalTextBox){for(const mo of v.writingModes)if(mo===s.ah.vertical?(ur=Dr(),to=ur):ur=Xr(),ur&&ur.box&&ur.box.length)break}else ur=Xr()},Mr=$t.textAnchorOffsetStartIndex,po=$t.textAnchorOffsetEndIndex;if(po===Mr){const Xr=(Dr,mo)=>{const Kr=this.collisionIndex.placeCollisionBox(Dr,ve,Z,P,Ae.predicate,Ft);return Kr&&Kr.box&&Kr.box.length&&(this.markUsedOrientation(v,mo,$t),this.placedOrientations[$t.crossTileID]=mo),Kr};zr(()=>Xr(wl,s.ah.horizontal),()=>{const Dr=_n.verticalTextBox;return v.allowVerticalPlacement&&$t.numVerticalGlyphVertices>0&&Dr?Xr(Dr,s.ah.vertical):{box:null,offscreen:null}}),Zr(ur&&ur.box&&ur.box.length)}else{let Xr=s.ap[(Wn=(Tn=this.prevPlacement)===null||Tn===void 0?void 0:Tn.variableOffsets[$t.crossTileID])===null||Wn===void 0?void 0:Wn.anchor];const Dr=(Kr,jr,jc)=>{const Yh=Kr.x2-Kr.x1,Xs=Kr.y2-Kr.y1,Ks=$t.textBoxScale,xu=ot&&tt==="never"?jr:null;let Ls={box:[],offscreen:!1},Uc=ve==="never"?1:2,Qh="never";Xr&&Uc++;for(let Vc=0;Vc<Uc;Vc++){for(let qc=Mr;qc<po;qc++){const Au=v.textAnchorOffsets.get(qc);if(Xr&&Au.textAnchor!==Xr)continue;const Hc=this.attemptAnchorPlacement(Au,Kr,Yh,Xs,Ks,He,rt,Z,P,Ae,Qh,$t,v,jc,xu,Ft);if(Hc&&(Ls=Hc.placedGlyphBoxes,Ls&&Ls.box&&Ls.box.length))return kn=!0,Or=Hc.shift,Ls}Xr?Xr=null:Qh=ve}return Ls};zr(()=>Dr(wl,_n.iconBox,s.ah.horizontal),()=>{const Kr=_n.verticalTextBox;return v.allowVerticalPlacement&&!(ur&&ur.box&&ur.box.length)&&$t.numVerticalGlyphVertices>0&&Kr?Dr(Kr,_n.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),ur&&(kn=ur.box,Rn=ur.offscreen);const mo=Zr(ur&&ur.box);if(!kn&&this.prevPlacement){const Kr=this.prevPlacement.variableOffsets[$t.crossTileID];Kr&&(this.variableOffsets[$t.crossTileID]=Kr,this.markUsedJustification(v,Kr.anchor,$t,mo))}}}if(ri=ur,kn=ri&&ri.box&&ri.box.length>0,Rn=ri&&ri.offscreen,$t.useRuntimeCollisionCircles){const Zr=v.text.placedSymbolArray.get($t.centerJustifiedTextSymbolIndex),zr=s.ai(v.textSizeData,me,Zr),Mr=A.get("text-padding");Pr=this.collisionIndex.placeCollisionCircles(ve,Zr,v.lineVertexArray,v.glyphOffsetArray,zr,P,D,$,y,rt,Ae.predicate,$t.collisionCircleDiameter,Mr,Ft),Pr.circles.length&&Pr.collisionDetected&&!y&&s.w("Collisions detected, but collision boxes are not shown"),kn=Be||Pr.circles.length>0&&!Pr.collisionDetected,Rn=Rn&&Pr.offscreen}if(_n.iconFeatureIndex&&(Ms=_n.iconFeatureIndex),_n.iconBox){const Zr=zr=>{const Mr=ot&&Or?Ci(zr,Or.x,Or.y,He,rt,this.transform.angle):zr;return this.collisionIndex.placeCollisionBox(Mr,tt,Z,P,Ae.predicate,Ft)};to&&to.box&&to.box.length&&_n.verticalIconBox?(ii=Zr(_n.verticalIconBox),In=ii.box.length>0):(ii=Zr(_n.iconBox),In=ii.box.length>0),Rn=Rn&&ii.offscreen}const Es=xe||$t.numHorizontalGlyphVertices===0&&$t.numVerticalGlyphVertices===0,Wo=Me||$t.numIconVertices===0;if(Es||Wo?Wo?Es||(In=In&&kn):kn=In&&kn:In=kn=In&&kn,kn&&ri&&ri.box&&this.collisionIndex.insertCollisionBox(ri.box,ve,A.get("text-ignore-placement"),v.bucketInstanceId,to&&to.box&&Go?Go:no,Ae.ID),In&&ii&&this.collisionIndex.insertCollisionBox(ii.box,tt,A.get("icon-ignore-placement"),v.bucketInstanceId,Ms,Ae.ID),Pr&&(kn&&this.collisionIndex.insertCollisionCircles(Pr.circles,ve,A.get("text-ignore-placement"),v.bucketInstanceId,no,Ae.ID),y)){const Zr=v.bucketInstanceId;let zr=this.collisionCircleArrays[Zr];zr===void 0&&(zr=this.collisionCircleArrays[Zr]=new Gr);for(let Mr=0;Mr<Pr.circles.length;Mr+=4)zr.circles.push(Pr.circles[Mr+0]),zr.circles.push(Pr.circles[Mr+1]),zr.circles.push(Pr.circles[Mr+2]),zr.circles.push(Pr.collisionDetected?1:0)}if($t.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[$t.crossTileID]=new Cr(kn||kt,In||bt,Rn||v.justReloaded),h[$t.crossTileID]=!0};if(ut){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const $t=v.getSortedSymbolIndexes(this.transform.angle);for(let _n=$t.length-1;_n>=0;--_n){const Tn=$t[_n];Cn(v.symbolInstances.get(Tn),v.collisionArrays[Tn])}}else for(let $t=l.symbolInstanceStart;$t<l.symbolInstanceEnd;$t++)Cn(v.symbolInstances.get($t),v.collisionArrays[$t]);if(y&&v.bucketInstanceId in this.collisionCircleArrays){const $t=this.collisionCircleArrays[v.bucketInstanceId];s.ar($t.invProjMatrix,P),$t.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(l,h,y,v){let A;A=v===s.ah.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[s.as(h)];const P=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const D of P)D>=0&&(l.text.placedSymbolArray.get(D).crossTileID=A>=0&&D!==A?0:y.crossTileID)}markUsedOrientation(l,h,y){const v=h===s.ah.horizontal||h===s.ah.horizontalOnly?h:0,A=h===s.ah.vertical?h:0,P=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const D of P)l.text.placedSymbolArray.get(D).placedOrientation=v;y.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(l):1,A=h?h.opacities:{},P=h?h.variableOffsets:{},D=h?h.placedOrientations:{};for(const $ in this.placements){const Z=this.placements[$],ee=A[$];ee?(this.opacities[$]=new Vn(ee,v,Z.text,Z.icon),y=y||Z.text!==ee.text.placed||Z.icon!==ee.icon.placed):(this.opacities[$]=new Vn(null,v,Z.text,Z.icon,Z.skipFade),y=y||Z.text||Z.icon)}for(const $ in A){const Z=A[$];if(!this.opacities[$]){const ee=new Vn(Z,v,!1,!1);ee.isHidden()||(this.opacities[$]=ee,y=y||Z.text.placed||Z.icon.placed)}}for(const $ in P)this.variableOffsets[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.variableOffsets[$]=P[$]);for(const $ in D)this.placedOrientations[$]||!this.opacities[$]||this.opacities[$].isHidden()||(this.placedOrientations[$]=D[$]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)}updateLayerOpacities(l,h){const y={};for(const v of h){const A=v.getBucket(l);A&&v.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,y,v.collisionBoxArray)}}updateBucketOpacities(l,h,y){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const v=l.layers[0],A=v.layout,P=new Vn(null,0,!1,!1,!0),D=A.get("text-allow-overlap"),$=A.get("icon-allow-overlap"),Z=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ee=A.get("text-rotation-alignment")==="map",te=A.get("text-pitch-alignment")==="map",me=A.get("icon-text-fit")!=="none",Ae=new Vn(null,0,D&&($||!l.hasIconData()||A.get("icon-optional")),$&&(D||!l.hasTextData()||A.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const xe=(Me,ve,Be)=>{for(let tt=0;tt<ve/4;tt++)Me.opacityVertexArray.emplaceBack(Be);Me.hasVisibleVertices=Me.hasVisibleVertices||Be!==Qa};for(let Me=0;Me<l.symbolInstances.length;Me++){const ve=l.symbolInstances.get(Me),{numHorizontalGlyphVertices:Be,numVerticalGlyphVertices:tt,crossTileID:Ie}=ve;let He=this.opacities[Ie];h[Ie]?He=P:He||(He=Ae,this.opacities[Ie]=He),h[Ie]=!0;const rt=ve.numIconVertices>0,ot=this.placedOrientations[ve.crossTileID],ut=ot===s.ah.vertical,kt=ot===s.ah.horizontal||ot===s.ah.horizontalOnly;if(Be>0||tt>0){const bt=Bi(He.text);xe(l.text,Be,ut?Qa:bt),xe(l.text,tt,kt?Qa:bt);const Rt=He.text.isHidden();[ve.rightJustifiedTextSymbolIndex,ve.centerJustifiedTextSymbolIndex,ve.leftJustifiedTextSymbolIndex].forEach($t=>{$t>=0&&(l.text.placedSymbolArray.get($t).hidden=Rt||ut?1:0)}),ve.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(ve.verticalPlacedTextSymbolIndex).hidden=Rt||kt?1:0);const Ft=this.variableOffsets[ve.crossTileID];Ft&&this.markUsedJustification(l,Ft.anchor,ve,ot);const Cn=this.placedOrientations[ve.crossTileID];Cn&&(this.markUsedJustification(l,"left",ve,Cn),this.markUsedOrientation(l,Cn,ve))}if(rt){const bt=Bi(He.icon),Rt=!(me&&ve.verticalPlacedIconSymbolIndex&&ut);ve.placedIconSymbolIndex>=0&&(xe(l.icon,ve.numIconVertices,Rt?bt:Qa),l.icon.placedSymbolArray.get(ve.placedIconSymbolIndex).hidden=He.icon.isHidden()),ve.verticalPlacedIconSymbolIndex>=0&&(xe(l.icon,ve.numVerticalIconVertices,Rt?Qa:bt),l.icon.placedSymbolArray.get(ve.verticalPlacedIconSymbolIndex).hidden=He.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const bt=l.collisionArrays[Me];if(bt){let Rt=new s.P(0,0);if(bt.textBox||bt.verticalTextBox){let Cn=!0;if(Z){const $t=this.variableOffsets[Ie];$t?(Rt=ni($t.anchor,$t.width,$t.height,$t.textOffset,$t.textBoxScale),ee&&Rt._rotate(te?this.transform.angle:-this.transform.angle)):Cn=!1}bt.textBox&&mi(l.textCollisionBox.collisionVertexArray,He.text.placed,!Cn||ut,Rt.x,Rt.y),bt.verticalTextBox&&mi(l.textCollisionBox.collisionVertexArray,He.text.placed,!Cn||kt,Rt.x,Rt.y)}const Ft=!!(!kt&&bt.verticalIconBox);bt.iconBox&&mi(l.iconCollisionBox.collisionVertexArray,He.icon.placed,Ft,me?Rt.x:0,me?Rt.y:0),bt.verticalIconBox&&mi(l.iconCollisionBox.collisionVertexArray,He.icon.placed,!Ft,me?Rt.x:0,me?Rt.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Me.invProjMatrix,l.placementViewportMatrix=Me.viewportMatrix,l.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function mi(w,l,h,y,v){w.emplaceBack(l?1:0,h?1:0,y||0,v||0),w.emplaceBack(l?1:0,h?1:0,y||0,v||0),w.emplaceBack(l?1:0,h?1:0,y||0,v||0),w.emplaceBack(l?1:0,h?1:0,y||0,v||0)}const jo=Math.pow(2,25),mh=Math.pow(2,24),gp=Math.pow(2,17),ar=Math.pow(2,16),uc=Math.pow(2,9),cc=Math.pow(2,8),Yi=Math.pow(2,1);function Bi(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const l=w.placed?1:0,h=Math.floor(127*w.opacity);return h*jo+l*mh+h*gp+l*ar+h*uc+l*cc+h*Yi+l}const Qa=0;class fo{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,h,y,v,A){const P=this._bucketParts;for(;this._currentTileIndex<l.length;)if(h.getBucketParts(P,v,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((D,$)=>D.sortKey-$.sortKey));this._currentPartIndex<P.length;)if(h.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,A())return!0;return!1}}class ho{constructor(l,h,y,v,A,P,D,$){this.placement=new Ri(l,h,P,D,$),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=A,this._done=!1}isDone(){return this._done}continuePlacement(l,h,y){const v=_.now(),A=()=>!this._forceFullPlacement&&_.now()-v>2;for(;this._currentPlacementIndex>=0;){const P=h[l[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=D)&&(!P.maxzoom||P.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new fo(P)),this._inProgressLayer.continuePlacement(y[P.source],this.placement,this._showCollisionBoxes,P,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const fa=512/s.W/2;class Fl{constructor(l,h,y){this.tileID=l,this.bucketInstanceId=y,this._symbolsByKey={};const v=new Map;for(let A=0;A<h.length;A++){const P=h.get(A),D=P.key,$=v.get(D);$?$.push(P):v.set(D,[P])}for(const[A,P]of v){const D={positions:P.map($=>({x:Math.floor($.anchorX*fa),y:Math.floor($.anchorY*fa)})),crossTileIDs:P.map($=>$.crossTileID)};if(D.positions.length>128){const $=new s.au(D.positions.length,16,Uint16Array);for(const{x:Z,y:ee}of D.positions)$.add(Z,ee);$.finish(),delete D.positions,D.index=$}this._symbolsByKey[A]=D}}getScaledCoordinates(l,h){const{x:y,y:v,z:A}=this.tileID.canonical,{x:P,y:D,z:$}=h.canonical,Z=fa/Math.pow(2,$-A),ee=(D*s.W+l.anchorY)*Z,te=v*s.W*fa;return{x:Math.floor((P*s.W+l.anchorX)*Z-y*s.W*fa),y:Math.floor(ee-te)}}findMatches(l,h,y){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let A=0;A<l.length;A++){const P=l.get(A);if(P.crossTileID)continue;const D=this._symbolsByKey[P.key];if(!D)continue;const $=this.getScaledCoordinates(P,h);if(D.index){const Z=D.index.range($.x-v,$.y-v,$.x+v,$.y+v).sort();for(const ee of Z){const te=D.crossTileIDs[ee];if(!y[te]){y[te]=!0,P.crossTileID=te;break}}}else if(D.positions)for(let Z=0;Z<D.positions.length;Z++){const ee=D.positions[Z],te=D.crossTileIDs[Z];if(Math.abs(ee.x-$.x)<=v&&Math.abs(ee.y-$.y)<=v&&!y[te]){y[te]=!0,P.crossTileID=te;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class Wr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class el{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const h=Math.round((l-this.lng)/360);if(h!==0)for(const y in this.indexes){const v=this.indexes[y],A={};for(const P in v){const D=v[P];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+h),A[D.tileID.key]=D}this.indexes[y]=A}this.lng=l}addBucket(l,h,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let A=0;A<h.symbolInstances.length;A++)h.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const v=this.usedCrossTileIDs[l.overscaledZ];for(const A in this.indexes){const P=this.indexes[A];if(Number(A)>l.overscaledZ)for(const D in P){const $=P[D];$.tileID.isChildOf(l)&&$.findMatches(h.symbolInstances,l,v)}else{const D=P[l.scaledTo(Number(A)).key];D&&D.findMatches(h.symbolInstances,l,v)}}for(let A=0;A<h.symbolInstances.length;A++){const P=h.symbolInstances.get(A);P.crossTileID||(P.crossTileID=y.generate(),v[P.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Fl(l,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(l,h){for(const y of h.getCrossTileIDsLists())for(const v of y)delete this.usedCrossTileIDs[l][v]}removeStaleBuckets(l){let h=!1;for(const y in this.indexes){const v=this.indexes[y];for(const A in v)l[v[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,v[A]),delete v[A],h=!0)}return h}}class xs{constructor(){this.layerIndexes={},this.crossTileIDs=new Wr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,h,y){let v=this.layerIndexes[l.id];v===void 0&&(v=this.layerIndexes[l.id]=new el);let A=!1;const P={};v.handleWrapJump(y);for(const D of h){const $=D.getBucket(l);$&&l.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,$,this.crossTileIDs)&&(A=!0),P[$.bucketInstanceId]=!0)}return v.removeStaleBuckets(P)&&(A=!0),A}pruneUnusedLayers(l){const h={};l.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const Ir=(w,l)=>s.t(w,l&&l.filter(h=>h.identifier!=="source.canvas")),Ol=s.av();class Qi extends s.E{constructor(l,h={}){super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const v=this.sourceCaches[y].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[y].reload()}},this.map=l,this.dispatcher=new Yt(Ot(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,v)=>this.getGlyphs(y,v)),this.dispatcher.registerMessageHandler("GI",(y,v)=>this.getImages(y,v)),this.imageManager=new ke,this.imageManager.setEventedParent(this),this.glyphManager=new De(l._requestManager,h.localIdeographFontFamily),this.lineAtlas=new at(256,512),this.crossTileSymbolIndex=new xs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.ax()),yt().on(An,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.sourceCaches[y.sourceId];if(!v)return;const A=v.getSource();if(A&&A.vectorLayerIds)for(const P in this._layers){const D=this._layers[P];D.source===A.id&&this._validateLayer(D)}})}loadURL(l,h={},y){this.fire(new s.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const v=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,s.h(v,this._loadStyleRequest).then(A=>{this._loadStyleRequest=null,this._load(A.data,h,y)}).catch(A=>{this._loadStyleRequest=null,A&&this.fire(new s.j(A))})}loadJSON(l,h={},y){this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(l,h,y)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(Ol,{validate:!1})}_load(l,h,y){var v;const A=h.transformStyle?h.transformStyle(y,l):l;if(!h.validate||!Ir(this,s.x(A))){this._loaded=!0,this.stylesheet=A;for(const P in A.sources)this.addSource(P,A.sources[P],{validate:!1});A.sprite?this._loadSprite(A.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(A.glyphs),this._createLayers(),this.light=new Ze(this.stylesheet.light),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const l=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of l){const y=s.az(h);y.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=y}}_loadSprite(l,h=!1,y=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(A,P,D,$){return s._(this,void 0,void 0,function*(){const Z=Ee(A),ee=D>1?"@2x":"",te={},me={};for(const{id:Ae,url:xe}of Z){const Me=P.transformRequest(P.normalizeSpriteURL(xe,ee,".json"),"SpriteJSON");te[Ae]=s.h(Me,$);const ve=P.transformRequest(P.normalizeSpriteURL(xe,ee,".png"),"SpriteImage");me[Ae]=O.getImage(ve,$)}return yield Promise.all([...Object.values(te),...Object.values(me)]),function(Ae,xe){return s._(this,void 0,void 0,function*(){const Me={};for(const ve in Ae){Me[ve]={};const Be=_.getImageCanvasContext((yield xe[ve]).data),tt=(yield Ae[ve]).data;for(const Ie in tt){const{width:He,height:rt,x:ot,y:ut,sdf:kt,pixelRatio:bt,stretchX:Rt,stretchY:Ft,content:Cn}=tt[Ie];Me[ve][Ie]={data:null,pixelRatio:bt,sdf:kt,stretchX:Rt,stretchY:Ft,content:Cn,spriteData:{width:He,height:rt,x:ot,y:ut,context:Be}}}}return Me})}(te,me)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(A=>{if(this._spriteRequest=null,A)for(const P in A){this._spritesImagesIds[P]=[];const D=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter($=>!($ in A)):[];for(const $ of D)this.imageManager.removeImage($),this._changedImages[$]=!0;for(const $ in A[P]){const Z=P==="default"?$:`${P}:${$}`;this._spritesImagesIds[P].push(Z),Z in this.imageManager.images?this.imageManager.updateImage(Z,A[P][$],!1):this.imageManager.addImage(Z,A[P][$]),h&&(this._changedImages[Z]=!0)}}}).catch(A=>{this._spriteRequest=null,v=A,this.fire(new s.j(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),y&&y(v)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(l){const h=this.sourceCaches[l.source];if(!h)return;const y=l.sourceLayer;if(!y)return;const v=h.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(y)===-1)&&this.fire(new s.j(new Error(`Source layer "${y}" does not exist on source "${v.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const h=this._serializedAllLayers();if(!l||l.length===0)return Object.values(h);const y=[];for(const v of l)h[v]&&y.push(h[v]);return y}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const h=Object.keys(this._layers);for(const y of h){const v=this._layers[y];v.type!=="custom"&&(l[y]=v.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const h=this._changed;if(h){const v=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(v.length||A.length)&&this._updateWorkerLayers(v,A);for(const P in this._updatedSources){const D=this._updatedSources[P];if(D==="reload")this._reloadSource(P);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const y={};for(const v in this.sourceCaches){const A=this.sourceCaches[v];y[v]=A.used,A.used=!1}for(const v of this._order){const A=this._layers[v];A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)&&A.source&&(this.sourceCaches[A.source].used=!0)}for(const v in y){const A=this.sourceCaches[v];!!y[v]!=!!A.used&&A.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(l),this.z=l.zoom,h&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,h={}){var y;this._checkLoaded();const v=this.serialize();if(l=h.transformStyle?h.transformStyle(v,l):l,((y=h.validate)===null||y===void 0||y)&&Ir(this,s.x(l)))return!1;(l=s.aA(l)).layers=s.ay(l.layers);const A=s.aB(v,l),P=this._getOperationsToPerform(A);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const D of P.operations)D();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const h=[],y=[];for(const v of l)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":h.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":h.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setTransition":h.push(()=>{});break;default:y.push(v.command)}return{operations:h,unimplemented:y}}addImage(l,h){if(this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,h),this._afterImageUpdated(l)}updateImage(l,h){this.imageManager.updateImage(l,h)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,h,y={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(s.x.source,`sources.${l}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=this.sourceCaches[l]=new Un(l,h,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:l})),v.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===l)return this.fire(new s.j(new Error(`Source "${l}" cannot be removed while layer "${y}" is using it.`)));const h=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],h.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,h){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const y=this.sourceCaches[l].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(h),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,h,y={}){this._checkLoaded();const v=l.id;if(this.getLayer(v))return void this.fire(new s.j(new Error(`Layer "${v}" already exists on this map.`)));let A;if(l.type==="custom"){if(Ir(this,s.aC(l)))return;A=s.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(v,l.source),l=s.aA(l),l=s.e(l,{source:v})),this._validate(s.x.layer,`layers.${v}`,l,{arrayIndex:-1},y))return;A=s.az(l),this._validateLayer(A),A.setEventedParent(this,{layer:{id:v}})}const P=h?this._order.indexOf(h):this._order.length;if(h&&P===-1)this.fire(new s.j(new Error(`Cannot add layer "${v}" before non-existing layer "${h}".`)));else{if(this._order.splice(P,0,v),this._layerOrderChanged=!0,this._layers[v]=A,this._removedLayers[v]&&A.source&&A.type!=="custom"){const D=this._removedLayers[v];delete this._removedLayers[v],D.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}moveLayer(l,h){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===h)return;const y=this._order.indexOf(l);this._order.splice(y,1);const v=h?this._order.indexOf(h):this._order.length;h&&v===-1?this.fire(new s.j(new Error(`Cannot move layer "${l}" before non-existing layer "${h}".`))):(this._order.splice(v,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const h=this._layers[l];if(!h)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${l}".`)));h.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=h,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],h.onRemove&&h.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,h,y){this._checkLoaded();const v=this.getLayer(l);v?v.minzoom===h&&v.maxzoom===y||(h!=null&&(v.minzoom=h),y!=null&&(v.maxzoom=y),this._updateLayer(v)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,h,y={}){this._checkLoaded();const v=this.getLayer(l);if(v){if(!s.aD(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(s.x.filter,`layers.${v.id}.filter`,h,null,y)||(v.filter=s.aA(h),this._updateLayer(v)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return s.aA(this.getLayer(l).filter)}setLayoutProperty(l,h,y,v={}){this._checkLoaded();const A=this.getLayer(l);A?s.aD(A.getLayoutProperty(h),y)||(A.setLayoutProperty(h,y,v),this._updateLayer(A)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,h){const y=this.getLayer(l);if(y)return y.getLayoutProperty(h);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,h,y,v={}){this._checkLoaded();const A=this.getLayer(l);A?s.aD(A.getPaintProperty(h),y)||(A.setPaintProperty(h,y,v)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,h){return this.getLayer(l).getPaintProperty(h)}setFeatureState(l,h){this._checkLoaded();const y=l.source,v=l.sourceLayer,A=this.sourceCaches[y];if(A===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const P=A.getSource().type;P==="geojson"&&v?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||v?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),A.setFeatureState(v,l.id,h)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,h){this._checkLoaded();const y=l.source,v=this.sourceCaches[y];if(v===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const A=v.getSource().type,P=A==="vector"?l.sourceLayer:void 0;A!=="vector"||P?h&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(P,l.id,h):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const h=l.source,y=l.sourceLayer,v=this.sourceCaches[h];if(v!==void 0)return v.getSource().type!=="vector"||y?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),v.getFeatureState(y,l.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=s.aE(this.sourceCaches,A=>A.serialize()),h=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,v=this.stylesheet;return s.aF({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:l,layers:h,terrain:y},A=>A!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const h=P=>this._layers[P].type==="fill-extrusion",y={},v=[];for(let P=this._order.length-1;P>=0;P--){const D=this._order[P];if(h(D)){y[D]=P;for(const $ of l){const Z=$[D];if(Z)for(const ee of Z)v.push(ee)}}}v.sort((P,D)=>D.intersectionZ-P.intersectionZ);const A=[];for(let P=this._order.length-1;P>=0;P--){const D=this._order[P];if(h(D))for(let $=v.length-1;$>=0;$--){const Z=v[$].feature;if(y[Z.layer.id]<P)break;A.push(Z),v.pop()}else for(const $ of l){const Z=$[D];if(Z)for(const ee of Z)A.push(ee.feature)}}return A}queryRenderedFeatures(l,h,y){h&&h.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const D of h.layers){const $=this._layers[D];if(!$)return this.fire(new s.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];v[$.source]=!0}}const A=[];h.availableImages=this._availableImages;const P=this._serializedAllLayers();for(const D in this.sourceCaches)h.layers&&!v[D]||A.push(fn(this.sourceCaches[D],this._layers,P,l,h,y));return this.placement&&A.push(function(D,$,Z,ee,te,me,Ae){const xe={},Me=me.queryRenderedSymbols(ee),ve=[];for(const Be of Object.keys(Me).map(Number))ve.push(Ae[Be]);ve.sort(mn);for(const Be of ve){const tt=Be.featureIndex.lookupSymbolFeatures(Me[Be.bucketInstanceId],$,Be.bucketIndex,Be.sourceLayerIndex,te.filter,te.layers,te.availableImages,D);for(const Ie in tt){const He=xe[Ie]=xe[Ie]||[],rt=tt[Ie];rt.sort((ot,ut)=>{const kt=Be.featureSortOrder;if(kt){const bt=kt.indexOf(ot.featureIndex);return kt.indexOf(ut.featureIndex)-bt}return ut.featureIndex-ot.featureIndex});for(const ot of rt)He.push(ot)}}for(const Be in xe)xe[Be].forEach(tt=>{const Ie=tt.feature,He=Z[D[Be].source].getFeatureState(Ie.layer["source-layer"],Ie.id);Ie.source=Ie.layer.source,Ie.layer["source-layer"]&&(Ie.sourceLayer=Ie.layer["source-layer"]),Ie.state=He});return xe}(this._layers,P,this.sourceCaches,l,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(l,h){h&&h.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",h.filter,null,h);const y=this.sourceCaches[l];return y?function(v,A){const P=v.getRenderableIds().map(Z=>v.getTileByID(Z)),D=[],$={};for(let Z=0;Z<P.length;Z++){const ee=P[Z],te=ee.tileID.canonical.key;$[te]||($[te]=!0,ee.querySourceFeatures(D,A))}return D}(y,h):[]}getLight(){return this.light.getLight()}setLight(l,h={}){this._checkLoaded();const y=this.light.getLight();let v=!1;for(const P in l)if(!s.aD(l[P],y[P])){v=!0;break}if(!v)return;const A={now:_.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,h),this.light.updateTransitions(A)}_validate(l,h,y,v,A={}){return(!A||A.validate!==!1)&&Ir(this,l.call(s.x,s.e({key:h,style:this.serialize(),value:y,styleSpec:s.v},v)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),yt().off(An,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const y=this.sourceCaches[h];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const h in this.sourceCaches)this.sourceCaches[h].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,h,y,v,A=!1){let P=!1,D=!1;const $={};for(const Z of this._order){const ee=this._layers[Z];if(ee.type!=="symbol")continue;if(!$[ee.source]){const me=this.sourceCaches[ee.source];$[ee.source]=me.getRenderableIds(!0).map(Ae=>me.getTileByID(Ae)).sort((Ae,xe)=>xe.tileID.overscaledZ-Ae.tileID.overscaledZ||(Ae.tileID.isLessThan(xe.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(ee,$[ee.source],l.center.lng);P=P||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.now(),l.zoom))&&(this.pauseablePlacement=new ho(l,this.map.terrain,this._order,A,h,y,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,$),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.now()),D=!0),P&&this.pauseablePlacement.placement.setStale()),D||P)for(const Z of this._order){const ee=this._layers[Z];ee.type==="symbol"&&this.placement.updateLayerOpacities(ee,$[ee.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,h){return s._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const v=this.sourceCaches[h.source];return v&&v.setDependencies(h.tileID.key,h.type,h.icons),y})}getGlyphs(l,h){return s._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(h.stacks),v=this.sourceCaches[h.source];return v&&v.setDependencies(h.tileID.key,h.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,h={}){this._checkLoaded(),l&&this._validate(s.x.glyphs,"glyphs",l,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,h,y={},v){this._checkLoaded();const A=[{id:l,url:h}],P=[...Ee(this.stylesheet.sprite),...A];this._validate(s.x.sprite,"sprite",P,null,y)||(this.stylesheet.sprite=P,this._loadSprite(A,!0,v))}removeSprite(l){this._checkLoaded();const h=Ee(this.stylesheet.sprite);if(h.find(y=>y.id===l)){if(this._spritesImagesIds[l])for(const y of this._spritesImagesIds[l])this.imageManager.removeImage(y),this._changedImages[y]=!0;h.splice(h.findIndex(y=>y.id===l),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Ee(this.stylesheet.sprite)}setSprite(l,h={},y){this._checkLoaded(),l&&this._validate(s.x.sprite,"sprite",l,null,h)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,y):(this._unloadSprite(),y&&y(null)))}}var $l=s.X([{name:"a_pos",type:"Int16",components:2}]),Uo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const tl={prelude:lr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:lr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:lr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:lr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:lr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:lr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:lr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:lr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:lr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:lr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:lr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:lr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:lr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:lr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:lr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:lr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:lr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:lr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:lr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:lr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:lr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:lr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:lr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:lr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:lr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Uo),terrainDepth:lr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Uo),terrainCoords:lr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Uo)};function lr(w,l){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=l.match(/attribute ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=A?A.concat(v):v,D={};return{fragmentSource:w=w.replace(h,($,Z,ee,te,me)=>(D[me]=!0,Z==="define"?`
#ifndef HAS_UNIFORM_u_${me}
varying ${ee} ${te} ${me};
#else
uniform ${ee} ${te} u_${me};
#endif
`:`
#ifdef HAS_UNIFORM_u_${me}
    ${ee} ${te} ${me} = u_${me};
#endif
`)),vertexSource:l=l.replace(h,($,Z,ee,te,me)=>{const Ae=te==="float"?"vec2":"vec4",xe=me.match(/color/)?"color":Ae;return D[me]?Z==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
attribute ${ee} ${Ae} a_${me};
varying ${ee} ${te} ${me};
#else
uniform ${ee} ${te} u_${me};
#endif
`:xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = a_${me};
#else
    ${ee} ${te} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = unpack_mix_${xe}(a_${me}, u_${me}_t);
#else
    ${ee} ${te} ${me} = u_${me};
#endif
`:Z==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
attribute ${ee} ${Ae} a_${me};
#else
uniform ${ee} ${te} u_${me};
#endif
`:xe==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${ee} ${te} ${me} = a_${me};
#else
    ${ee} ${te} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${ee} ${te} ${me} = unpack_mix_${xe}(a_${me}, u_${me}_t);
#else
    ${ee} ${te} ${me} = u_${me};
#endif
`}),staticAttributes:y,staticUniforms:P}}class Nl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,h,y,v,A,P,D,$,Z){this.context=l;let ee=this.boundPaintVertexBuffers.length!==v.length;for(let te=0;!ee&&te<v.length;te++)this.boundPaintVertexBuffers[te]!==v[te]&&(ee=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||ee||this.boundIndexBuffer!==A||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==$||this.boundDynamicVertexBuffer3!==Z?this.freshBind(h,y,v,A,P,D,$,Z):(l.bindVertexArray.set(this.vao),D&&D.bind(),A&&A.dynamicDraw&&A.bind(),$&&$.bind(),Z&&Z.bind())}freshBind(l,h,y,v,A,P,D,$){const Z=l.numAttributes,ee=this.context,te=ee.gl;this.vao&&this.destroy(),this.vao=ee.createVertexArray(),ee.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=v,this.boundVertexOffset=A,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=$,h.enableAttributes(te,l);for(const me of y)me.enableAttributes(te,l);P&&P.enableAttributes(te,l),D&&D.enableAttributes(te,l),$&&$.enableAttributes(te,l),h.bind(),h.setVertexAttribPointers(te,l,A);for(const me of y)me.bind(),me.setVertexAttribPointers(te,l,A);P&&(P.bind(),P.setVertexAttribPointers(te,l,A)),v&&v.bind(),D&&(D.bind(),D.setVertexAttribPointers(te,l,A)),$&&($.bind(),$.setVertexAttribPointers(te,l,A)),ee.currentNumAttributes=Z}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ha(w){const l=[];for(let h=0;h<w.length;h++){if(w[h]===null)continue;const y=w[h].split(" ");l.push(y.pop())}return l}class As{constructor(l,h,y,v,A,P){const D=l.gl;this.program=D.createProgram();const $=ha(h.staticAttributes),Z=y?y.getBinderAttributes():[],ee=$.concat(Z),te=tl.prelude.staticUniforms?ha(tl.prelude.staticUniforms):[],me=h.staticUniforms?ha(h.staticUniforms):[],Ae=y?y.getBinderUniforms():[],xe=te.concat(me).concat(Ae),Me=[];for(const ot of xe)Me.indexOf(ot)<0&&Me.push(ot);const ve=y?y.defines():[];A&&ve.push("#define OVERDRAW_INSPECTOR;"),P&&ve.push("#define TERRAIN3D;");const Be=ve.concat(tl.prelude.fragmentSource,h.fragmentSource).join(`
`),tt=ve.concat(tl.prelude.vertexSource,h.vertexSource).join(`
`),Ie=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ie,Be),D.compileShader(Ie),!D.getShaderParameter(Ie,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Ie)}`);D.attachShader(this.program,Ie);const He=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(He,tt),D.compileShader(He),!D.getShaderParameter(He,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(He)}`);D.attachShader(this.program,He),this.attributes={};const rt={};this.numAttributes=ee.length;for(let ot=0;ot<this.numAttributes;ot++)ee[ot]&&(D.bindAttribLocation(this.program,ot,ee[ot]),this.attributes[ee[ot]]=ot);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(He),D.deleteShader(Ie);for(let ot=0;ot<Me.length;ot++){const ut=Me[ot];if(ut&&!rt[ut]){const kt=D.getUniformLocation(this.program,ut);kt&&(rt[ut]=kt)}}this.fixedUniforms=v(l,rt),this.terrainUniforms=((ot,ut)=>({u_depth:new s.aG(ot,ut.u_depth),u_terrain:new s.aG(ot,ut.u_terrain),u_terrain_dim:new s.aH(ot,ut.u_terrain_dim),u_terrain_matrix:new s.aI(ot,ut.u_terrain_matrix),u_terrain_unpack:new s.aJ(ot,ut.u_terrain_unpack),u_terrain_exaggeration:new s.aH(ot,ut.u_terrain_exaggeration)}))(l,rt),this.binderUniforms=y?y.getUniforms(l,rt):[]}draw(l,h,y,v,A,P,D,$,Z,ee,te,me,Ae,xe,Me,ve,Be,tt){const Ie=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(y),l.setStencilMode(v),l.setColorMode(A),l.setCullFace(P),$){l.activeTexture.set(Ie.TEXTURE2),Ie.bindTexture(Ie.TEXTURE_2D,$.depthTexture),l.activeTexture.set(Ie.TEXTURE3),Ie.bindTexture(Ie.TEXTURE_2D,$.texture);for(const rt in this.terrainUniforms)this.terrainUniforms[rt].set($[rt])}for(const rt in this.fixedUniforms)this.fixedUniforms[rt].set(D[rt]);Me&&Me.setUniforms(l,this.binderUniforms,Ae,{zoom:xe});let He=0;switch(h){case Ie.LINES:He=2;break;case Ie.TRIANGLES:He=3;break;case Ie.LINE_STRIP:He=1}for(const rt of me.get()){const ot=rt.vaos||(rt.vaos={});(ot[Z]||(ot[Z]=new Nl)).bind(l,this,ee,Me?Me.getPaintVertexBuffers():[],te,rt.vertexOffset,ve,Be,tt),Ie.drawElements(h,rt.primitiveLength*He,Ie.UNSIGNED_SHORT,rt.primitiveOffset*He*2)}}}function jl(w,l,h){const y=1/gn(h,1,l.transform.tileZoom),v=Math.pow(2,h.tileID.overscaledZ),A=h.tileSize*Math.pow(2,l.transform.tileZoom)/v,P=A*(h.tileID.canonical.x+h.tileID.wrap*v),D=A*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[y,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[P>>16,D>>16],u_pixel_coord_lower:[65535&P,65535&D]}}const nl=(w,l,h,y)=>{const v=l.style.light,A=v.properties.get("position"),P=[A.x,A.y,A.z],D=function(){var Z=new s.A(9);return s.A!=Float32Array&&(Z[1]=0,Z[2]=0,Z[3]=0,Z[5]=0,Z[6]=0,Z[7]=0),Z[0]=1,Z[4]=1,Z[8]=1,Z}();v.properties.get("anchor")==="viewport"&&function(Z,ee){var te=Math.sin(ee),me=Math.cos(ee);Z[0]=me,Z[1]=te,Z[2]=0,Z[3]=-te,Z[4]=me,Z[5]=0,Z[6]=0,Z[7]=0,Z[8]=1}(D,-l.transform.angle),function(Z,ee,te){var me=ee[0],Ae=ee[1],xe=ee[2];Z[0]=me*te[0]+Ae*te[3]+xe*te[6],Z[1]=me*te[1]+Ae*te[4]+xe*te[7],Z[2]=me*te[2]+Ae*te[5]+xe*te[8]}(P,P,D);const $=v.properties.get("color");return{u_matrix:w,u_lightpos:P,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[$.r,$.g,$.b],u_vertical_gradient:+h,u_opacity:y}},_p=(w,l,h,y,v,A,P)=>s.e(nl(w,l,h,y),jl(A,l,P),{u_height_factor:-Math.pow(2,v.overscaledZ)/P.tileSize/8}),gh=w=>({u_matrix:w}),Ul=(w,l,h,y)=>s.e(gh(w),jl(h,l,y)),yp=(w,l)=>({u_matrix:w,u_world:l}),_h=(w,l,h,y,v)=>s.e(Ul(w,l,h,y),{u_world:v}),vp=(w,l,h,y)=>{const v=w.transform;let A,P;if(y.paint.get("circle-pitch-alignment")==="map"){const D=gn(h,1,v.zoom);A=!0,P=[D,D]}else A=!1,P=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(l.posMatrix,h,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+A,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:P}},yh=(w,l,h)=>{const y=gn(h,1,l.zoom),v=Math.pow(2,l.zoom-h.tileID.overscaledZ),A=h.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[l.pixelsToGLUnits[0]/(y*v),l.pixelsToGLUnits[1]/(y*v)],u_overscale_factor:A}},vh=(w,l,h=1)=>({u_matrix:w,u_color:l,u_overlay:0,u_overlay_scale:h}),Vl=w=>({u_matrix:w}),bh=(w,l,h,y)=>({u_matrix:w,u_extrude_scale:gn(l,1,h),u_intensity:y});function wh(w,l){const h=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new s.Y(0,y/h).toLngLat().lat,new s.Y(0,(y+1)/h).toLngLat().lat]}const ql=(w,l,h,y)=>{const v=w.transform;return{u_matrix:rl(w,l,h,y),u_ratio:1/gn(l,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},xh=(w,l,h,y,v)=>s.e(ql(w,l,h,v),{u_image:0,u_image_height:y}),js=(w,l,h,y,v)=>{const A=w.transform,P=eo(l,A);return{u_matrix:rl(w,l,h,v),u_texsize:l.imageAtlasTexture.size,u_ratio:1/gn(l,1,A.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[P,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]]}},Hl=(w,l,h,y,v,A)=>{const P=w.lineAtlas,D=eo(l,w.transform),$=h.layout.get("line-cap")==="round",Z=P.getDash(y.from,$),ee=P.getDash(y.to,$),te=Z.width*v.fromScale,me=ee.width*v.toScale;return s.e(ql(w,l,h,A),{u_patternscale_a:[D/te,-Z.height/2],u_patternscale_b:[D/me,-ee.height/2],u_sdfgamma:P.width/(256*Math.min(te,me)*w.pixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:ee.y,u_mix:v.t})};function eo(w,l){return 1/gn(w,1,l.tileZoom)}function rl(w,l,h,y){return w.translatePosMatrix(y?y.posMatrix:l.tileID.posMatrix,l,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Gl=(w,l,h,y,v)=>{return{u_matrix:w,u_tl_parent:l,u_scale_parent:h,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(P=v.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(A=v.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:il(v.paint.get("raster-hue-rotate"))};var A,P};function il(w){w*=Math.PI/180;const l=Math.sin(w),h=Math.cos(w);return[(2*h+1)/3,(-Math.sqrt(3)*l-h+1)/3,(Math.sqrt(3)*l-h+1)/3]}const ol=(w,l,h,y,v,A,P,D,$,Z)=>{const ee=v.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:ee.cameraToCenterDistance,u_pitch:ee.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:ee.width/ee.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:P,u_coord_matrix:D,u_is_text:+$,u_pitch_with_map:+y,u_texsize:Z,u_texture:0}},sl=(w,l,h,y,v,A,P,D,$,Z,ee)=>{const te=v.transform;return s.e(ol(w,l,h,y,v,A,P,D,$,Z),{u_gamma_scale:y?Math.cos(te._pitch)*te.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+ee})},al=(w,l,h,y,v,A,P,D,$,Z)=>s.e(sl(w,l,h,y,v,A,P,D,!0,$,!0),{u_texsize_icon:Z,u_texture_icon:1}),bp=(w,l,h)=>({u_matrix:w,u_opacity:l,u_color:h}),wp=(w,l,h,y,v,A)=>s.e(function(P,D,$,Z){const ee=$.imageManager.getPattern(P.from.toString()),te=$.imageManager.getPattern(P.to.toString()),{width:me,height:Ae}=$.imageManager.getPixelSize(),xe=Math.pow(2,Z.tileID.overscaledZ),Me=Z.tileSize*Math.pow(2,$.transform.tileZoom)/xe,ve=Me*(Z.tileID.canonical.x+Z.tileID.wrap*xe),Be=Me*Z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ee.tl,u_pattern_br_a:ee.br,u_pattern_tl_b:te.tl,u_pattern_br_b:te.br,u_texsize:[me,Ae],u_mix:D.t,u_pattern_size_a:ee.displaySize,u_pattern_size_b:te.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/gn(Z,1,$.transform.tileZoom),u_pixel_coord_upper:[ve>>16,Be>>16],u_pixel_coord_lower:[65535&ve,65535&Be]}}(y,A,h,v),{u_matrix:w,u_opacity:l}),Ah={fillExtrusion:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_opacity:new s.aH(w,l.u_opacity)}),fillExtrusionPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_height_factor:new s.aH(w,l.u_height_factor),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade),u_opacity:new s.aH(w,l.u_opacity)}),fill:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),fillPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),fillOutline:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world)}),fillOutlinePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),circle:(w,l)=>({u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_scale_with_map:new s.aG(w,l.u_scale_with_map),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_matrix:new s.aI(w,l.u_matrix)}),collisionBox:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(w,l.u_pixels_to_tile_units),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_overscale_factor:new s.aH(w,l.u_overscale_factor)}),collisionCircle:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_inv_matrix:new s.aI(w,l.u_inv_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_viewport_size:new s.aL(w,l.u_viewport_size)}),debug:(w,l)=>({u_color:new s.aM(w,l.u_color),u_matrix:new s.aI(w,l.u_matrix),u_overlay:new s.aG(w,l.u_overlay),u_overlay_scale:new s.aH(w,l.u_overlay_scale)}),clippingMask:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),heatmap:(w,l)=>({u_extrude_scale:new s.aH(w,l.u_extrude_scale),u_intensity:new s.aH(w,l.u_intensity),u_matrix:new s.aI(w,l.u_matrix)}),heatmapTexture:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_color_ramp:new s.aG(w,l.u_color_ramp),u_opacity:new s.aH(w,l.u_opacity)}),hillshade:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_latrange:new s.aL(w,l.u_latrange),u_light:new s.aL(w,l.u_light),u_shadow:new s.aM(w,l.u_shadow),u_highlight:new s.aM(w,l.u_highlight),u_accent:new s.aM(w,l.u_accent)}),hillshadePrepare:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_dimension:new s.aL(w,l.u_dimension),u_zoom:new s.aH(w,l.u_zoom),u_unpack:new s.aJ(w,l.u_unpack)}),line:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels)}),lineGradient:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_image:new s.aG(w,l.u_image),u_image_height:new s.aH(w,l.u_image_height)}),linePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texsize:new s.aL(w,l.u_texsize),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_image:new s.aG(w,l.u_image),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),lineSDF:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_patternscale_a:new s.aL(w,l.u_patternscale_a),u_patternscale_b:new s.aL(w,l.u_patternscale_b),u_sdfgamma:new s.aH(w,l.u_sdfgamma),u_image:new s.aG(w,l.u_image),u_tex_y_a:new s.aH(w,l.u_tex_y_a),u_tex_y_b:new s.aH(w,l.u_tex_y_b),u_mix:new s.aH(w,l.u_mix)}),raster:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_tl_parent:new s.aL(w,l.u_tl_parent),u_scale_parent:new s.aH(w,l.u_scale_parent),u_buffer_scale:new s.aH(w,l.u_buffer_scale),u_fade_t:new s.aH(w,l.u_fade_t),u_opacity:new s.aH(w,l.u_opacity),u_image0:new s.aG(w,l.u_image0),u_image1:new s.aG(w,l.u_image1),u_brightness_low:new s.aH(w,l.u_brightness_low),u_brightness_high:new s.aH(w,l.u_brightness_high),u_saturation_factor:new s.aH(w,l.u_saturation_factor),u_contrast_factor:new s.aH(w,l.u_contrast_factor),u_spin_weights:new s.aK(w,l.u_spin_weights)}),symbolIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture)}),symbolSDF:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),symbolTextAndIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texsize_icon:new s.aL(w,l.u_texsize_icon),u_texture:new s.aG(w,l.u_texture),u_texture_icon:new s.aG(w,l.u_texture_icon),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),background:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_color:new s.aM(w,l.u_color)}),backgroundPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_image:new s.aG(w,l.u_image),u_pattern_tl_a:new s.aL(w,l.u_pattern_tl_a),u_pattern_br_a:new s.aL(w,l.u_pattern_br_a),u_pattern_tl_b:new s.aL(w,l.u_pattern_tl_b),u_pattern_br_b:new s.aL(w,l.u_pattern_br_b),u_texsize:new s.aL(w,l.u_texsize),u_mix:new s.aH(w,l.u_mix),u_pattern_size_a:new s.aL(w,l.u_pattern_size_a),u_pattern_size_b:new s.aL(w,l.u_pattern_size_b),u_scale_a:new s.aH(w,l.u_scale_a),u_scale_b:new s.aH(w,l.u_scale_b),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(w,l.u_tile_units_to_pixels)}),terrain:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainDepth:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainCoords:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_terrain_coords_id:new s.aH(w,l.u_terrain_coords_id),u_ele_delta:new s.aH(w,l.u_ele_delta)})};class xp{constructor(l,h,y){this.context=l;const v=l.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Us={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wl{constructor(l,h,y,v){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,h){for(let y=0;y<this.attributes.length;y++){const v=h.attributes[this.attributes[y].name];v!==void 0&&l.enableVertexAttribArray(v)}}setVertexAttribPointers(l,h,y){for(let v=0;v<this.attributes.length;v++){const A=this.attributes[v],P=h.attributes[A.name];P!==void 0&&l.vertexAttribPointer(P,A.components,l[Us[A.type]],!1,this.itemSize,A.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ti=new WeakMap;function wi(w){var l;if(Ti.has(w))return Ti.get(w);{const h=(l=w.getParameter(w.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Ti.set(w,h),h}}class Qn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Zl extends Qn{getDefault(){return s.aO.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Xl extends Qn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class fc extends Qn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class hc extends Qn{getDefault(){return[!0,!0,!0,!0]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Kl extends Qn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class dc extends Qn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class pc extends Qn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Jl extends Qn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class kh extends Qn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}}class Sh extends Qn{getDefault(){return[0,1]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class da extends Qn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}}class Ap extends Qn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class kp extends Qn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}}class Sp extends Qn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Cp extends Qn{getDefault(){return s.aO.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Tp extends Qn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Mp extends Qn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}}class mc extends Qn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Yl extends Qn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class gc extends Qn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class _c extends Qn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class pa extends Qn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ch extends Qn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Th extends Qn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class yc extends Qn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Vs extends Qn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Mh extends Qn{getDefault(){return null}set(l){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class ma extends Qn{getDefault(){return null}set(l){var h;if(l===this.current&&!this.dirty)return;const y=this.gl;wi(y)?y.bindVertexArray(l):(h=y.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class ga extends Qn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Eh extends Qn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class vc extends Qn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Jn extends Qn{constructor(l,h){super(l),this.context=l,this.parent=h}getDefault(){return null}}class Ql extends Jn{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Ep extends Jn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Lh extends Jn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ll{constructor(l,h,y,v,A){this.context=l,this.width=h,this.height=y;const P=l.gl,D=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new Ql(l,D),v)this.depthAttachment=A?new Lh(l,D):new Ep(l,D);else if(A)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){const y=this.depthAttachment.get();y&&l.deleteRenderbuffer(y)}l.deleteFramebuffer(this.framebuffer)}}class Vr{constructor(l,h,y){this.blendFunction=l,this.blendColor=h,this.mask=y}}Vr.Replace=[1,0],Vr.disabled=new Vr(Vr.Replace,s.aO.transparent,[!1,!1,!1,!1]),Vr.unblended=new Vr(Vr.Replace,s.aO.transparent,[!0,!0,!0,!0]),Vr.alphaBlended=new Vr([1,771],s.aO.transparent,[!0,!0,!0,!0]);class Lp{constructor(l){var h,y;if(this.gl=l,this.clearColor=new Zl(this),this.clearDepth=new Xl(this),this.clearStencil=new fc(this),this.colorMask=new hc(this),this.depthMask=new Kl(this),this.stencilMask=new dc(this),this.stencilFunc=new pc(this),this.stencilOp=new Jl(this),this.stencilTest=new kh(this),this.depthRange=new Sh(this),this.depthTest=new da(this),this.depthFunc=new Ap(this),this.blend=new kp(this),this.blendFunc=new Sp(this),this.blendColor=new Cp(this),this.blendEquation=new Tp(this),this.cullFace=new Mp(this),this.cullFaceSide=new mc(this),this.frontFace=new Yl(this),this.program=new gc(this),this.activeTexture=new _c(this),this.viewport=new pa(this),this.bindFramebuffer=new Ch(this),this.bindRenderbuffer=new Th(this),this.bindTexture=new yc(this),this.bindVertexBuffer=new Vs(this),this.bindElementBuffer=new Mh(this),this.bindVertexArray=new ma(this),this.pixelStoreUnpack=new ga(this),this.pixelStoreUnpackPremultiplyAlpha=new Eh(this),this.pixelStoreUnpackFlipY=new vc(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),wi(l)){this.HALF_FLOAT=l.HALF_FLOAT;const v=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=l.RGBA16F)!==null&&h!==void 0?h:v==null?void 0:v.RGBA16F_EXT,this.RGB16F=(y=l.RGB16F)!==null&&y!==void 0?y:v==null?void 0:v.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const v=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=v==null?void 0:v.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,h){return new xp(this,l,h)}createVertexBuffer(l,h,y){return new Wl(this,l,h,y)}createRenderbuffer(l,h,y){const v=this.gl,A=v.createRenderbuffer();return this.bindRenderbuffer.set(A),v.renderbufferStorage(v.RENDERBUFFER,l,h,y),this.bindRenderbuffer.set(null),A}createFramebuffer(l,h,y,v){return new ll(this,l,h,y,v)}clear({color:l,depth:h,stencil:y}){const v=this.gl;let A=0;l&&(A|=v.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(A|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y!==void 0&&(A|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),v.clear(A)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){s.aD(l.blendFunction,Vr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return wi(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var h;return wi(this.gl)?this.gl.deleteVertexArray(l):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class Gn{constructor(l,h,y){this.func=l,this.mask=h,this.range=y}}Gn.ReadOnly=!1,Gn.ReadWrite=!0,Gn.disabled=new Gn(519,Gn.ReadOnly,[0,1]);const bc=7680;class wr{constructor(l,h,y,v,A,P){this.test=l,this.ref=h,this.mask=y,this.fail=v,this.depthFail=A,this.pass=P}}wr.disabled=new wr({func:519,mask:0},0,0,bc,bc,bc);class gr{constructor(l,h,y){this.enable=l,this.mode=h,this.frontFace=y}}let qs;function eu(w,l,h,y,v,A,P){const D=w.context,$=D.gl,Z=w.useProgram("collisionBox"),ee=[];let te=0,me=0;for(let Ie=0;Ie<y.length;Ie++){const He=y[Ie],rt=l.getTile(He),ot=rt.getBucket(h);if(!ot)continue;let ut=He.posMatrix;v[0]===0&&v[1]===0||(ut=w.translatePosMatrix(He.posMatrix,rt,v,A));const kt=P?ot.textCollisionBox:ot.iconCollisionBox,bt=ot.collisionCircleArray;if(bt.length>0){const Rt=s.F(),Ft=ut;s.aP(Rt,ot.placementInvProjMatrix,w.transform.glCoordMatrix),s.aP(Rt,Rt,ot.placementViewportMatrix),ee.push({circleArray:bt,circleOffset:me,transform:Ft,invTransform:Rt,coord:He}),te+=bt.length/4,me=te}kt&&Z.draw(D,$.LINES,Gn.disabled,wr.disabled,w.colorModeForRenderPass(),gr.disabled,yh(ut,w.transform,rt),w.style.map.terrain&&w.style.map.terrain.getTerrainData(He),h.id,kt.layoutVertexBuffer,kt.indexBuffer,kt.segments,null,w.transform.zoom,null,null,kt.collisionVertexBuffer)}if(!P||!ee.length)return;const Ae=w.useProgram("collisionCircle"),xe=new s.aQ;xe.resize(4*te),xe._trim();let Me=0;for(const Ie of ee)for(let He=0;He<Ie.circleArray.length/4;He++){const rt=4*He,ot=Ie.circleArray[rt+0],ut=Ie.circleArray[rt+1],kt=Ie.circleArray[rt+2],bt=Ie.circleArray[rt+3];xe.emplace(Me++,ot,ut,kt,bt,0),xe.emplace(Me++,ot,ut,kt,bt,1),xe.emplace(Me++,ot,ut,kt,bt,2),xe.emplace(Me++,ot,ut,kt,bt,3)}(!qs||qs.length<2*te)&&(qs=function(Ie){const He=2*Ie,rt=new s.aS;rt.resize(He),rt._trim();for(let ot=0;ot<He;ot++){const ut=6*ot;rt.uint16[ut+0]=4*ot+0,rt.uint16[ut+1]=4*ot+1,rt.uint16[ut+2]=4*ot+2,rt.uint16[ut+3]=4*ot+2,rt.uint16[ut+4]=4*ot+3,rt.uint16[ut+5]=4*ot+0}return rt}(te));const ve=D.createIndexBuffer(qs,!0),Be=D.createVertexBuffer(xe,s.aR.members,!0);for(const Ie of ee){const He={u_matrix:Ie.transform,u_inv_matrix:Ie.invTransform,u_camera_to_center_distance:(tt=w.transform).cameraToCenterDistance,u_viewport_size:[tt.width,tt.height]};Ae.draw(D,$.TRIANGLES,Gn.disabled,wr.disabled,w.colorModeForRenderPass(),gr.disabled,He,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ie.coord),h.id,Be,ve,s.$.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,w.transform.zoom,null,null,null)}var tt;Be.destroy(),ve.destroy()}gr.disabled=new gr(!1,1029,2305),gr.backCCW=new gr(!0,1029,2305);const wc=s.an(new Float32Array(16));function Ih(w,l,h,y,v,A){const{horizontalAlign:P,verticalAlign:D}=s.at(w);return new s.P((-(P-.5)*l/v+y[0])*A,(-(D-.5)*h/v+y[1])*A)}function tu(w,l,h,y,v,A,P,D,$,Z,ee){const te=w.text.placedSymbolArray,me=w.text.dynamicLayoutVertexArray,Ae=w.icon.dynamicLayoutVertexArray,xe={};me.clear();for(let Me=0;Me<te.length;Me++){const ve=te.get(Me),Be=ve.hidden||!ve.crossTileID||w.allowVerticalPlacement&&!ve.placedOrientation?null:y[ve.crossTileID];if(Be){const tt=new s.P(ve.anchorX,ve.anchorY),Ie=sr(tt,h?P:A,ee),He=Se(v.cameraToCenterDistance,Ie.signedDistanceFromCamera);let rt=s.ai(w.textSizeData,$,ve)*He/s.ao;h&&(rt*=w.tilePixelRatio/D);const{width:ot,height:ut,anchor:kt,textOffset:bt,textBoxScale:Rt}=Be,Ft=Ih(kt,ot,ut,bt,Rt,rt),Cn=h?sr(tt.add(Ft),A,ee).point:Ie.point.add(l?Ft.rotate(-v.angle):Ft),$t=w.allowVerticalPlacement&&ve.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let _n=0;_n<ve.numGlyphs;_n++)s.aj(me,Cn,$t);Z&&ve.associatedIconIndex>=0&&(xe[ve.associatedIconIndex]={shiftedAnchor:Cn,angle:$t})}else nt(ve.numGlyphs,me)}if(Z){Ae.clear();const Me=w.icon.placedSymbolArray;for(let ve=0;ve<Me.length;ve++){const Be=Me.get(ve);if(Be.hidden)nt(Be.numGlyphs,Ae);else{const tt=xe[ve];if(tt)for(let Ie=0;Ie<Be.numGlyphs;Ie++)s.aj(Ae,tt.shiftedAnchor,tt.angle);else nt(Be.numGlyphs,Ae)}}w.icon.dynamicLayoutVertexBuffer.updateData(Ae)}w.text.dynamicLayoutVertexBuffer.updateData(me)}function nu(w,l,h){return h.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function ru(w,l,h,y,v,A,P,D,$,Z,ee,te){const me=w.context,Ae=me.gl,xe=w.transform,Me=D==="map",ve=$==="map",Be=D!=="viewport"&&h.layout.get("symbol-placement")!=="point",tt=Me&&!ve&&!Be,Ie=!h.layout.get("symbol-sort-key").isConstant();let He=!1;const rt=w.depthModeForSublayer(0,Gn.ReadOnly),ot=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ut=[];for(const kt of y){const bt=l.getTile(kt),Rt=bt.getBucket(h);if(!Rt)continue;const Ft=v?Rt.text:Rt.icon;if(!Ft||!Ft.segments.get().length||!Ft.hasVisibleVertices)continue;const Cn=Ft.programConfigurations.get(h.id),$t=v||Rt.sdfIcons,_n=v?Rt.textSizeData:Rt.iconSizeData,Tn=ve||xe.pitch!==0,Wn=w.useProgram(nu($t,v,Rt),Cn),kn=s.ag(_n,xe.zoom),In=w.style.map.terrain&&w.style.map.terrain.getTerrainData(kt);let Rn,Or,ur,to,ri=[0,0],Pr=null;if(v)Or=bt.glyphAtlasTexture,ur=Ae.LINEAR,Rn=bt.glyphAtlasTexture.size,Rt.iconsInText&&(ri=bt.imageAtlasTexture.size,Pr=bt.imageAtlasTexture,to=Tn||w.options.rotating||w.options.zooming||_n.kind==="composite"||_n.kind==="camera"?Ae.LINEAR:Ae.NEAREST);else{const Xr=h.layout.get("icon-size").constantOr(0)!==1||Rt.iconsNeedLinear;Or=bt.imageAtlasTexture,ur=$t||w.options.rotating||w.options.zooming||Xr||Tn?Ae.LINEAR:Ae.NEAREST,Rn=bt.imageAtlasTexture.size}const ii=gn(bt,1,w.transform.zoom),no=tn(kt.posMatrix,ve,Me,w.transform,ii),Go=br(kt.posMatrix,ve,Me,w.transform,ii),Ms=ot&&Rt.hasTextData(),wl=h.layout.get("icon-text-fit")!=="none"&&Ms&&Rt.hasIconData();if(Be){const Xr=w.style.map.terrain?(mo,Kr)=>w.style.map.terrain.getElevation(kt,mo,Kr):null,Dr=h.layout.get("text-rotation-alignment")==="map";ce(Rt,kt.posMatrix,w,v,no,Go,ve,Z,Dr,Xr)}const Es=w.translatePosMatrix(kt.posMatrix,bt,A,P),Wo=Be||v&&ot||wl?wc:no,Zr=w.translatePosMatrix(Go,bt,A,P,!0),zr=$t&&h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mr;Mr=$t?Rt.iconsInText?al(_n.kind,kn,tt,ve,w,Es,Wo,Zr,Rn,ri):sl(_n.kind,kn,tt,ve,w,Es,Wo,Zr,v,Rn,!0):ol(_n.kind,kn,tt,ve,w,Es,Wo,Zr,v,Rn);const po={program:Wn,buffers:Ft,uniformValues:Mr,atlasTexture:Or,atlasTextureIcon:Pr,atlasInterpolation:ur,atlasInterpolationIcon:to,isSDF:$t,hasHalo:zr};if(Ie&&Rt.canOverlap){He=!0;const Xr=Ft.segments.get();for(const Dr of Xr)ut.push({segments:new s.$([Dr]),sortKey:Dr.sortKey,state:po,terrainData:In})}else ut.push({segments:Ft.segments,sortKey:0,state:po,terrainData:In})}He&&ut.sort((kt,bt)=>kt.sortKey-bt.sortKey);for(const kt of ut){const bt=kt.state;if(me.activeTexture.set(Ae.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,Ae.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(me.activeTexture.set(Ae.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE)),bt.isSDF){const Rt=bt.uniformValues;bt.hasHalo&&(Rt.u_is_halo=1,Ph(bt.buffers,kt.segments,h,w,bt.program,rt,ee,te,Rt,kt.terrainData)),Rt.u_is_halo=0}Ph(bt.buffers,kt.segments,h,w,bt.program,rt,ee,te,bt.uniformValues,kt.terrainData)}}function Ph(w,l,h,y,v,A,P,D,$,Z){const ee=y.context;v.draw(ee,ee.gl.TRIANGLES,A,P,D,gr.disabled,$,Z,h.id,w.layoutVertexBuffer,w.indexBuffer,l,h.paint,y.transform.zoom,w.programConfigurations.get(h.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function iu(w,l,h,y,v){if(!h||!y||!y.imageAtlas)return;const A=y.imageAtlas.patternPositions;let P=A[h.to.toString()],D=A[h.from.toString()];if(!P&&D&&(P=D),!D&&P&&(D=P),!P||!D){const $=v.getPaintProperty(l);P=A[$],D=A[$]}P&&D&&w.setConstantPatternPositions(P,D)}function zh(w,l,h,y,v,A,P){const D=w.context.gl,$="fill-pattern",Z=h.paint.get($),ee=Z&&Z.constantOr(1),te=h.getCrossfadeParameters();let me,Ae,xe,Me,ve;P?(Ae=ee&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",me=D.LINES):(Ae=ee?"fillPattern":"fill",me=D.TRIANGLES);const Be=Z.constantOr(null);for(const tt of y){const Ie=l.getTile(tt);if(ee&&!Ie.patternsLoaded())continue;const He=Ie.getBucket(h);if(!He)continue;const rt=He.programConfigurations.get(h.id),ot=w.useProgram(Ae,rt),ut=w.style.map.terrain&&w.style.map.terrain.getTerrainData(tt);ee&&(w.context.activeTexture.set(D.TEXTURE0),Ie.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),rt.updatePaintBuffers(te)),iu(rt,$,Be,Ie,h);const kt=ut?tt:null,bt=w.translatePosMatrix(kt?kt.posMatrix:tt.posMatrix,Ie,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(P){Me=He.indexBuffer2,ve=He.segments2;const Rt=[D.drawingBufferWidth,D.drawingBufferHeight];xe=Ae==="fillOutlinePattern"&&ee?_h(bt,w,te,Ie,Rt):yp(bt,Rt)}else Me=He.indexBuffer,ve=He.segments,xe=ee?Ul(bt,w,te,Ie):gh(bt);ot.draw(w.context,me,v,w.stencilModeForClipping(tt),A,gr.disabled,xe,ut,h.id,He.layoutVertexBuffer,Me,ve,h.paint,w.transform.zoom,rt)}}function ou(w,l,h,y,v,A,P){const D=w.context,$=D.gl,Z="fill-extrusion-pattern",ee=h.paint.get(Z),te=ee.constantOr(1),me=h.getCrossfadeParameters(),Ae=h.paint.get("fill-extrusion-opacity"),xe=ee.constantOr(null);for(const Me of y){const ve=l.getTile(Me),Be=ve.getBucket(h);if(!Be)continue;const tt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Me),Ie=Be.programConfigurations.get(h.id),He=w.useProgram(te?"fillExtrusionPattern":"fillExtrusion",Ie);te&&(w.context.activeTexture.set($.TEXTURE0),ve.imageAtlasTexture.bind($.LINEAR,$.CLAMP_TO_EDGE),Ie.updatePaintBuffers(me)),iu(Ie,Z,xe,ve,h);const rt=w.translatePosMatrix(Me.posMatrix,ve,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),ot=h.paint.get("fill-extrusion-vertical-gradient"),ut=te?_p(rt,w,ot,Ae,Me,me,ve):nl(rt,w,ot,Ae);He.draw(D,D.gl.TRIANGLES,v,A,P,gr.backCCW,ut,tt,h.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,h.paint,w.transform.zoom,Ie,w.style.map.terrain&&Be.centroidVertexBuffer)}}function su(w,l,h,y,v,A,P){const D=w.context,$=D.gl,Z=h.fbo;if(!Z)return;const ee=w.useProgram("hillshade"),te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(l);D.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,Z.colorAttachment.get()),ee.draw(D,$.TRIANGLES,v,A,P,gr.disabled,((me,Ae,xe,Me)=>{const ve=xe.paint.get("hillshade-shadow-color"),Be=xe.paint.get("hillshade-highlight-color"),tt=xe.paint.get("hillshade-accent-color");let Ie=xe.paint.get("hillshade-illumination-direction")*(Math.PI/180);xe.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ie-=me.transform.angle);const He=!me.options.moving;return{u_matrix:Me?Me.posMatrix:me.transform.calculatePosMatrix(Ae.tileID.toUnwrapped(),He),u_image:0,u_latrange:wh(0,Ae.tileID),u_light:[xe.paint.get("hillshade-exaggeration"),Ie],u_shadow:ve,u_highlight:Be,u_accent:tt}})(w,h,y,te?l:null),te,y.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function xc(w,l,h,y,v,A){const P=w.context,D=P.gl,$=l.dem;if($&&$.data){const Z=$.dim,ee=$.stride,te=$.getPixels();if(P.activeTexture.set(D.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||w.getTileTexture(ee),l.demTexture){const Ae=l.demTexture;Ae.update(te,{premultiply:!1}),Ae.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else l.demTexture=new Y(P,te,D.RGBA,{premultiply:!1}),l.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);P.activeTexture.set(D.TEXTURE0);let me=l.fbo;if(!me){const Ae=new Y(P,{width:Z,height:Z,data:null},D.RGBA);Ae.bind(D.LINEAR,D.CLAMP_TO_EDGE),me=l.fbo=P.createFramebuffer(Z,Z,!0,!1),me.colorAttachment.set(Ae.texture)}P.bindFramebuffer.set(me.framebuffer),P.viewport.set([0,0,Z,Z]),w.useProgram("hillshadePrepare").draw(P,D.TRIANGLES,y,v,A,gr.disabled,((Ae,xe)=>{const Me=xe.stride,ve=s.F();return s.aN(ve,0,s.W,-s.W,0,0,1),s.H(ve,ve,[0,-s.W,0]),{u_matrix:ve,u_image:1,u_dimension:[Me,Me],u_zoom:Ae.overscaledZ,u_unpack:xe.getUnpackVector()}})(l.tileID,$),null,h.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Dh(w,l,h,y,v,A){const P=y.paint.get("raster-fade-duration");if(!A&&P>0){const D=_.now(),$=(D-w.timeAdded)/P,Z=l?(D-l.timeAdded)/P:-1,ee=h.getSource(),te=v.coveringZoomLevel({tileSize:ee.tileSize,roundZoom:ee.roundZoom}),me=!l||Math.abs(l.tileID.overscaledZ-te)>Math.abs(w.tileID.overscaledZ-te),Ae=me&&w.refreshedUponExpiration?1:s.ac(me?$:1-Z,0,1);return w.refreshedUponExpiration&&$>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Ae}:{opacity:Ae,mix:0}}return{opacity:1,mix:0}}const Rh=new s.aO(1,0,0,1),au=new s.aO(0,1,0,1),Ac=new s.aO(0,0,1,1),Ip=new s.aO(1,0,1,1),Bh=new s.aO(0,1,1,1);function Br(w,l,h,y){Mi(w,0,l+h/2,w.transform.width,h,y)}function ks(w,l,h,y){Mi(w,l-h/2,0,h,w.transform.height,y)}function Mi(w,l,h,y,v,A){const P=w.context,D=P.gl;D.enable(D.SCISSOR_TEST),D.scissor(l*w.pixelRatio,h*w.pixelRatio,y*w.pixelRatio,v*w.pixelRatio),P.clear({color:A}),D.disable(D.SCISSOR_TEST)}function kc(w,l,h){const y=w.context,v=y.gl,A=h.posMatrix,P=w.useProgram("debug"),D=Gn.disabled,$=wr.disabled,Z=w.colorModeForRenderPass(),ee="$debug",te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(h);y.activeTexture.set(v.TEXTURE0);const me=l.getTileByID(h.key).latestRawTileData,Ae=Math.floor((me&&me.byteLength||0)/1024),xe=l.getTile(h).tileSize,Me=512/Math.min(xe,512)*(h.overscaledZ/w.transform.zoom)*.5;let ve=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ve+=` => ${h.overscaledZ}`),function(Be,tt){Be.initDebugOverlayCanvas();const Ie=Be.debugOverlayCanvas,He=Be.context.gl,rt=Be.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Ie.width,Ie.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(tt,5,5),rt.strokeText(tt,5,5),Be.debugOverlayTexture.update(Ie),Be.debugOverlayTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE)}(w,`${ve} ${Ae}kB`),P.draw(y,v.TRIANGLES,D,$,Vr.alphaBlended,gr.disabled,vh(A,s.aO.transparent,Me),null,ee,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),P.draw(y,v.LINE_STRIP,D,$,Z,gr.disabled,vh(A,s.aO.red),te,ee,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function lu(w,l,h){const y=w.context,v=y.gl,A=w.colorModeForRenderPass(),P=new Gn(v.LEQUAL,Gn.ReadWrite,w.depthRangeFor3D),D=w.useProgram("terrain"),$=l.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,w.width,w.height]);for(const Z of h){const ee=w.renderToTexture.getTexture(Z),te=l.getTerrainData(Z.tileID);y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,ee.texture);const me={u_matrix:w.transform.calculatePosMatrix(Z.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(w.transform.zoom)};D.draw(y,v.TRIANGLES,P,wr.disabled,A,gr.backCCW,me,te,"terrain",$.vertexBuffer,$.indexBuffer,$.segments)}}class Fh{constructor(l,h){this.context=new Lp(l),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Un.maxUnderzooming+Un.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new xs}resize(l,h,y){if(this.width=Math.floor(l*y),this.height=Math.floor(h*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const l=this.context,h=new s.aV;h.emplaceBack(0,0),h.emplaceBack(s.W,0),h.emplaceBack(0,s.W),h.emplaceBack(s.W,s.W),this.tileExtentBuffer=l.createVertexBuffer(h,$l.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const y=new s.aV;y.emplaceBack(0,0),y.emplaceBack(s.W,0),y.emplaceBack(0,s.W),y.emplaceBack(s.W,s.W),this.debugBuffer=l.createVertexBuffer(y,$l.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const v=new s.Z;v.emplaceBack(0,0,0,0),v.emplaceBack(s.W,0,s.W,0),v.emplaceBack(0,s.W,0,s.W),v.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=l.createVertexBuffer(v,it.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const A=new s.aV;A.emplaceBack(0,0),A.emplaceBack(1,0),A.emplaceBack(0,1),A.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(A,$l.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const P=new s.aW;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(P);const D=new s.aX;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(D);const $=this.context.gl;this.stencilClearMode=new wr({func:$.ALWAYS,mask:0},0,255,$.ZERO,$.ZERO,$.ZERO)}clearStencil(){const l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=s.F();s.aN(y,0,this.width,this.height,0,0,1),s.J(y,y,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,Gn.disabled,this.stencilClearMode,Vr.disabled,gr.disabled,Vl(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,h){if(this.currentStencilSource===l.source||!l.isTileClipped()||!h||!h.length)return;this.currentStencilSource=l.source;const y=this.context,v=y.gl;this.nextStencilID+h.length>256&&this.clearStencil(),y.setColorMode(Vr.disabled),y.setDepthMode(Gn.disabled);const A=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of h){const D=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,$=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P);A.draw(y,v.TRIANGLES,Gn.disabled,new wr({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),Vr.disabled,gr.disabled,Vl(P.posMatrix),$,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,h=this.context.gl;return new wr({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(l){const h=this.context.gl;return new wr({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(l){const h=this.context.gl,y=l.sort((P,D)=>D.overscaledZ-P.overscaledZ),v=y[y.length-1].overscaledZ,A=y[0].overscaledZ-v+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const P={};for(let D=0;D<A;D++)P[D+v]=new wr({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=A,[P,y]}return[{[v]:wr.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new Vr([l.CONSTANT_COLOR,l.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vr.unblended:Vr.alphaBlended}depthModeForSublayer(l,h,y){if(!this.opaquePassEnabledForLayer())return Gn.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Gn(y||this.context.gl.LEQUAL,h,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,h){this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(_.now()),this.imageManager.beginFrame();const y=this.style._order,v=this.style.sourceCaches,A={},P={},D={};for(const $ in v){const Z=v[$];Z.used&&Z.prepare(this.context),A[$]=Z.getVisibleCoordinates(),P[$]=A[$].slice().reverse(),D[$]=Z.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let $=0;$<y.length;$++)if(this.style._layers[y[$]].is3D()){this.opaquePassCutoff=$;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const $ of y){const Z=this.style._layers[$];if(!Z.hasOffscreenPass()||Z.isHidden(this.transform.zoom))continue;const ee=P[Z.source];(Z.type==="custom"||ee.length)&&this.renderLayer(this,v[Z.source],Z,ee)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const $=this.style._layers[y[this.currentLayer]],Z=v[$.source],ee=A[$.source];this._renderTileClippingMasks($,ee),this.renderLayer(this,Z,$,ee)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const $=this.style._layers[y[this.currentLayer]],Z=v[$.source];if(this.renderToTexture&&this.renderToTexture.renderLayer($))continue;const ee=($.type==="symbol"?D:P)[$.source];this._renderTileClippingMasks($,A[$.source]),this.renderLayer(this,Z,$,ee)}if(this.options.showTileBoundaries){const $=function(Z,ee){let te=null;const me=Object.values(Z._layers).flatMap(ve=>ve.source&&!ve.isHidden(ee)?[Z.sourceCaches[ve.source]]:[]),Ae=me.filter(ve=>ve.getSource().type==="vector"),xe=me.filter(ve=>ve.getSource().type!=="vector"),Me=ve=>{(!te||te.getSource().maxzoom<ve.getSource().maxzoom)&&(te=ve)};return Ae.forEach(ve=>Me(ve)),te||xe.forEach(ve=>Me(ve)),te}(this.style,this.transform.zoom);$&&function(Z,ee,te){for(let me=0;me<te.length;me++)kc(Z,ee,te[me])}(this,$,$.getVisibleCoordinates())}this.options.showPadding&&function($){const Z=$.transform.padding;Br($,$.transform.height-(Z.top||0),3,Rh),Br($,Z.bottom||0,3,au),ks($,Z.left||0,3,Ac),ks($,$.transform.width-(Z.right||0),3,Ip);const ee=$.transform.centerPoint;(function(te,me,Ae,xe){Mi(te,me-1,Ae-10,2,20,xe),Mi(te,me-10,Ae-1,20,2,xe)})($,ee.x,$.transform.height-ee.y,Bh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,y=this.transform.projMatrix;let v=this.terrainFacilitator.dirty;v||(v=l?!s.aY(h,y):!s.aZ(h,y)),v||(v=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),v&&(s.a_(h,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,P){const D=A.context,$=D.gl,Z=Vr.unblended,ee=new Gn($.LEQUAL,Gn.ReadWrite,[0,1]),te=P.getTerrainMesh(),me=P.sourceCache.getRenderableTiles(),Ae=A.useProgram("terrainDepth");D.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:s.aO.transparent,depth:1});for(const xe of me){const Me=P.getTerrainData(xe.tileID),ve={u_matrix:A.transform.calculatePosMatrix(xe.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};Ae.draw(D,$.TRIANGLES,ee,wr.disabled,Z,gr.backCCW,ve,Me,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,P){const D=A.context,$=D.gl,Z=Vr.unblended,ee=new Gn($.LEQUAL,Gn.ReadWrite,[0,1]),te=P.getTerrainMesh(),me=P.getCoordsTexture(),Ae=P.sourceCache.getRenderableTiles(),xe=A.useProgram("terrainCoords");D.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),D.clear({color:s.aO.transparent,depth:1}),P.coordsIndex=[];for(const Me of Ae){const ve=P.getTerrainData(Me.tileID);D.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,me.texture);const Be={u_matrix:A.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(A.transform.zoom)};xe.draw(D,$.TRIANGLES,ee,wr.disabled,Z,gr.backCCW,Be,ve,"terrain",te.vertexBuffer,te.indexBuffer,te.segments),P.coordsIndex.push(Me.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}renderLayer(l,h,y,v){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(v||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(A,P,D,$,Z){if(A.renderPass!=="translucent")return;const ee=wr.disabled,te=A.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(me,Ae,xe,Me,ve,Be,tt){const Ie=Ae.transform,He=ve==="map",rt=Be==="map";for(const ot of me){const ut=Me.getTile(ot),kt=ut.getBucket(xe);if(!kt||!kt.text||!kt.text.segments.get().length)continue;const bt=s.ag(kt.textSizeData,Ie.zoom),Rt=gn(ut,1,Ae.transform.zoom),Ft=tn(ot.posMatrix,rt,He,Ae.transform,Rt),Cn=xe.layout.get("icon-text-fit")!=="none"&&kt.hasIconData();if(bt){const $t=Math.pow(2,Ie.zoom-ut.tileID.overscaledZ);tu(kt,He,rt,tt,Ie,Ft,ot.posMatrix,$t,bt,Cn,Ae.style.map.terrain?(_n,Tn)=>Ae.style.map.terrain.getElevation(ot,_n,Tn):null)}}}($,A,D,P,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),Z),D.paint.get("icon-opacity").constantOr(1)!==0&&ru(A,P,D,$,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),ee,te),D.paint.get("text-opacity").constantOr(1)!==0&&ru(A,P,D,$,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),ee,te),P.map.showCollisionBoxes&&(eu(A,P,D,$,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),!0),eu(A,P,D,$,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),!1))})(l,h,y,v,this.style.placement.variableOffsets);break;case"circle":(function(A,P,D,$){if(A.renderPass!=="translucent")return;const Z=D.paint.get("circle-opacity"),ee=D.paint.get("circle-stroke-width"),te=D.paint.get("circle-stroke-opacity"),me=!D.layout.get("circle-sort-key").isConstant();if(Z.constantOr(1)===0&&(ee.constantOr(1)===0||te.constantOr(1)===0))return;const Ae=A.context,xe=Ae.gl,Me=A.depthModeForSublayer(0,Gn.ReadOnly),ve=wr.disabled,Be=A.colorModeForRenderPass(),tt=[];for(let Ie=0;Ie<$.length;Ie++){const He=$[Ie],rt=P.getTile(He),ot=rt.getBucket(D);if(!ot)continue;const ut=ot.programConfigurations.get(D.id),kt=A.useProgram("circle",ut),bt=ot.layoutVertexBuffer,Rt=ot.indexBuffer,Ft=A.style.map.terrain&&A.style.map.terrain.getTerrainData(He),Cn={programConfiguration:ut,program:kt,layoutVertexBuffer:bt,indexBuffer:Rt,uniformValues:vp(A,He,rt,D),terrainData:Ft};if(me){const $t=ot.segments.get();for(const _n of $t)tt.push({segments:new s.$([_n]),sortKey:_n.sortKey,state:Cn})}else tt.push({segments:ot.segments,sortKey:0,state:Cn})}me&&tt.sort((Ie,He)=>Ie.sortKey-He.sortKey);for(const Ie of tt){const{programConfiguration:He,program:rt,layoutVertexBuffer:ot,indexBuffer:ut,uniformValues:kt,terrainData:bt}=Ie.state;rt.draw(Ae,xe.TRIANGLES,Me,ve,Be,gr.disabled,kt,bt,D.id,ot,ut,Ie.segments,D.paint,A.transform.zoom,He)}})(l,h,y,v);break;case"heatmap":(function(A,P,D,$){if(D.paint.get("heatmap-opacity")!==0)if(A.renderPass==="offscreen"){const Z=A.context,ee=Z.gl,te=wr.disabled,me=new Vr([ee.ONE,ee.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(Ae,xe,Me){const ve=Ae.gl;Ae.activeTexture.set(ve.TEXTURE1),Ae.viewport.set([0,0,xe.width/4,xe.height/4]);let Be=Me.heatmapFbo;if(Be)ve.bindTexture(ve.TEXTURE_2D,Be.colorAttachment.get()),Ae.bindFramebuffer.set(Be.framebuffer);else{const tt=ve.createTexture();ve.bindTexture(ve.TEXTURE_2D,tt),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_S,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_WRAP_T,ve.CLAMP_TO_EDGE),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MIN_FILTER,ve.LINEAR),ve.texParameteri(ve.TEXTURE_2D,ve.TEXTURE_MAG_FILTER,ve.LINEAR),Be=Me.heatmapFbo=Ae.createFramebuffer(xe.width/4,xe.height/4,!1,!1),function(Ie,He,rt,ot){var ut,kt;const bt=Ie.gl,Rt=(ut=Ie.HALF_FLOAT)!==null&&ut!==void 0?ut:bt.UNSIGNED_BYTE,Ft=(kt=Ie.RGBA16F)!==null&&kt!==void 0?kt:bt.RGBA;bt.texImage2D(bt.TEXTURE_2D,0,Ft,He.width/4,He.height/4,0,bt.RGBA,Rt,null),ot.colorAttachment.set(rt)}(Ae,xe,tt,Be)}})(Z,A,D),Z.clear({color:s.aO.transparent});for(let Ae=0;Ae<$.length;Ae++){const xe=$[Ae];if(P.hasRenderableParent(xe))continue;const Me=P.getTile(xe),ve=Me.getBucket(D);if(!ve)continue;const Be=ve.programConfigurations.get(D.id),tt=A.useProgram("heatmap",Be),{zoom:Ie}=A.transform;tt.draw(Z,ee.TRIANGLES,Gn.disabled,te,me,gr.disabled,bh(xe.posMatrix,Me,Ie,D.paint.get("heatmap-intensity")),null,D.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,D.paint,A.transform.zoom,Be)}Z.viewport.set([0,0,A.width,A.height])}else A.renderPass==="translucent"&&(A.context.setColorMode(A.colorModeForRenderPass()),function(Z,ee){const te=Z.context,me=te.gl,Ae=ee.heatmapFbo;if(!Ae)return;te.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,Ae.colorAttachment.get()),te.activeTexture.set(me.TEXTURE1);let xe=ee.colorRampTexture;xe||(xe=ee.colorRampTexture=new Y(te,ee.colorRamp,me.RGBA)),xe.bind(me.LINEAR,me.CLAMP_TO_EDGE),Z.useProgram("heatmapTexture").draw(te,me.TRIANGLES,Gn.disabled,wr.disabled,Z.colorModeForRenderPass(),gr.disabled,((Me,ve,Be,tt)=>{const Ie=s.F();s.aN(Ie,0,Me.width,Me.height,0,0,1);const He=Me.context.gl;return{u_matrix:Ie,u_world:[He.drawingBufferWidth,He.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ve.paint.get("heatmap-opacity")}})(Z,ee),null,ee.id,Z.viewportBuffer,Z.quadTriangleIndexBuffer,Z.viewportSegments,ee.paint,Z.transform.zoom)}(A,D))})(l,h,y,v);break;case"line":(function(A,P,D,$){if(A.renderPass!=="translucent")return;const Z=D.paint.get("line-opacity"),ee=D.paint.get("line-width");if(Z.constantOr(1)===0||ee.constantOr(1)===0)return;const te=A.depthModeForSublayer(0,Gn.ReadOnly),me=A.colorModeForRenderPass(),Ae=D.paint.get("line-dasharray"),xe=D.paint.get("line-pattern"),Me=xe.constantOr(1),ve=D.paint.get("line-gradient"),Be=D.getCrossfadeParameters(),tt=Me?"linePattern":Ae?"lineSDF":ve?"lineGradient":"line",Ie=A.context,He=Ie.gl;let rt=!0;for(const ot of $){const ut=P.getTile(ot);if(Me&&!ut.patternsLoaded())continue;const kt=ut.getBucket(D);if(!kt)continue;const bt=kt.programConfigurations.get(D.id),Rt=A.context.program.get(),Ft=A.useProgram(tt,bt),Cn=rt||Ft.program!==Rt,$t=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ot),_n=xe.constantOr(null);if(_n&&ut.imageAtlas){const kn=ut.imageAtlas,In=kn.patternPositions[_n.to.toString()],Rn=kn.patternPositions[_n.from.toString()];In&&Rn&&bt.setConstantPatternPositions(In,Rn)}const Tn=$t?ot:null,Wn=Me?js(A,ut,D,Be,Tn):Ae?Hl(A,ut,D,Ae,Be,Tn):ve?xh(A,ut,D,kt.lineClipsArray.length,Tn):ql(A,ut,D,Tn);if(Me)Ie.activeTexture.set(He.TEXTURE0),ut.imageAtlasTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE),bt.updatePaintBuffers(Be);else if(Ae&&(Cn||A.lineAtlas.dirty))Ie.activeTexture.set(He.TEXTURE0),A.lineAtlas.bind(Ie);else if(ve){const kn=kt.gradients[D.id];let In=kn.texture;if(D.gradientVersion!==kn.version){let Rn=256;if(D.stepInterpolant){const Or=P.getSource().maxzoom,ur=ot.canonical.z===Or?Math.ceil(1<<A.transform.maxZoom-ot.canonical.z):1;Rn=s.ac(s.aT(kt.maxLineLength/s.W*1024*ur),256,Ie.maxTextureSize)}kn.gradient=s.aU({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:Rn,image:kn.gradient||void 0,clips:kt.lineClipsArray}),kn.texture?kn.texture.update(kn.gradient):kn.texture=new Y(Ie,kn.gradient,He.RGBA),kn.version=D.gradientVersion,In=kn.texture}Ie.activeTexture.set(He.TEXTURE0),In.bind(D.stepInterpolant?He.NEAREST:He.LINEAR,He.CLAMP_TO_EDGE)}Ft.draw(Ie,He.TRIANGLES,te,A.stencilModeForClipping(ot),me,gr.disabled,Wn,$t,D.id,kt.layoutVertexBuffer,kt.indexBuffer,kt.segments,D.paint,A.transform.zoom,bt,kt.layoutVertexBuffer2),rt=!1}})(l,h,y,v);break;case"fill":(function(A,P,D,$){const Z=D.paint.get("fill-color"),ee=D.paint.get("fill-opacity");if(ee.constantOr(1)===0)return;const te=A.colorModeForRenderPass(),me=D.paint.get("fill-pattern"),Ae=A.opaquePassEnabledForLayer()&&!me.constantOr(1)&&Z.constantOr(s.aO.transparent).a===1&&ee.constantOr(0)===1?"opaque":"translucent";if(A.renderPass===Ae){const xe=A.depthModeForSublayer(1,A.renderPass==="opaque"?Gn.ReadWrite:Gn.ReadOnly);zh(A,P,D,$,xe,te,!1)}if(A.renderPass==="translucent"&&D.paint.get("fill-antialias")){const xe=A.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,Gn.ReadOnly);zh(A,P,D,$,xe,te,!0)}})(l,h,y,v);break;case"fill-extrusion":(function(A,P,D,$){const Z=D.paint.get("fill-extrusion-opacity");if(Z!==0&&A.renderPass==="translucent"){const ee=new Gn(A.context.gl.LEQUAL,Gn.ReadWrite,A.depthRangeFor3D);if(Z!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))ou(A,P,D,$,ee,wr.disabled,Vr.disabled),ou(A,P,D,$,ee,A.stencilModeFor3D(),A.colorModeForRenderPass());else{const te=A.colorModeForRenderPass();ou(A,P,D,$,ee,wr.disabled,te)}}})(l,h,y,v);break;case"hillshade":(function(A,P,D,$){if(A.renderPass!=="offscreen"&&A.renderPass!=="translucent")return;const Z=A.context,ee=A.depthModeForSublayer(0,Gn.ReadOnly),te=A.colorModeForRenderPass(),[me,Ae]=A.renderPass==="translucent"?A.stencilConfigForOverlap($):[{},$];for(const xe of Ae){const Me=P.getTile(xe);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&A.renderPass==="offscreen"?xc(A,Me,D,ee,wr.disabled,te):A.renderPass==="translucent"&&su(A,xe,Me,D,ee,me[xe.overscaledZ],te)}Z.viewport.set([0,0,A.width,A.height])})(l,h,y,v);break;case"raster":(function(A,P,D,$){if(A.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!$.length)return;const Z=A.context,ee=Z.gl,te=P.getSource(),me=A.useProgram("raster"),Ae=A.colorModeForRenderPass(),[xe,Me]=te instanceof Ut?[{},$]:A.stencilConfigForOverlap($),ve=Me[Me.length-1].overscaledZ,Be=!A.options.moving;for(const tt of Me){const Ie=A.depthModeForSublayer(tt.overscaledZ-ve,D.paint.get("raster-opacity")===1?Gn.ReadWrite:Gn.ReadOnly,ee.LESS),He=P.getTile(tt);He.registerFadeDuration(D.paint.get("raster-fade-duration"));const rt=P.findLoadedParent(tt,0),ot=Dh(He,rt,P,D,A.transform,A.style.map.terrain);let ut,kt;const bt=D.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR;Z.activeTexture.set(ee.TEXTURE0),He.texture.bind(bt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),Z.activeTexture.set(ee.TEXTURE1),rt?(rt.texture.bind(bt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST),ut=Math.pow(2,rt.tileID.overscaledZ-He.tileID.overscaledZ),kt=[He.tileID.canonical.x*ut%1,He.tileID.canonical.y*ut%1]):He.texture.bind(bt,ee.CLAMP_TO_EDGE,ee.LINEAR_MIPMAP_NEAREST);const Rt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(tt),Ft=Rt?tt:null,Cn=Ft?Ft.posMatrix:A.transform.calculatePosMatrix(tt.toUnwrapped(),Be),$t=Gl(Cn,kt||[0,0],ut||1,ot,D);te instanceof Ut?me.draw(Z,ee.TRIANGLES,Ie,wr.disabled,Ae,gr.disabled,$t,Rt,D.id,te.boundsBuffer,A.quadTriangleIndexBuffer,te.boundsSegments):me.draw(Z,ee.TRIANGLES,Ie,xe[tt.overscaledZ],Ae,gr.disabled,$t,Rt,D.id,A.rasterBoundsBuffer,A.quadTriangleIndexBuffer,A.rasterBoundsSegments)}})(l,h,y,v);break;case"background":(function(A,P,D,$){const Z=D.paint.get("background-color"),ee=D.paint.get("background-opacity");if(ee===0)return;const te=A.context,me=te.gl,Ae=A.transform,xe=Ae.tileSize,Me=D.paint.get("background-pattern");if(A.isPatternMissing(Me))return;const ve=!Me&&Z.a===1&&ee===1&&A.opaquePassEnabledForLayer()?"opaque":"translucent";if(A.renderPass!==ve)return;const Be=wr.disabled,tt=A.depthModeForSublayer(0,ve==="opaque"?Gn.ReadWrite:Gn.ReadOnly),Ie=A.colorModeForRenderPass(),He=A.useProgram(Me?"backgroundPattern":"background"),rt=$||Ae.coveringTiles({tileSize:xe,terrain:A.style.map.terrain});Me&&(te.activeTexture.set(me.TEXTURE0),A.imageManager.bind(A.context));const ot=D.getCrossfadeParameters();for(const ut of rt){const kt=$?ut.posMatrix:A.transform.calculatePosMatrix(ut.toUnwrapped()),bt=Me?wp(kt,ee,A,Me,{tileID:ut,tileSize:xe},ot):bp(kt,ee,Z),Rt=A.style.map.terrain&&A.style.map.terrain.getTerrainData(ut);He.draw(te,me.TRIANGLES,tt,Be,Ie,gr.disabled,bt,Rt,D.id,A.tileExtentBuffer,A.quadTriangleIndexBuffer,A.tileExtentSegments)}})(l,0,y,v);break;case"custom":(function(A,P,D){const $=A.context,Z=D.implementation;if(A.renderPass==="offscreen"){const ee=Z.prerender;ee&&(A.setCustomLayerDefaults(),$.setColorMode(A.colorModeForRenderPass()),ee.call(Z,$.gl,A.transform.customLayerMatrix()),$.setDirty(),A.setBaseState())}else if(A.renderPass==="translucent"){A.setCustomLayerDefaults(),$.setColorMode(A.colorModeForRenderPass()),$.setStencilMode(wr.disabled);const ee=Z.renderingMode==="3d"?new Gn(A.context.gl.LEQUAL,Gn.ReadWrite,A.depthRangeFor3D):A.depthModeForSublayer(0,Gn.ReadOnly);$.setDepthMode(ee),Z.render($.gl,A.transform.customLayerMatrix()),$.setDirty(),A.setBaseState(),$.bindFramebuffer.set(null)}})(l,0,y)}}translatePosMatrix(l,h,y,v,A){if(!y[0]&&!y[1])return l;const P=A?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(P){const Z=Math.sin(P),ee=Math.cos(P);y=[y[0]*ee-y[1]*Z,y[0]*Z+y[1]*ee]}const D=[A?y[0]:gn(h,y[0],this.transform.zoom),A?y[1]:gn(h,y[1],this.transform.zoom),0],$=new Float32Array(16);return s.H($,l,D),$}saveTileTexture(l){const h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const h=this._tileTextures[l];return h&&h.length>0?h.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const h=this.imageManager.getPattern(l.from.toString()),y=this.imageManager.getPattern(l.to.toString());return!h||!y}useProgram(l,h){this.cache=this.cache||{};const y=l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new As(this.context,tl[l],h,Ah[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Y(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:h}=this.context.gl;return this.width!==l||this.height!==h}}class Ss{constructor(l,h){this.points=l,this.planes=h}static fromInvProjectionMatrix(l,h,y){const v=Math.pow(2,y),A=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const $=1/(D=s.af([],D,l))[3]/h*v;return s.a$(D,D,[$,$,1/D[3],$])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const $=function(me,Ae){var xe=Ae[0],Me=Ae[1],ve=Ae[2],Be=xe*xe+Me*Me+ve*ve;return Be>0&&(Be=1/Math.sqrt(Be)),me[0]=Ae[0]*Be,me[1]=Ae[1]*Be,me[2]=Ae[2]*Be,me}([],function(me,Ae,xe){var Me=Ae[0],ve=Ae[1],Be=Ae[2],tt=xe[0],Ie=xe[1],He=xe[2];return me[0]=ve*He-Be*Ie,me[1]=Be*tt-Me*He,me[2]=Me*Ie-ve*tt,me}([],J([],A[D[0]],A[D[1]]),J([],A[D[2]],A[D[1]]))),Z=-((ee=$)[0]*(te=A[D[1]])[0]+ee[1]*te[1]+ee[2]*te[2]);var ee,te;return $.concat(Z)});return new Ss(A,P)}}class Cs{constructor(l,h){this.min=l,this.max=h,this.center=function(y,v,A){return y[0]=.5*v[0],y[1]=.5*v[1],y[2]=.5*v[2],y}([],function(y,v,A){return y[0]=v[0]+A[0],y[1]=v[1]+A[1],y[2]=v[2]+A[2],y}([],this.min,this.max))}quadrant(l){const h=[l%2==0,l<2],y=H(this.min),v=H(this.max);for(let A=0;A<h.length;A++)y[A]=h[A]?this.min[A]:this.center[A],v[A]=h[A]?this.center[A]:this.max[A];return v[2]=this.max[2],new Cs(y,v)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let v=0;v<l.planes.length;v++){const A=l.planes[v];let P=0;for(let D=0;D<h.length;D++)s.b0(A,h[D])>=0&&P++;if(P===0)return 0;P!==h.length&&(y=!1)}if(y)return 2;for(let v=0;v<3;v++){let A=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let D=0;D<l.points.length;D++){const $=l.points[D][v]-this.min[v];A=Math.min(A,$),P=Math.max(P,$)}if(P<0||A>this.max[v]-this.min[v])return 0}return 1}}class _a{constructor(l=0,h=0,y=0,v=0){if(isNaN(l)||l<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=y,this.right=v}interpolate(l,h,y){return h.top!=null&&l.top!=null&&(this.top=s.z.number(l.top,h.top,y)),h.bottom!=null&&l.bottom!=null&&(this.bottom=s.z.number(l.bottom,h.bottom,y)),h.left!=null&&l.left!=null&&(this.left=s.z.number(l.left,h.left,y)),h.right!=null&&l.right!=null&&(this.right=s.z.number(l.right,h.right,y)),this}getCenter(l,h){const y=s.ac((this.left+l-this.right)/2,0,l),v=s.ac((this.top+h-this.bottom)/2,0,h);return new s.P(y,v)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new _a(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Sc=85.051129;class uu{constructor(l,h,y,v,A){this.tileSize=512,this._renderWorldCopies=A===void 0||!!A,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new _a,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new uu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const h=-s.b1(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var y=new s.A(4);return s.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,v,A){var P=v[0],D=v[1],$=v[2],Z=v[3],ee=Math.sin(A),te=Math.cos(A);y[0]=P*te+$*ee,y[1]=D*te+Z*ee,y[2]=P*-ee+$*te,y[3]=D*-ee+Z*te}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const h=s.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,h,y){this._unmodified=!1,this._edgeInsets.interpolate(l,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(l){const h=[new s.b2(0,l)];if(this._renderWorldCopies){const y=this.pointCoordinate(new s.P(0,0)),v=this.pointCoordinate(new s.P(this.width,0)),A=this.pointCoordinate(new s.P(this.width,this.height)),P=this.pointCoordinate(new s.P(0,this.height)),D=Math.floor(Math.min(y.x,v.x,A.x,P.x)),$=Math.floor(Math.max(y.x,v.x,A.x,P.x)),Z=1;for(let ee=D-Z;ee<=$+Z;ee++)ee!==0&&h.push(new s.b2(ee,l))}return h}coveringTiles(l){var h,y;let v=this.coveringZoomLevel(l);const A=v;if(l.minzoom!==void 0&&v<l.minzoom)return[];l.maxzoom!==void 0&&v>l.maxzoom&&(v=l.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),D=s.Y.fromLngLat(this.center),$=Math.pow(2,v),Z=[$*P.x,$*P.y,0],ee=[$*D.x,$*D.y,0],te=Ss.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v);let me=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(me=v);const Ae=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,xe=Ie=>({aabb:new Cs([Ie*$,0,0],[(Ie+1)*$,$,0]),zoom:0,x:0,y:0,wrap:Ie,fullyVisible:!1}),Me=[],ve=[],Be=v,tt=l.reparseOverscaled?A:v;if(this._renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)Me.push(xe(-Ie)),Me.push(xe(Ie));for(Me.push(xe(0));Me.length>0;){const Ie=Me.pop(),He=Ie.x,rt=Ie.y;let ot=Ie.fullyVisible;if(!ot){const Ft=Ie.aabb.intersects(te);if(Ft===0)continue;ot=Ft===2}const ut=l.terrain?Z:ee,kt=Ie.aabb.distanceX(ut),bt=Ie.aabb.distanceY(ut),Rt=Math.max(Math.abs(kt),Math.abs(bt));if(Ie.zoom===Be||Rt>Ae+(1<<Be-Ie.zoom)-2&&Ie.zoom>=me){const Ft=Be-Ie.zoom,Cn=Z[0]-.5-(He<<Ft),$t=Z[1]-.5-(rt<<Ft);ve.push({tileID:new s.Q(Ie.zoom===Be?tt:Ie.zoom,Ie.wrap,Ie.zoom,He,rt),distanceSq:he([ee[0]-.5-He,ee[1]-.5-rt]),tileDistanceToCamera:Math.sqrt(Cn*Cn+$t*$t)})}else for(let Ft=0;Ft<4;Ft++){const Cn=(He<<1)+Ft%2,$t=(rt<<1)+(Ft>>1),_n=Ie.zoom+1;let Tn=Ie.aabb.quadrant(Ft);if(l.terrain){const Wn=new s.Q(_n,Ie.wrap,_n,Cn,$t),kn=l.terrain.getMinMaxElevation(Wn),In=(h=kn.minElevation)!==null&&h!==void 0?h:this.elevation,Rn=(y=kn.maxElevation)!==null&&y!==void 0?y:this.elevation;Tn=new Cs([Tn.min[0],Tn.min[1],In],[Tn.max[0],Tn.max[1],Rn])}Me.push({aabb:Tn,zoom:_n,x:Cn,y:$t,wrap:Ie.wrap,fullyVisible:ot})}}return ve.sort((Ie,He)=>Ie.distanceSq-He.distanceSq).map(Ie=>Ie.tileID)}resize(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const h=s.ac(l.lat,-85.051129,Sc);return new s.P(s.N(l.lng)*this.worldSize,s.O(h)*this.worldSize)}unproject(l){return new s.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const h=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,v=this.pointLocation(this.centerPoint,l),A=l.getElevationForLngLatZoom(v,this.tileZoom);if(!(this.elevation-A))return;const P=y+h-A,D=Math.cos(this._pitch)*this.cameraToCenterDistance/P/s.b3(1,v.lat),$=this.scaleZoom(D/this.tileSize);this._elevation=A,this._center=v,this.zoom=$}setLocationAtPoint(l,h){const y=this.pointCoordinate(h),v=this.pointCoordinate(this.centerPoint),A=this.locationCoordinate(l),P=new s.Y(A.x-(y.x-v.x),A.y-(y.y-v.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,h){return h?this.coordinatePoint(this.locationCoordinate(l),h.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,h){return this.coordinateLocation(this.pointCoordinate(l,h))}locationCoordinate(l){return s.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,h){if(h){const me=h.pointCoordinate(l);if(me!=null)return me}const y=[l.x,l.y,0,1],v=[l.x,l.y,1,1];s.af(y,y,this.pixelMatrixInverse),s.af(v,v,this.pixelMatrixInverse);const A=y[3],P=v[3],D=y[1]/A,$=v[1]/P,Z=y[2]/A,ee=v[2]/P,te=Z===ee?0:(0-Z)/(ee-Z);return new s.Y(s.z.number(y[0]/A,v[0]/P,te)/this.worldSize,s.z.number(D,$,te)/this.worldSize)}coordinatePoint(l,h=0,y=this.pixelMatrix){const v=[l.x*this.worldSize,l.y*this.worldSize,h,1];return s.af(v,v,y),new s.P(v[0]/v[3],v[1]/v[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new Ge().extend(this.pointLocation(new s.P(0,l))).extend(this.pointLocation(new s.P(this.width,l))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ge([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Sc])}calculatePosMatrix(l,h=!1){const y=l.key,v=h?this._alignedPosMatrixCache:this._posMatrixCache;if(v[y])return v[y];const A=l.canonical,P=this.worldSize/this.zoomScale(A.z),D=A.x+Math.pow(2,A.z)*l.wrap,$=s.an(new Float64Array(16));return s.H($,$,[D*P,A.y*P,0]),s.J($,$,[P/s.W,P/s.W,1]),s.K($,h?this.alignedProjMatrix:this.projMatrix,$),v[y]=new Float32Array($),v[y]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,h){h=s.ac(+h,this.minZoom,this.maxZoom);const y={center:new s.M(l.lng,l.lat),zoom:h};let v=this.lngRange;if(!this._renderWorldCopies&&v===null){const Ie=179.9999999999;v=[-Ie,Ie]}const A=this.tileSize*this.zoomScale(y.zoom);let P=0,D=A,$=0,Z=A,ee=0,te=0;const{x:me,y:Ae}=this.size;if(this.latRange){const Ie=this.latRange;P=s.O(Ie[1])*A,D=s.O(Ie[0])*A,D-P<Ae&&(ee=Ae/(D-P))}v&&($=s.b1(s.N(v[0])*A,0,A),Z=s.b1(s.N(v[1])*A,0,A),Z<$&&(Z+=A),Z-$<me&&(te=me/(Z-$)));const{x:xe,y:Me}=this.project.call({worldSize:A},l);let ve,Be;const tt=Math.max(te||0,ee||0);if(tt){const Ie=new s.P(te?(Z+$)/2:xe,ee?(D+P)/2:Me);return y.center=this.unproject.call({worldSize:A},Ie).wrap(),y.zoom+=this.scaleZoom(tt),y}if(this.latRange){const Ie=Ae/2;Me-Ie<P&&(Be=P+Ie),Me+Ie>D&&(Be=D-Ie)}if(v){const Ie=($+Z)/2;let He=xe;this._renderWorldCopies&&(He=s.b1(xe,Ie-A/2,Ie+A/2));const rt=me/2;He-rt<$&&(ve=$+rt),He+rt>Z&&(ve=Z-rt)}if(ve!==void 0||Be!==void 0){const Ie=new s.P(ve??xe,Be??Me);y.center=this.unproject.call({worldSize:A},Ie).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:h,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=y,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,h=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b3(1,this.center.lat)*this.worldSize;let v=s.an(new Float64Array(16));s.J(v,v,[this.width/2,-this.height/2,1]),s.H(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=s.an(new Float64Array(16)),s.J(v,v,[1,-1,1]),s.H(v,v,[-1,-1,0]),s.J(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v;const A=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),P=Math.min(this.elevation,this.minElevationForCurrentTile),D=A-P*this._pixelPerMeter/Math.cos(this._pitch),$=P<0?D:A,Z=Math.PI/2+this._pitch,ee=this._fov*(.5+l.y/this.height),te=Math.sin(ee)*$/Math.sin(s.ac(Math.PI-Z-ee,.01,Math.PI-.01)),me=this.getHorizon(),Ae=2*Math.atan(me/this.cameraToCenterDistance)*(.5+l.y/(2*me)),xe=Math.sin(Ae)*$/Math.sin(s.ac(Math.PI-Z-Ae,.01,Math.PI-.01)),Me=Math.min(te,xe),ve=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+$),Be=this.height/50;v=new Float64Array(16),s.b4(v,this._fov,this.width/this.height,Be,ve),v[8]=2*-l.x/this.width,v[9]=2*l.y/this.height,s.J(v,v,[1,-1,1]),s.H(v,v,[0,0,-this.cameraToCenterDistance]),s.b5(v,v,this._pitch),s.ad(v,v,this.angle),s.H(v,v,[-h,-y,0]),this.mercatorMatrix=s.J([],v,[this.worldSize,this.worldSize,this.worldSize]),s.J(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,v),s.H(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=s.ar([],v),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,v);const tt=this.width%2/2,Ie=this.height%2/2,He=Math.cos(this.angle),rt=Math.sin(this.angle),ot=h-Math.round(h)+He*tt+rt*Ie,ut=y-Math.round(y)+He*Ie+rt*tt,kt=new Float64Array(v);if(s.H(kt,kt,[ot>.5?ot-1:ot,ut>.5?ut-1:ut,0]),this.alignedProjMatrix=kt,v=s.ar(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new s.P(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}getCameraQueryGeometry(l){const h=this.getCameraPoint();if(l.length===1)return[l[0],h];{let y=h.x,v=h.y,A=h.x,P=h.y;for(const D of l)y=Math.min(y,D.x),v=Math.min(v,D.y),A=Math.max(A,D.x),P=Math.max(P,D.y);return[new s.P(y,v),new s.P(A,v),new s.P(A,P),new s.P(y,P),new s.P(y,v)]}}lngLatToCameraDepth(l,h){const y=this.locationCoordinate(l),v=[y.x*this.worldSize,y.y*this.worldSize,h,1];return s.af(v,v,this.projMatrix),v[2]/v[3]}}function Cc(w,l){let h,y=!1,v=null,A=null;const P=()=>{v=null,y&&(w.apply(A,h),v=setTimeout(P,l),y=!1)};return(...D)=>(y=!0,A=this,h=D,v||P(),v)}class Tc{constructor(l){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let y;return h.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(y=v)}),(y&&y[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Cc(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const h=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,v=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,v),P=Math.round(h.lng*A)/A,D=Math.round(h.lat*A)/A,$=this._map.getBearing(),Z=this._map.getPitch();let ee="";if(ee+=l?`/${P}/${D}/${y}`:`${y}/${D}/${P}`,($||Z)&&(ee+="/"+Math.round(10*$)/10),Z&&(ee+=`/${Math.round(Z)}`),this._hashName){const te=this._hashName;let me=!1;const Ae=window.location.hash.slice(1).split("&").map(xe=>{const Me=xe.split("=")[0];return Me===te?(me=!0,`${Me}=${ee}`):xe}).filter(xe=>xe);return me||Ae.push(`${te}=${ee}`),`#${Ae.join("&")}`}return`#${ee}`}}const ul={linearity:.3,easing:s.b6(0,0,.3,1)},Hs=s.e({deceleration:2500,maxSpeed:1400},ul),Oh=s.e({deceleration:20,maxSpeed:1400},ul),$h=s.e({deceleration:1e3,maxSpeed:360},ul),Nh=s.e({deceleration:1e3,maxSpeed:90},ul);class jh{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,h=_.now();for(;l.length>0&&h-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)h.zoom+=A.zoomDelta||0,h.bearing+=A.bearingDelta||0,h.pitch+=A.pitchDelta||0,A.panDelta&&h.pan._add(A.panDelta),A.around&&(h.around=A.around),A.pinchAround&&(h.pinchAround=A.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const A=fl(h.pan.mag(),y,s.e({},Hs,l||{}));v.offset=h.pan.mult(A.amount/h.pan.mag()),v.center=this._map.transform.center,cl(v,A)}if(h.zoom){const A=fl(h.zoom,y,Oh);v.zoom=this._map.transform.zoom+A.amount,cl(v,A)}if(h.bearing){const A=fl(h.bearing,y,$h);v.bearing=this._map.transform.bearing+s.ac(A.amount,-179,179),cl(v,A)}if(h.pitch){const A=fl(h.pitch,y,Nh);v.pitch=this._map.transform.pitch+A.amount,cl(v,A)}if(v.zoom||v.bearing){const A=h.pinchAround===void 0?h.around:h.pinchAround;v.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),s.e(v,{noMoveStart:!0})}}function cl(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function fl(w,l,h){const{maxSpeed:y,linearity:v,deceleration:A}=h,P=s.ac(w*v/(l/1e3),-y,y),D=Math.abs(P)/(A*v);return{easing:h.easing,duration:1e3*D,amount:P*(D/2)}}class Fi extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y,v={}){const A=x.mousePos(h.getCanvas(),y),P=h.unproject(A);super(l,s.e({point:A,lngLat:P,originalEvent:y},v)),this._defaultPrevented=!1,this.target=h}}class Vo extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){const v=l==="touchend"?y.changedTouches:y.touches,A=x.touchPos(h.getCanvasContainer(),v),P=A.map($=>h.unproject($)),D=A.reduce(($,Z,ee,te)=>$.add(Z.div(te.length)),new s.P(0,0));super(l,{points:A,point:D,lngLats:P,lngLat:h.unproject(D),originalEvent:y}),this._defaultPrevented=!1}}class Mc extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){super(l,{originalEvent:y}),this._defaultPrevented=!1}}class Ao{constructor(l,h){this._map=l,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new Mc(l.type,this._map,l))}mousedown(l,h){return this._mousedownPos=h,this._firePreventable(new Fi(l.type,this._map,l))}mouseup(l){this._map.fire(new Fi(l.type,this._map,l))}click(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Fi(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Fi(l.type,this._map,l))}mouseover(l){this._map.fire(new Fi(l.type,this._map,l))}mouseout(l){this._map.fire(new Fi(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Vo(l.type,this._map,l))}touchmove(l){this._map.fire(new Vo(l.type,this._map,l))}touchend(l){this._map.fire(new Vo(l.type,this._map,l))}touchcancel(l){this._map.fire(new Vo(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qo{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Fi(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Fi(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ya{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(s.P.convert(l),this._map.terrain)}}class ko{constructor(l,h){this._map=l,this._tr=new ya(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(x.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(l,h){if(!this._active)return;const y=h;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=y,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const A=Math.min(v.x,y.x),P=Math.max(v.x,y.x),D=Math.min(v.y,y.y),$=Math.max(v.y,y.y);x.setTransform(this._box,`translate(${A}px,${D}px)`),this._box.style.width=P-A+"px",this._box.style.height=$-D+"px"}mouseupWindow(l,h){if(!this._active||l.button!==0)return;const y=this._startPos,v=h;if(this.reset(),x.suppressClick(),y.x!==v.x||y.y!==v.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:l})),{cameraAnimation:A=>A.fitScreenCoordinates(y,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,h){return this._map.fire(new s.k(l,{originalEvent:h}))}}function Gs(w,l){if(w.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${l.length}`);const h={};for(let y=0;y<w.length;y++)h[w[y].identifier]=l[y];return h}class Pp{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(v){const A=new s.P(0,0);for(const P of v)A._add(P);return A.div(v.length)}(h),this.touches=Gs(y,h)))}touchmove(l,h,y){if(this.aborted||!this.centroid)return;const v=Gs(y,h);for(const A in this.touches){const P=v[A];(!P||P.dist(this.touches[A])>30)&&(this.aborted=!0)}}touchend(l,h,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Ec{constructor(l){this.singleTap=new Pp(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,h,y){this.singleTap.touchstart(l,h,y)}touchmove(l,h,y){this.singleTap.touchmove(l,h,y)}touchend(l,h,y){const v=this.singleTap.touchend(l,h,y);if(v){const A=l.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(v)<30;if(A&&P||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class zp{constructor(l){this._tr=new ya(l),this._zoomIn=new Ec({numTouches:1,numTaps:2}),this._zoomOut=new Ec({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,h,y){this._zoomIn.touchstart(l,h,y),this._zoomOut.touchstart(l,h,y)}touchmove(l,h,y){this._zoomIn.touchmove(l,h,y),this._zoomOut.touchmove(l,h,y)}touchend(l,h,y){const v=this._zoomIn.touchend(l,h,y),A=this._zoomOut.touchend(l,h,y),P=this._tr;return v?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(v)},{originalEvent:l})}):A?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(A)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class va{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const h=this._moveFunction(...l);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(l,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,h){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const v=h.length?h[0]:h;return!this._moved&&v.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(y,v))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&x.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const hl={0:1,2:2};class Ho{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const h=x.mouseButton(l);this._eventButton=h}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(h,y){const v=hl[y];return h.buttons===void 0||(h.buttons&v)!==v}(l,this._eventButton)}isValidEndEvent(l){return x.mouseButton(l)===this._eventButton}}class Zt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const cu=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(l){l.preventDefault()}},ba=({enable:w,clickTolerance:l,bearingDegreesPerPixelMoved:h=.8})=>{const y=new Ho({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new va({clickTolerance:l,move:(v,A)=>({bearingDelta:(A.x-v.x)*h}),moveStateManager:y,enable:w,assignEvents:cu})},wa=({enable:w,clickTolerance:l,pitchDegreesPerPixelMoved:h=-.5})=>{const y=new Ho({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new va({clickTolerance:l,move:(v,A)=>({pitchDelta:(A.y-v.y)*h}),moveStateManager:y,enable:w,assignEvents:cu})};class Uh{constructor(l,h){this._clickTolerance=l.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,h,y){return this._calculateTransform(l,h,y)}touchmove(l,h,y){if(this._active&&!(y.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,h,y)}touchend(l,h,y){this._calculateTransform(l,h,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,h,y){y.length>0&&(this._active=!0);const v=Gs(y,h),A=new s.P(0,0),P=new s.P(0,0);let D=0;for(const Z in v){const ee=v[Z],te=this._touches[Z];te&&(A._add(ee),P._add(ee.sub(te)),D++,v[Z]=ee)}if(this._touches=v,D<this.minTouchs()||!P.mag())return;const $=P.div(D);return this._sum._add($),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(D),panDelta:$}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(l,h,y){if(!this._firstTwoTouches)return;l.preventDefault();const[v,A]=this._firstTwoTouches,P=xa(y,h,v),D=xa(y,h,A);if(!P||!D)return;const $=this._aroundCenter?null:P.add(D).div(2);return this._move([P,D],$,l)}touchend(l,h,y){if(!this._firstTwoTouches)return;const[v,A]=this._firstTwoTouches,P=xa(y,h,v),D=xa(y,h,A);P&&D||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function xa(w,l,h){for(let y=0;y<w.length;y++)if(w[y].identifier===h)return l[y]}function Vh(w,l){return Math.log(w/l)/Math.LN2}class qh extends Vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,h){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Vh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Vh(this._distance,y),pinchAround:h}}}function fu(w,l){return 180*w.angleWith(l)/Math.PI}class Lc extends Vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,h,y){const v=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fu(this._vector,v),pinchAround:h}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const h=25/(Math.PI*this._minDiameter)*360,y=fu(l,this._startVector);return Math.abs(y)<h}}function hu(w){return Math.abs(w.y)>Math.abs(w.x)}class Hh extends Vt{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,h,y){super.touchstart(l,h,y),this._currentTouchCount=y.length}_start(l){this._lastPoints=l,hu(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,h,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=l[0].sub(this._lastPoints[0]),A=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,A,y.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(v.y+A.y)/2*-.5}):void 0}gestureBeginsVertically(l,h,y){if(this._valid!==void 0)return this._valid;const v=l.mag()>=2,A=h.mag()>=2;if(!v&&!A)return;if(!v||!A)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const P=l.y>0==h.y>0;return hu(l)&&hu(h)&&P}}const Dp={panStep:100,bearingStep:15,pitchStep:10};class Ts{constructor(l){this._tr=new ya(l);const h=Dp;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let h=0,y=0,v=0,A=0,P=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?v=1:(l.preventDefault(),P=-1);break;case 40:l.shiftKey?v=-1:(l.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(y=0,v=0),{cameraAnimation:D=>{const $=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:Tr,zoom:h?Math.round($.zoom)+h*(l.shiftKey?2:1):$.zoom,bearing:$.bearing+y*this._bearingStep,pitch:$.pitch+v*this._pitchStep,offset:[-A*this._panStep,-P*this._panStep],center:$.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Tr(w){return w*(2-w)}const dl=4.000244140625;class du{constructor(l,h){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=l,this._tr=new ya(l),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let h=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=_.now(),v=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,h!==0&&h%dl==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=x.mousePos(this._map.getCanvas(),l),y=this._tr;this._around=h.y>y.transform.height/2-y.transform.getHorizon()?s.M.convert(this._aroundCenter?y.center:y.unproject(h)):s.M.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>dl?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&$!==0&&($=1/$);const Z=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(Z*$))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,y=this._startZoom,v=this._easing;let A,P=!1;if(this._type==="wheel"&&y&&v){const D=Math.min((_.now()-this._lastWheelEventTime)/200,1),$=v(D);A=s.z.number(y,h,$),D<1?this._frameId||(this._frameId=!0):P=!0}else A=h,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:A-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let h=s.b7;if(this._prevEase){const y=this._prevEase,v=(_.now()-y.start)/y.duration,A=y.easing(v+.01)-y.easing(v),P=.27/Math.sqrt(A*A+1e-4)*.01,D=Math.sqrt(.0729-P*P);h=s.b6(P,D,.25,1)}return this._prevEase={start:_.now(),duration:l,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ic{constructor(l,h){this._clickZoom=l,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Gh{constructor(l){this._tr=new ya(l),this.reset()}reset(){this._active=!1}dblclick(l,h){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wh{constructor(){this._tap=new Ec({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,h,y){if(!this._swipePoint)if(this._tapTime){const v=h[0],A=l.timeStamp-this._tapTime<500,P=this._tapPoint.dist(v)<30;A&&P?y.length>0&&(this._swipePoint=v,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(l,h,y)}touchmove(l,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const v=h[0],A=v.y-this._swipePoint.y;return this._swipePoint=v,l.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(l,h,y)}touchend(l,h,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const v=this._tap.touchend(l,h,y);v&&(this._tapTime=l.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zh{constructor(l,h,y){this._el=l,this._mousePan=h,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class So{constructor(l,h,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class pl{constructor(l,h,y,v){this._el=l,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class ln{constructor(l,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=x.create("div","maplibregl-cooperative-gesture-screen",l);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=h,this._container.appendChild(v);const A=document.createElement("div");A.className="maplibregl-mobile-message",A.textContent=y,this._container.appendChild(A),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(x.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const dn=w=>w.zoom||w.drag||w.pitch||w.rotate;class pu extends s.k{}function ml(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class Pc{constructor(l,h){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,A)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=v.type==="renderFrame"?void 0:v,D={needsRenderFrame:!1},$={},Z={},ee=v.touches,te=ee?this._getMapTouches(ee):void 0,me=te?x.touchPos(this._map.getCanvas(),te):x.mousePos(this._map.getCanvas(),v);for(const{handlerName:Me,handler:ve,allowed:Be}of this._handlers){if(!ve.isEnabled())continue;let tt;this._blockedByActive(Z,Be,Me)?ve.reset():ve[A||v.type]&&(tt=ve[A||v.type](v,me,te),this.mergeHandlerResult(D,$,tt,Me,P),tt&&tt.needsRenderFrame&&this._triggerRenderFrame()),(tt||ve.isActive())&&(Z[Me]=ve)}const Ae={};for(const Me in this._previousActiveHandlers)Z[Me]||(Ae[Me]=P);this._previousActiveHandlers=Z,(Object.keys(Ae).length||ml(D))&&(this._changes.push([D,$,Ae]),this._triggerRenderFrame()),(Object.keys(Z).length||ml(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:xe}=D;xe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],xe(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new jh(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,A,P]of this._listeners)x.addEventListener(v,A,v===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[l,h,y]of this._listeners)x.removeEventListener(l,h,l===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(l){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new Ao(h,l));const v=h.boxZoom=new ko(h,l);this._add("boxZoom",v),l.interactive&&l.boxZoom&&v.enable();const A=h.cooperativeGestures=new ln(h,l.cooperativeGestures);this._add("cooperativeGestures",A),l.cooperativeGestures&&A.enable();const P=new zp(h),D=new Gh(h);h.doubleClickZoom=new Ic(D,P),this._add("tapZoom",P),this._add("clickZoom",D),l.interactive&&l.doubleClickZoom&&h.doubleClickZoom.enable();const $=new Wh;this._add("tapDragZoom",$);const Z=h.touchPitch=new Hh(h);this._add("touchPitch",Z),l.interactive&&l.touchPitch&&h.touchPitch.enable(l.touchPitch);const ee=ba(l),te=wa(l);h.dragRotate=new So(l,ee,te),this._add("mouseRotate",ee,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]),l.interactive&&l.dragRotate&&h.dragRotate.enable();const me=(({enable:tt,clickTolerance:Ie})=>{const He=new Ho({checkCorrectEvent:rt=>x.mouseButton(rt)===0&&!rt.ctrlKey});return new va({clickTolerance:Ie,move:(rt,ot)=>({around:ot,panDelta:ot.sub(rt)}),activateOnStart:!0,moveStateManager:He,enable:tt,assignEvents:cu})})(l),Ae=new Uh(l,h);h.dragPan=new Zh(y,me,Ae),this._add("mousePan",me),this._add("touchPan",Ae,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&h.dragPan.enable(l.dragPan);const xe=new Lc,Me=new qh;h.touchZoomRotate=new pl(y,Me,xe,$),this._add("touchRotate",xe,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&h.touchZoomRotate.enable(l.touchZoomRotate);const ve=h.scrollZoom=new du(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ve,["mousePan"]),l.interactive&&l.scrollZoom&&h.scrollZoom.enable(l.scrollZoom);const Be=h.keyboard=new Ts(h);this._add("keyboard",Be),l.interactive&&l.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new qo(h))}_add(l,h,y){this._handlers.push({handlerName:l,handler:h,allowed:y}),this._handlersById[l]=h}stop(l){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!dn(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,h,y){for(const v in l)if(v!==y&&(!h||h.indexOf(v)<0))return!0;return!1}_getMapTouches(l){const h=[];for(const y of l)this._el.contains(y.target)&&h.push(y);return h}mergeHandlerResult(l,h,y,v,A){if(!y)return;s.e(l,y);const P={handlerName:v,originalEvent:y.originalEvent||A};y.zoomDelta!==void 0&&(h.zoom=P),y.panDelta!==void 0&&(h.drag=P),y.pitchDelta!==void 0&&(h.pitch=P),y.bearingDelta!==void 0&&(h.rotate=P)}_applyChanges(){const l={},h={},y={};for(const[v,A,P]of this._changes)v.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(l.around=v.around),v.pinchAround!==void 0&&(l.pinchAround=v.pinchAround),v.noInertia&&(l.noInertia=v.noInertia),s.e(h,A),s.e(y,P);this._updateMapTransform(l,h,y),this._changes=[]}_updateMapTransform(l,h,y){const v=this._map,A=v._getTransformForUpdate(),P=v.terrain;if(!(ml(l)||P&&this._terrainMovement))return this._fireEvents(h,y,!0);let{panDelta:D,zoomDelta:$,bearingDelta:Z,pitchDelta:ee,around:te,pinchAround:me}=l;me!==void 0&&(te=me),v._stop(!0),te=te||v.transform.centerPoint;const Ae=A.pointLocation(D?te.sub(D):te);Z&&(A.bearing+=Z),ee&&(A.pitch+=ee),$&&(A.zoom+=$),P?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?A.center=A.pointLocation(A.centerPoint.sub(D)):A.setLocationAtPoint(Ae,te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,A.setLocationAtPoint(Ae,te),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,A.recalculateZoom(v.terrain)})):A.setLocationAtPoint(Ae,te),v._applyUpdatedTransform(A),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,y,!0)}_fireEvents(l,h,y){const v=dn(this._eventsInProgress),A=dn(l),P={};for(const ee in l){const{originalEvent:te}=l[ee];this._eventsInProgress[ee]||(P[`${ee}start`]=te),this._eventsInProgress[ee]=l[ee]}!v&&A&&this._fireEvent("movestart",A.originalEvent);for(const ee in P)this._fireEvent(ee,P[ee]);A&&this._fireEvent("move",A.originalEvent);for(const ee in l){const{originalEvent:te}=l[ee];this._fireEvent(ee,te)}const D={};let $;for(const ee in this._eventsInProgress){const{handlerName:te,originalEvent:me}=this._eventsInProgress[ee];this._handlersById[te].isActive()||(delete this._eventsInProgress[ee],$=h[te]||me,D[`${ee}end`]=$)}for(const ee in D)this._fireEvent(ee,D[ee]);const Z=dn(this._eventsInProgress);if(y&&(v||A)&&!Z){this._updatingCamera=!0;const ee=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),te=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;!ee||!ee.essential&&_.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:$})),te(this._map.getBearing())&&this._map.resetNorth()):(te(ee.bearing||this._map.getBearing())&&(ee.bearing=0),ee.freezeElevation=!0,this._map.easeTo(ee,{originalEvent:$})),this._updatingCamera=!1}}_fireEvent(l,h){this._map.fire(new s.k(l,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new pu("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Oi extends s.E{constructor(l,h){super(),this._renderFrameCallback=()=>{const y=Math.min((_.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,h){return this.jumpTo({center:l},h)}panBy(l,h,y){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.e({offset:l},h),y)}panTo(l,h,y){return this.easeTo(s.e({center:l},h),y)}getZoom(){return this.transform.zoom}setZoom(l,h){return this.jumpTo({zoom:l},h),this}zoomTo(l,h,y){return this.easeTo(s.e({zoom:l},h),y)}zoomIn(l,h){return this.zoomTo(this.getZoom()+1,l,h),this}zoomOut(l,h){return this.zoomTo(this.getZoom()-1,l,h),this}getBearing(){return this.transform.bearing}setBearing(l,h){return this.jumpTo({bearing:l},h),this}getPadding(){return this.transform.padding}setPadding(l,h){return this.jumpTo({padding:l},h),this}rotateTo(l,h,y){return this.easeTo(s.e({bearing:l},h),y)}resetNorth(l,h){return this.rotateTo(0,s.e({duration:1e3},l),h),this}resetNorthPitch(l,h){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},l),h),this}snapToNorth(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this}getPitch(){return this.transform.pitch}setPitch(l,h){return this.jumpTo({pitch:l},h),this}cameraForBounds(l,h){l=Ge.convert(l);const y=h&&h.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),y,h)}_cameraForBoxAndBearing(l,h,y,v){const A={top:0,bottom:0,right:0,left:0};if(typeof(v=s.e({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const Ft=v.padding;v.padding={top:Ft,bottom:Ft,right:Ft,left:Ft}}v.padding=s.e(A,v.padding);const P=this.transform,D=P.padding,$=new Ge(l,h),Z=P.project($.getNorthWest()),ee=P.project($.getNorthEast()),te=P.project($.getSouthEast()),me=P.project($.getSouthWest()),Ae=s.b8(-y),xe=Z.rotate(Ae),Me=ee.rotate(Ae),ve=te.rotate(Ae),Be=me.rotate(Ae),tt=new s.P(Math.max(xe.x,Me.x,Be.x,ve.x),Math.max(xe.y,Me.y,Be.y,ve.y)),Ie=new s.P(Math.min(xe.x,Me.x,Be.x,ve.x),Math.min(xe.y,Me.y,Be.y,ve.y)),He=tt.sub(Ie),rt=(P.width-(D.left+D.right+v.padding.left+v.padding.right))/He.x,ot=(P.height-(D.top+D.bottom+v.padding.top+v.padding.bottom))/He.y;if(ot<0||rt<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ut=Math.min(P.scaleZoom(P.scale*Math.min(rt,ot)),v.maxZoom),kt=s.P.convert(v.offset),bt=new s.P((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(s.b8(y)),Rt=kt.add(bt).mult(P.scale/P.zoomScale(ut));return{center:P.unproject(Z.add(te).div(2).sub(Rt)),zoom:ut,bearing:y}}fitBounds(l,h,y){return this._fitInternal(this.cameraForBounds(l,h),h,y)}fitScreenCoordinates(l,h,y,v,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(l)),this.transform.pointLocation(s.P.convert(h)),y,v),v,A)}_fitInternal(l,h,y){return l?(delete(h=s.e(l,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this}jumpTo(l,h){this.stop();const y=this._getTransformForUpdate();let v=!1,A=!1,P=!1;return"zoom"in l&&y.zoom!==+l.zoom&&(v=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=s.M.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(A=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(P=!0,y.pitch=+l.pitch),l.padding==null||y.isPaddingEqual(l.padding)||(y.padding=l.padding),this._applyUpdatedTransform(y),this.fire(new s.k("movestart",h)).fire(new s.k("move",h)),v&&this.fire(new s.k("zoomstart",h)).fire(new s.k("zoom",h)).fire(new s.k("zoomend",h)),A&&this.fire(new s.k("rotatestart",h)).fire(new s.k("rotate",h)).fire(new s.k("rotateend",h)),P&&this.fire(new s.k("pitchstart",h)).fire(new s.k("pitch",h)).fire(new s.k("pitchend",h)),this.fire(new s.k("moveend",h))}calculateCameraOptionsFromTo(l,h,y,v=0){const A=s.Y.fromLngLat(l,h),P=s.Y.fromLngLat(y,v),D=P.x-A.x,$=P.y-A.y,Z=P.z-A.z,ee=Math.hypot(D,$,Z);if(ee===0)throw new Error("Can't calculate camera options with same From and To");const te=Math.hypot(D,$),me=this.transform.scaleZoom(this.transform.cameraToCenterDistance/ee/this.transform.tileSize),Ae=180*Math.atan2(D,-$)/Math.PI;let xe=180*Math.acos(te/ee)/Math.PI;return xe=Z<0?90-xe:90+xe,{center:P.toLngLat(),zoom:me,pitch:xe,bearing:Ae}}easeTo(l,h){var y;this._stop(!1,l.easeId),((l=s.e({offset:[0,0],duration:500,easing:s.b7},l)).animate===!1||!l.essential&&_.prefersReducedMotion)&&(l.duration=0);const v=this._getTransformForUpdate(),A=this.getZoom(),P=this.getBearing(),D=this.getPitch(),$=this.getPadding(),Z="bearing"in l?this._normalizeBearing(l.bearing,P):P,ee="pitch"in l?+l.pitch:D,te="padding"in l?l.padding:v.padding,me=s.P.convert(l.offset);let Ae=v.centerPoint.add(me);const xe=v.pointLocation(Ae),{center:Me,zoom:ve}=v.getConstrained(s.M.convert(l.center||xe),(y=l.zoom)!==null&&y!==void 0?y:A);this._normalizeCenter(Me);const Be=v.project(xe),tt=v.project(Me).sub(Be),Ie=v.zoomScale(ve-A);let He,rt;l.around&&(He=s.M.convert(l.around),rt=v.locationPoint(He));const ot={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ve!==A,this._rotating=this._rotating||P!==Z,this._pitching=this._pitching||ee!==D,this._padding=!v.isPaddingEqual(te),this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,ot),this.terrain&&this._prepareElevation(Me),this._ease(ut=>{if(this._zooming&&(v.zoom=s.z.number(A,ve,ut)),this._rotating&&(v.bearing=s.z.number(P,Z,ut)),this._pitching&&(v.pitch=s.z.number(D,ee,ut)),this._padding&&(v.interpolatePadding($,te,ut),Ae=v.centerPoint.add(me)),this.terrain&&!l.freezeElevation&&this._updateElevation(ut),He)v.setLocationAtPoint(He,rt);else{const kt=v.zoomScale(v.zoom-A),bt=ve>A?Math.min(2,Ie):Math.max(.5,Ie),Rt=Math.pow(bt,1-ut),Ft=v.unproject(Be.add(tt.mult(ut*Rt)).mult(kt));v.setLocationAtPoint(v.renderWorldCopies?Ft.wrap():Ft,Ae)}this._applyUpdatedTransform(v),this._fireMoveEvents(h)},ut=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,ut)},l),this}_prepareEase(l,h,y={}){this._moving=!0,h||y.moving||this.fire(new s.k("movestart",l)),this._zooming&&!y.zooming&&this.fire(new s.k("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new s.k("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new s.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&h!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(y-(h-(y*l+this._elevationStart))/(1-l)),this._elevationTarget=h}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const h=l.clone(),{center:y,zoom:v,pitch:A,bearing:P,elevation:D}=this.transformCameraUpdate(h);y&&(h.center=y),v!==void 0&&(h.zoom=v),A!==void 0&&(h.pitch=A),P!==void 0&&(h.bearing=P),D!==void 0&&(h.elevation=D),this.transform.apply(h)}_fireMoveEvents(l){this.fire(new s.k("move",l)),this._zooming&&this.fire(new s.k("zoom",l)),this._rotating&&this.fire(new s.k("rotate",l)),this._pitching&&this.fire(new s.k("pitch",l))}_afterEase(l,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const y=this._zooming,v=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new s.k("zoomend",l)),v&&this.fire(new s.k("rotateend",l)),A&&this.fire(new s.k("pitchend",l)),this.fire(new s.k("moveend",l))}flyTo(l,h){var y;if(!l.essential&&_.prefersReducedMotion){const Wn=s.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Wn,h)}this.stop(),l=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b7},l);const v=this._getTransformForUpdate(),A=this.getZoom(),P=this.getBearing(),D=this.getPitch(),$=this.getPadding(),Z="bearing"in l?this._normalizeBearing(l.bearing,P):P,ee="pitch"in l?+l.pitch:D,te="padding"in l?l.padding:v.padding,me=s.P.convert(l.offset);let Ae=v.centerPoint.add(me);const xe=v.pointLocation(Ae),{center:Me,zoom:ve}=v.getConstrained(s.M.convert(l.center||xe),(y=l.zoom)!==null&&y!==void 0?y:A);this._normalizeCenter(Me);const Be=v.zoomScale(ve-A),tt=v.project(xe),Ie=v.project(Me).sub(tt);let He=l.curve;const rt=Math.max(v.width,v.height),ot=rt/Be,ut=Ie.mag();if("minZoom"in l){const Wn=s.ac(Math.min(l.minZoom,A,ve),v.minZoom,v.maxZoom),kn=rt/v.zoomScale(Wn-A);He=Math.sqrt(kn/ut*2)}const kt=He*He;function bt(Wn){const kn=(ot*ot-rt*rt+(Wn?-1:1)*kt*kt*ut*ut)/(2*(Wn?ot:rt)*kt*ut);return Math.log(Math.sqrt(kn*kn+1)-kn)}function Rt(Wn){return(Math.exp(Wn)-Math.exp(-Wn))/2}function Ft(Wn){return(Math.exp(Wn)+Math.exp(-Wn))/2}const Cn=bt(!1);let $t=function(Wn){return Ft(Cn)/Ft(Cn+He*Wn)},_n=function(Wn){return rt*((Ft(Cn)*(Rt(kn=Cn+He*Wn)/Ft(kn))-Rt(Cn))/kt)/ut;var kn},Tn=(bt(!0)-Cn)/He;if(Math.abs(ut)<1e-6||!isFinite(Tn)){if(Math.abs(rt-ot)<1e-6)return this.easeTo(l,h);const Wn=ot<rt?-1:1;Tn=Math.abs(Math.log(ot/rt))/He,_n=function(){return 0},$t=function(kn){return Math.exp(Wn*He*kn)}}return l.duration="duration"in l?+l.duration:1e3*Tn/("screenSpeed"in l?+l.screenSpeed/He:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=P!==Z,this._pitching=ee!==D,this._padding=!v.isPaddingEqual(te),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(Me),this._ease(Wn=>{const kn=Wn*Tn,In=1/$t(kn);v.zoom=Wn===1?ve:A+v.scaleZoom(In),this._rotating&&(v.bearing=s.z.number(P,Z,Wn)),this._pitching&&(v.pitch=s.z.number(D,ee,Wn)),this._padding&&(v.interpolatePadding($,te,Wn),Ae=v.centerPoint.add(me)),this.terrain&&!l.freezeElevation&&this._updateElevation(Wn);const Rn=Wn===1?Me:v.unproject(tt.add(Ie.mult(_n(kn))).mult(In));v.setLocationAtPoint(v.renderWorldCopies?Rn.wrap():Rn,Ae),this._applyUpdatedTransform(v),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,h,y){y.animate===!1||y.duration===0?(l(1),h()):(this._easeStart=_.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,h){l=s.b1(l,-180,180);const y=Math.abs(l-h);return Math.abs(l-360-h)<y&&(l-=360),Math.abs(l+360-h)<y&&(l+=360),l}_normalizeCenter(l){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const y=l.lng-h.center.lng;l.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const zc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Co{constructor(l=zc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,h){const y=this._map._getUIString(`AttributionControl.${h}`);l.title=y,l.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style.sourceCaches;for(const v in h){const A=h[v];if(A.used||A.usedForTerrain){const P=A.getSource();P.attribution&&l.indexOf(P.attribution)<0&&l.push(P.attribution)}}l=l.filter(v=>String(v).trim()),l.sort((v,A)=>v.length-A.length),l=l.filter((v,A)=>{for(let P=A+1;P<l.length;P++)if(l[P].indexOf(v)>=0)return!1;return!0});const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Xh{constructor(l={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const y=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const h=x.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class gl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h}remove(l){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const v of y)if(v.id===l)return void(v.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Fr=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class qr extends s.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,h){this.sourceCache.update(l,h),this._renderableTilesKeys=[];const y={};for(const v of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))y[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),s.aN(v.posMatrix,0,s.W,0,s.W,0,1),this._tiles[v.key]=new mr(v,this.tileSize));for(const v in this._tiles)y[v]||delete this._tiles[v]}freeRtt(l){for(const h in this._tiles){const y=this._tiles[h];(!l||y.tileID.equals(l)||y.tileID.isChildOf(l)||l.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const h={};for(const y of this._renderableTilesKeys){const v=this._tiles[y].tileID;if(v.canonical.equals(l.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16),s.aN(A.posMatrix,0,s.W,0,s.W,0,1),h[y]=A}else if(v.canonical.isChildOf(l.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16);const P=v.canonical.z-l.canonical.z,D=v.canonical.x-(v.canonical.x>>P<<P),$=v.canonical.y-(v.canonical.y>>P<<P),Z=s.W>>P;s.aN(A.posMatrix,0,Z,0,Z,0,1),s.H(A.posMatrix,A.posMatrix,[-D*Z,-$*Z,0]),h[y]=A}else if(l.canonical.isChildOf(v.canonical)){const A=l.clone();A.posMatrix=new Float64Array(16);const P=l.canonical.z-v.canonical.z,D=l.canonical.x-(l.canonical.x>>P<<P),$=l.canonical.y-(l.canonical.y>>P<<P),Z=s.W>>P;s.aN(A.posMatrix,0,s.W,0,s.W,0,1),s.H(A.posMatrix,A.posMatrix,[D*Z,$*Z,0]),s.J(A.posMatrix,A.posMatrix,[1/2**P,1/2**P,0]),h[y]=A}}return h}getSourceTile(l,h){const y=this.sourceCache._source;let v=l.overscaledZ-this.deltaZoom;if(v>y.maxzoom&&(v=y.maxzoom),v<y.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(v).key);let A=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!A||!A.dem)&&h)for(;v>=y.minzoom&&(!A||!A.dem);)A=this.sourceCache.getTileByID(l.scaledTo(v--).key);return A}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=l)}}class Kh{constructor(l,h,y){this.painter=l,this.sourceCache=new qr(h),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,h,y,v=s.W){var A;if(!(h>=0&&h<v&&y>=0&&y<v))return 0;const P=this.getTerrainData(l),D=(A=P.tile)===null||A===void 0?void 0:A.dem;if(!D)return 0;const $=function(xe,Me,ve){var Be=Me[0],tt=Me[1];return xe[0]=ve[0]*Be+ve[4]*tt+ve[12],xe[1]=ve[1]*Be+ve[5]*tt+ve[13],xe}([],[h/v*s.W,y/v*s.W],P.u_terrain_matrix),Z=[$[0]*D.dim,$[1]*D.dim],ee=Math.floor(Z[0]),te=Math.floor(Z[1]),me=Z[0]-ee,Ae=Z[1]-te;return D.get(ee,te)*(1-me)*(1-Ae)+D.get(ee+1,te)*me*(1-Ae)+D.get(ee,te+1)*(1-me)*Ae+D.get(ee+1,te+1)*me*Ae}getElevationForLngLatZoom(l,h){const{tileID:y,mercatorX:v,mercatorY:A}=this._getOverscaledTileIDFromLngLatZoom(l,h);return this.getElevation(y,v%s.W,A%s.W,s.W)}getElevation(l,h,y,v=s.W){return this.getDEMElevation(l,h,y,v)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const v=this.painter.context,A=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Y(v,A,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Y(v,new s.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const h=this.sourceCache.getSourceTile(l,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const v=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new Y(v,h.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),h.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const y=h&&h+h.tileID.key+l.key;if(y&&!this._demMatrixCache[y]){const v=this.sourceCache.sourceCache._source.maxzoom;let A=l.canonical.z-h.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=v?A=l.canonical.z-v:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=l.canonical.x-(l.canonical.x>>A<<A),D=l.canonical.y-(l.canonical.y>>A<<A),$=s.b9(new Float64Array(16),[1/(s.W<<A),1/(s.W<<A),0]);s.H($,$,[P*s.W,D*s.W,0]),this._demMatrixCache[l.key]={matrix:$,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(l){const h=this.painter,y=h.width/devicePixelRatio,v=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Y(h.context,{width:y,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Y(h.context,{width:y,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(y,v,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,y,v))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let A=0,P=0;A<this._coordsTextureSize;A++)for(let D=0;D<this._coordsTextureSize;D++,P+=4)h[P+0]=255&D,h[P+1]=255&A,h[P+2]=D>>8<<4|A>>8,h[P+3]=0;const y=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),v=new Y(l,y,l.gl.RGBA,{premultiply:!1});return v.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),y=this.painter.context,v=y.gl,A=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),P=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(A,D-P-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),y.bindFramebuffer.set(null);const $=h[0]+(h[2]>>4<<8),Z=h[1]+((15&h[2])<<8),ee=this.coordsIndex[255-h[3]],te=ee&&this.sourceCache.getTileByID(ee);if(!te)return null;const me=this._coordsTextureSize,Ae=(1<<te.tileID.canonical.z)*me;return new s.Y((te.tileID.canonical.x*me+$)/Ae+te.tileID.wrap,(te.tileID.canonical.y*me+Z)/Ae,this.getElevation(te.tileID,$,Z,me))}depthAtPoint(l){const h=new Uint8Array(4),y=this.painter.context,v=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),y.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,h=new s.ba,y=new s.aX,v=this.meshSize,A=s.W/v,P=v*v;for(let te=0;te<=v;te++)for(let me=0;me<=v;me++)h.emplaceBack(me*A,te*A,0);for(let te=0;te<P;te+=v+1)for(let me=0;me<v;me++)y.emplaceBack(me+te,v+me+te+1,v+me+te+2),y.emplaceBack(me+te,v+me+te+2,me+te+1);const D=h.length,$=D+2*(v+1);for(const te of[0,1])for(let me=0;me<=v;me++)for(const Ae of[0,1])h.emplaceBack(me*A,te*s.W,Ae);for(let te=0;te<2*v;te+=2)y.emplaceBack($+te,$+te+1,$+te+3),y.emplaceBack($+te,$+te+3,$+te+2),y.emplaceBack(D+te,D+te+3,D+te+1),y.emplaceBack(D+te,D+te+2,D+te+3);const Z=h.length,ee=Z+2*(v+1);for(const te of[0,1])for(let me=0;me<=v;me++)for(const Ae of[0,1])h.emplaceBack(te*s.W,me*A,Ae);for(let te=0;te<2*v;te+=2)y.emplaceBack(Z+te,Z+te+1,Z+te+3),y.emplaceBack(Z+te,Z+te+3,Z+te+2),y.emplaceBack(ee+te,ee+te+3,ee+te+1),y.emplaceBack(ee+te,ee+te+2,ee+te+3);return this._mesh={indexBuffer:l.createIndexBuffer(y),vertexBuffer:l.createVertexBuffer(h,Fr.members),segments:s.$.simpleSegment(0,0,h.length,y.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*s.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,h){var y;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(l,h);return(y=this.getMinMaxElevation(v).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(l){const h=this.getTerrainData(l).tile,y={minElevation:null,maxElevation:null};return h&&h.dem&&(y.minElevation=h.dem.min*this.exaggeration,y.maxElevation=h.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(l,h){const y=s.Y.fromLngLat(l.wrap()),v=(1<<h)*s.W,A=y.x*v,P=y.y*v,D=Math.floor(A/s.W),$=Math.floor(P/s.W);return{tileID:new s.Q(h,0,h,D,$),mercatorX:A,mercatorY:P}}}class _l{constructor(l,h,y){this._context=l,this._size=h,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new Y(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(y.texture),{id:l,fbo:h,texture:y,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>l.id!==h),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const as={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Dc{constructor(l,h){this.painter=l,this.terrain=h,this.pool=new _l(l.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(y=>!l._layers[y].isHidden(h)),this._coordsDescendingInv={};for(const y in l.sourceCaches){this._coordsDescendingInv[y]={};const v=l.sourceCaches[y].getVisibleCoordinates();for(const A of v){const P=this.terrain.sourceCache.getTerrainCoords(A);for(const D in P)this._coordsDescendingInv[y][D]||(this._coordsDescendingInv[y][D]=[]),this._coordsDescendingInv[y][D].push(P[D])}}this._coordsDescendingInvStr={};for(const y of l._order){const v=l._layers[y],A=v.source;if(as[v.type]&&!this._coordsDescendingInvStr[A]){this._coordsDescendingInvStr[A]={};for(const P in this._coordsDescendingInv[A])this._coordsDescendingInvStr[A][P]=this._coordsDescendingInv[A][P].map(D=>D.key).sort().join()}}for(const y of this._renderableTiles)for(const v in this._coordsDescendingInvStr){const A=this._coordsDescendingInvStr[v][y.tileID.key];A&&A!==y.rttCoords[v]&&(y.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const h=l.type,y=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(as[h]&&(this._prevType&&as[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(l.id),!v))return!0;if(as[this._prevType]||as[h]&&v){this._prevType=h;const A=this._stacks.length-1,P=this._stacks[A]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(lu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[A]){const Z=this.pool.getObjectForId(D.rtt[A].id);if(Z.stamp===D.rtt[A].stamp){this.pool.useObject(Z);continue}}const $=this.pool.getOrCreateFreeObject();this.pool.useObject($),this.pool.stampObject($),D.rtt[A]={id:$.id,stamp:$.stamp},y.context.bindFramebuffer.set($.fbo.framebuffer),y.context.clear({color:s.aO.transparent,stencil:0}),y.currentStencilSource=void 0;for(let Z=0;Z<P.length;Z++){const ee=y.style._layers[P[Z]],te=ee.source?this._coordsDescendingInv[ee.source][D.tileID.key]:[D.tileID];y.context.viewport.set([0,0,$.fbo.width,$.fbo.height]),y._renderTileClippingMasks(ee,te),y.renderLayer(y,y.style.sourceCaches[ee.source],ee,te),ee.source&&(D.rttCoords[ee.source]=this._coordsDescendingInvStr[ee.source][D.tileID.key])}}return lu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),as[h]}return!1}}const Rc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use â + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Bc=d,yl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:zc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},mu=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},Fc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Oc{constructor(l,h,y=!1){this.mousedown=P=>{this.startMouse(s.e({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),x.mousePos(this.element,P)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,x.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const v=l.dragRotate._mouseRotate.getClickTolerance(),A=l.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=ba({clickTolerance:v,enable:!0}),this.touchRotate=(({enable:P,clickTolerance:D,bearingDegreesPerPixelMoved:$=.8})=>{const Z=new Zt;return new va({clickTolerance:D,move:(ee,te)=>({bearingDelta:(te.x-ee.x)*$}),moveStateManager:Z,enable:P,assignEvents:mu})})({clickTolerance:v,enable:!0}),this.map=l,y&&(this.mousePitch=wa({clickTolerance:A,enable:!0}),this.touchPitch=(({enable:P,clickTolerance:D,pitchDegreesPerPixelMoved:$=-.5})=>{const Z=new Zt;return new va({clickTolerance:D,move:(ee,te)=>({pitchDelta:(te.y-ee.y)*$}),moveStateManager:Z,enable:P,assignEvents:mu})})({clickTolerance:A,enable:!0})),x.addEventListener(h,"mousedown",this.mousedown),x.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(h,"touchcancel",this.reset)}startMouse(l,h){this.mouseRotate.dragStart(l,h),this.mousePitch&&this.mousePitch.dragStart(l,h),x.disableDrag()}startTouch(l,h){this.touchRotate.dragStart(l,h),this.touchPitch&&this.touchPitch.dragStart(l,h),x.disableDrag()}moveMouse(l,h){const y=this.map,{bearingDelta:v}=this.mouseRotate.dragMove(l,h)||{};if(v&&y.setBearing(y.getBearing()+v),this.mousePitch){const{pitchDelta:A}=this.mousePitch.dragMove(l,h)||{};A&&y.setPitch(y.getPitch()+A)}}moveTouch(l,h){const y=this.map,{bearingDelta:v}=this.touchRotate.dragMove(l,h)||{};if(v&&y.setBearing(y.getBearing()+v),this.touchPitch){const{pitchDelta:A}=this.touchPitch.dragMove(l,h)||{};A&&y.setPitch(y.getPitch()+A)}}off(){const l=this.element;x.removeEventListener(l,"mousedown",this.mousedown),x.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let ls;function gu(w,l,h){const y=new s.M(w.lng,w.lat);if(w=new s.M(w.lng,w.lat),l){const v=new s.M(w.lng-360,w.lat),A=new s.M(w.lng+360,w.lat),P=h.locationPoint(w).distSqr(l);h.locationPoint(v).distSqr(l)<P?w=v:h.locationPoint(A).distSqr(l)<P&&(w=A)}for(;Math.abs(w.lng-h.center.lng)>180;){const v=h.locationPoint(w);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;w.lng>h.center.lng?w.lng-=360:w.lng+=360}return w.lng!==y.lng&&h.locationPoint(w).y>h.height/2-h.getHorizon()?w:y}const vl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function _u(w,l,h){const y=w.classList;for(const v in vl)y.remove(`maplibregl-${h}-anchor-${v}`);y.add(`maplibregl-${h}-anchor-${l}`)}class bl extends s.E{constructor(l){if(super(),this._onKeyPress=h=>{const y=h.code,v=h.charCode||h.keyCode;y!=="Space"&&y!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=h=>{const y=h.originalEvent.target,v=this._element;this._popup&&(y===v||v.contains(y))&&this.togglePopup()},this._update=h=>{var y;if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?gu(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let A="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?A=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(A=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${vl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${A}`),_.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const h=x.createNS("http://www.w3.org/2000/svg","svg"),y=41,v=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${y}px`),h.setAttributeNS(null,"width",`${v}px`),h.setAttributeNS(null,"viewBox",`0 0 ${v} ${y}`);const A=x.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"stroke","none"),A.setAttributeNS(null,"stroke-width","1"),A.setAttributeNS(null,"fill","none"),A.setAttributeNS(null,"fill-rule","evenodd");const P=x.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const D=x.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const $=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Be of $){const tt=x.createNS("http://www.w3.org/2000/svg","ellipse");tt.setAttributeNS(null,"opacity","0.04"),tt.setAttributeNS(null,"cx","10.5"),tt.setAttributeNS(null,"cy","5.80029008"),tt.setAttributeNS(null,"rx",Be.rx),tt.setAttributeNS(null,"ry",Be.ry),D.appendChild(tt)}const Z=x.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill",this._color);const ee=x.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Z.appendChild(ee);const te=x.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"fill","#000000");const me=x.createNS("http://www.w3.org/2000/svg","path");me.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),te.appendChild(me);const Ae=x.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");const xe=x.createNS("http://www.w3.org/2000/svg","g");xe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=x.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const ve=x.createNS("http://www.w3.org/2000/svg","circle");ve.setAttributeNS(null,"fill","#FFFFFF"),ve.setAttributeNS(null,"cx","5.5"),ve.setAttributeNS(null,"cy","5.5"),ve.setAttributeNS(null,"r","5.4999962"),xe.appendChild(Me),xe.appendChild(ve),P.appendChild(D),P.appendChild(Z),P.appendChild(te),P.appendChild(Ae),P.appendChild(xe),h.appendChild(P),h.setAttributeNS(null,"height",y*this._scale+"px"),h.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(h),this._offset=s.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),_u(this._element,this._anchor,"marker"),l&&l.className)for(const h of l.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const v=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var h,y;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const v=this._map,A=v.terrain.depthAtPoint(this._pos),P=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,P)-A<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/v.transform._pixelPerMeter,$=Math.sin(v.getPitch()*Math.PI/180)*D,Z=v.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),ee=v.transform.lngLatToCameraDepth(this._lngLat,P+$)-Z>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&ee&&this._popup.remove(),this._element.style.opacity=ee?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,h){return l===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const yu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Aa=0,Ws=!1;const vu={maxWidth:100,unit:"metric"};function bu(w,l,h){const y=h&&h.maxWidth||100,v=w._container.clientHeight/2,A=w.unproject([0,v]),P=w.unproject([y,v]),D=A.distanceTo(P);if(h&&h.unit==="imperial"){const $=3.2808*D;$>5280?Zs(l,y,$/5280,w._getUIString("ScaleControl.Miles")):Zs(l,y,$,w._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Zs(l,y,D/1852,w._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Zs(l,y,D/1e3,w._getUIString("ScaleControl.Kilometers")):Zs(l,y,D,w._getUIString("ScaleControl.Meters"))}function Zs(w,l,h,y){const v=function(A){const P=Math.pow(10,`${Math.floor(A)}`.length-1);let D=A/P;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function($){const Z=Math.pow(10,Math.ceil(-Math.log($)/Math.LN10));return Math.round($*Z)/Z}(D),P*D}(h);w.style.width=l*(v/h)+"px",w.innerHTML=`${v}&nbsp;${y}`}const $c={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Nc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wu(w){if(w){if(typeof w=="number"){const l=Math.round(Math.abs(w)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,w),"top-left":new s.P(l,l),"top-right":new s.P(-l,l),bottom:new s.P(0,-w),"bottom-left":new s.P(l,-l),"bottom-right":new s.P(-l,-l),left:new s.P(w,0),right:new s.P(-w,0)}}if(w instanceof s.P||Array.isArray(w)){const l=s.P.convert(w);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:s.P.convert(w.center||[0,0]),top:s.P.convert(w.top||[0,0]),"top-left":s.P.convert(w["top-left"]||[0,0]),"top-right":s.P.convert(w["top-right"]||[0,0]),bottom:s.P.convert(w.bottom||[0,0]),"bottom-left":s.P.convert(w["bottom-left"]||[0,0]),"bottom-right":s.P.convert(w["bottom-right"]||[0,0]),left:s.P.convert(w.left||[0,0]),right:s.P.convert(w.right||[0,0])}}return wu(new s.P(0,0))}const Jh=d;u.AJAXError=s.be,u.Evented=s.E,u.LngLat=s.M,u.MercatorCoordinate=s.Y,u.Point=s.P,u.addProtocol=s.bf,u.config=s.a,u.removeProtocol=s.bg,u.AttributionControl=Co,u.BoxZoomHandler=ko,u.CanvasSource=jn,u.CooperativeGesturesHandler=ln,u.DoubleClickZoomHandler=Ic,u.DragPanHandler=Zh,u.DragRotateHandler=So,u.EdgeInsets=_a,u.FullscreenControl=class extends s.E{constructor(w={}){super(),this._onFullscreenChange=()=>{var l;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=h==null?void 0:h.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Xe,u.GeolocateControl=class extends s.E{constructor(w){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const h=new s.M(l.coords.longitude,l.coords.latitude),y=l.coords.accuracy,v=this._map.getBearing(),A=s.e({bearing:v},this.options.fitBoundsOptions),P=Ge.fromLngLat(h,y);this._map.fitBounds(P,A,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const h=new s.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Ws)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new bl({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new bl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},yu,w)}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return s._(this,arguments,void 0,function*(l=!1){if(ls!==void 0&&!l)return ls;if(window.navigator.permissions===void 0)return ls=!!window.navigator.geolocation,ls;try{ls=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ls=!!window.navigator.geolocation}return ls})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Aa=0,Ws=!1}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),h=w.coords;return l&&(h.longitude<l.getWest()||h.longitude>l.getEast()||h.latitude<l.getSouth()||h.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),l=w.getSouthEast(),h=w.getNorthEast(),y=l.distanceTo(h),v=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Aa--,Ws=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Aa++,Aa>1?(w={maximumAge:6e5,timeout:0},Ws=!0):(w=this.options.positionOptions,Ws=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Tc,u.ImageSource=Ut,u.KeyboardHandler=Ts,u.LngLatBounds=Ge,u.LogoControl=Xh,u.Map=class extends Oi{constructor(w){if(s.bc.mark(s.bd.create),(w=s.e({},yl,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new uu(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new gl,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},Rc,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=O.addThrottleControl(()=>this.isMoving()),this._requestManager=new B(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const h=Cc(y=>{this._trackResize&&!this._removed&&this.resize(y)._update()},50);this._resizeObserver=new ResizeObserver(y=>{l?h(y):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Pc(this,w),this._hash=w.hash&&new Tc(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,s.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new Co(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new Xh,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new s.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(w,l){if(l===void 0&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=w.onAdd(this);this._controls.push(w);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,l,h,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,l,h,y)}resize(w){var l;const h=this._containerDimensions(),y=h[0],v=h[1],A=this._getClampedPixelRatio(y,v);if(this._resizeCanvas(y,v,A),this.painter.resize(y,v,A),this.painter.overLimit()){const D=this.painter.context.gl;this._maxCanvasSize=[D.drawingBufferWidth,D.drawingBufferHeight];const $=this._getClampedPixelRatio(y,v);this._resizeCanvas(y,v,$),this.painter.resize(y,v,$)}this.transform.resize(y,v),(l=this._requestedCameraState)===null||l===void 0||l.resize(y,v);const P=!this._moving;return P&&(this.stop(),this.fire(new s.k("movestart",w)).fire(new s.k("move",w))),this.fire(new s.k("resize",w)),P&&this.fire(new s.k("moveend",w)),this}_getClampedPixelRatio(w,l){const{0:h,1:y}=this._maxCanvasSize,v=this.getPixelRatio(),A=w*v,P=l*v;return Math.min(A>h?h/A:1,P>y?y/P:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(Ge.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(s.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(s.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,l,h){if(w==="mouseenter"||w==="mouseover"){let y=!1;return{layer:l,listener:h,delegates:{mousemove:A=>{const P=this.getLayer(l)?this.queryRenderedFeatures(A.point,{layers:[l]}):[];P.length?y||(y=!0,h.call(this,new Fi(w,this,A.originalEvent,{features:P}))):y=!1},mouseout:()=>{y=!1}}}}if(w==="mouseleave"||w==="mouseout"){let y=!1;return{layer:l,listener:h,delegates:{mousemove:P=>{(this.getLayer(l)?this.queryRenderedFeatures(P.point,{layers:[l]}):[]).length?y=!0:y&&(y=!1,h.call(this,new Fi(w,this,P.originalEvent)))},mouseout:P=>{y&&(y=!1,h.call(this,new Fi(w,this,P.originalEvent)))}}}}{const y=v=>{const A=this.getLayer(l)?this.queryRenderedFeatures(v.point,{layers:[l]}):[];A.length&&(v.features=A,h.call(this,v),delete v.features)};return{layer:l,listener:h,delegates:{[w]:y}}}}on(w,l,h){if(h===void 0)return super.on(w,l);const y=this._createDelegatedListener(w,l,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(y);for(const v in y.delegates)this.on(v,y.delegates[v]);return this}once(w,l,h){if(h===void 0)return super.once(w,l);const y=this._createDelegatedListener(w,l,h);for(const v in y.delegates)this.once(v,y.delegates[v]);return this}off(w,l,h){return h===void 0?super.off(w,l):(this._delegatedListeners&&this._delegatedListeners[w]&&(y=>{const v=this._delegatedListeners[w];for(let A=0;A<v.length;A++){const P=v[A];if(P.layer===l&&P.listener===h){for(const D in P.delegates)this.off(D,P.delegates[D]);return v.splice(A,1),this}}})(),this)}queryRenderedFeatures(w,l){if(!this.style)return[];let h;const y=w instanceof s.P||Array.isArray(w),v=y?w:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(y?{}:w)||{},v instanceof s.P||typeof v[0]=="number")h=[s.P.convert(v)];else{const A=s.P.convert(v[0]),P=s.P.convert(v[1]);h=[A,new s.P(P.x,A.y),P,new s.P(A.x,P.y),A]}return this.style.queryRenderedFeatures(h,l,this.transform)}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}setStyle(w,l){return(l=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(w,l))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const l=this._locale[w];if(l==null)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,l));const h=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new Qi(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,l,h):this.style.loadJSON(w,l,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Qi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if(typeof w=="string"){const h=this._requestManager.transformRequest(w,"Style");s.h(h,new AbortController).then(y=>{this._updateDiff(y.data,l)}).catch(y=>{y&&this.fire(new s.j(y))})}else typeof w=="object"&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w,l)&&this._update(!0)}catch(h){s.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){const l=this.style&&this.style.sourceCaches[w];if(l!==void 0)return l.loaded();this.fire(new s.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const l=this.style.sourceCaches[w.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&l.reload();for(const h in this.style._layers){const y=this.style._layers[h];y.type==="hillshade"&&y.source===w.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Kh(this.painter,l,w),this.painter.renderToTexture=new Dc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:w})),this}getTerrain(){var w,l;return(l=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const l in w){const h=w[l]._tiles;for(const y in h){const v=h[y];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l,h={}){const{pixelRatio:y=1,sdf:v=!1,stretchX:A,stretchY:P,content:D}=h;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||s.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:$,height:Z,data:ee}=l,te=l;return this.style.addImage(w,{data:new s.R({width:$,height:Z},new Uint8Array(ee)),pixelRatio:y,stretchX:A,stretchY:P,content:D,sdf:v,version:0,userImage:te}),te.onAdd&&te.onAdd(this,w),this}}{const{width:$,height:Z,data:ee}=_.getImageData(l);this.style.addImage(w,{data:new s.R({width:$,height:Z},ee),pixelRatio:y,stretchX:A,stretchY:P,content:D,sdf:v,version:0})}}updateImage(w,l){const h=this.style.getImage(w);if(!h)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||s.b(l)?_.getImageData(l):l,{width:v,height:A,data:P}=y;if(v===void 0||A===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||A!==h.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(l instanceof HTMLImageElement||s.b(l));return h.data.replace(P,D),this.style.updateImage(w,h),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return O.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,l,h){return this.style.setLayerZoomRange(w,l,h),this._update(!0)}setFilter(w,l,h={}){return this.style.setFilter(w,l,h),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,h,y={}){return this.style.setPaintProperty(w,l,h,y),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,h,y={}){return this.style.setLayoutProperty(w,l,h,y),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setGlyphs(w,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,l,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,l,h,y=>{y||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,l,h=>{h||this._update(!0)}),this}setLight(w,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,l=0;return this._container&&(w=this._container.clientWidth||400,l=this._container.clientHeight||300),[w,l]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const l=this._canvasContainer=x.create("div","maplibregl-canvas-container",w);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),y=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],y);const v=this._controlContainer=x.create("div","maplibregl-control-container",w),A=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(P=>{A[P]=x.create("div",`maplibregl-ctrl-${P} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,l,h){this._canvas.width=Math.floor(h*w),this._canvas.height=Math.floor(h*l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{l={requestedAttributes:w},y&&(l.statusMessage=y.statusMessage,l.type=y.type)},{once:!0});const h=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!h){const y="Failed to initialize WebGL";throw l?(l.message=y,new Error(JSON.stringify(l))):new Error(y)}this.painter=new Fh(h,this.transform),C.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,A=_.now();this.style.zoomHistory.update(v,A);const P=new s.a8(v,{now:A,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=P.crossFadingFactor();D===1&&D===this._crossFadingFactor||(h=!0,this._crossFadingFactor=D),this.style.update(P)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bc.mark(s.bd.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,s.bc.mark(s.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),O.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bc.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(w=>{s.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return Bc}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=Fi,u.MapTouchEvent=Vo,u.MapWheelEvent=Mc,u.Marker=bl,u.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const l=this._map.getZoom(),h=l===this._map.getMaxZoom(),y=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,h)=>{const y=this._map._getUIString(`NavigationControl.${h}`);l.title=y,l.setAttribute("aria-label",y)},this.options=s.e({},Fc,w),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Oc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,l){const h=x.create("button",w,this._container);return h.type="button",h.addEventListener("click",l),h}},u.Popup=class extends s.E{constructor(w){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?gu(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!l)return;const y=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let v=this.options.anchor;const A=wu(this.options.offset);if(!v){const D=this._container.offsetWidth,$=this._container.offsetHeight;let Z;Z=y.y+A.bottom.y<$?["top"]:y.y>this._map.transform.height-$?["bottom"]:[],y.x<D/2?Z.push("left"):y.x>this._map.transform.width-D/2&&Z.push("right"),v=Z.length===0?"bottom":Z.join("-")}let P=y.add(A[v]);this.options.subpixelPositioning||(P=P.round()),x.setTransform(this._container,`${vl[v]} translate(${P.x}px,${P.y}px)`),_u(this._container,v,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create($c),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=s.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const l=document.createDocumentFragment(),h=document.createElement("body");let y;for(h.innerHTML=w;y=h.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(Nc);w&&w.focus()}},u.RasterDEMTileSource=en,u.RasterTileSource=de,u.ScaleControl=class{constructor(w){this._onMove=()=>{bu(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,bu(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},vu),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=du,u.Style=Qi,u.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=Hh,u.TwoFingersTouchRotateHandler=Lc,u.TwoFingersTouchZoomHandler=qh,u.TwoFingersTouchZoomRotateHandler=pl,u.VectorTileSource=et,u.VideoSource=Hn,u.addSourceType=(w,l)=>s._(void 0,void 0,void 0,function*(){if(Wt(w))throw new Error(`A source type called "${w}" already exists.`);((h,y)=>{Nn[h]=y})(w,l)}),u.clearPrewarmedResources=function(){const w=xt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(dt),xt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return yt().getRTLTextPluginStatus()},u.getVersion=function(){return Jh},u.getWorkerCount=function(){return pt.workerCount},u.getWorkerUrl=function(){return s.a.WORKER_URL},u.importScriptInWorkers=function(w){return nn().broadcast("IS",w)},u.prewarm=function(){Ot().acquire(dt)},u.setMaxParallelImageRequests=function(w){s.a.MAX_PARALLEL_IMAGE_REQUESTS=w},u.setRTLTextPlugin=function(w,l){return yt().setRTLTextPlugin(w,l)},u.setWorkerCount=function(w){pt.workerCount=w},u.setWorkerUrl=function(w){s.a.WORKER_URL=w}});var o=t;return o})})(uw);var oa=uw.exports;const Qr=lw(oa),bk=JA({__proto__:null,default:Qr},[oa]);let un;const fw=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&fw.decode();let bf=null;function Tf(){return(bf===null||bf.byteLength===0)&&(bf=new Uint8Array(un.memory.buffer)),bf}function Ko(r,e){return r=r>>>0,fw.decode(Tf().subarray(r,r+e))}const ra=new Array(128).fill(void 0);ra.push(void 0,null,!0,!1);let Mf=ra.length;function Yr(r){Mf===ra.length&&ra.push(ra.length+1);const e=Mf;return Mf=ra[e],ra[e]=r,e}function Zn(r){return ra[r]}function wk(r){r<132||(ra[r]=Mf,Mf=r)}function Vu(r){const e=Zn(r);return wk(r),e}function xm(r){return r==null}let wf=null;function xk(){return(wf===null||wf.byteLength===0)&&(wf=new Float64Array(un.memory.buffer)),wf}let xf=null;function tr(){return(xf===null||xf.byteLength===0)&&(xf=new Int32Array(un.memory.buffer)),xf}let Da=0;const zd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},Ak=typeof zd.encodeInto=="function"?function(r,e){return zd.encodeInto(r,e)}:function(r,e){const t=zd.encode(r);return e.set(t),{read:r.length,written:t.length}};function wd(r,e,t){if(t===void 0){const s=zd.encode(r),d=e(s.length,1)>>>0;return Tf().subarray(d,d+s.length).set(s),Da=s.length,d}let n=r.length,i=e(n,1)>>>0;const o=Tf();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Tf().subarray(i+u,i+n),d=Ak(r,s);u+=d.written}return Da=u,i}function Um(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Um(r[0]));for(let u=1;u<i;u++)o+=", "+Um(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function kk(r,e){const t=e(r.length*1,1)>>>0;return Tf().set(r,t/1),Da=r.length,t}function Am(r,e){try{return r.apply(this,e)}catch(t){un.__wbindgen_exn_store(Yr(t))}}class Gd{static __wrap(e){e=e>>>0;const t=Object.create(Gd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();un.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=un.__wbindgen_add_to_stack_pointer(-16),u=kk(e,un.__wbindgen_malloc),s=Da;un.jsroutesnapper_new(o,u,s);var t=tr()[o/4+0],n=tr()[o/4+1],i=tr()[o/4+2];if(i)throw Vu(n);return Gd.__wrap(t)}finally{un.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){un.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Yr(e))}setAreaMode(){un.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=tr()[o/4+0],i=tr()[o/4+1];return e=n,t=i,Ko(n,i)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=tr()[n/4+0],t=tr()[n/4+1];let i;return e!==0&&(i=Ko(e,t).slice(),un.__wbindgen_free(e,t*1)),i}finally{un.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=tr()[o/4+0],i=tr()[o/4+1];return e=n,t=i,Ko(n,i)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,t,1)}}toggleSnapMode(){un.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return un.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){un.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return un.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return un.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){un.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_editExisting(i,this.__wbg_ptr,Yr(e));var t=tr()[i/4+0],n=tr()[i/4+1];if(n)throw Vu(t)}finally{un.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=tr()[o/4+0],i=tr()[o/4+1];return e=n,t=i,Ko(n,i)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=tr()[o/4+0],i=tr()[o/4+1];return e=n,t=i,Ko(n,i)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const g=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_routeNameForWaypoints(g,this.__wbg_ptr,Yr(e));var i=tr()[g/4+0],o=tr()[g/4+1],u=tr()[g/4+2],s=tr()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Vu(u);return t=d,n=p,Ko(d,p)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){un.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){un.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const g=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_calculateRoute(g,this.__wbg_ptr,Yr(e));var i=tr()[g/4+0],o=tr()[g/4+1],u=tr()[g/4+2],s=tr()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Vu(u);return t=d,n=p,Ko(d,p)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const _=un.__wbindgen_add_to_stack_pointer(-16);un.jsroutesnapper_getExtraNodes(_,this.__wbg_ptr,Yr(e),Yr(t));var o=tr()[_/4+0],u=tr()[_/4+1],s=tr()[_/4+2],d=tr()[_/4+3],p=o,g=u;if(d)throw p=0,g=0,Vu(s);return n=p,i=g,Ko(p,g)}finally{un.__wbindgen_add_to_stack_pointer(16),un.__wbindgen_free(n,i,1)}}}async function Sk(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function Ck(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ko(e,t);return Yr(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Vu(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ko(e,t));return Yr(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Zn(t),i=typeof n=="number"?n:void 0;xk()[e/8+1]=xm(i)?0:i,tr()[e/4+0]=!xm(i)},r.wbg.__wbindgen_is_object=function(e){const t=Zn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Zn(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Zn(e)in Zn(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Zn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Zn(e)==Zn(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Zn(t),i=typeof n=="string"?n:void 0;var o=xm(i)?0:wd(i,un.__wbindgen_malloc,un.__wbindgen_realloc),u=Da;tr()[e/4+1]=u,tr()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Zn(t)),i=wd(n,un.__wbindgen_malloc,un.__wbindgen_realloc),o=Da;tr()[e/4+1]=o,tr()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Zn(e);return Yr(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Zn(e)[Zn(t)];return Yr(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Yr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Zn(t).stack,i=wd(n,un.__wbindgen_malloc,un.__wbindgen_realloc),o=Da;tr()[e/4+1]=o,tr()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Ko(e,t))}finally{un.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Zn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Zn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Zn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Zn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Zn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Zn(e)[t>>>0];return Yr(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Zn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Zn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Zn(e).next;return Yr(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Am(function(e){const t=Zn(e).next();return Yr(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Zn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Zn(e).value;return Yr(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Yr(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Am(function(e,t){const n=Reflect.get(Zn(e),Zn(t));return Yr(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Am(function(e,t){const n=Zn(e).call(Zn(t));return Yr(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Zn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Zn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Zn(e).buffer;return Yr(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Zn(e));return Yr(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Zn(e).set(Zn(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Zn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Zn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=Um(Zn(t)),i=wd(n,un.__wbindgen_malloc,un.__wbindgen_realloc),o=Da;tr()[e/4+1]=o,tr()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ko(e,t))},r.wbg.__wbindgen_memory=function(){const e=un.memory;return Yr(e)},r}function Tk(r,e){return un=r.exports,hw.__wbindgen_wasm_module=e,wf=null,xf=null,bf=null,un}async function hw(r){if(un!==void 0)return un;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=Ck();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await Sk(await r,e);return Tk(t,n)}var Hi=63710088e-1,zg={centimeters:Hi*100,centimetres:Hi*100,degrees:Hi/111325,feet:Hi*3.28084,inches:Hi*39.37,kilometers:Hi/1e3,kilometres:Hi/1e3,meters:Hi,metres:Hi,miles:Hi/1609.344,millimeters:Hi*1e3,millimetres:Hi*1e3,nauticalmiles:Hi/1852,radians:1,yards:Hi*1.0936},Mk={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Hi,yards:1.0936133},Vm={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function rs(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Ek(r,e,t){switch(r){case"Point":return _o(e).geometry;case"LineString":return Yo(e).geometry;case"Polygon":return Dg(e).geometry;case"MultiPoint":return pw(e).geometry;case"MultiLineString":return dw(e).geometry;case"MultiPolygon":return mw(e).geometry;default:throw new Error(r+" is invalid")}}function _o(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wd(r[0])||!Wd(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return rs(n,e,t)}function Lk(r,e,t){return t===void 0&&(t={}),zl(r.map(function(n){return _o(n,e)}),t)}function Dg(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return rs(s,e,t)}function Ik(r,e,t){return t===void 0&&(t={}),zl(r.map(function(n){return Dg(n,e)}),t)}function Yo(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return rs(n,e,t)}function Pk(r,e,t){return t===void 0&&(t={}),zl(r.map(function(n){return Yo(n,e)}),t)}function zl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function dw(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return rs(n,e,t)}function pw(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return rs(n,e,t)}function mw(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return rs(n,e,t)}function zk(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return rs(n,e,t)}function Dk(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Rg(r,e){e===void 0&&(e="kilometers");var t=zg[e];if(!t)throw new Error(e+" units is invalid");return r*t}function ap(r,e){e===void 0&&(e="kilometers");var t=zg[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Rk(r,e){return $f(ap(r,e))}function Bk(r){var e=r%360;return e<0&&(e+=360),e}function $f(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Qo(r){var e=r%360;return e*Math.PI/180}function Fk(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Rg(ap(r,e),t)}function Ok(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Vm[e];if(!n)throw new Error("invalid original units");var i=Vm[t];if(!i)throw new Error("invalid final units");return r/n*i}function Wd(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Bg(r){return!!r&&r.constructor===Object}function $k(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!Wd(e))throw new Error("bbox must only contain numbers")})}function Nk(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const jk=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Vm,bearingToAzimuth:Bk,convertArea:Ok,convertLength:Fk,degreesToRadians:Qo,earthRadius:Hi,factors:zg,feature:rs,featureCollection:zl,geometry:Ek,geometryCollection:zk,isNumber:Wd,isObject:Bg,lengthToDegrees:Rk,lengthToRadians:ap,lineString:Yo,lineStrings:Pk,multiLineString:dw,multiPoint:pw,multiPolygon:mw,point:_o,points:Lk,polygon:Dg,polygons:Ik,radiansToDegrees:$f,radiansToLength:Rg,round:Dk,unitsFactors:Mk,validateBBox:$k,validateId:Nk},Symbol.toStringTag,{value:"Module"}));function Nf(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Qu(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Yf(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,_=0,x,C=r.type,T=C==="FeatureCollection",z=C==="Feature",L=T?r.features.length:1,E=0;E<L;E++){p=T?r.features[E].geometry:z?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var O=0,B=0;if(u=x?p.geometries[I]:p,u!==null){d=u.coordinates;var K=u.type;switch(g=t&&(K==="Polygon"||K==="MultiPolygon")?1:0,K){case null:break;case"Point":if(e(d,_,E,O,B)===!1)return!1;_++,O++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,E,O,B)===!1)return!1;_++,K==="MultiPoint"&&O++}K==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],_,E,O,B)===!1)return!1;_++}K==="MultiLineString"&&O++,K==="Polygon"&&B++}K==="Polygon"&&O++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(B=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],_,E,O,B)===!1)return!1;_++}B++}O++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Yf(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Uk(r,e,t,n){var i=t;return Yf(r,function(o,u,s,d,p){u===0&&t===void 0?i=o:i=e(i,o,u,s,d,p)},n),i}function gw(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function Vk(r,e,t){var n=t;return gw(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Zd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function qk(r,e,t){var n=t;return Zd(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Hk(r){var e=[];return Yf(r,function(t){e.push(t)}),e}function Fg(r,e){var t,n,i,o,u,s,d,p,g,_,x=0,C=r.type==="FeatureCollection",T=r.type==="Feature",z=C?r.features.length:1;for(t=0;t<z;t++){for(s=C?r.features[t].geometry:T?r.geometry:r,p=C?r.features[t].properties:T?r.properties:{},g=C?r.features[t].bbox:T?r.bbox:void 0,_=C?r.features[t].id:T?r.id:void 0,d=s?s.type==="GeometryCollection":!1,u=d?s.geometries.length:1,i=0;i<u;i++){if(o=d?s.geometries[i]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function Gk(r,e,t){var n=t;return Fg(r,function(i,o,u,s,d){o===0&&t===void 0?n=i:n=e(n,i,o,u,s,d)}),n}function ac(r,e){Fg(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(rs(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:d,coordinates:g};if(e(rs(_,i),n,p)===!1)return!1}})}function Wk(r,e,t){var n=t;return ac(r,function(i,o,u){o===0&&u===0&&t===void 0?n=i:n=e(n,i,o,u)}),n}function _w(r,e){ac(r,function(t,n,i){var o=0;if(t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var s,d=0,p=0,g=0;if(Yf(t,function(_,x,C,T,z){if(s===void 0||n>d||T>p||z>g){s=_,d=n,p=T,g=z,o=0;return}var L=Yo([s,_],t.properties);if(e(L,n,i,z,o)===!1)return!1;o++,s=_})===!1)return!1}}})}function Zk(r,e,t){var n=t,i=!1;return _w(r,function(o,u,s,d,p){i===!1&&t===void 0?n=o:n=e(n,o,u,s,d,p),i=!0}),n}function yw(r,e){if(!r)throw new Error("geojson is required");ac(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<u.length;s++)if(e(Yo(u[s],t.properties),n,i,s)===!1)return!1;break}}})}function Xk(r,e,t){var n=t;return yw(r,function(i,o,u,s){o===0&&t===void 0?n=i:n=e(n,i,o,u,s)}),n}function Kk(r,e){if(e=e||{},!Bg(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var d=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),Yo([d[o],d[o+1]],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),Yo([d[i][o],d[i][o+1]],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),Yo([d[n][o],d[n][o+1]],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o-1),Yo([d[n][i][o],d[n][i][o+1]],u,e)}throw new Error("geojson is invalid")}function Jk(r,e){if(e=e||{},!Bg(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var d=s.coordinates;switch(s.type){case"Point":return _o(d,u,e);case"MultiPoint":return n<0&&(n=d.length+n),_o(d[n],u,e);case"LineString":return o<0&&(o=d.length+o),_o(d[o],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),_o(d[i][o],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),_o(d[n][o],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o),_o(d[n][i][o],u,e)}throw new Error("geojson is invalid")}const Yk=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Hk,coordEach:Yf,coordReduce:Uk,featureEach:Zd,featureReduce:qk,findPoint:Jk,findSegment:Kk,flattenEach:ac,flattenReduce:Wk,geomEach:Fg,geomReduce:Gk,lineEach:yw,lineReduce:Xk,propEach:gw,propReduce:Vk,segmentEach:_w,segmentReduce:Zk},Symbol.toStringTag,{value:"Module"}));function vw(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Qk(r,e);var n=Nf(r),i=Nf(e),o=Qo(n[0]),u=Qo(i[0]),s=Qo(n[1]),d=Qo(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(s)*Math.sin(d)-Math.sin(s)*Math.cos(d)*Math.cos(u-o);return $f(Math.atan2(p,g))}function Qk(r,e){var t=vw(e,r);return t=(t+180)%360,t}function cf(r,e,t){t===void 0&&(t={});var n=Nf(r),i=Nf(e),o=Qo(i[1]-n[1]),u=Qo(i[0]-n[0]),s=Qo(n[1]),d=Qo(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(d);return Rg(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function J0(r,e,t,n){n===void 0&&(n={});var i=Nf(r),o=Qo(i[0]),u=Qo(i[1]),s=Qo(t),d=ap(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),_=$f(g),x=$f(p);return _o([_,x],n.properties)}function Y0(r){if(!r)throw new Error("geojson is required");var e=[];return ac(r,function(t){e3(t,e)}),zl(e)}function e3(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Qu(n);break;case"LineString":t=[Qu(n)]}t.forEach(function(i){var o=t3(i,r.properties);o.forEach(function(u){u.id=e.length,e.push(u)})})}}function t3(r,e){var t=[];return r.reduce(function(n,i){var o=Yo([n,i],e);return o.bbox=n3(n,i),t.push(o),i}),t}function n3(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],u=t<i?t:i,s=n<o?n:o,d=t>i?t:i,p=n>o?n:o;return[u,s,d,p]}var Og={exports:{}},bw={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(aw,function(){function t(I,O,B,K,H){(function q(J,he,Ee,Y,oe){for(;Y>Ee;){if(Y-Ee>600){var ke=Y-Ee+1,ye=he-Ee+1,Ne=Math.log(ke),Ue=.5*Math.exp(2*Ne/3),De=.5*Math.sqrt(Ne*Ue*(ke-Ue)/ke)*(ye-ke/2<0?-1:1),Le=Math.max(Ee,Math.floor(he-ye*Ue/ke+De)),lt=Math.min(Y,Math.floor(he+(ke-ye)*Ue/ke+De));q(J,he,Le,lt,oe)}var Ze=J[he],at=Ee,dt=Y;for(n(J,Ee,he),oe(J[Y],Ze)>0&&n(J,Ee,Y);at<dt;){for(n(J,at,dt),at++,dt--;oe(J[at],Ze)<0;)at++;for(;oe(J[dt],Ze)>0;)dt--}oe(J[Ee],Ze)===0?n(J,Ee,dt):n(J,++dt,Y),dt<=he&&(Ee=dt+1),he<=dt&&(Y=dt-1)}})(I,O,B||0,K||I.length-1,H||i)}function n(I,O,B){var K=I[O];I[O]=I[B],I[B]=K}function i(I,O){return I<O?-1:I>O?1:0}var o=function(I){I===void 0&&(I=9),this._maxEntries=Math.max(4,I),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function u(I,O,B){if(!B)return O.indexOf(I);for(var K=0;K<O.length;K++)if(B(I,O[K]))return K;return-1}function s(I,O){d(I,0,I.children.length,O,I)}function d(I,O,B,K,H){H||(H=L(null)),H.minX=1/0,H.minY=1/0,H.maxX=-1/0,H.maxY=-1/0;for(var q=O;q<B;q++){var J=I.children[q];p(H,I.leaf?K(J):J)}return H}function p(I,O){return I.minX=Math.min(I.minX,O.minX),I.minY=Math.min(I.minY,O.minY),I.maxX=Math.max(I.maxX,O.maxX),I.maxY=Math.max(I.maxY,O.maxY),I}function g(I,O){return I.minX-O.minX}function _(I,O){return I.minY-O.minY}function x(I){return(I.maxX-I.minX)*(I.maxY-I.minY)}function C(I){return I.maxX-I.minX+(I.maxY-I.minY)}function T(I,O){return I.minX<=O.minX&&I.minY<=O.minY&&O.maxX<=I.maxX&&O.maxY<=I.maxY}function z(I,O){return O.minX<=I.maxX&&O.minY<=I.maxY&&O.maxX>=I.minX&&O.maxY>=I.minY}function L(I){return{children:I,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function E(I,O,B,K,H){for(var q=[O,B];q.length;)if(!((B=q.pop())-(O=q.pop())<=K)){var J=O+Math.ceil((B-O)/K/2)*K;t(I,J,O,B,H),q.push(O,J,J,B)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(I){var O=this.data,B=[];if(!z(I,O))return B;for(var K=this.toBBox,H=[];O;){for(var q=0;q<O.children.length;q++){var J=O.children[q],he=O.leaf?K(J):J;z(I,he)&&(O.leaf?B.push(J):T(I,he)?this._all(J,B):H.push(J))}O=H.pop()}return B},o.prototype.collides=function(I){var O=this.data;if(!z(I,O))return!1;for(var B=[];O;){for(var K=0;K<O.children.length;K++){var H=O.children[K],q=O.leaf?this.toBBox(H):H;if(z(I,q)){if(O.leaf||T(I,q))return!0;B.push(H)}}O=B.pop()}return!1},o.prototype.load=function(I){if(!I||!I.length)return this;if(I.length<this._minEntries){for(var O=0;O<I.length;O++)this.insert(I[O]);return this}var B=this._build(I.slice(),0,I.length-1,0);if(this.data.children.length)if(this.data.height===B.height)this._splitRoot(this.data,B);else{if(this.data.height<B.height){var K=this.data;this.data=B,B=K}this._insert(B,this.data.height-B.height-1,!0)}else this.data=B;return this},o.prototype.insert=function(I){return I&&this._insert(I,this.data.height-1),this},o.prototype.clear=function(){return this.data=L([]),this},o.prototype.remove=function(I,O){if(!I)return this;for(var B,K,H,q=this.data,J=this.toBBox(I),he=[],Ee=[];q||he.length;){if(q||(q=he.pop(),K=he[he.length-1],B=Ee.pop(),H=!0),q.leaf){var Y=u(I,q.children,O);if(Y!==-1)return q.children.splice(Y,1),he.push(q),this._condense(he),this}H||q.leaf||!T(q,J)?K?(B++,q=K.children[B],H=!1):q=null:(he.push(q),Ee.push(B),B=0,K=q,q=q.children[0])}return this},o.prototype.toBBox=function(I){return I},o.prototype.compareMinX=function(I,O){return I.minX-O.minX},o.prototype.compareMinY=function(I,O){return I.minY-O.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(I){return this.data=I,this},o.prototype._all=function(I,O){for(var B=[];I;)I.leaf?O.push.apply(O,I.children):B.push.apply(B,I.children),I=B.pop();return O},o.prototype._build=function(I,O,B,K){var H,q=B-O+1,J=this._maxEntries;if(q<=J)return s(H=L(I.slice(O,B+1)),this.toBBox),H;K||(K=Math.ceil(Math.log(q)/Math.log(J)),J=Math.ceil(q/Math.pow(J,K-1))),(H=L([])).leaf=!1,H.height=K;var he=Math.ceil(q/J),Ee=he*Math.ceil(Math.sqrt(J));E(I,O,B,Ee,this.compareMinX);for(var Y=O;Y<=B;Y+=Ee){var oe=Math.min(Y+Ee-1,B);E(I,Y,oe,he,this.compareMinY);for(var ke=Y;ke<=oe;ke+=he){var ye=Math.min(ke+he-1,oe);H.children.push(this._build(I,ke,ye,K-1))}}return s(H,this.toBBox),H},o.prototype._chooseSubtree=function(I,O,B,K){for(;K.push(O),!O.leaf&&K.length-1!==B;){for(var H=1/0,q=1/0,J=void 0,he=0;he<O.children.length;he++){var Ee=O.children[he],Y=x(Ee),oe=(ke=I,ye=Ee,(Math.max(ye.maxX,ke.maxX)-Math.min(ye.minX,ke.minX))*(Math.max(ye.maxY,ke.maxY)-Math.min(ye.minY,ke.minY))-Y);oe<q?(q=oe,H=Y<H?Y:H,J=Ee):oe===q&&Y<H&&(H=Y,J=Ee)}O=J||O.children[0]}var ke,ye;return O},o.prototype._insert=function(I,O,B){var K=B?I:this.toBBox(I),H=[],q=this._chooseSubtree(K,this.data,O,H);for(q.children.push(I),p(q,K);O>=0&&H[O].children.length>this._maxEntries;)this._split(H,O),O--;this._adjustParentBBoxes(K,H,O)},o.prototype._split=function(I,O){var B=I[O],K=B.children.length,H=this._minEntries;this._chooseSplitAxis(B,H,K);var q=this._chooseSplitIndex(B,H,K),J=L(B.children.splice(q,B.children.length-q));J.height=B.height,J.leaf=B.leaf,s(B,this.toBBox),s(J,this.toBBox),O?I[O-1].children.push(J):this._splitRoot(B,J)},o.prototype._splitRoot=function(I,O){this.data=L([I,O]),this.data.height=I.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(I,O,B){for(var K,H,q,J,he,Ee,Y,oe=1/0,ke=1/0,ye=O;ye<=B-O;ye++){var Ne=d(I,0,ye,this.toBBox),Ue=d(I,ye,B,this.toBBox),De=(H=Ne,q=Ue,J=void 0,he=void 0,Ee=void 0,Y=void 0,J=Math.max(H.minX,q.minX),he=Math.max(H.minY,q.minY),Ee=Math.min(H.maxX,q.maxX),Y=Math.min(H.maxY,q.maxY),Math.max(0,Ee-J)*Math.max(0,Y-he)),Le=x(Ne)+x(Ue);De<oe?(oe=De,K=ye,ke=Le<ke?Le:ke):De===oe&&Le<ke&&(ke=Le,K=ye)}return K||B-O},o.prototype._chooseSplitAxis=function(I,O,B){var K=I.leaf?this.compareMinX:g,H=I.leaf?this.compareMinY:_;this._allDistMargin(I,O,B,K)<this._allDistMargin(I,O,B,H)&&I.children.sort(K)},o.prototype._allDistMargin=function(I,O,B,K){I.children.sort(K);for(var H=this.toBBox,q=d(I,0,O,H),J=d(I,B-O,B,H),he=C(q)+C(J),Ee=O;Ee<B-O;Ee++){var Y=I.children[Ee];p(q,I.leaf?H(Y):Y),he+=C(q)}for(var oe=B-O-1;oe>=O;oe--){var ke=I.children[oe];p(J,I.leaf?H(ke):ke),he+=C(J)}return he},o.prototype._adjustParentBBoxes=function(I,O,B){for(var K=B;K>=0;K--)p(O[K],I)},o.prototype._condense=function(I){for(var O=I.length-1,B=void 0;O>=0;O--)I[O].children.length===0?O>0?(B=I[O-1].children).splice(B.indexOf(I[O]),1):this.clear():s(I[O],this.toBBox)},o})})(bw);var r3=bw.exports;const i3=Pg(jk),o3=Pg(Yk);function ww(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,_=0,x,C=r.type,T=C==="FeatureCollection",z=C==="Feature",L=T?r.features.length:1,E=0;E<L;E++){p=T?r.features[E].geometry:z?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var O=0,B=0;if(u=x?p.geometries[I]:p,u!==null){d=u.coordinates;var K=u.type;switch(g=t&&(K==="Polygon"||K==="MultiPolygon")?1:0,K){case null:break;case"Point":if(e(d,_,E,O,B)===!1)return!1;_++,O++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,E,O,B)===!1)return!1;_++,K==="MultiPoint"&&O++}K==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],_,E,O,B)===!1)return!1;_++}K==="MultiLineString"&&O++,K==="Polygon"&&B++}K==="Polygon"&&O++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(B=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],_,E,O,B)===!1)return!1;_++}B++}O++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(ww(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function xw(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return ww(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var s3=xw;const a3=Object.freeze(Object.defineProperty({__proto__:null,bbox:xw,default:s3},Symbol.toStringTag,{value:"Module"})),l3=Pg(a3);var zs=r3,Aw=i3,kw=o3,Ru=l3.default,u3=kw.featureEach;kw.coordEach;Aw.polygon;var Q0=Aw.featureCollection;function Sw(r){var e=new zs(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ru(t),zs.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Ru(i),n.push(i)}):u3(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Ru(i),n.push(i)}),zs.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Ru(t),zs.prototype.remove.call(this,t,n)},e.clear=function(){return zs.prototype.clear.call(this)},e.search=function(t){var n=zs.prototype.search.call(this,this.toBBox(t));return Q0(n)},e.collides=function(t){return zs.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=zs.prototype.all.call(this);return Q0(t)},e.toJSON=function(){return zs.prototype.toJSON.call(this)},e.fromJSON=function(t){return zs.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=Ru(t);else if(t.type==="FeatureCollection")n=Ru(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Og.exports=Sw;Og.exports.default=Sw;var c3=Og.exports;const f3=lw(c3);function h3(r,e){var t={},n=[];if(r.type==="LineString"&&(r=rs(r)),e.type==="LineString"&&(e=rs(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=ey(r,e);return i&&n.push(i),zl(n)}var o=f3();return o.load(Y0(e)),Zd(Y0(r),function(u){Zd(o.search(u),function(s){var d=ey(u,s);if(d){var p=Qu(d).join(",");t[p]||(t[p]=!0,n.push(d))}})}),zl(n)}function ey(r,e){var t=Qu(r),n=Qu(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],u=t[1][0],s=t[1][1],d=n[0][0],p=n[0][1],g=n[1][0],_=n[1][1],x=(_-p)*(u-i)-(g-d)*(s-o),C=(g-d)*(o-p)-(_-p)*(i-d),T=(u-i)*(o-p)-(s-o)*(i-d);if(x===0)return null;var z=C/x,L=T/x;if(z>=0&&z<=1&&L>=0&&L<=1){var E=i+z*(u-i),I=o+z*(s-o);return _o([E,I])}return null}function d3(r,e,t){t===void 0&&(t={});var n=_o([1/0,1/0],{dist:1/0}),i=0;return ac(r,function(o){for(var u=Qu(o),s=0;s<u.length-1;s++){var d=_o(u[s]);d.properties.dist=cf(e,d,t);var p=_o(u[s+1]);p.properties.dist=cf(e,p,t);var g=cf(d,p,t),_=Math.max(d.properties.dist,p.properties.dist),x=vw(d,p),C=J0(e,_,x+90,t),T=J0(e,_,x-90,t),z=h3(Yo([C.geometry.coordinates,T.geometry.coordinates]),Yo([d.geometry.coordinates,p.geometry.coordinates])),L=null;z.features.length>0&&(L=z.features[0],L.properties.dist=cf(e,L,t),L.properties.location=i+cf(d,L,t)),d.properties.dist<n.properties.dist&&(n=d,n.properties.index=s,n.properties.location=i),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=s+1,n.properties.location=i+g),L&&L.properties.dist<n.properties.dist&&(n=L,n.properties.index=s),i+=g}}),n}const p3=30;class m3{constructor(e,t,n,i,o){this.onMouseMove=u=>{if(!this.active)return;const s=[u.point.x-p3,u.point.y],d=this.map.unproject(u.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(u.lngLat.lng,u.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=u=>{this.active&&(u.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||u.key=="Escape"&&(u.stopPropagation(),this.cancel())},this.onKeyPress=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||(u.key=="Enter"?(u.stopPropagation(),this.finish()):u.key=="s"||u.key=="S"?(u.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):u.key=="z"&&u.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Gd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Bu=[];function Dd(r,e){return{subscribe:Pn(r,e).subscribe}}function Pn(r,e=ft){let t;const n=new Set;function i(s){if(wt(r,s)&&(r=s,t)){const d=!Bu.length;for(const p of n)p[1](),Bu.push(p,r);if(d){for(let p=0;p<Bu.length;p+=2)Bu[p][0](Bu[p+1]);Bu.length=0}}}function o(s){i(s(r))}function u(s,d=ft){const p=[s,d];return n.add(p),n.size===1&&(t=e(i,o)||ft),s(r),()=>{n.delete(p),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:u}}function Cw(r,e,t){const n=!Array.isArray(r),i=n?[r]:r;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return Dd(t,(u,s)=>{let d=!1;const p=[];let g=0,_=ft;const x=()=>{if(g)return;_();const T=e(n?p[0]:p,u,s);o?u(T):_=ua(T)?T:ft},C=i.map((T,z)=>Sg(T,L=>{p[z]=L,g&=~(1<<z),d&&x()},()=>{g|=1<<z}));return d=!0,x(),function(){hr(C),_(),d=!1}})}class g3{constructor(){er(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty â nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,2 .toString());return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new km(n,1,Rd);for(const[o,u]of _3(n))for(const{projectKey:s,projectName:d}of u){let p=window.localStorage.getItem(s);if(!p){console.warn(`Project features not found for ${s}, skipping migration`);continue}let g=JSON.parse(p);g.app_focus=n,g.study_area_name=o,g.project_name=d,console.log(`migrating project ${s}`);let _=i.createProject(g);console.log(`Successfully migrated v0->v1 project ${s} -> ${i.projectKey(_)}`),window.localStorage.removeItem(s)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new km(n,2,Rd);for(const[o,u]of i.projects()){if(u.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}u.db_schema_version=2,i.saveProject(o,u),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,2 .toString()),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new km(e,this.storedSchemaVersion,Rd)}}const Rd=Symbol("internal_method_token");class km{constructor(e,t,n){er(this,"appFocus");er(this,"dbSchemaVersion");if(n!==Rd)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t="My neighbourhood",i=this.project(e).features.filter(s=>{var d;return((d=s.properties)==null?void 0:d.kind)=="boundary"}),o=t,u=1;for(;i.some(s=>{var d;return((d=s.properties)==null?void 0:d.name)==o});)u++,o=`${t} #${u}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.globalAndCntProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}globalAndCntProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function _3(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[u,s,d]=o.split("/");e.has(s)||e.set(s,[]),e.get(s).push({projectKey:o,projectName:d})}catch(u){console.log(`error loading cnt project: ${o}`,u)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let u=o.split("ltn_"),s=u[u.length-1],d="";try{d=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(p){console.log(`error loading global project: ${o}`,p)}d&&d.length>0?(e.has(d)||e.set(d,[]),e.get(d).push({projectKey:o,projectName:s})):t.push({projectKey:o,projectName:s})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const Tw="MZEJTanw3WpxRvt7qDfo";let is=Pn(null),bs=Pn("global"),Fs=Pn(void 0),y3=Cw(Fs,r=>{if(r)return hi(Va).project(r)}),Ia=Pn(void 0),Mw=new g3,Va=Cw(bs,r=>Mw.projectStorage(r)),ty=Pn(!0),Xd=Pn(!1),kr=Pn(null),lc=Pn({population_density:[0,1,2,3,4,5],collision_density:[0,1,2,3,4,5],poi_density:[0,1,2,3,4,5]}),Ef=Pn(new oa.LngLat(0,0)),Lf=Pn(new oa.LngLat(0,0)),xd=Pn(new oa.LngLat(0,0)),ny=Pn(1),Gi=Pn(1),nr=Pn({mode:"title",firstLoad:!0}),If=Pn(!1),qm=Pn("streets-v2"),Hm=Pn("walk_cycle_only"),ry=Pn(!1),Gm=Pn(!0),Kd=Pn(!0),Jd=Pn("shortcuts"),Wm=Pn(!1),Zm=Pn(!0),iy=Pn(500);function jf(){const r=hi(Fs);try{hi(Va).saveProject(r,hi(kr).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let Xm=Pn(!1);function Fo(r){return hi(Xm)?`/${r}`:`https://assets.od2net.org/${r}`}function Km(r){var n;function e(i){const o=i.getEast()-i.getWest();let u=i.getWest()+Math.random()*o;const s=i.getNorth()-i.getSouth();let d=i.getSouth()+Math.random()*s;return new oa.LngLat(u,d)}const t=(n=hi(is))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(hi(r))||r.set(e(t))}function v3(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z;return{c(){e=U("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=ie(),n=U("p"),n.innerHTML=`This is the second version of the A/B Street LTN tool, <a href="https://github.com/a-b-street/ltn" target="_blank">an open source project</a>. This version, called the Connected Neighbourhoods Tool, has been funded
    by
    <a href="https://www.transport.gov.scot/" target="_blank">Transport Scotland</a>
    and designed by
    <a href="https://www.sustrans.org.uk" target="_blank">Sustrans Scotland</a>.
    The team includes:`,i=ie(),o=U("ul"),o.innerHTML=`<li>Dustin Carlino, lead developer and director of <a href="https://find-and-update.company-information.service.gov.uk/company/16217327" target="_blank">A/B Street Ltd</a></li> <li><a href="https://github.com/michaelkirk/" target="_blank">Michael Kirk</a>, software developer</li> <li>Sustrans Scotland
      <ul><li><a href="https://www.linkedin.com/in/congying-hu/" target="_blank">Congying (Cici) Hu</a>, mobility planner</li> <li><a href="https://www.linkedin.com/in/angus-calder-a69543206" target="_blank">Angus Calder</a>, senior mobility planner</li> <li>Michael Naysmith, senior mobility planner (project manager)</li> <li><a href="https://www.linkedin.com/in/matthew-davis-6b3a8124/" target="_blank">Matthew Davis</a>, principal mobility planner</li></ul></li>`,u=ie(),s=U("p"),s.innerHTML=`This second version of the tool is an evolution from the original A/B Street
    tool, with <a href="https://a-b-street.github.io/docs/software/ltn/index.html#credits" target="_blank">many people</a> to thank there. Of the dozens of users giving excellent feedback and shaping
    the toolâs development, particular thanks to:`,d=ie(),p=U("ul"),p.innerHTML='<li><a href="https://github.com/XioNoX" target="_blank">Arzhel Younsi</a></li> <li><a href="https://github.com/rouelibre1" target="_blank">Rouelibre1</a></li>',g=ie(),_=U("p"),_.textContent="This tool would not be possible without:",x=ie(),C=U("ul"),C.innerHTML='<li><a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap contributors</a></li> <li><a href="https://www.maptiler.com/" target="_blank">Maptiler</a></li> <li><a href="https://georust.org/" target="_blank">GeoRust</a></li> <li><a href="https://lucide.dev/" target="_blank">Lucide icons</a></li> <li>And countless other open source libraries</li>',T=ie(),z=U("p"),z.textContent="Some road signs images Â© Crown copyright."},m(L,E){W(L,e,E),W(L,t,E),W(L,n,E),W(L,i,E),W(L,o,E),W(L,u,E),W(L,s,E),W(L,d,E),W(L,p,E),W(L,g,E),W(L,_,E),W(L,x,E),W(L,C,E),W(L,T,E),W(L,z,E)},p:ft,d(L){L&&(G(e),G(t),G(n),G(i),G(o),G(u),G(s),G(d),G(p),G(g),G(_),G(x),G(C),G(T),G(z))}}}function b3(r){let e,t,n;function i(u){r[1](u)}let o={$$slots:{default:[v3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Lg({props:o}),pn.push(()=>Dn(e,"show",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&4&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.show=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function w3(r,e,t){let n;st(r,Xd,o=>t(0,n=o));function i(o){n=o,Xd.set(n)}return[n,i]}class x3 extends Tt{constructor(e){super(),Ct(this,e,w3,b3,wt,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const A3={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},oy=A3;function sy(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Sm(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=It(n,t[i]);return{c(){e=ys(r[11]),Hd(e,n)},m(i,o){W(i,e,o)},p(i,o){Hd(e,n=Mn(t,[o&32&&i[12]]))},d(i){i&&G(e)}}}function ay(r){let e=r[11],t,n=r[11]&&Sm(r);return{c(){n&&n.c(),t=rr()},m(i,o){n&&n.m(i,o),W(i,t,o)},p(i,o){i[11]?e?wt(e,i[11])?(n.d(1),n=Sm(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=Sm(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&G(t),n&&n.d(i)}}}function k3(r){let e,t,n,i,o,u=On(r[5]),s=[];for(let x=0;x<u.length;x+=1)s[x]=ay(sy(r,u,x));const d=r[10].default,p=vn(d,r,r[9],null);let g=[oy,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],_={};for(let x=0;x<g.length;x+=1)_=It(_,g[x]);return{c(){e=ys("svg");for(let x=0;x<s.length;x+=1)s[x].c();t=rr(),p&&p.c(),Hd(e,_)},m(x,C){W(x,e,C);for(let T=0;T<s.length;T+=1)s[T]&&s[T].m(e,null);R(e,t),p&&p.m(e,null),o=!0},p(x,[C]){if(C&32){u=On(x[5]);let T;for(T=0;T<u.length;T+=1){const z=sy(x,u,T);s[T]?s[T].p(z,C):(s[T]=ay(z),s[T].c(),s[T].m(e,t))}for(;T<s.length;T+=1)s[T].d(1);s.length=u.length}p&&p.p&&(!o||C&512)&&wn(p,d,x,x[9],o?bn(d,x[9],C,null):xn(x[9]),null),Hd(e,_=Mn(g,[oy,C&128&&x[7],(!o||C&4)&&{width:x[2]},(!o||C&4)&&{height:x[2]},(!o||C&2)&&{stroke:x[1]},(!o||C&28&&n!==(n=x[4]?Number(x[3])*24/Number(x[2]):x[3]))&&{"stroke-width":n},(!o||C&257&&i!==(i=x[6]("lucide-icon","lucide",x[0]?`lucide-${x[0]}`:"",x[8].class)))&&{class:i}]))},i(x){o||(N(p,x),o=!0)},o(x){V(p,x),o=!1},d(x){x&&G(e),di(s,x),p&&p.d(x)}}}function S3(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=U0(e,n),{$$slots:o={},$$scope:u}=e,{name:s=void 0}=e,{color:d="currentColor"}=e,{size:p=24}=e,{strokeWidth:g=2}=e,{absoluteStrokeWidth:_=!1}=e,{iconNode:x=[]}=e;const C=(...T)=>T.filter((z,L,E)=>!!z&&E.indexOf(z)===L).join(" ");return r.$$set=T=>{t(8,e=It(It({},e),fr(T))),t(7,i=U0(e,n)),"name"in T&&t(0,s=T.name),"color"in T&&t(1,d=T.color),"size"in T&&t(2,p=T.size),"strokeWidth"in T&&t(3,g=T.strokeWidth),"absoluteStrokeWidth"in T&&t(4,_=T.absoluteStrokeWidth),"iconNode"in T&&t(5,x=T.iconNode),"$$scope"in T&&t(9,u=T.$$scope)},e=fr(e),[s,d,p,g,_,x,C,i,e,u,o]}class C3 extends Tt{constructor(e){super(),Ct(this,e,S3,k3,wt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const co=C3;function T3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function M3(r){let e,t;const n=[{name:"arrow-up"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[T3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function E3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class L3 extends Tt{constructor(e){super(),Ct(this,e,E3,M3,wt,{})}}const I3=L3;function P3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function z3(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[P3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function D3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class R3 extends Tt{constructor(e){super(),Ct(this,e,D3,z3,wt,{})}}const B3=R3;function F3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function O3(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[F3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function $3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class N3 extends Tt{constructor(e){super(),Ct(this,e,$3,O3,wt,{})}}const j3=N3;function U3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function V3(r){let e,t;const n=[{name:"eraser"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[U3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function q3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class H3 extends Tt{constructor(e){super(),Ct(this,e,q3,V3,wt,{})}}const G3=H3;function W3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Z3(r){let e,t;const n=[{name:"eye-closed"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[W3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function X3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m15 18-.722-3.25"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0"}],["path",{d:"m20 15-1.726-2.05"}],["path",{d:"m4 15 1.726-2.05"}],["path",{d:"m9 18 .722-3.25"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class K3 extends Tt{constructor(e){super(),Ct(this,e,X3,Z3,wt,{})}}const J3=K3;function Y3(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Q3(r){let e,t;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Y3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function e4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class t4 extends Tt{constructor(e){super(),Ct(this,e,e4,Q3,wt,{})}}const n4=t4;function r4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function i4(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[r4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function o4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class s4 extends Tt{constructor(e){super(),Ct(this,e,o4,i4,wt,{})}}const Ew=s4;function a4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function l4(r){let e,t;const n=[{name:"house"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[a4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function u4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class c4 extends Tt{constructor(e){super(),Ct(this,e,u4,l4,wt,{})}}const f4=c4;function h4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function d4(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[h4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function p4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class m4 extends Tt{constructor(e){super(),Ct(this,e,p4,d4,wt,{})}}const g4=m4;function _4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function y4(r){let e,t;const n=[{name:"paintbrush"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[_4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function v4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m14.622 17.897-10.68-2.913"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class b4 extends Tt{constructor(e){super(),Ct(this,e,v4,y4,wt,{})}}const Lw=b4;function w4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function x4(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[w4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function A4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class k4 extends Tt{constructor(e){super(),Ct(this,e,A4,x4,wt,{})}}const $g=k4;function S4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function C4(r){let e,t;const n=[{name:"pointer"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[S4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function T4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M22 14a8 8 0 0 1-8 8"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class M4 extends Tt{constructor(e){super(),Ct(this,e,T4,C4,wt,{})}}const Iw=M4;function E4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function L4(r){let e,t;const n=[{name:"redo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[E4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function I4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 7v6h-6"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class P4 extends Tt{constructor(e){super(),Ct(this,e,I4,L4,wt,{})}}const z4=P4;function D4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function R4(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[D4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function B4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class F4 extends Tt{constructor(e){super(),Ct(this,e,B4,R4,wt,{})}}const Ng=F4;function O4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function $4(r){let e,t;const n=[{name:"undo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[O4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new co({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?Mn(n,[n[0],u&2&&uo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function N4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 7v6h6"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}]];return r.$$set=u=>{t(1,e=It(It({},e),fr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=fr(e),[o,e,n,i]}class j4 extends Tt{constructor(e){super(),Ct(this,e,N4,$4,wt,{})}}const U4=j4;let V4=Date.now();function qa(r){return`${r}-${V4++}`}const jg=Symbol.for("svelte-maplibre");function Ha(){return Kf(jg)}function q4(r){let e=new WeakMap;return t=>{var u;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(u=t.target.queryRenderedFeatures(t.point).find(s=>{var d;return(d=r.get(s.layer.id))==null?void 0:d.interactive}))==null?void 0:u.layer.id;return e.set(t.originalEvent,o),o}}function H4(){let r=new Map;return op(jg,{map:Pn(null),source:Dd(null),layer:Dd(null),popupTarget:Dd(null),cluster:Pn(),loadedImages:Pn(new Set),minzoom:Pn(0),maxzoom:Pn(24),layerEvent:Pn(null),layerInfo:r,eventTopMost:q4(r),markerClickManager:new Z4})}function ly(r){return{subscribe:r.subscribe}}function Ug({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=Ha(),o=Pn(null),u=ly(o),s={...i,[r]:ly(o)};if(e&&(s.popupTarget=u),n){let d=Pn(null);s.layerEvent=d,i.layerEvent=d}return t&&(s.cluster=Pn()),op(jg,s),{...i,self:o}}function Pw(){return Ug({key:"source",setCluster:!0})}function zw(r=!0){return Ug({key:"layer",setPopupTarget:r,setMouseEvent:r})}function G4(){return Ug({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function W4(r){return"layerType"in r&&r.layerType==="deckgl"}class Z4{constructor(){er(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function uy(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function X4(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function K4(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Xn(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var Fa=J4;function J4(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var u=o[n],s=r[u];s!=null&&(e[u]=s)}return e}}}function cy(r){let e=r[0],t,n,i=fy(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&wt(e,e=o[0])?(Kt(),V(i,1,1,ft),Jt(),i=fy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function fy(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function Y4(r){let e,t,n=r[0]&&cy(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=cy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function Q4(r,e,t){let n,i,o,u,s,d,p,g,_,x,C,T,{$$slots:z={},$$scope:L}=e,{id:E=qa("layer")}=e,{source:I=void 0}=e,{sourceLayer:O=void 0}=e,{beforeId:B=void 0}=e,{beforeLayerType:K=void 0}=e,{type:H}=e,{paint:q=void 0}=e,{layout:J=void 0}=e,{filter:he=void 0}=e,{applyToClusters:Ee=void 0}=e,{minzoom:Y=void 0}=e,{maxzoom:oe=void 0}=e,{manageHoverState:ke=!1}=e,{hovered:ye=null}=e,{interactive:Ne=!0}=e,{hoverCursor:Ue=void 0}=e,{eventsIfTopMost:De=!1}=e;const Le=$s(),{map:lt,source:Ze,self:at,minzoom:dt,maxzoom:pt,eventTopMost:Je,layerInfo:xt}=zw();st(r,lt,qe=>t(31,_=qe)),st(r,Ze,qe=>t(32,x=qe)),st(r,at,qe=>t(0,g=qe)),st(r,dt,qe=>t(34,T=qe)),st(r,pt,qe=>t(33,C=qe)),ei(()=>{g&&_&&(xt.delete(g),_==null||_.removeLayer(g))});let Mt;function Ot(qe){var de,en;if(!Ne||!g||!_||De&&Je(qe)!==g)return;let Ge=qe.features??[],gt=(en=(de=Ge[0])==null?void 0:de.properties)==null?void 0:en.cluster_id,et={event:qe,map:_,clusterId:gt,layer:g,source:s,features:Ge};Le(qe.type,et)}function Yt(qe){var de,en;if(!Ne||!g||!_||De&&Je(qe)!==g)return;Ue&&(_.getCanvas().style.cursor=Ue);let Ge=qe.features??[];t(6,ye=Ge[0]??null);let gt=(en=(de=Ge[0])==null?void 0:de.properties)==null?void 0:en.cluster_id;Le("mouseenter",{event:qe,map:_,clusterId:gt,layer:g,source:s,features:Ge})}function nn(qe){var de,en,Xe;if(!Ne||!_)return;if(De&&Je(qe)!==g){t(6,ye=null),ke&&Mt!==void 0&&(_==null||_.setFeatureState({source:s,sourceLayer:O,id:Mt},{hover:!1}),Mt=void 0);return}_.getCanvas().style.cursor=Ue;let Ge=qe.features??[],gt=(en=(de=Ge[0])==null?void 0:de.properties)==null?void 0:en.cluster_id,et=(Xe=Ge[0])==null?void 0:Xe.id;et!==Mt&&(ke&&(Mt!==void 0&&(_==null||_.setFeatureState({source:s,id:Mt,sourceLayer:O},{hover:!1})),_==null||_.setFeatureState({source:s,id:et,sourceLayer:O},{hover:!0})),Mt=et,t(6,ye=Ge[0]??null)),Le("mousemove",{event:qe,map:_,clusterId:gt,layer:g,source:s,features:Ge})}function Qt(qe){if(!(!Ne||!g||!_)){if(Ue&&(_.getCanvas().style.cursor=""),t(6,ye=null),ke&&Mt!==void 0){const Ge={source:s,id:Mt,sourceLayer:O};_==null||_.setFeatureState(Ge,{hover:!1}),Mt=void 0}Le("mouseleave",{map:_,layer:g,source:s})}}let fn=!0;function mn(qe){_&&(_.off("click",qe,Ot),_.off("dblclick",qe,Ot),_.off("contextmenu",qe,Ot),_.off("mouseenter",qe,Yt),_.off("mousemove",qe,nn),_.off("mouseleave",qe,Qt))}return ei(()=>{_&&g&&mn(g)}),r.$$set=qe=>{"id"in qe&&t(7,E=qe.id),"source"in qe&&t(8,I=qe.source),"sourceLayer"in qe&&t(9,O=qe.sourceLayer),"beforeId"in qe&&t(10,B=qe.beforeId),"beforeLayerType"in qe&&t(11,K=qe.beforeLayerType),"type"in qe&&t(12,H=qe.type),"paint"in qe&&t(13,q=qe.paint),"layout"in qe&&t(14,J=qe.layout),"filter"in qe&&t(15,he=qe.filter),"applyToClusters"in qe&&t(16,Ee=qe.applyToClusters),"minzoom"in qe&&t(17,Y=qe.minzoom),"maxzoom"in qe&&t(18,oe=qe.maxzoom),"manageHoverState"in qe&&t(19,ke=qe.manageHoverState),"hovered"in qe&&t(6,ye=qe.hovered),"interactive"in qe&&t(20,Ne=qe.interactive),"hoverCursor"in qe&&t(21,Ue=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,De=qe.eventsIfTopMost),"$$scope"in qe&&t(35,L=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=K4(Ee)),r.$$.dirty[0]&1073774592&&t(24,i=X4("all",n,he)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=Y??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=oe??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=I||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&g!==E&&s){g&&(mn(g),xt.delete(g));let qe=B;if(!B&&K){let Ge=_.getStyle().layers,gt=typeof K=="function"?K:de=>de.type===K,et=Ge==null?void 0:Ge.find(gt);et&&(qe=et.id)}cn(at,g=E,g),_.addLayer(Fa({id:g,type:H,source:s,"source-layer":O,filter:i,paint:q,layout:J,minzoom:o,maxzoom:u}),qe),t(23,fn=!0),_.on("click",g,Ot),_.on("dblclick",g,Ot),_.on("contextmenu",g,Ot),_.on("mouseenter",g,Yt),_.on("mousemove",g,nn),_.on("mouseleave",g,Qt)}r.$$.dirty[0]&1048577&&g&&xt.set(g,{interactive:Ne}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?uy((qe,Ge)=>{_!=null&&_.style._loaded?_.setPaintProperty(g,qe,Ge):_==null||_.once("styledata",()=>_==null?void 0:_.setPaintProperty(g,qe,Ge))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?uy((qe,Ge)=>{_!=null&&_.style._loaded?_.setLayoutProperty(g,qe,Ge):_==null||_.once("styledata",()=>_==null?void 0:_.setLayoutProperty(g,qe,Ge))}):void 0),r.$$.dirty[0]&268443648&&(d==null||d(q)),r.$$.dirty[0]&134234112&&(p==null||p(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(_==null||_.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(fn?t(23,fn=!1):_==null||_.setFilter(g,i))},[g,lt,Ze,at,dt,pt,ye,E,I,O,B,K,H,q,J,he,Ee,Y,oe,ke,Ne,Ue,De,fn,i,u,o,p,d,s,n,_,x,C,T,L,z]}let Qf=class extends Tt{constructor(e){super(),Ct(this,e,Q4,Y4,wt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function eS(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function tS(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[eS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Qf({props:o}),pn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function nS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=qa("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:E=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:B=!0}=e;function K(oe){I=oe,t(0,I)}function H(oe){Sn.call(this,r,oe)}function q(oe){Sn.call(this,r,oe)}function J(oe){Sn.call(this,r,oe)}function he(oe){Sn.call(this,r,oe)}function Ee(oe){Sn.call(this,r,oe)}function Y(oe){Sn.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,o=oe.id),"source"in oe&&t(2,u=oe.source),"sourceLayer"in oe&&t(3,s=oe.sourceLayer),"beforeId"in oe&&t(4,d=oe.beforeId),"beforeLayerType"in oe&&t(5,p=oe.beforeLayerType),"paint"in oe&&t(6,g=oe.paint),"layout"in oe&&t(7,_=oe.layout),"filter"in oe&&t(8,x=oe.filter),"applyToClusters"in oe&&t(9,C=oe.applyToClusters),"minzoom"in oe&&t(10,T=oe.minzoom),"maxzoom"in oe&&t(11,z=oe.maxzoom),"hoverCursor"in oe&&t(12,L=oe.hoverCursor),"manageHoverState"in oe&&t(13,E=oe.manageHoverState),"hovered"in oe&&t(0,I=oe.hovered),"eventsIfTopMost"in oe&&t(14,O=oe.eventsIfTopMost),"interactive"in oe&&t(15,B=oe.interactive),"$$scope"in oe&&t(24,i=oe.$$scope)},[I,o,u,s,d,p,g,_,x,C,T,z,L,E,O,B,n,K,H,q,J,he,Ee,Y,i]}let Bl=class extends Tt{constructor(e){super(),Ct(this,e,nS,tS,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function rS(r){let e,t;const n=r[7].default,i=vn(n,r,r[6],null);return{c(){e=U("div"),i&&i.c(),fe(e,"class",r[1]),Gt(e,"maplibregl-ctrl",r[0])},m(o,u){W(o,e,u),i&&i.m(e,null),r[8](e),t=!0},p(o,[u]){i&&i.p&&(!t||u&64)&&wn(i,n,o,o[6],t?bn(n,o[6],u,null):xn(o[6]),null),(!t||u&2)&&fe(e,"class",o[1]),(!t||u&3)&&Gt(e,"maplibregl-ctrl",o[0])},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o),r[8](null)}}}function iS(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:u=!0}=e,{position:s="top-right"}=e,{class:d=void 0}=e;const{map:p}=Ha();st(r,p,C=>t(5,n=C));let g,_={onAdd(){return g},onRemove(){var C;(C=g==null?void 0:g.parentNode)==null||C.removeChild(g)}};ei(()=>{n==null||n.removeControl(_)});function x(C){pn[C?"unshift":"push"](()=>{g=C,t(2,g)})}return r.$$set=C=>{"defaultStyling"in C&&t(0,u=C.defaultStyling),"position"in C&&t(4,s=C.position),"class"in C&&t(1,d=C.class),"$$scope"in C&&t(6,o=C.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&g&&n.addControl(_,s)},[u,d,g,p,s,n,o,i,x]}class Jm extends Tt{constructor(e){super(),Ct(this,e,iS,rS,wt,{defaultStyling:0,position:4,class:1})}}function oS(r){let e,t,n,i,o,u;const s=r[5].default,d=vn(s,r,r[4],null);return{c(){e=U("button"),t=U("div"),d&&d.c(),fe(t,"class",n=Yu(r[3])+" svelte-1s83zbq"),Gt(t,"maplibregl-ctrl-icon",r[0]),Gt(t,"ctrl-btn-center",r[1]),fe(e,"type","button"),fe(e,"title",r[2])},m(p,g){W(p,e,g),R(e,t),d&&d.m(t,null),i=!0,o||(u=Lt(e,"click",r[6]),o=!0)},p(p,[g]){d&&d.p&&(!i||g&16)&&wn(d,s,p,p[4],i?bn(s,p[4],g,null):xn(p[4]),null),(!i||g&8&&n!==(n=Yu(p[3])+" svelte-1s83zbq"))&&fe(t,"class",n),(!i||g&9)&&Gt(t,"maplibregl-ctrl-icon",p[0]),(!i||g&10)&&Gt(t,"ctrl-btn-center",p[1]),(!i||g&4)&&fe(e,"title",p[2])},i(p){i||(N(d,p),i=!0)},o(p){V(d,p),i=!1},d(p){p&&G(e),d&&d.d(p),o=!1,u()}}}function sS(r,e,t){let{$$slots:n={},$$scope:i}=e,{icon:o=!0}=e,{center:u=!0}=e,{title:s=void 0}=e,{class:d=void 0}=e;function p(g){Sn.call(this,r,g)}return r.$$set=g=>{"icon"in g&&t(0,o=g.icon),"center"in g&&t(1,u=g.center),"title"in g&&t(2,s=g.title),"class"in g&&t(3,d=g.class),"$$scope"in g&&t(4,i=g.$$scope)},[o,u,s,d,i,n,p]}class Dw extends Tt{constructor(e){super(),Ct(this,e,sS,oS,wt,{icon:0,center:1,title:2,class:3})}}function aS(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[1],null);return{c(){e=U("div"),o&&o.c(),fe(e,"class",t="maplibregl-ctrl-group "+r[0])},m(u,s){W(u,e,s),o&&o.m(e,null),n=!0},p(u,[s]){o&&o.p&&(!n||s&2)&&wn(o,i,u,u[1],n?bn(i,u[1],s,null):xn(u[1]),null),(!n||s&1&&t!==(t="maplibregl-ctrl-group "+u[0]))&&fe(e,"class",t)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&G(e),o&&o.d(u)}}}function lS(r,e,t){let{$$slots:n={},$$scope:i}=e,{class:o=""}=e;return r.$$set=u=>{"class"in u&&t(0,o=u.class),"$$scope"in u&&t(1,i=u.$$scope)},[o,i,n]}class Rw extends Tt{constructor(e){super(),Ct(this,e,lS,aS,wt,{class:0})}}function uS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function cS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[uS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Qf({props:o}),pn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function fS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=qa("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:L=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:O=!0}=e;function B(Y){E=Y,t(0,E)}function K(Y){Sn.call(this,r,Y)}function H(Y){Sn.call(this,r,Y)}function q(Y){Sn.call(this,r,Y)}function J(Y){Sn.call(this,r,Y)}function he(Y){Sn.call(this,r,Y)}function Ee(Y){Sn.call(this,r,Y)}return r.$$set=Y=>{"id"in Y&&t(1,o=Y.id),"source"in Y&&t(2,u=Y.source),"sourceLayer"in Y&&t(3,s=Y.sourceLayer),"beforeId"in Y&&t(4,d=Y.beforeId),"beforeLayerType"in Y&&t(5,p=Y.beforeLayerType),"paint"in Y&&t(6,g=Y.paint),"layout"in Y&&t(7,_=Y.layout),"filter"in Y&&t(8,x=Y.filter),"minzoom"in Y&&t(9,C=Y.minzoom),"maxzoom"in Y&&t(10,T=Y.maxzoom),"hoverCursor"in Y&&t(11,z=Y.hoverCursor),"manageHoverState"in Y&&t(12,L=Y.manageHoverState),"hovered"in Y&&t(0,E=Y.hovered),"eventsIfTopMost"in Y&&t(13,I=Y.eventsIfTopMost),"interactive"in Y&&t(14,O=Y.interactive),"$$scope"in Y&&t(23,i=Y.$$scope)},[E,o,u,s,d,p,g,_,x,C,T,z,L,I,O,n,B,K,H,q,J,he,Ee,i]}let Xi=class extends Tt{constructor(e){super(),Ct(this,e,fS,cS,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function hS(r,e,t){let n;const{map:i}=Ha();st(r,i,d=>t(4,n=d));let{position:o="top-left"}=e,{container:u=void 0}=e,s=null;return ei(()=>{n!=null&&n.loaded()&&s&&n.removeControl(s)}),r.$$set=d=>{"position"in d&&t(1,o=d.position),"container"in d&&t(2,u=d.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!s){let d;typeof u=="string"?d=document.querySelector(u)??void 0:d=u,t(3,s=new Qr.FullscreenControl({container:d})),n.addControl(s,o)}},[i,o,u,s,n]}class dS extends Tt{constructor(e){super(),Ct(this,e,hS,null,wt,{position:1,container:2})}}function Bw(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function Fw(r,e,t){ew().then(()=>{let n=hi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function hy(r){let e=r[0],t,n,i=dy(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&wt(e,e=o[0])?(Kt(),V(i,1,1,ft),Jt(),i=dy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function dy(r){let e;const t=r[19].default,n=vn(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&wn(n,t,i,i[18],e?bn(t,i[18],o,null):xn(i[18]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function pS(r){let e,t,n=r[0]&&hy(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=hy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function mS(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:d=qa("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:_=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:T=void 0}=e,{maxzoom:z=void 0}=e,{attribution:L=void 0}=e,{buffer:E=void 0}=e,{tolerance:I=void 0}=e;const{map:O,cluster:B,self:K}=Pw();st(r,O,J=>t(17,i=J)),st(r,B,J=>t(20,o=J)),st(r,K,J=>t(0,n=J));let H,q=!0;return ei(()=>{n&&H&&i&&(Fw(O,n,H),cn(K,n=null,n),t(15,H=void 0))}),r.$$set=J=>{"id"in J&&t(4,d=J.id),"data"in J&&t(5,p=J.data),"generateId"in J&&t(6,g=J.generateId),"promoteId"in J&&t(7,_=J.promoteId),"filter"in J&&t(8,x=J.filter),"lineMetrics"in J&&t(9,C=J.lineMetrics),"cluster"in J&&t(10,T=J.cluster),"maxzoom"in J&&t(11,z=J.maxzoom),"attribution"in J&&t(12,L=J.attribution),"buffer"in J&&t(13,E=J.buffer),"tolerance"in J&&t(14,I=J.tolerance),"$$scope"in J&&t(18,s=J.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&cn(B,o=T,o),r.$$.dirty&196593&&i&&n!==d&&(cn(K,n=d,n),Bw(i,n,Fa({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:_,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties,maxzoom:z,attribution:L,buffer:E,tolerance:I}),J=>i&&J===n,()=>{n&&(t(15,H=i==null?void 0:i.getSource(n)),t(16,q=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,H=i==null?void 0:i.getSource(d))})),r.$$.dirty&98336&&H&&(q?t(16,q=!1):H.setData(p)),r.$$.dirty&33792&&(H==null||H.setClusterOptions(Fa({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[n,O,B,K,d,p,g,_,x,C,T,z,L,E,I,H,q,i,s,u]}let yr=class extends Tt{constructor(e){super(),Ct(this,e,mS,pS,wt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function gS(r,e,t){let n;const{map:i}=Ha();st(r,i,x=>t(8,n=x));let{position:o="top-left"}=e,{positionOptions:u=void 0}=e,{fitBoundsOptions:s=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:p=!0}=e,{showUserLocation:g=!0}=e,{control:_=null}=e;return ei(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),r.$$set=x=>{"position"in x&&t(2,o=x.position),"positionOptions"in x&&t(3,u=x.positionOptions),"fitBoundsOptions"in x&&t(4,s=x.fitBoundsOptions),"trackUserLocation"in x&&t(5,d=x.trackUserLocation),"showAccuracyCircle"in x&&t(6,p=x.showAccuracyCircle),"showUserLocation"in x&&t(7,g=x.showUserLocation),"control"in x&&t(1,_=x.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!_&&(t(1,_=new Qr.GeolocateControl({positionOptions:u,fitBoundsOptions:s,trackUserLocation:d,showAccuracyCircle:p,showUserLocation:g})),n.addControl(_,o))},[i,_,o,u,s,d,p,g,n]}class _S extends Tt{constructor(e){super(),Ct(this,e,gS,null,wt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function yS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function vS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"heatmap",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[yS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Qf({props:o}),pn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function bS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=qa("heatmap")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:L=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:O=!0}=e;function B(Y){E=Y,t(0,E)}function K(Y){Sn.call(this,r,Y)}function H(Y){Sn.call(this,r,Y)}function q(Y){Sn.call(this,r,Y)}function J(Y){Sn.call(this,r,Y)}function he(Y){Sn.call(this,r,Y)}function Ee(Y){Sn.call(this,r,Y)}return r.$$set=Y=>{"id"in Y&&t(1,o=Y.id),"source"in Y&&t(2,u=Y.source),"sourceLayer"in Y&&t(3,s=Y.sourceLayer),"beforeId"in Y&&t(4,d=Y.beforeId),"beforeLayerType"in Y&&t(5,p=Y.beforeLayerType),"paint"in Y&&t(6,g=Y.paint),"layout"in Y&&t(7,_=Y.layout),"filter"in Y&&t(8,x=Y.filter),"minzoom"in Y&&t(9,C=Y.minzoom),"maxzoom"in Y&&t(10,T=Y.maxzoom),"hoverCursor"in Y&&t(11,z=Y.hoverCursor),"manageHoverState"in Y&&t(12,L=Y.manageHoverState),"hovered"in Y&&t(0,E=Y.hovered),"eventsIfTopMost"in Y&&t(13,I=Y.eventsIfTopMost),"interactive"in Y&&t(14,O=Y.interactive),"$$scope"in Y&&t(23,i=Y.$$scope)},[E,o,u,s,d,p,g,_,x,C,T,z,L,I,O,n,B,K,H,q,J,he,Ee,i]}class wS extends Tt{constructor(e){super(),Ct(this,e,bS,vS,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function xS(r,e,t){let n,i,{data:o}=e,{idCol:u}=e,{sourceLayer:s=void 0}=e,d=new Set;const{map:p,source:g}=zw();return st(r,p,_=>t(6,n=_)),st(r,g,_=>t(7,i=_)),r.$$set=_=>{"data"in _&&t(2,o=_.data),"idCol"in _&&t(3,u=_.idCol),"sourceLayer"in _&&t(4,s=_.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let _=new Set;for(const x of o){const C=x[u];if(!C)continue;d.delete(C),_.add(C);const T={id:C,source:i,sourceLayer:s},z=n.getFeatureState(T);let L=!1;for(const E of Object.keys(x))if(z[E]!==x[E]){L=!0;break}L&&n.setFeatureState(T,x)}for(const x of d){const C={id:x,source:i,sourceLayer:s},T=n.getFeatureState(C);for(const z of Object.keys(T))n.removeFeatureState(C,z)}t(5,d=_)}},[p,g,o,u,s,d,n,i]}class AS extends Tt{constructor(e){super(),Ct(this,e,xS,null,wt,{data:2,idCol:3,sourceLayer:4})}}function kS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function SS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[kS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Qf({props:o}),pn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function CS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=qa("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:L=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:O=!0}=e;function B(Y){E=Y,t(0,E)}function K(Y){Sn.call(this,r,Y)}function H(Y){Sn.call(this,r,Y)}function q(Y){Sn.call(this,r,Y)}function J(Y){Sn.call(this,r,Y)}function he(Y){Sn.call(this,r,Y)}function Ee(Y){Sn.call(this,r,Y)}return r.$$set=Y=>{"id"in Y&&t(1,o=Y.id),"source"in Y&&t(2,u=Y.source),"sourceLayer"in Y&&t(3,s=Y.sourceLayer),"beforeId"in Y&&t(4,d=Y.beforeId),"beforeLayerType"in Y&&t(5,p=Y.beforeLayerType),"paint"in Y&&t(6,g=Y.paint),"layout"in Y&&t(7,_=Y.layout),"filter"in Y&&t(8,x=Y.filter),"minzoom"in Y&&t(9,C=Y.minzoom),"maxzoom"in Y&&t(10,T=Y.maxzoom),"hoverCursor"in Y&&t(11,z=Y.hoverCursor),"manageHoverState"in Y&&t(12,L=Y.manageHoverState),"hovered"in Y&&t(0,E=Y.hovered),"eventsIfTopMost"in Y&&t(13,I=Y.eventsIfTopMost),"interactive"in Y&&t(14,O=Y.interactive),"$$scope"in Y&&t(23,i=Y.$$scope)},[E,o,u,s,d,p,g,_,x,C,T,z,L,I,O,n,B,K,H,q,J,he,Ee,i]}let cr=class extends Tt{constructor(e){super(),Ct(this,e,CS,SS,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function TS(r,e,t){let n;const i=$s();let{layer:o=void 0}=e;const{map:u}=Ha();st(r,u,g=>t(2,n=g));function s(g){i(g.type,{...g,map:u})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ei(()=>{if(n)if(o)for(const g of d)n.off(g,o,s);else for(const g of p)n.off(g,s)}),r.$$set=g=>{"layer"in g&&t(1,o=g.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const g of d)n.on(g,o,s);else for(const g of p)n.on(g,s)},[u,o,n]}class Vg extends Tt{constructor(e){super(),Ct(this,e,TS,null,wt,{layer:1})}}function MS(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,u=Math.round(e.lng*i)/i,s=`${t}/${o}/${u}`,d=r.getBearing(),p=r.getPitch();return(d||p)&&(s+=`/${Math.round(d*10)/10}`),p&&(s+=`/${Math.round(p)}`),`#${s}`}function ES(r){return r.replace("#","").split("/").map(parseFloat)}var Fu=qg;function qg(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?py(r,e):{}.toString.call(r)=="[object Set]"?py(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?IS(r,e):LS(r,e)}function LS(r,e){return r.toString()===e.toString()}function py(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!qg(r[n],e[n]))return!1;return!0}function IS(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&qg(r[o],e[o])))return!1}return!0}function PS(r,e,t){let n;const{map:i}=Ha();st(r,i,g=>t(6,n=g));let{position:o="top-left"}=e,{showCompass:u=!0}=e,{showZoom:s=!0}=e,{visualizePitch:d=!1}=e,p=null;return ei(()=>{n!=null&&n.loaded()&&p&&n.removeControl(p)}),r.$$set=g=>{"position"in g&&t(1,o=g.position),"showCompass"in g&&t(2,u=g.showCompass),"showZoom"in g&&t(3,s=g.showZoom),"visualizePitch"in g&&t(4,d=g.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!p&&(t(5,p=new Qr.NavigationControl({showCompass:u,showZoom:s,visualizePitch:d})),n.addControl(p,o))},[i,o,u,s,d,p,n]}class Ow extends Tt{constructor(e){super(),Ct(this,e,PS,null,wt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function zS(r,e,t){let n;const{map:i}=Ha();st(r,i,p=>t(5,n=p));let{position:o="bottom-left"}=e,{maxWidth:u=void 0}=e,{unit:s="metric"}=e,d=null;return ei(()=>{n!=null&&n.loaded()&&d&&n.removeControl(d)}),r.$$set=p=>{"position"in p&&t(1,o=p.position),"maxWidth"in p&&t(2,u=p.maxWidth),"unit"in p&&t(3,s=p.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!d&&(t(4,d=new Qr.ScaleControl({maxWidth:u,unit:s})),n.addControl(d,o))},[i,o,u,s,d,n]}class $w extends Tt{constructor(e){super(),Ct(this,e,zS,null,wt,{position:1,maxWidth:2,unit:3})}}const{window:DS}=Jb,RS=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),my=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function gy(r){let e,t,n=r[3]&&_y(r);const i=r[46].default,o=vn(i,r,r[45],my);return{c(){n&&n.c(),e=ie(),o&&o.c()},m(u,s){n&&n.m(u,s),W(u,e,s),o&&o.m(u,s),t=!0},p(u,s){u[3]?n?(n.p(u,s),s[0]&8&&N(n,1)):(n=_y(u),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt()),o&&o.p&&(!t||s[0]&112|s[1]&16384)&&wn(o,i,u,u[45],t?bn(i,u[45],s,RS):xn(u[45]),my)},i(u){t||(N(n),N(o,u),t=!0)},o(u){V(n),V(o,u),t=!1},d(u){u&&G(e),n&&n.d(u),o&&o.d(u)}}}function _y(r){let e,t,n,i,o,u,s,d;return e=new Ow({props:{position:r[7]}}),n=new _S({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new dS({props:{position:r[7]}}),s=new $w({props:{position:r[7]}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),W(p,i,g),ae(o,p,g),W(p,u,g),ae(s,p,g),d=!0},p(p,g){const _={};g[0]&128&&(_.position=p[7]),e.$set(_);const x={};g[0]&128&&(x.position=p[7]),n.$set(x);const C={};g[0]&128&&(C.position=p[7]),o.$set(C);const T={};g[0]&128&&(T.position=p[7]),s.$set(T)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(G(t),G(i),G(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function BS(r){let e,t,n,i,o,u=r[4]&&r[0]&&gy(r);return{c(){e=U("div"),u&&u.c(),fe(e,"class",t=Yu(r[2])+" svelte-p00lfq"),fe(e,"data-testid","map-container"),Gt(e,"expand-map",!r[2])},m(s,d){W(s,e,d),u&&u.m(e,null),r[47](e),n=!0,i||(o=[Lt(DS,"hashchange",r[11]),$m(r[10].call(null,e))],i=!0)},p(s,d){s[4]&&s[0]?u?(u.p(s,d),d[0]&17&&N(u,1)):(u=gy(s),u.c(),N(u,1),u.m(e,null)):u&&(Kt(),V(u,1,1,()=>{u=null}),Jt()),(!n||d[0]&4&&t!==(t=Yu(s[2])+" svelte-p00lfq"))&&fe(e,"class",t),(!n||d[0]&4)&&Gt(e,"expand-map",!s[2])},i(s){n||(N(u),n=!0)},o(s){V(u),n=!1},d(s){s&&G(e),u&&u.d(),r[47](null),i=!1,hr(o)}}}function FS(r,e,t){let n,i,o,u,{$$slots:s={},$$scope:d}=e,{map:p=null}=e,{mapContainer:g=void 0}=e,{class:_=void 0}=e,{style:x}=e,{diffStyleUpdates:C=!1}=e,{center:T=void 0}=e,{zoom:z=void 0}=e,{pitch:L=0}=e,{bearing:E=0}=e,{bounds:I=void 0}=e,{hash:O=!1}=e,{updateHash:B=Xe=>{window.history.replaceState(window.history.state,"",Xe)}}=e,{loaded:K=!1}=e,{minZoom:H=0}=e,{maxZoom:q=22}=e,{minPitch:J=0}=e,{maxPitch:he=60}=e,{renderWorldCopies:Ee=void 0}=e,{dragPan:Y=void 0}=e,{dragRotate:oe=void 0}=e,{pitchWithRotate:ke=void 0}=e,{antialias:ye=void 0}=e,{zoomOnDoubleClick:Ne=!0}=e,{locale:Ue=void 0}=e,{interactive:De=!0}=e,{attributionControl:Le=!0}=e,{cooperativeGestures:lt=!1}=e,{preserveDrawingBuffer:Ze=!1}=e,{maxBounds:at=void 0}=e,{images:dt=[]}=e,{standardControls:pt=!1}=e,{filterLayers:Je=void 0}=e,{transformRequest:xt=void 0}=e;const Mt=$s(),{map:Ot,loadedImages:Yt}=H4();st(r,Ot,Xe=>t(4,o=Xe)),st(r,Yt,Xe=>t(5,u=Xe));let nn=new Set;async function Qt(Xe,it=!1){if(o&&!(!o.loaded()&&!it))if("url"in Xe){nn.add(Xe.id);try{let Ut=await o.loadImage(Xe.url);o==null||o.addImage(Xe.id,Ut.data,Xe.options),u.add(Xe.id),Yt.set(u)}catch(Ut){Mt("error",Ut)}finally{nn.delete(Xe.id)}}else o.addImage(Xe.id,Xe.data,Xe.options),u.add(Xe.id),Yt.set(u)}let fn,mn,qe,Ge;function gt(Xe){return de(),cn(Ot,o=new Qr.Map(Fa({container:Xe,style:x,locale:Ue,center:T,zoom:z,pitch:L,bearing:E,minZoom:H,maxZoom:q,minPitch:J,maxPitch:he,renderWorldCopies:Ee,dragPan:Y,dragRotate:oe,pitchWithRotate:ke,antialias:ye,interactive:De,preserveDrawingBuffer:Ze,maxBounds:at,bounds:I,attributionControl:Le,transformRequest:xt,cooperativeGestures:lt})),o),o.on("load",it=>{it.target.getContainer().setAttribute("data-testid","map"),it.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,K=!0),Mt("load",o)}),o.on("error",it=>Mt("error",{...it,map:o})),o.on("movestart",it=>Mt("movestart",{...it,map:o})),o.on("moveend",it=>{if(t(12,T=it.target.getCenter()),t(13,z=it.target.getZoom()),t(14,L=it.target.getPitch()),t(15,E=it.target.getBearing()),t(16,I=it.target.getBounds()),Mt("moveend",{...it,map:o}),O){let Ut=new URL(window.location.href.replace(/(#.+)?$/,MS(o)));B(Ut)}}),o.on("click",it=>Mt("click",{...it,map:o})),o.on("dblclick",it=>Mt("dblclick",{...it,map:o})),o.on("contextmenu",it=>Mt("contextmenu",{...it,map:o})),o.on("zoomstart",it=>Mt("zoomstart",{...it,map:o})),o.on("zoom",it=>{Mt("zoom",{...it,map:o})}),o.on("zoomend",it=>{Mt("zoomend",{...it,map:o})}),o.on("style.load",()=>{if(o){const it=o.getStyle();if(t(42,fn=it.layers.map(Ut=>Ut.id)),t(43,mn=Object.keys(it.sources)),Ge)for(const[Ut,Hn]of Object.entries(Ge))o.addSource(Ut,Hn);if(qe)for(const Ut of qe)o.addLayer(Ut);for(const Ut of dt)Qt(Ut,!0)}}),o.on("styledata",it=>{if(o&&Je){const Ut=o.getStyle().layers;if(Ut)for(let Hn of Ut)Je(Hn)||o.setLayoutProperty(Hn.id,"visibility","none")}Mt("styledata",{...it,map:o})}),{destroy(){t(0,K=!1),o==null||o.remove(),cn(Ot,o=null,o)}}}let et=x;function de(){if(O){let Xe=ES(window.location.hash);Xe.length>=3&&(t(13,z=Xe[0]),t(12,T=[Xe[2],Xe[1]])),Xe.length==5&&(t(15,E=Xe[3]),t(14,L=Xe[4]))}}function en(Xe){pn[Xe?"unshift":"push"](()=>{g=Xe,t(1,g)})}return r.$$set=Xe=>{"map"in Xe&&t(17,p=Xe.map),"mapContainer"in Xe&&t(1,g=Xe.mapContainer),"class"in Xe&&t(2,_=Xe.class),"style"in Xe&&t(18,x=Xe.style),"diffStyleUpdates"in Xe&&t(19,C=Xe.diffStyleUpdates),"center"in Xe&&t(12,T=Xe.center),"zoom"in Xe&&t(13,z=Xe.zoom),"pitch"in Xe&&t(14,L=Xe.pitch),"bearing"in Xe&&t(15,E=Xe.bearing),"bounds"in Xe&&t(16,I=Xe.bounds),"hash"in Xe&&t(20,O=Xe.hash),"updateHash"in Xe&&t(21,B=Xe.updateHash),"loaded"in Xe&&t(0,K=Xe.loaded),"minZoom"in Xe&&t(22,H=Xe.minZoom),"maxZoom"in Xe&&t(23,q=Xe.maxZoom),"minPitch"in Xe&&t(24,J=Xe.minPitch),"maxPitch"in Xe&&t(25,he=Xe.maxPitch),"renderWorldCopies"in Xe&&t(26,Ee=Xe.renderWorldCopies),"dragPan"in Xe&&t(27,Y=Xe.dragPan),"dragRotate"in Xe&&t(28,oe=Xe.dragRotate),"pitchWithRotate"in Xe&&t(29,ke=Xe.pitchWithRotate),"antialias"in Xe&&t(30,ye=Xe.antialias),"zoomOnDoubleClick"in Xe&&t(31,Ne=Xe.zoomOnDoubleClick),"locale"in Xe&&t(32,Ue=Xe.locale),"interactive"in Xe&&t(33,De=Xe.interactive),"attributionControl"in Xe&&t(34,Le=Xe.attributionControl),"cooperativeGestures"in Xe&&t(35,lt=Xe.cooperativeGestures),"preserveDrawingBuffer"in Xe&&t(36,Ze=Xe.preserveDrawingBuffer),"maxBounds"in Xe&&t(37,at=Xe.maxBounds),"images"in Xe&&t(38,dt=Xe.images),"standardControls"in Xe&&t(3,pt=Xe.standardControls),"filterLayers"in Xe&&t(39,Je=Xe.filterLayers),"transformRequest"in Xe&&t(40,xt=Xe.transformRequest),"$$scope"in Xe&&t(45,d=Xe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof pt=="boolean"?void 0:pt),r.$$.dirty[0]&16&&t(17,p=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!Fu(x,et)){const Xe=o.getStyle();if(fn&&(qe=Xe.layers.filter(it=>!fn.includes(it.id))),mn){const it=Object.keys(Xe.sources).filter(Ut=>!mn.includes(Ut));Ge={};for(const Ut of it)Ge[Ut]=Xe.sources[Ut]}t(44,et=x),o.setStyle(x,{diff:C}),cn(Yt,u=new Set,u),t(41,nn=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&K&&o!=null&&o.loaded())for(let Xe of dt)!u.has(Xe.id)&&!nn.has(Xe.id)&&!o.hasImage(Xe.id)&&Qt(Xe);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=dt.every(Xe=>u.has(Xe.id))),r.$$.dirty[0]&61456&&o){let Xe={};T!=null&&!Fu(T,o==null?void 0:o.getCenter())&&(Xe.center=T),z!=null&&!Fu(z,o==null?void 0:o.getZoom())&&(Xe.zoom=z),E!=null&&!Fu(E,o==null?void 0:o.getBearing())&&(Xe.bearing=E),L!=null&&!Fu(L,o==null?void 0:o.getPitch())&&(Xe.pitch=L),Object.keys(Xe).length&&o.easeTo(Xe)}r.$$.dirty[0]&65552&&I&&!Fu(I,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(I)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(Ne?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[K,g,_,pt,o,u,i,n,Ot,Yt,gt,de,T,z,L,E,I,p,x,C,O,B,H,q,J,he,Ee,Y,oe,ke,ye,Ne,Ue,De,Le,lt,Ze,at,dt,Je,xt,nn,fn,mn,et,d,s,en]}class OS extends Tt{constructor(e){super(),Ct(this,e,FS,BS,wt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const $S=r=>({marker:r&8}),yy=r=>({marker:r[3]});function NS(r){let e,t,n,i,o,u,s;const d=r[19].default,p=vn(d,r,r[18],yy);return{c(){e=U("div"),p&&p.c(),fe(e,"tabindex",t=r[1]?0:void 0),fe(e,"role",n=r[1]?"button":void 0),Ye(e,"z-index",r[2])},m(g,_){W(g,e,_),p&&p.m(e,null),o=!0,u||(s=[$m(r[7].call(null,e)),$m(i=jS.call(null,e,r[0])),Lt(e,"click",Sf(r[20])),Lt(e,"dblclick",Sf(r[21])),Lt(e,"contextmenu",Sf(Tg(r[22]))),Lt(e,"mouseenter",r[23]),Lt(e,"mouseleave",r[24]),Lt(e,"mousemove",r[25]),Lt(e,"keydown",r[8])],u=!0)},p(g,[_]){p&&p.p&&(!o||_&262152)&&wn(p,d,g,g[18],o?bn(d,g[18],_,$S):xn(g[18]),yy),(!o||_&2&&t!==(t=g[1]?0:void 0))&&fe(e,"tabindex",t),(!o||_&2&&n!==(n=g[1]?"button":void 0))&&fe(e,"role",n),i&&ua(i.update)&&_&1&&i.update.call(null,g[0]),_&4&&Ye(e,"z-index",g[2])},i(g){o||(N(p,g),o=!0)},o(g){V(p,g),o=!1},d(g){g&&G(e),p&&p.d(g),u=!1,hr(s)}}}function jS(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function US(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{marker:d=void 0}=e,{lngLat:p}=e,{class:g=void 0}=e,{interactive:_=!0}=e,{asButton:x=!1}=e,{draggable:C=!1}=e,{feature:T=null}=e,{offset:z=void 0}=e,{zIndex:L=void 0}=e,{rotation:E=0}=e,{opacity:I=1}=e;const O=$s(),{map:B,layerEvent:K,self:H,markerClickManager:q}=G4();st(r,B,Le=>t(27,o=Le)),st(r,K,Le=>t(26,n=Le)),st(r,H,Le=>t(3,i=Le));function J(Le){cn(H,i=new Qr.Marker({element:Le,rotation:E,draggable:C,offset:z,opacity:I.toString()}).setLngLat(p).addTo(o),i),t(11,d=i);const lt=()=>Y("dragstart"),Ze=()=>{he(),Y("drag")},at=()=>{he(),Y("dragend")};return C&&(i.on("dragstart",lt),i.on("drag",Ze),i.on("dragend",at)),{destroy(){C&&(i==null||i.off("dragstart",lt),i==null||i.off("drag",Ze),i==null||i.off("dragend",at)),t(11,d=void 0),i==null||i.remove()}}}function he(){let Le=i==null?void 0:i.getLngLat();Le&&(Array.isArray(p)?t(10,p=[Le.lng,Le.lat]):p&&"lon"in p?t(10,p={lon:Le.lng,lat:Le.lat}):t(10,p=Le))}function Ee(Le){Le.key===" "&&(Le.preventDefault(),Le.stopPropagation(),Y("click"))}function Y(Le){if(!_)return;let lt=i==null?void 0:i.getLngLat();if(!lt)return;const Ze=[lt.lng,lt.lat];let at={map:o,marker:i,lngLat:Ze,features:[{type:"Feature",properties:(T==null?void 0:T.properties)??{},geometry:{type:"Point",coordinates:Ze}}]};(Le==="click"||Le==="contextmenu")&&q.handleClick(at),cn(K,n={...at,layerType:"marker",type:Le},n),O(Le,at)}const oe=()=>Y("click"),ke=()=>Y("dblclick"),ye=()=>{Y("contextmenu")},Ne=()=>{Y("mouseenter")},Ue=()=>{Y("mouseleave")},De=()=>Y("mousemove");return r.$$set=Le=>{"marker"in Le&&t(11,d=Le.marker),"lngLat"in Le&&t(10,p=Le.lngLat),"class"in Le&&t(0,g=Le.class),"interactive"in Le&&t(12,_=Le.interactive),"asButton"in Le&&t(1,x=Le.asButton),"draggable"in Le&&t(13,C=Le.draggable),"feature"in Le&&t(14,T=Le.feature),"offset"in Le&&t(15,z=Le.offset),"zIndex"in Le&&t(2,L=Le.zIndex),"rotation"in Le&&t(16,E=Le.rotation),"opacity"in Le&&t(17,I=Le.opacity),"$$scope"in Le&&t(18,s=Le.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(p)),r.$$.dirty&32776&&(i==null||i.setOffset(z??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(E)),r.$$.dirty&131080&&(i==null||i.setOpacity(I.toString()))},[g,x,L,i,B,K,H,J,Ee,Y,p,d,_,C,T,z,E,I,s,u,oe,ke,ye,Ne,Ue,De]}class lp extends Tt{constructor(e){super(),Ct(this,e,US,NS,wt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const VS=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),vy=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function by(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof Qr.Marker)&&wy(r);return{c(){e=U("div"),n&&n.c()},m(o,u){W(o,e,u),n&&n.m(e,null),r[32](e),t=!0},p(o,u){var s;(s=o[4])!=null&&s.length||o[3]instanceof Qr.Marker?n?(n.p(o,u),u[0]&24&&N(n,1)):(n=wy(o),n.c(),N(n,1),n.m(e,null)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(o){t||(N(n),t=!0)},o(o){V(n),t=!1},d(o){o&&G(e),n&&n.d(),r[32](null)}}}function wy(r){let e;const t=r[30].default,n=vn(t,r,r[29],vy);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,VS):xn(i[29]),vy)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function qS(r){let e,t,n=r[9].default&&by(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=by(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function HS(r,e,t){let n,i,o,u,s,d,{$$slots:p={},$$scope:g}=e;const _=Cg(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:z=!1}=e,{openOn:L="click"}=e,{openIfTopMost:E=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:O=void 0}=e,{offset:B=void 0}=e,{popupClass:K=void 0}=e,{maxWidth:H=void 0}=e,{lngLat:q=void 0}=e,{html:J=void 0}=e,{open:he=!1}=e;const Ee=$s(),{map:Y,popupTarget:oe,layerEvent:ke,layer:ye,eventTopMost:Ne,markerClickManager:Ue}=Ha();st(r,Y,de=>t(2,o=de)),st(r,oe,de=>t(3,s=de)),st(r,ke,de=>t(28,u=de)),st(r,ye,de=>t(35,d=de));const De=["click","dblclick","contextmenu"];let Le,lt=!1,Ze;function at(){if(!Le)return;let de=Le.getElement();!de||de===Ze||(Ze=de,L==="hover"&&(Ze.style.pointerEvents="none"),Ze.addEventListener("mouseenter",()=>{t(24,lt=!0)},{passive:!0}),Ze.addEventListener("mouseleave",()=>{t(24,lt=!1)},{passive:!0}),Ze.addEventListener("click",()=>{T&&t(0,he=!1)},{passive:!0}))}ws(()=>{if(o)return o.on("click",mn),o.on("contextmenu",mn),Ue.add(qe),typeof s=="string"&&(o.on("click",s,Mt),o.on("dblclick",s,Mt),o.on("contextmenu",s,Mt),o.on("mousemove",s,fn),o.on("mouseleave",s,Qt),o.on("touchstart",s,Yt),o.on("touchend",s,nn)),()=>{o!=null&&o.loaded()&&(Le==null||Le.remove(),o.off("click",mn),o.off("contextmenu",mn),Ue.remove(qe),s instanceof Qr.Marker?s.getPopup()===Le&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Mt),o.off("dblclick",s,Mt),o.off("contextmenu",s,Mt),o.off("mousemove",s,fn),o.off("mouseleave",s,Qt),o.off("touchstart",s,Yt),o.off("touchend",s,nn)))}});function dt(de){return E?!("marker"in de)&&!W4(de)&&Ne(de)!==d:!1}let pt=null,Je="normal";function xt(de){"layerType"in de&&de.layerType==="deckgl"?(t(10,q=de.coordinate),t(4,pt=de.object?[de.object]:null)):(t(10,q=de.lngLat),t(4,pt=de.features??[]))}function Mt(de){de.type!==L||dt(de)||(xt(de),setTimeout(()=>t(0,he=!0)))}let Ot=null;function Yt(de){Ot=de.point}function nn(de){if(!Ot||L!=="hover")return;let en=Ot.dist(de.point);Ot=null,en<3&&(t(10,q=de.lngLat),t(4,pt=de.features??[]),Le.isOpen()?t(25,Je="justOpened"):(t(25,Je="opening"),t(0,he=!0)))}function Qt(de){L!=="hover"||Ot||Je!=="normal"||(t(0,he=!1),t(4,pt=null))}function fn(de){if(!(L!=="hover"||Ot||Je!=="normal")){if(dt(de)){t(0,he=!1),t(4,pt=null);return}t(0,he=!0),t(4,pt=de.features??[]),t(10,q=de.lngLat)}}function mn(de){if(Je==="justOpened"){t(25,Je="normal");return}if(!C)return;let en=[Ze,s instanceof Qr.Marker?s==null?void 0:s.getElement():null];he&&Le.isOpen()&&!en.some(Xe=>Xe==null?void 0:Xe.contains(de.originalEvent.target))&&(de.type==="contextmenu"&&L==="contextmenu"||de.type!=="contextmenu")&&t(0,he=!1)}function qe(de){C&&he&&Le.isOpen()&&de.marker!==s&&t(0,he=!1)}ei(()=>{o&&(Le!=null&&Le.isOpen())&&Le.remove()});let Ge;const gt=()=>t(0,he=!1);function et(de){pn[de?"unshift":"push"](()=>{Ge=de,t(1,Ge)})}return r.$$set=de=>{"closeButton"in de&&t(11,x=de.closeButton),"closeOnClickOutside"in de&&t(12,C=de.closeOnClickOutside),"closeOnClickInside"in de&&t(13,T=de.closeOnClickInside),"closeOnMove"in de&&t(14,z=de.closeOnMove),"openOn"in de&&t(15,L=de.openOn),"openIfTopMost"in de&&t(16,E=de.openIfTopMost),"focusAfterOpen"in de&&t(17,I=de.focusAfterOpen),"anchor"in de&&t(18,O=de.anchor),"offset"in de&&t(19,B=de.offset),"popupClass"in de&&t(20,K=de.popupClass),"maxWidth"in de&&t(21,H=de.maxWidth),"lngLat"in de&&t(10,q=de.lngLat),"html"in de&&t(22,J=de.html),"open"in de&&t(0,he=de.open),"$$scope"in de&&t(29,g=de.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!T)),r.$$.dirty[0]&146685952&&(Le||(t(23,Le=new Qr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:z,focusAfterOpen:I,maxWidth:H,className:K,anchor:O,offset:B})),Ze=Le.getElement(),Le.on("open",()=>{t(0,he=!0),at(),Ee("open",Le)}),Le.on("close",()=>{t(0,he=!1),Ee("close",Le)}),Le.on("hover",()=>{Ee("hover",Le)}))),r.$$.dirty[0]&8421384&&Le&&s instanceof Qr.Marker&&(L==="click"?s.setPopup(Le):s.getPopup()===Le&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&De.includes(L)&&(u==null?void 0:u.type)===L&&(Mt(u),cn(ke,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=L==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&L==="hover"&&ke&&(i&&u&&xt(u),t(0,he=(i||lt)??!1)),r.$$.dirty[0]&12582914&&(Ge?Le.setDOMContent(Ge):J&&Le.setHTML(J)),r.$$.dirty[0]&8389632&&q&&Le.setLngLat(q),r.$$.dirty[0]&41943045&&o){let de=Le.isOpen();he&&!de?(Le.addTo(o),Je==="opening"&&t(25,Je="justOpened")):!he&&de&&Le.remove()}},[he,Ge,o,s,pt,Y,oe,ke,ye,_,q,x,C,T,z,L,E,I,O,B,K,H,J,Le,lt,Je,i,n,u,g,p,gt,et]}let Nw=class extends Tt{constructor(e){super(),Ct(this,e,HS,qS,wt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var Xu=Math.pow,Zi=(r,e,t)=>new Promise((n,i)=>{var o=d=>{try{s(t.next(d))}catch(p){i(p)}},u=d=>{try{s(t.throw(d))}catch(p){i(p)}},s=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,u);s((t=t.apply(r,e)).next())}),$o=Uint8Array,Wu=Uint16Array,GS=Int32Array,jw=new $o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Uw=new $o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),WS=new $o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vw=function(r,e){for(var t=new Wu(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new GS(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},qw=Vw(jw,2),Hw=qw.b,ZS=qw.r;Hw[28]=258,ZS[258]=28;var XS=Vw(Uw,0),KS=XS.b,Ym=new Wu(32768);for(pr=0;pr<32768;++pr)ta=(pr&43690)>>1|(pr&21845)<<1,ta=(ta&52428)>>2|(ta&13107)<<2,ta=(ta&61680)>>4|(ta&3855)<<4,Ym[pr]=((ta&65280)>>8|(ta&255)<<8)>>1;var ta,pr,Pf=function(r,e,t){for(var n=r.length,i=0,o=new Wu(e);i<n;++i)r[i]&&++o[r[i]-1];var u=new Wu(e);for(i=1;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;var s;if(t){s=new Wu(1<<e);var d=15-e;for(i=0;i<n;++i)if(r[i])for(var p=i<<4|r[i],g=e-r[i],_=u[r[i]-1]++<<g,x=_|(1<<g)-1;_<=x;++_)s[Ym[_]>>d]=p}else for(s=new Wu(n),i=0;i<n;++i)r[i]&&(s[i]=Ym[u[r[i]-1]++]>>15-r[i]);return s},eh=new $o(288);for(pr=0;pr<144;++pr)eh[pr]=8;var pr;for(pr=144;pr<256;++pr)eh[pr]=9;var pr;for(pr=256;pr<280;++pr)eh[pr]=7;var pr;for(pr=280;pr<288;++pr)eh[pr]=8;var pr,Gw=new $o(32);for(pr=0;pr<32;++pr)Gw[pr]=5;var pr,JS=Pf(eh,9,1),YS=Pf(Gw,5,1),Cm=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ds=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Tm=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},QS=function(r){return(r+7)/8|0},e5=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new $o(t-e);return n.set(r.subarray(e,t)),n},t5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ro=function(r,e,t){var n=new Error(e||t5[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Ro),!t)throw n;return n},Hg=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new $o(0);var u=!t||e.i!=2,s=e.i;t||(t=new $o(i*3));var d=function(Qt){var fn=t.length;if(Qt>fn){var mn=new $o(Math.max(fn*2,Qt));mn.set(t),t=mn}},p=e.f||0,g=e.p||0,_=e.b||0,x=e.l,C=e.d,T=e.m,z=e.n,L=i*8;do{if(!x){p=ds(r,g,1);var E=ds(r,g+1,3);if(g+=3,E)if(E==1)x=JS,C=YS,T=9,z=5;else if(E==2){var K=ds(r,g,31)+257,H=ds(r,g+10,15)+4,q=K+ds(r,g+5,31)+1;g+=14;for(var J=new $o(q),he=new $o(19),Ee=0;Ee<H;++Ee)he[WS[Ee]]=ds(r,g+Ee*3,7);g+=H*3;for(var Y=Cm(he),oe=(1<<Y)-1,ke=Pf(he,Y,1),Ee=0;Ee<q;){var ye=ke[ds(r,g,oe)];g+=ye&15;var I=ye>>4;if(I<16)J[Ee++]=I;else{var Ne=0,Ue=0;for(I==16?(Ue=3+ds(r,g,3),g+=2,Ne=J[Ee-1]):I==17?(Ue=3+ds(r,g,7),g+=3):I==18&&(Ue=11+ds(r,g,127),g+=7);Ue--;)J[Ee++]=Ne}}var De=J.subarray(0,K),Le=J.subarray(K);T=Cm(De),z=Cm(Le),x=Pf(De,T,1),C=Pf(Le,z,1)}else Ro(1);else{var I=QS(g)+4,O=r[I-4]|r[I-3]<<8,B=I+O;if(B>i){s&&Ro(0);break}u&&d(_+O),t.set(r.subarray(I,B),_),e.b=_+=O,e.p=g=B*8,e.f=p;continue}if(g>L){s&&Ro(0);break}}u&&d(_+131072);for(var lt=(1<<T)-1,Ze=(1<<z)-1,at=g;;at=g){var Ne=x[Tm(r,g)&lt],dt=Ne>>4;if(g+=Ne&15,g>L){s&&Ro(0);break}if(Ne||Ro(2),dt<256)t[_++]=dt;else if(dt==256){at=g,x=null;break}else{var pt=dt-254;if(dt>264){var Ee=dt-257,Je=jw[Ee];pt=ds(r,g,(1<<Je)-1)+Hw[Ee],g+=Je}var xt=C[Tm(r,g)&Ze],Mt=xt>>4;xt||Ro(3),g+=xt&15;var Le=KS[Mt];if(Mt>3){var Je=Uw[Mt];Le+=Tm(r,g)&(1<<Je)-1,g+=Je}if(g>L){s&&Ro(0);break}u&&d(_+131072);var Ot=_+pt;if(_<Le){var Yt=o-Le,nn=Math.min(Le,Ot);for(Yt+_<0&&Ro(3);_<nn;++_)t[_]=n[Yt+_]}for(;_<Ot;_+=4)t[_]=t[_-Le],t[_+1]=t[_+1-Le],t[_+2]=t[_+2-Le],t[_+3]=t[_+3-Le];_=Ot}}e.l=x,e.p=at,e.b=_,e.f=p,x&&(p=1,e.m=T,e.d=C,e.n=z)}while(!p);return _==t.length?t:e5(t,0,_)},n5=new $o(0),r5=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Ro(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},i5=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},o5=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Ro(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Ro(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function s5(r,e){return Hg(r,{i:2},e&&e.out,e&&e.dictionary)}function a5(r,e){var t=r5(r);return t+8>r.length&&Ro(6,"invalid gzip data"),Hg(r.subarray(t,-8),{i:2},e&&e.out||new $o(i5(r)),e&&e.dictionary)}function l5(r,e){return Hg(r.subarray(o5(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function Qm(r,e){return r[0]==31&&r[1]==139&&r[2]==8?a5(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?s5(r,e):l5(r,e)}var u5=typeof TextDecoder<"u"&&new TextDecoder,c5=0;try{u5.decode(n5,{stream:!0}),c5=1}catch{}var Ww=(r,e)=>r*Xu(2,e),ff=(r,e)=>Math.floor(r/Xu(2,e)),Yd=(r,e)=>Ww(r.getUint16(e+1,!0),8)+r.getUint8(e),Zw=(r,e)=>Ww(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),f5=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=Yd(n,i+1);if(e!==o)return e-o;const u=Yd(n,i+4);return t!==u?t-u:0},h5=(r,e,t,n)=>{const i=Xw(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},xy=(r,e,t,n)=>{const i=Xw(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},Xw=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const u=o+i>>1,s=f5(e,t,n,r,u*17);if(s>0)i=u+1;else if(s<0)o=u-1;else return[Zw(r,u*17+7),r.getUint32(u*17+13,!0)]}return null},d5=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,Kw=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:Yd(r,e*17+1),y:Yd(r,e*17+4),offset:Zw(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},Ay=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(Kw(t,n));return p5(e)},p5=r=>{r.sort(d5);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=ff(i.offset,8)&255,t[n*17+9]=ff(i.offset,16)&255,t[n*17+10]=ff(i.offset,24)&255,t[n*17+11]=ff(i.offset,32)&255,t[n*17+12]=ff(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},m5=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=Kw(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,u=Math.trunc(e.x/(1<<o)),s=Math.trunc(e.y/(1<<o));return{z:i,x:u,y:s}}return null};function g5(r){return Zi(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),u=JSON.parse(o.decode(new DataView(e.data,10,n)));let s=0;u.compression==="gzip"&&(s=2);let d=0;"minzoom"in u&&(d=+u.minzoom);let p=0;"maxzoom"in u&&(p=+u.maxzoom);let g=0,_=0,x=0,C=-180,T=-85,z=180,L=85;if(u.bounds){const I=u.bounds.split(",");C=+I[0],T=+I[1],z=+I[2],L=+I[3]}if(u.center){const I=u.center.split(",");g=+I[0],_=+I[1],x=+I[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:d,maxZoom:p,minLon:C,minLat:T,maxLon:z,maxLat:L,centerZoom:x,centerLon:g,centerLat:_,etag:e.etag}})}function _5(r,e,t,n,i,o,u){return Zi(this,null,function*(){let s=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(s=Ay(s));const d=xy(new DataView(s),n,i,o);if(d){let _=(yield e.getBytes(d.offset,d.length,u)).data;const x=new DataView(_);return x.getUint8(0)===31&&x.getUint8(1)===139&&(_=Qm(new Uint8Array(_))),{data:_}}const p=m5(new DataView(s),{z:n,x:i,y:o});if(p){const g=h5(new DataView(s),p.z,p.x,p.y);if(g){let _=yield t.getArrayBuffer(e,g.offset,g.length,r);r.specVersion===1&&(_=Ay(_));const x=xy(new DataView(_),n,i,o);if(x){let T=(yield e.getBytes(x.offset,x.length,u)).data;const z=new DataView(T);return z.getUint8(0)===31&&z.getUint8(1)===139&&(T=Qm(new Uint8Array(T))),{data:T}}}}})}var Jw={getHeader:g5,getZxy:_5},y5=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},v5=class{constructor(){this.tilev4=(r,e)=>Zi(this,null,function*(){if(r.type==="json"){const _=r.url.substr(10);let x=this.tiles.get(_);x||(x=new ky(_),this.tiles.set(_,x));const C=yield x.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:C.minZoom,maxzoom:C.maxZoom,bounds:[C.minLon,C.minLat,C.maxLon,C.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=r.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const i=n[1];let o=this.tiles.get(i);o||(o=new ky(i),this.tiles.set(i,o));const u=n[2],s=n[3],d=n[4],p=yield o.getHeader(),g=yield o==null?void 0:o.getZxy(+u,+s,+d,e.signal);return g?{data:new Uint8Array(g.data),cacheControl:g.cacheControl,expires:g.expires}:p.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=y5(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function Ou(r,e){return(e>>>0)*4294967296+(r>>>0)}function b5(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return Ou(r,i);throw new Error("Expected varint not more than 10 bytes")}function hf(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,b5(n,r))}function w5(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var x5=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function A5(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Xu(2,r)-1||t>Xu(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=x5[r],i=Xu(2,r);let o=0,u=0,s=0;const d=[e,t];let p=i/2;for(;p>0;)o=(d[0]&p)>0?1:0,u=(d[1]&p)>0?1:0,s+=p*p*(3*o^u),w5(p,d,o,u),p=p/2;return n+s}function Yw(r,e){return Zi(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Qm(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var k5=127;function S5(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var C5=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Zi(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const u=new Headers(this.customHeaders);u.set("range",`bytes=${r}-${r+e-1}`);let s;this.mustReload&&(s="reload");let d=yield fetch(this.url,{signal:o,cache:s,headers:u});if(r===0&&d.status===416){const x=d.headers.get("Content-Range");if(!x||!x.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const C=+x.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${C-1}`}})}let p=d.headers.get("Etag");if(p!=null&&p.startsWith("W/")&&(p=null),d.status===416||n&&p&&p!==n)throw this.mustReload=!0,new eg(n);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const g=d.headers.get("Content-Length");if(d.status===200&&(!g||+g>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function ps(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Xu(2,32)+n}function T5(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:ps(t,8),rootDirectoryLength:ps(t,16),jsonMetadataOffset:ps(t,24),jsonMetadataLength:ps(t,32),leafDirectoryOffset:ps(t,40),leafDirectoryLength:ps(t,48),tileDataOffset:ps(t,56),tileDataLength:ps(t,64),numAddressedTiles:ps(t,72),numTileEntries:ps(t,80),numTileContents:ps(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Qw(r){const e={buf:new Uint8Array(r),pos:0},t=hf(e),n=[];let i=0;for(let o=0;o<t;o++){const u=hf(e);n.push({tileId:i+u,offset:0,length:0,runLength:1}),i+=u}for(let o=0;o<t;o++)n[o].runLength=hf(e);for(let o=0;o<t;o++)n[o].length=hf(e);for(let o=0;o<t;o++){const u=hf(e);u===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=u-1}return n}function M5(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var eg=class extends Error{};function E5(r,e){return Zi(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(M5(t.data)<3)return[yield Jw.getHeader(r)];const i=t.data.slice(0,k5),o=T5(i,t.etag),u=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),s=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=Qw(yield e(u,o.internalCompression));return[o,[s,d.length,d]]})}function L5(r,e,t,n,i){return Zi(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),u=yield e(o.data,i.internalCompression),s=Qw(u);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var I5=class{constructor(r=100,e=!0,t=Yw){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Zi(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{E5(r,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),i(u[0]),this.prune()}).catch(u=>{o(u)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Zi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,d)=>{L5(r,this.decompress,e,t,n).then(p=>{s(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}getArrayBuffer(r,e,t,n){return Zi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,d)=>{r.getBytes(e,t,void 0,n.etag).then(p=>{s(p.data),this.cache.has(i),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Zi(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},ky=class{constructor(r,e,t){typeof r=="string"?this.source=new C5(r):this.source=r,t?this.decompress=t:this.decompress=Yw,e?this.cache=e:this.cache=new I5}getHeader(){return Zi(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Zi(this,null,function*(){const i=A5(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Jw.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let u=o.rootDirectoryOffset,s=o.rootDirectoryLength;for(let d=0;d<=3;d++){const p=yield this.cache.getDirectory(this.source,u,s,o),g=S5(p,i);if(g){if(g.runLength>0){const _=yield this.source.getBytes(o.tileDataOffset+g.offset,g.length,n,o.etag);return{data:yield this.decompress(_.data,o.tileCompression),cacheControl:_.cacheControl,expires:_.expires}}u=o.leafDirectoryOffset+g.offset,s=g.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Zi(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof eg)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Zi(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Zi(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof eg)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};function P5(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function z5(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[P5]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Qf({props:o}),pn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function D5(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=qa("symbol")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g=void 0}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:E=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:B=!0}=e;function K(oe){I=oe,t(0,I)}function H(oe){Sn.call(this,r,oe)}function q(oe){Sn.call(this,r,oe)}function J(oe){Sn.call(this,r,oe)}function he(oe){Sn.call(this,r,oe)}function Ee(oe){Sn.call(this,r,oe)}function Y(oe){Sn.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,o=oe.id),"source"in oe&&t(2,u=oe.source),"sourceLayer"in oe&&t(3,s=oe.sourceLayer),"beforeId"in oe&&t(4,d=oe.beforeId),"beforeLayerType"in oe&&t(5,p=oe.beforeLayerType),"paint"in oe&&t(6,g=oe.paint),"layout"in oe&&t(7,_=oe.layout),"filter"in oe&&t(8,x=oe.filter),"applyToClusters"in oe&&t(9,C=oe.applyToClusters),"minzoom"in oe&&t(10,T=oe.minzoom),"maxzoom"in oe&&t(11,z=oe.maxzoom),"hoverCursor"in oe&&t(12,L=oe.hoverCursor),"manageHoverState"in oe&&t(13,E=oe.manageHoverState),"hovered"in oe&&t(0,I=oe.hovered),"eventsIfTopMost"in oe&&t(14,O=oe.eventsIfTopMost),"interactive"in oe&&t(15,B=oe.interactive),"$$scope"in oe&&t(24,i=oe.$$scope)},[I,o,u,s,d,p,g,_,x,C,T,z,L,E,O,B,n,K,H,q,J,he,Ee,Y,i]}class ec extends Tt{constructor(e){super(),Ct(this,e,D5,z5,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Sy(r){let e=r[0],t,n,i=Cy(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&wt(e,e=o[0])?(Kt(),V(i,1,1,ft),Jt(),i=Cy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function Cy(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function R5(r){let e,t,n=r[0]&&Sy(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Sy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function B5(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e,{id:s=qa("vector")}=e,{url:d=null}=e,{tiles:p=null}=e,{promoteId:g=null}=e,{bounds:_=null}=e,{scheme:x=null}=e,{attribution:C=null}=e,{minzoom:T=null}=e,{maxzoom:z=null}=e,{volatile:L=null}=e;if(d&&d.includes("pmtiles://")&&!Qr.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let B=new v5;Qr.addProtocol("pmtiles",B.tile)}const{map:E,self:I}=Pw();st(r,E,B=>t(13,i=B)),st(r,I,B=>t(0,n=B));let O;return ei(()=>{n&&i&&(Fw(E,n,O),cn(I,n=null,n),O=void 0)}),r.$$set=B=>{"id"in B&&t(3,s=B.id),"url"in B&&t(4,d=B.url),"tiles"in B&&t(5,p=B.tiles),"promoteId"in B&&t(6,g=B.promoteId),"bounds"in B&&t(7,_=B.bounds),"scheme"in B&&t(8,x=B.scheme),"attribution"in B&&t(9,C=B.attribution),"minzoom"in B&&t(10,T=B.minzoom),"maxzoom"in B&&t(11,z=B.maxzoom),"volatile"in B&&t(12,L=B.volatile),"$$scope"in B&&t(14,u=B.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==s&&(cn(I,n=s,n),Bw(i,n,Fa({type:"vector",url:d,tiles:p,promoteId:g,bounds:_,scheme:x,attribution:C,minzoom:T,maxzoom:z,volatile:L}),B=>i&&B===n,()=>{n&&(O=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{O=i==null?void 0:i.getSource(s)}))},[n,E,I,s,d,p,g,_,x,C,T,z,L,i,u,o]}class th extends Tt{constructor(e){super(),Ct(this,e,B5,R5,wt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}var vo="top",os="bottom",ss="right",bo="left",Gg="auto",nh=[vo,os,ss,bo],tc="start",Uf="end",F5="clippingParents",e2="viewport",df="popper",O5="reference",Ty=nh.reduce(function(r,e){return r.concat([e+"-"+tc,e+"-"+Uf])},[]),t2=[].concat(nh,[Gg]).reduce(function(r,e){return r.concat([e,e+"-"+tc,e+"-"+Uf])},[]),$5="beforeRead",N5="read",j5="afterRead",U5="beforeMain",V5="main",q5="afterMain",H5="beforeWrite",G5="write",W5="afterWrite",Z5=[$5,N5,j5,U5,V5,q5,H5,G5,W5];function Os(r){return r?(r.nodeName||"").toLowerCase():null}function No(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function Dl(r){var e=No(r).Element;return r instanceof e||r instanceof Element}function ts(r){var e=No(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function Wg(r){if(typeof ShadowRoot>"u")return!1;var e=No(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function X5(r){var e=r.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},o=e.elements[t];!ts(o)||!Os(o)||(Object.assign(o.style,n),Object.keys(i).forEach(function(u){var s=i[u];s===!1?o.removeAttribute(u):o.setAttribute(u,s===!0?"":s)}))})}function K5(r){var e=r.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],o=e.attributes[n]||{},u=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]),s=u.reduce(function(d,p){return d[p]="",d},{});!ts(i)||!Os(i)||(Object.assign(i.style,s),Object.keys(o).forEach(function(d){i.removeAttribute(d)}))})}}const n2={name:"applyStyles",enabled:!0,phase:"write",fn:X5,effect:K5,requires:["computeStyles"]};function Bs(r){return r.split("-")[0]}var Il=Math.max,Qd=Math.min,nc=Math.round;function tg(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function r2(){return!/^((?!chrome|android).)*safari/i.test(tg())}function rc(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=r.getBoundingClientRect(),i=1,o=1;e&&ts(r)&&(i=r.offsetWidth>0&&nc(n.width)/r.offsetWidth||1,o=r.offsetHeight>0&&nc(n.height)/r.offsetHeight||1);var u=Dl(r)?No(r):window,s=u.visualViewport,d=!r2()&&t,p=(n.left+(d&&s?s.offsetLeft:0))/i,g=(n.top+(d&&s?s.offsetTop:0))/o,_=n.width/i,x=n.height/o;return{width:_,height:x,top:g,right:p+_,bottom:g+x,left:p,x:p,y:g}}function Zg(r){var e=rc(r),t=r.offsetWidth,n=r.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:r.offsetLeft,y:r.offsetTop,width:t,height:n}}function i2(r,e){var t=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(t&&Wg(t)){var n=e;do{if(n&&r.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function sa(r){return No(r).getComputedStyle(r)}function J5(r){return["table","td","th"].indexOf(Os(r))>=0}function Ga(r){return((Dl(r)?r.ownerDocument:r.document)||window.document).documentElement}function up(r){return Os(r)==="html"?r:r.assignedSlot||r.parentNode||(Wg(r)?r.host:null)||Ga(r)}function My(r){return!ts(r)||sa(r).position==="fixed"?null:r.offsetParent}function Y5(r){var e=/firefox/i.test(tg()),t=/Trident/i.test(tg());if(t&&ts(r)){var n=sa(r);if(n.position==="fixed")return null}var i=up(r);for(Wg(i)&&(i=i.host);ts(i)&&["html","body"].indexOf(Os(i))<0;){var o=sa(i);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return i;i=i.parentNode}return null}function rh(r){for(var e=No(r),t=My(r);t&&J5(t)&&sa(t).position==="static";)t=My(t);return t&&(Os(t)==="html"||Os(t)==="body"&&sa(t).position==="static")?e:t||Y5(r)||e}function Xg(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function zf(r,e,t){return Il(r,Qd(e,t))}function Q5(r,e,t){var n=zf(r,e,t);return n>t?t:n}function o2(){return{top:0,right:0,bottom:0,left:0}}function s2(r){return Object.assign({},o2(),r)}function a2(r,e){return e.reduce(function(t,n){return t[n]=r,t},{})}var eC=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,s2(typeof e!="number"?e:a2(e,nh))};function tC(r){var e,t=r.state,n=r.name,i=r.options,o=t.elements.arrow,u=t.modifiersData.popperOffsets,s=Bs(t.placement),d=Xg(s),p=[bo,ss].indexOf(s)>=0,g=p?"height":"width";if(!(!o||!u)){var _=eC(i.padding,t),x=Zg(o),C=d==="y"?vo:bo,T=d==="y"?os:ss,z=t.rects.reference[g]+t.rects.reference[d]-u[d]-t.rects.popper[g],L=u[d]-t.rects.reference[d],E=rh(o),I=E?d==="y"?E.clientHeight||0:E.clientWidth||0:0,O=z/2-L/2,B=_[C],K=I-x[g]-_[T],H=I/2-x[g]/2+O,q=zf(B,H,K),J=d;t.modifiersData[n]=(e={},e[J]=q,e.centerOffset=q-H,e)}}function nC(r){var e=r.state,t=r.options,n=t.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||i2(e.elements.popper,i)&&(e.elements.arrow=i))}const rC={name:"arrow",enabled:!0,phase:"main",fn:tC,effect:nC,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ic(r){return r.split("-")[1]}var iC={top:"auto",right:"auto",bottom:"auto",left:"auto"};function oC(r,e){var t=r.x,n=r.y,i=e.devicePixelRatio||1;return{x:nc(t*i)/i||0,y:nc(n*i)/i||0}}function Ey(r){var e,t=r.popper,n=r.popperRect,i=r.placement,o=r.variation,u=r.offsets,s=r.position,d=r.gpuAcceleration,p=r.adaptive,g=r.roundOffsets,_=r.isFixed,x=u.x,C=x===void 0?0:x,T=u.y,z=T===void 0?0:T,L=typeof g=="function"?g({x:C,y:z}):{x:C,y:z};C=L.x,z=L.y;var E=u.hasOwnProperty("x"),I=u.hasOwnProperty("y"),O=bo,B=vo,K=window;if(p){var H=rh(t),q="clientHeight",J="clientWidth";if(H===No(t)&&(H=Ga(t),sa(H).position!=="static"&&s==="absolute"&&(q="scrollHeight",J="scrollWidth")),H=H,i===vo||(i===bo||i===ss)&&o===Uf){B=os;var he=_&&H===K&&K.visualViewport?K.visualViewport.height:H[q];z-=he-n.height,z*=d?1:-1}if(i===bo||(i===vo||i===os)&&o===Uf){O=ss;var Ee=_&&H===K&&K.visualViewport?K.visualViewport.width:H[J];C-=Ee-n.width,C*=d?1:-1}}var Y=Object.assign({position:s},p&&iC),oe=g===!0?oC({x:C,y:z},No(t)):{x:C,y:z};if(C=oe.x,z=oe.y,d){var ke;return Object.assign({},Y,(ke={},ke[B]=I?"0":"",ke[O]=E?"0":"",ke.transform=(K.devicePixelRatio||1)<=1?"translate("+C+"px, "+z+"px)":"translate3d("+C+"px, "+z+"px, 0)",ke))}return Object.assign({},Y,(e={},e[B]=I?z+"px":"",e[O]=E?C+"px":"",e.transform="",e))}function sC(r){var e=r.state,t=r.options,n=t.gpuAcceleration,i=n===void 0?!0:n,o=t.adaptive,u=o===void 0?!0:o,s=t.roundOffsets,d=s===void 0?!0:s,p={placement:Bs(e.placement),variation:ic(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Ey(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:u,roundOffsets:d})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Ey(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:d})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const aC={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:sC,data:{}};var Ad={passive:!0};function lC(r){var e=r.state,t=r.instance,n=r.options,i=n.scroll,o=i===void 0?!0:i,u=n.resize,s=u===void 0?!0:u,d=No(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&p.forEach(function(g){g.addEventListener("scroll",t.update,Ad)}),s&&d.addEventListener("resize",t.update,Ad),function(){o&&p.forEach(function(g){g.removeEventListener("scroll",t.update,Ad)}),s&&d.removeEventListener("resize",t.update,Ad)}}const uC={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:lC,data:{}};var cC={left:"right",right:"left",bottom:"top",top:"bottom"};function Bd(r){return r.replace(/left|right|bottom|top/g,function(e){return cC[e]})}var fC={start:"end",end:"start"};function Ly(r){return r.replace(/start|end/g,function(e){return fC[e]})}function Kg(r){var e=No(r),t=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:t,scrollTop:n}}function Jg(r){return rc(Ga(r)).left+Kg(r).scrollLeft}function hC(r,e){var t=No(r),n=Ga(r),i=t.visualViewport,o=n.clientWidth,u=n.clientHeight,s=0,d=0;if(i){o=i.width,u=i.height;var p=r2();(p||!p&&e==="fixed")&&(s=i.offsetLeft,d=i.offsetTop)}return{width:o,height:u,x:s+Jg(r),y:d}}function dC(r){var e,t=Ga(r),n=Kg(r),i=(e=r.ownerDocument)==null?void 0:e.body,o=Il(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),u=Il(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-n.scrollLeft+Jg(r),d=-n.scrollTop;return sa(i||t).direction==="rtl"&&(s+=Il(t.clientWidth,i?i.clientWidth:0)-o),{width:o,height:u,x:s,y:d}}function Yg(r){var e=sa(r),t=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+n)}function l2(r){return["html","body","#document"].indexOf(Os(r))>=0?r.ownerDocument.body:ts(r)&&Yg(r)?r:l2(up(r))}function Df(r,e){var t;e===void 0&&(e=[]);var n=l2(r),i=n===((t=r.ownerDocument)==null?void 0:t.body),o=No(n),u=i?[o].concat(o.visualViewport||[],Yg(n)?n:[]):n,s=e.concat(u);return i?s:s.concat(Df(up(u)))}function ng(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function pC(r,e){var t=rc(r,!1,e==="fixed");return t.top=t.top+r.clientTop,t.left=t.left+r.clientLeft,t.bottom=t.top+r.clientHeight,t.right=t.left+r.clientWidth,t.width=r.clientWidth,t.height=r.clientHeight,t.x=t.left,t.y=t.top,t}function Iy(r,e,t){return e===e2?ng(hC(r,t)):Dl(e)?pC(e,t):ng(dC(Ga(r)))}function mC(r){var e=Df(up(r)),t=["absolute","fixed"].indexOf(sa(r).position)>=0,n=t&&ts(r)?rh(r):r;return Dl(n)?e.filter(function(i){return Dl(i)&&i2(i,n)&&Os(i)!=="body"}):[]}function gC(r,e,t,n){var i=e==="clippingParents"?mC(r):[].concat(e),o=[].concat(i,[t]),u=o[0],s=o.reduce(function(d,p){var g=Iy(r,p,n);return d.top=Il(g.top,d.top),d.right=Qd(g.right,d.right),d.bottom=Qd(g.bottom,d.bottom),d.left=Il(g.left,d.left),d},Iy(r,u,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function u2(r){var e=r.reference,t=r.element,n=r.placement,i=n?Bs(n):null,o=n?ic(n):null,u=e.x+e.width/2-t.width/2,s=e.y+e.height/2-t.height/2,d;switch(i){case vo:d={x:u,y:e.y-t.height};break;case os:d={x:u,y:e.y+e.height};break;case ss:d={x:e.x+e.width,y:s};break;case bo:d={x:e.x-t.width,y:s};break;default:d={x:e.x,y:e.y}}var p=i?Xg(i):null;if(p!=null){var g=p==="y"?"height":"width";switch(o){case tc:d[p]=d[p]-(e[g]/2-t[g]/2);break;case Uf:d[p]=d[p]+(e[g]/2-t[g]/2);break}}return d}function Vf(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=n===void 0?r.placement:n,o=t.strategy,u=o===void 0?r.strategy:o,s=t.boundary,d=s===void 0?F5:s,p=t.rootBoundary,g=p===void 0?e2:p,_=t.elementContext,x=_===void 0?df:_,C=t.altBoundary,T=C===void 0?!1:C,z=t.padding,L=z===void 0?0:z,E=s2(typeof L!="number"?L:a2(L,nh)),I=x===df?O5:df,O=r.rects.popper,B=r.elements[T?I:x],K=gC(Dl(B)?B:B.contextElement||Ga(r.elements.popper),d,g,u),H=rc(r.elements.reference),q=u2({reference:H,element:O,strategy:"absolute",placement:i}),J=ng(Object.assign({},O,q)),he=x===df?J:H,Ee={top:K.top-he.top+E.top,bottom:he.bottom-K.bottom+E.bottom,left:K.left-he.left+E.left,right:he.right-K.right+E.right},Y=r.modifiersData.offset;if(x===df&&Y){var oe=Y[i];Object.keys(Ee).forEach(function(ke){var ye=[ss,os].indexOf(ke)>=0?1:-1,Ne=[vo,os].indexOf(ke)>=0?"y":"x";Ee[ke]+=oe[Ne]*ye})}return Ee}function _C(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=t.boundary,o=t.rootBoundary,u=t.padding,s=t.flipVariations,d=t.allowedAutoPlacements,p=d===void 0?t2:d,g=ic(n),_=g?s?Ty:Ty.filter(function(T){return ic(T)===g}):nh,x=_.filter(function(T){return p.indexOf(T)>=0});x.length===0&&(x=_);var C=x.reduce(function(T,z){return T[z]=Vf(r,{placement:z,boundary:i,rootBoundary:o,padding:u})[Bs(z)],T},{});return Object.keys(C).sort(function(T,z){return C[T]-C[z]})}function yC(r){if(Bs(r)===Gg)return[];var e=Bd(r);return[Ly(r),e,Ly(e)]}function vC(r){var e=r.state,t=r.options,n=r.name;if(!e.modifiersData[n]._skip){for(var i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!0:u,d=t.fallbackPlacements,p=t.padding,g=t.boundary,_=t.rootBoundary,x=t.altBoundary,C=t.flipVariations,T=C===void 0?!0:C,z=t.allowedAutoPlacements,L=e.options.placement,E=Bs(L),I=E===L,O=d||(I||!T?[Bd(L)]:yC(L)),B=[L].concat(O).reduce(function(Je,xt){return Je.concat(Bs(xt)===Gg?_C(e,{placement:xt,boundary:g,rootBoundary:_,padding:p,flipVariations:T,allowedAutoPlacements:z}):xt)},[]),K=e.rects.reference,H=e.rects.popper,q=new Map,J=!0,he=B[0],Ee=0;Ee<B.length;Ee++){var Y=B[Ee],oe=Bs(Y),ke=ic(Y)===tc,ye=[vo,os].indexOf(oe)>=0,Ne=ye?"width":"height",Ue=Vf(e,{placement:Y,boundary:g,rootBoundary:_,altBoundary:x,padding:p}),De=ye?ke?ss:bo:ke?os:vo;K[Ne]>H[Ne]&&(De=Bd(De));var Le=Bd(De),lt=[];if(o&&lt.push(Ue[oe]<=0),s&&lt.push(Ue[De]<=0,Ue[Le]<=0),lt.every(function(Je){return Je})){he=Y,J=!1;break}q.set(Y,lt)}if(J)for(var Ze=T?3:1,at=function(xt){var Mt=B.find(function(Ot){var Yt=q.get(Ot);if(Yt)return Yt.slice(0,xt).every(function(nn){return nn})});if(Mt)return he=Mt,"break"},dt=Ze;dt>0;dt--){var pt=at(dt);if(pt==="break")break}e.placement!==he&&(e.modifiersData[n]._skip=!0,e.placement=he,e.reset=!0)}}const bC={name:"flip",enabled:!0,phase:"main",fn:vC,requiresIfExists:["offset"],data:{_skip:!1}};function Py(r,e,t){return t===void 0&&(t={x:0,y:0}),{top:r.top-e.height-t.y,right:r.right-e.width+t.x,bottom:r.bottom-e.height+t.y,left:r.left-e.width-t.x}}function zy(r){return[vo,ss,os,bo].some(function(e){return r[e]>=0})}function wC(r){var e=r.state,t=r.name,n=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,u=Vf(e,{elementContext:"reference"}),s=Vf(e,{altBoundary:!0}),d=Py(u,n),p=Py(s,i,o),g=zy(d),_=zy(p);e.modifiersData[t]={referenceClippingOffsets:d,popperEscapeOffsets:p,isReferenceHidden:g,hasPopperEscaped:_},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":g,"data-popper-escaped":_})}const xC={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:wC};function AC(r,e,t){var n=Bs(r),i=[bo,vo].indexOf(n)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:r})):t,u=o[0],s=o[1];return u=u||0,s=(s||0)*i,[bo,ss].indexOf(n)>=0?{x:s,y:u}:{x:u,y:s}}function kC(r){var e=r.state,t=r.options,n=r.name,i=t.offset,o=i===void 0?[0,0]:i,u=t2.reduce(function(g,_){return g[_]=AC(_,e.rects,o),g},{}),s=u[e.placement],d=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=d,e.modifiersData.popperOffsets.y+=p),e.modifiersData[n]=u}const SC={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:kC};function CC(r){var e=r.state,t=r.name;e.modifiersData[t]=u2({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const TC={name:"popperOffsets",enabled:!0,phase:"read",fn:CC,data:{}};function MC(r){return r==="x"?"y":"x"}function EC(r){var e=r.state,t=r.options,n=r.name,i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!1:u,d=t.boundary,p=t.rootBoundary,g=t.altBoundary,_=t.padding,x=t.tether,C=x===void 0?!0:x,T=t.tetherOffset,z=T===void 0?0:T,L=Vf(e,{boundary:d,rootBoundary:p,padding:_,altBoundary:g}),E=Bs(e.placement),I=ic(e.placement),O=!I,B=Xg(E),K=MC(B),H=e.modifiersData.popperOffsets,q=e.rects.reference,J=e.rects.popper,he=typeof z=="function"?z(Object.assign({},e.rects,{placement:e.placement})):z,Ee=typeof he=="number"?{mainAxis:he,altAxis:he}:Object.assign({mainAxis:0,altAxis:0},he),Y=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,oe={x:0,y:0};if(H){if(o){var ke,ye=B==="y"?vo:bo,Ne=B==="y"?os:ss,Ue=B==="y"?"height":"width",De=H[B],Le=De+L[ye],lt=De-L[Ne],Ze=C?-J[Ue]/2:0,at=I===tc?q[Ue]:J[Ue],dt=I===tc?-J[Ue]:-q[Ue],pt=e.elements.arrow,Je=C&&pt?Zg(pt):{width:0,height:0},xt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:o2(),Mt=xt[ye],Ot=xt[Ne],Yt=zf(0,q[Ue],Je[Ue]),nn=O?q[Ue]/2-Ze-Yt-Mt-Ee.mainAxis:at-Yt-Mt-Ee.mainAxis,Qt=O?-q[Ue]/2+Ze+Yt+Ot+Ee.mainAxis:dt+Yt+Ot+Ee.mainAxis,fn=e.elements.arrow&&rh(e.elements.arrow),mn=fn?B==="y"?fn.clientTop||0:fn.clientLeft||0:0,qe=(ke=Y==null?void 0:Y[B])!=null?ke:0,Ge=De+nn-qe-mn,gt=De+Qt-qe,et=zf(C?Qd(Le,Ge):Le,De,C?Il(lt,gt):lt);H[B]=et,oe[B]=et-De}if(s){var de,en=B==="x"?vo:bo,Xe=B==="x"?os:ss,it=H[K],Ut=K==="y"?"height":"width",Hn=it+L[en],jn=it-L[Xe],Nn=[vo,bo].indexOf(E)!==-1,Wt=(de=Y==null?void 0:Y[K])!=null?de:0,An=Nn?Hn:it-q[Ut]-J[Ut]-Wt+Ee.altAxis,ti=Nn?it+q[Ut]+J[Ut]-Wt-Ee.altAxis:jn,Bn=C&&Nn?Q5(An,it,ti):zf(C?An:Hn,it,C?ti:jn);H[K]=Bn,oe[K]=Bn-it}e.modifiersData[n]=oe}}const LC={name:"preventOverflow",enabled:!0,phase:"main",fn:EC,requiresIfExists:["offset"]};function IC(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function PC(r){return r===No(r)||!ts(r)?Kg(r):IC(r)}function zC(r){var e=r.getBoundingClientRect(),t=nc(e.width)/r.offsetWidth||1,n=nc(e.height)/r.offsetHeight||1;return t!==1||n!==1}function DC(r,e,t){t===void 0&&(t=!1);var n=ts(e),i=ts(e)&&zC(e),o=Ga(e),u=rc(r,i,t),s={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(n||!n&&!t)&&((Os(e)!=="body"||Yg(o))&&(s=PC(e)),ts(e)?(d=rc(e,!0),d.x+=e.clientLeft,d.y+=e.clientTop):o&&(d.x=Jg(o))),{x:u.left+s.scrollLeft-d.x,y:u.top+s.scrollTop-d.y,width:u.width,height:u.height}}function RC(r){var e=new Map,t=new Set,n=[];r.forEach(function(o){e.set(o.name,o)});function i(o){t.add(o.name);var u=[].concat(o.requires||[],o.requiresIfExists||[]);u.forEach(function(s){if(!t.has(s)){var d=e.get(s);d&&i(d)}}),n.push(o)}return r.forEach(function(o){t.has(o.name)||i(o)}),n}function BC(r){var e=RC(r);return Z5.reduce(function(t,n){return t.concat(e.filter(function(i){return i.phase===n}))},[])}function FC(r){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(r())})})),e}}function OC(r){var e=r.reduce(function(t,n){var i=t[n.name];return t[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,t},{});return Object.keys(e).map(function(t){return e[t]})}var Dy={placement:"bottom",modifiers:[],strategy:"absolute"};function Ry(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function $C(r){r===void 0&&(r={});var e=r,t=e.defaultModifiers,n=t===void 0?[]:t,i=e.defaultOptions,o=i===void 0?Dy:i;return function(s,d,p){p===void 0&&(p=o);var g={placement:"bottom",orderedModifiers:[],options:Object.assign({},Dy,o),modifiersData:{},elements:{reference:s,popper:d},attributes:{},styles:{}},_=[],x=!1,C={state:g,setOptions:function(E){var I=typeof E=="function"?E(g.options):E;z(),g.options=Object.assign({},o,g.options,I),g.scrollParents={reference:Dl(s)?Df(s):s.contextElement?Df(s.contextElement):[],popper:Df(d)};var O=BC(OC([].concat(n,g.options.modifiers)));return g.orderedModifiers=O.filter(function(B){return B.enabled}),T(),C.update()},forceUpdate:function(){if(!x){var E=g.elements,I=E.reference,O=E.popper;if(Ry(I,O)){g.rects={reference:DC(I,rh(O),g.options.strategy==="fixed"),popper:Zg(O)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(Ee){return g.modifiersData[Ee.name]=Object.assign({},Ee.data)});for(var B=0;B<g.orderedModifiers.length;B++){if(g.reset===!0){g.reset=!1,B=-1;continue}var K=g.orderedModifiers[B],H=K.fn,q=K.options,J=q===void 0?{}:q,he=K.name;typeof H=="function"&&(g=H({state:g,options:J,name:he,instance:C})||g)}}}},update:FC(function(){return new Promise(function(L){C.forceUpdate(),L(g)})}),destroy:function(){z(),x=!0}};if(!Ry(s,d))return C;C.setOptions(p).then(function(L){!x&&p.onFirstUpdate&&p.onFirstUpdate(L)});function T(){g.orderedModifiers.forEach(function(L){var E=L.name,I=L.options,O=I===void 0?{}:I,B=L.effect;if(typeof B=="function"){var K=B({state:g,name:E,instance:C,options:O}),H=function(){};_.push(K||H)}})}function z(){_.forEach(function(L){return L()}),_=[]}return C}}var NC=[uC,TC,aC,n2,SC,bC,LC,rC,xC],jC=$C({defaultModifiers:NC}),UC="tippy-box",c2="tippy-content",VC="tippy-backdrop",f2="tippy-arrow",h2="tippy-svg-arrow",Cl={passive:!0,capture:!0},d2=function(){return document.body};function Mm(r,e,t){if(Array.isArray(r)){var n=r[e];return n??(Array.isArray(t)?t[e]:t)}return r}function Qg(r,e){var t={}.toString.call(r);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function p2(r,e){return typeof r=="function"?r.apply(void 0,e):r}function By(r,e){if(e===0)return r;var t;return function(n){clearTimeout(t),t=setTimeout(function(){r(n)},e)}}function qC(r){return r.split(/\s+/).filter(Boolean)}function qu(r){return[].concat(r)}function Fy(r,e){r.indexOf(e)===-1&&r.push(e)}function HC(r){return r.filter(function(e,t){return r.indexOf(e)===t})}function GC(r){return r.split("-")[0]}function ep(r){return[].slice.call(r)}function Oy(r){return Object.keys(r).reduce(function(e,t){return r[t]!==void 0&&(e[t]=r[t]),e},{})}function Rf(){return document.createElement("div")}function cp(r){return["Element","Fragment"].some(function(e){return Qg(r,e)})}function WC(r){return Qg(r,"NodeList")}function ZC(r){return Qg(r,"MouseEvent")}function XC(r){return!!(r&&r._tippy&&r._tippy.reference===r)}function KC(r){return cp(r)?[r]:WC(r)?ep(r):Array.isArray(r)?r:ep(document.querySelectorAll(r))}function Em(r,e){r.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function $y(r,e){r.forEach(function(t){t&&t.setAttribute("data-state",e)})}function JC(r){var e,t=qu(r),n=t[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function YC(r,e){var t=e.clientX,n=e.clientY;return r.every(function(i){var o=i.popperRect,u=i.popperState,s=i.props,d=s.interactiveBorder,p=GC(u.placement),g=u.modifiersData.offset;if(!g)return!0;var _=p==="bottom"?g.top.y:0,x=p==="top"?g.bottom.y:0,C=p==="right"?g.left.x:0,T=p==="left"?g.right.x:0,z=o.top-n+_>d,L=n-o.bottom-x>d,E=o.left-t+C>d,I=t-o.right-T>d;return z||L||E||I})}function Lm(r,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){r[n](i,t)})}function Ny(r,e){for(var t=e;t;){var n;if(r.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var Rs={isTouch:!1},jy=0;function QC(){Rs.isTouch||(Rs.isTouch=!0,window.performance&&document.addEventListener("mousemove",m2))}function m2(){var r=performance.now();r-jy<20&&(Rs.isTouch=!1,document.removeEventListener("mousemove",m2)),jy=r}function eT(){var r=document.activeElement;if(XC(r)){var e=r._tippy;r.blur&&!e.state.isVisible&&r.blur()}}function tT(){document.addEventListener("touchstart",QC,Cl),window.addEventListener("blur",eT)}var nT=typeof window<"u"&&typeof document<"u",rT=nT?!!window.msCrypto:!1,iT={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},oT={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},gs=Object.assign({appendTo:d2,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},iT,oT),sT=Object.keys(gs),aT=function(e){var t=Object.keys(e);t.forEach(function(n){gs[n]=e[n]})};function g2(r){var e=r.plugins||[],t=e.reduce(function(n,i){var o=i.name,u=i.defaultValue;if(o){var s;n[o]=r[o]!==void 0?r[o]:(s=gs[o])!=null?s:u}return n},{});return Object.assign({},r,t)}function lT(r,e){var t=e?Object.keys(g2(Object.assign({},gs,{plugins:e}))):sT,n=t.reduce(function(i,o){var u=(r.getAttribute("data-tippy-"+o)||"").trim();if(!u)return i;if(o==="content")i[o]=u;else try{i[o]=JSON.parse(u)}catch{i[o]=u}return i},{});return n}function Uy(r,e){var t=Object.assign({},e,{content:p2(e.content,[r])},e.ignoreAttributes?{}:lT(r,e.plugins));return t.aria=Object.assign({},gs.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var uT=function(){return"innerHTML"};function rg(r,e){r[uT()]=e}function Vy(r){var e=Rf();return r===!0?e.className=f2:(e.className=h2,cp(r)?e.appendChild(r):rg(e,r)),e}function qy(r,e){cp(e.content)?(rg(r,""),r.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?rg(r,e.content):r.textContent=e.content)}function ig(r){var e=r.firstElementChild,t=ep(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(c2)}),arrow:t.find(function(n){return n.classList.contains(f2)||n.classList.contains(h2)}),backdrop:t.find(function(n){return n.classList.contains(VC)})}}function _2(r){var e=Rf(),t=Rf();t.className=UC,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Rf();n.className=c2,n.setAttribute("data-state","hidden"),qy(n,r.props),e.appendChild(t),t.appendChild(n),i(r.props,r.props);function i(o,u){var s=ig(e),d=s.box,p=s.content,g=s.arrow;u.theme?d.setAttribute("data-theme",u.theme):d.removeAttribute("data-theme"),typeof u.animation=="string"?d.setAttribute("data-animation",u.animation):d.removeAttribute("data-animation"),u.inertia?d.setAttribute("data-inertia",""):d.removeAttribute("data-inertia"),d.style.maxWidth=typeof u.maxWidth=="number"?u.maxWidth+"px":u.maxWidth,u.role?d.setAttribute("role",u.role):d.removeAttribute("role"),(o.content!==u.content||o.allowHTML!==u.allowHTML)&&qy(p,r.props),u.arrow?g?o.arrow!==u.arrow&&(d.removeChild(g),d.appendChild(Vy(u.arrow))):d.appendChild(Vy(u.arrow)):g&&d.removeChild(g)}return{popper:e,onUpdate:i}}_2.$$tippy=!0;var cT=1,kd=[],Im=[];function fT(r,e){var t=Uy(r,Object.assign({},gs,g2(Oy(e)))),n,i,o,u=!1,s=!1,d=!1,p=!1,g,_,x,C=[],T=By(Ge,t.interactiveDebounce),z,L=cT++,E=null,I=HC(t.plugins),O={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},B={id:L,reference:r,popper:Rf(),popperInstance:E,props:t,state:O,plugins:I,clearDelayTimeouts:An,setProps:ti,setContent:Bn,show:yt,hide:mr,hideWithInteractivity:or,enable:Nn,disable:Wt,unmount:gi,destroy:Un};if(!t.render)return B;var K=t.render(B),H=K.popper,q=K.onUpdate;H.setAttribute("data-tippy-root",""),H.id="tippy-"+B.id,B.popper=H,r._tippy=B,H._tippy=B;var J=I.map(function(Fe){return Fe.fn(B)}),he=r.hasAttribute("aria-expanded");return fn(),Ze(),De(),Le("onCreate",[B]),t.showOnCreate&&Hn(),H.addEventListener("mouseenter",function(){B.props.interactive&&B.state.isVisible&&B.clearDelayTimeouts()}),H.addEventListener("mouseleave",function(){B.props.interactive&&B.props.trigger.indexOf("mouseenter")>=0&&ye().addEventListener("mousemove",T)}),B;function Ee(){var Fe=B.props.touch;return Array.isArray(Fe)?Fe:[Fe,0]}function Y(){return Ee()[0]==="hold"}function oe(){var Fe;return!!((Fe=B.props.render)!=null&&Fe.$$tippy)}function ke(){return z||r}function ye(){var Fe=ke().parentNode;return Fe?JC(Fe):document}function Ne(){return ig(H)}function Ue(Fe){return B.state.isMounted&&!B.state.isVisible||Rs.isTouch||g&&g.type==="focus"?0:Mm(B.props.delay,Fe?0:1,gs.delay)}function De(Fe){Fe===void 0&&(Fe=!1),H.style.pointerEvents=B.props.interactive&&!Fe?"":"none",H.style.zIndex=""+B.props.zIndex}function Le(Fe,mt,vt){if(vt===void 0&&(vt=!0),J.forEach(function(rn){rn[Fe]&&rn[Fe].apply(rn,mt)}),vt){var Dt;(Dt=B.props)[Fe].apply(Dt,mt)}}function lt(){var Fe=B.props.aria;if(Fe.content){var mt="aria-"+Fe.content,vt=H.id,Dt=qu(B.props.triggerTarget||r);Dt.forEach(function(rn){var tn=rn.getAttribute(mt);if(B.state.isVisible)rn.setAttribute(mt,tn?tn+" "+vt:vt);else{var br=tn&&tn.replace(vt,"").trim();br?rn.setAttribute(mt,br):rn.removeAttribute(mt)}})}}function Ze(){if(!(he||!B.props.aria.expanded)){var Fe=qu(B.props.triggerTarget||r);Fe.forEach(function(mt){B.props.interactive?mt.setAttribute("aria-expanded",B.state.isVisible&&mt===ke()?"true":"false"):mt.removeAttribute("aria-expanded")})}}function at(){ye().removeEventListener("mousemove",T),kd=kd.filter(function(Fe){return Fe!==T})}function dt(Fe){if(!(Rs.isTouch&&(d||Fe.type==="mousedown"))){var mt=Fe.composedPath&&Fe.composedPath()[0]||Fe.target;if(!(B.props.interactive&&Ny(H,mt))){if(qu(B.props.triggerTarget||r).some(function(vt){return Ny(vt,mt)})){if(Rs.isTouch||B.state.isVisible&&B.props.trigger.indexOf("click")>=0)return}else Le("onClickOutside",[B,Fe]);B.props.hideOnClick===!0&&(B.clearDelayTimeouts(),B.hide(),s=!0,setTimeout(function(){s=!1}),B.state.isMounted||Mt())}}}function pt(){d=!0}function Je(){d=!1}function xt(){var Fe=ye();Fe.addEventListener("mousedown",dt,!0),Fe.addEventListener("touchend",dt,Cl),Fe.addEventListener("touchstart",Je,Cl),Fe.addEventListener("touchmove",pt,Cl)}function Mt(){var Fe=ye();Fe.removeEventListener("mousedown",dt,!0),Fe.removeEventListener("touchend",dt,Cl),Fe.removeEventListener("touchstart",Je,Cl),Fe.removeEventListener("touchmove",pt,Cl)}function Ot(Fe,mt){nn(Fe,function(){!B.state.isVisible&&H.parentNode&&H.parentNode.contains(H)&&mt()})}function Yt(Fe,mt){nn(Fe,mt)}function nn(Fe,mt){var vt=Ne().box;function Dt(rn){rn.target===vt&&(Lm(vt,"remove",Dt),mt())}if(Fe===0)return mt();Lm(vt,"remove",_),Lm(vt,"add",Dt),_=Dt}function Qt(Fe,mt,vt){vt===void 0&&(vt=!1);var Dt=qu(B.props.triggerTarget||r);Dt.forEach(function(rn){rn.addEventListener(Fe,mt,vt),C.push({node:rn,eventType:Fe,handler:mt,options:vt})})}function fn(){Y()&&(Qt("touchstart",qe,{passive:!0}),Qt("touchend",gt,{passive:!0})),qC(B.props.trigger).forEach(function(Fe){if(Fe!=="manual")switch(Qt(Fe,qe),Fe){case"mouseenter":Qt("mouseleave",gt);break;case"focus":Qt(rT?"focusout":"blur",et);break;case"focusin":Qt("focusout",et);break}})}function mn(){C.forEach(function(Fe){var mt=Fe.node,vt=Fe.eventType,Dt=Fe.handler,rn=Fe.options;mt.removeEventListener(vt,Dt,rn)}),C=[]}function qe(Fe){var mt,vt=!1;if(!(!B.state.isEnabled||de(Fe)||s)){var Dt=((mt=g)==null?void 0:mt.type)==="focus";g=Fe,z=Fe.currentTarget,Ze(),!B.state.isVisible&&ZC(Fe)&&kd.forEach(function(rn){return rn(Fe)}),Fe.type==="click"&&(B.props.trigger.indexOf("mouseenter")<0||u)&&B.props.hideOnClick!==!1&&B.state.isVisible?vt=!0:Hn(Fe),Fe.type==="click"&&(u=!vt),vt&&!Dt&&jn(Fe)}}function Ge(Fe){var mt=Fe.target,vt=ke().contains(mt)||H.contains(mt);if(!(Fe.type==="mousemove"&&vt)){var Dt=Ut().concat(H).map(function(rn){var tn,br=rn._tippy,sr=(tn=br.popperInstance)==null?void 0:tn.state;return sr?{popperRect:rn.getBoundingClientRect(),popperState:sr,props:t}:null}).filter(Boolean);YC(Dt,Fe)&&(at(),jn(Fe))}}function gt(Fe){var mt=de(Fe)||B.props.trigger.indexOf("click")>=0&&u;if(!mt){if(B.props.interactive){B.hideWithInteractivity(Fe);return}jn(Fe)}}function et(Fe){B.props.trigger.indexOf("focusin")<0&&Fe.target!==ke()||B.props.interactive&&Fe.relatedTarget&&H.contains(Fe.relatedTarget)||jn(Fe)}function de(Fe){return Rs.isTouch?Y()!==Fe.type.indexOf("touch")>=0:!1}function en(){Xe();var Fe=B.props,mt=Fe.popperOptions,vt=Fe.placement,Dt=Fe.offset,rn=Fe.getReferenceClientRect,tn=Fe.moveTransition,br=oe()?ig(H).arrow:null,sr=rn?{getBoundingClientRect:rn,contextElement:rn.contextElement||ke()}:r,Se={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ge){var we=ge.state;if(oe()){var Oe=Ne(),$e=Oe.box;["placement","reference-hidden","escaped"].forEach(function(Ve){Ve==="placement"?$e.setAttribute("data-placement",we.placement):we.attributes.popper["data-popper-"+Ve]?$e.setAttribute("data-"+Ve,""):$e.removeAttribute("data-"+Ve)}),we.attributes.popper={}}}},ne=[{name:"offset",options:{offset:Dt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!tn}},Se];oe()&&br&&ne.push({name:"arrow",options:{element:br,padding:3}}),ne.push.apply(ne,(mt==null?void 0:mt.modifiers)||[]),B.popperInstance=jC(sr,H,Object.assign({},mt,{placement:vt,onFirstUpdate:x,modifiers:ne}))}function Xe(){B.popperInstance&&(B.popperInstance.destroy(),B.popperInstance=null)}function it(){var Fe=B.props.appendTo,mt,vt=ke();B.props.interactive&&Fe===d2||Fe==="parent"?mt=vt.parentNode:mt=p2(Fe,[vt]),mt.contains(H)||mt.appendChild(H),B.state.isMounted=!0,en()}function Ut(){return ep(H.querySelectorAll("[data-tippy-root]"))}function Hn(Fe){B.clearDelayTimeouts(),Fe&&Le("onTrigger",[B,Fe]),xt();var mt=Ue(!0),vt=Ee(),Dt=vt[0],rn=vt[1];Rs.isTouch&&Dt==="hold"&&rn&&(mt=rn),mt?n=setTimeout(function(){B.show()},mt):B.show()}function jn(Fe){if(B.clearDelayTimeouts(),Le("onUntrigger",[B,Fe]),!B.state.isVisible){Mt();return}if(!(B.props.trigger.indexOf("mouseenter")>=0&&B.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Fe.type)>=0&&u)){var mt=Ue(!1);mt?i=setTimeout(function(){B.state.isVisible&&B.hide()},mt):o=requestAnimationFrame(function(){B.hide()})}}function Nn(){B.state.isEnabled=!0}function Wt(){B.hide(),B.state.isEnabled=!1}function An(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(o)}function ti(Fe){if(!B.state.isDestroyed){Le("onBeforeUpdate",[B,Fe]),mn();var mt=B.props,vt=Uy(r,Object.assign({},mt,Oy(Fe),{ignoreAttributes:!0}));B.props=vt,fn(),mt.interactiveDebounce!==vt.interactiveDebounce&&(at(),T=By(Ge,vt.interactiveDebounce)),mt.triggerTarget&&!vt.triggerTarget?qu(mt.triggerTarget).forEach(function(Dt){Dt.removeAttribute("aria-expanded")}):vt.triggerTarget&&r.removeAttribute("aria-expanded"),Ze(),De(),q&&q(mt,vt),B.popperInstance&&(en(),Ut().forEach(function(Dt){requestAnimationFrame(Dt._tippy.popperInstance.forceUpdate)})),Le("onAfterUpdate",[B,Fe])}}function Bn(Fe){B.setProps({content:Fe})}function yt(){var Fe=B.state.isVisible,mt=B.state.isDestroyed,vt=!B.state.isEnabled,Dt=Rs.isTouch&&!B.props.touch,rn=Mm(B.props.duration,0,gs.duration);if(!(Fe||mt||vt||Dt)&&!ke().hasAttribute("disabled")&&(Le("onShow",[B],!1),B.props.onShow(B)!==!1)){if(B.state.isVisible=!0,oe()&&(H.style.visibility="visible"),De(),xt(),B.state.isMounted||(H.style.transition="none"),oe()){var tn=Ne(),br=tn.box,sr=tn.content;Em([br,sr],0)}x=function(){var ne;if(!(!B.state.isVisible||p)){if(p=!0,H.offsetHeight,H.style.transition=B.props.moveTransition,oe()&&B.props.animation){var ce=Ne(),ge=ce.box,we=ce.content;Em([ge,we],rn),$y([ge,we],"visible")}lt(),Ze(),Fy(Im,B),(ne=B.popperInstance)==null||ne.forceUpdate(),Le("onMount",[B]),B.props.animation&&oe()&&Yt(rn,function(){B.state.isShown=!0,Le("onShown",[B])})}},it()}}function mr(){var Fe=!B.state.isVisible,mt=B.state.isDestroyed,vt=!B.state.isEnabled,Dt=Mm(B.props.duration,1,gs.duration);if(!(Fe||mt||vt)&&(Le("onHide",[B],!1),B.props.onHide(B)!==!1)){if(B.state.isVisible=!1,B.state.isShown=!1,p=!1,u=!1,oe()&&(H.style.visibility="hidden"),at(),Mt(),De(!0),oe()){var rn=Ne(),tn=rn.box,br=rn.content;B.props.animation&&(Em([tn,br],Dt),$y([tn,br],"hidden"))}lt(),Ze(),B.props.animation?oe()&&Ot(Dt,B.unmount):B.unmount()}}function or(Fe){ye().addEventListener("mousemove",T),Fy(kd,T),T(Fe)}function gi(){B.state.isVisible&&B.hide(),B.state.isMounted&&(Xe(),Ut().forEach(function(Fe){Fe._tippy.unmount()}),H.parentNode&&H.parentNode.removeChild(H),Im=Im.filter(function(Fe){return Fe!==B}),B.state.isMounted=!1,Le("onHidden",[B]))}function Un(){B.state.isDestroyed||(B.clearDelayTimeouts(),B.unmount(),mn(),delete r._tippy,B.state.isDestroyed=!0,Le("onDestroy",[B]))}}function ih(r,e){e===void 0&&(e={});var t=gs.plugins.concat(e.plugins||[]);tT();var n=Object.assign({},e,{plugins:t}),i=KC(r),o=i.reduce(function(u,s){var d=s&&fT(s,n);return d&&u.push(d),u},[]);return cp(r)?o[0]:o}ih.defaultProps=gs;ih.setDefaultProps=aT;ih.currentInput=Rs;Object.assign({},n2,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});ih.setDefaultProps({render:_2});const hT=r=>({}),Hy=r=>({}),dT=r=>({}),Gy=r=>({});function Wy(r){let e,t,n;return t=new e_({props:{$$slots:{default:[pT]},$$scope:{ctx:r}}}),{c(){e=U("span"),ue(t.$$.fragment),Ye(e,"margin-left","auto")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&128&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function pT(r){let e,t;const n=r[4].help,i=vn(n,r,r[7],Gy);return{c(){e=U("div"),i&&i.c(),fe(e,"class","context-layer-help-content")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&128)&&wn(i,n,o,o[7],t?bn(n,o[7],u,dT):xn(o[7]),Gy)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function Zy(r){let e,t;const n=r[4].legend,i=vn(n,r,r[7],Hy);return{c(){e=U("div"),i&&i.c(),fe(e,"class","legend svelte-14vnnlu")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&128)&&wn(i,n,o,o[7],t?bn(n,o[7],u,hT):xn(o[7]),Hy)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function mT(r){let e,t,n,i,o,u,s,d,p,g,_=r[3].help&&Wy(r),x=r[0]&&r[3].legend&&Zy(r);return{c(){e=U("button"),t=U("input"),n=ie(),i=Te(r[1]),o=ie(),_&&_.c(),u=ie(),x&&x.c(),s=rr(),Ye(t,"aspect-ratio","1.0"),fe(t,"type","checkbox"),fe(e,"class","context-control svelte-14vnnlu")},m(C,T){W(C,e,T),R(e,t),t.checked=r[0],R(e,n),R(e,i),R(e,o),_&&_.m(e,null),W(C,u,T),x&&x.m(C,T),W(C,s,T),d=!0,p||(g=[Lt(t,"change",r[5]),Lt(t,"change",function(){ua(r[2])&&r[2].apply(this,arguments)}),Lt(e,"click",r[6])],p=!0)},p(C,[T]){r=C,T&1&&(t.checked=r[0]),(!d||T&2)&&At(i,r[1]),r[3].help?_?(_.p(r,T),T&8&&N(_,1)):(_=Wy(r),_.c(),N(_,1),_.m(e,null)):_&&(Kt(),V(_,1,1,()=>{_=null}),Jt()),r[0]&&r[3].legend?x?(x.p(r,T),T&9&&N(x,1)):(x=Zy(r),x.c(),N(x,1),x.m(s.parentNode,s)):x&&(Kt(),V(x,1,1,()=>{x=null}),Jt())},i(C){d||(N(_),N(x),d=!0)},o(C){V(_),V(x),d=!1},d(C){C&&(G(e),G(u),G(s)),_&&_.d(),x&&x.d(C),p=!1,hr(g)}}}function gT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=Cg(n);let{label:u}=e,{show:s=!1}=e,{onChange:d=()=>{}}=e;function p(){s=this.checked,t(0,s)}const g=()=>{t(0,s=!s),d()};return r.$$set=_=>{"label"in _&&t(1,u=_.label),"show"in _&&t(0,s=_.show),"onChange"in _&&t(2,d=_.onChange),"$$scope"in _&&t(7,i=_.$$scope)},[s,u,d,o,n,p,g,i]}class ns extends Tt{constructor(e){super(),Ct(this,e,gT,mT,wt,{label:1,show:0,onChange:2})}}let Fd=Pn(!0);function _T(r){let e,t;return e=new Xi({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yT(r){let e,t;return e=new yr({props:{data:r[1],$$slots:{default:[_T]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function vT(r,e,t){let n;return st(r,Fd,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class bT extends Tt{constructor(e){super(),Ct(this,e,vT,yT,wt,{})}}function wT(r){let e,t;return e=new lp({props:{lngLat:r[0],$$slots:{default:[AT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function xT(r){let e,t,n;function i(u){r[3](u)}let o={draggable:!0,$$slots:{default:[kT]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new lp({props:o}),pn.push(()=>Dn(e,"lngLat",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const d={};s&16&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.lngLat=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function AT(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),fe(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function kT(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),fe(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&G(e),i&&i.d(o)}}}function ST(r){let e,t,n,i;const o=[xT,wT],u=[];function s(d,p){return d[1]?0:1}return e=s(r),t=u[e]=o[e](r),{c(){t.c(),n=rr()},m(d,p){u[e].m(d,p),W(d,n,p),i=!0},p(d,[p]){let g=e;e=s(d),e===g?u[e].p(d,p):(Kt(),V(u[g],1,1,()=>{u[g]=null}),Jt(),t=u[e],t?t.p(d,p):(t=u[e]=o[e](d),t.c()),N(t,1),t.m(n.parentNode,n))},i(d){i||(N(t),i=!0)},o(d){V(t),i=!1},d(d){d&&G(n),u[e].d(d)}}}function CT(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:u=!1}=e;function s(d){o=d,t(0,o)}return r.$$set=d=>{"lngLat"in d&&t(0,o=d.lngLat),"draggable"in d&&t(1,u=d.draggable),"$$scope"in d&&t(4,i=d.$$scope)},[o,u,n,s,i]}class Rl extends Tt{constructor(e){super(),Ct(this,e,CT,ST,wt,{lngLat:0,draggable:1})}}function TT(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[5],null);return{c(){e=U("h2"),e.textContent="Help",t=ie(),o&&o.c()},m(u,s){W(u,e,s),W(u,t,s),o&&o.m(u,s),n=!0},p(u,s){o&&o.p&&(!n||s&32)&&wn(o,i,u,u[5],n?bn(i,u[5],s,null):xn(u[5]),null)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&(G(e),G(t)),o&&o.d(u)}}}function MT(r){let e,t,n,i,o,u,s,d;t=new B3({props:{color:r[0]}});function p(_){r[4](_)}let g={$$slots:{default:[TT]},$$scope:{ctx:r}};return r[1]!==void 0&&(g.show=r[1]),i=new Lg({props:g}),pn.push(()=>Dn(i,"show",p)),{c(){e=U("button"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),fe(e,"class","icon-btn help svelte-my65h"),fe(e,"title","Help")},m(_,x){W(_,e,x),ae(t,e,null),W(_,n,x),ae(i,_,x),u=!0,s||(d=Lt(e,"click",Sf(r[3])),s=!0)},p(_,[x]){const C={};x&1&&(C.color=_[0]),t.$set(C);const T={};x&32&&(T.$$scope={dirty:x,ctx:_}),!o&&x&2&&(o=!0,T.show=_[1],zn(()=>o=!1)),i.$set(T)},i(_){u||(N(t.$$.fragment,_),N(i.$$.fragment,_),u=!0)},o(_){V(t.$$.fragment,_),V(i.$$.fragment,_),u=!1},d(_){_&&(G(e),G(n)),le(t),le(i,_),s=!1,d()}}}function ET(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:u="black"}=e;const s=()=>t(1,o=!0);function d(p){o=p,t(1,o)}return r.$$set=p=>{"color"in p&&t(0,u=p.color),"$$scope"in p&&t(5,i=p.$$scope)},[u,o,n,s,d,i]}class e_ extends Tt{constructor(e){super(),Ct(this,e,ET,MT,wt,{color:0})}}function LT(r){let e,t,n,i;const o=r[1].default,u=vn(o,r,r[0],null);return{c(){e=U("a"),u&&u.c(),fe(e,"href","#")},m(s,d){W(s,e,d),u&&u.m(e,null),t=!0,n||(i=Lt(e,"click",Tg(r[2])),n=!0)},p(s,[d]){u&&u.p&&(!t||d&1)&&wn(u,o,s,s[0],t?bn(o,s[0],d,null):xn(s[0]),null)},i(s){t||(N(u,s),t=!0)},o(s){V(u,s),t=!1},d(s){s&&G(e),u&&u.d(s),n=!1,i()}}}function IT(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(u){Sn.call(this,r,u)}return r.$$set=u=>{"$$scope"in u&&t(0,i=u.$$scope)},[i,n,o]}class oh extends Tt{constructor(e){super(),Ct(this,e,IT,LT,wt,{})}}function Xy(r){let e,t,n,i=r[1]!=null&&Ky(r);return{c(){e=U("div"),t=Te(r[0]),n=ie(),i&&i.c(),fe(e,"class","cover svelte-1w7hi45")},m(o,u){W(o,e,u),R(e,t),R(e,n),i&&i.m(e,null)},p(o,u){u&1&&At(t,o[0]),o[1]!=null?i?i.p(o,u):(i=Ky(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(o){o&&G(e),i&&i.d()}}}function Ky(r){let e,t;return{c(){e=U("div"),t=U("progress"),t.value=r[1],Ye(t,"width","100%")},m(n,i){W(n,e,i),R(e,t)},p(n,i){i&2&&(t.value=n[1])},d(n){n&&G(e)}}}function PT(r){let e,t=r[0]&&Xy(r);return{c(){t&&t.c(),e=rr()},m(n,i){t&&t.m(n,i),W(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=Xy(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ft,o:ft,d(n){n&&G(e),t&&t.d(n)}}}function zT(r,e,t){let{loading:n}=e,{progress:i=null}=e,o,u;return r.$$set=s=>{"loading"in s&&t(0,n=s.loading),"progress"in s&&t(1,i=s.progress)},r.$$.update=()=>{if(r.$$.dirty&13){if(n&&!o)t(2,o=Date.now()),t(3,u=n);else if(!n&&o){const s=Date.now()-o;console.log(`Loading "${u}" took ${s}ms`),t(2,o=void 0)}}},[n,i,o,u]}class sh extends Tt{constructor(e){super(),Ct(this,e,zT,PT,wt,{loading:0,progress:1})}}function vr(r){var e;switch(r){case"title":return"Choose project";case"new-project":return"New project";case"pick-neighbourhood":return((e=hi(y3))==null?void 0:e.project_name)||"Pick neighbourhood";case"set-boundary":return"Adjust boundary";case"add-neighbourhood":return"Add a neighbourhood";case"neighbourhood":return hi(Ia)||"Editing";case"view-shortcuts":return"Shortcuts";case"impact-one-destination":return"Impact on one destination";case"route":return"Route";case"predict-impact":return"Predict impact";case"impact-detail":return"Impact detail";case"debug-intersections":return"Debug intersections";case"debug-neighbourhood":return"Debug neighbourhood";case"debug-demand":return"Explore origin/destination demand data"}}function DT(r){let e,t=vr(r[0].mode)+"",n;return{c(){e=U("span"),n=Te(t),fe(e,"class","page-title svelte-1o8s136")},m(i,o){W(i,e,o),R(e,n)},p(i,o){o&1&&t!==(t=vr(i[0].mode)+"")&&At(n,t)},d(i){i&&G(e)}}}function RT(r){let e;const t=r[2].default,n=vn(t,r,r[4],null),i=n||DT(r);return{c(){i&&i.c()},m(o,u){i&&i.m(o,u),e=!0},p(o,u){n?n.p&&(!e||u&16)&&wn(n,t,o,o[4],e?bn(t,o[4],u,null):xn(o[4]),null):i&&i.p&&(!e||u&1)&&i.p(o,e?u:-1)},i(o){e||(N(i,o),e=!0)},o(o){V(i,o),e=!1},d(o){i&&i.d(o)}}}function BT(r){let e,t;return e=new oh({props:{$$slots:{default:[RT]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&17&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function FT(r,e,t){let n;st(r,nr,d=>t(1,n=d));let{$$slots:i={},$$scope:o}=e,{mode:u}=e;const s=()=>cn(nr,n=u,n);return r.$$set=d=>{"mode"in d&&t(0,u=d.mode),"$$scope"in d&&t(4,o=d.$$scope)},[u,n,i,s,o]}class $n extends Tt{constructor(e){super(),Ct(this,e,FT,BT,wt,{mode:0})}}function OT(r){let e,t,n,i,o,u=r[0]+1+"",s,d,p=r[1].length+"",g,_,x,C,T,z,L;return{c(){e=U("div"),t=U("button"),n=Te("Previous"),o=ie(),s=Te(u),d=Te(" / "),g=Te(p),_=ie(),x=U("button"),C=Te("Next"),t.disabled=i=r[0]==0,fe(t,"data-tippy-content","Left"),x.disabled=T=r[0]==r[1].length-1,fe(x,"data-tippy-content","Right"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between"),Ye(e,"align-items","center")},m(E,I){W(E,e,I),R(e,t),R(t,n),R(e,o),R(e,s),R(e,d),R(e,g),R(e,_),R(e,x),R(x,C),z||(L=[Lt(window,"keydown",r[2]),Lt(t,"click",r[3]),Lt(x,"click",r[4])],z=!0)},p(E,[I]){I&1&&i!==(i=E[0]==0)&&(t.disabled=i),I&1&&u!==(u=E[0]+1+"")&&At(s,u),I&2&&p!==(p=E[1].length+"")&&At(g,p),I&3&&T!==(T=E[0]==E[1].length-1)&&(x.disabled=T)},i:ft,o:ft,d(E){E&&G(e),z=!1,hr(L)}}}function $T(r,e,t){let n;st(r,is,p=>t(5,n=p));let{list:i}=e,{idx:o=0}=e;ws(()=>{n==null||n.keyboard.disable(),w2()}),ei(()=>{n==null||n.keyboard.enable()});function u(p){p.key=="ArrowLeft"&&(p.stopPropagation(),s()),p.key=="ArrowRight"&&(p.stopPropagation(),d())}function s(){o!=0&&t(0,o--,o)}function d(){o!=i.length-1&&t(0,o++,o)}return r.$$set=p=>{"list"in p&&t(1,i=p.list),"idx"in p&&t(0,o=p.idx)},[o,i,u,s,d]}class fp extends Tt{constructor(e){super(),Ct(this,e,$T,OT,wt,{list:1,idx:0})}}function NT(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:jT}=Jb;function UT(r){let e,t;return e=new n4({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function VT(r){let e,t;return e=new J3({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Jy(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I;return L=Mg(r[9][0]),{c(){e=U("div"),t=Te(`Click the map to see street view
      `),n=U("br"),i=ie(),o=U("br"),u=ie(),s=U("b"),s.textContent="Street view source",d=ie(),p=U("label"),g=U("input"),_=Te(`
        Google Street View`),x=ie(),C=U("label"),T=U("input"),z=Te(`
        Bing Streetside`),fe(g,"type","radio"),g.__value="google",Kn(g,g.__value),fe(g,"class","svelte-1kgc7zz"),fe(p,"class","svelte-1kgc7zz"),fe(T,"type","radio"),T.__value="bing",Kn(T,T.__value),fe(T,"class","svelte-1kgc7zz"),fe(C,"class","svelte-1kgc7zz"),fe(e,"class","street-view-control-source svelte-1kgc7zz"),Gt(e,"expanded",r[0]),L.p(g,T)},m(O,B){W(O,e,B),R(e,t),R(e,n),R(e,i),R(e,o),R(e,u),R(e,s),R(e,d),R(e,p),R(p,g),g.checked=g.__value===r[1],R(p,_),R(e,x),R(e,C),R(C,T),T.checked=T.__value===r[1],R(C,z),E||(I=[Lt(g,"change",r[8]),Lt(T,"change",r[10])],E=!0)},p(O,B){B&2&&(g.checked=g.__value===O[1]),B&2&&(T.checked=T.__value===O[1]),B&1&&Gt(e,"expanded",O[0])},d(O){O&&G(e),L.r(),E=!1,hr(I)}}}function qT(r){let e,t,n,i,o,u,s,d,p;const g=[VT,UT],_=[];function x(T,z){return T[0]?0:1}n=x(r),i=_[n]=g[n](r);let C=r[0]&&Jy(r);return{c(){e=U("button"),t=U("div"),i.c(),o=ie(),C&&C.c(),u=rr(),fe(t,"class","ltn-map-btn"),fe(e,"title","Street view")},m(T,z){W(T,e,z),R(e,t),_[n].m(t,null),W(T,o,z),C&&C.m(T,z),W(T,u,z),s=!0,d||(p=Lt(e,"click",r[7]),d=!0)},p(T,z){let L=n;n=x(T),n!==L&&(Kt(),V(_[L],1,1,()=>{_[L]=null}),Jt(),i=_[n],i||(i=_[n]=g[n](T),i.c()),N(i,1),i.m(t,null)),T[0]?C?C.p(T,z):(C=Jy(T),C.c(),C.m(u.parentNode,u)):C&&(C.d(1),C=null)},i(T){s||(N(i),s=!0)},o(T){V(i),s=!1},d(T){T&&(G(e),G(o),G(u)),_[n].d(),C&&C.d(T),d=!1,p()}}}function HT(r){let e,t,n,i;return e=new Dw({props:{$$slots:{default:[qT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=Lt(jT,"keydown",r[4]),n=!0)},p(o,[u]){const s={};u&16387&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}function GT(r,e,t){let n;st(r,Fd,E=>t(12,n=E));let{map:i}=e,{maptilerBasemap:o}=e,u=!1,s="google",d=[];function p(){cn(Fd,n=!1,n),i.on("click",_),i.getCanvas().style.cursor="crosshair";for(let E of NT(i,o))d.push([E,i.getPaintProperty(E,"line-color")]),i.setPaintProperty(E,"line-color","cyan")}function g(){cn(Fd,n=!0,n),i.off("click",_),i.getCanvas().style.cursor="inherit";for(let[E,I]of d)i.setPaintProperty(E,"line-color",I);d=[]}ei(g);function _(E){let I=E.lngLat.lng,O=E.lngLat.lat;s=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${O},${I}&cbp=11,0,0,0,0`,"_blank"):s=="bing"&&window.open(`https://www.bing.com/maps?cp=${O}~${I}&style=x`,"_blank")}function x(E){!n&&E.key=="Escape"&&(E.stopPropagation(),g())}const C=[[]],T=()=>{t(0,u=!u),u?p():g()};function z(){s=this.__value,t(1,s)}function L(){s=this.__value,t(1,s)}return r.$$set=E=>{"map"in E&&t(5,i=E.map),"maptilerBasemap"in E&&t(6,o=E.maptilerBasemap)},[u,s,p,g,x,i,o,T,z,C,L]}class WT extends Tt{constructor(e){super(),Ct(this,e,GT,HT,wt,{map:5,maptilerBasemap:6})}}function yn(r,e=!0){return{id:r,beforeId:ZT(r),eventsIfTopMost:e}}function ZT(r){let e=hi(is);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=Yy.length-1;i>=0;i--){let o=Yy[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Pm=r=>r,zm=r=>r;const Yy=[Pm(zm("Background")),"neighbourhood-boundaries",Pm("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","main-roads-outlines","main-roads","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","border-entries","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",zm("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","debug-demand-fill","debug-demand-outline","one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19-heatmap","context-stats19-points",zm("Road labels"),Pm("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let y2=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],v2=[20,30,40,50,60,70],Wa=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],ah=Wa,lh=[0,20,40,60,80,100],oc=Wa.toReversed(),Od=Wa.toReversed(),XT=[0,.3,.6,1,1.5,2],KT=Wa.toReversed(),t_=Wa.toReversed(),n_=Wa.toReversed(),uh=[0,20,40,60,80,100],ch=Wa,r_=[1,2,3,4,5],i_=Wa.toReversed();function b2(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const JT="#0C793A",yo={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function w2(){ih("[data-tippy-content]")}function na(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function Oa(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function $a(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function sc(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function Bf(r){return r?hi(bs)=="cnt"?sg(r,"LAD_"):r:"custom area"}function x2(r){let e=hi(Va).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;sp(n,JSON.stringify(e))}function og(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function La(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function Qy(r){return r.reduce((e,t)=>e+t,0)}function sg(r,e){return r.startsWith(e)?r.slice(e.length):r}function e1(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}function YT(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function QT(r){let e,t;const n=[yn("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":na(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&1?Mn(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function eM(r){let e,t,n,i,o;function u(d){r[1](d)}let s={label:"Bus routes",$$slots:{help:[YT]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new ns({props:s}),pn.push(()=>Dn(e,"show",u)),i=new th({props:{url:`pmtiles://${Fo("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[QT]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),W(d,n,p),ae(i,d,p),o=!0},p(d,[p]){const g={};p&4&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],zn(()=>t=!1)),e.$set(g);const _={};p&5&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&G(n),le(e,d),le(i,d)}}}function tM(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class nM extends Tt{constructor(e){super(),Ct(this,e,tM,eM,wt,{})}}var rM=Object.defineProperty,A2=r=>{throw TypeError(r)},iM=(r,e,t)=>e in r?rM(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,zo=(r,e,t)=>iM(r,typeof e!="symbol"?e+"":e,t),k2=(r,e,t)=>e.has(r)||A2("Cannot "+t),yi=(r,e,t)=>(k2(r,e,"read from private field"),t?t.call(r):e.get(r)),t1=(r,e,t)=>e.has(r)?A2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),n1=(r,e,t,n)=>(k2(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function $r(){}function oM(r,e){for(const t in e)r[t]=e[t];return r}function S2(r){return r()}function r1(){return Object.create(null)}function ca(r){r.forEach(S2)}function C2(r){return typeof r=="function"}function Za(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Sd;function Ki(r,e){return r===e?!0:(Sd||(Sd=document.createElement("a")),Sd.href=e,r===Sd.href)}function sM(r){return Object.keys(r).length===0}function aM(r,e,t,n){if(r){const i=T2(r,e,t,n);return r[0](i)}}function T2(r,e,t,n){return r[1]&&n?oM(t.ctx.slice(),r[1](n(e))):t.ctx}function lM(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function uM(r,e,t,n,i,o){if(i){const u=T2(e,t,n,o);r.p(u,i)}}function cM(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function i1(r){return r??""}function ir(r,e){r.appendChild(e)}function Ur(r,e,t){r.insertBefore(e,t||null)}function Nr(r){r.parentNode&&r.parentNode.removeChild(r)}function Ar(r){return document.createElement(r)}function vs(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Na(r){return document.createTextNode(r)}function Bo(){return Na(" ")}function fM(){return Na("")}function lo(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function hM(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Et(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function dM(r){return Array.from(r.childNodes)}function qf(r,e){e=""+e,r.data!==e&&(r.data=e)}function o1(r,e){r.value=e??""}function es(r,e,t){r.classList.toggle(e,!!t)}function pM(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let Hf;function Ff(r){Hf=r}function M2(){if(!Hf)throw new Error("Function called outside component initialization");return Hf}function mM(r){M2().$$.on_destroy.push(r)}function gM(){const r=M2();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=pM(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function s1(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Hu=[],ag=[];let Ku=[];const a1=[],_M=Promise.resolve();let lg=!1;function yM(){lg||(lg=!0,_M.then(E2))}function ug(r){Ku.push(r)}const Dm=new Set;let $u=0;function E2(){if($u!==0)return;const r=Hf;do{try{for(;$u<Hu.length;){const e=Hu[$u];$u++,Ff(e),vM(e.$$)}}catch(e){throw Hu.length=0,$u=0,e}for(Ff(null),Hu.length=0,$u=0;ag.length;)ag.pop()();for(let e=0;e<Ku.length;e+=1){const t=Ku[e];Dm.has(t)||(Dm.add(t),t())}Ku.length=0}while(Hu.length);for(;a1.length;)a1.pop()();lg=!1,Dm.clear(),Ff(r)}function vM(r){if(r.fragment!==null){r.update(),ca(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ug)}}function bM(r){const e=[],t=[];Ku.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Ku=e}const $d=new Set;let El;function Nd(){El={r:0,c:[],p:El}}function jd(){El.r||ca(El.c),El=El.p}function fi(r,e){r&&r.i&&($d.delete(r),r.i(e))}function Si(r,e,t,n){if(r&&r.o){if($d.has(r))return;$d.add(r),El.c.push(()=>{$d.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function l1(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function wM(r,e){Si(r,1,1,()=>{e.delete(r.key)})}function xM(r,e,t,n,i,o,u,s,d,p,g,_){let x=r.length,C=o.length,T=x;const z={};for(;T--;)z[r[T].key]=T;const L=[],E=new Map,I=new Map,O=[];for(T=C;T--;){const q=_(i,o,T),J=t(q);let he=u.get(J);he?O.push(()=>he.p(q,e)):(he=p(J,q),he.c()),E.set(J,L[T]=he),J in z&&I.set(J,Math.abs(T-z[J]))}const B=new Set,K=new Set;function H(q){fi(q,1),q.m(s,g),u.set(q.key,q),g=q.first,C--}for(;x&&C;){const q=L[C-1],J=r[x-1],he=q.key,Ee=J.key;q===J?(g=q.first,x--,C--):E.has(Ee)?!u.has(he)||B.has(he)?H(q):K.has(Ee)?x--:I.get(he)>I.get(Ee)?(K.add(he),H(q)):(B.add(Ee),x--):(d(J,u),x--)}for(;x--;){const q=r[x];E.has(q.key)||d(q,u)}for(;C;)H(L[C-1]);return ca(O),L}function ja(r){r&&r.c()}function aa(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),ug(()=>{const o=r.$$.on_mount.map(S2).filter(C2);r.$$.on_destroy?r.$$.on_destroy.push(...o):ca(o),r.$$.on_mount=[]}),i.forEach(ug)}function la(r,e){const t=r.$$;t.fragment!==null&&(bM(t.after_update),ca(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function AM(r,e){r.$$.dirty[0]===-1&&(Hu.push(r),yM(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Xa(r,e,t,n,i,o,u=null,s=[-1]){const d=Hf;Ff(r);const p=r.$$={fragment:null,ctx:[],props:o,update:$r,not_equal:i,bound:r1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:r1(),dirty:s,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(_,x,...C)=>{const T=C.length?C[0]:x;return p.ctx&&i(p.ctx[_],p.ctx[_]=T)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](T),g&&AM(r,_)),x}):[],p.update(),g=!0,ca(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=dM(e.target);p.fragment&&p.fragment.l(_),_.forEach(Nr)}else p.fragment&&p.fragment.c();e.intro&&fi(r.$$.fragment),aa(r,e.target,e.anchor),E2()}Ff(d)}class Ka{constructor(){zo(this,"$$"),zo(this,"$$set")}$destroy(){la(this,1),this.$destroy=$r}$on(e,t){if(!C2(t))return $r;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!sM(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const kM="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(kM);function SM(r){let e,t;return{c(){e=vs("svg"),t=vs("path"),Et(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Et(e,"viewBox","0 0 14 14"),Et(e,"width","13"),Et(e,"height","13"),Et(e,"class","svelte-en2qvf")},m(n,i){Ur(n,e,i),ir(e,t)},p:$r,i:$r,o:$r,d(n){n&&Nr(e)}}}class L2 extends Ka{constructor(e){super(),Xa(this,e,null,SM,Za,{})}}function CM(r){let e,t;return{c(){e=vs("svg"),t=vs("path"),Et(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Et(e,"viewBox","0 0 30 30"),Et(e,"fill","none"),Et(e,"xmlns","http://www.w3.org/2000/svg"),Et(e,"class","svelte-d2loi5")},m(n,i){Ur(n,e,i),ir(e,t)},p:$r,i:$r,o:$r,d(n){n&&Nr(e)}}}class I2 extends Ka{constructor(e){super(),Xa(this,e,null,CM,Za,{})}}function TM(r){let e,t;return{c(){e=Ar("img"),Ki(e.src,t=r[3]+"area.svg")||Et(e,"src",t),Et(e,"alt",r[6]),Et(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ki(e.src,t=n[3]+"area.svg")&&Et(e,"src",t),i&64&&Et(e,"alt",n[6])},d(n){n&&Nr(e)}}}function MM(r){let e,t;return{c(){e=Ar("img"),Ki(e.src,t=r[3]+"reverse.svg")||Et(e,"src",t),Et(e,"alt",r[6]),Et(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ki(e.src,t=n[3]+"reverse.svg")&&Et(e,"src",t),i&64&&Et(e,"alt",n[6])},d(n){n&&Nr(e)}}}function EM(r){let e,t;return{c(){e=Ar("img"),Ki(e.src,t=r[3]+"poi.svg")||Et(e,"src",t),Et(e,"alt",r[6]),Et(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ki(e.src,t=n[3]+"poi.svg")&&Et(e,"src",t),i&64&&Et(e,"alt",n[6])},d(n){n&&Nr(e)}}}function LM(r){let e,t;return{c(){e=Ar("img"),Ki(e.src,t=r[3]+"postal_code.svg")||Et(e,"src",t),Et(e,"alt",r[6]),Et(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ki(e.src,t=n[3]+"postal_code.svg")&&Et(e,"src",t),i&64&&Et(e,"alt",n[6])},d(n){n&&Nr(e)}}}function IM(r){let e,t;return{c(){e=Ar("img"),Ki(e.src,t=r[3]+"street.svg")||Et(e,"src",t),Et(e,"alt",r[6]),Et(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ki(e.src,t=n[3]+"street.svg")&&Et(e,"src",t),i&64&&Et(e,"alt",n[6])},d(n){n&&Nr(e)}}}function PM(r){let e,t;return{c(){e=Ar("img"),Ki(e.src,t=r[3]+"road.svg")||Et(e,"src",t),Et(e,"alt",r[6]),Et(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ki(e.src,t=n[3]+"road.svg")&&Et(e,"src",t),i&64&&Et(e,"alt",n[6])},d(n){n&&Nr(e)}}}function zM(r){let e,t;return{c(){e=Ar("img"),Ki(e.src,t=r[3]+"housenumber.svg")||Et(e,"src",t),Et(e,"alt",r[6]),Et(e,"class","svelte-ltkwvy")},m(n,i){Ur(n,e,i)},p(n,i){i&8&&!Ki(e.src,t=n[3]+"housenumber.svg")&&Et(e,"src",t),i&64&&Et(e,"alt",n[6])},d(n){n&&Nr(e)}}}function DM(r){let e,t,n,i;return{c(){e=Ar("img"),Ki(e.src,t=r[5])||Et(e,"src",t),Et(e,"alt",r[4]),Et(e,"class","svelte-ltkwvy")},m(o,u){Ur(o,e,u),n||(i=lo(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Ki(e.src,t=o[5])&&Et(e,"src",t),u&16&&Et(e,"alt",o[4])},d(o){o&&Nr(e),n=!1,i()}}}function u1(r){let e,t;return{c(){e=Ar("span"),t=Na(r[6]),Et(e,"class","secondary svelte-ltkwvy")},m(n,i){Ur(n,e,i),ir(e,t)},p(n,i){i&64&&qf(t,n[6])},d(n){n&&Nr(e)}}}function RM(r){let e,t,n,i,o,u,s,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],T,z,L=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",E,I,O;function B(J,he){return he&1&&(t=null),he&1&&(n=null),he&1&&(i=null),he&1&&(o=null),J[5]?DM:J[0].address?zM:(t==null&&(t=!!J[0].id.startsWith("road.")),t?PM:(n==null&&(n=!!J[0].id.startsWith("address.")),n?IM:(i==null&&(i=!!J[0].id.startsWith("postal_code.")),i?LM:(o==null&&(o=!!J[0].id.startsWith("poi.")),o?EM:J[7]?MM:TM))))}let K=B(r,-1),H=K(r),q=C&&u1(r);return{c(){e=Ar("li"),H.c(),u=Bo(),s=Ar("span"),d=Ar("span"),p=Ar("span"),_=Na(g),x=Bo(),q&&q.c(),T=Bo(),z=Ar("span"),E=Na(L),Et(p,"class","primary svelte-ltkwvy"),Et(d,"class","svelte-ltkwvy"),Et(z,"class","line2 svelte-ltkwvy"),Et(s,"class","texts svelte-ltkwvy"),Et(e,"tabindex","0"),Et(e,"data-selected",r[1]),Et(e,"class","svelte-ltkwvy"),es(e,"selected",r[1])},m(J,he){Ur(J,e,he),H.m(e,null),ir(e,u),ir(e,s),ir(s,d),ir(d,p),ir(p,_),ir(d,x),q&&q.m(d,null),ir(s,T),ir(s,z),ir(z,E),I||(O=[lo(e,"mouseenter",r[12]),lo(e,"focus",r[13])],I=!0)},p(J,[he]){K===(K=B(J,he))&&H?H.p(J,he):(H.d(1),H=K(J),H&&(H.c(),H.m(e,u))),he&1&&g!==(g=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&qf(_,g),he&37&&(C=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),C?q?q.p(J,he):(q=u1(J),q.c(),q.m(d,null)):q&&(q.d(1),q=null),he&1&&L!==(L=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&qf(E,L),he&2&&Et(e,"data-selected",J[1]),he&2&&es(e,"selected",J[1])},i:$r,o:$r,d(J){J&&Nr(e),H.d(),q&&q.d(),I=!1,ca(O)}}}function BM(r,e,t){var n;let i,o,{feature:u}=e,{selected:s=!1}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:g}=e;const _=(n=u.properties)==null?void 0:n.categories;let x,C,T=0,z=u.place_type[0]==="reverse";function L(){C&&p.add(C),t(10,T++,T)}function E(B){s1.call(this,r,B)}function I(B){s1.call(this,r,B)}const O=()=>L();return r.$$set=B=>{"feature"in B&&t(0,u=B.feature),"selected"in B&&t(1,s=B.selected),"showPlaceType"in B&&t(2,d=B.showPlaceType),"missingIconsCache"in B&&t(9,p=B.missingIconsCache),"iconsBaseUrl"in B&&t(3,g=B.iconsBaseUrl)},r.$$.update=()=>{var B,K,H,q;if(r.$$.dirty&3640)do t(11,i--,i),t(4,x=_==null?void 0:_[i]),t(5,C=x?g+x.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!C||p.has(C)));r.$$.dirty&1&&t(6,o=((K=(B=u.properties)==null?void 0:B.categories)==null?void 0:K.join(", "))??((q=(H=u.properties)==null?void 0:H.place_type_name)==null?void 0:q[0])??u.place_type[0])},t(11,i=(_==null?void 0:_.length)??0),[u,s,d,g,x,C,o,z,L,p,T,i,E,I,O]}class FM extends Ka{constructor(e){super(),Xa(this,e,BM,RM,Za,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function OM(r){let e;return{c(){e=Ar("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Et(e,"class","svelte-7cmwmc")},m(t,n){Ur(t,e,n)},p:$r,i:$r,o:$r,d(t){t&&Nr(e)}}}class $M extends Ka{constructor(e){super(),Xa(this,e,null,OM,Za,{})}}function NM(r){let e,t,n;return{c(){e=vs("svg"),t=vs("path"),Et(t,"stroke-width","4"),Et(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Et(t,"class","svelte-gzo3ar"),Et(e,"width",n=r[0]==="list"?20:void 0),Et(e,"viewBox","0 0 70 85"),Et(e,"fill","none"),Et(e,"class","svelte-gzo3ar"),es(e,"in-map",r[0]!=="list"),es(e,"list-icon",r[0]==="list")},m(i,o){Ur(i,e,o),ir(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&Et(e,"width",n),o&1&&es(e,"in-map",i[0]!=="list"),o&1&&es(e,"list-icon",i[0]==="list")},i:$r,o:$r,d(i){i&&Nr(e)}}}function jM(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class UM extends Ka{constructor(e){super(),Xa(this,e,jM,NM,Za,{displayIn:0})}}function VM(r){let e,t;return{c(){e=vs("svg"),t=vs("path"),Et(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Et(e,"viewBox","0 0 60.006 21.412"),Et(e,"width","14"),Et(e,"height","20"),Et(e,"class","svelte-en2qvf")},m(n,i){Ur(n,e,i),ir(e,t)},p:$r,i:$r,o:$r,d(n){n&&Nr(e)}}}class qM extends Ka{constructor(e){super(),Xa(this,e,null,VM,Za,{})}}function HM(r){let e,t,n;return{c(){e=vs("svg"),t=vs("circle"),n=vs("path"),Et(t,"cx","4.789"),Et(t,"cy","4.787"),Et(t,"r","3.85"),Et(t,"class","svelte-1aq105l"),Et(n,"d","M12.063 12.063 7.635 7.635"),Et(n,"class","svelte-1aq105l"),Et(e,"xmlns","http://www.w3.org/2000/svg"),Et(e,"width","13"),Et(e,"height","13"),Et(e,"viewBox","0 0 13 13"),Et(e,"class","svelte-1aq105l")},m(i,o){Ur(i,e,o),ir(e,t),ir(e,n)},p:$r,i:$r,o:$r,d(i){i&&Nr(e)}}}class GM extends Ka{constructor(e){super(),Xa(this,e,null,HM,Za,{})}}function WM(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function tp(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let pf;async function ZM(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(pf&&i.cachedLocationExpiry&&pf.time+i.cachedLocationExpiry>Date.now()){if(!pf.coords)break e;return pf.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{s(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(pf={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const XM=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,c1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,f1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(EAST|WEST|[EW])?$/i,h1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,d1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,p1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|ââ|Â´Â´|["â³â\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|Â´Â´|ââ|["â³â\.])?\s*(EAST|WEST|[EW])?$/i;function KM(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let d;r=="DD"&&(d=`${i}Â° ${u}, ${o}Â° ${s}`);const p=Math.floor(i),g=Math.floor(o),_=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=m1(_,3).toFixed(3).padStart(6,"0"),T=m1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&T.endsWith(".000")&&(C=C.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),d=`${p}Â° ${C}' ${u}, ${g}Â° ${T}' ${s}`}if(r=="DMS"){const C=Math.floor(_),T=Math.floor(x);let z=((_-C)*60).toFixed(1).padStart(4,"0"),L=((x-T)*60).toFixed(1).padStart(4,"0");const E=C.toString().padStart(2,"0"),I=T.toString().padStart(2,"0");z.endsWith(".0")&&L.endsWith(".0")&&(z=z.replace(/\.0$/,""),L=L.replace(/\.0$/,"")),d=`${p}Â° ${E}' ${z}" ${u}, ${g}Â° ${I}' ${L}" ${s}`}return d}else throw new Error("no decimal coordinates to convert")}function m1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function o_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],d=!1;if(XM.test(r))throw new Error("invalid coordinate value");if(c1.test(r))if(s=c1.exec(r),d=mf(s),d)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(f1.test(r))if(s=f1.exec(r),d=mf(s),d){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(h1.test(r))if(s=h1.exec(r),d=mf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(d1.test(r))if(s=d1.exec(r),d=mf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(p1.test(r)){if(s=p1.exec(r),d=mf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let _,x;const C=/[,/;\u0020]/g,T=g.match(C);if(T==null){const E=Math.floor(r.length/2);_=g.substring(0,E).trim(),x=g.substring(E).trim()}else{let E;T.length%2==1?E=Math.floor(T.length/2):E=T.length/2-1;let I=0;if(E==0)I=g.indexOf(T[0]),_=g.substring(0,I).trim(),x=g.substring(I+1).trim();else{let O=0,B=0;for(;O<=E;)I=g.indexOf(T[O],B),B=I+1,O++;_=g.substring(0,I).trim(),x=g.substring(I+1).trim()}}const z=_.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");const L=x.split(".");if(L.length==2&&L[1]==0&&L[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:JM,toCoordinateFormat:KM})}else throw new Error("coordinates pattern match failed")}function mf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],d=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(d||p||g)continue;return!1}}return!0}function g1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function JM(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return g1(this.decimalLatitude,Number(e[0]))&&g1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const YM=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});o_.to=YM;const QM=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:'40Â° 7Â´ 22.8" N 74Â° 7Â´ 22.8" W',verbatimLatitude:'40Â° 7Â´ 22.8" N',verbatimLongitude:'74Â° 7Â´ 22.8" W'},{verbatimCoordinates:"40Â° 7.38â , -74Â° 7.38â",verbatimLatitude:"40Â° 7.38â",verbatimLongitude:"-74Â° 7.38â"},{verbatimCoordinates:"N40Â°7â22.8ââ, W74Â°7â22.8ââ",verbatimLatitude:"N40Â°7â22.8ââ",verbatimLongitude:"W74Â°7â22.8ââ"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:`40Â°7'22.8"N, 74Â°7'22.8"W`,verbatimLatitude:`40Â°7'22.8"N`,verbatimLongitude:`74Â°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â°,-74.123Â°",verbatimLatitude:"40.123Â°",verbatimLongitude:"-74.123Â°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40Â°7â23"N 74Â°7â23"W',verbatimLatitude:'40Â°7â23"N',verbatimLongitude:'74Â°7â23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40Â°7â23"S 74Â°7â23"E',verbatimLatitude:'40Â°7â23"S',verbatimLongitude:'74Â°7â23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40Â°7â23" -74Â°7â23"',verbatimLatitude:'40Â°7â23"',verbatimLongitude:'-74Â°7â23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7â 23" N 74d 7â 23" W',verbatimLatitude:'40d 7â 23" N',verbatimLongitude:'74d 7â 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],eE={decimalLatitude:40.123,decimalLongitude:-74.123},tE=[{verbatimCoordinates:`50Â°4'17.698"south, 14Â°24'2.826"east`,verbatimLatitude:`50Â°4'17.698"south`,verbatimLongitude:`14Â°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40Â°26â²47â³N 79Â°58â²36â³W",verbatimLatitude:"40Â°26â²47â³N",verbatimLongitude:"79Â°58â²36â³W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26â² 47â³ N 79d 58â² 36â³ W",verbatimLatitude:"40d 26â² 47â³ N",verbatimLongitude:"79d 58â² 36â³ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195Â° 79,948862Â°",verbatimLatitude:"40,446195Â°",verbatimLongitude:"79,948862Â°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40Â° 26.7717, -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18Â°24S 22Â°45E",verbatimLatitude:"18Â°24S",verbatimLongitude:"22Â°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],nE=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245Â° S / 28.2344Â° E",verbatimLatitude:"-23.3245Â° S",verbatimLongitude:"28.2344Â° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40Â° 26.7717 -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 Â°  E22.45634 Â°",verbatimLatitude:"S23.43563 Â°",verbatimLongitude:"E22.45634 Â°",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372Â° S 23,07771Â° E",verbatimLatitude:"27,71372Â° S",verbatimLongitude:"23,07771Â° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48Â° 30,6410', E 18Â° 57,4583'",verbatimLatitude:"N 48Â° 30,6410'",verbatimLongitude:"E 18Â° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function rE(){const r=[];return QM.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...eE})}),[...r,...tE,...nE]}const iE=rE();o_.formats=iE.map(r=>r.verbatimCoordinates);const oE=o_;function _1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function y1(r){let e,t;return e=new $M({}),{c(){ja(e.$$.fragment)},m(n,i){aa(e,n,i),t=!0},i(n){t||(fi(e.$$.fragment,n),t=!0)},o(n){Si(e.$$.fragment,n),t=!1},d(n){la(e,n)}}}function v1(r){let e,t,n,i,o;return t=new qM({}),{c(){e=Ar("button"),ja(t.$$.fragment),Et(e,"type","button"),Et(e,"title",r[9]),Et(e,"class","svelte-bz0zu3"),es(e,"active",r[0])},m(u,s){Ur(u,e,s),aa(t,e,null),n=!0,i||(o=lo(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&Et(e,"title",u[9]),(!n||s[0]&1)&&es(e,"active",u[0])},i(u){n||(fi(t.$$.fragment,u),n=!0)},o(u){Si(t.$$.fragment,u),n=!1},d(u){u&&Nr(e),la(t),i=!1,o()}}}function sE(r){let e,t=[],n=new Map,i,o,u,s=l1(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=_1(r,s,p),_=d(g);n.set(_,t[p]=b1(_,g))}return{c(){e=Ar("ul");for(let p=0;p<t.length;p+=1)t[p].c();Et(e,"class","options svelte-bz0zu3")},m(p,g){Ur(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(u=[lo(e,"mouseleave",r[73]),lo(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=l1(p[14]),Nd(),t=xM(t,g,d,1,p,s,n,e,wM,b1,null,_1),jd())},i(p){if(!i){for(let g=0;g<s.length;g+=1)fi(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)Si(t[g]);i=!1},d(p){p&&Nr(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,ca(u)}}}function aE(r){let e,t,n,i,o,u;return t=new I2({}),{c(){e=Ar("div"),ja(t.$$.fragment),n=Bo(),i=Ar("div"),o=Na(r[7]),Et(i,"class","svelte-bz0zu3"),Et(e,"class","no-results svelte-bz0zu3")},m(s,d){Ur(s,e,d),aa(t,e,null),ir(e,n),ir(e,i),ir(i,o),u=!0},p(s,d){(!u||d[0]&128)&&qf(o,s[7])},i(s){u||(fi(t.$$.fragment,s),u=!0)},o(s){Si(t.$$.fragment,s),u=!1},d(s){s&&Nr(e),la(t)}}}function lE(r){let e="",t;return{c(){t=Na(e)},m(n,i){Ur(n,t,i)},p:$r,i:$r,o:$r,d(n){n&&Nr(t)}}}function uE(r){let e,t,n,i,o,u,s,d,p,g,_;return t=new I2({}),d=new L2({}),{c(){e=Ar("div"),ja(t.$$.fragment),n=Bo(),i=Ar("div"),o=Na(r[6]),u=Bo(),s=Ar("button"),ja(d.$$.fragment),Et(i,"class","svelte-bz0zu3"),Et(s,"class","svelte-bz0zu3"),Et(e,"class","error svelte-bz0zu3")},m(x,C){Ur(x,e,C),aa(t,e,null),ir(e,n),ir(e,i),ir(i,o),ir(e,u),ir(e,s),aa(d,s,null),p=!0,g||(_=lo(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&qf(o,x[6])},i(x){p||(fi(t.$$.fragment,x),fi(d.$$.fragment,x),p=!0)},o(x){Si(t.$$.fragment,x),Si(d.$$.fragment,x),p=!1},d(x){x&&Nr(e),la(t),la(d),g=!1,_()}}}function b1(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new FM({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=fM(),ja(n.$$.fragment),this.first=t},m(s,d){Ur(s,t,d),aa(n,s,d),i=!0},p(s,d){e=s;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(fi(n.$$.fragment,s),i=!0)},o(s){Si(n.$$.fragment,s),i=!1},d(s){s&&Nr(t),la(n,s)}}}function cE(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B,K,H=!1;o=new GM({}),_=new L2({});let q=r[19]&&y1(),J=r[5]==="button"&&v1(r);const he=r[61].default,Ee=aM(he,r,r[60],null),Y=[uE,lE,aE,sE],oe=[];function ke(ye,Ne){var Ue,De;return ye[18]?0:ye[16]?((Ue=ye[14])==null?void 0:Ue.length)===0?2:ye[16]&&(De=ye[14])!=null&&De.length?3:-1:1}return~(L=ke(r))&&(E=oe[L]=Y[L](r)),{c(){e=Bo(),t=Ar("form"),n=Ar("div"),i=Ar("button"),ja(o.$$.fragment),u=Bo(),s=Ar("input"),d=Bo(),p=Ar("div"),g=Ar("button"),ja(_.$$.fragment),x=Bo(),q&&q.c(),C=Bo(),J&&J.c(),T=Bo(),Ee&&Ee.c(),z=Bo(),E&&E.c(),Et(i,"class","search-button svelte-bz0zu3"),Et(i,"type","button"),Et(s,"placeholder",r[8]),Et(s,"aria-label",r[8]),Et(s,"class","svelte-bz0zu3"),Et(g,"type","button"),Et(g,"title",r[3]),Et(g,"class","svelte-bz0zu3"),Et(p,"class","clear-button-container svelte-bz0zu3"),es(p,"displayable",r[1]!==""),Et(n,"class","input-group svelte-bz0zu3"),Et(t,"tabindex","0"),Et(t,"class",I=i1(r[2])+" svelte-bz0zu3"),es(t,"can-collapse",r[4]&&r[1]==="")},m(ye,Ne){Ur(ye,e,Ne),Ur(ye,t,Ne),ir(t,n),ir(n,i),aa(o,i,null),ir(n,u),ir(n,s),r[63](s),o1(s,r[1]),ir(n,d),ir(n,p),ir(p,g),aa(_,g,null),ir(p,x),q&&q.m(p,null),ir(n,C),J&&J.m(n,null),ir(n,T),Ee&&Ee.m(n,null),ir(t,z),~L&&oe[L].m(t,null),O=!0,B||(K=[lo(i,"click",r[62]),lo(s,"input",r[64]),lo(s,"focus",r[65]),lo(s,"blur",r[66]),lo(s,"keydown",r[22]),lo(s,"input",r[67]),lo(g,"click",r[68]),lo(t,"submit",hM(r[21]))],B=!0)},p(ye,Ne){(!O||Ne[0]&256)&&Et(s,"placeholder",ye[8]),(!O||Ne[0]&256)&&Et(s,"aria-label",ye[8]),Ne[0]&2&&s.value!==ye[1]&&o1(s,ye[1]),(!O||Ne[0]&8)&&Et(g,"title",ye[3]),ye[19]?q?Ne[0]&524288&&fi(q,1):(q=y1(),q.c(),fi(q,1),q.m(p,null)):q&&(Nd(),Si(q,1,1,()=>{q=null}),jd()),(!O||Ne[0]&2)&&es(p,"displayable",ye[1]!==""),ye[5]==="button"?J?(J.p(ye,Ne),Ne[0]&32&&fi(J,1)):(J=v1(ye),J.c(),fi(J,1),J.m(n,T)):J&&(Nd(),Si(J,1,1,()=>{J=null}),jd()),Ee&&Ee.p&&(!O||Ne[1]&536870912)&&uM(Ee,he,ye,ye[60],O?lM(he,ye[60],Ne,null):cM(ye[60]),null);let Ue=L;L=ke(ye),L===Ue?~L&&oe[L].p(ye,Ne):(E&&(Nd(),Si(oe[Ue],1,1,()=>{oe[Ue]=null}),jd()),~L?(E=oe[L],E?E.p(ye,Ne):(E=oe[L]=Y[L](ye),E.c()),fi(E,1),E.m(t,null)):E=null),(!O||Ne[0]&4&&I!==(I=i1(ye[2])+" svelte-bz0zu3"))&&Et(t,"class",I),(!O||Ne[0]&22)&&es(t,"can-collapse",ye[4]&&ye[1]==="")},i(ye){O||(fi(H),fi(o.$$.fragment,ye),fi(_.$$.fragment,ye),fi(q),fi(J),fi(Ee,ye),fi(E),O=!0)},o(ye){Si(H),Si(o.$$.fragment,ye),Si(_.$$.fragment,ye),Si(q),Si(J),Si(Ee,ye),Si(E),O=!1},d(ye){ye&&(Nr(e),Nr(t)),la(o),r[63](null),la(_),q&&q.d(),J&&J.d(),Ee&&Ee.d(ye),~L&&oe[L].d(),B=!1,ca(K)}}}function fE(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:T=void 0}=e,{debounceSearch:z=200}=e,{enableReverse:L="never"}=e,{errorMessage:E="Something went wrongâ¦"}=e,{filter:I=()=>!0}=e,{flyTo:O=!0}=e,{fuzzyMatch:B=!0}=e,{language:K=void 0}=e,{limit:H=void 0}=e,{mapController:q=void 0}=e,{minLength:J=2}=e,{noResultsMessage:he="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ee="Search"}=e,{proximity:Y=[{type:"server-geolocation"}]}=e,{reverseActive:oe=L==="always"}=e,{reverseButtonTitle:ke="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{pickedResultStyle:Ne="full-geometry"}=e,{showPlaceType:Ue="if-needed"}=e,{showResultsWhileTyping:De=!0}=e,{selectFirst:Le=!0}=e,{flyToSelected:lt=!1}=e,{markerOnSelected:Ze=!0}=e,{types:at=void 0}=e,{exhaustiveReverseGeocoding:dt=!1}=e,{excludeTypes:pt=!1}=e,{zoom:Je=s}=e,{apiUrl:xt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Mt={}}=e,{iconsBaseUrl:Ot="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Yt=()=>{}}=e;function nn(){Xe.focus()}function Qt(){Xe.blur()}function fn(re,Ke=!0,Qe=!1){t(1,ye=re),Ke?(t(15,it=-1),yt()):(vt(!Qe,Qe),setTimeout(()=>{Xe.focus(),Xe.select()}))}function mn(){t(14,gt=void 0),t(56,de=void 0),t(15,it=-1)}function qe(){t(55,et=[]),t(56,de=void 0)}let Ge=!1,gt,et,de,en="",Xe,it=-1,Ut,Hn=[],jn,Nn,Wt,An;const ti=new Set,Bn=gM();mM(()=>{q&&(q.setEventHandler(void 0),q.indicateReverse(!1),q.setSelectedMarker(-1),q.setFeatures(void 0,void 0,!1))});function yt(re){if(Nn&&(clearTimeout(Nn),Nn=void 0),it>-1&&gt)t(56,de=gt[it]),t(1,ye=de.place_type[0]==="reverse"?de.place_name:de.place_name.replace(/,.*/,"")),t(18,Ut=void 0),t(55,et=void 0),t(15,it=-1);else if(ye){const Ke=re||!mr(ye);or(ye,{exact:!0}).then(()=>{t(55,et=gt),t(56,de=void 0),Ke&&gi()}).catch(Qe=>t(18,Ut=Qe))}}function mr(re){try{return oE(re,6)}catch{return!1}}async function or(re,{byId:Ke=!1,exact:Qe=!1}={}){t(18,Ut=void 0),jn==null||jn.abort();const nt=new AbortController;t(19,jn=nt);try{const ct=mr(re),zt=new URLSearchParams;if(K!==void 0&&zt.set("language",Array.isArray(K)?K.join(","):K??""),at&&zt.set("types",at.join(",")),pt&&zt.set("excludeTypes",String(pt)),g&&zt.set("bbox",g.map(Vn=>Vn.toFixed(6)).join(",")),T&&zt.set("country",Array.isArray(T)?T.join(","):T),!Ke&&!ct){const Vn=await ZM(q,Y,nt);Vn&&zt.set("proximity",Vn),(Qe||!De)&&zt.set("autocomplete","false"),zt.set("fuzzyMatch",String(B))}H!==void 0&&(dt||!ct||(at==null?void 0:at.length)===1)&&zt.set("limit",String(H)),zt.set("key",p),Yt(zt);const on=xt+"/"+encodeURIComponent(ct?ct.decimalLongitude+","+ct.decimalLatitude:re)+".json?"+zt.toString();if(on===en){Ke?(t(14,gt=void 0),t(56,de=Hn[0])):t(14,gt=Hn);return}en=on;const gn=await fetch(on,{signal:nt.signal,...Mt});if(!gn.ok)throw new Error(await gn.text());const En=await gn.json();Bn("response",{url:on,featureCollection:En}),Ke?(t(14,gt=void 0),t(56,de=En.features[0]),Hn=[de]):(t(14,gt=En.features.filter(I)),ct&&gt.unshift({type:"Feature",properties:{},id:"reverse_"+ct.decimalLongitude+"_"+ct.decimalLatitude,text:ct.decimalLatitude+", "+ct.decimalLongitude,place_name:ct.decimalLatitude+", "+ct.decimalLongitude,place_type:["reverse"],center:[ct.decimalLongitude,ct.decimalLatitude],bbox:[ct.decimalLongitude,ct.decimalLatitude,ct.decimalLongitude,ct.decimalLatitude],geometry:{type:"Point",coordinates:[ct.decimalLongitude,ct.decimalLatitude]}}),Hn=gt,ct&&Xe.focus())}catch(ct){if(ct&&typeof ct=="object"&&"name"in ct&&ct.name==="AbortError")return;throw ct}finally{nt===jn&&t(19,jn=void 0)}}function gi(){var re;if(!(et!=null&&et.length)||!O)return;const Ke=[180,90,-180,-90],Qe=!et.some(ct=>!ct.matching_text);let nt;for(const ct of et){const zt=Un(ct);if(nt=nt===void 0?zt:zt===void 0?nt:Math.max(nt,zt),Qe||!ct.matching_text)for(const on of[0,1,2,3])Ke[on]=Math[on<2?"min":"max"](Ke[on],((re=ct.bbox)==null?void 0:re[on])??ct.center[on%2])}q&&et.length>0&&(de&&Ke[0]===Ke[2]&&Ke[1]===Ke[3]?q.flyTo(de.center,Un(de)):q.fitBounds(tp(Ke),50,nt))}function Un(re){var Ke;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const Qe=re.id.replace(/\..*/,"");return(Array.isArray((Ke=re.properties)==null?void 0:Ke.categories)?re.properties.categories.reduce((nt,ct)=>{const zt=Je[Qe+"."+ct];return nt===void 0?zt:zt===void 0?nt:Math.max(nt,zt)},void 0):void 0)??Je[Qe]}function Fe(re){t(0,oe=L==="always"),t(14,gt=void 0),t(56,de=void 0),t(15,it=-1),fn(re[1].toFixed(6)+", "+WM(re[0],[-180,180],!0).toFixed(6),!1,!0)}function mt(re){if(!gt)return;let Ke=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;Ke&&(it===(Le?0:-1)&&Ke===-1&&t(15,it=gt.length),t(15,it+=Ke),it>=gt.length&&t(15,it=-1),it<0&&Le&&t(15,it=0),re.preventDefault())}function vt(re=!0,Ke=!1){if(t(18,Ut=void 0),De||Ke){if(Nn&&clearTimeout(Nn),ye.length<J)return;const Qe=ye;Nn=window.setTimeout(()=>{or(Qe).catch(nt=>t(18,Ut=nt))},re?z:0)}else t(14,gt=void 0),t(18,Ut=void 0)}function Dt(re){t(56,de=re),t(1,ye=re.place_name),t(15,it=-1)}const rn=()=>Xe.focus();function tn(re){ag[re?"unshift":"push"](()=>{Xe=re,t(17,Xe)})}function br(){ye=this.value,t(1,ye),t(13,Ge),t(28,x)}const sr=()=>t(13,Ge=!0),Se=()=>t(13,Ge=!1),ne=()=>vt(),ce=()=>{t(1,ye=""),Xe.focus()},ge=()=>t(0,oe=!oe),we=()=>t(18,Ut=void 0),Oe=re=>t(15,it=re),$e=re=>Dt(re),Ve=()=>{Le||t(15,it=-1)},ze=()=>{};return r.$$set=re=>{"class"in re&&t(2,d=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,g=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,x=re.clearOnBlur),"collapsed"in re&&t(4,C=re.collapsed),"country"in re&&t(29,T=re.country),"debounceSearch"in re&&t(30,z=re.debounceSearch),"enableReverse"in re&&t(5,L=re.enableReverse),"errorMessage"in re&&t(6,E=re.errorMessage),"filter"in re&&t(31,I=re.filter),"flyTo"in re&&t(32,O=re.flyTo),"fuzzyMatch"in re&&t(33,B=re.fuzzyMatch),"language"in re&&t(34,K=re.language),"limit"in re&&t(35,H=re.limit),"mapController"in re&&t(36,q=re.mapController),"minLength"in re&&t(37,J=re.minLength),"noResultsMessage"in re&&t(7,he=re.noResultsMessage),"placeholder"in re&&t(8,Ee=re.placeholder),"proximity"in re&&t(38,Y=re.proximity),"reverseActive"in re&&t(0,oe=re.reverseActive),"reverseButtonTitle"in re&&t(9,ke=re.reverseButtonTitle),"searchValue"in re&&t(1,ye=re.searchValue),"pickedResultStyle"in re&&t(39,Ne=re.pickedResultStyle),"showPlaceType"in re&&t(10,Ue=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,De=re.showResultsWhileTyping),"selectFirst"in re&&t(11,Le=re.selectFirst),"flyToSelected"in re&&t(41,lt=re.flyToSelected),"markerOnSelected"in re&&t(42,Ze=re.markerOnSelected),"types"in re&&t(43,at=re.types),"exhaustiveReverseGeocoding"in re&&t(44,dt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,pt=re.excludeTypes),"zoom"in re&&t(46,Je=re.zoom),"apiUrl"in re&&t(47,xt=re.apiUrl),"fetchParameters"in re&&t(48,Mt=re.fetchParameters),"iconsBaseUrl"in re&&t(12,Ot=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,Yt=re.adjustUrlQuery),"$$scope"in re&&t(60,u=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,oe=L==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Wt=Ge),x&&!Ge&&t(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ye.length<J&&(t(56,de=void 0),t(14,gt=void 0),t(18,Ut=void 0),t(55,et=gt)),r.$$.dirty[1]&33554688&&Ne!=="marker-only"&&de&&!de.address&&de.geometry.type==="Point"&&de.place_type[0]!=="reverse"&&or(de.id,{byId:!0}).catch(re=>t(18,Ut=re)),r.$$.dirty[1]&100663330&&(q&&de&&de.id!==An&&O&&(!de.bbox||de.bbox[0]===de.bbox[2]&&de.bbox[1]===de.bbox[3]?q.flyTo(de.center,Un(de)):q.fitBounds(tp(de.bbox),50,Un(de)),t(14,gt=void 0),t(55,et=void 0),t(15,it=-1)),t(57,An=de==null?void 0:de.id)),r.$$.dirty[0]&18432&&Le&&gt!=null&&gt.length&&t(15,it=0),r.$$.dirty[0]&2&&t(15,it=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&et!==gt&&t(55,et=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&q&&q.setEventHandler(re=>{switch(re.type){case"mapClick":oe&&Fe(re.coordinates);break;case"markerClick":{const Ke=gt==null?void 0:gt.find(Qe=>Qe.id===re.id);Ke&&Dt(Ke)}break;case"markerMouseEnter":et&&t(15,it=Wt?(gt==null?void 0:gt.findIndex(Ke=>Ke.id===re.id))??-1:-1);break;case"markerMouseLeave":et&&t(15,it=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=gt==null?void 0:gt[it]),r.$$.dirty[1]&134218786&&q&&i&&O&&lt&&q.flyTo(i.center,Un(i)),r.$$.dirty[1]&256&&t(59,n=Ne==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Ze||q==null||q.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&q&&Ze&&!et&&(q.setFeatures(i?[i]:void 0,void 0,n),q.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&q&&q.setFeatures(et,de,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&et&&q&&q.setSelectedMarker(it),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&q){const re=mr(ye);q.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Bn("select",{feature:i}),r.$$.dirty[1]&33554432&&Bn("pick",{feature:de}),r.$$.dirty[0]&81920&&Bn("optionsvisibilitychange",{optionsVisible:Wt&&!!gt}),r.$$.dirty[0]&16384&&Bn("featureslisted",{features:gt}),r.$$.dirty[1]&16777216&&Bn("featuresmarked",{features:et}),r.$$.dirty[0]&1&&Bn("reversetoggle",{reverse:oe}),r.$$.dirty[0]&2&&Bn("querychange",{query:ye}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&q&&q.indicateReverse(oe)},[oe,ye,d,_,C,L,E,he,Ee,ke,Ue,Le,Ot,Ge,gt,it,Wt,Xe,Ut,jn,ti,yt,mt,vt,Dt,s,p,g,x,T,z,I,O,B,K,H,q,J,Y,Ne,De,lt,Ze,at,dt,pt,Je,xt,Mt,Yt,nn,Qt,fn,mn,qe,et,de,An,i,n,u,o,rn,tn,br,sr,Se,ne,ce,ge,we,Oe,$e,Ve,ze]}let hE=class extends Ka{constructor(r){super(),Xa(this,r,fE,cE,Za,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Gf(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function s_(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return Gf({type:"Polygon",coordinates:r},e,t)}function Wf(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function P2(r,e,t={}){return Gf({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function dE(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(p){return function(g){return d([p,g])}}function d(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=p[0]&2?i.return:p[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,p[1])).done)return o;switch(i=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(r,t)}catch(g){p=[6,g],i=0}finally{n=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var Ua=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function pE(r,e){return r>e?1:r<e?-1:0}function Pa(r,e,t){for(var n=new Ua(null,null),i=n,o=n;;){var u=t(r,e.key);if(u<0){if(e.left===null)break;if(t(r,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(u>0){if(e.right===null)break;if(t(r,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Rm(r,e,t,n){var i=new Ua(r,e);if(t===null)return i.left=i.right=null,i;t=Pa(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function w1(r,e,t){var n=null,i=null;if(e){e=Pa(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function mE(r,e,t){return e===null?r:(r===null||(e=Pa(r.key,e,t),e.left=r),e)}function cg(r,e,t,n,i){if(r){n(""+e+(t?"âââ ":"âââ ")+i(r)+`
`);var o=e+(t?"    ":"â   ");r.left&&cg(r.left,o,!1,n,i),r.right&&cg(r.right,o,!0,n,i)}}var a_=function(){function r(e){e===void 0&&(e=pE),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Rm(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ua(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Pa(e,this._root,i),u=i(e,o.key);return u===0?this._root=o:(u<0?(n.left=o.left,n.right=o,o.left=null):u>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Pa(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Pa(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Pa(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Pa(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],u=this._comparator,s=this._root,d;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),d=u(s.key,t),d>0)break;if(u(s.key,e)>=0&&n.call(i,s))return this;s=s.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return _E(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&dg(e,t,0,i-1,o),this._root===null)this._root=fg(e,t,0,i),this._size=i;else{var u=yE(this.toList(),gE(e,t),o);i=this._size+i,this._root=hg({head:u},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return cg(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=w1(e,this._root,i),u=o.left,s=o.right;i(e,t)<0?s=Rm(t,n,s,i):u=Rm(t,n,u,i),this._root=mE(u,s,i)},r.prototype.split=function(e){return w1(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return dE(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function fg(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),u=r[o],s=e[o],d=new Ua(u,s);return d.left=fg(r,e,t,o),d.right=fg(r,e,o+1,n),d}return null}function gE(r,e){for(var t=new Ua(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ua(r[i],e[i]);return n.next=null,t.next}function _E(r){for(var e=r,t=[],n=!1,i=new Ua(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function hg(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=hg(r,e,i),u=r.head;return u.left=o,r.head=r.head.next,u.right=hg(r,i+1,t),u}return null}function yE(r,e,t){for(var n=new Ua(null,null),i=n,o=r,u=e;o!==null&&u!==null;)t(o.key,u.key)<0?(i.next=o,o=o.next):(i.next=u,u=u.next),i=i.next;return o!==null?i.next=o:u!==null&&(i.next=u),n.next}function dg(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],u=t-1,s=n+1;;){do u++;while(i(r[u],o)<0);do s--;while(i(r[s],o)>0);if(u>=s)break;var d=r[u];r[u]=r[s],r[s]=d,d=e[u],e[u]=e[s],e[s]=d}dg(r,e,t,s,i),dg(r,e,s+1,n,i)}}const ia=11102230246251565e-32,qi=134217729,vE=(3+8*ia)*ia;function Bm(r,e,t,n,i){let o,u,s,d,p=e[0],g=n[0],_=0,x=0;g>p==g>-p?(o=p,p=e[++_]):(o=g,g=n[++x]);let C=0;if(_<r&&x<t)for(g>p==g>-p?(u=p+o,s=o-(u-p),p=e[++_]):(u=g+o,s=o-(u-g),g=n[++x]),o=u,s!==0&&(i[C++]=s);_<r&&x<t;)g>p==g>-p?(u=o+p,d=u-o,s=o-(u-d)+(p-d),p=e[++_]):(u=o+g,d=u-o,s=o-(u-d)+(g-d),g=n[++x]),o=u,s!==0&&(i[C++]=s);for(;_<r;)u=o+p,d=u-o,s=o-(u-d)+(p-d),p=e[++_],o=u,s!==0&&(i[C++]=s);for(;x<t;)u=o+g,d=u-o,s=o-(u-d)+(g-d),g=n[++x],o=u,s!==0&&(i[C++]=s);return(o!==0||C===0)&&(i[C++]=o),C}function bE(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function fh(r){return new Float64Array(r)}const wE=(3+16*ia)*ia,xE=(2+12*ia)*ia,AE=(9+64*ia)*ia*ia,Nu=fh(4),x1=fh(8),A1=fh(12),k1=fh(16),ao=fh(4);function kE(r,e,t,n,i,o,u){let s,d,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J;const he=r-i,Ee=t-i,Y=e-o,oe=n-o;B=he*oe,x=qi*he,C=x-(x-he),T=he-C,x=qi*oe,z=x-(x-oe),L=oe-z,K=T*L-(B-C*z-T*z-C*L),H=Y*Ee,x=qi*Y,C=x-(x-Y),T=Y-C,x=qi*Ee,z=x-(x-Ee),L=Ee-z,q=T*L-(H-C*z-T*z-C*L),E=K-q,_=K-E,Nu[0]=K-(E+_)+(_-q),I=B+E,_=I-B,O=B-(I-_)+(E-_),E=O-H,_=O-E,Nu[1]=O-(E+_)+(_-H),J=I+E,_=J-I,Nu[2]=I-(J-_)+(E-_),Nu[3]=J;let ke=bE(4,Nu),ye=xE*u;if(ke>=ye||-ke>=ye||(_=r-he,s=r-(he+_)+(_-i),_=t-Ee,p=t-(Ee+_)+(_-i),_=e-Y,d=e-(Y+_)+(_-o),_=n-oe,g=n-(oe+_)+(_-o),s===0&&d===0&&p===0&&g===0)||(ye=AE*u+vE*Math.abs(ke),ke+=he*g+oe*s-(Y*p+Ee*d),ke>=ye||-ke>=ye))return ke;B=s*oe,x=qi*s,C=x-(x-s),T=s-C,x=qi*oe,z=x-(x-oe),L=oe-z,K=T*L-(B-C*z-T*z-C*L),H=d*Ee,x=qi*d,C=x-(x-d),T=d-C,x=qi*Ee,z=x-(x-Ee),L=Ee-z,q=T*L-(H-C*z-T*z-C*L),E=K-q,_=K-E,ao[0]=K-(E+_)+(_-q),I=B+E,_=I-B,O=B-(I-_)+(E-_),E=O-H,_=O-E,ao[1]=O-(E+_)+(_-H),J=I+E,_=J-I,ao[2]=I-(J-_)+(E-_),ao[3]=J;const Ne=Bm(4,Nu,4,ao,x1);B=he*g,x=qi*he,C=x-(x-he),T=he-C,x=qi*g,z=x-(x-g),L=g-z,K=T*L-(B-C*z-T*z-C*L),H=Y*p,x=qi*Y,C=x-(x-Y),T=Y-C,x=qi*p,z=x-(x-p),L=p-z,q=T*L-(H-C*z-T*z-C*L),E=K-q,_=K-E,ao[0]=K-(E+_)+(_-q),I=B+E,_=I-B,O=B-(I-_)+(E-_),E=O-H,_=O-E,ao[1]=O-(E+_)+(_-H),J=I+E,_=J-I,ao[2]=I-(J-_)+(E-_),ao[3]=J;const Ue=Bm(Ne,x1,4,ao,A1);B=s*g,x=qi*s,C=x-(x-s),T=s-C,x=qi*g,z=x-(x-g),L=g-z,K=T*L-(B-C*z-T*z-C*L),H=d*p,x=qi*d,C=x-(x-d),T=d-C,x=qi*p,z=x-(x-p),L=p-z,q=T*L-(H-C*z-T*z-C*L),E=K-q,_=K-E,ao[0]=K-(E+_)+(_-q),I=B+E,_=I-B,O=B-(I-_)+(E-_),E=O-H,_=O-E,ao[1]=O-(E+_)+(_-H),J=I+E,_=J-I,ao[2]=I-(J-_)+(E-_),ao[3]=J;const De=Bm(Ue,A1,4,ao,k1);return k1[De-1]}function SE(r,e,t,n,i,o){const u=(e-o)*(t-i),s=(r-i)*(n-o),d=u-s,p=Math.abs(u+s);return Math.abs(d)>=wE*p?d:-kE(r,e,t,n,i,o,p)}const gf=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,pg=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let Ra=Number.EPSILON;Ra===void 0&&(Ra=Math.pow(2,-52));const CE=Ra*Ra,S1=(r,e)=>{if(-Ra<r&&r<Ra&&-Ra<e&&e<Ra)return 0;const t=r-e;return t*t<CE*r*e?0:r<e?-1:1};class TE{constructor(){this.reset()}reset(){this.xRounder=new C1,this.yRounder=new C1}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class C1{constructor(){this.tree=new a_,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&S1(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&S1(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const Zf=new TE,Ud=(r,e)=>r.x*e.y-r.y*e.x,z2=(r,e)=>r.x*e.x+r.y*e.y,T1=(r,e,t)=>{const n=SE(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},np=r=>Math.sqrt(z2(r,r)),ME=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return Ud(i,n)/np(i)/np(n)},EE=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return z2(i,n)/np(i)/np(n)},M1=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},E1=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},LE=(r,e,t,n)=>{if(e.x===0)return E1(t,n,r.x);if(n.x===0)return E1(r,e,t.x);if(e.y===0)return M1(t,n,r.y);if(n.y===0)return M1(r,e,t.y);const i=Ud(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},u=Ud(o,e)/i,s=Ud(o,n)/i,d=r.x+s*e.x,p=t.x+u*n.x,g=r.y+s*e.y,_=t.y+u*n.y,x=(d+p)/2,C=(g+_)/2;return{x,y:C}};class Jo{static compare(e,t){const n=Jo.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ba.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:ME(this.point,e.point,o.point),cosine:EE(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:u,cosine:s}=t.get(i),{sine:d,cosine:p}=t.get(o);return u>=0&&d>=0?s<p?1:s>p?-1:0:u<0&&d<0?s<p?-1:s>p?1:0:d<u?-1:d>u?1:0}}}let IE=0;class Ba{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,u=t.rightSE.point.x;if(u<n)return 1;if(o<i)return-1;const s=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,g=t.rightSE.point.y;if(n<i){if(d<s&&d<p)return 1;if(d>s&&d>p)return-1;const _=e.comparePoint(t.leftSE.point);if(_<0)return 1;if(_>0)return-1;const x=t.comparePoint(e.rightSE.point);return x!==0?x:-1}if(n>i){if(s<d&&s<g)return-1;if(s>d&&s>g)return 1;const _=t.comparePoint(e.leftSE.point);if(_!==0)return _;const x=e.comparePoint(t.rightSE.point);return x<0?1:x>0?-1:1}if(s<d)return-1;if(s>d)return 1;if(o<u){const _=t.comparePoint(e.rightSE.point);if(_!==0)return _}if(o>u){const _=e.comparePoint(t.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(o!==u){const _=p-s,x=o-n,C=g-d,T=u-i;if(_>x&&C<T)return 1;if(_<x&&C>T)return-1}return o>u?1:o<u||p<g?-1:p>g?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++IE,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,u;const s=Jo.comparePoints(e,t);if(s<0)i=e,o=t,u=1;else if(s>0)i=t,o=e,u=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new Jo(i,!0),p=new Jo(o,!1);return new Ba(d,p,[n],[u])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,u=t.x+o*i.x;if(e.x===u)return 0;const s=(e.x-t.x)/i.x,d=t.y+s*i.y;return e.y===d?0:e.y<d?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=pg(t,n);if(i===null)return null;const o=this.leftSE.point,u=this.rightSE.point,s=e.leftSE.point,d=e.rightSE.point,p=gf(t,s)&&this.comparePoint(s)===0,g=gf(n,o)&&e.comparePoint(o)===0,_=gf(t,d)&&this.comparePoint(d)===0,x=gf(n,u)&&e.comparePoint(u)===0;if(g&&p)return x&&!_?u:!x&&_?d:null;if(g)return _&&o.x===d.x&&o.y===d.y?null:o;if(p)return x&&u.x===s.x&&u.y===s.y?null:s;if(x&&_)return null;if(x)return u;if(_)return d;const C=LE(o,this.vector(),s,e.vector());return C===null||!gf(i,C)?null:Zf.round(C.x,C.y)}split(e){const t=[],n=e.events!==void 0,i=new Jo(e,!0),o=new Jo(e,!1),u=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const s=new Ba(i,u,this.rings.slice(),this.windings.slice());return Jo.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),Jo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Ba.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,u=n.rings.length;o<u;o++){const s=n.rings[o],d=n.windings[o],p=t.rings.indexOf(s);p===-1?(t.rings.push(s),t.windings.push(d)):t.windings[p]+=d}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let s=0,d=this.rings.length;s<d;s++){const p=this.rings[s],g=this.windings[s],_=t.indexOf(p);_===-1?(t.push(p),n.push(g)):n[_]+=g}const o=[],u=[];for(let s=0,d=t.length;s<d;s++){if(n[s]===0)continue;const p=t[s],g=p.poly;if(u.indexOf(g)===-1)if(p.isExterior)o.push(g);else{u.indexOf(g)===-1&&u.push(g);const _=o.indexOf(p.poly);_!==-1&&o.splice(_,1)}}for(let s=0,d=o.length;s<d;s++){const p=o[s].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(_s.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===_s.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${_s.type}`)}return this._isInResult}}class L1{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Zf.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let u=1,s=e.length;u<s;u++){if(typeof e[u][0]!="number"||typeof e[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let d=Zf.round(e[u][0],e[u][1]);d.x===o.x&&d.y===o.y||(this.segments.push(Ba.fromRing(o,d,this)),d.x<this.bbox.ll.x&&(this.bbox.ll.x=d.x),d.y<this.bbox.ll.y&&(this.bbox.ll.y=d.y),d.x>this.bbox.ur.x&&(this.bbox.ur.x=d.x),d.y>this.bbox.ur.y&&(this.bbox.ur.y=d.y),o=d)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Ba.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class PE{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new L1(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new L1(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class I1{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new PE(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class rp{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let u=null,s=o.leftSE,d=o.rightSE;const p=[s],g=s.point,_=[];for(;u=s,s=d,p.push(s),s.point!==g;)for(;;){const x=s.getAvailableLinkedEvents();if(x.length===0){const z=p[0].point,L=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${z.x}, ${z.y}]. Last matching segment found ends at [${L.x}, ${L.y}].`)}if(x.length===1){d=x[0].otherSE;break}let C=null;for(let z=0,L=_.length;z<L;z++)if(_[z].point===s.point){C=z;break}if(C!==null){const z=_.splice(C)[0],L=p.splice(z.index);L.unshift(L[0].otherSE),t.push(new rp(L.reverse()));continue}_.push({index:p.length,point:s.point});const T=s.getLeftmostComparator(u);d=x.sort(T)[0].otherSE;break}t.push(new rp(p))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,g=this.events.length-1;p<g;p++){const _=this.events[p].point,x=this.events[p+1].point;T1(_,e,x)!==0&&(t.push(_),e=_)}if(t.length===1)return null;const n=t[0],i=t[1];T1(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,d=[];for(let p=u;p!=s;p+=o)d.push([t[p].x,t[p].y]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const u=this.events[i];Jo.compare(e,u)>0&&(e=u)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class P1{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class zE{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new P1(o));else{const u=o.enclosingRing();u.poly||t.push(new P1(u)),u.poly.addInterior(o)}}return t}}class DE{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ba.compare;this.queue=e,this.tree=new a_(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,u=i,s,d;for(;s===void 0;)o=this.tree.prev(o),o===null?s=null:o.key.consumedBy===void 0&&(s=o.key);for(;d===void 0;)u=this.tree.next(u),u===null?d=null:u.key.consumedBy===void 0&&(d=u.key);if(e.isLeft){let p=null;if(s){const _=s.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(p=_),!s.isAnEndpoint(_))){const x=this._splitSafely(s,_);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}}let g=null;if(d){const _=d.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(g=_),!d.isAnEndpoint(_))){const x=this._splitSafely(d,_);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}}if(p!==null||g!==null){let _=null;p===null?_=g:g===null?_=p:_=Jo.comparePoints(p,g)<=0?p:g,this.queue.remove(t.rightSE),n.push(t.rightSE);const x=t.split(_);for(let C=0,T=x.length;C<T;C++)n.push(x[C])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&d){const p=s.getIntersection(d);if(p!==null){if(!s.isAnEndpoint(p)){const g=this._splitSafely(s,p);for(let _=0,x=g.length;_<x;_++)n.push(g[_])}if(!d.isAnEndpoint(p)){const g=this._splitSafely(d,p);for(let _=0,x=g.length;_<x;_++)n.push(g[_])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const z1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,RE=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class BE{run(e,t,n){_s.type=e,Zf.reset();const i=[new I1(t,!0)];for(let g=0,_=n.length;g<_;g++)i.push(new I1(n[g],!1));if(_s.numMultiPolys=i.length,_s.type==="difference"){const g=i[0];let _=1;for(;_<i.length;)pg(i[_].bbox,g.bbox)!==null?_++:i.splice(_,1)}if(_s.type==="intersection")for(let g=0,_=i.length;g<_;g++){const x=i[g];for(let C=g+1,T=i.length;C<T;C++)if(pg(x.bbox,i[C].bbox)===null)return[]}const o=new a_(Jo.compare);for(let g=0,_=i.length;g<_;g++){const x=i[g].getSweepEvents();for(let C=0,T=x.length;C<T;C++)if(o.insert(x[C]),o.size>z1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const u=new DE(o);let s=o.size,d=o.pop();for(;d;){const g=d.key;if(o.size===s){const x=g.segment;throw new Error(`Unable to pop() ${g.isLeft?"left":"right"} SweepEvent [${g.point.x}, ${g.point.y}] from segment #${x.id} [${x.leftSE.point.x}, ${x.leftSE.point.y}] -> [${x.rightSE.point.x}, ${x.rightSE.point.y}] from queue.`)}if(o.size>z1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(u.segments.length>RE)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const _=u.process(g);for(let x=0,C=_.length;x<C;x++){const T=_[x];T.consumedBy===void 0&&o.insert(T)}s=o.size,d=o.pop()}Zf.reset();const p=rp.factory(u.segments);return new zE(p).getGeom()}}const _s=new BE,FE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return _s.run("union",r,t)},OE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return _s.run("intersection",r,t)},$E=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return _s.run("xor",r,t)},NE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return _s.run("difference",r,t)};var D2={union:FE,intersection:OE,xor:$E,difference:NE};function R2(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,_=0,x,C=r.type,T=C==="FeatureCollection",z=C==="Feature",L=T?r.features.length:1,E=0;E<L;E++){p=T?r.features[E].geometry:z?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var O=0,B=0;if(u=x?p.geometries[I]:p,u!==null){d=u.coordinates;var K=u.type;switch(g=0,K){case null:break;case"Point":if(e(d,_,E,O,B)===!1)return!1;_++,O++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,E,O,B)===!1)return!1;_++,K==="MultiPoint"&&O++}K==="LineString"&&O++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],_,E,O,B)===!1)return!1;_++}K==="MultiLineString"&&O++,K==="Polygon"&&B++}K==="Polygon"&&O++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(B=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],_,E,O,B)===!1)return!1;_++}B++}O++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(R2(u.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function l_(r,e){var t,n,i,o,u,s,d,p,g,_,x=0,C=r.type==="FeatureCollection",T=r.type==="Feature",z=C?r.features.length:1;for(t=0;t<z;t++){for(s=C?r.features[t].geometry:T?r.geometry:r,p=C?r.features[t].properties:T?r.properties:{},g=C?r.features[t].bbox:T?r.bbox:void 0,_=C?r.features[t].id:T?r.id:void 0,d=s?s.type==="GeometryCollection":!1,u=d?s.geometries.length:1,i=0;i<u;i++){if(o=d?s.geometries[i]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function jE(r,e){l_(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Gf(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:d,coordinates:g};if(e(Gf(_,i),n,p)===!1)return!1}})}function UE(r,e={}){const t=[];if(l_(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=D2.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?s_(n[0],e.properties):P2(n,e.properties)}var B2=UE;function VE(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return R2(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var D1=VE;function qE(r){const e=[];if(l_(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=D2.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?s_(n[0],t):P2(n,t)}var HE=qE;function GE(r){if(!r)throw new Error("geojson is required");var e=[];return jE(r,function(t){e.push(t)}),Wf(e)}var WE=GE;function R1(r,e){const t=HE(Wf([s_([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=tp(D1(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,u=n[2]>180,s=WE(r);if(s.features.length>1&&(o||u))for(const d of s.features){const p=tp(D1(d));if(u&&p[0]<-180+i)for(const g of d.geometry.coordinates)for(const _ of g)_[0]+=360-i;if(o&&p[2]>180-i)for(const g of d.geometry.coordinates)for(const _ of g)_[0]-=360-i}e(Wf([s.features.length<2?r:B2(s)??r,t]))}const B1={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Cd="mtlr-gc-full-geom",F1="mtlr-gc-full-geom-fill",O1="mtlr-gc-full-geom-line";function F2(r,e,t=!0,n=!0,i={},o={},u=B1){let s;const d=[];let p,g,_;function x(){if(!r.loaded){r.once("load",x);return}const L=u?u===!0?B1:u:void 0;if(!(L!=null&&L.fill)&&!(L!=null&&L.line))return;const E=r.getSource(Cd);if(E)E.setData(_??Wf([]));else if(_)r.addSource(Cd,{type:"geojson",data:_});else return;!r.getLayer(F1)&&L!=null&&L.fill&&r.addLayer({...L==null?void 0:L.fill,id:F1,type:"fill",source:Cd}),!r.getLayer(O1)&&L!=null&&L.line&&r.addLayer({...L==null?void 0:L.line,id:O1,type:"line",source:Cd})}function C(L){_=L,x()}r.on("styledata",()=>{setTimeout(()=>{_&&x()})});const T=L=>{s==null||s({type:"mapClick",coordinates:[L.lngLat.lng,L.lngLat.lat]})};function z(L=!1){if(!e)throw new Error;const E=document.createElement("div");return L&&E.classList.add("marker-interactive"),new UM({props:{displayIn:"maplibre"},target:E}),new e.Marker({element:E,offset:[1,-13]})}return{setEventHandler(L){L?(s=L,r.on("click",T)):(s=void 0,r.off("click",T))},flyTo(L,E){r.flyTo({center:L,...E?{zoom:E}:{},...i})},fitBounds(L,E,I){r.fitBounds([[L[0],L[1]],[L[2],L[3]]],{padding:E,...I?{maxZoom:I}:{},...o})},indicateReverse(L){r.getCanvasContainer().style.cursor=L?"crosshair":""},setReverseMarker(L){!e||!t||(g?L?g.setLngLat(L):(g.remove(),g=void 0):L&&(t instanceof Function?g=t(r)??void 0:(g=(typeof t=="object"?new e.Marker(t):z()).setLngLat(L).addTo(r),g.getElement().classList.add("marker-reverse"))))},setFeatures(L,E,I){for(const O of d)O.remove();if(d.length=0,C(void 0),!!e){if(E){let O=!1;if(E.geometry.type==="GeometryCollection"){const B=E.geometry.geometries.filter(K=>K.type==="Polygon"||K.type==="MultiPolygon");e:if(B.length>0){const K=B2(Wf(B.map(H=>Gf(H))));if(!K)break e;R1({...E,geometry:K.geometry},C),O=!0}else{const K=E.geometry.geometries.filter(H=>H.type==="LineString"||H.type==="MultiLineString");K.length>0&&(C({...E,geometry:{type:"GeometryCollection",geometries:K}}),O=!0)}}if(!O){if(E.geometry.type==="Polygon"||E.geometry.type==="MultiPolygon")R1(E,C);else if(E.geometry.type==="LineString"||E.geometry.type==="MultiLineString"){C(E);return}}if(!I&&E.geometry.type!=="Point")return;if(t instanceof Function){const B=t(r,E);B&&d.push(B)}else t&&d.push(typeof t=="object"?new e.Marker(t):z().setLngLat(E.center).addTo(r))}if(n)for(const O of L??[]){if(O===E)continue;let B;if(n instanceof Function){if(B=n(r,O),!B)continue}else B=(typeof n=="object"?new e.Marker(n):z(!0)).setLngLat(O.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(O.place_type[0]==="reverse"?O.place_name:O.place_name.replace(/,.*/,""))).addTo(r);const K=B.getElement();K.addEventListener("click",H=>{H.stopPropagation(),s==null||s({type:"markerClick",id:O.id})}),K.addEventListener("mouseenter",()=>{s==null||s({type:"markerMouseEnter",id:O.id}),B.togglePopup()}),K.addEventListener("mouseleave",()=>{s==null||s({type:"markerMouseLeave",id:O.id}),B.togglePopup()}),d.push(B)}}},setSelectedMarker(L){p&&p.getElement().classList.toggle("marker-selected",!1),p=L>-1?d[L]:void 0,p==null||p.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const L=r.getCenter();return[r.getZoom(),L.lng,L.lat]}}}function ZE(r,e,t){var n,i;class o{constructor(L,E){zo(this,"type"),zo(this,"target"),this.type=E,this.target=L}}class u extends o{constructor(L,E){super(L,"select"),zo(this,"feature"),Object.assign(this,E)}}class s extends o{constructor(L,E){super(L,"featureslisted"),zo(this,"features"),this.features=E}}class d extends o{constructor(L,E){super(L,"featuresmarked"),zo(this,"features"),this.features=E}}class p extends o{constructor(L,E){super(L,"optionsvisibilitychange"),zo(this,"optionsVisible"),this.optionsVisible=E}}class g extends o{constructor(L,E){super(L,"pick"),zo(this,"feature"),this.feature=E}}class _ extends o{constructor(L,E){super(L,"querychange"),zo(this,"query"),this.query=E}}class x extends o{constructor(L,E,I){super(L,"response"),zo(this,"url"),zo(this,"featureCollection"),this.url=E,this.featureCollection=I}}class C extends o{constructor(L,E){super(L,"reversetoggle"),zo(this,"reverse"),this.reverse=E}}class T extends r{constructor(L={}){super(),t1(this,n),t1(this,i),n1(this,i,L)}onAddInt(L){const E=document.createElement("div");E.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:I,showResultMarkers:O,flyTo:B,fullGeometryStyle:K,...H}=yi(this,i),q=typeof B=="boolean"?{}:B,J={mapController:F2(L,e,I,O,q,q,K),flyTo:B===void 0?!0:!!B,apiKey:"",...t==null?void 0:t(L,E),...H};if(!J.apiKey)throw new Error("no apiKey provided");return n1(this,n,new hE({target:E,props:J})),yi(this,n).$on("select",he=>{this.fire(new u(this,he.detail))}),yi(this,n).$on("pick",he=>{this.fire(new g(this,he.detail.feature))}),yi(this,n).$on("featureslisted",he=>{this.fire(new s(this,he.detail.features))}),yi(this,n).$on("featuresmarked",he=>{this.fire(new d(this,he.detail.features))}),yi(this,n).$on("response",he=>{this.fire(new x(this,he.detail.url,he.detail.featureCollection))}),yi(this,n).$on("optionsvisibilitychange",he=>{this.fire(new p(this,he.detail.optionsVisible))}),yi(this,n).$on("reversetoggle",he=>{this.fire(new C(this,he.detail.reverse))}),yi(this,n).$on("querychange",he=>{this.fire(new _(this,he.detail.query))}),E}on(L,E){return super.on(L,E)}once(L,E){return super.once(L,E)}off(L,E){return super.off(L,E)}listens(L){return super.listens(L)}setOptions(L){var E;Object.assign(yi(this,i),L);const{marker:I,showResultMarkers:O,flyTo:B,fullGeometryStyle:K,...H}=yi(this,i);(E=yi(this,n))==null||E.$set(H)}setQuery(L,E=!0){var I;(I=yi(this,n))==null||I.setQuery(L,E)}clearMap(){var L;(L=yi(this,n))==null||L.clearMap()}clearList(){var L;(L=yi(this,n))==null||L.clearList()}setReverseMode(L){var E;(E=yi(this,n))==null||E.$set({reverseActive:L})}focus(){var L;(L=yi(this,n))==null||L.focus()}blur(){var L;(L=yi(this,n))==null||L.blur()}onRemove(){var L;(L=yi(this,n))==null||L.$destroy()}}return n=new WeakMap,i=new WeakMap,{MapLibreBasedGeocodingControl:T,events:{SelectEvent:u,FeaturesListedEvent:s,FeaturesMarkedEvent:d,OptionsVisibilityChangeEvent:p,PickEvent:g,QueryChangeEvent:_,ResponseEvent:x,ReverseToggleEvent:C}}}const{MapLibreBasedGeocodingControl:$B,events:Ja}=ZE(oa.Evented,bk);Ja.SelectEvent;Ja.FeaturesListedEvent;Ja.FeaturesMarkedEvent;Ja.OptionsVisibilityChangeEvent;Ja.PickEvent;Ja.QueryChangeEvent;Ja.ResponseEvent;Ja.ReverseToggleEvent;function XE(r){let e,t;return{c(){e=ys("svg"),t=ys("path"),fe(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),fe(e,"viewBox","0 0 14 14"),fe(e,"width","13"),fe(e,"height","13"),fe(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),R(e,t)},p:ft,i:ft,o:ft,d(n){n&&G(e)}}}class O2 extends Tt{constructor(e){super(),Ct(this,e,null,XE,wt,{})}}function KE(r){let e,t;return{c(){e=ys("svg"),t=ys("path"),fe(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),fe(e,"viewBox","0 0 30 30"),fe(e,"fill","none"),fe(e,"xmlns","http://www.w3.org/2000/svg"),fe(e,"class","svelte-d2loi5")},m(n,i){W(n,e,i),R(e,t)},p:ft,i:ft,o:ft,d(n){n&&G(e)}}}class $2 extends Tt{constructor(e){super(),Ct(this,e,null,KE,wt,{})}}function JE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"area.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"area.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&G(e)}}}function YE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"reverse.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"reverse.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&G(e)}}}function QE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"poi.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"poi.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&G(e)}}}function eL(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"postal_code.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"postal_code.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&G(e)}}}function tL(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"street.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"street.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&G(e)}}}function nL(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"road.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"road.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&G(e)}}}function rL(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"housenumber.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"housenumber.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&G(e)}}}function iL(r){let e,t,n,i;return{c(){e=U("img"),Sr(e.src,t=r[5])||fe(e,"src",t),fe(e,"alt",r[4]),fe(e,"class","svelte-ltkwvy")},m(o,u){W(o,e,u),n||(i=Lt(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Sr(e.src,t=o[5])&&fe(e,"src",t),u&16&&fe(e,"alt",o[4])},d(o){o&&G(e),n=!1,i()}}}function $1(r){let e,t;return{c(){e=U("span"),t=Te(r[6]),fe(e,"class","secondary svelte-ltkwvy")},m(n,i){W(n,e,i),R(e,t)},p(n,i){i&64&&At(t,n[6])},d(n){n&&G(e)}}}function oL(r){let e,t,n,i,o,u,s,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],T,z,L=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",E,I,O;function B(J,he){return he&1&&(t=null),he&1&&(n=null),he&1&&(i=null),he&1&&(o=null),J[5]?iL:J[0].address?rL:(t==null&&(t=!!J[0].id.startsWith("road.")),t?nL:(n==null&&(n=!!J[0].id.startsWith("address.")),n?tL:(i==null&&(i=!!J[0].id.startsWith("postal_code.")),i?eL:(o==null&&(o=!!J[0].id.startsWith("poi.")),o?QE:J[7]?YE:JE))))}let K=B(r,-1),H=K(r),q=C&&$1(r);return{c(){e=U("li"),H.c(),u=ie(),s=U("span"),d=U("span"),p=U("span"),_=Te(g),x=ie(),q&&q.c(),T=ie(),z=U("span"),E=Te(L),fe(p,"class","primary svelte-ltkwvy"),fe(d,"class","svelte-ltkwvy"),fe(z,"class","line2 svelte-ltkwvy"),fe(s,"class","texts svelte-ltkwvy"),fe(e,"tabindex","0"),fe(e,"data-selected",r[1]),fe(e,"class","svelte-ltkwvy"),Gt(e,"selected",r[1])},m(J,he){W(J,e,he),H.m(e,null),R(e,u),R(e,s),R(s,d),R(d,p),R(p,_),R(d,x),q&&q.m(d,null),R(s,T),R(s,z),R(z,E),I||(O=[Lt(e,"mouseenter",r[12]),Lt(e,"focus",r[13])],I=!0)},p(J,[he]){K===(K=B(J,he))&&H?H.p(J,he):(H.d(1),H=K(J),H&&(H.c(),H.m(e,u))),he&1&&g!==(g=(J[7]?J[0].place_name:J[0].place_name.replace(/,.*/,""))+"")&&At(_,g),he&37&&(C=J[2]==="always"||J[2]!=="never"&&!J[0].address&&!J[0].id.startsWith("road.")&&!J[0].id.startsWith("address.")&&!J[0].id.startsWith("postal_code.")&&(!J[0].id.startsWith("poi.")||!J[5])&&!J[7]),C?q?q.p(J,he):(q=$1(J),q.c(),q.m(d,null)):q&&(q.d(1),q=null),he&1&&L!==(L=(J[7]?"":J[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&At(E,L),he&2&&fe(e,"data-selected",J[1]),he&2&&Gt(e,"selected",J[1])},i:ft,o:ft,d(J){J&&G(e),H.d(),q&&q.d(),I=!1,hr(O)}}}function sL(r,e,t){var O;let n,i,{feature:o}=e,{selected:u=!1}=e,{showPlaceType:s}=e,{missingIconsCache:d}=e,{iconsBaseUrl:p}=e;const g=(O=o.properties)==null?void 0:O.categories;let _,x,C=0,T=o.place_type[0]==="reverse";function z(){x&&d.add(x),t(10,C++,C)}function L(B){Sn.call(this,r,B)}function E(B){Sn.call(this,r,B)}const I=()=>z();return r.$$set=B=>{"feature"in B&&t(0,o=B.feature),"selected"in B&&t(1,u=B.selected),"showPlaceType"in B&&t(2,s=B.showPlaceType),"missingIconsCache"in B&&t(9,d=B.missingIconsCache),"iconsBaseUrl"in B&&t(3,p=B.iconsBaseUrl)},r.$$.update=()=>{var B,K,H,q;if(r.$$.dirty&3640)do t(11,n--,n),t(4,_=g==null?void 0:g[n]),t(5,x=_?p+_.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!x||d.has(x)));r.$$.dirty&1&&t(6,i=((K=(B=o.properties)==null?void 0:B.categories)==null?void 0:K.join(", "))??((q=(H=o.properties)==null?void 0:H.place_type_name)==null?void 0:q[0])??o.place_type[0])},t(11,n=(g==null?void 0:g.length)??0),[o,u,s,p,_,x,i,T,z,d,C,n,L,E,I]}class aL extends Tt{constructor(e){super(),Ct(this,e,sL,oL,wt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function lL(r){let e;return{c(){e=U("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',fe(e,"class","svelte-7cmwmc")},m(t,n){W(t,e,n)},p:ft,i:ft,o:ft,d(t){t&&G(e)}}}class uL extends Tt{constructor(e){super(),Ct(this,e,null,lL,wt,{})}}function cL(r){let e,t;return{c(){e=ys("svg"),t=ys("path"),fe(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),fe(e,"viewBox","0 0 60.006 21.412"),fe(e,"width","14"),fe(e,"height","20"),fe(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),R(e,t)},p:ft,i:ft,o:ft,d(n){n&&G(e)}}}class fL extends Tt{constructor(e){super(),Ct(this,e,null,cL,wt,{})}}function hL(r){let e,t,n;return{c(){e=ys("svg"),t=ys("circle"),n=ys("path"),fe(t,"cx","4.789"),fe(t,"cy","4.787"),fe(t,"r","3.85"),fe(t,"class","svelte-1aq105l"),fe(n,"d","M12.063 12.063 7.635 7.635"),fe(n,"class","svelte-1aq105l"),fe(e,"xmlns","http://www.w3.org/2000/svg"),fe(e,"width","13"),fe(e,"height","13"),fe(e,"viewBox","0 0 13 13"),fe(e,"class","svelte-1aq105l")},m(i,o){W(i,e,o),R(e,t),R(e,n)},p:ft,i:ft,o:ft,d(i){i&&G(e)}}}class dL extends Tt{constructor(e){super(),Ct(this,e,null,hL,wt,{})}}function pL(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function N1(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let _f;async function mL(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(_f&&i.cachedLocationExpiry&&_f.time+i.cachedLocationExpiry>Date.now()){if(!_f.coords)break e;return _f.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{s(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(_f={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const gL=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,j1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,U1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([â¢ÂºÂ°]?)[\s]*(EAST|WEST|[EW])?$/i,V1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,q1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,H1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|ââ|Â´Â´|["â³â\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([â¢ÂºÂ°\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['â²Â´â\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''|â²â²|Â´Â´|ââ|["â³â\.])?\s*(EAST|WEST|[EW])?$/i;function _L(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let d;r=="DD"&&(d=`${i}Â° ${u}, ${o}Â° ${s}`);const p=Math.floor(i),g=Math.floor(o),_=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=G1(_,3).toFixed(3).padStart(6,"0"),T=G1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&T.endsWith(".000")&&(C=C.replace(/\.000$/,""),T=T.replace(/\.000$/,"")),d=`${p}Â° ${C}' ${u}, ${g}Â° ${T}' ${s}`}if(r=="DMS"){const C=Math.floor(_),T=Math.floor(x);let z=((_-C)*60).toFixed(1).padStart(4,"0"),L=((x-T)*60).toFixed(1).padStart(4,"0");const E=C.toString().padStart(2,"0"),I=T.toString().padStart(2,"0");z.endsWith(".0")&&L.endsWith(".0")&&(z=z.replace(/\.0$/,""),L=L.replace(/\.0$/,"")),d=`${p}Â° ${E}' ${z}" ${u}, ${g}Â° ${I}' ${L}" ${s}`}return d}else throw new Error("no decimal coordinates to convert")}function G1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function u_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],d=!1;if(gL.test(r))throw new Error("invalid coordinate value");if(j1.test(r))if(s=j1.exec(r),d=yf(s),d)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(U1.test(r))if(s=U1.exec(r),d=yf(s),d){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(V1.test(r))if(s=V1.exec(r),d=yf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(q1.test(r))if(s=q1.exec(r),d=yf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(H1.test(r)){if(s=H1.exec(r),d=yf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let _,x;const C=/[,/;\u0020]/g,T=g.match(C);if(T==null){const E=Math.floor(r.length/2);_=g.substring(0,E).trim(),x=g.substring(E).trim()}else{let E;T.length%2==1?E=Math.floor(T.length/2):E=T.length/2-1;let I=0;if(E==0)I=g.indexOf(T[0]),_=g.substring(0,I).trim(),x=g.substring(I+1).trim();else{let O=0,B=0;for(;O<=E;)I=g.indexOf(T[O],B),B=I+1,O++;_=g.substring(0,I).trim(),x=g.substring(I+1).trim()}}const z=_.split(".");if(z.length==2&&z[1]==0&&z[1].length!=2)throw new Error("invalid coordinates format");const L=x.split(".");if(L.length==2&&L[1]==0&&L[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:yL,toCoordinateFormat:_L})}else throw new Error("coordinates pattern match failed")}function yf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],d=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(d||p||g)continue;return!1}}return!0}function W1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function yL(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return W1(this.decimalLatitude,Number(e[0]))&&W1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const vL=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});u_.to=vL;const bL=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:"40.123Â° N 74.123Â° W",verbatimLatitude:"40.123Â° N",verbatimLongitude:"74.123Â° W"},{verbatimCoordinates:'40Â° 7Â´ 22.8" N 74Â° 7Â´ 22.8" W',verbatimLatitude:'40Â° 7Â´ 22.8" N',verbatimLongitude:'74Â° 7Â´ 22.8" W'},{verbatimCoordinates:"40Â° 7.38â , -74Â° 7.38â",verbatimLatitude:"40Â° 7.38â",verbatimLongitude:"-74Â° 7.38â"},{verbatimCoordinates:"N40Â°7â22.8ââ, W74Â°7â22.8ââ",verbatimLatitude:"N40Â°7â22.8ââ",verbatimLongitude:"W74Â°7â22.8ââ"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:`40Â°7'22.8"N, 74Â°7'22.8"W`,verbatimLatitude:`40Â°7'22.8"N`,verbatimLongitude:`74Â°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123Â°,-74.123Â°",verbatimLatitude:"40.123Â°",verbatimLongitude:"-74.123Â°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40Â°7â22.8"N, 74Â°7â22.8"W',verbatimLatitude:'40Â°7â22.8"N',verbatimLongitude:'74Â°7â22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40Â°7â23"N 74Â°7â23"W',verbatimLatitude:'40Â°7â23"N',verbatimLongitude:'74Â°7â23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40Â°7â23"S 74Â°7â23"E',verbatimLatitude:'40Â°7â23"S',verbatimLongitude:'74Â°7â23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40Â°7â23" -74Â°7â23"',verbatimLatitude:'40Â°7â23"',verbatimLongitude:'-74Â°7â23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7â 23" N 74d 7â 23" W',verbatimLatitude:'40d 7â 23" N',verbatimLongitude:'74d 7â 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40Â° 7.38, -74Â° 7.38",verbatimLatitude:"40Â° 7.38",verbatimLongitude:"-74Â° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],wL={decimalLatitude:40.123,decimalLongitude:-74.123},xL=[{verbatimCoordinates:`50Â°4'17.698"south, 14Â°24'2.826"east`,verbatimLatitude:`50Â°4'17.698"south`,verbatimLongitude:`14Â°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40Â°26â²47â³N 79Â°58â²36â³W",verbatimLatitude:"40Â°26â²47â³N",verbatimLongitude:"79Â°58â²36â³W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26â² 47â³ N 79d 58â² 36â³ W",verbatimLatitude:"40d 26â² 47â³ N",verbatimLongitude:"79d 58â² 36â³ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195Â° 79,948862Â°",verbatimLatitude:"40,446195Â°",verbatimLongitude:"79,948862Â°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40Â° 26.7717, -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18Â°24S 22Â°45E",verbatimLatitude:"18Â°24S",verbatimLongitude:"22Â°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],AL=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245Â° S / 28.2344Â° E",verbatimLatitude:"-23.3245Â° S",verbatimLongitude:"28.2344Â° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40Â° 26.7717 -79Â° 56.93172",verbatimLatitude:"40Â° 26.7717",verbatimLongitude:"-79Â° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 Â°  E22.45634 Â°",verbatimLatitude:"S23.43563 Â°",verbatimLongitude:"E22.45634 Â°",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372Â° S 23,07771Â° E",verbatimLatitude:"27,71372Â° S",verbatimLongitude:"23,07771Â° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48Â° 30,6410', E 18Â° 57,4583'",verbatimLatitude:"N 48Â° 30,6410'",verbatimLongitude:"E 18Â° 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function kL(){const r=[];return bL.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...wL})}),[...r,...xL,...AL]}const SL=kL();u_.formats=SL.map(r=>r.verbatimCoordinates);const CL=u_;function Z1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function X1(r){let e,t;return e=new uL({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function K1(r){let e,t,n,i,o;return t=new fL({}),{c(){e=U("button"),ue(t.$$.fragment),fe(e,"type","button"),fe(e,"title",r[9]),fe(e,"class","svelte-bz0zu3"),Gt(e,"active",r[0])},m(u,s){W(u,e,s),ae(t,e,null),n=!0,i||(o=Lt(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&fe(e,"title",u[9]),(!n||s[0]&1)&&Gt(e,"active",u[0])},i(u){n||(N(t.$$.fragment,u),n=!0)},o(u){V(t.$$.fragment,u),n=!1},d(u){u&&G(e),le(t),i=!1,o()}}}function TL(r){let e,t=[],n=new Map,i,o,u,s=On(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=Z1(r,s,p),_=d(g);n.set(_,t[p]=J1(_,g))}return{c(){e=U("ul");for(let p=0;p<t.length;p+=1)t[p].c();fe(e,"class","options svelte-bz0zu3")},m(p,g){W(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(u=[Lt(e,"mouseleave",r[73]),Lt(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=On(p[14]),Kt(),t=ok(t,g,d,1,p,s,n,e,ik,J1,null,Z1),Jt())},i(p){if(!i){for(let g=0;g<s.length;g+=1)N(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)V(t[g]);i=!1},d(p){p&&G(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,hr(u)}}}function ML(r){let e,t,n,i,o,u;return t=new $2({}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),o=Te(r[7]),fe(i,"class","svelte-bz0zu3"),fe(e,"class","no-results svelte-bz0zu3")},m(s,d){W(s,e,d),ae(t,e,null),R(e,n),R(e,i),R(i,o),u=!0},p(s,d){(!u||d[0]&128)&&At(o,s[7])},i(s){u||(N(t.$$.fragment,s),u=!0)},o(s){V(t.$$.fragment,s),u=!1},d(s){s&&G(e),le(t)}}}function EL(r){let e="",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p:ft,i:ft,o:ft,d(n){n&&G(t)}}}function LL(r){let e,t,n,i,o,u,s,d,p,g,_;return t=new $2({}),d=new O2({}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),o=Te(r[6]),u=ie(),s=U("button"),ue(d.$$.fragment),fe(i,"class","svelte-bz0zu3"),fe(s,"class","svelte-bz0zu3"),fe(e,"class","error svelte-bz0zu3")},m(x,C){W(x,e,C),ae(t,e,null),R(e,n),R(e,i),R(i,o),R(e,u),R(e,s),ae(d,s,null),p=!0,g||(_=Lt(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&At(o,x[6])},i(x){p||(N(t.$$.fragment,x),N(d.$$.fragment,x),p=!0)},o(x){V(t.$$.fragment,x),V(d.$$.fragment,x),p=!1},d(x){x&&G(e),le(t),le(d),g=!1,_()}}}function J1(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new aL({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=rr(),ue(n.$$.fragment),this.first=t},m(s,d){W(s,t,d),ae(n,s,d),i=!0},p(s,d){e=s;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(N(n.$$.fragment,s),i=!0)},o(s){V(n.$$.fragment,s),i=!1},d(s){s&&G(t),le(n,s)}}}function IL(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B,K,H=!1;o=new dL({}),_=new O2({});let q=r[19]&&X1(),J=r[5]==="button"&&K1(r);const he=r[61].default,Ee=vn(he,r,r[60],null),Y=[LL,EL,ML,TL],oe=[];function ke(ye,Ne){var Ue,De;return ye[18]?0:ye[16]?((Ue=ye[14])==null?void 0:Ue.length)===0?2:ye[16]&&((De=ye[14])!=null&&De.length)?3:-1:1}return~(L=ke(r))&&(E=oe[L]=Y[L](r)),{c(){e=ie(),t=U("form"),n=U("div"),i=U("button"),ue(o.$$.fragment),u=ie(),s=U("input"),d=ie(),p=U("div"),g=U("button"),ue(_.$$.fragment),x=ie(),q&&q.c(),C=ie(),J&&J.c(),T=ie(),Ee&&Ee.c(),z=ie(),E&&E.c(),fe(i,"class","search-button svelte-bz0zu3"),fe(i,"type","button"),fe(s,"placeholder",r[8]),fe(s,"aria-label",r[8]),fe(s,"class","svelte-bz0zu3"),fe(g,"type","button"),fe(g,"title",r[3]),fe(g,"class","svelte-bz0zu3"),fe(p,"class","clear-button-container svelte-bz0zu3"),Gt(p,"displayable",r[1]!==""),fe(n,"class","input-group svelte-bz0zu3"),fe(t,"tabindex","0"),fe(t,"class",I=Yu(r[2])+" svelte-bz0zu3"),Gt(t,"can-collapse",r[4]&&r[1]==="")},m(ye,Ne){W(ye,e,Ne),W(ye,t,Ne),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),r[63](s),Kn(s,r[1]),R(n,d),R(n,p),R(p,g),ae(_,g,null),R(p,x),q&&q.m(p,null),R(n,C),J&&J.m(n,null),R(n,T),Ee&&Ee.m(n,null),R(t,z),~L&&oe[L].m(t,null),O=!0,B||(K=[Lt(i,"click",r[62]),Lt(s,"input",r[64]),Lt(s,"focus",r[65]),Lt(s,"blur",r[66]),Lt(s,"keydown",r[22]),Lt(s,"input",r[67]),Lt(g,"click",r[68]),Lt(t,"submit",Tg(r[21]))],B=!0)},p(ye,Ne){(!O||Ne[0]&256)&&fe(s,"placeholder",ye[8]),(!O||Ne[0]&256)&&fe(s,"aria-label",ye[8]),Ne[0]&2&&s.value!==ye[1]&&Kn(s,ye[1]),(!O||Ne[0]&8)&&fe(g,"title",ye[3]),ye[19]?q?Ne[0]&524288&&N(q,1):(q=X1(),q.c(),N(q,1),q.m(p,null)):q&&(Kt(),V(q,1,1,()=>{q=null}),Jt()),(!O||Ne[0]&2)&&Gt(p,"displayable",ye[1]!==""),ye[5]==="button"?J?(J.p(ye,Ne),Ne[0]&32&&N(J,1)):(J=K1(ye),J.c(),N(J,1),J.m(n,T)):J&&(Kt(),V(J,1,1,()=>{J=null}),Jt()),Ee&&Ee.p&&(!O||Ne[1]&536870912)&&wn(Ee,he,ye,ye[60],O?bn(he,ye[60],Ne,null):xn(ye[60]),null);let Ue=L;L=ke(ye),L===Ue?~L&&oe[L].p(ye,Ne):(E&&(Kt(),V(oe[Ue],1,1,()=>{oe[Ue]=null}),Jt()),~L?(E=oe[L],E?E.p(ye,Ne):(E=oe[L]=Y[L](ye),E.c()),N(E,1),E.m(t,null)):E=null),(!O||Ne[0]&4&&I!==(I=Yu(ye[2])+" svelte-bz0zu3"))&&fe(t,"class",I),(!O||Ne[0]&22)&&Gt(t,"can-collapse",ye[4]&&ye[1]==="")},i(ye){O||(N(H),N(o.$$.fragment,ye),N(_.$$.fragment,ye),N(q),N(J),N(Ee,ye),N(E),O=!0)},o(ye){V(H),V(o.$$.fragment,ye),V(_.$$.fragment,ye),V(q),V(J),V(Ee,ye),V(E),O=!1},d(ye){ye&&(G(e),G(t)),le(o),r[63](null),le(_),q&&q.d(),J&&J.d(),Ee&&Ee.d(ye),~L&&oe[L].d(),B=!1,hr(K)}}}function PL(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:T=void 0}=e,{debounceSearch:z=200}=e,{enableReverse:L="never"}=e,{errorMessage:E="Something went wrongâ¦"}=e,{filter:I=()=>!0}=e,{flyTo:O=!0}=e,{fuzzyMatch:B=!0}=e,{language:K=void 0}=e,{limit:H=void 0}=e,{mapController:q=void 0}=e,{minLength:J=2}=e,{noResultsMessage:he="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ee="Search"}=e,{proximity:Y=[{type:"server-geolocation"}]}=e,{reverseActive:oe=L==="always"}=e,{reverseButtonTitle:ke="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{pickedResultStyle:Ne="full-geometry"}=e,{showPlaceType:Ue="if-needed"}=e,{showResultsWhileTyping:De=!0}=e,{selectFirst:Le=!0}=e,{flyToSelected:lt=!1}=e,{markerOnSelected:Ze=!0}=e,{types:at=void 0}=e,{exhaustiveReverseGeocoding:dt=!1}=e,{excludeTypes:pt=!1}=e,{zoom:Je=s}=e,{apiUrl:xt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Mt={}}=e,{iconsBaseUrl:Ot="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:Yt=()=>{}}=e;function nn(){Xe.focus()}function Qt(){Xe.blur()}function fn(re,Ke=!0,Qe=!1){t(1,ye=re),Ke?(t(15,it=-1),yt()):(vt(!Qe,Qe),setTimeout(()=>{Xe.focus(),Xe.select()}))}function mn(){t(14,gt=void 0),t(56,de=void 0),t(15,it=-1)}function qe(){t(55,et=[]),t(56,de=void 0)}let Ge=!1,gt,et,de,en="",Xe,it=-1,Ut,Hn=[],jn,Nn,Wt,An;const ti=new Set,Bn=$s();ei(()=>{q&&(q.setEventHandler(void 0),q.indicateReverse(!1),q.setSelectedMarker(-1),q.setFeatures(void 0,void 0,!1))});function yt(re){if(Nn&&(clearTimeout(Nn),Nn=void 0),it>-1&&gt)t(56,de=gt[it]),t(1,ye=de.place_type[0]==="reverse"?de.place_name:de.place_name.replace(/,.*/,"")),t(18,Ut=void 0),t(55,et=void 0),t(15,it=-1);else if(ye){const Ke=re||!mr(ye);or(ye,{exact:!0}).then(()=>{t(55,et=gt),t(56,de=void 0),Ke&&gi()}).catch(Qe=>t(18,Ut=Qe))}}function mr(re){try{return CL(re,6)}catch{return!1}}async function or(re,{byId:Ke=!1,exact:Qe=!1}={}){t(18,Ut=void 0),jn==null||jn.abort();const nt=new AbortController;t(19,jn=nt);try{const ct=mr(re),zt=new URLSearchParams;if(K!==void 0&&zt.set("language",Array.isArray(K)?K.join(","):K??""),at&&zt.set("types",at.join(",")),pt&&zt.set("excludeTypes",String(pt)),g&&zt.set("bbox",g.map(Vn=>Vn.toFixed(6)).join(",")),T&&zt.set("country",Array.isArray(T)?T.join(","):T),!Ke&&!ct){const Vn=await mL(q,Y,nt);Vn&&zt.set("proximity",Vn),(Qe||!De)&&zt.set("autocomplete","false"),zt.set("fuzzyMatch",String(B))}H!==void 0&&(dt||!ct||(at==null?void 0:at.length)===1)&&zt.set("limit",String(H)),zt.set("key",p),Yt(zt);const on=xt+"/"+encodeURIComponent(ct?ct.decimalLongitude+","+ct.decimalLatitude:re)+".json?"+zt.toString();if(on===en){Ke?(t(14,gt=void 0),t(56,de=Hn[0])):t(14,gt=Hn);return}en=on;const gn=await fetch(on,{signal:nt.signal,...Mt});if(!gn.ok)throw new Error(await gn.text());const En=await gn.json();Bn("response",{url:on,featureCollection:En}),Ke?(t(14,gt=void 0),t(56,de=En.features[0]),Hn=[de]):(t(14,gt=En.features.filter(I)),ct&&gt.unshift({type:"Feature",properties:{},id:"reverse_"+ct.decimalLongitude+"_"+ct.decimalLatitude,text:ct.decimalLatitude+", "+ct.decimalLongitude,place_name:ct.decimalLatitude+", "+ct.decimalLongitude,place_type:["reverse"],center:[ct.decimalLongitude,ct.decimalLatitude],bbox:[ct.decimalLongitude,ct.decimalLatitude,ct.decimalLongitude,ct.decimalLatitude],geometry:{type:"Point",coordinates:[ct.decimalLongitude,ct.decimalLatitude]}}),Hn=gt,ct&&Xe.focus())}catch(ct){if(ct&&typeof ct=="object"&&"name"in ct&&ct.name==="AbortError")return;throw ct}finally{nt===jn&&t(19,jn=void 0)}}function gi(){var nt;if(!(et!=null&&et.length)||!O)return;const re=[180,90,-180,-90],Ke=!et.some(ct=>!ct.matching_text);let Qe;for(const ct of et){const zt=Un(ct);if(Qe=Qe===void 0?zt:zt===void 0?Qe:Math.max(Qe,zt),Ke||!ct.matching_text)for(const on of[0,1,2,3])re[on]=Math[on<2?"min":"max"](re[on],((nt=ct.bbox)==null?void 0:nt[on])??ct.center[on%2])}q&&et.length>0&&(de&&re[0]===re[2]&&re[1]===re[3]?q.flyTo(de.center,Un(de)):q.fitBounds(N1(re),50,Qe))}function Un(re){var Qe;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const Ke=re.id.replace(/\..*/,"");return(Array.isArray((Qe=re.properties)==null?void 0:Qe.categories)?re.properties.categories.reduce((nt,ct)=>{const zt=Je[Ke+"."+ct];return nt===void 0?zt:zt===void 0?nt:Math.max(nt,zt)},void 0):void 0)??Je[Ke]}function Fe(re){t(0,oe=L==="always"),t(14,gt=void 0),t(56,de=void 0),t(15,it=-1),fn(re[1].toFixed(6)+", "+pL(re[0],[-180,180],!0).toFixed(6),!1,!0)}function mt(re){if(!gt)return;let Ke=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;Ke&&(it===(Le?0:-1)&&Ke===-1&&t(15,it=gt.length),t(15,it+=Ke),it>=gt.length&&t(15,it=-1),it<0&&Le&&t(15,it=0),re.preventDefault())}function vt(re=!0,Ke=!1){if(t(18,Ut=void 0),De||Ke){if(Nn&&clearTimeout(Nn),ye.length<J)return;const Qe=ye;Nn=window.setTimeout(()=>{or(Qe).catch(nt=>t(18,Ut=nt))},re?z:0)}else t(14,gt=void 0),t(18,Ut=void 0)}function Dt(re){t(56,de=re),t(1,ye=re.place_name),t(15,it=-1)}const rn=()=>Xe.focus();function tn(re){pn[re?"unshift":"push"](()=>{Xe=re,t(17,Xe)})}function br(){ye=this.value,t(1,ye),t(13,Ge),t(28,x)}const sr=()=>t(13,Ge=!0),Se=()=>t(13,Ge=!1),ne=()=>vt(),ce=()=>{t(1,ye=""),Xe.focus()},ge=()=>t(0,oe=!oe),we=()=>t(18,Ut=void 0),Oe=re=>t(15,it=re),$e=re=>Dt(re),Ve=()=>{Le||t(15,it=-1)},ze=()=>{};return r.$$set=re=>{"class"in re&&t(2,d=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,g=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,x=re.clearOnBlur),"collapsed"in re&&t(4,C=re.collapsed),"country"in re&&t(29,T=re.country),"debounceSearch"in re&&t(30,z=re.debounceSearch),"enableReverse"in re&&t(5,L=re.enableReverse),"errorMessage"in re&&t(6,E=re.errorMessage),"filter"in re&&t(31,I=re.filter),"flyTo"in re&&t(32,O=re.flyTo),"fuzzyMatch"in re&&t(33,B=re.fuzzyMatch),"language"in re&&t(34,K=re.language),"limit"in re&&t(35,H=re.limit),"mapController"in re&&t(36,q=re.mapController),"minLength"in re&&t(37,J=re.minLength),"noResultsMessage"in re&&t(7,he=re.noResultsMessage),"placeholder"in re&&t(8,Ee=re.placeholder),"proximity"in re&&t(38,Y=re.proximity),"reverseActive"in re&&t(0,oe=re.reverseActive),"reverseButtonTitle"in re&&t(9,ke=re.reverseButtonTitle),"searchValue"in re&&t(1,ye=re.searchValue),"pickedResultStyle"in re&&t(39,Ne=re.pickedResultStyle),"showPlaceType"in re&&t(10,Ue=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,De=re.showResultsWhileTyping),"selectFirst"in re&&t(11,Le=re.selectFirst),"flyToSelected"in re&&t(41,lt=re.flyToSelected),"markerOnSelected"in re&&t(42,Ze=re.markerOnSelected),"types"in re&&t(43,at=re.types),"exhaustiveReverseGeocoding"in re&&t(44,dt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,pt=re.excludeTypes),"zoom"in re&&t(46,Je=re.zoom),"apiUrl"in re&&t(47,xt=re.apiUrl),"fetchParameters"in re&&t(48,Mt=re.fetchParameters),"iconsBaseUrl"in re&&t(12,Ot=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,Yt=re.adjustUrlQuery),"$$scope"in re&&t(60,u=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,oe=L==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Wt=Ge),x&&!Ge&&t(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ye.length<J&&(t(56,de=void 0),t(14,gt=void 0),t(18,Ut=void 0),t(55,et=gt)),r.$$.dirty[1]&33554688&&Ne!=="marker-only"&&de&&!de.address&&de.geometry.type==="Point"&&de.place_type[0]!=="reverse"&&or(de.id,{byId:!0}).catch(re=>t(18,Ut=re)),r.$$.dirty[1]&100663330&&(q&&de&&de.id!==An&&O&&(!de.bbox||de.bbox[0]===de.bbox[2]&&de.bbox[1]===de.bbox[3]?q.flyTo(de.center,Un(de)):q.fitBounds(N1(de.bbox),50,Un(de)),t(14,gt=void 0),t(55,et=void 0),t(15,it=-1)),t(57,An=de==null?void 0:de.id)),r.$$.dirty[0]&18432&&Le&&gt!=null&&gt.length&&t(15,it=0),r.$$.dirty[0]&2&&t(15,it=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&et!==gt&&t(55,et=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&q&&q.setEventHandler(re=>{switch(re.type){case"mapClick":oe&&Fe(re.coordinates);break;case"markerClick":{const Ke=gt==null?void 0:gt.find(Qe=>Qe.id===re.id);Ke&&Dt(Ke)}break;case"markerMouseEnter":et&&t(15,it=Wt?(gt==null?void 0:gt.findIndex(Ke=>Ke.id===re.id))??-1:-1);break;case"markerMouseLeave":et&&t(15,it=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=gt==null?void 0:gt[it]),r.$$.dirty[1]&134218786&&q&&i&&O&&lt&&q.flyTo(i.center,Un(i)),r.$$.dirty[1]&256&&t(59,n=Ne==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Ze||q==null||q.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&q&&Ze&&!et&&(q.setFeatures(i?[i]:void 0,void 0,n),q.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&q&&q.setFeatures(et,de,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&et&&q&&q.setSelectedMarker(it),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&q){const re=mr(ye);q.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Bn("select",{feature:i}),r.$$.dirty[1]&33554432&&Bn("pick",{feature:de}),r.$$.dirty[0]&81920&&Bn("optionsvisibilitychange",{optionsVisible:Wt&&!!gt}),r.$$.dirty[0]&16384&&Bn("featureslisted",{features:gt}),r.$$.dirty[1]&16777216&&Bn("featuresmarked",{features:et}),r.$$.dirty[0]&1&&Bn("reversetoggle",{reverse:oe}),r.$$.dirty[0]&2&&Bn("querychange",{query:ye}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&q&&q.indicateReverse(oe)},[oe,ye,d,_,C,L,E,he,Ee,ke,Ue,Le,Ot,Ge,gt,it,Wt,Xe,Ut,jn,ti,yt,mt,vt,Dt,s,p,g,x,T,z,I,O,B,K,H,q,J,Y,Ne,De,lt,Ze,at,dt,pt,Je,xt,Mt,Yt,nn,Qt,fn,mn,qe,et,de,An,i,n,u,o,rn,tn,br,sr,Se,ne,ce,ge,we,Oe,$e,Ve,ze]}class zL extends Tt{constructor(e){super(),Ct(this,e,PL,IL,wt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function Y1(r){let e,t,n;return t=new zL({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"class","svelte-ixhnie")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&4&&(u.mapController=i[2]),o&1&&(u.apiKey=i[0]),o&2&&(u.country=i[1]),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function DL(r){let e,t,n=r[2]&&Y1(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&N(n,1)):(n=Y1(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function RL(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:u}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function d(p){return p?F2(p,Qr,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=p=>{"apiKey"in p&&t(0,i=p.apiKey),"map"in p&&t(4,o=p.map),"country"in p&&t(1,u=p.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=d(o))},[i,u,n,s,o]}class BL extends Tt{constructor(e){super(),Ct(this,e,RL,DL,wt,{apiKey:0,map:4,country:1})}}const FL=Symbol.for("svelte-maplibre");function OL(){return Kf(FL)}function $L(r){return"layerType"in r&&r.layerType==="deckgl"}const NL=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Q1=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function ev(r){let e,t,n=(r[4]||r[3]instanceof Qr.Marker)&&tv(r);return{c(){e=U("div"),n&&n.c()},m(i,o){W(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof Qr.Marker?n?(n.p(i,o),o[0]&24&&N(n,1)):(n=tv(i),n.c(),N(n,1),n.m(e,null)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(),r[32](null)}}}function tv(r){let e;const t=r[30].default,n=vn(t,r,r[29],Q1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,NL):xn(i[29]),Q1)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function jL(r){let e,t,n=r[9].default&&ev(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=ev(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function UL(r,e,t){let n,i,o,u,s,d,{$$slots:p={},$$scope:g}=e;const _=Cg(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:T=!1}=e,{closeOnMove:z=!1}=e,{openOn:L="click"}=e,{openIfTopMost:E=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:O=void 0}=e,{offset:B=void 0}=e,{popupClass:K=void 0}=e,{maxWidth:H=void 0}=e,{lngLat:q=void 0}=e,{html:J=void 0}=e,{open:he=!1}=e;const Ee=$s(),{map:Y,popupTarget:oe,layerEvent:ke,layer:ye,eventTopMost:Ne}=OL();st(r,Y,Ge=>t(2,o=Ge)),st(r,oe,Ge=>t(3,s=Ge)),st(r,ke,Ge=>t(28,u=Ge)),st(r,ye,Ge=>t(35,d=Ge));const Ue=["click","dblclick","contextmenu"];let De,Le=!1,lt;function Ze(){if(!De)return;let Ge=De.getElement();!Ge||Ge===lt||(lt=Ge,L==="hover"&&(lt.style.pointerEvents="none"),lt.addEventListener("mouseenter",()=>{t(24,Le=!0)},{passive:!0}),lt.addEventListener("mouseleave",()=>{t(24,Le=!1)},{passive:!0}),lt.addEventListener("click",()=>{T&&t(0,he=!1)},{passive:!0}))}ws(()=>{if(o)return o.on("click",Qt),o.on("contextmenu",Qt),typeof s=="string"&&(o.on("click",s,Je),o.on("dblclick",s,Je),o.on("contextmenu",s,Je),o.on("mousemove",s,nn),o.on("mouseleave",s,Yt),o.on("touchstart",s,Mt),o.on("touchend",s,Ot)),()=>{o!=null&&o.loaded()&&(De==null||De.remove(),o.off("click",Qt),o.off("contextmenu",Qt),s instanceof Qr.Marker?s.getPopup()===De&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Je),o.off("dblclick",s,Je),o.off("contextmenu",s,Je),o.off("mousemove",s,nn),o.off("mouseleave",s,Yt),o.off("touchstart",s,Mt),o.off("touchend",s,Ot)))}});function at(Ge){return E?!("marker"in Ge)&&!$L(Ge)&&Ne(Ge)!==d:!1}let dt=null,pt="normal";function Je(Ge){Ge.type===L&&(at(Ge)||("layerType"in Ge?Ge.layerType==="deckgl"?(t(10,q=Ge.coordinate),t(4,dt=Ge.object?[Ge.object]:null)):(t(10,q=Ge.lngLat),t(4,dt=Ge.features??[])):(t(10,q=Ge.lngLat),t(4,dt=Ge.features??[])),setTimeout(()=>t(0,he=!0))))}let xt=null;function Mt(Ge){xt=Ge.point}function Ot(Ge){if(!xt||L!=="hover")return;let gt=xt.dist(Ge.point);xt=null,gt<3&&(t(10,q=Ge.lngLat),t(4,dt=Ge.features??[]),De.isOpen()?t(25,pt="justOpened"):(t(25,pt="opening"),t(0,he=!0)))}function Yt(Ge){L!=="hover"||xt||pt!=="normal"||(t(0,he=!1),t(4,dt=null))}function nn(Ge){if(!(L!=="hover"||xt||pt!=="normal")){if(at(Ge)){t(0,he=!1),t(4,dt=null);return}t(0,he=!0),t(4,dt=Ge.features??[]),t(10,q=Ge.lngLat)}}function Qt(Ge){if(pt==="justOpened"){t(25,pt="normal");return}if(!C)return;let gt=[lt,s instanceof Qr.Marker?s==null?void 0:s.getElement():null];he&&De.isOpen()&&!gt.some(et=>et==null?void 0:et.contains(Ge.originalEvent.target))&&(Ge.type==="contextmenu"&&L==="contextmenu"||Ge.type!=="contextmenu")&&t(0,he=!1)}ei(()=>{o&&(De!=null&&De.isOpen())&&De.remove()});let fn;const mn=()=>t(0,he=!1);function qe(Ge){pn[Ge?"unshift":"push"](()=>{fn=Ge,t(1,fn)})}return r.$$set=Ge=>{"closeButton"in Ge&&t(11,x=Ge.closeButton),"closeOnClickOutside"in Ge&&t(12,C=Ge.closeOnClickOutside),"closeOnClickInside"in Ge&&t(13,T=Ge.closeOnClickInside),"closeOnMove"in Ge&&t(14,z=Ge.closeOnMove),"openOn"in Ge&&t(15,L=Ge.openOn),"openIfTopMost"in Ge&&t(16,E=Ge.openIfTopMost),"focusAfterOpen"in Ge&&t(17,I=Ge.focusAfterOpen),"anchor"in Ge&&t(18,O=Ge.anchor),"offset"in Ge&&t(19,B=Ge.offset),"popupClass"in Ge&&t(20,K=Ge.popupClass),"maxWidth"in Ge&&t(21,H=Ge.maxWidth),"lngLat"in Ge&&t(10,q=Ge.lngLat),"html"in Ge&&t(22,J=Ge.html),"open"in Ge&&t(0,he=Ge.open),"$$scope"in Ge&&t(29,g=Ge.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!T)),r.$$.dirty[0]&146685952&&(De||(t(23,De=new Qr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:z,focusAfterOpen:I,maxWidth:H,className:K,anchor:O,offset:B})),lt=De.getElement(),De.on("open",()=>{t(0,he=!0),Ze(),Ee("open",De)}),De.on("close",()=>{t(0,he=!1),Ee("close",De)}),De.on("hover",()=>{Ee("hover",De)}))),r.$$.dirty[0]&8421384&&De&&s instanceof Qr.Marker&&(L==="click"?s.setPopup(De):s.getPopup()===De&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ue.includes(L)&&(u==null?void 0:u.type)===L&&(Je(u),cn(ke,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=L==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&L==="hover"&&ke&&(i&&u&&(u.layerType==="deckgl"?(t(10,q=u.coordinate),t(4,dt=u.object?[u.object]:null)):(t(10,q=u.lngLat),t(4,dt=u.features??[]))),t(0,he=(i||Le)??!1)),r.$$.dirty[0]&12582914&&(fn?De.setDOMContent(fn):J&&De.setHTML(J)),r.$$.dirty[0]&8389632&&q&&De.setLngLat(q),r.$$.dirty[0]&41943045&&o){let Ge=De.isOpen();he&&!Ge?(De.addTo(o),pt==="opening"&&t(25,pt="justOpened")):!he&&Ge&&De.remove()}},[he,fn,o,s,dt,Y,oe,ke,ye,_,q,x,C,T,z,L,E,I,O,B,K,H,J,De,Le,pt,i,n,u,g,p,mn,qe]}class VL extends Tt{constructor(e){super(),Ct(this,e,UL,jL,wt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const qL=r=>({props:r&8}),nv=r=>({props:WL(r[3])});function HL(r){let e;const t=r[1].default,n=vn(t,r,r[2],nv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&wn(n,t,i,i[2],e?bn(t,i[2],o,qL):xn(i[2]),nv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function GL(r){let e,t;return e=new VL({props:{openOn:r[0],$$slots:{default:[HL,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function WL(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function ZL(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=u=>{"openOn"in u&&t(0,o=u.openOn),"$$scope"in u&&t(2,i=u.$$scope)},[o,n,i]}class pi extends Tt{constructor(e){super(),Ct(this,e,ZL,GL,wt,{openOn:0})}}function Oo(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function Di(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function Ji(){return{type:"FeatureCollection",features:[]}}function rv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function iv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function ov(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function sv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function av(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function lv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function XL(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function uv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Te(t),e.__value=r[18],Kn(e,e.__value)},m(i,o){W(i,e,o),R(e,n)},p:ft,d(i){i&&G(e)}}}function cv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Te(t),e.__value=r[18],Kn(e,e.__value)},m(i,o){W(i,e,o),R(e,n)},p:ft,d(i){i&&G(e)}}}function fv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Te(t),e.__value=r[18],Kn(e,e.__value)},m(i,o){W(i,e,o),R(e,n)},p:ft,d(i){i&&G(e)}}}function hv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Te(t),e.__value=r[18],Kn(e,e.__value)},m(i,o){W(i,e,o),R(e,n)},p:ft,d(i){i&&G(e)}}}function KL(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O=On(r[7]),B=[];for(let Y=0;Y<O.length;Y+=1)B[Y]=uv(lv(r,O,Y));let K=On(r[8]),H=[];for(let Y=0;Y<K.length;Y+=1)H[Y]=cv(av(r,K,Y));let q=On(r[9]),J=[];for(let Y=0;Y<q.length;Y+=1)J[Y]=fv(sv(r,q,Y));let he=On(r[10]),Ee=[];for(let Y=0;Y<he.length;Y+=1)Ee[Y]=hv(ov(r,he,Y));return{c(){e=U("div"),t=U("label"),n=Te(`Trip purpose:
      `),i=U("select");for(let Y=0;Y<B.length;Y+=1)B[Y].c();o=ie(),u=U("label"),s=Te(`Scenario:
      `),d=U("select");for(let Y=0;Y<H.length;Y+=1)H[Y].c();p=ie(),g=U("label"),_=Te(`Network type:
      `),x=U("select");for(let Y=0;Y<J.length;Y+=1)J[Y].c();C=ie(),T=U("label"),z=Te(`Color by:
      `),L=U("select");for(let Y=0;Y<Ee.length;Y+=1)Ee[Y].c();r[0]===void 0&&ms(()=>r[11].call(i)),r[1]===void 0&&ms(()=>r[12].call(d)),r[2]===void 0&&ms(()=>r[13].call(x)),r[3]===void 0&&ms(()=>r[14].call(L)),fe(e,"slot","legend")},m(Y,oe){W(Y,e,oe),R(e,t),R(t,n),R(t,i);for(let ke=0;ke<B.length;ke+=1)B[ke]&&B[ke].m(i,null);Wi(i,r[0],!0),R(e,o),R(e,u),R(u,s),R(u,d);for(let ke=0;ke<H.length;ke+=1)H[ke]&&H[ke].m(d,null);Wi(d,r[1],!0),R(e,p),R(e,g),R(g,_),R(g,x);for(let ke=0;ke<J.length;ke+=1)J[ke]&&J[ke].m(x,null);Wi(x,r[2],!0),R(e,C),R(e,T),R(T,z),R(T,L);for(let ke=0;ke<Ee.length;ke+=1)Ee[ke]&&Ee[ke].m(L,null);Wi(L,r[3],!0),E||(I=[Lt(i,"change",r[11]),Lt(d,"change",r[12]),Lt(x,"change",r[13]),Lt(L,"change",r[14])],E=!0)},p(Y,oe){if(oe[0]&128){O=On(Y[7]);let ke;for(ke=0;ke<O.length;ke+=1){const ye=lv(Y,O,ke);B[ke]?B[ke].p(ye,oe):(B[ke]=uv(ye),B[ke].c(),B[ke].m(i,null))}for(;ke<B.length;ke+=1)B[ke].d(1);B.length=O.length}if(oe[0]&129&&Wi(i,Y[0]),oe[0]&256){K=On(Y[8]);let ke;for(ke=0;ke<K.length;ke+=1){const ye=av(Y,K,ke);H[ke]?H[ke].p(ye,oe):(H[ke]=cv(ye),H[ke].c(),H[ke].m(d,null))}for(;ke<H.length;ke+=1)H[ke].d(1);H.length=K.length}if(oe[0]&258&&Wi(d,Y[1]),oe[0]&512){q=On(Y[9]);let ke;for(ke=0;ke<q.length;ke+=1){const ye=sv(Y,q,ke);J[ke]?J[ke].p(ye,oe):(J[ke]=fv(ye),J[ke].c(),J[ke].m(x,null))}for(;ke<J.length;ke+=1)J[ke].d(1);J.length=q.length}if(oe[0]&516&&Wi(x,Y[2]),oe[0]&1024){he=On(Y[10]);let ke;for(ke=0;ke<he.length;ke+=1){const ye=ov(Y,he,ke);Ee[ke]?Ee[ke].p(ye,oe):(Ee[ke]=hv(ye),Ee[ke].c(),Ee[ke].m(L,null))}for(;ke<Ee.length;ke+=1)Ee[ke].d(1);Ee.length=he.length}oe[0]&1032&&Wi(L,Y[3])},d(Y){Y&&G(e),di(B,Y),di(H,Y),di(J,Y),di(Ee,Y),E=!1,hr(I)}}}function dv(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",u,s,d,p=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",g,_,x,C=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",T,z;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=ie(),i=U("td"),u=Te(o),s=ie(),d=U("td"),g=Te(p),_=ie(),x=U("td"),T=Te(C),z=ie()},m(L,E){W(L,e,E),R(e,t),R(e,n),R(e,i),R(i,u),R(e,s),R(e,d),R(d,g),R(e,_),R(e,x),R(x,T),R(e,z)},p(L,E){E[0]&131072&&o!==(o=L[17][`${L[18]}_fastest_bicycle`].toLocaleString()+"")&&At(u,o),E[0]&131072&&p!==(p=L[17][`${L[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&At(g,p),E[0]&131072&&C!==(C=L[17][`${L[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&At(T,C)},d(L){L&&G(e)}}}function pv(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",u,s,d,p=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",g,_,x,C=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",T,z;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=ie(),i=U("td"),u=Te(o),s=ie(),d=U("td"),g=Te(p),_=ie(),x=U("td"),T=Te(C),z=ie()},m(L,E){W(L,e,E),R(e,t),R(e,n),R(e,i),R(i,u),R(e,s),R(e,d),R(d,g),R(e,_),R(e,x),R(x,T),R(e,z)},p(L,E){E[0]&131072&&o!==(o=L[17][`${L[18]}_quietest_bicycle`].toLocaleString()+"")&&At(u,o),E[0]&131072&&p!==(p=L[17][`${L[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&At(g,p),E[0]&131072&&C!==(C=L[17][`${L[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&At(T,C)},d(L){L&&G(e)}}}function JL(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,u,s,d,p=r[17].gradient+"",g,_,x,C,T,z=r[17].quietness+"",L,E,I,O,B,K,H,q,J,he,Ee,Y,oe,ke,ye,Ne,Ue,De=On(r[7]),Le=[];for(let at=0;at<De.length;at+=1)Le[at]=dv(iv(r,De,at));let lt=On(r[7]),Ze=[];for(let at=0;at<lt.length;at+=1)Ze[at]=pv(rv(r,lt,at));return{c(){e=U("div"),t=U("p"),n=Te("Cyclists: "),o=Te(i),u=ie(),s=U("p"),d=Te("Gradient: "),g=Te(p),_=Te("%"),x=ie(),C=U("p"),T=Te("Cycle-friendliness: "),L=Te(z),E=Te("%"),I=ie(),O=U("details"),B=U("summary"),B.textContent="All network details",K=ie(),H=U("p"),H.textContent="Fast/Direct network",q=ie(),J=U("table"),he=U("tr"),he.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ee=ie();for(let at=0;at<Le.length;at+=1)Le[at].c();Y=ie(),oe=U("p"),oe.textContent="Quiet/Indirect network",ke=ie(),ye=U("table"),Ne=U("tr"),Ne.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ue=ie();for(let at=0;at<Ze.length;at+=1)Ze[at].c();Ye(e,"max-width","30vw"),Ye(e,"max-height","60vh"),Ye(e,"overflow","auto")},m(at,dt){W(at,e,dt),R(e,t),R(t,n),R(t,o),R(e,u),R(e,s),R(s,d),R(s,g),R(s,_),R(e,x),R(e,C),R(C,T),R(C,L),R(C,E),R(e,I),R(e,O),R(O,B),R(O,K),R(O,H),R(O,q),R(O,J),R(J,he),R(J,Ee);for(let pt=0;pt<Le.length;pt+=1)Le[pt]&&Le[pt].m(J,null);R(O,Y),R(O,oe),R(O,ke),R(O,ye),R(ye,Ne),R(ye,Ue);for(let pt=0;pt<Ze.length;pt+=1)Ze[pt]&&Ze[pt].m(ye,null)},p(at,dt){if(dt[0]&131088&&i!==(i=at[17][at[4]].toLocaleString()+"")&&At(o,i),dt[0]&131072&&p!==(p=at[17].gradient+"")&&At(g,p),dt[0]&131072&&z!==(z=at[17].quietness+"")&&At(L,z),dt[0]&131200){De=On(at[7]);let pt;for(pt=0;pt<De.length;pt+=1){const Je=iv(at,De,pt);Le[pt]?Le[pt].p(Je,dt):(Le[pt]=dv(Je),Le[pt].c(),Le[pt].m(J,null))}for(;pt<Le.length;pt+=1)Le[pt].d(1);Le.length=De.length}if(dt[0]&131200){lt=On(at[7]);let pt;for(pt=0;pt<lt.length;pt+=1){const Je=rv(at,lt,pt);Ze[pt]?Ze[pt].p(Je,dt):(Ze[pt]=pv(Je),Ze[pt].c(),Ze[pt].m(ye,null))}for(;pt<Ze.length;pt+=1)Ze[pt].d(1);Ze.length=lt.length}},d(at){at&&G(e),di(Le,at),di(Ze,at)}}}function YL(r){let e,t;return e=new pi({props:{openOn:"click",$$slots:{default:[JL,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function QL(r){let e,t;const n=[yn("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":mv(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[YL]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u[0]&112?Mn(n,[n[0],n[1],u[0]&80&&{paint:{"line-color":o[6],"line-width":mv(["get",o[4]])}},u[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};u[0]&16|u[1]&2&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function eI(r){let e,t,n,i,o;function u(d){r[15](d)}let s={label:"Estimated cycling demand",$$slots:{legend:[KL],help:[XL]},$$scope:{ctx:r}};return r[5]!==void 0&&(s.show=r[5]),e=new ns({props:s}),pn.push(()=>Dn(e,"show",u)),i=new th({props:{url:`pmtiles://${Fo("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[QL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),W(d,n,p),ae(i,d,p),o=!0},p(d,p){const g={};p[0]&15|p[1]&2&&(g.$$scope={dirty:p,ctx:d}),!t&&p[0]&32&&(t=!0,g.show=d[5],zn(()=>t=!1)),e.$set(g);const _={};p[0]&112|p[1]&2&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&G(n),le(e,d),le(i,d)}}}function mv(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function tI(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function nI(r,e,t){let n,i,o=!1,u="all",s="bicycle_go_dutch",d="fastest",p="flow",g=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],_=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],x=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],C=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],T={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function z(){u=za(this),t(0,u),t(7,g)}function L(){s=za(this),t(1,s),t(8,_)}function E(){d=za(this),t(2,d),t(9,x)}function I(){p=za(this),t(3,p),t(10,C)}function O(B){o=B,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${u}_${d}_${s}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:tI(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:Di(["abs",["get","gradient"]],T.limits,T.colorScale)}[p])},[u,s,d,p,n,o,i,g,_,x,C,z,L,E,I,O]}class rI extends Tt{constructor(e){super(),Ct(this,e,nI,eI,wt,{},null,[-1,-1])}}function iI(r){let e,t,n;return t=new Ig({props:{labelColors:r[5]}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:ft,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function oI(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function sI(r){let e,t,n;return t=new wo({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:ft,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function aI(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function lI(r){let e,t,n;return t=new wo({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:ft,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function uI(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function cI(r){let e,t,n,i,o,u;const s=[yn("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Oo(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":na(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let d={};for(let C=0;C<s.length;C+=1)d=It(d,s[C]);e=new cr({props:d});const p=[yn("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Oo(["get","Level of Service"],r[4],"cyan"),"line-width":na(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let g={};for(let C=0;C<p.length;C+=1)g=It(g,p[C]);n=new cr({props:g});const _=[yn("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Oo(["get","Infrastructure type"],r[5],"cyan"),"line-width":na(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={};for(let C=0;C<_.length;C+=1)x=It(x,_[C]);return o=new cr({props:x}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment)},m(C,T){ae(e,C,T),W(C,t,T),ae(n,C,T),W(C,i,T),ae(o,C,T),u=!0},p(C,T){const z=T&9?Mn(s,[s[0],s[1],s[2],T&8&&{paint:{"line-color":Oo(["get","Traffic volume category"],{"0 to 1999":C[3].colorScale[0],"2000 to 3999":C[3].colorScale[1],"4000+":C[3].colorScale[2]},"cyan"),"line-width":na(0)}},T&1&&{layout:{visibility:C[0]?"visible":"none"}}]):{};e.$set(z);const L=T&18?Mn(p,[p[0],p[1],T&16&&{paint:{"line-color":Oo(["get","Level of Service"],C[4],"cyan"),"line-width":na(1)}},T&2&&{layout:{visibility:C[1]?"visible":"none"}}]):{};n.$set(L);const E=T&36?Mn(_,[_[0],_[1],_[2],T&32&&{paint:{"line-color":Oo(["get","Infrastructure type"],C[5],"cyan"),"line-width":na(1)}},T&4&&{layout:{visibility:C[2]?"visible":"none"}}]):{};o.$set(E)},i(C){u||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),u=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),u=!1},d(C){C&&(G(t),G(i)),le(e,C),le(n,C),le(o,C)}}}function fI(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z;function L(H){r[6](H)}let E={label:"Existing cycling infrastructure",$$slots:{help:[oI],legend:[iI]},$$scope:{ctx:r}};r[2]!==void 0&&(E.show=r[2]),e=new ns({props:E}),pn.push(()=>Dn(e,"show",L));function I(H){r[7](H)}let O={label:"Cycling safety Level of Service",$$slots:{help:[aI],legend:[sI]},$$scope:{ctx:r}};r[1]!==void 0&&(O.show=r[1]),i=new ns({props:O}),pn.push(()=>Dn(i,"show",I)),s=new rI({});function B(H){r[8](H)}let K={label:"Estimated traffic",$$slots:{help:[uI],legend:[lI]},$$scope:{ctx:r}};return r[0]!==void 0&&(K.show=r[0]),_=new ns({props:K}),pn.push(()=>Dn(_,"show",B)),T=new th({props:{url:`pmtiles://${Fo("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[cI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment),u=ie(),ue(s.$$.fragment),d=ie(),p=U("div"),p.textContent="Other",g=ie(),ue(_.$$.fragment),C=ie(),ue(T.$$.fragment),fe(p,"class","layer-group")},m(H,q){ae(e,H,q),W(H,n,q),ae(i,H,q),W(H,u,q),ae(s,H,q),W(H,d,q),W(H,p,q),W(H,g,q),ae(_,H,q),W(H,C,q),ae(T,H,q),z=!0},p(H,[q]){const J={};q&512&&(J.$$scope={dirty:q,ctx:H}),!t&&q&4&&(t=!0,J.show=H[2],zn(()=>t=!1)),e.$set(J);const he={};q&512&&(he.$$scope={dirty:q,ctx:H}),!o&&q&2&&(o=!0,he.show=H[1],zn(()=>o=!1)),i.$set(he);const Ee={};q&512&&(Ee.$$scope={dirty:q,ctx:H}),!x&&q&1&&(x=!0,Ee.show=H[0],zn(()=>x=!1)),_.$set(Ee);const Y={};q&519&&(Y.$$scope={dirty:q,ctx:H}),T.$set(Y)},i(H){z||(N(e.$$.fragment,H),N(i.$$.fragment,H),N(s.$$.fragment,H),N(_.$$.fragment,H),N(T.$$.fragment,H),z=!0)},o(H){V(e.$$.fragment,H),V(i.$$.fragment,H),V(s.$$.fragment,H),V(_.$$.fragment,H),V(T.$$.fragment,H),z=!1},d(H){H&&(G(n),G(u),G(d),G(p),G(g),G(C)),le(e,H),le(i,H),le(s,H),le(_,H),le(T,H)}}}function hI(r,e,t){let n=!1,i=!1,o=!1,u={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},s={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},d={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function p(x){o=x,t(2,o)}function g(x){i=x,t(1,i)}function _(x){n=x,t(0,n)}return[n,i,o,u,s,d,p,g,_]}class dI extends Tt{constructor(e){super(),Ct(this,e,hI,fI,wt,{})}}function pI(r){let e,t,n;return t=new Ig({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:ft,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function mI(r){let e;return{c(){e=U("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function gv(r){let e,t;return e=new yr({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[yI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function gI(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&At(t,e)},d(n){n&&G(t)}}}function _I(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[gI,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yI(r){let e,t;const n=[yn("context-pois"),{paint:{"circle-color":Oo(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[_I]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new Bl({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&5?Mn(n,[n[0],u&4&&{paint:{"circle-color":Oo(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},u&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};u&32&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function vI(r){let e,t,n,i,o;function u(p){r[3](p)}let s={label:"POIs",$$slots:{help:[mI],legend:[pI]},$$scope:{ctx:r}};r[0]!==void 0&&(s.show=r[0]),e=new ns({props:s}),pn.push(()=>Dn(e,"show",u));let d=r[1]&&gv(r);return{c(){ue(e.$$.fragment),n=ie(),d&&d.c(),i=rr()},m(p,g){ae(e,p,g),W(p,n,g),d&&d.m(p,g),W(p,i,g),o=!0},p(p,[g]){const _={};g&32&&(_.$$scope={dirty:g,ctx:p}),!t&&g&1&&(t=!0,_.show=p[0],zn(()=>t=!1)),e.$set(_),p[1]?d?(d.p(p,g),g&2&&N(d,1)):(d=gv(p),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Kt(),V(d,1,1,()=>{d=null}),Jt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(G(n),G(i)),le(e,p),d&&d.d(p)}}}function bI(r,e,t){let n;st(r,kr,s=>t(1,n=s));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99",Recreation:"#f0027f"};function u(s){i=s,t(0,i)}return[i,n,o,u]}class wI extends Tt{constructor(e){super(),Ct(this,e,bI,vI,wt,{})}}function xI(r){let e,t,n,i,o;return t=new wo({props:{colorScale:ah.toReversed(),labels:{buckets:b2(lh).toReversed()}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),i.innerHTML="<span>Less deprived</span> <span>More deprived</span>",Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),fe(e,"slot","legend")},m(u,s){W(u,e,s),ae(t,e,null),R(e,n),R(e,i),o=!0},p:ft,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&G(e),le(t)}}}function AI(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function kI(r){let e,t,n,i,o;return t=new wo({props:{colorScale:oc,labels:{limits:r[3].population_density}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),i.innerHTML="<span>Less dense</span> <span>people / kmÂ²</span> <span>More dense</span>",Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),fe(e,"slot","legend")},m(u,s){W(u,e,s),ae(t,e,null),R(e,n),R(e,i),o=!0},p(u,s){const d={};s&8&&(d.labels={limits:u[3].population_density}),t.$set(d)},i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&G(e),le(t)}}}function SI(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function CI(r){let e,t,n,i,o;return t=new wo({props:{colorScale:ch.toReversed(),labels:{limits:uh.toReversed().map(BI)}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),fe(e,"slot","legend")},m(u,s){W(u,e,s),ae(t,e,null),R(e,n),R(e,i),o=!0},p:ft,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&G(e),le(t)}}}function TI(r){let e;return{c(){e=U("p"),e.textContent="Show households from the Scottish census with at least one car.",fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function MI(r){let e,t,n=r[10].id+"",i,o,u=r[10].population.toLocaleString()+"",s,d,p=r[10].imd_rank+"",g,_,x=r[10].imd_percentile+"",C,T;return{c(){e=U("p"),t=Te("Data zone "),i=Te(n),o=Te(`
        has `),s=Te(u),d=Te(`
        people, and a SIMD rank of `),g=Te(p),_=Te(`, making it less deprived
        than `),C=Te(x),T=Te("% of data zones.")},m(z,L){W(z,e,L),R(e,t),R(e,i),R(e,o),R(e,s),R(e,d),R(e,g),R(e,_),R(e,C),R(e,T)},p(z,L){L&1024&&n!==(n=z[10].id+"")&&At(i,n),L&1024&&u!==(u=z[10].population.toLocaleString()+"")&&At(s,u),L&1024&&p!==(p=z[10].imd_rank+"")&&At(g,p),L&1024&&x!==(x=z[10].imd_percentile+"")&&At(C,x)},d(z){z&&G(e)}}}function EI(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[MI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function LI(r){let e,t,n=r[10].id+"",i,o,u=sc(r[10].households_with_cars_or_vans,r[10].total_households)+"",s,d,p=r[10].total_households.toLocaleString()+"",g,_;return{c(){e=U("p"),t=Te("In data zone "),i=Te(n),o=ie(),s=Te(u),d=Te(" of approximately "),g=Te(p),_=Te(`
        households have at least one car or van.`)},m(x,C){W(x,e,C),R(e,t),R(e,i),R(e,o),R(e,s),R(e,d),R(e,g),R(e,_)},p(x,C){C&1024&&n!==(n=x[10].id+"")&&At(i,n),C&1024&&u!==(u=sc(x[10].households_with_cars_or_vans,x[10].total_households)+"")&&At(s,u),C&1024&&p!==(p=x[10].total_households.toLocaleString()+"")&&At(g,p)},d(x){x&&G(e)}}}function II(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[LI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function PI(r){let e,t,n=r[10].id+"",i,o,u=r[10].population.toLocaleString()+"",s,d,p=Math.round(r[10].population/(r[10].area/1e6)).toLocaleString()+"",g,_;return{c(){e=U("p"),t=Te("Data zone "),i=Te(n),o=Te(`
        has `),s=Te(u),d=Te(`
        people, with a density of `),g=Te(p),_=Te(" people per square kilometer")},m(x,C){W(x,e,C),R(e,t),R(e,i),R(e,o),R(e,s),R(e,d),R(e,g),R(e,_)},p(x,C){C&1024&&n!==(n=x[10].id+"")&&At(i,n),C&1024&&u!==(u=x[10].population.toLocaleString()+"")&&At(s,u),C&1024&&p!==(p=Math.round(x[10].population/(x[10].area/1e6)).toLocaleString()+"")&&At(g,p)},d(x){x&&G(e)}}}function zI(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[PI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function DI(r){let e,t,n,i,o,u,s,d;const p=[yn("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Di(["get","imd_percentile"],lh,ah),"fill-opacity":Xn(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let g={$$slots:{default:[EI]},$$scope:{ctx:r}};for(let E=0;E<p.length;E+=1)g=It(g,p[E]);e=new Xi({props:g});const _=[yn("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Di(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],uh,ch),"fill-opacity":Xn(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={$$slots:{default:[II]},$$scope:{ctx:r}};for(let E=0;E<_.length;E+=1)x=It(x,_[E]);n=new Xi({props:x});const C=[yn("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Di(["/",["get","population"],["/",["get","area"],1e6]],r[3].population_density,oc),"fill-opacity":Xn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let T={$$slots:{default:[zI]},$$scope:{ctx:r}};for(let E=0;E<C.length;E+=1)T=It(T,C[E]);o=new Xi({props:T});const z=[yn("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let L={};for(let E=0;E<z.length;E+=1)L=It(L,z[E]);return s=new cr({props:L}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(E,I){ae(e,E,I),W(E,t,I),ae(n,E,I),W(E,i,I),ae(o,E,I),W(E,u,I),ae(s,E,I),d=!0},p(E,I){const O=I&1?Mn(p,[p[0],p[1],p[2],p[3],{layout:{visibility:E[0]?"visible":"none"}}]):{};I&2048&&(O.$$scope={dirty:I,ctx:E}),e.$set(O);const B=I&4?Mn(_,[_[0],_[1],_[2],_[3],{layout:{visibility:E[2]?"visible":"none"}}]):{};I&2048&&(B.$$scope={dirty:I,ctx:E}),n.$set(B);const K=I&10?Mn(C,[C[0],C[1],C[2],I&8&&{paint:{"fill-color":Di(["/",["get","population"],["/",["get","area"],1e6]],E[3].population_density,oc),"fill-opacity":Xn(.7,.9)}},I&2&&{layout:{visibility:E[1]?"visible":"none"}}]):{};I&2048&&(K.$$scope={dirty:I,ctx:E}),o.$set(K);const H=I&7?Mn(z,[z[0],z[1],z[2],{layout:{visibility:E[0]||E[1]||E[2]?"visible":"none"}}]):{};s.$set(H)},i(E){d||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(s.$$.fragment,E),d=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(s.$$.fragment,E),d=!1},d(E){E&&(G(t),G(i),G(u)),le(e,E),le(n,E),le(o,E),le(s,E)}}}function RI(r){let e,t,n,i,o,u,s,d,p,g,_;function x(I){r[5](I)}let C={label:"SIMD",onChange:r[4],$$slots:{help:[AI],legend:[xI]},$$scope:{ctx:r}};r[0]!==void 0&&(C.show=r[0]),e=new ns({props:C}),pn.push(()=>Dn(e,"show",x));function T(I){r[7](I)}let z={label:"Population density",onChange:r[6],$$slots:{help:[SI],legend:[kI]},$$scope:{ctx:r}};r[1]!==void 0&&(z.show=r[1]),i=new ns({props:z}),pn.push(()=>Dn(i,"show",T));function L(I){r[9](I)}let E={label:"Car ownership",onChange:r[8],$$slots:{help:[TI],legend:[CI]},$$scope:{ctx:r}};return r[2]!==void 0&&(E.show=r[2]),s=new ns({props:E}),pn.push(()=>Dn(s,"show",L)),g=new th({props:{url:`pmtiles://${Fo("cnt_layers/population.pmtiles")}`,$$slots:{default:[DI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment),u=ie(),ue(s.$$.fragment),p=ie(),ue(g.$$.fragment)},m(I,O){ae(e,I,O),W(I,n,O),ae(i,I,O),W(I,u,O),ae(s,I,O),W(I,p,O),ae(g,I,O),_=!0},p(I,[O]){const B={};O&7&&(B.onChange=I[4]),O&2048&&(B.$$scope={dirty:O,ctx:I}),!t&&O&1&&(t=!0,B.show=I[0],zn(()=>t=!1)),e.$set(B);const K={};O&7&&(K.onChange=I[6]),O&2056&&(K.$$scope={dirty:O,ctx:I}),!o&&O&2&&(o=!0,K.show=I[1],zn(()=>o=!1)),i.$set(K);const H={};O&7&&(H.onChange=I[8]),O&2048&&(H.$$scope={dirty:O,ctx:I}),!d&&O&4&&(d=!0,H.show=I[2],zn(()=>d=!1)),s.$set(H);const q={};O&2063&&(q.$$scope={dirty:O,ctx:I}),g.$set(q)},i(I){_||(N(e.$$.fragment,I),N(i.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),_=!0)},o(I){V(e.$$.fragment,I),V(i.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),_=!1},d(I){I&&(G(n),G(u),G(p)),le(e,I),le(i,I),le(s,I),le(g,I)}}}const BI=r=>`${r}%`;function FI(r,e,t){let n;st(r,lc,C=>t(3,n=C));let i=!1,o=!1,u=!1;const s=()=>{i&&(t(1,o=!1),t(2,u=!1))};function d(C){i=C,t(0,i)}const p=()=>{o&&(t(0,i=!1),t(2,u=!1))};function g(C){o=C,t(1,o)}const _=()=>{u&&(t(0,i=!1),t(1,o=!1))};function x(C){u=C,t(2,u)}return[i,o,u,n,s,d,p,g,_,x]}class OI extends Tt{constructor(e){super(),Ct(this,e,FI,RI,wt,{})}}function $I(r){let e;return{c(){e=U("div"),e.innerHTML=`<img src="${sw}" alt="National Rail logo"/>
    Station`,fe(e,"slot","legend"),Ye(e,"display","flex"),Ye(e,"gap","8px"),Ye(e,"align-items","center")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function NI(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function jI(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=U("p"),n=Te(t)},m(i,o){W(i,e,o),R(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&At(n,t)},d(i){i&&G(e)}}}function UI(r){let e,t;return e=new pi({props:{$$slots:{default:[jI,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function VI(r){let e,t;const n=[yn("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[UI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new ec({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&1?Mn(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function qI(r){let e,t,n,i,o;function u(d){r[1](d)}let s={label:"Railway stations",$$slots:{help:[NI],legend:[$I]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new ns({props:s}),pn.push(()=>Dn(e,"show",u)),i=new yr({props:{data:Fo("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[VI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),W(d,n,p),ae(i,d,p),o=!0},p(d,[p]){const g={};p&8&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],zn(()=>t=!1)),e.$set(g);const _={};p&9&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&G(n),le(e,d),le(i,d)}}}function HI(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class GI extends Tt{constructor(e){super(),Ct(this,e,HI,qI,wt,{})}}function WI(r){let e;return{c(){e=U("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data Â© Crown copyright and database right 2025.</p>`,fe(e,"slot","help")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function ZI(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q;return B=new Ig({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=U("div"),t=U("fieldset"),n=U("label"),i=U("input"),o=Te(`
        Pedestrians`),u=ie(),s=U("label"),d=U("input"),p=Te(`
        Cyclists`),g=ie(),_=U("fieldset"),x=U("label"),C=Te(`From
        `),T=U("input"),z=ie(),L=U("label"),E=Te(`To
        `),I=U("input"),O=ie(),ue(B.$$.fragment),fe(i,"type","checkbox"),fe(i,"class","svelte-rvrx5w"),fe(d,"type","checkbox"),fe(d,"class","svelte-rvrx5w"),Ye(t,"display","flex"),Ye(t,"gap","3em"),fe(t,"class","svelte-rvrx5w"),fe(T,"type","number"),fe(T,"min",2017),fe(T,"max",2023),fe(T,"class","svelte-rvrx5w"),fe(I,"type","number"),fe(I,"min",2017),fe(I,"max",2023),fe(I,"class","svelte-rvrx5w"),fe(_,"class","year-filter svelte-rvrx5w"),fe(e,"slot","legend")},m(J,he){W(J,e,he),R(e,t),R(t,n),R(n,i),i.checked=r[1].pedestrians,R(n,o),R(t,u),R(t,s),R(s,d),d.checked=r[1].cyclists,R(s,p),R(e,g),R(e,_),R(_,x),R(x,C),R(x,T),Kn(T,r[1].minYear),R(_,z),R(_,L),R(L,E),R(L,I),Kn(I,r[1].maxYear),R(e,O),ae(B,e,null),K=!0,H||(q=[Lt(i,"change",r[7]),Lt(d,"change",r[8]),Lt(T,"input",r[9]),Lt(I,"input",r[10])],H=!0)},p(J,he){he&2&&(i.checked=J[1].pedestrians),he&2&&(d.checked=J[1].cyclists),he&2&&Pl(T.value)!==J[1].minYear&&Kn(T,J[1].minYear),he&2&&Pl(I.value)!==J[1].maxYear&&Kn(I,J[1].maxYear)},i(J){K||(N(B.$$.fragment,J),K=!0)},o(J){V(B.$$.fragment,J),K=!1},d(J){J&&G(e),le(B),H=!1,hr(q)}}}function _v(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=U("p"),t=Te("Pedestrian location: "),n=U("b"),o=Te(i)},m(u,s){W(u,e,s),R(e,t),R(e,n),R(n,o)},p(u,s){s&4096&&i!==(i=u[3][u[12].pedestrian_location]+"")&&At(o,i)},d(u){u&&G(e)}}}function yv(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=U("p"),t=Te("Pedestrian movement: "),n=U("b"),o=Te(i)},m(u,s){W(u,e,s),R(e,t),R(e,n),R(n,o)},p(u,s){s&4096&&i!==(i=u[4][u[12].pedestrian_movement]+"")&&At(o,i)},d(u){u&&G(e)}}}function XI(r){let e,t,n,i=r[12].year+"",o,u,s,d,p,g=r[5][r[12].severity]+"",_,x,C,T,z,L=vv(r[12])+"",E,I,O,B,K,H=r[12].pedestrian_location&&_v(r),q=r[12].pedestrian_movement&&yv(r);return{c(){e=U("p"),t=Te("Year: "),n=U("b"),o=Te(i),u=ie(),s=U("p"),d=Te("Severity: "),p=U("b"),_=Te(g),x=ie(),C=U("p"),T=Te("Casualties: "),z=U("b"),E=Te(L),I=ie(),H&&H.c(),O=ie(),q&&q.c(),B=ie(),K=U("p"),K.textContent="Click to open full report in CycleStreets"},m(J,he){W(J,e,he),R(e,t),R(e,n),R(n,o),W(J,u,he),W(J,s,he),R(s,d),R(s,p),R(p,_),W(J,x,he),W(J,C,he),R(C,T),R(C,z),R(z,E),W(J,I,he),H&&H.m(J,he),W(J,O,he),q&&q.m(J,he),W(J,B,he),W(J,K,he)},p(J,he){he&4096&&i!==(i=J[12].year+"")&&At(o,i),he&4096&&g!==(g=J[5][J[12].severity]+"")&&At(_,g),he&4096&&L!==(L=vv(J[12])+"")&&At(E,L),J[12].pedestrian_location?H?H.p(J,he):(H=_v(J),H.c(),H.m(O.parentNode,O)):H&&(H.d(1),H=null),J[12].pedestrian_movement?q?q.p(J,he):(q=yv(J),q.c(),q.m(B.parentNode,B)):q&&(q.d(1),q=null)},d(J){J&&(G(e),G(u),G(s),G(x),G(C),G(I),G(O),G(B),G(K)),H&&H.d(J),q&&q.d(J)}}}function KI(r){let e,t;return e=new pi({props:{$$slots:{default:[XI,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function JI(r){let e,t,n,i;const o=[yn("context-stats19-heatmap"),{sourceLayer:"stats19"},{maxzoom:13},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{paint:{"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,15]}}];let u={};for(let p=0;p<o.length;p+=1)u=It(u,o[p]);e=new wS({props:u});const s=[yn("context-stats19-points"),{sourceLayer:"stats19"},{minzoom:13},{paint:{"circle-color":Di(["get","severity"],[1,2,3],[mg,gg,_g]),"circle-opacity":.9,"circle-radius":13,"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let d={$$slots:{default:[KI]},$$scope:{ctx:r}};for(let p=0;p<s.length;p+=1)d=It(d,s[p]);return n=new Bl({props:d}),n.$on("click",QI),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _=g&7?Mn(o,[o[0],o[1],o[2],g&6&&{filter:p[2](p[1])},g&1&&{layout:{visibility:p[0]?"visible":"none"}},o[5]]):{};e.$set(_);const x=g&7?Mn(s,[s[0],s[1],s[2],g&0&&{paint:{"circle-color":Di(["get","severity"],[1,2,3],[mg,gg,_g]),"circle-opacity":.9,"circle-radius":13,"circle-stroke-color":"black","circle-stroke-width":.1}},g&6&&{filter:p[2](p[1])},g&1&&{layout:{visibility:p[0]?"visible":"none"}},s[6]]):{};g&8192&&(x.$$scope={dirty:g,ctx:p}),n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function YI(r){let e,t,n,i,o;function u(d){r[11](d)}let s={label:"Collisions",$$slots:{legend:[ZI],help:[WI]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new ns({props:s}),pn.push(()=>Dn(e,"show",u)),i=new th({props:{url:`pmtiles://${Fo("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[JI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),W(d,n,p),ae(i,d,p),o=!0},p(d,[p]){const g={};p&8194&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],zn(()=>t=!1)),e.$set(g);const _={};p&8195&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&G(n),le(e,d),le(i,d)}}}let mg="#080C54",gg="#1F9EB7",_g="#CDE594";function vv(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function QI(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function e6(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(z){let L=["any"];return i.pedestrians&&L.push(["get","pedestrian"]),i.cyclists&&L.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],L]}let u={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},s={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},d={1:"Fatal",2:"Serious",3:"Slight"},p={Slight:_g,Serious:gg,Fatal:mg};function g(){i.pedestrians=this.checked,t(1,i)}function _(){i.cyclists=this.checked,t(1,i)}function x(){i.minYear=Pl(this.value),t(1,i)}function C(){i.maxYear=Pl(this.value),t(1,i)}function T(z){n=z,t(0,n)}return[n,i,o,u,s,d,p,g,_,x,C,T]}class t6 extends Tt{constructor(e){super(),Ct(this,e,e6,YI,wt,{})}}function bv(r){let e;return{c(){e=Te("Layers")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function wv(r){let e,t,n,i,o;function u(p){r[6](p)}let s={label:"Existing modal filters and turn restrictions"};r[2]!==void 0&&(s.show=r[2]),e=new ns({props:s}),pn.push(()=>Dn(e,"show",u));let d=r[3]=="cnt"&&xv();return{c(){ue(e.$$.fragment),n=ie(),d&&d.c(),i=rr()},m(p,g){ae(e,p,g),W(p,n,g),d&&d.m(p,g),W(p,i,g),o=!0},p(p,g){const _={};!t&&g&4&&(t=!0,_.show=p[2],zn(()=>t=!1)),e.$set(_),p[3]=="cnt"?d?g&8&&N(d,1):(d=xv(),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Kt(),V(d,1,1,()=>{d=null}),Jt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(G(n),G(i)),le(e,p),d&&d.d(p)}}}function xv(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I;return n=new OI({}),o=new wI({}),s=new t6({}),_=new GI({}),C=new nM({}),E=new dI({}),{c(){e=U("div"),e.textContent="Metrics",t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment),d=ie(),p=U("div"),p.textContent="Public transport integration",g=ie(),ue(_.$$.fragment),x=ie(),ue(C.$$.fragment),T=ie(),z=U("div"),z.textContent="Active travel",L=ie(),ue(E.$$.fragment),fe(e,"class","layer-group"),fe(p,"class","layer-group"),fe(z,"class","layer-group")},m(O,B){W(O,e,B),W(O,t,B),ae(n,O,B),W(O,i,B),ae(o,O,B),W(O,u,B),ae(s,O,B),W(O,d,B),W(O,p,B),W(O,g,B),ae(_,O,B),W(O,x,B),ae(C,O,B),W(O,T,B),W(O,z,B),W(O,L,B),ae(E,O,B),I=!0},i(O){I||(N(n.$$.fragment,O),N(o.$$.fragment,O),N(s.$$.fragment,O),N(_.$$.fragment,O),N(C.$$.fragment,O),N(E.$$.fragment,O),I=!0)},o(O){V(n.$$.fragment,O),V(o.$$.fragment,O),V(s.$$.fragment,O),V(_.$$.fragment,O),V(C.$$.fragment,O),V(E.$$.fragment,O),I=!1},d(O){O&&(G(e),G(t),G(i),G(u),G(d),G(p),G(g),G(x),G(T),G(z),G(L)),le(n,O),le(o,O),le(s,O),le(_,O),le(C,O),le(E,O)}}}function n6(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B;i=new g4({props:{color:"#333"}});let K=r[0]&&bv(),H=r[1]&&wv(r);return{c(){e=U("div"),t=U("button"),n=U("div"),ue(i.$$.fragment),o=ie(),K&&K.c(),s=ie(),d=U("div"),H&&H.c(),p=ie(),g=U("div"),_=U("span"),_.textContent="Basemap",x=ie(),C=U("select"),T=U("option"),T.textContent="MapTiler Dataviz",z=U("option"),z.textContent="MapTiler Streets",L=U("option"),L.textContent="MapTiler Satellite",E=U("option"),E.textContent="OS Open Zoomstack",Ye(n,"display","flex"),Ye(n,"gap","12px"),Ye(n,"color","#333"),Ye(n,"align-items","center"),Ye(n,"justify-content","center"),fe(t,"class",u="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-1skef0p"),fe(t,"aria-label","Layers"),Ye(_,"font-size","20px"),Ye(_,"margin-left","8px"),Ye(_,"margin-top","4px"),T.__value="dataviz",Kn(T,T.__value),z.__value="streets-v2",Kn(z,z.__value),L.__value="hybrid",Kn(L,L.__value),E.__value="uk-openzoomstack-light",Kn(E,E.__value),Ye(C,"width","auto"),Ye(C,"font-size","20px"),Ye(C,"margin","8px"),Ye(C,"padding","8px"),Ye(C,"text-overflow","ellipsis"),r[4]===void 0&&ms(()=>r[7].call(C)),fe(g,"class","context-control"),fe(d,"class","contextual-layer-controls svelte-1skef0p"),Ye(d,"flex-direction","column"),Ye(d,"display",r[0]?"flex":"none"),fe(e,"class","pico contextual-layers svelte-1skef0p"),Ye(e,"display","flex"),Ye(e,"flex-direction","column"),Ye(e,"border-radius","5px"),Ye(e,"width",r[0]?"300px":"auto")},m(q,J){W(q,e,J),R(e,t),R(t,n),ae(i,n,null),R(n,o),K&&K.m(n,null),R(e,s),R(e,d),H&&H.m(d,null),R(d,p),R(d,g),R(g,_),R(g,x),R(g,C),R(C,T),R(C,z),R(C,L),R(C,E),Wi(C,r[4],!0),I=!0,O||(B=[Lt(t,"click",r[5]),Lt(C,"change",r[7])],O=!0)},p(q,J){q[0]?K||(K=bv(),K.c(),K.m(n,null)):K&&(K.d(1),K=null),(!I||J&1&&u!==(u="show-layers-button icon-btn "+(q[0]?"expanded":"")+" svelte-1skef0p"))&&fe(t,"class",u),q[1]?H?(H.p(q,J),J&2&&N(H,1)):(H=wv(q),H.c(),N(H,1),H.m(d,p)):H&&(Kt(),V(H,1,1,()=>{H=null}),Jt()),J&16&&Wi(C,q[4]),J&1&&Ye(d,"display",q[0]?"flex":"none"),J&1&&Ye(e,"width",q[0]?"300px":"auto")},i(q){I||(N(i.$$.fragment,q),N(H),I=!0)},o(q){V(i.$$.fragment,q),V(H),I=!1},d(q){q&&G(e),le(i),K&&K.d(),H&&H.d(),O=!1,hr(B)}}}function r6(r){let e,t;return e=new Jm({props:{defaultStyling:!0,$$slots:{default:[n6]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function i6(r,e,t){let n,i,o,u;st(r,kr,_=>t(1,n=_)),st(r,Kd,_=>t(2,i=_)),st(r,bs,_=>t(3,o=_)),st(r,qm,_=>t(4,u=_));let s=!1;const d=()=>t(0,s=!s);function p(_){i=_,Kd.set(i)}function g(){u=za(this),qm.set(u)}return[s,n,i,o,u,d,p,g]}class o6 extends Tt{constructor(e){super(),Ct(this,e,i6,r6,wt,{})}}let St;function s6(r){const e=St.__externref_table_alloc();return St.__wbindgen_export_2.set(e,r),e}function Sl(r,e){try{return r.apply(this,e)}catch(t){const n=s6(t);St.__wbindgen_exn_store(n)}}const N2=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&N2.decode();let Af=null;function Ju(){return(Af===null||Af.byteLength===0)&&(Af=new Uint8Array(St.memory.buffer)),Af}function Lr(r,e){return r=r>>>0,N2.decode(Ju().subarray(r,r+e))}let bi=0;const Vd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},a6=typeof Vd.encodeInto=="function"?function(r,e){return Vd.encodeInto(r,e)}:function(r,e){const t=Vd.encode(r);return e.set(t),{read:r.length,written:t.length}};function Do(r,e,t){if(t===void 0){const s=Vd.encode(r),d=e(s.length,1)>>>0;return Ju().subarray(d,d+s.length).set(s),bi=s.length,d}let n=r.length,i=e(n,1)>>>0;const o=Ju();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Ju().subarray(i+u,i+n),d=a6(r,s);u+=d.written,i=t(i,n,u,1)>>>0}return bi=u,i}let Tl=null;function Ds(){return(Tl===null||Tl.buffer.detached===!0||Tl.buffer.detached===void 0&&Tl.buffer!==St.memory.buffer)&&(Tl=new DataView(St.memory.buffer)),Tl}function Gu(r){return r==null}function yg(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=yg(r[0]));for(let u=1;u<i;u++)o+=", "+yg(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t&&t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Fm(r,e){const t=e(r.length*1,1)>>>0;return Ju().set(r,t/1),bi=r.length,t}function Yn(r){const e=St.__wbindgen_export_2.get(r);return St.__externref_table_dealloc(r),e}let kf=null;function l6(){return(kf===null||kf.byteLength===0)&&(kf=new Float64Array(St.memory.buffer)),kf}function u6(r,e){return r=r>>>0,l6().subarray(r/8,r/8+e)}function c6(r,e){return r=r>>>0,Ju().subarray(r/1,r/1+e)}const Av=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>St.__wbg_ltn_free(r>>>0,1));class f6{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Av.unregister(this),e}free(){const e=this.__destroy_into_raw();St.__wbg_ltn_free(e,0)}constructor(e,t,n,i,o,u,s,d){const p=Fm(e,St.__wbindgen_malloc),g=bi,_=Fm(t,St.__wbindgen_malloc),x=bi,C=Fm(n,St.__wbindgen_malloc),T=bi,z=Do(o,St.__wbindgen_malloc,St.__wbindgen_realloc),L=bi;var E=Gu(u)?0:Do(u,St.__wbindgen_malloc,St.__wbindgen_realloc),I=bi;const O=Do(s,St.__wbindgen_malloc,St.__wbindgen_realloc),B=bi,K=St.ltn_new(p,g,_,x,C,T,i,z,L,E,I,O,B,d);if(K[2])throw Yn(K[1]);return this.__wbg_ptr=K[0]>>>0,Av.register(this,this.__wbg_ptr,this),this}getInvertedBoundary(){let e,t;try{const o=St.ltn_getInvertedBoundary(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}getBounds(){const e=St.ltn_getBounds(this.__wbg_ptr);var t=u6(e[0],e[1]).slice();return St.__wbindgen_free(e[0],e[1]*8,8),t}toRouteSnapper(){const e=St.ltn_toRouteSnapper(this.__wbg_ptr);var t=c6(e[0],e[1]).slice();return St.__wbindgen_free(e[0],e[1]*1,1),t}toRouteSnapperGj(){let e,t;try{const o=St.ltn_toRouteSnapperGj(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const o=St.ltn_renderModalFilters(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const o=St.ltn_renderTurnRestrictions(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const o=St.ltn_renderNeighbourhood(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const o=St.ltn_generatedBoundaries(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const u=St.ltn_generateMergedBoundary(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{St.__wbindgen_free(t,n,1)}}extractWaypointsFromRing(e){let t,n;try{const u=St.ltn_extractWaypointsFromRing(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{St.__wbindgen_free(t,n,1)}}setCurrentNeighbourhoodBoundary(e,t){const n=Do(e,St.__wbindgen_malloc,St.__wbindgen_realloc),i=bi,o=St.ltn_setCurrentNeighbourhoodBoundary(this.__wbg_ptr,n,i,t);if(o[1])throw Yn(o[0])}deleteNeighbourhoodBoundary(e){const t=Do(e,St.__wbindgen_malloc,St.__wbindgen_realloc),n=bi;St.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Do(e,St.__wbindgen_malloc,St.__wbindgen_realloc),i=bi,o=Do(t,St.__wbindgen_malloc,St.__wbindgen_realloc),u=bi;St.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,u)}setCurrentNeighbourhood(e){const t=Do(e,St.__wbindgen_malloc,St.__wbindgen_realloc),n=bi,i=St.ltn_setCurrentNeighbourhood(this.__wbg_ptr,t,n);if(i[1])throw Yn(i[0])}addModalFilter(e,t){const n=Do(t,St.__wbindgen_malloc,St.__wbindgen_realloc),i=bi,o=St.ltn_addModalFilter(this.__wbg_ptr,e,n,i);if(o[1])throw Yn(o[0])}addManyModalFilters(e,t){const n=Do(t,St.__wbindgen_malloc,St.__wbindgen_realloc),i=bi,o=St.ltn_addManyModalFilters(this.__wbg_ptr,e,n,i);if(o[1])throw Yn(o[0])}deleteModalFilter(e){St.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){const t=St.ltn_addDiagonalFilter(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}rotateDiagonalFilter(e){const t=St.ltn_rotateDiagonalFilter(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}deleteDiagonalFilter(e){const t=St.ltn_deleteDiagonalFilter(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}addTurnRestriction(e,t){const n=St.ltn_addTurnRestriction(this.__wbg_ptr,e,t);if(n[1])throw Yn(n[0])}deleteTurnRestriction(e,t,n){const i=St.ltn_deleteTurnRestriction(this.__wbg_ptr,e,t,n);if(i[1])throw Yn(i[0])}getTurnRestrictionTargets(e){let t,n;try{const u=St.ltn_getTurnRestrictionTargets(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{St.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){St.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){const t=St.ltn_toggleMainRoad(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}reclassifyRoadsAlongLine(e,t,n){const i=St.ltn_reclassifyRoadsAlongLine(this.__wbg_ptr,e,t,n);if(i[1])throw Yn(i[0])}undo(){const e=St.ltn_undo(this.__wbg_ptr);if(e[1])throw Yn(e[0])}redo(){const e=St.ltn_redo(this.__wbg_ptr);if(e[1])throw Yn(e[0])}getShortcutsCrossingRoad(e){let t,n;try{const u=St.ltn_getShortcutsCrossingRoad(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{St.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const o=St.ltn_getAllShortcuts(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const o=St.ltn_toSavefile(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}loadSavefile(e){const t=St.ltn_loadSavefile(this.__wbg_ptr,e);if(t[1])throw Yn(t[0])}compareRoute(e,t,n,i,o){let u,s;try{const g=St.ltn_compareRoute(this.__wbg_ptr,e,t,n,i,o);var d=g[0],p=g[1];if(g[3])throw d=0,p=0,Yn(g[2]);return u=d,s=p,Lr(d,p)}finally{St.__wbindgen_free(u,s,1)}}impactToOneDestination(e,t){let n,i;try{const s=St.ltn_impactToOneDestination(this.__wbg_ptr,e,t);var o=s[0],u=s[1];if(s[3])throw o=0,u=0,Yn(s[2]);return n=o,i=u,Lr(o,u)}finally{St.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const u=St.ltn_predictImpact(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{St.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const s=St.ltn_getImpactsOnRoad(this.__wbg_ptr,e,t);var o=s[0],u=s[1];if(s[3])throw o=0,u=0,Yn(s[2]);return n=o,i=u,Lr(o,u)}finally{St.__wbindgen_free(n,i,1)}}getAllNeighbourhoods(){let e,t;try{const o=St.ltn_getAllNeighbourhoods(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const o=St.ltn_getAllIntersections(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const u=St.ltn_getMovements(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Yn(u[2]);return t=i,n=o,Lr(i,o)}finally{St.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const o=St.ltn_getDemandModel(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const o=St.ltn_getPOIs(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}getMetricBuckets(){let e,t;try{const o=St.ltn_getMetricBuckets(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Yn(o[2]);return e=n,t=i,Lr(n,i)}finally{St.__wbindgen_free(e,t,1)}}}async function h6(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function d6(){const r={};return r.wbg={},r.wbg.__wbg_buffer_0e2c274546535a84=function(e){return e.buffer},r.wbg.__wbg_call_3a8ceff4c9f12325=function(){return Sl(function(e,t){return e.call(t)},arguments)},r.wbg.__wbg_debug_809501eb69aeeef4=function(e){console.debug(e)},r.wbg.__wbg_done_60e5165eca70220e=function(e){return e.done},r.wbg.__wbg_entries_85a648a6a5215287=function(e){return Object.entries(e)},r.wbg.__wbg_error_1c3d6d32fc1361cc=function(e){console.error(e)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let n,i;try{n=e,i=t,console.error(Lr(e,t))}finally{St.__wbindgen_free(n,i,1)}},r.wbg.__wbg_get_9c5338635800e15f=function(){return Sl(function(e,t){return Reflect.get(e,t)},arguments)},r.wbg.__wbg_get_d749e505e6746136=function(e,t){return e[t>>>0]},r.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){return e[t]},r.wbg.__wbg_globalThis_d0fa1c7e1465604c=function(){return Sl(function(){return globalThis.globalThis},arguments)},r.wbg.__wbg_global_23a7926f0ad701bc=function(){return Sl(function(){return global.global},arguments)},r.wbg.__wbg_info_26a1a6efb20c9f43=function(e){console.info(e)},r.wbg.__wbg_instanceof_ArrayBuffer_c632aa9cfefb45b9=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_instanceof_Map_212855790ec94f3b=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t},r.wbg.__wbg_instanceof_Uint8Array_aa04d9da2a05b974=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_isArray_b7133b5e9a258525=function(e){return Array.isArray(e)},r.wbg.__wbg_isSafeInteger_f6d409cd7a7eb81d=function(e){return Number.isSafeInteger(e)},r.wbg.__wbg_iterator_0210e004ec06fb30=function(){return Symbol.iterator},r.wbg.__wbg_length_bc129fab12fd2a9c=function(e){return e.length},r.wbg.__wbg_length_ee1bca74ed444cce=function(e){return e.length},r.wbg.__wbg_log_91785a95194156ea=function(e){console.log(e)},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},r.wbg.__wbg_new_cf66b35fe5443282=function(e){return new Uint8Array(e)},r.wbg.__wbg_newnoargs_1143e0b74be16ea9=function(e,t){return new Function(Lr(e,t))},r.wbg.__wbg_next_4d092fa9da3ba108=function(e){return e.next},r.wbg.__wbg_next_7b79803d4b7a1b68=function(){return Sl(function(e){return e.next()},arguments)},r.wbg.__wbg_now_882dd9fbc163f00d=function(e){return e.now()},r.wbg.__wbg_performance_686bdd9b0415bed6=function(e){return e.performance},r.wbg.__wbg_self_3a2c444cba620c12=function(){return Sl(function(){return self.self},arguments)},r.wbg.__wbg_set_2611eb16b9ac5ca9=function(e,t,n){e.set(t,n>>>0)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const n=t.stack,i=Do(n,St.__wbindgen_malloc,St.__wbindgen_realloc),o=bi;Ds().setInt32(e+4*1,o,!0),Ds().setInt32(e+4*0,i,!0)},r.wbg.__wbg_value_fdfbba27b1fcaf65=function(e){return e.value},r.wbg.__wbg_warn_8fc67512df65ef55=function(e){console.warn(e)},r.wbg.__wbg_window_a27f90073150a6bf=function(){return Sl(function(){return window.window},arguments)},r.wbg.__wbindgen_bigint_from_i64=function(e){return e},r.wbg.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=t,i=typeof n=="bigint"?n:void 0;Ds().setBigInt64(e+8*1,Gu(i)?BigInt(0):i,!0),Ds().setInt32(e+4*0,!Gu(i),!0)},r.wbg.__wbindgen_boolean_get=function(e){const t=e;return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_debug_string=function(e,t){const n=yg(t),i=Do(n,St.__wbindgen_malloc,St.__wbindgen_realloc),o=bi;Ds().setInt32(e+4*1,o,!0),Ds().setInt32(e+4*0,i,!0)},r.wbg.__wbindgen_error_new=function(e,t){return new Error(Lr(e,t))},r.wbg.__wbindgen_in=function(e,t){return e in t},r.wbg.__wbindgen_init_externref_table=function(){const e=St.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},r.wbg.__wbindgen_is_bigint=function(e){return typeof e=="bigint"},r.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},r.wbg.__wbindgen_is_object=function(e){const t=e;return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return e===void 0},r.wbg.__wbindgen_jsval_eq=function(e,t){return e===t},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return e==t},r.wbg.__wbindgen_memory=function(){return St.memory},r.wbg.__wbindgen_number_get=function(e,t){const n=t,i=typeof n=="number"?n:void 0;Ds().setFloat64(e+8*1,Gu(i)?0:i,!0),Ds().setInt32(e+4*0,!Gu(i),!0)},r.wbg.__wbindgen_string_get=function(e,t){const n=t,i=typeof n=="string"?n:void 0;var o=Gu(i)?0:Do(i,St.__wbindgen_malloc,St.__wbindgen_realloc),u=bi;Ds().setInt32(e+4*1,u,!0),Ds().setInt32(e+4*0,o,!0)},r.wbg.__wbindgen_string_new=function(e,t){return Lr(e,t)},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Lr(e,t))},r}function p6(r,e){return St=r.exports,j2.__wbindgen_wasm_module=e,Tl=null,kf=null,Af=null,St.__wbindgen_start(),St}async function j2(r){if(St!==void 0)return St;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("backend_bg.wasm",self.location));const e=d6();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await h6(await r,e);return p6(t,n)}const m6=r=>({}),kv=r=>({}),g6=r=>({}),Sv=r=>({}),_6=r=>({}),Cv=r=>({});function y6(r){let e,t,n,i,o,u,s,d;const p=r[1].top,g=vn(p,r,r[0],Cv),_=r[1].left,x=vn(_,r,r[0],Sv),C=r[1].main,T=vn(C,r,r[0],kv);return{c(){e=U("div"),t=U("div"),g&&g.c(),n=ie(),i=U("div"),o=U("div"),x&&x.c(),u=ie(),s=U("div"),T&&T.c(),fe(t,"class","top svelte-29q570"),fe(o,"class","left svelte-29q570"),fe(s,"class","main svelte-29q570"),fe(i,"class","content svelte-29q570"),fe(e,"class","flex-container svelte-29q570")},m(z,L){W(z,e,L),R(e,t),g&&g.m(t,null),R(e,n),R(e,i),R(i,o),x&&x.m(o,null),R(i,u),R(i,s),T&&T.m(s,null),d=!0},p(z,[L]){g&&g.p&&(!d||L&1)&&wn(g,p,z,z[0],d?bn(p,z[0],L,_6):xn(z[0]),Cv),x&&x.p&&(!d||L&1)&&wn(x,_,z,z[0],d?bn(_,z[0],L,g6):xn(z[0]),Sv),T&&T.p&&(!d||L&1)&&wn(T,C,z,z[0],d?bn(C,z[0],L,m6):xn(z[0]),kv)},i(z){d||(N(g,z),N(x,z),N(T,z),d=!0)},o(z){V(g,z),V(x,z),V(T,z),d=!1},d(z){z&&G(e),g&&g.d(z),x&&x.d(z),T&&T.d(z)}}}function v6(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class b6 extends Tt{constructor(e){super(),Ct(this,e,v6,y6,wt,{})}}const w6=r=>({}),Tv=r=>({}),x6=r=>({}),Mv=r=>({}),A6=r=>({}),Ev=r=>({});function k6(r){let e,t,n,i,o,u;const s=r[4].top,d=vn(s,r,r[3],Ev),p=r[4].sidebar,g=vn(p,r,r[3],Mv),_=r[4].map,x=vn(_,r,r[3],Tv);return{c(){e=U("div"),d&&d.c(),t=ie(),n=U("div"),g&&g.c(),i=ie(),o=U("div"),x&&x.c()},m(C,T){W(C,e,T),d&&d.m(e,null),r[5](e),W(C,t,T),W(C,n,T),g&&g.m(n,null),r[6](n),W(C,i,T),W(C,o,T),x&&x.m(o,null),r[7](o),u=!0},p(C,[T]){d&&d.p&&(!u||T&8)&&wn(d,s,C,C[3],u?bn(s,C[3],T,A6):xn(C[3]),Ev),g&&g.p&&(!u||T&8)&&wn(g,p,C,C[3],u?bn(p,C[3],T,x6):xn(C[3]),Mv),x&&x.p&&(!u||T&8)&&wn(x,_,C,C[3],u?bn(_,C[3],T,w6):xn(C[3]),Tv)},i(C){u||(N(d,C),N(g,C),N(x,C),u=!0)},o(C){V(d,C),V(g,C),V(x,C),u=!1},d(C){C&&(G(e),G(t),G(n),G(i),G(o)),d&&d.d(C),r[5](null),g&&g.d(C),r[6](null),x&&x.d(C),r[7](null)}}}function S6(r,e,t){let n,i,o;st(r,vg,_=>t(0,n=_)),st(r,bg,_=>t(1,i=_)),st(r,wg,_=>t(2,o=_));let{$$slots:u={},$$scope:s}=e;function d(_){pn[_?"unshift":"push"](()=>{n=_,vg.set(n)})}function p(_){pn[_?"unshift":"push"](()=>{i=_,bg.set(i)})}function g(_){pn[_?"unshift":"push"](()=>{o=_,wg.set(o)})}return r.$$set=_=>{"$$scope"in _&&t(3,s=_.$$scope)},[n,i,o,s,u,d,p,g]}class xo extends Tt{constructor(e){super(),Ct(this,e,S6,k6,wt,{})}}let vg=Pn(null),bg=Pn(null),wg=Pn(null);const C6="/ltn/assets/streets-v2-style-b76f3b8b.json";function T6(r){let e;return{c(){e=Te("Back")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function M6(r){let e,t,n,i;return e=new oh({props:{$$slots:{default:[T6]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=Lt(window,"keydown",r[2]),n=!0)},p(o,[u]){const s={};u&16&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}function E6(r,e,t){let n;st(r,nr,s=>t(1,n=s));let{mode:i}=e;function o(s){s.key=="Escape"&&(s.stopPropagation(),cn(nr,n=i,n))}const u=()=>cn(nr,n=i,n);return r.$$set=s=>{"mode"in s&&t(0,i=s.mode)},[i,n,o,u]}class Ns extends Tt{constructor(e){super(),Ct(this,e,E6,M6,wt,{mode:0})}}let ip=Pn(null);function Lv(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function Iv(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function L6(r){let e,t=r[6].length+"",n,i;return{c(){e=Te("Undo ("),n=Te(t),i=Te(")")},m(o,u){W(o,e,u),W(o,n,u),W(o,i,u)},p(o,u){u[0]&64&&t!==(t=o[6].length+"")&&At(n,t)},d(o){o&&(G(e),G(n),G(i))}}}function I6(r){let e;return{c(){e=Te("Undo")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function P6(r){let e;return{c(){e=U("span"),fe(e,"class","dot svelte-11yzwwb"),Gt(e,"snapped-node",r[40].snapped),Gt(e,"free-node",!r[40].snapped),Gt(e,"hide",r[4])},m(t,n){W(t,e,n)},p(t,n){n[0]&128&&Gt(e,"snapped-node",t[40].snapped),n[0]&128&&Gt(e,"free-node",!t[40].snapped),n[0]&16&&Gt(e,"hide",t[4])},d(t){t&&G(e)}}}function Pv(r){let e,t,n;function i(p){r[23](p,r[40])}function o(){return r[24](r[40])}function u(){return r[25](r[40])}function s(){return r[26](r[40])}let d={draggable:!0,zIndex:0,$$slots:{default:[P6]},$$scope:{ctx:r}};return r[40].point!==void 0&&(d.lngLat=r[40].point),e=new lp({props:d}),pn.push(()=>Dn(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",u),e.$on("dragend",r[16]),e.$on("click",s),{c(){ue(e.$$.fragment)},m(p,g){ae(e,p,g),n=!0},p(p,g){r=p;const _={};g[0]&144|g[1]&4096&&(_.$$scope={dirty:g,ctx:r}),!t&&g[0]&128&&(t=!0,_.lngLat=r[40].point,zn(()=>t=!1)),e.$set(_)},i(p){n||(N(e.$$.fragment,p),n=!0)},o(p){V(e.$$.fragment,p),n=!1},d(p){le(e,p)}}}function z6(r){let e;return{c(){e=U("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,Ye(e,"padding-right","0"),Ye(e,"padding-left","20px"),Ye(e,"margin","0")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function D6(r){let e,t,n,i;return n=new Nw({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[z6]},$$scope:{ctx:r}}}),{c(){e=U("span"),e.textContent=`${r[39]+1}`,t=ie(),ue(n.$$.fragment),fe(e,"class","dot svelte-11yzwwb"),Gt(e,"snapped",r[37].snapped)},m(o,u){W(o,e,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){(!i||u[0]&1)&&Gt(e,"snapped",o[37].snapped);const s={};u[1]&4096&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&(G(e),G(t)),le(n,o)}}}function zv(r){let e,t,n;function i(d){r[27](d,r[37])}function o(){return r[28](r[39])}function u(){return r[29](r[39])}let s={draggable:!0,zIndex:1,$$slots:{default:[D6]},$$scope:{ctx:r}};return r[37].point!==void 0&&(s.lngLat=r[37].point),e=new lp({props:s}),pn.push(()=>Dn(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",u),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){ue(e.$$.fragment)},m(d,p){ae(e,d,p),n=!0},p(d,p){r=d;const g={};p[0]&1|p[1]&4096&&(g.$$scope={dirty:p,ctx:r}),!t&&p[0]&1&&(t=!0,g.lngLat=r[37].point,zn(()=>t=!1)),e.$set(g)},i(d){n||(N(e.$$.fragment,d),n=!0)},o(d){V(e.$$.fragment,d),n=!1},d(d){le(e,d)}}}function R6(r){let e,t,n,i;const o=[yn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let u={};for(let p=0;p<o.length;p+=1)u=It(u,o[p]);e=new cr({props:u});const s=[yn("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let p=0;p<s.length;p+=1)d=It(d,s[p]);return n=new Xi({props:d}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function B6(r){let e,t;const n=[yn("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function F6(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B,K,H;function q(Ue,De){return Ue[6].length==0?I6:L6}let J=q(r),he=J(r);x=new Vg({}),x.$on("click",r[10]),x.$on("mousemove",r[11]);let Ee=On(r[7]),Y=[];for(let Ue=0;Ue<Ee.length;Ue+=1)Y[Ue]=Pv(Iv(r,Ee,Ue));const oe=Ue=>V(Y[Ue],1,1,()=>{Y[Ue]=null});let ke=On(r[0]),ye=[];for(let Ue=0;Ue<ke.length;Ue+=1)ye[Ue]=zv(Lv(r,ke,Ue));const Ne=Ue=>V(ye[Ue],1,1,()=>{ye[Ue]=null});return L=new yr({props:{data:r[1]||Ji(),generateId:!0,$$slots:{default:[R6]},$$scope:{ctx:r}}}),I=new yr({props:{data:r[8],$$slots:{default:[B6]},$$scope:{ctx:r}}}),B=Mg(r[22][0]),{c(){e=U("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=ie(),n=U("div"),i=U("label"),o=U("input"),s=Te(`
    Snap boundary to roads`),d=ie(),p=U("button"),he.c(),_=ie(),ue(x.$$.fragment),C=ie();for(let Ue=0;Ue<Y.length;Ue+=1)Y[Ue].c();T=ie();for(let Ue=0;Ue<ye.length;Ue+=1)ye[Ue].c();z=ie(),ue(L.$$.fragment),E=ie(),ue(I.$$.fragment),o.disabled=u=r[0].length>=3,fe(o,"type","checkbox"),o.__value="snap",Kn(o,o.__value),fe(p,"class","secondary"),p.disabled=g=r[6].length==0,Ye(n,"display","flex"),Ye(n,"gap","16px"),B.p(o)},m(Ue,De){W(Ue,e,De),W(Ue,t,De),W(Ue,n,De),R(n,i),R(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),R(i,s),R(n,d),R(n,p),he.m(p,null),W(Ue,_,De),ae(x,Ue,De),W(Ue,C,De);for(let Le=0;Le<Y.length;Le+=1)Y[Le]&&Y[Le].m(Ue,De);W(Ue,T,De);for(let Le=0;Le<ye.length;Le+=1)ye[Le]&&ye[Le].m(Ue,De);W(Ue,z,De),ae(L,Ue,De),W(Ue,E,De),ae(I,Ue,De),O=!0,K||(H=[Lt(o,"change",r[21]),Lt(p,"click",r[9])],K=!0)},p(Ue,De){if((!O||De[0]&1&&u!==(u=Ue[0].length>=3))&&(o.disabled=u),De[0]&32&&(o.checked=~(Ue[5]||[]).indexOf(o.__value)),J===(J=q(Ue))&&he?he.p(Ue,De):(he.d(1),he=J(Ue),he&&(he.c(),he.m(p,null))),(!O||De[0]&64&&g!==(g=Ue[6].length==0))&&(p.disabled=g),De[0]&114832){Ee=On(Ue[7]);let Ze;for(Ze=0;Ze<Ee.length;Ze+=1){const at=Iv(Ue,Ee,Ze);Y[Ze]?(Y[Ze].p(at,De),N(Y[Ze],1)):(Y[Ze]=Pv(at),Y[Ze].c(),N(Y[Ze],1),Y[Ze].m(T.parentNode,T))}for(Kt(),Ze=Ee.length;Ze<Y.length;Ze+=1)oe(Ze);Jt()}if(De[0]&143373){ke=On(Ue[0]);let Ze;for(Ze=0;Ze<ke.length;Ze+=1){const at=Lv(Ue,ke,Ze);ye[Ze]?(ye[Ze].p(at,De),N(ye[Ze],1)):(ye[Ze]=zv(at),ye[Ze].c(),N(ye[Ze],1),ye[Ze].m(z.parentNode,z))}for(Kt(),Ze=ke.length;Ze<ye.length;Ze+=1)Ne(Ze);Jt()}const Le={};De[0]&2&&(Le.data=Ue[1]||Ji()),De[1]&4096&&(Le.$$scope={dirty:De,ctx:Ue}),L.$set(Le);const lt={};De[0]&256&&(lt.data=Ue[8]),De[1]&4096&&(lt.$$scope={dirty:De,ctx:Ue}),I.$set(lt)},i(Ue){if(!O){N(x.$$.fragment,Ue);for(let De=0;De<Ee.length;De+=1)N(Y[De]);for(let De=0;De<ke.length;De+=1)N(ye[De]);N(L.$$.fragment,Ue),N(I.$$.fragment,Ue),O=!0}},o(Ue){V(x.$$.fragment,Ue),Y=Y.filter(Boolean);for(let De=0;De<Y.length;De+=1)V(Y[De]);ye=ye.filter(Boolean);for(let De=0;De<ye.length;De+=1)V(ye[De]);V(L.$$.fragment,Ue),V(I.$$.fragment,Ue),O=!1},d(Ue){Ue&&(G(e),G(t),G(n),G(_),G(C),G(T),G(z),G(E)),he.d(),le(x,Ue),di(Y,Ue),di(ye,Ue),le(L,Ue),le(I,Ue),B.r(),K=!1,hr(H)}}}function O6(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function $6(r,e,t){let n,i;st(r,ip,Je=>t(20,i=Je));let{map:o}=e,{waypoints:u}=e,{drawnShapeOut:s=void 0}=e;ei(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let d="snap",p=[],g=[],_=null,x=!1,C=!1,T=!1;function z(Je){let xt=Je.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=xt}function L(){let Je=p.pop();t(6,p),Je&&t(0,u=Je)}function E(){p.length==100&&p.shift(),t(6,p=[...p,JSON.parse(JSON.stringify(u))])}function I(Je){u.length>=3||(E(),u.push({point:Je.detail.lngLat.toArray(),snapped:d=="snap"}),t(0,u))}function O(Je){t(19,_={point:Je.detail.lngLat.toArray(),snapped:d=="snap"})}function B(Je){E(),t(0,u[Je].snapped=!u[Je].snapped,u),t(0,u)}function K(Je){E(),u.splice(Je,1),t(0,u),t(2,x=!1)}function H(Je,xt,Mt,Ot){if(Ot||xt.length>=3)return Ji();try{if(Je&&xt.length>0&&Mt)return JSON.parse(Je.inner.calculateRoute([xt[xt.length-1],Mt]))}catch{}return Ji()}function q(Je,xt,Mt){if(Mt)return;if(!Je||xt.length<3){t(7,g=[]);return}let Ot=[],Yt=1,nn=JSON.parse(JSON.stringify(xt));nn.push(nn[0]);for(let Qt=0;Qt<nn.length-1;Qt++){let fn=JSON.parse(Je.inner.getExtraNodes(nn[Qt],nn[Qt+1]));for(let[mn,qe,Ge]of fn)Ot.push({point:[mn,qe],snapped:Ge,insertIdx:Yt});Yt++}t(7,g=Ot)}function J(Je){E(),u.splice(Je.insertIdx,0,{point:Je.point,snapped:Je.snapped}),t(0,u),t(4,T=!0)}function he(Je){t(0,u[Je.insertIdx].point=Je.point,u),t(0,u)}function Ee(){t(4,T=!1)}function Y(){E(),t(3,C=!0)}const oe=[[]];function ke(){d=QA(oe[0],this.__value,this.checked),t(5,d)}function ye(Je,xt){r.$$.not_equal(xt.point,Je)&&(xt.point=Je,t(7,g))}const Ne=Je=>J(Je),Ue=Je=>he(Je),De=Je=>{J(Je),t(4,T=!1)};function Le(Je,xt){r.$$.not_equal(xt.point,Je)&&(xt.point=Je,t(0,u))}const lt=Je=>B(Je),Ze=Je=>K(Je),at=()=>t(2,x=!0),dt=()=>t(2,x=!1),pt=()=>t(3,C=!1);return r.$$set=Je=>{"map"in Je&&t(18,o=Je.map),"waypoints"in Je&&t(0,u=Je.waypoints),"drawnShapeOut"in Je&&t(1,s=Je.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,s=O6(i,u))}catch(Je){console.log("error drawing shape",Je),t(1,s=void 0)}r.$$.dirty[0]&1048593&&q(i,u,T),r.$$.dirty[0]&1572877&&t(8,n=H(i,u,_,x||C)),r.$$.dirty[0]&1&&z(u)},[u,s,x,C,T,d,p,g,n,L,I,O,B,K,J,he,Ee,Y,o,_,i,ke,oe,ye,Ne,Ue,De,Le,lt,Ze,at,dt,pt]}class U2 extends Tt{constructor(e){super(),Ct(this,e,$6,F6,wt,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function Dv(r,e,t){const n=r.slice();return n[4]=e[t],n[6]=t,n}function Rv(r){let e,t,n,i,o,u,s;return o=new I3({props:{strokeWidth:"4px",size:"14px"}}),{c(){e=U("div"),t=U("div"),n=ie(),i=U("div"),ue(o.$$.fragment),u=ie(),fe(t,"class","bucket-color svelte-lqjxv2"),Ye(t,"background",r[4]),fe(i,"class","bucket-indicator svelte-lqjxv2"),fe(e,"class","bucket svelte-lqjxv2"),Gt(e,"selected",r[6]==r[1])},m(d,p){W(d,e,p),R(e,t),R(e,n),R(e,i),ae(o,i,null),R(e,u),s=!0},p(d,p){p&1&&Ye(t,"background",d[4]),(!s||p&2)&&Gt(e,"selected",d[6]==d[1])},i(d){s||(N(o.$$.fragment,d),s=!0)},o(d){V(o.$$.fragment,d),s=!1},d(d){d&&G(e),le(o)}}}function N6(r){let e,t,n=On(r[0]),i=[];for(let u=0;u<n.length;u+=1)i[u]=Rv(Dv(r,n,u));const o=u=>V(i[u],1,1,()=>{i[u]=null});return{c(){e=U("div");for(let u=0;u<i.length;u+=1)i[u].c();fe(e,"class","colors svelte-lqjxv2")},m(u,s){W(u,e,s);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(e,null);t=!0},p(u,[s]){if(s&3){n=On(u[0]);let d;for(d=0;d<n.length;d+=1){const p=Dv(u,n,d);i[d]?(i[d].p(p,s),N(i[d],1)):(i[d]=Rv(p),i[d].c(),N(i[d],1),i[d].m(e,null))}for(Kt(),d=n.length;d<i.length;d+=1)o(d);Jt()}},i(u){if(!t){for(let s=0;s<n.length;s+=1)N(i[s]);t=!0}},o(u){i=i.filter(Boolean);for(let s=0;s<i.length;s+=1)V(i[s]);t=!1},d(u){u&&G(e),di(i,u)}}}function j6(r,e){let t=0;for(let n of r.slice(1,-1)){if(e<n)break;t++}return t}function U6(r,e,t){let n,{colorScale:i}=e,{limits:o}=e,{value:u}=e;return r.$$set=s=>{"colorScale"in s&&t(0,i=s.colorScale),"limits"in s&&t(2,o=s.limits),"value"in s&&t(3,u=s.value)},r.$$.update=()=>{r.$$.dirty&12&&t(1,n=j6(o,u))},[i,n,o,u]}class ju extends Tt{constructor(e){super(),Ct(this,e,U6,N6,wt,{colorScale:0,limits:2,value:3})}}function Bv(r){let e,t,n,i,o,u,s,d=1+Math.floor(r[0].properties.simd/20)+"",p,g,_,x,C,T,z,L,E=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",I,O,B,K,H,q,J,he,Ee,Y=sc(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",oe,ke,ye,Ne,Ue,De,Le,lt,Ze,at=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",dt,pt,Je,xt,Mt,Ot,Yt,nn,Qt,fn=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",mn,qe,Ge,gt,et,de,en,Xe,it,Ut=r[0].properties.combined_score+"",Hn,jn,Nn;return i=new ju({props:{colorScale:ah.toReversed(),limits:lh,value:100-r[0].properties.simd}}),T=new ju({props:{colorScale:oc,limits:r[2].population_density,value:r[0].properties.population/r[0].properties.area_km2}}),J=new ju({props:{colorScale:ch.toReversed(),limits:uh,value:100*(1-r[0].properties.households_with_cars_or_vans/r[0].properties.total_households)}}),Le=new ju({props:{colorScale:n_,limits:r[2].poi_density,value:r[0].properties.number_pois/r[0].properties.area_km2}}),Yt=new ju({props:{colorScale:t_,limits:r[2].collision_density,value:r[0].properties.number_stats19_collisions/r[0].properties.area_km2}}),en=new ju({props:{colorScale:i_,limits:r_,value:r[0].properties.combined_score}}),{c(){e=U("tr"),t=U("th"),n=Te(`SIMD
        `),ue(i.$$.fragment),o=ie(),u=U("td"),s=Te("quintile "),p=Te(d),g=ie(),_=U("tr"),x=U("th"),C=Te(`Population density
        `),ue(T.$$.fragment),z=ie(),L=U("td"),I=Te(E),O=Te(" people / kmÂ²"),B=ie(),K=U("tr"),H=U("th"),q=Te(`Car ownership
        `),ue(J.$$.fragment),he=ie(),Ee=U("td"),oe=Te(Y),ke=Te(" of households"),ye=ie(),Ne=U("tr"),Ue=U("th"),De=Te(`POI density
        `),ue(Le.$$.fragment),lt=ie(),Ze=U("td"),dt=Te(at),pt=Te(" / kmÂ²"),Je=ie(),xt=U("tr"),Mt=U("th"),Ot=Te(`Collision density
        `),ue(Yt.$$.fragment),nn=ie(),Qt=U("td"),mn=Te(fn),qe=Te(" / kmÂ²"),Ge=ie(),gt=U("tr"),et=U("th"),de=Te(`Overall prioritisation score
        `),ue(en.$$.fragment),Xe=ie(),it=U("td"),Hn=Te(Ut),jn=Te(" / 5")},m(Wt,An){W(Wt,e,An),R(e,t),R(t,n),ae(i,t,null),R(e,o),R(e,u),R(u,s),R(u,p),W(Wt,g,An),W(Wt,_,An),R(_,x),R(x,C),ae(T,x,null),R(_,z),R(_,L),R(L,I),R(L,O),W(Wt,B,An),W(Wt,K,An),R(K,H),R(H,q),ae(J,H,null),R(K,he),R(K,Ee),R(Ee,oe),R(Ee,ke),W(Wt,ye,An),W(Wt,Ne,An),R(Ne,Ue),R(Ue,De),ae(Le,Ue,null),R(Ne,lt),R(Ne,Ze),R(Ze,dt),R(Ze,pt),W(Wt,Je,An),W(Wt,xt,An),R(xt,Mt),R(Mt,Ot),ae(Yt,Mt,null),R(xt,nn),R(xt,Qt),R(Qt,mn),R(Qt,qe),W(Wt,Ge,An),W(Wt,gt,An),R(gt,et),R(et,de),ae(en,et,null),R(gt,Xe),R(gt,it),R(it,Hn),R(it,jn),Nn=!0},p(Wt,An){const ti={};An&1&&(ti.value=100-Wt[0].properties.simd),i.$set(ti),(!Nn||An&1)&&d!==(d=1+Math.floor(Wt[0].properties.simd/20)+"")&&At(p,d);const Bn={};An&4&&(Bn.limits=Wt[2].population_density),An&1&&(Bn.value=Wt[0].properties.population/Wt[0].properties.area_km2),T.$set(Bn),(!Nn||An&1)&&E!==(E=Math.round(Wt[0].properties.population/Wt[0].properties.area_km2).toLocaleString()+"")&&At(I,E);const yt={};An&1&&(yt.value=100*(1-Wt[0].properties.households_with_cars_or_vans/Wt[0].properties.total_households)),J.$set(yt),(!Nn||An&1)&&Y!==(Y=sc(Wt[0].properties.households_with_cars_or_vans,Wt[0].properties.total_households)+"")&&At(oe,Y);const mr={};An&4&&(mr.limits=Wt[2].poi_density),An&1&&(mr.value=Wt[0].properties.number_pois/Wt[0].properties.area_km2),Le.$set(mr),(!Nn||An&1)&&at!==(at=(Wt[0].properties.number_pois/Wt[0].properties.area_km2).toFixed(1)+"")&&At(dt,at);const or={};An&4&&(or.limits=Wt[2].collision_density),An&1&&(or.value=Wt[0].properties.number_stats19_collisions/Wt[0].properties.area_km2),Yt.$set(or),(!Nn||An&1)&&fn!==(fn=(Wt[0].properties.number_stats19_collisions/Wt[0].properties.area_km2).toFixed(1)+"")&&At(mn,fn);const gi={};An&1&&(gi.value=Wt[0].properties.combined_score),en.$set(gi),(!Nn||An&1)&&Ut!==(Ut=Wt[0].properties.combined_score+"")&&At(Hn,Ut)},i(Wt){Nn||(N(i.$$.fragment,Wt),N(T.$$.fragment,Wt),N(J.$$.fragment,Wt),N(Le.$$.fragment,Wt),N(Yt.$$.fragment,Wt),N(en.$$.fragment,Wt),Nn=!0)},o(Wt){V(i.$$.fragment,Wt),V(T.$$.fragment,Wt),V(J.$$.fragment,Wt),V(Le.$$.fragment,Wt),V(Yt.$$.fragment,Wt),V(en.$$.fragment,Wt),Nn=!1},d(Wt){Wt&&(G(e),G(g),G(_),G(B),G(K),G(ye),G(Ne),G(Je),G(xt),G(Ge),G(gt)),le(i),le(T),le(J),le(Le),le(Yt),le(en)}}}function V6(r){let e,t,n,i,o,u=r[0].properties.area_km2.toFixed(1)+"",s,d,p,g,_=r[1]=="cnt"&&Bv(r);return{c(){e=U("table"),t=U("tr"),n=U("th"),n.textContent="Area",i=ie(),o=U("td"),s=Te(u),d=Te(" kmÂ²"),p=ie(),_&&_.c(),fe(e,"class","svelte-1kpsyee")},m(x,C){W(x,e,C),R(e,t),R(t,n),R(t,i),R(t,o),R(o,s),R(o,d),R(e,p),_&&_.m(e,null),g=!0},p(x,[C]){(!g||C&1)&&u!==(u=x[0].properties.area_km2.toFixed(1)+"")&&At(s,u),x[1]=="cnt"?_?(_.p(x,C),C&2&&N(_,1)):(_=Bv(x),_.c(),N(_,1),_.m(e,null)):_&&(Kt(),V(_,1,1,()=>{_=null}),Jt())},i(x){g||(N(_),g=!0)},o(x){V(_),g=!1},d(x){x&&G(e),_&&_.d()}}}function q6(r,e,t){let n,i;st(r,bs,u=>t(1,n=u)),st(r,lc,u=>t(2,i=u));let{neighbourhoodBoundary:o}=e;return r.$$set=u=>{"neighbourhoodBoundary"in u&&t(0,o=u.neighbourhoodBoundary)},[o,n,i]}class V2 extends Tt{constructor(e){super(),Ct(this,e,q6,V6,wt,{neighbourhoodBoundary:0})}}function q2(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function H6(r){let e,t,n,i,o,u,s,d;return e=new wo({props:{colorScale:i_,labels:{buckets:r_}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML="<span>Least important</span> <span>Most important</span>",i=ie(),o=U("br"),u=ie(),s=U("p"),s.textContent="This score averages the other five metrics, on the 1-5 scale.",fe(n,"class","sub-labels svelte-3xhwrh")},m(p,g){ae(e,p,g),W(p,t,g),W(p,n,g),W(p,i,g),W(p,o,g),W(p,u,g),W(p,s,g),d=!0},p:ft,i(p){d||(N(e.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),d=!1},d(p){p&&(G(t),G(n),G(i),G(o),G(u),G(s)),le(e,p)}}}function G6(r){let e,t,n,i;return e=new wo({props:{colorScale:n_,labels:{limits:r[1].poi_density}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.textContent="POIs / kmÂ²",Ye(n,"text-align","center")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const s={};u&2&&(s.labels={limits:o[1].poi_density}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function W6(r){let e,t,n,i;return e=new wo({props:{colorScale:t_,labels:{limits:r[1].collision_density}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.textContent="collisions / kmÂ²",Ye(n,"text-align","center")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const s={};u&2&&(s.labels={limits:o[1].collision_density}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function Z6(r){let e,t,n,i;return e=new wo({props:{colorScale:ah.toReversed(),labels:{buckets:b2(lh).toReversed()}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML="<span>Less deprived</span> <span>More deprived</span>",fe(n,"class","sub-labels svelte-3xhwrh")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:ft,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function X6(r){let e,t,n,i;return e=new wo({props:{colorScale:ch.toReversed(),labels:{limits:uh.toReversed().map(Y6)}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ye(n,"display","flex"),Ye(n,"justify-content","space-between")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:ft,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function K6(r){let e,t,n,i;return e=new wo({props:{colorScale:oc,labels:{limits:r[1].population_density}}}),{c(){ue(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML="<span>Less dense</span> <span>people / kmÂ²</span> <span>More dense</span>",fe(n,"class","sub-labels svelte-3xhwrh")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const s={};u&2&&(s.labels={limits:o[1].population_density}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(G(t),G(n)),le(e,o)}}}function J6(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I;const O=[K6,X6,Z6,W6,G6,H6],B=[];function K(H,q){return H[0]=="population_density"?0:H[0]=="car_ownership"?1:H[0]=="simd"?2:H[0]=="stats19"?3:H[0]=="pois"?4:H[0]=="combined"?5:-1}return~(C=K(r))&&(T=B[C]=O[C](r)),{c(){e=U("div"),t=U("label"),t.textContent="Metric",n=ie(),i=U("select"),o=U("option"),o.textContent="None",u=U("option"),u.textContent="SIMD",s=U("option"),s.textContent="Population density",d=U("option"),d.textContent="Car ownership",p=U("option"),p.textContent="Points of interest",g=U("option"),g.textContent="Collisions",_=U("option"),_.textContent="Overall prioritisation score",x=ie(),T&&T.c(),z=rr(),Ye(t,"margin","0"),Ye(t,"padding","0"),fe(t,"for","prioritization-selection"),o.__value="none",Kn(o,o.__value),u.__value="simd",Kn(u,u.__value),s.__value="population_density",Kn(s,s.__value),d.__value="car_ownership",Kn(d,d.__value),p.__value="pois",Kn(p,p.__value),g.__value="stats19",Kn(g,g.__value),_.__value="combined",Kn(_,_.__value),fe(i,"id","prioritization-selection"),r[0]===void 0&&ms(()=>r[2].call(i)),Ye(e,"display","flex"),Ye(e,"gap","16px"),Ye(e,"align-items","center"),Ye(e,"width","fit-content")},m(H,q){W(H,e,q),R(e,t),R(e,n),R(e,i),R(i,o),R(i,u),R(i,s),R(i,d),R(i,p),R(i,g),R(i,_),Wi(i,r[0],!0),W(H,x,q),~C&&B[C].m(H,q),W(H,z,q),L=!0,E||(I=Lt(i,"change",r[2]),E=!0)},p(H,[q]){q&1&&Wi(i,H[0]);let J=C;C=K(H),C===J?~C&&B[C].p(H,q):(T&&(Kt(),V(B[J],1,1,()=>{B[J]=null}),Jt()),~C?(T=B[C],T?T.p(H,q):(T=B[C]=O[C](H),T.c()),N(T,1),T.m(z.parentNode,z)):T=null)},i(H){L||(N(T),L=!0)},o(H){V(T),L=!1},d(H){H&&(G(e),G(x),G(z)),~C&&B[C].d(H),E=!1,I()}}}const Y6=r=>`${r}%`;function Q6(r,e,t){let n,i;st(r,bs,d=>t(3,n=d)),st(r,lc,d=>t(1,i=d));let{selectedPrioritization:o}=e;function u(){let d=new URL(window.location.href).searchParams.get("prioritisationMetric");d=="population_density"?t(0,o="population_density"):d=="simd"?t(0,o="simd"):d=="stats19"?t(0,o="stats19"):d=="pois"?t(0,o="pois"):d=="car_ownership"?t(0,o="car_ownership"):d=="combined"&&t(0,o="combined")}n=="cnt"?u():o="none";function s(){o=za(this),t(0,o)}return r.$$set=d=>{"selectedPrioritization"in d&&t(0,o=d.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const d=new URL(window.location.href);o=="none"?d.searchParams.delete("prioritisationMetric"):d.searchParams.set("prioritisationMetric",o),history.replaceState({},"",d)}},[o,i,s]}class H2 extends Tt{constructor(e){super(),Ct(this,e,Q6,J6,wt,{selectedPrioritization:0})}}function G2(r,e,t){return{none:r.none,area:Di(["get","area_km2"],XT,KT),car_ownership:Di(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],uh,ch),population_density:Di(["/",["get","population"],["get","area_km2"]],t.population_density,oc),pois:Di(["/",["get","number_pois"],["get","area_km2"]],t.poi_density,n_),simd:Di(["get","simd"],lh,ah),stats19:Di(["/",["get","number_stats19_collisions"],["get","area_km2"]],t.collision_density,t_),combined:Di(["get","combined_score"],r_,i_)}[e]}function e8(r){let e,t,n,i,o,u,s,d,p,g,_=vr(r[8].mode)+"",x,C;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),g=U("li"),x=Te(_),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(T,z){W(T,e,z),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),R(n,g),R(g,x),C=!0},p(T,z){(!C||z[0]&256)&&_!==(_=vr(T[8].mode)+"")&&At(x,_)},i(T){C||(N(o.$$.fragment,T),N(d.$$.fragment,T),C=!0)},o(T){V(o.$$.fragment,T),V(d.$$.fragment,T),C=!1},d(T){T&&G(e),le(o),le(d)}}}function Fv(r){let e,t,n,i,o,u,s;function d(g){r[20](g)}let p={};return r[4]!==void 0&&(p.selectedPrioritization=r[4]),o=new H2({props:p}),pn.push(()=>Dn(o,"selectedPrioritization",d)),{c(){e=U("h3"),e.textContent="Prioritisation",t=ie(),n=U("p"),n.textContent=`Compare the prioritisation or individual metrics across candidate
        neighbourhoods.`,i=ie(),ue(o.$$.fragment)},m(g,_){W(g,e,_),W(g,t,_),W(g,n,_),W(g,i,_),ae(o,g,_),s=!0},p(g,_){const x={};!u&&_[0]&16&&(u=!0,x.selectedPrioritization=g[4],zn(()=>u=!1)),o.$set(x)},i(g){s||(N(o.$$.fragment,g),s=!0)},o(g){V(o.$$.fragment,g),s=!1},d(g){g&&(G(e),G(t),G(n),G(i)),le(o,g)}}}function Ov(r){let e;return{c(){e=U("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function t8(r){let e,t,n,i,o,u,s,d;function p(x){r[23](x)}function g(x){r[24](x)}let _={map:_r(r[10])};return r[6]!==void 0&&(_.waypoints=r[6]),r[1]!==void 0&&(_.drawnShapeOut=r[1]),n=new U2({props:_}),pn.push(()=>Dn(n,"waypoints",p)),pn.push(()=>Dn(n,"drawnShapeOut",g)),{c(){e=U("div"),e.innerHTML='<h3 class="svelte-iaefgo">1. Draw your neighbourhood</h3>',t=ie(),ue(n.$$.fragment),u=ie(),s=U("div"),s.innerHTML=`<h3 class="svelte-iaefgo">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,fe(e,"class","step svelte-iaefgo"),Gt(e,"active",!r[7]),Gt(e,"complete",r[7]),fe(s,"class","step svelte-iaefgo"),Ye(s,"margin-top","16px"),Gt(s,"active",r[7]),Gt(s,"complete",r[5].size>1)},m(x,C){W(x,e,C),W(x,t,C),ae(n,x,C),W(x,u,C),W(x,s,C),d=!0},p(x,C){(!d||C[0]&128)&&Gt(e,"active",!x[7]),(!d||C[0]&128)&&Gt(e,"complete",x[7]);const T={};C[0]&1024&&(T.map=_r(x[10])),!i&&C[0]&64&&(i=!0,T.waypoints=x[6],zn(()=>i=!1)),!o&&C[0]&2&&(o=!0,T.drawnShapeOut=x[1],zn(()=>o=!1)),n.$set(T),(!d||C[0]&128)&&Gt(s,"active",x[7]),(!d||C[0]&32)&&Gt(s,"complete",x[5].size>1)},i(x){d||(N(n.$$.fragment,x),d=!0)},o(x){V(n.$$.fragment,x),d=!1},d(x){x&&(G(e),G(t),G(u),G(s)),le(n,x)}}}function n8(r){let e,t,n;return{c(){e=U("div"),e.innerHTML=`<h3 class="svelte-iaefgo">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=ie(),n=U("div"),n.innerHTML='<h3 class="svelte-iaefgo">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',fe(e,"class","step svelte-iaefgo"),Gt(e,"active",!r[7]),Gt(e,"complete",r[7]),fe(n,"class","step svelte-iaefgo"),Gt(n,"active",r[7]),Gt(n,"complete",r[5].size>1)},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o[0]&128&&Gt(e,"active",!i[7]),o[0]&128&&Gt(e,"complete",i[7]),o[0]&128&&Gt(n,"active",i[7]),o[0]&32&&Gt(n,"complete",i[5].size>1)},i:ft,o:ft,d(i){i&&(G(e),G(t),G(n))}}}function r8(r){let e;function t(o,u){if(o[0]=="choose-area")return s8;if(o[0]=="draw-area")return o8}let n=t(r),i=n&&n(r);return{c(){e=U("span"),i&&i.c(),Ye(e,"text-align","center")},m(o,u){W(o,e,u),i&&i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:ft,o:ft,d(o){o&&G(e),i&&i.d()}}}function i8(r){let e,t;return e=new V2({props:{neighbourhoodBoundary:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function o8(r){let e;function t(o,u){return o[6].length<3?l8:a8}let n=t(r),i=n(r);return{c(){i.c(),e=rr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i.d(o)}}}function s8(r){let e;return{c(){e=Te("Empty so far. Click a colored area to get started.")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function a8(r){let e;return{c(){e=Te(`Not a valid shape yet â try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function l8(r){let e;return{c(){e=Te(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function u8(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J,he,Ee,Y,oe,ke,ye,Ne,Ue,De,Le,lt,Ze,at,dt,pt,Je,xt,Mt,Ot,Yt;t=new Ns({props:{mode:{mode:"pick-neighbourhood"}}});let nn=r[9]=="cnt"&&Fv(r),Qt=r[4]=="none"&&Ov();_=new Iw({}),z=new $g({});const fn=[n8,t8],mn=[];function qe(de,en){return de[0]=="choose-area"?0:de[0]=="draw-area"?1:-1}~(I=qe(r))&&(O=mn[I]=fn[I](r)),ke=new Ng({});const Ge=[i8,r8],gt=[];function et(de,en){return de[7]?0:1}return Ze=et(r),at=gt[Ze]=Ge[Ze](r),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),nn&&nn.c(),i=ie(),Qt&&Qt.c(),o=ie(),u=U("hr"),s=ie(),d=U("div"),p=U("div"),g=U("button"),ue(_.$$.fragment),x=Te(`
          Choose area`),C=Te(`
        or
        `),T=U("button"),ue(z.$$.fragment),L=Te(`
          Draw area`),E=ie(),O&&O.c(),B=ie(),K=U("div"),K.innerHTML='<h3 class="svelte-iaefgo">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',H=ie(),q=U("div"),J=U("button"),he=Te("Create neighborhood"),Y=ie(),oe=U("button"),ue(ke.$$.fragment),ye=Te(" Start over"),Ue=ie(),De=U("h3"),De.textContent="Your neighbourhood overall",Le=ie(),lt=U("div"),at.c(),dt=ie(),pt=U("hr"),Je=ie(),xt=U("button"),xt.textContent="Export metrics to GeoJSON",Gt(g,"active",r[0]=="choose-area"),Gt(T,"active",r[0]=="draw-area"),fe(p,"class","tool-palette svelte-iaefgo"),Ye(p,"display","flex"),Ye(p,"align-items","center"),Ye(p,"gap","16px"),fe(K,"class","step svelte-iaefgo"),Gt(K,"active",r[7]),J.disabled=Ee=!r[7],fe(oe,"class","destructive"),Ye(oe,"display","flex"),Ye(oe,"gap","8px"),Ye(oe,"align-items","center"),oe.disabled=Ne=!(r[7]||r[0]=="draw-area"&&r[6].length>0),Ye(q,"display","flex"),Ye(q,"gap","16px"),Ye(q,"justify-content","space-between"),Ye(q,"margin-bottom","16px"),fe(lt,"class","neighbourhood-boundary-summary svelte-iaefgo"),fe(xt,"class","secondary"),fe(e,"slot","sidebar")},m(de,en){W(de,e,en),ae(t,e,null),R(e,n),nn&&nn.m(e,null),R(e,i),Qt&&Qt.m(e,null),R(e,o),R(e,u),R(e,s),R(e,d),R(d,p),R(p,g),ae(_,g,null),R(g,x),R(p,C),R(p,T),ae(z,T,null),R(T,L),R(d,E),~I&&mn[I].m(d,null),R(d,B),R(d,K),R(d,H),R(d,q),R(q,J),R(J,he),R(q,Y),R(q,oe),ae(ke,oe,null),R(oe,ye),R(d,Ue),R(d,De),R(d,Le),R(d,lt),gt[Ze].m(lt,null),R(e,dt),R(e,pt),R(e,Je),R(e,xt),Mt=!0,Ot||(Yt=[Lt(g,"click",r[21]),Lt(T,"click",r[22]),Lt(J,"click",r[25]),Lt(oe,"click",r[16]),Lt(xt,"click",r[13])],Ot=!0)},p(de,en){de[9]=="cnt"?nn?(nn.p(de,en),en[0]&512&&N(nn,1)):(nn=Fv(de),nn.c(),N(nn,1),nn.m(e,i)):nn&&(Kt(),V(nn,1,1,()=>{nn=null}),Jt()),de[4]=="none"?Qt||(Qt=Ov(),Qt.c(),Qt.m(e,o)):Qt&&(Qt.d(1),Qt=null),(!Mt||en[0]&1)&&Gt(g,"active",de[0]=="choose-area"),(!Mt||en[0]&1)&&Gt(T,"active",de[0]=="draw-area");let Xe=I;I=qe(de),I===Xe?~I&&mn[I].p(de,en):(O&&(Kt(),V(mn[Xe],1,1,()=>{mn[Xe]=null}),Jt()),~I?(O=mn[I],O?O.p(de,en):(O=mn[I]=fn[I](de),O.c()),N(O,1),O.m(d,B)):O=null),(!Mt||en[0]&128)&&Gt(K,"active",de[7]),(!Mt||en[0]&128&&Ee!==(Ee=!de[7]))&&(J.disabled=Ee),(!Mt||en[0]&193&&Ne!==(Ne=!(de[7]||de[0]=="draw-area"&&de[6].length>0)))&&(oe.disabled=Ne);let it=Ze;Ze=et(de),Ze===it?gt[Ze].p(de,en):(Kt(),V(gt[it],1,1,()=>{gt[it]=null}),Jt(),at=gt[Ze],at?at.p(de,en):(at=gt[Ze]=Ge[Ze](de),at.c()),N(at,1),at.m(lt,null))},i(de){Mt||(N(t.$$.fragment,de),N(nn),N(_.$$.fragment,de),N(z.$$.fragment,de),N(O),N(ke.$$.fragment,de),N(at),Mt=!0)},o(de){V(t.$$.fragment,de),V(nn),V(_.$$.fragment,de),V(z.$$.fragment,de),V(O),V(ke.$$.fragment,de),V(at),Mt=!1},d(de){de&&G(e),le(t),nn&&nn.d(),Qt&&Qt.d(),le(_),le(z),~I&&mn[I].d(),le(ke),gt[Ze].d(),Ot=!1,hr(Yt)}}}function $v(r){let e,t;return e=new yr({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[c8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function c8(r){let e,t,n,i;const o=[yn("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let u={};for(let p=0;p<o.length;p+=1)u=It(u,o[p]);e=new cr({props:u});const s=[yn("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8}}];let d={};for(let p=0;p<s.length;p+=1)d=It(d,s[p]);return n=new cr({props:d}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function Nv(r){let e,t;return e=new yr({props:{data:r[3],generateId:!0,$$slots:{default:[v8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&8&&(o.data=n[3]),i[0]&16|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function jv(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[_8,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1073741840|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function f8(r){let e,t,n,i,o=r[30].combined_score+"",u;return{c(){e=U("b"),e.textContent="Combined score",t=ie(),n=U("br"),i=ie(),u=Te(o)},m(s,d){W(s,e,d),W(s,t,d),W(s,n,d),W(s,i,d),W(s,u,d)},p(s,d){d[0]&1073741824&&o!==(o=s[30].combined_score+"")&&At(u,o)},d(s){s&&(G(e),G(t),G(n),G(i),G(u))}}}function h8(r){let e,t,n,i,o=(r[30].number_pois/r[30].area_km2).toFixed(1)+"",u,s;return{c(){e=U("b"),e.textContent="Points of interest",t=ie(),n=U("br"),i=ie(),u=Te(o),s=Te(" / kmÂ²")},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,u,p),W(d,s,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_pois/d[30].area_km2).toFixed(1)+"")&&At(u,o)},d(d){d&&(G(e),G(t),G(n),G(i),G(u),G(s))}}}function d8(r){let e,t,n,i,o=(r[30].number_stats19_collisions/r[30].area_km2).toFixed(1)+"",u,s;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions",t=ie(),n=U("br"),i=ie(),u=Te(o),s=Te(` /
                kmÂ²`)},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,u,p),W(d,s,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_stats19_collisions/d[30].area_km2).toFixed(1)+"")&&At(u,o)},d(d){d&&(G(e),G(t),G(n),G(i),G(u),G(s))}}}function p8(r){let e,t,n,i,o=Math.round(r[30].population/r[30].area_km2).toLocaleString()+"",u,s;return{c(){e=U("b"),e.textContent="Population density",t=ie(),n=U("br"),i=ie(),u=Te(o),s=Te(`
                people / kmÂ²`)},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,u,p),W(d,s,p)},p(d,p){p[0]&1073741824&&o!==(o=Math.round(d[30].population/d[30].area_km2).toLocaleString()+"")&&At(u,o)},d(d){d&&(G(e),G(t),G(n),G(i),G(u),G(s))}}}function m8(r){let e,t,n,i,o=sc(r[30].households_with_cars_or_vans,r[30].total_households)+"",u,s,d=r[30].total_households.toLocaleString()+"",p,g;return{c(){e=U("b"),e.textContent="Car or van ownership",t=ie(),n=U("br"),i=ie(),u=Te(o),s=Te(" of approximately "),p=Te(d),g=Te(`
                households have at least one car or van.`)},m(_,x){W(_,e,x),W(_,t,x),W(_,n,x),W(_,i,x),W(_,u,x),W(_,s,x),W(_,p,x),W(_,g,x)},p(_,x){x[0]&1073741824&&o!==(o=sc(_[30].households_with_cars_or_vans,_[30].total_households)+"")&&At(u,o),x[0]&1073741824&&d!==(d=_[30].total_households.toLocaleString()+"")&&At(p,d)},d(_){_&&(G(e),G(t),G(n),G(i),G(u),G(s),G(p),G(g))}}}function g8(r){let e,t,n=r[30].area_km2.toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Area:",t=ie(),i=Te(n),o=Te(" kmÂ²")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&1073741824&&n!==(n=u[30].area_km2.toFixed(1)+"")&&At(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function _8(r){let e;function t(o,u){if(o[4]=="none")return g8;if(o[4]=="car_ownership")return m8;if(o[4]=="population_density")return p8;if(o[4]=="stats19")return d8;if(o[4]=="pois")return h8;if(o[4]=="combined")return f8}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=rr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i&&i.d(o)}}}function y8(r){let e,t,n=r[4]!="simd"&&jv(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o[0]&16&&N(n,1)):(n=jv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function v8(r){let e,t,n,i;const o=[yn("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[y8]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=It(u,o[p]);e=new Xi({props:u}),e.$on("click",r[11]);const s=[yn("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let d={};for(let p=0;p<s.length;p+=1)d=It(d,s[p]);return n=new cr({props:d}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _=g[0]&49168?Mn(o,[o[0],{paint:{"fill-color":p[14](p[4]),"fill-opacity":p[15](p[4])}},o[2],o[3]]):{};g[0]&16|g[1]&1&&(_.$$scope={dirty:g,ctx:p}),e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function b8(r){let e,t,n,i=r[7]&&$v(r),o=r[0]=="choose-area"&&Nv(r);return{c(){e=U("div"),i&&i.c(),t=ie(),o&&o.c(),fe(e,"slot","map")},m(u,s){W(u,e,s),i&&i.m(e,null),R(e,t),o&&o.m(e,null),n=!0},p(u,s){u[7]?i?(i.p(u,s),s[0]&128&&N(i,1)):(i=$v(u),i.c(),N(i,1),i.m(e,t)):i&&(Kt(),V(i,1,1,()=>{i=null}),Jt()),u[0]=="choose-area"?o?(o.p(u,s),s[0]&1&&N(o,1)):(o=Nv(u),o.c(),N(o,1),o.m(e,null)):o&&(Kt(),V(o,1,1,()=>{o=null}),Jt())},i(u){n||(N(i),N(o),n=!0)},o(u){V(i),V(o),n=!1},d(u){u&&G(e),i&&i.d(),o&&o.d()}}}function w8(r){let e,t,n,i;return e=new sh({props:{loading:r[2]}}),n=new xo({props:{$$slots:{map:[b8],sidebar:[u8],top:[e8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u[0]&4&&(s.loading=o[2]),e.$set(s);const d={};u[0]&2043|u[1]&1&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function x8(r,e,t){let n,i,o,u,s,d,p,g;st(r,lc,De=>t(26,n=De)),st(r,nr,De=>t(8,i=De)),st(r,Ia,De=>t(27,o=De)),st(r,kr,De=>t(19,u=De)),st(r,Fs,De=>t(28,s=De)),st(r,Va,De=>t(29,d=De)),st(r,bs,De=>t(9,p=De)),st(r,is,De=>t(10,g=De));let _="Generating severance boundaries...",x=Ji(),C="choose-area",T=p=="cnt"?"combined":"none",z=null,L=new Map,E=[],I,O=null,B=null;ws(async()=>{await new Promise(De=>{requestAnimationFrame(()=>{requestAnimationFrame(De)})}),t(3,x=u.generatedBoundaries()),t(2,_="")});function K(De){let Le=De.detail.features[0].id,lt=x.features[Le],Ze=new Map(L);if(Ze.has(Le)?Ze.delete(Le):Ze.set(Le,lt),Ze.size===0)t(17,z=null),t(5,L=Ze);else if(Ze.size===1)t(17,z=Ze.values().next().value),t(5,L=Ze);else{let at={type:"FeatureCollection",features:Array.from(Ze.values())};try{t(17,z=u.generateMergedBoundary(at)),t(5,L=Ze)}catch(dt){console.log(`error merging boundaries: ${dt}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${dt}`)}}}function H(De){var Ze;let Le=d.nextAvailableNeighbourhoodName(s),lt=q2(u,"What do you want to name the neighbourhood?",Le);if(lt)try{const at={};C=="draw-area"&&((Ze=I==null?void 0:I.properties)!=null&&Ze.waypoints)&&(at.waypoints=I.properties.waypoints);let dt={type:"Feature",properties:at,geometry:De.geometry};u.setCurrentNeighbourhoodBoundary(lt,dt),cn(Ia,o=lt,o),jf(),cn(nr,i={mode:"neighbourhood"},i)}catch(at){window.alert(`Sorry, this boundary is invalid: ${at}`)}}function q(){sp("auto_boundaries.geojson",JSON.stringify(x,null,"  "))}function J(De){return G2({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},De,n)}function he(De){return{none:Xn(.3,.5),area:Xn(.7,.9),car_ownership:Xn(.7,.9),population_density:Xn(.7,.9),pois:Xn(.7,.9),simd:Xn(.7,.9),stats19:Xn(.7,.9),combined:Xn(.7,.9)}[De]}function Ee(){t(17,z=null),L.clear(),t(5,L),t(6,E=[]),t(18,O=null),t(7,B=null)}function Y(De){T=De,t(4,T)}const oe=()=>t(0,C="choose-area"),ke=()=>t(0,C="draw-area");function ye(De){E=De,t(6,E)}function Ne(De){I=De,t(1,I)}const Ue=()=>H(_r(B));return r.$$.update=()=>{if(r.$$.dirty[0]&524290){let De=null;if(I&&I.geometry.coordinates[0].length>3){let Le={type:"FeatureCollection",features:[I]};try{De=u.generateMergedBoundary(Le)}catch(lt){console.log(`error merging boundaries: ${lt}`)}}t(18,O=De)}r.$$.dirty[0]&393217&&(C=="draw-area"?t(7,B=O):t(7,B=z))},[C,I,_,x,T,L,E,B,i,p,g,K,H,q,J,he,Ee,z,O,u,Y,oe,ke,ye,Ne,Ue]}class A8 extends Tt{constructor(e){super(),Ct(this,e,x8,w8,wt,{},null,[-1,-1])}}const k8="/ltn/assets/bus_gate_icon-5ea86d80.gif",S8="/ltn/assets/bus_gate-fc08b133.gif",C8="/ltn/assets/no_entry_icon-a9bfd826.gif",T8="/ltn/assets/no_entry-6857cf3d.gif",M8="/ltn/assets/school_street_icon-38e9058e.gif",E8="/ltn/assets/school_street-a0b77e20.gif",L8="/ltn/assets/walk_cycle_only_icon-4c8b48c0.gif",I8="/ltn/assets/walk_cycle_only-03bfc59f.gif",vi=class vi{constructor(e,t,n,i,o){er(this,"filterType");er(this,"label");er(this,"description");er(this,"imageUrl");er(this,"iconUrl");this.filterType=e,this.label=t,this.description=n,this.imageUrl=i,this.iconUrl=o}get iconURL(){return this.iconUrl}get largeImageURL(){return this.imageUrl}static getFilter(e){switch(e){case"walk_cycle_only":return vi.walkCycleOnly;case"no_entry":return vi.noEntry;case"bus_gate":return vi.busGate;case"school_street":return vi.schoolStreet;default:console.assert(`unknown filter type: "${e}"`);return}}};er(vi,"walkCycleOnly",new vi("walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter.",I8,L8)),er(vi,"noEntry",new vi("no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through.",T8,C8)),er(vi,"busGate",new vi("bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier.",S8,k8)),er(vi,"schoolStreet",new vi("school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school.",E8,M8)),er(vi,"allTypes",[vi.walkCycleOnly,vi.noEntry,vi.busGate,vi.schoolStreet]);let zi=vi;function P8(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=vr(r[7].mode)+"",z,L;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),_=new $n({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Te(T),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(E,I){W(E,e,I),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),R(n,g),ae(_,g,null),R(n,x),R(n,C),R(C,z),L=!0},p(E,I){(!L||I&128)&&T!==(T=vr(E[7].mode)+"")&&At(z,T)},i(E){L||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(d),le(_)}}}function z8(r){let e;return{c(){e=U("p"),e.textContent="Hover on a zone"},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function D8(r){let e,t=r[6].properties.name+"",n,i,o,u,s=r[6].properties.sum_from.toLocaleString()+"",d,p,g,_,x=r[6].properties.sum_to.toLocaleString()+"",C,T,z,L,E=r[6].properties.counts_from[r[3]]+"",I;return{c(){e=U("u"),n=Te(t),i=ie(),o=U("p"),u=Te("Total trips from here: "),d=Te(s),p=ie(),g=U("p"),_=Te("Total trips to here: "),C=Te(x),T=ie(),z=U("p"),L=Te("Total intra-zonal trips starting and ending here: "),I=Te(E)},m(O,B){W(O,e,B),R(e,n),W(O,i,B),W(O,o,B),R(o,u),R(o,d),W(O,p,B),W(O,g,B),R(g,_),R(g,C),W(O,T,B),W(O,z,B),R(z,L),R(z,I)},p(O,B){B&64&&t!==(t=O[6].properties.name+"")&&At(n,t),B&64&&s!==(s=O[6].properties.sum_from.toLocaleString()+"")&&At(d,s),B&64&&x!==(x=O[6].properties.sum_to.toLocaleString()+"")&&At(C,x),B&72&&E!==(E=O[6].properties.counts_from[O[3]]+"")&&At(I,E)},d(O){O&&(G(e),G(i),G(o),G(p),G(g),G(T),G(z))}}}function R8(r){let e,t,n,i,o,u=r[0].features.length.toLocaleString()+"",s,d,p,g,_,x,C,T,z,L,E=r[1]?"from":"to",I,O,B=r[3]==null?"each zone":"this zone",K,H,q,J,he,Ee,Y,oe,ke,ye;t=new Ns({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),J=new wo({props:{colorScale:Od,labels:{limits:r[5]}}});function Ne(Le,lt){return Le[6]&&Le[3]!=null?D8:z8}let Ue=Ne(r),De=Ue(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),o=Te("Trips begin and end in "),s=Te(u),d=Te(" zones"),p=ie(),g=U("label"),_=Te(`Trips from
      `),x=U("input"),C=Te(`
      Trips to`),T=ie(),z=U("p"),L=Te("Trips "),I=Te(E),O=ie(),K=Te(B),H=Te(":"),q=ie(),ue(J.$$.fragment),he=ie(),Ee=U("hr"),Y=ie(),De.c(),fe(x,"type","checkbox"),fe(x,"role","switch"),fe(e,"slot","sidebar")},m(Le,lt){W(Le,e,lt),ae(t,e,null),R(e,n),R(e,i),R(i,o),R(i,s),R(i,d),R(e,p),R(e,g),R(g,_),R(g,x),x.checked=r[1],R(g,C),R(e,T),R(e,z),R(z,L),R(z,I),R(z,O),R(z,K),R(z,H),R(e,q),ae(J,e,null),R(e,he),R(e,Ee),R(e,Y),De.m(e,null),oe=!0,ke||(ye=Lt(x,"change",r[9]),ke=!0)},p(Le,lt){(!oe||lt&1)&&u!==(u=Le[0].features.length.toLocaleString()+"")&&At(s,u),lt&2&&(x.checked=Le[1]),(!oe||lt&2)&&E!==(E=Le[1]?"from":"to")&&At(I,E),(!oe||lt&8)&&B!==(B=Le[3]==null?"each zone":"this zone")&&At(K,B);const Ze={};lt&32&&(Ze.labels={limits:Le[5]}),J.$set(Ze),Ue===(Ue=Ne(Le))&&De?De.p(Le,lt):(De.d(1),De=Ue(Le),De&&(De.c(),De.m(e,null)))},i(Le){oe||(N(t.$$.fragment,Le),N(J.$$.fragment,Le),oe=!0)},o(Le){V(t.$$.fragment,Le),V(J.$$.fragment,Le),oe=!1},d(Le){Le&&G(e),le(t),le(J),De.d(),ke=!1,ye()}}}function B8(r){let e,t,n,i,o;const u=[yn("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":Xn(.5,.1)}},{manageHoverState:!0}];function s(_){r[8](_)}let d={};for(let _=0;_<u.length;_+=1)d=It(d,u[_]);r[2]!==void 0&&(d.hovered=r[2]),e=new Xi({props:d}),pn.push(()=>Dn(e,"hovered",s));const p=[yn("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let g={};for(let _=0;_<p.length;_+=1)g=It(g,p[_]);return i=new cr({props:g}),{c(){ue(e.$$.fragment),n=ie(),ue(i.$$.fragment)},m(_,x){ae(e,_,x),W(_,n,x),ae(i,_,x),o=!0},p(_,x){const C=x&16?Mn(u,[u[0],{paint:{"fill-color":_[4],"fill-opacity":Xn(.5,.1)}},u[2]]):{};!t&&x&4&&(t=!0,C.hovered=_[2],zn(()=>t=!1)),e.$set(C);const T={};i.$set(T)},i(_){o||(N(e.$$.fragment,_),N(i.$$.fragment,_),o=!0)},o(_){V(e.$$.fragment,_),V(i.$$.fragment,_),o=!1},d(_){_&&G(n),le(e,_),le(i,_)}}}function F8(r){let e,t,n;return t=new yr({props:{data:r[0],generateId:!0,$$slots:{default:[B8]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","map")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&1&&(u.data=i[0]),o&8212&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function O8(r){let e,t;return e=new xo({props:{$$slots:{map:[F8],sidebar:[R8],top:[P8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&8447&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function $8(r,e,t){let n,i,o,u,s,d;st(r,nr,L=>t(7,s=L)),st(r,kr,L=>t(10,d=L));let p=Ji();try{p=d.getDemandModel()}catch{window.alert("No demand model for this area"),cn(nr,s={mode:"pick-neighbourhood"},s)}let g=!1,_=null;function x(L,E){if(L==null){let I=E?"sum_to":"sum_from",O=Math.max(...p.features.map(K=>K.properties[I])),B=C(O);return[B,Di(["get",I],B,Od)]}else{let I=E?"counts_to":"counts_from",O=[...p.features.map(H=>H.properties[I][L])],B=Math.max(...O),K=C(B);return[K,Di(["at",["id"],["literal",O]],K,Od)]}}function C(L){let E=Od.length+1;return Array.from(Array(E).keys()).map(I=>Math.round(L/(E-1)*I))}function T(L){_=L,t(2,_)}function z(){g=this.checked,t(1,g)}return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=_==null?null:_.id),r.$$.dirty&9&&t(6,i=n!=null?p.features[n]:null),r.$$.dirty&10&&t(5,[o,u]=x(n,g),o,(t(4,u),t(3,n),t(1,g),t(2,_)))},[p,g,_,n,u,o,i,s,T,z]}class N8 extends Tt{constructor(e){super(),Ct(this,e,$8,O8,wt,{})}}function j8(r){let e,t,n,i,o,u,s,d,p,g,_=vr(r[4].mode)+"",x,C;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),g=U("li"),x=Te(_),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(T,z){W(T,e,z),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),R(n,g),R(g,x),C=!0},p(T,z){(!C||z&16)&&_!==(_=vr(T[4].mode)+"")&&At(x,_)},i(T){C||(N(o.$$.fragment,T),N(d.$$.fragment,T),C=!0)},o(T){V(o.$$.fragment,T),V(d.$$.fragment,T),C=!1},d(T){T&&G(e),le(o),le(d)}}}function Uv(r){let e,t,n,i,o,u,s;function d(g){r[7](g)}let p={list:r[1].features};return r[2]!==void 0&&(p.idx=r[2]),n=new fp({props:p}),pn.push(()=>Dn(n,"idx",d)),{c(){e=U("button"),e.textContent="Pick another intersection",t=ie(),ue(n.$$.fragment),fe(e,"class","secondary")},m(g,_){W(g,e,_),W(g,t,_),ae(n,g,_),o=!0,u||(s=Lt(e,"click",r[6]),u=!0)},p(g,_){const x={};_&2&&(x.list=g[1].features),!i&&_&4&&(i=!0,x.idx=g[2],zn(()=>i=!1)),n.$set(x)},i(g){o||(N(n.$$.fragment,g),o=!0)},o(g){V(n.$$.fragment,g),o=!1},d(g){g&&(G(e),G(t)),le(n,g),u=!1,s()}}}function Vv(r){let e,t;return{c(){e=U("a"),t=Te("Open OSM"),fe(e,"href",r[0]),fe(e,"target","_blank")},m(n,i){W(n,e,i),R(e,t)},p(n,i){i&1&&fe(e,"href",n[0])},d(n){n&&G(e)}}}function U8(r){let e,t,n,i,o,u,s;t=new Ns({props:{mode:{mode:"pick-neighbourhood"}}});let d=r[1].features.length>0&&Uv(r),p=r[0]&&Vv(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=ie(),d&&d.c(),u=ie(),p&&p.c(),fe(e,"slot","sidebar")},m(g,_){W(g,e,_),ae(t,e,null),R(e,n),R(e,i),R(e,o),d&&d.m(e,null),R(e,u),p&&p.m(e,null),s=!0},p(g,_){g[1].features.length>0?d?(d.p(g,_),_&2&&N(d,1)):(d=Uv(g),d.c(),N(d,1),d.m(e,u)):d&&(Kt(),V(d,1,1,()=>{d=null}),Jt()),g[0]?p?p.p(g,_):(p=Vv(g),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(g){s||(N(t.$$.fragment,g),N(d),s=!0)},o(g){V(t.$$.fragment,g),V(d),s=!1},d(g){g&&G(e),le(t),d&&d.d(),p&&p.d()}}}function V8(r){let e,t;const n=[yn("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new Bl({props:i}),e.$on("click",r[5]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function q8(r){let e,t,n,i;const o=[yn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=It(u,o[p]);e=new cr({props:u});const s=[yn("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<s.length;p+=1)d=It(d,s[p]);return n=new Xi({props:d}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x=g&4?Mn(s,[s[0],{filter:["==",["id"],p[2]]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function H8(r){let e,t,n,i,o;return t=new yr({props:{data:_r(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[V8]},$$scope:{ctx:r}}}),i=new yr({props:{data:r[1],generateId:!0,$$slots:{default:[q8]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),fe(e,"slot","map")},m(u,s){W(u,e,s),ae(t,e,null),R(e,n),ae(i,e,null),o=!0},p(u,s){const d={};s&8&&(d.data=_r(u[3]).getAllIntersections()),s&256&&(d.$$scope={dirty:s,ctx:u}),t.$set(d);const p={};s&2&&(p.data=u[1]),s&260&&(p.$$scope={dirty:s,ctx:u}),i.$set(p)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&G(e),le(t),le(i)}}}function G8(r){let e,t;return e=new xo({props:{$$slots:{map:[H8],sidebar:[U8],top:[j8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function W8(r,e,t){let n,i;st(r,kr,_=>t(3,n=_)),st(r,nr,_=>t(4,i=_));let o=null,u=Ji(),s=0;function d(_){t(0,o=_.detail.features[0].properties.osm),t(1,u=n.getMovements(_.detail.features[0].id)),t(2,s=0)}const p=()=>t(1,u=Ji());function g(_){s=_,t(2,s)}return[o,u,s,n,i,d,p,g]}class Z8 extends Tt{constructor(e){super(),Ct(this,e,W8,G8,wt,{})}}function X8(r){let e,t,n,i;const o=[yn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":qd(),"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let u={};for(let p=0;p<o.length;p+=1)u=It(u,o[p]);e=new Xi({props:u});const s=[yn("border-entries"),{filter:["==",["get","kind"],"border_entry"]},{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Td(1),"icon-offset":qv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:r[1]?"visible":"none"}},{paint:{"icon-color":qd(),"icon-halo-color":"black","icon-opacity":Hv(),"icon-halo-width":Td(1.5),"icon-halo-blur":0}},{minzoom:13},{interactive:!1}];let d={};for(let p=0;p<s.length;p+=1)d=It(d,s[p]);return n=new ec({props:d}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,[g]){const _=g&1?Mn(o,[o[0],o[1],{layout:{visibility:p[0]=="cells"?"none":"visible"}},o[3]]):{};e.$set(_);const x=g&2?Mn(s,[s[0],s[1],g&2&&{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Td(1),"icon-offset":qv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:p[1]?"visible":"none"}},g&0&&{paint:{"icon-color":qd(),"icon-halo-color":"black","icon-opacity":Hv(),"icon-halo-width":Td(1.5),"icon-halo-blur":0}},s[4],s[5]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function Td(r){return["interpolate",["linear"],["zoom"],14,.08*r,22,.7*r]}function qv(r){return[0,-50*r]}function Hv(){return["interpolate",["linear"],["zoom"],14,1,22,.7]}function K8(r,e,t){let n,i;return st(r,Jd,o=>t(0,n=o)),st(r,Gm,o=>t(1,i=o)),[n,i]}class hp extends Tt{constructor(e){super(),Ct(this,e,K8,X8,wt,{})}}function J8(r){let e,t;const n=[yn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new Xi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}class dp extends Tt{constructor(e){super(),Ct(this,e,null,J8,wt,{})}}const Y8=r=>({}),Gv=r=>({}),Q8=r=>({}),Wv=r=>({});function Zv(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],Wv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,Q8):xn(i[10]),Wv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function eP(r){let e,t,n=r[0]&&Zv(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Zv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function Xv(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],Gv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,Y8):xn(i[10]),Gv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function tP(r){let e,t,n=r[0]&&Xv(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Xv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function nP(r){let e,t,n,i,o,u,s,d;const p=[yn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,1),"line-color":"black"}},{minzoom:13}];let g={};for(let E=0;E<p.length;E+=1)g=It(g,p[E]);e=new cr({props:g});const _=[yn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":Xn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let x={$$slots:{default:[eP]},$$scope:{ctx:r}};for(let E=0;E<_.length;E+=1)x=It(x,_[E]);n=new cr({props:x}),n.$on("click",r[8]);const C=[yn("main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,6),"line-color":"black"}},{minzoom:13}];let T={};for(let E=0;E<C.length;E+=1)T=It(T,C[E]);o=new cr({props:T});const z=[yn("main-roads"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,4),"line-color":Xn("gray",yo.mapFeature.hover.backgroundColor),"line-opacity":Xn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let L={$$slots:{default:[tP]},$$scope:{ctx:r}};for(let E=0;E<z.length;E+=1)L=It(L,z[E]);return s=new cr({props:L}),s.$on("click",r[9]),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(E,I){ae(e,E,I),W(E,t,I),ae(n,E,I),W(E,i,I),ae(o,E,I),W(E,u,I),ae(s,E,I),d=!0},p(E,[I]){const O=I&84?Mn(p,[p[0],p[1],{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,1),"line-color":"black"}},p[3]]):{};e.$set(O);const B=I&125?Mn(_,[_[0],_[1],I&124&&{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,0),"line-color":E[5](E[3],E[4].maxShortcuts),"line-opacity":Xn(1,.5)}},_[3],_[4],I&1&&{manageHoverState:E[0]},I&1&&{hoverCursor:E[0]?"pointer":void 0}]):{};I&1025&&(B.$$scope={dirty:I,ctx:E}),n.$set(B);const K=I&84?Mn(C,[C[0],C[1],{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,6),"line-color":"black"}},C[3]]):{};o.$set(K);const H=I&85?Mn(z,[z[0],z[1],I&84&&{paint:{"line-width":E[6](E[2],E[4].maxShortcuts,4),"line-color":Xn("gray",yo.mapFeature.hover.backgroundColor),"line-opacity":Xn(1,.5)}},z[3],z[4],I&1&&{manageHoverState:E[0]},I&1&&{hoverCursor:E[0]?"pointer":void 0}]):{};I&1025&&(H.$$scope={dirty:I,ctx:E}),s.$set(H)},i(E){d||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(s.$$.fragment,E),d=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(s.$$.fragment,E),d=!1},d(E){E&&(G(t),G(i),G(u)),le(e,E),le(n,E),le(o,E),le(s,E)}}}function rP(r,e,t){let n,i;st(r,Wm,T=>t(2,n=T)),st(r,Jd,T=>t(3,i=T));let{$$slots:o={},$$scope:u}=e,s=Kf("neighbourhoodGj"),{interactive:d=!0}=e,{onClickLine:p=(T,z)=>{}}=e;function g(T,z){return T=="cells"?qd():T=="edits"?Xn(["case",["get","edited"],JT,"white"],yo.mapFeature.hover.backgroundColor):T=="speeds"?Di(["get","speed_mph"],v2,y2):z<=2?Xn("white","blue"):(console.assert(T=="shortcuts"),Xn(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",z,"#A32015"],yo.mapFeature.hover.backgroundColor))}function _(T,z,L){return!T||z<=2?na(L):["interpolate",["linear"],["get","shortcuts"],0,5+L,z,25+L]}const x=T=>d&&p(T.detail.features[0],T.detail.event.lngLat),C=T=>d&&p(T.detail.features[0],T.detail.event.lngLat);return r.$$set=T=>{"interactive"in T&&t(0,d=T.interactive),"onClickLine"in T&&t(1,p=T.onClickLine),"$$scope"in T&&t(10,u=T.$$scope)},[d,p,n,i,s,g,_,o,x,C,u]}class hh extends Tt{constructor(e){super(),Ct(this,e,rP,nP,wt,{interactive:0,onClickLine:1})}}function iP(r){let e;const t=r[7].default,n=vn(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&wn(n,t,i,i[9],e?bn(t,i[9],o,null):xn(i[9]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function oP(r){let e,t,n;const i=[yn("turn-restrictions"),{minzoom:13},{filter:r[4]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(s){r[8](s)}let u={$$slots:{default:[iP]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=It(u,i[s]);return r[1]!==void 0&&(u.hovered=r[1]),e=new ec({props:u}),pn.push(()=>Dn(e,"hovered",o)),e.$on("click",function(){ua(r[0])&&r[0].apply(this,arguments)}),{c(){ue(e.$$.fragment)},m(s,d){ae(e,s,d),n=!0},p(s,d){r=s;const p=d&16?Mn(i,[i[0],i[1],{filter:r[4]?void 0:["get","edited"]},i[3],i[4]]):{};d&512&&(p.$$scope={dirty:d,ctx:r}),!t&&d&2&&(t=!0,p.hovered=r[1],zn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function sP(r){let e,t;const n=[yn("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function aP(r){let e,t,n,i;return e=new yr({props:{data:r[2],generateId:!0,$$slots:{default:[oP]},$$scope:{ctx:r}}}),n=new yr({props:{data:r[3],$$slots:{default:[sP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&4&&(s.data=o[2]),u&531&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&8&&(d.data=o[3]),u&512&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function lP(r,e,t){let n,i,o,u,s;st(r,kr,C=>t(5,o=C)),st(r,Gi,C=>t(6,u=C)),st(r,Kd,C=>t(4,s=C));let{$$slots:d={},$$scope:p}=e,{onClickTurnRestriction:g=()=>{}}=e,_=null;function x(C){_=C,t(1,_)}return r.$$set=C=>{"onClickTurnRestriction"in C&&t(0,g=C.onClickTurnRestriction),"$$scope"in C&&t(9,p=C.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=_==null?Ji():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(_.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(_.properties.to_geometry),properties:{}}]}),r.$$.dirty&96&&t(2,i=u>0?o.renderTurnRestrictions():Ji())},[g,_,i,n,s,o,u,d,x,p]}class uP extends Tt{constructor(e){super(),Ct(this,e,lP,aP,wt,{onClickTurnRestriction:0})}}const cP=r=>({}),Kv=r=>({}),fP=r=>({}),Jv=r=>({});function hP(r){let e;const t=r[7]["modal-filter"],n=vn(t,r,r[8],Jv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,fP):xn(i[8]),Jv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function dP(r){let e,t,n,i;const o=[yn("modal-filters"),{interactive:r[2]},{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},{minzoom:Md},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let u={$$slots:{default:[hP]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=It(u,o[p]);e=new ec({props:u}),e.$on("click",function(){ua(r[0])&&r[0].apply(this,arguments)});const s=[yn("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Md},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let d={};for(let p=0;p<s.length;p+=1)d=It(d,s[p]);return n=new ec({props:d}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){r=p;const _=g&20?Mn(o,[o[0],g&4&&{interactive:r[2]},g&16&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},g&0&&{minzoom:Md},o[4],o[5]]):{};g&256&&(_.$$scope={dirty:g,ctx:r}),e.$set(_);const x=g&0?Mn(s,[s[0],s[1],{minzoom:Md},s[3],s[4]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function pP(r){let e;const t=r[7]["turn-restriction"],n=vn(t,r,r[8],Kv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,cP):xn(i[8]),Kv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function mP(r){let e,t,n,i;return e=new yr({props:{data:r[3],generateId:!0,$$slots:{default:[dP]},$$scope:{ctx:r}}}),n=new uP({props:{onClickTurnRestriction:r[1],$$slots:{default:[pP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&8&&(s.data=o[3]),u&277&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&2&&(d.onClickTurnRestriction=o[1]),u&256&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}let Md=13;function gP(r,e,t){let n,i,o,u;st(r,kr,x=>t(5,i=x)),st(r,Gi,x=>t(6,o=x)),st(r,Kd,x=>t(4,u=x));let{$$slots:s={},$$scope:d}=e,{onClickModalFilter:p=()=>{}}=e,{onClickTurnRestriction:g=()=>{}}=e,{interactive:_}=e;return r.$$set=x=>{"onClickModalFilter"in x&&t(0,p=x.onClickModalFilter),"onClickTurnRestriction"in x&&t(1,g=x.onClickTurnRestriction),"interactive"in x&&t(2,_=x.interactive),"$$scope"in x&&t(8,d=x.$$scope)},r.$$.update=()=>{r.$$.dirty&96&&t(3,n=o>0?i.renderModalFilters():Ji())},[p,g,_,n,u,i,o,s,d]}class Ya extends Tt{constructor(e){super(),Ct(this,e,gP,mP,wt,{onClickModalFilter:0,onClickTurnRestriction:1,interactive:2})}}function _P(r){let e,t;const n=[yn("one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new ec({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}class pp extends Tt{constructor(e){super(),Ct(this,e,null,_P,wt,{})}}function yP(r){let e;const t=r[3].default,n=vn(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&wn(n,t,i,i[4],e?bn(t,i[4],o,null):xn(i[4]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function vP(r){let e,t;return e=new yr({props:{data:r[0],generateId:!0,$$slots:{default:[yP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function bP(r,e,t){let n,i;st(r,kr,d=>t(2,i=d));let{$$slots:o={},$$scope:u}=e,{input:s=null}=e;return r.$$set=d=>{"input"in d&&t(1,s=d.input),"$$scope"in d&&t(4,u=d.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=s||i.renderNeighbourhood()),r.$$.dirty&1&&op("neighbourhoodGj",n)},[n,s,i,o,u]}class dh extends Tt{constructor(e){super(),Ct(this,e,bP,vP,wt,{input:1})}}function qd(){return["match",["get","cell_color"],"disconnected","red",["let","index",["%",["to-number",["get","cell_color"]],10],["match",["var","index"],0,"#8dd3c7",1,"#ffffb3",2,"#bebada",3,"#80b1d3",4,"#fdb462",5,"#b3de69",6,"#fccde5",7,"#bc80bd",8,"#ccebc5",9,"#ffed6f","blue"]]]}function wP(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=vr(r[2].mode)+"",z,L;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),_=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Te(T),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(E,I){W(E,e,I),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),R(n,g),ae(_,g,null),R(n,x),R(n,C),R(C,z),L=!0},p(E,I){(!L||I&4)&&T!==(T=vr(E[2].mode)+"")&&At(z,T)},i(E){L||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(d),le(_)}}}function Yv(r){let e,t,n;return{c(){e=U("button"),e.textContent="â",fe(e,"class","close-btn svelte-khnvno")},m(i,o){W(i,e,o),t||(n=Lt(e,"click",r[5]),t=!0)},p:ft,d(i){i&&G(e),t=!1,n()}}}function xP(r){let e;return{c(){e=U("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){W(t,e,n)},p:ft,i:ft,o:ft,d(t){t&&G(e)}}}function AP(r){let e,t,n,i,o,u,s;e=new Jf({props:{properties:r[0].feature.properties}});function d(g){r[6](g)}let p={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(p.idx=r[0].movementIdx),o=new fp({props:p}),pn.push(()=>Dn(o,"idx",d)),{c(){ue(e.$$.fragment),t=ie(),n=U("h5"),n.textContent="Turn restrictions:",i=ie(),ue(o.$$.fragment)},m(g,_){ae(e,g,_),W(g,t,_),W(g,n,_),W(g,i,_),ae(o,g,_),s=!0},p(g,_){const x={};_&1&&(x.properties=g[0].feature.properties),e.$set(x);const C={};_&1&&(C.list=g[0].movements.features),!u&&_&1&&(u=!0,C.idx=g[0].movementIdx,zn(()=>u=!1)),o.$set(C)},i(g){s||(N(e.$$.fragment,g),N(o.$$.fragment,g),s=!0)},o(g){V(e.$$.fragment,g),V(o.$$.fragment,g),s=!1},d(g){g&&(G(t),G(n),G(i)),le(e,g),le(o,g)}}}function kP(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T;t=new Ns({props:{mode:{mode:"neighbourhood"}}});let z=r[0]&&Yv(r);const L=[AP,xP],E=[];function I(O,B){return O[0]?0:1}return x=I(r),C=E[x]=L[x](r),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("h4"),i.textContent="Roads",o=ie(),u=U("p"),u.textContent="Click a road to visit its OSM object.",s=ie(),d=U("div"),p=U("h4"),p.textContent="Intersections",g=ie(),z&&z.c(),_=ie(),C.c(),Ye(d,"display","flex"),Ye(d,"align-items","start"),Ye(d,"justify-content","space-between"),fe(e,"slot","sidebar")},m(O,B){W(O,e,B),ae(t,e,null),R(e,n),R(e,i),R(e,o),R(e,u),R(e,s),R(e,d),R(d,p),R(d,g),z&&z.m(d,null),R(e,_),E[x].m(e,null),T=!0},p(O,B){O[0]?z?z.p(O,B):(z=Yv(O),z.c(),z.m(d,null)):z&&(z.d(1),z=null);let K=x;x=I(O),x===K?E[x].p(O,B):(Kt(),V(E[K],1,1,()=>{E[K]=null}),Jt(),C=E[x],C?C.p(O,B):(C=E[x]=L[x](O),C.c()),N(C,1),C.m(e,null))},i(O){T||(N(t.$$.fragment,O),N(C),T=!0)},o(O){V(t.$$.fragment,O),V(C),T=!1},d(O){O&&G(e),le(t),z&&z.d(),E[x].d()}}}function SP(r){let e,t;return e=new Jf({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function CP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[SP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function TP(r){let e,t;return e=new Jf({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function MP(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[TP,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","line-popup")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&384&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function EP(r){let e,t,n,i,o,u,s,d,p,g;e=new dp({}),n=new hp({}),o=new pp({});const _=[yn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let x={$$slots:{default:[CP]},$$scope:{ctx:r}};for(let C=0;C<_.length;C+=1)x=It(x,_[C]);return s=new Bl({props:x}),p=new hh({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[MP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment),d=ie(),ue(p.$$.fragment)},m(C,T){ae(e,C,T),W(C,t,T),ae(n,C,T),W(C,i,T),ae(o,C,T),W(C,u,T),ae(s,C,T),W(C,d,T),ae(p,C,T),g=!0},p(C,T){const z={};T&256&&(z.$$scope={dirty:T,ctx:C}),s.$set(z);const L={};T&256&&(L.$$scope={dirty:T,ctx:C}),p.$set(L)},i(C){g||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),N(s.$$.fragment,C),N(p.$$.fragment,C),g=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),V(s.$$.fragment,C),V(p.$$.fragment,C),g=!1},d(C){C&&(G(t),G(i),G(u),G(d)),le(e,C),le(n,C),le(o,C),le(s,C),le(p,C)}}}function LP(r){let e,t;return e=new Jf({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function IP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[LP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function PP(r){let e,t;return e=new Jf({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function zP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[PP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function DP(r){var o,u,s;let e,t;const n=[yn("debug-intersections"),{paint:{"circle-radius":og(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Xn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(u=(o=r[0])==null?void 0:o.feature)==null?void 0:u.properties)==null?void 0:s.intersection_id)??-1],.3,Xn(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[zP]},$$scope:{ctx:r}};for(let d=0;d<n.length;d+=1)i=It(i,n[d]);return e=new Bl({props:i}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(d,p){ae(e,d,p),t=!0},p(d,p){var _,x,C;const g=p&1?Mn(n,[n[0],{paint:{"circle-radius":og(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Xn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((C=(x=(_=d[0])==null?void 0:_.feature)==null?void 0:x.properties)==null?void 0:C.intersection_id)??-1],.3,Xn(0,.5)]}},n[2],n[3]]):{};p&256&&(g.$$scope={dirty:p,ctx:d}),e.$set(g)},i(d){t||(N(e.$$.fragment,d),t=!0)},o(d){V(e.$$.fragment,d),t=!1},d(d){le(e,d)}}}function Qv(r){let e,t;return e=new yr({props:{data:r[0].movements,generateId:!0,$$slots:{default:[RP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&257&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function RP(r){let e,t,n,i;const o=[yn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=It(u,o[p]);e=new cr({props:u});const s=[yn("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<s.length;p+=1)d=It(d,s[p]);return n=new Xi({props:d}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x=g&1?Mn(s,[s[0],{filter:["==",["id"],p[0].movementIdx]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function BP(r){let e,t,n,i,o,u,s,d;t=new dh({props:{$$slots:{default:[EP]},$$scope:{ctx:r}}}),i=new Ya({props:{interactive:!0,$$slots:{default:[IP]},$$scope:{ctx:r}}}),u=new yr({props:{data:_r(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[DP]},$$scope:{ctx:r}}});let p=r[0]&&Qv(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),o=ie(),ue(u.$$.fragment),s=ie(),p&&p.c(),fe(e,"slot","map")},m(g,_){W(g,e,_),ae(t,e,null),R(e,n),ae(i,e,null),R(e,o),ae(u,e,null),R(e,s),p&&p.m(e,null),d=!0},p(g,_){const x={};_&256&&(x.$$scope={dirty:_,ctx:g}),t.$set(x);const C={};_&256&&(C.$$scope={dirty:_,ctx:g}),i.$set(C);const T={};_&2&&(T.data=_r(g[1]).getAllIntersections()),_&257&&(T.$$scope={dirty:_,ctx:g}),u.$set(T),g[0]?p?(p.p(g,_),_&1&&N(p,1)):(p=Qv(g),p.c(),N(p,1),p.m(e,null)):p&&(Kt(),V(p,1,1,()=>{p=null}),Jt())},i(g){d||(N(t.$$.fragment,g),N(i.$$.fragment,g),N(u.$$.fragment,g),N(p),d=!0)},o(g){V(t.$$.fragment,g),V(i.$$.fragment,g),V(u.$$.fragment,g),V(p),d=!1},d(g){g&&G(e),le(t),le(i),le(u),p&&p.d()}}}function FP(r){let e,t;return e=new xo({props:{$$slots:{map:[BP],sidebar:[kP],top:[wP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&263&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function OP(r,e,t){let n,i;st(r,kr,g=>t(1,n=g)),st(r,nr,g=>t(2,i=g));let o=null;function u(g){let _=g.detail.features[0],x=n.getMovements(_.properties.intersection_id);t(0,o={feature:_,movements:x,movementIdx:0})}const s=(g,_)=>window.open(_r(g.properties).way,"_blank"),d=()=>t(0,o=null);function p(g){r.$$.not_equal(o.movementIdx,g)&&(o.movementIdx=g,t(0,o))}return[o,n,i,u,s,d,p]}class $P extends Tt{constructor(e){super(),Ct(this,e,OP,FP,wt,{})}}const NP="/ltn/assets/eraser-894c4bbc.svg",jP="/ltn/assets/paintbrush-511a1297.svg",eb="/ltn/assets/one_way_left-9368d5dd.svg",UP="/ltn/assets/traffic_1-a90740ec.svg";var Io=63710088e-1,VP={centimeters:Io*100,centimetres:Io*100,degrees:360/(2*Math.PI),feet:Io*3.28084,inches:Io*39.37,kilometers:Io/1e3,kilometres:Io/1e3,meters:Io,metres:Io,miles:Io/1609.344,millimeters:Io*1e3,millimetres:Io*1e3,nauticalmiles:Io/1852,radians:1,yards:Io*1.0936};function qP(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function xg(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!tb(r[0])||!tb(r[1]))throw new Error("coordinates must contain numbers");return qP({type:"Point",coordinates:r},e,t)}function HP(r,e="kilometers"){const t=VP[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Ag(r){return r%(2*Math.PI)*180/Math.PI}function Ll(r){return r%360*Math.PI/180}function tb(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function kg(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function GP(r){return r.type==="Feature"?r.geometry:r}function W2(r,e,t={}){if(t.final===!0)return WP(r,e);const n=kg(r),i=kg(e),o=Ll(n[0]),u=Ll(i[0]),s=Ll(n[1]),d=Ll(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(s)*Math.sin(d)-Math.sin(s)*Math.cos(d)*Math.cos(u-o);return Ag(Math.atan2(p,g))}function WP(r,e){let t=W2(e,r);return t=(t+180)%360,t}function ZP(r,e,t,n={}){const i=kg(r),o=Ll(i[0]),u=Ll(i[1]),s=Ll(t),d=HP(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),_=Ag(g),x=Ag(p);return xg([_,x],n.properties)}var Po=63710088e-1,XP={centimeters:Po*100,centimetres:Po*100,degrees:360/(2*Math.PI),feet:Po*3.28084,inches:Po*39.37,kilometers:Po/1e3,kilometres:Po/1e3,meters:Po,metres:Po,miles:Po/1609.344,millimeters:Po*1e3,millimetres:Po*1e3,nauticalmiles:Po/1852,radians:1,yards:Po*1.0936};function KP(r,e="kilometers"){const t=XP[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Ed(r){return r%360*Math.PI/180}function nb(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Z2(r,e,t={}){var n=nb(r),i=nb(e),o=Ed(i[1]-n[1]),u=Ed(i[0]-n[0]),s=Ed(n[1]),d=Ed(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(d);return KP(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}var JP=Z2;function YP(r,e,t={}){const i=GP(r).coordinates;let o=0;for(let u=0;u<i.length&&!(e>=o&&u===i.length-1);u++)if(o>=e){const s=e-o;if(s){const d=W2(i[u],i[u-1])-180;return ZP(i[u],s,d,t)}else return xg(i[u])}else o+=Z2(i[u],i[u+1],t);return xg(i[i.length-1])}var QP=YP;function ez(r){let e,t;const n=[yn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new Bl({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function tz(r){let e,t;return e=new yr({props:{data:r[0],$$slots:{default:[ez]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}let nz=50,rz=100,iz=.01;function oz(r,e,t){let{paths:n}=e,i=d(),o=p(),u=_(),s=setInterval(x,rz);ei(()=>clearInterval(s));function d(){return n.features.map(C=>1/C.properties.directness).reduce((C,T)=>C+T,0)}function p(){return n.features.length==0?[]:Array.from({length:nz},g)}function g(){let C=Math.random()*i,T=0;for(let[z,L]of n.features.entries())if(T+=1/L.properties.directness,C<T)return{idx:z,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function _(){return{type:"FeatureCollection",features:o.map(({idx:C,distance:T})=>QP(n.features[C],T,{units:"kilometers"}))}}function x(){for(let[C,T]of o.entries())T.distance+=iz,T.distance>=n.features[T.idx].properties.length_meters/1e3&&(o[C]=g());t(0,u=_())}return r.$$set=C=>{"paths"in C&&t(1,n=C.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=d(),o=p())},[u,n]}class sz extends Tt{constructor(e){super(),Ct(this,e,oz,tz,wt,{paths:1})}}class az{constructor(e){er(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}const c_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==";function lz(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="+",t=ie(),n=U("img"),o=Te(`
    Add diagonal filter`),Ye(e,"font-size","200%"),Ye(e,"margin-top","-12px"),fe(e,"class","icon"),Sr(n.src,i=c_)||fe(n,"src",i),fe(n,"alt","Add diagonal filter"),Ye(n,"transform","rotate(135deg)"),fe(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},p:ft,d(u){u&&(G(e),G(t),G(n),G(o))}}}function uz(r){let e;function t(o,u){return o[0].hasRotatedFilter?fz:cz}let n=t(r),i=n(r);return{c(){i.c(),e=rr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i.d(o)}}}function cz(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="â»",t=ie(),n=U("img"),o=Te(`
      Rotate diagonal filter`),Ye(e,"font-size","200%"),Ye(e,"padding-bottom","4px"),fe(e,"class","icon"),Sr(n.src,i=c_)||fe(n,"src",i),fe(n,"alt","Rotate diagonal filter"),Ye(n,"transform","rotate(45deg)"),fe(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},d(u){u&&(G(e),G(t),G(n),G(o))}}}function fz(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="â",t=ie(),n=U("img"),o=Te(`
      Delete diagonal filter`),fe(e,"class","icon"),Sr(n.src,i=c_)||fe(n,"src",i),fe(n,"alt","Remove diagonal filter"),Ye(n,"transform","rotate(45deg)"),fe(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},d(u){u&&(G(e),G(t),G(n),G(o))}}}function hz(r){let e;function t(o,u){return o[0].filter?uz:lz}let n=t(r),i=n(r);return{c(){e=U("div"),i.c(),Ye(e,"display","flex"),Ye(e,"align-items","center")},m(o,u){W(o,e,u),i.m(e,null)},p(o,[u]){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:ft,o:ft,d(o){o&&G(e),i.d()}}}function dz(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class pz extends Tt{constructor(e){super(),Ct(this,e,dz,hz,wt,{intersection:0})}}function mz(r){let e,t;return e=new pz({props:{intersection:r[2](r[6])}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.intersection=n[2](n[6])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function gz(r){let e,t;return e=new Nw({props:{openOn:"hover",$$slots:{default:[mz,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function _z(r){let e,t;const n=[yn("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":og(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-opacity":Xn(0,.5),"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Xn(0,3)}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[gz]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new Bl({props:i}),e.$on("click",r[4]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&2?Mn(n,[n[0],n[1],n[2],n[3],{interactive:o[1]},n[5],n[6]]):{};u&128&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function yz(r,e,t){let{neighbourhood:n=Kf("neighbourhoodGj")}=e,{onClickIntersection:i=p=>{}}=e,{interactive:o=!1}=e;function u(p){let g=n.features[p];return new az(g)}function s(p){return u(p[0].id)}const d=p=>i(s(p.detail.features));return r.$$set=p=>{"neighbourhood"in p&&t(3,n=p.neighbourhood),"onClickIntersection"in p&&t(0,i=p.onClickIntersection),"interactive"in p&&t(1,o=p.interactive)},[i,o,s,n,d]}class vz extends Tt{constructor(e){super(),Ct(this,e,yz,_z,wt,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function rb(r,e,t){const n=r.slice();return n[6]=e[t],n}function ib(r){let e,t,n,i,o,u,s=r[6].label+"",d,p,g,_,x;function C(){return r[3](r[6])}return{c(){e=U("button"),t=U("img"),i=ie(),o=U("br"),u=ie(),d=Te(s),p=ie(),Sr(t.src,n=r[6].iconURL)||fe(t,"src",n),fe(t,"width","80"),fe(t,"alt",r[6].label),fe(e,"class","outline"),Ye(e,"width","100%"),e.disabled=g=r[1]==r[6].filterType},m(T,z){W(T,e,z),R(e,t),R(e,i),R(e,o),R(e,u),R(e,d),R(e,p),_||(x=Lt(e,"click",C),_=!0)},p(T,z){r=T,z&2&&g!==(g=r[1]==r[6].filterType)&&(e.disabled=g)},d(T){T&&G(e),_=!1,x()}}}function bz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C=r[2].description+"",T,z,L,E,I,O,B=On(zi.allTypes),K=[];for(let H=0;H<B.length;H+=1)K[H]=ib(rb(r,B,H));return{c(){e=U("h3"),e.textContent="Choose a modal filter to place on streets",t=ie(),n=U("table"),i=U("tr"),o=U("td");for(let H=0;H<K.length;H+=1)K[H].c();u=ie(),s=U("td"),d=U("img"),_=ie(),x=U("p"),T=Te(C),z=ie(),L=U("center"),E=U("button"),E.textContent="Confirm",Sr(d.src,p=r[2].largeImageURL)||fe(d,"src",p),fe(d,"height","300"),fe(d,"alt",g=r[2].label)},m(H,q){W(H,e,q),W(H,t,q),W(H,n,q),R(n,i),R(i,o);for(let J=0;J<K.length;J+=1)K[J]&&K[J].m(o,null);R(i,u),R(i,s),R(s,d),R(s,_),R(s,x),R(x,T),W(H,z,q),W(H,L,q),R(L,E),I||(O=Lt(E,"click",r[4]),I=!0)},p(H,q){if(q&2){B=On(zi.allTypes);let J;for(J=0;J<B.length;J+=1){const he=rb(H,B,J);K[J]?K[J].p(he,q):(K[J]=ib(he),K[J].c(),K[J].m(o,null))}for(;J<K.length;J+=1)K[J].d(1);K.length=B.length}q&4&&!Sr(d.src,p=H[2].largeImageURL)&&fe(d,"src",p),q&4&&g!==(g=H[2].label)&&fe(d,"alt",g),q&4&&C!==(C=H[2].description+"")&&At(T,C)},d(H){H&&(G(e),G(t),G(n),G(z),G(L)),di(K,H),I=!1,O()}}}function wz(r){let e,t,n;function i(u){r[5](u)}let o={$$slots:{default:[bz]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Lg({props:o}),pn.push(()=>Dn(e,"show",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&519&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.show=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function xz(r,e,t){let n,i;st(r,Hm,p=>t(1,i=p));let{show:o}=e;const u=p=>cn(Hm,i=p.filterType,i),s=()=>t(0,o=!1);function d(p){o=p,t(0,o)}return r.$$set=p=>{"show"in p&&t(0,o=p.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=zi.allTypes.find(p=>p.filterType==i))},[o,i,n,u,s,d]}class Az extends Tt{constructor(e){super(),Ct(this,e,xz,wz,wt,{show:0})}}function ob(r){let e,t;return e=new yr({props:{data:r[0],$$slots:{default:[kz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function kz(r){let e,t;const n=[yn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Sz(r){let e,t,n=r[0]&&ob(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=ob(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function Cz(r,e,t){let{map:n}=e,i=null;const o=$s();n.on("dragstart",u),n.on("mousemove",s),n.on("mouseup",d),ei(()=>{n.dragPan.enable(),n.off("dragstart",u),n.off("mousemove",s),n.off("mouseup",d)});function u(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(p){if(i){let g=p.lngLat.toArray(),_=i.geometry.coordinates.at(-1);if(_&&JP(_,g)*1e3<.5)return;i.geometry.coordinates.push(g),t(0,i),i.geometry.coordinates.length%10==0&&o("progress",i)}}function d(){!i||i.geometry.coordinates.length==0?o("done",null):o("done",i),t(0,i=null),n.dragPan.enable()}return r.$$set=p=>{"map"in p&&t(1,n=p.map)},[i,n]}class X2 extends Tt{constructor(e){super(),Ct(this,e,Cz,Sz,wt,{map:1})}}function Tz(r){let e;return{c(){e=U("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function sb(r){let e,t,n;return t=new $n({props:{mode:{mode:"debug-neighbourhood"},$$slots:{default:[Mz]},$$scope:{ctx:r}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function Mz(r){let e;return{c(){e=Te("Debug")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Ez(r){let e,t,n,i,o,u,s,d,p,g,_=vr(r[14].mode)+"",x,C,T,z,L,E,I,O,B,K,H,q,J,he,Ee,Y,oe,ke,ye,Ne,Ue,De;o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),T=new e_({props:{$$slots:{default:[Tz]},$$scope:{ctx:r}}}),O=new $n({props:{mode:{mode:"view-shortcuts"}}}),H=new $n({props:{mode:{mode:"route",prevMode:"neighbourhood"}}}),he=new $n({props:{mode:{mode:"predict-impact",prevMode:"neighbourhood"}}}),oe=new $n({props:{mode:{mode:"impact-one-destination"}}}),Ne=new $n({props:{mode:{mode:"set-boundary",name:_r(r[6]).properties.name,existing:_r(r[6])}}});let Le=r[15]&&sb(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),g=U("li"),x=Te(_),C=ie(),ue(T.$$.fragment),z=ie(),L=U("nav"),E=U("ul"),I=U("li"),ue(O.$$.fragment),B=ie(),K=U("li"),ue(H.$$.fragment),q=ie(),J=U("li"),ue(he.$$.fragment),Ee=ie(),Y=U("li"),ue(oe.$$.fragment),ke=ie(),ye=U("li"),ue(Ne.$$.fragment),Ue=ie(),Le&&Le.c(),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(lt,Ze){W(lt,e,Ze),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),R(n,g),R(g,x),R(g,C),ae(T,g,null),R(e,z),R(e,L),R(L,E),R(E,I),ae(O,I,null),R(E,B),R(E,K),ae(H,K,null),R(E,q),R(E,J),ae(he,J,null),R(E,Ee),R(E,Y),ae(oe,Y,null),R(E,ke),R(E,ye),ae(Ne,ye,null),R(E,Ue),Le&&Le.m(E,null),De=!0},p(lt,Ze){(!De||Ze[0]&16384)&&_!==(_=vr(lt[14].mode)+"")&&At(x,_);const at={};Ze[1]&524288&&(at.$$scope={dirty:Ze,ctx:lt}),T.$set(at);const dt={};Ze[0]&64&&(dt.mode={mode:"set-boundary",name:_r(lt[6]).properties.name,existing:_r(lt[6])}),Ne.$set(dt),lt[15]?Le?Ze[0]&32768&&N(Le,1):(Le=sb(lt),Le.c(),N(Le,1),Le.m(E,null)):Le&&(Kt(),V(Le,1,1,()=>{Le=null}),Jt())},i(lt){De||(N(o.$$.fragment,lt),N(d.$$.fragment,lt),N(T.$$.fragment,lt),N(O.$$.fragment,lt),N(H.$$.fragment,lt),N(he.$$.fragment,lt),N(oe.$$.fragment,lt),N(Ne.$$.fragment,lt),N(Le),De=!0)},o(lt){V(o.$$.fragment,lt),V(d.$$.fragment,lt),V(T.$$.fragment,lt),V(O.$$.fragment,lt),V(H.$$.fragment,lt),V(he.$$.fragment,lt),V(oe.$$.fragment,lt),V(Ne.$$.fragment,lt),V(Le),De=!1},d(lt){lt&&G(e),le(o),le(d),le(T),le(O),le(H),le(he),le(oe),le(Ne),Le&&Le.d()}}}function Lz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J,he,Ee,Y;return g=new Iw({}),L=new Lw({}),H=new G3({}),{c(){e=U("h3"),e.textContent="Reclassify main roads",t=ie(),n=U("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically using
          data from
          <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=ie(),o=U("p"),o.textContent=`Main roads are typically better suited to support higher levels of
          traffic than neighbourhood roads.`,u=ie(),s=U("div"),d=U("button"),p=U("div"),ue(g.$$.fragment),_=ie(),x=U("span"),x.textContent="Toggle segment or pan map",C=ie(),T=U("button"),z=U("div"),ue(L.$$.fragment),E=ie(),I=U("span"),I.textContent="Mark as main along a line",O=ie(),B=U("button"),K=U("div"),ue(H.$$.fragment),q=ie(),J=U("span"),J.textContent="Erase main classification",Ye(p,"display","flex"),Ye(p,"align-items","center"),Ye(p,"gap","8px"),fe(d,"data-tippy-content","Click a road to reclassify it"),Gt(d,"active",!r[0].freehand),Gt(d,"outline",r[0].freehand),Ye(z,"display","flex"),Ye(z,"align-items","center"),Ye(z,"gap","8px"),fe(T,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Gt(T,"active",r[0].freehand&&r[0].isMain),Gt(T,"outline",!(r[0].freehand&&r[0].isMain)),Ye(K,"display","flex"),Ye(K,"align-items","center"),Ye(K,"gap","8px"),fe(B,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Gt(B,"active",r[0].freehand&&!r[0].isMain),Gt(B,"outline",!(r[0].freehand&&!r[0].isMain)),fe(s,"class","classification-buttons svelte-b4nchc"),Ye(s,"display","flex"),Ye(s,"flex-direction","column"),Ye(s,"gap","8px"),Ye(s,"justify-content","left")},m(oe,ke){W(oe,e,ke),W(oe,t,ke),W(oe,n,ke),W(oe,i,ke),W(oe,o,ke),W(oe,u,ke),W(oe,s,ke),R(s,d),R(d,p),ae(g,p,null),R(p,_),R(p,x),R(s,C),R(s,T),R(T,z),ae(L,z,null),R(z,E),R(z,I),R(s,O),R(s,B),R(B,K),ae(H,K,null),R(K,q),R(K,J),he=!0,Ee||(Y=[Lt(d,"click",r[40]),Lt(T,"click",r[41]),Lt(B,"click",r[42])],Ee=!0)},p(oe,ke){(!he||ke[0]&1)&&Gt(d,"active",!oe[0].freehand),(!he||ke[0]&1)&&Gt(d,"outline",oe[0].freehand),(!he||ke[0]&1)&&Gt(T,"active",oe[0].freehand&&oe[0].isMain),(!he||ke[0]&1)&&Gt(T,"outline",!(oe[0].freehand&&oe[0].isMain)),(!he||ke[0]&1)&&Gt(B,"active",oe[0].freehand&&!oe[0].isMain),(!he||ke[0]&1)&&Gt(B,"outline",!(oe[0].freehand&&!oe[0].isMain))},i(oe){he||(N(g.$$.fragment,oe),N(L.$$.fragment,oe),N(H.$$.fragment,oe),he=!0)},o(oe){V(g.$$.fragment,oe),V(L.$$.fragment,oe),V(H.$$.fragment,oe),he=!1},d(oe){oe&&(G(e),G(t),G(n),G(i),G(o),G(u),G(s)),le(g),le(L),le(H),Ee=!1,hr(Y)}}}function Iz(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Restrict turns",t=ie(),n=U("p"),n.textContent=`To restrict certain turns, first click on the source road, then the
          destination road. Traffic will no longer be able to turn from the
          source road to the destination road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:ft,i:ft,o:ft,d(i){i&&(G(e),G(t),G(n))}}}function Pz(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Toggle one-way",t=ie(),n=U("p"),n.textContent=`Click on a road segment to toggle its direction. This will change the
          direction of traffic flow on that road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:ft,i:ft,o:ft,d(i){i&&(G(e),G(t),G(n))}}}function zz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I;function O(K){r[36](K)}let B={};return r[3]!==void 0&&(B.show=r[3]),o=new Az({props:B}),pn.push(()=>Dn(o,"show",O)),C=new Lw({}),{c(){e=U("h3"),e.textContent="Add modal filter",t=ie(),n=U("p"),n.textContent=`Modal filters restrict what kind of traffic can pass through a road
          segment. Place them strategically to deter shortcuts through your
          neighbourhood.`,i=ie(),ue(o.$$.fragment),s=ie(),d=U("div"),p=U("button"),p.textContent="Change modal filter type",g=ie(),_=U("button"),x=U("div"),ue(C.$$.fragment),T=ie(),z=U("span"),z.textContent="Add along a line",fe(p,"class","outline"),Ye(x,"display","flex"),Ye(x,"align-items","center"),Ye(x,"gap","8px"),fe(_,"data-tippy-content","Add many modal filters along a line"),Gt(_,"active",r[0].freehand),Gt(_,"outline",!r[0].freehand),Ye(d,"display","flex"),Ye(d,"gap","8px"),Ye(d,"align-items","leading"),Ye(d,"flex-direction","column"),Ye(d,"width","fit-content")},m(K,H){W(K,e,H),W(K,t,H),W(K,n,H),W(K,i,H),ae(o,K,H),W(K,s,H),W(K,d,H),R(d,p),R(d,g),R(d,_),R(_,x),ae(C,x,null),R(x,T),R(x,z),L=!0,E||(I=[Lt(p,"click",r[37]),Lt(_,"click",function(){ua(r[0].freehand?r[38]:r[39])&&(r[0].freehand?r[38]:r[39]).apply(this,arguments)})],E=!0)},p(K,H){r=K;const q={};!u&&H[0]&8&&(u=!0,q.show=r[3],zn(()=>u=!1)),o.$set(q),(!L||H[0]&1)&&Gt(_,"active",r[0].freehand),(!L||H[0]&1)&&Gt(_,"outline",!r[0].freehand)},i(K){L||(N(o.$$.fragment,K),N(C.$$.fragment,K),L=!0)},o(K){V(o.$$.fragment,K),V(C.$$.fragment,K),L=!1},d(K){K&&(G(e),G(t),G(n),G(i),G(s),G(d)),le(o,K),le(C),E=!1,hr(I)}}}function ab(r){let e;return{c(){e=U("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function lb(r){let e,t;return e=new wo({props:{colorScale:y2,labels:{limits:v2}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Dz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J,he,Ee,Y,oe,ke,ye,Ne,Ue,De,Le,lt,Ze,at,dt,pt,Je,xt,Mt,Ot,Yt,nn,Qt,fn,mn,qe,Ge,gt,et,de,en,Xe,it,Ut,Hn,jn,Nn,Wt,An,ti,Bn,yt,mr,or;I=new U4({}),q=new z4({});const gi=[zz,Pz,Iz,Lz],Un=[];function Fe(Dt,rn){return Dt[0].kind=="filter"?0:Dt[0].kind=="oneway"?1:Dt[0].kind=="turn_restriction"?2:Dt[0].kind=="main-roads"?3:-1}~(oe=Fe(r))&&(ke=Un[oe]=gi[oe](r));let mt=r[8]>0&&ab(),vt=r[13]=="speeds"&&lb();return Bn=new V2({props:{neighbourhoodBoundary:_r(r[6])}}),{c(){e=U("div"),t=U("h2"),t.textContent="Editing tools",n=ie(),i=U("div"),o=U("div"),u=U("button"),s=U("img"),p=ie(),g=U("button"),g.innerHTML=`<div style="height: 100%; width: 100%; position: relative;"><img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${eb}" alt="Reverse directions"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${eb}" alt="Reverse directions"/></div>`,_=ie(),x=U("button"),x.innerHTML=`<img src="${Eg}" alt="Restrict turns"/>`,C=ie(),T=U("button"),T.innerHTML=`<img src="${UP}" alt="Change main/minor roads"/>`,z=ie(),L=U("div"),E=U("button"),ue(I.$$.fragment),K=ie(),H=U("button"),ue(q.$$.fragment),Ee=ie(),Y=U("div"),ke&&ke.c(),ye=ie(),mt&&mt.c(),Ne=ie(),Ue=U("h2"),Ue.textContent="Map style",De=ie(),Le=U("label"),lt=U("input"),Ze=Te(`
      Animate shortcuts`),at=U("span"),dt=Te("1"),pt=ie(),Je=U("label"),xt=U("input"),Mt=Te(`
      Show entries into cells`),Ot=U("span"),Yt=Te("2"),nn=ie(),Qt=U("label"),fn=U("input"),mn=Te(`
      Road thickness depends on shortcuts`),qe=U("span"),Ge=Te("1"),gt=ie(),et=U("label"),de=U("span"),de.textContent="Draw roads:",en=ie(),Xe=U("select"),it=U("option"),it.textContent="Worst shortcuts",Ut=U("option"),Ut.textContent="Cell",Hn=U("option"),Hn.textContent="Edits (either filter or direction)",jn=U("option"),jn.textContent="Speed limit",Nn=ie(),vt&&vt.c(),Wt=ie(),An=U("h2"),An.textContent="Neighbourhood stats",ti=ie(),ue(Bn.$$.fragment),Sr(s.src,d=_r(zi.getFilter(r[9])).iconURL)||fe(s,"src",d),fe(s,"alt","Add a modal filter"),fe(u,"class","icon-btn"),fe(u,"data-tippy-content","Add a modal filter (hotkey 1)"),Gt(u,"active",r[0].kind=="filter"),fe(g,"class","icon-btn"),fe(g,"data-tippy-content","Toggle one-way (hotkey 2)"),Gt(g,"active",r[0].kind=="oneway"),fe(x,"class","icon-btn"),fe(x,"data-tippy-content","Restrict turns (hotkey 3)"),Gt(x,"active",r[0].kind=="turn_restriction"),fe(T,"class","icon-btn"),fe(T,"data-tippy-content","Reclassify main roads (hotkey 4)"),Gt(T,"active",r[0].kind=="main-roads"),Ye(o,"height","50px"),Ye(o,"display","flex"),Ye(o,"justify-content","left"),Ye(o,"gap","6px"),fe(E,"class","outline icon-btn"),E.disabled=O=r[4]==0,fe(E,"data-tippy-content",B=r[4]==0?"Undo Ctrl+Z":`Undo (${r[4]}) Ctrl+Z`),fe(H,"class","outline icon-btn"),H.disabled=J=r[5]==0,fe(H,"data-tippy-content",he=r[5]==0?"Redo Ctrl+Y":`Redo (${r[5]}) Ctrl+Y`),Ye(L,"height","50px"),Ye(L,"display","flex"),Ye(L,"justify-content","right"),Ye(L,"gap","6px"),fe(i,"class","tool-palette"),Ye(i,"display","flex"),Ye(i,"justify-content","space-between"),Ye(i,"flex-wrap","wrap"),Ye(i,"gap","6px"),Ye(Y,"min-height","200px"),Ye(Y,"padding-bottom","16px"),Ye(Y,"border-bottom","solid var(--pico-muted-border-color) 1px"),fe(lt,"type","checkbox"),fe(at,"class","footnote-ref svelte-b4nchc"),fe(at,"data-tippy-content",fb),fe(xt,"type","checkbox"),fe(Ot,"class","footnote-ref svelte-b4nchc"),fe(Ot,"data-tippy-content",t7),fe(fn,"type","checkbox"),fe(qe,"class","footnote-ref svelte-b4nchc"),fe(qe,"data-tippy-content",fb),Ye(de,"text-wrap","nowrap"),it.__value="shortcuts",Kn(it,it.__value),Ut.__value="cells",Kn(Ut,Ut.__value),Hn.__value="edits",Kn(Hn,Hn.__value),jn.__value="speeds",Kn(jn,jn.__value),Ye(Xe,"margin","0"),Ye(Xe,"padding","8px"),Ye(Xe,"width","auto"),r[13]===void 0&&ms(()=>r[46].call(Xe)),Ye(et,"display","flex"),Ye(et,"align-items","center"),Ye(et,"gap","8px"),Ye(et,"flex-wrap","wrap"),fe(e,"slot","sidebar")},m(Dt,rn){W(Dt,e,rn),R(e,t),R(e,n),R(e,i),R(i,o),R(o,u),R(u,s),R(o,p),R(o,g),R(o,_),R(o,x),R(o,C),R(o,T),R(i,z),R(i,L),R(L,E),ae(I,E,null),R(L,K),R(L,H),ae(q,H,null),R(e,Ee),R(e,Y),~oe&&Un[oe].m(Y,null),R(e,ye),mt&&mt.m(e,null),R(e,Ne),R(e,Ue),R(e,De),R(e,Le),R(Le,lt),lt.checked=r[10],R(Le,Ze),R(Le,at),R(at,dt),R(e,pt),R(e,Je),R(Je,xt),xt.checked=r[11],R(Je,Mt),R(Je,Ot),R(Ot,Yt),R(e,nn),R(e,Qt),R(Qt,fn),fn.checked=r[12],R(Qt,mn),R(Qt,qe),R(qe,Ge),R(e,gt),R(e,et),R(et,de),R(et,en),R(et,Xe),R(Xe,it),R(Xe,Ut),R(Xe,Hn),R(Xe,jn),Wi(Xe,r[13],!0),R(e,Nn),vt&&vt.m(e,null),R(e,Wt),R(e,An),R(e,ti),ae(Bn,e,null),yt=!0,mr||(or=[Lt(u,"click",r[32]),Lt(g,"click",r[33]),Lt(x,"click",r[34]),Lt(T,"click",r[35]),Lt(E,"click",r[24]),Lt(H,"click",r[25]),Lt(lt,"change",r[43]),Lt(xt,"change",r[44]),Lt(fn,"change",r[45]),Lt(Xe,"change",r[46])],mr=!0)},p(Dt,rn){(!yt||rn[0]&512&&!Sr(s.src,d=_r(zi.getFilter(Dt[9])).iconURL))&&fe(s,"src",d),(!yt||rn[0]&1)&&Gt(u,"active",Dt[0].kind=="filter"),(!yt||rn[0]&1)&&Gt(g,"active",Dt[0].kind=="oneway"),(!yt||rn[0]&1)&&Gt(x,"active",Dt[0].kind=="turn_restriction"),(!yt||rn[0]&1)&&Gt(T,"active",Dt[0].kind=="main-roads"),(!yt||rn[0]&16&&O!==(O=Dt[4]==0))&&(E.disabled=O),(!yt||rn[0]&16&&B!==(B=Dt[4]==0?"Undo Ctrl+Z":`Undo (${Dt[4]}) Ctrl+Z`))&&fe(E,"data-tippy-content",B),(!yt||rn[0]&32&&J!==(J=Dt[5]==0))&&(H.disabled=J),(!yt||rn[0]&32&&he!==(he=Dt[5]==0?"Redo Ctrl+Y":`Redo (${Dt[5]}) Ctrl+Y`))&&fe(H,"data-tippy-content",he);let tn=oe;oe=Fe(Dt),oe===tn?~oe&&Un[oe].p(Dt,rn):(ke&&(Kt(),V(Un[tn],1,1,()=>{Un[tn]=null}),Jt()),~oe?(ke=Un[oe],ke?ke.p(Dt,rn):(ke=Un[oe]=gi[oe](Dt),ke.c()),N(ke,1),ke.m(Y,null)):ke=null),Dt[8]>0?mt||(mt=ab(),mt.c(),mt.m(e,Ne)):mt&&(mt.d(1),mt=null),rn[0]&1024&&(lt.checked=Dt[10]),rn[0]&2048&&(xt.checked=Dt[11]),rn[0]&4096&&(fn.checked=Dt[12]),rn[0]&8192&&Wi(Xe,Dt[13]),Dt[13]=="speeds"?vt?rn[0]&8192&&N(vt,1):(vt=lb(),vt.c(),N(vt,1),vt.m(e,Wt)):vt&&(Kt(),V(vt,1,1,()=>{vt=null}),Jt());const br={};rn[0]&64&&(br.neighbourhoodBoundary=_r(Dt[6])),Bn.$set(br)},i(Dt){yt||(N(I.$$.fragment,Dt),N(q.$$.fragment,Dt),N(ke),N(vt),N(Bn.$$.fragment,Dt),yt=!0)},o(Dt){V(I.$$.fragment,Dt),V(q.$$.fragment,Dt),V(ke),V(vt),V(Bn.$$.fragment,Dt),yt=!1},d(Dt){Dt&&G(e),le(I),le(q),~oe&&Un[oe].d(),mt&&mt.d(),vt&&vt.d(),le(Bn),mr=!1,hr(or)}}}function Rz(r){let e,t,n=(r[49].name??"unnamed road")+"",i,o,u=Math.round(r[49].speed_mph)+"",s,d;return{c(){e=U("p"),t=Te("Main road: "),i=Te(n),o=Te(`
                (`),s=Te(u),d=Te(" mph)")},m(p,g){W(p,e,g),R(e,t),R(e,i),R(e,o),R(e,s),R(e,d)},p(p,g){g[1]&262144&&n!==(n=(p[49].name??"unnamed road")+"")&&At(i,n),g[1]&262144&&u!==(u=Math.round(p[49].speed_mph)+"")&&At(s,u)},d(p){p&&G(e)}}}function Bz(r){let e,t=r[49].shortcuts+"",n,i,o=(r[49].name??"unnamed road")+"",u,s,d=Math.round(r[49].speed_mph)+"",p,g;return{c(){e=U("p"),n=Te(t),i=Te(" shortcuts through "),u=Te(o),s=Te(`
                (`),p=Te(d),g=Te(" mph)")},m(_,x){W(_,e,x),R(e,n),R(e,i),R(e,u),R(e,s),R(e,p),R(e,g)},p(_,x){x[1]&262144&&t!==(t=_[49].shortcuts+"")&&At(n,t),x[1]&262144&&o!==(o=(_[49].name??"unnamed road")+"")&&At(u,o),x[1]&262144&&d!==(d=Math.round(_[49].speed_mph)+"")&&At(p,d)},d(_){_&&G(e)}}}function Fz(r){let e;return{c(){e=U("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function Oz(r){let e;return{c(){e=U("p"),e.textContent="Click to designate a main road or not"},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function $z(r){let e;return{c(){e=U("p"),e.textContent="Click to change direction"},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function Nz(r){let e,t,n,i;return{c(){e=U("div"),t=U("img"),i=Te(`
                Click to add modal filter`),Sr(t.src,n=_r(zi.getFilter(r[9])).iconURL)||fe(t,"src",n),fe(t,"width","20"),fe(t,"alt","Add modal filter")},m(o,u){W(o,e,u),R(e,t),R(e,i)},p(o,u){u[0]&512&&!Sr(t.src,n=_r(zi.getFilter(o[9])).iconURL)&&fe(t,"src",n)},d(o){o&&G(e)}}}function jz(r){let e,t;function n(p,g){if(p[49].kind=="interior_road")return Bz;if(p[49].kind=="main_road")return Rz}let i=n(r),o=i&&i(r);function u(p,g){if(p[0].kind=="filter")return Nz;if(p[0].kind=="oneway")return $z;if(p[0].kind=="main-roads"&&!p[0].freehand)return Oz;if(p[0].kind=="turn_restriction")return Fz}let s=u(r),d=s&&s(r);return{c(){o&&o.c(),e=ie(),d&&d.c(),t=rr()},m(p,g){o&&o.m(p,g),W(p,e,g),d&&d.m(p,g),W(p,t,g)},p(p,g){i===(i=n(p))&&o?o.p(p,g):(o&&o.d(1),o=i&&i(p),o&&(o.c(),o.m(e.parentNode,e))),s===(s=u(p))&&d?d.p(p,g):(d&&d.d(1),d=s&&s(p),d&&(d.c(),d.m(t.parentNode,t)))},d(p){p&&(G(e),G(t)),o&&o.d(p),d&&d.d(p)}}}function Uz(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[jz,({props:i})=>({49:i}),({props:i})=>[0,i?262144:0]]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","line-popup")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[0]&513|o[1]&786432&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function Vz(r){let e,t,n,i,o,u,s,d,p,g;return e=new dp({}),n=new hp({}),o=new pp({}),s=new hh({props:{interactive:r[0].kind=="filter"&&!r[0].freehand||r[0].kind=="oneway"||r[0].kind=="main-roads"&&!r[0].freehand||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[17],$$slots:{"line-popup":[Uz]},$$scope:{ctx:r}}}),p=new vz({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[22]}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment),d=ie(),ue(p.$$.fragment)},m(_,x){ae(e,_,x),W(_,t,x),ae(n,_,x),W(_,i,x),ae(o,_,x),W(_,u,x),ae(s,_,x),W(_,d,x),ae(p,_,x),g=!0},p(_,x){const C={};x[0]&1&&(C.interactive=_[0].kind=="filter"&&!_[0].freehand||_[0].kind=="oneway"||_[0].kind=="main-roads"&&!_[0].freehand||_[0].kind=="turn_restriction"&&_[0].from_road_id==null),x[0]&513|x[1]&524288&&(C.$$scope={dirty:x,ctx:_}),s.$set(C);const T={};x[0]&1&&(T.interactive=_[0].kind=="filter"),x[0]&2&&(T.neighbourhood=_[1]),p.$set(T)},i(_){g||(N(e.$$.fragment,_),N(n.$$.fragment,_),N(o.$$.fragment,_),N(s.$$.fragment,_),N(p.$$.fragment,_),g=!0)},o(_){V(e.$$.fragment,_),V(n.$$.fragment,_),V(o.$$.fragment,_),V(s.$$.fragment,_),V(p.$$.fragment,_),g=!1},d(_){_&&(G(t),G(i),G(u),G(d)),le(e,_),le(n,_),le(o,_),le(s,_),le(p,_)}}}function ub(r){let e,t;return e=new sz({props:{paths:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.paths=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function qz(r){let e;return{c(){e=Te("Click to delete filter")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Hz(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[qz]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","modal-filter")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[1]&524288&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function Gz(r){let e;return{c(){e=Te("Click to delete turn restriction")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function Wz(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[Gz]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","turn-restriction")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[1]&524288&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function Zz(r){let e,t;return e=new X2({props:{map:_r(r[2])}}),e.$on("done",r[30]),e.$on("progress",r[31]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=_r(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Xz(r){let e,t;return e=new X2({props:{map:_r(r[2])}}),e.$on("done",r[26]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=_r(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cb(r){let e,t;return e=new yr({props:{data:r[0].possible_targets||Ji(),generateId:!0,$$slots:{default:[Yz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||Ji()),i[0]&1|i[1]&524288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Kz(r){let e,t,n,i,o=r[0].from_road_name+"",u,s,d=(r[49].name||"unnamed road")+"",p;return{c(){e=U("div"),t=U("img"),i=Te(`

              Create a turn restriction from `),u=Te(o),s=Te(" to "),p=Te(d),Sr(t.src,n=r[28][r[49].kind])||fe(t,"src",n),fe(t,"width","20"),fe(t,"alt","Add turn restriction")},m(g,_){W(g,e,_),R(e,t),R(e,i),R(e,u),R(e,s),R(e,p)},p(g,_){_[1]&262144&&!Sr(t.src,n=g[28][g[49].kind])&&fe(t,"src",n),_[0]&1&&o!==(o=g[0].from_road_name+"")&&At(u,o),_[1]&262144&&d!==(d=(g[49].name||"unnamed road")+"")&&At(p,d)},d(g){g&&G(e)}}}function Jz(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[Kz,({props:n})=>({49:n}),({props:n})=>[0,n?262144:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Yz(r){let e,t;const n=[yn("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":Xn(.5,1),"line-width":na(1)}}];let i={$$slots:{default:[Jz]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),e.$on("click",r[19]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};u[0]&1|u[1]&524288&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Qz(r){let e,t,n,i,o,u,s,d,p,g,_,x;t=new Vg({}),t.$on("click",r[18]),i=new dh({props:{input:r[1],$$slots:{default:[Vz]},$$scope:{ctx:r}}});let C=r[10]&&ub(r);s=new Ya({props:{onClickModalFilter:r[20],onClickTurnRestriction:r[21],interactive:r[0].kind=="filter",$$slots:{"turn-restriction":[Wz],"modal-filter":[Hz]},$$scope:{ctx:r}}});const T=[Xz,Zz],z=[];function L(I,O){return I[0].kind=="filter"&&I[0].freehand?0:I[0].kind=="main-roads"&&I[0].freehand?1:-1}~(p=L(r))&&(g=z[p]=T[p](r));let E=r[0].kind=="turn_restriction"&&cb(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),o=ie(),C&&C.c(),u=ie(),ue(s.$$.fragment),d=ie(),g&&g.c(),_=ie(),E&&E.c(),fe(e,"slot","map")},m(I,O){W(I,e,O),ae(t,e,null),R(e,n),ae(i,e,null),R(e,o),C&&C.m(e,null),R(e,u),ae(s,e,null),R(e,d),~p&&z[p].m(e,null),R(e,_),E&&E.m(e,null),x=!0},p(I,O){const B={};O[0]&2&&(B.input=I[1]),O[0]&515|O[1]&524288&&(B.$$scope={dirty:O,ctx:I}),i.$set(B),I[10]?C?(C.p(I,O),O[0]&1024&&N(C,1)):(C=ub(I),C.c(),N(C,1),C.m(e,u)):C&&(Kt(),V(C,1,1,()=>{C=null}),Jt());const K={};O[0]&1&&(K.interactive=I[0].kind=="filter"),O[1]&524288&&(K.$$scope={dirty:O,ctx:I}),s.$set(K);let H=p;p=L(I),p===H?~p&&z[p].p(I,O):(g&&(Kt(),V(z[H],1,1,()=>{z[H]=null}),Jt()),~p?(g=z[p],g?g.p(I,O):(g=z[p]=T[p](I),g.c()),N(g,1),g.m(e,_)):g=null),I[0].kind=="turn_restriction"?E?(E.p(I,O),O[0]&1&&N(E,1)):(E=cb(I),E.c(),N(E,1),E.m(e,null)):E&&(Kt(),V(E,1,1,()=>{E=null}),Jt())},i(I){x||(N(t.$$.fragment,I),N(i.$$.fragment,I),N(C),N(s.$$.fragment,I),N(g),N(E),x=!0)},o(I){V(t.$$.fragment,I),V(i.$$.fragment,I),V(C),V(s.$$.fragment,I),V(g),V(E),x=!1},d(I){I&&G(e),le(t),le(i),C&&C.d(),le(s),~p&&z[p].d(),E&&E.d()}}}function e7(r){let e,t,n,i;return e=new xo({props:{$$slots:{map:[Qz],sidebar:[Dz],top:[Ez]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=Lt(window,"keydown",r[23]),n=!0)},p(o,u){const s={};u[0]&65535|u[1]&524288&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}let fb="Shortcuts are routes from one main road to another, which cut through the neighborhood's interior.",t7="Cells are the colored area reachable without travelling along a main road.";function n7(r,e,t){let n,i,o,u,s,d,p,g,_,x,C;st(r,Gi,et=>t(29,i=et)),st(r,kr,et=>t(47,o=et)),st(r,Hm,et=>t(9,u=et)),st(r,is,et=>t(2,s=et)),st(r,ry,et=>t(10,d=et)),st(r,Gm,et=>t(11,p=et)),st(r,Wm,et=>t(12,g=et)),st(r,Jd,et=>t(13,_=et)),st(r,nr,et=>t(14,x=et)),st(r,If,et=>t(15,C=et));function T(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:Ji()}}let z={kind:"filter",freehand:!1},L=!1,E=0,I=0,O,B,K=o.getAllShortcuts();ws(()=>{w2()}),ei(()=>{s.doubleClickZoom.enable()});function H(et){t(1,B=o.renderNeighbourhood()),t(6,O=B.features.find(de=>de.properties.kind=="boundary")),t(4,E=B.undo_length),t(5,I=B.redo_length),t(7,K=o.getAllShortcuts()),jf()}function q(et,de){z.kind=="filter"?(o.addModalFilter(de,u),cn(Gi,i++,i)):z.kind=="oneway"?(o.toggleTravelFlow(et.properties.road),cn(Gi,i++,i)):z.kind=="main-roads"&&!z.freehand?(o.toggleMainRoad(et.properties.road),cn(Gi,i++,i)):z.kind=="turn_restriction"&&(t(0,z.from_road_id=et.properties.road,z),t(0,z.from_road_name=et.properties.name||"unnamed road",z),t(0,z.possible_targets=o.getTurnRestrictionTargets(et.properties.road),z))}function J(et){z.kind=="turn_restriction"&&(s.queryRenderedFeatures(et.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,z=T()))}function he(et){if(z.kind=="turn_restriction"&&z.from_road_id!=null){let de=et.detail.features[0].properties.road;o.addTurnRestriction(z.from_road_id,de),cn(Gi,i++,i)}t(0,z=T())}function Ee(et){let de=et.detail.features[0];o.deleteModalFilter(de.properties.road),cn(Gi,i++,i)}function Y(et){let de=et.detail.features[0];o.deleteTurnRestriction(de.properties.intersection,de.properties.from_road,de.properties.to_road),cn(Gi,i++,i)}function oe(et){if(z.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${z.kind}`);return}et.hasRotatedFilter?(o.deleteDiagonalFilter(et),cn(Gi,i++,i)):et.filter?(o.rotateDiagonalFilter(et),cn(Gi,i++,i)):(o.addDiagonalFilter(et),cn(Gi,i++,i))}function ke(et){et.target.tagName!="INPUT"&&(et.ctrlKey&&et.key=="z"&&ye(),et.ctrlKey&&et.key=="y"&&Ne(),et.key=="1"&&t(0,z={kind:"filter",freehand:!1}),et.key=="2"&&t(0,z={kind:"oneway"}),et.key=="3"&&t(0,z=T()),et.key=="4"&&t(0,z={kind:"main-roads",freehand:!1,isMain:!1}))}function ye(){o.undo(),cn(Gi,i++,i)}function Ne(){o.redo(),cn(Gi,i++,i)}function Ue(et){let de=et.detail;de&&(o.addManyModalFilters(de,u),cn(Gi,i++,i)),t(0,z={kind:"filter",freehand:!1})}function De(et,de){if(z.kind!="main-roads"){console.assert(!1,"cant paint line unless in main-roads mode");return}let en=et.detail;en&&(o.reclassifyRoadsAlongLine(en,z.isMain,de),cn(Gi,i++,i))}let Le={left:nw,right:Eg,straight:rw,u_left_to_right:ow,u_right_to_left:iw};const lt=et=>De(et,!0),Ze=et=>De(et,!1),at=()=>t(0,z={kind:"filter",freehand:!1}),dt=()=>t(0,z={kind:"oneway"}),pt=()=>t(0,z=T()),Je=()=>t(0,z={kind:"main-roads",freehand:!1,isMain:!1});function xt(et){L=et,t(3,L)}const Mt=()=>t(3,L=!0),Ot=()=>t(0,z={kind:"filter",freehand:!1}),Yt=()=>t(0,z={kind:"filter",freehand:!0}),nn=()=>{t(0,z={kind:"main-roads",freehand:!1,isMain:!0})},Qt=()=>{t(0,z={kind:"main-roads",freehand:!0,isMain:!0})},fn=()=>{t(0,z={kind:"main-roads",freehand:!0,isMain:!1})};function mn(){d=this.checked,ry.set(d)}function qe(){p=this.checked,Gm.set(p)}function Ge(){g=this.checked,Wm.set(g)}function gt(){_=za(this),Jd.set(_)}return r.$$.update=()=>{r.$$.dirty[0]&5&&(z.kind=="oneway"||z.kind=="main-roads"?s.doubleClickZoom.disable():s.doubleClickZoom.enable()),r.$$.dirty[0]&5&&(z.kind=="filter"&&z.freehand||z.kind=="main-roads"&&z.freehand&&z.isMain?s.getCanvas().style.cursor=`url(${jP}) 8 22, cell`:z.kind=="main-roads"&&z.freehand&&!z.isMain?s.getCanvas().style.cursor=`url(${NP}) 8 22, cell`:s.getCanvas().style.cursor=""),r.$$.dirty[0]&536870912&&H(),r.$$.dirty[0]&2&&t(8,n=B.features.filter(et=>et.properties.kind=="cell"&&et.properties.cell_color=="disconnected").length)},[z,B,s,L,E,I,O,K,n,u,d,p,g,_,x,C,T,q,J,he,Ee,Y,oe,ke,ye,Ne,Ue,De,Le,i,lt,Ze,at,dt,pt,Je,xt,Mt,Ot,Yt,nn,Qt,fn,mn,qe,Ge,gt]}class r7 extends Tt{constructor(e){super(),Ct(this,e,n7,e7,wt,{},null,[-1,-1])}}function hb(r){let e,t,n;return t=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function i7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z=vr(r[5].mode)+"",L,E;o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}});let I=r[0]=="neighbourhood"&&hb();return x=new $n({props:{mode:{mode:"predict-impact",prevMode:r[0]}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),I&&I.c(),g=ie(),_=U("li"),ue(x.$$.fragment),C=ie(),T=U("li"),L=Te(z),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(O,B){W(O,e,B),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),I&&I.m(n,null),R(n,g),R(n,_),ae(x,_,null),R(n,C),R(n,T),R(T,L),E=!0},p(O,B){O[0]=="neighbourhood"?I?B&1&&N(I,1):(I=hb(),I.c(),N(I,1),I.m(n,g)):I&&(Kt(),V(I,1,1,()=>{I=null}),Jt());const K={};B&1&&(K.mode={mode:"predict-impact",prevMode:O[0]}),x.$set(K),(!E||B&32)&&z!==(z=vr(O[5].mode)+"")&&At(L,z)},i(O){E||(N(o.$$.fragment,O),N(d.$$.fragment,O),N(I),N(x.$$.fragment,O),E=!0)},o(O){V(o.$$.fragment,O),V(d.$$.fragment,O),V(I),V(x.$$.fragment,O),E=!1},d(O){O&&G(e),le(o),le(d),I&&I.d(),le(x)}}}function db(r){let e,t,n,i,o,u,s;function d(C){r[10](C)}let p={list:r[2]};r[3]!==void 0&&(p.idx=r[3]),e=new fp({props:p}),pn.push(()=>Dn(e,"idx",d));let g=r[2][r[3]].count>1&&pb(r),_=r[2][r[3]].before==null&&mb(),x=r[2][r[3]].after==null&&gb();return{c(){ue(e.$$.fragment),n=ie(),g&&g.c(),i=ie(),_&&_.c(),o=ie(),x&&x.c(),u=rr()},m(C,T){ae(e,C,T),W(C,n,T),g&&g.m(C,T),W(C,i,T),_&&_.m(C,T),W(C,o,T),x&&x.m(C,T),W(C,u,T),s=!0},p(C,T){const z={};T&4&&(z.list=C[2]),!t&&T&8&&(t=!0,z.idx=C[3],zn(()=>t=!1)),e.$set(z),C[2][C[3]].count>1?g?g.p(C,T):(g=pb(C),g.c(),g.m(i.parentNode,i)):g&&(g.d(1),g=null),C[2][C[3]].before==null?_||(_=mb(),_.c(),_.m(o.parentNode,o)):_&&(_.d(1),_=null),C[2][C[3]].after==null?x||(x=gb(),x.c(),x.m(u.parentNode,u)):x&&(x.d(1),x=null)},i(C){s||(N(e.$$.fragment,C),s=!0)},o(C){V(e.$$.fragment,C),s=!1},d(C){C&&(G(n),G(i),G(o),G(u)),le(e,C),g&&g.d(C),_&&_.d(C),x&&x.d(C)}}}function pb(r){let e,t,n=r[2][r[3]].count.toLocaleString()+"",i,o,u,s;return{c(){e=U("p"),t=Te(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=Te(n),o=Te(` trips between the
          same points.`),u=ie(),s=U("i"),s.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(d,p){W(d,e,p),R(e,t),R(e,i),R(e,o),W(d,u,p),W(d,s,p)},p(d,p){p&12&&n!==(n=d[2][d[3]].count.toLocaleString()+"")&&At(i,n)},d(d){d&&(G(e),G(u),G(s))}}}function mb(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,Ye(e,"color","red")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function gb(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,Ye(e,"color","blue")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function o7(r){let e,t,n,i,o=r[1].before.toLocaleString()+"",u,s,d,p,g=r[1].after.toLocaleString()+"",_,x,C,T,z=Math.round(100*r[1].after/r[1].before)+"",L,E,I,O;t=new Ns({props:{mode:{mode:"predict-impact",prevMode:r[0]}}});let B=r[2].length>0&&db(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),u=Te(o),s=Te(` routes cross here
      `),d=U("span"),d.textContent="before your changes",p=Te(`
      , and `),_=Te(g),x=ie(),C=U("span"),C.textContent="after your changes",T=Te(`
      . That's
      `),L=Te(z),E=Te("% of the original traffic."),I=ie(),B&&B.c(),Ye(d,"color","red"),Ye(C,"color","blue"),fe(e,"slot","sidebar")},m(K,H){W(K,e,H),ae(t,e,null),R(e,n),R(e,i),R(i,u),R(i,s),R(i,d),R(i,p),R(i,_),R(i,x),R(i,C),R(i,T),R(i,L),R(i,E),R(e,I),B&&B.m(e,null),O=!0},p(K,H){const q={};H&1&&(q.mode={mode:"predict-impact",prevMode:K[0]}),t.$set(q),(!O||H&2)&&o!==(o=K[1].before.toLocaleString()+"")&&At(u,o),(!O||H&2)&&g!==(g=K[1].after.toLocaleString()+"")&&At(_,g),(!O||H&2)&&z!==(z=Math.round(100*K[1].after/K[1].before)+"")&&At(L,z),K[2].length>0?B?(B.p(K,H),H&4&&N(B,1)):(B=db(K),B.c(),N(B,1),B.m(e,null)):B&&(Kt(),V(B,1,1,()=>{B=null}),Jt())},i(K){O||(N(t.$$.fragment,K),N(B),O=!0)},o(K){V(t.$$.fragment,K),V(B),O=!1},d(K){K&&G(e),le(t),B&&B.d()}}}function _b(r){let e,t,n,i,o,u;return e=new yr({props:{data:r[6](r[3]),$$slots:{default:[s7]},$$scope:{ctx:r}}}),n=new Rl({props:{lngLat:r[7](r[3]),$$slots:{default:[a7]},$$scope:{ctx:r}}}),o=new Rl({props:{lngLat:r[8](r[3]),$$slots:{default:[l7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment)},m(s,d){ae(e,s,d),W(s,t,d),ae(n,s,d),W(s,i,d),ae(o,s,d),u=!0},p(s,d){const p={};d&8&&(p.data=s[6](s[3])),d&8192&&(p.$$scope={dirty:d,ctx:s}),e.$set(p);const g={};d&8&&(g.lngLat=s[7](s[3])),d&8192&&(g.$$scope={dirty:d,ctx:s}),n.$set(g);const _={};d&8&&(_.lngLat=s[8](s[3])),d&8192&&(_.$$scope={dirty:d,ctx:s}),o.$set(_)},i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(G(t),G(i)),le(e,s),le(n,s),le(o,s)}}}function s7(r){let e,t;const n=[yn("predict-impact"),{paint:{"line-width":Oo(["get","kind"],{focus:8},5),"line-color":Oo(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Oo(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function a7(r){let e;return{c(){e=Te("A")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function l7(r){let e;return{c(){e=Te("B")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function u7(r){let e,t,n,i,o=r[2].length>0&&_b(r);return n=new Ya({props:{interactive:!1}}),{c(){e=U("div"),o&&o.c(),t=ie(),ue(n.$$.fragment),fe(e,"slot","map")},m(u,s){W(u,e,s),o&&o.m(e,null),R(e,t),ae(n,e,null),i=!0},p(u,s){u[2].length>0?o?(o.p(u,s),s&4&&N(o,1)):(o=_b(u),o.c(),N(o,1),o.m(e,t)):o&&(Kt(),V(o,1,1,()=>{o=null}),Jt())},i(u){i||(N(o),N(n.$$.fragment,u),i=!0)},o(u){V(o),V(n.$$.fragment,u),i=!1},d(u){u&&G(e),o&&o.d(),le(n)}}}function c7(r){let e,t,n,i;return e=new sh({props:{loading:r[4]}}),n=new xo({props:{$$slots:{map:[u7],sidebar:[o7],top:[i7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&16&&(s.loading=o[4]),e.$set(s);const d={};u&8239&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function f7(r,e,t){let n,i,o;st(r,nr,L=>t(5,n=L)),st(r,Zm,L=>t(11,i=L)),st(r,kr,L=>t(12,o=L));let{road:u}=e,{prevPrevMode:s}=e,d=u.properties;d.kind="focus";let p=[],g=0,_="Finding changes to this road";ws(async()=>{await new Promise(L=>{requestAnimationFrame(()=>{requestAnimationFrame(L)})}),t(2,p=o.getImpactsOnRoad(d.id,i)),t(4,_=""),p.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),cn(nr,n={mode:"predict-impact",prevMode:s},n))});function x(L){return{type:"FeatureCollection",features:[p[L].before,p[L].after,u].filter(E=>E!=null)}}function C(L){return p[L].before!=null?p[L].before.geometry.coordinates[0]:p[L].after.geometry.coordinates[0]}function T(L){let E=p[L].before!=null?p[L].before.geometry.coordinates:p[L].after.geometry.coordinates;return E[E.length-1]}function z(L){g=L,t(3,g)}return r.$$set=L=>{"road"in L&&t(9,u=L.road),"prevPrevMode"in L&&t(0,s=L.prevPrevMode)},[s,d,p,g,_,n,x,C,T,u,z]}class h7 extends Tt{constructor(e){super(),Ct(this,e,f7,c7,wt,{road:9,prevPrevMode:0})}}function d7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=vr(r[6].mode)+"",z,L;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),_=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Te(T),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(E,I){W(E,e,I),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),R(n,g),ae(_,g,null),R(n,x),R(n,C),R(C,z),L=!0},p(E,I){(!L||I&64)&&T!==(T=vr(E[6].mode)+"")&&At(z,T)},i(E){L||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(d),le(_)}}}function p7(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function m7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function g7(r){let e,t=Oa(r[4].properties.distance)+"",n,i,o=$a(r[4].properties.time)+"",u;return{c(){e=U("p"),n=Te(t),i=Te(", "),u=Te(o)},m(s,d){W(s,e,d),R(e,n),R(e,i),R(e,u)},p(s,d){d&16&&t!==(t=Oa(s[4].properties.distance)+"")&&At(n,t),d&16&&o!==(o=$a(s[4].properties.time)+"")&&At(u,o)},d(s){s&&G(e)}}}function _7(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function y7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function v7(r){let e,t=Oa(r[3].properties.distance)+"",n,i,o=$a(r[3].properties.time)+"",u;return{c(){e=U("p"),n=Te(t),i=Te(", "),u=Te(o)},m(s,d){W(s,e,d),R(e,n),R(e,i),R(e,u)},p(s,d){d&8&&t!==(t=Oa(s[3].properties.distance)+"")&&At(n,t),d&8&&o!==(o=$a(s[3].properties.time)+"")&&At(u,o)},d(s){s&&G(e)}}}function b7(r){let e,t,n,i,o,u,s,d,p,g,_;t=new Ns({props:{mode:{mode:"neighbourhood"}}});function x(I,O){return I[4]?g7:I[3]?m7:p7}let C=x(r),T=C(r);function z(I,O){return I[3]?v7:I[4]?y7:_7}let L=z(r),E=L(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=ie(),u=U("u"),u.textContent="Route before changes",s=ie(),T.c(),d=ie(),p=U("u"),p.textContent="Route after changes",g=ie(),E.c(),Ye(u,"color","red"),Ye(p,"color","blue"),fe(e,"slot","sidebar")},m(I,O){W(I,e,O),ae(t,e,null),R(e,n),R(e,i),R(e,o),R(e,u),R(e,s),T.m(e,null),R(e,d),R(e,p),R(e,g),E.m(e,null),_=!0},p(I,O){C===(C=x(I))&&T?T.p(I,O):(T.d(1),T=C(I),T&&(T.c(),T.m(e,d))),L===(L=z(I))&&E?E.p(I,O):(E.d(1),E=L(I),E&&(E.c(),E.m(e,null)))},i(I){_||(N(t.$$.fragment,I),_=!0)},o(I){V(t.$$.fragment,I),_=!1},d(I){I&&G(e),le(t),T.d(),E.d()}}}function w7(r){let e,t;const n=[yn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new Xi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function x7(r){let e,t,n=(r[16].time_after/r[16].time_before).toFixed(1)+"",i;return{c(){e=U("p"),t=Te("Time ratio: "),i=Te(n)},m(o,u){W(o,e,u),R(e,t),R(e,i)},p(o,u){u&65536&&n!==(n=(o[16].time_after/o[16].time_before).toFixed(1)+"")&&At(i,n)},d(o){o&&G(e)}}}function A7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[x7,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function k7(r){let e,t,n;const i=[yn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(s){r[10](s)}let u={$$slots:{default:[A7]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=It(u,i[s]);return r[0]!==void 0&&(u.hovered=r[0]),e=new cr({props:u}),pn.push(()=>Dn(e,"hovered",o)),e.$on("click",r[11]),{c(){ue(e.$$.fragment)},m(s,d){ae(e,s,d),n=!0},p(s,d){const p=d&32?Mn(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};d&131072&&(p.$$scope={dirty:d,ctx:s}),!t&&d&1&&(t=!0,p.hovered=s[0],zn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function S7(r){let e,t;const n=[yn("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Oo(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function C7(r){let e;return{c(){e=Te("X")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function T7(r){let e,t,n,i,o,u,s,d,p,g,_,x;t=new dh({props:{$$slots:{default:[w7]},$$scope:{ctx:r}}}),i=new yr({props:{data:r[5],generateId:!0,$$slots:{default:[k7]},$$scope:{ctx:r}}}),u=new yr({props:{data:r[1],$$slots:{default:[S7]},$$scope:{ctx:r}}}),d=new Ya({props:{interactive:!1}});function C(z){r[12](z)}let T={draggable:!0,$$slots:{default:[C7]},$$scope:{ctx:r}};return r[2]!==void 0&&(T.lngLat=r[2]),g=new Rl({props:T}),pn.push(()=>Dn(g,"lngLat",C)),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),o=ie(),ue(u.$$.fragment),s=ie(),ue(d.$$.fragment),p=ie(),ue(g.$$.fragment),fe(e,"slot","map")},m(z,L){W(z,e,L),ae(t,e,null),R(e,n),ae(i,e,null),R(e,o),ae(u,e,null),R(e,s),ae(d,e,null),R(e,p),ae(g,e,null),x=!0},p(z,L){const E={};L&131072&&(E.$$scope={dirty:L,ctx:z}),t.$set(E);const I={};L&32&&(I.data=z[5]),L&131105&&(I.$$scope={dirty:L,ctx:z}),i.$set(I);const O={};L&2&&(O.data=z[1]),L&131072&&(O.$$scope={dirty:L,ctx:z}),u.$set(O);const B={};L&131072&&(B.$$scope={dirty:L,ctx:z}),!_&&L&4&&(_=!0,B.lngLat=z[2],zn(()=>_=!1)),g.$set(B)},i(z){x||(N(t.$$.fragment,z),N(i.$$.fragment,z),N(u.$$.fragment,z),N(d.$$.fragment,z),N(g.$$.fragment,z),x=!0)},o(z){V(t.$$.fragment,z),V(i.$$.fragment,z),V(u.$$.fragment,z),V(d.$$.fragment,z),V(g.$$.fragment,z),x=!1},d(z){z&&G(e),le(t),le(i),le(u),le(d),le(g)}}}function M7(r){let e,t,n,i;return e=new Vg({}),e.$on("contextmenu",r[8]),n=new xo({props:{$$slots:{map:[T7],sidebar:[b7],top:[d7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&131199&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function E7(r,e,t){let n,i,o,u,s,d,p,g,_;st(r,xd,O=>t(2,s=O)),st(r,nr,O=>t(6,d=O)),st(r,Lf,O=>t(13,p=O)),st(r,Ef,O=>t(14,g=O)),st(r,kr,O=>t(9,_=O));let x=null;ws(()=>{setTimeout(()=>{s&&Km(xd)},10)});function C(O){return O?_.compareRoute(new oa.LngLat(O.properties.pt1_x,O.properties.pt1_y),s,1):Ji()}function T(O){cn(Ef,g=new oa.LngLat(O.properties.pt1_x,O.properties.pt1_y),g),cn(Lf,p=s,p),cn(nr,d={mode:"route",prevMode:"impact-one-destination"},d)}function z(O){cn(xd,s=O.detail.lngLat,s)}function L(O){x=O,t(0,x)}const E=O=>T(O.detail.features[0]);function I(O){s=O,xd.set(s)}return r.$$.update=()=>{r.$$.dirty&516&&t(5,n=_.impactToOneDestination(s)),r.$$.dirty&1&&t(1,i=C(x)),r.$$.dirty&2&&t(4,o=i.features.find(O=>O.properties.kind=="before")),r.$$.dirty&2&&t(3,u=i.features.find(O=>O.properties.kind=="after"))},[x,i,s,u,o,n,d,T,z,_,L,E,I]}class L7 extends Tt{constructor(e){super(),Ct(this,e,E7,M7,wt,{})}}function yb(r,e,t){const n=r.slice();return n[28]=e[t].properties.name,n}function I7(r){let e;return{c(){e=U("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function vb(r){let e,t,n;return t=new $n({props:{mode:{mode:"debug-intersections"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function P7(r){let e,t,n,i,o,u,s,d=vr(r[5].mode)+"",p,g,_,x,C,T,z,L,E,I,O,B,K;o=new $n({props:{mode:{mode:"title"}}}),_=new e_({props:{$$slots:{default:[I7]},$$scope:{ctx:r}}}),L=new $n({props:{mode:{mode:"route",prevMode:"pick-neighbourhood"}}}),O=new $n({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}});let H=r[8]&&vb();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),p=Te(d),g=ie(),ue(_.$$.fragment),x=ie(),C=U("nav"),T=U("ul"),z=U("li"),ue(L.$$.fragment),E=ie(),I=U("li"),ue(O.$$.fragment),B=ie(),H&&H.c(),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top"),Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(q,J){W(q,e,J),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),R(s,p),R(s,g),ae(_,s,null),R(e,x),R(e,C),R(C,T),R(T,z),ae(L,z,null),R(T,E),R(T,I),ae(O,I,null),R(T,B),H&&H.m(T,null),K=!0},p(q,J){(!K||J[0]&32)&&d!==(d=vr(q[5].mode)+"")&&At(p,d);const he={};J[1]&1&&(he.$$scope={dirty:J,ctx:q}),_.$set(he),q[8]?H?J[0]&256&&N(H,1):(H=vb(),H.c(),N(H,1),H.m(T,null)):H&&(Kt(),V(H,1,1,()=>{H=null}),Jt())},i(q){K||(N(o.$$.fragment,q),N(_.$$.fragment,q),N(L.$$.fragment,q),N(O.$$.fragment,q),N(H),K=!0)},o(q){V(o.$$.fragment,q),V(_.$$.fragment,q),V(L.$$.fragment,q),V(O.$$.fragment,q),V(H),K=!1},d(q){q&&G(e),le(o),le(_),le(L),le(O),H&&H.d()}}}function z7(r){let e=r[28]+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i[0]&1&&e!==(e=n[28]+"")&&At(t,e)},d(n){n&&G(t)}}}function bb(r){let e,t,n,i,o,u,s,d,p,g,_,x,C;function T(){return r[19](r[28])}n=new oh({props:{$$slots:{default:[z7]},$$scope:{ctx:r}}}),n.$on("click",T),s=new $g({props:{color:"black"}});function z(){return r[20](r[28])}g=new Ng({props:{color:"white"}});function L(){return r[21](r[28])}function E(){return r[22](r[28])}return{c(){var I;e=U("li"),t=U("h3"),ue(n.$$.fragment),i=ie(),o=U("span"),u=U("button"),ue(s.$$.fragment),d=ie(),p=U("button"),ue(g.$$.fragment),fe(u,"class","outline icon-btn"),fe(u,"title","Rename neighbourhood"),fe(p,"class","icon-btn destructive"),fe(p,"title","Delete neighbourhood"),fe(o,"class","actions"),fe(e,"class","actionable-cell svelte-qhjp0j"),Gt(e,"highlighted",((I=r[3])==null?void 0:I.properties.name)==r[28]||r[2]==r[28])},m(I,O){W(I,e,O),R(e,t),ae(n,t,null),R(e,i),R(e,o),R(o,u),ae(s,u,null),R(o,d),R(o,p),ae(g,p,null),_=!0,x||(C=[Lt(u,"click",z),Lt(p,"click",L),Lt(e,"mouseenter",E),Lt(e,"mouseleave",r[23])],x=!0)},p(I,O){var K;r=I;const B={};O[0]&1|O[1]&1&&(B.$$scope={dirty:O,ctx:r}),n.$set(B),(!_||O[0]&13)&&Gt(e,"highlighted",((K=r[3])==null?void 0:K.properties.name)==r[28]||r[2]==r[28])},i(I){_||(N(n.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),_=!0)},o(I){V(n.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),_=!1},d(I){I&&G(e),le(n),le(s),le(g),x=!1,hr(C)}}}function D7(r){let e,t,n;return e=new j3({}),{c(){ue(e.$$.fragment),t=Te(`
          Add a new neighbourhood`)},m(i,o){ae(e,i,o),W(i,t,o),n=!0},i(i){n||(N(e.$$.fragment,i),n=!0)},o(i){V(e.$$.fragment,i),n=!1},d(i){i&&G(t),le(e,i)}}}function wb(r){let e,t,n,i,o,u,s,d,p;function g(x){r[24](x)}let _={};return r[1]!==void 0&&(_.selectedPrioritization=r[1]),o=new H2({props:_}),pn.push(()=>Dn(o,"selectedPrioritization",g)),{c(){e=U("h3"),e.textContent="Prioritisation",t=ie(),n=U("p"),n.textContent=`Compare the prioritisation or individual metrics across your
        neighbourhoods.`,i=ie(),ue(o.$$.fragment),s=ie(),d=U("hr")},m(x,C){W(x,e,C),W(x,t,C),W(x,n,C),W(x,i,C),ae(o,x,C),W(x,s,C),W(x,d,C),p=!0},p(x,C){const T={};!u&&C[0]&2&&(u=!0,T.selectedPrioritization=x[1],zn(()=>u=!1)),o.$set(T)},i(x){p||(N(o.$$.fragment,x),p=!0)},o(x){V(o.$$.fragment,x),p=!1},d(x){x&&(G(e),G(t),G(n),G(i),G(s),G(d)),le(o,x)}}}function xb(r){let e,t,n;return{c(){e=U("button"),e.textContent="Debug route-snapper",fe(e,"class","secondary")},m(i,o){W(i,e,o),t||(n=Lt(e,"click",r[12]),t=!0)},p:ft,d(i){i&&G(e),t=!1,n()}}}function R7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I=r[4].modalFilters+"",O,B,K,H,q=r[4].deletedModalFilters+"",J,he,Ee,Y,oe=r[4].travelFlows+"",ke,ye,Ne,Ue,De,Le;s=new Ew({});let lt=On(r[0].features),Ze=[];for(let Je=0;Je<lt.length;Je+=1)Ze[Je]=bb(yb(r,lt,Je));const at=Je=>V(Ze[Je],1,1,()=>{Ze[Je]=null});T=new $n({props:{mode:{mode:"add-neighbourhood"},$$slots:{default:[D7]},$$scope:{ctx:r}}});let dt=r[6]=="cnt"&&wb(r),pt=r[8]&&xb(r);return{c(){e=U("div"),t=U("div"),n=U("h2"),n.textContent="Neighbourhoods",i=ie(),o=U("button"),u=U("div"),ue(s.$$.fragment),d=ie(),p=U("span"),p.textContent="Export",g=ie(),_=U("ul");for(let Je=0;Je<Ze.length;Je+=1)Ze[Je].c();x=ie(),C=U("li"),ue(T.$$.fragment),z=ie(),dt&&dt.c(),L=ie(),E=U("p"),O=Te(I),B=Te(" new modal filter(s) added"),K=ie(),H=U("p"),J=Te(q),he=Te(`
      existing modal filter(s) removed`),Ee=ie(),Y=U("p"),ke=Te(oe),ye=Te(" road segment direction(s) changed"),Ne=ie(),pt&&pt.c(),Ye(p,"margin-right","2px"),Ye(u,"display","flex"),Ye(u,"align-items","center"),Ye(u,"gap","8px"),Ye(u,"color","black"),fe(o,"class","outline"),Ye(o,"margin-right","8px"),fe(o,"title","Download project as GeoJSON"),Ye(t,"display","flex"),Ye(t,"justify-content","space-between"),Ye(t,"align-items","center"),Ye(t,"gap","16px"),fe(_,"class","navigable-list"),fe(e,"slot","sidebar")},m(Je,xt){W(Je,e,xt),R(e,t),R(t,n),R(t,i),R(t,o),R(o,u),ae(s,u,null),R(u,d),R(u,p),R(e,g),R(e,_);for(let Mt=0;Mt<Ze.length;Mt+=1)Ze[Mt]&&Ze[Mt].m(_,null);R(_,x),R(_,C),ae(T,C,null),R(e,z),dt&&dt.m(e,null),R(e,L),R(e,E),R(E,O),R(E,B),R(e,K),R(e,H),R(H,J),R(H,he),R(e,Ee),R(e,Y),R(Y,ke),R(Y,ye),R(e,Ne),pt&&pt.m(e,null),Ue=!0,De||(Le=Lt(o,"click",r[18]),De=!0)},p(Je,xt){if(xt[0]&3597){lt=On(Je[0].features);let Ot;for(Ot=0;Ot<lt.length;Ot+=1){const Yt=yb(Je,lt,Ot);Ze[Ot]?(Ze[Ot].p(Yt,xt),N(Ze[Ot],1)):(Ze[Ot]=bb(Yt),Ze[Ot].c(),N(Ze[Ot],1),Ze[Ot].m(_,x))}for(Kt(),Ot=lt.length;Ot<Ze.length;Ot+=1)at(Ot);Jt()}const Mt={};xt[1]&1&&(Mt.$$scope={dirty:xt,ctx:Je}),T.$set(Mt),Je[6]=="cnt"?dt?(dt.p(Je,xt),xt[0]&64&&N(dt,1)):(dt=wb(Je),dt.c(),N(dt,1),dt.m(e,L)):dt&&(Kt(),V(dt,1,1,()=>{dt=null}),Jt()),(!Ue||xt[0]&16)&&I!==(I=Je[4].modalFilters+"")&&At(O,I),(!Ue||xt[0]&16)&&q!==(q=Je[4].deletedModalFilters+"")&&At(J,q),(!Ue||xt[0]&16)&&oe!==(oe=Je[4].travelFlows+"")&&At(ke,oe),Je[8]?pt?pt.p(Je,xt):(pt=xb(Je),pt.c(),pt.m(e,null)):pt&&(pt.d(1),pt=null)},i(Je){if(!Ue){N(s.$$.fragment,Je);for(let xt=0;xt<lt.length;xt+=1)N(Ze[xt]);N(T.$$.fragment,Je),N(dt),Ue=!0}},o(Je){V(s.$$.fragment,Je),Ze=Ze.filter(Boolean);for(let xt=0;xt<Ze.length;xt+=1)V(Ze[xt]);V(T.$$.fragment,Je),V(dt),Ue=!1},d(Je){Je&&G(e),le(s),di(Ze,Je),le(T),dt&&dt.d(),pt&&pt.d(),De=!1,Le()}}}function B7(r){let e,t,n=(r[27].number_pois/r[27].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Points of interest:",t=ie(),i=Te(n),o=Te(" / kmÂ²")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&134217728&&n!==(n=(u[27].number_pois/u[27].area_km2).toFixed(1)+"")&&At(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function F7(r){let e,t,n=(r[27].number_stats19_collisions/r[27].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions:",t=ie(),i=Te(n),o=Te(" / kmÂ²")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&134217728&&n!==(n=(u[27].number_stats19_collisions/u[27].area_km2).toFixed(1)+"")&&At(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function O7(r){let e,t,n=Math.round(r[27].population/r[27].area_km2).toLocaleString()+"",i,o;return{c(){e=U("b"),e.textContent="Population density:",t=ie(),i=Te(n),o=Te(` people
            / kmÂ²`)},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s[0]&134217728&&n!==(n=Math.round(u[27].population/u[27].area_km2).toLocaleString()+"")&&At(i,n)},d(u){u&&(G(e),G(t),G(i),G(o))}}}function $7(r){let e,t=r[27].name+"",n,i,o;function u(p,g){if(p[1]=="population_density")return O7;if(p[1]=="stats19")return F7;if(p[1]=="pois")return B7}let s=u(r),d=s&&s(r);return{c(){e=U("h2"),n=Te(t),i=ie(),d&&d.c(),o=rr()},m(p,g){W(p,e,g),R(e,n),W(p,i,g),d&&d.m(p,g),W(p,o,g)},p(p,g){g[0]&134217728&&t!==(t=p[27].name+"")&&At(n,t),s===(s=u(p))&&d?d.p(p,g):(d&&d.d(1),d=s&&s(p),d&&(d.c(),d.m(o.parentNode,o)))},d(p){p&&(G(e),G(i),G(o)),d&&d.d(p)}}}function N7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[$7,({props:n})=>({27:n}),({props:n})=>[n?134217728:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&134217730|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function j7(r){let e,t,n,i,o,u,s,d,p;e=new AS({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const g=[{filter:["==",["get","kind"],"boundary"]},yn("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let _={};for(let E=0;E<g.length;E+=1)_=It(_,g[E]);n=new cr({props:_});const x=[{filter:["==",["get","kind"],"boundary"]},yn("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let C={};for(let E=0;E<x.length;E+=1)C=It(C,x[E]);o=new cr({props:C});const T=[yn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function z(E){r[16](E)}let L={$$slots:{default:[N7]},$$scope:{ctx:r}};for(let E=0;E<T.length;E+=1)L=It(L,T[E]);return r[3]!==void 0&&(L.hovered=r[3]),s=new Xi({props:L}),pn.push(()=>Dn(s,"hovered",z)),s.$on("click",r[17]),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(E,I){ae(e,E,I),W(E,t,I),ae(n,E,I),W(E,i,I),ae(o,E,I),W(E,u,I),ae(s,E,I),p=!0},p(E,I){const O={};I[0]&4&&(O.data=E[2]?[{name:E[2],highlight:"yes"}]:[]),e.$set(O);const B={};n.$set(B);const K={};o.$set(K);const H=I[0]&24578?Mn(T,[T[0],T[1],{paint:{"fill-color":E[13](E[1]),"fill-opacity":E[14](E[1])}},T[3],T[4]]):{};I[0]&2|I[1]&1&&(H.$$scope={dirty:I,ctx:E}),!d&&I[0]&8&&(d=!0,H.hovered=E[3],zn(()=>d=!1)),s.$set(H)},i(E){p||(N(e.$$.fragment,E),N(n.$$.fragment,E),N(o.$$.fragment,E),N(s.$$.fragment,E),p=!0)},o(E){V(e.$$.fragment,E),V(n.$$.fragment,E),V(o.$$.fragment,E),V(s.$$.fragment,E),p=!1},d(E){E&&(G(t),G(i),G(u)),le(e,E),le(n,E),le(o,E),le(s,E)}}}function U7(r){let e,t,n,i,o;return t=new yr({props:{data:r[0],promoteId:"name",$$slots:{default:[j7]},$$scope:{ctx:r}}}),i=new Ya({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),fe(e,"slot","map")},m(u,s){W(u,e,s),ae(t,e,null),R(e,n),ae(i,e,null),o=!0},p(u,s){const d={};s[0]&1&&(d.data=u[0]),s[0]&14|s[1]&1&&(d.$$scope={dirty:s,ctx:u}),t.$set(d)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&G(e),le(t),le(i)}}}function V7(r){let e,t;return e=new xo({props:{$$slots:{map:[U7],sidebar:[R7],top:[P7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&511|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function q7(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function H7(r,e,t){let n,i,o,u,s,d,p,g,_;st(r,lc,ye=>t(25,o=ye)),st(r,kr,ye=>t(15,u=ye)),st(r,Ia,ye=>t(26,s=ye)),st(r,nr,ye=>t(5,d=ye)),st(r,bs,ye=>t(6,p=ye)),st(r,Fs,ye=>t(7,g=ye)),st(r,If,ye=>t(8,_=ye));let x=p=="cnt"?"combined":"none",C=null,T=null;cn(Ia,s=void 0,s);function z(ye){u.setCurrentNeighbourhood(ye),cn(Ia,s=ye,s),cn(nr,d={mode:"neighbourhood"},d)}function L(ye){window.confirm(`Really delete neighbourhood ${ye}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(ye),console.assert(!Ia),jf(),t(0,n=u.getAllNeighbourhoods()))}function E(ye){let Ne=q2(u,`Rename neighbourhood ${ye} to what?`,ye);Ne&&(u.renameNeighbourhoodBoundary(ye,Ne),cn(Ia,s=Ne,s),jf(),t(0,n=u.getAllNeighbourhoods()))}function I(){sp("debug_route_snapper.geojson",u.toRouteSnapperGj())}function O(ye){let Ne=yo.mapFeature.hover.backgroundColor,Ue=G2({none:Ne},ye,o);return["case",["==",["feature-state","highlight"],"yes"],Ne,Ue]}function B(ye){let Ne=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],Ne,Xn(.3,Ne)],area:Xn(.7,.9),population_density:Xn(.7,.9),simd:Xn(.7,.9),stats19:Xn(.7,.9),pois:Xn(.7,.9),car_ownership:Xn(.7,.9),combined:Xn(.7,.9)}[ye]}function K(ye){T=ye,t(3,T)}const H=ye=>z(_r(ye.detail.features[0].properties).name),q=()=>x2(_r(g)),J=ye=>z(ye),he=ye=>E(ye),Ee=ye=>L(ye),Y=ye=>t(2,C=ye),oe=()=>t(2,C=null);function ke(ye){x=ye,t(1,x)}return r.$$.update=()=>{r.$$.dirty[0]&32768&&t(0,n=u.getAllNeighbourhoods()),r.$$.dirty[0]&1&&t(4,i=q7(n))},[n,x,C,T,i,d,p,g,_,z,L,E,I,O,B,u,K,H,q,J,he,Ee,Y,oe,ke]}class G7 extends Tt{constructor(e){super(),Ct(this,e,H7,V7,wt,{},null,[-1,-1])}}function Ab(r){let e,t,n;return t=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function W7(r){let e,t,n,i,o,u,s,d,p,g,_,x=vr(r[4].mode)+"",C,T;o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}});let z=r[0]=="neighbourhood"&&Ab();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),z&&z.c(),g=ie(),_=U("li"),C=Te(x),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(L,E){W(L,e,E),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),z&&z.m(n,null),R(n,g),R(n,_),R(_,C),T=!0},p(L,E){L[0]=="neighbourhood"?z?E&1&&N(z,1):(z=Ab(),z.c(),N(z,1),z.m(n,g)):z&&(Kt(),V(z,1,1,()=>{z=null}),Jt()),(!T||E&16)&&x!==(x=vr(L[4].mode)+"")&&At(C,x)},i(L){T||(N(o.$$.fragment,L),N(d.$$.fragment,L),N(z),T=!0)},o(L){V(o.$$.fragment,L),V(d.$$.fragment,L),V(z),T=!1},d(L){L&&G(e),le(o),le(d),z&&z.d()}}}function Z7(r){let e;return{c(){e=Te("Explore the origin/destination demand data used")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function X7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B,K,H,q,J,he,Ee,Y;return t=new Ns({props:{mode:{mode:r[0]}}}),u=new $n({props:{mode:{mode:"debug-demand"},$$slots:{default:[Z7]},$$scope:{ctx:r}}}),q=new wo({props:{colorScale:r[6],labels:{limits:["0%","50%","same","150%","200%"]}}}),he=Mg(r[13][0]),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),o=Te(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),ue(u.$$.fragment),s=ie(),d=U("fieldset"),p=U("label"),g=U("input"),_=Te(`
        Calculate quickly`),x=ie(),C=U("label"),T=U("input"),z=Te(`
        Calculate more accurately`),L=ie(),E=U("p"),E.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,I=ie(),O=U("label"),B=Te(`Only show roads with at least this many daily trips before or after
      `),K=U("input"),H=ie(),ue(q.$$.fragment),fe(g,"type","radio"),g.__value="fast",Kn(g,g.__value),fe(T,"type","radio"),T.__value="accurate",Kn(T,T.__value),fe(K,"type","number"),fe(K,"min",0),fe(e,"slot","sidebar"),he.p(g,T)},m(oe,ke){W(oe,e,ke),ae(t,e,null),R(e,n),R(e,i),R(i,o),ae(u,i,null),R(e,s),R(e,d),R(d,p),R(p,g),g.checked=g.__value===r[3],R(p,_),R(d,x),R(d,C),R(C,T),T.checked=T.__value===r[3],R(C,z),R(e,L),R(e,E),R(e,I),R(e,O),R(O,B),R(O,K),Kn(K,r[5]),R(e,H),ae(q,e,null),J=!0,Ee||(Y=[Lt(g,"change",r[12]),Lt(g,"change",r[9]),Lt(T,"change",r[14]),Lt(T,"change",r[9]),Lt(K,"input",r[15])],Ee=!0)},p(oe,ke){const ye={};ke&1&&(ye.mode={mode:oe[0]}),t.$set(ye);const Ne={};ke&524288&&(Ne.$$scope={dirty:ke,ctx:oe}),u.$set(Ne),ke&8&&(g.checked=g.__value===oe[3]),ke&8&&(T.checked=T.__value===oe[3]),ke&32&&Pl(K.value)!==oe[5]&&Kn(K,oe[5])},i(oe){J||(N(t.$$.fragment,oe),N(u.$$.fragment,oe),N(q.$$.fragment,oe),J=!0)},o(oe){V(t.$$.fragment,oe),V(u.$$.fragment,oe),V(q.$$.fragment,oe),J=!1},d(oe){oe&&G(e),le(t),le(u),le(q),he.r(),Ee=!1,hr(Y)}}}function K7(r){let e,t;const n=[yn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new Xi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function J7(r){let e,t=r[18].before.toLocaleString()+"",n,i,o=r[18].after.toLocaleString()+"",u,s,d,p,g=Math.round(100*r[18].after/r[18].before)+"",_,x;return{c(){e=U("p"),n=Te(t),i=Te(" before, "),u=Te(o),s=Te(`
            after`),d=ie(),p=U("p"),_=Te(g),x=Te("%")},m(C,T){W(C,e,T),R(e,n),R(e,i),R(e,u),R(e,s),W(C,d,T),W(C,p,T),R(p,_),R(p,x)},p(C,T){T&262144&&t!==(t=C[18].before.toLocaleString()+"")&&At(n,t),T&262144&&o!==(o=C[18].after.toLocaleString()+"")&&At(u,o),T&262144&&g!==(g=Math.round(100*C[18].after/C[18].before)+"")&&At(_,g)},d(C){C&&(G(e),G(d),G(p))}}}function Y7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[J7,({props:n})=>({18:n}),({props:n})=>n?262144:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Q7(r){let e,t,n,i;const o=[yn("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Ld,r[2].max_count,1.5*Id],"line-color":"black"}}];let u={};for(let p=0;p<o.length;p+=1)u=It(u,o[p]);e=new cr({props:u});const s=[yn("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ld,r[2].max_count,Id],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[6][0],50,r[6][1],100,r[6][2],150,r[6][3],200,r[6][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let d={$$slots:{default:[Y7]},$$scope:{ctx:r}};for(let p=0;p<s.length;p+=1)d=It(d,s[p]);return n=new cr({props:d}),n.$on("click",r[11]),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _=g&36?Mn(o,[o[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&4&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Ld,p[2].max_count,1.5*Id],"line-color":"black"}}]):{};e.$set(_);const x=g&100?Mn(s,[s[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&68&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ld,p[2].max_count,Id],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,p[6][0],50,p[6][1],100,p[6][2],150,p[6][3],200,p[6][4]]]}},s[3],s[4]]):{};g&524288&&(x.$$scope={dirty:g,ctx:p}),n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&G(t),le(e,p),le(n,p)}}}function eD(r){let e,t,n,i,o,u,s;return t=new yr({props:{data:r[7],$$slots:{default:[K7]},$$scope:{ctx:r}}}),i=new yr({props:{data:r[2],generateId:!0,$$slots:{default:[Q7]},$$scope:{ctx:r}}}),u=new Ya({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),ue(i.$$.fragment),o=ie(),ue(u.$$.fragment),fe(e,"slot","map")},m(d,p){W(d,e,p),ae(t,e,null),R(e,n),ae(i,e,null),R(e,o),ae(u,e,null),s=!0},p(d,p){const g={};p&524288&&(g.$$scope={dirty:p,ctx:d}),t.$set(g);const _={};p&4&&(_.data=d[2]),p&524324&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){s||(N(t.$$.fragment,d),N(i.$$.fragment,d),N(u.$$.fragment,d),s=!0)},o(d){V(t.$$.fragment,d),V(i.$$.fragment,d),V(u.$$.fragment,d),s=!1},d(d){d&&G(e),le(t),le(i),le(u)}}}function tD(r){let e,t,n,i;return e=new sh({props:{loading:r[1]}}),n=new xo({props:{$$slots:{map:[eD],sidebar:[X7],top:[W7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&2&&(s.loading=o[1]),e.$set(s);const d={};u&524349&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}let Ld=3,Id=10;function nD(r,e,t){let n,i,o,u;st(r,Zm,K=>t(10,n=K)),st(r,kr,K=>t(16,i=K)),st(r,nr,K=>t(4,o=K)),st(r,iy,K=>t(5,u=K));let{prevMode:s}=e,d=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],p="",g={type:"FeatureCollection",features:[],max_count:1},_=i.getAllNeighbourhoods();function x(K){cn(nr,o={mode:"impact-detail",road:K,prevPrevMode:s},o)}async function C(K){t(1,p="Calculating impact"),await new Promise(H=>{requestAnimationFrame(()=>{requestAnimationFrame(H)})}),t(2,g=i.predictImpact(K)),t(1,p="")}let T=n?"fast":"accurate";function z(){cn(Zm,n=T=="fast",n)}const L=[[]],E=K=>x(K.detail.features[0]);function I(){T=this.__value,t(3,T)}function O(){T=this.__value,t(3,T)}function B(){u=Pl(this.value),iy.set(u)}return r.$$set=K=>{"prevMode"in K&&t(0,s=K.prevMode)},r.$$.update=()=>{r.$$.dirty&1024&&C(n)},[s,p,g,T,o,u,d,_,x,z,n,E,I,L,O,B]}class rD extends Tt{constructor(e){super(),Ct(this,e,nD,tD,wt,{prevMode:0})}}function kb(r){let e,t,n;return t=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function iD(r){let e,t,n,i,o,u,s,d,p,g,_,x=vr(r[7].mode)+"",C,T;o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}});let z=r[0]=="neighbourhood"&&kb();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),z&&z.c(),g=ie(),_=U("li"),C=Te(x),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(L,E){W(L,e,E),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),z&&z.m(n,null),R(n,g),R(n,_),R(_,C),T=!0},p(L,E){L[0]=="neighbourhood"?z?E&1&&N(z,1):(z=kb(),z.c(),N(z,1),z.m(n,g)):z&&(Kt(),V(z,1,1,()=>{z=null}),Jt()),(!T||E&128)&&x!==(x=vr(L[7].mode)+"")&&At(C,x)},i(L){T||(N(o.$$.fragment,L),N(d.$$.fragment,L),N(z),T=!0)},o(L){V(o.$$.fragment,L),V(d.$$.fragment,L),V(z),T=!1},d(L){L&&G(e),le(o),le(d),z&&z.d()}}}function oD(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function sD(r){let e,t=Oa(r[6].properties.distance)+"",n,i,o=$a(r[6].properties.time)+"",u;return{c(){e=U("p"),n=Te(t),i=Te(", "),u=Te(o)},m(s,d){W(s,e,d),R(e,n),R(e,i),R(e,u)},p(s,d){d&64&&t!==(t=Oa(s[6].properties.distance)+"")&&At(n,t),d&64&&o!==(o=$a(s[6].properties.time)+"")&&At(u,o)},d(s){s&&G(e)}}}function aD(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function lD(r){let e,t=Oa(r[5].properties.distance)+"",n,i,o=$a(r[5].properties.time)+"",u;return{c(){e=U("p"),n=Te(t),i=Te(", "),u=Te(o)},m(s,d){W(s,e,d),R(e,n),R(e,i),R(e,u)},p(s,d){d&32&&t!==(t=Oa(s[5].properties.distance)+"")&&At(n,t),d&32&&o!==(o=$a(s[5].properties.time)+"")&&At(u,o)},d(s){s&&G(e)}}}function uD(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I,O,B,K;t=new Ns({props:{mode:{mode:r[0]}}});function H(oe,ke){return oe[6]?sD:oD}let q=H(r),J=q(r);function he(oe,ke){return oe[5]?lD:aD}let Ee=he(r),Y=Ee(r);return{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("p"),i.textContent="Drag markers for a route",o=ie(),u=U("u"),u.textContent="Route before changes",s=ie(),J.c(),d=ie(),p=U("u"),p.textContent="Route after changes",g=ie(),Y.c(),_=ie(),x=U("label"),C=Te("Slow-down factor for main roads: "),T=Te(r[2]),z=ie(),L=U("input"),E=ie(),I=U("i"),I.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Ye(u,"color","red"),Ye(p,"color","blue"),fe(L,"type","range"),fe(L,"min","1.0"),fe(L,"max","5.0"),fe(L,"step","0.1"),fe(e,"slot","sidebar")},m(oe,ke){W(oe,e,ke),ae(t,e,null),R(e,n),R(e,i),R(e,o),R(e,u),R(e,s),J.m(e,null),R(e,d),R(e,p),R(e,g),Y.m(e,null),R(e,_),R(e,x),R(x,C),R(x,T),R(x,z),R(x,L),Kn(L,r[2]),R(e,E),R(e,I),O=!0,B||(K=[Lt(L,"change",r[11]),Lt(L,"input",r[11])],B=!0)},p(oe,ke){const ye={};ke&1&&(ye.mode={mode:oe[0]}),t.$set(ye),q===(q=H(oe))&&J?J.p(oe,ke):(J.d(1),J=q(oe),J&&(J.c(),J.m(e,d))),Ee===(Ee=he(oe))&&Y?Y.p(oe,ke):(Y.d(1),Y=Ee(oe),Y&&(Y.c(),Y.m(e,_))),(!O||ke&4)&&At(T,oe[2]),ke&4&&Kn(L,oe[2])},i(oe){O||(N(t.$$.fragment,oe),O=!0)},o(oe){V(t.$$.fragment,oe),O=!1},d(oe){oe&&G(e),le(t),J.d(),Y.d(),B=!1,hr(K)}}}function Sb(r){let e,t;return e=new dh({props:{$$slots:{default:[cD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cD(r){let e,t,n,i,o,u,s,d;return e=new dp({}),n=new hp({}),o=new pp({}),s=new hh({props:{interactive:!1}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),W(p,i,g),ae(o,p,g),W(p,u,g),ae(s,p,g),d=!0},p:ft,i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(G(t),G(i),G(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function fD(r){let e,t;const n=[yn("compare-route"),{paint:{"line-width":10,"line-color":Oo(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function hD(r){let e;return{c(){e=Te("A")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function dD(r){let e;return{c(){e=Te("B")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function pD(r){let e,t,n,i,o,u,s,d,p,g,_,x,C=r[0]=="neighbourhood"&&Sb(r);n=new Ya({props:{interactive:!1}}),o=new yr({props:{data:r[1],$$slots:{default:[fD]},$$scope:{ctx:r}}});function T(I){r[9](I)}let z={draggable:!0,$$slots:{default:[hD]},$$scope:{ctx:r}};r[4]!==void 0&&(z.lngLat=r[4]),s=new Rl({props:z}),pn.push(()=>Dn(s,"lngLat",T));function L(I){r[10](I)}let E={draggable:!0,$$slots:{default:[dD]},$$scope:{ctx:r}};return r[3]!==void 0&&(E.lngLat=r[3]),g=new Rl({props:E}),pn.push(()=>Dn(g,"lngLat",L)),{c(){e=U("div"),C&&C.c(),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment),p=ie(),ue(g.$$.fragment),fe(e,"slot","map")},m(I,O){W(I,e,O),C&&C.m(e,null),R(e,t),ae(n,e,null),R(e,i),ae(o,e,null),R(e,u),ae(s,e,null),R(e,p),ae(g,e,null),x=!0},p(I,O){I[0]=="neighbourhood"?C?O&1&&N(C,1):(C=Sb(I),C.c(),N(C,1),C.m(e,t)):C&&(Kt(),V(C,1,1,()=>{C=null}),Jt());const B={};O&2&&(B.data=I[1]),O&4096&&(B.$$scope={dirty:O,ctx:I}),o.$set(B);const K={};O&4096&&(K.$$scope={dirty:O,ctx:I}),!d&&O&16&&(d=!0,K.lngLat=I[4],zn(()=>d=!1)),s.$set(K);const H={};O&4096&&(H.$$scope={dirty:O,ctx:I}),!_&&O&8&&(_=!0,H.lngLat=I[3],zn(()=>_=!1)),g.$set(H)},i(I){x||(N(C),N(n.$$.fragment,I),N(o.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),x=!0)},o(I){V(C),V(n.$$.fragment,I),V(o.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),x=!1},d(I){I&&G(e),C&&C.d(),le(n),le(o),le(s),le(g)}}}function mD(r){let e,t;return e=new xo({props:{$$slots:{map:[pD],sidebar:[uD],top:[iD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&4351&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function gD(r,e,t){let n,i,o,u,s,d,p,g;st(r,ny,z=>t(2,u=z)),st(r,Lf,z=>t(3,s=z)),st(r,Ef,z=>t(4,d=z)),st(r,kr,z=>t(8,p=z)),st(r,nr,z=>t(7,g=z));let{prevMode:_}=e;ws(()=>{setTimeout(()=>{Km(Ef),Km(Lf)},10)});function x(z){d=z,Ef.set(d)}function C(z){s=z,Lf.set(s)}function T(){u=Pl(this.value),ny.set(u)}return r.$$set=z=>{"prevMode"in z&&t(0,_=z.prevMode)},r.$$.update=()=>{r.$$.dirty&284&&t(1,n=p.compareRoute(d,s,u)),r.$$.dirty&2&&t(6,i=n.features.find(z=>z.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(z=>z.properties.kind=="after"))},[_,n,u,s,d,o,i,g,p,x,C,T]}class _D extends Tt{constructor(e){super(),Ct(this,e,gD,mD,wt,{prevMode:0})}}function yD(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=vr(r[2].mode)+"",z,L;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),_=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Te(T),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(E,I){W(E,e,I),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),R(n,g),ae(_,g,null),R(n,x),R(n,C),R(C,z),L=!0},p(E,I){(!L||I&4)&&T!==(T=vr(E[2].mode)+"")&&At(z,T)},i(E){L||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(d),le(_)}}}function vD(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E,I;t=new Ns({props:{mode:{mode:"neighbourhood"}}});function O(H){r[8](H)}function B(H){r[9](H)}let K={map:_r(r[3])};return r[0]!==void 0&&(K.waypoints=r[0]),r[1]!==void 0&&(K.drawnShapeOut=r[1]),u=new U2({props:K}),pn.push(()=>Dn(u,"waypoints",O)),pn.push(()=>Dn(u,"drawnShapeOut",B)),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("h1"),i.textContent="Adjust boundary",o=ie(),ue(u.$$.fragment),p=ie(),g=U("div"),_=U("button"),x=Te("Finish"),T=ie(),z=U("button"),z.textContent="Cancel",_.disabled=C=r[0].length<3,fe(z,"class","secondary"),Ye(g,"display","flex"),Ye(g,"gap","16px"),fe(e,"slot","sidebar")},m(H,q){W(H,e,q),ae(t,e,null),R(e,n),R(e,i),R(e,o),ae(u,e,null),R(e,p),R(e,g),R(g,_),R(_,x),R(g,T),R(g,z),L=!0,E||(I=[Lt(_,"click",r[4]),Lt(z,"click",r[5])],E=!0)},p(H,q){const J={};q&8&&(J.map=_r(H[3])),!s&&q&1&&(s=!0,J.waypoints=H[0],zn(()=>s=!1)),!d&&q&2&&(d=!0,J.drawnShapeOut=H[1],zn(()=>d=!1)),u.$set(J),(!L||q&1&&C!==(C=H[0].length<3))&&(_.disabled=C)},i(H){L||(N(t.$$.fragment,H),N(u.$$.fragment,H),L=!0)},o(H){V(t.$$.fragment,H),V(u.$$.fragment,H),L=!1},d(H){H&&G(e),le(t),le(u),E=!1,hr(I)}}}function bD(r){let e,t;return e=new xo({props:{$$slots:{sidebar:[vD],top:[yD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&4111&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function wD(r,e,t){let n,i,o;st(r,nr,z=>t(2,n=z)),st(r,kr,z=>t(11,i=z)),st(r,is,z=>t(3,o=z));let{name:u}=e,{existing:s}=e,d=[],p,g=s.properties.waypoints;if(!g){let z={type:"LineString",coordinates:s.geometry.coordinates[1]};g=i.extractWaypointsFromRing(z)}d=g.map(z=>({point:[z.lon,z.lat],snapped:z.snapped}));function _(){if(p)try{i.setCurrentNeighbourhoodBoundary(u,p),jf(),cn(nr,n={mode:"neighbourhood"},n)}catch(z){window.alert(`Sorry, this boundary is invalid: ${z}`),x()}}function x(){cn(nr,n={mode:"neighbourhood"},n)}function C(z){d=z,t(0,d)}function T(z){p=z,t(1,p)}return r.$$set=z=>{"name"in z&&t(6,u=z.name),"existing"in z&&t(7,s=z.existing)},[d,p,n,o,_,x,u,s,C,T]}class xD extends Tt{constructor(e){super(),Ct(this,e,wD,bD,wt,{name:6,existing:7})}}const AD=["==",["geometry-type"],"Polygon"],kD=["==",["geometry-type"],"LineString"],SD=["==",["geometry-type"],"Point"];function K2(){return{type:"FeatureCollection",features:[]}}function Om(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:J2(r)}}}function J2(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Y2=Pn(K2()),Q2=Pn(0),CD=100;class TD{constructor(e){er(this,"map");er(this,"active");er(this,"eventListenersSuccess");er(this,"eventListenersUpdated");er(this,"eventListenersFailure");er(this,"points");er(this,"cursor");er(this,"hover");er(this,"dragFrom");er(this,"previousStates");er(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});er(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(Cb(this.points).forEach((n,i)=>{t.push([i+1,d3(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});er(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Om(e.lngLat.toArray()),this.onClick(e),this.finish())});er(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});er(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});er(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});er(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=K2();this.points.forEach((i,o)=>{let u=Om(i);u.properties.hover=this.hover==o,u.properties.idx=o,e.features.push(u)}),e.features=e.features.concat(Cb(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Y2.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,Q2.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Om(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(J2),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>CD&&this.previousStates.shift()}}function Cb(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function MD(r){let e,t,n;return{c(){e=Te("Undo ("),t=Te(r[1]),n=Te(")")},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o&2&&At(t,i[1])},d(i){i&&(G(e),G(t),G(n))}}}function ED(r){let e;return{c(){e=Te("Undo")},m(t,n){W(t,e,n)},p:ft,d(t){t&&G(e)}}}function LD(r){let e,t,n,i,o,u,s,d,p,g,_;function x(z,L){return z[1]==0?ED:MD}let C=x(r),T=C(r);return{c(){e=U("div"),t=U("button"),t.textContent="Finish",n=ie(),i=U("button"),i.textContent="Cancel",o=ie(),u=U("button"),T.c(),d=ie(),p=U("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,u.disabled=s=r[1]==0,Ye(e,"display","flex"),Ye(e,"justify-content","space-between")},m(z,L){W(z,e,L),R(e,t),R(e,n),R(e,i),R(e,o),R(e,u),T.m(u,null),W(z,d,L),W(z,p,L),g||(_=[Lt(t,"click",r[2]),Lt(i,"click",r[3]),Lt(u,"click",r[4])],g=!0)},p(z,[L]){C===(C=x(z))&&T?T.p(z,L):(T.d(1),T=C(z),T&&(T.c(),T.m(u,null))),L&2&&s!==(s=z[1]==0)&&(u.disabled=s)},i:ft,o:ft,d(z){z&&(G(e),G(d),G(p)),T.d(),g=!1,hr(_)}}}function ID(r,e,t){let n;st(r,Q2,d=>t(1,n=d));let{polygonTool:i}=e;const o=()=>i.finish(),u=()=>i.cancel(),s=()=>i.undo();return r.$$set=d=>{"polygonTool"in d&&t(0,i=d.polygonTool)},[i,n,o,u,s]}class PD extends Tt{constructor(e){super(),Ct(this,e,ID,LD,wt,{polygonTool:0})}}let zD=Date.now();function ph(r){return`${r}-${zD++}`}const ex=Symbol.for("svelte-maplibre");function DD(){return Kf(ex)}function Tb(r){return{subscribe:r.subscribe}}function tx({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=DD(),o=Pn(null),u=Tb(o),s={...i,[r]:Tb(o)};if(e&&(s.popupTarget=u),n){let d=Pn(null);s.layerEvent=d,i.layerEvent=d}return t&&(s.cluster=Pn()),op(ex,s),{...i,self:o}}function RD(){return tx({key:"source",setCluster:!0})}function BD(r=!0){return tx({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Mb(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function FD(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function OD(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Eb(r){let e=r[0],t,n,i=Lb(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&wt(e,e=o[0])?(Kt(),V(i,1,1,ft),Jt(),i=Lb(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function Lb(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function $D(r){let e,t,n=r[0]&&Eb(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=Eb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function ND(r,e,t){let n,i,o,u,s,d,p,g,_,x,C,T,{$$slots:z={},$$scope:L}=e,{id:E=ph("layer")}=e,{source:I=void 0}=e,{sourceLayer:O=void 0}=e,{beforeId:B=void 0}=e,{beforeLayerType:K=void 0}=e,{type:H}=e,{paint:q=void 0}=e,{layout:J=void 0}=e,{filter:he=void 0}=e,{applyToClusters:Ee=void 0}=e,{minzoom:Y=void 0}=e,{maxzoom:oe=void 0}=e,{manageHoverState:ke=!1}=e,{hovered:ye=null}=e,{interactive:Ne=!0}=e,{hoverCursor:Ue=void 0}=e,{eventsIfTopMost:De=!1}=e;const Le=$s(),{map:lt,source:Ze,self:at,minzoom:dt,maxzoom:pt,eventTopMost:Je,layerInfo:xt}=BD();st(r,lt,qe=>t(31,_=qe)),st(r,Ze,qe=>t(32,x=qe)),st(r,at,qe=>t(0,g=qe)),st(r,dt,qe=>t(34,T=qe)),st(r,pt,qe=>t(33,C=qe)),ei(()=>{g&&_&&(xt.delete(g),_==null||_.removeLayer(g))});let Mt;function Ot(qe){var de,en;if(!Ne||!g||!_||De&&Je(qe)!==g)return;let Ge=qe.features??[],gt=(en=(de=Ge[0])==null?void 0:de.properties)==null?void 0:en.cluster_id,et={event:qe,map:_,clusterId:gt,layer:g,source:s,features:Ge};Le(qe.type,et)}function Yt(qe){var de,en;if(!Ne||!g||!_||De&&Je(qe)!==g)return;Ue&&(_.getCanvas().style.cursor=Ue);let Ge=qe.features??[];t(6,ye=Ge[0]??null);let gt=(en=(de=Ge[0])==null?void 0:de.properties)==null?void 0:en.cluster_id;Le("mouseenter",{event:qe,map:_,clusterId:gt,layer:g,source:s,features:Ge})}function nn(qe){var de,en,Xe;if(!Ne||!_)return;if(De&&Je(qe)!==g){t(6,ye=null),ke&&Mt!==void 0&&(_==null||_.setFeatureState({source:s,sourceLayer:O,id:Mt},{hover:!1}),Mt=void 0);return}_.getCanvas().style.cursor=Ue;let Ge=qe.features??[],gt=(en=(de=Ge[0])==null?void 0:de.properties)==null?void 0:en.cluster_id,et=(Xe=Ge[0])==null?void 0:Xe.id;et!==Mt&&(ke&&(Mt!==void 0&&(_==null||_.setFeatureState({source:s,id:Mt,sourceLayer:O},{hover:!1})),_==null||_.setFeatureState({source:s,id:et,sourceLayer:O},{hover:!0})),Mt=et,t(6,ye=Ge[0]??null)),Le("mousemove",{event:qe,map:_,clusterId:gt,layer:g,source:s,features:Ge})}function Qt(qe){if(!(!Ne||!g||!_)){if(Ue&&(_.getCanvas().style.cursor=""),t(6,ye=null),ke&&Mt!==void 0){const Ge={source:s,id:Mt,sourceLayer:O};_==null||_.setFeatureState(Ge,{hover:!1}),Mt=void 0}Le("mouseleave",{map:_,layer:g,source:s})}}let fn=!0;function mn(qe){_&&(_.off("click",qe,Ot),_.off("dblclick",qe,Ot),_.off("contextmenu",qe,Ot),_.off("mouseenter",qe,Yt),_.off("mousemove",qe,nn),_.off("mouseleave",qe,Qt))}return ei(()=>{_&&g&&mn(g)}),r.$$set=qe=>{"id"in qe&&t(7,E=qe.id),"source"in qe&&t(8,I=qe.source),"sourceLayer"in qe&&t(9,O=qe.sourceLayer),"beforeId"in qe&&t(10,B=qe.beforeId),"beforeLayerType"in qe&&t(11,K=qe.beforeLayerType),"type"in qe&&t(12,H=qe.type),"paint"in qe&&t(13,q=qe.paint),"layout"in qe&&t(14,J=qe.layout),"filter"in qe&&t(15,he=qe.filter),"applyToClusters"in qe&&t(16,Ee=qe.applyToClusters),"minzoom"in qe&&t(17,Y=qe.minzoom),"maxzoom"in qe&&t(18,oe=qe.maxzoom),"manageHoverState"in qe&&t(19,ke=qe.manageHoverState),"hovered"in qe&&t(6,ye=qe.hovered),"interactive"in qe&&t(20,Ne=qe.interactive),"hoverCursor"in qe&&t(21,Ue=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,De=qe.eventsIfTopMost),"$$scope"in qe&&t(35,L=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=OD(Ee)),r.$$.dirty[0]&1073774592&&t(24,i=FD("all",n,he)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=Y??T),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=oe??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=I||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&g!==E&&s){g&&(mn(g),xt.delete(g));let qe=B;if(!B&&K){let Ge=_.getStyle().layers,gt=typeof K=="function"?K:de=>de.type===K,et=Ge==null?void 0:Ge.find(gt);et&&(qe=et.id)}cn(at,g=E,g),_.addLayer(Fa({id:g,type:H,source:s,"source-layer":O,filter:i,paint:q,layout:J,minzoom:o,maxzoom:u}),qe),t(23,fn=!0),_.on("click",g,Ot),_.on("dblclick",g,Ot),_.on("contextmenu",g,Ot),_.on("mouseenter",g,Yt),_.on("mousemove",g,nn),_.on("mouseleave",g,Qt)}r.$$.dirty[0]&1048577&&g&&xt.set(g,{interactive:Ne}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?Mb((qe,Ge)=>_==null?void 0:_.setPaintProperty(g,qe,Ge)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?Mb((qe,Ge)=>_==null?void 0:_.setLayoutProperty(g,qe,Ge)):void 0),r.$$.dirty[0]&268443648&&(d==null||d(q)),r.$$.dirty[0]&134234112&&(p==null||p(J)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(_==null||_.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(fn?t(23,fn=!1):_==null||_.setFilter(g,i))},[g,lt,Ze,at,dt,pt,ye,E,I,O,B,K,H,q,J,he,Ee,Y,oe,ke,Ne,Ue,De,fn,i,u,o,p,d,s,n,_,x,C,T,L,z]}class f_ extends Tt{constructor(e){super(),Ct(this,e,ND,$D,wt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function jD(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function UD(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[jD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new f_({props:o}),pn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function VD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ph("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:E=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:B=!0}=e;function K(oe){I=oe,t(0,I)}function H(oe){Sn.call(this,r,oe)}function q(oe){Sn.call(this,r,oe)}function J(oe){Sn.call(this,r,oe)}function he(oe){Sn.call(this,r,oe)}function Ee(oe){Sn.call(this,r,oe)}function Y(oe){Sn.call(this,r,oe)}return r.$$set=oe=>{"id"in oe&&t(1,o=oe.id),"source"in oe&&t(2,u=oe.source),"sourceLayer"in oe&&t(3,s=oe.sourceLayer),"beforeId"in oe&&t(4,d=oe.beforeId),"beforeLayerType"in oe&&t(5,p=oe.beforeLayerType),"paint"in oe&&t(6,g=oe.paint),"layout"in oe&&t(7,_=oe.layout),"filter"in oe&&t(8,x=oe.filter),"applyToClusters"in oe&&t(9,C=oe.applyToClusters),"minzoom"in oe&&t(10,T=oe.minzoom),"maxzoom"in oe&&t(11,z=oe.maxzoom),"hoverCursor"in oe&&t(12,L=oe.hoverCursor),"manageHoverState"in oe&&t(13,E=oe.manageHoverState),"hovered"in oe&&t(0,I=oe.hovered),"eventsIfTopMost"in oe&&t(14,O=oe.eventsIfTopMost),"interactive"in oe&&t(15,B=oe.interactive),"$$scope"in oe&&t(24,i=oe.$$scope)},[I,o,u,s,d,p,g,_,x,C,T,z,L,E,O,B,n,K,H,q,J,he,Ee,Y,i]}class qD extends Tt{constructor(e){super(),Ct(this,e,VD,UD,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function HD(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function GD(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[HD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new f_({props:o}),pn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function WD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ph("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:L=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:O=!0}=e;function B(Y){E=Y,t(0,E)}function K(Y){Sn.call(this,r,Y)}function H(Y){Sn.call(this,r,Y)}function q(Y){Sn.call(this,r,Y)}function J(Y){Sn.call(this,r,Y)}function he(Y){Sn.call(this,r,Y)}function Ee(Y){Sn.call(this,r,Y)}return r.$$set=Y=>{"id"in Y&&t(1,o=Y.id),"source"in Y&&t(2,u=Y.source),"sourceLayer"in Y&&t(3,s=Y.sourceLayer),"beforeId"in Y&&t(4,d=Y.beforeId),"beforeLayerType"in Y&&t(5,p=Y.beforeLayerType),"paint"in Y&&t(6,g=Y.paint),"layout"in Y&&t(7,_=Y.layout),"filter"in Y&&t(8,x=Y.filter),"minzoom"in Y&&t(9,C=Y.minzoom),"maxzoom"in Y&&t(10,T=Y.maxzoom),"hoverCursor"in Y&&t(11,z=Y.hoverCursor),"manageHoverState"in Y&&t(12,L=Y.manageHoverState),"hovered"in Y&&t(0,E=Y.hovered),"eventsIfTopMost"in Y&&t(13,I=Y.eventsIfTopMost),"interactive"in Y&&t(14,O=Y.interactive),"$$scope"in Y&&t(23,i=Y.$$scope)},[E,o,u,s,d,p,g,_,x,C,T,z,L,I,O,n,B,K,H,q,J,he,Ee,i]}class ZD extends Tt{constructor(e){super(),Ct(this,e,WD,GD,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function XD(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function KD(r,e,t){ew().then(()=>{let n=hi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Ib(r){let e=r[0],t,n,i=Pb(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&wt(e,e=o[0])?(Kt(),V(i,1,1,ft),Jt(),i=Pb(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&G(t),i.d(o)}}}function Pb(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function JD(r){let e,t,n=r[0]&&Ib(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Ib(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d(i)}}}function YD(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:d=ph("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:_=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:T=void 0}=e;const{map:z,cluster:L,self:E}=RD();st(r,z,B=>t(13,i=B)),st(r,L,B=>t(16,o=B)),st(r,E,B=>t(0,n=B));let I,O=!0;return ei(()=>{n&&I&&i&&(KD(z,n,I),cn(E,n=null,n),t(11,I=void 0))}),r.$$set=B=>{"id"in B&&t(4,d=B.id),"data"in B&&t(5,p=B.data),"generateId"in B&&t(6,g=B.generateId),"promoteId"in B&&t(7,_=B.promoteId),"filter"in B&&t(8,x=B.filter),"lineMetrics"in B&&t(9,C=B.lineMetrics),"cluster"in B&&t(10,T=B.cluster),"$$scope"in B&&t(14,s=B.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&cn(L,o=T,o),r.$$.dirty&12273&&i&&n!==d&&(cn(E,n=d,n),XD(i,n,Fa({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:_,cluster:!!T,clusterMinPoints:T==null?void 0:T.minPoints,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius,clusterProperties:T==null?void 0:T.properties}),B=>i&&B===n,()=>{n&&(t(11,I=i==null?void 0:i.getSource(n)),t(12,O=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,I=i==null?void 0:i.getSource(d))})),r.$$.dirty&6176&&I&&(O?t(12,O=!1):I.setData(p)),r.$$.dirty&3072&&(I==null||I.setClusterOptions(Fa({cluster:!!T,clusterMaxZoom:T==null?void 0:T.maxZoom,clusterRadius:T==null?void 0:T.radius})))},[n,z,L,E,d,p,g,_,x,C,T,I,O,i,s,u]}class QD extends Tt{constructor(e){super(),Ct(this,e,YD,JD,wt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function eR(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function tR(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[eR]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new f_({props:o}),pn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function nR(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=ph("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:T=void 0}=e,{hoverCursor:z=void 0}=e,{manageHoverState:L=!1}=e,{hovered:E=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:O=!0}=e;function B(Y){E=Y,t(0,E)}function K(Y){Sn.call(this,r,Y)}function H(Y){Sn.call(this,r,Y)}function q(Y){Sn.call(this,r,Y)}function J(Y){Sn.call(this,r,Y)}function he(Y){Sn.call(this,r,Y)}function Ee(Y){Sn.call(this,r,Y)}return r.$$set=Y=>{"id"in Y&&t(1,o=Y.id),"source"in Y&&t(2,u=Y.source),"sourceLayer"in Y&&t(3,s=Y.sourceLayer),"beforeId"in Y&&t(4,d=Y.beforeId),"beforeLayerType"in Y&&t(5,p=Y.beforeLayerType),"paint"in Y&&t(6,g=Y.paint),"layout"in Y&&t(7,_=Y.layout),"filter"in Y&&t(8,x=Y.filter),"minzoom"in Y&&t(9,C=Y.minzoom),"maxzoom"in Y&&t(10,T=Y.maxzoom),"hoverCursor"in Y&&t(11,z=Y.hoverCursor),"manageHoverState"in Y&&t(12,L=Y.manageHoverState),"hovered"in Y&&t(0,E=Y.hovered),"eventsIfTopMost"in Y&&t(13,I=Y.eventsIfTopMost),"interactive"in Y&&t(14,O=Y.interactive),"$$scope"in Y&&t(23,i=Y.$$scope)},[E,o,u,s,d,p,g,_,x,C,T,z,L,I,O,n,B,K,H,q,J,he,Ee,i]}class rR extends Tt{constructor(e){super(),Ct(this,e,nR,tR,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function iR(r){let e,t,n,i,o,u;return e=new ZD({props:{id:"edit-polygon-fill",filter:AD,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new rR({props:{id:"edit-polygon-lines",filter:kD,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new qD({props:{id:"edit-polygon-vertices",filter:SD,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment)},m(s,d){ae(e,s,d),W(s,t,d),ae(n,s,d),W(s,i,d),ae(o,s,d),u=!0},p:ft,i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(G(t),G(i)),le(e,s),le(n,s),le(o,s)}}}function oR(r){let e,t;return e=new QD({props:{data:r[0],$$slots:{default:[iR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function sR(r,e,t){let n;return st(r,Y2,i=>t(0,n=i)),[n]}class aR extends Tt{constructor(e){super(),Ct(this,e,sR,oR,wt,{})}}function lR(r){let e,t,n,i,o,u,s;return{c(){e=U("button"),e.textContent="Import current view",t=ie(),n=U("i"),n.textContent="or...",i=ie(),o=U("button"),o.textContent="Draw an area to import on the map",fe(e,"type","button"),fe(o,"type","button")},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,o,p),u||(s=[Lt(e,"click",r[2]),Lt(o,"click",r[3])],u=!0)},p:ft,i:ft,o:ft,d(d){d&&(G(e),G(t),G(n),G(i),G(o)),u=!1,hr(s)}}}function uR(r){let e,t;return e=new PD({props:{polygonTool:r[0]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cR(r){let e,t,n,i,o,u,s,d,p;const g=[uR,lR],_=[];function x(C,T){return C[0]?0:1}return e=x(r),t=_[e]=g[e](r),{c(){t.c(),n=ie(),i=U("label"),o=U("input"),u=Te(`Save a copy of the osm.xml
  after importing`),fe(o,"type","checkbox")},m(C,T){_[e].m(C,T),W(C,n,T),W(C,i,T),R(i,o),o.checked=r[1],R(i,u),s=!0,d||(p=Lt(o,"change",r[5]),d=!0)},p(C,[T]){let z=e;e=x(C),e===z?_[e].p(C,T):(Kt(),V(_[z],1,1,()=>{_[z]=null}),Jt(),t=_[e],t?t.p(C,T):(t=_[e]=g[e](C),t.c()),N(t,1),t.m(n.parentNode,n)),T&2&&(o.checked=C[1])},i(C){s||(N(t),s=!0)},o(C){V(t),s=!1},d(C){C&&(G(n),G(i)),_[e].d(C),d=!1,p()}}}function vf(r){return[r.lng,r.lat]}function fR(r,e,t){let{map:n}=e;const i=$s();let o=null,u=!1;async function s(x){try{i("loading","Loading from Overpass");let T=await(await fetch(nx(x))).text();u&&sp("osm.xml",T),i("gotXml",{xml:T,boundary:x})}catch(C){i("error",C.toString())}}function d(){let x=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[vf(x.getSouthWest()),vf(x.getNorthWest()),vf(x.getNorthEast()),vf(x.getSouthEast()),vf(x.getSouthWest())]],type:"Polygon"}}}async function p(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await s(d())}}function g(){n&&(t(0,o=new TD(n)),o.startNew(),o.addEventListenerSuccess(async x=>{t(0,o=null),await s(x)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function _(){u=this.checked,t(1,u)}return r.$$set=x=>{"map"in x&&t(4,n=x.map)},[o,u,p,g,n,_]}class hR extends Tt{constructor(e){super(),Ct(this,e,fR,cR,wt,{map:4})}}function nx(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class rx{constructor(e,t,n,i,o,u,s,d){er(this,"inner");this.inner=new f6(e,t||new Uint8Array,n||new Uint8Array,i,o,u,s,d)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=JSON.parse(this.inner.renderNeighbourhood());return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setCurrentNeighbourhoodBoundary(e,t){this.inner.setCurrentNeighbourhoodBoundary(e,t)}extractWaypointsFromRing(e){let t=this.inner.extractWaypointsFromRing(e);return JSON.parse(t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}reclassifyRoadsAlongLine(e,t,n){this.inner.reclassifyRoadsAlongLine(e,t,n)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,u]=n;return{count:i,before:o,after:u}})}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=Qy(t.properties.counts_from),t.properties.sum_to=Qy(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}getMetricBuckets(){try{return JSON.parse(this.inner.getMetricBuckets())}catch{return null}}}async function mp(r){let e=hi(Va).project(r);try{console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:i,boundary:o}=await dR(e);console.timeEnd("get input files"),console.time("load"),kr.set(new rx(new Uint8Array(t),n?new Uint8Array(n):void 0,i?new Uint8Array(i):void 0,o,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),hi(kr).loadSavefile(e),Fs.set(r),console.timeEnd("load"),ix(r)}catch(t){window.alert(`Couldn't open project: ${t}`),Fs.set(void 0)}}async function dR(r){if(r.app_focus=="cnt"){console.assert(r.study_area_name,"CNT projects must have a study area name");let e=Fo(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${e}`);let n=await(await La(e)).arrayBuffer(),i=Fo(`cnt_boundaries/${r.study_area_name}.geojson`),u=await(await La(i)).json(),s=Fo(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${s}`);let d;try{d=await(await La(s)).arrayBuffer()}catch(_){console.log(`No demand model: ${_}`)}let p=Fo(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${p}`);let g;try{g=await(await La(p)).arrayBuffer()}catch(_){console.log(`No context data for prioritization: ${_}`)}return{osmBuffer:n,boundary:u,demandBuffer:d,contextDataBuffer:g}}else if(r.study_area_name){let e=Fo(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${e}`);let n=await(await La(e)).arrayBuffer(),i=Fo(`boundaries/${r.study_area_name}.geojson`),u=await(await La(i)).json();return{osmBuffer:n,boundary:u}}else{console.log("Grabbing from Overpass");let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await La(nx(e))).arrayBuffer(),boundary:e}}}function ix(r){ip.set(new m3(hi(is),hi(kr).toRouteSnapper(),Pn(Ji()),Pn(!0),Pn(0))),hi(is).fitBounds(hi(kr).getBounds(),{duration:500});let e=hi(kr).getMetricBuckets();e&&lc.set(e);let t=new URL(window.location.href);t.searchParams.set("project",r),window.history.replaceState(null,"",t.toString())}function zb(r,e,t){const n=r.slice();return n[17]=e[t][0],n[18]=e[t][1],n}function Db(r,e,t){const n=r.slice();return n[21]=e[t][0],n[22]=e[t][1],n}function pR(r){let e,t,n,i,o,u,s,d=vr(r[5].mode)+"",p,g;return o=new $n({props:{mode:{mode:"title"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),p=Te(d),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(_,x){W(_,e,x),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),R(s,p),g=!0},p(_,x){(!g||x&32)&&d!==(d=vr(_[5].mode)+"")&&At(p,d)},i(_){g||(N(o.$$.fragment,_),g=!0)},o(_){V(o.$$.fragment,_),g=!1},d(_){_&&G(e),le(o)}}}function Rb(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T;e=new sh({props:{loading:r[4]}});let z=On(r[3]),L=[];for(let E=0;E<z.length;E+=1)L[E]=Fb(zb(r,z,E));return _=new hR({props:{map:r[6]}}),_.$on("gotXml",r[7]),_.$on("loading",r[11]),_.$on("error",r[12]),{c(){ue(e.$$.fragment),t=ie(),n=U("label"),i=Te(`Load a built-in area:
        `),o=U("select"),u=U("option");for(let E=0;E<L.length;E+=1)L[E].c();s=ie(),d=U("i"),d.textContent="or...",p=ie(),g=U("div"),ue(_.$$.fragment),u.__value="",Kn(u,u.__value),r[2]===void 0&&ms(()=>r[9].call(o))},m(E,I){ae(e,E,I),W(E,t,I),W(E,n,I),R(n,i),R(n,o),R(o,u);for(let O=0;O<L.length;O+=1)L[O]&&L[O].m(o,null);Wi(o,r[2],!0),W(E,s,I),W(E,d,I),W(E,p,I),W(E,g,I),ae(_,g,null),x=!0,C||(T=[Lt(o,"change",r[9]),Lt(o,"change",r[10])],C=!0)},p(E,I){const O={};if(I&16&&(O.loading=E[4]),e.$set(O),I&8){z=On(E[3]);let K;for(K=0;K<z.length;K+=1){const H=zb(E,z,K);L[K]?L[K].p(H,I):(L[K]=Fb(H),L[K].c(),L[K].m(o,null))}for(;K<L.length;K+=1)L[K].d(1);L.length=z.length}I&12&&Wi(o,E[2]);const B={};I&64&&(B.map=E[6]),_.$set(B)},i(E){x||(N(e.$$.fragment,E),N(_.$$.fragment,E),x=!0)},o(E){V(e.$$.fragment,E),V(_.$$.fragment,E),x=!1},d(E){E&&(G(t),G(n),G(s),G(d),G(p),G(g)),le(e,E),di(L,E),le(_),C=!1,hr(T)}}}function Bb(r){let e,t=r[22]+"",n,i;return{c(){e=U("option"),n=Te(t),e.__value=i=r[21],Kn(e,e.__value)},m(o,u){W(o,e,u),R(e,n)},p(o,u){u&8&&t!==(t=o[22]+"")&&At(n,t),u&8&&i!==(i=o[21])&&(e.__value=i,Kn(e,e.__value))},d(o){o&&G(e)}}}function Fb(r){let e,t,n=On(r[18]),i=[];for(let o=0;o<n.length;o+=1)i[o]=Bb(Db(r,n,o));return{c(){e=U("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();fe(e,"label",t=r[17])},m(o,u){W(o,e,u);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(e,null)},p(o,u){if(u&8){n=On(o[18]);let s;for(s=0;s<n.length;s+=1){const d=Db(o,n,s);i[s]?i[s].p(d,u):(i[s]=Bb(d),i[s].c(),i[s].m(e,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}u&8&&t!==(t=o[17])&&fe(e,"label",t)},d(o){o&&G(e),di(i,o)}}}function mR(r){let e,t,n,i,o,u,s,d,p,g=r[1]&&Rb(r);return{c(){e=U("div"),t=U("div"),n=U("label"),i=Te(`Project name:
        `),o=U("input"),u=ie(),g&&g.c(),fe(o,"type","text"),fe(e,"slot","sidebar")},m(_,x){W(_,e,x),R(e,t),R(t,n),R(n,i),R(n,o),Kn(o,r[1]),R(e,u),g&&g.m(e,null),s=!0,d||(p=Lt(o,"input",r[8]),d=!0)},p(_,x){x&2&&o.value!==_[1]&&Kn(o,_[1]),_[1]?g?(g.p(_,x),x&2&&N(g,1)):(g=Rb(_),g.c(),N(g,1),g.m(e,null)):g&&(Kt(),V(g,1,1,()=>{g=null}),Jt())},i(_){s||(N(g),s=!0)},o(_){V(g),s=!1},d(_){_&&G(e),g&&g.d(),d=!1,p()}}}function gR(r){let e,t,n;return t=new aR({}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","map")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:ft,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function _R(r){let e,t;return e=new xo({props:{$$slots:{map:[gR],sidebar:[mR],top:[pR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&33554558&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yR(r,e,t){let n,i,o,u,s,d;st(r,nr,B=>t(5,n=B)),st(r,Va,B=>t(13,i=B)),st(r,Fs,B=>t(14,o=B)),st(r,kr,B=>t(15,u=B)),st(r,bs,B=>t(16,s=B)),st(r,is,B=>t(6,d=B));let p="",g=null,_=[],x="";ws(async()=>{let B=await La(Fo("severance_pbfs/areas.json"));t(3,_=await B.json())});async function C(B){t(4,x="Loading OSM");try{let K;cn(kr,u=new rx(new TextEncoder().encode(B.detail.xml),void 0,void 0,B.detail.boundary,s,K,p,i.dbSchemaVersion),u);const H=i.createProject(u.toSavefile());cn(Fs,o=H,o),ix(H),cn(nr,n={mode:"add-neighbourhood"},n)}catch(K){window.alert(`Couldn't import from Overpass: ${K}`)}t(4,x="")}async function T(){if(!g)return;let B;try{B=i.createEmptyProject(p,g)}catch(K){t(2,g=null),window.alert(`Couldn't create project: ${K}`);return}t(4,x=`Loading pre-clipped OSM area ${g}`),await mp(B),cn(nr,n={mode:"add-neighbourhood"},n),t(4,x="")}function z(){p=this.value,t(1,p)}function L(){g=za(this),t(2,g),t(3,_)}return[T,p,g,_,x,n,d,C,z,L,()=>T(),B=>t(4,x=B.detail),B=>window.alert(B.detail)]}class vR extends Tt{constructor(e){super(),Ct(this,e,yR,_R,wt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const bR="/ltn/assets/boundaries-2701bb3b.geojson";function Ob(r,e,t){const n=r.slice();return n[9]=e[t],n}function wR(r){let e=r[9]+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i&2&&e!==(e=n[9]+"")&&At(t,e)},d(n){n&&G(t)}}}function $b(r){let e,t,n;function i(){return r[5](r[9])}return t=new oh({props:{$$slots:{default:[wR]},$$scope:{ctx:r}}}),t.$on("click",i),{c(){e=U("li"),ue(t.$$.fragment)},m(o,u){W(o,e,u),ae(t,e,null),n=!0},p(o,u){r=o;const s={};u&4098&&(s.$$scope={dirty:u,ctx:r}),t.$set(s)},i(o){n||(N(t.$$.fragment,o),n=!0)},o(o){V(t.$$.fragment,o),n=!1},d(o){o&&G(e),le(t)}}}function xR(r){let e,t,n=r[8].name+"",i;return{c(){e=U("p"),t=Te("Click to start a new project in "),i=Te(n)},m(o,u){W(o,e,u),R(e,t),R(e,i)},p(o,u){u&256&&n!==(n=o[8].name+"")&&At(i,n)},d(o){o&&G(e)}}}function AR(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[xR,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&4352&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function kR(r){let e,t,n,i;return e=new Xi({props:{paint:{"fill-color":yo.mapFeature.hover.backgroundColor,"fill-outline-color":yo.mapFeature.hover.backgroundColor,"fill-opacity":Xn(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[AR]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new cr({props:{paint:{"line-color":yo.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u&4096&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function SR(r){let e,t,n,i,o,u,s=On(r[1]),d=[];for(let g=0;g<s.length;g+=1)d[g]=$b(Ob(r,s,g));const p=g=>V(d[g],1,1,()=>{d[g]=null});return o=new yr({props:{data:r[0],generateId:!0,$$slots:{default:[kR]},$$scope:{ctx:r}}}),{c(){e=U("p"),e.textContent="Choose a boundary below or on the map to begin sketching:",t=ie(),n=U("ul");for(let g=0;g<d.length;g+=1)d[g].c();i=ie(),ue(o.$$.fragment),Ye(n,"columns","3")},m(g,_){W(g,e,_),W(g,t,_),W(g,n,_);for(let x=0;x<d.length;x+=1)d[x]&&d[x].m(n,null);W(g,i,_),ae(o,g,_),u=!0},p(g,[_]){if(_&10){s=On(g[1]);let C;for(C=0;C<s.length;C+=1){const T=Ob(g,s,C);d[C]?(d[C].p(T,_),N(d[C],1)):(d[C]=$b(T),d[C].c(),N(d[C],1),d[C].m(n,null))}for(Kt(),C=s.length;C<d.length;C+=1)p(C);Jt()}const x={};_&1&&(x.data=g[0]),_&4096&&(x.$$scope={dirty:_,ctx:g}),o.$set(x)},i(g){if(!u){for(let _=0;_<s.length;_+=1)N(d[_]);N(o.$$.fragment,g),u=!0}},o(g){d=d.filter(Boolean);for(let _=0;_<d.length;_+=1)V(d[_]);V(o.$$.fragment,g),u=!1},d(g){g&&(G(e),G(t),G(n),G(i)),di(d,g),le(o,g)}}}function CR(r,e,t){let n,i;st(r,nr,_=>t(6,n=_)),st(r,Va,_=>t(7,i=_));let{activityIndicatorText:o}=e,u={type:"FeatureCollection",features:[]},s=[];ws(async()=>{let _=await fetch(bR);t(0,u=await _.json());for(let x of u.features)s.push(x.properties.name);s.sort(),t(1,s)});function d(_){let x=_.detail.features[0].properties;p(`${x.kind}_${x.name}`)}async function p(_){let x,C=!1;for(;!C;){let T=x||i.nextAvailableProjectName(Bf(_));if(x=window.prompt(`Please pick a project name to create in ${Bf(_)}`,T),x===null)return;if(x=x.trim(),x===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}t(4,o=`Loading pre-clipped OSM area ${Bf(_)}`);try{let z=i.createEmptyProject(x,_);await mp(z),cn(nr,n={mode:"add-neighbourhood"},n),C=!0}catch(z){window.alert(z)}t(4,o="")}}const g=_=>p(`LAD_${_}`);return r.$$set=_=>{"activityIndicatorText"in _&&t(4,o=_.activityIndicatorText)},[u,s,d,p,o,g]}class TR extends Tt{constructor(e){super(),Ct(this,e,CR,SR,wt,{activityIndicatorText:4})}}function MR(r){let e,t,n,i,o,u;return{c(){e=U("label"),t=U("strong"),t.textContent="Load a project from a file",n=ie(),i=U("input"),fe(i,"type","file"),Ye(e,"margin-top","16px")},m(s,d){W(s,e,d),R(e,t),R(e,n),R(e,i),r[3](i),o||(u=Lt(i,"change",r[1]),o=!0)},p:ft,i:ft,o:ft,d(s){s&&G(e),r[3](null),o=!1,u()}}}function ER(r,e,t){let n;st(r,nr,d=>t(4,n=d));let{loading:i}=e,o;async function u(d){let p=o.files[0].name;t(2,i=`Loading from file ${p}`);let g=await o.files[0].text(),_=JSON.parse(g),x,C,T;_.app_focus&&(console.assert(_.app_focus=="global"||_.app_focus=="cnt"),x=_.app_focus),_.study_area_name&&(C=_.study_area_name),_.project_name&&(T=_.project_name),(!_.app_focus||!_.project_name)&&(_.study_area_name&&_.study_area_name.startsWith("LAD_")?(x="cnt",T=e1(sg(p,`ltn_cnt_${_.study_area_name}_`),".geojson")):(x="global",T=e1(sg(p,"ltn_"),".geojson"))),T=T,x=x;let z=Mw.projectStorage(x);T=z.nextAvailableProjectName(T),_.project_name=T,_.app_focus=x,_.study_area_name=C;let L=z.createProject(_);await mp(L),cn(nr,n={mode:"pick-neighbourhood"},n),t(2,i="")}function s(d){pn[d?"unshift":"push"](()=>{o=d,t(0,o)})}return r.$$set=d=>{"loading"in d&&t(2,i=d.loading)},[o,u,i,s]}class LR extends Tt{constructor(e){super(),Ct(this,e,ER,MR,wt,{loading:2})}}function Nb(r,e,t){const n=r.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function jb(r,e,t){const n=r.slice();return n[26]=e[t].projectID,n[27]=e[t].projectName,n}function IR(r){let e,t,n,i,o=vr(r[3].mode)+"",u;return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),u=Te(o),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(s,d){W(s,e,d),R(e,t),R(t,n),R(n,i),R(i,u)},p(s,d){d&8&&o!==(o=vr(s[3].mode)+"")&&At(u,o)},d(s){s&&G(e)}}}function PR(r){let e;return{c(){e=U("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){W(t,e,n)},p:ft,i:ft,o:ft,d(t){t&&G(e)}}}function zR(r){let e,t,n,i,o,u,s,d,p,g=r[2].length>0&&Ub(r);const _=[BR,RR],x=[];function C(L,E){return L[5]=="global"?0:L[5]=="cnt"?1:-1}~(i=C(r))&&(o=x[i]=_[i](r));function T(L){r[15](L)}let z={};return r[1]!==void 0&&(z.loading=r[1]),s=new LR({props:z}),pn.push(()=>Dn(s,"loading",T)),{c(){g&&g.c(),e=ie(),t=U("h1"),t.textContent="Start a new project",n=ie(),o&&o.c(),u=ie(),ue(s.$$.fragment)},m(L,E){g&&g.m(L,E),W(L,e,E),W(L,t,E),W(L,n,E),~i&&x[i].m(L,E),W(L,u,E),ae(s,L,E),p=!0},p(L,E){L[2].length>0?g?(g.p(L,E),E&4&&N(g,1)):(g=Ub(L),g.c(),N(g,1),g.m(e.parentNode,e)):g&&(Kt(),V(g,1,1,()=>{g=null}),Jt());let I=i;i=C(L),i===I?~i&&x[i].p(L,E):(o&&(Kt(),V(x[I],1,1,()=>{x[I]=null}),Jt()),~i?(o=x[i],o?o.p(L,E):(o=x[i]=_[i](L),o.c()),N(o,1),o.m(u.parentNode,u)):o=null);const O={};!d&&E&2&&(d=!0,O.loading=L[1],zn(()=>d=!1)),s.$set(O)},i(L){p||(N(g),N(o),N(s.$$.fragment,L),p=!0)},o(L){V(g),V(o),V(s.$$.fragment,L),p=!1},d(L){L&&(G(e),G(t),G(n),G(u)),g&&g.d(L),~i&&x[i].d(L),le(s,L)}}}function Ub(r){let e,t,n,i,o=On(r[2]),u=[];for(let d=0;d<o.length;d+=1)u[d]=qb(Nb(r,o,d));const s=d=>V(u[d],1,1,()=>{u[d]=null});return{c(){e=U("h1"),e.textContent="Your projects",t=ie(),n=U("div");for(let d=0;d<u.length;d+=1)u[d].c();fe(n,"class","project-list svelte-s5f8l2")},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(n,null);i=!0},p(d,p){if(p&452){o=On(d[2]);let g;for(g=0;g<o.length;g+=1){const _=Nb(d,o,g);u[g]?(u[g].p(_,p),N(u[g],1)):(u[g]=qb(_),u[g].c(),N(u[g],1),u[g].m(n,null))}for(Kt(),g=o.length;g<u.length;g+=1)s(g);Jt()}},i(d){if(!i){for(let p=0;p<o.length;p+=1)N(u[p]);i=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)V(u[p]);i=!1},d(d){d&&(G(e),G(t),G(n)),di(u,d)}}}function DR(r){let e=r[27]+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i&4&&e!==(e=n[27]+"")&&At(t,e)},d(n){n&&G(t)}}}function Vb(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L;function E(){return r[9](r[26],r[27])}n=new oh({props:{$$slots:{default:[DR]},$$scope:{ctx:r}}}),n.$on("click",E),s=new Ew({props:{color:"black"}});function I(){return r[10](r[26])}g=new $g({props:{color:"black"}});function O(){return r[11](r[26],r[27])}C=new Ng({props:{color:"white"}});function B(){return r[12](r[26],r[27])}return{c(){e=U("li"),t=U("h3"),ue(n.$$.fragment),i=ie(),o=U("span"),u=U("button"),ue(s.$$.fragment),d=ie(),p=U("button"),ue(g.$$.fragment),_=ie(),x=U("button"),ue(C.$$.fragment),fe(u,"class","outline icon-btn"),fe(u,"title","Download project as GeoJSON"),fe(p,"class","outline icon-btn"),fe(p,"title","Rename project"),fe(x,"class","icon-btn destructive"),fe(x,"title","Delete project"),fe(o,"class","actions"),fe(e,"class","actionable-cell svelte-s5f8l2")},m(K,H){W(K,e,H),R(e,t),ae(n,t,null),R(e,i),R(e,o),R(o,u),ae(s,u,null),R(o,d),R(o,p),ae(g,p,null),R(o,_),R(o,x),ae(C,x,null),T=!0,z||(L=[Lt(u,"click",I),Lt(p,"click",O),Lt(x,"click",B)],z=!0)},p(K,H){r=K;const q={};H&1073741828&&(q.$$scope={dirty:H,ctx:r}),n.$set(q)},i(K){T||(N(n.$$.fragment,K),N(s.$$.fragment,K),N(g.$$.fragment,K),N(C.$$.fragment,K),T=!0)},o(K){V(n.$$.fragment,K),V(s.$$.fragment,K),V(g.$$.fragment,K),V(C.$$.fragment,K),T=!1},d(K){K&&G(e),le(n),le(s),le(g),le(C),z=!1,hr(L)}}}function qb(r){let e,t=Bf(r[22])+"",n,i,o,u,s,d=On(r[23]),p=[];for(let _=0;_<d.length;_+=1)p[_]=Vb(jb(r,d,_));const g=_=>V(p[_],1,1,()=>{p[_]=null});return{c(){e=U("h2"),n=Te(t),i=ie(),o=U("ul");for(let _=0;_<p.length;_+=1)p[_].c();u=ie(),fe(e,"class","study-area-name svelte-s5f8l2"),fe(o,"class","navigable-list")},m(_,x){W(_,e,x),R(e,n),W(_,i,x),W(_,o,x);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(o,null);R(o,u),s=!0},p(_,x){if((!s||x&4)&&t!==(t=Bf(_[22])+"")&&At(n,t),x&452){d=On(_[23]);let C;for(C=0;C<d.length;C+=1){const T=jb(_,d,C);p[C]?(p[C].p(T,x),N(p[C],1)):(p[C]=Vb(T),p[C].c(),N(p[C],1),p[C].m(o,u))}for(Kt(),C=d.length;C<p.length;C+=1)g(C);Jt()}},i(_){if(!s){for(let x=0;x<d.length;x+=1)N(p[x]);s=!0}},o(_){p=p.filter(Boolean);for(let x=0;x<p.length;x+=1)V(p[x]);s=!1},d(_){_&&(G(e),G(i),G(o)),di(p,_)}}}function RR(r){let e,t,n;function i(u){r[14](u)}let o={};return r[1]!==void 0&&(o.activityIndicatorText=r[1]),e=new TR({props:o}),pn.push(()=>Dn(e,"activityIndicatorText",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const d={};!t&&s&2&&(t=!0,d.activityIndicatorText=u[1],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function BR(r){let e,t,n;return{c(){e=U("button"),e.textContent="New project"},m(i,o){W(i,e,o),t||(n=Lt(e,"click",r[13]),t=!0)},p:ft,i:ft,o:ft,d(i){i&&G(e),t=!1,n()}}}function FR(r){let e,t,n,i;const o=[zR,PR],u=[];function s(d,p){return d[4]&&d[0]?0:1}return t=s(r),n=u[t]=o[t](r),{c(){e=U("div"),n.c(),fe(e,"slot","sidebar")},m(d,p){W(d,e,p),u[t].m(e,null),i=!0},p(d,p){let g=t;t=s(d),t===g?u[t].p(d,p):(Kt(),V(u[g],1,1,()=>{u[g]=null}),Jt(),n=u[t],n?n.p(d,p):(n=u[t]=o[t](d),n.c()),N(n,1),n.m(e,null))},i(d){i||(N(n),i=!0)},o(d){V(n),i=!1},d(d){d&&G(e),u[t].d()}}}function OR(r){let e,t,n,i;return e=new sh({props:{loading:r[1]}}),n=new xo({props:{$$slots:{sidebar:[FR],top:[IR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&2&&(s.loading=o[1]),e.$set(s);const d={};u&1073741887&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function $R(r,e,t){let n,i,o,u,s,d,p,g;st(r,nr,he=>t(3,n=he)),st(r,Va,he=>t(16,i=he)),st(r,is,he=>t(4,o=he)),st(r,bs,he=>t(5,u=he)),st(r,ty,he=>t(17,s=he)),st(r,Fs,he=>t(18,d=he)),st(r,ip,he=>t(19,p=he)),st(r,kr,he=>t(20,g=he));let{wasmReady:_}=e,x="";if(cn(kr,g=null,g),cn(ip,p=null,p),cn(Fs,d=void 0,d),s){let Ee=new URLSearchParams(window.location.search).get("project");Ee&&T(Ee),cn(ty,s=!1,s)}else{let he=new URL(window.location.href);he.searchParams.delete("project"),window.history.replaceState(null,"",he.toString())}if(o&&!s){let he=[-180,-90,180,90];u=="cnt"&&(he=[-8.943,54.631,-.901,59.489]),o.fitBounds(he,{duration:500})}let C=i.studyAreaProjects();function T(he){let Ee=he;try{let Y=i.projectName(Ee);if(!Y){console.error(`Project ${Ee} from URL not found`);return}E(Ee,Y)}catch{console.error(`Error trying to fetch project from URL: ${Ee}`)}}function z(he,Ee){window.confirm(`Really delete project ${Ee}? You can't undo this.`)&&(i.removeProject(he),t(2,C=i.studyAreaProjects()))}function L(he,Ee){let Y=window.prompt(`Rename project ${Ee} to what?`,Ee);if(Y){try{i.renameProject(he,Y)}catch(oe){window.alert(`Couldn't rename project: ${oe}`)}t(2,C=i.studyAreaProjects())}}async function E(he,Ee){t(1,x=`Loading project ${Ee}`),await mp(he),cn(nr,n={mode:"pick-neighbourhood"},n),t(1,x="")}const I=(he,Ee)=>E(he,Ee),O=he=>x2(he),B=(he,Ee)=>L(he,Ee),K=(he,Ee)=>z(he,Ee),H=()=>cn(nr,n={mode:"new-project"},n);function q(he){x=he,t(1,x)}function J(he){x=he,t(1,x)}return r.$$set=he=>{"wasmReady"in he&&t(0,_=he.wasmReady)},[_,x,C,n,o,u,z,L,E,I,O,B,K,H,q,J]}class NR extends Tt{constructor(e){super(),Ct(this,e,$R,OR,wt,{wasmReady:0})}}function jR(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T=vr(r[1].mode)+"",z,L;return o=new $n({props:{mode:{mode:"title"}}}),d=new $n({props:{mode:{mode:"pick-neighbourhood"}}}),_=new $n({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=ie(),s=U("li"),ue(d.$$.fragment),p=ie(),g=U("li"),ue(_.$$.fragment),x=ie(),C=U("li"),z=Te(T),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(E,I){W(E,e,I),R(e,t),R(t,n),R(n,i),ae(o,i,null),R(n,u),R(n,s),ae(d,s,null),R(n,p),R(n,g),ae(_,g,null),R(n,x),R(n,C),R(C,z),L=!0},p(E,I){(!L||I&2)&&T!==(T=vr(E[1].mode)+"")&&At(z,T)},i(E){L||(N(o.$$.fragment,E),N(d.$$.fragment,E),N(_.$$.fragment,E),L=!0)},o(E){V(o.$$.fragment,E),V(d.$$.fragment,E),V(_.$$.fragment,E),L=!1},d(E){E&&G(e),le(o),le(d),le(_)}}}function UR(r){let e,t,n,i,o,u,s,d,p,g,_=_r(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",x,C,T,z,L,E;function I(B){r[4](B)}let O={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(O.idx=r[0].shortcutIndex),o=new fp({props:O}),pn.push(()=>Dn(o,"idx",I)),{c(){e=U("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=ie(),n=U("button"),n.textContent="Pick a different road",i=ie(),ue(o.$$.fragment),s=ie(),d=U("p"),p=Te("This shortcut is "),g=U("b"),x=Te(_),C=Te("x"),T=Te(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(B,K){W(B,e,K),W(B,t,K),W(B,n,K),W(B,i,K),ae(o,B,K),W(B,s,K),W(B,d,K),R(d,p),R(d,g),R(g,x),R(g,C),R(d,T),z=!0,L||(E=Lt(n,"click",r[3]),L=!0)},p(B,K){const H={};K&1&&(H.list=B[0].gj.features),!u&&K&1&&(u=!0,H.idx=B[0].shortcutIndex,zn(()=>u=!1)),o.$set(H),(!z||K&1)&&_!==(_=_r(B[0].gj.features[B[0].shortcutIndex].properties).directness.toFixed(1)+"")&&At(x,_)},i(B){z||(N(o.$$.fragment,B),z=!0)},o(B){V(o.$$.fragment,B),z=!1},d(B){B&&(G(e),G(t),G(n),G(i),G(s),G(d)),le(o,B),L=!1,E()}}}function VR(r){let e;return{c(){e=U("p"),e.textContent="Click a road to see shortcuts"},m(t,n){W(t,e,n)},p:ft,i:ft,o:ft,d(t){t&&G(e)}}}function qR(r){let e,t,n,i,o,u;t=new Ns({props:{mode:{mode:"neighbourhood"}}});const s=[VR,UR],d=[];function p(g,_){return g[0].state=="neutral"?0:g[0].state=="chose-road"?1:-1}return~(i=p(r))&&(o=d[i]=s[i](r)),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),o&&o.c(),fe(e,"slot","sidebar")},m(g,_){W(g,e,_),ae(t,e,null),R(e,n),~i&&d[i].m(e,null),u=!0},p(g,_){let x=i;i=p(g),i===x?~i&&d[i].p(g,_):(o&&(Kt(),V(d[x],1,1,()=>{d[x]=null}),Jt()),~i?(o=d[i],o?o.p(g,_):(o=d[i]=s[i](g),o.c()),N(o,1),o.m(e,null)):o=null)},i(g){u||(N(t.$$.fragment,g),N(o),u=!0)},o(g){V(t.$$.fragment,g),V(o),u=!1},d(g){g&&G(e),le(t),~i&&d[i].d()}}}function HR(r){let e,t;return e=new hh({props:{interactive:!1}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function GR(r){let e,t;return e=new hh({props:{onClickLine:r[2],$$slots:{"line-popup":[KR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function WR(r){let e,t,n=(r[6].name??"unnamed road")+"",i;return{c(){e=U("p"),t=Te("Main road: "),i=Te(n)},m(o,u){W(o,e,u),R(e,t),R(e,i)},p(o,u){u&64&&n!==(n=(o[6].name??"unnamed road")+"")&&At(i,n)},d(o){o&&G(e)}}}function ZR(r){let e,t=r[6].shortcuts+"",n,i,o=(r[6].name??"unnamed road")+"",u;return{c(){e=U("p"),n=Te(t),i=Te(" shortcuts through "),u=Te(o)},m(s,d){W(s,e,d),R(e,n),R(e,i),R(e,u)},p(s,d){d&64&&t!==(t=s[6].shortcuts+"")&&At(n,t),d&64&&o!==(o=(s[6].name??"unnamed road")+"")&&At(u,o)},d(s){s&&G(e)}}}function XR(r){let e;function t(o,u){if(o[6].kind=="interior_road")return ZR;if(o[6].kind=="main_road")return WR}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=rr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&G(e),i&&i.d(o)}}}function KR(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[XR,({props:i})=>({6:i}),({props:i})=>i?64:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"slot","line-popup")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function JR(r){let e,t,n,i,o,u,s,d,p,g;e=new dp({}),n=new hp({}),o=new pp({});const _=[GR,HR],x=[];function C(T,z){return T[0].state=="neutral"?0:T[0].state=="chose-road"?1:-1}return~(s=C(r))&&(d=x[s]=_[s](r)),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),d&&d.c(),p=rr()},m(T,z){ae(e,T,z),W(T,t,z),ae(n,T,z),W(T,i,z),ae(o,T,z),W(T,u,z),~s&&x[s].m(T,z),W(T,p,z),g=!0},p(T,z){let L=s;s=C(T),s===L?~s&&x[s].p(T,z):(d&&(Kt(),V(x[L],1,1,()=>{x[L]=null}),Jt()),~s?(d=x[s],d?d.p(T,z):(d=x[s]=_[s](T),d.c()),N(d,1),d.m(p.parentNode,p)):d=null)},i(T){g||(N(e.$$.fragment,T),N(n.$$.fragment,T),N(o.$$.fragment,T),N(d),g=!0)},o(T){V(e.$$.fragment,T),V(n.$$.fragment,T),V(o.$$.fragment,T),V(d),g=!1},d(T){T&&(G(t),G(i),G(u),G(p)),le(e,T),le(n,T),le(o,T),~s&&x[s].d(T)}}}function Hb(r){let e,t,n,i,o,u,s,d;return e=new yr({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[YR]},$$scope:{ctx:r}}}),n=new yr({props:{data:r[0].roadGj,$$slots:{default:[QR]},$$scope:{ctx:r}}}),o=new Rl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[eB]},$$scope:{ctx:r}}}),s=new Rl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[tB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment),i=ie(),ue(o.$$.fragment),u=ie(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),W(p,i,g),ae(o,p,g),W(p,u,g),ae(s,p,g),d=!0},p(p,g){const _={};g&1&&(_.data=p[0].gj.features[p[0].shortcutIndex]),g&128&&(_.$$scope={dirty:g,ctx:p}),e.$set(_);const x={};g&1&&(x.data=p[0].roadGj),g&128&&(x.$$scope={dirty:g,ctx:p}),n.$set(x);const C={};g&1&&(C.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[0]),g&128&&(C.$$scope={dirty:g,ctx:p}),o.$set(C);const T={};g&1&&(T.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[p[0].gj.features[p[0].shortcutIndex].geometry.coordinates.length-1]),g&128&&(T.$$scope={dirty:g,ctx:p}),s.$set(T)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(G(t),G(i),G(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function YR(r){let e,t;const n=[yn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function QR(r){let e,t;const n=[yn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new cr({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function eB(r){let e;return{c(){e=Te("A")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function tB(r){let e;return{c(){e=Te("B")},m(t,n){W(t,e,n)},d(t){t&&G(e)}}}function nB(r){let e,t,n,i,o,u;t=new dh({props:{$$slots:{default:[JR]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&Hb(r);return o=new Ya({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),s&&s.c(),i=ie(),ue(o.$$.fragment),fe(e,"slot","map")},m(d,p){W(d,e,p),ae(t,e,null),R(e,n),s&&s.m(e,null),R(e,i),ae(o,e,null),u=!0},p(d,p){const g={};p&129&&(g.$$scope={dirty:p,ctx:d}),t.$set(g),d[0].state=="chose-road"?s?(s.p(d,p),p&1&&N(s,1)):(s=Hb(d),s.c(),N(s,1),s.m(e,i)):s&&(Kt(),V(s,1,1,()=>{s=null}),Jt())},i(d){u||(N(t.$$.fragment,d),N(s),N(o.$$.fragment,d),u=!0)},o(d){V(t.$$.fragment,d),V(s),V(o.$$.fragment,d),u=!1},d(d){d&&G(e),le(t),s&&s.d(),le(o)}}}function rB(r){let e,t;return e=new xo({props:{$$slots:{map:[nB],sidebar:[qR],top:[jR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&131&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function iB(r,e,t){let n,i;st(r,kr,p=>t(5,n=p)),st(r,nr,p=>t(1,i=p));let o={state:"neutral"};function u(p,g){let _=n.getShortcutsCrossingRoad(p.properties.id);if(_.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:p,gj:_,shortcutIndex:0})}const s=()=>t(0,o={state:"neutral"});function d(p){r.$$.not_equal(o.shortcutIndex,p)&&(o.shortcutIndex=p,t(0,o))}return[o,i,u,s,d]}class oB extends Tt{constructor(e){super(),Ct(this,e,iB,rB,wt,{})}}function sB(r){let e,t,n,i,o,u;return{c(){e=U("div"),t=U("button"),t.innerHTML=`<img src="${fk}" style="height: 32px;" alt="A/B Street logo"/>`,n=ie(),i=U("span"),fe(t,"class","outline"),Ye(i,"width","100%"),fe(e,"slot","top"),fe(e,"class","pico"),Ye(e,"display","flex"),Ye(e,"align-items","center"),Ye(e,"gap","8px")},m(s,d){W(s,e,d),R(e,t),R(e,n),R(e,i),r[24](i),o||(u=Lt(t,"click",r[23]),o=!0)},p:ft,d(s){s&&G(e),r[24](null),o=!1,u()}}}function aB(r){let e,t;return{c(){e=U("div"),t=U("div"),fe(e,"class","pico"),fe(e,"slot","left")},m(n,i){W(n,e,i),R(e,t),r[22](t)},p:ft,d(n){n&&G(e),r[22](null)}}}function Gb(r){let e,t,n;function i(u){r[20](u)}let o={style:r[7],hash:!0,bounds:r[6],maxZoom:19,images:[{id:zi.walkCycleOnly.filterType,url:zi.walkCycleOnly.iconURL},{id:zi.noEntry.filterType,url:zi.noEntry.iconURL},{id:zi.busGate.filterType,url:zi.busGate.iconURL},{id:zi.schoolStreet.filterType,url:zi.schoolStreet.iconURL},{id:"diagonal_filter",url:ck},{id:"no_straight_turn",url:rw},{id:"no_left_turn",url:nw},{id:"no_right_turn",url:Eg},{id:"no_u_left_to_right_turn",url:ow},{id:"no_u_right_to_left_turn",url:iw},{id:"oneway_arrow",url:uk},{id:"border_entry_arrow",url:lk,options:{sdf:!0}},{id:"national_rail",url:sw}],$$slots:{default:[MB]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.map=r[0]),e=new OS({props:o}),pn.push(()=>Dn(e,"map",i)),e.$on("error",r[21]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const d={};s&128&&(d.style=u[7]),s&64&&(d.bounds=u[6]),s&268438329&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.map=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function Wb(r){let e,t,n,i;return e=new Jm({props:{position:"top-left",$$slots:{default:[cB]},$$scope:{ctx:r}}}),n=new Jm({props:{position:"top-left",$$slots:{default:[hB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=ie(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u&268435456&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&268435984&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&G(t),le(e,o),le(n,o)}}}function lB(r){let e,t,n;return t=new f4({}),{c(){e=U("div"),ue(t.$$.fragment),fe(e,"class","ltn-map-btn zoom-to-fit-btn")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:ft,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&G(e),le(t)}}}function uB(r){let e,t;return e=new Dw({props:{title:"Zoom to fit study area",$$slots:{default:[lB]},$$scope:{ctx:r}}}),e.$on("click",r[18]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cB(r){let e,t;return e=new Rw({props:{$$slots:{default:[uB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function fB(r){let e,t;return e=new WT({props:{map:_r(r[9]),maptilerBasemap:r[4]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&512&&(o.map=_r(n[9])),i&16&&(o.maptilerBasemap=n[4]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function hB(r){let e,t;return e=new Rw({props:{$$slots:{default:[fB]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268435984&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function dB(r){let e,t;return e=new vR({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function pB(r){let e,t;return e=new NR({props:{wasmReady:r[5]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&32&&(o.wasmReady=n[5]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Zb(r){let e,t,n,i,o,u;e=new yr({props:{data:r[8].getInvertedBoundary(),$$slots:{default:[mB]},$$scope:{ctx:r}}});const s=[TB,CB,SB,kB,AB,xB,wB,bB,vB,yB,_B,gB],d=[];function p(g,_){return g[11].mode=="pick-neighbourhood"?0:g[11].mode=="set-boundary"?1:g[11].mode=="add-neighbourhood"?2:g[11].mode=="neighbourhood"?3:g[11].mode=="view-shortcuts"?4:g[11].mode=="impact-one-destination"?5:g[11].mode=="route"?6:g[11].mode=="predict-impact"?7:g[11].mode=="impact-detail"?8:g[11].mode=="debug-neighbourhood"?9:g[11].mode=="debug-intersections"?10:g[11].mode=="debug-demand"?11:-1}return~(n=p(r))&&(i=d[n]=s[n](r)),{c(){ue(e.$$.fragment),t=ie(),i&&i.c(),o=rr()},m(g,_){ae(e,g,_),W(g,t,_),~n&&d[n].m(g,_),W(g,o,_),u=!0},p(g,_){const x={};_&256&&(x.data=g[8].getInvertedBoundary()),_&268435456&&(x.$$scope={dirty:_,ctx:g}),e.$set(x);let C=n;n=p(g),n===C?~n&&d[n].p(g,_):(i&&(Kt(),V(d[C],1,1,()=>{d[C]=null}),Jt()),~n?(i=d[n],i?i.p(g,_):(i=d[n]=s[n](g),i.c()),N(i,1),i.m(o.parentNode,o)):i=null)},i(g){u||(N(e.$$.fragment,g),N(i),u=!0)},o(g){V(e.$$.fragment,g),V(i),u=!1},d(g){g&&(G(t),G(o)),le(e,g),~n&&d[n].d(g)}}}function mB(r){let e,t;const n=[yn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=It(i,n[o]);return e=new Xi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function gB(r){let e,t;return e=new N8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function _B(r){let e,t;return e=new Z8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yB(r){let e,t;return e=new $P({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function vB(r){let e,t;return e=new h7({props:{road:r[11].road,prevPrevMode:r[11].prevPrevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&2048&&(o.road=n[11].road),i&2048&&(o.prevPrevMode=n[11].prevPrevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function bB(r){let e,t;return e=new rD({props:{prevMode:r[11].prevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&2048&&(o.prevMode=n[11].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function wB(r){let e,t;return e=new _D({props:{prevMode:r[11].prevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&2048&&(o.prevMode=n[11].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function xB(r){let e,t;return e=new L7({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function AB(r){let e,t;return e=new oB({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function kB(r){let e,t;return e=new r7({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function SB(r){let e,t;return e=new A8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function CB(r){let e,t;return e=new xD({props:{name:r[11].name,existing:r[11].existing}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&2048&&(o.name=n[11].name),i&2048&&(o.existing=n[11].existing),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function TB(r){let e,t;return e=new G7({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:ft,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function MB(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,T,z,L,E;e=new Ow({props:{showCompass:!1}});let I=r[8]&&Wb(r);i=new BL({props:{map:r[0],apiKey:Tw,country:void 0}}),u=new $w({});const O=[pB,dB],B=[];function K(q,J){return q[11].mode=="title"?0:q[11].mode=="new-project"?1:-1}~(g=K(r))&&(_=B[g]=O[g](r)),C=new o6({});let H=r[8]&&Zb(r);return L=new bT({}),{c(){ue(e.$$.fragment),t=ie(),I&&I.c(),n=ie(),ue(i.$$.fragment),o=ie(),ue(u.$$.fragment),s=ie(),d=U("div"),p=ie(),_&&_.c(),x=ie(),ue(C.$$.fragment),T=ie(),H&&H.c(),z=ie(),ue(L.$$.fragment)},m(q,J){ae(e,q,J),W(q,t,J),I&&I.m(q,J),W(q,n,J),ae(i,q,J),W(q,o,J),ae(u,q,J),W(q,s,J),W(q,d,J),r[19](d),W(q,p,J),~g&&B[g].m(q,J),W(q,x,J),ae(C,q,J),W(q,T,J),H&&H.m(q,J),W(q,z,J),ae(L,q,J),E=!0},p(q,J){q[8]?I?(I.p(q,J),J&256&&N(I,1)):(I=Wb(q),I.c(),N(I,1),I.m(n.parentNode,n)):I&&(Kt(),V(I,1,1,()=>{I=null}),Jt());const he={};J&1&&(he.map=q[0]),i.$set(he);let Ee=g;g=K(q),g===Ee?~g&&B[g].p(q,J):(_&&(Kt(),V(B[Ee],1,1,()=>{B[Ee]=null}),Jt()),~g?(_=B[g],_?_.p(q,J):(_=B[g]=O[g](q),_.c()),N(_,1),_.m(x.parentNode,x)):_=null),q[8]?H?(H.p(q,J),J&256&&N(H,1)):(H=Zb(q),H.c(),N(H,1),H.m(z.parentNode,z)):H&&(Kt(),V(H,1,1,()=>{H=null}),Jt())},i(q){E||(N(e.$$.fragment,q),N(I),N(i.$$.fragment,q),N(u.$$.fragment,q),N(_),N(C.$$.fragment,q),N(H),N(L.$$.fragment,q),E=!0)},o(q){V(e.$$.fragment,q),V(I),V(i.$$.fragment,q),V(u.$$.fragment,q),V(_),V(C.$$.fragment,q),V(H),V(L.$$.fragment,q),E=!1},d(q){q&&(G(t),G(n),G(o),G(s),G(d),G(p),G(x),G(T),G(z)),le(e,q),I&&I.d(q),le(i,q),le(u,q),r[19](null),~g&&B[g].d(q),le(C,q),H&&H.d(q),le(L,q)}}}function EB(r){let e,t,n=r[7]&&Gb(r);return{c(){e=U("div"),n&&n.c(),fe(e,"slot","main"),Ye(e,"position","relative"),Ye(e,"width","100%"),Ye(e,"height","100%")},m(i,o){W(i,e,o),n&&n.m(e,null),t=!0},p(i,o){i[7]?n?(n.p(i,o),o&128&&N(n,1)):(n=Gb(i),n.c(),N(n,1),n.m(e,null)):n&&(Kt(),V(n,1,1,()=>{n=null}),Jt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&G(e),n&&n.d()}}}function LB(r){let e,t,n,i,o,u,s;return t=new x3({}),o=new b6({props:{$$slots:{main:[EB],left:[aB],top:[sB]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),n=ie(),i=U("div"),ue(o.$$.fragment),fe(e,"class","pico"),fe(i,"class",u="app-focus-"+r[10])},m(d,p){W(d,e,p),ae(t,e,null),W(d,n,p),W(d,i,p),ae(o,i,null),s=!0},p(d,[p]){const g={};p&268442623&&(g.$$scope={dirty:p,ctx:d}),o.$set(g),(!s||p&1024&&u!==(u="app-focus-"+d[10]))&&fe(i,"class",u)},i(d){s||(N(t.$$.fragment,d),N(o.$$.fragment,d),s=!0)},o(d){V(t.$$.fragment,d),V(o.$$.fragment,d),s=!1},d(d){d&&(G(e),G(n),G(i)),le(t),le(o)}}}function IB(r,e,t){let n,i,o,u,s,d,p,g,_,x,C;st(r,qm,Ne=>t(4,n=Ne)),st(r,wg,Ne=>t(15,i=Ne)),st(r,bg,Ne=>t(16,o=Ne)),st(r,vg,Ne=>t(17,u=Ne)),st(r,kr,Ne=>t(8,s=Ne)),st(r,is,Ne=>t(9,d=Ne)),st(r,If,Ne=>t(25,p=Ne)),st(r,Xm,Ne=>t(26,g=Ne)),st(r,bs,Ne=>t(10,_=Ne)),st(r,nr,Ne=>t(11,x=Ne)),st(r,Xd,Ne=>t(12,C=Ne));let{appFocus:T="global"}=e;bs.set(T);let z=!1;ws(async()=>{await j2(),await hw(),t(5,z=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(cn(Xm,g=!0,g),console.log("Using local cache, not od2net.org"))}catch{}let Ne=new URLSearchParams(window.location.search).get("dev");Ne==="true"||Ne===""?cn(If,p=!0,p):(console.assert(Ne===null||Ne=="false",`unknown dev mode value: ${Ne}, should be "true", "false", or empty`),cn(If,p=!1,p))});let L=null;function E(Ne){d.fitBounds(s.getBounds(),{animate:Ne})}let I,O,B,K;T=="cnt"&&(K=[-8.943,54.631,-.901,59.489]);let H=null;async function q(Ne){Ne=="streets-v2"?t(7,H=C6):t(7,H=`https://api.maptiler.com/maps/${Ne}/style.json?key=${Tw}`)}const J=()=>E(!0);function he(Ne){pn[Ne?"unshift":"push"](()=>{B=Ne,t(3,B),t(15,i)})}function Ee(Ne){L=Ne,t(0,L)}const Y=Ne=>{console.log(Ne.detail.error)};function oe(Ne){pn[Ne?"unshift":"push"](()=>{O=Ne,t(2,O),t(16,o)})}const ke=()=>cn(Xd,C=!0,C);function ye(Ne){pn[Ne?"unshift":"push"](()=>{I=Ne,t(1,I),t(17,u)})}return r.$$set=Ne=>{"appFocus"in Ne&&t(14,T=Ne.appFocus)},r.$$.update=()=>{r.$$.dirty&1&&L&&(L.keyboard.disableRotation(),L.dragRotate.disable(),L.touchZoomRotate.disableRotation(),is.set(L)),r.$$.dirty&131074&&I&&u&&(t(1,I.innerHTML="",I),I.appendChild(u)),r.$$.dirty&65540&&O&&o&&(t(2,O.innerHTML="",O),O.appendChild(o)),r.$$.dirty&32776&&B&&i&&(t(3,B.innerHTML="",B),B.appendChild(i)),r.$$.dirty&16&&q(n)},[L,I,O,B,n,z,K,H,s,d,_,x,C,E,T,i,o,u,J,he,Ee,Y,oe,ke,ye]}class NB extends Tt{constructor(e){super(),Ct(this,e,IB,LB,wt,{appFocus:14})}}export{NB as A};
