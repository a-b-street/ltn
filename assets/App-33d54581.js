var j2=Object.defineProperty;var U2=(r,e,t)=>e in r?j2(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var tr=(r,e,t)=>(U2(r,typeof e!="symbol"?e+"":e,t),t);function V2(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function tt(){}function Ot(r,e){for(const t in e)r[t]=e[t];return r}function q2(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function fb(r){return r()}function z_(){return Object.create(null)}function mr(r){r.forEach(fb)}function bl(r){return typeof r=="function"}function wt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Nf;function dr(r,e){return r===e?!0:(Nf||(Nf=document.createElement("a")),Nf.href=e,r===Nf.href)}function Z2(r){return Object.keys(r).length===0}function db(r,...e){if(r==null){for(const n of e)n(void 0);return tt}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function di(r){let e;return db(r,t=>e=t)(),e}function at(r,e,t){r.$$.on_destroy.push(db(e,t))}function Cn(r,e,t,n){if(r){const i=pb(r,e,t,n);return r[0](i)}}function pb(r,e,t,n){return r[1]&&n?Ot(t.ctx.slice(),r[1](n(e))):t.ctx}function Tn(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],c=Math.max(e.dirty.length,i.length);for(let a=0;a<c;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function Mn(r,e,t,n,i,o){if(i){const c=pb(e,t,n,o);r.p(c,i)}}function Ln(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function mi(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function D_(r,e){const t={};e=new Set(e);for(const n in r)!e.has(n)&&n[0]!=="$"&&(t[n]=r[n]);return t}function Pm(r){const e={};for(const t in r)e[t]=!0;return e}function id(r){return r??""}function Nt(r,e,t){return r.set(t),e}function Qp(r){return r&&bl(r.destroy)?r.destroy:tt}const mb=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function R(r,e){r.appendChild(e)}function q(r,e,t){r.insertBefore(e,t||null)}function V(r){r.parentNode&&r.parentNode.removeChild(r)}function pi(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function U(r){return document.createElement(r)}function ds(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function xe(r){return document.createTextNode(r)}function ie(){return xe(" ")}function Qn(){return xe("")}function xt(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function zm(r){return function(e){return e.preventDefault(),r.call(this,e)}}function nh(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function fe(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function od(r,e){for(const t in e)fe(r,t,e[t])}function G2(r,e,t){const n=new Set;for(let i=0;i<r.length;i+=1)r[i].checked&&n.add(r[i].__value);return t||n.delete(e),Array.from(n)}function Dm(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function ml(r){return r===""?null:+r}function H2(r){return Array.from(r.childNodes)}function Mt(r,e){e=""+e,r.data!==e&&(r.data=e)}function Wn(r,e){r.value=e??""}function st(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function Zi(r,e,t){for(let n=0;n<r.options.length;n+=1){const i=r.options[n];if(i.__value===e){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Sa(r){const e=r.querySelector(":checked");return e&&e.__value}function en(r,e,t){r.classList.toggle(e,!!t)}function W2(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let fh;function Hs(r){fh=r}function Bc(){if(!fh)throw new Error("Function called outside component initialization");return fh}function Ls(r){Bc().$$.on_mount.push(r)}function Yr(r){Bc().$$.on_destroy.push(r)}function ms(){const r=Bc();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=W2(e,t,{cancelable:n});return i.slice().forEach(c=>{c.call(r,o)}),!o.defaultPrevented}return!0}}function _d(r,e){return Bc().$$.context.set(r,e),e}function Sh(r){return Bc().$$.context.get(r)}function Dn(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Mc=[],hn=[];let Pc=[];const em=[],gb=Promise.resolve();let tm=!1;function _b(){tm||(tm=!0,gb.then($m))}function yb(){return _b(),gb}function us(r){Pc.push(r)}function In(r){em.push(r)}const Bp=new Set;let vc=0;function $m(){if(vc!==0)return;const r=fh;do{try{for(;vc<Mc.length;){const e=Mc[vc];vc++,Hs(e),K2(e.$$)}}catch(e){throw Mc.length=0,vc=0,e}for(Hs(null),Mc.length=0,vc=0;hn.length;)hn.pop()();for(let e=0;e<Pc.length;e+=1){const t=Pc[e];Bp.has(t)||(Bp.add(t),t())}Pc.length=0}while(Mc.length);for(;em.length;)em.pop()();tm=!1,Bp.clear(),Hs(r)}function K2(r){if(r.fragment!==null){r.update(),mr(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(us)}}function X2(r){const e=[],t=[];Pc.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Pc=e}const Wf=new Set;let dl;function tn(){dl={r:0,c:[],p:dl}}function nn(){dl.r||mr(dl.c),dl=dl.p}function j(r,e){r&&r.i&&(Wf.delete(r),r.i(e))}function Z(r,e,t,n){if(r&&r.o){if(Wf.has(r))return;Wf.add(r),dl.c.push(()=>{Wf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function $_(r,e){const t=e.token={};function n(i,o,c,a){if(e.token!==t)return;e.resolved=a;let d=e.ctx;c!==void 0&&(d=d.slice(),d[c]=a);const p=i&&(e.current=i)(d);let _=!1;e.block&&(e.blocks?e.blocks.forEach((y,w)=>{w!==o&&y&&(tn(),Z(y,1,1,()=>{e.blocks[w]===y&&(e.blocks[w]=null)}),nn())}):e.block.d(1),p.c(),j(p,1),p.m(e.mount(),e.anchor),_=!0),e.block=p,e.blocks&&(e.blocks[o]=p),_&&$m()}if(q2(r)){const i=Bc();if(r.then(o=>{Hs(i),n(e.then,1,e.value,o),Hs(null)},o=>{if(Hs(i),n(e.catch,2,e.error,o),Hs(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,r),!0;e.resolved=r}}function J2(r,e,t){const n=e.slice(),{resolved:i}=r;r.current===r.then&&(n[r.value]=i),r.current===r.catch&&(n[r.error]=i),r.block.p(n,t)}function Nn(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function Y2(r,e){Z(r,1,1,()=>{e.delete(r.key)})}function Q2(r,e,t,n,i,o,c,a,d,p,_,y){let w=r.length,T=o.length,M=w;const $={};for(;M--;)$[r[M].key]=M;const D=[],z=new Map,I=new Map,F=[];for(M=T;M--;){const J=y(i,o,M),ee=t(J);let pe=c.get(ee);pe?n&&F.push(()=>pe.p(J,e)):(pe=p(ee,J),pe.c()),z.set(ee,D[M]=pe),ee in $&&I.set(ee,Math.abs(M-$[ee]))}const N=new Set,W=new Set;function oe(J){j(J,1),J.m(a,_),c.set(J.key,J),_=J.first,T--}for(;w&&T;){const J=D[T-1],ee=r[w-1],pe=J.key,Ie=ee.key;J===ee?(_=J.first,w--,T--):z.has(Ie)?!c.has(pe)||N.has(pe)?oe(J):W.has(Ie)?w--:I.get(pe)>I.get(Ie)?(W.add(pe),oe(J)):(N.add(Ie),w--):(d(ee,c),w--)}for(;w--;){const J=r[w];z.has(J.key)||d(J,c)}for(;T;)oe(D[T-1]);return mr(F),D}function Vn(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const c=r[o],a=e[o];if(a){for(const d in c)d in a||(n[d]=1);for(const d in a)i[d]||(t[d]=a[d],i[d]=1);r[o]=a}else for(const d in c)i[d]=1}for(const c in n)c in t||(t[c]=void 0);return t}function Ys(r){return typeof r=="object"&&r!==null?r:{}}function An(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function he(r){r&&r.c()}function le(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),us(()=>{const o=r.$$.on_mount.map(fb).filter(bl);r.$$.on_destroy?r.$$.on_destroy.push(...o):mr(o),r.$$.on_mount=[]}),i.forEach(us)}function ce(r,e){const t=r.$$;t.fragment!==null&&(X2(t.after_update),mr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function ex(r,e){r.$$.dirty[0]===-1&&(Mc.push(r),_b(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Lt(r,e,t,n,i,o,c=null,a=[-1]){const d=fh;Hs(r);const p=r.$$={fragment:null,ctx:[],props:o,update:tt,not_equal:i,bound:z_(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:z_(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};c&&c(p.root);let _=!1;if(p.ctx=t?t(r,e.props||{},(y,w,...T)=>{const M=T.length?T[0]:w;return p.ctx&&i(p.ctx[y],p.ctx[y]=M)&&(!p.skip_bound&&p.bound[y]&&p.bound[y](M),_&&ex(r,y)),w}):[],p.update(),_=!0,mr(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const y=H2(e.target);p.fragment&&p.fragment.l(y),y.forEach(V)}else p.fragment&&p.fragment.c();e.intro&&j(r.$$.fragment),le(r,e.target,e.anchor),$m()}Hs(d)}class Et{constructor(){tr(this,"$$");tr(this,"$$set")}$destroy(){ce(this,1),this.$destroy=tt}$on(e,t){if(!bl(t))return tt;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!Z2(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const tx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(tx);const nx="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",rx="/ltn/assets/logo-97f2d067.svg",bb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function R_(r){let e,t,n,i=r[1]!=null&&F_(r);return{c(){e=U("div"),t=xe(r[0]),n=ie(),i&&i.c(),fe(e,"class","cover svelte-1w7hi45")},m(o,c){q(o,e,c),R(e,t),R(e,n),i&&i.m(e,null)},p(o,c){c&1&&Mt(t,o[0]),o[1]!=null?i?i.p(o,c):(i=F_(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(o){o&&V(e),i&&i.d()}}}function F_(r){let e,t;return{c(){e=U("div"),t=U("progress"),t.value=r[1],st(t,"width","100%")},m(n,i){q(n,e,i),R(e,t)},p(n,i){i&2&&(t.value=n[1])},d(n){n&&V(e)}}}function ix(r){let e,t=r[0]&&R_(r);return{c(){t&&t.c(),e=Qn()},m(n,i){t&&t.m(n,i),q(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=R_(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:tt,o:tt,d(n){n&&V(e),t&&t.d(n)}}}function ox(r,e,t){let{loading:n}=e,{progress:i=null}=e;return r.$$set=o=>{"loading"in o&&t(0,n=o.loading),"progress"in o&&t(1,i=o.progress)},[n,i]}class Ch extends Et{constructor(e){super(),Lt(this,e,ox,ix,wt,{loading:0,progress:1})}}function sx(r){let e,t,n,i,o;const c=r[5].default,a=Cn(c,r,r[4],null);return{c(){e=U("dialog"),t=U("article"),a&&a.c()},m(d,p){q(d,e,p),R(e,t),a&&a.m(t,null),r[6](e),n=!0,i||(o=[xt(e,"click",nh(r[1])),xt(e,"keydown",r[2])],i=!0)},p(d,[p]){a&&a.p&&(!n||p&16)&&Mn(a,c,d,d[4],n?Tn(c,d[4],p,null):Ln(d[4]),null)},i(d){n||(j(a,d),n=!0)},o(d){Z(a,d),n=!1},d(d){d&&V(e),a&&a.d(d),r[6](null),i=!1,mr(o)}}}function ax(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,c;function a(_){_.target==c&&t(3,o=!1)}function d(_){(_.key=="Escape"||_.key=="Enter")&&(_.stopPropagation(),t(3,o=!1))}function p(_){hn[_?"unshift":"push"](()=>{c=_,t(0,c)})}return r.$$set=_=>{"show"in _&&t(3,o=_.show),"$$scope"in _&&t(4,i=_.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&c&&(o?c.showModal():c.close())},[c,a,d,o,i,n,p]}class yd extends Et{constructor(e){super(),Lt(this,e,ax,sx,wt,{show:3})}}function B_(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function O_(r){let e,t,n=r[1]+"",i,o,c,a=r[2]+"",d,p;return{c(){e=U("tr"),t=U("td"),i=xe(n),o=ie(),c=U("td"),d=xe(a),p=ie()},m(_,y){q(_,e,y),R(e,t),R(t,i),R(e,o),R(e,c),R(c,d),R(e,p)},p(_,y){y&1&&n!==(n=_[1]+"")&&Mt(i,n),y&1&&a!==(a=_[2]+"")&&Mt(d,a)},d(_){_&&V(e)}}}function lx(r){let e,t,n=Nn(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=O_(B_(r,n,o));return{c(){e=U("table"),t=U("tbody");for(let o=0;o<i.length;o+=1)i[o].c();fe(e,"class","svelte-lh2o9l")},m(o,c){q(o,e,c),R(e,t);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(t,null)},p(o,[c]){if(c&1){n=Nn(Object.entries(o[0]));let a;for(a=0;a<n.length;a+=1){const d=B_(o,n,a);i[a]?i[a].p(d,c):(i[a]=O_(d),i[a].c(),i[a].m(t,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}},i:tt,o:tt,d(o){o&&V(e),pi(i,o)}}}function cx(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class Th extends Et{constructor(e){super(),Lt(this,e,cx,lx,wt,{properties:0})}}function bd(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function vr(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var vb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wb(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Rm(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var xb={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(vb,function(){var t={},n={};function i(c,a,d){if(n[c]=d,c==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",_={};return n.shared(_),n.index(t,_),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}i("shared",["exports"],function(c){function a(u,s,h,m){return new(h||(h=Promise))(function(v,S){function C(O){try{P(m.next(O))}catch(H){S(H)}}function L(O){try{P(m.throw(O))}catch(H){S(H)}}function P(O){var H;O.done?v(O.value):(H=O.value,H instanceof h?H:new h(function(K){K(H)})).then(C,L)}P((m=m.apply(u,s||[])).next())})}function d(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}typeof SuppressedError=="function"&&SuppressedError;var p=_;function _(u,s){this.x=u,this.y=s}_.prototype={clone:function(){return new _(this.x,this.y)},add:function(u){return this.clone()._add(u)},sub:function(u){return this.clone()._sub(u)},multByPoint:function(u){return this.clone()._multByPoint(u)},divByPoint:function(u){return this.clone()._divByPoint(u)},mult:function(u){return this.clone()._mult(u)},div:function(u){return this.clone()._div(u)},rotate:function(u){return this.clone()._rotate(u)},rotateAround:function(u,s){return this.clone()._rotateAround(u,s)},matMult:function(u){return this.clone()._matMult(u)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(u){return this.x===u.x&&this.y===u.y},dist:function(u){return Math.sqrt(this.distSqr(u))},distSqr:function(u){var s=u.x-this.x,h=u.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(u){return Math.atan2(this.y-u.y,this.x-u.x)},angleWith:function(u){return this.angleWithSep(u.x,u.y)},angleWithSep:function(u,s){return Math.atan2(this.x*s-this.y*u,this.x*u+this.y*s)},_matMult:function(u){var s=u[2]*this.x+u[3]*this.y;return this.x=u[0]*this.x+u[1]*this.y,this.y=s,this},_add:function(u){return this.x+=u.x,this.y+=u.y,this},_sub:function(u){return this.x-=u.x,this.y-=u.y,this},_mult:function(u){return this.x*=u,this.y*=u,this},_div:function(u){return this.x/=u,this.y/=u,this},_multByPoint:function(u){return this.x*=u.x,this.y*=u.y,this},_divByPoint:function(u){return this.x/=u.x,this.y/=u.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var u=this.y;return this.y=this.x,this.x=-u,this},_rotate:function(u){var s=Math.cos(u),h=Math.sin(u),m=h*this.x+s*this.y;return this.x=s*this.x-h*this.y,this.y=m,this},_rotateAround:function(u,s){var h=Math.cos(u),m=Math.sin(u),v=s.y+m*(this.x-s.x)+h*(this.y-s.y);return this.x=s.x+h*(this.x-s.x)-m*(this.y-s.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_.convert=function(u){return u instanceof _?u:Array.isArray(u)?new _(u[0],u[1]):u};var y=d(p),w=T;function T(u,s,h,m){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=s,this.p2x=h,this.p2y=m}T.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,s){if(s===void 0&&(s=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,m=0;m<8;m++){var v=this.sampleCurveX(h)-u;if(Math.abs(v)<s)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=v/S}var C=0,L=1;for(h=u,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-u)<s));m++)u>v?C=h:L=h,h=.5*(L-C)+C;return h},solve:function(u,s){return this.sampleCurveY(this.solveCurveX(u,s))}};var M=d(w);let $,D;function z(){return $==null&&($=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),$}function I(){if(D==null&&(D=!1,z())){const s=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(s){for(let m=0;m<5*5;m++){const v=4*m;s.fillStyle=`rgb(${v},${v+1},${v+2})`,s.fillRect(m%5,Math.floor(m/5),1,1)}const h=s.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&h[m]!==m){D=!0;break}}}return D||!1}function F(u,s,h,m){const v=new M(u,s,h,m);return function(S){return v.solve(S)}}const N=F(.25,.1,.25,1);function W(u,s,h){return Math.min(h,Math.max(s,u))}function oe(u,s,h){const m=h-s,v=((u-s)%m+m)%m+s;return v===s?h:v}function J(u,...s){for(const h of s)for(const m in h)u[m]=h[m];return u}let ee=1;function pe(u,s,h){const m={};for(const v in u)m[v]=s.call(h||this,u[v],v,u);return m}function Ie(u,s,h){const m={};for(const v in u)s.call(h||this,u[v],v,u)&&(m[v]=u[v]);return m}function Q(u){return Array.isArray(u)?u.map(Q):typeof u=="object"&&u?pe(u,Q):u}const ae={};function Pe(u){ae[u]||(typeof console<"u"&&console.warn(u),ae[u]=!0)}function ve(u,s,h){return(h.y-u.y)*(s.x-u.x)>(s.y-u.y)*(h.x-u.x)}function nt(u){let s=0;for(let h,m,v=0,S=u.length,C=S-1;v<S;C=v++)h=u[v],m=u[C],s+=(m.x-h.x)*(h.y+m.y);return s}function Ge(u){return typeof WorkerGlobalScope<"u"&&u!==void 0&&u instanceof WorkerGlobalScope}let Ee=null;function De(u){return typeof ImageBitmap<"u"&&u instanceof ImageBitmap}const Ct="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function it(u,s,h,m,v){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(u,{timestamp:0});try{const C=S==null?void 0:S.format;if(!C||!C.startsWith("BGR")&&!C.startsWith("RGB"))throw new Error(`Unrecognized format ${C}`);const L=C.startsWith("BGR"),P=new Uint8ClampedArray(m*v*4);if(yield S.copyTo(P,function(O,H,K,re,ue){const me=4*Math.max(-H,0),be=(Math.max(0,K)-K)*re*4+me,Te=4*re,Ae=Math.max(0,H),qe=Math.max(0,K);return{rect:{x:Ae,y:qe,width:Math.min(O.width,H+re)-Ae,height:Math.min(O.height,K+ue)-qe},layout:[{offset:be,stride:Te}]}}(u,s,h,m,v)),L)for(let O=0;O<P.length;O+=4){const H=P[O];P[O]=P[O+2],P[O+2]=H}return P}finally{S.close()}})}let lt,mt;const dt="AbortError";function Xe(){return new Error(dt)}const $t={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function yt(u){return $t.REGISTERED_PROTOCOLS[u.substring(0,u.indexOf("://"))]}const Rt="global-dispatcher";class It extends Error{constructor(s,h,m,v){super(`AJAXError: ${h} (${s}): ${m}`),this.status=s,this.statusText=h,this.url=m,this.body=v}}const Qt=()=>Ge(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,yn=function(u,s){if(/:\/\//.test(u.url)&&!/^https?:|^file:/.test(u.url)){const m=yt(u.url);if(m)return m(u,s);if(Ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,targetMapId:Rt},s)}if(!(/^file:/.test(h=u.url)||/^file:/.test(Qt())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,v){return a(this,void 0,void 0,function*(){const S=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:Qt(),signal:v.signal});m.type==="json"&&S.headers.set("Accept","application/json");const C=yield fetch(S);if(!C.ok){const O=yield C.blob();throw new It(C.status,C.statusText,m.url,O)}let L;L=m.type==="arrayBuffer"||m.type==="image"?C.arrayBuffer():m.type==="json"?C.json():C.text();const P=yield L;if(v.signal.aborted)throw Xe();return{data:P,cacheControl:C.headers.get("Cache-Control"),expires:C.headers.get("Expires")}})}(u,s);if(Ge(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:u,mustQueue:!0,targetMapId:Rt},s)}var h;return function(m,v){return new Promise((S,C)=>{const L=new XMLHttpRequest;L.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(L.responseType="arraybuffer");for(const P in m.headers)L.setRequestHeader(P,m.headers[P]);m.type==="json"&&(L.responseType="text",L.setRequestHeader("Accept","application/json")),L.withCredentials=m.credentials==="include",L.onerror=()=>{C(new Error(L.statusText))},L.onload=()=>{if(!v.signal.aborted)if((L.status>=200&&L.status<300||L.status===0)&&L.response!==null){let P=L.response;if(m.type==="json")try{P=JSON.parse(L.response)}catch(O){return void C(O)}S({data:P,cacheControl:L.getResponseHeader("Cache-Control"),expires:L.getResponseHeader("Expires")})}else{const P=new Blob([L.response],{type:L.getResponseHeader("Content-Type")});C(new It(L.status,L.statusText,m.url,P))}},v.signal.addEventListener("abort",()=>{L.abort(),C(Xe())}),L.send(m.body)})}(u,s)};function ut(u){if(!u||u.indexOf("://")<=0||u.indexOf("data:image/")===0||u.indexOf("blob:")===0)return!0;const s=new URL(u),h=window.location;return s.protocol===h.protocol&&s.host===h.host}function Wt(u,s,h){h[u]&&h[u].indexOf(s)!==-1||(h[u]=h[u]||[],h[u].push(s))}function Ze(u,s,h){if(h&&h[u]){const m=h[u].indexOf(s);m!==-1&&h[u].splice(m,1)}}class Ve{constructor(s,h={}){J(this,h),this.type=s}}class St extends Ve{constructor(s,h={}){super("error",J({error:s},h))}}class Ut{on(s,h){return this._listeners=this._listeners||{},Wt(s,h,this._listeners),this}off(s,h){return Ze(s,h,this._listeners),Ze(s,h,this._oneTimeListeners),this}once(s,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},Wt(s,h,this._oneTimeListeners),this):new Promise(m=>this.once(s,m))}fire(s,h){typeof s=="string"&&(s=new Ve(s,h||{}));const m=s.type;if(this.listens(m)){s.target=this;const v=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const L of v)L.call(this,s);const S=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const L of S)Ze(m,L,this._oneTimeListeners),L.call(this,s);const C=this._eventedParent;C&&(J(s,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),C.fire(s))}else s instanceof St&&console.error(s.error);return this}listens(s){return this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s)}setEventedParent(s,h){return this._eventedParent=s,this._eventedParentData=h,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Pn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ne(u,s){const h={};for(const m in u)m!=="ref"&&(h[m]=u[m]);return Pn.forEach(m=>{m in s&&(h[m]=s[m])}),h}function et(u,s){if(Array.isArray(u)){if(!Array.isArray(s)||u.length!==s.length)return!1;for(let h=0;h<u.length;h++)if(!et(u[h],s[h]))return!1;return!0}if(typeof u=="object"&&u!==null&&s!==null){if(typeof s!="object"||Object.keys(u).length!==Object.keys(s).length)return!1;for(const h in u)if(!et(u[h],s[h]))return!1;return!0}return u===s}function Kt(u,s){u.push(s)}function er(u,s,h){Kt(h,{command:"addSource",args:[u,s[u]]})}function ur(u,s,h){Kt(s,{command:"removeSource",args:[u]}),h[u]=!0}function gr(u,s,h,m){ur(u,h,m),er(u,s,h)}function Qr(u,s,h){let m;for(m in u[h])if(Object.prototype.hasOwnProperty.call(u[h],m)&&m!=="data"&&!et(u[h][m],s[h][m]))return!1;for(m in s[h])if(Object.prototype.hasOwnProperty.call(s[h],m)&&m!=="data"&&!et(u[h][m],s[h][m]))return!1;return!0}function ei(u,s,h,m,v,S){u=u||{},s=s||{};for(const C in u)Object.prototype.hasOwnProperty.call(u,C)&&(et(u[C],s[C])||h.push({command:S,args:[m,C,s[C],v]}));for(const C in s)Object.prototype.hasOwnProperty.call(s,C)&&!Object.prototype.hasOwnProperty.call(u,C)&&(et(u[C],s[C])||h.push({command:S,args:[m,C,s[C],v]}))}function co(u){return u.id}function hr(u,s){return u[s.id]=s,u}class bt{constructor(s,h,m,v){this.message=(s?`${s}: `:"")+m,v&&(this.identifier=v),h!=null&&h.__line__&&(this.line=h.__line__)}}function Bn(u,...s){for(const h of s)for(const m in h)u[m]=h[m];return u}class xr extends Error{constructor(s,h){super(h),this.message=h,this.key=s}}class uo{constructor(s,h=[]){this.parent=s,this.bindings={};for(const[m,v]of h)this.bindings[m]=v}concat(s){return new uo(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const Rn={kind:"null"},Pt={kind:"number"},fn={kind:"string"},mn={kind:"boolean"},wn={kind:"color"},ln={kind:"object"},Gt={kind:"value"},Ci={kind:"collator"},_r={kind:"formatted"},Ce={kind:"padding"},ne={kind:"resolvedImage"},se={kind:"variableAnchorOffsetCollection"};function ge(u,s){return{kind:"array",itemType:u,N:s}}function we(u){if(u.kind==="array"){const s=we(u.itemType);return typeof u.N=="number"?`array<${s}, ${u.N}>`:u.itemType.kind==="value"?"array":`array<${s}>`}return u.kind}const Fe=[Rn,Pt,fn,mn,wn,_r,ln,ge(Gt),Ce,ne,se];function Be(u,s){if(s.kind==="error")return null;if(u.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Be(u.itemType,s.itemType))&&(typeof u.N!="number"||u.N===s.N))return null}else{if(u.kind===s.kind)return null;if(u.kind==="value"){for(const h of Fe)if(!Be(h,s))return null}}return`Expected ${we(u)} but found ${we(s)} instead.`}function Ue(u,s){return s.some(h=>h.kind===u.kind)}function ze(u,s){return s.some(h=>h==="null"?u===null:h==="array"?Array.isArray(u):h==="object"?u&&!Array.isArray(u)&&typeof u=="object":h===typeof u)}function te(u,s){return u.kind==="array"&&s.kind==="array"?u.itemType.kind===s.itemType.kind&&typeof u.N=="number":u.kind===s.kind}const He=.96422,Ke=.82521,Ye=4/29,ct=6/29,Tt=3*ct*ct,Jt=ct*ct*ct,dn=Math.PI/180,xn=180/Math.PI;function jn(u){return(u%=360)<0&&(u+=360),u}function kr([u,s,h,m]){let v,S;const C=kn((.2225045*(u=qr(u))+.7168786*(s=qr(s))+.0606169*(h=qr(h)))/1);u===s&&s===h?v=S=C:(v=kn((.4360747*u+.3850649*s+.1430804*h)/He),S=kn((.0139322*u+.0971045*s+.7141733*h)/Ke));const L=116*C-16;return[L<0?0:L,500*(v-C),200*(C-S),m]}function qr(u){return u<=.04045?u/12.92:Math.pow((u+.055)/1.055,2.4)}function kn(u){return u>Jt?Math.pow(u,1/3):u/Tt+Ye}function Pr([u,s,h,m]){let v=(u+16)/116,S=isNaN(s)?v:v+s/500,C=isNaN(h)?v:v-h/200;return v=1*Ti(v),S=He*Ti(S),C=Ke*Ti(C),[ti(3.1338561*S-1.6168667*v-.4906146*C),ti(-.9787684*S+1.9161415*v+.033454*C),ti(.0719453*S-.2289914*v+1.4052427*C),m]}function ti(u){return(u=u<=.00304?12.92*u:1.055*Math.pow(u,1/2.4)-.055)<0?0:u>1?1:u}function Ti(u){return u>ct?u*u*u:Tt*(u-Ye)}function Di(u){return parseInt(u.padEnd(2,u),16)/255}function fi(u,s){return No(s?u/100:u,0,1)}function No(u,s,h){return Math.min(Math.max(s,u),h)}function Dh(u){return!u.some(Number.isNaN)}const zd={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class ir{constructor(s,h,m,v=1,S=!0){this.r=s,this.g=h,this.b=m,this.a=v,S||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[s,h,m,v]))}static parse(s){if(s instanceof ir)return s;if(typeof s!="string")return;const h=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=zd[m];if(v){const[C,L,P]=v;return[C/255,L/255,P/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const C=m.length<6?1:2;let L=1;return[Di(m.slice(L,L+=C)),Di(m.slice(L,L+=C)),Di(m.slice(L,L+=C)),Di(m.slice(L,L+C)||"ff")]}if(m.startsWith("rgb")){const C=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(C){const[L,P,O,H,K,re,ue,me,be,Te,Ae,qe]=C,$e=[H||" ",ue||" ",Te].join("");if($e==="  "||$e==="  /"||$e===",,"||$e===",,,"){const Oe=[O,re,be].join(""),ht=Oe==="%%%"?100:Oe===""?255:0;if(ht){const ft=[No(+P/ht,0,1),No(+K/ht,0,1),No(+me/ht,0,1),Ae?fi(+Ae,qe):1];if(Dh(ft))return ft}}return}}const S=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[C,L,P,O,H,K,re,ue,me]=S,be=[P||" ",H||" ",re].join("");if(be==="  "||be==="  /"||be===",,"||be===",,,"){const Te=[+L,No(+O,0,100),No(+K,0,100),ue?fi(+ue,me):1];if(Dh(Te))return function([Ae,qe,$e,Oe]){function ht(ft){const Zt=(ft+Ae/30)%12,Yt=qe*Math.min($e,1-$e);return $e-Yt*Math.max(-1,Math.min(Zt-3,9-Zt,1))}return Ae=jn(Ae),qe/=100,$e/=100,[ht(0),ht(8),ht(4),Oe]}(Te)}}}(s);return h?new ir(...h,!1):void 0}get rgb(){const{r:s,g:h,b:m,a:v}=this,S=v||1/0;return this.overwriteGetter("rgb",[s/S,h/S,m/S,v])}get hcl(){return this.overwriteGetter("hcl",function(s){const[h,m,v,S]=kr(s),C=Math.sqrt(m*m+v*v);return[Math.round(1e4*C)?jn(Math.atan2(v,m)*xn):NaN,C,h,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",kr(this.rgb))}overwriteGetter(s,h){return Object.defineProperty(this,s,{value:h}),h}toString(){const[s,h,m,v]=this.rgb;return`rgba(${[s,h,m].map(S=>Math.round(255*S)).join(",")},${v})`}}ir.black=new ir(0,0,0,1),ir.white=new ir(1,1,1,1),ir.transparent=new ir(0,0,0,0),ir.red=new ir(1,0,0,1);class Nc{constructor(s,h,m){this.sensitivity=s?h?"variant":"case":h?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,h){return this.collator.compare(s,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class jc{constructor(s,h,m,v,S){this.text=s,this.image=h,this.scale=m,this.fontStack=v,this.textColor=S}}class Ki{constructor(s){this.sections=s}static fromString(s){return new Ki([new jc(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||s.image&&s.image.name.length!==0)}static factory(s){return s instanceof Ki?s:Ki.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}}class $i{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof $i)return s;if(typeof s=="number")return new $i([s,s,s,s]);if(Array.isArray(s)&&!(s.length<1||s.length>4)){for(const h of s)if(typeof h!="number")return;switch(s.length){case 1:s=[s[0],s[0],s[0],s[0]];break;case 2:s=[s[0],s[1],s[0],s[1]];break;case 3:s=[s[0],s[1],s[2],s[1]]}return new $i(s)}}toString(){return JSON.stringify(this.values)}}const Na=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ho{constructor(s){this.values=s.slice()}static parse(s){if(s instanceof ho)return s;if(Array.isArray(s)&&!(s.length<1)&&s.length%2==0){for(let h=0;h<s.length;h+=2){const m=s[h],v=s[h+1];if(typeof m!="string"||!Na.has(m)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new ho(s)}}toString(){return JSON.stringify(this.values)}}class fo{constructor(s){this.name=s.name,this.available=s.available}toString(){return this.name}static fromString(s){return s?new fo({name:s,available:!1}):null}}function ra(u,s,h,m){return typeof u=="number"&&u>=0&&u<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof h=="number"&&h>=0&&h<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[u,s,h,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[u,s,h,m]:[u,s,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function kl(u){if(u===null||typeof u=="string"||typeof u=="boolean"||typeof u=="number"||u instanceof ir||u instanceof Nc||u instanceof Ki||u instanceof $i||u instanceof ho||u instanceof fo)return!0;if(Array.isArray(u)){for(const s of u)if(!kl(s))return!1;return!0}if(typeof u=="object"){for(const s in u)if(!kl(u[s]))return!1;return!0}return!1}function Zr(u){if(u===null)return Rn;if(typeof u=="string")return fn;if(typeof u=="boolean")return mn;if(typeof u=="number")return Pt;if(u instanceof ir)return wn;if(u instanceof Nc)return Ci;if(u instanceof Ki)return _r;if(u instanceof $i)return Ce;if(u instanceof ho)return se;if(u instanceof fo)return ne;if(Array.isArray(u)){const s=u.length;let h;for(const m of u){const v=Zr(m);if(h){if(h===v)continue;h=Gt;break}h=v}return ge(h||Gt,s)}return ln}function ja(u){const s=typeof u;return u===null?"":s==="string"||s==="number"||s==="boolean"?String(u):u instanceof ir||u instanceof Ki||u instanceof $i||u instanceof ho||u instanceof fo?u.toString():JSON.stringify(u)}class gs{constructor(s,h){this.type=s,this.value=h}static parse(s,h){if(s.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!kl(s[1]))return h.error("invalid value");const m=s[1];let v=Zr(m);const S=h.expectedType;return v.kind!=="array"||v.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(v=S),new gs(v,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Mr{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const Sl={string:fn,number:Pt,boolean:mn,object:ln};class Xi{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");let m,v=1;const S=s[0];if(S==="array"){let L,P;if(s.length>2){const O=s[1];if(typeof O!="string"||!(O in Sl)||O==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);L=Sl[O],v++}else L=Gt;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return h.error('The length argument to "array" must be a positive integer literal',2);P=s[2],v++}m=ge(L,P)}else{if(!Sl[S])throw new Error(`Types doesn't contain name = ${S}`);m=Sl[S]}const C=[];for(;v<s.length;v++){const L=h.parse(s[v],v,Gt);if(!L)return null;C.push(L)}return new Xi(m,C)}evaluate(s){for(let h=0;h<this.args.length;h++){const m=this.args[h].evaluate(s);if(!Be(this.type,Zr(m)))return m;if(h===this.args.length-1)throw new Mr(`Expected value to be of type ${we(this.type)}, but found ${we(Zr(m))} instead.`)}throw new Error}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Cl={"to-boolean":mn,"to-color":wn,"to-number":Pt,"to-string":fn};class jo{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const m=s[0];if(!Cl[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&s.length!==2)return h.error("Expected one argument.");const v=Cl[m],S=[];for(let C=1;C<s.length;C++){const L=h.parse(s[C],C,Gt);if(!L)return null;S.push(L)}return new jo(v,S)}evaluate(s){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(s);case"color":{let h,m;for(const v of this.args){if(h=v.evaluate(s),m=null,h instanceof ir)return h;if(typeof h=="string"){const S=s.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(m=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:ra(h[0],h[1],h[2],h[3]),!m))return new ir(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new Mr(m||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const m of this.args){h=m.evaluate(s);const v=$i.parse(h);if(v)return v}throw new Mr(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const m of this.args){h=m.evaluate(s);const v=ho.parse(h);if(v)return v}throw new Mr(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const m of this.args){if(h=m.evaluate(s),h===null)return 0;const v=Number(h);if(!isNaN(v))return v}throw new Mr(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return Ki.fromString(ja(this.args[0].evaluate(s)));case"resolvedImage":return fo.fromString(ja(this.args[0].evaluate(s)));default:return ja(this.args[0].evaluate(s))}}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}const Ua=["Unknown","Point","LineString","Polygon"];class or{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ua[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(s){let h=this._parseColorCache[s];return h||(h=this._parseColorCache[s]=ir.parse(s)),h}}class Tl{constructor(s,h,m=[],v,S=new uo,C=[]){this.registry=s,this.path=m,this.key=m.map(L=>`[${L}]`).join(""),this.scope=S,this.errors=C,this.expectedType=v,this._isConstant=h}parse(s,h,m,v,S={}){return h?this.concat(h,m,v)._parse(s,S):this._parse(s,S)}_parse(s,h){function m(v,S,C){return C==="assert"?new Xi(S,[v]):C==="coerce"?new jo(S,[v]):v}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=s[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[v];if(S){let C=S.parse(s,this);if(!C)return null;if(this.expectedType){const L=this.expectedType,P=C.type;if(L.kind!=="string"&&L.kind!=="number"&&L.kind!=="boolean"&&L.kind!=="object"&&L.kind!=="array"||P.kind!=="value")if(L.kind!=="color"&&L.kind!=="formatted"&&L.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(L.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(L.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(L,P))return null}else C=m(C,L,h.typeAnnotation||"coerce");else C=m(C,L,h.typeAnnotation||"coerce");else C=m(C,L,h.typeAnnotation||"coerce");else C=m(C,L,h.typeAnnotation||"assert")}if(!(C instanceof gs)&&C.type.kind!=="resolvedImage"&&this._isConstant(C)){const L=new or;try{C=new gs(C.type,C.evaluate(L))}catch(P){return this.error(P.message),null}}return C}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,h,m){const v=typeof s=="number"?this.path.concat(s):this.path,S=m?this.scope.concat(m):this.scope;return new Tl(this.registry,this._isConstant,v,h||null,S,this.errors)}error(s,...h){const m=`${this.key}${h.map(v=>`[${v}]`).join("")}`;this.errors.push(new xr(m,s))}checkSubtype(s,h){const m=Be(s,h);return m&&this.error(m),m}}class ia{constructor(s,h,m){this.type=Ci,this.locale=m,this.caseSensitive=s,this.diacriticSensitive=h}static parse(s,h){if(s.length!==2)return h.error("Expected one argument.");const m=s[1];if(typeof m!="object"||Array.isArray(m))return h.error("Collator options argument must be an object.");const v=h.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,mn);if(!v)return null;const S=h.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,mn);if(!S)return null;let C=null;return m.locale&&(C=h.parse(m.locale,1,fn),!C)?null:new ia(v,S,C)}evaluate(s){return new Nc(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}}const _s=8192;function Ml(u,s){u[0]=Math.min(u[0],s[0]),u[1]=Math.min(u[1],s[1]),u[2]=Math.max(u[2],s[0]),u[3]=Math.max(u[3],s[1])}function Va(u,s){return!(u[0]<=s[0]||u[2]>=s[2]||u[1]<=s[1]||u[3]>=s[3])}function Dd(u,s){const h=(180+u[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u[1]*Math.PI/360)))/360,v=Math.pow(2,s.z);return[Math.round(h*v*_s),Math.round(m*v*_s)]}function $h(u,s,h){const m=u[0]-s[0],v=u[1]-s[1],S=u[0]-h[0],C=u[1]-h[1];return m*C-S*v==0&&m*S<=0&&v*C<=0}function Ll(u,s){let h=!1;for(let C=0,L=s.length;C<L;C++){const P=s[C];for(let O=0,H=P.length;O<H-1;O++){if($h(u,P[O],P[O+1]))return!1;(v=P[O])[1]>(m=u)[1]!=(S=P[O+1])[1]>m[1]&&m[0]<(S[0]-v[0])*(m[1]-v[1])/(S[1]-v[1])+v[0]&&(h=!h)}}var m,v,S;return h}function $d(u,s){for(let h=0;h<s.length;h++)if(Ll(u,s[h]))return!0;return!1}function Rh(u,s,h,m){const v=m[0]-h[0],S=m[1]-h[1],C=(u[0]-h[0])*S-v*(u[1]-h[1]),L=(s[0]-h[0])*S-v*(s[1]-h[1]);return C>0&&L<0||C<0&&L>0}function Rd(u,s,h){for(const O of h)for(let H=0;H<O.length-1;++H)if((L=[(C=O[H+1])[0]-(S=O[H])[0],C[1]-S[1]])[0]*(P=[(v=s)[0]-(m=u)[0],v[1]-m[1]])[1]-L[1]*P[0]!=0&&Rh(m,v,S,C)&&Rh(S,C,m,v))return!0;var m,v,S,C,L,P;return!1}function Fh(u,s){for(let h=0;h<u.length;++h)if(!Ll(u[h],s))return!1;for(let h=0;h<u.length-1;++h)if(Rd(u[h],u[h+1],s))return!1;return!0}function Bh(u,s){for(let h=0;h<s.length;h++)if(Fh(u,s[h]))return!0;return!1}function El(u,s,h){const m=[];for(let v=0;v<u.length;v++){const S=[];for(let C=0;C<u[v].length;C++){const L=Dd(u[v][C],h);Ml(s,L),S.push(L)}m.push(S)}return m}function Oh(u,s,h){const m=[];for(let v=0;v<u.length;v++){const S=El(u[v],s,h);m.push(S)}return m}function Nh(u,s,h,m){if(u[0]<h[0]||u[0]>h[2]){const v=.5*m;let S=u[0]-h[0]>v?-m:h[0]-u[0]>v?m:0;S===0&&(S=u[0]-h[2]>v?-m:h[2]-u[0]>v?m:0),u[0]+=S}Ml(s,u)}function Il(u,s,h,m){const v=Math.pow(2,m.z)*_s,S=[m.x*_s,m.y*_s],C=[];for(const L of u)for(const P of L){const O=[P.x+S[0],P.y+S[1]];Nh(O,s,h,v),C.push(O)}return C}function jh(u,s,h,m){const v=Math.pow(2,m.z)*_s,S=[m.x*_s,m.y*_s],C=[];for(const P of u){const O=[];for(const H of P){const K=[H.x+S[0],H.y+S[1]];Ml(s,K),O.push(K)}C.push(O)}if(s[2]-s[0]<=v/2){(L=s)[0]=L[1]=1/0,L[2]=L[3]=-1/0;for(const P of C)for(const O of P)Nh(O,s,h,v)}var L;return C}class Es{constructor(s,h){this.type=mn,this.geojson=s,this.geometries=h}static parse(s,h){if(s.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(kl(s[1])){const m=s[1];if(m.type==="FeatureCollection"){const v=[];for(const S of m.features){const{type:C,coordinates:L}=S.geometry;C==="Polygon"&&v.push(L),C==="MultiPolygon"&&v.push(...L)}if(v.length)return new Es(m,{type:"MultiPolygon",coordinates:v})}else if(m.type==="Feature"){const v=m.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Es(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Es(m,m)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],C=h.canonicalID();if(m.type==="Polygon"){const L=El(m.coordinates,S,C),P=Il(h.geometry(),v,S,C);if(!Va(v,S))return!1;for(const O of P)if(!Ll(O,L))return!1}if(m.type==="MultiPolygon"){const L=Oh(m.coordinates,S,C),P=Il(h.geometry(),v,S,C);if(!Va(v,S))return!1;for(const O of P)if(!$d(O,L))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(h,m){const v=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],C=h.canonicalID();if(m.type==="Polygon"){const L=El(m.coordinates,S,C),P=jh(h.geometry(),v,S,C);if(!Va(v,S))return!1;for(const O of P)if(!Fh(O,L))return!1}if(m.type==="MultiPolygon"){const L=Oh(m.coordinates,S,C),P=jh(h.geometry(),v,S,C);if(!Va(v,S))return!1;for(const O of P)if(!Bh(O,L))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Al{constructor(s,h){this.type=h.type,this.name=s,this.boundExpression=h}static parse(s,h){if(s.length!==2||typeof s[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const m=s[1];return h.scope.has(m)?new Al(m,h.scope.get(m)):h.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}}class Ji{constructor(s,h,m,v){this.name=s,this.type=h,this._evaluate=m,this.args=v}evaluate(s){return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}static parse(s,h){const m=s[0],v=Ji.definitions[m];if(!v)return h.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(v)?v[0]:v.type,C=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,L=C.filter(([O])=>!Array.isArray(O)||O.length===s.length-1);let P=null;for(const[O,H]of L){P=new Tl(h.registry,qa,h.path,null,h.scope);const K=[];let re=!1;for(let ue=1;ue<s.length;ue++){const me=s[ue],be=Array.isArray(O)?O[ue-1]:O.type,Te=P.parse(me,1+K.length,be);if(!Te){re=!0;break}K.push(Te)}if(!re)if(Array.isArray(O)&&O.length!==K.length)P.error(`Expected ${O.length} arguments, but found ${K.length} instead.`);else{for(let ue=0;ue<K.length;ue++){const me=Array.isArray(O)?O[ue]:O.type,be=K[ue];P.concat(ue+1).checkSubtype(me,be.type)}if(P.errors.length===0)return new Ji(m,S,H,K)}}if(L.length===1)h.errors.push(...P.errors);else{const O=(L.length?L:C).map(([K])=>{return re=K,Array.isArray(re)?`(${re.map(we).join(", ")})`:`(${we(re.type)}...)`;var re}).join(" | "),H=[];for(let K=1;K<s.length;K++){const re=h.parse(s[K],1+H.length);if(!re)return null;H.push(we(re.type))}h.error(`Expected arguments of type ${O}, but found (${H.join(", ")}) instead.`)}return null}static register(s,h){Ji.definitions=h;for(const m in h)s[m]=Ji}}function qa(u){if(u instanceof Al)return qa(u.boundExpression);if(u instanceof Ji&&u.name==="error"||u instanceof ia||u instanceof Es)return!1;const s=u instanceof jo||u instanceof Xi;let h=!0;return u.eachChild(m=>{h=s?h&&qa(m):h&&m instanceof gs}),!!h&&Pl(u)&&Ga(u,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Pl(u){if(u instanceof Ji&&(u.name==="get"&&u.args.length===1||u.name==="feature-state"||u.name==="has"&&u.args.length===1||u.name==="properties"||u.name==="geometry-type"||u.name==="id"||/^filter-/.test(u.name))||u instanceof Es)return!1;let s=!0;return u.eachChild(h=>{s&&!Pl(h)&&(s=!1)}),s}function Za(u){if(u instanceof Ji&&u.name==="feature-state")return!1;let s=!0;return u.eachChild(h=>{s&&!Za(h)&&(s=!1)}),s}function Ga(u,s){if(u instanceof Ji&&s.indexOf(u.name)>=0)return!1;let h=!0;return u.eachChild(m=>{h&&!Ga(m,s)&&(h=!1)}),h}function Ha(u,s){const h=u.length-1;let m,v,S=0,C=h,L=0;for(;S<=C;)if(L=Math.floor((S+C)/2),m=u[L],v=u[L+1],m<=s){if(L===h||s<v)return L;S=L+1}else{if(!(m>s))throw new Mr("Input is not a number.");C=L-1}return 0}class Wa{constructor(s,h,m){this.type=s,this.input=h,this.labels=[],this.outputs=[];for(const[v,S]of m)this.labels.push(v),this.outputs.push(S)}static parse(s,h){if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");const m=h.parse(s[1],1,Pt);if(!m)return null;const v=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let C=1;C<s.length;C+=2){const L=C===1?-1/0:s[C],P=s[C+1],O=C,H=C+1;if(typeof L!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',O);if(v.length&&v[v.length-1][0]>=L)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',O);const K=h.parse(P,H,S);if(!K)return null;S=S||K.type,v.push([L,K])}return new Wa(S,m,v)}evaluate(s){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(s);const v=this.input.evaluate(s);if(v<=h[0])return m[0].evaluate(s);const S=h.length;return v>=h[S-1]?m[S-1].evaluate(s):m[Ha(h,v)].evaluate(s)}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Fd(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var Bd=Uh;function Uh(u,s,h,m){this.cx=3*u,this.bx=3*(h-u)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*s,this.by=3*(m-s)-this.cy,this.ay=1-this.cy-this.by,this.p1x=u,this.p1y=s,this.p2x=h,this.p2y=m}Uh.prototype={sampleCurveX:function(u){return((this.ax*u+this.bx)*u+this.cx)*u},sampleCurveY:function(u){return((this.ay*u+this.by)*u+this.cy)*u},sampleCurveDerivativeX:function(u){return(3*this.ax*u+2*this.bx)*u+this.cx},solveCurveX:function(u,s){if(s===void 0&&(s=1e-6),u<0)return 0;if(u>1)return 1;for(var h=u,m=0;m<8;m++){var v=this.sampleCurveX(h)-u;if(Math.abs(v)<s)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=v/S}var C=0,L=1;for(h=u,m=0;m<20&&(v=this.sampleCurveX(h),!(Math.abs(v-u)<s));m++)u>v?C=h:L=h,h=.5*(L-C)+C;return h},solve:function(u,s){return this.sampleCurveY(this.solveCurveX(u,s))}};var Od=Fd(Bd);function Is(u,s,h){return u+h*(s-u)}function zl(u,s,h){return u.map((m,v)=>Is(m,s[v],h))}const Mi={number:Is,color:function(u,s,h,m="rgb"){switch(m){case"rgb":{const[v,S,C,L]=zl(u.rgb,s.rgb,h);return new ir(v,S,C,L,!1)}case"hcl":{const[v,S,C,L]=u.hcl,[P,O,H,K]=s.hcl;let re,ue;if(isNaN(v)||isNaN(P))isNaN(v)?isNaN(P)?re=NaN:(re=P,C!==1&&C!==0||(ue=O)):(re=v,H!==1&&H!==0||(ue=S));else{let qe=P-v;P>v&&qe>180?qe-=360:P<v&&v-P>180&&(qe+=360),re=v+h*qe}const[me,be,Te,Ae]=function([qe,$e,Oe,ht]){return qe=isNaN(qe)?0:qe*dn,Pr([Oe,Math.cos(qe)*$e,Math.sin(qe)*$e,ht])}([re,ue??Is(S,O,h),Is(C,H,h),Is(L,K,h)]);return new ir(me,be,Te,Ae,!1)}case"lab":{const[v,S,C,L]=Pr(zl(u.lab,s.lab,h));return new ir(v,S,C,L,!1)}}},array:zl,padding:function(u,s,h){return new $i(zl(u.values,s.values,h))},variableAnchorOffsetCollection:function(u,s,h){const m=u.values,v=s.values;if(m.length!==v.length)throw new Mr(`Cannot interpolate values of different length. from: ${u.toString()}, to: ${s.toString()}`);const S=[];for(let C=0;C<m.length;C+=2){if(m[C]!==v[C])throw new Mr(`Cannot interpolate values containing mismatched anchors. from[${C}]: ${m[C]}, to[${C}]: ${v[C]}`);S.push(m[C]);const[L,P]=m[C+1],[O,H]=v[C+1];S.push([Is(L,O,h),Is(P,H,h)])}return new ho(S)}};class vi{constructor(s,h,m,v,S){this.type=s,this.operator=h,this.interpolation=m,this.input=v,this.labels=[],this.outputs=[];for(const[C,L]of S)this.labels.push(C),this.outputs.push(L)}static interpolationFactor(s,h,m,v){let S=0;if(s.name==="exponential")S=Kn(h,s.base,m,v);else if(s.name==="linear")S=Kn(h,1,m,v);else if(s.name==="cubic-bezier"){const C=s.controlPoints;S=new Od(C[0],C[1],C[2],C[3]).solve(Kn(h,1,m,v))}return S}static parse(s,h){let[m,v,S,...C]=s;if(!Array.isArray(v)||v.length===0)return h.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const O=v[1];if(typeof O!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:O}}else{if(v[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const O=v.slice(1);if(O.length!==4||O.some(H=>typeof H!="number"||H<0||H>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:O}}}if(s.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,Pt),!S)return null;const L=[];let P=null;m==="interpolate-hcl"||m==="interpolate-lab"?P=wn:h.expectedType&&h.expectedType.kind!=="value"&&(P=h.expectedType);for(let O=0;O<C.length;O+=2){const H=C[O],K=C[O+1],re=O+3,ue=O+4;if(typeof H!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(L.length&&L[L.length-1][0]>=H)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',re);const me=h.parse(K,ue,P);if(!me)return null;P=P||me.type,L.push([H,me])}return te(P,Pt)||te(P,wn)||te(P,Ce)||te(P,se)||te(P,ge(Pt))?new vi(P,m,v,S,L):h.error(`Type ${we(P)} is not interpolatable.`)}evaluate(s){const h=this.labels,m=this.outputs;if(h.length===1)return m[0].evaluate(s);const v=this.input.evaluate(s);if(v<=h[0])return m[0].evaluate(s);const S=h.length;if(v>=h[S-1])return m[S-1].evaluate(s);const C=Ha(h,v),L=vi.interpolationFactor(this.interpolation,v,h[C],h[C+1]),P=m[C].evaluate(s),O=m[C+1].evaluate(s);switch(this.operator){case"interpolate":return Mi[this.type.kind](P,O,L);case"interpolate-hcl":return Mi.color(P,O,L,"hcl");case"interpolate-lab":return Mi.color(P,O,L,"lab")}}eachChild(s){s(this.input);for(const h of this.outputs)s(h)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}}function Kn(u,s,h,m){const v=m-h,S=u-h;return v===0?0:s===1?S/v:(Math.pow(s,S)-1)/(Math.pow(s,v)-1)}class Dl{constructor(s,h){this.type=s,this.args=h}static parse(s,h){if(s.length<2)return h.error("Expectected at least one argument.");let m=null;const v=h.expectedType;v&&v.kind!=="value"&&(m=v);const S=[];for(const L of s.slice(1)){const P=h.parse(L,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!P)return null;m=m||P.type,S.push(P)}if(!m)throw new Error("No output type");const C=v&&S.some(L=>Be(v,L.type));return new Dl(C?Gt:m,S)}evaluate(s){let h,m=null,v=0;for(const S of this.args)if(v++,m=S.evaluate(s),m&&m instanceof fo&&!m.available&&(h||(h=m.name),m=null,v===this.args.length&&(m=h)),m!==null)break;return m}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}}class $l{constructor(s,h){this.type=h.type,this.bindings=[].concat(s),this.result=h}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const h of this.bindings)s(h[1]);s(this.result)}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const m=[];for(let S=1;S<s.length-1;S+=2){const C=s[S];if(typeof C!="string")return h.error(`Expected string, but found ${typeof C} instead.`,S);if(/[^a-zA-Z0-9_]/.test(C))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const L=h.parse(s[S+1],S+1);if(!L)return null;m.push([C,L])}const v=h.parse(s[s.length-1],s.length-1,h.expectedType,m);return v?new $l(m,v):null}outputDefined(){return this.result.outputDefined()}}class Uc{constructor(s,h,m){this.type=s,this.index=h,this.input=m}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,Pt),v=h.parse(s[2],2,ge(h.expectedType||Gt));return m&&v?new Uc(v.type.itemType,m,v):null}evaluate(s){const h=this.index.evaluate(s),m=this.input.evaluate(s);if(h<0)throw new Mr(`Array index out of bounds: ${h} < 0.`);if(h>=m.length)throw new Mr(`Array index out of bounds: ${h} > ${m.length-1}.`);if(h!==Math.floor(h))throw new Mr(`Array index must be an integer, but found ${h} instead.`);return m[h]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}}class Vc{constructor(s,h){this.type=mn,this.needle=s,this.haystack=h}static parse(s,h){if(s.length!==3)return h.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,Gt),v=h.parse(s[2],2,Gt);return m&&v?Ue(m.type,[mn,fn,Pt,Rn,Gt])?new Vc(m,v):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`):null}evaluate(s){const h=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!m)return!1;if(!ze(h,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${we(Zr(h))} instead.`);if(!ze(m,["string","array"]))throw new Mr(`Expected second argument to be of type array or string, but found ${we(Zr(m))} instead.`);return m.indexOf(h)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}}class Rl{constructor(s,h,m){this.type=Pt,this.needle=s,this.haystack=h,this.fromIndex=m}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,Gt),v=h.parse(s[2],2,Gt);if(!m||!v)return null;if(!Ue(m.type,[mn,fn,Pt,Rn,Gt]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${we(m.type)} instead`);if(s.length===4){const S=h.parse(s[3],3,Pt);return S?new Rl(m,v,S):null}return new Rl(m,v)}evaluate(s){const h=this.needle.evaluate(s),m=this.haystack.evaluate(s);if(!ze(h,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${we(Zr(h))} instead.`);if(!ze(m,["string","array"]))throw new Mr(`Expected second argument to be of type array or string, but found ${we(Zr(m))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(s);return m.indexOf(h,v)}return m.indexOf(h)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}}class qc{constructor(s,h,m,v,S,C){this.inputType=s,this.type=h,this.input=m,this.cases=v,this.outputs=S,this.otherwise=C}static parse(s,h){if(s.length<5)return h.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return h.error("Expected an even number of arguments.");let m,v;h.expectedType&&h.expectedType.kind!=="value"&&(v=h.expectedType);const S={},C=[];for(let O=2;O<s.length-1;O+=2){let H=s[O];const K=s[O+1];Array.isArray(H)||(H=[H]);const re=h.concat(O);if(H.length===0)return re.error("Expected at least one branch label.");for(const me of H){if(typeof me!="number"&&typeof me!="string")return re.error("Branch labels must be numbers or strings.");if(typeof me=="number"&&Math.abs(me)>Number.MAX_SAFE_INTEGER)return re.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof me=="number"&&Math.floor(me)!==me)return re.error("Numeric branch labels must be integer values.");if(m){if(re.checkSubtype(m,Zr(me)))return null}else m=Zr(me);if(S[String(me)]!==void 0)return re.error("Branch labels must be unique.");S[String(me)]=C.length}const ue=h.parse(K,O,v);if(!ue)return null;v=v||ue.type,C.push(ue)}const L=h.parse(s[1],1,Gt);if(!L)return null;const P=h.parse(s[s.length-1],s.length-1,v);return P?L.type.kind!=="value"&&h.concat(1).checkSubtype(m,L.type)?null:new qc(m,v,L,S,C,P):null}evaluate(s){const h=this.input.evaluate(s);return(Zr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}}class Zc{constructor(s,h,m){this.type=s,this.branches=h,this.otherwise=m}static parse(s,h){if(s.length<4)return h.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return h.error("Expected an odd number of arguments.");let m;h.expectedType&&h.expectedType.kind!=="value"&&(m=h.expectedType);const v=[];for(let C=1;C<s.length-1;C+=2){const L=h.parse(s[C],C,mn);if(!L)return null;const P=h.parse(s[C+1],C+1,m);if(!P)return null;v.push([L,P]),m=m||P.type}const S=h.parse(s[s.length-1],s.length-1,m);if(!S)return null;if(!m)throw new Error("Can't infer output type");return new Zc(m,v,S)}evaluate(s){for(const[h,m]of this.branches)if(h.evaluate(s))return m.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[h,m]of this.branches)s(h),s(m);s(this.otherwise)}outputDefined(){return this.branches.every(([s,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class Fl{constructor(s,h,m,v){this.type=s,this.input=h,this.beginIndex=m,this.endIndex=v}static parse(s,h){if(s.length<=2||s.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const m=h.parse(s[1],1,Gt),v=h.parse(s[2],2,Pt);if(!m||!v)return null;if(!Ue(m.type,[ge(Gt),fn,Gt]))return h.error(`Expected first argument to be of type array or string, but found ${we(m.type)} instead`);if(s.length===4){const S=h.parse(s[3],3,Pt);return S?new Fl(m.type,m,v,S):null}return new Fl(m.type,m,v)}evaluate(s){const h=this.input.evaluate(s),m=this.beginIndex.evaluate(s);if(!ze(h,["string","array"]))throw new Mr(`Expected first argument to be of type array or string, but found ${we(Zr(h))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(s);return h.slice(m,v)}return h.slice(m)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}}function Vh(u,s){return u==="=="||u==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function qh(u,s,h,m){return m.compare(s,h)===0}function oa(u,s,h){const m=u!=="=="&&u!=="!=";return class kb{constructor(S,C,L){this.type=mn,this.lhs=S,this.rhs=C,this.collator=L,this.hasUntypedArgument=S.type.kind==="value"||C.type.kind==="value"}static parse(S,C){if(S.length!==3&&S.length!==4)return C.error("Expected two or three arguments.");const L=S[0];let P=C.parse(S[1],1,Gt);if(!P)return null;if(!Vh(L,P.type))return C.concat(1).error(`"${L}" comparisons are not supported for type '${we(P.type)}'.`);let O=C.parse(S[2],2,Gt);if(!O)return null;if(!Vh(L,O.type))return C.concat(2).error(`"${L}" comparisons are not supported for type '${we(O.type)}'.`);if(P.type.kind!==O.type.kind&&P.type.kind!=="value"&&O.type.kind!=="value")return C.error(`Cannot compare types '${we(P.type)}' and '${we(O.type)}'.`);m&&(P.type.kind==="value"&&O.type.kind!=="value"?P=new Xi(O.type,[P]):P.type.kind!=="value"&&O.type.kind==="value"&&(O=new Xi(P.type,[O])));let H=null;if(S.length===4){if(P.type.kind!=="string"&&O.type.kind!=="string"&&P.type.kind!=="value"&&O.type.kind!=="value")return C.error("Cannot use collator to compare non-string types.");if(H=C.parse(S[3],3,Ci),!H)return null}return new kb(P,O,H)}evaluate(S){const C=this.lhs.evaluate(S),L=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const P=Zr(C),O=Zr(L);if(P.kind!==O.kind||P.kind!=="string"&&P.kind!=="number")throw new Mr(`Expected arguments for "${u}" to be (string, string) or (number, number), but found (${P.kind}, ${O.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const P=Zr(C),O=Zr(L);if(P.kind!=="string"||O.kind!=="string")return s(S,C,L)}return this.collator?h(S,C,L,this.collator.evaluate(S)):s(S,C,L)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const Nd=oa("==",function(u,s,h){return s===h},qh),jd=oa("!=",function(u,s,h){return s!==h},function(u,s,h,m){return!qh(0,s,h,m)}),Ud=oa("<",function(u,s,h){return s<h},function(u,s,h,m){return m.compare(s,h)<0}),Vd=oa(">",function(u,s,h){return s>h},function(u,s,h,m){return m.compare(s,h)>0}),qd=oa("<=",function(u,s,h){return s<=h},function(u,s,h,m){return m.compare(s,h)<=0}),Zd=oa(">=",function(u,s,h){return s>=h},function(u,s,h,m){return m.compare(s,h)>=0});class Gc{constructor(s,h,m,v,S){this.type=fn,this.number=s,this.locale=h,this.currency=m,this.minFractionDigits=v,this.maxFractionDigits=S}static parse(s,h){if(s.length!==3)return h.error("Expected two arguments.");const m=h.parse(s[1],1,Pt);if(!m)return null;const v=s[2];if(typeof v!="object"||Array.isArray(v))return h.error("NumberFormat options argument must be an object.");let S=null;if(v.locale&&(S=h.parse(v.locale,1,fn),!S))return null;let C=null;if(v.currency&&(C=h.parse(v.currency,1,fn),!C))return null;let L=null;if(v["min-fraction-digits"]&&(L=h.parse(v["min-fraction-digits"],1,Pt),!L))return null;let P=null;return v["max-fraction-digits"]&&(P=h.parse(v["max-fraction-digits"],1,Pt),!P)?null:new Gc(m,S,C,L,P)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}}class Bl{constructor(s){this.type=_r,this.sections=s}static parse(s,h){if(s.length<2)return h.error("Expected at least one argument.");const m=s[1];if(!Array.isArray(m)&&typeof m=="object")return h.error("First argument must be an image or text section.");const v=[];let S=!1;for(let C=1;C<=s.length-1;++C){const L=s[C];if(S&&typeof L=="object"&&!Array.isArray(L)){S=!1;let P=null;if(L["font-scale"]&&(P=h.parse(L["font-scale"],1,Pt),!P))return null;let O=null;if(L["text-font"]&&(O=h.parse(L["text-font"],1,ge(fn)),!O))return null;let H=null;if(L["text-color"]&&(H=h.parse(L["text-color"],1,wn),!H))return null;const K=v[v.length-1];K.scale=P,K.font=O,K.textColor=H}else{const P=h.parse(s[C],1,Gt);if(!P)return null;const O=P.type.kind;if(O!=="string"&&O!=="value"&&O!=="null"&&O!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,v.push({content:P,scale:null,font:null,textColor:null})}}return new Bl(v)}evaluate(s){return new Ki(this.sections.map(h=>{const m=h.content.evaluate(s);return Zr(m)===ne?new jc("",m,null,null,null):new jc(ja(m),null,h.scale?h.scale.evaluate(s):null,h.font?h.font.evaluate(s).join(","):null,h.textColor?h.textColor.evaluate(s):null)}))}eachChild(s){for(const h of this.sections)s(h.content),h.scale&&s(h.scale),h.font&&s(h.font),h.textColor&&s(h.textColor)}outputDefined(){return!1}}class Hc{constructor(s){this.type=ne,this.input=s}static parse(s,h){if(s.length!==2)return h.error("Expected two arguments.");const m=h.parse(s[1],1,fn);return m?new Hc(m):h.error("No image name provided.")}evaluate(s){const h=this.input.evaluate(s),m=fo.fromString(h);return m&&s.availableImages&&(m.available=s.availableImages.indexOf(h)>-1),m}eachChild(s){s(this.input)}outputDefined(){return!1}}class Wc{constructor(s){this.type=Pt,this.input=s}static parse(s,h){if(s.length!==2)return h.error(`Expected 1 argument, but found ${s.length-1} instead.`);const m=h.parse(s[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${we(m.type)} instead.`):new Wc(m):null}evaluate(s){const h=this.input.evaluate(s);if(typeof h=="string"||Array.isArray(h))return h.length;throw new Mr(`Expected value to be of type string or array, but found ${we(Zr(h))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}}const sa={"==":Nd,"!=":jd,">":Vd,"<":Ud,">=":Zd,"<=":qd,array:Xi,at:Uc,boolean:Xi,case:Zc,coalesce:Dl,collator:ia,format:Bl,image:Hc,in:Vc,"index-of":Rl,interpolate:vi,"interpolate-hcl":vi,"interpolate-lab":vi,length:Wc,let:$l,literal:gs,match:qc,number:Xi,"number-format":Gc,object:Xi,slice:Fl,step:Wa,string:Xi,"to-boolean":jo,"to-color":jo,"to-number":jo,"to-string":jo,var:Al,within:Es};function Zh(u,[s,h,m,v]){s=s.evaluate(u),h=h.evaluate(u),m=m.evaluate(u);const S=v?v.evaluate(u):1,C=ra(s,h,m,S);if(C)throw new Mr(C);return new ir(s/255,h/255,m/255,S,!1)}function Gh(u,s){return u in s}function Kc(u,s){const h=s[u];return h===void 0?null:h}function As(u){return{type:u}}function Hh(u){return{result:"success",value:u}}function aa(u){return{result:"error",value:u}}function la(u){return u["property-type"]==="data-driven"||u["property-type"]==="cross-faded-data-driven"}function Wh(u){return!!u.expression&&u.expression.parameters.indexOf("zoom")>-1}function Xc(u){return!!u.expression&&u.expression.interpolated}function Hn(u){return u instanceof Number?"number":u instanceof String?"string":u instanceof Boolean?"boolean":Array.isArray(u)?"array":u===null?"null":typeof u}function Ol(u){return typeof u=="object"&&u!==null&&!Array.isArray(u)}function Gd(u){return u}function Kh(u,s){const h=s.type==="color",m=u.stops&&typeof u.stops[0][0]=="object",v=m||!(m||u.property!==void 0),S=u.type||(Xc(s)?"exponential":"interval");if(h||s.type==="padding"){const H=h?ir.parse:$i.parse;(u=Bn({},u)).stops&&(u.stops=u.stops.map(K=>[K[0],H(K[1])])),u.default=H(u.default?u.default:s.default)}if(u.colorSpace&&(C=u.colorSpace)!=="rgb"&&C!=="hcl"&&C!=="lab")throw new Error(`Unknown color space: "${u.colorSpace}"`);var C;let L,P,O;if(S==="exponential")L=qn;else if(S==="interval")L=Hd;else if(S==="categorical"){L=jr,P=Object.create(null);for(const H of u.stops)P[H[0]]=H[1];O=typeof u.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);L=Jc}if(m){const H={},K=[];for(let me=0;me<u.stops.length;me++){const be=u.stops[me],Te=be[0].zoom;H[Te]===void 0&&(H[Te]={zoom:Te,type:u.type,property:u.property,default:u.default,stops:[]},K.push(Te)),H[Te].stops.push([be[0].value,be[1]])}const re=[];for(const me of K)re.push([H[me].zoom,Kh(H[me],s)]);const ue={name:"linear"};return{kind:"composite",interpolationType:ue,interpolationFactor:vi.interpolationFactor.bind(void 0,ue),zoomStops:re.map(me=>me[0]),evaluate:({zoom:me},be)=>qn({stops:re,base:u.base},s,me).evaluate(me,be)}}if(v){const H=S==="exponential"?{name:"exponential",base:u.base!==void 0?u.base:1}:null;return{kind:"camera",interpolationType:H,interpolationFactor:vi.interpolationFactor.bind(void 0,H),zoomStops:u.stops.map(K=>K[0]),evaluate:({zoom:K})=>L(u,s,K,P,O)}}return{kind:"source",evaluate(H,K){const re=K&&K.properties?K.properties[u.property]:void 0;return re===void 0?Ka(u.default,s.default):L(u,s,re,P,O)}}}function Ka(u,s,h){return u!==void 0?u:s!==void 0?s:h!==void 0?h:void 0}function jr(u,s,h,m,v){return Ka(typeof h===v?m[h]:void 0,u.default,s.default)}function Hd(u,s,h){if(Hn(h)!=="number")return Ka(u.default,s.default);const m=u.stops.length;if(m===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[m-1][0])return u.stops[m-1][1];const v=Ha(u.stops.map(S=>S[0]),h);return u.stops[v][1]}function qn(u,s,h){const m=u.base!==void 0?u.base:1;if(Hn(h)!=="number")return Ka(u.default,s.default);const v=u.stops.length;if(v===1||h<=u.stops[0][0])return u.stops[0][1];if(h>=u.stops[v-1][0])return u.stops[v-1][1];const S=Ha(u.stops.map(H=>H[0]),h),C=function(H,K,re,ue){const me=ue-re,be=H-re;return me===0?0:K===1?be/me:(Math.pow(K,be)-1)/(Math.pow(K,me)-1)}(h,m,u.stops[S][0],u.stops[S+1][0]),L=u.stops[S][1],P=u.stops[S+1][1],O=Mi[s.type]||Gd;return typeof L.evaluate=="function"?{evaluate(...H){const K=L.evaluate.apply(void 0,H),re=P.evaluate.apply(void 0,H);if(K!==void 0&&re!==void 0)return O(K,re,C,u.colorSpace)}}:O(L,P,C,u.colorSpace)}function Jc(u,s,h){switch(s.type){case"color":h=ir.parse(h);break;case"formatted":h=Ki.fromString(h.toString());break;case"resolvedImage":h=fo.fromString(h.toString());break;case"padding":h=$i.parse(h);break;default:Hn(h)===s.type||s.type==="enum"&&s.values[h]||(h=void 0)}return Ka(h,u.default,s.default)}Ji.register(sa,{error:[{kind:"error"},[fn],(u,[s])=>{throw new Mr(s.evaluate(u))}],typeof:[fn,[Gt],(u,[s])=>we(Zr(s.evaluate(u)))],"to-rgba":[ge(Pt,4),[wn],(u,[s])=>{const[h,m,v,S]=s.evaluate(u).rgb;return[255*h,255*m,255*v,S]}],rgb:[wn,[Pt,Pt,Pt],Zh],rgba:[wn,[Pt,Pt,Pt,Pt],Zh],has:{type:mn,overloads:[[[fn],(u,[s])=>Gh(s.evaluate(u),u.properties())],[[fn,ln],(u,[s,h])=>Gh(s.evaluate(u),h.evaluate(u))]]},get:{type:Gt,overloads:[[[fn],(u,[s])=>Kc(s.evaluate(u),u.properties())],[[fn,ln],(u,[s,h])=>Kc(s.evaluate(u),h.evaluate(u))]]},"feature-state":[Gt,[fn],(u,[s])=>Kc(s.evaluate(u),u.featureState||{})],properties:[ln,[],u=>u.properties()],"geometry-type":[fn,[],u=>u.geometryType()],id:[Gt,[],u=>u.id()],zoom:[Pt,[],u=>u.globals.zoom],"heatmap-density":[Pt,[],u=>u.globals.heatmapDensity||0],"line-progress":[Pt,[],u=>u.globals.lineProgress||0],accumulated:[Gt,[],u=>u.globals.accumulated===void 0?null:u.globals.accumulated],"+":[Pt,As(Pt),(u,s)=>{let h=0;for(const m of s)h+=m.evaluate(u);return h}],"*":[Pt,As(Pt),(u,s)=>{let h=1;for(const m of s)h*=m.evaluate(u);return h}],"-":{type:Pt,overloads:[[[Pt,Pt],(u,[s,h])=>s.evaluate(u)-h.evaluate(u)],[[Pt],(u,[s])=>-s.evaluate(u)]]},"/":[Pt,[Pt,Pt],(u,[s,h])=>s.evaluate(u)/h.evaluate(u)],"%":[Pt,[Pt,Pt],(u,[s,h])=>s.evaluate(u)%h.evaluate(u)],ln2:[Pt,[],()=>Math.LN2],pi:[Pt,[],()=>Math.PI],e:[Pt,[],()=>Math.E],"^":[Pt,[Pt,Pt],(u,[s,h])=>Math.pow(s.evaluate(u),h.evaluate(u))],sqrt:[Pt,[Pt],(u,[s])=>Math.sqrt(s.evaluate(u))],log10:[Pt,[Pt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN10],ln:[Pt,[Pt],(u,[s])=>Math.log(s.evaluate(u))],log2:[Pt,[Pt],(u,[s])=>Math.log(s.evaluate(u))/Math.LN2],sin:[Pt,[Pt],(u,[s])=>Math.sin(s.evaluate(u))],cos:[Pt,[Pt],(u,[s])=>Math.cos(s.evaluate(u))],tan:[Pt,[Pt],(u,[s])=>Math.tan(s.evaluate(u))],asin:[Pt,[Pt],(u,[s])=>Math.asin(s.evaluate(u))],acos:[Pt,[Pt],(u,[s])=>Math.acos(s.evaluate(u))],atan:[Pt,[Pt],(u,[s])=>Math.atan(s.evaluate(u))],min:[Pt,As(Pt),(u,s)=>Math.min(...s.map(h=>h.evaluate(u)))],max:[Pt,As(Pt),(u,s)=>Math.max(...s.map(h=>h.evaluate(u)))],abs:[Pt,[Pt],(u,[s])=>Math.abs(s.evaluate(u))],round:[Pt,[Pt],(u,[s])=>{const h=s.evaluate(u);return h<0?-Math.round(-h):Math.round(h)}],floor:[Pt,[Pt],(u,[s])=>Math.floor(s.evaluate(u))],ceil:[Pt,[Pt],(u,[s])=>Math.ceil(s.evaluate(u))],"filter-==":[mn,[fn,Gt],(u,[s,h])=>u.properties()[s.value]===h.value],"filter-id-==":[mn,[Gt],(u,[s])=>u.id()===s.value],"filter-type-==":[mn,[fn],(u,[s])=>u.geometryType()===s.value],"filter-<":[mn,[fn,Gt],(u,[s,h])=>{const m=u.properties()[s.value],v=h.value;return typeof m==typeof v&&m<v}],"filter-id-<":[mn,[Gt],(u,[s])=>{const h=u.id(),m=s.value;return typeof h==typeof m&&h<m}],"filter->":[mn,[fn,Gt],(u,[s,h])=>{const m=u.properties()[s.value],v=h.value;return typeof m==typeof v&&m>v}],"filter-id->":[mn,[Gt],(u,[s])=>{const h=u.id(),m=s.value;return typeof h==typeof m&&h>m}],"filter-<=":[mn,[fn,Gt],(u,[s,h])=>{const m=u.properties()[s.value],v=h.value;return typeof m==typeof v&&m<=v}],"filter-id-<=":[mn,[Gt],(u,[s])=>{const h=u.id(),m=s.value;return typeof h==typeof m&&h<=m}],"filter->=":[mn,[fn,Gt],(u,[s,h])=>{const m=u.properties()[s.value],v=h.value;return typeof m==typeof v&&m>=v}],"filter-id->=":[mn,[Gt],(u,[s])=>{const h=u.id(),m=s.value;return typeof h==typeof m&&h>=m}],"filter-has":[mn,[Gt],(u,[s])=>s.value in u.properties()],"filter-has-id":[mn,[],u=>u.id()!==null&&u.id()!==void 0],"filter-type-in":[mn,[ge(fn)],(u,[s])=>s.value.indexOf(u.geometryType())>=0],"filter-id-in":[mn,[ge(Gt)],(u,[s])=>s.value.indexOf(u.id())>=0],"filter-in-small":[mn,[fn,ge(Gt)],(u,[s,h])=>h.value.indexOf(u.properties()[s.value])>=0],"filter-in-large":[mn,[fn,ge(Gt)],(u,[s,h])=>function(m,v,S,C){for(;S<=C;){const L=S+C>>1;if(v[L]===m)return!0;v[L]>m?C=L-1:S=L+1}return!1}(u.properties()[s.value],h.value,0,h.value.length-1)],all:{type:mn,overloads:[[[mn,mn],(u,[s,h])=>s.evaluate(u)&&h.evaluate(u)],[As(mn),(u,s)=>{for(const h of s)if(!h.evaluate(u))return!1;return!0}]]},any:{type:mn,overloads:[[[mn,mn],(u,[s,h])=>s.evaluate(u)||h.evaluate(u)],[As(mn),(u,s)=>{for(const h of s)if(h.evaluate(u))return!0;return!1}]]},"!":[mn,[mn],(u,[s])=>!s.evaluate(u)],"is-supported-script":[mn,[fn],(u,[s])=>{const h=u.globals&&u.globals.isSupportedScript;return!h||h(s.evaluate(u))}],upcase:[fn,[fn],(u,[s])=>s.evaluate(u).toUpperCase()],downcase:[fn,[fn],(u,[s])=>s.evaluate(u).toLowerCase()],concat:[fn,As(Gt),(u,s)=>s.map(h=>ja(h.evaluate(u))).join("")],"resolved-locale":[fn,[Ci],(u,[s])=>s.evaluate(u).resolvedLocale()]});class yr{constructor(s,h){var m;this.expression=s,this._warningHistory={},this._evaluator=new or,this._defaultValue=h?(m=h).type==="color"&&Ol(m.default)?new ir(0,0,0,0):m.type==="color"?ir.parse(m.default)||null:m.type==="padding"?$i.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?ho.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(s,h,m,v,S,C){return this._evaluator.globals=s,this._evaluator.feature=h,this._evaluator.featureState=m,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=C,this.expression.evaluate(this._evaluator)}evaluate(s,h,m,v,S,C){this._evaluator.globals=s,this._evaluator.feature=h||null,this._evaluator.featureState=m||null,this._evaluator.canonical=v,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=C||null;try{const L=this.expression.evaluate(this._evaluator);if(L==null||typeof L=="number"&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new Mr(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function fr(u){return Array.isArray(u)&&u.length>0&&typeof u[0]=="string"&&u[0]in sa}function Ps(u,s){const h=new Tl(sa,qa,[],s?function(v){const S={color:wn,string:fn,number:Pt,enum:fn,boolean:mn,formatted:_r,padding:Ce,resolvedImage:ne,variableAnchorOffsetCollection:se};return v.type==="array"?ge(S[v.value]||Gt,v.length):S[v.type]}(s):void 0),m=h.parse(u,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Hh(new yr(m,s)):aa(h.errors)}class Nl{constructor(s,h){this.kind=s,this._styleExpression=h,this.isStateDependent=s!=="constant"&&!Za(h.expression)}evaluateWithoutErrorHandling(s,h,m,v,S,C){return this._styleExpression.evaluateWithoutErrorHandling(s,h,m,v,S,C)}evaluate(s,h,m,v,S,C){return this._styleExpression.evaluate(s,h,m,v,S,C)}}class Yc{constructor(s,h,m,v){this.kind=s,this.zoomStops=m,this._styleExpression=h,this.isStateDependent=s!=="camera"&&!Za(h.expression),this.interpolationType=v}evaluateWithoutErrorHandling(s,h,m,v,S,C){return this._styleExpression.evaluateWithoutErrorHandling(s,h,m,v,S,C)}evaluate(s,h,m,v,S,C){return this._styleExpression.evaluate(s,h,m,v,S,C)}interpolationFactor(s,h,m){return this.interpolationType?vi.interpolationFactor(this.interpolationType,s,h,m):0}}function Xh(u,s){const h=Ps(u,s);if(h.result==="error")return h;const m=h.value.expression,v=Pl(m);if(!v&&!la(s))return aa([new xr("","data expressions not supported")]);const S=Ga(m,["zoom"]);if(!S&&!Wh(s))return aa([new xr("","zoom expressions not supported")]);const C=Ul(m);return C||S?C instanceof xr?aa([C]):C instanceof vi&&!Xc(s)?aa([new xr("",'"interpolate" expressions cannot be used with this property')]):Hh(C?new Yc(v?"camera":"composite",h.value,C.labels,C instanceof vi?C.interpolation:void 0):new Nl(v?"constant":"source",h.value)):aa([new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class jl{constructor(s,h){this._parameters=s,this._specification=h,Bn(this,Kh(this._parameters,this._specification))}static deserialize(s){return new jl(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Ul(u){let s=null;if(u instanceof $l)s=Ul(u.result);else if(u instanceof Dl){for(const h of u.args)if(s=Ul(h),s)break}else(u instanceof Wa||u instanceof vi)&&u.input instanceof Ji&&u.input.name==="zoom"&&(s=u);return s instanceof xr||u.eachChild(h=>{const m=Ul(h);m instanceof xr?s=m:!s&&m?s=new xr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):s&&m&&s!==m&&(s=new xr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}function Vl(u){if(u===!0||u===!1)return!0;if(!Array.isArray(u)||u.length===0)return!1;switch(u[0]){case"has":return u.length>=2&&u[1]!=="$id"&&u[1]!=="$type";case"in":return u.length>=3&&(typeof u[1]!="string"||Array.isArray(u[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return u.length!==3||Array.isArray(u[1])||Array.isArray(u[2]);case"any":case"all":for(const s of u.slice(1))if(!Vl(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}const Jh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ql(u){if(u==null)return{filter:()=>!0,needGeometry:!1};Vl(u)||(u=Gl(u));const s=Ps(u,Jh);if(s.result==="error")throw new Error(s.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,m,v)=>s.value.evaluate(h,m,{},v),needGeometry:Zl(u)}}function Yh(u,s){return u<s?-1:u>s?1:0}function Zl(u){if(!Array.isArray(u))return!1;if(u[0]==="within")return!0;for(let s=1;s<u.length;s++)if(Zl(u[s]))return!0;return!1}function Gl(u){if(!u)return!0;const s=u[0];return u.length<=1?s!=="any":s==="=="?Qc(u[1],u[2],"=="):s==="!="?Hl(Qc(u[1],u[2],"==")):s==="<"||s===">"||s==="<="||s===">="?Qc(u[1],u[2],s):s==="any"?(h=u.slice(1),["any"].concat(h.map(Gl))):s==="all"?["all"].concat(u.slice(1).map(Gl)):s==="none"?["all"].concat(u.slice(1).map(Gl).map(Hl)):s==="in"?Qh(u[1],u.slice(2)):s==="!in"?Hl(Qh(u[1],u.slice(2))):s==="has"?ef(u[1]):s==="!has"?Hl(ef(u[1])):s!=="within"||u;var h}function Qc(u,s,h){switch(u){case"$type":return[`filter-type-${h}`,s];case"$id":return[`filter-id-${h}`,s];default:return[`filter-${h}`,u,s]}}function Qh(u,s){if(s.length===0)return!1;switch(u){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(h=>typeof h!=typeof s[0])?["filter-in-large",u,["literal",s.sort(Yh)]]:["filter-in-small",u,["literal",s]]}}function ef(u){switch(u){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",u]}}function Hl(u){return["!",u]}function eu(u){const s=typeof u;if(s==="number"||s==="boolean"||s==="string"||u==null)return JSON.stringify(u);if(Array.isArray(u)){let v="[";for(const S of u)v+=`${eu(S)},`;return`${v}]`}const h=Object.keys(u).sort();let m="{";for(let v=0;v<h.length;v++)m+=`${JSON.stringify(h[v])}:${eu(u[h[v]])},`;return`${m}}`}function Wd(u){let s="";for(const h of Pn)s+=`/${eu(u[h])}`;return s}function tf(u){const s=u.value;return s?[new bt(u.key,s,"constants have been deprecated as of v8")]:[]}function zr(u){return u instanceof Number||u instanceof String||u instanceof Boolean?u.valueOf():u}function ys(u){if(Array.isArray(u))return u.map(ys);if(u instanceof Object&&!(u instanceof Number||u instanceof String||u instanceof Boolean)){const s={};for(const h in u)s[h]=ys(u[h]);return s}return zr(u)}function Li(u){const s=u.key,h=u.value,m=u.valueSpec||{},v=u.objectElementValidators||{},S=u.style,C=u.styleSpec,L=u.validateSpec;let P=[];const O=Hn(h);if(O!=="object")return[new bt(s,h,`object expected, ${O} found`)];for(const H in h){const K=H.split(".")[0],re=m[K]||m["*"];let ue;if(v[K])ue=v[K];else if(m[K])ue=L;else if(v["*"])ue=v["*"];else{if(!m["*"]){P.push(new bt(s,h[H],`unknown property "${H}"`));continue}ue=L}P=P.concat(ue({key:(s&&`${s}.`)+H,value:h[H],valueSpec:re,style:S,styleSpec:C,object:h,objectKey:H,validateSpec:L},h))}for(const H in m)v[H]||m[H].required&&m[H].default===void 0&&h[H]===void 0&&P.push(new bt(s,h,`missing required property "${H}"`));return P}function tu(u){const s=u.value,h=u.valueSpec,m=u.style,v=u.styleSpec,S=u.key,C=u.arrayElementValidator||u.validateSpec;if(Hn(s)!=="array")return[new bt(S,s,`array expected, ${Hn(s)} found`)];if(h.length&&s.length!==h.length)return[new bt(S,s,`array length ${h.length} expected, length ${s.length} found`)];if(h["min-length"]&&s.length<h["min-length"])return[new bt(S,s,`array length at least ${h["min-length"]} expected, length ${s.length} found`)];let L={type:h.value,values:h.values};v.$version<7&&(L.function=h.function),Hn(h.value)==="object"&&(L=h.value);let P=[];for(let O=0;O<s.length;O++)P=P.concat(C({array:s,arrayIndex:O,value:s[O],valueSpec:L,validateSpec:u.validateSpec,style:m,styleSpec:v,key:`${S}[${O}]`}));return P}function Wl(u){const s=u.key,h=u.value,m=u.valueSpec;let v=Hn(h);return v==="number"&&h!=h&&(v="NaN"),v!=="number"?[new bt(s,h,`number expected, ${v} found`)]:"minimum"in m&&h<m.minimum?[new bt(s,h,`${h} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&h>m.maximum?[new bt(s,h,`${h} is greater than the maximum value ${m.maximum}`)]:[]}function nf(u){const s=u.valueSpec,h=zr(u.value.type);let m,v,S,C={};const L=h!=="categorical"&&u.value.property===void 0,P=!L,O=Hn(u.value.stops)==="array"&&Hn(u.value.stops[0])==="array"&&Hn(u.value.stops[0][0])==="object",H=Li({key:u.key,value:u.value,valueSpec:u.styleSpec.function,validateSpec:u.validateSpec,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(ue){if(h==="identity")return[new bt(ue.key,ue.value,'identity function may not have a "stops" property')];let me=[];const be=ue.value;return me=me.concat(tu({key:ue.key,value:be,valueSpec:ue.valueSpec,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:K})),Hn(be)==="array"&&be.length===0&&me.push(new bt(ue.key,be,"array must have at least one stop")),me},default:function(ue){return ue.validateSpec({key:ue.key,value:ue.value,valueSpec:s,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec})}}});return h==="identity"&&L&&H.push(new bt(u.key,u.value,'missing required property "property"')),h==="identity"||u.value.stops||H.push(new bt(u.key,u.value,'missing required property "stops"')),h==="exponential"&&u.valueSpec.expression&&!Xc(u.valueSpec)&&H.push(new bt(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(P&&!la(u.valueSpec)?H.push(new bt(u.key,u.value,"property functions not supported")):L&&!Wh(u.valueSpec)&&H.push(new bt(u.key,u.value,"zoom functions not supported"))),h!=="categorical"&&!O||u.value.property!==void 0||H.push(new bt(u.key,u.value,'"property" property is required')),H;function K(ue){let me=[];const be=ue.value,Te=ue.key;if(Hn(be)!=="array")return[new bt(Te,be,`array expected, ${Hn(be)} found`)];if(be.length!==2)return[new bt(Te,be,`array length 2 expected, length ${be.length} found`)];if(O){if(Hn(be[0])!=="object")return[new bt(Te,be,`object expected, ${Hn(be[0])} found`)];if(be[0].zoom===void 0)return[new bt(Te,be,"object stop key must have zoom")];if(be[0].value===void 0)return[new bt(Te,be,"object stop key must have value")];if(S&&S>zr(be[0].zoom))return[new bt(Te,be[0].zoom,"stop zoom values must appear in ascending order")];zr(be[0].zoom)!==S&&(S=zr(be[0].zoom),v=void 0,C={}),me=me.concat(Li({key:`${Te}[0]`,value:be[0],valueSpec:{zoom:{}},validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:Wl,value:re}}))}else me=me.concat(re({key:`${Te}[0]`,value:be[0],valueSpec:{},validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec},be));return fr(ys(be[1]))?me.concat([new bt(`${Te}[1]`,be[1],"expressions are not allowed in function stops.")]):me.concat(ue.validateSpec({key:`${Te}[1]`,value:be[1],valueSpec:s,validateSpec:ue.validateSpec,style:ue.style,styleSpec:ue.styleSpec}))}function re(ue,me){const be=Hn(ue.value),Te=zr(ue.value),Ae=ue.value!==null?ue.value:me;if(m){if(be!==m)return[new bt(ue.key,Ae,`${be} stop domain type must match previous stop domain type ${m}`)]}else m=be;if(be!=="number"&&be!=="string"&&be!=="boolean")return[new bt(ue.key,Ae,"stop domain value must be a number, string, or boolean")];if(be!=="number"&&h!=="categorical"){let qe=`number expected, ${be} found`;return la(s)&&h===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new bt(ue.key,Ae,qe)]}return h!=="categorical"||be!=="number"||isFinite(Te)&&Math.floor(Te)===Te?h!=="categorical"&&be==="number"&&v!==void 0&&Te<v?[new bt(ue.key,Ae,"stop domain values must appear in ascending order")]:(v=Te,h==="categorical"&&Te in C?[new bt(ue.key,Ae,"stop domain values must be unique")]:(C[Te]=!0,[])):[new bt(ue.key,Ae,`integer expected, found ${Te}`)]}}function bs(u){const s=(u.expressionContext==="property"?Xh:Ps)(ys(u.value),u.valueSpec);if(s.result==="error")return s.value.map(m=>new bt(`${u.key}${m.key}`,u.value,m.message));const h=s.value.expression||s.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!h.outputDefined())return[new bt(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!Za(h))return[new bt(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter"&&!Za(h))return[new bt(u.key,u.value,'"feature-state" data expressions are not supported with filters.')];if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!Ga(h,["zoom","feature-state"]))return[new bt(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!Pl(h))return[new bt(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function vs(u){const s=u.key,h=u.value,m=u.valueSpec,v=[];return Array.isArray(m.values)?m.values.indexOf(zr(h))===-1&&v.push(new bt(s,h,`expected one of [${m.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(m.values).indexOf(zr(h))===-1&&v.push(new bt(s,h,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(h)} found`)),v}function ca(u){return Vl(ys(u.value))?bs(Bn({},u,{expressionContext:"filter",valueSpec:{value:"boolean"}})):nu(u)}function nu(u){const s=u.value,h=u.key;if(Hn(s)!=="array")return[new bt(h,s,`array expected, ${Hn(s)} found`)];const m=u.styleSpec;let v,S=[];if(s.length<1)return[new bt(h,s,"filter array must have at least 1 element")];switch(S=S.concat(vs({key:`${h}[0]`,value:s[0],valueSpec:m.filter_operator,style:u.style,styleSpec:u.styleSpec})),zr(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&zr(s[1])==="$type"&&S.push(new bt(h,s,`"$type" cannot be use with operator "${s[0]}"`));case"==":case"!=":s.length!==3&&S.push(new bt(h,s,`filter array for operator "${s[0]}" must have 3 elements`));case"in":case"!in":s.length>=2&&(v=Hn(s[1]),v!=="string"&&S.push(new bt(`${h}[1]`,s[1],`string expected, ${v} found`)));for(let C=2;C<s.length;C++)v=Hn(s[C]),zr(s[1])==="$type"?S=S.concat(vs({key:`${h}[${C}]`,value:s[C],valueSpec:m.geometry_type,style:u.style,styleSpec:u.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&S.push(new bt(`${h}[${C}]`,s[C],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let C=1;C<s.length;C++)S=S.concat(nu({key:`${h}[${C}]`,value:s[C],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":v=Hn(s[1]),s.length!==2?S.push(new bt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="string"&&S.push(new bt(`${h}[1]`,s[1],`string expected, ${v} found`));break;case"within":v=Hn(s[1]),s.length!==2?S.push(new bt(h,s,`filter array for "${s[0]}" operator must have 2 elements`)):v!=="object"&&S.push(new bt(`${h}[1]`,s[1],`object expected, ${v} found`))}return S}function Kl(u,s){const h=u.key,m=u.validateSpec,v=u.style,S=u.styleSpec,C=u.value,L=u.objectKey,P=S[`${s}_${u.layerType}`];if(!P)return[];const O=L.match(/^(.*)-transition$/);if(s==="paint"&&O&&P[O[1]]&&P[O[1]].transition)return m({key:h,value:C,valueSpec:S.transition,style:v,styleSpec:S});const H=u.valueSpec||P[L];if(!H)return[new bt(h,C,`unknown property "${L}"`)];let K;if(Hn(C)==="string"&&la(H)&&!H.tokens&&(K=/^{([^}]+)}$/.exec(C)))return[new bt(h,C,`"${L}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(K[1])} }\`.`)];const re=[];return u.layerType==="symbol"&&(L==="text-field"&&v&&!v.glyphs&&re.push(new bt(h,C,'use of "text-field" requires a style "glyphs" property')),L==="text-font"&&Ol(ys(C))&&zr(C.type)==="identity"&&re.push(new bt(h,C,'"text-font" does not support identity functions'))),re.concat(m({key:u.key,value:C,valueSpec:H,style:v,styleSpec:S,expressionContext:"property",propertyType:s,propertyKey:L}))}function ru(u){return Kl(u,"paint")}function iu(u){return Kl(u,"layout")}function Xa(u){let s=[];const h=u.value,m=u.key,v=u.style,S=u.styleSpec;h.type||h.ref||s.push(new bt(m,h,'either "type" or "ref" is required'));let C=zr(h.type);const L=zr(h.ref);if(h.id){const P=zr(h.id);for(let O=0;O<u.arrayIndex;O++){const H=v.layers[O];zr(H.id)===P&&s.push(new bt(m,h.id,`duplicate layer id "${h.id}", previously used at line ${H.id.__line__}`))}}if("ref"in h){let P;["type","source","source-layer","filter","layout"].forEach(O=>{O in h&&s.push(new bt(m,h[O],`"${O}" is prohibited for ref layers`))}),v.layers.forEach(O=>{zr(O.id)===L&&(P=O)}),P?P.ref?s.push(new bt(m,h.ref,"ref cannot reference another ref layer")):C=zr(P.type):s.push(new bt(m,h.ref,`ref layer "${L}" not found`))}else if(C!=="background")if(h.source){const P=v.sources&&v.sources[h.source],O=P&&zr(P.type);P?O==="vector"&&C==="raster"?s.push(new bt(m,h.source,`layer "${h.id}" requires a raster source`)):O!=="raster-dem"&&C==="hillshade"?s.push(new bt(m,h.source,`layer "${h.id}" requires a raster-dem source`)):O==="raster"&&C!=="raster"?s.push(new bt(m,h.source,`layer "${h.id}" requires a vector source`)):O!=="vector"||h["source-layer"]?O==="raster-dem"&&C!=="hillshade"?s.push(new bt(m,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!h.paint||!h.paint["line-gradient"]||O==="geojson"&&P.lineMetrics||s.push(new bt(m,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):s.push(new bt(m,h,`layer "${h.id}" must specify a "source-layer"`)):s.push(new bt(m,h.source,`source "${h.source}" not found`))}else s.push(new bt(m,h,'missing required property "source"'));return s=s.concat(Li({key:m,value:h,valueSpec:S.layer,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,objectElementValidators:{"*":()=>[],type:()=>u.validateSpec({key:`${m}.type`,value:h.type,valueSpec:S.layer.type,style:u.style,styleSpec:u.styleSpec,validateSpec:u.validateSpec,object:h,objectKey:"type"}),filter:ca,layout:P=>Li({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":O=>iu(Bn({layerType:C},O))}}),paint:P=>Li({layer:h,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":O=>ru(Bn({layerType:C},O))}})}})),s}function zs(u){const s=u.value,h=u.key,m=Hn(s);return m!=="string"?[new bt(h,s,`string expected, ${m} found`)]:[]}const rf={promoteId:function({key:u,value:s}){if(Hn(s)==="string")return zs({key:u,value:s});{const h=[];for(const m in s)h.push(...zs({key:`${u}.${m}`,value:s[m]}));return h}}};function of(u){const s=u.value,h=u.key,m=u.styleSpec,v=u.style,S=u.validateSpec;if(!s.type)return[new bt(h,s,'"type" is required')];const C=zr(s.type);let L;switch(C){case"vector":case"raster":return L=Li({key:h,value:s,valueSpec:m[`source_${C.replace("-","_")}`],style:u.style,styleSpec:m,objectElementValidators:rf,validateSpec:S}),L;case"raster-dem":return L=function(P){var O;const H=(O=P.sourceName)!==null&&O!==void 0?O:"",K=P.value,re=P.styleSpec,ue=re.source_raster_dem,me=P.style;let be=[];const Te=Hn(K);if(K===void 0)return be;if(Te!=="object")return be.push(new bt("source_raster_dem",K,`object expected, ${Te} found`)),be;const Ae=zr(K.encoding)==="custom",qe=["redFactor","greenFactor","blueFactor","baseShift"],$e=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Oe in K)!Ae&&qe.includes(Oe)?be.push(new bt(Oe,K[Oe],`In "${H}": "${Oe}" is only valid when "encoding" is set to "custom". ${$e} encoding found`)):ue[Oe]?be=be.concat(P.validateSpec({key:Oe,value:K[Oe],valueSpec:ue[Oe],validateSpec:P.validateSpec,style:me,styleSpec:re})):be.push(new bt(Oe,K[Oe],`unknown property "${Oe}"`));return be}({sourceName:h,value:s,style:u.style,styleSpec:m,validateSpec:S}),L;case"geojson":if(L=Li({key:h,value:s,valueSpec:m.source_geojson,style:v,styleSpec:m,validateSpec:S,objectElementValidators:rf}),s.cluster)for(const P in s.clusterProperties){const[O,H]=s.clusterProperties[P],K=typeof O=="string"?[O,["accumulated"],["get",P]]:O;L.push(...bs({key:`${h}.${P}.map`,value:H,validateSpec:S,expressionContext:"cluster-map"})),L.push(...bs({key:`${h}.${P}.reduce`,value:K,validateSpec:S,expressionContext:"cluster-reduce"}))}return L;case"video":return Li({key:h,value:s,valueSpec:m.source_video,style:v,validateSpec:S,styleSpec:m});case"image":return Li({key:h,value:s,valueSpec:m.source_image,style:v,validateSpec:S,styleSpec:m});case"canvas":return[new bt(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return vs({key:`${h}.type`,value:s.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:S,styleSpec:m})}}function sf(u){const s=u.value,h=u.styleSpec,m=h.light,v=u.style;let S=[];const C=Hn(s);if(s===void 0)return S;if(C!=="object")return S=S.concat([new bt("light",s,`object expected, ${C} found`)]),S;for(const L in s){const P=L.match(/^(.*)-transition$/);S=S.concat(P&&m[P[1]]&&m[P[1]].transition?u.validateSpec({key:L,value:s[L],valueSpec:h.transition,validateSpec:u.validateSpec,style:v,styleSpec:h}):m[L]?u.validateSpec({key:L,value:s[L],valueSpec:m[L],validateSpec:u.validateSpec,style:v,styleSpec:h}):[new bt(L,s[L],`unknown property "${L}"`)])}return S}function af(u){const s=u.value,h=u.styleSpec,m=h.sky,v=u.style,S=Hn(s);if(s===void 0)return[];if(S!=="object")return[new bt("sky",s,`object expected, ${S} found`)];let C=[];for(const L in s)C=C.concat(m[L]?Uo({key:L,value:s[L],valueSpec:m[L],style:v,styleSpec:h}):[new bt(L,s[L],`unknown property "${L}"`)]);return C}function Ja(u){const s=u.value,h=u.styleSpec,m=h.terrain,v=u.style;let S=[];const C=Hn(s);if(s===void 0)return S;if(C!=="object")return S=S.concat([new bt("terrain",s,`object expected, ${C} found`)]),S;for(const L in s)S=S.concat(m[L]?u.validateSpec({key:L,value:s[L],valueSpec:m[L],validateSpec:u.validateSpec,style:v,styleSpec:h}):[new bt(L,s[L],`unknown property "${L}"`)]);return S}function Ya(u){let s=[];const h=u.value,m=u.key;if(Array.isArray(h)){const v=[],S=[];for(const C in h)h[C].id&&v.includes(h[C].id)&&s.push(new bt(m,h,`all the sprites' ids must be unique, but ${h[C].id} is duplicated`)),v.push(h[C].id),h[C].url&&S.includes(h[C].url)&&s.push(new bt(m,h,`all the sprites' URLs must be unique, but ${h[C].url} is duplicated`)),S.push(h[C].url),s=s.concat(Li({key:`${m}[${C}]`,value:h[C],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:u.validateSpec}));return s}return zs({key:m,value:h})}const Ri={"*":()=>[],array:tu,boolean:function(u){const s=u.value,h=u.key,m=Hn(s);return m!=="boolean"?[new bt(h,s,`boolean expected, ${m} found`)]:[]},number:Wl,color:function(u){const s=u.key,h=u.value,m=Hn(h);return m!=="string"?[new bt(s,h,`color expected, ${m} found`)]:ir.parse(String(h))?[]:[new bt(s,h,`color expected, "${h}" found`)]},constants:tf,enum:vs,filter:ca,function:nf,layer:Xa,object:Li,source:of,light:sf,sky:af,terrain:Ja,string:zs,formatted:function(u){return zs(u).length===0?[]:bs(u)},resolvedImage:function(u){return zs(u).length===0?[]:bs(u)},padding:function(u){const s=u.key,h=u.value;if(Hn(h)==="array"){if(h.length<1||h.length>4)return[new bt(s,h,`padding requires 1 to 4 values; ${h.length} values found`)];const m={type:"number"};let v=[];for(let S=0;S<h.length;S++)v=v.concat(u.validateSpec({key:`${s}[${S}]`,value:h[S],validateSpec:u.validateSpec,valueSpec:m}));return v}return Wl({key:s,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(u){const s=u.key,h=u.value,m=Hn(h),v=u.styleSpec;if(m!=="array"||h.length<1||h.length%2!=0)return[new bt(s,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let C=0;C<h.length;C+=2)S=S.concat(vs({key:`${s}[${C}]`,value:h[C],valueSpec:v.layout_symbol["text-anchor"]})),S=S.concat(tu({key:`${s}[${C+1}]`,value:h[C+1],valueSpec:{length:2,value:"number"},validateSpec:u.validateSpec,style:u.style,styleSpec:v}));return S},sprite:Ya};function Uo(u){const s=u.value,h=u.valueSpec,m=u.styleSpec;return u.validateSpec=Uo,h.expression&&Ol(zr(s))?nf(u):h.expression&&fr(ys(s))?bs(u):h.type&&Ri[h.type]?Ri[h.type](u):Li(Bn({},u,{valueSpec:h.type?m[h.type]:h}))}function ou(u){const s=u.value,h=u.key,m=zs(u);return m.length||(s.indexOf("{fontstack}")===-1&&m.push(new bt(h,s,'"glyphs" url must include a "{fontstack}" token')),s.indexOf("{range}")===-1&&m.push(new bt(h,s,'"glyphs" url must include a "{range}" token'))),m}function vo(u,s=_e){let h=[];return h=h.concat(Uo({key:"",value:u,valueSpec:s.$root,styleSpec:s,style:u,validateSpec:Uo,objectElementValidators:{glyphs:ou,"*":()=>[]}})),u.constants&&(h=h.concat(tf({key:"constants",value:u.constants,style:u,styleSpec:s,validateSpec:Uo}))),ua(h)}function Vo(u){return function(s){return u({...s,validateSpec:Uo})}}function ua(u){return[].concat(u).sort((s,h)=>s.line-h.line)}function wo(u){return function(...s){return ua(u.apply(this,s))}}vo.source=wo(Vo(of)),vo.sprite=wo(Vo(Ya)),vo.glyphs=wo(Vo(ou)),vo.light=wo(Vo(sf)),vo.sky=wo(Vo(af)),vo.terrain=wo(Vo(Ja)),vo.layer=wo(Vo(Xa)),vo.filter=wo(Vo(ca)),vo.paintProperty=wo(Vo(ru)),vo.layoutProperty=wo(Vo(iu));const Ds=vo,Kd=Ds.light,su=Ds.paintProperty,Xd=Ds.layoutProperty;function ha(u,s){let h=!1;if(s&&s.length)for(const m of s)u.fire(new St(new Error(m.message))),h=!0;return h}class Qa{constructor(s,h,m){const v=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;const C=new Int32Array(this.arrayBuffer);s=C[0],this.d=(h=C[1])+2*(m=C[2]);for(let P=0;P<this.d*this.d;P++){const O=C[3+P],H=C[3+P+1];v.push(O===H?null:C.subarray(O,H))}const L=C[3+v.length+1];this.keys=C.subarray(C[3+v.length],L),this.bboxes=C.subarray(L),this.insert=this._insertReadonly}else{this.d=h+2*m;for(let C=0;C<this.d*this.d;C++)v.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=s,this.padding=m,this.scale=h/s,this.uid=0;const S=m/h*s;this.min=-S,this.max=s+S}insert(s,h,m,v,S){this._forEachCell(h,m,v,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(s),this.bboxes.push(h),this.bboxes.push(m),this.bboxes.push(v),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(s,h,m,v,S,C){this.cells[S].push(C)}query(s,h,m,v,S){const C=this.min,L=this.max;if(s<=C&&h<=C&&L<=m&&L<=v&&!S)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(s,h,m,v,this._queryCell,P,{},S),P}}_queryCell(s,h,m,v,S,C,L,P){const O=this.cells[S];if(O!==null){const H=this.keys,K=this.bboxes;for(let re=0;re<O.length;re++){const ue=O[re];if(L[ue]===void 0){const me=4*ue;(P?P(K[me+0],K[me+1],K[me+2],K[me+3]):s<=K[me+2]&&h<=K[me+3]&&m>=K[me+0]&&v>=K[me+1])?(L[ue]=!0,C.push(H[ue])):L[ue]=!1}}}}_forEachCell(s,h,m,v,S,C,L,P){const O=this._convertToCellCoord(s),H=this._convertToCellCoord(h),K=this._convertToCellCoord(m),re=this._convertToCellCoord(v);for(let ue=O;ue<=K;ue++)for(let me=H;me<=re;me++){const be=this.d*me+ue;if((!P||P(this._convertFromCellCoord(ue),this._convertFromCellCoord(me),this._convertFromCellCoord(ue+1),this._convertFromCellCoord(me+1)))&&S.call(this,s,h,m,v,be,C,L,P))return}}_convertFromCellCoord(s){return(s-this.padding)/this.scale}_convertToCellCoord(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const s=this.cells,h=3+this.cells.length+1+1;let m=0;for(let C=0;C<this.cells.length;C++)m+=this.cells[C].length;const v=new Int32Array(h+m+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let S=h;for(let C=0;C<s.length;C++){const L=s[C];v[3+C]=S,v.set(L,S),S+=L.length}return v[3+s.length]=S,v.set(this.keys,S),S+=this.keys.length,v[3+s.length+1]=S,v.set(this.bboxes,S),S+=this.bboxes.length,v.buffer}static serialize(s,h){const m=s.toArrayBuffer();return h&&h.push(m),{buffer:m}}static deserialize(s){return new Qa(s.buffer)}}const qo={};function Ht(u,s,h={}){if(qo[u])throw new Error(`${u} is already registered.`);Object.defineProperty(s,"_classRegistryKey",{value:u,writeable:!1}),qo[u]={klass:s,omit:h.omit||[],shallow:h.shallow||[]}}Ht("Object",Object),Ht("TransferableGridIndex",Qa),Ht("Color",ir),Ht("Error",Error),Ht("AJAXError",It),Ht("ResolvedImage",fo),Ht("StylePropertyFunction",jl),Ht("StyleExpression",yr,{omit:["_evaluator"]}),Ht("ZoomDependentExpression",Yc),Ht("ZoomConstantExpression",Nl),Ht("CompoundExpression",Ji,{omit:["_evaluate"]});for(const u in sa)sa[u]._classRegistryKey||Ht(`Expression_${u}`,sa[u]);function Xl(u){return u&&typeof ArrayBuffer<"u"&&(u instanceof ArrayBuffer||u.constructor&&u.constructor.name==="ArrayBuffer")}function fa(u,s){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error)return u;if(Xl(u)||De(u))return s&&s.push(u),u;if(ArrayBuffer.isView(u)){const h=u;return s&&s.push(h.buffer),h}if(u instanceof ImageData)return s&&s.push(u.data.buffer),u;if(Array.isArray(u)){const h=[];for(const m of u)h.push(fa(m,s));return h}if(typeof u=="object"){const h=u.constructor,m=h._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!qo[m])throw new Error(`${m} is not registered.`);const v=h.serialize?h.serialize(u,s):{};if(h.serialize){if(s&&v===s[s.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in u){if(!u.hasOwnProperty(S)||qo[m].omit.indexOf(S)>=0)continue;const C=u[S];v[S]=qo[m].shallow.indexOf(S)>=0?C:fa(C,s)}u instanceof Error&&(v.message=u.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(v.$name=m),v}throw new Error("can't serialize object of type "+typeof u)}function da(u){if(u==null||typeof u=="boolean"||typeof u=="number"||typeof u=="string"||u instanceof Boolean||u instanceof Number||u instanceof String||u instanceof Date||u instanceof RegExp||u instanceof Blob||u instanceof Error||Xl(u)||De(u)||ArrayBuffer.isView(u)||u instanceof ImageData)return u;if(Array.isArray(u))return u.map(da);if(typeof u=="object"){const s=u.$name||"Object";if(!qo[s])throw new Error(`can't deserialize unregistered class ${s}`);const{klass:h}=qo[s];if(!h)throw new Error(`can't deserialize unregistered class ${s}`);if(h.deserialize)return h.deserialize(u);const m=Object.create(h.prototype);for(const v of Object.keys(u)){if(v==="$name")continue;const S=u[v];m[v]=qo[s].shallow.indexOf(v)>=0?S:da(S)}return m}throw new Error("can't deserialize object of type "+typeof u)}class lf{constructor(){this.first=!0}update(s,h){const m=Math.floor(s);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=s,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=h),s!==this.lastZoom&&(this.lastZoom=s,this.lastFloorZoom=m,!0))}}const Vt={"Latin-1 Supplement":u=>u>=128&&u<=255,Arabic:u=>u>=1536&&u<=1791,"Arabic Supplement":u=>u>=1872&&u<=1919,"Arabic Extended-A":u=>u>=2208&&u<=2303,"Hangul Jamo":u=>u>=4352&&u<=4607,"Unified Canadian Aboriginal Syllabics":u=>u>=5120&&u<=5759,Khmer:u=>u>=6016&&u<=6143,"Unified Canadian Aboriginal Syllabics Extended":u=>u>=6320&&u<=6399,"General Punctuation":u=>u>=8192&&u<=8303,"Letterlike Symbols":u=>u>=8448&&u<=8527,"Number Forms":u=>u>=8528&&u<=8591,"Miscellaneous Technical":u=>u>=8960&&u<=9215,"Control Pictures":u=>u>=9216&&u<=9279,"Optical Character Recognition":u=>u>=9280&&u<=9311,"Enclosed Alphanumerics":u=>u>=9312&&u<=9471,"Geometric Shapes":u=>u>=9632&&u<=9727,"Miscellaneous Symbols":u=>u>=9728&&u<=9983,"Miscellaneous Symbols and Arrows":u=>u>=11008&&u<=11263,"CJK Radicals Supplement":u=>u>=11904&&u<=12031,"Kangxi Radicals":u=>u>=12032&&u<=12255,"Ideographic Description Characters":u=>u>=12272&&u<=12287,"CJK Symbols and Punctuation":u=>u>=12288&&u<=12351,Hiragana:u=>u>=12352&&u<=12447,Katakana:u=>u>=12448&&u<=12543,Bopomofo:u=>u>=12544&&u<=12591,"Hangul Compatibility Jamo":u=>u>=12592&&u<=12687,Kanbun:u=>u>=12688&&u<=12703,"Bopomofo Extended":u=>u>=12704&&u<=12735,"CJK Strokes":u=>u>=12736&&u<=12783,"Katakana Phonetic Extensions":u=>u>=12784&&u<=12799,"Enclosed CJK Letters and Months":u=>u>=12800&&u<=13055,"CJK Compatibility":u=>u>=13056&&u<=13311,"CJK Unified Ideographs Extension A":u=>u>=13312&&u<=19903,"Yijing Hexagram Symbols":u=>u>=19904&&u<=19967,"CJK Unified Ideographs":u=>u>=19968&&u<=40959,"Yi Syllables":u=>u>=40960&&u<=42127,"Yi Radicals":u=>u>=42128&&u<=42191,"Hangul Jamo Extended-A":u=>u>=43360&&u<=43391,"Hangul Syllables":u=>u>=44032&&u<=55215,"Hangul Jamo Extended-B":u=>u>=55216&&u<=55295,"Private Use Area":u=>u>=57344&&u<=63743,"CJK Compatibility Ideographs":u=>u>=63744&&u<=64255,"Arabic Presentation Forms-A":u=>u>=64336&&u<=65023,"Vertical Forms":u=>u>=65040&&u<=65055,"CJK Compatibility Forms":u=>u>=65072&&u<=65103,"Small Form Variants":u=>u>=65104&&u<=65135,"Arabic Presentation Forms-B":u=>u>=65136&&u<=65279,"Halfwidth and Fullwidth Forms":u=>u>=65280&&u<=65519};function pa(u){for(const s of u)if(Jl(s.charCodeAt(0)))return!0;return!1}function cf(u){for(const s of u)if(!uf(s.charCodeAt(0)))return!1;return!0}function uf(u){return!(Vt.Arabic(u)||Vt["Arabic Supplement"](u)||Vt["Arabic Extended-A"](u)||Vt["Arabic Presentation Forms-A"](u)||Vt["Arabic Presentation Forms-B"](u))}function Jl(u){return!(u!==746&&u!==747&&(u<4352||!(Vt["Bopomofo Extended"](u)||Vt.Bopomofo(u)||Vt["CJK Compatibility Forms"](u)&&!(u>=65097&&u<=65103)||Vt["CJK Compatibility Ideographs"](u)||Vt["CJK Compatibility"](u)||Vt["CJK Radicals Supplement"](u)||Vt["CJK Strokes"](u)||!(!Vt["CJK Symbols and Punctuation"](u)||u>=12296&&u<=12305||u>=12308&&u<=12319||u===12336)||Vt["CJK Unified Ideographs Extension A"](u)||Vt["CJK Unified Ideographs"](u)||Vt["Enclosed CJK Letters and Months"](u)||Vt["Hangul Compatibility Jamo"](u)||Vt["Hangul Jamo Extended-A"](u)||Vt["Hangul Jamo Extended-B"](u)||Vt["Hangul Jamo"](u)||Vt["Hangul Syllables"](u)||Vt.Hiragana(u)||Vt["Ideographic Description Characters"](u)||Vt.Kanbun(u)||Vt["Kangxi Radicals"](u)||Vt["Katakana Phonetic Extensions"](u)||Vt.Katakana(u)&&u!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](u)||u===65288||u===65289||u===65293||u>=65306&&u<=65310||u===65339||u===65341||u===65343||u>=65371&&u<=65503||u===65507||u>=65512&&u<=65519)||!(!Vt["Small Form Variants"](u)||u>=65112&&u<=65118||u>=65123&&u<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](u)||Vt["Unified Canadian Aboriginal Syllabics Extended"](u)||Vt["Vertical Forms"](u)||Vt["Yijing Hexagram Symbols"](u)||Vt["Yi Syllables"](u)||Vt["Yi Radicals"](u))))}function au(u){return!(Jl(u)||function(s){return!!(Vt["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||Vt["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||Vt["Letterlike Symbols"](s)||Vt["Number Forms"](s)||Vt["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||Vt["Control Pictures"](s)&&s!==9251||Vt["Optical Character Recognition"](s)||Vt["Enclosed Alphanumerics"](s)||Vt["Geometric Shapes"](s)||Vt["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||Vt["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||Vt["CJK Symbols and Punctuation"](s)||Vt.Katakana(s)||Vt["Private Use Area"](s)||Vt["CJK Compatibility Forms"](s)||Vt["Small Form Variants"](s)||Vt["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(u))}function Yl(u){return u>=1424&&u<=2303||Vt["Arabic Presentation Forms-A"](u)||Vt["Arabic Presentation Forms-B"](u)}function hf(u,s){return!(!s&&Yl(u)||u>=2304&&u<=3583||u>=3840&&u<=4255||Vt.Khmer(u))}function Jd(u){for(const s of u)if(Yl(s.charCodeAt(0)))return!0;return!1}const ws=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(u){this.pluginStatus=u.pluginStatus,this.pluginURL=u.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(u){this.applyArabicShaping=u.applyArabicShaping,this.processBidirectionalText=u.processBidirectionalText,this.processStyledBidirectionalText=u.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Sr{constructor(s,h){this.zoom=s,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new lf,this.transition={})}isSupportedScript(s){return function(h,m){for(const v of h)if(!hf(v.charCodeAt(0),m))return!1;return!0}(s,ws.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const s=this.zoom,h=s-Math.floor(s),m=this.crossFadingFactor();return s>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*h}}}class el{constructor(s,h){this.property=s,this.value=h,this.expression=function(m,v){if(Ol(m))return new jl(m,v);if(fr(m)){const S=Xh(m,v);if(S.result==="error")throw new Error(S.value.map(C=>`${C.key}: ${C.message}`).join(", "));return S.value}{let S=m;return v.type==="color"&&typeof m=="string"?S=ir.parse(m):v.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(S=ho.parse(m)):S=$i.parse(m),{kind:"constant",evaluate:()=>S}}}(h===void 0?s.specification.default:h,s.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,h,m){return this.property.possiblyEvaluate(this,s,h,m)}}class Ql{constructor(s){this.property=s,this.value=new el(s,void 0)}transitioned(s,h){return new ff(this.property,this.value,h,J({},s.transition,this.transition),s.now)}untransitioned(){return new ff(this.property,this.value,null,{},0)}}class lu{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues)}getValue(s){return Q(this._values[s].value.value)}setValue(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Ql(this._values[s].property)),this._values[s].value=new el(this._values[s].property,h===null?void 0:Q(h))}getTransition(s){return Q(this._values[s].transition)}setTransition(s,h){Object.prototype.hasOwnProperty.call(this._values,s)||(this._values[s]=new Ql(this._values[s].property)),this._values[s].transition=Q(h)||void 0}serialize(){const s={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(s[h]=m);const v=this.getTransition(h);v!==void 0&&(s[`${h}-transition`]=v)}return s}transitioned(s,h){const m=new df(this._properties);for(const v of Object.keys(this._values))m._values[v]=this._values[v].transitioned(s,h._values[v]);return m}untransitioned(){const s=new df(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].untransitioned();return s}}class ff{constructor(s,h,m,v,S){this.property=s,this.value=h,this.begin=S+v.delay||0,this.end=this.begin+v.duration||0,s.specification.transition&&(v.delay||v.duration)&&(this.prior=m)}possiblyEvaluate(s,h,m){const v=s.now||0,S=this.value.possiblyEvaluate(s,h,m),C=this.prior;if(C){if(v>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(v<this.begin)return C.possiblyEvaluate(s,h,m);{const L=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(C.possiblyEvaluate(s,h,m),S,function(P){if(P<=0)return 0;if(P>=1)return 1;const O=P*P,H=O*P;return 4*(P<.5?H:3*(P-O)+H-.75)}(L))}}return S}}class df{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,h,m){const v=new tl(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(s,h,m);return v}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class pf{constructor(s){this._properties=s,this._values=Object.create(s.defaultPropertyValues)}hasValue(s){return this._values[s].value!==void 0}getValue(s){return Q(this._values[s].value)}setValue(s,h){this._values[s]=new el(this._values[s].property,h===null?void 0:Q(h))}serialize(){const s={};for(const h of Object.keys(this._values)){const m=this.getValue(h);m!==void 0&&(s[h]=m)}return s}possiblyEvaluate(s,h,m){const v=new tl(this._properties);for(const S of Object.keys(this._values))v._values[S]=this._values[S].possiblyEvaluate(s,h,m);return v}}class xo{constructor(s,h,m){this.property=s,this.value=h,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,h,m,v){return this.property.evaluate(this.value,this.parameters,s,h,m,v)}}class tl{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class on{constructor(s){this.specification=s}possiblyEvaluate(s,h){if(s.isDataDriven())throw new Error("Value should not be data driven");return s.expression.evaluate(h)}interpolate(s,h,m){const v=Mi[this.specification.type];return v?v(s,h,m):s}}class un{constructor(s,h){this.specification=s,this.overrides=h}possiblyEvaluate(s,h,m,v){return new xo(this,s.expression.kind==="constant"||s.expression.kind==="camera"?{kind:"constant",value:s.expression.evaluate(h,null,{},m,v)}:s.expression,h)}interpolate(s,h,m){if(s.value.kind!=="constant"||h.value.kind!=="constant")return s;if(s.value.value===void 0||h.value.value===void 0)return new xo(this,{kind:"constant",value:void 0},s.parameters);const v=Mi[this.specification.type];if(v){const S=v(s.value.value,h.value.value,m);return new xo(this,{kind:"constant",value:S},s.parameters)}return s}evaluate(s,h,m,v,S,C){return s.kind==="constant"?s.value:s.evaluate(h,m,v,S,C)}}class ec extends un{possiblyEvaluate(s,h,m,v){if(s.value===void 0)return new xo(this,{kind:"constant",value:void 0},h);if(s.expression.kind==="constant"){const S=s.expression.evaluate(h,null,{},m,v),C=s.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,L=this._calculate(C,C,C,h);return new xo(this,{kind:"constant",value:L},h)}if(s.expression.kind==="camera"){const S=this._calculate(s.expression.evaluate({zoom:h.zoom-1}),s.expression.evaluate({zoom:h.zoom}),s.expression.evaluate({zoom:h.zoom+1}),h);return new xo(this,{kind:"constant",value:S},h)}return new xo(this,s.expression,h)}evaluate(s,h,m,v,S,C){if(s.kind==="source"){const L=s.evaluate(h,m,v,S,C);return this._calculate(L,L,L,h)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(h.zoom)-1},m,v),s.evaluate({zoom:Math.floor(h.zoom)},m,v),s.evaluate({zoom:Math.floor(h.zoom)+1},m,v),h):s.value}_calculate(s,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}}interpolate(s){return s}}class nl{constructor(s){this.specification=s}possiblyEvaluate(s,h,m,v){if(s.value!==void 0){if(s.expression.kind==="constant"){const S=s.expression.evaluate(h,null,{},m,v);return this._calculate(S,S,S,h)}return this._calculate(s.expression.evaluate(new Sr(Math.floor(h.zoom-1),h)),s.expression.evaluate(new Sr(Math.floor(h.zoom),h)),s.expression.evaluate(new Sr(Math.floor(h.zoom+1),h)),h)}}_calculate(s,h,m,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:s,to:h}:{from:m,to:h}}interpolate(s){return s}}class cu{constructor(s){this.specification=s}possiblyEvaluate(s,h,m,v){return!!s.expression.evaluate(h,null,{},m,v)}interpolate(){return!1}}class Fi{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in s){const m=s[h];m.specification.overridable&&this.overridableProperties.push(h);const v=this.defaultPropertyValues[h]=new el(m,void 0),S=this.defaultTransitionablePropertyValues[h]=new Ql(m);this.defaultTransitioningPropertyValues[h]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=v.possiblyEvaluate({})}}}Ht("DataDrivenProperty",un),Ht("DataConstantProperty",on),Ht("CrossFadedDataDrivenProperty",ec),Ht("CrossFadedProperty",nl),Ht("ColorRampProperty",cu);const uu="-transition";class ko extends Ut{constructor(s,h){if(super(),this.id=s.id,this.type=s.type,this._featureFilter={filter:()=>!0,needGeometry:!1},s.type!=="custom"&&(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),h.layout&&(this._unevaluatedLayout=new pf(h.layout)),h.paint)){this._transitionablePaint=new lu(h.paint);for(const m in s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(const m in s.layout)this.setLayoutProperty(m,s.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new tl(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,h,m={}){h!=null&&this._validate(Xd,`layers.${this.id}.layout.${s}`,s,h,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,h):this.visibility=h)}getPaintProperty(s){return s.endsWith(uu)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}setPaintProperty(s,h,m={}){if(h!=null&&this._validate(su,`layers.${this.id}.paint.${s}`,s,h,m))return!1;if(s.endsWith(uu))return this._transitionablePaint.setTransition(s.slice(0,-11),h||void 0),!1;{const v=this._transitionablePaint._values[s],S=v.property.specification["property-type"]==="cross-faded-data-driven",C=v.value.isDataDriven(),L=v.value;this._transitionablePaint.setValue(s,h),this._handleSpecialPaintPropertyUpdate(s);const P=this._transitionablePaint._values[s].value;return P.isDataDriven()||C||S||this._handleOverridablePaintPropertyUpdate(s,L,P)}}_handleSpecialPaintPropertyUpdate(s){}_handleOverridablePaintPropertyUpdate(s,h,m){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,h){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,h)}serialize(){const s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),Ie(s,(h,m)=>!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length))}_validate(s,h,m,v,S={}){return(!S||S.validate!==!1)&&ha(this,s.call(Ds,{key:h,layerType:this.type,objectKey:m,value:v,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const s in this.paint._values){const h=this.paint.get(s);if(h instanceof xo&&la(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const mf={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class rl{constructor(s,h){this._structArray=s,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(s,h){return s._trim(),h&&(s.isTransferred=!0,h.push(s.arrayBuffer)),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const h=Object.create(this.prototype);return h.arrayBuffer=s.arrayBuffer,h.length=s.length,h.capacity=s.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ur(u,s=1){let h=0,m=0;return{members:u.map(v=>{const S=mf[v.type].BYTES_PER_ELEMENT,C=h=gf(h,Math.max(s,S)),L=v.components||1;return m=Math.max(m,S),h+=S*L,{name:v.name,type:v.type,components:L,offset:C}}),size:gf(h,Math.max(m,s)),alignment:s}}function gf(u,s){return Math.ceil(u/s)*s}class il extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.int16[v+0]=h,this.int16[v+1]=m,s}}il.prototype.bytesPerElement=4,Ht("StructArrayLayout2i4",il);class ns extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=v,s}}ns.prototype.bytesPerElement=6,Ht("StructArrayLayout3i6",ns);class hu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const C=4*s;return this.int16[C+0]=h,this.int16[C+1]=m,this.int16[C+2]=v,this.int16[C+3]=S,s}}hu.prototype.bytesPerElement=8,Ht("StructArrayLayout4i8",hu);class fu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,v,S,C)}emplace(s,h,m,v,S,C,L){const P=6*s;return this.int16[P+0]=h,this.int16[P+1]=m,this.int16[P+2]=v,this.int16[P+3]=S,this.int16[P+4]=C,this.int16[P+5]=L,s}}fu.prototype.bytesPerElement=12,Ht("StructArrayLayout2i4i12",fu);class du extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,v,S,C)}emplace(s,h,m,v,S,C,L){const P=4*s,O=8*s;return this.int16[P+0]=h,this.int16[P+1]=m,this.uint8[O+4]=v,this.uint8[O+5]=S,this.uint8[O+6]=C,this.uint8[O+7]=L,s}}du.prototype.bytesPerElement=8,Ht("StructArrayLayout2i4ub8",du);class ol extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.float32[v+0]=h,this.float32[v+1]=m,s}}ol.prototype.bytesPerElement=8,Ht("StructArrayLayout2f8",ol);class tc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,P,O,H){const K=this.length;return this.resize(K+1),this.emplace(K,s,h,m,v,S,C,L,P,O,H)}emplace(s,h,m,v,S,C,L,P,O,H,K){const re=10*s;return this.uint16[re+0]=h,this.uint16[re+1]=m,this.uint16[re+2]=v,this.uint16[re+3]=S,this.uint16[re+4]=C,this.uint16[re+5]=L,this.uint16[re+6]=P,this.uint16[re+7]=O,this.uint16[re+8]=H,this.uint16[re+9]=K,s}}tc.prototype.bytesPerElement=20,Ht("StructArrayLayout10ui20",tc);class pu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,P,O,H,K,re){const ue=this.length;return this.resize(ue+1),this.emplace(ue,s,h,m,v,S,C,L,P,O,H,K,re)}emplace(s,h,m,v,S,C,L,P,O,H,K,re,ue){const me=12*s;return this.int16[me+0]=h,this.int16[me+1]=m,this.int16[me+2]=v,this.int16[me+3]=S,this.uint16[me+4]=C,this.uint16[me+5]=L,this.uint16[me+6]=P,this.uint16[me+7]=O,this.int16[me+8]=H,this.int16[me+9]=K,this.int16[me+10]=re,this.int16[me+11]=ue,s}}pu.prototype.bytesPerElement=24,Ht("StructArrayLayout4i4ui4i24",pu);class mu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=v,s}}mu.prototype.bytesPerElement=12,Ht("StructArrayLayout3f12",mu);class rs extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint32[1*s+0]=h,s}}rs.prototype.bytesPerElement=4,Ht("StructArrayLayout1ul4",rs);class nc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,P,O){const H=this.length;return this.resize(H+1),this.emplace(H,s,h,m,v,S,C,L,P,O)}emplace(s,h,m,v,S,C,L,P,O,H){const K=10*s,re=5*s;return this.int16[K+0]=h,this.int16[K+1]=m,this.int16[K+2]=v,this.int16[K+3]=S,this.int16[K+4]=C,this.int16[K+5]=L,this.uint32[re+3]=P,this.uint16[K+8]=O,this.uint16[K+9]=H,s}}nc.prototype.bytesPerElement=20,Ht("StructArrayLayout6i1ul2ui20",nc);class sl extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C){const L=this.length;return this.resize(L+1),this.emplace(L,s,h,m,v,S,C)}emplace(s,h,m,v,S,C,L){const P=6*s;return this.int16[P+0]=h,this.int16[P+1]=m,this.int16[P+2]=v,this.int16[P+3]=S,this.int16[P+4]=C,this.int16[P+5]=L,s}}sl.prototype.bytesPerElement=12,Ht("StructArrayLayout2i2i2i12",sl);class rc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S){const C=this.length;return this.resize(C+1),this.emplace(C,s,h,m,v,S)}emplace(s,h,m,v,S,C){const L=4*s,P=8*s;return this.float32[L+0]=h,this.float32[L+1]=m,this.float32[L+2]=v,this.int16[P+6]=S,this.int16[P+7]=C,s}}rc.prototype.bytesPerElement=16,Ht("StructArrayLayout2f1f2i16",rc);class al extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const C=12*s,L=3*s;return this.uint8[C+0]=h,this.uint8[C+1]=m,this.float32[L+1]=v,this.float32[L+2]=S,s}}al.prototype.bytesPerElement=12,Ht("StructArrayLayout2ub2f12",al);class ic extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.uint16[S+0]=h,this.uint16[S+1]=m,this.uint16[S+2]=v,s}}ic.prototype.bytesPerElement=6,Ht("StructArrayLayout3ui6",ic);class ma extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,P,O,H,K,re,ue,me,be,Te,Ae){const qe=this.length;return this.resize(qe+1),this.emplace(qe,s,h,m,v,S,C,L,P,O,H,K,re,ue,me,be,Te,Ae)}emplace(s,h,m,v,S,C,L,P,O,H,K,re,ue,me,be,Te,Ae,qe){const $e=24*s,Oe=12*s,ht=48*s;return this.int16[$e+0]=h,this.int16[$e+1]=m,this.uint16[$e+2]=v,this.uint16[$e+3]=S,this.uint32[Oe+2]=C,this.uint32[Oe+3]=L,this.uint32[Oe+4]=P,this.uint16[$e+10]=O,this.uint16[$e+11]=H,this.uint16[$e+12]=K,this.float32[Oe+7]=re,this.float32[Oe+8]=ue,this.uint8[ht+36]=me,this.uint8[ht+37]=be,this.uint8[ht+38]=Te,this.uint32[Oe+10]=Ae,this.int16[$e+22]=qe,s}}ma.prototype.bytesPerElement=48,Ht("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ma);class $s extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v,S,C,L,P,O,H,K,re,ue,me,be,Te,Ae,qe,$e,Oe,ht,ft,Zt,Yt,qt,jt,zt,Xt){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,s,h,m,v,S,C,L,P,O,H,K,re,ue,me,be,Te,Ae,qe,$e,Oe,ht,ft,Zt,Yt,qt,jt,zt,Xt)}emplace(s,h,m,v,S,C,L,P,O,H,K,re,ue,me,be,Te,Ae,qe,$e,Oe,ht,ft,Zt,Yt,qt,jt,zt,Xt,Bt){const kt=32*s,cn=16*s;return this.int16[kt+0]=h,this.int16[kt+1]=m,this.int16[kt+2]=v,this.int16[kt+3]=S,this.int16[kt+4]=C,this.int16[kt+5]=L,this.int16[kt+6]=P,this.int16[kt+7]=O,this.uint16[kt+8]=H,this.uint16[kt+9]=K,this.uint16[kt+10]=re,this.uint16[kt+11]=ue,this.uint16[kt+12]=me,this.uint16[kt+13]=be,this.uint16[kt+14]=Te,this.uint16[kt+15]=Ae,this.uint16[kt+16]=qe,this.uint16[kt+17]=$e,this.uint16[kt+18]=Oe,this.uint16[kt+19]=ht,this.uint16[kt+20]=ft,this.uint16[kt+21]=Zt,this.uint16[kt+22]=Yt,this.uint32[cn+12]=qt,this.float32[cn+13]=jt,this.float32[cn+14]=zt,this.uint16[kt+30]=Xt,this.uint16[kt+31]=Bt,s}}$s.prototype.bytesPerElement=64,Ht("StructArrayLayout8i15ui1ul2f2ui64",$s);class oc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.float32[1*s+0]=h,s}}oc.prototype.bytesPerElement=4,Ht("StructArrayLayout1f4",oc);class sc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=3*s;return this.uint16[6*s+0]=h,this.float32[S+1]=m,this.float32[S+2]=v,s}}sc.prototype.bytesPerElement=12,Ht("StructArrayLayout1ui2f12",sc);class Rs extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h,m){const v=this.length;return this.resize(v+1),this.emplace(v,s,h,m)}emplace(s,h,m,v){const S=4*s;return this.uint32[2*s+0]=h,this.uint16[S+2]=m,this.uint16[S+3]=v,s}}Rs.prototype.bytesPerElement=8,Ht("StructArrayLayout1ul2ui8",Rs);class gu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,h){const m=this.length;return this.resize(m+1),this.emplace(m,s,h)}emplace(s,h,m){const v=2*s;return this.uint16[v+0]=h,this.uint16[v+1]=m,s}}gu.prototype.bytesPerElement=4,Ht("StructArrayLayout2ui4",gu);class _u extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const h=this.length;return this.resize(h+1),this.emplace(h,s)}emplace(s,h){return this.uint16[1*s+0]=h,s}}_u.prototype.bytesPerElement=2,Ht("StructArrayLayout1ui2",_u);class ac extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,h,m,v){const S=this.length;return this.resize(S+1),this.emplace(S,s,h,m,v)}emplace(s,h,m,v,S){const C=4*s;return this.float32[C+0]=h,this.float32[C+1]=m,this.float32[C+2]=v,this.float32[C+3]=S,s}}ac.prototype.bytesPerElement=16,Ht("StructArrayLayout4f16",ac);class _f extends rl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new y(this.anchorPointX,this.anchorPointY)}}_f.prototype.size=20;class x extends nc{get(s){return new _f(this,s)}}Ht("CollisionBoxArray",x);class l extends rl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(s){this._structArray.uint8[this._pos1+37]=s}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(s){this._structArray.uint8[this._pos1+38]=s}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(s){this._structArray.uint32[this._pos4+10]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class f extends ma{get(s){return new l(this,s)}}Ht("PlacedSymbolArray",f);class g extends rl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(s){this._structArray.uint32[this._pos4+12]=s}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}g.prototype.size=64;class b extends $s{get(s){return new g(this,s)}}Ht("SymbolInstanceArray",b);class k extends oc{getoffsetX(s){return this.float32[1*s+0]}}Ht("GlyphOffsetArray",k);class E extends ns{getx(s){return this.int16[3*s+0]}gety(s){return this.int16[3*s+1]}gettileUnitDistanceFromAnchor(s){return this.int16[3*s+2]}}Ht("SymbolLineVertexArray",E);class A extends rl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}A.prototype.size=12;class B extends sc{get(s){return new A(this,s)}}Ht("TextAnchorOffsetArray",B);class G extends rl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}G.prototype.size=8;class X extends Rs{get(s){return new G(this,s)}}Ht("FeatureIndexArray",X);class Y extends il{}class de extends il{}class Se extends il{}class ke extends fu{}class Me extends du{}class ye extends ol{}class Re extends tc{}class Je extends pu{}class Le extends mu{}class je extends rs{}class Qe extends sl{}class rt extends al{}class ot extends ic{}class _t extends gu{}const pt=Ur([{name:"a_pos",components:2,type:"Int16"}],4),{members:At}=pt;class Dt{constructor(s=[]){this.segments=s}prepareSegment(s,h,m,v){let S=this.segments[this.segments.length-1];return s>Dt.MAX_VERTEX_ARRAY_LENGTH&&Pe(`Max vertices per segment is ${Dt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!S||S.vertexLength+s>Dt.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==v)&&(S={vertexOffset:h.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},v!==void 0&&(S.sortKey=v),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const s of this.segments)for(const h in s.vaos)s.vaos[h].destroy()}static simpleSegment(s,h,m,v){return new Dt([{vertexOffset:s,primitiveOffset:h,vertexLength:m,primitiveLength:v,vaos:{},sortKey:0}])}}function bn(u,s){return 256*(u=W(Math.floor(u),0,255))+W(Math.floor(s),0,255)}Dt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ht("SegmentVector",Dt);const Ft=Ur([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var pn={exports:{}},vn={exports:{}};vn.exports=function(u,s){var h,m,v,S,C,L,P,O;for(m=u.length-(h=3&u.length),v=s,C=3432918353,L=461845907,O=0;O<m;)P=255&u.charCodeAt(O)|(255&u.charCodeAt(++O))<<8|(255&u.charCodeAt(++O))<<16|(255&u.charCodeAt(++O))<<24,++O,v=27492+(65535&(S=5*(65535&(v=(v^=P=(65535&(P=(P=(65535&P)*C+(((P>>>16)*C&65535)<<16)&4294967295)<<15|P>>>17))*L+(((P>>>16)*L&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(P=0,h){case 3:P^=(255&u.charCodeAt(O+2))<<16;case 2:P^=(255&u.charCodeAt(O+1))<<8;case 1:v^=P=(65535&(P=(P=(65535&(P^=255&u.charCodeAt(O)))*C+(((P>>>16)*C&65535)<<16)&4294967295)<<15|P>>>17))*L+(((P>>>16)*L&65535)<<16)&4294967295}return v^=u.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var Zn=vn.exports,_n={exports:{}};_n.exports=function(u,s){for(var h,m=u.length,v=s^m,S=0;m>=4;)h=1540483477*(65535&(h=255&u.charCodeAt(S)|(255&u.charCodeAt(++S))<<8|(255&u.charCodeAt(++S))<<16|(255&u.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++S;switch(m){case 3:v^=(255&u.charCodeAt(S+2))<<16;case 2:v^=(255&u.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&u.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var Sn=Zn,zn=_n.exports;pn.exports=Sn,pn.exports.murmur3=Sn,pn.exports.murmur2=zn;var $r=d(pn.exports);class sr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(s,h,m,v){this.ids.push(Yi(s)),this.positions.push(h,m,v)}getPositions(s){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=Yi(s);let m=0,v=this.ids.length-1;for(;m<v;){const C=m+v>>1;this.ids[C]>=h?v=C:m=C+1}const S=[];for(;this.ids[m]===h;)S.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return S}static serialize(s,h){const m=new Float64Array(s.ids),v=new Uint32Array(s.positions);return ni(m,v,0,m.length-1),h&&h.push(m.buffer,v.buffer),{ids:m,positions:v}}static deserialize(s){const h=new sr;return h.ids=s.ids,h.positions=s.positions,h.indexed=!0,h}}function Yi(u){const s=+u;return!isNaN(s)&&s<=Number.MAX_SAFE_INTEGER?s:$r(String(u))}function ni(u,s,h,m){for(;h<m;){const v=u[h+m>>1];let S=h-1,C=m+1;for(;;){do S++;while(u[S]<v);do C--;while(u[C]>v);if(S>=C)break;Lr(u,S,C),Lr(s,3*S,3*C),Lr(s,3*S+1,3*C+1),Lr(s,3*S+2,3*C+2)}C-h<m-C?(ni(u,s,h,C),h=C+1):(ni(u,s,C+1,m),m=C)}}function Lr(u,s,h){const m=u[s];u[s]=u[h],u[h]=m}Ht("FeaturePositionMap",sr);class ri{constructor(s,h){this.gl=s.gl,this.location=h}}class Qi extends ri{constructor(s,h){super(s,h),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Zo extends ri{constructor(s,h){super(s,h),this.current=[0,0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))}}class xs extends ri{constructor(s,h){super(s,h),this.current=ir.transparent}set(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))}}const ll=new Float32Array(16);function ks(u){return[bn(255*u.r,255*u.g),bn(255*u.b,255*u.a)]}class Go{constructor(s,h,m){this.value=s,this.uniformNames=h.map(v=>`u_${v}`),this.type=m}setUniform(s,h,m){s.set(m.constantOr(this.value))}getBinding(s,h,m){return this.type==="color"?new xs(s,h):new Qi(s,h)}}class Gr{constructor(s,h){this.uniformNames=h.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(s,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=s.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=s.tlbr}setUniform(s,h,m,v){const S=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&s.set(S)}getBinding(s,h,m){return m.substr(0,9)==="u_pattern"?new Zo(s,h):new Qi(s,h)}}class Er{constructor(s,h,m,v){this.expression=s,this.type=m,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(s,h,m,v,S){const C=this.paintVertexArray.length,L=this.expression.evaluate(new Sr(0),h,{},v,[],S);this.paintVertexArray.resize(s),this._setPaintValue(C,s,L)}updatePaintArray(s,h,m,v){const S=this.expression.evaluate({zoom:0},m,v);this._setPaintValue(s,h,S)}_setPaintValue(s,h,m){if(this.type==="color"){const v=ks(m);for(let S=s;S<h;S++)this.paintVertexArray.emplace(S,v[0],v[1])}else{for(let v=s;v<h;v++)this.paintVertexArray.emplace(v,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cr{constructor(s,h,m,v,S,C){this.expression=s,this.uniformNames=h.map(L=>`u_${L}_t`),this.type=m,this.useIntegerZoom=v,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=h.map(L=>({name:`a_${L}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new C}populatePaintArray(s,h,m,v,S){const C=this.expression.evaluate(new Sr(this.zoom),h,{},v,[],S),L=this.expression.evaluate(new Sr(this.zoom+1),h,{},v,[],S),P=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(P,s,C,L)}updatePaintArray(s,h,m,v){const S=this.expression.evaluate({zoom:this.zoom},m,v),C=this.expression.evaluate({zoom:this.zoom+1},m,v);this._setPaintValue(s,h,S,C)}_setPaintValue(s,h,m,v){if(this.type==="color"){const S=ks(m),C=ks(v);for(let L=s;L<h;L++)this.paintVertexArray.emplace(L,S[0],S[1],C[0],C[1])}else{for(let S=s;S<h;S++)this.paintVertexArray.emplace(S,m,v);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(v))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,h){const m=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,v=W(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);s.set(v)}getBinding(s,h,m){return new Qi(s,h)}}class po{constructor(s,h,m,v,S,C){this.expression=s,this.type=h,this.useIntegerZoom=m,this.zoom=v,this.layerId=C,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(s,h,m){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(s),this.zoomOutPaintVertexArray.resize(s),this._setPaintValues(v,s,h.patterns&&h.patterns[this.layerId],m)}updatePaintArray(s,h,m,v,S){this._setPaintValues(s,h,m.patterns&&m.patterns[this.layerId],S)}_setPaintValues(s,h,m,v){if(!v||!m)return;const{min:S,mid:C,max:L}=m,P=v[S],O=v[C],H=v[L];if(P&&O&&H)for(let K=s;K<h;K++)this.zoomInPaintVertexArray.emplace(K,O.tl[0],O.tl[1],O.br[0],O.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],O.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(K,O.tl[0],O.tl[1],O.br[0],O.br[1],H.tl[0],H.tl[1],H.br[0],H.br[1],O.pixelRatio,H.pixelRatio)}upload(s){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=s.createVertexBuffer(this.zoomInPaintVertexArray,Ft.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=s.createVertexBuffer(this.zoomOutPaintVertexArray,Ft.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Hr{constructor(s,h,m){this.binders={},this._buffers=[];const v=[];for(const S in s.paint._values){if(!m(S))continue;const C=s.paint.get(S);if(!(C instanceof xo&&la(C.property.specification)))continue;const L=mo(S,s.type),P=C.value,O=C.property.specification.type,H=C.property.useIntegerZoom,K=C.property.specification["property-type"],re=K==="cross-faded"||K==="cross-faded-data-driven";if(P.kind==="constant")this.binders[S]=re?new Gr(P.value,L):new Go(P.value,L,O),v.push(`/u_${S}`);else if(P.kind==="source"||re){const ue=Wr(S,O,"source");this.binders[S]=re?new po(P,O,H,h,ue,s.id):new Er(P,L,O,ue),v.push(`/a_${S}`)}else{const ue=Wr(S,O,"composite");this.binders[S]=new Cr(P,L,O,H,h,ue),v.push(`/z_${S}`)}}this.cacheKey=v.sort().join("")}getMaxValue(s){const h=this.binders[s];return h instanceof Er||h instanceof Cr?h.maxValue:0}populatePaintArrays(s,h,m,v,S){for(const C in this.binders){const L=this.binders[C];(L instanceof Er||L instanceof Cr||L instanceof po)&&L.populatePaintArray(s,h,m,v,S)}}setConstantPatternPositions(s,h){for(const m in this.binders){const v=this.binders[m];v instanceof Gr&&v.setConstantPatternPositions(s,h)}}updatePaintArrays(s,h,m,v,S){let C=!1;for(const L in s){const P=h.getPositions(L);for(const O of P){const H=m.feature(O.index);for(const K in this.binders){const re=this.binders[K];if((re instanceof Er||re instanceof Cr||re instanceof po)&&re.expression.isStateDependent===!0){const ue=v.paint.get(K);re.expression=ue.value,re.updatePaintArray(O.start,O.end,H,s[L],S),C=!0}}}}return C}defines(){const s=[];for(const h in this.binders){const m=this.binders[h];(m instanceof Go||m instanceof Gr)&&s.push(...m.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return s}getBinderAttributes(){const s=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Er||m instanceof Cr)for(let v=0;v<m.paintVertexAttributes.length;v++)s.push(m.paintVertexAttributes[v].name);else if(m instanceof po)for(let v=0;v<Ft.members.length;v++)s.push(Ft.members[v].name)}return s}getBinderUniforms(){const s=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof Go||m instanceof Gr||m instanceof Cr)for(const v of m.uniformNames)s.push(v)}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s,h){const m=[];for(const v in this.binders){const S=this.binders[v];if(S instanceof Go||S instanceof Gr||S instanceof Cr){for(const C of S.uniformNames)if(h[C]){const L=S.getBinding(s,h[C],C);m.push({name:C,property:v,binding:L})}}}return m}setUniforms(s,h,m,v){for(const{name:S,property:C,binding:L}of h)this.binders[C].setUniform(L,v,m.get(C),S)}updatePaintBuffers(s){this._buffers=[];for(const h in this.binders){const m=this.binders[h];if(s&&m instanceof po){const v=s.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(m instanceof Er||m instanceof Cr)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(s){for(const h in this.binders){const m=this.binders[h];(m instanceof Er||m instanceof Cr||m instanceof po)&&m.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const h=this.binders[s];(h instanceof Er||h instanceof Cr||h instanceof po)&&h.destroy()}}}class Ir{constructor(s,h,m=()=>!0){this.programConfigurations={};for(const v of s)this.programConfigurations[v.id]=new Hr(v,h,m);this.needsUpload=!1,this._featureMap=new sr,this._bufferOffset=0}populatePaintArrays(s,h,m,v,S,C){for(const L in this.programConfigurations)this.programConfigurations[L].populatePaintArrays(s,h,v,S,C);h.id!==void 0&&this._featureMap.add(h.id,m,this._bufferOffset,s),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,h,m,v){for(const S of m)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(s,this._featureMap,h,S,v)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}function mo(u,s){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[u]||[u.replace(`${s}-`,"").replace(/-/g,"_")]}function Wr(u,s,h){const m={color:{source:ol,composite:ac},number:{source:oc,composite:ol}},v=function(S){return{"line-pattern":{source:Re,composite:Re},"fill-pattern":{source:Re,composite:Re},"fill-extrusion-pattern":{source:Re,composite:Re}}[S]}(u);return v&&v[h]||m[s][h]}Ht("ConstantBinder",Go),Ht("CrossFadedConstantBinder",Gr),Ht("SourceExpressionBinder",Er),Ht("CrossFadedCompositeBinder",po),Ht("CompositeExpressionBinder",Cr),Ht("ProgramConfiguration",Hr,{omit:["_buffers"]}),Ht("ProgramConfigurationSet",Ir);const Or=8192,yu=Math.pow(2,14)-1,yf=-yu-1;function Fs(u){const s=Or/u.extent,h=u.loadGeometry();for(let m=0;m<h.length;m++){const v=h[m];for(let S=0;S<v.length;S++){const C=v[S],L=Math.round(C.x*s),P=Math.round(C.y*s);C.x=W(L,yf,yu),C.y=W(P,yf,yu),(L<C.x||L>C.x+1||P<C.y||P>C.y+1)&&Pe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function Bs(u,s){return{type:u.type,id:u.id,properties:u.properties,geometry:s?Fs(u):[]}}function lc(u,s,h,m,v){u.emplaceBack(2*s+(m+1)/2,2*h+(v+1)/2)}class Ss{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new de,this.indexArray=new ot,this.segments=new Dt,this.programConfigurations=new Ir(s.layers,s.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){const v=this.layers[0],S=[];let C=null,L=!1;v.type==="circle"&&(C=v.layout.get("circle-sort-key"),L=!C.isConstant());for(const{feature:P,id:O,index:H,sourceLayerIndex:K}of s){const re=this.layers[0]._featureFilter.needGeometry,ue=Bs(P,re);if(!this.layers[0]._featureFilter.filter(new Sr(this.zoom),ue,m))continue;const me=L?C.evaluate(ue,{},m):void 0,be={id:O,properties:P.properties,type:P.type,sourceLayerIndex:K,index:H,geometry:re?ue.geometry:Fs(P),patterns:{},sortKey:me};S.push(be)}L&&S.sort((P,O)=>P.sortKey-O.sortKey);for(const P of S){const{geometry:O,index:H,sourceLayerIndex:K}=P,re=s[H].feature;this.addFeature(P,O,H,m),h.featureIndex.insert(re,O,H,K,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,At),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,h,m,v){for(const S of h)for(const C of S){const L=C.x,P=C.y;if(L<0||L>=Or||P<0||P>=Or)continue;const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),H=O.vertexLength;lc(this.layoutVertexArray,L,P,-1,-1),lc(this.layoutVertexArray,L,P,1,-1),lc(this.layoutVertexArray,L,P,1,1),lc(this.layoutVertexArray,L,P,-1,1),this.indexArray.emplaceBack(H,H+1,H+2),this.indexArray.emplaceBack(H,H+3,H+2),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,{},v)}}function bu(u,s){for(let h=0;h<u.length;h++)if(uc(s,u[h]))return!0;for(let h=0;h<s.length;h++)if(uc(u,s[h]))return!0;return!!cc(u,s)}function bf(u,s,h){return!!uc(u,s)||!!Yd(s,u,h)}function vu(u,s){if(u.length===1)return og(s,u[0]);for(let h=0;h<s.length;h++){const m=s[h];for(let v=0;v<m.length;v++)if(uc(u,m[v]))return!0}for(let h=0;h<u.length;h++)if(og(s,u[h]))return!0;for(let h=0;h<s.length;h++)if(cc(u,s[h]))return!0;return!1}function wu(u,s,h){if(u.length>1){if(cc(u,s))return!0;for(let m=0;m<s.length;m++)if(Yd(s[m],u,h))return!0}for(let m=0;m<u.length;m++)if(Yd(u[m],s,h))return!0;return!1}function cc(u,s){if(u.length===0||s.length===0)return!1;for(let h=0;h<u.length-1;h++){const m=u[h],v=u[h+1];for(let S=0;S<s.length-1;S++)if(xu(m,v,s[S],s[S+1]))return!0}return!1}function xu(u,s,h,m){return ve(u,h,m)!==ve(s,h,m)&&ve(u,s,h)!==ve(u,s,m)}function Yd(u,s,h){const m=h*h;if(s.length===1)return u.distSqr(s[0])<m;for(let v=1;v<s.length;v++)if(ig(u,s[v-1],s[v])<m)return!0;return!1}function ig(u,s,h){const m=s.distSqr(h);if(m===0)return u.distSqr(s);const v=((u.x-s.x)*(h.x-s.x)+(u.y-s.y)*(h.y-s.y))/m;return u.distSqr(v<0?s:v>1?h:h.sub(s)._mult(v)._add(s))}function og(u,s){let h,m,v,S=!1;for(let C=0;C<u.length;C++){h=u[C];for(let L=0,P=h.length-1;L<h.length;P=L++)m=h[L],v=h[P],m.y>s.y!=v.y>s.y&&s.x<(v.x-m.x)*(s.y-m.y)/(v.y-m.y)+m.x&&(S=!S)}return S}function uc(u,s){let h=!1;for(let m=0,v=u.length-1;m<u.length;v=m++){const S=u[m],C=u[v];S.y>s.y!=C.y>s.y&&s.x<(C.x-S.x)*(s.y-S.y)/(C.y-S.y)+S.x&&(h=!h)}return h}function Jv(u,s,h){const m=h[0],v=h[2];if(u.x<m.x&&s.x<m.x||u.x>v.x&&s.x>v.x||u.y<m.y&&s.y<m.y||u.y>v.y&&s.y>v.y)return!1;const S=ve(u,s,h[0]);return S!==ve(u,s,h[1])||S!==ve(u,s,h[2])||S!==ve(u,s,h[3])}function ku(u,s,h){const m=s.paint.get(u).value;return m.kind==="constant"?m.value:h.programConfigurations.get(s.id).getMaxValue(u)}function vf(u){return Math.sqrt(u[0]*u[0]+u[1]*u[1])}function wf(u,s,h,m,v){if(!s[0]&&!s[1])return u;const S=y.convert(s)._mult(v);h==="viewport"&&S._rotate(-m);const C=[];for(let L=0;L<u.length;L++)C.push(u[L].sub(S));return C}let sg,ag;Ht("CircleBucket",Ss,{omit:["layers"]});var Yv={get paint(){return ag=ag||new Fi({"circle-radius":new un(_e.paint_circle["circle-radius"]),"circle-color":new un(_e.paint_circle["circle-color"]),"circle-blur":new un(_e.paint_circle["circle-blur"]),"circle-opacity":new un(_e.paint_circle["circle-opacity"]),"circle-translate":new on(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new on(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new on(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new on(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new un(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new un(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new un(_e.paint_circle["circle-stroke-opacity"])})},get layout(){return sg=sg||new Fi({"circle-sort-key":new un(_e.layout_circle["circle-sort-key"])})}},Bi=1e-6,hc=typeof Float32Array<"u"?Float32Array:Array;function Qd(u){return u[0]=1,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=1,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=1,u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u}function lg(u,s,h){var m=s[0],v=s[1],S=s[2],C=s[3],L=s[4],P=s[5],O=s[6],H=s[7],K=s[8],re=s[9],ue=s[10],me=s[11],be=s[12],Te=s[13],Ae=s[14],qe=s[15],$e=h[0],Oe=h[1],ht=h[2],ft=h[3];return u[0]=$e*m+Oe*L+ht*K+ft*be,u[1]=$e*v+Oe*P+ht*re+ft*Te,u[2]=$e*S+Oe*O+ht*ue+ft*Ae,u[3]=$e*C+Oe*H+ht*me+ft*qe,u[4]=($e=h[4])*m+(Oe=h[5])*L+(ht=h[6])*K+(ft=h[7])*be,u[5]=$e*v+Oe*P+ht*re+ft*Te,u[6]=$e*S+Oe*O+ht*ue+ft*Ae,u[7]=$e*C+Oe*H+ht*me+ft*qe,u[8]=($e=h[8])*m+(Oe=h[9])*L+(ht=h[10])*K+(ft=h[11])*be,u[9]=$e*v+Oe*P+ht*re+ft*Te,u[10]=$e*S+Oe*O+ht*ue+ft*Ae,u[11]=$e*C+Oe*H+ht*me+ft*qe,u[12]=($e=h[12])*m+(Oe=h[13])*L+(ht=h[14])*K+(ft=h[15])*be,u[13]=$e*v+Oe*P+ht*re+ft*Te,u[14]=$e*S+Oe*O+ht*ue+ft*Ae,u[15]=$e*C+Oe*H+ht*me+ft*qe,u}Math.hypot||(Math.hypot=function(){for(var u=0,s=arguments.length;s--;)u+=arguments[s]*arguments[s];return Math.sqrt(u)});var Su,Qv=lg;function xf(u,s,h){var m=s[0],v=s[1],S=s[2],C=s[3];return u[0]=h[0]*m+h[4]*v+h[8]*S+h[12]*C,u[1]=h[1]*m+h[5]*v+h[9]*S+h[13]*C,u[2]=h[2]*m+h[6]*v+h[10]*S+h[14]*C,u[3]=h[3]*m+h[7]*v+h[11]*S+h[15]*C,u}Su=new hc(4),hc!=Float32Array&&(Su[0]=0,Su[1]=0,Su[2]=0,Su[3]=0);class ew extends ko{constructor(s){super(s,Yv)}createBucket(s){return new Ss(s)}queryRadius(s){const h=s;return ku("circle-radius",this,h)+ku("circle-stroke-width",this,h)+vf(this.paint.get("circle-translate"))}queryIntersectsFeature(s,h,m,v,S,C,L,P){const O=wf(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,L),H=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),K=this.paint.get("circle-pitch-alignment")==="map",re=K?O:function(me,be){return me.map(Te=>cg(Te,be))}(O,P),ue=K?H*L:H;for(const me of v)for(const be of me){const Te=K?be:cg(be,P);let Ae=ue;const qe=xf([],[be.x,be.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ae*=qe[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ae*=C.cameraToCenterDistance/qe[3]),bf(re,Te,Ae))return!0}return!1}}function cg(u,s){const h=xf([],[u.x,u.y,0,1],s);return new y(h[0]/h[3],h[1]/h[3])}class ug extends Ss{}let hg;Ht("HeatmapBucket",ug,{omit:["layers"]});var tw={get paint(){return hg=hg||new Fi({"heatmap-radius":new un(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new un(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new on(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new cu(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new on(_e.paint_heatmap["heatmap-opacity"])})}};function ep(u,{width:s,height:h},m,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==s*h*m)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${s*h*m}`)}else v=new Uint8Array(s*h*m);return u.width=s,u.height=h,u.data=v,u}function fg(u,{width:s,height:h},m){if(s===u.width&&h===u.height)return;const v=ep({},{width:s,height:h},m);tp(u,v,{x:0,y:0},{x:0,y:0},{width:Math.min(u.width,s),height:Math.min(u.height,h)},m),u.width=s,u.height=h,u.data=v.data}function tp(u,s,h,m,v,S){if(v.width===0||v.height===0)return s;if(v.width>u.width||v.height>u.height||h.x>u.width-v.width||h.y>u.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>s.width||v.height>s.height||m.x>s.width-v.width||m.y>s.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const C=u.data,L=s.data;if(C===L)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<v.height;P++){const O=((h.y+P)*u.width+h.x)*S,H=((m.y+P)*s.width+m.x)*S;for(let K=0;K<v.width*S;K++)L[H+K]=C[O+K]}return s}class Cu{constructor(s,h){ep(this,s,1,h)}resize(s){fg(this,s,1)}clone(){return new Cu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,m,v,S){tp(s,h,m,v,S,1)}}class So{constructor(s,h){ep(this,s,4,h)}resize(s){fg(this,s,4)}replace(s,h){h?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new So({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,h,m,v,S){tp(s,h,m,v,S,4)}}function dg(u){const s={},h=u.resolution||256,m=u.clips?u.clips.length:1,v=u.image||new So({width:h,height:m});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const S=(C,L,P)=>{s[u.evaluationKey]=P;const O=u.expression.evaluate(s);v.data[C+L+0]=Math.floor(255*O.r/O.a),v.data[C+L+1]=Math.floor(255*O.g/O.a),v.data[C+L+2]=Math.floor(255*O.b/O.a),v.data[C+L+3]=Math.floor(255*O.a)};if(u.clips)for(let C=0,L=0;C<m;++C,L+=4*h)for(let P=0,O=0;P<h;P++,O+=4){const H=P/(h-1),{start:K,end:re}=u.clips[C];S(L,O,K*(1-H)+re*H)}else for(let C=0,L=0;C<h;C++,L+=4)S(0,L,C/(h-1));return v}Ht("AlphaImage",Cu),Ht("RGBAImage",So);class nw extends ko{createBucket(s){return new ug(s)}constructor(s){super(s,tw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=dg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let pg;var rw={get paint(){return pg=pg||new Fi({"hillshade-illumination-direction":new on(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new on(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new on(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new on(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new on(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new on(_e.paint_hillshade["hillshade-accent-color"])})}};class iw extends ko{constructor(s){super(s,rw)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const ow=Ur([{name:"a_pos",components:2,type:"Int16"}],4),{members:sw}=ow;var np={exports:{}};function kf(u,s,h){h=h||2;var m,v,S,C,L,P,O,H=s&&s.length,K=H?s[0]*h:u.length,re=mg(u,0,K,h,!0),ue=[];if(!re||re.next===re.prev)return ue;if(H&&(re=function(be,Te,Ae,qe){var $e,Oe,ht,ft=[];for($e=0,Oe=Te.length;$e<Oe;$e++)(ht=mg(be,Te[$e]*qe,$e<Oe-1?Te[$e+1]*qe:be.length,qe,!1))===ht.next&&(ht.steiner=!0),ft.push(pw(ht));for(ft.sort(hw),$e=0;$e<ft.length;$e++)Ae=fw(ft[$e],Ae);return Ae}(u,s,re,h)),u.length>80*h){m=S=u[0],v=C=u[1];for(var me=h;me<K;me+=h)(L=u[me])<m&&(m=L),(P=u[me+1])<v&&(v=P),L>S&&(S=L),P>C&&(C=P);O=(O=Math.max(S-m,C-v))!==0?32767/O:0}return Tu(re,ue,h,m,v,O,0),ue}function mg(u,s,h,m,v){var S,C;if(v===op(u,s,h,m)>0)for(S=s;S<h;S+=m)C=yg(S,u[S],u[S+1],C);else for(S=h-m;S>=s;S-=m)C=yg(S,u[S],u[S+1],C);return C&&Sf(C,C.next)&&(Lu(C),C=C.next),C}function cl(u,s){if(!u)return u;s||(s=u);var h,m=u;do if(h=!1,m.steiner||!Sf(m,m.next)&&Vr(m.prev,m,m.next)!==0)m=m.next;else{if(Lu(m),(m=s=m.prev)===m.next)break;h=!0}while(h||m!==s);return s}function Tu(u,s,h,m,v,S,C){if(u){!C&&S&&function(H,K,re,ue){var me=H;do me.z===0&&(me.z=rp(me.x,me.y,K,re,ue)),me.prevZ=me.prev,me.nextZ=me.next,me=me.next;while(me!==H);me.prevZ.nextZ=null,me.prevZ=null,function(be){var Te,Ae,qe,$e,Oe,ht,ft,Zt,Yt=1;do{for(Ae=be,be=null,Oe=null,ht=0;Ae;){for(ht++,qe=Ae,ft=0,Te=0;Te<Yt&&(ft++,qe=qe.nextZ);Te++);for(Zt=Yt;ft>0||Zt>0&&qe;)ft!==0&&(Zt===0||!qe||Ae.z<=qe.z)?($e=Ae,Ae=Ae.nextZ,ft--):($e=qe,qe=qe.nextZ,Zt--),Oe?Oe.nextZ=$e:be=$e,$e.prevZ=Oe,Oe=$e;Ae=qe}Oe.nextZ=null,Yt*=2}while(ht>1)}(me)}(u,m,v,S);for(var L,P,O=u;u.prev!==u.next;)if(L=u.prev,P=u.next,S?lw(u,m,v,S):aw(u))s.push(L.i/h|0),s.push(u.i/h|0),s.push(P.i/h|0),Lu(u),u=P.next,O=P.next;else if((u=P)===O){C?C===1?Tu(u=cw(cl(u),s,h),s,h,m,v,S,2):C===2&&uw(u,s,h,m,v,S):Tu(cl(u),s,h,m,v,S,1);break}}}function aw(u){var s=u.prev,h=u,m=u.next;if(Vr(s,h,m)>=0)return!1;for(var v=s.x,S=h.x,C=m.x,L=s.y,P=h.y,O=m.y,H=v<S?v<C?v:C:S<C?S:C,K=L<P?L<O?L:O:P<O?P:O,re=v>S?v>C?v:C:S>C?S:C,ue=L>P?L>O?L:O:P>O?P:O,me=m.next;me!==s;){if(me.x>=H&&me.x<=re&&me.y>=K&&me.y<=ue&&fc(v,L,S,P,C,O,me.x,me.y)&&Vr(me.prev,me,me.next)>=0)return!1;me=me.next}return!0}function lw(u,s,h,m){var v=u.prev,S=u,C=u.next;if(Vr(v,S,C)>=0)return!1;for(var L=v.x,P=S.x,O=C.x,H=v.y,K=S.y,re=C.y,ue=L<P?L<O?L:O:P<O?P:O,me=H<K?H<re?H:re:K<re?K:re,be=L>P?L>O?L:O:P>O?P:O,Te=H>K?H>re?H:re:K>re?K:re,Ae=rp(ue,me,s,h,m),qe=rp(be,Te,s,h,m),$e=u.prevZ,Oe=u.nextZ;$e&&$e.z>=Ae&&Oe&&Oe.z<=qe;){if($e.x>=ue&&$e.x<=be&&$e.y>=me&&$e.y<=Te&&$e!==v&&$e!==C&&fc(L,H,P,K,O,re,$e.x,$e.y)&&Vr($e.prev,$e,$e.next)>=0||($e=$e.prevZ,Oe.x>=ue&&Oe.x<=be&&Oe.y>=me&&Oe.y<=Te&&Oe!==v&&Oe!==C&&fc(L,H,P,K,O,re,Oe.x,Oe.y)&&Vr(Oe.prev,Oe,Oe.next)>=0))return!1;Oe=Oe.nextZ}for(;$e&&$e.z>=Ae;){if($e.x>=ue&&$e.x<=be&&$e.y>=me&&$e.y<=Te&&$e!==v&&$e!==C&&fc(L,H,P,K,O,re,$e.x,$e.y)&&Vr($e.prev,$e,$e.next)>=0)return!1;$e=$e.prevZ}for(;Oe&&Oe.z<=qe;){if(Oe.x>=ue&&Oe.x<=be&&Oe.y>=me&&Oe.y<=Te&&Oe!==v&&Oe!==C&&fc(L,H,P,K,O,re,Oe.x,Oe.y)&&Vr(Oe.prev,Oe,Oe.next)>=0)return!1;Oe=Oe.nextZ}return!0}function cw(u,s,h){var m=u;do{var v=m.prev,S=m.next.next;!Sf(v,S)&&gg(v,m,m.next,S)&&Mu(v,S)&&Mu(S,v)&&(s.push(v.i/h|0),s.push(m.i/h|0),s.push(S.i/h|0),Lu(m),Lu(m.next),m=u=S),m=m.next}while(m!==u);return cl(m)}function uw(u,s,h,m,v,S){var C=u;do{for(var L=C.next.next;L!==C.prev;){if(C.i!==L.i&&mw(C,L)){var P=_g(C,L);return C=cl(C,C.next),P=cl(P,P.next),Tu(C,s,h,m,v,S,0),void Tu(P,s,h,m,v,S,0)}L=L.next}C=C.next}while(C!==u)}function hw(u,s){return u.x-s.x}function fw(u,s){var h=function(v,S){var C,L=S,P=v.x,O=v.y,H=-1/0;do{if(O<=L.y&&O>=L.next.y&&L.next.y!==L.y){var K=L.x+(O-L.y)*(L.next.x-L.x)/(L.next.y-L.y);if(K<=P&&K>H&&(H=K,C=L.x<L.next.x?L:L.next,K===P))return C}L=L.next}while(L!==S);if(!C)return null;var re,ue=C,me=C.x,be=C.y,Te=1/0;L=C;do P>=L.x&&L.x>=me&&P!==L.x&&fc(O<be?P:H,O,me,be,O<be?H:P,O,L.x,L.y)&&(re=Math.abs(O-L.y)/(P-L.x),Mu(L,v)&&(re<Te||re===Te&&(L.x>C.x||L.x===C.x&&dw(C,L)))&&(C=L,Te=re)),L=L.next;while(L!==ue);return C}(u,s);if(!h)return s;var m=_g(h,u);return cl(m,m.next),cl(h,h.next)}function dw(u,s){return Vr(u.prev,u,s.prev)<0&&Vr(s.next,u,u.next)<0}function rp(u,s,h,m,v){return(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=(u-h)*v|0)|u<<8))|u<<4))|u<<2))|u<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-m)*v|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function pw(u){var s=u,h=u;do(s.x<h.x||s.x===h.x&&s.y<h.y)&&(h=s),s=s.next;while(s!==u);return h}function fc(u,s,h,m,v,S,C,L){return(v-C)*(s-L)>=(u-C)*(S-L)&&(u-C)*(m-L)>=(h-C)*(s-L)&&(h-C)*(S-L)>=(v-C)*(m-L)}function mw(u,s){return u.next.i!==s.i&&u.prev.i!==s.i&&!function(h,m){var v=h;do{if(v.i!==h.i&&v.next.i!==h.i&&v.i!==m.i&&v.next.i!==m.i&&gg(v,v.next,h,m))return!0;v=v.next}while(v!==h);return!1}(u,s)&&(Mu(u,s)&&Mu(s,u)&&function(h,m){var v=h,S=!1,C=(h.x+m.x)/2,L=(h.y+m.y)/2;do v.y>L!=v.next.y>L&&v.next.y!==v.y&&C<(v.next.x-v.x)*(L-v.y)/(v.next.y-v.y)+v.x&&(S=!S),v=v.next;while(v!==h);return S}(u,s)&&(Vr(u.prev,u,s.prev)||Vr(u,s.prev,s))||Sf(u,s)&&Vr(u.prev,u,u.next)>0&&Vr(s.prev,s,s.next)>0)}function Vr(u,s,h){return(s.y-u.y)*(h.x-s.x)-(s.x-u.x)*(h.y-s.y)}function Sf(u,s){return u.x===s.x&&u.y===s.y}function gg(u,s,h,m){var v=Tf(Vr(u,s,h)),S=Tf(Vr(u,s,m)),C=Tf(Vr(h,m,u)),L=Tf(Vr(h,m,s));return v!==S&&C!==L||!(v!==0||!Cf(u,h,s))||!(S!==0||!Cf(u,m,s))||!(C!==0||!Cf(h,u,m))||!(L!==0||!Cf(h,s,m))}function Cf(u,s,h){return s.x<=Math.max(u.x,h.x)&&s.x>=Math.min(u.x,h.x)&&s.y<=Math.max(u.y,h.y)&&s.y>=Math.min(u.y,h.y)}function Tf(u){return u>0?1:u<0?-1:0}function Mu(u,s){return Vr(u.prev,u,u.next)<0?Vr(u,s,u.next)>=0&&Vr(u,u.prev,s)>=0:Vr(u,s,u.prev)<0||Vr(u,u.next,s)<0}function _g(u,s){var h=new ip(u.i,u.x,u.y),m=new ip(s.i,s.x,s.y),v=u.next,S=s.prev;return u.next=s,s.prev=u,h.next=v,v.prev=h,m.next=h,h.prev=m,S.next=m,m.prev=S,m}function yg(u,s,h,m){var v=new ip(u,s,h);return m?(v.next=m.next,v.prev=m,m.next.prev=v,m.next=v):(v.prev=v,v.next=v),v}function Lu(u){u.next.prev=u.prev,u.prev.next=u.next,u.prevZ&&(u.prevZ.nextZ=u.nextZ),u.nextZ&&(u.nextZ.prevZ=u.prevZ)}function ip(u,s,h){this.i=u,this.x=s,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function op(u,s,h,m){for(var v=0,S=s,C=h-m;S<h;S+=m)v+=(u[C]-u[S])*(u[S+1]+u[C+1]),C=S;return v}np.exports=kf,np.exports.default=kf,kf.deviation=function(u,s,h,m){var v=s&&s.length,S=Math.abs(op(u,0,v?s[0]*h:u.length,h));if(v)for(var C=0,L=s.length;C<L;C++)S-=Math.abs(op(u,s[C]*h,C<L-1?s[C+1]*h:u.length,h));var P=0;for(C=0;C<m.length;C+=3){var O=m[C]*h,H=m[C+1]*h,K=m[C+2]*h;P+=Math.abs((u[O]-u[K])*(u[H+1]-u[O+1])-(u[O]-u[H])*(u[K+1]-u[O+1]))}return S===0&&P===0?0:Math.abs((P-S)/S)},kf.flatten=function(u){for(var s=u[0][0].length,h={vertices:[],holes:[],dimensions:s},m=0,v=0;v<u.length;v++){for(var S=0;S<u[v].length;S++)for(var C=0;C<s;C++)h.vertices.push(u[v][S][C]);v>0&&h.holes.push(m+=u[v-1].length)}return h};var bg=d(np.exports);function gw(u,s,h,m,v){vg(u,s,h||0,m||u.length-1,v||_w)}function vg(u,s,h,m,v){for(;m>h;){if(m-h>600){var S=m-h+1,C=s-h+1,L=Math.log(S),P=.5*Math.exp(2*L/3),O=.5*Math.sqrt(L*P*(S-P)/S)*(C-S/2<0?-1:1);vg(u,s,Math.max(h,Math.floor(s-C*P/S+O)),Math.min(m,Math.floor(s+(S-C)*P/S+O)),v)}var H=u[s],K=h,re=m;for(Eu(u,h,s),v(u[m],H)>0&&Eu(u,h,m);K<re;){for(Eu(u,K,re),K++,re--;v(u[K],H)<0;)K++;for(;v(u[re],H)>0;)re--}v(u[h],H)===0?Eu(u,h,re):Eu(u,++re,m),re<=s&&(h=re+1),s<=re&&(m=re-1)}}function Eu(u,s,h){var m=u[s];u[s]=u[h],u[h]=m}function _w(u,s){return u<s?-1:u>s?1:0}function sp(u,s){const h=u.length;if(h<=1)return[u];const m=[];let v,S;for(let C=0;C<h;C++){const L=nt(u[C]);L!==0&&(u[C].area=Math.abs(L),S===void 0&&(S=L<0),S===L<0?(v&&m.push(v),v=[u[C]]):v.push(u[C]))}if(v&&m.push(v),s>1)for(let C=0;C<m.length;C++)m[C].length<=s||(gw(m[C],s,1,m[C].length-1,yw),m[C]=m[C].slice(0,s));return m}function yw(u,s){return s.area-u.area}function ap(u,s,h){const m=h.patternDependencies;let v=!1;for(const S of s){const C=S.paint.get(`${u}-pattern`);C.isConstant()||(v=!0);const L=C.constantOr(null);L&&(v=!0,m[L.to]=!0,m[L.from]=!0)}return v}function lp(u,s,h,m,v){const S=v.patternDependencies;for(const C of s){const L=C.paint.get(`${u}-pattern`).value;if(L.kind!=="constant"){let P=L.evaluate({zoom:m-1},h,{},v.availableImages),O=L.evaluate({zoom:m},h,{},v.availableImages),H=L.evaluate({zoom:m+1},h,{},v.availableImages);P=P&&P.name?P.name:P,O=O&&O.name?O.name:O,H=H&&H.name?H.name:H,S[P]=!0,S[O]=!0,S[H]=!0,h.patterns[C.id]={min:P,mid:O,max:H}}}return h}class cp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Se,this.indexArray=new ot,this.indexArray2=new _t,this.programConfigurations=new Ir(s.layers,s.zoom),this.segments=new Dt,this.segments2=new Dt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.hasPattern=ap("fill",this.layers,h);const v=this.layers[0].layout.get("fill-sort-key"),S=!v.isConstant(),C=[];for(const{feature:L,id:P,index:O,sourceLayerIndex:H}of s){const K=this.layers[0]._featureFilter.needGeometry,re=Bs(L,K);if(!this.layers[0]._featureFilter.filter(new Sr(this.zoom),re,m))continue;const ue=S?v.evaluate(re,{},m,h.availableImages):void 0,me={id:P,properties:L.properties,type:L.type,sourceLayerIndex:H,index:O,geometry:K?re.geometry:Fs(L),patterns:{},sortKey:ue};C.push(me)}S&&C.sort((L,P)=>L.sortKey-P.sortKey);for(const L of C){const{geometry:P,index:O,sourceLayerIndex:H}=L;if(this.hasPattern){const K=lp("fill",this.layers,L,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(L,P,O,m,{});h.featureIndex.insert(s[O].feature,P,O,H,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}addFeatures(s,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,sw),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.indexBuffer2=s.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(s,h,m,v,S){for(const C of sp(h,500)){let L=0;for(const ue of C)L+=ue.length;const P=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),O=P.vertexLength,H=[],K=[];for(const ue of C){if(ue.length===0)continue;ue!==C[0]&&K.push(H.length/2);const me=this.segments2.prepareSegment(ue.length,this.layoutVertexArray,this.indexArray2),be=me.vertexLength;this.layoutVertexArray.emplaceBack(ue[0].x,ue[0].y),this.indexArray2.emplaceBack(be+ue.length-1,be),H.push(ue[0].x),H.push(ue[0].y);for(let Te=1;Te<ue.length;Te++)this.layoutVertexArray.emplaceBack(ue[Te].x,ue[Te].y),this.indexArray2.emplaceBack(be+Te-1,be+Te),H.push(ue[Te].x),H.push(ue[Te].y);me.vertexLength+=ue.length,me.primitiveLength+=ue.length}const re=bg(H,K);for(let ue=0;ue<re.length;ue+=3)this.indexArray.emplaceBack(O+re[ue],O+re[ue+1],O+re[ue+2]);P.vertexLength+=L,P.primitiveLength+=re.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}}let wg,xg;Ht("FillBucket",cp,{omit:["layers","patternFeatures"]});var bw={get paint(){return xg=xg||new Fi({"fill-antialias":new on(_e.paint_fill["fill-antialias"]),"fill-opacity":new un(_e.paint_fill["fill-opacity"]),"fill-color":new un(_e.paint_fill["fill-color"]),"fill-outline-color":new un(_e.paint_fill["fill-outline-color"]),"fill-translate":new on(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new on(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new ec(_e.paint_fill["fill-pattern"])})},get layout(){return wg=wg||new Fi({"fill-sort-key":new un(_e.layout_fill["fill-sort-key"])})}};class vw extends ko{constructor(s){super(s,bw)}recalculate(s,h){super.recalculate(s,h);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new cp(s)}queryRadius(){return vf(this.paint.get("fill-translate"))}queryIntersectsFeature(s,h,m,v,S,C,L){return vu(wf(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,L),v)}isTileClipped(){return!0}}const ww=Ur([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),xw=Ur([{name:"a_centroid",components:2,type:"Int16"}],4),{members:kw}=ww;var ga={},Sw=p,kg=dc;function dc(u,s,h,m,v){this.properties={},this.extent=h,this.type=0,this._pbf=u,this._geometry=-1,this._keys=m,this._values=v,u.readFields(Cw,this,s)}function Cw(u,s,h){u==1?s.id=h.readVarint():u==2?function(m,v){for(var S=m.readVarint()+m.pos;m.pos<S;){var C=v._keys[m.readVarint()],L=v._values[m.readVarint()];v.properties[C]=L}}(h,s):u==3?s.type=h.readVarint():u==4&&(s._geometry=h.pos)}function Tw(u){for(var s,h,m=0,v=0,S=u.length,C=S-1;v<S;C=v++)m+=((h=u[C]).x-(s=u[v]).x)*(s.y+h.y);return m}dc.types=["Unknown","Point","LineString","Polygon"],dc.prototype.loadGeometry=function(){var u=this._pbf;u.pos=this._geometry;for(var s,h=u.readVarint()+u.pos,m=1,v=0,S=0,C=0,L=[];u.pos<h;){if(v<=0){var P=u.readVarint();m=7&P,v=P>>3}if(v--,m===1||m===2)S+=u.readSVarint(),C+=u.readSVarint(),m===1&&(s&&L.push(s),s=[]),s.push(new Sw(S,C));else{if(m!==7)throw new Error("unknown command "+m);s&&s.push(s[0].clone())}}return s&&L.push(s),L},dc.prototype.bbox=function(){var u=this._pbf;u.pos=this._geometry;for(var s=u.readVarint()+u.pos,h=1,m=0,v=0,S=0,C=1/0,L=-1/0,P=1/0,O=-1/0;u.pos<s;){if(m<=0){var H=u.readVarint();h=7&H,m=H>>3}if(m--,h===1||h===2)(v+=u.readSVarint())<C&&(C=v),v>L&&(L=v),(S+=u.readSVarint())<P&&(P=S),S>O&&(O=S);else if(h!==7)throw new Error("unknown command "+h)}return[C,P,L,O]},dc.prototype.toGeoJSON=function(u,s,h){var m,v,S=this.extent*Math.pow(2,h),C=this.extent*u,L=this.extent*s,P=this.loadGeometry(),O=dc.types[this.type];function H(ue){for(var me=0;me<ue.length;me++){var be=ue[me];ue[me]=[360*(be.x+C)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(be.y+L)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(m=0;m<P.length;m++)K[m]=P[m][0];H(P=K);break;case 2:for(m=0;m<P.length;m++)H(P[m]);break;case 3:for(P=function(ue){var me=ue.length;if(me<=1)return[ue];for(var be,Te,Ae=[],qe=0;qe<me;qe++){var $e=Tw(ue[qe]);$e!==0&&(Te===void 0&&(Te=$e<0),Te===$e<0?(be&&Ae.push(be),be=[ue[qe]]):be.push(ue[qe]))}return be&&Ae.push(be),Ae}(P),m=0;m<P.length;m++)for(v=0;v<P[m].length;v++)H(P[m][v])}P.length===1?P=P[0]:O="Multi"+O;var re={type:"Feature",geometry:{type:O,coordinates:P},properties:this.properties};return"id"in this&&(re.id=this.id),re};var Mw=kg,Sg=Cg;function Cg(u,s){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=u,this._keys=[],this._values=[],this._features=[],u.readFields(Lw,this,s),this.length=this._features.length}function Lw(u,s,h){u===15?s.version=h.readVarint():u===1?s.name=h.readString():u===5?s.extent=h.readVarint():u===2?s._features.push(h.pos):u===3?s._keys.push(h.readString()):u===4&&s._values.push(function(m){for(var v=null,S=m.readVarint()+m.pos;m.pos<S;){var C=m.readVarint()>>3;v=C===1?m.readString():C===2?m.readFloat():C===3?m.readDouble():C===4?m.readVarint64():C===5?m.readVarint():C===6?m.readSVarint():C===7?m.readBoolean():null}return v}(h))}Cg.prototype.feature=function(u){if(u<0||u>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[u];var s=this._pbf.readVarint()+this._pbf.pos;return new Mw(this._pbf,s,this.extent,this._keys,this._values)};var Ew=Sg;function Iw(u,s,h){if(u===3){var m=new Ew(h,h.readVarint()+h.pos);m.length&&(s[m.name]=m)}}ga.VectorTile=function(u,s){this.layers=u.readFields(Iw,{},s)},ga.VectorTileFeature=kg,ga.VectorTileLayer=Sg;const Aw=ga.VectorTileFeature.types,up=Math.pow(2,13);function Iu(u,s,h,m,v,S,C,L){u.emplaceBack(s,h,2*Math.floor(m*up)+C,v*up*2,S*up*2,Math.round(L))}class hp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.centroidVertexArray=new Y,this.indexArray=new ot,this.programConfigurations=new Ir(s.layers,s.zoom),this.segments=new Dt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.features=[],this.hasPattern=ap("fill-extrusion",this.layers,h);for(const{feature:v,id:S,index:C,sourceLayerIndex:L}of s){const P=this.layers[0]._featureFilter.needGeometry,O=Bs(v,P);if(!this.layers[0]._featureFilter.filter(new Sr(this.zoom),O,m))continue;const H={id:S,sourceLayerIndex:L,index:C,geometry:P?O.geometry:Fs(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(lp("fill-extrusion",this.layers,H,this.zoom,h)):this.addFeature(H,H.geometry,C,m,{}),h.featureIndex.insert(v,H.geometry,C,L,this.index,!0)}}addFeatures(s,h,m){for(const v of this.features){const{geometry:S}=v;this.addFeature(v,S,v.index,h,m)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,kw),this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,xw.members,!0),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(s,h,m,v,S){const C={x:0,y:0,vertexCount:0};for(const L of sp(h,500)){let P=0;for(const me of L)P+=me.length;let O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const me of L){if(me.length===0||zw(me))continue;let be=0;for(let Te=0;Te<me.length;Te++){const Ae=me[Te];if(Te>=1){const qe=me[Te-1];if(!Pw(Ae,qe)){O.vertexLength+4>Dt.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const $e=Ae.sub(qe)._perp()._unit(),Oe=qe.dist(Ae);be+Oe>32768&&(be=0),Iu(this.layoutVertexArray,Ae.x,Ae.y,$e.x,$e.y,0,0,be),Iu(this.layoutVertexArray,Ae.x,Ae.y,$e.x,$e.y,0,1,be),C.x+=2*Ae.x,C.y+=2*Ae.y,C.vertexCount+=2,be+=Oe,Iu(this.layoutVertexArray,qe.x,qe.y,$e.x,$e.y,0,0,be),Iu(this.layoutVertexArray,qe.x,qe.y,$e.x,$e.y,0,1,be),C.x+=2*qe.x,C.y+=2*qe.y,C.vertexCount+=2;const ht=O.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),O.vertexLength+=4,O.primitiveLength+=2}}}}if(O.vertexLength+P>Dt.MAX_VERTEX_ARRAY_LENGTH&&(O=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),Aw[s.type]!=="Polygon")continue;const H=[],K=[],re=O.vertexLength;for(const me of L)if(me.length!==0){me!==L[0]&&K.push(H.length/2);for(let be=0;be<me.length;be++){const Te=me[be];Iu(this.layoutVertexArray,Te.x,Te.y,0,0,1,1,0),C.x+=Te.x,C.y+=Te.y,C.vertexCount+=1,H.push(Te.x),H.push(Te.y)}}const ue=bg(H,K);for(let me=0;me<ue.length;me+=3)this.indexArray.emplaceBack(re+ue[me],re+ue[me+2],re+ue[me+1]);O.primitiveLength+=ue.length/3,O.vertexLength+=P}for(let L=0;L<C.vertexCount;L++)this.centroidVertexArray.emplaceBack(Math.floor(C.x/C.vertexCount),Math.floor(C.y/C.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}}function Pw(u,s){return u.x===s.x&&(u.x<0||u.x>Or)||u.y===s.y&&(u.y<0||u.y>Or)}function zw(u){return u.every(s=>s.x<0)||u.every(s=>s.x>Or)||u.every(s=>s.y<0)||u.every(s=>s.y>Or)}let Tg;Ht("FillExtrusionBucket",hp,{omit:["layers","features"]});var Dw={get paint(){return Tg=Tg||new Fi({"fill-extrusion-opacity":new on(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new un(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new on(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new on(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ec(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new un(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new un(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new on(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class $w extends ko{constructor(s){super(s,Dw)}createBucket(s){return new hp(s)}queryRadius(){return vf(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,h,m,v,S,C,L,P){const O=wf(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,L),H=this.paint.get("fill-extrusion-height").evaluate(h,m),K=this.paint.get("fill-extrusion-base").evaluate(h,m),re=function(me,be,Te,Ae){const qe=[];for(const $e of me){const Oe=[$e.x,$e.y,0,1];xf(Oe,Oe,be),qe.push(new y(Oe[0]/Oe[3],Oe[1]/Oe[3]))}return qe}(O,P),ue=function(me,be,Te,Ae){const qe=[],$e=[],Oe=Ae[8]*be,ht=Ae[9]*be,ft=Ae[10]*be,Zt=Ae[11]*be,Yt=Ae[8]*Te,qt=Ae[9]*Te,jt=Ae[10]*Te,zt=Ae[11]*Te;for(const Xt of me){const Bt=[],kt=[];for(const cn of Xt){const rn=cn.x,Fn=cn.y,br=Ae[0]*rn+Ae[4]*Fn+Ae[12],Tr=Ae[1]*rn+Ae[5]*Fn+Ae[13],oi=Ae[2]*rn+Ae[6]*Fn+Ae[14],go=Ae[3]*rn+Ae[7]*Fn+Ae[15],Oi=oi+ft,Kr=go+Zt,gi=br+Yt,xi=Tr+qt,Ni=oi+jt,ji=go+zt,si=new y((br+Oe)/Kr,(Tr+ht)/Kr);si.z=Oi/Kr,Bt.push(si);const ai=new y(gi/ji,xi/ji);ai.z=Ni/ji,kt.push(ai)}qe.push(Bt),$e.push(kt)}return[qe,$e]}(v,K,H,P);return function(me,be,Te){let Ae=1/0;vu(Te,be)&&(Ae=Mg(Te,be[0]));for(let qe=0;qe<be.length;qe++){const $e=be[qe],Oe=me[qe];for(let ht=0;ht<$e.length-1;ht++){const ft=$e[ht],Zt=[ft,$e[ht+1],Oe[ht+1],Oe[ht],ft];bu(Te,Zt)&&(Ae=Math.min(Ae,Mg(Te,Zt)))}}return Ae!==1/0&&Ae}(ue[0],ue[1],re)}}function Au(u,s){return u.x*s.x+u.y*s.y}function Mg(u,s){if(u.length===1){let h=0;const m=s[h++];let v;for(;!v||m.equals(v);)if(v=s[h++],!v)return 1/0;for(;h<s.length;h++){const S=s[h],C=u[0],L=v.sub(m),P=S.sub(m),O=C.sub(m),H=Au(L,L),K=Au(L,P),re=Au(P,P),ue=Au(O,L),me=Au(O,P),be=H*re-K*K,Te=(re*ue-K*me)/be,Ae=(H*me-K*ue)/be,qe=m.z*(1-Te-Ae)+v.z*Te+S.z*Ae;if(isFinite(qe))return qe}return 1/0}{let h=1/0;for(const m of s)h=Math.min(h,m.z);return h}}const Rw=Ur([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Fw}=Rw,Bw=Ur([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ow}=Bw,Nw=ga.VectorTileFeature.types,jw=Math.cos(Math.PI/180*37.5),Lg=Math.pow(2,14)/.5;class fp{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(h=>h.id),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new Me,this.layoutVertexArray2=new ye,this.indexArray=new ot,this.programConfigurations=new Ir(s.layers,s.zoom),this.segments=new Dt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(s,h,m){this.hasPattern=ap("line",this.layers,h);const v=this.layers[0].layout.get("line-sort-key"),S=!v.isConstant(),C=[];for(const{feature:L,id:P,index:O,sourceLayerIndex:H}of s){const K=this.layers[0]._featureFilter.needGeometry,re=Bs(L,K);if(!this.layers[0]._featureFilter.filter(new Sr(this.zoom),re,m))continue;const ue=S?v.evaluate(re,{},m):void 0,me={id:P,properties:L.properties,type:L.type,sourceLayerIndex:H,index:O,geometry:K?re.geometry:Fs(L),patterns:{},sortKey:ue};C.push(me)}S&&C.sort((L,P)=>L.sortKey-P.sortKey);for(const L of C){const{geometry:P,index:O,sourceLayerIndex:H}=L;if(this.hasPattern){const K=lp("line",this.layers,L,this.zoom,h);this.patternFeatures.push(K)}else this.addFeature(L,P,O,m,{});h.featureIndex.insert(s[O].feature,P,O,H,this.index)}}update(s,h,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(s,h,this.stateDependentLayers,m)}addFeatures(s,h,m){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,Ow)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,Fw),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s){if(s.properties&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(s.properties,"mapbox_clip_end"))return{start:+s.properties.mapbox_clip_start,end:+s.properties.mapbox_clip_end}}addFeature(s,h,m,v,S){const C=this.layers[0].layout,L=C.get("line-join").evaluate(s,{}),P=C.get("line-cap"),O=C.get("line-miter-limit"),H=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(s);for(const K of h)this.addLine(K,s,L,P,O,H);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,m,S,v)}addLine(s,h,m,v,S,C){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ae=0;Ae<s.length-1;Ae++)this.totalDistance+=s[Ae].dist(s[Ae+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const L=Nw[h.type]==="Polygon";let P=s.length;for(;P>=2&&s[P-1].equals(s[P-2]);)P--;let O=0;for(;O<P-1&&s[O].equals(s[O+1]);)O++;if(P<(L?3:2))return;m==="bevel"&&(S=1.05);const H=this.overscaling<=16?15*Or/(512*this.overscaling):0,K=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let re,ue,me,be,Te;this.e1=this.e2=-1,L&&(re=s[P-2],Te=s[O].sub(re)._unit()._perp());for(let Ae=O;Ae<P;Ae++){if(me=Ae===P-1?L?s[O+1]:void 0:s[Ae+1],me&&s[Ae].equals(me))continue;Te&&(be=Te),re&&(ue=re),re=s[Ae],Te=me?me.sub(re)._unit()._perp():be,be=be||Te;let qe=be.add(Te);qe.x===0&&qe.y===0||qe._unit();const $e=be.x*Te.x+be.y*Te.y,Oe=qe.x*Te.x+qe.y*Te.y,ht=Oe!==0?1/Oe:1/0,ft=2*Math.sqrt(2-2*Oe),Zt=Oe<jw&&ue&&me,Yt=be.x*Te.y-be.y*Te.x>0;if(Zt&&Ae>O){const zt=re.dist(ue);if(zt>2*H){const Xt=re.sub(re.sub(ue)._mult(H/zt)._round());this.updateDistance(ue,Xt),this.addCurrentVertex(Xt,be,0,0,K),ue=Xt}}const qt=ue&&me;let jt=qt?m:L?"butt":v;if(qt&&jt==="round"&&(ht<C?jt="miter":ht<=2&&(jt="fakeround")),jt==="miter"&&ht>S&&(jt="bevel"),jt==="bevel"&&(ht>2&&(jt="flipbevel"),ht<S&&(jt="miter")),ue&&this.updateDistance(ue,re),jt==="miter")qe._mult(ht),this.addCurrentVertex(re,qe,0,0,K);else if(jt==="flipbevel"){if(ht>100)qe=Te.mult(-1);else{const zt=ht*be.add(Te).mag()/be.sub(Te).mag();qe._perp()._mult(zt*(Yt?-1:1))}this.addCurrentVertex(re,qe,0,0,K),this.addCurrentVertex(re,qe.mult(-1),0,0,K)}else if(jt==="bevel"||jt==="fakeround"){const zt=-Math.sqrt(ht*ht-1),Xt=Yt?zt:0,Bt=Yt?0:zt;if(ue&&this.addCurrentVertex(re,be,Xt,Bt,K),jt==="fakeround"){const kt=Math.round(180*ft/Math.PI/20);for(let cn=1;cn<kt;cn++){let rn=cn/kt;if(rn!==.5){const br=rn-.5;rn+=rn*br*(rn-1)*((1.0904+$e*($e*(3.55645-1.43519*$e)-3.2452))*br*br+(.848013+$e*(.215638*$e-1.06021)))}const Fn=Te.sub(be)._mult(rn)._add(be)._unit()._mult(Yt?-1:1);this.addHalfVertex(re,Fn.x,Fn.y,!1,Yt,0,K)}}me&&this.addCurrentVertex(re,Te,-Xt,-Bt,K)}else if(jt==="butt")this.addCurrentVertex(re,qe,0,0,K);else if(jt==="square"){const zt=ue?1:-1;this.addCurrentVertex(re,qe,zt,zt,K)}else jt==="round"&&(ue&&(this.addCurrentVertex(re,be,0,0,K),this.addCurrentVertex(re,be,1,1,K,!0)),me&&(this.addCurrentVertex(re,Te,-1,-1,K,!0),this.addCurrentVertex(re,Te,0,0,K)));if(Zt&&Ae<P-1){const zt=re.dist(me);if(zt>2*H){const Xt=re.add(me.sub(re)._mult(H/zt)._round());this.updateDistance(re,Xt),this.addCurrentVertex(Xt,Te,0,0,K),re=Xt}}}}addCurrentVertex(s,h,m,v,S,C=!1){const L=h.y*v-h.x,P=-h.y-h.x*v;this.addHalfVertex(s,h.x+h.y*m,h.y-h.x*m,C,!1,m,S),this.addHalfVertex(s,L,P,C,!0,-v,S),this.distance>Lg/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(s,h,m,v,S,C))}addHalfVertex({x:s,y:h},m,v,S,C,L,P){const O=.5*(this.lineClips?this.scaledDistance*(Lg-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((s<<1)+(S?1:0),(h<<1)+(C?1:0),Math.round(63*m)+128,Math.round(63*v)+128,1+(L===0?0:L<0?-1:1)|(63&O)<<2,O>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const H=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,H),P.primitiveLength++),C?this.e2=H:this.e1=H}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(s,h){this.distance+=s.dist(h),this.updateScaledDistance()}}let Eg,Ig;Ht("LineBucket",fp,{omit:["layers","patternFeatures"]});var Ag={get paint(){return Ig=Ig||new Fi({"line-opacity":new un(_e.paint_line["line-opacity"]),"line-color":new un(_e.paint_line["line-color"]),"line-translate":new on(_e.paint_line["line-translate"]),"line-translate-anchor":new on(_e.paint_line["line-translate-anchor"]),"line-width":new un(_e.paint_line["line-width"]),"line-gap-width":new un(_e.paint_line["line-gap-width"]),"line-offset":new un(_e.paint_line["line-offset"]),"line-blur":new un(_e.paint_line["line-blur"]),"line-dasharray":new nl(_e.paint_line["line-dasharray"]),"line-pattern":new ec(_e.paint_line["line-pattern"]),"line-gradient":new cu(_e.paint_line["line-gradient"])})},get layout(){return Eg=Eg||new Fi({"line-cap":new on(_e.layout_line["line-cap"]),"line-join":new un(_e.layout_line["line-join"]),"line-miter-limit":new on(_e.layout_line["line-miter-limit"]),"line-round-limit":new on(_e.layout_line["line-round-limit"]),"line-sort-key":new un(_e.layout_line["line-sort-key"])})}};class Uw extends un{possiblyEvaluate(s,h){return h=new Sr(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(s,h)}evaluate(s,h,m,v){return h=J({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(s,h,m,v)}}let Mf;class Vw extends ko{constructor(s){super(s,Ag),this.gradientVersion=0,Mf||(Mf=new Uw(Ag.paint.properties["line-width"].specification),Mf.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Wa,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,h){super.recalculate(s,h),this.paint._values["line-floorwidth"]=Mf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new fp(s)}queryRadius(s){const h=s,m=Pg(ku("line-width",this,h),ku("line-gap-width",this,h)),v=ku("line-offset",this,h);return m/2+Math.abs(v)+vf(this.paint.get("line-translate"))}queryIntersectsFeature(s,h,m,v,S,C,L){const P=wf(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,L),O=L/2*Pg(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),H=this.paint.get("line-offset").evaluate(h,m);return H&&(v=function(K,re){const ue=[];for(let me=0;me<K.length;me++){const be=K[me],Te=[];for(let Ae=0;Ae<be.length;Ae++){const qe=be[Ae-1],$e=be[Ae],Oe=be[Ae+1],ht=Ae===0?new y(0,0):$e.sub(qe)._unit()._perp(),ft=Ae===be.length-1?new y(0,0):Oe.sub($e)._unit()._perp(),Zt=ht._add(ft)._unit(),Yt=Zt.x*ft.x+Zt.y*ft.y;Yt!==0&&Zt._mult(1/Yt),Te.push(Zt._mult(re)._add($e))}ue.push(Te)}return ue}(v,H*L)),function(K,re,ue){for(let me=0;me<re.length;me++){const be=re[me];if(K.length>=3){for(let Te=0;Te<be.length;Te++)if(uc(K,be[Te]))return!0}if(wu(K,be,ue))return!0}return!1}(P,v,O)}isTileClipped(){return!0}}function Pg(u,s){return s>0?s+2*u:u}const qw=Ur([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zw=Ur([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ur([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Gw=Ur([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ur([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const zg=Ur([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Hw=Ur([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ww(u,s,h){return u.sections.forEach(m=>{m.text=function(v,S,C){const L=S.layout.get("text-transform").evaluate(C,{});return L==="uppercase"?v=v.toLocaleUpperCase():L==="lowercase"&&(v=v.toLocaleLowerCase()),ws.applyArabicShaping&&(v=ws.applyArabicShaping(v)),v}(m.text,s,h)}),u}Ur([{name:"triangle",components:3,type:"Uint16"}]),Ur([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ur([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ur([{type:"Float32",name:"offsetX"}]),Ur([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ur([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Pu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ii=24,Dg=ar,$g=function(u,s,h,m,v){var S,C,L=8*v-m-1,P=(1<<L)-1,O=P>>1,H=-7,K=h?v-1:0,re=h?-1:1,ue=u[s+K];for(K+=re,S=ue&(1<<-H)-1,ue>>=-H,H+=L;H>0;S=256*S+u[s+K],K+=re,H-=8);for(C=S&(1<<-H)-1,S>>=-H,H+=m;H>0;C=256*C+u[s+K],K+=re,H-=8);if(S===0)S=1-O;else{if(S===P)return C?NaN:1/0*(ue?-1:1);C+=Math.pow(2,m),S-=O}return(ue?-1:1)*C*Math.pow(2,S-m)},Rg=function(u,s,h,m,v,S){var C,L,P,O=8*S-v-1,H=(1<<O)-1,K=H>>1,re=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=m?0:S-1,me=m?1:-1,be=s<0||s===0&&1/s<0?1:0;for(s=Math.abs(s),isNaN(s)||s===1/0?(L=isNaN(s)?1:0,C=H):(C=Math.floor(Math.log(s)/Math.LN2),s*(P=Math.pow(2,-C))<1&&(C--,P*=2),(s+=C+K>=1?re/P:re*Math.pow(2,1-K))*P>=2&&(C++,P/=2),C+K>=H?(L=0,C=H):C+K>=1?(L=(s*P-1)*Math.pow(2,v),C+=K):(L=s*Math.pow(2,K-1)*Math.pow(2,v),C=0));v>=8;u[h+ue]=255&L,ue+=me,L/=256,v-=8);for(C=C<<v|L,O+=v;O>0;u[h+ue]=255&C,ue+=me,C/=256,O-=8);u[h+ue-me]|=128*be};function ar(u){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(u)?u:new Uint8Array(u||0),this.pos=0,this.type=0,this.length=this.buf.length}ar.Varint=0,ar.Fixed64=1,ar.Bytes=2,ar.Fixed32=5;var dp=4294967296,Fg=1/dp,Bg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Os(u){return u.type===ar.Bytes?u.readVarint()+u.pos:u.pos+1}function pc(u,s,h){return h?4294967296*s+(u>>>0):4294967296*(s>>>0)+(u>>>0)}function Og(u,s,h){var m=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));h.realloc(m);for(var v=h.pos-1;v>=u;v--)h.buf[v+m]=h.buf[v]}function Kw(u,s){for(var h=0;h<u.length;h++)s.writeVarint(u[h])}function Xw(u,s){for(var h=0;h<u.length;h++)s.writeSVarint(u[h])}function Jw(u,s){for(var h=0;h<u.length;h++)s.writeFloat(u[h])}function Yw(u,s){for(var h=0;h<u.length;h++)s.writeDouble(u[h])}function Qw(u,s){for(var h=0;h<u.length;h++)s.writeBoolean(u[h])}function e2(u,s){for(var h=0;h<u.length;h++)s.writeFixed32(u[h])}function t2(u,s){for(var h=0;h<u.length;h++)s.writeSFixed32(u[h])}function n2(u,s){for(var h=0;h<u.length;h++)s.writeFixed64(u[h])}function r2(u,s){for(var h=0;h<u.length;h++)s.writeSFixed64(u[h])}function Lf(u,s){return(u[s]|u[s+1]<<8|u[s+2]<<16)+16777216*u[s+3]}function mc(u,s,h){u[h]=s,u[h+1]=s>>>8,u[h+2]=s>>>16,u[h+3]=s>>>24}function Ng(u,s){return(u[s]|u[s+1]<<8|u[s+2]<<16)+(u[s+3]<<24)}ar.prototype={destroy:function(){this.buf=null},readFields:function(u,s,h){for(h=h||this.length;this.pos<h;){var m=this.readVarint(),v=m>>3,S=this.pos;this.type=7&m,u(v,s,this),this.pos===S&&this.skip(m)}return s},readMessage:function(u,s){return this.readFields(u,s,this.readVarint()+this.pos)},readFixed32:function(){var u=Lf(this.buf,this.pos);return this.pos+=4,u},readSFixed32:function(){var u=Ng(this.buf,this.pos);return this.pos+=4,u},readFixed64:function(){var u=Lf(this.buf,this.pos)+Lf(this.buf,this.pos+4)*dp;return this.pos+=8,u},readSFixed64:function(){var u=Lf(this.buf,this.pos)+Ng(this.buf,this.pos+4)*dp;return this.pos+=8,u},readFloat:function(){var u=$g(this.buf,this.pos,!0,23,4);return this.pos+=4,u},readDouble:function(){var u=$g(this.buf,this.pos,!0,52,8);return this.pos+=8,u},readVarint:function(u){var s,h,m=this.buf;return s=127&(h=m[this.pos++]),h<128?s:(s|=(127&(h=m[this.pos++]))<<7,h<128?s:(s|=(127&(h=m[this.pos++]))<<14,h<128?s:(s|=(127&(h=m[this.pos++]))<<21,h<128?s:function(v,S,C){var L,P,O=C.buf;if(L=(112&(P=O[C.pos++]))>>4,P<128||(L|=(127&(P=O[C.pos++]))<<3,P<128)||(L|=(127&(P=O[C.pos++]))<<10,P<128)||(L|=(127&(P=O[C.pos++]))<<17,P<128)||(L|=(127&(P=O[C.pos++]))<<24,P<128)||(L|=(1&(P=O[C.pos++]))<<31,P<128))return pc(v,L,S);throw new Error("Expected varint not more than 10 bytes")}(s|=(15&(h=m[this.pos]))<<28,u,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var u=this.readVarint();return u%2==1?(u+1)/-2:u/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var u=this.readVarint()+this.pos,s=this.pos;return this.pos=u,u-s>=12&&Bg?function(h,m,v){return Bg.decode(h.subarray(m,v))}(this.buf,s,u):function(h,m,v){for(var S="",C=m;C<v;){var L,P,O,H=h[C],K=null,re=H>239?4:H>223?3:H>191?2:1;if(C+re>v)break;re===1?H<128&&(K=H):re===2?(192&(L=h[C+1]))==128&&(K=(31&H)<<6|63&L)<=127&&(K=null):re===3?(P=h[C+2],(192&(L=h[C+1]))==128&&(192&P)==128&&((K=(15&H)<<12|(63&L)<<6|63&P)<=2047||K>=55296&&K<=57343)&&(K=null)):re===4&&(P=h[C+2],O=h[C+3],(192&(L=h[C+1]))==128&&(192&P)==128&&(192&O)==128&&((K=(15&H)<<18|(63&L)<<12|(63&P)<<6|63&O)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,re=1):K>65535&&(K-=65536,S+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),S+=String.fromCharCode(K),C+=re}return S}(this.buf,s,u)},readBytes:function(){var u=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,u);return this.pos=u,s},readPackedVarint:function(u,s){if(this.type!==ar.Bytes)return u.push(this.readVarint(s));var h=Os(this);for(u=u||[];this.pos<h;)u.push(this.readVarint(s));return u},readPackedSVarint:function(u){if(this.type!==ar.Bytes)return u.push(this.readSVarint());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readSVarint());return u},readPackedBoolean:function(u){if(this.type!==ar.Bytes)return u.push(this.readBoolean());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readBoolean());return u},readPackedFloat:function(u){if(this.type!==ar.Bytes)return u.push(this.readFloat());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readFloat());return u},readPackedDouble:function(u){if(this.type!==ar.Bytes)return u.push(this.readDouble());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readDouble());return u},readPackedFixed32:function(u){if(this.type!==ar.Bytes)return u.push(this.readFixed32());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readFixed32());return u},readPackedSFixed32:function(u){if(this.type!==ar.Bytes)return u.push(this.readSFixed32());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readSFixed32());return u},readPackedFixed64:function(u){if(this.type!==ar.Bytes)return u.push(this.readFixed64());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readFixed64());return u},readPackedSFixed64:function(u){if(this.type!==ar.Bytes)return u.push(this.readSFixed64());var s=Os(this);for(u=u||[];this.pos<s;)u.push(this.readSFixed64());return u},skip:function(u){var s=7&u;if(s===ar.Varint)for(;this.buf[this.pos++]>127;);else if(s===ar.Bytes)this.pos=this.readVarint()+this.pos;else if(s===ar.Fixed32)this.pos+=4;else{if(s!==ar.Fixed64)throw new Error("Unimplemented type: "+s);this.pos+=8}},writeTag:function(u,s){this.writeVarint(u<<3|s)},realloc:function(u){for(var s=this.length||16;s<this.pos+u;)s*=2;if(s!==this.length){var h=new Uint8Array(s);h.set(this.buf),this.buf=h,this.length=s}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(u){this.realloc(4),mc(this.buf,u,this.pos),this.pos+=4},writeSFixed32:function(u){this.realloc(4),mc(this.buf,u,this.pos),this.pos+=4},writeFixed64:function(u){this.realloc(8),mc(this.buf,-1&u,this.pos),mc(this.buf,Math.floor(u*Fg),this.pos+4),this.pos+=8},writeSFixed64:function(u){this.realloc(8),mc(this.buf,-1&u,this.pos),mc(this.buf,Math.floor(u*Fg),this.pos+4),this.pos+=8},writeVarint:function(u){(u=+u||0)>268435455||u<0?function(s,h){var m,v;if(s>=0?(m=s%4294967296|0,v=s/4294967296|0):(v=~(-s/4294967296),4294967295^(m=~(-s%4294967296))?m=m+1|0:(m=0,v=v+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,C,L){L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,S>>>=7,L.buf[L.pos++]=127&S|128,L.buf[L.pos]=127&(S>>>=7)}(m,0,h),function(S,C){var L=(7&S)<<4;C.buf[C.pos++]|=L|((S>>>=3)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S|((S>>>=7)?128:0),S&&(C.buf[C.pos++]=127&S)))))}(v,h)}(u,this):(this.realloc(4),this.buf[this.pos++]=127&u|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=127&(u>>>=7)|(u>127?128:0),u<=127||(this.buf[this.pos++]=u>>>7&127))))},writeSVarint:function(u){this.writeVarint(u<0?2*-u-1:2*u)},writeBoolean:function(u){this.writeVarint(!!u)},writeString:function(u){u=String(u),this.realloc(4*u.length),this.pos++;var s=this.pos;this.pos=function(m,v,S){for(var C,L,P=0;P<v.length;P++){if((C=v.charCodeAt(P))>55295&&C<57344){if(!L){C>56319||P+1===v.length?(m[S++]=239,m[S++]=191,m[S++]=189):L=C;continue}if(C<56320){m[S++]=239,m[S++]=191,m[S++]=189,L=C;continue}C=L-55296<<10|C-56320|65536,L=null}else L&&(m[S++]=239,m[S++]=191,m[S++]=189,L=null);C<128?m[S++]=C:(C<2048?m[S++]=C>>6|192:(C<65536?m[S++]=C>>12|224:(m[S++]=C>>18|240,m[S++]=C>>12&63|128),m[S++]=C>>6&63|128),m[S++]=63&C|128)}return S}(this.buf,u,this.pos);var h=this.pos-s;h>=128&&Og(s,h,this),this.pos=s-1,this.writeVarint(h),this.pos+=h},writeFloat:function(u){this.realloc(4),Rg(this.buf,u,this.pos,!0,23,4),this.pos+=4},writeDouble:function(u){this.realloc(8),Rg(this.buf,u,this.pos,!0,52,8),this.pos+=8},writeBytes:function(u){var s=u.length;this.writeVarint(s),this.realloc(s);for(var h=0;h<s;h++)this.buf[this.pos++]=u[h]},writeRawMessage:function(u,s){this.pos++;var h=this.pos;u(s,this);var m=this.pos-h;m>=128&&Og(h,m,this),this.pos=h-1,this.writeVarint(m),this.pos+=m},writeMessage:function(u,s,h){this.writeTag(u,ar.Bytes),this.writeRawMessage(s,h)},writePackedVarint:function(u,s){s.length&&this.writeMessage(u,Kw,s)},writePackedSVarint:function(u,s){s.length&&this.writeMessage(u,Xw,s)},writePackedBoolean:function(u,s){s.length&&this.writeMessage(u,Qw,s)},writePackedFloat:function(u,s){s.length&&this.writeMessage(u,Jw,s)},writePackedDouble:function(u,s){s.length&&this.writeMessage(u,Yw,s)},writePackedFixed32:function(u,s){s.length&&this.writeMessage(u,e2,s)},writePackedSFixed32:function(u,s){s.length&&this.writeMessage(u,t2,s)},writePackedFixed64:function(u,s){s.length&&this.writeMessage(u,n2,s)},writePackedSFixed64:function(u,s){s.length&&this.writeMessage(u,r2,s)},writeBytesField:function(u,s){this.writeTag(u,ar.Bytes),this.writeBytes(s)},writeFixed32Field:function(u,s){this.writeTag(u,ar.Fixed32),this.writeFixed32(s)},writeSFixed32Field:function(u,s){this.writeTag(u,ar.Fixed32),this.writeSFixed32(s)},writeFixed64Field:function(u,s){this.writeTag(u,ar.Fixed64),this.writeFixed64(s)},writeSFixed64Field:function(u,s){this.writeTag(u,ar.Fixed64),this.writeSFixed64(s)},writeVarintField:function(u,s){this.writeTag(u,ar.Varint),this.writeVarint(s)},writeSVarintField:function(u,s){this.writeTag(u,ar.Varint),this.writeSVarint(s)},writeStringField:function(u,s){this.writeTag(u,ar.Bytes),this.writeString(s)},writeFloatField:function(u,s){this.writeTag(u,ar.Fixed32),this.writeFloat(s)},writeDoubleField:function(u,s){this.writeTag(u,ar.Fixed64),this.writeDouble(s)},writeBooleanField:function(u,s){this.writeVarintField(u,!!s)}};var pp=d(Dg);const mp=3;function i2(u,s,h){u===1&&h.readMessage(o2,s)}function o2(u,s,h){if(u===3){const{id:m,bitmap:v,width:S,height:C,left:L,top:P,advance:O}=h.readMessage(s2,{});s.push({id:m,bitmap:new Cu({width:S+2*mp,height:C+2*mp},v),metrics:{width:S,height:C,left:L,top:P,advance:O}})}}function s2(u,s,h){u===1?s.id=h.readVarint():u===2?s.bitmap=h.readBytes():u===3?s.width=h.readVarint():u===4?s.height=h.readVarint():u===5?s.left=h.readSVarint():u===6?s.top=h.readSVarint():u===7&&(s.advance=h.readVarint())}const jg=mp;function Ug(u){let s=0,h=0;for(const C of u)s+=C.w*C.h,h=Math.max(h,C.w);u.sort((C,L)=>L.h-C.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),h),h:1/0}];let v=0,S=0;for(const C of u)for(let L=m.length-1;L>=0;L--){const P=m[L];if(!(C.w>P.w||C.h>P.h)){if(C.x=P.x,C.y=P.y,S=Math.max(S,C.y+C.h),v=Math.max(v,C.x+C.w),C.w===P.w&&C.h===P.h){const O=m.pop();L<m.length&&(m[L]=O)}else C.h===P.h?(P.x+=C.w,P.w-=C.w):C.w===P.w?(P.y+=C.h,P.h-=C.h):(m.push({x:P.x+C.w,y:P.y,w:P.w-C.w,h:C.h}),P.y+=C.h,P.h-=C.h);break}}return{w:v,h:S,fill:s/(v*S)||0}}const eo=1;class gp{constructor(s,{pixelRatio:h,version:m,stretchX:v,stretchY:S,content:C}){this.paddedRect=s,this.pixelRatio=h,this.stretchX=v,this.stretchY=S,this.content=C,this.version=m}get tl(){return[this.paddedRect.x+eo,this.paddedRect.y+eo]}get br(){return[this.paddedRect.x+this.paddedRect.w-eo,this.paddedRect.y+this.paddedRect.h-eo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*eo)/this.pixelRatio,(this.paddedRect.h-2*eo)/this.pixelRatio]}}class Vg{constructor(s,h){const m={},v={};this.haveRenderCallbacks=[];const S=[];this.addImages(s,m,S),this.addImages(h,v,S);const{w:C,h:L}=Ug(S),P=new So({width:C||1,height:L||1});for(const O in s){const H=s[O],K=m[O].paddedRect;So.copy(H.data,P,{x:0,y:0},{x:K.x+eo,y:K.y+eo},H.data)}for(const O in h){const H=h[O],K=v[O].paddedRect,re=K.x+eo,ue=K.y+eo,me=H.data.width,be=H.data.height;So.copy(H.data,P,{x:0,y:0},{x:re,y:ue},H.data),So.copy(H.data,P,{x:0,y:be-1},{x:re,y:ue-1},{width:me,height:1}),So.copy(H.data,P,{x:0,y:0},{x:re,y:ue+be},{width:me,height:1}),So.copy(H.data,P,{x:me-1,y:0},{x:re-1,y:ue},{width:1,height:be}),So.copy(H.data,P,{x:0,y:0},{x:re+me,y:ue},{width:1,height:be})}this.image=P,this.iconPositions=m,this.patternPositions=v}addImages(s,h,m){for(const v in s){const S=s[v],C={x:0,y:0,w:S.data.width+2*eo,h:S.data.height+2*eo};m.push(C),h[v]=new gp(C,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(s,h){s.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in s.updatedImages)this.patchUpdatedImage(this.iconPositions[m],s.getImage(m),h),this.patchUpdatedImage(this.patternPositions[m],s.getImage(m),h)}patchUpdatedImage(s,h,m){if(!s||!h||s.version===h.version)return;s.version=h.version;const[v,S]=s.tl;m.update(h.data,void 0,{x:v,y:S})}}var _a;Ht("ImagePosition",gp),Ht("ImageAtlas",Vg),c.ah=void 0,(_a=c.ah||(c.ah={}))[_a.none=0]="none",_a[_a.horizontal=1]="horizontal",_a[_a.vertical=2]="vertical",_a[_a.horizontalOnly=3]="horizontalOnly";const zu=-17;class Du{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(s,h){const m=new Du;return m.scale=s||1,m.fontStack=h,m}static forImage(s){const h=new Du;return h.imageName=s,h}}class gc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,h){const m=new gc;for(let v=0;v<s.sections.length;v++){const S=s.sections[v];S.image?m.addImageSection(S):m.addTextSection(S,h)}return m}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSectionIndex(s){return this.sectionIndex[s]}getCharCode(s){return this.text.charCodeAt(s)}verticalizePunctuation(){this.text=function(s){let h="";for(let m=0;m<s.length;m++){const v=s.charCodeAt(m+1)||null,S=s.charCodeAt(m-1)||null;h+=v&&au(v)&&!Pu[s[m+1]]||S&&au(S)&&!Pu[s[m-1]]||!Pu[s[m]]?s[m]:Pu[s[m]]}return h}(this.text)}trim(){let s=0;for(let m=0;m<this.text.length&&If[this.text.charCodeAt(m)];m++)s++;let h=this.text.length;for(let m=this.text.length-1;m>=0&&m>=s&&If[this.text.charCodeAt(m)];m--)h--;this.text=this.text.substring(s,h),this.sectionIndex=this.sectionIndex.slice(s,h)}substring(s,h){const m=new gc;return m.text=this.text.substring(s,h),m.sectionIndex=this.sectionIndex.slice(s,h),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,h)=>Math.max(s,this.sections[h].scale),0)}addTextSection(s,h){this.text+=s.text,this.sections.push(Du.forText(s.scale,s.fontStack||h));const m=this.sections.length-1;for(let v=0;v<s.text.length;++v)this.sectionIndex.push(m)}addImageSection(s){const h=s.image?s.image.name:"";if(h.length===0)return void Pe("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(Du.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Pe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ef(u,s,h,m,v,S,C,L,P,O,H,K,re,ue,me,be){const Te=gc.fromFeature(u,v);let Ae;K===c.ah.vertical&&Te.verticalizePunctuation();const{processBidirectionalText:qe,processStyledBidirectionalText:$e}=ws;if(qe&&Te.sections.length===1){Ae=[];const ft=qe(Te.toString(),_p(Te,O,S,s,m,ue,me));for(const Zt of ft){const Yt=new gc;Yt.text=Zt,Yt.sections=Te.sections;for(let qt=0;qt<Zt.length;qt++)Yt.sectionIndex.push(0);Ae.push(Yt)}}else if($e){Ae=[];const ft=$e(Te.text,Te.sectionIndex,_p(Te,O,S,s,m,ue,me));for(const Zt of ft){const Yt=new gc;Yt.text=Zt[0],Yt.sectionIndex=Zt[1],Yt.sections=Te.sections,Ae.push(Yt)}}else Ae=function(ft,Zt){const Yt=[],qt=ft.text;let jt=0;for(const zt of Zt)Yt.push(ft.substring(jt,zt)),jt=zt;return jt<qt.length&&Yt.push(ft.substring(jt,qt.length)),Yt}(Te,_p(Te,O,S,s,m,ue,me));const Oe=[],ht={positionedLines:Oe,text:Te.toString(),top:H[1],bottom:H[1],left:H[0],right:H[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(ft,Zt,Yt,qt,jt,zt,Xt,Bt,kt,cn,rn,Fn){let br=0,Tr=zu,oi=0,go=0;const Oi=Bt==="right"?1:Bt==="left"?0:.5;let Kr=0;for(const si of jt){si.trim();const ai=si.getMaxScale(),Ei=(ai-1)*ii,Ui={positionedGlyphs:[],lineOffset:0};ft.positionedLines[Kr]=Ui;const Ii=Ui.positionedGlyphs;let to=0;if(!si.length()){Tr+=zt,++Kr;continue}for(let li=0;li<si.length();li++){const Un=si.getSection(li),Ai=si.getSectionIndex(li),ki=si.getCharCode(li);let ci=0,Ho=null,is=null,os=null,Ns=ii;const Wo=!(kt===c.ah.horizontal||!rn&&!Jl(ki)||rn&&(If[ki]||(gi=ki,Vt.Arabic(gi)||Vt["Arabic Supplement"](gi)||Vt["Arabic Extended-A"](gi)||Vt["Arabic Presentation Forms-A"](gi)||Vt["Arabic Presentation Forms-B"](gi))));if(Un.imageName){const To=qt[Un.imageName];if(!To)continue;os=Un.imageName,ft.iconsInText=ft.iconsInText||!0,is=To.paddedRect;const ro=To.displaySize;Un.scale=Un.scale*ii/Fn,Ho={width:ro[0],height:ro[1],left:eo,top:-jg,advance:Wo?ro[1]:ro[0]},ci=Ei+(ii-ro[1]*Un.scale),Ns=Ho.advance;const js=Wo?ro[0]*Un.scale-ii*ai:ro[1]*Un.scale-ii*ai;js>0&&js>to&&(to=js)}else{const To=Yt[Un.fontStack],ro=To&&To[ki];if(ro&&ro.rect)is=ro.rect,Ho=ro.metrics;else{const js=Zt[Un.fontStack],Ou=js&&js[ki];if(!Ou)continue;Ho=Ou.metrics}ci=(ai-Un.scale)*ii}Wo?(ft.verticalizable=!0,Ii.push({glyph:ki,imageName:os,x:br,y:Tr+ci,vertical:Wo,scale:Un.scale,fontStack:Un.fontStack,sectionIndex:Ai,metrics:Ho,rect:is}),br+=Ns*Un.scale+cn):(Ii.push({glyph:ki,imageName:os,x:br,y:Tr+ci,vertical:Wo,scale:Un.scale,fontStack:Un.fontStack,sectionIndex:Ai,metrics:Ho,rect:is}),br+=Ho.advance*Un.scale+cn)}Ii.length!==0&&(oi=Math.max(br-cn,oi),c2(Ii,0,Ii.length-1,Oi,to)),br=0;const no=zt*ai+to;Ui.lineOffset=Math.max(to,Ei),Tr+=no,go=Math.max(no,go),++Kr}var gi;const xi=Tr-zu,{horizontalAlign:Ni,verticalAlign:ji}=yp(Xt);(function(si,ai,Ei,Ui,Ii,to,no,li,Un){const Ai=(ai-Ei)*Ii;let ki=0;ki=to!==no?-li*Ui-zu:(-Ui*Un+.5)*no;for(const ci of si)for(const Ho of ci.positionedGlyphs)Ho.x+=Ai,Ho.y+=ki})(ft.positionedLines,Oi,Ni,ji,oi,go,zt,xi,jt.length),ft.top+=-ji*xi,ft.bottom=ft.top+xi,ft.left+=-Ni*oi,ft.right=ft.left+oi}(ht,s,h,m,Ae,C,L,P,K,O,re,be),!function(ft){for(const Zt of ft)if(Zt.positionedGlyphs.length!==0)return!1;return!0}(Oe)&&ht}const If={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},a2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function qg(u,s,h,m,v,S){if(s.imageName){const C=m[s.imageName];return C?C.displaySize[0]*s.scale*ii/S+v:0}{const C=h[s.fontStack],L=C&&C[u];return L?L.metrics.advance*s.scale+v:0}}function Zg(u,s,h,m){const v=Math.pow(u-s,2);return m?u<s?v/2:2*v:v+Math.abs(h)*h}function l2(u,s,h){let m=0;return u===10&&(m-=1e4),h&&(m+=150),u!==40&&u!==65288||(m+=50),s!==41&&s!==65289||(m+=50),m}function Gg(u,s,h,m,v,S){let C=null,L=Zg(s,h,v,S);for(const P of m){const O=Zg(s-P.x,h,v,S)+P.badness;O<=L&&(C=P,L=O)}return{index:u,x:s,priorBreak:C,badness:L}}function Hg(u){return u?Hg(u.priorBreak).concat(u.index):[]}function _p(u,s,h,m,v,S,C){if(S!=="point")return[];if(!u)return[];const L=[],P=function(re,ue,me,be,Te,Ae){let qe=0;for(let $e=0;$e<re.length();$e++){const Oe=re.getSection($e);qe+=qg(re.getCharCode($e),Oe,be,Te,ue,Ae)}return qe/Math.max(1,Math.ceil(qe/me))}(u,s,h,m,v,C),O=u.text.indexOf("")>=0;let H=0;for(let re=0;re<u.length();re++){const ue=u.getSection(re),me=u.getCharCode(re);if(If[me]||(H+=qg(me,ue,m,v,s,C)),re<u.length()-1){const be=!((K=me)<11904||!(Vt["Bopomofo Extended"](K)||Vt.Bopomofo(K)||Vt["CJK Compatibility Forms"](K)||Vt["CJK Compatibility Ideographs"](K)||Vt["CJK Compatibility"](K)||Vt["CJK Radicals Supplement"](K)||Vt["CJK Strokes"](K)||Vt["CJK Symbols and Punctuation"](K)||Vt["CJK Unified Ideographs Extension A"](K)||Vt["CJK Unified Ideographs"](K)||Vt["Enclosed CJK Letters and Months"](K)||Vt["Halfwidth and Fullwidth Forms"](K)||Vt.Hiragana(K)||Vt["Ideographic Description Characters"](K)||Vt["Kangxi Radicals"](K)||Vt["Katakana Phonetic Extensions"](K)||Vt.Katakana(K)||Vt["Vertical Forms"](K)||Vt["Yi Radicals"](K)||Vt["Yi Syllables"](K)));(a2[me]||be||ue.imageName)&&L.push(Gg(re+1,H,P,L,l2(me,u.getCharCode(re+1),be&&O),!1))}}var K;return Hg(Gg(u.length(),H,P,L,0,!0))}function yp(u){let s=.5,h=.5;switch(u){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(u){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:s,verticalAlign:h}}function c2(u,s,h,m,v){if(!m&&!v)return;const S=u[h],C=(u[h].x+S.metrics.advance*S.scale)*m;for(let L=s;L<=h;L++)u[L].x-=C,u[L].y+=v}function u2(u,s,h){const{horizontalAlign:m,verticalAlign:v}=yp(h),S=s[0]-u.displaySize[0]*m,C=s[1]-u.displaySize[1]*v;return{image:u,top:C,bottom:C+u.displaySize[1],left:S,right:S+u.displaySize[0]}}function Wg(u,s,h,m,v,S){const C=u.image;let L;if(C.content){const Te=C.content,Ae=C.pixelRatio||1;L=[Te[0]/Ae,Te[1]/Ae,C.displaySize[0]-Te[2]/Ae,C.displaySize[1]-Te[3]/Ae]}const P=s.left*S,O=s.right*S;let H,K,re,ue;h==="width"||h==="both"?(ue=v[0]+P-m[3],K=v[0]+O+m[1]):(ue=v[0]+(P+O-C.displaySize[0])/2,K=ue+C.displaySize[0]);const me=s.top*S,be=s.bottom*S;return h==="height"||h==="both"?(H=v[1]+me-m[0],re=v[1]+be+m[2]):(H=v[1]+(me+be-C.displaySize[1])/2,re=H+C.displaySize[1]),{image:C,top:H,right:K,bottom:re,left:ue,collisionPadding:L}}const $u=255,Cs=128,ya=$u*Cs;function Kg(u,s){const{expression:h}=s;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new Sr(u+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:v}=h;let S=0;for(;S<m.length&&m[S]<=u;)S++;S=Math.max(0,S-1);let C=S;for(;C<m.length&&m[C]<u+1;)C++;C=Math.min(m.length-1,C);const L=m[S],P=m[C];return h.kind==="composite"?{kind:"composite",minZoom:L,maxZoom:P,interpolationType:v}:{kind:"camera",minZoom:L,maxZoom:P,minSize:h.evaluate(new Sr(L)),maxSize:h.evaluate(new Sr(P)),interpolationType:v}}}function bp(u,s,h){let m="never";const v=u.get(s);return v?m=v:u.get(h)&&(m="always"),m}const h2=ga.VectorTileFeature.types,f2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Af(u,s,h,m,v,S,C,L,P,O,H,K,re){const ue=L?Math.min(ya,Math.round(L[0])):0,me=L?Math.min(ya,Math.round(L[1])):0;u.emplaceBack(s,h,Math.round(32*m),Math.round(32*v),S,C,(ue<<1)+(P?1:0),me,16*O,16*H,256*K,256*re)}function vp(u,s,h){u.emplaceBack(s.x,s.y,h),u.emplaceBack(s.x,s.y,h),u.emplaceBack(s.x,s.y,h),u.emplaceBack(s.x,s.y,h)}function d2(u){for(const s of u.sections)if(Jd(s.text))return!0;return!1}class wp{constructor(s){this.layoutVertexArray=new Je,this.indexArray=new ot,this.programConfigurations=s,this.segments=new Dt,this.dynamicLayoutVertexArray=new Le,this.opacityVertexArray=new je,this.hasVisibleVertices=!1,this.placedSymbolArray=new f}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(s,h,m,v){this.isEmpty()||(m&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,qw.members),this.indexBuffer=s.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,Zw.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,f2,!0),this.opacityVertexBuffer.itemSize=1),(m||v)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ht("SymbolBuffers",wp);class xp{constructor(s,h,m){this.layoutVertexArray=new s,this.layoutAttributes=h,this.indexArray=new m,this.segments=new Dt,this.collisionVertexArray=new rt}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,Gw.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ht("CollisionBuffers",xp);class _c{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(C=>C.id),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Qd([]),this.placementViewportMatrix=Qd([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Kg(this.zoom,h["text-size"]),this.iconSizeData=Kg(this.zoom,h["icon-size"]);const m=this.layers[0].layout,v=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.canOverlap=bp(m,"text-overlap","text-allow-overlap")!=="never"||bp(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(C=>c.ah[C])),this.stateDependentLayerIds=this.layers.filter(C=>C.isStateDependent()).map(C=>C.id),this.sourceID=s.sourceID}createArrays(){this.text=new wp(new Ir(this.layers,this.zoom,s=>/^text/.test(s))),this.icon=new wp(new Ir(this.layers,this.zoom,s=>/^icon/.test(s))),this.glyphOffsetArray=new k,this.lineVertexArray=new E,this.symbolInstances=new b,this.textAnchorOffsets=new B}calculateGlyphDependencies(s,h,m,v,S){for(let C=0;C<s.length;C++)if(h[s.charCodeAt(C)]=!0,(m||v)&&S){const L=Pu[s.charAt(C)];L&&(h[L.charCodeAt(0)]=!0)}}populate(s,h,m){const v=this.layers[0],S=v.layout,C=S.get("text-font"),L=S.get("text-field"),P=S.get("icon-image"),O=(L.value.kind!=="constant"||L.value.value instanceof Ki&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&(C.value.kind!=="constant"||C.value.value.length>0),H=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,K=S.get("symbol-sort-key");if(this.features=[],!O&&!H)return;const re=h.iconDependencies,ue=h.glyphDependencies,me=h.availableImages,be=new Sr(this.zoom);for(const{feature:Te,id:Ae,index:qe,sourceLayerIndex:$e}of s){const Oe=v._featureFilter.needGeometry,ht=Bs(Te,Oe);if(!v._featureFilter.filter(be,ht,m))continue;let ft,Zt;if(Oe||(ht.geometry=Fs(Te)),O){const qt=v.getValueAndResolveTokens("text-field",ht,m,me),jt=Ki.factory(qt),zt=this.hasRTLText=this.hasRTLText||d2(jt);(!zt||ws.getRTLTextPluginStatus()==="unavailable"||zt&&ws.isParsed())&&(ft=Ww(jt,v,ht))}if(H){const qt=v.getValueAndResolveTokens("icon-image",ht,m,me);Zt=qt instanceof fo?qt:fo.fromString(qt)}if(!ft&&!Zt)continue;const Yt=this.sortFeaturesByKey?K.evaluate(ht,{},m):void 0;if(this.features.push({id:Ae,text:ft,icon:Zt,index:qe,sourceLayerIndex:$e,geometry:ht.geometry,properties:Te.properties,type:h2[Te.type],sortKey:Yt}),Zt&&(re[Zt.name]=!0),ft){const qt=C.evaluate(ht,{},m).join(","),jt=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(c.ah.vertical)>=0;for(const zt of ft.sections)if(zt.image)re[zt.image.name]=!0;else{const Xt=pa(ft.toString()),Bt=zt.fontStack||qt,kt=ue[Bt]=ue[Bt]||{};this.calculateGlyphDependencies(zt.text,kt,jt,this.allowVerticalPlacement,Xt)}}}S.get("symbol-placement")==="line"&&(this.features=function(Te){const Ae={},qe={},$e=[];let Oe=0;function ht(qt){$e.push(Te[qt]),Oe++}function ft(qt,jt,zt){const Xt=qe[qt];return delete qe[qt],qe[jt]=Xt,$e[Xt].geometry[0].pop(),$e[Xt].geometry[0]=$e[Xt].geometry[0].concat(zt[0]),Xt}function Zt(qt,jt,zt){const Xt=Ae[jt];return delete Ae[jt],Ae[qt]=Xt,$e[Xt].geometry[0].shift(),$e[Xt].geometry[0]=zt[0].concat($e[Xt].geometry[0]),Xt}function Yt(qt,jt,zt){const Xt=zt?jt[0][jt[0].length-1]:jt[0][0];return`${qt}:${Xt.x}:${Xt.y}`}for(let qt=0;qt<Te.length;qt++){const jt=Te[qt],zt=jt.geometry,Xt=jt.text?jt.text.toString():null;if(!Xt){ht(qt);continue}const Bt=Yt(Xt,zt),kt=Yt(Xt,zt,!0);if(Bt in qe&&kt in Ae&&qe[Bt]!==Ae[kt]){const cn=Zt(Bt,kt,zt),rn=ft(Bt,kt,$e[cn].geometry);delete Ae[Bt],delete qe[kt],qe[Yt(Xt,$e[rn].geometry,!0)]=rn,$e[cn].geometry=null}else Bt in qe?ft(Bt,kt,zt):kt in Ae?Zt(Bt,kt,zt):(ht(qt),Ae[Bt]=Oe-1,qe[kt]=Oe-1)}return $e.filter(qt=>qt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Te,Ae)=>Te.sortKey-Ae.sortKey)}update(s,h,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(s,h,this.layers,m),this.icon.programConfigurations.updatePaintArrays(s,h,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,h){const m=this.lineVertexArray.length;if(s.segment!==void 0){let v=s.dist(h[s.segment+1]),S=s.dist(h[s.segment]);const C={};for(let L=s.segment+1;L<h.length;L++)C[L]={x:h[L].x,y:h[L].y,tileUnitDistanceFromAnchor:v},L<h.length-1&&(v+=h[L+1].dist(h[L]));for(let L=s.segment||0;L>=0;L--)C[L]={x:h[L].x,y:h[L].y,tileUnitDistanceFromAnchor:S},L>0&&(S+=h[L-1].dist(h[L]));for(let L=0;L<h.length;L++){const P=C[L];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(s,h,m,v,S,C,L,P,O,H,K,re){const ue=s.indexArray,me=s.layoutVertexArray,be=s.segments.prepareSegment(4*h.length,me,ue,this.canOverlap?C.sortKey:void 0),Te=this.glyphOffsetArray.length,Ae=be.vertexLength,qe=this.allowVerticalPlacement&&L===c.ah.vertical?Math.PI/2:0,$e=C.text&&C.text.sections;for(let Oe=0;Oe<h.length;Oe++){const{tl:ht,tr:ft,bl:Zt,br:Yt,tex:qt,pixelOffsetTL:jt,pixelOffsetBR:zt,minFontScaleX:Xt,minFontScaleY:Bt,glyphOffset:kt,isSDF:cn,sectionIndex:rn}=h[Oe],Fn=be.vertexLength,br=kt[1];Af(me,P.x,P.y,ht.x,br+ht.y,qt.x,qt.y,m,cn,jt.x,jt.y,Xt,Bt),Af(me,P.x,P.y,ft.x,br+ft.y,qt.x+qt.w,qt.y,m,cn,zt.x,jt.y,Xt,Bt),Af(me,P.x,P.y,Zt.x,br+Zt.y,qt.x,qt.y+qt.h,m,cn,jt.x,zt.y,Xt,Bt),Af(me,P.x,P.y,Yt.x,br+Yt.y,qt.x+qt.w,qt.y+qt.h,m,cn,zt.x,zt.y,Xt,Bt),vp(s.dynamicLayoutVertexArray,P,qe),ue.emplaceBack(Fn,Fn+1,Fn+2),ue.emplaceBack(Fn+1,Fn+2,Fn+3),be.vertexLength+=4,be.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(kt[0]),Oe!==h.length-1&&rn===h[Oe+1].sectionIndex||s.programConfigurations.populatePaintArrays(me.length,C,C.index,{},re,$e&&$e[rn])}s.placedSymbolArray.emplaceBack(P.x,P.y,Te,this.glyphOffsetArray.length-Te,Ae,O,H,P.segment,m?m[0]:0,m?m[1]:0,v[0],v[1],L,0,!1,0,K)}_addCollisionDebugVertex(s,h,m,v,S,C){return h.emplaceBack(0,0),s.emplaceBack(m.x,m.y,v,S,Math.round(C.x),Math.round(C.y))}addCollisionDebugVertices(s,h,m,v,S,C,L){const P=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),O=P.vertexLength,H=S.layoutVertexArray,K=S.collisionVertexArray,re=L.anchorX,ue=L.anchorY;this._addCollisionDebugVertex(H,K,C,re,ue,new y(s,h)),this._addCollisionDebugVertex(H,K,C,re,ue,new y(m,h)),this._addCollisionDebugVertex(H,K,C,re,ue,new y(m,v)),this._addCollisionDebugVertex(H,K,C,re,ue,new y(s,v)),P.vertexLength+=4;const me=S.indexArray;me.emplaceBack(O,O+1),me.emplaceBack(O+1,O+2),me.emplaceBack(O+2,O+3),me.emplaceBack(O+3,O),P.primitiveLength+=4}addDebugCollisionBoxes(s,h,m,v){for(let S=s;S<h;S++){const C=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(C.x1,C.y1,C.x2,C.y2,v?this.textCollisionBox:this.iconCollisionBox,C.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new xp(Qe,zg.members,_t),this.iconCollisionBox=new xp(Qe,zg.members,_t);for(let s=0;s<this.symbolInstances.length;s++){const h=this.symbolInstances.get(s);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(s,h,m,v,S,C,L,P,O){const H={};for(let K=h;K<m;K++){const re=s.get(K);H.textBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},H.textFeatureIndex=re.featureIndex;break}for(let K=v;K<S;K++){const re=s.get(K);H.verticalTextBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},H.verticalTextFeatureIndex=re.featureIndex;break}for(let K=C;K<L;K++){const re=s.get(K);H.iconBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},H.iconFeatureIndex=re.featureIndex;break}for(let K=P;K<O;K++){const re=s.get(K);H.verticalIconBox={x1:re.x1,y1:re.y1,x2:re.x2,y2:re.y2,anchorPointX:re.anchorPointX,anchorPointY:re.anchorPointY},H.verticalIconFeatureIndex=re.featureIndex;break}return H}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const m=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(s,h){const m=s.placedSymbolArray.get(h),v=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<v;S+=4)s.indexArray.emplaceBack(S,S+1,S+2),s.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(s),m=Math.cos(s),v=[],S=[],C=[];for(let L=0;L<this.symbolInstances.length;++L){C.push(L);const P=this.symbolInstances.get(L);v.push(0|Math.round(h*P.anchorX+m*P.anchorY)),S.push(P.featureIndex)}return C.sort((L,P)=>v[L]-v[P]||S[P]-S[L]),C}addToSortKeyRanges(s,h){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===h?m.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const m=this.symbolInstances.get(h);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((v,S,C)=>{v>=0&&C.indexOf(v)===S&&this.addIndicesForPlacedSymbol(this.text,v)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Xg,Jg;Ht("SymbolBucket",_c,{omit:["layers","collisionBoxArray","features","compareText"]}),_c.MAX_GLYPHS=65535,_c.addDynamicAttributes=vp;var kp={get paint(){return Jg=Jg||new Fi({"icon-opacity":new un(_e.paint_symbol["icon-opacity"]),"icon-color":new un(_e.paint_symbol["icon-color"]),"icon-halo-color":new un(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new un(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new un(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new on(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new on(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new un(_e.paint_symbol["text-opacity"]),"text-color":new un(_e.paint_symbol["text-color"],{runtimeType:wn,getOverride:u=>u.textColor,hasOverride:u=>!!u.textColor}),"text-halo-color":new un(_e.paint_symbol["text-halo-color"]),"text-halo-width":new un(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new un(_e.paint_symbol["text-halo-blur"]),"text-translate":new on(_e.paint_symbol["text-translate"]),"text-translate-anchor":new on(_e.paint_symbol["text-translate-anchor"])})},get layout(){return Xg=Xg||new Fi({"symbol-placement":new on(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new on(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new on(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new un(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new on(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new on(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new on(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new on(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new on(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new on(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new un(_e.layout_symbol["icon-size"]),"icon-text-fit":new on(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new on(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new un(_e.layout_symbol["icon-image"]),"icon-rotate":new un(_e.layout_symbol["icon-rotate"]),"icon-padding":new un(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new on(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new un(_e.layout_symbol["icon-offset"]),"icon-anchor":new un(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new on(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new on(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new on(_e.layout_symbol["text-rotation-alignment"]),"text-field":new un(_e.layout_symbol["text-field"]),"text-font":new un(_e.layout_symbol["text-font"]),"text-size":new un(_e.layout_symbol["text-size"]),"text-max-width":new un(_e.layout_symbol["text-max-width"]),"text-line-height":new on(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new un(_e.layout_symbol["text-letter-spacing"]),"text-justify":new un(_e.layout_symbol["text-justify"]),"text-radial-offset":new un(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new on(_e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new un(_e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new un(_e.layout_symbol["text-anchor"]),"text-max-angle":new on(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new on(_e.layout_symbol["text-writing-mode"]),"text-rotate":new un(_e.layout_symbol["text-rotate"]),"text-padding":new on(_e.layout_symbol["text-padding"]),"text-keep-upright":new on(_e.layout_symbol["text-keep-upright"]),"text-transform":new un(_e.layout_symbol["text-transform"]),"text-offset":new un(_e.layout_symbol["text-offset"]),"text-allow-overlap":new on(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new on(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new on(_e.layout_symbol["text-ignore-placement"]),"text-optional":new on(_e.layout_symbol["text-optional"])})}};class Yg{constructor(s){if(s.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=s.property.overrides?s.property.overrides.runtimeType:Rn,this.defaultValue=s}evaluate(s){if(s.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(s.formattedSection))return h.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ht("FormatSectionOverride",Yg,{omit:["defaultValue"]});class Pf extends ko{constructor(s){super(s,kp)}recalculate(s,h){if(super.recalculate(s,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const v=[];for(const S of m)v.indexOf(S)<0&&v.push(S);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(s,h,m,v){const S=this.layout.get(s).evaluate(h,{},m,v),C=this._unevaluatedLayout._values[s];return C.isDataDriven()||fr(C.value)||!S?S:function(L,P){return P.replace(/{([^{}]+)}/g,(O,H)=>L&&H in L?String(L[H]):"")}(h.properties,S)}createBucket(s){return new _c(s)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const s of kp.paint.overridableProperties){if(!Pf.hasPaintOverride(this.layout,s))continue;const h=this.paint.get(s),m=new Yg(h),v=new yr(m,h.property.specification);let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new Nl("source",v):new Yc("composite",v,h.value.zoomStops),this.paint._values[s]=new xo(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(s,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&Pf.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,h){const m=s.get("text-field"),v=kp.paint.properties[h];let S=!1;const C=L=>{for(const P of L)if(v.overrides&&v.overrides.hasOverride(P))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Ki)C(m.value.value.sections);else if(m.value.kind==="source"){const L=O=>{S||(O instanceof gs&&Zr(O.value)===_r?C(O.value.sections):O instanceof Bl?C(O.sections):O.eachChild(L))},P=m.value;P._styleExpression&&L(P._styleExpression.expression)}return S}}let Qg;var p2={get paint(){return Qg=Qg||new Fi({"background-color":new on(_e.paint_background["background-color"]),"background-pattern":new nl(_e.paint_background["background-pattern"]),"background-opacity":new on(_e.paint_background["background-opacity"])})}};class m2 extends ko{constructor(s){super(s,p2)}}let e_;var g2={get paint(){return e_=e_||new Fi({"raster-opacity":new on(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new on(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new on(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new on(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new on(_e.paint_raster["raster-saturation"]),"raster-contrast":new on(_e.paint_raster["raster-contrast"]),"raster-resampling":new on(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new on(_e.paint_raster["raster-fade-duration"])})}};class _2 extends ko{constructor(s){super(s,g2)}}class y2 extends ko{constructor(s){super(s,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=s}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class b2{constructor(s){this._methodToThrottle=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Sp=63710088e-1;class ba{constructor(s,h){if(isNaN(s)||isNaN(h))throw new Error(`Invalid LngLat object: (${s}, ${h})`);if(this.lng=+s,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ba(oe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const h=Math.PI/180,m=this.lat*h,v=s.lat*h,S=Math.sin(m)*Math.sin(v)+Math.cos(m)*Math.cos(v)*Math.cos((s.lng-this.lng)*h);return Sp*Math.acos(Math.min(S,1))}static convert(s){if(s instanceof ba)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new ba(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new ba(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const t_=2*Math.PI*Sp;function n_(u){return t_*Math.cos(u*Math.PI/180)}function r_(u){return(180+u)/360}function i_(u){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+u*Math.PI/360)))/360}function o_(u,s){return u/n_(s)}function Cp(u){return 360/Math.PI*Math.atan(Math.exp((180-360*u)*Math.PI/180))-90}class zf{constructor(s,h,m=0){this.x=+s,this.y=+h,this.z=+m}static fromLngLat(s,h=0){const m=ba.convert(s);return new zf(r_(m.lng),i_(m.lat),o_(h,m.lat))}toLngLat(){return new ba(360*this.x-180,Cp(this.y))}toAltitude(){return this.z*n_(Cp(this.y))}meterInMercatorCoordinateUnits(){return 1/t_*(s=Cp(this.y),1/Math.cos(s*Math.PI/180));var s}}function s_(u,s,h){var m=2*Math.PI*6378137/256/Math.pow(2,h);return[u*m-2*Math.PI*6378137/2,s*m-2*Math.PI*6378137/2]}class Tp{constructor(s,h,m){if(s<0||s>25||m<0||m>=Math.pow(2,s)||h<0||h>=Math.pow(2,s))throw new Error(`x=${h}, y=${m}, z=${s} outside of bounds. 0<=x<${Math.pow(2,s)}, 0<=y<${Math.pow(2,s)} 0<=z<=25 `);this.z=s,this.x=h,this.y=m,this.key=Ru(0,s,s,h,m)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}url(s,h,m){const v=(C=this.y,L=this.z,P=s_(256*(S=this.x),256*(C=Math.pow(2,L)-C-1),L),O=s_(256*(S+1),256*(C+1),L),P[0]+","+P[1]+","+O[0]+","+O[1]);var S,C,L,P,O;const H=function(K,re,ue){let me,be="";for(let Te=K;Te>0;Te--)me=1<<Te-1,be+=(re&me?1:0)+(ue&me?2:0);return be}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,H).replace(/{bbox-epsg-3857}/g,v)}isChildOf(s){const h=this.z-s.z;return h>0&&s.x===this.x>>h&&s.y===this.y>>h}getTilePoint(s){const h=Math.pow(2,this.z);return new y((s.x*h-this.x)*Or,(s.y*h-this.y)*Or)}toString(){return`${this.z}/${this.x}/${this.y}`}}class a_{constructor(s,h){this.wrap=s,this.canonical=h,this.key=Ru(s,h.z,h.z,h.x,h.y)}}class Co{constructor(s,h,m,v,S){if(s<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${s}; z = ${m}`);this.overscaledZ=s,this.wrap=h,this.canonical=new Tp(m,+v,+S),this.key=Ru(h,s,m,v,S)}clone(){return new Co(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-s;return s>this.canonical.z?new Co(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Co(s,this.wrap,s,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(s,h){if(s>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${s}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-s;return s>this.canonical.z?Ru(this.wrap*+h,s,this.canonical.z,this.canonical.x,this.canonical.y):Ru(this.wrap*+h,s,s,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(s){if(s.wrap!==this.wrap)return!1;const h=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.x===this.canonical.x>>h&&s.canonical.y===this.canonical.y>>h}children(s){if(this.overscaledZ>=s)return[new Co(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,m=2*this.canonical.x,v=2*this.canonical.y;return[new Co(h,this.wrap,h,m,v),new Co(h,this.wrap,h,m+1,v),new Co(h,this.wrap,h,m,v+1),new Co(h,this.wrap,h,m+1,v+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new Co(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new Co(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new a_(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(s){return this.canonical.getTilePoint(new zf(s.x-this.wrap,s.y))}}function Ru(u,s,h,m,v){(u*=2)<0&&(u=-1*u-1);const S=1<<h;return(S*S*u+S*v+m).toString(36)+h.toString(36)+s.toString(36)}Ht("CanonicalTileID",Tp),Ht("OverscaledTileID",Co,{omit:["posMatrix"]});class l_{constructor(s,h,m,v=1,S=1,C=1,L=0){if(this.uid=s,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void Pe(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const P=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=S,this.blueFactor=C,this.baseShift=L;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let O=0;O<P;O++)this.data[this._idx(-1,O)]=this.data[this._idx(0,O)],this.data[this._idx(P,O)]=this.data[this._idx(P-1,O)],this.data[this._idx(O,-1)]=this.data[this._idx(O,0)],this.data[this._idx(O,P)]=this.data[this._idx(O,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let O=0;O<P;O++)for(let H=0;H<P;H++){const K=this.get(O,H);K>this.max&&(this.max=K),K<this.min&&(this.min=K)}}get(s,h){const m=new Uint8Array(this.data.buffer),v=4*this._idx(s,h);return this.unpack(m[v],m[v+1],m[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(s,h){if(s<-1||s>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(s+1)}unpack(s,h,m){return s*this.redFactor+h*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new So({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(s,h,m){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let v=h*this.dim,S=h*this.dim+this.dim,C=m*this.dim,L=m*this.dim+this.dim;switch(h){case-1:v=S-1;break;case 1:S=v+1}switch(m){case-1:C=L-1;break;case 1:L=C+1}const P=-h*this.dim,O=-m*this.dim;for(let H=C;H<L;H++)for(let K=v;K<S;K++)this.data[this._idx(K,H)]=s.data[this._idx(K+P,H+O)]}}Ht("DEMData",l_);class c_{constructor(s){this._stringToNumber={},this._numberToString=[];for(let h=0;h<s.length;h++){const m=s[h];this._stringToNumber[m]=h,this._numberToString[h]=m}}encode(s){return this._stringToNumber[s]}decode(s){if(s>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${s} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[s]}}class u_{constructor(s,h,m,v,S){this.type="Feature",this._vectorTileFeature=s,s._z=h,s._x=m,s._y=v,this.properties=s.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(s[h]=this[h]);return s}}class h_{constructor(s,h){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Qa(Or,16,0),this.grid3D=new Qa(Or,16,0),this.featureIndexArray=new X,this.promoteId=h}insert(s,h,m,v,S,C){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,v,S);const P=C?this.grid3D:this.grid;for(let O=0;O<h.length;O++){const H=h[O],K=[1/0,1/0,-1/0,-1/0];for(let re=0;re<H.length;re++){const ue=H[re];K[0]=Math.min(K[0],ue.x),K[1]=Math.min(K[1],ue.y),K[2]=Math.max(K[2],ue.x),K[3]=Math.max(K[3],ue.y)}K[0]<Or&&K[1]<Or&&K[2]>=0&&K[3]>=0&&P.insert(L,K[0],K[1],K[2],K[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ga.VectorTile(new pp(this.rawTileData)).layers,this.sourceLayerCoder=new c_(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(s,h,m,v){this.loadVTLayers();const S=s.params||{},C=Or/s.tileSize/s.scale,L=ql(S.filter),P=s.queryGeometry,O=s.queryPadding*C,H=d_(P),K=this.grid.query(H.minX-O,H.minY-O,H.maxX+O,H.maxY+O),re=d_(s.cameraQueryGeometry),ue=this.grid3D.query(re.minX-O,re.minY-O,re.maxX+O,re.maxY+O,(Te,Ae,qe,$e)=>function(Oe,ht,ft,Zt,Yt){for(const jt of Oe)if(ht<=jt.x&&ft<=jt.y&&Zt>=jt.x&&Yt>=jt.y)return!0;const qt=[new y(ht,ft),new y(ht,Yt),new y(Zt,Yt),new y(Zt,ft)];if(Oe.length>2){for(const jt of qt)if(uc(Oe,jt))return!0}for(let jt=0;jt<Oe.length-1;jt++)if(Jv(Oe[jt],Oe[jt+1],qt))return!0;return!1}(s.cameraQueryGeometry,Te-O,Ae-O,qe+O,$e+O));for(const Te of ue)K.push(Te);K.sort(v2);const me={};let be;for(let Te=0;Te<K.length;Te++){const Ae=K[Te];if(Ae===be)continue;be=Ae;const qe=this.featureIndexArray.get(Ae);let $e=null;this.loadMatchingFeature(me,qe.bucketIndex,qe.sourceLayerIndex,qe.featureIndex,L,S.layers,S.availableImages,h,m,v,(Oe,ht,ft)=>($e||($e=Fs(Oe)),ht.queryIntersectsFeature(P,Oe,ft,$e,this.z,s.transform,C,s.pixelPosMatrix)))}return me}loadMatchingFeature(s,h,m,v,S,C,L,P,O,H,K){const re=this.bucketLayerIDs[h];if(C&&!function(Te,Ae){for(let qe=0;qe<Te.length;qe++)if(Ae.indexOf(Te[qe])>=0)return!0;return!1}(C,re))return;const ue=this.sourceLayerCoder.decode(m),me=this.vtLayers[ue].feature(v);if(S.needGeometry){const Te=Bs(me,!0);if(!S.filter(new Sr(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!S.filter(new Sr(this.tileID.overscaledZ),me))return;const be=this.getId(me,ue);for(let Te=0;Te<re.length;Te++){const Ae=re[Te];if(C&&C.indexOf(Ae)<0)continue;const qe=P[Ae];if(!qe)continue;let $e={};be&&H&&($e=H.getState(qe.sourceLayer||"_geojsonTileLayer",be));const Oe=J({},O[Ae]);Oe.paint=f_(Oe.paint,qe.paint,me,$e,L),Oe.layout=f_(Oe.layout,qe.layout,me,$e,L);const ht=!K||K(me,qe,$e);if(!ht)continue;const ft=new u_(me,this.z,this.x,this.y,be);ft.layer=Oe;let Zt=s[Ae];Zt===void 0&&(Zt=s[Ae]=[]),Zt.push({featureIndex:v,feature:ft,intersectionZ:ht})}}lookupSymbolFeatures(s,h,m,v,S,C,L,P){const O={};this.loadVTLayers();const H=ql(S);for(const K of s)this.loadMatchingFeature(O,m,v,K,H,C,L,P,h);return O}hasLayer(s){for(const h of this.bucketLayerIDs)for(const m of h)if(s===m)return!0;return!1}getId(s,h){let m=s.id;return this.promoteId&&(m=s.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof m=="boolean"&&(m=Number(m))),m}}function f_(u,s,h,m,v){return pe(u,(S,C)=>{const L=s instanceof tl?s.get(C):null;return L&&L.evaluate?L.evaluate(h,m,v):L})}function d_(u){let s=1/0,h=1/0,m=-1/0,v=-1/0;for(const S of u)s=Math.min(s,S.x),h=Math.min(h,S.y),m=Math.max(m,S.x),v=Math.max(v,S.y);return{minX:s,minY:h,maxX:m,maxY:v}}function v2(u,s){return s-u}function p_(u,s,h,m,v){const S=[];for(let C=0;C<u.length;C++){const L=u[C];let P;for(let O=0;O<L.length-1;O++){let H=L[O],K=L[O+1];H.x<s&&K.x<s||(H.x<s?H=new y(s,H.y+(s-H.x)/(K.x-H.x)*(K.y-H.y))._round():K.x<s&&(K=new y(s,H.y+(s-H.x)/(K.x-H.x)*(K.y-H.y))._round()),H.y<h&&K.y<h||(H.y<h?H=new y(H.x+(h-H.y)/(K.y-H.y)*(K.x-H.x),h)._round():K.y<h&&(K=new y(H.x+(h-H.y)/(K.y-H.y)*(K.x-H.x),h)._round()),H.x>=m&&K.x>=m||(H.x>=m?H=new y(m,H.y+(m-H.x)/(K.x-H.x)*(K.y-H.y))._round():K.x>=m&&(K=new y(m,H.y+(m-H.x)/(K.x-H.x)*(K.y-H.y))._round()),H.y>=v&&K.y>=v||(H.y>=v?H=new y(H.x+(v-H.y)/(K.y-H.y)*(K.x-H.x),v)._round():K.y>=v&&(K=new y(H.x+(v-H.y)/(K.y-H.y)*(K.x-H.x),v)._round()),P&&H.equals(P[P.length-1])||(P=[H],S.push(P)),P.push(K)))))}}return S}Ht("FeatureIndex",h_,{omit:["rawTileData","sourceLayerCoder"]});class va extends y{constructor(s,h,m,v){super(s,h),this.angle=m,v!==void 0&&(this.segment=v)}clone(){return new va(this.x,this.y,this.angle,this.segment)}}function m_(u,s,h,m,v){if(s.segment===void 0||h===0)return!0;let S=s,C=s.segment+1,L=0;for(;L>-h/2;){if(C--,C<0)return!1;L-=u[C].dist(S),S=u[C]}L+=u[C].dist(u[C+1]),C++;const P=[];let O=0;for(;L<h/2;){const H=u[C],K=u[C+1];if(!K)return!1;let re=u[C-1].angleTo(H)-H.angleTo(K);for(re=Math.abs((re+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:L,angleDelta:re}),O+=re;L-P[0].distance>m;)O-=P.shift().angleDelta;if(O>v)return!1;C++,L+=H.dist(K)}return!0}function g_(u){let s=0;for(let h=0;h<u.length-1;h++)s+=u[h].dist(u[h+1]);return s}function __(u,s,h){return u?.6*s*h:0}function y_(u,s){return Math.max(u?u.right-u.left:0,s?s.right-s.left:0)}function w2(u,s,h,m,v,S){const C=__(h,v,S),L=y_(h,m)*S;let P=0;const O=g_(u)/2;for(let H=0;H<u.length-1;H++){const K=u[H],re=u[H+1],ue=K.dist(re);if(P+ue>O){const me=(O-P)/ue,be=Mi.number(K.x,re.x,me),Te=Mi.number(K.y,re.y,me),Ae=new va(be,Te,re.angleTo(K),H);return Ae._round(),!C||m_(u,Ae,L,C,s)?Ae:void 0}P+=ue}}function x2(u,s,h,m,v,S,C,L,P){const O=__(m,S,C),H=y_(m,v),K=H*C,re=u[0].x===0||u[0].x===P||u[0].y===0||u[0].y===P;return s-K<s/4&&(s=K+s/4),b_(u,re?s/2*L%s:(H/2+2*S)*C*L%s,s,O,h,K,re,!1,P)}function b_(u,s,h,m,v,S,C,L,P){const O=S/2,H=g_(u);let K=0,re=s-h,ue=[];for(let me=0;me<u.length-1;me++){const be=u[me],Te=u[me+1],Ae=be.dist(Te),qe=Te.angleTo(be);for(;re+h<K+Ae;){re+=h;const $e=(re-K)/Ae,Oe=Mi.number(be.x,Te.x,$e),ht=Mi.number(be.y,Te.y,$e);if(Oe>=0&&Oe<P&&ht>=0&&ht<P&&re-O>=0&&re+O<=H){const ft=new va(Oe,ht,qe,me);ft._round(),m&&!m_(u,ft,S,m,v)||ue.push(ft)}}K+=Ae}return L||ue.length||C||(ue=b_(u,K/2,h,m,v,S,C,!0,P)),ue}Ht("Anchor",va);const yc=eo;function v_(u,s,h,m){const v=[],S=u.image,C=S.pixelRatio,L=S.paddedRect.w-2*yc,P=S.paddedRect.h-2*yc,O=u.right-u.left,H=u.bottom-u.top,K=S.stretchX||[[0,L]],re=S.stretchY||[[0,P]],ue=(zt,Xt)=>zt+Xt[1]-Xt[0],me=K.reduce(ue,0),be=re.reduce(ue,0),Te=L-me,Ae=P-be;let qe=0,$e=me,Oe=0,ht=be,ft=0,Zt=Te,Yt=0,qt=Ae;if(S.content&&m){const zt=S.content;qe=Df(K,0,zt[0]),Oe=Df(re,0,zt[1]),$e=Df(K,zt[0],zt[2]),ht=Df(re,zt[1],zt[3]),ft=zt[0]-qe,Yt=zt[1]-Oe,Zt=zt[2]-zt[0]-$e,qt=zt[3]-zt[1]-ht}const jt=(zt,Xt,Bt,kt)=>{const cn=$f(zt.stretch-qe,$e,O,u.left),rn=Rf(zt.fixed-ft,Zt,zt.stretch,me),Fn=$f(Xt.stretch-Oe,ht,H,u.top),br=Rf(Xt.fixed-Yt,qt,Xt.stretch,be),Tr=$f(Bt.stretch-qe,$e,O,u.left),oi=Rf(Bt.fixed-ft,Zt,Bt.stretch,me),go=$f(kt.stretch-Oe,ht,H,u.top),Oi=Rf(kt.fixed-Yt,qt,kt.stretch,be),Kr=new y(cn,Fn),gi=new y(Tr,Fn),xi=new y(Tr,go),Ni=new y(cn,go),ji=new y(rn/C,br/C),si=new y(oi/C,Oi/C),ai=s*Math.PI/180;if(ai){const Ii=Math.sin(ai),to=Math.cos(ai),no=[to,-Ii,Ii,to];Kr._matMult(no),gi._matMult(no),Ni._matMult(no),xi._matMult(no)}const Ei=zt.stretch+zt.fixed,Ui=Xt.stretch+Xt.fixed;return{tl:Kr,tr:gi,bl:Ni,br:xi,tex:{x:S.paddedRect.x+yc+Ei,y:S.paddedRect.y+yc+Ui,w:Bt.stretch+Bt.fixed-Ei,h:kt.stretch+kt.fixed-Ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ji,pixelOffsetBR:si,minFontScaleX:Zt/C/O,minFontScaleY:qt/C/H,isSDF:h}};if(m&&(S.stretchX||S.stretchY)){const zt=w_(K,Te,me),Xt=w_(re,Ae,be);for(let Bt=0;Bt<zt.length-1;Bt++){const kt=zt[Bt],cn=zt[Bt+1];for(let rn=0;rn<Xt.length-1;rn++)v.push(jt(kt,Xt[rn],cn,Xt[rn+1]))}}else v.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:P+1}));return v}function Df(u,s,h){let m=0;for(const v of u)m+=Math.max(s,Math.min(h,v[1]))-Math.max(s,Math.min(h,v[0]));return m}function w_(u,s,h){const m=[{fixed:-yc,stretch:0}];for(const[v,S]of u){const C=m[m.length-1];m.push({fixed:v-C.stretch,stretch:C.stretch}),m.push({fixed:v-C.stretch,stretch:C.stretch+(S-v)})}return m.push({fixed:s+yc,stretch:h}),m}function $f(u,s,h,m){return u/s*h+m}function Rf(u,s,h,m){return u-s*h/m}class Ff{constructor(s,h,m,v,S,C,L,P,O,H){if(this.boxStartIndex=s.length,O){let K=C.top,re=C.bottom;const ue=C.collisionPadding;ue&&(K-=ue[1],re+=ue[3]);let me=re-K;me>0&&(me=Math.max(10,me),this.circleDiameter=me)}else{let K=C.top*L-P[0],re=C.bottom*L+P[2],ue=C.left*L-P[3],me=C.right*L+P[1];const be=C.collisionPadding;if(be&&(ue-=be[0]*L,K-=be[1]*L,me+=be[2]*L,re+=be[3]*L),H){const Te=new y(ue,K),Ae=new y(me,K),qe=new y(ue,re),$e=new y(me,re),Oe=H*Math.PI/180;Te._rotate(Oe),Ae._rotate(Oe),qe._rotate(Oe),$e._rotate(Oe),ue=Math.min(Te.x,Ae.x,qe.x,$e.x),me=Math.max(Te.x,Ae.x,qe.x,$e.x),K=Math.min(Te.y,Ae.y,qe.y,$e.y),re=Math.max(Te.y,Ae.y,qe.y,$e.y)}s.emplaceBack(h.x,h.y,ue,K,me,re,m,v,S)}this.boxEndIndex=s.length}}class k2{constructor(s=[],h=S2){if(this.data=s,this.length=this.data.length,this.compare=h,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(s){this.data.push(s),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const s=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:h,compare:m}=this,v=h[s];for(;s>0;){const S=s-1>>1,C=h[S];if(m(v,C)>=0)break;h[s]=C,s=S}h[s]=v}_down(s){const{data:h,compare:m}=this,v=this.length>>1,S=h[s];for(;s<v;){let C=1+(s<<1),L=h[C];const P=C+1;if(P<this.length&&m(h[P],L)<0&&(C=P,L=h[P]),m(L,S)>=0)break;h[s]=L,s=C}h[s]=S}}function S2(u,s){return u<s?-1:u>s?1:0}function C2(u,s=1,h=!1){let m=1/0,v=1/0,S=-1/0,C=-1/0;const L=u[0];for(let ue=0;ue<L.length;ue++){const me=L[ue];(!ue||me.x<m)&&(m=me.x),(!ue||me.y<v)&&(v=me.y),(!ue||me.x>S)&&(S=me.x),(!ue||me.y>C)&&(C=me.y)}const P=Math.min(S-m,C-v);let O=P/2;const H=new k2([],T2);if(P===0)return new y(m,v);for(let ue=m;ue<S;ue+=P)for(let me=v;me<C;me+=P)H.push(new bc(ue+O,me+O,O,u));let K=function(ue){let me=0,be=0,Te=0;const Ae=ue[0];for(let qe=0,$e=Ae.length,Oe=$e-1;qe<$e;Oe=qe++){const ht=Ae[qe],ft=Ae[Oe],Zt=ht.x*ft.y-ft.x*ht.y;be+=(ht.x+ft.x)*Zt,Te+=(ht.y+ft.y)*Zt,me+=3*Zt}return new bc(be/me,Te/me,0,ue)}(u),re=H.length;for(;H.length;){const ue=H.pop();(ue.d>K.d||!K.d)&&(K=ue,h&&console.log("found best %d after %d probes",Math.round(1e4*ue.d)/1e4,re)),ue.max-K.d<=s||(O=ue.h/2,H.push(new bc(ue.p.x-O,ue.p.y-O,O,u)),H.push(new bc(ue.p.x+O,ue.p.y-O,O,u)),H.push(new bc(ue.p.x-O,ue.p.y+O,O,u)),H.push(new bc(ue.p.x+O,ue.p.y+O,O,u)),re+=4)}return h&&(console.log(`num probes: ${re}`),console.log(`best distance: ${K.d}`)),K.p}function T2(u,s){return s.max-u.max}function bc(u,s,h,m){this.p=new y(u,s),this.h=h,this.d=function(v,S){let C=!1,L=1/0;for(let P=0;P<S.length;P++){const O=S[P];for(let H=0,K=O.length,re=K-1;H<K;re=H++){const ue=O[H],me=O[re];ue.y>v.y!=me.y>v.y&&v.x<(me.x-ue.x)*(v.y-ue.y)/(me.y-ue.y)+ue.x&&(C=!C),L=Math.min(L,ig(v,ue,me))}}return(C?1:-1)*Math.sqrt(L)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var wi;c.ap=void 0,(wi=c.ap||(c.ap={}))[wi.center=1]="center",wi[wi.left=2]="left",wi[wi.right=3]="right",wi[wi.top=4]="top",wi[wi.bottom=5]="bottom",wi[wi["top-left"]=6]="top-left",wi[wi["top-right"]=7]="top-right",wi[wi["bottom-left"]=8]="bottom-left",wi[wi["bottom-right"]=9]="bottom-right";const wa=7,Mp=Number.POSITIVE_INFINITY;function x_(u,s){return s[1]!==Mp?function(h,m,v){let S=0,C=0;switch(m=Math.abs(m),v=Math.abs(v),h){case"top-right":case"top-left":case"top":C=v-wa;break;case"bottom-right":case"bottom-left":case"bottom":C=-v+wa}switch(h){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,C]}(u,s[0],s[1]):function(h,m){let v=0,S=0;m<0&&(m=0);const C=m/Math.SQRT2;switch(h){case"top-right":case"top-left":S=C-wa;break;case"bottom-right":case"bottom-left":S=-C+wa;break;case"bottom":S=-m+wa;break;case"top":S=m-wa}switch(h){case"top-right":case"bottom-right":v=-C;break;case"top-left":case"bottom-left":v=C;break;case"left":v=m;break;case"right":v=-m}return[v,S]}(u,s[0])}function k_(u,s,h){var m;const v=u.layout,S=(m=v.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(s,{},h);if(S){const L=S.values,P=[];for(let O=0;O<L.length;O+=2){const H=P[O]=L[O],K=L[O+1].map(re=>re*ii);H.startsWith("top")?K[1]-=wa:H.startsWith("bottom")&&(K[1]+=wa),P[O+1]=K}return new ho(P)}const C=v.get("text-variable-anchor");if(C){let L;L=u._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(s,{},h)*ii,Mp]:v.get("text-offset").evaluate(s,{},h).map(O=>O*ii);const P=[];for(const O of C)P.push(O,x_(O,L));return new ho(P)}return null}function Lp(u){switch(u){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function M2(u,s,h,m,v,S,C,L,P,O,H){let K=S.textMaxSize.evaluate(s,{});K===void 0&&(K=C);const re=u.layers[0].layout,ue=re.get("icon-offset").evaluate(s,{},H),me=C_(h.horizontal),be=C/24,Te=u.tilePixelRatio*be,Ae=u.tilePixelRatio*K/24,qe=u.tilePixelRatio*L,$e=u.tilePixelRatio*re.get("symbol-spacing"),Oe=re.get("text-padding")*u.tilePixelRatio,ht=function(kt,cn,rn,Fn=1){const br=kt.get("icon-padding").evaluate(cn,{},rn),Tr=br&&br.values;return[Tr[0]*Fn,Tr[1]*Fn,Tr[2]*Fn,Tr[3]*Fn]}(re,s,H,u.tilePixelRatio),ft=re.get("text-max-angle")/180*Math.PI,Zt=re.get("text-rotation-alignment")!=="viewport"&&re.get("symbol-placement")!=="point",Yt=re.get("icon-rotation-alignment")==="map"&&re.get("symbol-placement")!=="point",qt=re.get("symbol-placement"),jt=$e/2,zt=re.get("icon-text-fit");let Xt;m&&zt!=="none"&&(u.allowVerticalPlacement&&h.vertical&&(Xt=Wg(m,h.vertical,zt,re.get("icon-text-fit-padding"),ue,be)),me&&(m=Wg(m,me,zt,re.get("icon-text-fit-padding"),ue,be)));const Bt=(kt,cn)=>{cn.x<0||cn.x>=Or||cn.y<0||cn.y>=Or||function(rn,Fn,br,Tr,oi,go,Oi,Kr,gi,xi,Ni,ji,si,ai,Ei,Ui,Ii,to,no,li,Un,Ai,ki,ci,Ho){const is=rn.addToLineVertexArray(Fn,br);let os,Ns,Wo,To,ro=0,js=0,Ou=0,E_=0,Rp=-1,Fp=-1;const Us={};let I_=$r("");if(rn.allowVerticalPlacement&&Tr.vertical){const Pi=Kr.layout.get("text-rotate").evaluate(Un,{},ci)+90;Wo=new Ff(gi,Fn,xi,Ni,ji,Tr.vertical,si,ai,Ei,Pi),Oi&&(To=new Ff(gi,Fn,xi,Ni,ji,Oi,Ii,to,Ei,Pi))}if(oi){const Pi=Kr.layout.get("icon-rotate").evaluate(Un,{}),Mo=Kr.layout.get("icon-text-fit")!=="none",ul=v_(oi,Pi,ki,Mo),as=Oi?v_(Oi,Pi,ki,Mo):void 0;Ns=new Ff(gi,Fn,xi,Ni,ji,oi,Ii,to,!1,Pi),ro=4*ul.length;const hl=rn.iconSizeData;let Ts=null;hl.kind==="source"?(Ts=[Cs*Kr.layout.get("icon-size").evaluate(Un,{})],Ts[0]>ya&&Pe(`${rn.layerIds[0]}: Value for "icon-size" is >= ${$u}. Reduce your "icon-size".`)):hl.kind==="composite"&&(Ts=[Cs*Ai.compositeIconSizes[0].evaluate(Un,{},ci),Cs*Ai.compositeIconSizes[1].evaluate(Un,{},ci)],(Ts[0]>ya||Ts[1]>ya)&&Pe(`${rn.layerIds[0]}: Value for "icon-size" is >= ${$u}. Reduce your "icon-size".`)),rn.addSymbols(rn.icon,ul,Ts,li,no,Un,c.ah.none,Fn,is.lineStartIndex,is.lineLength,-1,ci),Rp=rn.icon.placedSymbolArray.length-1,as&&(js=4*as.length,rn.addSymbols(rn.icon,as,Ts,li,no,Un,c.ah.vertical,Fn,is.lineStartIndex,is.lineLength,-1,ci),Fp=rn.icon.placedSymbolArray.length-1)}const A_=Object.keys(Tr.horizontal);for(const Pi of A_){const Mo=Tr.horizontal[Pi];if(!os){I_=$r(Mo.text);const as=Kr.layout.get("text-rotate").evaluate(Un,{},ci);os=new Ff(gi,Fn,xi,Ni,ji,Mo,si,ai,Ei,as)}const ul=Mo.positionedLines.length===1;if(Ou+=S_(rn,Fn,Mo,go,Kr,Ei,Un,Ui,is,Tr.vertical?c.ah.horizontal:c.ah.horizontalOnly,ul?A_:[Pi],Us,Rp,Ai,ci),ul)break}Tr.vertical&&(E_+=S_(rn,Fn,Tr.vertical,go,Kr,Ei,Un,Ui,is,c.ah.vertical,["vertical"],Us,Fp,Ai,ci));const I2=os?os.boxStartIndex:rn.collisionBoxArray.length,A2=os?os.boxEndIndex:rn.collisionBoxArray.length,P2=Wo?Wo.boxStartIndex:rn.collisionBoxArray.length,z2=Wo?Wo.boxEndIndex:rn.collisionBoxArray.length,D2=Ns?Ns.boxStartIndex:rn.collisionBoxArray.length,$2=Ns?Ns.boxEndIndex:rn.collisionBoxArray.length,R2=To?To.boxStartIndex:rn.collisionBoxArray.length,F2=To?To.boxEndIndex:rn.collisionBoxArray.length;let ss=-1;const Of=(Pi,Mo)=>Pi&&Pi.circleDiameter?Math.max(Pi.circleDiameter,Mo):Mo;ss=Of(os,ss),ss=Of(Wo,ss),ss=Of(Ns,ss),ss=Of(To,ss);const P_=ss>-1?1:0;P_&&(ss*=Ho/ii),rn.glyphOffsetArray.length>=_c.MAX_GLYPHS&&Pe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Un.sortKey!==void 0&&rn.addToSortKeyRanges(rn.symbolInstances.length,Un.sortKey);const B2=k_(Kr,Un,ci),[O2,N2]=function(Pi,Mo){const ul=Pi.length,as=Mo==null?void 0:Mo.values;if((as==null?void 0:as.length)>0)for(let hl=0;hl<as.length;hl+=2){const Ts=as[hl+1];Pi.emplaceBack(c.ap[as[hl]],Ts[0],Ts[1])}return[ul,Pi.length]}(rn.textAnchorOffsets,B2);rn.symbolInstances.emplaceBack(Fn.x,Fn.y,Us.right>=0?Us.right:-1,Us.center>=0?Us.center:-1,Us.left>=0?Us.left:-1,Us.vertical||-1,Rp,Fp,I_,I2,A2,P2,z2,D2,$2,R2,F2,xi,Ou,E_,ro,js,P_,0,si,ss,O2,N2)}(u,cn,kt,h,m,v,Xt,u.layers[0],u.collisionBoxArray,s.index,s.sourceLayerIndex,u.index,Te,[Oe,Oe,Oe,Oe],Zt,P,qe,ht,Yt,ue,s,S,O,H,C)};if(qt==="line")for(const kt of p_(s.geometry,0,0,Or,Or)){const cn=x2(kt,$e,ft,h.vertical||me,m,24,Ae,u.overscaling,Or);for(const rn of cn)me&&L2(u,me.text,jt,rn)||Bt(kt,rn)}else if(qt==="line-center"){for(const kt of s.geometry)if(kt.length>1){const cn=w2(kt,ft,h.vertical||me,m,24,Ae);cn&&Bt(kt,cn)}}else if(s.type==="Polygon")for(const kt of sp(s.geometry,0)){const cn=C2(kt,16);Bt(kt[0],new va(cn.x,cn.y,0))}else if(s.type==="LineString")for(const kt of s.geometry)Bt(kt,new va(kt[0].x,kt[0].y,0));else if(s.type==="Point")for(const kt of s.geometry)for(const cn of kt)Bt([cn],new va(cn.x,cn.y,0))}function S_(u,s,h,m,v,S,C,L,P,O,H,K,re,ue,me){const be=function(qe,$e,Oe,ht,ft,Zt,Yt,qt){const jt=ht.layout.get("text-rotate").evaluate(Zt,{})*Math.PI/180,zt=[];for(const Xt of $e.positionedLines)for(const Bt of Xt.positionedGlyphs){if(!Bt.rect)continue;const kt=Bt.rect||{};let cn=jg+1,rn=!0,Fn=1,br=0;const Tr=(ft||qt)&&Bt.vertical,oi=Bt.metrics.advance*Bt.scale/2;if(qt&&$e.verticalizable&&(br=Xt.lineOffset/2-(Bt.imageName?-(ii-Bt.metrics.width*Bt.scale)/2:(Bt.scale-1)*ii)),Bt.imageName){const li=Yt[Bt.imageName];rn=li.sdf,Fn=li.pixelRatio,cn=eo/Fn}const go=ft?[Bt.x+oi,Bt.y]:[0,0];let Oi=ft?[0,0]:[Bt.x+oi+Oe[0],Bt.y+Oe[1]-br],Kr=[0,0];Tr&&(Kr=Oi,Oi=[0,0]);const gi=Bt.metrics.isDoubleResolution?2:1,xi=(Bt.metrics.left-cn)*Bt.scale-oi+Oi[0],Ni=(-Bt.metrics.top-cn)*Bt.scale+Oi[1],ji=xi+kt.w/gi*Bt.scale/Fn,si=Ni+kt.h/gi*Bt.scale/Fn,ai=new y(xi,Ni),Ei=new y(ji,Ni),Ui=new y(xi,si),Ii=new y(ji,si);if(Tr){const li=new y(-oi,oi-zu),Un=-Math.PI/2,Ai=ii/2-oi,ki=new y(5-zu-Ai,-(Bt.imageName?Ai:0)),ci=new y(...Kr);ai._rotateAround(Un,li)._add(ki)._add(ci),Ei._rotateAround(Un,li)._add(ki)._add(ci),Ui._rotateAround(Un,li)._add(ki)._add(ci),Ii._rotateAround(Un,li)._add(ki)._add(ci)}if(jt){const li=Math.sin(jt),Un=Math.cos(jt),Ai=[Un,-li,li,Un];ai._matMult(Ai),Ei._matMult(Ai),Ui._matMult(Ai),Ii._matMult(Ai)}const to=new y(0,0),no=new y(0,0);zt.push({tl:ai,tr:Ei,bl:Ui,br:Ii,tex:kt,writingMode:$e.writingMode,glyphOffset:go,sectionIndex:Bt.sectionIndex,isSDF:rn,pixelOffsetTL:to,pixelOffsetBR:no,minFontScaleX:0,minFontScaleY:0})}return zt}(0,h,L,v,S,C,m,u.allowVerticalPlacement),Te=u.textSizeData;let Ae=null;Te.kind==="source"?(Ae=[Cs*v.layout.get("text-size").evaluate(C,{})],Ae[0]>ya&&Pe(`${u.layerIds[0]}: Value for "text-size" is >= ${$u}. Reduce your "text-size".`)):Te.kind==="composite"&&(Ae=[Cs*ue.compositeTextSizes[0].evaluate(C,{},me),Cs*ue.compositeTextSizes[1].evaluate(C,{},me)],(Ae[0]>ya||Ae[1]>ya)&&Pe(`${u.layerIds[0]}: Value for "text-size" is >= ${$u}. Reduce your "text-size".`)),u.addSymbols(u.text,be,Ae,L,S,C,O,s,P.lineStartIndex,P.lineLength,re,me);for(const qe of H)K[qe]=u.text.placedSymbolArray.length-1;return 4*be.length}function C_(u){for(const s in u)return u[s];return null}function L2(u,s,h,m){const v=u.compareText;if(s in v){const S=v[s];for(let C=S.length-1;C>=0;C--)if(m.dist(S[C])<h)return!0}else v[s]=[];return v[s].push(m),!1}const T_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Ep{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,m]=new Uint8Array(s,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=m>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const S=T_[15&m];if(!S)throw new Error("Unrecognized array type.");const[C]=new Uint16Array(s,2,1),[L]=new Uint32Array(s,4,1);return new Ep(L,C,S,s)}constructor(s,h=64,m=Float64Array,v){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=m,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const S=T_.indexOf(this.ArrayType),C=2*s*this.ArrayType.BYTES_PER_ELEMENT,L=s*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-L%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${m}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+L+P,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+C+L+P),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+L+P,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=s)}add(s,h){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=s,this.coords[this._pos++]=h,m}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return Ip(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,h,m,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:C,nodeSize:L}=this,P=[0,S.length-1,0],O=[];for(;P.length;){const H=P.pop()||0,K=P.pop()||0,re=P.pop()||0;if(K-re<=L){for(let Te=re;Te<=K;Te++){const Ae=C[2*Te],qe=C[2*Te+1];Ae>=s&&Ae<=m&&qe>=h&&qe<=v&&O.push(S[Te])}continue}const ue=re+K>>1,me=C[2*ue],be=C[2*ue+1];me>=s&&me<=m&&be>=h&&be<=v&&O.push(S[ue]),(H===0?s<=me:h<=be)&&(P.push(re),P.push(ue-1),P.push(1-H)),(H===0?m>=me:v>=be)&&(P.push(ue+1),P.push(K),P.push(1-H))}return O}within(s,h,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:S,nodeSize:C}=this,L=[0,v.length-1,0],P=[],O=m*m;for(;L.length;){const H=L.pop()||0,K=L.pop()||0,re=L.pop()||0;if(K-re<=C){for(let Te=re;Te<=K;Te++)L_(S[2*Te],S[2*Te+1],s,h)<=O&&P.push(v[Te]);continue}const ue=re+K>>1,me=S[2*ue],be=S[2*ue+1];L_(me,be,s,h)<=O&&P.push(v[ue]),(H===0?s-m<=me:h-m<=be)&&(L.push(re),L.push(ue-1),L.push(1-H)),(H===0?s+m>=me:h+m>=be)&&(L.push(ue+1),L.push(K),L.push(1-H))}return P}}function Ip(u,s,h,m,v,S){if(v-m<=h)return;const C=m+v>>1;M_(u,s,C,m,v,S),Ip(u,s,h,m,C-1,1-S),Ip(u,s,h,C+1,v,1-S)}function M_(u,s,h,m,v,S){for(;v>m;){if(v-m>600){const O=v-m+1,H=h-m+1,K=Math.log(O),re=.5*Math.exp(2*K/3),ue=.5*Math.sqrt(K*re*(O-re)/O)*(H-O/2<0?-1:1);M_(u,s,h,Math.max(m,Math.floor(h-H*re/O+ue)),Math.min(v,Math.floor(h+(O-H)*re/O+ue)),S)}const C=s[2*h+S];let L=m,P=v;for(Fu(u,s,m,h),s[2*v+S]>C&&Fu(u,s,m,v);L<P;){for(Fu(u,s,L,P),L++,P--;s[2*L+S]<C;)L++;for(;s[2*P+S]>C;)P--}s[2*m+S]===C?Fu(u,s,m,P):(P++,Fu(u,s,P,v)),P<=h&&(m=P+1),h<=P&&(v=P-1)}}function Fu(u,s,h,m){Ap(u,h,m),Ap(s,2*h,2*m),Ap(s,2*h+1,2*m+1)}function Ap(u,s,h){const m=u[s];u[s]=u[h],u[h]=m}function L_(u,s,h,m){const v=u-h,S=s-m;return v*v+S*S}var Pp;c.bd=void 0,(Pp=c.bd||(c.bd={})).create="create",Pp.load="load",Pp.fullLoad="fullLoad";let Bf=null,Bu=[];const zp=1e3/60,Dp="loadTime",$p="fullLoadTime",E2={mark(u){performance.mark(u)},frame(u){const s=u;Bf!=null&&Bu.push(s-Bf),Bf=s},clearMetrics(){Bf=null,Bu=[],performance.clearMeasures(Dp),performance.clearMeasures($p);for(const u in c.bd)performance.clearMarks(c.bd[u])},getPerformanceMetrics(){performance.measure(Dp,c.bd.create,c.bd.load),performance.measure($p,c.bd.create,c.bd.fullLoad);const u=performance.getEntriesByName(Dp)[0].duration,s=performance.getEntriesByName($p)[0].duration,h=Bu.length,m=1/(Bu.reduce((S,C)=>S+C,0)/h/1e3),v=Bu.filter(S=>S>zp).reduce((S,C)=>S+(C-zp)/zp,0);return{loadTime:u,fullLoadTime:s,fps:m,percentDroppedFrames:v/(h+v)*100,totalFrames:h}}};c.$=Dt,c.A=hc,c.B=function(u){if(Ee==null){const s=u.navigator?u.navigator.userAgent:null;Ee=!!u.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ee},c.C=class{constructor(u,s){this.target=u,this.mapId=s,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new b2(()=>this.process()),this.subscription=function(h,m,v,S){return h.addEventListener(m,v,!1),{unsubscribe:()=>{h.removeEventListener(m,v,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=Ge(self)?u:window}registerMessageHandler(u,s){this.messageHandlers[u]=s}sendAsync(u,s){return new Promise((h,m)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:h,reject:m},s&&s.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const L={id:v,type:"<cancel>",origin:location.origin,targetMapId:u.targetMapId,sourceMapId:this.mapId};this.target.postMessage(L)},{once:!0});const S=[],C=Object.assign(Object.assign({},u),{id:v,sourceMapId:this.mapId,origin:location.origin,data:fa(u.data,S)});this.target.postMessage(C,{transfer:S})})}receive(u){const s=u.data,h=s.id;if(!(s.origin!=="file://"&&location.origin!=="file://"&&s.origin!==location.origin||s.targetMapId&&this.mapId!==s.targetMapId)){if(s.type==="<cancel>"){delete this.tasks[h];const m=this.abortControllers[h];return delete this.abortControllers[h],void(m&&m.abort())}if(Ge(self)||s.mustQueue)return this.tasks[h]=s,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,s)}}process(){if(this.taskQueue.length===0)return;const u=this.taskQueue.shift(),s=this.tasks[u];delete this.tasks[u],this.taskQueue.length>0&&this.invoker.trigger(),s&&this.processTask(u,s)}processTask(u,s){return a(this,void 0,void 0,function*(){if(s.type==="<response>"){const v=this.resolveRejects[u];return delete this.resolveRejects[u],v?void(s.error?v.reject(da(s.error)):v.resolve(da(s.data))):void 0}if(!this.messageHandlers[s.type])return void this.completeTask(u,new Error(`Could not find a registered handler for ${s.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=da(s.data),m=new AbortController;this.abortControllers[u]=m;try{const v=yield this.messageHandlers[s.type](s.sourceMapId,h,m);this.completeTask(u,null,v)}catch(v){this.completeTask(u,v)}})}completeTask(u,s,h){const m=[];delete this.abortControllers[u];const v={id:u,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:s?fa(s):null,data:fa(h,m)};this.target.postMessage(v,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},c.D=on,c.E=Ut,c.F=function(){var u=new hc(16);return hc!=Float32Array&&(u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=0,u[12]=0,u[13]=0,u[14]=0),u[0]=1,u[5]=1,u[10]=1,u[15]=1,u},c.G=Rt,c.H=function(u,s,h){var m,v,S,C,L,P,O,H,K,re,ue,me,be=h[0],Te=h[1],Ae=h[2];return s===u?(u[12]=s[0]*be+s[4]*Te+s[8]*Ae+s[12],u[13]=s[1]*be+s[5]*Te+s[9]*Ae+s[13],u[14]=s[2]*be+s[6]*Te+s[10]*Ae+s[14],u[15]=s[3]*be+s[7]*Te+s[11]*Ae+s[15]):(v=s[1],S=s[2],C=s[3],L=s[4],P=s[5],O=s[6],H=s[7],K=s[8],re=s[9],ue=s[10],me=s[11],u[0]=m=s[0],u[1]=v,u[2]=S,u[3]=C,u[4]=L,u[5]=P,u[6]=O,u[7]=H,u[8]=K,u[9]=re,u[10]=ue,u[11]=me,u[12]=m*be+L*Te+K*Ae+s[12],u[13]=v*be+P*Te+re*Ae+s[13],u[14]=S*be+O*Te+ue*Ae+s[14],u[15]=C*be+H*Te+me*Ae+s[15]),u},c.I=gp,c.J=function(u,s,h){var m=h[0],v=h[1],S=h[2];return u[0]=s[0]*m,u[1]=s[1]*m,u[2]=s[2]*m,u[3]=s[3]*m,u[4]=s[4]*v,u[5]=s[5]*v,u[6]=s[6]*v,u[7]=s[7]*v,u[8]=s[8]*S,u[9]=s[9]*S,u[10]=s[10]*S,u[11]=s[11]*S,u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},c.K=lg,c.L=function(u,s){const h={};for(let m=0;m<s.length;m++){const v=s[m];v in u&&(h[v]=u[v])}return h},c.M=ba,c.N=r_,c.O=i_,c.P=y,c.Q=Co,c.R=So,c.S=z,c.T=lu,c.U=I,c.V=it,c.W=Or,c.X=Ur,c.Y=zf,c.Z=class extends hu{},c._=a,c.a=$t,c.a$=function(u,s,h){return u[0]=s[0]*h[0],u[1]=s[1]*h[1],u[2]=s[2]*h[2],u[3]=s[3]*h[3],u},c.a0=Tp,c.a1=bt,c.a2=u=>{const s=window.document.createElement("video");return s.muted=!0,new Promise(h=>{s.onloadstart=()=>{h(s)};for(const m of u){const v=window.document.createElement("source");ut(m)||(s.crossOrigin="Anonymous"),v.src=m,s.appendChild(v)}})},c.a3=function(){return ee++},c.a4=x,c.a5=_c,c.a6=ql,c.a7=Bs,c.a8=Sr,c.a9=u_,c.aA=Q,c.aB=function(u,s){if(!u)return[{command:"setStyle",args:[s]}];let h=[];try{if(!et(u.version,s.version))return[{command:"setStyle",args:[s]}];et(u.center,s.center)||h.push({command:"setCenter",args:[s.center]}),et(u.zoom,s.zoom)||h.push({command:"setZoom",args:[s.zoom]}),et(u.bearing,s.bearing)||h.push({command:"setBearing",args:[s.bearing]}),et(u.pitch,s.pitch)||h.push({command:"setPitch",args:[s.pitch]}),et(u.sprite,s.sprite)||h.push({command:"setSprite",args:[s.sprite]}),et(u.glyphs,s.glyphs)||h.push({command:"setGlyphs",args:[s.glyphs]}),et(u.transition,s.transition)||h.push({command:"setTransition",args:[s.transition]}),et(u.light,s.light)||h.push({command:"setLight",args:[s.light]}),et(u.terrain,s.terrain)||h.push({command:"setTerrain",args:[s.terrain]}),et(u.sky,s.sky)||h.push({command:"setSky",args:[s.sky]});const m={},v=[];(function(C,L,P,O){let H;for(H in L=L||{},C=C||{})Object.prototype.hasOwnProperty.call(C,H)&&(Object.prototype.hasOwnProperty.call(L,H)||ur(H,P,O));for(H in L)Object.prototype.hasOwnProperty.call(L,H)&&(Object.prototype.hasOwnProperty.call(C,H)?et(C[H],L[H])||(C[H].type==="geojson"&&L[H].type==="geojson"&&Qr(C,L,H)?Kt(P,{command:"setGeoJSONSourceData",args:[H,L[H].data]}):gr(H,L,P,O)):er(H,L,P))})(u.sources,s.sources,v,m);const S=[];u.layers&&u.layers.forEach(C=>{"source"in C&&m[C.source]?h.push({command:"removeLayer",args:[C.id]}):S.push(C)}),h=h.concat(v),function(C,L,P){L=L||[];const O=(C=C||[]).map(co),H=L.map(co),K=C.reduce(hr,{}),re=L.reduce(hr,{}),ue=O.slice(),me=Object.create(null);let be,Te,Ae,qe,$e;for(let Oe=0,ht=0;Oe<O.length;Oe++)be=O[Oe],Object.prototype.hasOwnProperty.call(re,be)?ht++:(Kt(P,{command:"removeLayer",args:[be]}),ue.splice(ue.indexOf(be,ht),1));for(let Oe=0,ht=0;Oe<H.length;Oe++)be=H[H.length-1-Oe],ue[ue.length-1-Oe]!==be&&(Object.prototype.hasOwnProperty.call(K,be)?(Kt(P,{command:"removeLayer",args:[be]}),ue.splice(ue.lastIndexOf(be,ue.length-ht),1)):ht++,qe=ue[ue.length-Oe],Kt(P,{command:"addLayer",args:[re[be],qe]}),ue.splice(ue.length-Oe,0,be),me[be]=!0);for(let Oe=0;Oe<H.length;Oe++)if(be=H[Oe],Te=K[be],Ae=re[be],!me[be]&&!et(Te,Ae))if(et(Te.source,Ae.source)&&et(Te["source-layer"],Ae["source-layer"])&&et(Te.type,Ae.type)){for($e in ei(Te.layout,Ae.layout,P,be,null,"setLayoutProperty"),ei(Te.paint,Ae.paint,P,be,null,"setPaintProperty"),et(Te.filter,Ae.filter)||Kt(P,{command:"setFilter",args:[be,Ae.filter]}),et(Te.minzoom,Ae.minzoom)&&et(Te.maxzoom,Ae.maxzoom)||Kt(P,{command:"setLayerZoomRange",args:[be,Ae.minzoom,Ae.maxzoom]}),Te)Object.prototype.hasOwnProperty.call(Te,$e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&($e.indexOf("paint.")===0?ei(Te[$e],Ae[$e],P,be,$e.slice(6),"setPaintProperty"):et(Te[$e],Ae[$e])||Kt(P,{command:"setLayerProperty",args:[be,$e,Ae[$e]]}));for($e in Ae)Object.prototype.hasOwnProperty.call(Ae,$e)&&!Object.prototype.hasOwnProperty.call(Te,$e)&&$e!=="layout"&&$e!=="paint"&&$e!=="filter"&&$e!=="metadata"&&$e!=="minzoom"&&$e!=="maxzoom"&&($e.indexOf("paint.")===0?ei(Te[$e],Ae[$e],P,be,$e.slice(6),"setPaintProperty"):et(Te[$e],Ae[$e])||Kt(P,{command:"setLayerProperty",args:[be,$e,Ae[$e]]}))}else Kt(P,{command:"removeLayer",args:[be]}),qe=ue[ue.lastIndexOf(be)+1],Kt(P,{command:"addLayer",args:[Ae,qe]})}(S,s.layers,h)}catch(m){console.warn("Unable to compute style diff:",m),h=[{command:"setStyle",args:[s]}]}return h},c.aC=function(u){const s=[],h=u.id;return h===void 0&&s.push({message:`layers.${h}: missing required property "id"`}),u.render===void 0&&s.push({message:`layers.${h}: missing required method "render"`}),u.renderingMode&&u.renderingMode!=="2d"&&u.renderingMode!=="3d"&&s.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),s},c.aD=function u(s,h){if(Array.isArray(s)){if(!Array.isArray(h)||s.length!==h.length)return!1;for(let m=0;m<s.length;m++)if(!u(s[m],h[m]))return!1;return!0}if(typeof s=="object"&&s!==null&&h!==null){if(typeof h!="object"||Object.keys(s).length!==Object.keys(h).length)return!1;for(const m in s)if(!u(s[m],h[m]))return!1;return!0}return s===h},c.aE=pe,c.aF=Ie,c.aG=class extends ri{constructor(u,s){super(u,s),this.current=0}set(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}},c.aH=Qi,c.aI=class extends ri{constructor(u,s){super(u,s),this.current=ll}set(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let s=1;s<16;s++)if(u[s]!==this.current[s]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}},c.aJ=Zo,c.aK=class extends ri{constructor(u,s){super(u,s),this.current=[0,0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))}},c.aL=class extends ri{constructor(u,s){super(u,s),this.current=[0,0]}set(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))}},c.aM=xs,c.aN=function(u,s,h,m,v,S,C){var L=1/(s-h),P=1/(m-v),O=1/(S-C);return u[0]=-2*L,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=-2*P,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=2*O,u[11]=0,u[12]=(s+h)*L,u[13]=(v+m)*P,u[14]=(C+S)*O,u[15]=1,u},c.aO=ir,c.aP=Qv,c.aQ=class extends rc{},c.aR=Hw,c.aS=class extends ic{},c.aT=function(u){return u<=1?1:Math.pow(2,Math.ceil(Math.log(u)/Math.LN2))},c.aU=dg,c.aV=Y,c.aW=class extends _u{},c.aX=ot,c.aY=function(u,s){return u[0]===s[0]&&u[1]===s[1]&&u[2]===s[2]&&u[3]===s[3]&&u[4]===s[4]&&u[5]===s[5]&&u[6]===s[6]&&u[7]===s[7]&&u[8]===s[8]&&u[9]===s[9]&&u[10]===s[10]&&u[11]===s[11]&&u[12]===s[12]&&u[13]===s[13]&&u[14]===s[14]&&u[15]===s[15]},c.aZ=function(u,s){var h=u[0],m=u[1],v=u[2],S=u[3],C=u[4],L=u[5],P=u[6],O=u[7],H=u[8],K=u[9],re=u[10],ue=u[11],me=u[12],be=u[13],Te=u[14],Ae=u[15],qe=s[0],$e=s[1],Oe=s[2],ht=s[3],ft=s[4],Zt=s[5],Yt=s[6],qt=s[7],jt=s[8],zt=s[9],Xt=s[10],Bt=s[11],kt=s[12],cn=s[13],rn=s[14],Fn=s[15];return Math.abs(h-qe)<=Bi*Math.max(1,Math.abs(h),Math.abs(qe))&&Math.abs(m-$e)<=Bi*Math.max(1,Math.abs(m),Math.abs($e))&&Math.abs(v-Oe)<=Bi*Math.max(1,Math.abs(v),Math.abs(Oe))&&Math.abs(S-ht)<=Bi*Math.max(1,Math.abs(S),Math.abs(ht))&&Math.abs(C-ft)<=Bi*Math.max(1,Math.abs(C),Math.abs(ft))&&Math.abs(L-Zt)<=Bi*Math.max(1,Math.abs(L),Math.abs(Zt))&&Math.abs(P-Yt)<=Bi*Math.max(1,Math.abs(P),Math.abs(Yt))&&Math.abs(O-qt)<=Bi*Math.max(1,Math.abs(O),Math.abs(qt))&&Math.abs(H-jt)<=Bi*Math.max(1,Math.abs(H),Math.abs(jt))&&Math.abs(K-zt)<=Bi*Math.max(1,Math.abs(K),Math.abs(zt))&&Math.abs(re-Xt)<=Bi*Math.max(1,Math.abs(re),Math.abs(Xt))&&Math.abs(ue-Bt)<=Bi*Math.max(1,Math.abs(ue),Math.abs(Bt))&&Math.abs(me-kt)<=Bi*Math.max(1,Math.abs(me),Math.abs(kt))&&Math.abs(be-cn)<=Bi*Math.max(1,Math.abs(be),Math.abs(cn))&&Math.abs(Te-rn)<=Bi*Math.max(1,Math.abs(Te),Math.abs(rn))&&Math.abs(Ae-Fn)<=Bi*Math.max(1,Math.abs(Ae),Math.abs(Fn))},c.a_=function(u,s){return u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[4]=s[4],u[5]=s[5],u[6]=s[6],u[7]=s[7],u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15],u},c.aa=function(u){const s={};if(u.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,m,v,S)=>{const C=v||S;return s[m]=!C||C.toLowerCase(),""}),s["max-age"]){const h=parseInt(s["max-age"],10);isNaN(h)?delete s["max-age"]:s["max-age"]=h}return s},c.ab=function(u,s){const h=[];for(const m in u)m in s||h.push(m);return h},c.ac=W,c.ad=function(u,s,h){var m=Math.sin(h),v=Math.cos(h),S=s[0],C=s[1],L=s[2],P=s[3],O=s[4],H=s[5],K=s[6],re=s[7];return s!==u&&(u[8]=s[8],u[9]=s[9],u[10]=s[10],u[11]=s[11],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[0]=S*v+O*m,u[1]=C*v+H*m,u[2]=L*v+K*m,u[3]=P*v+re*m,u[4]=O*v-S*m,u[5]=H*v-C*m,u[6]=K*v-L*m,u[7]=re*v-P*m,u},c.ae=function(u){var s=new hc(16);return s[0]=u[0],s[1]=u[1],s[2]=u[2],s[3]=u[3],s[4]=u[4],s[5]=u[5],s[6]=u[6],s[7]=u[7],s[8]=u[8],s[9]=u[9],s[10]=u[10],s[11]=u[11],s[12]=u[12],s[13]=u[13],s[14]=u[14],s[15]=u[15],s},c.af=xf,c.ag=function(u,s){let h=0,m=0;if(u.kind==="constant")m=u.layoutSize;else if(u.kind!=="source"){const{interpolationType:v,minZoom:S,maxZoom:C}=u,L=v?W(vi.interpolationFactor(v,s,S,C),0,1):0;u.kind==="camera"?m=Mi.number(u.minSize,u.maxSize,L):h=L}return{uSizeT:h,uSize:m}},c.ai=function(u,{uSize:s,uSizeT:h},{lowerSize:m,upperSize:v}){return u.kind==="source"?m/Cs:u.kind==="composite"?Mi.number(m/Cs,v/Cs,h):s},c.aj=vp,c.ak=function(u,s,h,m){const v=s.y-u.y,S=s.x-u.x,C=m.y-h.y,L=m.x-h.x,P=C*S-L*v;if(P===0)return null;const O=(L*(u.y-h.y)-C*(u.x-h.x))/P;return new y(u.x+O*S,u.y+O*v)},c.al=p_,c.am=bu,c.an=Qd,c.ao=ii,c.aq=bp,c.ar=function(u,s){var h=s[0],m=s[1],v=s[2],S=s[3],C=s[4],L=s[5],P=s[6],O=s[7],H=s[8],K=s[9],re=s[10],ue=s[11],me=s[12],be=s[13],Te=s[14],Ae=s[15],qe=h*L-m*C,$e=h*P-v*C,Oe=h*O-S*C,ht=m*P-v*L,ft=m*O-S*L,Zt=v*O-S*P,Yt=H*be-K*me,qt=H*Te-re*me,jt=H*Ae-ue*me,zt=K*Te-re*be,Xt=K*Ae-ue*be,Bt=re*Ae-ue*Te,kt=qe*Bt-$e*Xt+Oe*zt+ht*jt-ft*qt+Zt*Yt;return kt?(u[0]=(L*Bt-P*Xt+O*zt)*(kt=1/kt),u[1]=(v*Xt-m*Bt-S*zt)*kt,u[2]=(be*Zt-Te*ft+Ae*ht)*kt,u[3]=(re*ft-K*Zt-ue*ht)*kt,u[4]=(P*jt-C*Bt-O*qt)*kt,u[5]=(h*Bt-v*jt+S*qt)*kt,u[6]=(Te*Oe-me*Zt-Ae*$e)*kt,u[7]=(H*Zt-re*Oe+ue*$e)*kt,u[8]=(C*Xt-L*jt+O*Yt)*kt,u[9]=(m*jt-h*Xt-S*Yt)*kt,u[10]=(me*ft-be*Oe+Ae*qe)*kt,u[11]=(K*Oe-H*ft-ue*qe)*kt,u[12]=(L*qt-C*zt-P*Yt)*kt,u[13]=(h*zt-m*qt+v*Yt)*kt,u[14]=(be*$e-me*ht-Te*qe)*kt,u[15]=(H*ht-K*$e+re*qe)*kt,u):null},c.as=Lp,c.at=yp,c.au=Ep,c.av=function(){const u={},s=_e.$version;for(const h in _e.$root){const m=_e.$root[h];if(m.required){let v=null;v=h==="version"?s:m.type==="array"?[]:{},v!=null&&(u[h]=v)}}return u},c.aw=lf,c.ax=Qt,c.ay=function(u){u=u.slice();const s=Object.create(null);for(let h=0;h<u.length;h++)s[u[h].id]=u[h];for(let h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=Ne(u[h],s[u[h].ref]));return u},c.az=function(u){if(u.type==="custom")return new y2(u);switch(u.type){case"background":return new m2(u);case"circle":return new ew(u);case"fill":return new vw(u);case"fill-extrusion":return new $w(u);case"heatmap":return new nw(u);case"hillshade":return new iw(u);case"line":return new Vw(u);case"raster":return new _2(u);case"symbol":return new Pf(u)}},c.b=De,c.b0=function(u,s){return u[0]*s[0]+u[1]*s[1]+u[2]*s[2]+u[3]*s[3]},c.b1=oe,c.b2=a_,c.b3=o_,c.b4=function(u,s,h,m,v){var S,C=1/Math.tan(s/2);return u[0]=C/h,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=C,u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[11]=-1,u[12]=0,u[13]=0,u[15]=0,v!=null&&v!==1/0?(u[10]=(v+m)*(S=1/(m-v)),u[14]=2*v*m*S):(u[10]=-1,u[14]=-2*m),u},c.b5=function(u,s,h){var m=Math.sin(h),v=Math.cos(h),S=s[4],C=s[5],L=s[6],P=s[7],O=s[8],H=s[9],K=s[10],re=s[11];return s!==u&&(u[0]=s[0],u[1]=s[1],u[2]=s[2],u[3]=s[3],u[12]=s[12],u[13]=s[13],u[14]=s[14],u[15]=s[15]),u[4]=S*v+O*m,u[5]=C*v+H*m,u[6]=L*v+K*m,u[7]=P*v+re*m,u[8]=O*v-S*m,u[9]=H*v-C*m,u[10]=K*v-L*m,u[11]=re*v-P*m,u},c.b6=F,c.b7=N,c.b8=function(u){return u*Math.PI/180},c.b9=function(u,s){return u[0]=s[0],u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=s[1],u[6]=0,u[7]=0,u[8]=0,u[9]=0,u[10]=s[2],u[11]=0,u[12]=0,u[13]=0,u[14]=0,u[15]=1,u},c.bA=ws,c.ba=class extends ns{},c.bb=Sp,c.bc=E2,c.be=It,c.bf=function(u,s){$t.REGISTERED_PROTOCOLS[u]=s},c.bg=function(u){delete $t.REGISTERED_PROTOCOLS[u]},c.bh=function(u,s){const h={};for(let v=0;v<u.length;v++){const S=s&&s[u[v].id]||Wd(u[v]);s&&(s[u[v].id]=S);let C=h[S];C||(C=h[S]=[]),C.push(u[v])}const m=[];for(const v in h)m.push(h[v]);return m},c.bi=Ht,c.bj=c_,c.bk=h_,c.bl=Vg,c.bm=function(u){u.bucket.createArrays(),u.bucket.tilePixelRatio=Or/(512*u.bucket.overscaling),u.bucket.compareText={},u.bucket.iconsNeedLinear=!1;const s=u.bucket.layers[0],h=s.layout,m=s._unevaluatedLayout._values,v={layoutIconSize:m["icon-size"].possiblyEvaluate(new Sr(u.bucket.zoom+1),u.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Sr(u.bucket.zoom+1),u.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Sr(18))};if(u.bucket.textSizeData.kind==="composite"){const{minZoom:O,maxZoom:H}=u.bucket.textSizeData;v.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Sr(O),u.canonical),m["text-size"].possiblyEvaluate(new Sr(H),u.canonical)]}if(u.bucket.iconSizeData.kind==="composite"){const{minZoom:O,maxZoom:H}=u.bucket.iconSizeData;v.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Sr(O),u.canonical),m["icon-size"].possiblyEvaluate(new Sr(H),u.canonical)]}const S=h.get("text-line-height")*ii,C=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",L=h.get("text-keep-upright"),P=h.get("text-size");for(const O of u.bucket.features){const H=h.get("text-font").evaluate(O,{},u.canonical).join(","),K=P.evaluate(O,{},u.canonical),re=v.layoutTextSize.evaluate(O,{},u.canonical),ue=v.layoutIconSize.evaluate(O,{},u.canonical),me={horizontal:{},vertical:void 0},be=O.text;let Te,Ae=[0,0];if(be){const Oe=be.toString(),ht=h.get("text-letter-spacing").evaluate(O,{},u.canonical)*ii,ft=cf(Oe)?ht:0,Zt=h.get("text-anchor").evaluate(O,{},u.canonical),Yt=k_(s,O,u.canonical);if(!Yt){const Bt=h.get("text-radial-offset").evaluate(O,{},u.canonical);Ae=Bt?x_(Zt,[Bt*ii,Mp]):h.get("text-offset").evaluate(O,{},u.canonical).map(kt=>kt*ii)}let qt=C?"center":h.get("text-justify").evaluate(O,{},u.canonical);const jt=h.get("symbol-placement"),zt=jt==="point"?h.get("text-max-width").evaluate(O,{},u.canonical)*ii:0,Xt=()=>{u.bucket.allowVerticalPlacement&&pa(Oe)&&(me.vertical=Ef(be,u.glyphMap,u.glyphPositions,u.imagePositions,H,zt,S,Zt,"left",ft,Ae,c.ah.vertical,!0,jt,re,K))};if(!C&&Yt){const Bt=new Set;if(qt==="auto")for(let cn=0;cn<Yt.values.length;cn+=2)Bt.add(Lp(Yt.values[cn]));else Bt.add(qt);let kt=!1;for(const cn of Bt)if(!me.horizontal[cn])if(kt)me.horizontal[cn]=me.horizontal[0];else{const rn=Ef(be,u.glyphMap,u.glyphPositions,u.imagePositions,H,zt,S,"center",cn,ft,Ae,c.ah.horizontal,!1,jt,re,K);rn&&(me.horizontal[cn]=rn,kt=rn.positionedLines.length===1)}Xt()}else{qt==="auto"&&(qt=Lp(Zt));const Bt=Ef(be,u.glyphMap,u.glyphPositions,u.imagePositions,H,zt,S,Zt,qt,ft,Ae,c.ah.horizontal,!1,jt,re,K);Bt&&(me.horizontal[qt]=Bt),Xt(),pa(Oe)&&C&&L&&(me.vertical=Ef(be,u.glyphMap,u.glyphPositions,u.imagePositions,H,zt,S,Zt,qt,ft,Ae,c.ah.vertical,!1,jt,re,K))}}let qe=!1;if(O.icon&&O.icon.name){const Oe=u.imageMap[O.icon.name];Oe&&(Te=u2(u.imagePositions[O.icon.name],h.get("icon-offset").evaluate(O,{},u.canonical),h.get("icon-anchor").evaluate(O,{},u.canonical)),qe=!!Oe.sdf,u.bucket.sdfIcons===void 0?u.bucket.sdfIcons=qe:u.bucket.sdfIcons!==qe&&Pe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Oe.pixelRatio!==u.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(u.bucket.iconsNeedLinear=!0))}const $e=C_(me.horizontal)||me.vertical;u.bucket.iconsInText=!!$e&&$e.iconsInText,($e||Te)&&M2(u.bucket,O,me,Te,u.imageMap,v,re,ue,Ae,qe,u.canonical)}u.showCollisionBoxes&&u.bucket.generateCollisionDebugBuffers()},c.bn=fp,c.bo=cp,c.bp=hp,c.bq=ga,c.br=pp,c.bs=class{constructor(u){this._marks={start:[u.url,"start"].join("#"),end:[u.url,"end"].join("#"),measure:u.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let u=performance.getEntriesByName(this._marks.measure);return u.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),u=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),u}},c.bt=function(u,s,h,m,v){return a(this,void 0,void 0,function*(){if(I())try{return yield it(u,s,h,m,v)}catch{}return function(S,C,L,P,O){const H=S.width,K=S.height;lt&&mt||(lt=new OffscreenCanvas(H,K),mt=lt.getContext("2d",{willReadFrequently:!0})),lt.width=H,lt.height=K,mt.drawImage(S,0,0,H,K);const re=mt.getImageData(C,L,P,O);return mt.clearRect(0,0,H,K),re.data}(u,s,h,m,v)})},c.bu=l_,c.bv=d,c.bw=p,c.bx=Dg,c.by=Ps,c.bz=function(u){return u.message===dt},c.c=Xe,c.d=u=>a(void 0,void 0,void 0,function*(){if(u.byteLength===0)return createImageBitmap(new ImageData(1,1));const s=new Blob([new Uint8Array(u)],{type:"image/png"});try{return createImageBitmap(s)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),c.e=J,c.f=u=>new Promise((s,h)=>{const m=new Image;m.onload=()=>{s(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=Ct})},m.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(u)],{type:"image/png"});m.src=u.byteLength?URL.createObjectURL(v):Ct}),c.g=yt,c.h=(u,s)=>yn(J(u,{type:"json"}),s),c.i=Ge,c.j=St,c.k=Ve,c.l=(u,s)=>yn(J(u,{type:"arrayBuffer"}),s),c.m=yn,c.n=function(u){return new pp(u).readFields(i2,[])},c.o=Cu,c.p=Ug,c.q=Fi,c.r=Kd,c.s=ut,c.t=ha,c.u=Vt,c.v=_e,c.w=Pe,c.x=Ds,c.y=function([u,s,h]){return s+=90,s*=Math.PI/180,h*=Math.PI/180,{x:u*Math.cos(s)*Math.sin(h),y:u*Math.sin(s)*Math.sin(h),z:u*Math.cos(h)}},c.z=Mi}),i("worker",["./shared"],function(c){class a{constructor(ne){this.keyCache={},ne&&this.replace(ne)}replace(ne){this._layerConfigs={},this._layers={},this.update(ne,[])}update(ne,se){for(const we of ne){this._layerConfigs[we.id]=we;const Fe=this._layers[we.id]=c.az(we);Fe._featureFilter=c.a6(Fe.filter),this.keyCache[we.id]&&delete this.keyCache[we.id]}for(const we of se)delete this.keyCache[we],delete this._layerConfigs[we],delete this._layers[we];this.familiesBySource={};const ge=c.bh(Object.values(this._layerConfigs),this.keyCache);for(const we of ge){const Fe=we.map(Ke=>this._layers[Ke.id]),Be=Fe[0];if(Be.visibility==="none")continue;const Ue=Be.source||"";let ze=this.familiesBySource[Ue];ze||(ze=this.familiesBySource[Ue]={});const te=Be.sourceLayer||"_geojsonTileLayer";let He=ze[te];He||(He=ze[te]=[]),He.push(Fe)}}}class d{constructor(ne){const se={},ge=[];for(const Ue in ne){const ze=ne[Ue],te=se[Ue]={};for(const He in ze){const Ke=ze[+He];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const Ye={x:0,y:0,w:Ke.bitmap.width+2,h:Ke.bitmap.height+2};ge.push(Ye),te[He]={rect:Ye,metrics:Ke.metrics}}}const{w:we,h:Fe}=c.p(ge),Be=new c.o({width:we||1,height:Fe||1});for(const Ue in ne){const ze=ne[Ue];for(const te in ze){const He=ze[+te];if(!He||He.bitmap.width===0||He.bitmap.height===0)continue;const Ke=se[Ue][te].rect;c.o.copy(He.bitmap,Be,{x:0,y:0},{x:Ke.x+1,y:Ke.y+1},He.bitmap)}}this.image=Be,this.positions=se}}c.bi("GlyphAtlas",d);class p{constructor(ne){this.tileID=new c.Q(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.uid=ne.uid,this.zoom=ne.zoom,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.returnDependencies=!!ne.returnDependencies,this.promoteId=ne.promoteId,this.inFlightDependencies=[]}parse(ne,se,ge,we){return c._(this,void 0,void 0,function*(){this.status="parsing",this.data=ne,this.collisionBoxArray=new c.a4;const Fe=new c.bj(Object.keys(ne.layers).sort()),Be=new c.bk(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const Ue={},ze={featureIndex:Be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ge},te=se.familiesBySource[this.source];for(const kn in te){const Pr=ne.layers[kn];if(!Pr)continue;Pr.version===1&&c.w(`Vector tile source "${this.source}" layer "${kn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ti=Fe.encode(kn),Ti=[];for(let Di=0;Di<Pr.length;Di++){const fi=Pr.feature(Di),No=Be.getId(fi,kn);Ti.push({feature:fi,id:No,index:Di,sourceLayerIndex:ti})}for(const Di of te[kn]){const fi=Di[0];fi.source!==this.source&&c.w(`layer.source = ${fi.source} does not equal this.source = ${this.source}`),fi.minzoom&&this.zoom<Math.floor(fi.minzoom)||fi.maxzoom&&this.zoom>=fi.maxzoom||fi.visibility!=="none"&&(_(Di,this.zoom,ge),(Ue[fi.id]=fi.createBucket({index:Be.bucketLayerIDs.length,layers:Di,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ti,sourceID:this.source})).populate(Ti,ze,this.tileID.canonical),Be.bucketLayerIDs.push(Di.map(No=>No.id)))}}const He=c.aE(ze.glyphDependencies,kn=>Object.keys(kn).map(Number));this.inFlightDependencies.forEach(kn=>kn==null?void 0:kn.abort()),this.inFlightDependencies=[];let Ke=Promise.resolve({});if(Object.keys(He).length){const kn=new AbortController;this.inFlightDependencies.push(kn),Ke=we.sendAsync({type:"GG",data:{stacks:He,source:this.source,tileID:this.tileID,type:"glyphs"}},kn)}const Ye=Object.keys(ze.iconDependencies);let ct=Promise.resolve({});if(Ye.length){const kn=new AbortController;this.inFlightDependencies.push(kn),ct=we.sendAsync({type:"GI",data:{icons:Ye,source:this.source,tileID:this.tileID,type:"icons"}},kn)}const Tt=Object.keys(ze.patternDependencies);let Jt=Promise.resolve({});if(Tt.length){const kn=new AbortController;this.inFlightDependencies.push(kn),Jt=we.sendAsync({type:"GI",data:{icons:Tt,source:this.source,tileID:this.tileID,type:"patterns"}},kn)}const[dn,xn,jn]=yield Promise.all([Ke,ct,Jt]),kr=new d(dn),qr=new c.bl(xn,jn);for(const kn in Ue){const Pr=Ue[kn];Pr instanceof c.a5?(_(Pr.layers,this.zoom,ge),c.bm({bucket:Pr,glyphMap:dn,glyphPositions:kr.positions,imageMap:xn,imagePositions:qr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Pr.hasPattern&&(Pr instanceof c.bn||Pr instanceof c.bo||Pr instanceof c.bp)&&(_(Pr.layers,this.zoom,ge),Pr.addFeatures(ze,this.tileID.canonical,qr.patternPositions))}return this.status="done",{buckets:Object.values(Ue).filter(kn=>!kn.isEmpty()),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:kr.image,imageAtlas:qr,glyphMap:this.returnDependencies?dn:null,iconMap:this.returnDependencies?xn:null,glyphPositions:this.returnDependencies?kr.positions:null}})}}function _(Ce,ne,se){const ge=new c.a8(ne);for(const we of Ce)we.recalculate(ge,se)}class y{constructor(ne,se,ge){this.actor=ne,this.layerIndex=se,this.availableImages=ge,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ne,se){return c._(this,void 0,void 0,function*(){const ge=yield c.l(ne.request,se);try{return{vectorTile:new c.bq.VectorTile(new c.br(ge.data)),rawData:ge.data,cacheControl:ge.cacheControl,expires:ge.expires}}catch(we){const Fe=new Uint8Array(ge.data);let Be=`Unable to parse the tile at ${ne.request.url}, `;throw Be+=Fe[0]===31&&Fe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${we.messge}`,new Error(Be)}})}loadTile(ne){return c._(this,void 0,void 0,function*(){const se=ne.uid,ge=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new c.bs(ne.request),we=new p(ne);this.loading[se]=we;const Fe=new AbortController;we.abort=Fe;try{const Be=yield this.loadVectorTile(ne,Fe);if(delete this.loading[se],!Be)return null;const Ue=Be.rawData,ze={};Be.expires&&(ze.expires=Be.expires),Be.cacheControl&&(ze.cacheControl=Be.cacheControl);const te={};if(ge){const Ke=ge.finish();Ke&&(te.resourceTiming=JSON.parse(JSON.stringify(Ke)))}we.vectorTile=Be.vectorTile;const He=we.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[se]=we,this.fetching[se]={rawTileData:Ue,cacheControl:ze,resourceTiming:te};try{const Ke=yield He;return c.e({rawTileData:Ue.slice(0)},Ke,ze,te)}finally{delete this.fetching[se]}}catch(Be){throw delete this.loading[se],we.status="done",this.loaded[se]=we,Be}})}reloadTile(ne){return c._(this,void 0,void 0,function*(){const se=ne.uid;if(!this.loaded||!this.loaded[se])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ge=this.loaded[se];if(ge.showCollisionBoxes=ne.showCollisionBoxes,ge.status==="parsing"){const we=yield ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor);let Fe;if(this.fetching[se]){const{rawTileData:Be,cacheControl:Ue,resourceTiming:ze}=this.fetching[se];delete this.fetching[se],Fe=c.e({rawTileData:Be.slice(0)},we,Ue,ze)}else Fe=we;return Fe}if(ge.status==="done"&&ge.vectorTile)return ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(ne){return c._(this,void 0,void 0,function*(){const se=this.loading,ge=ne.uid;se&&se[ge]&&se[ge].abort&&(se[ge].abort.abort(),delete se[ge])})}removeTile(ne){return c._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ne.uid]&&delete this.loaded[ne.uid]})}}class w{constructor(){this.loaded={}}loadTile(ne){return c._(this,void 0,void 0,function*(){const{uid:se,encoding:ge,rawImageData:we,redFactor:Fe,greenFactor:Be,blueFactor:Ue,baseShift:ze}=ne,te=we.width+2,He=we.height+2,Ke=c.b(we)?new c.R({width:te,height:He},yield c.bt(we,-1,-1,te,He)):we,Ye=new c.bu(se,Ke,ge,Fe,Be,Ue,ze);return this.loaded=this.loaded||{},this.loaded[se]=Ye,Ye})}removeTile(ne){const se=this.loaded,ge=ne.uid;se&&se[ge]&&delete se[ge]}}function T(Ce,ne){if(Ce.length!==0){M(Ce[0],ne);for(var se=1;se<Ce.length;se++)M(Ce[se],!ne)}}function M(Ce,ne){for(var se=0,ge=0,we=0,Fe=Ce.length,Be=Fe-1;we<Fe;Be=we++){var Ue=(Ce[we][0]-Ce[Be][0])*(Ce[Be][1]+Ce[we][1]),ze=se+Ue;ge+=Math.abs(se)>=Math.abs(Ue)?se-ze+Ue:Ue-ze+se,se=ze}se+ge>=0!=!!ne&&Ce.reverse()}var $=c.bv(function Ce(ne,se){var ge,we=ne&&ne.type;if(we==="FeatureCollection")for(ge=0;ge<ne.features.length;ge++)Ce(ne.features[ge],se);else if(we==="GeometryCollection")for(ge=0;ge<ne.geometries.length;ge++)Ce(ne.geometries[ge],se);else if(we==="Feature")Ce(ne.geometry,se);else if(we==="Polygon")T(ne.coordinates,se);else if(we==="MultiPolygon")for(ge=0;ge<ne.coordinates.length;ge++)T(ne.coordinates[ge],se);return ne});const D=c.bq.VectorTileFeature.prototype.toGeoJSON;var z={exports:{}},I=c.bw,F=c.bq.VectorTileFeature,N=W;function W(Ce,ne){this.options=ne||{},this.features=Ce,this.length=Ce.length}function oe(Ce,ne){this.id=typeof Ce.id=="number"?Ce.id:void 0,this.type=Ce.type,this.rawGeometry=Ce.type===1?[Ce.geometry]:Ce.geometry,this.properties=Ce.tags,this.extent=ne||4096}W.prototype.feature=function(Ce){return new oe(this.features[Ce],this.options.extent)},oe.prototype.loadGeometry=function(){var Ce=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Ce.length;ne++){for(var se=Ce[ne],ge=[],we=0;we<se.length;we++)ge.push(new I(se[we][0],se[we][1]));this.geometry.push(ge)}return this.geometry},oe.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ce=this.geometry,ne=1/0,se=-1/0,ge=1/0,we=-1/0,Fe=0;Fe<Ce.length;Fe++)for(var Be=Ce[Fe],Ue=0;Ue<Be.length;Ue++){var ze=Be[Ue];ne=Math.min(ne,ze.x),se=Math.max(se,ze.x),ge=Math.min(ge,ze.y),we=Math.max(we,ze.y)}return[ne,ge,se,we]},oe.prototype.toGeoJSON=F.prototype.toGeoJSON;var J=c.bx,ee=N;function pe(Ce){var ne=new J;return function(se,ge){for(var we in se.layers)ge.writeMessage(3,Ie,se.layers[we])}(Ce,ne),ne.finish()}function Ie(Ce,ne){var se;ne.writeVarintField(15,Ce.version||1),ne.writeStringField(1,Ce.name||""),ne.writeVarintField(5,Ce.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<Ce.length;se++)ge.feature=Ce.feature(se),ne.writeMessage(2,Q,ge);var we=ge.keys;for(se=0;se<we.length;se++)ne.writeStringField(3,we[se]);var Fe=ge.values;for(se=0;se<Fe.length;se++)ne.writeMessage(4,Ge,Fe[se])}function Q(Ce,ne){var se=Ce.feature;se.id!==void 0&&ne.writeVarintField(1,se.id),ne.writeMessage(2,ae,Ce),ne.writeVarintField(3,se.type),ne.writeMessage(4,nt,se)}function ae(Ce,ne){var se=Ce.feature,ge=Ce.keys,we=Ce.values,Fe=Ce.keycache,Be=Ce.valuecache;for(var Ue in se.properties){var ze=se.properties[Ue],te=Fe[Ue];if(ze!==null){te===void 0&&(ge.push(Ue),Fe[Ue]=te=ge.length-1),ne.writeVarint(te);var He=typeof ze;He!=="string"&&He!=="boolean"&&He!=="number"&&(ze=JSON.stringify(ze));var Ke=He+":"+ze,Ye=Be[Ke];Ye===void 0&&(we.push(ze),Be[Ke]=Ye=we.length-1),ne.writeVarint(Ye)}}}function Pe(Ce,ne){return(ne<<3)+(7&Ce)}function ve(Ce){return Ce<<1^Ce>>31}function nt(Ce,ne){for(var se=Ce.loadGeometry(),ge=Ce.type,we=0,Fe=0,Be=se.length,Ue=0;Ue<Be;Ue++){var ze=se[Ue],te=1;ge===1&&(te=ze.length),ne.writeVarint(Pe(1,te));for(var He=ge===3?ze.length-1:ze.length,Ke=0;Ke<He;Ke++){Ke===1&&ge!==1&&ne.writeVarint(Pe(2,He-1));var Ye=ze[Ke].x-we,ct=ze[Ke].y-Fe;ne.writeVarint(ve(Ye)),ne.writeVarint(ve(ct)),we+=Ye,Fe+=ct}ge===3&&ne.writeVarint(Pe(7,1))}}function Ge(Ce,ne){var se=typeof Ce;se==="string"?ne.writeStringField(1,Ce):se==="boolean"?ne.writeBooleanField(7,Ce):se==="number"&&(Ce%1!=0?ne.writeDoubleField(3,Ce):Ce<0?ne.writeSVarintField(6,Ce):ne.writeVarintField(5,Ce))}z.exports=pe,z.exports.fromVectorTileJs=pe,z.exports.fromGeojsonVt=function(Ce,ne){ne=ne||{};var se={};for(var ge in Ce)se[ge]=new ee(Ce[ge].features,ne),se[ge].name=ge,se[ge].version=ne.version,se[ge].extent=ne.extent;return pe({layers:se})},z.exports.GeoJSONWrapper=ee;var Ee=c.bv(z.exports);const De={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},Ct=Math.fround||(it=new Float32Array(1),Ce=>(it[0]=+Ce,it[0]));var it;const lt=3,mt=5,dt=6;class Xe{constructor(ne){this.options=Object.assign(Object.create(De),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:se,minZoom:ge,maxZoom:we}=this.options;se&&console.time("total time");const Fe=`prepare ${ne.length} points`;se&&console.time(Fe),this.points=ne;const Be=[];for(let ze=0;ze<ne.length;ze++){const te=ne[ze];if(!te.geometry)continue;const[He,Ke]=te.geometry.coordinates,Ye=Ct(Rt(He)),ct=Ct(It(Ke));Be.push(Ye,ct,1/0,ze,-1,1),this.options.reduce&&Be.push(0)}let Ue=this.trees[we+1]=this._createTree(Be);se&&console.timeEnd(Fe);for(let ze=we;ze>=ge;ze--){const te=+Date.now();Ue=this.trees[ze]=this._createTree(this._cluster(Ue,ze)),se&&console.log("z%d: %d clusters in %dms",ze,Ue.numItems,+Date.now()-te)}return se&&console.timeEnd("total time"),this}getClusters(ne,se){let ge=((ne[0]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,ne[1]));let Fe=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ge=-180,Fe=180;else if(ge>Fe){const Ke=this.getClusters([ge,we,180,Be],se),Ye=this.getClusters([-180,we,Fe,Be],se);return Ke.concat(Ye)}const Ue=this.trees[this._limitZoom(se)],ze=Ue.range(Rt(ge),It(Be),Rt(Fe),It(we)),te=Ue.data,He=[];for(const Ke of ze){const Ye=this.stride*Ke;He.push(te[Ye+mt]>1?$t(te,Ye,this.clusterProps):this.points[te[Ye+lt]])}return He}getChildren(ne){const se=this._getOriginId(ne),ge=this._getOriginZoom(ne),we="No cluster with the specified id.",Fe=this.trees[ge];if(!Fe)throw new Error(we);const Be=Fe.data;if(se*this.stride>=Be.length)throw new Error(we);const Ue=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),ze=Fe.within(Be[se*this.stride],Be[se*this.stride+1],Ue),te=[];for(const He of ze){const Ke=He*this.stride;Be[Ke+4]===ne&&te.push(Be[Ke+mt]>1?$t(Be,Ke,this.clusterProps):this.points[Be[Ke+lt]])}if(te.length===0)throw new Error(we);return te}getLeaves(ne,se,ge){const we=[];return this._appendLeaves(we,ne,se=se||10,ge=ge||0,0),we}getTile(ne,se,ge){const we=this.trees[this._limitZoom(ne)],Fe=Math.pow(2,ne),{extent:Be,radius:Ue}=this.options,ze=Ue/Be,te=(ge-ze)/Fe,He=(ge+1+ze)/Fe,Ke={features:[]};return this._addTileFeatures(we.range((se-ze)/Fe,te,(se+1+ze)/Fe,He),we.data,se,ge,Fe,Ke),se===0&&this._addTileFeatures(we.range(1-ze/Fe,te,1,He),we.data,Fe,ge,Fe,Ke),se===Fe-1&&this._addTileFeatures(we.range(0,te,ze/Fe,He),we.data,-1,ge,Fe,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(ne){let se=this._getOriginZoom(ne)-1;for(;se<=this.options.maxZoom;){const ge=this.getChildren(ne);if(se++,ge.length!==1)break;ne=ge[0].properties.cluster_id}return se}_appendLeaves(ne,se,ge,we,Fe){const Be=this.getChildren(se);for(const Ue of Be){const ze=Ue.properties;if(ze&&ze.cluster?Fe+ze.point_count<=we?Fe+=ze.point_count:Fe=this._appendLeaves(ne,ze.cluster_id,ge,we,Fe):Fe<we?Fe++:ne.push(Ue),ne.length===ge)break}return Fe}_createTree(ne){const se=new c.au(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ne.length;ge+=this.stride)se.add(ne[ge],ne[ge+1]);return se.finish(),se.data=ne,se}_addTileFeatures(ne,se,ge,we,Fe,Be){for(const Ue of ne){const ze=Ue*this.stride,te=se[ze+mt]>1;let He,Ke,Ye;if(te)He=yt(se,ze,this.clusterProps),Ke=se[ze],Ye=se[ze+1];else{const Jt=this.points[se[ze+lt]];He=Jt.properties;const[dn,xn]=Jt.geometry.coordinates;Ke=Rt(dn),Ye=It(xn)}const ct={type:1,geometry:[[Math.round(this.options.extent*(Ke*Fe-ge)),Math.round(this.options.extent*(Ye*Fe-we))]],tags:He};let Tt;Tt=te||this.options.generateId?se[ze+lt]:this.points[se[ze+lt]].id,Tt!==void 0&&(ct.id=Tt),Be.features.push(ct)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,se){const{radius:ge,extent:we,reduce:Fe,minPoints:Be}=this.options,Ue=ge/(we*Math.pow(2,se)),ze=ne.data,te=[],He=this.stride;for(let Ke=0;Ke<ze.length;Ke+=He){if(ze[Ke+2]<=se)continue;ze[Ke+2]=se;const Ye=ze[Ke],ct=ze[Ke+1],Tt=ne.within(ze[Ke],ze[Ke+1],Ue),Jt=ze[Ke+mt];let dn=Jt;for(const xn of Tt){const jn=xn*He;ze[jn+2]>se&&(dn+=ze[jn+mt])}if(dn>Jt&&dn>=Be){let xn,jn=Ye*Jt,kr=ct*Jt,qr=-1;const kn=((Ke/He|0)<<5)+(se+1)+this.points.length;for(const Pr of Tt){const ti=Pr*He;if(ze[ti+2]<=se)continue;ze[ti+2]=se;const Ti=ze[ti+mt];jn+=ze[ti]*Ti,kr+=ze[ti+1]*Ti,ze[ti+4]=kn,Fe&&(xn||(xn=this._map(ze,Ke,!0),qr=this.clusterProps.length,this.clusterProps.push(xn)),Fe(xn,this._map(ze,ti)))}ze[Ke+4]=kn,te.push(jn/dn,kr/dn,1/0,kn,-1,dn),Fe&&te.push(qr)}else{for(let xn=0;xn<He;xn++)te.push(ze[Ke+xn]);if(dn>1)for(const xn of Tt){const jn=xn*He;if(!(ze[jn+2]<=se)){ze[jn+2]=se;for(let kr=0;kr<He;kr++)te.push(ze[jn+kr])}}}}return te}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,se,ge){if(ne[se+mt]>1){const Be=this.clusterProps[ne[se+dt]];return ge?Object.assign({},Be):Be}const we=this.points[ne[se+lt]].properties,Fe=this.options.map(we);return ge&&Fe===we?Object.assign({},Fe):Fe}}function $t(Ce,ne,se){return{type:"Feature",id:Ce[ne+lt],properties:yt(Ce,ne,se),geometry:{type:"Point",coordinates:[(ge=Ce[ne],360*(ge-.5)),Qt(Ce[ne+1])]}};var ge}function yt(Ce,ne,se){const ge=Ce[ne+mt],we=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,Fe=Ce[ne+dt],Be=Fe===-1?{}:Object.assign({},se[Fe]);return Object.assign(Be,{cluster:!0,cluster_id:Ce[ne+lt],point_count:ge,point_count_abbreviated:we})}function Rt(Ce){return Ce/360+.5}function It(Ce){const ne=Math.sin(Ce*Math.PI/180),se=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return se<0?0:se>1?1:se}function Qt(Ce){const ne=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function yn(Ce,ne,se,ge){for(var we,Fe=ge,Be=se-ne>>1,Ue=se-ne,ze=Ce[ne],te=Ce[ne+1],He=Ce[se],Ke=Ce[se+1],Ye=ne+3;Ye<se;Ye+=3){var ct=ut(Ce[Ye],Ce[Ye+1],ze,te,He,Ke);if(ct>Fe)we=Ye,Fe=ct;else if(ct===Fe){var Tt=Math.abs(Ye-Be);Tt<Ue&&(we=Ye,Ue=Tt)}}Fe>ge&&(we-ne>3&&yn(Ce,ne,we,ge),Ce[we+2]=Fe,se-we>3&&yn(Ce,we,se,ge))}function ut(Ce,ne,se,ge,we,Fe){var Be=we-se,Ue=Fe-ge;if(Be!==0||Ue!==0){var ze=((Ce-se)*Be+(ne-ge)*Ue)/(Be*Be+Ue*Ue);ze>1?(se=we,ge=Fe):ze>0&&(se+=Be*ze,ge+=Ue*ze)}return(Be=Ce-se)*Be+(Ue=ne-ge)*Ue}function Wt(Ce,ne,se,ge){var we={id:Ce===void 0?null:Ce,type:ne,geometry:se,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Fe){var Be=Fe.geometry,Ue=Fe.type;if(Ue==="Point"||Ue==="MultiPoint"||Ue==="LineString")Ze(Fe,Be);else if(Ue==="Polygon"||Ue==="MultiLineString")for(var ze=0;ze<Be.length;ze++)Ze(Fe,Be[ze]);else if(Ue==="MultiPolygon")for(ze=0;ze<Be.length;ze++)for(var te=0;te<Be[ze].length;te++)Ze(Fe,Be[ze][te])}(we),we}function Ze(Ce,ne){for(var se=0;se<ne.length;se+=3)Ce.minX=Math.min(Ce.minX,ne[se]),Ce.minY=Math.min(Ce.minY,ne[se+1]),Ce.maxX=Math.max(Ce.maxX,ne[se]),Ce.maxY=Math.max(Ce.maxY,ne[se+1])}function Ve(Ce,ne,se,ge){if(ne.geometry){var we=ne.geometry.coordinates,Fe=ne.geometry.type,Be=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),Ue=[],ze=ne.id;if(se.promoteId?ze=ne.properties[se.promoteId]:se.generateId&&(ze=ge||0),Fe==="Point")St(we,Ue);else if(Fe==="MultiPoint")for(var te=0;te<we.length;te++)St(we[te],Ue);else if(Fe==="LineString")Ut(we,Ue,Be,!1);else if(Fe==="MultiLineString"){if(se.lineMetrics){for(te=0;te<we.length;te++)Ut(we[te],Ue=[],Be,!1),Ce.push(Wt(ze,"LineString",Ue,ne.properties));return}_e(we,Ue,Be,!1)}else if(Fe==="Polygon")_e(we,Ue,Be,!0);else{if(Fe!=="MultiPolygon"){if(Fe==="GeometryCollection"){for(te=0;te<ne.geometry.geometries.length;te++)Ve(Ce,{id:ze,geometry:ne.geometry.geometries[te],properties:ne.properties},se,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(te=0;te<we.length;te++){var He=[];_e(we[te],He,Be,!0),Ue.push(He)}}Ce.push(Wt(ze,Fe,Ue,ne.properties))}}function St(Ce,ne){ne.push(Pn(Ce[0])),ne.push(Ne(Ce[1])),ne.push(0)}function Ut(Ce,ne,se,ge){for(var we,Fe,Be=0,Ue=0;Ue<Ce.length;Ue++){var ze=Pn(Ce[Ue][0]),te=Ne(Ce[Ue][1]);ne.push(ze),ne.push(te),ne.push(0),Ue>0&&(Be+=ge?(we*te-ze*Fe)/2:Math.sqrt(Math.pow(ze-we,2)+Math.pow(te-Fe,2))),we=ze,Fe=te}var He=ne.length-3;ne[2]=1,yn(ne,0,He,se),ne[He+2]=1,ne.size=Math.abs(Be),ne.start=0,ne.end=ne.size}function _e(Ce,ne,se,ge){for(var we=0;we<Ce.length;we++){var Fe=[];Ut(Ce[we],Fe,se,ge),ne.push(Fe)}}function Pn(Ce){return Ce/360+.5}function Ne(Ce){var ne=Math.sin(Ce*Math.PI/180),se=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return se<0?0:se>1?1:se}function et(Ce,ne,se,ge,we,Fe,Be,Ue){if(ge/=ne,Fe>=(se/=ne)&&Be<ge)return Ce;if(Be<se||Fe>=ge)return null;for(var ze=[],te=0;te<Ce.length;te++){var He=Ce[te],Ke=He.geometry,Ye=He.type,ct=we===0?He.minX:He.minY,Tt=we===0?He.maxX:He.maxY;if(ct>=se&&Tt<ge)ze.push(He);else if(!(Tt<se||ct>=ge)){var Jt=[];if(Ye==="Point"||Ye==="MultiPoint")Kt(Ke,Jt,se,ge,we);else if(Ye==="LineString")er(Ke,Jt,se,ge,we,!1,Ue.lineMetrics);else if(Ye==="MultiLineString")gr(Ke,Jt,se,ge,we,!1);else if(Ye==="Polygon")gr(Ke,Jt,se,ge,we,!0);else if(Ye==="MultiPolygon")for(var dn=0;dn<Ke.length;dn++){var xn=[];gr(Ke[dn],xn,se,ge,we,!0),xn.length&&Jt.push(xn)}if(Jt.length){if(Ue.lineMetrics&&Ye==="LineString"){for(dn=0;dn<Jt.length;dn++)ze.push(Wt(He.id,Ye,Jt[dn],He.tags));continue}Ye!=="LineString"&&Ye!=="MultiLineString"||(Jt.length===1?(Ye="LineString",Jt=Jt[0]):Ye="MultiLineString"),Ye!=="Point"&&Ye!=="MultiPoint"||(Ye=Jt.length===3?"Point":"MultiPoint"),ze.push(Wt(He.id,Ye,Jt,He.tags))}}}return ze.length?ze:null}function Kt(Ce,ne,se,ge,we){for(var Fe=0;Fe<Ce.length;Fe+=3){var Be=Ce[Fe+we];Be>=se&&Be<=ge&&(ne.push(Ce[Fe]),ne.push(Ce[Fe+1]),ne.push(Ce[Fe+2]))}}function er(Ce,ne,se,ge,we,Fe,Be){for(var Ue,ze,te=ur(Ce),He=we===0?ei:co,Ke=Ce.start,Ye=0;Ye<Ce.length-3;Ye+=3){var ct=Ce[Ye],Tt=Ce[Ye+1],Jt=Ce[Ye+2],dn=Ce[Ye+3],xn=Ce[Ye+4],jn=we===0?ct:Tt,kr=we===0?dn:xn,qr=!1;Be&&(Ue=Math.sqrt(Math.pow(ct-dn,2)+Math.pow(Tt-xn,2))),jn<se?kr>se&&(ze=He(te,ct,Tt,dn,xn,se),Be&&(te.start=Ke+Ue*ze)):jn>ge?kr<ge&&(ze=He(te,ct,Tt,dn,xn,ge),Be&&(te.start=Ke+Ue*ze)):Qr(te,ct,Tt,Jt),kr<se&&jn>=se&&(ze=He(te,ct,Tt,dn,xn,se),qr=!0),kr>ge&&jn<=ge&&(ze=He(te,ct,Tt,dn,xn,ge),qr=!0),!Fe&&qr&&(Be&&(te.end=Ke+Ue*ze),ne.push(te),te=ur(Ce)),Be&&(Ke+=Ue)}var kn=Ce.length-3;ct=Ce[kn],Tt=Ce[kn+1],Jt=Ce[kn+2],(jn=we===0?ct:Tt)>=se&&jn<=ge&&Qr(te,ct,Tt,Jt),kn=te.length-3,Fe&&kn>=3&&(te[kn]!==te[0]||te[kn+1]!==te[1])&&Qr(te,te[0],te[1],te[2]),te.length&&ne.push(te)}function ur(Ce){var ne=[];return ne.size=Ce.size,ne.start=Ce.start,ne.end=Ce.end,ne}function gr(Ce,ne,se,ge,we,Fe){for(var Be=0;Be<Ce.length;Be++)er(Ce[Be],ne,se,ge,we,Fe,!1)}function Qr(Ce,ne,se,ge){Ce.push(ne),Ce.push(se),Ce.push(ge)}function ei(Ce,ne,se,ge,we,Fe){var Be=(Fe-ne)/(ge-ne);return Ce.push(Fe),Ce.push(se+(we-se)*Be),Ce.push(1),Be}function co(Ce,ne,se,ge,we,Fe){var Be=(Fe-se)/(we-se);return Ce.push(ne+(ge-ne)*Be),Ce.push(Fe),Ce.push(1),Be}function hr(Ce,ne){for(var se=[],ge=0;ge<Ce.length;ge++){var we,Fe=Ce[ge],Be=Fe.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")we=bt(Fe.geometry,ne);else if(Be==="MultiLineString"||Be==="Polygon"){we=[];for(var Ue=0;Ue<Fe.geometry.length;Ue++)we.push(bt(Fe.geometry[Ue],ne))}else if(Be==="MultiPolygon")for(we=[],Ue=0;Ue<Fe.geometry.length;Ue++){for(var ze=[],te=0;te<Fe.geometry[Ue].length;te++)ze.push(bt(Fe.geometry[Ue][te],ne));we.push(ze)}se.push(Wt(Fe.id,Be,we,Fe.tags))}return se}function bt(Ce,ne){var se=[];se.size=Ce.size,Ce.start!==void 0&&(se.start=Ce.start,se.end=Ce.end);for(var ge=0;ge<Ce.length;ge+=3)se.push(Ce[ge]+ne,Ce[ge+1],Ce[ge+2]);return se}function Bn(Ce,ne){if(Ce.transformed)return Ce;var se,ge,we,Fe=1<<Ce.z,Be=Ce.x,Ue=Ce.y;for(se=0;se<Ce.features.length;se++){var ze=Ce.features[se],te=ze.geometry,He=ze.type;if(ze.geometry=[],He===1)for(ge=0;ge<te.length;ge+=2)ze.geometry.push(xr(te[ge],te[ge+1],ne,Fe,Be,Ue));else for(ge=0;ge<te.length;ge++){var Ke=[];for(we=0;we<te[ge].length;we+=2)Ke.push(xr(te[ge][we],te[ge][we+1],ne,Fe,Be,Ue));ze.geometry.push(Ke)}}return Ce.transformed=!0,Ce}function xr(Ce,ne,se,ge,we,Fe){return[Math.round(se*(Ce*ge-we)),Math.round(se*(ne*ge-Fe))]}function uo(Ce,ne,se,ge,we){for(var Fe=ne===we.maxZoom?0:we.tolerance/((1<<ne)*we.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:ge,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ue=0;Ue<Ce.length;Ue++){Be.numFeatures++,Rn(Be,Ce[Ue],Fe,we);var ze=Ce[Ue].minX,te=Ce[Ue].minY,He=Ce[Ue].maxX,Ke=Ce[Ue].maxY;ze<Be.minX&&(Be.minX=ze),te<Be.minY&&(Be.minY=te),He>Be.maxX&&(Be.maxX=He),Ke>Be.maxY&&(Be.maxY=Ke)}return Be}function Rn(Ce,ne,se,ge){var we=ne.geometry,Fe=ne.type,Be=[];if(Fe==="Point"||Fe==="MultiPoint")for(var Ue=0;Ue<we.length;Ue+=3)Be.push(we[Ue]),Be.push(we[Ue+1]),Ce.numPoints++,Ce.numSimplified++;else if(Fe==="LineString")Pt(Be,we,Ce,se,!1,!1);else if(Fe==="MultiLineString"||Fe==="Polygon")for(Ue=0;Ue<we.length;Ue++)Pt(Be,we[Ue],Ce,se,Fe==="Polygon",Ue===0);else if(Fe==="MultiPolygon")for(var ze=0;ze<we.length;ze++){var te=we[ze];for(Ue=0;Ue<te.length;Ue++)Pt(Be,te[Ue],Ce,se,!0,Ue===0)}if(Be.length){var He=ne.tags||null;if(Fe==="LineString"&&ge.lineMetrics){for(var Ke in He={},ne.tags)He[Ke]=ne.tags[Ke];He.mapbox_clip_start=we.start/we.size,He.mapbox_clip_end=we.end/we.size}var Ye={geometry:Be,type:Fe==="Polygon"||Fe==="MultiPolygon"?3:Fe==="LineString"||Fe==="MultiLineString"?2:1,tags:He};ne.id!==null&&(Ye.id=ne.id),Ce.features.push(Ye)}}function Pt(Ce,ne,se,ge,we,Fe){var Be=ge*ge;if(ge>0&&ne.size<(we?Be:ge))se.numPoints+=ne.length/3;else{for(var Ue=[],ze=0;ze<ne.length;ze+=3)(ge===0||ne[ze+2]>Be)&&(se.numSimplified++,Ue.push(ne[ze]),Ue.push(ne[ze+1])),se.numPoints++;we&&function(te,He){for(var Ke=0,Ye=0,ct=te.length,Tt=ct-2;Ye<ct;Tt=Ye,Ye+=2)Ke+=(te[Ye]-te[Tt])*(te[Ye+1]+te[Tt+1]);if(Ke>0===He)for(Ye=0,ct=te.length;Ye<ct/2;Ye+=2){var Jt=te[Ye],dn=te[Ye+1];te[Ye]=te[ct-2-Ye],te[Ye+1]=te[ct-1-Ye],te[ct-2-Ye]=Jt,te[ct-1-Ye]=dn}}(Ue,Fe),Ce.push(Ue)}}function fn(Ce,ne){var se=(ne=this.options=function(we,Fe){for(var Be in Fe)we[Be]=Fe[Be];return we}(Object.create(this.options),ne)).debug;if(se&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(we,Fe){var Be=[];if(we.type==="FeatureCollection")for(var Ue=0;Ue<we.features.length;Ue++)Ve(Be,we.features[Ue],Fe,Ue);else Ve(Be,we.type==="Feature"?we:{geometry:we},Fe);return Be}(Ce,ne);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(we,Fe){var Be=Fe.buffer/Fe.extent,Ue=we,ze=et(we,1,-1-Be,Be,0,-1,2,Fe),te=et(we,1,1-Be,2+Be,0,-1,2,Fe);return(ze||te)&&(Ue=et(we,1,-Be,1+Be,0,-1,2,Fe)||[],ze&&(Ue=hr(ze,1).concat(Ue)),te&&(Ue=Ue.concat(hr(te,-1)))),Ue}(ge,ne),ge.length&&this.splitTile(ge,0,0,0),se&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function mn(Ce,ne,se){return 32*((1<<Ce)*se+ne)+Ce}function wn(Ce,ne){return ne?Ce.properties[ne]:Ce.id}function ln(Ce,ne){if(Ce==null)return!0;if(Ce.type==="Feature")return wn(Ce,ne)!=null;if(Ce.type==="FeatureCollection"){const se=new Set;for(const ge of Ce.features){const we=wn(ge,ne);if(we==null||se.has(we))return!1;se.add(we)}return!0}return!1}function Gt(Ce,ne){const se=new Map;if(Ce!=null)if(Ce.type==="Feature")se.set(wn(Ce,ne),Ce);else for(const ge of Ce.features)se.set(wn(ge,ne),ge);return se}fn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},fn.prototype.splitTile=function(Ce,ne,se,ge,we,Fe,Be){for(var Ue=[Ce,ne,se,ge],ze=this.options,te=ze.debug;Ue.length;){ge=Ue.pop(),se=Ue.pop(),ne=Ue.pop(),Ce=Ue.pop();var He=1<<ne,Ke=mn(ne,se,ge),Ye=this.tiles[Ke];if(!Ye&&(te>1&&console.time("creation"),Ye=this.tiles[Ke]=uo(Ce,ne,se,ge,ze),this.tileCoords.push({z:ne,x:se,y:ge}),te)){te>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,se,ge,Ye.numFeatures,Ye.numPoints,Ye.numSimplified),console.timeEnd("creation"));var ct="z"+ne;this.stats[ct]=(this.stats[ct]||0)+1,this.total++}if(Ye.source=Ce,we){if(ne===ze.maxZoom||ne===we)continue;var Tt=1<<we-ne;if(se!==Math.floor(Fe/Tt)||ge!==Math.floor(Be/Tt))continue}else if(ne===ze.indexMaxZoom||Ye.numPoints<=ze.indexMaxPoints)continue;if(Ye.source=null,Ce.length!==0){te>1&&console.time("clipping");var Jt,dn,xn,jn,kr,qr,kn=.5*ze.buffer/ze.extent,Pr=.5-kn,ti=.5+kn,Ti=1+kn;Jt=dn=xn=jn=null,kr=et(Ce,He,se-kn,se+ti,0,Ye.minX,Ye.maxX,ze),qr=et(Ce,He,se+Pr,se+Ti,0,Ye.minX,Ye.maxX,ze),Ce=null,kr&&(Jt=et(kr,He,ge-kn,ge+ti,1,Ye.minY,Ye.maxY,ze),dn=et(kr,He,ge+Pr,ge+Ti,1,Ye.minY,Ye.maxY,ze),kr=null),qr&&(xn=et(qr,He,ge-kn,ge+ti,1,Ye.minY,Ye.maxY,ze),jn=et(qr,He,ge+Pr,ge+Ti,1,Ye.minY,Ye.maxY,ze),qr=null),te>1&&console.timeEnd("clipping"),Ue.push(Jt||[],ne+1,2*se,2*ge),Ue.push(dn||[],ne+1,2*se,2*ge+1),Ue.push(xn||[],ne+1,2*se+1,2*ge),Ue.push(jn||[],ne+1,2*se+1,2*ge+1)}}},fn.prototype.getTile=function(Ce,ne,se){var ge=this.options,we=ge.extent,Fe=ge.debug;if(Ce<0||Ce>24)return null;var Be=1<<Ce,Ue=mn(Ce,ne=(ne%Be+Be)%Be,se);if(this.tiles[Ue])return Bn(this.tiles[Ue],we);Fe>1&&console.log("drilling down to z%d-%d-%d",Ce,ne,se);for(var ze,te=Ce,He=ne,Ke=se;!ze&&te>0;)te--,He=Math.floor(He/2),Ke=Math.floor(Ke/2),ze=this.tiles[mn(te,He,Ke)];return ze&&ze.source?(Fe>1&&console.log("found parent tile z%d-%d-%d",te,He,Ke),Fe>1&&console.time("drilling down"),this.splitTile(ze.source,te,He,Ke,Ce,ne,se),Fe>1&&console.timeEnd("drilling down"),this.tiles[Ue]?Bn(this.tiles[Ue],we):null):null};class Ci extends y{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ne,se){return c._(this,void 0,void 0,function*(){const ge=ne.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const we=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!we)return null;const Fe=new class{constructor(Ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.W,this.length=Ue.length,this._features=Ue}feature(Ue){return new class{constructor(ze){this._feature=ze,this.extent=c.W,this.type=ze.type,this.properties=ze.tags,"id"in ze&&!isNaN(ze.id)&&(this.id=parseInt(ze.id,10))}loadGeometry(){if(this._feature.type===1){const ze=[];for(const te of this._feature.geometry)ze.push([new c.P(te[0],te[1])]);return ze}{const ze=[];for(const te of this._feature.geometry){const He=[];for(const Ke of te)He.push(new c.P(Ke[0],Ke[1]));ze.push(He)}return ze}}toGeoJSON(ze,te,He){return D.call(this,ze,te,He)}}(this._features[Ue])}}(we.features);let Be=Ee(Fe);return Be.byteOffset===0&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),{vectorTile:Fe,rawData:Be.buffer}})}loadData(ne){return c._(this,void 0,void 0,function*(){var se;(se=this._pendingRequest)===null||se===void 0||se.abort();const ge=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new c.bs(ne.request);this._pendingRequest=new AbortController;try{let we=yield this.loadGeoJSON(ne,this._pendingRequest);if(delete this._pendingRequest,typeof we!="object")throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if($(we,!0),ne.filter){const Be=c.by(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(ze=>`${ze.key}: ${ze.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(ze=>Be.value.evaluate({zoom:0},ze))}}this._geoJSONIndex=ne.cluster?new Xe(function({superclusterOptions:Be,clusterProperties:Ue}){if(!Ue||!Be)return Be;const ze={},te={},He={accumulated:null,zoom:0},Ke={properties:null},Ye=Object.keys(Ue);for(const ct of Ye){const[Tt,Jt]=Ue[ct],dn=c.by(Jt),xn=c.by(typeof Tt=="string"?[Tt,["accumulated"],["get",ct]]:Tt);ze[ct]=dn.value,te[ct]=xn.value}return Be.map=ct=>{Ke.properties=ct;const Tt={};for(const Jt of Ye)Tt[Jt]=ze[Jt].evaluate(He,Ke);return Tt},Be.reduce=(ct,Tt)=>{Ke.properties=Tt;for(const Jt of Ye)He.accumulated=ct[Jt],ct[Jt]=te[Jt].evaluate(He,Ke)},Be}(ne)).load(we.features):function(Be,Ue){return new fn(Be,Ue)}(we,ne.geojsonVtOptions),this.loaded={};const Fe={};if(ge){const Be=ge.finish();Be&&(Fe.resourceTiming={},Fe.resourceTiming[ne.source]=JSON.parse(JSON.stringify(Be)))}return Fe}catch(we){if(delete this._pendingRequest,c.bz(we))return{abandoned:!0};throw we}})}reloadTile(ne){const se=this.loaded;return se&&se[ne.uid]?super.reloadTile(ne):this.loadTile(ne)}loadGeoJSON(ne,se){return c._(this,void 0,void 0,function*(){const{promoteId:ge}=ne;if(ne.request){const we=yield c.h(ne.request,se);return this._dataUpdateable=ln(we.data,ge)?Gt(we.data,ge):void 0,we.data}if(typeof ne.data=="string")try{const we=JSON.parse(ne.data);return this._dataUpdateable=ln(we,ge)?Gt(we,ge):void 0,we}catch{throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`)}if(!ne.dataDiff)throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ne.source}`);return function(we,Fe,Be){var Ue,ze,te,He;if(Fe.removeAll&&we.clear(),Fe.remove)for(const Ke of Fe.remove)we.delete(Ke);if(Fe.add)for(const Ke of Fe.add){const Ye=wn(Ke,Be);Ye!=null&&we.set(Ye,Ke)}if(Fe.update)for(const Ke of Fe.update){let Ye=we.get(Ke.id);if(Ye==null)continue;const ct=!Ke.removeAllProperties&&(((Ue=Ke.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0||((ze=Ke.addOrUpdateProperties)===null||ze===void 0?void 0:ze.length)>0);if((Ke.newGeometry||Ke.removeAllProperties||ct)&&(Ye=Object.assign({},Ye),we.set(Ke.id,Ye),ct&&(Ye.properties=Object.assign({},Ye.properties))),Ke.newGeometry&&(Ye.geometry=Ke.newGeometry),Ke.removeAllProperties)Ye.properties={};else if(((te=Ke.removeProperties)===null||te===void 0?void 0:te.length)>0)for(const Tt of Ke.removeProperties)Object.prototype.hasOwnProperty.call(Ye.properties,Tt)&&delete Ye.properties[Tt];if(((He=Ke.addOrUpdateProperties)===null||He===void 0?void 0:He.length)>0)for(const{key:Tt,value:Jt}of Ke.addOrUpdateProperties)Ye.properties[Tt]=Jt}}(this._dataUpdateable,ne.dataDiff,ge),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ne){return c._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ne){return this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId)}getClusterChildren(ne){return this._geoJSONIndex.getChildren(ne.clusterId)}getClusterLeaves(ne){return this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset)}}class _r{constructor(ne){this.self=ne,this.actor=new c.C(ne),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(se,ge)=>{if(this.externalWorkerSourceTypes[se])throw new Error(`Worker source with name "${se}" already registered.`);this.externalWorkerSourceTypes[se]=ge},this.self.addProtocol=c.bf,this.self.removeProtocol=c.bg,this.self.registerRTLTextPlugin=se=>{if(c.bA.isParsed())throw new Error("RTL text plugin already registered.");c.bA.setMethods(se)},this.actor.registerMessageHandler("LDT",(se,ge)=>this._getDEMWorkerSource(se,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RDT",(se,ge)=>c._(this,void 0,void 0,function*(){this._getDEMWorkerSource(se,ge.source).removeTile(ge)})),this.actor.registerMessageHandler("GCEZ",(se,ge)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(se,ge.type,ge.source).getClusterExpansionZoom(ge)})),this.actor.registerMessageHandler("GCC",(se,ge)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(se,ge.type,ge.source).getClusterChildren(ge)})),this.actor.registerMessageHandler("GCL",(se,ge)=>c._(this,void 0,void 0,function*(){return this._getWorkerSource(se,ge.type,ge.source).getClusterLeaves(ge)})),this.actor.registerMessageHandler("LD",(se,ge)=>this._getWorkerSource(se,ge.type,ge.source).loadData(ge)),this.actor.registerMessageHandler("LT",(se,ge)=>this._getWorkerSource(se,ge.type,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RT",(se,ge)=>this._getWorkerSource(se,ge.type,ge.source).reloadTile(ge)),this.actor.registerMessageHandler("AT",(se,ge)=>this._getWorkerSource(se,ge.type,ge.source).abortTile(ge)),this.actor.registerMessageHandler("RMT",(se,ge)=>this._getWorkerSource(se,ge.type,ge.source).removeTile(ge)),this.actor.registerMessageHandler("RS",(se,ge)=>c._(this,void 0,void 0,function*(){if(!this.workerSources[se]||!this.workerSources[se][ge.type]||!this.workerSources[se][ge.type][ge.source])return;const we=this.workerSources[se][ge.type][ge.source];delete this.workerSources[se][ge.type][ge.source],we.removeSource!==void 0&&we.removeSource(ge)})),this.actor.registerMessageHandler("RM",se=>c._(this,void 0,void 0,function*(){delete this.layerIndexes[se],delete this.availableImages[se],delete this.workerSources[se],delete this.demWorkerSources[se]})),this.actor.registerMessageHandler("SR",(se,ge)=>c._(this,void 0,void 0,function*(){this.referrer=ge})),this.actor.registerMessageHandler("SRPS",(se,ge)=>this._syncRTLPluginState(se,ge)),this.actor.registerMessageHandler("IS",(se,ge)=>c._(this,void 0,void 0,function*(){this.self.importScripts(ge)})),this.actor.registerMessageHandler("SI",(se,ge)=>this._setImages(se,ge)),this.actor.registerMessageHandler("UL",(se,ge)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(se).update(ge.layers,ge.removedIds)})),this.actor.registerMessageHandler("SL",(se,ge)=>c._(this,void 0,void 0,function*(){this._getLayerIndex(se).replace(ge)}))}_setImages(ne,se){return c._(this,void 0,void 0,function*(){this.availableImages[ne]=se;for(const ge in this.workerSources[ne]){const we=this.workerSources[ne][ge];for(const Fe in we)we[Fe].availableImages=se}})}_syncRTLPluginState(ne,se){return c._(this,void 0,void 0,function*(){if(c.bA.isParsed())return c.bA.getState();if(se.pluginStatus!=="loading")return c.bA.setState(se),se;const ge=se.pluginURL;if(this.self.importScripts(ge),c.bA.isParsed()){const we={pluginStatus:"loaded",pluginURL:ge};return c.bA.setState(we),we}throw c.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ge}`)})}_getAvailableImages(ne){let se=this.availableImages[ne];return se||(se=[]),se}_getLayerIndex(ne){let se=this.layerIndexes[ne];return se||(se=this.layerIndexes[ne]=new a),se}_getWorkerSource(ne,se,ge){if(this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][se]||(this.workerSources[ne][se]={}),!this.workerSources[ne][se][ge]){const we={sendAsync:(Fe,Be)=>(Fe.targetMapId=ne,this.actor.sendAsync(Fe,Be))};switch(se){case"vector":this.workerSources[ne][se][ge]=new y(we,this._getLayerIndex(ne),this._getAvailableImages(ne));break;case"geojson":this.workerSources[ne][se][ge]=new Ci(we,this._getLayerIndex(ne),this._getAvailableImages(ne));break;default:this.workerSources[ne][se][ge]=new this.externalWorkerSourceTypes[se](we,this._getLayerIndex(ne),this._getAvailableImages(ne))}}return this.workerSources[ne][se][ge]}_getDEMWorkerSource(ne,se){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][se]||(this.demWorkerSources[ne][se]=new w),this.demWorkerSources[ne][se]}}return c.i(self)&&(self.worker=new _r(self)),_r}),i("index",["exports","./shared"],function(c,a){var d="4.1.3";let p,_;const y={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:x=>new Promise((l,f)=>{const g=requestAnimationFrame(l);x.signal.addEventListener("abort",()=>{cancelAnimationFrame(g),f(a.c())})}),getImageData(x,l=0){return this.getImageCanvasContext(x).getImageData(-l,-l,x.width+2*l,x.height+2*l)},getImageCanvasContext(x){const l=window.document.createElement("canvas"),f=l.getContext("2d",{willReadFrequently:!0});if(!f)throw new Error("failed to create canvas 2d context");return l.width=x.width,l.height=x.height,f.drawImage(x,0,0,x.width,x.height),f},resolveURL:x=>(p||(p=document.createElement("a")),p.href=x,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(_==null&&(_=matchMedia("(prefers-reduced-motion: reduce)")),_.matches)}};class w{static testProp(l){if(!w.docStyle)return l[0];for(let f=0;f<l.length;f++)if(l[f]in w.docStyle)return l[f];return l[0]}static create(l,f,g){const b=window.document.createElement(l);return f!==void 0&&(b.className=f),g&&g.appendChild(b),b}static createNS(l,f){return window.document.createElementNS(l,f)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(l,f){l.style[w.transformProp]=f}static addEventListener(l,f,g,b={}){l.addEventListener(f,g,"passive"in b?b:b.capture)}static removeEventListener(l,f,g,b={}){l.removeEventListener(f,g,"passive"in b?b:b.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static getScale(l){const f=l.getBoundingClientRect();return{x:f.width/l.offsetWidth||1,y:f.height/l.offsetHeight||1,boundingClientRect:f}}static getPoint(l,f,g){const b=f.boundingClientRect;return new a.P((g.clientX-b.left)/f.x-l.clientLeft,(g.clientY-b.top)/f.y-l.clientTop)}static mousePos(l,f){const g=w.getScale(l);return w.getPoint(l,g,f)}static touchPos(l,f){const g=[],b=w.getScale(l);for(let k=0;k<f.length;k++)g.push(w.getPoint(l,b,f[k]));return g}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(x){!D&&$&&(z?I(x):M=x)}};let M,$,D=!1,z=!1;function I(x){const l=x.createTexture();x.bindTexture(x.TEXTURE_2D,l);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,$),x.isContextLost())return;T.supported=!0}catch{}x.deleteTexture(l),D=!0}var F;typeof document<"u"&&($=document.createElement("img"),$.onload=function(){M&&I(M),M=null,z=!0},$.onerror=function(){D=!0,M=null},$.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(x){let l,f,g,b;x.resetRequestQueue=()=>{l=[],f=0,g=0,b={}},x.addThrottleControl=B=>{const G=g++;return b[G]=B,G},x.removeThrottleControl=B=>{delete b[B],E()},x.getImage=(B,G,X=!0)=>new Promise((Y,de)=>{T.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),a.e(B,{type:"image"}),l.push({abortController:G,requestParameters:B,supportImageRefresh:X,state:"queued",onError:Se=>{de(Se)},onSuccess:Se=>{Y(Se)}}),E()});const k=B=>a._(this,void 0,void 0,function*(){B.state="running";const{requestParameters:G,supportImageRefresh:X,onError:Y,onSuccess:de,abortController:Se}=B,ke=X===!1&&!a.i(self)&&!a.g(G.url)&&(!G.headers||Object.keys(G.headers).reduce((Re,Je)=>Re&&Je==="accept",!0));f++;const Me=ke?A(G,Se):a.m(G,Se);try{const Re=yield Me;delete B.abortController,B.state="completed",Re.data instanceof HTMLImageElement||a.b(Re.data)?de(Re):Re.data&&de({data:yield(ye=Re.data,typeof createImageBitmap=="function"?a.d(ye):a.f(ye)),cacheControl:Re.cacheControl,expires:Re.expires})}catch(Re){delete B.abortController,Y(Re)}finally{f--,E()}var ye}),E=()=>{const B=(()=>{for(const G of Object.keys(b))if(b[G]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let G=f;G<B&&l.length>0;G++){const X=l.shift();X.abortController.signal.aborted?G--:k(X)}},A=(B,G)=>new Promise((X,Y)=>{const de=new Image,Se=B.url,ke=B.credentials;ke&&ke==="include"?de.crossOrigin="use-credentials":(ke&&ke==="same-origin"||!a.s(Se))&&(de.crossOrigin="anonymous"),G.signal.addEventListener("abort",()=>{de.src="",Y(a.c())}),de.fetchPriority="high",de.onload=()=>{de.onerror=de.onload=null,X({data:de})},de.onerror=()=>{de.onerror=de.onload=null,G.signal.aborted||Y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},de.src=Se})}(F||(F={})),F.resetRequestQueue();class N{constructor(l){this._transformRequestFn=l}transformRequest(l,f){return this._transformRequestFn&&this._transformRequestFn(l,f)||{url:l}}normalizeSpriteURL(l,f,g){const b=function(k){const E=k.match(W);if(!E)throw new Error(`Unable to parse URL "${k}"`);return{protocol:E[1],authority:E[2],path:E[3]||"/",params:E[4]?E[4].split("&"):[]}}(l);return b.path+=`${f}${g}`,function(k){const E=k.params.length?`?${k.params.join("&")}`:"";return`${k.protocol}://${k.authority}${k.path}${E}`}(b)}setTransformRequest(l){this._transformRequestFn=l}}const W=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function oe(x){var l=new a.A(3);return l[0]=x[0],l[1]=x[1],l[2]=x[2],l}var J,ee=function(x,l,f){return x[0]=l[0]-f[0],x[1]=l[1]-f[1],x[2]=l[2]-f[2],x};J=new a.A(3),a.A!=Float32Array&&(J[0]=0,J[1]=0,J[2]=0);var pe=function(x){var l=x[0],f=x[1];return l*l+f*f};function Ie(x){const l=[];if(typeof x=="string")l.push({id:"default",url:x});else if(x&&x.length>0){const f=[];for(const{id:g,url:b}of x){const k=`${g}${b}`;f.indexOf(k)===-1&&(f.push(k),l.push({id:g,url:b}))}}return l}(function(){var x=new a.A(2);a.A!=Float32Array&&(x[0]=0,x[1]=0)})();class Q{constructor(l,f,g,b){this.context=l,this.format=g,this.texture=l.gl.createTexture(),this.update(f,b)}update(l,f,g){const{width:b,height:k}=l,E=!(this.size&&this.size[0]===b&&this.size[1]===k||g),{context:A}=this,{gl:B}=A;if(this.useMipmap=!!(f&&f.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!f||f.premultiply!==!1)),E)this.size=[b,k],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||a.b(l)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,l):B.texImage2D(B.TEXTURE_2D,0,this.format,b,k,0,this.format,B.UNSIGNED_BYTE,l.data);else{const{x:G,y:X}=g||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||a.b(l)?B.texSubImage2D(B.TEXTURE_2D,0,G,X,B.RGBA,B.UNSIGNED_BYTE,l):B.texSubImage2D(B.TEXTURE_2D,0,G,X,b,k,B.RGBA,B.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D)}bind(l,f,g){const{context:b}=this,{gl:k}=b;k.bindTexture(k.TEXTURE_2D,this.texture),g!==k.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(g=k.LINEAR),l!==this.filter&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,l),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,g||l),this.filter=l),f!==this.wrap&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,f),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,f),this.wrap=f)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function ae(x){const{userImage:l}=x;return!!(l&&l.render&&l.render())&&(x.data.replace(new Uint8Array(l.data.buffer)),!0)}class Pe extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:f,promiseResolve:g}of this.requestors)g(this._getImagesForIds(f));this.requestors=[]}}getImage(l){const f=this.images[l];if(f&&!f.data&&f.spriteData){const g=f.spriteData;f.data=new a.R({width:g.width,height:g.height},g.context.getImageData(g.x,g.y,g.width,g.height).data),f.spriteData=null}return f}addImage(l,f){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,f)&&(this.images[l]=f)}_validate(l,f){let g=!0;const b=f.data||f.spriteData;return this._validateStretch(f.stretchX,b&&b.width)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "stretchX" value`))),g=!1),this._validateStretch(f.stretchY,b&&b.height)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "stretchY" value`))),g=!1),this._validateContent(f.content,f)||(this.fire(new a.j(new Error(`Image "${l}" has invalid "content" value`))),g=!1),g}_validateStretch(l,f){if(!l)return!0;let g=0;for(const b of l){if(b[0]<g||b[1]<b[0]||f<b[1])return!1;g=b[1]}return!0}_validateContent(l,f){if(!l)return!0;if(l.length!==4)return!1;const g=f.spriteData,b=g&&g.width||f.data.width,k=g&&g.height||f.data.height;return!(l[0]<0||b<l[0]||l[1]<0||k<l[1]||l[2]<0||b<l[2]||l[3]<0||k<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,f,g=!0){const b=this.getImage(l);if(g&&(b.data.width!==f.data.width||b.data.height!==f.data.height))throw new Error(`size mismatch between old image (${b.data.width}x${b.data.height}) and new image (${f.data.width}x${f.data.height}).`);f.version=b.version+1,this.images[l]=f,this.updatedImages[l]=!0}removeImage(l){const f=this.images[l];delete this.images[l],delete this.patterns[l],f.userImage&&f.userImage.onRemove&&f.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((f,g)=>{let b=!0;if(!this.isLoaded())for(const k of l)this.images[k]||(b=!1);this.isLoaded()||b?f(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:f})})}_getImagesForIds(l){const f={};for(const g of l){let b=this.getImage(g);b||(this.fire(new a.k("styleimagemissing",{id:g})),b=this.getImage(g)),b?f[g]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:a.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return f}getPixelSize(){const{width:l,height:f}=this.atlasImage;return{width:l,height:f}}getPattern(l){const f=this.patterns[l],g=this.getImage(l);if(!g)return null;if(f&&f.position.version===g.version)return f.position;if(f)f.position.version=g.version;else{const b={w:g.data.width+2,h:g.data.height+2,x:0,y:0},k=new a.I(b,g);this.patterns[l]={bin:b,position:k}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const f=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Q(l,this.atlasImage,f.RGBA),this.atlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const k in this.patterns)l.push(this.patterns[k].bin);const{w:f,h:g}=a.p(l),b=this.atlasImage;b.resize({width:f||1,height:g||1});for(const k in this.patterns){const{bin:E}=this.patterns[k],A=E.x+1,B=E.y+1,G=this.getImage(k).data,X=G.width,Y=G.height;a.R.copy(G,b,{x:0,y:0},{x:A,y:B},{width:X,height:Y}),a.R.copy(G,b,{x:0,y:Y-1},{x:A,y:B-1},{width:X,height:1}),a.R.copy(G,b,{x:0,y:0},{x:A,y:B+Y},{width:X,height:1}),a.R.copy(G,b,{x:X-1,y:0},{x:A-1,y:B},{width:1,height:Y}),a.R.copy(G,b,{x:0,y:0},{x:A+X,y:B},{width:1,height:Y})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const f of l){if(this.callbackDispatchedThisFrame[f])continue;this.callbackDispatchedThisFrame[f]=!0;const g=this.getImage(f);g||a.w(`Image with ID: "${f}" was not found`),ae(g)&&this.updateImage(f,g)}}}const ve=1e20;function nt(x,l,f,g,b,k,E,A,B){for(let G=l;G<l+g;G++)Ge(x,f*k+G,k,b,E,A,B);for(let G=f;G<f+b;G++)Ge(x,G*k+l,1,g,E,A,B)}function Ge(x,l,f,g,b,k,E){k[0]=0,E[0]=-ve,E[1]=ve,b[0]=x[l];for(let A=1,B=0,G=0;A<g;A++){b[A]=x[l+A*f];const X=A*A;do{const Y=k[B];G=(b[A]-b[Y]+X-Y*Y)/(A-Y)/2}while(G<=E[B]&&--B>-1);B++,k[B]=A,E[B]=G,E[B+1]=ve}for(let A=0,B=0;A<g;A++){for(;E[B+1]<A;)B++;const G=k[B],X=A-G;x[l+A*f]=b[G]+X*X}}class Ee{constructor(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return a._(this,void 0,void 0,function*(){const f=[];for(const k in l)for(const E of l[k])f.push(this._getAndCacheGlyphsPromise(k,E));const g=yield Promise.all(f),b={};for(const{stack:k,id:E,glyph:A}of g)b[k]||(b[k]={}),b[k][E]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};return b})}_getAndCacheGlyphsPromise(l,f){return a._(this,void 0,void 0,function*(){let g=this.entries[l];g||(g=this.entries[l]={glyphs:{},requests:{},ranges:{}});let b=g.glyphs[f];if(b!==void 0)return{stack:l,id:f,glyph:b};if(b=this._tinySDF(g,l,f),b)return g.glyphs[f]=b,{stack:l,id:f,glyph:b};const k=Math.floor(f/256);if(256*k>65535)throw new Error("glyphs > 65535 not supported");if(g.ranges[k])return{stack:l,id:f,glyph:b};if(!this.url)throw new Error("glyphsUrl is not set");if(!g.requests[k]){const A=Ee.loadGlyphRange(l,k,this.url,this.requestManager);g.requests[k]=A}const E=yield g.requests[k];for(const A in E)this._doesCharSupportLocalGlyph(+A)||(g.glyphs[+A]=E[+A]);return g.ranges[k]=!0,{stack:l,id:f,glyph:E[f]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](l)||a.u["Hangul Syllables"](l)||a.u.Hiragana(l)||a.u.Katakana(l))}_tinySDF(l,f,g){const b=this.localIdeographFontFamily;if(!b||!this._doesCharSupportLocalGlyph(g))return;let k=l.tinySDF;if(!k){let A="400";/bold/i.test(f)?A="900":/medium/i.test(f)?A="500":/light/i.test(f)&&(A="200"),k=l.tinySDF=new Ee.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:b,fontWeight:A})}const E=k.draw(String.fromCharCode(g));return{id:g,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ee.loadGlyphRange=function(x,l,f,g){return a._(this,void 0,void 0,function*(){const b=256*l,k=b+255,E=g.transformRequest(f.replace("{fontstack}",x).replace("{range}",`${b}-${k}`),"Glyphs"),A=yield a.l(E,new AbortController);if(!A||!A.data)throw new Error(`Could not load glyph range. range: ${l}, ${b}-${k}`);const B={};for(const G of a.n(A.data))B[G.id]=G;return B})},Ee.TinySDF=class{constructor({fontSize:x=24,buffer:l=3,radius:f=8,cutoff:g=.25,fontFamily:b="sans-serif",fontWeight:k="normal",fontStyle:E="normal"}={}){this.buffer=l,this.cutoff=g,this.radius=f;const A=this.size=x+4*l,B=this._createCanvas(A),G=this.ctx=B.getContext("2d",{willReadFrequently:!0});G.font=`${E} ${k} ${x}px ${b}`,G.textBaseline="alphabetic",G.textAlign="left",G.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Uint16Array(A)}_createCanvas(x){const l=document.createElement("canvas");return l.width=l.height=x,l}draw(x){const{width:l,actualBoundingBoxAscent:f,actualBoundingBoxDescent:g,actualBoundingBoxLeft:b,actualBoundingBoxRight:k}=this.ctx.measureText(x),E=Math.ceil(f),A=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(k-b))),B=Math.min(this.size-this.buffer,E+Math.ceil(g)),G=A+2*this.buffer,X=B+2*this.buffer,Y=Math.max(G*X,0),de=new Uint8ClampedArray(Y),Se={data:de,width:G,height:X,glyphWidth:A,glyphHeight:B,glyphTop:E,glyphLeft:0,glyphAdvance:l};if(A===0||B===0)return Se;const{ctx:ke,buffer:Me,gridInner:ye,gridOuter:Re}=this;ke.clearRect(Me,Me,A,B),ke.fillText(x,Me,Me+E);const Je=ke.getImageData(Me,Me,A,B);Re.fill(ve,0,Y),ye.fill(0,0,Y);for(let Le=0;Le<B;Le++)for(let je=0;je<A;je++){const Qe=Je.data[4*(Le*A+je)+3]/255;if(Qe===0)continue;const rt=(Le+Me)*G+je+Me;if(Qe===1)Re[rt]=0,ye[rt]=ve;else{const ot=.5-Qe;Re[rt]=ot>0?ot*ot:0,ye[rt]=ot<0?ot*ot:0}}nt(Re,0,0,G,X,G,this.f,this.v,this.z),nt(ye,Me,Me,A,B,G,this.f,this.v,this.z);for(let Le=0;Le<Y;Le++){const je=Math.sqrt(Re[Le])-Math.sqrt(ye[Le]);de[Le]=Math.round(255-255*(je/this.radius+this.cutoff))}return Se}};class De{constructor(){this.specification=a.v.light.position}possiblyEvaluate(l,f){return a.y(l.expression.evaluate(f))}interpolate(l,f,g){return{x:a.z.number(l.x,f.x,g),y:a.z.number(l.y,f.y,g),z:a.z.number(l.z,f.z,g)}}}let Ct;class it extends a.E{constructor(l){super(),Ct=Ct||new a.q({anchor:new a.D(a.v.light.anchor),position:new De,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Ct),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,f={}){if(!this._validate(a.r,l,f))for(const g in l){const b=l[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),b):this._transitionable.setValue(g,b)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,f,g){return(!g||g.validate!==!1)&&a.t(this,l.call(a.x,{value:f,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class lt{constructor(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,f){const g=l.join(",")+String(f);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(l,f)),this.dashEntry[g]}getDashRanges(l,f,g){const b=[];let k=l.length%2==1?-l[l.length-1]*g:0,E=l[0]*g,A=!0;b.push({left:k,right:E,isDash:A,zeroLength:l[0]===0});let B=l[0];for(let G=1;G<l.length;G++){A=!A;const X=l[G];k=B*g,B+=X,E=B*g,b.push({left:k,right:E,isDash:A,zeroLength:X===0})}return b}addRoundDash(l,f,g){const b=f/2;for(let k=-g;k<=g;k++){const E=this.width*(this.nextRow+g+k);let A=0,B=l[A];for(let G=0;G<this.width;G++){G/B.right>1&&(B=l[++A]);const X=Math.abs(G-B.left),Y=Math.abs(G-B.right),de=Math.min(X,Y);let Se;const ke=k/g*(b+1);if(B.isDash){const Me=b-Math.abs(ke);Se=Math.sqrt(de*de+Me*Me)}else Se=b-Math.sqrt(de*de+ke*ke);this.data[E+G]=Math.max(0,Math.min(255,Se+128))}}}addRegularDash(l){for(let A=l.length-1;A>=0;--A){const B=l[A],G=l[A+1];B.zeroLength?l.splice(A,1):G&&G.isDash===B.isDash&&(G.left=B.left,l.splice(A,1))}const f=l[0],g=l[l.length-1];f.isDash===g.isDash&&(f.left=g.left-this.width,g.right=f.right+this.width);const b=this.width*this.nextRow;let k=0,E=l[k];for(let A=0;A<this.width;A++){A/E.right>1&&(E=l[++k]);const B=Math.abs(A-E.left),G=Math.abs(A-E.right),X=Math.min(B,G);this.data[b+A]=Math.max(0,Math.min(255,(E.isDash?X:-X)+128))}}addDash(l,f){const g=f?7:0,b=2*g+1;if(this.nextRow+b>this.height)return a.w("LineAtlas out of space"),null;let k=0;for(let A=0;A<l.length;A++)k+=l[A];if(k!==0){const A=this.width/k,B=this.getDashRanges(l,this.width,A);f?this.addRoundDash(B,A,g):this.addRegularDash(B)}const E={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:k};return this.nextRow+=b,this.dirty=!0,E}bind(l){const f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))}}const mt="maplibre_preloaded_worker_pool";class dt{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<dt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(f=>{f.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mt]}numActive(){return Object.keys(this.active).length}}const Xe=Math.floor(y.hardwareConcurrency/2);let $t,yt;function Rt(){return $t||($t=new dt),$t}dt.workerCount=a.B(globalThis)?Math.max(Math.min(Xe,3),1):1;class It{constructor(l,f){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=f;const g=this.workerPool.acquire(f);for(let b=0;b<g.length;b++){const k=new a.C(g[b],f);k.name=`Worker ${b}`,this.actors.push(k)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,f){const g=[];for(const b of this.actors)g.push(b.sendAsync({type:l,data:f}));return Promise.all(g)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(f=>{f.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,f){for(const g of this.actors)g.registerMessageHandler(l,f)}}function Qt(){return yt||(yt=new It(Rt(),a.G),yt.registerMessageHandler("GR",(x,l,f)=>a.m(l,f))),yt}function yn(x,l){const f=a.F();return a.H(f,f,[1,1,0]),a.J(f,f,[.5*x.width,.5*x.height,1]),a.K(f,f,x.calculatePosMatrix(l.toUnwrapped()))}function ut(x,l,f,g,b,k){const E=function(Y,de,Se){if(Y)for(const ke of Y){const Me=de[ke];if(Me&&Me.source===Se&&Me.type==="fill-extrusion")return!0}else for(const ke in de){const Me=de[ke];if(Me.source===Se&&Me.type==="fill-extrusion")return!0}return!1}(b&&b.layers,l,x.id),A=k.maxPitchScaleFactor(),B=x.tilesIn(g,A,E);B.sort(Wt);const G=[];for(const Y of B)G.push({wrappedTileID:Y.tileID.wrapped().key,queryResults:Y.tile.queryRenderedFeatures(l,f,x._state,Y.queryGeometry,Y.cameraQueryGeometry,Y.scale,b,k,A,yn(x.transform,Y.tileID))});const X=function(Y){const de={},Se={};for(const ke of Y){const Me=ke.queryResults,ye=ke.wrappedTileID,Re=Se[ye]=Se[ye]||{};for(const Je in Me){const Le=Me[Je],je=Re[Je]=Re[Je]||{},Qe=de[Je]=de[Je]||[];for(const rt of Le)je[rt.featureIndex]||(je[rt.featureIndex]=!0,Qe.push(rt))}}return de}(G);for(const Y in X)X[Y].forEach(de=>{const Se=de.feature,ke=x.getFeatureState(Se.layer["source-layer"],Se.id);Se.source=Se.layer.source,Se.layer["source-layer"]&&(Se.sourceLayer=Se.layer["source-layer"]),Se.state=ke});return X}function Wt(x,l){const f=x.tileID,g=l.tileID;return f.overscaledZ-g.overscaledZ||f.canonical.y-g.canonical.y||f.wrap-g.wrap||f.canonical.x-g.canonical.x}function Ze(x,l,f){return a._(this,void 0,void 0,function*(){let g=x;if(x.url?g=(yield a.h(l.transformRequest(x.url,"Source"),f)).data:yield y.frameAsync(f),!g)return null;const b=a.L(a.e(g,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(b.vectorLayerIds=g.vector_layers.map(k=>k.id)),b})}class Ve{constructor(l,f){l&&(f?this.setSouthWest(l).setNorthEast(f):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof a.M?new a.M(l.lng,l.lat):a.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof a.M?new a.M(l.lng,l.lat):a.M.convert(l),this}extend(l){const f=this._sw,g=this._ne;let b,k;if(l instanceof a.M)b=l,k=l;else{if(!(l instanceof Ve))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(Ve.convert(l)):this.extend(a.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(a.M.convert(l)):this;if(b=l._sw,k=l._ne,!b||!k)return this}return f||g?(f.lng=Math.min(b.lng,f.lng),f.lat=Math.min(b.lat,f.lat),g.lng=Math.max(k.lng,g.lng),g.lat=Math.max(k.lat,g.lat)):(this._sw=new a.M(b.lng,b.lat),this._ne=new a.M(k.lng,k.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:f,lat:g}=a.M.convert(l);let b=this._sw.lng<=f&&f<=this._ne.lng;return this._sw.lng>this._ne.lng&&(b=this._sw.lng>=f&&f>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&b}static convert(l){return l instanceof Ve?l:l&&new Ve(l)}static fromLngLat(l,f=0){const g=360*f/40075017,b=g/Math.cos(Math.PI/180*l.lat);return new Ve(new a.M(l.lng-b,l.lat-g),new a.M(l.lng+b,l.lat+g))}}class St{constructor(l,f,g){this.bounds=Ve.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=g||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const f=Math.pow(2,l.z),g=Math.floor(a.N(this.bounds.getWest())*f),b=Math.floor(a.O(this.bounds.getNorth())*f),k=Math.ceil(a.N(this.bounds.getEast())*f),E=Math.ceil(a.O(this.bounds.getSouth())*f);return l.x>=g&&l.x<k&&l.y>=b&&l.y<E}}class Ut extends a.E{constructor(l,f,g,b){if(super(),this.id=l,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(f,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},f),this._collectResourceTiming=f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield Ze(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(a.e(this,l),l.bounds&&(this.tileBounds=new St(l.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new a.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(f,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};g.request.collectResourceTiming=this._collectResourceTiming;let b="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((k,E)=>{l.reloadPromise={resolve:k,reject:E}})}else l.actor=this.dispatcher.getActor(),b="LT";l.abortController=new AbortController;try{const k=yield l.actor.sendAsync({type:b,data:g},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,k)}catch(k){if(delete l.abortController,l.aborted)return;if(k&&k.status!==404)throw k;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,f){if(f&&f.resourceTiming&&(l.resourceTiming=f.resourceTiming),f&&this.map._refreshExpiredTiles&&l.setExpiryData(f),l.loadVectorData(f,this.map.painter),l.reloadPromise){const g=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(g.resolve).catch(g.reject)}}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class _e extends a.E{constructor(l,f,g,b){super(),this.id=l,this.dispatcher=g,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},f),a.e(this,a.L(f,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield Ze(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(a.e(this,l),l.bounds&&(this.tileBounds=new St(l.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new a.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return a.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const g=yield F.getImage(this.map._requestManager.transformRequest(f,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(g&&g.data){this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&l.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const b=this.map.painter.context,k=b.gl,E=g.data;l.texture=this.map.painter.getTileTexture(E.width),l.texture?l.texture.update(E,{useMipmap:!0}):(l.texture=new Q(b,E,k.RGBA,{useMipmap:!0}),l.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),b.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,b.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(g){if(delete l.abortController,l.aborted)l.state="unloaded";else if(g)throw l.state="errored",g}})}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class Pn extends _e{constructor(l,f,g,b){super(l,f,g,b),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},f),this.encoding=f.encoding||"mapbox",this.redFactor=f.redFactor,this.greenFactor=f.greenFactor,this.blueFactor=f.blueFactor,this.baseShift=f.baseShift}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(f,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const b=yield F.getImage(g,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(b&&b.data){const k=b.data;this.map._refreshExpiredTiles&&b.cacheControl&&b.expires&&l.setExpiryData({cacheControl:b.cacheControl,expires:b.expires});const E=a.b(k)&&a.S()?k:yield this.readImageNow(k),A={type:this.type,uid:l.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const B=yield l.actor.sendAsync({type:"LDT",data:A});l.dem=B,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(b){if(delete l.abortController,l.aborted)l.state="unloaded";else if(b)throw l.state="errored",b}})}readImageNow(l){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const f=l.width+2,g=l.height+2;try{return new a.R({width:f,height:g},yield a.V(l,-1,-1,f,g))}catch{}}return y.getImageData(l,1)})}_getNeighboringTiles(l){const f=l.canonical,g=Math.pow(2,f.z),b=(f.x-1+g)%g,k=f.x===0?l.wrap-1:l.wrap,E=(f.x+1+g)%g,A=f.x+1===g?l.wrap+1:l.wrap,B={};return B[new a.Q(l.overscaledZ,k,f.z,b,f.y).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,E,f.y).key]={backfilled:!1},f.y>0&&(B[new a.Q(l.overscaledZ,k,f.z,b,f.y-1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,l.wrap,f.z,f.x,f.y-1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,E,f.y-1).key]={backfilled:!1}),f.y+1<g&&(B[new a.Q(l.overscaledZ,k,f.z,b,f.y+1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,l.wrap,f.z,f.x,f.y+1).key]={backfilled:!1},B[new a.Q(l.overscaledZ,A,f.z,E,f.y+1).key]={backfilled:!1}),B}unloadTile(l){return a._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Ne extends a.E{constructor(l,f,g,b){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=g.getActor(),this.setEventedParent(b),this._data=f.data,this._options=a.e({},f),this._collectResourceTiming=f.collectResourceTiming,f.maxzoom!==void 0&&(this.maxzoom=f.maxzoom),f.type&&(this.type=f.type),f.attribution&&(this.attribution=f.attribution),this.promoteId=f.promoteId;const k=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:f.cluster||!1,geojsonVtOptions:{buffer:(f.buffer!==void 0?f.buffer:128)*k,tolerance:(f.tolerance!==void 0?f.tolerance:.375)*k,extent:a.W,maxZoom:this.maxzoom,lineMetrics:f.lineMetrics||!1,generateId:f.generateId||!1},superclusterOptions:{maxZoom:f.clusterMaxZoom!==void 0?f.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,f.clusterMinPoints||2),extent:a.W,radius:(f.clusterRadius||50)*k,log:!1,generateId:f.generateId||!1},clusterProperties:f.clusterProperties,filter:f.filter},f.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,f,g){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:f,offset:g}})}_updateWorkerData(l){return a._(this,void 0,void 0,function*(){const f=a.e({type:this.type},this.workerOptions);l?f.dataDiff=l:typeof this._data=="string"?(f.request=this.map._requestManager.transformRequest(y.resolveURL(this._data),"Source"),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const g=yield this.actor.sendAsync({type:"LD",data:f});if(this._pendingLoads--,this._removed||g.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let b=null;g.resourceTiming&&g.resourceTiming[this.id]&&(b=g.resourceTiming[this.id].slice(0));const k={dataType:"source"};this._collectResourceTiming&&b&&b.length>0&&a.e(k,{resourceTiming:b}),this.fire(new a.k("data",Object.assign(Object.assign({},k),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},k),{sourceDataType:"content"})))}catch(g){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(g))}})}loaded(){return this._pendingLoads===0}loadTile(l){return a._(this,void 0,void 0,function*(){const f=l.actor?"RT":"LT";l.actor=this.actor;const g={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const b=yield this.actor.sendAsync({type:f,data:g},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(b,this.map.painter,f==="RT")})}abortTile(l){return a._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return a._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var et=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Kt extends a.E{constructor(l,f,g,b){super(),this.id=l,this.dispatcher=g,this.coordinates=f.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=f}load(l){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const f=yield F.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,f&&f.data&&(this.image=f.data,l&&(this.coordinates=l),this._finishLoading())}catch(f){this._request=null,this._loaded=!0,this.fire(new a.j(f))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const f=l.map(a.Y.fromLngLat);this.tileID=function(b){let k=1/0,E=1/0,A=-1/0,B=-1/0;for(const de of b)k=Math.min(k,de.x),E=Math.min(E,de.y),A=Math.max(A,de.x),B=Math.max(B,de.y);const G=Math.max(A-k,B-E),X=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),Y=Math.pow(2,X);return new a.a0(X,Math.floor((k+A)/2*Y),Math.floor((E+B)/2*Y))}(f),this.minzoom=this.maxzoom=this.tileID.z;const g=f.map(b=>this.tileID.getTilePoint(b)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(g[0].x,g[0].y,0,0),this._boundsArray.emplaceBack(g[1].x,g[1].y,a.W,0),this._boundsArray.emplaceBack(g[3].x,g[3].y,0,a.W),this._boundsArray.emplaceBack(g[2].x,g[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,et.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Q(l,this.image,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let g=!1;for(const b in this.tiles){const k=this.tiles[b];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,g=!0)}g&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class er extends Kt{constructor(l,f,g,b){super(l,f,g,b),this.roundZoom=!0,this.type="video",this.options=f}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const f of l.urls)this.urls.push(this.map._requestManager.transformRequest(f,"Source").url);try{const f=yield a.a2(this.urls);if(this._loaded=!0,!f)return;this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(f){this.fire(new a.j(f))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const f=this.video.seekable;l<f.start(0)||l>f.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${f.start(0)} and ${f.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,f=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,et.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE),f.texSubImage2D(f.TEXTURE_2D,0,0,0,f.RGBA,f.UNSIGNED_BYTE,this.video)):(this.texture=new Q(l,this.video,f.RGBA),this.texture.bind(f.LINEAR,f.CLAMP_TO_EDGE));let g=!1;for(const b in this.tiles){const k=this.tiles[b];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,g=!0)}g&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ur extends Kt{constructor(l,f,g,b){super(l,f,g,b),f.coordinates?Array.isArray(f.coordinates)&&f.coordinates.length===4&&!f.coordinates.some(k=>!Array.isArray(k)||k.length!==2||k.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${l}`,null,'missing required property "coordinates"'))),f.animate&&typeof f.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),f.canvas?typeof f.canvas=="string"||f.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=f,this.animate=f.animate===void 0||f.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const f=this.map.painter.context,g=f.gl;this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,et.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Q(f,this.canvas,g.RGBA,{premultiply:!0});let b=!1;for(const k in this.tiles){const E=this.tiles[k];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,b=!0)}b&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const gr={},Qr=x=>{switch(x){case"geojson":return Ne;case"image":return Kt;case"raster":return _e;case"raster-dem":return Pn;case"vector":return Ut;case"video":return er;case"canvas":return ur}return gr[x]},ei="RTLPluginLoaded";class co extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Qt()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(f=>{throw this.status="error",f})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return a._(this,arguments,void 0,function*(f,g=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=y.resolveURL(f),!this.url)throw new Error(`requested url ${f} is invalid`);if(this.status==="unavailable"){if(!g)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(ei))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let hr=null;function bt(){return hr||(hr=new co),hr}class Bn{constructor(l,f){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=a.a3(),this.uses=0,this.tileSize=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const f=l+this.timeAdded;f<this.fadeEndTime||(this.fadeEndTime=f)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,f,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(b,k){const E={};if(!k)return E;for(const A of b){const B=A.layerIds.map(G=>k.getLayer(G)).filter(Boolean);if(B.length!==0){A.layers=B,A.stateDependentLayerIds&&(A.stateDependentLayers=A.stateDependentLayerIds.map(G=>B.filter(X=>X.id===G)[0]));for(const G of B)E[G.id]=A}}return E}(l.buckets,f.style),this.hasSymbolBuckets=!1;for(const b in this.buckets){const k=this.buckets[b];if(k instanceof a.a5){if(this.hasSymbolBuckets=!0,!g)break;k.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const b in this.buckets){const k=this.buckets[b];if(k instanceof a.a5&&k.hasRTLText){this.hasRTLText=!0,bt().lazyLoad();break}}this.queryPadding=0;for(const b in this.buckets){const k=this.buckets[b];this.queryPadding=Math.max(this.queryPadding,f.style.getLayer(b).queryRadius(k))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const g in this.buckets){const b=this.buckets[g];b.uploadPending()&&b.upload(l)}const f=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Q(l,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Q(l,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,f,g,b,k,E,A,B,G,X){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:b,cameraQueryGeometry:k,scale:E,tileSize:this.tileSize,pixelPosMatrix:X,transform:B,params:A,queryPadding:this.queryPadding*G},l,f,g):{}}querySourceFeatures(l,f){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const b=g.loadVTLayers(),k=f&&f.sourceLayer?f.sourceLayer:"",E=b._geojsonTileLayer||b[k];if(!E)return;const A=a.a6(f&&f.filter),{z:B,x:G,y:X}=this.tileID.canonical,Y={z:B,x:G,y:X};for(let de=0;de<E.length;de++){const Se=E.feature(de);if(A.needGeometry){const ye=a.a7(Se,!0);if(!A.filter(new a.a8(this.tileID.overscaledZ),ye,this.tileID.canonical))continue}else if(!A.filter(new a.a8(this.tileID.overscaledZ),Se))continue;const ke=g.getId(Se,k),Me=new a.a9(Se,B,G,X,ke);Me.tile=Y,l.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const f=this.expirationTime;if(l.cacheControl){const g=a.aa(l.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const g=Date.now();let b=!1;if(this.expirationTime>g)b=!1;else if(f)if(this.expirationTime<f)b=!0;else{const k=this.expirationTime-f;k?this.expirationTime=g+Math.max(k,3e4):b=!0}else b=!0;b?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,f){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const g=this.latestFeatureIndex.loadVTLayers();for(const b in this.buckets){if(!f.style.hasLayer(b))continue;const k=this.buckets[b],E=k.layers[0].sourceLayer||"_geojsonTileLayer",A=g[E],B=l[E];if(!A||!B||Object.keys(B).length===0)continue;k.update(B,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});const G=f&&f.style&&f.style.getLayer(b);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<y.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=y.now()+l}setDependencies(l,f){const g={};for(const b of f)g[b]=!0;this.dependencies[l]=g}hasDependency(l,f){for(const g of l){const b=this.dependencies[g];if(b){for(const k of f)if(b[k])return!0}}return!1}}class xr{constructor(l,f){this.max=l,this.onRemove=f,this.reset()}reset(){for(const l in this.data)for(const f of this.data[l])f.timeout&&clearTimeout(f.timeout),this.onRemove(f.value);return this.data={},this.order=[],this}add(l,f,g){const b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);const k={value:f,timeout:void 0};if(g!==void 0&&(k.timeout=setTimeout(()=>{this.remove(l,k)},g)),this.data[b].push(k),this.order.push(b),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value}getByKey(l){const f=this.data[l];return f?f[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,f){if(!this.has(l))return this;const g=l.wrapped().key,b=f===void 0?0:this.data[g].indexOf(f),k=this.data[g][b];return this.data[g].splice(b,1),k.timeout&&clearTimeout(k.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(k.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this}filter(l){const f=[];for(const g in this.data)for(const b of this.data[g])l(b.value)||f.push(b);for(const g of f)this.remove(g.value.tileID,g)}}class uo{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,f,g){const b=String(f);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][b]=this.stateChanges[l][b]||{},a.e(this.stateChanges[l][b],g),this.deletedStates[l]===null){this.deletedStates[l]={};for(const k in this.state[l])k!==b&&(this.deletedStates[l][k]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][b]===null){this.deletedStates[l][b]={};for(const k in this.state[l][b])g[k]||(this.deletedStates[l][b][k]=null)}else for(const k in g)this.deletedStates[l]&&this.deletedStates[l][b]&&this.deletedStates[l][b][k]===null&&delete this.deletedStates[l][b][k]}removeFeatureState(l,f,g){if(this.deletedStates[l]===null)return;const b=String(f);if(this.deletedStates[l]=this.deletedStates[l]||{},g&&f!==void 0)this.deletedStates[l][b]!==null&&(this.deletedStates[l][b]=this.deletedStates[l][b]||{},this.deletedStates[l][b][g]=null);else if(f!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][b])for(g in this.deletedStates[l][b]={},this.stateChanges[l][b])this.deletedStates[l][b][g]=null;else this.deletedStates[l][b]=null;else this.deletedStates[l]=null}getState(l,f){const g=String(f),b=a.e({},(this.state[l]||{})[g],(this.stateChanges[l]||{})[g]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const k=this.deletedStates[l][f];if(k===null)return{};for(const E in k)delete b[E]}return b}initializeTileState(l,f){l.setFeatureState(this.state,f)}coalesceChanges(l,f){const g={};for(const b in this.stateChanges){this.state[b]=this.state[b]||{};const k={};for(const E in this.stateChanges[b])this.state[b][E]||(this.state[b][E]={}),a.e(this.state[b][E],this.stateChanges[b][E]),k[E]=this.state[b][E];g[b]=k}for(const b in this.deletedStates){this.state[b]=this.state[b]||{};const k={};if(this.deletedStates[b]===null)for(const E in this.state[b])k[E]={},this.state[b][E]={};else for(const E in this.deletedStates[b]){if(this.deletedStates[b][E]===null)this.state[b][E]={};else for(const A of Object.keys(this.deletedStates[b][E]))delete this.state[b][E][A];k[E]=this.state[b][E]}g[b]=g[b]||{},a.e(g[b],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const b in l)l[b].setFeatureState(g,f)}}class Rn extends a.E{constructor(l,f,g){super(),this.id=l,this.dispatcher=g,this.on("data",b=>this._dataHandler(b)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((b,k,E,A)=>{const B=new(Qr(k.type))(b,k,E,A);if(B.id!==b)throw new Error(`Expected Source id to be ${b} instead of ${B.id}`);return B})(l,f,g,this),this._tiles={},this._cache=new xr(0,b=>this._unloadTile(b)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new uo,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const f=this._tiles[l];if(f.state!=="loaded"&&f.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,f,g){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,f,g)}catch(b){l.state="errored",b.status!==404?this._source.fire(new a.j(b,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new a.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const f in this._tiles){const g=this._tiles[f];g.upload(l),g.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Pt).map(l=>l.key)}getRenderableIds(l){const f=[];for(const g in this._tiles)this._isIdRenderable(g,l)&&f.push(this._tiles[g]);return l?f.sort((g,b)=>{const k=g.tileID,E=b.tileID,A=new a.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),B=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-E.overscaledZ||B.y-A.y||B.x-A.x}).map(g=>g.tileID.key):f.map(g=>g.tileID).sort(Pt).map(g=>g.key)}hasRenderableParent(l){const f=this.findLoadedParent(l,0);return!!f&&this._isIdRenderable(f.tileID.key)}_isIdRenderable(l,f){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(f||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,f){return a._(this,void 0,void 0,function*(){const g=this._tiles[l];g&&(g.state!=="loading"&&(g.state=f),yield this._loadTile(g,l,f))})}_tileLoaded(l,f,g){l.timeAdded=y.now(),g==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(f,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const f=this.getRenderableIds();for(let b=0;b<f.length;b++){const k=f[b];if(l.neighboringTiles&&l.neighboringTiles[k]){const E=this.getTileByID(k);g(l,E),g(E,l)}}function g(b,k){b.needsHillshadePrepare=!0,b.needsTerrainPrepare=!0;let E=k.tileID.canonical.x-b.tileID.canonical.x;const A=k.tileID.canonical.y-b.tileID.canonical.y,B=Math.pow(2,b.tileID.canonical.z),G=k.tileID.key;E===0&&A===0||Math.abs(A)>1||(Math.abs(E)>1&&(Math.abs(E+B)===1?E+=B:Math.abs(E-B)===1&&(E-=B)),k.dem&&b.dem&&(b.dem.backfillBorder(k.dem,E,A),b.neighboringTiles&&b.neighboringTiles[G]&&(b.neighboringTiles[G].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,f,g,b){for(const k in this._tiles){let E=this._tiles[k];if(b[k]||!E.hasData()||E.tileID.overscaledZ<=f||E.tileID.overscaledZ>g)continue;let A=E.tileID;for(;E&&E.tileID.overscaledZ>f+1;){const G=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[G.key],E&&E.hasData()&&(A=G)}let B=A;for(;B.overscaledZ>f;)if(B=B.scaledTo(B.overscaledZ-1),l[B.key]){b[A.key]=A;break}}}findLoadedParent(l,f){if(l.key in this._loadedParentTiles){const g=this._loadedParentTiles[l.key];return g&&g.tileID.overscaledZ>=f?g:null}for(let g=l.overscaledZ-1;g>=f;g--){const b=l.scaledTo(g),k=this._getLoadedTile(b);if(k)return k}}_getLoadedTile(l){const f=this._tiles[l.key];return f&&f.hasData()?f:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const f=Math.ceil(l.width/this._source.tileSize)+1,g=Math.ceil(l.height/this._source.tileSize)+1,b=Math.floor(f*g*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(k)}handleWrapJump(l){const f=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,f){const g={};for(const b in this._tiles){const k=this._tiles[b];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+f),g[k.tileID.key]=k}this._tiles=g;for(const b in this._timers)clearTimeout(this._timers[b]),delete this._timers[b];for(const b in this._tiles)this._setTileReloadTimer(b,this._tiles[b])}}update(l,f){if(!this._sourceLoaded||this._paused)return;let g;this.transform=l,this.terrain=f,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(X=>new a.Q(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y)):(g=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:f}),this._source.hasTile&&(g=g.filter(X=>this._source.hasTile(X)))):g=[];const b=l.coveringZoomLevel(this._source),k=Math.max(b-Rn.maxOverzooming,this._source.minzoom),E=Math.max(b+Rn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const X={};for(const Y of g)if(Y.canonical.z>this._source.minzoom){const de=Y.scaledTo(Y.canonical.z-1);X[de.key]=de;const Se=Y.scaledTo(Math.max(this._source.minzoom,Math.min(Y.canonical.z,5)));X[Se.key]=Se}g=g.concat(Object.values(X))}const A=g.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,A&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(g,b);if(fn(this._source.type)){const X={},Y={},de=Object.keys(B),Se=y.now();for(const ke of de){const Me=B[ke],ye=this._tiles[ke];if(!ye||ye.fadeEndTime!==0&&ye.fadeEndTime<=Se)continue;const Re=this.findLoadedParent(Me,k);Re&&(this._addTile(Re.tileID),X[Re.tileID.key]=Re.tileID),Y[ke]=Me}this._retainLoadedChildren(Y,b,E,B);for(const ke in X)B[ke]||(this._coveredTiles[ke]=!0,B[ke]=X[ke]);if(f){const ke={},Me={};for(const ye of g)this._tiles[ye.key].hasData()?ke[ye.key]=ye:Me[ye.key]=ye;for(const ye in Me){const Re=Me[ye].children(this._source.maxzoom);this._tiles[Re[0].key]&&this._tiles[Re[1].key]&&this._tiles[Re[2].key]&&this._tiles[Re[3].key]&&(ke[Re[0].key]=B[Re[0].key]=Re[0],ke[Re[1].key]=B[Re[1].key]=Re[1],ke[Re[2].key]=B[Re[2].key]=Re[2],ke[Re[3].key]=B[Re[3].key]=Re[3],delete Me[ye])}for(const ye in Me){const Re=this.findLoadedParent(Me[ye],this._source.minzoom);if(Re){ke[Re.tileID.key]=B[Re.tileID.key]=Re.tileID;for(const Je in ke)ke[Je].isChildOf(Re.tileID)&&delete ke[Je]}}for(const ye in this._tiles)ke[ye]||(this._coveredTiles[ye]=!0)}}for(const X in B)this._tiles[X].clearFadeHold();const G=a.ab(this._tiles,B);for(const X of G){const Y=this._tiles[X];Y.hasSymbolBuckets&&!Y.holdingForFade()?Y.setHoldDuration(this.map._fadeDuration):Y.hasSymbolBuckets&&!Y.symbolFadeFinished()||this._removeTile(X)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,f){const g={},b={},k=Math.max(f-Rn.maxOverzooming,this._source.minzoom),E=Math.max(f+Rn.maxUnderzooming,this._source.minzoom),A={};for(const B of l){const G=this._addTile(B);g[B.key]=B,G.hasData()||f<this._source.maxzoom&&(A[B.key]=B)}this._retainLoadedChildren(A,f,E,g);for(const B of l){let G=this._tiles[B.key];if(G.hasData())continue;if(f+1>this._source.maxzoom){const Y=B.children(this._source.maxzoom)[0],de=this.getTile(Y);if(de&&de.hasData()){g[Y.key]=Y;continue}}else{const Y=B.children(this._source.maxzoom);if(g[Y[0].key]&&g[Y[1].key]&&g[Y[2].key]&&g[Y[3].key])continue}let X=G.wasRequested();for(let Y=B.overscaledZ-1;Y>=k;--Y){const de=B.scaledTo(Y);if(b[de.key])break;if(b[de.key]=!0,G=this.getTile(de),!G&&X&&(G=this._addTile(de)),G){const Se=G.hasData();if((X||Se)&&(g[de.key]=de),X=G.wasRequested(),Se)break}}}return g}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const f=[];let g,b=this._tiles[l].tileID;for(;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){g=this._loadedParentTiles[b.key];break}f.push(b.key);const k=b.scaledTo(b.overscaledZ-1);if(g=this._getLoadedTile(k),g)break;b=k}for(const k of f)this._loadedParentTiles[k]=g}}_addTile(l){let f=this._tiles[l.key];if(f)return f;f=this._cache.getAndRemove(l),f&&(this._setTileReloadTimer(l.key,f),f.tileID=l,this._state.initializeTileState(f,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,f)));const g=f;return f||(f=new Bn(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(f,l.key,f.state)),f.uses++,this._tiles[l.key]=f,g||this._source.fire(new a.k("dataloading",{tile:f,coord:f.tileID,dataType:"source"})),f}_setTileReloadTimer(l,f){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const g=f.getExpiryTimeout();g&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},g))}_removeTile(l){const f=this._tiles[l];f&&(f.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),f.uses>0||(f.hasData()&&f.state!=="reloading"?this._cache.add(f.tileID,f,f.getExpiryTimeout()):(f.aborted=!0,this._abortTile(f),this._unloadTile(f))))}_dataHandler(l){const f=l.sourceDataType;l.dataType==="source"&&f==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&f==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,f,g){const b=[],k=this.transform;if(!k)return b;const E=g?k.getCameraQueryGeometry(l):l,A=l.map(ke=>k.pointCoordinate(ke,this.terrain)),B=E.map(ke=>k.pointCoordinate(ke,this.terrain)),G=this.getIds();let X=1/0,Y=1/0,de=-1/0,Se=-1/0;for(const ke of B)X=Math.min(X,ke.x),Y=Math.min(Y,ke.y),de=Math.max(de,ke.x),Se=Math.max(Se,ke.y);for(let ke=0;ke<G.length;ke++){const Me=this._tiles[G[ke]];if(Me.holdingForFade())continue;const ye=Me.tileID,Re=Math.pow(2,k.zoom-Me.tileID.overscaledZ),Je=f*Me.queryPadding*a.W/Me.tileSize/Re,Le=[ye.getTilePoint(new a.Y(X,Y)),ye.getTilePoint(new a.Y(de,Se))];if(Le[0].x-Je<a.W&&Le[0].y-Je<a.W&&Le[1].x+Je>=0&&Le[1].y+Je>=0){const je=A.map(rt=>ye.getTilePoint(rt)),Qe=B.map(rt=>ye.getTilePoint(rt));b.push({tile:Me,tileID:ye,queryGeometry:je,cameraQueryGeometry:Qe,scale:Re})}}return b}getVisibleCoordinates(l){const f=this.getRenderableIds(l).map(g=>this._tiles[g].tileID);for(const g of f)g.posMatrix=this.transform.calculatePosMatrix(g.toUnwrapped());return f}hasTransition(){if(this._source.hasTransition())return!0;if(fn(this._source.type)){const l=y.now();for(const f in this._tiles)if(this._tiles[f].fadeEndTime>=l)return!0}return!1}setFeatureState(l,f,g){this._state.updateState(l=l||"_geojsonTileLayer",f,g)}removeFeatureState(l,f,g){this._state.removeFeatureState(l=l||"_geojsonTileLayer",f,g)}getFeatureState(l,f){return this._state.getState(l=l||"_geojsonTileLayer",f)}setDependencies(l,f,g){const b=this._tiles[l];b&&b.setDependencies(f,g)}reloadTilesForDependencies(l,f){for(const g in this._tiles)this._tiles[g].hasDependency(l,f)&&this._reloadTile(g,"reloading");this._cache.filter(g=>!g.hasDependency(l,f))}}function Pt(x,l){const f=Math.abs(2*x.wrap)-+(x.wrap<0),g=Math.abs(2*l.wrap)-+(l.wrap<0);return x.overscaledZ-l.overscaledZ||g-f||l.canonical.y-x.canonical.y||l.canonical.x-x.canonical.x}function fn(x){return x==="raster"||x==="image"||x==="video"}Rn.maxOverzooming=10,Rn.maxUnderzooming=3;class mn{constructor(l,f){this.reset(l,f)}reset(l,f){this.points=l||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=a.ac(l,0,1);let f=1,g=this._distances[f];const b=l*this.paddedLength+this.padding;for(;g<b&&f<this._distances.length;)g=this._distances[++f];const k=f-1,E=this._distances[k],A=g-E,B=A>0?(b-E)/A:0;return this.points[k].mult(1-B).add(this.points[f].mult(B))}}function wn(x,l){let f=!0;return x==="always"||x!=="never"&&l!=="never"||(f=!1),f}class ln{constructor(l,f,g){const b=this.boxCells=[],k=this.circleCells=[];this.xCellCount=Math.ceil(l/g),this.yCellCount=Math.ceil(f/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)b.push([]),k.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,f,g,b,k){this._forEachCell(f,g,b,k,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(k)}insertCircle(l,f,g,b){this._forEachCell(f-b,g-b,f+b,g+b,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(g),this.circles.push(b)}_insertBoxCell(l,f,g,b,k,E){this.boxCells[k].push(E)}_insertCircleCell(l,f,g,b,k,E){this.circleCells[k].push(E)}_query(l,f,g,b,k,E,A){if(g<0||l>this.width||b<0||f>this.height)return[];const B=[];if(l<=0&&f<=0&&this.width<=g&&this.height<=b){if(k)return[{key:null,x1:l,y1:f,x2:g,y2:b}];for(let G=0;G<this.boxKeys.length;G++)B.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const X=this.circles[3*G],Y=this.circles[3*G+1],de=this.circles[3*G+2];B.push({key:this.circleKeys[G],x1:X-de,y1:Y-de,x2:X+de,y2:Y+de})}}else this._forEachCell(l,f,g,b,this._queryCell,B,{hitTest:k,overlapMode:E,seenUids:{box:{},circle:{}}},A);return B}query(l,f,g,b){return this._query(l,f,g,b,!1,null)}hitTest(l,f,g,b,k,E){return this._query(l,f,g,b,!0,k,E).length>0}hitTestCircle(l,f,g,b,k){const E=l-g,A=l+g,B=f-g,G=f+g;if(A<0||E>this.width||G<0||B>this.height)return!1;const X=[];return this._forEachCell(E,B,A,G,this._queryCellCircle,X,{hitTest:!0,overlapMode:b,circle:{x:l,y:f,radius:g},seenUids:{box:{},circle:{}}},k),X.length>0}_queryCell(l,f,g,b,k,E,A,B){const{seenUids:G,hitTest:X,overlapMode:Y}=A,de=this.boxCells[k];if(de!==null){const ke=this.bboxes;for(const Me of de)if(!G.box[Me]){G.box[Me]=!0;const ye=4*Me,Re=this.boxKeys[Me];if(l<=ke[ye+2]&&f<=ke[ye+3]&&g>=ke[ye+0]&&b>=ke[ye+1]&&(!B||B(Re))&&(!X||!wn(Y,Re.overlapMode))&&(E.push({key:Re,x1:ke[ye],y1:ke[ye+1],x2:ke[ye+2],y2:ke[ye+3]}),X))return!0}}const Se=this.circleCells[k];if(Se!==null){const ke=this.circles;for(const Me of Se)if(!G.circle[Me]){G.circle[Me]=!0;const ye=3*Me,Re=this.circleKeys[Me];if(this._circleAndRectCollide(ke[ye],ke[ye+1],ke[ye+2],l,f,g,b)&&(!B||B(Re))&&(!X||!wn(Y,Re.overlapMode))){const Je=ke[ye],Le=ke[ye+1],je=ke[ye+2];if(E.push({key:Re,x1:Je-je,y1:Le-je,x2:Je+je,y2:Le+je}),X)return!0}}}return!1}_queryCellCircle(l,f,g,b,k,E,A,B){const{circle:G,seenUids:X,overlapMode:Y}=A,de=this.boxCells[k];if(de!==null){const ke=this.bboxes;for(const Me of de)if(!X.box[Me]){X.box[Me]=!0;const ye=4*Me,Re=this.boxKeys[Me];if(this._circleAndRectCollide(G.x,G.y,G.radius,ke[ye+0],ke[ye+1],ke[ye+2],ke[ye+3])&&(!B||B(Re))&&!wn(Y,Re.overlapMode))return E.push(!0),!0}}const Se=this.circleCells[k];if(Se!==null){const ke=this.circles;for(const Me of Se)if(!X.circle[Me]){X.circle[Me]=!0;const ye=3*Me,Re=this.circleKeys[Me];if(this._circlesCollide(ke[ye],ke[ye+1],ke[ye+2],G.x,G.y,G.radius)&&(!B||B(Re))&&!wn(Y,Re.overlapMode))return E.push(!0),!0}}}_forEachCell(l,f,g,b,k,E,A,B){const G=this._convertToXCellCoord(l),X=this._convertToYCellCoord(f),Y=this._convertToXCellCoord(g),de=this._convertToYCellCoord(b);for(let Se=G;Se<=Y;Se++)for(let ke=X;ke<=de;ke++)if(k.call(this,l,f,g,b,this.xCellCount*ke+Se,E,A,B))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,f,g,b,k,E){const A=b-l,B=k-f,G=g+E;return G*G>A*A+B*B}_circleAndRectCollide(l,f,g,b,k,E,A){const B=(E-b)/2,G=Math.abs(l-(b+B));if(G>B+g)return!1;const X=(A-k)/2,Y=Math.abs(f-(k+X));if(Y>X+g)return!1;if(G<=B||Y<=X)return!0;const de=G-B,Se=Y-X;return de*de+Se*Se<=g*g}}function Gt(x,l,f,g,b){const k=a.F();return l?(a.J(k,k,[1/b,1/b,1]),f||a.ad(k,k,g.angle)):a.K(k,g.labelPlaneMatrix,x),k}function Ci(x,l,f,g,b){if(l){const k=a.ae(x);return a.J(k,k,[b,b,1]),f||a.ad(k,k,-g.angle),k}return g.glCoordMatrix}function _r(x,l,f){let g;f?(g=[x.x,x.y,f(x.x,x.y),1],a.af(g,g,l)):(g=[x.x,x.y,0,1],ct(g,g,l));const b=g[3];return{point:new a.P(g[0]/b,g[1]/b),signedDistanceFromCamera:b}}function Ce(x,l){return .5+x/l*.5}function ne(x,l){const f=x[0]/x[3],g=x[1]/x[3];return f>=-l[0]&&f<=l[0]&&g>=-l[1]&&g<=l[1]}function se(x,l,f,g,b,k,E,A,B,G){const X=g?x.textSizeData:x.iconSizeData,Y=a.ag(X,f.transform.zoom),de=[256/f.width*2+1,256/f.height*2+1],Se=g?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;Se.clear();const ke=x.lineVertexArray,Me=g?x.text.placedSymbolArray:x.icon.placedSymbolArray,ye=f.transform.width/f.transform.height;let Re=!1;for(let Je=0;Je<Me.length;Je++){const Le=Me.get(Je);if(Le.hidden||Le.writingMode===a.ah.vertical&&!Re){Ye(Le.numGlyphs,Se);continue}let je;if(Re=!1,G?(je=[Le.anchorX,Le.anchorY,G(Le.anchorX,Le.anchorY),1],a.af(je,je,l)):(je=[Le.anchorX,Le.anchorY,0,1],ct(je,je,l)),!ne(je,de)){Ye(Le.numGlyphs,Se);continue}const Qe=Ce(f.transform.cameraToCenterDistance,je[3]),rt=a.ai(X,Y,Le),ot=E?rt/Qe:rt*Qe,_t=new a.P(Le.anchorX,Le.anchorY),pt=_r(_t,b,G).point,At={projections:{},offsets:{}},Dt=Fe(Le,ot,!1,A,l,b,k,x.glyphOffsetArray,ke,Se,pt,_t,At,ye,B,G);Re=Dt.useVertical,(Dt.notEnoughRoom||Re||Dt.needsFlipping&&Fe(Le,ot,!0,A,l,b,k,x.glyphOffsetArray,ke,Se,pt,_t,At,ye,B,G).notEnoughRoom)&&Ye(Le.numGlyphs,Se)}g?x.text.dynamicLayoutVertexBuffer.updateData(Se):x.icon.dynamicLayoutVertexBuffer.updateData(Se)}function ge(x,l,f,g,b,k,E,A,B,G,X,Y,de){const Se=A.glyphStartIndex+A.numGlyphs,ke=A.lineStartIndex,Me=A.lineStartIndex+A.lineLength,ye=l.getoffsetX(A.glyphStartIndex),Re=l.getoffsetX(Se-1),Je=He(x*ye,f,g,b,k,E,A.segment,ke,Me,B,G,X,Y,de);if(!Je)return null;const Le=He(x*Re,f,g,b,k,E,A.segment,ke,Me,B,G,X,Y,de);return Le?{first:Je,last:Le}:null}function we(x,l,f,g){return x===a.ah.horizontal&&Math.abs(f.y-l.y)>Math.abs(f.x-l.x)*g?{useVertical:!0}:(x===a.ah.vertical?l.y<f.y:l.x>f.x)?{needsFlipping:!0}:null}function Fe(x,l,f,g,b,k,E,A,B,G,X,Y,de,Se,ke,Me){const ye=l/24,Re=x.lineOffsetX*ye,Je=x.lineOffsetY*ye;let Le;if(x.numGlyphs>1){const je=x.glyphStartIndex+x.numGlyphs,Qe=x.lineStartIndex,rt=x.lineStartIndex+x.lineLength,ot=ge(ye,A,Re,Je,f,X,Y,x,B,k,de,ke,Me);if(!ot)return{notEnoughRoom:!0};const _t=_r(ot.first.point,E,Me).point,pt=_r(ot.last.point,E,Me).point;if(g&&!f){const At=we(x.writingMode,_t,pt,Se);if(At)return At}Le=[ot.first];for(let At=x.glyphStartIndex+1;At<je-1;At++)Le.push(He(ye*A.getoffsetX(At),Re,Je,f,X,Y,x.segment,Qe,rt,B,k,de,ke,Me));Le.push(ot.last)}else{if(g&&!f){const Qe=_r(Y,b,Me).point,rt=x.lineStartIndex+x.segment+1,ot=new a.P(B.getx(rt),B.gety(rt)),_t=_r(ot,b,Me),pt=_t.signedDistanceFromCamera>0?_t.point:Be(Y,ot,Qe,1,b,Me),At=we(x.writingMode,Qe,pt,Se);if(At)return At}const je=He(ye*A.getoffsetX(x.glyphStartIndex),Re,Je,f,X,Y,x.segment,x.lineStartIndex,x.lineStartIndex+x.lineLength,B,k,de,ke,Me);if(!je)return{notEnoughRoom:!0};Le=[je]}for(const je of Le)a.aj(G,je.point,je.angle);return{}}function Be(x,l,f,g,b,k){const E=_r(x.add(x.sub(l)._unit()),b,k).point,A=f.sub(E);return f.add(A._mult(g/A.mag()))}function Ue(x,l){const{projectionCache:f,lineVertexArray:g,labelPlaneMatrix:b,tileAnchorPoint:k,distanceFromAnchor:E,getElevation:A,previousVertex:B,direction:G,absOffsetX:X}=l;if(f.projections[x])return f.projections[x];const Y=new a.P(g.getx(x),g.gety(x)),de=_r(Y,b,A);if(de.signedDistanceFromCamera>0)return f.projections[x]=de.point,de.point;const Se=x-G;return Be(E===0?k:new a.P(g.getx(Se),g.gety(Se)),Y,B,X-E+1,b,A)}function ze(x,l,f){return x._unit()._perp()._mult(l*f)}function te(x,l,f,g,b,k,E,A){const{projectionCache:B,direction:G}=A;if(B.offsets[x])return B.offsets[x];const X=f.add(l);if(x+G<g||x+G>=b)return B.offsets[x]=X,X;const Y=Ue(x+G,A),de=ze(Y.sub(f),E,G),Se=f.add(de),ke=Y.add(de);return B.offsets[x]=a.ak(k,X,Se,ke)||X,B.offsets[x]}function He(x,l,f,g,b,k,E,A,B,G,X,Y,de,Se){const ke=g?x-l:x+l;let Me=ke>0?1:-1,ye=0;g&&(Me*=-1,ye=Math.PI),Me<0&&(ye+=Math.PI);let Re,Je,Le=Me>0?A+E:A+E+1,je=b,Qe=b,rt=0,ot=0;const _t=Math.abs(ke),pt=[];let At;for(;rt+ot<=_t;){if(Le+=Me,Le<A||Le>=B)return null;rt+=ot,Qe=je,Je=Re;const Ft={projectionCache:Y,lineVertexArray:G,labelPlaneMatrix:X,tileAnchorPoint:k,distanceFromAnchor:rt,getElevation:Se,previousVertex:Qe,direction:Me,absOffsetX:_t};if(je=Ue(Le,Ft),f===0)pt.push(Qe),At=je.sub(Qe);else{let pn;const vn=je.sub(Qe);pn=vn.mag()===0?ze(Ue(Le+Me,Ft).sub(je),f,Me):ze(vn,f,Me),Je||(Je=Qe.add(pn)),Re=te(Le,pn,je,A,B,Je,f,Ft),pt.push(Je),At=Re.sub(Je)}ot=At.mag()}const Dt=At._mult((_t-rt)/ot)._add(Je||Qe),bn=ye+Math.atan2(je.y-Qe.y,je.x-Qe.x);return pt.push(Dt),{point:Dt,angle:de?bn:0,path:pt}}const Ke=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ye(x,l){for(let f=0;f<x;f++){const g=l.length;l.resize(g+4),l.float32.set(Ke,3*g)}}function ct(x,l,f){const g=l[0],b=l[1];return x[0]=f[0]*g+f[4]*b+f[12],x[1]=f[1]*g+f[5]*b+f[13],x[3]=f[3]*g+f[7]*b+f[15],x}const Tt=100;class Jt{constructor(l,f=new ln(l.width+200,l.height+200,25),g=new ln(l.width+200,l.height+200,25)){this.transform=l,this.grid=f,this.ignoredGrid=g,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Tt,this.screenBottomBoundary=l.height+Tt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,f,g,b,k,E){const A=this.projectAndGetPerspectiveRatio(b,l.anchorPointX,l.anchorPointY,E),B=g*A.perspectiveRatio,G=l.x1*B+A.point.x,X=l.y1*B+A.point.y,Y=l.x2*B+A.point.x,de=l.y2*B+A.point.y;return!this.isInsideGrid(G,X,Y,de)||f!=="always"&&this.grid.hitTest(G,X,Y,de,f,k)||A.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[G,X,Y,de],offscreen:this.isOffscreen(G,X,Y,de)}}placeCollisionCircles(l,f,g,b,k,E,A,B,G,X,Y,de,Se,ke){const Me=[],ye=new a.P(f.anchorX,f.anchorY),Re=_r(ye,E,ke),Je=Ce(this.transform.cameraToCenterDistance,Re.signedDistanceFromCamera),Le=(X?k/Je:k*Je)/a.ao,je=_r(ye,A,ke).point,Qe=ge(Le,b,f.lineOffsetX*Le,f.lineOffsetY*Le,!1,je,ye,f,g,A,{projections:{},offsets:{}},!1,ke);let rt=!1,ot=!1,_t=!0;if(Qe){const pt=.5*de*Je+Se,At=new a.P(-100,-100),Dt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),bn=new mn,Ft=Qe.first,pn=Qe.last;let vn=[];for(let Sn=Ft.path.length-1;Sn>=1;Sn--)vn.push(Ft.path[Sn]);for(let Sn=1;Sn<pn.path.length;Sn++)vn.push(pn.path[Sn]);const Zn=2.5*pt;if(B){const Sn=vn.map(zn=>_r(zn,B,ke));vn=Sn.some(zn=>zn.signedDistanceFromCamera<=0)?[]:Sn.map(zn=>zn.point)}let _n=[];if(vn.length>0){const Sn=vn[0].clone(),zn=vn[0].clone();for(let $r=1;$r<vn.length;$r++)Sn.x=Math.min(Sn.x,vn[$r].x),Sn.y=Math.min(Sn.y,vn[$r].y),zn.x=Math.max(zn.x,vn[$r].x),zn.y=Math.max(zn.y,vn[$r].y);_n=Sn.x>=At.x&&zn.x<=Dt.x&&Sn.y>=At.y&&zn.y<=Dt.y?[vn]:zn.x<At.x||Sn.x>Dt.x||zn.y<At.y||Sn.y>Dt.y?[]:a.al([vn],At.x,At.y,Dt.x,Dt.y)}for(const Sn of _n){bn.reset(Sn,.25*pt);let zn=0;zn=bn.length<=.5*pt?1:Math.ceil(bn.paddedLength/Zn)+1;for(let $r=0;$r<zn;$r++){const sr=$r/Math.max(zn-1,1),Yi=bn.lerp(sr),ni=Yi.x+Tt,Lr=Yi.y+Tt;Me.push(ni,Lr,pt,0);const ri=ni-pt,Qi=Lr-pt,Zo=ni+pt,xs=Lr+pt;if(_t=_t&&this.isOffscreen(ri,Qi,Zo,xs),ot=ot||this.isInsideGrid(ri,Qi,Zo,xs),l!=="always"&&this.grid.hitTestCircle(ni,Lr,pt,l,Y)&&(rt=!0,!G))return{circles:[],offscreen:!1,collisionDetected:rt}}}}return{circles:!G&&rt||!ot||Je<this.perspectiveRatioCutoff?[]:Me,offscreen:_t,collisionDetected:rt}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let g=1/0,b=1/0,k=-1/0,E=-1/0;for(const X of l){const Y=new a.P(X.x+Tt,X.y+Tt);g=Math.min(g,Y.x),b=Math.min(b,Y.y),k=Math.max(k,Y.x),E=Math.max(E,Y.y),f.push(Y)}const A=this.grid.query(g,b,k,E).concat(this.ignoredGrid.query(g,b,k,E)),B={},G={};for(const X of A){const Y=X.key;if(B[Y.bucketInstanceId]===void 0&&(B[Y.bucketInstanceId]={}),B[Y.bucketInstanceId][Y.featureIndex])continue;const de=[new a.P(X.x1,X.y1),new a.P(X.x2,X.y1),new a.P(X.x2,X.y2),new a.P(X.x1,X.y2)];a.am(f,de)&&(B[Y.bucketInstanceId][Y.featureIndex]=!0,G[Y.bucketInstanceId]===void 0&&(G[Y.bucketInstanceId]=[]),G[Y.bucketInstanceId].push(Y.featureIndex))}return G}insertCollisionBox(l,f,g,b,k,E){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:k,collisionGroupID:E,overlapMode:f},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,f,g,b,k,E){const A=g?this.ignoredGrid:this.grid,B={bucketInstanceId:b,featureIndex:k,collisionGroupID:E,overlapMode:f};for(let G=0;G<l.length;G+=4)A.insertCircle(B,l[G],l[G+1],l[G+2])}projectAndGetPerspectiveRatio(l,f,g,b){let k;return b?(k=[f,g,b(f,g),1],a.af(k,k,l)):(k=[f,g,0,1],ct(k,k,l)),{point:new a.P((k[0]/k[3]+1)/2*this.transform.width+Tt,(-k[1]/k[3]+1)/2*this.transform.height+Tt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k[3]*.5}}isOffscreen(l,f,g,b){return g<Tt||l>=this.screenRightBoundary||b<Tt||f>this.screenBottomBoundary}isInsideGrid(l,f,g,b){return g>=0&&l<this.gridRightBoundary&&b>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const l=a.an([]);return a.H(l,l,[-100,-100,0]),l}}function dn(x,l,f){return l*(a.W/(x.tileSize*Math.pow(2,f-x.tileID.overscaledZ)))}class xn{constructor(l,f,g,b){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):b&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class jn{constructor(l,f,g,b,k){this.text=new xn(l?l.text:null,f,g,k),this.icon=new xn(l?l.icon:null,f,b,k)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kr{constructor(l,f,g){this.text=l,this.icon=f,this.skipFade=g}}class qr{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class kn{constructor(l,f,g,b,k){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=g,this.bucketIndex=b,this.tileID=k}}class Pr{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:g=>g.collisionGroupID===f}}return this.collisionGroups[l]}}function ti(x,l,f,g,b){const{horizontalAlign:k,verticalAlign:E}=a.at(x);return new a.P(-(k-.5)*l+g[0]*b,-(E-.5)*f+g[1]*b)}function Ti(x,l,f,g,b,k){const{x1:E,x2:A,y1:B,y2:G,anchorPointX:X,anchorPointY:Y}=x,de=new a.P(l,f);return g&&de._rotate(b?k:-k),{x1:E+de.x,y1:B+de.y,x2:A+de.x,y2:G+de.y,anchorPointX:X,anchorPointY:Y}}class Di{constructor(l,f,g,b,k){this.transform=l.clone(),this.terrain=f,this.collisionIndex=new Jt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Pr(b),this.collisionCircleArrays={},this.prevPlacement=k,k&&(k.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,f,g,b){const k=g.getBucket(f),E=g.latestFeatureIndex;if(!k||!E||f.id!==k.layerIds[0])return;const A=g.collisionBoxArray,B=k.layers[0].layout,G=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),X=g.tileSize/a.W,Y=this.transform.calculatePosMatrix(g.tileID.toUnwrapped()),de=B.get("text-pitch-alignment")==="map",Se=B.get("text-rotation-alignment")==="map",ke=dn(g,1,this.transform.zoom),Me=Gt(Y,de,Se,this.transform,ke);let ye=null;if(de){const Je=Ci(Y,de,Se,this.transform,ke);ye=a.K([],this.transform.labelPlaneMatrix,Je)}this.retainedQueryData[k.bucketInstanceId]=new kn(k.bucketInstanceId,E,k.sourceLayerIndex,k.index,g.tileID);const Re={bucket:k,layout:B,posMatrix:Y,textLabelPlaneMatrix:Me,labelToScreenMatrix:ye,scale:G,textPixelRatio:X,holdingForFade:g.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:a.ag(k.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(k.sourceID)};if(b)for(const Je of k.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:je,symbolInstanceEnd:Qe}=Je;l.push({sortKey:Le,symbolInstanceStart:je,symbolInstanceEnd:Qe,parameters:Re})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:Re})}attemptAnchorPlacement(l,f,g,b,k,E,A,B,G,X,Y,de,Se,ke,Me,ye){const Re=a.ap[l.textAnchor],Je=[l.textOffset0,l.textOffset1],Le=ti(Re,g,b,Je,k),je=this.collisionIndex.placeCollisionBox(Ti(f,Le.x,Le.y,E,A,this.transform.angle),Y,B,G,X.predicate,ye);if((!Me||this.collisionIndex.placeCollisionBox(Ti(Me,Le.x,Le.y,E,A,this.transform.angle),Y,B,G,X.predicate,ye).box.length!==0)&&je.box.length>0){let Qe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[de.crossTileID]&&this.prevPlacement.placements[de.crossTileID]&&this.prevPlacement.placements[de.crossTileID].text&&(Qe=this.prevPlacement.variableOffsets[de.crossTileID].anchor),de.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[de.crossTileID]={textOffset:Je,width:g,height:b,anchor:Re,textBoxScale:k,prevAnchor:Qe},this.markUsedJustification(Se,Re,de,ke),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,ke,de),this.placedOrientations[de.crossTileID]=ke),{shift:Le,placedGlyphBoxes:je}}}placeLayerBucketPart(l,f,g){const{bucket:b,layout:k,posMatrix:E,textLabelPlaneMatrix:A,labelToScreenMatrix:B,textPixelRatio:G,holdingForFade:X,collisionBoxArray:Y,partiallyEvaluatedTextSize:de,collisionGroup:Se}=l.parameters,ke=k.get("text-optional"),Me=k.get("icon-optional"),ye=a.aq(k,"text-overlap","text-allow-overlap"),Re=ye==="always",Je=a.aq(k,"icon-overlap","icon-allow-overlap"),Le=Je==="always",je=k.get("text-rotation-alignment")==="map",Qe=k.get("text-pitch-alignment")==="map",rt=k.get("icon-text-fit")!=="none",ot=k.get("symbol-z-order")==="viewport-y",_t=Re&&(Le||!b.hasIconData()||Me),pt=Le&&(Re||!b.hasTextData()||ke);!b.collisionArrays&&Y&&b.deserializeCollisionBoxes(Y);const At=this.retainedQueryData[b.bucketInstanceId].tileID,Dt=this.terrain?(Ft,pn)=>this.terrain.getElevation(At,Ft,pn):null,bn=(Ft,pn)=>{var vn,Zn;if(f[Ft.crossTileID])return;if(X)return void(this.placements[Ft.crossTileID]=new kr(!1,!1,!1));let _n=!1,Sn=!1,zn=!0,$r=null,sr={box:null,offscreen:null},Yi={box:null,offscreen:null},ni=null,Lr=null,ri=null,Qi=0,Zo=0,xs=0;pn.textFeatureIndex?Qi=pn.textFeatureIndex:Ft.useRuntimeCollisionCircles&&(Qi=Ft.featureIndex),pn.verticalTextFeatureIndex&&(Zo=pn.verticalTextFeatureIndex);const ll=pn.textBox;if(ll){const Gr=Hr=>{let Ir=a.ah.horizontal;if(b.allowVerticalPlacement&&!Hr&&this.prevPlacement){const mo=this.prevPlacement.placedOrientations[Ft.crossTileID];mo&&(this.placedOrientations[Ft.crossTileID]=mo,Ir=mo,this.markUsedOrientation(b,Ir,Ft))}return Ir},Er=(Hr,Ir)=>{if(b.allowVerticalPlacement&&Ft.numVerticalGlyphVertices>0&&pn.verticalTextBox){for(const mo of b.writingModes)if(mo===a.ah.vertical?(sr=Ir(),Yi=sr):sr=Hr(),sr&&sr.box&&sr.box.length)break}else sr=Hr()},Cr=Ft.textAnchorOffsetStartIndex,po=Ft.textAnchorOffsetEndIndex;if(po===Cr){const Hr=(Ir,mo)=>{const Wr=this.collisionIndex.placeCollisionBox(Ir,ye,G,E,Se.predicate,Dt);return Wr&&Wr.box&&Wr.box.length&&(this.markUsedOrientation(b,mo,Ft),this.placedOrientations[Ft.crossTileID]=mo),Wr};Er(()=>Hr(ll,a.ah.horizontal),()=>{const Ir=pn.verticalTextBox;return b.allowVerticalPlacement&&Ft.numVerticalGlyphVertices>0&&Ir?Hr(Ir,a.ah.vertical):{box:null,offscreen:null}}),Gr(sr&&sr.box&&sr.box.length)}else{let Hr=a.ap[(Zn=(vn=this.prevPlacement)===null||vn===void 0?void 0:vn.variableOffsets[Ft.crossTileID])===null||Zn===void 0?void 0:Zn.anchor];const Ir=(Wr,Or,yu)=>{const yf=Wr.x2-Wr.x1,Fs=Wr.y2-Wr.y1,Bs=Ft.textBoxScale,lc=rt&&Je==="never"?Or:null;let Ss={box:[],offscreen:!1},bu=ye==="never"?1:2,bf="never";Hr&&bu++;for(let vu=0;vu<bu;vu++){for(let wu=Cr;wu<po;wu++){const cc=b.textAnchorOffsets.get(wu);if(Hr&&cc.textAnchor!==Hr)continue;const xu=this.attemptAnchorPlacement(cc,Wr,yf,Fs,Bs,je,Qe,G,E,Se,bf,Ft,b,yu,lc,Dt);if(xu&&(Ss=xu.placedGlyphBoxes,Ss&&Ss.box&&Ss.box.length))return _n=!0,$r=xu.shift,Ss}Hr?Hr=null:bf=ye}return Ss};Er(()=>Ir(ll,pn.iconBox,a.ah.horizontal),()=>{const Wr=pn.verticalTextBox;return b.allowVerticalPlacement&&!(sr&&sr.box&&sr.box.length)&&Ft.numVerticalGlyphVertices>0&&Wr?Ir(Wr,pn.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),sr&&(_n=sr.box,zn=sr.offscreen);const mo=Gr(sr&&sr.box);if(!_n&&this.prevPlacement){const Wr=this.prevPlacement.variableOffsets[Ft.crossTileID];Wr&&(this.variableOffsets[Ft.crossTileID]=Wr,this.markUsedJustification(b,Wr.anchor,Ft,mo))}}}if(ni=sr,_n=ni&&ni.box&&ni.box.length>0,zn=ni&&ni.offscreen,Ft.useRuntimeCollisionCircles){const Gr=b.text.placedSymbolArray.get(Ft.centerJustifiedTextSymbolIndex),Er=a.ai(b.textSizeData,de,Gr),Cr=k.get("text-padding");Lr=this.collisionIndex.placeCollisionCircles(ye,Gr,b.lineVertexArray,b.glyphOffsetArray,Er,E,A,B,g,Qe,Se.predicate,Ft.collisionCircleDiameter,Cr,Dt),Lr.circles.length&&Lr.collisionDetected&&!g&&a.w("Collisions detected, but collision boxes are not shown"),_n=Re||Lr.circles.length>0&&!Lr.collisionDetected,zn=zn&&Lr.offscreen}if(pn.iconFeatureIndex&&(xs=pn.iconFeatureIndex),pn.iconBox){const Gr=Er=>{const Cr=rt&&$r?Ti(Er,$r.x,$r.y,je,Qe,this.transform.angle):Er;return this.collisionIndex.placeCollisionBox(Cr,Je,G,E,Se.predicate,Dt)};Yi&&Yi.box&&Yi.box.length&&pn.verticalIconBox?(ri=Gr(pn.verticalIconBox),Sn=ri.box.length>0):(ri=Gr(pn.iconBox),Sn=ri.box.length>0),zn=zn&&ri.offscreen}const ks=ke||Ft.numHorizontalGlyphVertices===0&&Ft.numVerticalGlyphVertices===0,Go=Me||Ft.numIconVertices===0;if(ks||Go?Go?ks||(Sn=Sn&&_n):_n=Sn&&_n:Sn=_n=Sn&&_n,_n&&ni&&ni.box&&this.collisionIndex.insertCollisionBox(ni.box,ye,k.get("text-ignore-placement"),b.bucketInstanceId,Yi&&Yi.box&&Zo?Zo:Qi,Se.ID),Sn&&ri&&this.collisionIndex.insertCollisionBox(ri.box,Je,k.get("icon-ignore-placement"),b.bucketInstanceId,xs,Se.ID),Lr&&(_n&&this.collisionIndex.insertCollisionCircles(Lr.circles,ye,k.get("text-ignore-placement"),b.bucketInstanceId,Qi,Se.ID),g)){const Gr=b.bucketInstanceId;let Er=this.collisionCircleArrays[Gr];Er===void 0&&(Er=this.collisionCircleArrays[Gr]=new qr);for(let Cr=0;Cr<Lr.circles.length;Cr+=4)Er.circles.push(Lr.circles[Cr+0]),Er.circles.push(Lr.circles[Cr+1]),Er.circles.push(Lr.circles[Cr+2]),Er.circles.push(Lr.collisionDetected?1:0)}if(Ft.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(b.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ft.crossTileID]=new kr(_n||_t,Sn||pt,zn||b.justReloaded),f[Ft.crossTileID]=!0};if(ot){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ft=b.getSortedSymbolIndexes(this.transform.angle);for(let pn=Ft.length-1;pn>=0;--pn){const vn=Ft[pn];bn(b.symbolInstances.get(vn),b.collisionArrays[vn])}}else for(let Ft=l.symbolInstanceStart;Ft<l.symbolInstanceEnd;Ft++)bn(b.symbolInstances.get(Ft),b.collisionArrays[Ft]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const Ft=this.collisionCircleArrays[b.bucketInstanceId];a.ar(Ft.invProjMatrix,E),Ft.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(l,f,g,b){let k;k=b===a.ah.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[a.as(f)];const E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const A of E)A>=0&&(l.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:g.crossTileID)}markUsedOrientation(l,f,g){const b=f===a.ah.horizontal||f===a.ah.horizontalOnly?f:0,k=f===a.ah.vertical?f:0,E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const A of E)l.text.placedSymbolArray.get(A).placedOrientation=b;g.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=k)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let g=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const b=f?f.symbolFadeChange(l):1,k=f?f.opacities:{},E=f?f.variableOffsets:{},A=f?f.placedOrientations:{};for(const B in this.placements){const G=this.placements[B],X=k[B];X?(this.opacities[B]=new jn(X,b,G.text,G.icon),g=g||G.text!==X.text.placed||G.icon!==X.icon.placed):(this.opacities[B]=new jn(null,b,G.text,G.icon,G.skipFade),g=g||G.text||G.icon)}for(const B in k){const G=k[B];if(!this.opacities[B]){const X=new jn(G,b,!1,!1);X.isHidden()||(this.opacities[B]=X,g=g||G.text.placed||G.icon.placed)}}for(const B in E)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=E[B]);for(const B in A)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=A[B]);if(f&&f.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");g?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)}updateLayerOpacities(l,f){const g={};for(const b of f){const k=b.getBucket(l);k&&b.latestFeatureIndex&&l.id===k.layerIds[0]&&this.updateBucketOpacities(k,g,b.collisionBoxArray)}}updateBucketOpacities(l,f,g){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const b=l.layers[0],k=b.layout,E=new jn(null,0,!1,!1,!0),A=k.get("text-allow-overlap"),B=k.get("icon-allow-overlap"),G=b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"),X=k.get("text-rotation-alignment")==="map",Y=k.get("text-pitch-alignment")==="map",de=k.get("icon-text-fit")!=="none",Se=new jn(null,0,A&&(B||!l.hasIconData()||k.get("icon-optional")),B&&(A||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&g&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(g);const ke=(Me,ye,Re)=>{for(let Je=0;Je<ye/4;Je++)Me.opacityVertexArray.emplaceBack(Re);Me.hasVisibleVertices=Me.hasVisibleVertices||Re!==Na};for(let Me=0;Me<l.symbolInstances.length;Me++){const ye=l.symbolInstances.get(Me),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:Je,crossTileID:Le}=ye;let je=this.opacities[Le];f[Le]?je=E:je||(je=Se,this.opacities[Le]=je),f[Le]=!0;const Qe=ye.numIconVertices>0,rt=this.placedOrientations[ye.crossTileID],ot=rt===a.ah.vertical,_t=rt===a.ah.horizontal||rt===a.ah.horizontalOnly;if(Re>0||Je>0){const pt=$i(je.text);ke(l.text,Re,ot?Na:pt),ke(l.text,Je,_t?Na:pt);const At=je.text.isHidden();[ye.rightJustifiedTextSymbolIndex,ye.centerJustifiedTextSymbolIndex,ye.leftJustifiedTextSymbolIndex].forEach(Ft=>{Ft>=0&&(l.text.placedSymbolArray.get(Ft).hidden=At||ot?1:0)}),ye.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(ye.verticalPlacedTextSymbolIndex).hidden=At||_t?1:0);const Dt=this.variableOffsets[ye.crossTileID];Dt&&this.markUsedJustification(l,Dt.anchor,ye,rt);const bn=this.placedOrientations[ye.crossTileID];bn&&(this.markUsedJustification(l,"left",ye,bn),this.markUsedOrientation(l,bn,ye))}if(Qe){const pt=$i(je.icon),At=!(de&&ye.verticalPlacedIconSymbolIndex&&ot);ye.placedIconSymbolIndex>=0&&(ke(l.icon,ye.numIconVertices,At?pt:Na),l.icon.placedSymbolArray.get(ye.placedIconSymbolIndex).hidden=je.icon.isHidden()),ye.verticalPlacedIconSymbolIndex>=0&&(ke(l.icon,ye.numVerticalIconVertices,At?Na:pt),l.icon.placedSymbolArray.get(ye.verticalPlacedIconSymbolIndex).hidden=je.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const pt=l.collisionArrays[Me];if(pt){let At=new a.P(0,0);if(pt.textBox||pt.verticalTextBox){let bn=!0;if(G){const Ft=this.variableOffsets[Le];Ft?(At=ti(Ft.anchor,Ft.width,Ft.height,Ft.textOffset,Ft.textBoxScale),X&&At._rotate(Y?this.transform.angle:-this.transform.angle)):bn=!1}pt.textBox&&fi(l.textCollisionBox.collisionVertexArray,je.text.placed,!bn||ot,At.x,At.y),pt.verticalTextBox&&fi(l.textCollisionBox.collisionVertexArray,je.text.placed,!bn||_t,At.x,At.y)}const Dt=!!(!_t&&pt.verticalIconBox);pt.iconBox&&fi(l.iconCollisionBox.collisionVertexArray,je.icon.placed,Dt,de?At.x:0,de?At.y:0),pt.verticalIconBox&&fi(l.iconCollisionBox.collisionVertexArray,je.icon.placed,!Dt,de?At.x:0,de?At.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Me.invProjMatrix,l.placementViewportMatrix=Me.viewportMatrix,l.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,f){const g=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*g>l}setStale(){this.stale=!0}}function fi(x,l,f,g,b){x.emplaceBack(l?1:0,f?1:0,g||0,b||0),x.emplaceBack(l?1:0,f?1:0,g||0,b||0),x.emplaceBack(l?1:0,f?1:0,g||0,b||0),x.emplaceBack(l?1:0,f?1:0,g||0,b||0)}const No=Math.pow(2,25),Dh=Math.pow(2,24),zd=Math.pow(2,17),ir=Math.pow(2,16),Nc=Math.pow(2,9),jc=Math.pow(2,8),Ki=Math.pow(2,1);function $i(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const l=x.placed?1:0,f=Math.floor(127*x.opacity);return f*No+l*Dh+f*zd+l*ir+f*Nc+l*jc+f*Ki+l}const Na=0;class ho{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,f,g,b,k){const E=this._bucketParts;for(;this._currentTileIndex<l.length;)if(f.getBucketParts(E,b,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,k())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((A,B)=>A.sortKey-B.sortKey));this._currentPartIndex<E.length;)if(f.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,k())return!0;return!1}}class fo{constructor(l,f,g,b,k,E,A,B){this.placement=new Di(l,f,E,A,B),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=k,this._done=!1}isDone(){return this._done}continuePlacement(l,f,g){const b=y.now(),k=()=>!this._forceFullPlacement&&y.now()-b>2;for(;this._currentPlacementIndex>=0;){const E=f[l[this._currentPlacementIndex]],A=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=A)&&(!E.maxzoom||E.maxzoom>A)){if(this._inProgressLayer||(this._inProgressLayer=new ho(E)),this._inProgressLayer.continuePlacement(g[E.source],this.placement,this._showCollisionBoxes,E,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const ra=512/a.W/2;class kl{constructor(l,f,g){this.tileID=l,this.bucketInstanceId=g,this._symbolsByKey={};const b=new Map;for(let k=0;k<f.length;k++){const E=f.get(k),A=E.key,B=b.get(A);B?B.push(E):b.set(A,[E])}for(const[k,E]of b){const A={positions:E.map(B=>({x:Math.floor(B.anchorX*ra),y:Math.floor(B.anchorY*ra)})),crossTileIDs:E.map(B=>B.crossTileID)};if(A.positions.length>128){const B=new a.au(A.positions.length,16,Uint16Array);for(const{x:G,y:X}of A.positions)B.add(G,X);B.finish(),delete A.positions,A.index=B}this._symbolsByKey[k]=A}}getScaledCoordinates(l,f){const{x:g,y:b,z:k}=this.tileID.canonical,{x:E,y:A,z:B}=f.canonical,G=ra/Math.pow(2,B-k),X=(A*a.W+l.anchorY)*G,Y=b*a.W*ra;return{x:Math.floor((E*a.W+l.anchorX)*G-g*a.W*ra),y:Math.floor(X-Y)}}findMatches(l,f,g){const b=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z);for(let k=0;k<l.length;k++){const E=l.get(k);if(E.crossTileID)continue;const A=this._symbolsByKey[E.key];if(!A)continue;const B=this.getScaledCoordinates(E,f);if(A.index){const G=A.index.range(B.x-b,B.y-b,B.x+b,B.y+b).sort();for(const X of G){const Y=A.crossTileIDs[X];if(!g[Y]){g[Y]=!0,E.crossTileID=Y;break}}}else if(A.positions)for(let G=0;G<A.positions.length;G++){const X=A.positions[G],Y=A.crossTileIDs[G];if(Math.abs(X.x-B.x)<=b&&Math.abs(X.y-B.y)<=b&&!g[Y]){g[Y]=!0,E.crossTileID=Y;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class Zr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ja{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const f=Math.round((l-this.lng)/360);if(f!==0)for(const g in this.indexes){const b=this.indexes[g],k={};for(const E in b){const A=b[E];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+f),k[A.tileID.key]=A}this.indexes[g]=k}this.lng=l}addBucket(l,f,g){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let k=0;k<f.symbolInstances.length;k++)f.symbolInstances.get(k).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const b=this.usedCrossTileIDs[l.overscaledZ];for(const k in this.indexes){const E=this.indexes[k];if(Number(k)>l.overscaledZ)for(const A in E){const B=E[A];B.tileID.isChildOf(l)&&B.findMatches(f.symbolInstances,l,b)}else{const A=E[l.scaledTo(Number(k)).key];A&&A.findMatches(f.symbolInstances,l,b)}}for(let k=0;k<f.symbolInstances.length;k++){const E=f.symbolInstances.get(k);E.crossTileID||(E.crossTileID=g.generate(),b[E.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new kl(l,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(l,f){for(const g of f.getCrossTileIDsLists())for(const b of g)delete this.usedCrossTileIDs[l][b]}removeStaleBuckets(l){let f=!1;for(const g in this.indexes){const b=this.indexes[g];for(const k in b)l[b[k].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,b[k]),delete b[k],f=!0)}return f}}class gs{constructor(){this.layerIndexes={},this.crossTileIDs=new Zr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,f,g){let b=this.layerIndexes[l.id];b===void 0&&(b=this.layerIndexes[l.id]=new ja);let k=!1;const E={};b.handleWrapJump(g);for(const A of f){const B=A.getBucket(l);B&&l.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(A.tileID,B,this.crossTileIDs)&&(k=!0),E[B.bucketInstanceId]=!0)}return b.removeStaleBuckets(E)&&(k=!0),k}pruneUnusedLayers(l){const f={};l.forEach(g=>{f[g]=!0});for(const g in this.layerIndexes)f[g]||delete this.layerIndexes[g]}}const Mr=(x,l)=>a.t(x,l&&l.filter(f=>f.identifier!=="source.canvas")),Sl=a.av();class Xi extends a.E{constructor(l,f={}){super(),this._rtlPluginLoaded=()=>{for(const g in this.sourceCaches){const b=this.sourceCaches[g].getSource().type;b!=="vector"&&b!=="geojson"||this.sourceCaches[g].reload()}},this.map=l,this.dispatcher=new It(Rt(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(g,b)=>this.getGlyphs(g,b)),this.dispatcher.registerMessageHandler("GI",(g,b)=>this.getImages(g,b)),this.imageManager=new Pe,this.imageManager.setEventedParent(this),this.glyphManager=new Ee(l._requestManager,f.localIdeographFontFamily),this.lineAtlas=new lt(256,512),this.crossTileSymbolIndex=new gs,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),bt().on(ei,this._rtlPluginLoaded),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const b=this.sourceCaches[g.sourceId];if(!b)return;const k=b.getSource();if(k&&k.vectorLayerIds)for(const E in this._layers){const A=this._layers[E];A.source===k.id&&this._validateLayer(A)}})}loadURL(l,f={},g){this.fire(new a.k("dataloading",{dataType:"style"})),f.validate=typeof f.validate!="boolean"||f.validate;const b=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,a.h(b,this._loadStyleRequest).then(k=>{this._loadStyleRequest=null,this._load(k.data,f,g)}).catch(k=>{this._loadStyleRequest=null,k&&this.fire(new a.j(k))})}loadJSON(l,f={},g){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,f.validate=f.validate!==!1,this._load(l,f,g)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Sl,{validate:!1})}_load(l,f,g){var b;const k=f.transformStyle?f.transformStyle(g,l):l;if(!f.validate||!Mr(this,a.x(k))){this._loaded=!0,this.stylesheet=k;for(const E in k.sources)this.addSource(E,k.sources[E],{validate:!1});k.sprite?this._loadSprite(k.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(k.glyphs),this._createLayers(),this.light=new it(this.stylesheet.light),this.map.setTerrain((b=this.stylesheet.terrain)!==null&&b!==void 0?b:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const l=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(f=>f.id),this._layers={},this._serializedLayers=null;for(const f of l){const g=a.az(f);g.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=g}}_loadSprite(l,f=!1,g=void 0){let b;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(k,E,A,B){return a._(this,void 0,void 0,function*(){const G=Ie(k),X=A>1?"@2x":"",Y={},de={};for(const{id:Se,url:ke}of G){const Me=E.transformRequest(E.normalizeSpriteURL(ke,X,".json"),"SpriteJSON");Y[Se]=a.h(Me,B);const ye=E.transformRequest(E.normalizeSpriteURL(ke,X,".png"),"SpriteImage");de[Se]=F.getImage(ye,B)}return yield Promise.all([...Object.values(Y),...Object.values(de)]),function(Se,ke){return a._(this,void 0,void 0,function*(){const Me={};for(const ye in Se){Me[ye]={};const Re=y.getImageCanvasContext((yield ke[ye]).data),Je=(yield Se[ye]).data;for(const Le in Je){const{width:je,height:Qe,x:rt,y:ot,sdf:_t,pixelRatio:pt,stretchX:At,stretchY:Dt,content:bn}=Je[Le];Me[ye][Le]={data:null,pixelRatio:pt,sdf:_t,stretchX:At,stretchY:Dt,content:bn,spriteData:{width:je,height:Qe,x:rt,y:ot,context:Re}}}}return Me})}(Y,de)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(k=>{if(this._spriteRequest=null,k)for(const E in k){this._spritesImagesIds[E]=[];const A=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(B=>!(B in k)):[];for(const B of A)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in k[E]){const G=E==="default"?B:`${E}:${B}`;this._spritesImagesIds[E].push(G),G in this.imageManager.images?this.imageManager.updateImage(G,k[E][B],!1):this.imageManager.addImage(G,k[E][B]),f&&(this._changedImages[G]=!0)}}}).catch(k=>{this._spriteRequest=null,b=k,this.fire(new a.j(b))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),f&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),g&&g(b)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(l){const f=this.sourceCaches[l.source];if(!f)return;const g=l.sourceLayer;if(!g)return;const b=f.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(g)===-1)&&this.fire(new a.j(new Error(`Source layer "${g}" does not exist on source "${b.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const f=this._serializedAllLayers();if(!l||l.length===0)return Object.values(f);const g=[];for(const b of l)f[b]&&g.push(f[b]);return g}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const f=Object.keys(this._layers);for(const g of f){const b=this._layers[g];b.type!=="custom"&&(l[g]=b.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const f=this._changed;if(f){const b=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);(b.length||k.length)&&this._updateWorkerLayers(b,k);for(const E in this._updatedSources){const A=this._updatedSources[E];if(A==="reload")this._reloadSource(E);else{if(A!=="clear")throw new Error(`Invalid action ${A}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const g={};for(const b in this.sourceCaches){const k=this.sourceCaches[b];g[b]=k.used,k.used=!1}for(const b of this._order){const k=this._layers[b];k.recalculate(l,this._availableImages),!k.isHidden(l.zoom)&&k.source&&(this.sourceCaches[k.source].used=!0)}for(const b in g){const k=this.sourceCaches[b];!!g[b]!=!!k.used&&k.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:b}))}this.light.recalculate(l),this.z=l.zoom,f&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const f in this.sourceCaches)this.sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,f){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:f})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,f={}){var g;this._checkLoaded();const b=this.serialize();if(l=f.transformStyle?f.transformStyle(b,l):l,((g=f.validate)===null||g===void 0||g)&&Mr(this,a.x(l)))return!1;(l=a.aA(l)).layers=a.ay(l.layers);const k=a.aB(b,l),E=this._getOperationsToPerform(k);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const A of E.operations)A();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const f=[],g=[];for(const b of l)switch(b.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":f.push(()=>this.addLayer.apply(this,b.args));break;case"removeLayer":f.push(()=>this.removeLayer.apply(this,b.args));break;case"setPaintProperty":f.push(()=>this.setPaintProperty.apply(this,b.args));break;case"setLayoutProperty":f.push(()=>this.setLayoutProperty.apply(this,b.args));break;case"setFilter":f.push(()=>this.setFilter.apply(this,b.args));break;case"addSource":f.push(()=>this.addSource.apply(this,b.args));break;case"removeSource":f.push(()=>this.removeSource.apply(this,b.args));break;case"setLayerZoomRange":f.push(()=>this.setLayerZoomRange.apply(this,b.args));break;case"setLight":f.push(()=>this.setLight.apply(this,b.args));break;case"setGeoJSONSourceData":f.push(()=>this.setGeoJSONSourceData.apply(this,b.args));break;case"setGlyphs":f.push(()=>this.setGlyphs.apply(this,b.args));break;case"setSprite":f.push(()=>this.setSprite.apply(this,b.args));break;case"setTerrain":f.push(()=>this.map.setTerrain.apply(this,b.args));break;case"setTransition":f.push(()=>{});break;default:g.push(b.command)}return{operations:f,unimplemented:g}}addImage(l,f){if(this.getImage(l))return this.fire(new a.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,f),this._afterImageUpdated(l)}updateImage(l,f){this.imageManager.updateImage(l,f)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new a.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,f,g={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(a.x.source,`sources.${l}`,f,null,g))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const b=this.sourceCaches[l]=new Rn(l,f,this.dispatcher);b.style=this,b.setEventedParent(this,()=>({isSourceLoaded:b.loaded(),source:b.serialize(),sourceId:l})),b.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===l)return this.fire(new a.j(new Error(`Source "${l}" cannot be removed while layer "${g}" is using it.`)));const f=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],f.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),f.setEventedParent(null),f.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,f){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const g=this.sourceCaches[l].getSource();if(g.type!=="geojson")throw new Error(`geojsonSource.type is ${g.type}, which is !== 'geojson`);g.setData(f),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,f,g={}){this._checkLoaded();const b=l.id;if(this.getLayer(b))return void this.fire(new a.j(new Error(`Layer "${b}" already exists on this map.`)));let k;if(l.type==="custom"){if(Mr(this,a.aC(l)))return;k=a.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(b,l.source),l=a.aA(l),l=a.e(l,{source:b})),this._validate(a.x.layer,`layers.${b}`,l,{arrayIndex:-1},g))return;k=a.az(l),this._validateLayer(k),k.setEventedParent(this,{layer:{id:b}})}const E=f?this._order.indexOf(f):this._order.length;if(f&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${b}" before non-existing layer "${f}".`)));else{if(this._order.splice(E,0,b),this._layerOrderChanged=!0,this._layers[b]=k,this._removedLayers[b]&&k.source&&k.type!=="custom"){const A=this._removedLayers[b];delete this._removedLayers[b],A.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",this.sourceCaches[k.source].pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map)}}moveLayer(l,f){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new a.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===f)return;const g=this._order.indexOf(l);this._order.splice(g,1);const b=f?this._order.indexOf(f):this._order.length;f&&b===-1?this.fire(new a.j(new Error(`Cannot move layer "${l}" before non-existing layer "${f}".`))):(this._order.splice(b,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const f=this._layers[l];if(!f)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${l}".`)));f.setEventedParent(null);const g=this._order.indexOf(l);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=f,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],f.onRemove&&f.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,f,g){this._checkLoaded();const b=this.getLayer(l);b?b.minzoom===f&&b.maxzoom===g||(f!=null&&(b.minzoom=f),g!=null&&(b.maxzoom=g),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,f,g={}){this._checkLoaded();const b=this.getLayer(l);if(b){if(!a.aD(b.filter,f))return f==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(a.x.filter,`layers.${b.id}.filter`,f,null,g)||(b.filter=a.aA(f),this._updateLayer(b)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return a.aA(this.getLayer(l).filter)}setLayoutProperty(l,f,g,b={}){this._checkLoaded();const k=this.getLayer(l);k?a.aD(k.getLayoutProperty(f),g)||(k.setLayoutProperty(f,g,b),this._updateLayer(k)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,f){const g=this.getLayer(l);if(g)return g.getLayoutProperty(f);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,f,g,b={}){this._checkLoaded();const k=this.getLayer(l);k?a.aD(k.getPaintProperty(f),g)||(k.setPaintProperty(f,g,b)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,f){return this.getLayer(l).getPaintProperty(f)}setFeatureState(l,f){this._checkLoaded();const g=l.source,b=l.sourceLayer,k=this.sourceCaches[g];if(k===void 0)return void this.fire(new a.j(new Error(`The source '${g}' does not exist in the map's style.`)));const E=k.getSource().type;E==="geojson"&&b?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||b?(l.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),k.setFeatureState(b,l.id,f)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,f){this._checkLoaded();const g=l.source,b=this.sourceCaches[g];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${g}' does not exist in the map's style.`)));const k=b.getSource().type,E=k==="vector"?l.sourceLayer:void 0;k!=="vector"||E?f&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(E,l.id,f):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const f=l.source,g=l.sourceLayer,b=this.sourceCaches[f];if(b!==void 0)return b.getSource().type!=="vector"||g?(l.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.getFeatureState(g,l.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${f}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=a.aE(this.sourceCaches,k=>k.serialize()),f=this._serializeByIds(this._order),g=this.map.getTerrain()||void 0,b=this.stylesheet;return a.aF({version:b.version,name:b.name,metadata:b.metadata,light:b.light,center:b.center,zoom:b.zoom,bearing:b.bearing,pitch:b.pitch,sprite:b.sprite,glyphs:b.glyphs,transition:b.transition,sources:l,layers:f,terrain:g},k=>k!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const f=E=>this._layers[E].type==="fill-extrusion",g={},b=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(f(A)){g[A]=E;for(const B of l){const G=B[A];if(G)for(const X of G)b.push(X)}}}b.sort((E,A)=>A.intersectionZ-E.intersectionZ);const k=[];for(let E=this._order.length-1;E>=0;E--){const A=this._order[E];if(f(A))for(let B=b.length-1;B>=0;B--){const G=b[B].feature;if(g[G.layer.id]<E)break;k.push(G),b.pop()}else for(const B of l){const G=B[A];if(G)for(const X of G)k.push(X.feature)}}return k}queryRenderedFeatures(l,f,g){f&&f.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",f.filter,null,f);const b={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const A of f.layers){const B=this._layers[A];if(!B)return this.fire(new a.j(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];b[B.source]=!0}}const k=[];f.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const A in this.sourceCaches)f.layers&&!b[A]||k.push(ut(this.sourceCaches[A],this._layers,E,l,f,g));return this.placement&&k.push(function(A,B,G,X,Y,de,Se){const ke={},Me=de.queryRenderedSymbols(X),ye=[];for(const Re of Object.keys(Me).map(Number))ye.push(Se[Re]);ye.sort(Wt);for(const Re of ye){const Je=Re.featureIndex.lookupSymbolFeatures(Me[Re.bucketInstanceId],B,Re.bucketIndex,Re.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,A);for(const Le in Je){const je=ke[Le]=ke[Le]||[],Qe=Je[Le];Qe.sort((rt,ot)=>{const _t=Re.featureSortOrder;if(_t){const pt=_t.indexOf(rt.featureIndex);return _t.indexOf(ot.featureIndex)-pt}return ot.featureIndex-rt.featureIndex});for(const rt of Qe)je.push(rt)}}for(const Re in ke)ke[Re].forEach(Je=>{const Le=Je.feature,je=G[A[Re].source].getFeatureState(Le.layer["source-layer"],Le.id);Le.source=Le.layer.source,Le.layer["source-layer"]&&(Le.sourceLayer=Le.layer["source-layer"]),Le.state=je});return ke}(this._layers,E,this.sourceCaches,l,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(k)}querySourceFeatures(l,f){f&&f.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",f.filter,null,f);const g=this.sourceCaches[l];return g?function(b,k){const E=b.getRenderableIds().map(G=>b.getTileByID(G)),A=[],B={};for(let G=0;G<E.length;G++){const X=E[G],Y=X.tileID.canonical.key;B[Y]||(B[Y]=!0,X.querySourceFeatures(A,k))}return A}(g,f):[]}getLight(){return this.light.getLight()}setLight(l,f={}){this._checkLoaded();const g=this.light.getLight();let b=!1;for(const E in l)if(!a.aD(l[E],g[E])){b=!0;break}if(!b)return;const k={now:y.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,f),this.light.updateTransitions(k)}_validate(l,f,g,b,k={}){return(!k||k.validate!==!1)&&Mr(this,l.call(a.x,a.e({key:f,style:this.serialize(),value:g,styleSpec:a.v},b)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),bt().off(ei,this._rtlPluginLoaded);for(const f in this._layers)this._layers[f].setEventedParent(null);for(const f in this.sourceCaches){const g=this.sourceCaches[f];g.setEventedParent(null),g.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const f in this.sourceCaches)this.sourceCaches[f].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,f,g,b,k=!1){let E=!1,A=!1;const B={};for(const G of this._order){const X=this._layers[G];if(X.type!=="symbol")continue;if(!B[X.source]){const de=this.sourceCaches[X.source];B[X.source]=de.getRenderableIds(!0).map(Se=>de.getTileByID(Se)).sort((Se,ke)=>ke.tileID.overscaledZ-Se.tileID.overscaledZ||(Se.tileID.isLessThan(ke.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer(X,B[X.source],l.center.lng);E=E||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((k=k||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(y.now(),l.zoom))&&(this.pauseablePlacement=new fo(l,this.map.terrain,this._order,k,f,g,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(y.now()),A=!0),E&&this.pauseablePlacement.placement.setStale()),A||E)for(const G of this._order){const X=this._layers[G];X.type==="symbol"&&this.placement.updateLayerOpacities(X,B[X.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(y.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,f){return a._(this,void 0,void 0,function*(){const g=yield this.imageManager.getImages(f.icons);this._updateTilesForChangedImages();const b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,f.icons),g})}getGlyphs(l,f){return a._(this,void 0,void 0,function*(){const g=yield this.glyphManager.getGlyphs(f.stacks),b=this.sourceCaches[f.source];return b&&b.setDependencies(f.tileID.key,f.type,[""]),g})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,f={}){this._checkLoaded(),l&&this._validate(a.x.glyphs,"glyphs",l,null,f)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,f,g={},b){this._checkLoaded();const k=[{id:l,url:f}],E=[...Ie(this.stylesheet.sprite),...k];this._validate(a.x.sprite,"sprite",E,null,g)||(this.stylesheet.sprite=E,this._loadSprite(k,!0,b))}removeSprite(l){this._checkLoaded();const f=Ie(this.stylesheet.sprite);if(f.find(g=>g.id===l)){if(this._spritesImagesIds[l])for(const g of this._spritesImagesIds[l])this.imageManager.removeImage(g),this._changedImages[g]=!0;f.splice(f.findIndex(g=>g.id===l),1),this.stylesheet.sprite=f.length>0?f:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Ie(this.stylesheet.sprite)}setSprite(l,f={},g){this._checkLoaded(),l&&this._validate(a.x.sprite,"sprite",l,null,f)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,g):(this._unloadSprite(),g&&g(null)))}}var Cl=a.X([{name:"a_pos",type:"Int16",components:2}]),jo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ua={prelude:or(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:or(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:or(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:or(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:or("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:or(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:or(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:or("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:or("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:or("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:or(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:or(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:or(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:or(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:or(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:or(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:or(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:or(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:or(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:or(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:or(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:or(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:or(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:or(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:or(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:or(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:or("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",jo),terrainDepth:or("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",jo),terrainCoords:or("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",jo)};function or(x,l){const f=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=l.match(/attribute ([\w]+) ([\w]+)/g),b=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=k?k.concat(b):b,A={};return{fragmentSource:x=x.replace(f,(B,G,X,Y,de)=>(A[de]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${de}
varying ${X} ${Y} ${de};
#else
uniform ${X} ${Y} u_${de};
#endif
`:`
#ifdef HAS_UNIFORM_u_${de}
    ${X} ${Y} ${de} = u_${de};
#endif
`)),vertexSource:l=l.replace(f,(B,G,X,Y,de)=>{const Se=Y==="float"?"vec2":"vec4",ke=de.match(/color/)?"color":Se;return A[de]?G==="define"?`
#ifndef HAS_UNIFORM_u_${de}
uniform lowp float u_${de}_t;
attribute ${X} ${Se} a_${de};
varying ${X} ${Y} ${de};
#else
uniform ${X} ${Y} u_${de};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${de}
    ${de} = a_${de};
#else
    ${X} ${Y} ${de} = u_${de};
#endif
`:`
#ifndef HAS_UNIFORM_u_${de}
    ${de} = unpack_mix_${ke}(a_${de}, u_${de}_t);
#else
    ${X} ${Y} ${de} = u_${de};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${de}
uniform lowp float u_${de}_t;
attribute ${X} ${Se} a_${de};
#else
uniform ${X} ${Y} u_${de};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${de}
    ${X} ${Y} ${de} = a_${de};
#else
    ${X} ${Y} ${de} = u_${de};
#endif
`:`
#ifndef HAS_UNIFORM_u_${de}
    ${X} ${Y} ${de} = unpack_mix_${ke}(a_${de}, u_${de}_t);
#else
    ${X} ${Y} ${de} = u_${de};
#endif
`}),staticAttributes:g,staticUniforms:E}}class Tl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,f,g,b,k,E,A,B,G){this.context=l;let X=this.boundPaintVertexBuffers.length!==b.length;for(let Y=0;!X&&Y<b.length;Y++)this.boundPaintVertexBuffers[Y]!==b[Y]&&(X=!0);!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==g||X||this.boundIndexBuffer!==k||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==A||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==G?this.freshBind(f,g,b,k,E,A,B,G):(l.bindVertexArray.set(this.vao),A&&A.bind(),k&&k.dynamicDraw&&k.bind(),B&&B.bind(),G&&G.bind())}freshBind(l,f,g,b,k,E,A,B){const G=l.numAttributes,X=this.context,Y=X.gl;this.vao&&this.destroy(),this.vao=X.createVertexArray(),X.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=b,this.boundVertexOffset=k,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=A,this.boundDynamicVertexBuffer3=B,f.enableAttributes(Y,l);for(const de of g)de.enableAttributes(Y,l);E&&E.enableAttributes(Y,l),A&&A.enableAttributes(Y,l),B&&B.enableAttributes(Y,l),f.bind(),f.setVertexAttribPointers(Y,l,k);for(const de of g)de.bind(),de.setVertexAttribPointers(Y,l,k);E&&(E.bind(),E.setVertexAttribPointers(Y,l,k)),b&&b.bind(),A&&(A.bind(),A.setVertexAttribPointers(Y,l,k)),B&&(B.bind(),B.setVertexAttribPointers(Y,l,k)),X.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ia(x){const l=[];for(let f=0;f<x.length;f++){if(x[f]===null)continue;const g=x[f].split(" ");l.push(g.pop())}return l}class _s{constructor(l,f,g,b,k,E){const A=l.gl;this.program=A.createProgram();const B=ia(f.staticAttributes),G=g?g.getBinderAttributes():[],X=B.concat(G),Y=Ua.prelude.staticUniforms?ia(Ua.prelude.staticUniforms):[],de=f.staticUniforms?ia(f.staticUniforms):[],Se=g?g.getBinderUniforms():[],ke=Y.concat(de).concat(Se),Me=[];for(const rt of ke)Me.indexOf(rt)<0&&Me.push(rt);const ye=g?g.defines():[];k&&ye.push("#define OVERDRAW_INSPECTOR;"),E&&ye.push("#define TERRAIN3D;");const Re=ye.concat(Ua.prelude.fragmentSource,f.fragmentSource).join(`
`),Je=ye.concat(Ua.prelude.vertexSource,f.vertexSource).join(`
`),Le=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(Le,Re),A.compileShader(Le),!A.getShaderParameter(Le,A.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${A.getShaderInfoLog(Le)}`);A.attachShader(this.program,Le);const je=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())return void(this.failedToCreate=!0);if(A.shaderSource(je,Je),A.compileShader(je),!A.getShaderParameter(je,A.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${A.getShaderInfoLog(je)}`);A.attachShader(this.program,je),this.attributes={};const Qe={};this.numAttributes=X.length;for(let rt=0;rt<this.numAttributes;rt++)X[rt]&&(A.bindAttribLocation(this.program,rt,X[rt]),this.attributes[X[rt]]=rt);if(A.linkProgram(this.program),!A.getProgramParameter(this.program,A.LINK_STATUS))throw new Error(`Program failed to link: ${A.getProgramInfoLog(this.program)}`);A.deleteShader(je),A.deleteShader(Le);for(let rt=0;rt<Me.length;rt++){const ot=Me[rt];if(ot&&!Qe[ot]){const _t=A.getUniformLocation(this.program,ot);_t&&(Qe[ot]=_t)}}this.fixedUniforms=b(l,Qe),this.terrainUniforms=((rt,ot)=>({u_depth:new a.aG(rt,ot.u_depth),u_terrain:new a.aG(rt,ot.u_terrain),u_terrain_dim:new a.aH(rt,ot.u_terrain_dim),u_terrain_matrix:new a.aI(rt,ot.u_terrain_matrix),u_terrain_unpack:new a.aJ(rt,ot.u_terrain_unpack),u_terrain_exaggeration:new a.aH(rt,ot.u_terrain_exaggeration)}))(l,Qe),this.binderUniforms=g?g.getUniforms(l,Qe):[]}draw(l,f,g,b,k,E,A,B,G,X,Y,de,Se,ke,Me,ye,Re,Je){const Le=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(g),l.setStencilMode(b),l.setColorMode(k),l.setCullFace(E),B){l.activeTexture.set(Le.TEXTURE2),Le.bindTexture(Le.TEXTURE_2D,B.depthTexture),l.activeTexture.set(Le.TEXTURE3),Le.bindTexture(Le.TEXTURE_2D,B.texture);for(const Qe in this.terrainUniforms)this.terrainUniforms[Qe].set(B[Qe])}for(const Qe in this.fixedUniforms)this.fixedUniforms[Qe].set(A[Qe]);Me&&Me.setUniforms(l,this.binderUniforms,Se,{zoom:ke});let je=0;switch(f){case Le.LINES:je=2;break;case Le.TRIANGLES:je=3;break;case Le.LINE_STRIP:je=1}for(const Qe of de.get()){const rt=Qe.vaos||(Qe.vaos={});(rt[G]||(rt[G]=new Tl)).bind(l,this,X,Me?Me.getPaintVertexBuffers():[],Y,Qe.vertexOffset,ye,Re,Je),Le.drawElements(f,Qe.primitiveLength*je,Le.UNSIGNED_SHORT,Qe.primitiveOffset*je*2)}}}function Ml(x,l,f){const g=1/dn(f,1,l.transform.tileZoom),b=Math.pow(2,f.tileID.overscaledZ),k=f.tileSize*Math.pow(2,l.transform.tileZoom)/b,E=k*(f.tileID.canonical.x+f.tileID.wrap*b),A=k*f.tileID.canonical.y;return{u_image:0,u_texsize:f.imageAtlasTexture.size,u_scale:[g,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[E>>16,A>>16],u_pixel_coord_lower:[65535&E,65535&A]}}const Va=(x,l,f,g)=>{const b=l.style.light,k=b.properties.get("position"),E=[k.x,k.y,k.z],A=function(){var G=new a.A(9);return a.A!=Float32Array&&(G[1]=0,G[2]=0,G[3]=0,G[5]=0,G[6]=0,G[7]=0),G[0]=1,G[4]=1,G[8]=1,G}();b.properties.get("anchor")==="viewport"&&function(G,X){var Y=Math.sin(X),de=Math.cos(X);G[0]=de,G[1]=Y,G[2]=0,G[3]=-Y,G[4]=de,G[5]=0,G[6]=0,G[7]=0,G[8]=1}(A,-l.transform.angle),function(G,X,Y){var de=X[0],Se=X[1],ke=X[2];G[0]=de*Y[0]+Se*Y[3]+ke*Y[6],G[1]=de*Y[1]+Se*Y[4]+ke*Y[7],G[2]=de*Y[2]+Se*Y[5]+ke*Y[8]}(E,E,A);const B=b.properties.get("color");return{u_matrix:x,u_lightpos:E,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+f,u_opacity:g}},Dd=(x,l,f,g,b,k,E)=>a.e(Va(x,l,f,g),Ml(k,l,E),{u_height_factor:-Math.pow(2,b.overscaledZ)/E.tileSize/8}),$h=x=>({u_matrix:x}),Ll=(x,l,f,g)=>a.e($h(x),Ml(f,l,g)),$d=(x,l)=>({u_matrix:x,u_world:l}),Rh=(x,l,f,g,b)=>a.e(Ll(x,l,f,g),{u_world:b}),Rd=(x,l,f,g)=>{const b=x.transform;let k,E;if(g.paint.get("circle-pitch-alignment")==="map"){const A=dn(f,1,b.zoom);k=!0,E=[A,A]}else k=!1,E=b.pixelsToGLUnits;return{u_camera_to_center_distance:b.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:x.translatePosMatrix(l.posMatrix,f,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+k,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:E}},Fh=(x,l,f)=>{const g=dn(f,1,l.zoom),b=Math.pow(2,l.zoom-f.tileID.overscaledZ),k=f.tileID.overscaleFactor();return{u_matrix:x,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[l.pixelsToGLUnits[0]/(g*b),l.pixelsToGLUnits[1]/(g*b)],u_overscale_factor:k}},Bh=(x,l,f=1)=>({u_matrix:x,u_color:l,u_overlay:0,u_overlay_scale:f}),El=x=>({u_matrix:x}),Oh=(x,l,f,g)=>({u_matrix:x,u_extrude_scale:dn(l,1,f),u_intensity:g});function Nh(x,l){const f=Math.pow(2,l.canonical.z),g=l.canonical.y;return[new a.Y(0,g/f).toLngLat().lat,new a.Y(0,(g+1)/f).toLngLat().lat]}const Il=(x,l,f,g)=>{const b=x.transform;return{u_matrix:qa(x,l,f,g),u_ratio:1/dn(l,1,b.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},jh=(x,l,f,g,b)=>a.e(Il(x,l,f,b),{u_image:0,u_image_height:g}),Es=(x,l,f,g,b)=>{const k=x.transform,E=Ji(l,k);return{u_matrix:qa(x,l,f,b),u_texsize:l.imageAtlasTexture.size,u_ratio:1/dn(l,1,k.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[E,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},Al=(x,l,f,g,b,k)=>{const E=x.lineAtlas,A=Ji(l,x.transform),B=f.layout.get("line-cap")==="round",G=E.getDash(g.from,B),X=E.getDash(g.to,B),Y=G.width*b.fromScale,de=X.width*b.toScale;return a.e(Il(x,l,f,k),{u_patternscale_a:[A/Y,-G.height/2],u_patternscale_b:[A/de,-X.height/2],u_sdfgamma:E.width/(256*Math.min(Y,de)*x.pixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:X.y,u_mix:b.t})};function Ji(x,l){return 1/dn(x,1,l.tileZoom)}function qa(x,l,f,g){return x.translatePosMatrix(g?g.posMatrix:l.tileID.posMatrix,l,f.paint.get("line-translate"),f.paint.get("line-translate-anchor"))}const Pl=(x,l,f,g,b)=>{return{u_matrix:x,u_tl_parent:l,u_scale_parent:f,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(E=b.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(k=b.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:Za(b.paint.get("raster-hue-rotate"))};var k,E};function Za(x){x*=Math.PI/180;const l=Math.sin(x),f=Math.cos(x);return[(2*f+1)/3,(-Math.sqrt(3)*l-f+1)/3,(Math.sqrt(3)*l-f+1)/3]}const Ga=(x,l,f,g,b,k,E,A,B,G)=>{const X=b.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:X.cameraToCenterDistance,u_pitch:X.pitch/360*2*Math.PI,u_rotate_symbol:+f,u_aspect_ratio:X.width/X.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:E,u_coord_matrix:A,u_is_text:+B,u_pitch_with_map:+g,u_texsize:G,u_texture:0}},Ha=(x,l,f,g,b,k,E,A,B,G,X)=>{const Y=b.transform;return a.e(Ga(x,l,f,g,b,k,E,A,B,G),{u_gamma_scale:g?Math.cos(Y._pitch)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:+X})},Wa=(x,l,f,g,b,k,E,A,B,G)=>a.e(Ha(x,l,f,g,b,k,E,A,!0,B,!0),{u_texsize_icon:G,u_texture_icon:1}),Fd=(x,l,f)=>({u_matrix:x,u_opacity:l,u_color:f}),Bd=(x,l,f,g,b,k)=>a.e(function(E,A,B,G){const X=B.imageManager.getPattern(E.from.toString()),Y=B.imageManager.getPattern(E.to.toString()),{width:de,height:Se}=B.imageManager.getPixelSize(),ke=Math.pow(2,G.tileID.overscaledZ),Me=G.tileSize*Math.pow(2,B.transform.tileZoom)/ke,ye=Me*(G.tileID.canonical.x+G.tileID.wrap*ke),Re=Me*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:X.tl,u_pattern_br_a:X.br,u_pattern_tl_b:Y.tl,u_pattern_br_b:Y.br,u_texsize:[de,Se],u_mix:A.t,u_pattern_size_a:X.displaySize,u_pattern_size_b:Y.displaySize,u_scale_a:A.fromScale,u_scale_b:A.toScale,u_tile_units_to_pixels:1/dn(G,1,B.transform.tileZoom),u_pixel_coord_upper:[ye>>16,Re>>16],u_pixel_coord_lower:[65535&ye,65535&Re]}}(g,k,f,b),{u_matrix:x,u_opacity:l}),Uh={fillExtrusion:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_lightpos:new a.aK(x,l.u_lightpos),u_lightintensity:new a.aH(x,l.u_lightintensity),u_lightcolor:new a.aK(x,l.u_lightcolor),u_vertical_gradient:new a.aH(x,l.u_vertical_gradient),u_opacity:new a.aH(x,l.u_opacity)}),fillExtrusionPattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_lightpos:new a.aK(x,l.u_lightpos),u_lightintensity:new a.aH(x,l.u_lightintensity),u_lightcolor:new a.aK(x,l.u_lightcolor),u_vertical_gradient:new a.aH(x,l.u_vertical_gradient),u_height_factor:new a.aH(x,l.u_height_factor),u_image:new a.aG(x,l.u_image),u_texsize:new a.aL(x,l.u_texsize),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade),u_opacity:new a.aH(x,l.u_opacity)}),fill:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix)}),fillPattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_image:new a.aG(x,l.u_image),u_texsize:new a.aL(x,l.u_texsize),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade)}),fillOutline:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_world:new a.aL(x,l.u_world)}),fillOutlinePattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_world:new a.aL(x,l.u_world),u_image:new a.aG(x,l.u_image),u_texsize:new a.aL(x,l.u_texsize),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade)}),circle:(x,l)=>({u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_scale_with_map:new a.aG(x,l.u_scale_with_map),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_extrude_scale:new a.aL(x,l.u_extrude_scale),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_matrix:new a.aI(x,l.u_matrix)}),collisionBox:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(x,l.u_pixels_to_tile_units),u_extrude_scale:new a.aL(x,l.u_extrude_scale),u_overscale_factor:new a.aH(x,l.u_overscale_factor)}),collisionCircle:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_inv_matrix:new a.aI(x,l.u_inv_matrix),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_viewport_size:new a.aL(x,l.u_viewport_size)}),debug:(x,l)=>({u_color:new a.aM(x,l.u_color),u_matrix:new a.aI(x,l.u_matrix),u_overlay:new a.aG(x,l.u_overlay),u_overlay_scale:new a.aH(x,l.u_overlay_scale)}),clippingMask:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix)}),heatmap:(x,l)=>({u_extrude_scale:new a.aH(x,l.u_extrude_scale),u_intensity:new a.aH(x,l.u_intensity),u_matrix:new a.aI(x,l.u_matrix)}),heatmapTexture:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_world:new a.aL(x,l.u_world),u_image:new a.aG(x,l.u_image),u_color_ramp:new a.aG(x,l.u_color_ramp),u_opacity:new a.aH(x,l.u_opacity)}),hillshade:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_image:new a.aG(x,l.u_image),u_latrange:new a.aL(x,l.u_latrange),u_light:new a.aL(x,l.u_light),u_shadow:new a.aM(x,l.u_shadow),u_highlight:new a.aM(x,l.u_highlight),u_accent:new a.aM(x,l.u_accent)}),hillshadePrepare:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_image:new a.aG(x,l.u_image),u_dimension:new a.aL(x,l.u_dimension),u_zoom:new a.aH(x,l.u_zoom),u_unpack:new a.aJ(x,l.u_unpack)}),line:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels)}),lineGradient:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels),u_image:new a.aG(x,l.u_image),u_image_height:new a.aH(x,l.u_image_height)}),linePattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_texsize:new a.aL(x,l.u_texsize),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_image:new a.aG(x,l.u_image),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels),u_scale:new a.aK(x,l.u_scale),u_fade:new a.aH(x,l.u_fade)}),lineSDF:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ratio:new a.aH(x,l.u_ratio),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_units_to_pixels:new a.aL(x,l.u_units_to_pixels),u_patternscale_a:new a.aL(x,l.u_patternscale_a),u_patternscale_b:new a.aL(x,l.u_patternscale_b),u_sdfgamma:new a.aH(x,l.u_sdfgamma),u_image:new a.aG(x,l.u_image),u_tex_y_a:new a.aH(x,l.u_tex_y_a),u_tex_y_b:new a.aH(x,l.u_tex_y_b),u_mix:new a.aH(x,l.u_mix)}),raster:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_tl_parent:new a.aL(x,l.u_tl_parent),u_scale_parent:new a.aH(x,l.u_scale_parent),u_buffer_scale:new a.aH(x,l.u_buffer_scale),u_fade_t:new a.aH(x,l.u_fade_t),u_opacity:new a.aH(x,l.u_opacity),u_image0:new a.aG(x,l.u_image0),u_image1:new a.aG(x,l.u_image1),u_brightness_low:new a.aH(x,l.u_brightness_low),u_brightness_high:new a.aH(x,l.u_brightness_high),u_saturation_factor:new a.aH(x,l.u_saturation_factor),u_contrast_factor:new a.aH(x,l.u_contrast_factor),u_spin_weights:new a.aK(x,l.u_spin_weights)}),symbolIcon:(x,l)=>({u_is_size_zoom_constant:new a.aG(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(x,l.u_is_size_feature_constant),u_size_t:new a.aH(x,l.u_size_t),u_size:new a.aH(x,l.u_size),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pitch:new a.aH(x,l.u_pitch),u_rotate_symbol:new a.aG(x,l.u_rotate_symbol),u_aspect_ratio:new a.aH(x,l.u_aspect_ratio),u_fade_change:new a.aH(x,l.u_fade_change),u_matrix:new a.aI(x,l.u_matrix),u_label_plane_matrix:new a.aI(x,l.u_label_plane_matrix),u_coord_matrix:new a.aI(x,l.u_coord_matrix),u_is_text:new a.aG(x,l.u_is_text),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_texsize:new a.aL(x,l.u_texsize),u_texture:new a.aG(x,l.u_texture)}),symbolSDF:(x,l)=>({u_is_size_zoom_constant:new a.aG(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(x,l.u_is_size_feature_constant),u_size_t:new a.aH(x,l.u_size_t),u_size:new a.aH(x,l.u_size),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pitch:new a.aH(x,l.u_pitch),u_rotate_symbol:new a.aG(x,l.u_rotate_symbol),u_aspect_ratio:new a.aH(x,l.u_aspect_ratio),u_fade_change:new a.aH(x,l.u_fade_change),u_matrix:new a.aI(x,l.u_matrix),u_label_plane_matrix:new a.aI(x,l.u_label_plane_matrix),u_coord_matrix:new a.aI(x,l.u_coord_matrix),u_is_text:new a.aG(x,l.u_is_text),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_texsize:new a.aL(x,l.u_texsize),u_texture:new a.aG(x,l.u_texture),u_gamma_scale:new a.aH(x,l.u_gamma_scale),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_is_halo:new a.aG(x,l.u_is_halo)}),symbolTextAndIcon:(x,l)=>({u_is_size_zoom_constant:new a.aG(x,l.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(x,l.u_is_size_feature_constant),u_size_t:new a.aH(x,l.u_size_t),u_size:new a.aH(x,l.u_size),u_camera_to_center_distance:new a.aH(x,l.u_camera_to_center_distance),u_pitch:new a.aH(x,l.u_pitch),u_rotate_symbol:new a.aG(x,l.u_rotate_symbol),u_aspect_ratio:new a.aH(x,l.u_aspect_ratio),u_fade_change:new a.aH(x,l.u_fade_change),u_matrix:new a.aI(x,l.u_matrix),u_label_plane_matrix:new a.aI(x,l.u_label_plane_matrix),u_coord_matrix:new a.aI(x,l.u_coord_matrix),u_is_text:new a.aG(x,l.u_is_text),u_pitch_with_map:new a.aG(x,l.u_pitch_with_map),u_texsize:new a.aL(x,l.u_texsize),u_texsize_icon:new a.aL(x,l.u_texsize_icon),u_texture:new a.aG(x,l.u_texture),u_texture_icon:new a.aG(x,l.u_texture_icon),u_gamma_scale:new a.aH(x,l.u_gamma_scale),u_device_pixel_ratio:new a.aH(x,l.u_device_pixel_ratio),u_is_halo:new a.aG(x,l.u_is_halo)}),background:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_opacity:new a.aH(x,l.u_opacity),u_color:new a.aM(x,l.u_color)}),backgroundPattern:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_opacity:new a.aH(x,l.u_opacity),u_image:new a.aG(x,l.u_image),u_pattern_tl_a:new a.aL(x,l.u_pattern_tl_a),u_pattern_br_a:new a.aL(x,l.u_pattern_br_a),u_pattern_tl_b:new a.aL(x,l.u_pattern_tl_b),u_pattern_br_b:new a.aL(x,l.u_pattern_br_b),u_texsize:new a.aL(x,l.u_texsize),u_mix:new a.aH(x,l.u_mix),u_pattern_size_a:new a.aL(x,l.u_pattern_size_a),u_pattern_size_b:new a.aL(x,l.u_pattern_size_b),u_scale_a:new a.aH(x,l.u_scale_a),u_scale_b:new a.aH(x,l.u_scale_b),u_pixel_coord_upper:new a.aL(x,l.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(x,l.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(x,l.u_tile_units_to_pixels)}),terrain:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_texture:new a.aG(x,l.u_texture),u_ele_delta:new a.aH(x,l.u_ele_delta)}),terrainDepth:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_ele_delta:new a.aH(x,l.u_ele_delta)}),terrainCoords:(x,l)=>({u_matrix:new a.aI(x,l.u_matrix),u_texture:new a.aG(x,l.u_texture),u_terrain_coords_id:new a.aH(x,l.u_terrain_coords_id),u_ele_delta:new a.aH(x,l.u_ele_delta)})};class Od{constructor(l,f,g){this.context=l;const b=l.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const f=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Is={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zl{constructor(l,f,g,b){this.length=f.length,this.attributes=g,this.itemSize=f.bytesPerElement,this.dynamicDraw=b,this.context=l;const k=l.gl;this.buffer=k.createBuffer(),l.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,f){for(let g=0;g<this.attributes.length;g++){const b=f.attributes[this.attributes[g].name];b!==void 0&&l.enableVertexAttribArray(b)}}setVertexAttribPointers(l,f,g){for(let b=0;b<this.attributes.length;b++){const k=this.attributes[b],E=f.attributes[k.name];E!==void 0&&l.vertexAttribPointer(E,k.components,l[Is[k.type]],!1,this.itemSize,k.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Mi=new WeakMap;function vi(x){var l;if(Mi.has(x))return Mi.get(x);{const f=(l=x.getParameter(x.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Mi.set(x,f),f}}class Kn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Dl extends Kn{getDefault(){return a.aO.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class $l extends Kn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Uc extends Kn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Vc extends Kn{getDefault(){return[!0,!0,!0,!0]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Rl extends Kn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class qc extends Kn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class Zc extends Kn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const f=this.current;(l.func!==f.func||l.ref!==f.ref||l.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class Fl extends Kn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Vh extends Kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=l,this.dirty=!1}}class qh extends Kn{getDefault(){return[0,1]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class oa extends Kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=l,this.dirty=!1}}class Nd extends Kn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class jd extends Kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.BLEND):f.disable(f.BLEND),this.current=l,this.dirty=!1}}class Ud extends Kn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Vd extends Kn{getDefault(){return a.aO.transparent}set(l){const f=this.current;(l.r!==f.r||l.g!==f.g||l.b!==f.b||l.a!==f.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class qd extends Kn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Zd extends Kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;l?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=l,this.dirty=!1}}class Gc extends Kn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Bl extends Kn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class Hc extends Kn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Wc extends Kn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class sa extends Kn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const f=this.current;(l[0]!==f[0]||l[1]!==f[1]||l[2]!==f[2]||l[3]!==f[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Zh extends Kn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Gh extends Kn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Kc extends Kn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class As extends Kn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Hh extends Kn{getDefault(){return null}set(l){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class aa extends Kn{getDefault(){return null}set(l){var f;if(l===this.current&&!this.dirty)return;const g=this.gl;vi(g)?g.bindVertexArray(l):(f=g.getExtension("OES_vertex_array_object"))===null||f===void 0||f.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class la extends Kn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Wh extends Kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Xc extends Kn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Hn extends Kn{constructor(l,f){super(l),this.context=l,this.parent=f}getDefault(){return null}}class Ol extends Hn{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Gd extends Hn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Kh extends Hn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ka{constructor(l,f,g,b,k){this.context=l,this.width=f,this.height=g;const E=l.gl,A=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new Ol(l,A),b)this.depthAttachment=k?new Kh(l,A):new Gd(l,A);else if(k)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){const g=this.depthAttachment.get();g&&l.deleteRenderbuffer(g)}l.deleteFramebuffer(this.framebuffer)}}class jr{constructor(l,f,g){this.blendFunction=l,this.blendColor=f,this.mask=g}}jr.Replace=[1,0],jr.disabled=new jr(jr.Replace,a.aO.transparent,[!1,!1,!1,!1]),jr.unblended=new jr(jr.Replace,a.aO.transparent,[!0,!0,!0,!0]),jr.alphaBlended=new jr([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Hd{constructor(l){var f,g;if(this.gl=l,this.clearColor=new Dl(this),this.clearDepth=new $l(this),this.clearStencil=new Uc(this),this.colorMask=new Vc(this),this.depthMask=new Rl(this),this.stencilMask=new qc(this),this.stencilFunc=new Zc(this),this.stencilOp=new Fl(this),this.stencilTest=new Vh(this),this.depthRange=new qh(this),this.depthTest=new oa(this),this.depthFunc=new Nd(this),this.blend=new jd(this),this.blendFunc=new Ud(this),this.blendColor=new Vd(this),this.blendEquation=new qd(this),this.cullFace=new Zd(this),this.cullFaceSide=new Gc(this),this.frontFace=new Bl(this),this.program=new Hc(this),this.activeTexture=new Wc(this),this.viewport=new sa(this),this.bindFramebuffer=new Zh(this),this.bindRenderbuffer=new Gh(this),this.bindTexture=new Kc(this),this.bindVertexBuffer=new As(this),this.bindElementBuffer=new Hh(this),this.bindVertexArray=new aa(this),this.pixelStoreUnpack=new la(this),this.pixelStoreUnpackPremultiplyAlpha=new Wh(this),this.pixelStoreUnpackFlipY=new Xc(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),vi(l)){this.HALF_FLOAT=l.HALF_FLOAT;const b=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(f=l.RGBA16F)!==null&&f!==void 0?f:b==null?void 0:b.RGBA16F_EXT,this.RGB16F=(g=l.RGB16F)!==null&&g!==void 0?g:b==null?void 0:b.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const b=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=b==null?void 0:b.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,f){return new Od(this,l,f)}createVertexBuffer(l,f,g){return new zl(this,l,f,g)}createRenderbuffer(l,f,g){const b=this.gl,k=b.createRenderbuffer();return this.bindRenderbuffer.set(k),b.renderbufferStorage(b.RENDERBUFFER,l,f,g),this.bindRenderbuffer.set(null),k}createFramebuffer(l,f,g,b){return new Ka(this,l,f,g,b)}clear({color:l,depth:f,stencil:g}){const b=this.gl;let k=0;l&&(k|=b.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),f!==void 0&&(k|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),g!==void 0&&(k|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),b.clear(k)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){a.aD(l.blendFunction,jr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return vi(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var f;return vi(this.gl)?this.gl.deleteVertexArray(l):(f=this.gl.getExtension("OES_vertex_array_object"))===null||f===void 0?void 0:f.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class qn{constructor(l,f,g){this.func=l,this.mask=f,this.range=g}}qn.ReadOnly=!1,qn.ReadWrite=!0,qn.disabled=new qn(519,qn.ReadOnly,[0,1]);const Jc=7680;class yr{constructor(l,f,g,b,k,E){this.test=l,this.ref=f,this.mask=g,this.fail=b,this.depthFail=k,this.pass=E}}yr.disabled=new yr({func:519,mask:0},0,0,Jc,Jc,Jc);class fr{constructor(l,f,g){this.enable=l,this.mode=f,this.frontFace=g}}let Ps;function Nl(x,l,f,g,b,k,E){const A=x.context,B=A.gl,G=x.useProgram("collisionBox"),X=[];let Y=0,de=0;for(let Le=0;Le<g.length;Le++){const je=g[Le],Qe=l.getTile(je),rt=Qe.getBucket(f);if(!rt)continue;let ot=je.posMatrix;b[0]===0&&b[1]===0||(ot=x.translatePosMatrix(je.posMatrix,Qe,b,k));const _t=E?rt.textCollisionBox:rt.iconCollisionBox,pt=rt.collisionCircleArray;if(pt.length>0){const At=a.F(),Dt=ot;a.aP(At,rt.placementInvProjMatrix,x.transform.glCoordMatrix),a.aP(At,At,rt.placementViewportMatrix),X.push({circleArray:pt,circleOffset:de,transform:Dt,invTransform:At,coord:je}),Y+=pt.length/4,de=Y}_t&&G.draw(A,B.LINES,qn.disabled,yr.disabled,x.colorModeForRenderPass(),fr.disabled,Fh(ot,x.transform,Qe),x.style.map.terrain&&x.style.map.terrain.getTerrainData(je),f.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,null,x.transform.zoom,null,null,_t.collisionVertexBuffer)}if(!E||!X.length)return;const Se=x.useProgram("collisionCircle"),ke=new a.aQ;ke.resize(4*Y),ke._trim();let Me=0;for(const Le of X)for(let je=0;je<Le.circleArray.length/4;je++){const Qe=4*je,rt=Le.circleArray[Qe+0],ot=Le.circleArray[Qe+1],_t=Le.circleArray[Qe+2],pt=Le.circleArray[Qe+3];ke.emplace(Me++,rt,ot,_t,pt,0),ke.emplace(Me++,rt,ot,_t,pt,1),ke.emplace(Me++,rt,ot,_t,pt,2),ke.emplace(Me++,rt,ot,_t,pt,3)}(!Ps||Ps.length<2*Y)&&(Ps=function(Le){const je=2*Le,Qe=new a.aS;Qe.resize(je),Qe._trim();for(let rt=0;rt<je;rt++){const ot=6*rt;Qe.uint16[ot+0]=4*rt+0,Qe.uint16[ot+1]=4*rt+1,Qe.uint16[ot+2]=4*rt+2,Qe.uint16[ot+3]=4*rt+2,Qe.uint16[ot+4]=4*rt+3,Qe.uint16[ot+5]=4*rt+0}return Qe}(Y));const ye=A.createIndexBuffer(Ps,!0),Re=A.createVertexBuffer(ke,a.aR.members,!0);for(const Le of X){const je={u_matrix:Le.transform,u_inv_matrix:Le.invTransform,u_camera_to_center_distance:(Je=x.transform).cameraToCenterDistance,u_viewport_size:[Je.width,Je.height]};Se.draw(A,B.TRIANGLES,qn.disabled,yr.disabled,x.colorModeForRenderPass(),fr.disabled,je,x.style.map.terrain&&x.style.map.terrain.getTerrainData(Le.coord),f.id,Re,ye,a.$.simpleSegment(0,2*Le.circleOffset,Le.circleArray.length,Le.circleArray.length/2),null,x.transform.zoom,null,null,null)}var Je;Re.destroy(),ye.destroy()}fr.disabled=new fr(!1,1029,2305),fr.backCCW=new fr(!0,1029,2305);const Yc=a.an(new Float32Array(16));function Xh(x,l,f,g,b,k){const{horizontalAlign:E,verticalAlign:A}=a.at(x);return new a.P((-(E-.5)*l/b+g[0])*k,(-(A-.5)*f/b+g[1])*k)}function jl(x,l,f,g,b,k,E,A,B,G,X){const Y=x.text.placedSymbolArray,de=x.text.dynamicLayoutVertexArray,Se=x.icon.dynamicLayoutVertexArray,ke={};de.clear();for(let Me=0;Me<Y.length;Me++){const ye=Y.get(Me),Re=ye.hidden||!ye.crossTileID||x.allowVerticalPlacement&&!ye.placedOrientation?null:g[ye.crossTileID];if(Re){const Je=new a.P(ye.anchorX,ye.anchorY),Le=_r(Je,f?E:k,X),je=Ce(b.cameraToCenterDistance,Le.signedDistanceFromCamera);let Qe=a.ai(x.textSizeData,B,ye)*je/a.ao;f&&(Qe*=x.tilePixelRatio/A);const{width:rt,height:ot,anchor:_t,textOffset:pt,textBoxScale:At}=Re,Dt=Xh(_t,rt,ot,pt,At,Qe),bn=f?_r(Je.add(Dt),k,X).point:Le.point.add(l?Dt.rotate(-b.angle):Dt),Ft=x.allowVerticalPlacement&&ye.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let pn=0;pn<ye.numGlyphs;pn++)a.aj(de,bn,Ft);G&&ye.associatedIconIndex>=0&&(ke[ye.associatedIconIndex]={shiftedAnchor:bn,angle:Ft})}else Ye(ye.numGlyphs,de)}if(G){Se.clear();const Me=x.icon.placedSymbolArray;for(let ye=0;ye<Me.length;ye++){const Re=Me.get(ye);if(Re.hidden)Ye(Re.numGlyphs,Se);else{const Je=ke[ye];if(Je)for(let Le=0;Le<Re.numGlyphs;Le++)a.aj(Se,Je.shiftedAnchor,Je.angle);else Ye(Re.numGlyphs,Se)}}x.icon.dynamicLayoutVertexBuffer.updateData(Se)}x.text.dynamicLayoutVertexBuffer.updateData(de)}function Ul(x,l,f){return f.iconsInText&&l?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function Vl(x,l,f,g,b,k,E,A,B,G,X,Y){const de=x.context,Se=de.gl,ke=x.transform,Me=A==="map",ye=B==="map",Re=A!=="viewport"&&f.layout.get("symbol-placement")!=="point",Je=Me&&!ye&&!Re,Le=!f.layout.get("symbol-sort-key").isConstant();let je=!1;const Qe=x.depthModeForSublayer(0,qn.ReadOnly),rt=f._unevaluatedLayout.hasValue("text-variable-anchor")||f._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ot=[];for(const _t of g){const pt=l.getTile(_t),At=pt.getBucket(f);if(!At)continue;const Dt=b?At.text:At.icon;if(!Dt||!Dt.segments.get().length||!Dt.hasVisibleVertices)continue;const bn=Dt.programConfigurations.get(f.id),Ft=b||At.sdfIcons,pn=b?At.textSizeData:At.iconSizeData,vn=ye||ke.pitch!==0,Zn=x.useProgram(Ul(Ft,b,At),bn),_n=a.ag(pn,ke.zoom),Sn=x.style.map.terrain&&x.style.map.terrain.getTerrainData(_t);let zn,$r,sr,Yi,ni=[0,0],Lr=null;if(b)$r=pt.glyphAtlasTexture,sr=Se.LINEAR,zn=pt.glyphAtlasTexture.size,At.iconsInText&&(ni=pt.imageAtlasTexture.size,Lr=pt.imageAtlasTexture,Yi=vn||x.options.rotating||x.options.zooming||pn.kind==="composite"||pn.kind==="camera"?Se.LINEAR:Se.NEAREST);else{const Hr=f.layout.get("icon-size").constantOr(0)!==1||At.iconsNeedLinear;$r=pt.imageAtlasTexture,sr=Ft||x.options.rotating||x.options.zooming||Hr||vn?Se.LINEAR:Se.NEAREST,zn=pt.imageAtlasTexture.size}const ri=dn(pt,1,x.transform.zoom),Qi=Gt(_t.posMatrix,ye,Me,x.transform,ri),Zo=Ci(_t.posMatrix,ye,Me,x.transform,ri),xs=rt&&At.hasTextData(),ll=f.layout.get("icon-text-fit")!=="none"&&xs&&At.hasIconData();if(Re){const Hr=x.style.map.terrain?(mo,Wr)=>x.style.map.terrain.getElevation(_t,mo,Wr):null,Ir=f.layout.get("text-rotation-alignment")==="map";se(At,_t.posMatrix,x,b,Qi,Zo,ye,G,Ir,Hr)}const ks=x.translatePosMatrix(_t.posMatrix,pt,k,E),Go=Re||b&&rt||ll?Yc:Qi,Gr=x.translatePosMatrix(Zo,pt,k,E,!0),Er=Ft&&f.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Cr;Cr=Ft?At.iconsInText?Wa(pn.kind,_n,Je,ye,x,ks,Go,Gr,zn,ni):Ha(pn.kind,_n,Je,ye,x,ks,Go,Gr,b,zn,!0):Ga(pn.kind,_n,Je,ye,x,ks,Go,Gr,b,zn);const po={program:Zn,buffers:Dt,uniformValues:Cr,atlasTexture:$r,atlasTextureIcon:Lr,atlasInterpolation:sr,atlasInterpolationIcon:Yi,isSDF:Ft,hasHalo:Er};if(Le&&At.canOverlap){je=!0;const Hr=Dt.segments.get();for(const Ir of Hr)ot.push({segments:new a.$([Ir]),sortKey:Ir.sortKey,state:po,terrainData:Sn})}else ot.push({segments:Dt.segments,sortKey:0,state:po,terrainData:Sn})}je&&ot.sort((_t,pt)=>_t.sortKey-pt.sortKey);for(const _t of ot){const pt=_t.state;if(de.activeTexture.set(Se.TEXTURE0),pt.atlasTexture.bind(pt.atlasInterpolation,Se.CLAMP_TO_EDGE),pt.atlasTextureIcon&&(de.activeTexture.set(Se.TEXTURE1),pt.atlasTextureIcon&&pt.atlasTextureIcon.bind(pt.atlasInterpolationIcon,Se.CLAMP_TO_EDGE)),pt.isSDF){const At=pt.uniformValues;pt.hasHalo&&(At.u_is_halo=1,Jh(pt.buffers,_t.segments,f,x,pt.program,Qe,X,Y,At,_t.terrainData)),At.u_is_halo=0}Jh(pt.buffers,_t.segments,f,x,pt.program,Qe,X,Y,pt.uniformValues,_t.terrainData)}}function Jh(x,l,f,g,b,k,E,A,B,G){const X=g.context;b.draw(X,X.gl.TRIANGLES,k,E,A,fr.disabled,B,G,f.id,x.layoutVertexBuffer,x.indexBuffer,l,f.paint,g.transform.zoom,x.programConfigurations.get(f.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function ql(x,l,f,g,b){if(!f||!g||!g.imageAtlas)return;const k=g.imageAtlas.patternPositions;let E=k[f.to.toString()],A=k[f.from.toString()];if(!E&&A&&(E=A),!A&&E&&(A=E),!E||!A){const B=b.getPaintProperty(l);E=k[B],A=k[B]}E&&A&&x.setConstantPatternPositions(E,A)}function Yh(x,l,f,g,b,k,E){const A=x.context.gl,B="fill-pattern",G=f.paint.get(B),X=G&&G.constantOr(1),Y=f.getCrossfadeParameters();let de,Se,ke,Me,ye;E?(Se=X&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",de=A.LINES):(Se=X?"fillPattern":"fill",de=A.TRIANGLES);const Re=G.constantOr(null);for(const Je of g){const Le=l.getTile(Je);if(X&&!Le.patternsLoaded())continue;const je=Le.getBucket(f);if(!je)continue;const Qe=je.programConfigurations.get(f.id),rt=x.useProgram(Se,Qe),ot=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Je);X&&(x.context.activeTexture.set(A.TEXTURE0),Le.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),Qe.updatePaintBuffers(Y)),ql(Qe,B,Re,Le,f);const _t=ot?Je:null,pt=x.translatePosMatrix(_t?_t.posMatrix:Je.posMatrix,Le,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor"));if(E){Me=je.indexBuffer2,ye=je.segments2;const At=[A.drawingBufferWidth,A.drawingBufferHeight];ke=Se==="fillOutlinePattern"&&X?Rh(pt,x,Y,Le,At):$d(pt,At)}else Me=je.indexBuffer,ye=je.segments,ke=X?Ll(pt,x,Y,Le):$h(pt);rt.draw(x.context,de,b,x.stencilModeForClipping(Je),k,fr.disabled,ke,ot,f.id,je.layoutVertexBuffer,Me,ye,f.paint,x.transform.zoom,Qe)}}function Zl(x,l,f,g,b,k,E){const A=x.context,B=A.gl,G="fill-extrusion-pattern",X=f.paint.get(G),Y=X.constantOr(1),de=f.getCrossfadeParameters(),Se=f.paint.get("fill-extrusion-opacity"),ke=X.constantOr(null);for(const Me of g){const ye=l.getTile(Me),Re=ye.getBucket(f);if(!Re)continue;const Je=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Me),Le=Re.programConfigurations.get(f.id),je=x.useProgram(Y?"fillExtrusionPattern":"fillExtrusion",Le);Y&&(x.context.activeTexture.set(B.TEXTURE0),ye.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Le.updatePaintBuffers(de)),ql(Le,G,ke,ye,f);const Qe=x.translatePosMatrix(Me.posMatrix,ye,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),rt=f.paint.get("fill-extrusion-vertical-gradient"),ot=Y?Dd(Qe,x,rt,Se,Me,de,ye):Va(Qe,x,rt,Se);je.draw(A,A.gl.TRIANGLES,b,k,E,fr.backCCW,ot,Je,f.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,f.paint,x.transform.zoom,Le,x.style.map.terrain&&Re.centroidVertexBuffer)}}function Gl(x,l,f,g,b,k,E){const A=x.context,B=A.gl,G=f.fbo;if(!G)return;const X=x.useProgram("hillshade"),Y=x.style.map.terrain&&x.style.map.terrain.getTerrainData(l);A.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get()),X.draw(A,B.TRIANGLES,b,k,E,fr.disabled,((de,Se,ke,Me)=>{const ye=ke.paint.get("hillshade-shadow-color"),Re=ke.paint.get("hillshade-highlight-color"),Je=ke.paint.get("hillshade-accent-color");let Le=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(Le-=de.transform.angle);const je=!de.options.moving;return{u_matrix:Me?Me.posMatrix:de.transform.calculatePosMatrix(Se.tileID.toUnwrapped(),je),u_image:0,u_latrange:Nh(0,Se.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Le],u_shadow:ye,u_highlight:Re,u_accent:Je}})(x,f,g,Y?l:null),Y,g.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}function Qc(x,l,f,g,b,k){const E=x.context,A=E.gl,B=l.dem;if(B&&B.data){const G=B.dim,X=B.stride,Y=B.getPixels();if(E.activeTexture.set(A.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||x.getTileTexture(X),l.demTexture){const Se=l.demTexture;Se.update(Y,{premultiply:!1}),Se.bind(A.NEAREST,A.CLAMP_TO_EDGE)}else l.demTexture=new Q(E,Y,A.RGBA,{premultiply:!1}),l.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE);E.activeTexture.set(A.TEXTURE0);let de=l.fbo;if(!de){const Se=new Q(E,{width:G,height:G,data:null},A.RGBA);Se.bind(A.LINEAR,A.CLAMP_TO_EDGE),de=l.fbo=E.createFramebuffer(G,G,!0,!1),de.colorAttachment.set(Se.texture)}E.bindFramebuffer.set(de.framebuffer),E.viewport.set([0,0,G,G]),x.useProgram("hillshadePrepare").draw(E,A.TRIANGLES,g,b,k,fr.disabled,((Se,ke)=>{const Me=ke.stride,ye=a.F();return a.aN(ye,0,a.W,-a.W,0,0,1),a.H(ye,ye,[0,-a.W,0]),{u_matrix:ye,u_image:1,u_dimension:[Me,Me],u_zoom:Se.overscaledZ,u_unpack:ke.getUnpackVector()}})(l.tileID,B),null,f.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Qh(x,l,f,g,b,k){const E=g.paint.get("raster-fade-duration");if(!k&&E>0){const A=y.now(),B=(A-x.timeAdded)/E,G=l?(A-l.timeAdded)/E:-1,X=f.getSource(),Y=b.coveringZoomLevel({tileSize:X.tileSize,roundZoom:X.roundZoom}),de=!l||Math.abs(l.tileID.overscaledZ-Y)>Math.abs(x.tileID.overscaledZ-Y),Se=de&&x.refreshedUponExpiration?1:a.ac(de?B:1-G,0,1);return x.refreshedUponExpiration&&B>=1&&(x.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Se}:{opacity:Se,mix:0}}return{opacity:1,mix:0}}const ef=new a.aO(1,0,0,1),Hl=new a.aO(0,1,0,1),eu=new a.aO(0,0,1,1),Wd=new a.aO(1,0,1,1),tf=new a.aO(0,1,1,1);function zr(x,l,f,g){Li(x,0,l+f/2,x.transform.width,f,g)}function ys(x,l,f,g){Li(x,l-f/2,0,f,x.transform.height,g)}function Li(x,l,f,g,b,k){const E=x.context,A=E.gl;A.enable(A.SCISSOR_TEST),A.scissor(l*x.pixelRatio,f*x.pixelRatio,g*x.pixelRatio,b*x.pixelRatio),E.clear({color:k}),A.disable(A.SCISSOR_TEST)}function tu(x,l,f){const g=x.context,b=g.gl,k=f.posMatrix,E=x.useProgram("debug"),A=qn.disabled,B=yr.disabled,G=x.colorModeForRenderPass(),X="$debug",Y=x.style.map.terrain&&x.style.map.terrain.getTerrainData(f);g.activeTexture.set(b.TEXTURE0);const de=l.getTileByID(f.key).latestRawTileData,Se=Math.floor((de&&de.byteLength||0)/1024),ke=l.getTile(f).tileSize,Me=512/Math.min(ke,512)*(f.overscaledZ/x.transform.zoom)*.5;let ye=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(ye+=` => ${f.overscaledZ}`),function(Re,Je){Re.initDebugOverlayCanvas();const Le=Re.debugOverlayCanvas,je=Re.context.gl,Qe=Re.debugOverlayCanvas.getContext("2d");Qe.clearRect(0,0,Le.width,Le.height),Qe.shadowColor="white",Qe.shadowBlur=2,Qe.lineWidth=1.5,Qe.strokeStyle="white",Qe.textBaseline="top",Qe.font="bold 36px Open Sans, sans-serif",Qe.fillText(Je,5,5),Qe.strokeText(Je,5,5),Re.debugOverlayTexture.update(Le),Re.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)}(x,`${ye} ${Se}kB`),E.draw(g,b.TRIANGLES,A,B,jr.alphaBlended,fr.disabled,Bh(k,a.aO.transparent,Me),null,X,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),E.draw(g,b.LINE_STRIP,A,B,G,fr.disabled,Bh(k,a.aO.red),Y,X,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function Wl(x,l,f){const g=x.context,b=g.gl,k=x.colorModeForRenderPass(),E=new qn(b.LEQUAL,qn.ReadWrite,x.depthRangeFor3D),A=x.useProgram("terrain"),B=l.getTerrainMesh();g.bindFramebuffer.set(null),g.viewport.set([0,0,x.width,x.height]);for(const G of f){const X=x.renderToTexture.getTexture(G),Y=l.getTerrainData(G.tileID);g.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,X.texture);const de={u_matrix:x.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(x.transform.zoom)};A.draw(g,b.TRIANGLES,E,yr.disabled,k,fr.backCCW,de,Y,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}class nf{constructor(l,f){this.context=new Hd(l),this.transform=f,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Rn.maxUnderzooming+Rn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new gs}resize(l,f,g){if(this.width=Math.floor(l*g),this.height=Math.floor(f*g),this.pixelRatio=g,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style._order)this.style._layers[b].resize()}setup(){const l=this.context,f=new a.aV;f.emplaceBack(0,0),f.emplaceBack(a.W,0),f.emplaceBack(0,a.W),f.emplaceBack(a.W,a.W),this.tileExtentBuffer=l.createVertexBuffer(f,Cl.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const g=new a.aV;g.emplaceBack(0,0),g.emplaceBack(a.W,0),g.emplaceBack(0,a.W),g.emplaceBack(a.W,a.W),this.debugBuffer=l.createVertexBuffer(g,Cl.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const b=new a.Z;b.emplaceBack(0,0,0,0),b.emplaceBack(a.W,0,a.W,0),b.emplaceBack(0,a.W,0,a.W),b.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=l.createVertexBuffer(b,et.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const k=new a.aV;k.emplaceBack(0,0),k.emplaceBack(1,0),k.emplaceBack(0,1),k.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(k,Cl.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const E=new a.aW;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(E);const A=new a.aX;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A);const B=this.context.gl;this.stencilClearMode=new yr({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)}clearStencil(){const l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const g=a.F();a.aN(g,0,this.width,this.height,0,0,1),a.J(g,g,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,qn.disabled,this.stencilClearMode,jr.disabled,fr.disabled,El(g),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,f){if(this.currentStencilSource===l.source||!l.isTileClipped()||!f||!f.length)return;this.currentStencilSource=l.source;const g=this.context,b=g.gl;this.nextStencilID+f.length>256&&this.clearStencil(),g.setColorMode(jr.disabled),g.setDepthMode(qn.disabled);const k=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of f){const A=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);k.draw(g,b.TRIANGLES,qn.disabled,new yr({func:b.ALWAYS,mask:0},A,255,b.KEEP,b.KEEP,b.REPLACE),jr.disabled,fr.disabled,El(E.posMatrix),B,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,f=this.context.gl;return new yr({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(l){const f=this.context.gl;return new yr({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(l){const f=this.context.gl,g=l.sort((E,A)=>A.overscaledZ-E.overscaledZ),b=g[g.length-1].overscaledZ,k=g[0].overscaledZ-b+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();const E={};for(let A=0;A<k;A++)E[A+b]=new yr({func:f.GEQUAL,mask:255},A+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=k,[E,g]}return[{[b]:yr.disabled},g]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new jr([l.CONSTANT_COLOR,l.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jr.unblended:jr.alphaBlended}depthModeForSublayer(l,f,g){if(!this.opaquePassEnabledForLayer())return qn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new qn(g||this.context.gl.LEQUAL,f,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,f){this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(y.now()),this.imageManager.beginFrame();const g=this.style._order,b=this.style.sourceCaches,k={},E={},A={};for(const B in b){const G=b[B];G.used&&G.prepare(this.context),k[B]=G.getVisibleCoordinates(),E[B]=k[B].slice().reverse(),A[B]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<g.length;B++)if(this.style._layers[g[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of g){const G=this.style._layers[B];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const X=E[G.source];(G.type==="custom"||X.length)&&this.renderLayer(this,b[G.source],G,X)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[g[this.currentLayer]],G=b[B.source],X=k[B.source];this._renderTileClippingMasks(B,X),this.renderLayer(this,G,B,X)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const B=this.style._layers[g[this.currentLayer]],G=b[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B))continue;const X=(B.type==="symbol"?A:E)[B.source];this._renderTileClippingMasks(B,k[B.source]),this.renderLayer(this,G,B,X)}if(this.options.showTileBoundaries){const B=function(G,X){let Y=null;const de=Object.values(G._layers).flatMap(ye=>ye.source&&!ye.isHidden(X)?[G.sourceCaches[ye.source]]:[]),Se=de.filter(ye=>ye.getSource().type==="vector"),ke=de.filter(ye=>ye.getSource().type!=="vector"),Me=ye=>{(!Y||Y.getSource().maxzoom<ye.getSource().maxzoom)&&(Y=ye)};return Se.forEach(ye=>Me(ye)),Y||ke.forEach(ye=>Me(ye)),Y}(this.style,this.transform.zoom);B&&function(G,X,Y){for(let de=0;de<Y.length;de++)tu(G,X,Y[de])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const G=B.transform.padding;zr(B,B.transform.height-(G.top||0),3,ef),zr(B,G.bottom||0,3,Hl),ys(B,G.left||0,3,eu),ys(B,B.transform.width-(G.right||0),3,Wd);const X=B.transform.centerPoint;(function(Y,de,Se,ke){Li(Y,de-1,Se-10,2,20,ke),Li(Y,de-10,Se-1,20,2,ke)})(B,X.x,B.transform.height-X.y,tf)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const f=this.terrainFacilitator.matrix,g=this.transform.projMatrix;let b=this.terrainFacilitator.dirty;b||(b=l?!a.aY(f,g):!a.aZ(f,g)),b||(b=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),b&&(a.a_(f,g),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(k,E){const A=k.context,B=A.gl,G=jr.unblended,X=new qn(B.LEQUAL,qn.ReadWrite,[0,1]),Y=E.getTerrainMesh(),de=E.sourceCache.getRenderableTiles(),Se=k.useProgram("terrainDepth");A.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),A.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),A.clear({color:a.aO.transparent,depth:1});for(const ke of de){const Me=E.getTerrainData(ke.tileID),ye={u_matrix:k.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(k.transform.zoom)};Se.draw(A,B.TRIANGLES,X,yr.disabled,G,fr.backCCW,ye,Me,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}A.bindFramebuffer.set(null),A.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain),function(k,E){const A=k.context,B=A.gl,G=jr.unblended,X=new qn(B.LEQUAL,qn.ReadWrite,[0,1]),Y=E.getTerrainMesh(),de=E.getCoordsTexture(),Se=E.sourceCache.getRenderableTiles(),ke=k.useProgram("terrainCoords");A.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),A.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),A.clear({color:a.aO.transparent,depth:1}),E.coordsIndex=[];for(const Me of Se){const ye=E.getTerrainData(Me.tileID);A.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,de.texture);const Re={u_matrix:k.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(k.transform.zoom)};ke.draw(A,B.TRIANGLES,X,yr.disabled,G,fr.backCCW,Re,ye,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),E.coordsIndex.push(Me.tileID.key)}A.bindFramebuffer.set(null),A.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain))}renderLayer(l,f,g,b){if(!g.isHidden(this.transform.zoom)&&(g.type==="background"||g.type==="custom"||(b||[]).length))switch(this.id=g.id,g.type){case"symbol":(function(k,E,A,B,G){if(k.renderPass!=="translucent")return;const X=yr.disabled,Y=k.colorModeForRenderPass();(A._unevaluatedLayout.hasValue("text-variable-anchor")||A._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(de,Se,ke,Me,ye,Re,Je){const Le=Se.transform,je=ye==="map",Qe=Re==="map";for(const rt of de){const ot=Me.getTile(rt),_t=ot.getBucket(ke);if(!_t||!_t.text||!_t.text.segments.get().length)continue;const pt=a.ag(_t.textSizeData,Le.zoom),At=dn(ot,1,Se.transform.zoom),Dt=Gt(rt.posMatrix,Qe,je,Se.transform,At),bn=ke.layout.get("icon-text-fit")!=="none"&&_t.hasIconData();if(pt){const Ft=Math.pow(2,Le.zoom-ot.tileID.overscaledZ);jl(_t,je,Qe,Je,Le,Dt,rt.posMatrix,Ft,pt,bn,Se.style.map.terrain?(pn,vn)=>Se.style.map.terrain.getElevation(rt,pn,vn):null)}}}(B,k,A,E,A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),G),A.paint.get("icon-opacity").constantOr(1)!==0&&Vl(k,E,A,B,!1,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),A.layout.get("icon-rotation-alignment"),A.layout.get("icon-pitch-alignment"),A.layout.get("icon-keep-upright"),X,Y),A.paint.get("text-opacity").constantOr(1)!==0&&Vl(k,E,A,B,!0,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),A.layout.get("text-rotation-alignment"),A.layout.get("text-pitch-alignment"),A.layout.get("text-keep-upright"),X,Y),E.map.showCollisionBoxes&&(Nl(k,E,A,B,A.paint.get("text-translate"),A.paint.get("text-translate-anchor"),!0),Nl(k,E,A,B,A.paint.get("icon-translate"),A.paint.get("icon-translate-anchor"),!1))})(l,f,g,b,this.style.placement.variableOffsets);break;case"circle":(function(k,E,A,B){if(k.renderPass!=="translucent")return;const G=A.paint.get("circle-opacity"),X=A.paint.get("circle-stroke-width"),Y=A.paint.get("circle-stroke-opacity"),de=!A.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(X.constantOr(1)===0||Y.constantOr(1)===0))return;const Se=k.context,ke=Se.gl,Me=k.depthModeForSublayer(0,qn.ReadOnly),ye=yr.disabled,Re=k.colorModeForRenderPass(),Je=[];for(let Le=0;Le<B.length;Le++){const je=B[Le],Qe=E.getTile(je),rt=Qe.getBucket(A);if(!rt)continue;const ot=rt.programConfigurations.get(A.id),_t=k.useProgram("circle",ot),pt=rt.layoutVertexBuffer,At=rt.indexBuffer,Dt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(je),bn={programConfiguration:ot,program:_t,layoutVertexBuffer:pt,indexBuffer:At,uniformValues:Rd(k,je,Qe,A),terrainData:Dt};if(de){const Ft=rt.segments.get();for(const pn of Ft)Je.push({segments:new a.$([pn]),sortKey:pn.sortKey,state:bn})}else Je.push({segments:rt.segments,sortKey:0,state:bn})}de&&Je.sort((Le,je)=>Le.sortKey-je.sortKey);for(const Le of Je){const{programConfiguration:je,program:Qe,layoutVertexBuffer:rt,indexBuffer:ot,uniformValues:_t,terrainData:pt}=Le.state;Qe.draw(Se,ke.TRIANGLES,Me,ye,Re,fr.disabled,_t,pt,A.id,rt,ot,Le.segments,A.paint,k.transform.zoom,je)}})(l,f,g,b);break;case"heatmap":(function(k,E,A,B){if(A.paint.get("heatmap-opacity")!==0)if(k.renderPass==="offscreen"){const G=k.context,X=G.gl,Y=yr.disabled,de=new jr([X.ONE,X.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(Se,ke,Me){const ye=Se.gl;Se.activeTexture.set(ye.TEXTURE1),Se.viewport.set([0,0,ke.width/4,ke.height/4]);let Re=Me.heatmapFbo;if(Re)ye.bindTexture(ye.TEXTURE_2D,Re.colorAttachment.get()),Se.bindFramebuffer.set(Re.framebuffer);else{const Je=ye.createTexture();ye.bindTexture(ye.TEXTURE_2D,Je),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_S,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_WRAP_T,ye.CLAMP_TO_EDGE),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MIN_FILTER,ye.LINEAR),ye.texParameteri(ye.TEXTURE_2D,ye.TEXTURE_MAG_FILTER,ye.LINEAR),Re=Me.heatmapFbo=Se.createFramebuffer(ke.width/4,ke.height/4,!1,!1),function(Le,je,Qe,rt){var ot,_t;const pt=Le.gl,At=(ot=Le.HALF_FLOAT)!==null&&ot!==void 0?ot:pt.UNSIGNED_BYTE,Dt=(_t=Le.RGBA16F)!==null&&_t!==void 0?_t:pt.RGBA;pt.texImage2D(pt.TEXTURE_2D,0,Dt,je.width/4,je.height/4,0,pt.RGBA,At,null),rt.colorAttachment.set(Qe)}(Se,ke,Je,Re)}})(G,k,A),G.clear({color:a.aO.transparent});for(let Se=0;Se<B.length;Se++){const ke=B[Se];if(E.hasRenderableParent(ke))continue;const Me=E.getTile(ke),ye=Me.getBucket(A);if(!ye)continue;const Re=ye.programConfigurations.get(A.id),Je=k.useProgram("heatmap",Re),{zoom:Le}=k.transform;Je.draw(G,X.TRIANGLES,qn.disabled,Y,de,fr.disabled,Oh(ke.posMatrix,Me,Le,A.paint.get("heatmap-intensity")),null,A.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,A.paint,k.transform.zoom,Re)}G.viewport.set([0,0,k.width,k.height])}else k.renderPass==="translucent"&&(k.context.setColorMode(k.colorModeForRenderPass()),function(G,X){const Y=G.context,de=Y.gl,Se=X.heatmapFbo;if(!Se)return;Y.activeTexture.set(de.TEXTURE0),de.bindTexture(de.TEXTURE_2D,Se.colorAttachment.get()),Y.activeTexture.set(de.TEXTURE1);let ke=X.colorRampTexture;ke||(ke=X.colorRampTexture=new Q(Y,X.colorRamp,de.RGBA)),ke.bind(de.LINEAR,de.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(Y,de.TRIANGLES,qn.disabled,yr.disabled,G.colorModeForRenderPass(),fr.disabled,((Me,ye,Re,Je)=>{const Le=a.F();a.aN(Le,0,Me.width,Me.height,0,0,1);const je=Me.context.gl;return{u_matrix:Le,u_world:[je.drawingBufferWidth,je.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ye.paint.get("heatmap-opacity")}})(G,X),null,X.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,X.paint,G.transform.zoom)}(k,A))})(l,f,g,b);break;case"line":(function(k,E,A,B){if(k.renderPass!=="translucent")return;const G=A.paint.get("line-opacity"),X=A.paint.get("line-width");if(G.constantOr(1)===0||X.constantOr(1)===0)return;const Y=k.depthModeForSublayer(0,qn.ReadOnly),de=k.colorModeForRenderPass(),Se=A.paint.get("line-dasharray"),ke=A.paint.get("line-pattern"),Me=ke.constantOr(1),ye=A.paint.get("line-gradient"),Re=A.getCrossfadeParameters(),Je=Me?"linePattern":Se?"lineSDF":ye?"lineGradient":"line",Le=k.context,je=Le.gl;let Qe=!0;for(const rt of B){const ot=E.getTile(rt);if(Me&&!ot.patternsLoaded())continue;const _t=ot.getBucket(A);if(!_t)continue;const pt=_t.programConfigurations.get(A.id),At=k.context.program.get(),Dt=k.useProgram(Je,pt),bn=Qe||Dt.program!==At,Ft=k.style.map.terrain&&k.style.map.terrain.getTerrainData(rt),pn=ke.constantOr(null);if(pn&&ot.imageAtlas){const _n=ot.imageAtlas,Sn=_n.patternPositions[pn.to.toString()],zn=_n.patternPositions[pn.from.toString()];Sn&&zn&&pt.setConstantPatternPositions(Sn,zn)}const vn=Ft?rt:null,Zn=Me?Es(k,ot,A,Re,vn):Se?Al(k,ot,A,Se,Re,vn):ye?jh(k,ot,A,_t.lineClipsArray.length,vn):Il(k,ot,A,vn);if(Me)Le.activeTexture.set(je.TEXTURE0),ot.imageAtlasTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE),pt.updatePaintBuffers(Re);else if(Se&&(bn||k.lineAtlas.dirty))Le.activeTexture.set(je.TEXTURE0),k.lineAtlas.bind(Le);else if(ye){const _n=_t.gradients[A.id];let Sn=_n.texture;if(A.gradientVersion!==_n.version){let zn=256;if(A.stepInterpolant){const $r=E.getSource().maxzoom,sr=rt.canonical.z===$r?Math.ceil(1<<k.transform.maxZoom-rt.canonical.z):1;zn=a.ac(a.aT(_t.maxLineLength/a.W*1024*sr),256,Le.maxTextureSize)}_n.gradient=a.aU({expression:A.gradientExpression(),evaluationKey:"lineProgress",resolution:zn,image:_n.gradient||void 0,clips:_t.lineClipsArray}),_n.texture?_n.texture.update(_n.gradient):_n.texture=new Q(Le,_n.gradient,je.RGBA),_n.version=A.gradientVersion,Sn=_n.texture}Le.activeTexture.set(je.TEXTURE0),Sn.bind(A.stepInterpolant?je.NEAREST:je.LINEAR,je.CLAMP_TO_EDGE)}Dt.draw(Le,je.TRIANGLES,Y,k.stencilModeForClipping(rt),de,fr.disabled,Zn,Ft,A.id,_t.layoutVertexBuffer,_t.indexBuffer,_t.segments,A.paint,k.transform.zoom,pt,_t.layoutVertexBuffer2),Qe=!1}})(l,f,g,b);break;case"fill":(function(k,E,A,B){const G=A.paint.get("fill-color"),X=A.paint.get("fill-opacity");if(X.constantOr(1)===0)return;const Y=k.colorModeForRenderPass(),de=A.paint.get("fill-pattern"),Se=k.opaquePassEnabledForLayer()&&!de.constantOr(1)&&G.constantOr(a.aO.transparent).a===1&&X.constantOr(0)===1?"opaque":"translucent";if(k.renderPass===Se){const ke=k.depthModeForSublayer(1,k.renderPass==="opaque"?qn.ReadWrite:qn.ReadOnly);Yh(k,E,A,B,ke,Y,!1)}if(k.renderPass==="translucent"&&A.paint.get("fill-antialias")){const ke=k.depthModeForSublayer(A.getPaintProperty("fill-outline-color")?2:0,qn.ReadOnly);Yh(k,E,A,B,ke,Y,!0)}})(l,f,g,b);break;case"fill-extrusion":(function(k,E,A,B){const G=A.paint.get("fill-extrusion-opacity");if(G!==0&&k.renderPass==="translucent"){const X=new qn(k.context.gl.LEQUAL,qn.ReadWrite,k.depthRangeFor3D);if(G!==1||A.paint.get("fill-extrusion-pattern").constantOr(1))Zl(k,E,A,B,X,yr.disabled,jr.disabled),Zl(k,E,A,B,X,k.stencilModeFor3D(),k.colorModeForRenderPass());else{const Y=k.colorModeForRenderPass();Zl(k,E,A,B,X,yr.disabled,Y)}}})(l,f,g,b);break;case"hillshade":(function(k,E,A,B){if(k.renderPass!=="offscreen"&&k.renderPass!=="translucent")return;const G=k.context,X=k.depthModeForSublayer(0,qn.ReadOnly),Y=k.colorModeForRenderPass(),[de,Se]=k.renderPass==="translucent"?k.stencilConfigForOverlap(B):[{},B];for(const ke of Se){const Me=E.getTile(ke);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&k.renderPass==="offscreen"?Qc(k,Me,A,X,yr.disabled,Y):k.renderPass==="translucent"&&Gl(k,ke,Me,A,X,de[ke.overscaledZ],Y)}G.viewport.set([0,0,k.width,k.height])})(l,f,g,b);break;case"raster":(function(k,E,A,B){if(k.renderPass!=="translucent"||A.paint.get("raster-opacity")===0||!B.length)return;const G=k.context,X=G.gl,Y=E.getSource(),de=k.useProgram("raster"),Se=k.colorModeForRenderPass(),[ke,Me]=Y instanceof Kt?[{},B]:k.stencilConfigForOverlap(B),ye=Me[Me.length-1].overscaledZ,Re=!k.options.moving;for(const Je of Me){const Le=k.depthModeForSublayer(Je.overscaledZ-ye,A.paint.get("raster-opacity")===1?qn.ReadWrite:qn.ReadOnly,X.LESS),je=E.getTile(Je);je.registerFadeDuration(A.paint.get("raster-fade-duration"));const Qe=E.findLoadedParent(Je,0),rt=Qh(je,Qe,E,A,k.transform,k.style.map.terrain);let ot,_t;const pt=A.paint.get("raster-resampling")==="nearest"?X.NEAREST:X.LINEAR;G.activeTexture.set(X.TEXTURE0),je.texture.bind(pt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),G.activeTexture.set(X.TEXTURE1),Qe?(Qe.texture.bind(pt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST),ot=Math.pow(2,Qe.tileID.overscaledZ-je.tileID.overscaledZ),_t=[je.tileID.canonical.x*ot%1,je.tileID.canonical.y*ot%1]):je.texture.bind(pt,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST);const At=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Je),Dt=At?Je:null,bn=Dt?Dt.posMatrix:k.transform.calculatePosMatrix(Je.toUnwrapped(),Re),Ft=Pl(bn,_t||[0,0],ot||1,rt,A);Y instanceof Kt?de.draw(G,X.TRIANGLES,Le,yr.disabled,Se,fr.disabled,Ft,At,A.id,Y.boundsBuffer,k.quadTriangleIndexBuffer,Y.boundsSegments):de.draw(G,X.TRIANGLES,Le,ke[Je.overscaledZ],Se,fr.disabled,Ft,At,A.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}})(l,f,g,b);break;case"background":(function(k,E,A,B){const G=A.paint.get("background-color"),X=A.paint.get("background-opacity");if(X===0)return;const Y=k.context,de=Y.gl,Se=k.transform,ke=Se.tileSize,Me=A.paint.get("background-pattern");if(k.isPatternMissing(Me))return;const ye=!Me&&G.a===1&&X===1&&k.opaquePassEnabledForLayer()?"opaque":"translucent";if(k.renderPass!==ye)return;const Re=yr.disabled,Je=k.depthModeForSublayer(0,ye==="opaque"?qn.ReadWrite:qn.ReadOnly),Le=k.colorModeForRenderPass(),je=k.useProgram(Me?"backgroundPattern":"background"),Qe=B||Se.coveringTiles({tileSize:ke,terrain:k.style.map.terrain});Me&&(Y.activeTexture.set(de.TEXTURE0),k.imageManager.bind(k.context));const rt=A.getCrossfadeParameters();for(const ot of Qe){const _t=B?ot.posMatrix:k.transform.calculatePosMatrix(ot.toUnwrapped()),pt=Me?Bd(_t,X,k,Me,{tileID:ot,tileSize:ke},rt):Fd(_t,X,G),At=k.style.map.terrain&&k.style.map.terrain.getTerrainData(ot);je.draw(Y,de.TRIANGLES,Je,Re,Le,fr.disabled,pt,At,A.id,k.tileExtentBuffer,k.quadTriangleIndexBuffer,k.tileExtentSegments)}})(l,0,g,b);break;case"custom":(function(k,E,A){const B=k.context,G=A.implementation;if(k.renderPass==="offscreen"){const X=G.prerender;X&&(k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),X.call(G,B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState())}else if(k.renderPass==="translucent"){k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),B.setStencilMode(yr.disabled);const X=G.renderingMode==="3d"?new qn(k.context.gl.LEQUAL,qn.ReadWrite,k.depthRangeFor3D):k.depthModeForSublayer(0,qn.ReadOnly);B.setDepthMode(X),G.render(B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState(),B.bindFramebuffer.set(null)}})(l,0,g)}}translatePosMatrix(l,f,g,b,k){if(!g[0]&&!g[1])return l;const E=k?b==="map"?this.transform.angle:0:b==="viewport"?-this.transform.angle:0;if(E){const G=Math.sin(E),X=Math.cos(E);g=[g[0]*X-g[1]*G,g[0]*G+g[1]*X]}const A=[k?g[0]:dn(f,g[0],this.transform.zoom),k?g[1]:dn(f,g[1],this.transform.zoom),0],B=new Float32Array(16);return a.H(B,l,A),B}saveTileTexture(l){const f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const f=this._tileTextures[l];return f&&f.length>0?f.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const f=this.imageManager.getPattern(l.from.toString()),g=this.imageManager.getPattern(l.to.toString());return!f||!g}useProgram(l,f){this.cache=this.cache||{};const g=l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[g]||(this.cache[g]=new _s(this.context,Ua[l],f,Uh[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[g]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Q(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:f}=this.context.gl;return this.width!==l||this.height!==f}}class bs{constructor(l,f){this.points=l,this.planes=f}static fromInvProjectionMatrix(l,f,g){const b=Math.pow(2,g),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(A=>{const B=1/(A=a.af([],A,l))[3]/f*b;return a.a$(A,A,[B,B,1/A[3],B])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(A=>{const B=function(de,Se){var ke=Se[0],Me=Se[1],ye=Se[2],Re=ke*ke+Me*Me+ye*ye;return Re>0&&(Re=1/Math.sqrt(Re)),de[0]=Se[0]*Re,de[1]=Se[1]*Re,de[2]=Se[2]*Re,de}([],function(de,Se,ke){var Me=Se[0],ye=Se[1],Re=Se[2],Je=ke[0],Le=ke[1],je=ke[2];return de[0]=ye*je-Re*Le,de[1]=Re*Je-Me*je,de[2]=Me*Le-ye*Je,de}([],ee([],k[A[0]],k[A[1]]),ee([],k[A[2]],k[A[1]]))),G=-((X=B)[0]*(Y=k[A[1]])[0]+X[1]*Y[1]+X[2]*Y[2]);var X,Y;return B.concat(G)});return new bs(k,E)}}class vs{constructor(l,f){this.min=l,this.max=f,this.center=function(g,b,k){return g[0]=.5*b[0],g[1]=.5*b[1],g[2]=.5*b[2],g}([],function(g,b,k){return g[0]=b[0]+k[0],g[1]=b[1]+k[1],g[2]=b[2]+k[2],g}([],this.min,this.max))}quadrant(l){const f=[l%2==0,l<2],g=oe(this.min),b=oe(this.max);for(let k=0;k<f.length;k++)g[k]=f[k]?this.min[k]:this.center[k],b[k]=f[k]?this.center[k]:this.max[k];return b[2]=this.max[2],new vs(g,b)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const f=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let g=!0;for(let b=0;b<l.planes.length;b++){const k=l.planes[b];let E=0;for(let A=0;A<f.length;A++)a.b0(k,f[A])>=0&&E++;if(E===0)return 0;E!==f.length&&(g=!1)}if(g)return 2;for(let b=0;b<3;b++){let k=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let A=0;A<l.points.length;A++){const B=l.points[A][b]-this.min[b];k=Math.min(k,B),E=Math.max(E,B)}if(E<0||k>this.max[b]-this.min[b])return 0}return 1}}class ca{constructor(l=0,f=0,g=0,b=0){if(isNaN(l)||l<0||isNaN(f)||f<0||isNaN(g)||g<0||isNaN(b)||b<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=g,this.right=b}interpolate(l,f,g){return f.top!=null&&l.top!=null&&(this.top=a.z.number(l.top,f.top,g)),f.bottom!=null&&l.bottom!=null&&(this.bottom=a.z.number(l.bottom,f.bottom,g)),f.left!=null&&l.left!=null&&(this.left=a.z.number(l.left,f.left,g)),f.right!=null&&l.right!=null&&(this.right=a.z.number(l.right,f.right,g)),this}getCenter(l,f){const g=a.ac((this.left+l-this.right)/2,0,l),b=a.ac((this.top+f-this.bottom)/2,0,f);return new a.P(g,b)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const nu=85.051129;class Kl{constructor(l,f,g,b,k){this.tileSize=512,this._renderWorldCopies=k===void 0||!!k,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=g??0,this._maxPitch=b??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ca,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new Kl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const f=-a.b1(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=function(){var g=new a.A(4);return a.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}(),function(g,b,k){var E=b[0],A=b[1],B=b[2],G=b[3],X=Math.sin(k),Y=Math.cos(k);g[0]=E*Y+B*X,g[1]=A*Y+G*X,g[2]=E*-X+B*Y,g[3]=A*-X+G*Y}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const f=a.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.tileZoom=Math.max(0,Math.floor(f)),this.scale=this.zoomScale(f),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,f,g){this._unmodified=!1,this._edgeInsets.interpolate(l,f,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(l){const f=[new a.b2(0,l)];if(this._renderWorldCopies){const g=this.pointCoordinate(new a.P(0,0)),b=this.pointCoordinate(new a.P(this.width,0)),k=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),A=Math.floor(Math.min(g.x,b.x,k.x,E.x)),B=Math.floor(Math.max(g.x,b.x,k.x,E.x)),G=1;for(let X=A-G;X<=B+G;X++)X!==0&&f.push(new a.b2(X,l))}return f}coveringTiles(l){var f,g;let b=this.coveringZoomLevel(l);const k=b;if(l.minzoom!==void 0&&b<l.minzoom)return[];l.maxzoom!==void 0&&b>l.maxzoom&&(b=l.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),A=a.Y.fromLngLat(this.center),B=Math.pow(2,b),G=[B*E.x,B*E.y,0],X=[B*A.x,B*A.y,0],Y=bs.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,b);let de=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(de=b);const Se=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,ke=Le=>({aabb:new vs([Le*B,0,0],[(Le+1)*B,B,0]),zoom:0,x:0,y:0,wrap:Le,fullyVisible:!1}),Me=[],ye=[],Re=b,Je=l.reparseOverscaled?k:b;if(this._renderWorldCopies)for(let Le=1;Le<=3;Le++)Me.push(ke(-Le)),Me.push(ke(Le));for(Me.push(ke(0));Me.length>0;){const Le=Me.pop(),je=Le.x,Qe=Le.y;let rt=Le.fullyVisible;if(!rt){const Dt=Le.aabb.intersects(Y);if(Dt===0)continue;rt=Dt===2}const ot=l.terrain?G:X,_t=Le.aabb.distanceX(ot),pt=Le.aabb.distanceY(ot),At=Math.max(Math.abs(_t),Math.abs(pt));if(Le.zoom===Re||At>Se+(1<<Re-Le.zoom)-2&&Le.zoom>=de){const Dt=Re-Le.zoom,bn=G[0]-.5-(je<<Dt),Ft=G[1]-.5-(Qe<<Dt);ye.push({tileID:new a.Q(Le.zoom===Re?Je:Le.zoom,Le.wrap,Le.zoom,je,Qe),distanceSq:pe([X[0]-.5-je,X[1]-.5-Qe]),tileDistanceToCamera:Math.sqrt(bn*bn+Ft*Ft)})}else for(let Dt=0;Dt<4;Dt++){const bn=(je<<1)+Dt%2,Ft=(Qe<<1)+(Dt>>1),pn=Le.zoom+1;let vn=Le.aabb.quadrant(Dt);if(l.terrain){const Zn=new a.Q(pn,Le.wrap,pn,bn,Ft),_n=l.terrain.getMinMaxElevation(Zn),Sn=(f=_n.minElevation)!==null&&f!==void 0?f:this.elevation,zn=(g=_n.maxElevation)!==null&&g!==void 0?g:this.elevation;vn=new vs([vn.min[0],vn.min[1],Sn],[vn.max[0],vn.max[1],zn])}Me.push({aabb:vn,zoom:pn,x:bn,y:Ft,wrap:Le.wrap,fullyVisible:rt})}}return ye.sort((Le,je)=>Le.distanceSq-je.distanceSq).map(Le=>Le.tileID)}resize(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const f=a.ac(l.lat,-85.051129,nu);return new a.P(a.N(l.lng)*this.worldSize,a.O(f)*this.worldSize)}unproject(l){return new a.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const f=this.elevation,g=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,b=this.pointLocation(this.centerPoint,l),k=l.getElevationForLngLatZoom(b,this.tileZoom);if(!(this.elevation-k))return;const E=g+f-k,A=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b3(1,b.lat),B=this.scaleZoom(A/this.tileSize);this._elevation=k,this._center=b,this.zoom=B}setLocationAtPoint(l,f){const g=this.pointCoordinate(f),b=this.pointCoordinate(this.centerPoint),k=this.locationCoordinate(l),E=new a.Y(k.x-(g.x-b.x),k.y-(g.y-b.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,f){return f?this.coordinatePoint(this.locationCoordinate(l),f.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,f){return this.coordinateLocation(this.pointCoordinate(l,f))}locationCoordinate(l){return a.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,f){if(f){const de=f.pointCoordinate(l);if(de!=null)return de}const g=[l.x,l.y,0,1],b=[l.x,l.y,1,1];a.af(g,g,this.pixelMatrixInverse),a.af(b,b,this.pixelMatrixInverse);const k=g[3],E=b[3],A=g[1]/k,B=b[1]/E,G=g[2]/k,X=b[2]/E,Y=G===X?0:(0-G)/(X-G);return new a.Y(a.z.number(g[0]/k,b[0]/E,Y)/this.worldSize,a.z.number(A,B,Y)/this.worldSize)}coordinatePoint(l,f=0,g=this.pixelMatrix){const b=[l.x*this.worldSize,l.y*this.worldSize,f,1];return a.af(b,b,g),new a.P(b[0]/b[3],b[1]/b[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new Ve().extend(this.pointLocation(new a.P(0,l))).extend(this.pointLocation(new a.P(this.width,l))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ve([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,nu])}calculatePosMatrix(l,f=!1){const g=l.key,b=f?this._alignedPosMatrixCache:this._posMatrixCache;if(b[g])return b[g];const k=l.canonical,E=this.worldSize/this.zoomScale(k.z),A=k.x+Math.pow(2,k.z)*l.wrap,B=a.an(new Float64Array(16));return a.H(B,B,[A*E,k.y*E,0]),a.J(B,B,[E/a.W,E/a.W,1]),a.K(B,f?this.alignedProjMatrix:this.projMatrix,B),b[g]=new Float32Array(B),b[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,f){f=a.ac(+f,this.minZoom,this.maxZoom);const g={center:new a.M(l.lng,l.lat),zoom:f};let b=this.lngRange;if(!this._renderWorldCopies&&b===null){const Le=179.9999999999;b=[-Le,Le]}const k=this.tileSize*this.zoomScale(g.zoom);let E=0,A=k,B=0,G=k,X=0,Y=0;const{x:de,y:Se}=this.size;if(this.latRange){const Le=this.latRange;E=a.O(Le[1])*k,A=a.O(Le[0])*k,A-E<Se&&(X=Se/(A-E))}b&&(B=a.b1(a.N(b[0])*k,0,k),G=a.b1(a.N(b[1])*k,0,k),G<B&&(G+=k),G-B<de&&(Y=de/(G-B)));const{x:ke,y:Me}=this.project.call({worldSize:k},l);let ye,Re;const Je=Math.max(Y||0,X||0);if(Je){const Le=new a.P(Y?(G+B)/2:ke,X?(A+E)/2:Me);return g.center=this.unproject.call({worldSize:k},Le).wrap(),g.zoom+=this.scaleZoom(Je),g}if(this.latRange){const Le=Se/2;Me-Le<E&&(Re=E+Le),Me+Le>A&&(Re=A-Le)}if(b){const Le=(B+G)/2;let je=ke;this._renderWorldCopies&&(je=a.b1(ke,Le-k/2,Le+k/2));const Qe=de/2;je-Qe<B&&(ye=B+Qe),je+Qe>G&&(ye=G-Qe)}if(ye!==void 0||Re!==void 0){const Le=new a.P(ye??ke,Re??Me);g.center=this.unproject.call({worldSize:k},Le).wrap()}return g}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:f,zoom:g}=this.getConstrained(this.center,this.zoom);this.center=f,this.zoom=g,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,f=this.point.x,g=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let b=a.an(new Float64Array(16));a.J(b,b,[this.width/2,-this.height/2,1]),a.H(b,b,[1,-1,0]),this.labelPlaneMatrix=b,b=a.an(new Float64Array(16)),a.J(b,b,[1,-1,1]),a.H(b,b,[-1,-1,0]),a.J(b,b,[2/this.width,2/this.height,1]),this.glCoordMatrix=b;const k=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),A=k-E*this._pixelPerMeter/Math.cos(this._pitch),B=E<0?A:k,G=Math.PI/2+this._pitch,X=this._fov*(.5+l.y/this.height),Y=Math.sin(X)*B/Math.sin(a.ac(Math.PI-G-X,.01,Math.PI-.01)),de=this.getHorizon(),Se=2*Math.atan(de/this.cameraToCenterDistance)*(.5+l.y/(2*de)),ke=Math.sin(Se)*B/Math.sin(a.ac(Math.PI-G-Se,.01,Math.PI-.01)),Me=Math.min(Y,ke),ye=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+B),Re=this.height/50;b=new Float64Array(16),a.b4(b,this._fov,this.width/this.height,Re,ye),b[8]=2*-l.x/this.width,b[9]=2*l.y/this.height,a.J(b,b,[1,-1,1]),a.H(b,b,[0,0,-this.cameraToCenterDistance]),a.b5(b,b,this._pitch),a.ad(b,b,this.angle),a.H(b,b,[-f,-g,0]),this.mercatorMatrix=a.J([],b,[this.worldSize,this.worldSize,this.worldSize]),a.J(b,b,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,b),a.H(b,b,[0,0,-this.elevation]),this.projMatrix=b,this.invProjMatrix=a.ar([],b),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,b);const Je=this.width%2/2,Le=this.height%2/2,je=Math.cos(this.angle),Qe=Math.sin(this.angle),rt=f-Math.round(f)+je*Je+Qe*Le,ot=g-Math.round(g)+je*Le+Qe*Je,_t=new Float64Array(b);if(a.H(_t,_t,[rt>.5?rt-1:rt,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=_t,b=a.ar(new Float64Array(16),this.pixelMatrix),!b)throw new Error("failed to invert matrix");this.pixelMatrixInverse=b,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new a.P(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return a.af(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,l))}getCameraQueryGeometry(l){const f=this.getCameraPoint();if(l.length===1)return[l[0],f];{let g=f.x,b=f.y,k=f.x,E=f.y;for(const A of l)g=Math.min(g,A.x),b=Math.min(b,A.y),k=Math.max(k,A.x),E=Math.max(E,A.y);return[new a.P(g,b),new a.P(k,b),new a.P(k,E),new a.P(g,E),new a.P(g,b)]}}lngLatToCameraDepth(l,f){const g=this.locationCoordinate(l),b=[g.x*this.worldSize,g.y*this.worldSize,f,1];return a.af(b,b,this.projMatrix),b[2]/b[3]}}function ru(x,l){let f,g=!1,b=null,k=null;const E=()=>{b=null,g&&(x.apply(k,f),b=setTimeout(E,l),g=!1)};return(...A)=>(g=!0,k=this,f=A,b||E(),b)}class iu{constructor(l){this._getCurrentHash=()=>{const f=window.location.hash.replace("#","");if(this._hashName){let g;return f.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(g=b)}),(g&&g[1]||"").split("/")}return f.split("/")},this._onHashChange=()=>{const f=this._getCurrentHash();if(f.length>=3&&!f.some(g=>isNaN(g))){const g=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(f[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:g,pitch:+(f[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const f=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,f)}catch{}},this._updateHash=ru(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const f=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,b=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),k=Math.pow(10,b),E=Math.round(f.lng*k)/k,A=Math.round(f.lat*k)/k,B=this._map.getBearing(),G=this._map.getPitch();let X="";if(X+=l?`/${E}/${A}/${g}`:`${g}/${A}/${E}`,(B||G)&&(X+="/"+Math.round(10*B)/10),G&&(X+=`/${Math.round(G)}`),this._hashName){const Y=this._hashName;let de=!1;const Se=window.location.hash.slice(1).split("&").map(ke=>{const Me=ke.split("=")[0];return Me===Y?(de=!0,`${Me}=${X}`):ke}).filter(ke=>ke);return de||Se.push(`${Y}=${X}`),`#${Se.join("&")}`}return`#${X}`}}const Xa={linearity:.3,easing:a.b6(0,0,.3,1)},zs=a.e({deceleration:2500,maxSpeed:1400},Xa),rf=a.e({deceleration:20,maxSpeed:1400},Xa),of=a.e({deceleration:1e3,maxSpeed:360},Xa),sf=a.e({deceleration:1e3,maxSpeed:90},Xa);class af{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:y.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,f=y.now();for(;l.length>0&&f-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const f={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:k}of this._inertiaBuffer)f.zoom+=k.zoomDelta||0,f.bearing+=k.bearingDelta||0,f.pitch+=k.pitchDelta||0,k.panDelta&&f.pan._add(k.panDelta),k.around&&(f.around=k.around),k.pinchAround&&(f.pinchAround=k.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,b={};if(f.pan.mag()){const k=Ya(f.pan.mag(),g,a.e({},zs,l||{}));b.offset=f.pan.mult(k.amount/f.pan.mag()),b.center=this._map.transform.center,Ja(b,k)}if(f.zoom){const k=Ya(f.zoom,g,rf);b.zoom=this._map.transform.zoom+k.amount,Ja(b,k)}if(f.bearing){const k=Ya(f.bearing,g,of);b.bearing=this._map.transform.bearing+a.ac(k.amount,-179,179),Ja(b,k)}if(f.pitch){const k=Ya(f.pitch,g,sf);b.pitch=this._map.transform.pitch+k.amount,Ja(b,k)}if(b.zoom||b.bearing){const k=f.pinchAround===void 0?f.around:f.pinchAround;b.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),a.e(b,{noMoveStart:!0})}}function Ja(x,l){(!x.duration||x.duration<l.duration)&&(x.duration=l.duration,x.easing=l.easing)}function Ya(x,l,f){const{maxSpeed:g,linearity:b,deceleration:k}=f,E=a.ac(x*b/(l/1e3),-g,g),A=Math.abs(E)/(k*b);return{easing:f.easing,duration:1e3*A,amount:E*(A/2)}}class Ri extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,g,b={}){const k=w.mousePos(f.getCanvas(),g),E=f.unproject(k);super(l,a.e({point:k,lngLat:E,originalEvent:g},b)),this._defaultPrevented=!1,this.target=f}}class Uo extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,g){const b=l==="touchend"?g.changedTouches:g.touches,k=w.touchPos(f.getCanvasContainer(),b),E=k.map(B=>f.unproject(B)),A=k.reduce((B,G,X,Y)=>B.add(G.div(Y.length)),new a.P(0,0));super(l,{points:k,point:A,lngLats:E,lngLat:f.unproject(A),originalEvent:g}),this._defaultPrevented=!1}}class ou extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,f,g){super(l,{originalEvent:g}),this._defaultPrevented=!1}}class vo{constructor(l,f){this._map=l,this._clickTolerance=f.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new ou(l.type,this._map,l))}mousedown(l,f){return this._mousedownPos=f,this._firePreventable(new Ri(l.type,this._map,l))}mouseup(l){this._map.fire(new Ri(l.type,this._map,l))}click(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new Ri(l.type,this._map,l))}dblclick(l){return this._firePreventable(new Ri(l.type,this._map,l))}mouseover(l){this._map.fire(new Ri(l.type,this._map,l))}mouseout(l){this._map.fire(new Ri(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Uo(l.type,this._map,l))}touchmove(l){this._map.fire(new Uo(l.type,this._map,l))}touchend(l){this._map.fire(new Uo(l.type,this._map,l))}touchcancel(l){this._map.fire(new Uo(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vo{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new Ri(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ri("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new Ri(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ua{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(a.P.convert(l),this._map.terrain)}}class wo{constructor(l,f){this._map=l,this._tr=new ua(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(w.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(l,f){if(!this._active)return;const g=f;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const b=this._startPos;this._lastPos=g,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const k=Math.min(b.x,g.x),E=Math.max(b.x,g.x),A=Math.min(b.y,g.y),B=Math.max(b.y,g.y);w.setTransform(this._box,`translate(${k}px,${A}px)`),this._box.style.width=E-k+"px",this._box.style.height=B-A+"px"}mouseupWindow(l,f){if(!this._active||l.button!==0)return;const g=this._startPos,b=f;if(this.reset(),w.suppressClick(),g.x!==b.x||g.y!==b.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:l})),{cameraAnimation:k=>k.fitScreenCoordinates(g,b,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,f){return this._map.fire(new a.k(l,{originalEvent:f}))}}function Ds(x,l){if(x.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${l.length}`);const f={};for(let g=0;g<x.length;g++)f[x[g].identifier]=l[g];return f}class Kd{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,f,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),g.length===this.numTouches&&(this.centroid=function(b){const k=new a.P(0,0);for(const E of b)k._add(E);return k.div(b.length)}(f),this.touches=Ds(g,f)))}touchmove(l,f,g){if(this.aborted||!this.centroid)return;const b=Ds(g,f);for(const k in this.touches){const E=b[k];(!E||E.dist(this.touches[k])>30)&&(this.aborted=!0)}}touchend(l,f,g){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const b=!this.aborted&&this.centroid;if(this.reset(),b)return b}}}class su{constructor(l){this.singleTap=new Kd(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,f,g){this.singleTap.touchstart(l,f,g)}touchmove(l,f,g){this.singleTap.touchmove(l,f,g)}touchend(l,f,g){const b=this.singleTap.touchend(l,f,g);if(b){const k=l.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(b)<30;if(k&&E||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=b,this.count===this.numTaps)return this.reset(),b}}}class Xd{constructor(l){this._tr=new ua(l),this._zoomIn=new su({numTouches:1,numTaps:2}),this._zoomOut=new su({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,f,g){this._zoomIn.touchstart(l,f,g),this._zoomOut.touchstart(l,f,g)}touchmove(l,f,g){this._zoomIn.touchmove(l,f,g),this._zoomOut.touchmove(l,f,g)}touchend(l,f,g){const b=this._zoomIn.touchend(l,f,g),k=this._zoomOut.touchend(l,f,g),E=this._tr;return b?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(b)},{originalEvent:l})}):k?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(k)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ha{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const f=this._moveFunction(...l);if(f.bearingDelta||f.pitchDelta||f.around||f.panDelta)return this._active=!0,f}dragStart(l,f){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=f.length?f[0]:f,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,f){if(!this.isEnabled())return;const g=this._lastPoint;if(!g)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const b=f.length?f[0]:f;return!this._moved&&b.dist(g)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=b,this._move(g,b))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&w.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Qa={0:1,2:2};class qo{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const f=w.mouseButton(l);this._eventButton=f}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(f,g){const b=Qa[g];return f.buttons===void 0||(f.buttons&b)!==b}(l,this._eventButton)}isValidEndEvent(l){return w.mouseButton(l)===this._eventButton}}class Ht{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const Xl=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=function(l){l.preventDefault()}},fa=({enable:x,clickTolerance:l,bearingDegreesPerPixelMoved:f=.8})=>{const g=new qo({checkCorrectEvent:b=>w.mouseButton(b)===0&&b.ctrlKey||w.mouseButton(b)===2});return new ha({clickTolerance:l,move:(b,k)=>({bearingDelta:(k.x-b.x)*f}),moveStateManager:g,enable:x,assignEvents:Xl})},da=({enable:x,clickTolerance:l,pitchDegreesPerPixelMoved:f=-.5})=>{const g=new qo({checkCorrectEvent:b=>w.mouseButton(b)===0&&b.ctrlKey||w.mouseButton(b)===2});return new ha({clickTolerance:l,move:(b,k)=>({pitchDelta:(k.y-b.y)*f}),moveStateManager:g,enable:x,assignEvents:Xl})};class lf{constructor(l,f){this._clickTolerance=l.clickTolerance||1,this._map=f,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,f,g){return this._calculateTransform(l,f,g)}touchmove(l,f,g){if(this._active&&!(g.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,f,g)}touchend(l,f,g){this._calculateTransform(l,f,g),this._active&&g.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,f,g){g.length>0&&(this._active=!0);const b=Ds(g,f),k=new a.P(0,0),E=new a.P(0,0);let A=0;for(const G in b){const X=b[G],Y=this._touches[G];Y&&(k._add(X),E._add(X.sub(Y)),A++,b[G]=X)}if(this._touches=b,A<this.minTouchs()||!E.mag())return;const B=E.div(A);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:k.div(A),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,f,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([f[0],f[1]]))}touchmove(l,f,g){if(!this._firstTwoTouches)return;l.preventDefault();const[b,k]=this._firstTwoTouches,E=pa(g,f,b),A=pa(g,f,k);if(!E||!A)return;const B=this._aroundCenter?null:E.add(A).div(2);return this._move([E,A],B,l)}touchend(l,f,g){if(!this._firstTwoTouches)return;const[b,k]=this._firstTwoTouches,E=pa(g,f,b),A=pa(g,f,k);E&&A||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function pa(x,l,f){for(let g=0;g<x.length;g++)if(x[g].identifier===f)return l[g]}function cf(x,l){return Math.log(x/l)/Math.LN2}class uf extends Vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,f){const g=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(cf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:cf(this._distance,g),pinchAround:f}}}function Jl(x,l){return 180*x.angleWith(l)/Math.PI}class au extends Vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,f,g){const b=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Jl(this._vector,b),pinchAround:f}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const f=25/(Math.PI*this._minDiameter)*360,g=Jl(l,this._startVector);return Math.abs(g)<f}}function Yl(x){return Math.abs(x.y)>Math.abs(x.x)}class hf extends Vt{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,f,g){super.touchstart(l,f,g),this._currentTouchCount=g.length}_start(l){this._lastPoints=l,Yl(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,f,g){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const b=l[0].sub(this._lastPoints[0]),k=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(b,k,g.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(b.y+k.y)/2*-.5}):void 0}gestureBeginsVertically(l,f,g){if(this._valid!==void 0)return this._valid;const b=l.mag()>=2,k=f.mag()>=2;if(!b&&!k)return;if(!b||!k)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=l.y>0==f.y>0;return Yl(l)&&Yl(f)&&E}}const Jd={panStep:100,bearingStep:15,pitchStep:10};class ws{constructor(l){this._tr=new ua(l);const f=Jd;this._panStep=f.panStep,this._bearingStep=f.bearingStep,this._pitchStep=f.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let f=0,g=0,b=0,k=0,E=0;switch(l.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:l.shiftKey?g=-1:(l.preventDefault(),k=-1);break;case 39:l.shiftKey?g=1:(l.preventDefault(),k=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),E=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,b=0),{cameraAnimation:A=>{const B=this._tr;A.easeTo({duration:300,easeId:"keyboardHandler",easing:Sr,zoom:f?Math.round(B.zoom)+f*(l.shiftKey?2:1):B.zoom,bearing:B.bearing+g*this._bearingStep,pitch:B.pitch+b*this._pitchStep,offset:[-k*this._panStep,-E*this._panStep],center:B.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Sr(x){return x*(2-x)}const el=4.000244140625;class Ql{constructor(l,f){this._onTimeout=g=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)},this._map=l,this._tr=new ua(l),this._triggerRenderFrame=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let f=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const g=y.now(),b=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,f!==0&&f%el==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":b>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(b*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=w.mousePos(this._map.getCanvas(),l),g=this._tr;this._around=f.y>g.transform.height/2-g.transform.getHorizon()?a.M.convert(this._aroundCenter?g.center:g.unproject(f)):a.M.convert(g.center),this._aroundPoint=g.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const A=this._type==="wheel"&&Math.abs(this._delta)>el?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&B!==0&&(B=1/B);const G=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(G*B))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,g=this._startZoom,b=this._easing;let k,E=!1;if(this._type==="wheel"&&g&&b){const A=Math.min((y.now()-this._lastWheelEventTime)/200,1),B=b(A);k=a.z.number(g,f,B),A<1?this._frameId||(this._frameId=!0):E=!0}else k=f,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:k-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let f=a.b7;if(this._prevEase){const g=this._prevEase,b=(y.now()-g.start)/g.duration,k=g.easing(b+.01)-g.easing(b),E=.27/Math.sqrt(k*k+1e-4)*.01,A=Math.sqrt(.0729-E*E);f=a.b6(E,A,.25,1)}return this._prevEase={start:y.now(),duration:l,easing:f},f}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class lu{constructor(l,f){this._clickZoom=l,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ff{constructor(l){this._tr=new ua(l),this.reset()}reset(){this._active=!1}dblclick(l,f){return l.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(f)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class df{constructor(){this._tap=new su({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,f,g){if(!this._swipePoint)if(this._tapTime){const b=f[0],k=l.timeStamp-this._tapTime<500,E=this._tapPoint.dist(b)<30;k&&E?g.length>0&&(this._swipePoint=b,this._swipeTouch=g[0].identifier):this.reset()}else this._tap.touchstart(l,f,g)}touchmove(l,f,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const b=f[0],k=b.y-this._swipePoint.y;return this._swipePoint=b,l.preventDefault(),this._active=!0,{zoomDelta:k/128}}}else this._tap.touchmove(l,f,g)}touchend(l,f,g){if(this._tapTime)this._swipePoint&&g.length===0&&this.reset();else{const b=this._tap.touchend(l,f,g);b&&(this._tapTime=l.timeStamp,this._tapPoint=b)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pf{constructor(l,f,g){this._el=l,this._mousePan=f,this._touchPan=g}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class xo{constructor(l,f,g){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tl{constructor(l,f,g,b){this._el=l,this._touchZoom=f,this._touchRotate=g,this._tapDragZoom=b,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class on{constructor(l,f){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=f,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=w.create("div","maplibregl-cooperative-gesture-screen",l);let f=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(f=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const g=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),b=document.createElement("div");b.className="maplibregl-desktop-message",b.textContent=f,this._container.appendChild(b);const k=document.createElement("div");k.className="maplibregl-mobile-message",k.textContent=g,this._container.appendChild(k),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(w.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const un=x=>x.zoom||x.drag||x.pitch||x.rotate;class ec extends a.k{}function nl(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class cu{constructor(l,f){this.handleWindowEvent=b=>{this.handleEvent(b,`${b.type}Window`)},this.handleEvent=(b,k)=>{if(b.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=b.type==="renderFrame"?void 0:b,A={needsRenderFrame:!1},B={},G={},X=b.touches,Y=X?this._getMapTouches(X):void 0,de=Y?w.touchPos(this._map.getCanvas(),Y):w.mousePos(this._map.getCanvas(),b);for(const{handlerName:Me,handler:ye,allowed:Re}of this._handlers){if(!ye.isEnabled())continue;let Je;this._blockedByActive(G,Re,Me)?ye.reset():ye[k||b.type]&&(Je=ye[k||b.type](b,de,Y),this.mergeHandlerResult(A,B,Je,Me,E),Je&&Je.needsRenderFrame&&this._triggerRenderFrame()),(Je||ye.isActive())&&(G[Me]=ye)}const Se={};for(const Me in this._previousActiveHandlers)G[Me]||(Se[Me]=E);this._previousActiveHandlers=G,(Object.keys(Se).length||nl(A))&&(this._changes.push([A,B,Se]),this._triggerRenderFrame()),(Object.keys(G).length||nl(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ke}=A;ke&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ke(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new af(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[b,k,E]of this._listeners)w.addEventListener(b,k,b===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[l,f,g]of this._listeners)w.removeEventListener(l,f,l===document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(l){const f=this._map,g=f.getCanvasContainer();this._add("mapEvent",new vo(f,l));const b=f.boxZoom=new wo(f,l);this._add("boxZoom",b),l.interactive&&l.boxZoom&&b.enable();const k=f.cooperativeGestures=new on(f,l.cooperativeGestures);this._add("cooperativeGestures",k),l.cooperativeGestures&&k.enable();const E=new Xd(f),A=new ff(f);f.doubleClickZoom=new lu(A,E),this._add("tapZoom",E),this._add("clickZoom",A),l.interactive&&l.doubleClickZoom&&f.doubleClickZoom.enable();const B=new df;this._add("tapDragZoom",B);const G=f.touchPitch=new hf(f);this._add("touchPitch",G),l.interactive&&l.touchPitch&&f.touchPitch.enable(l.touchPitch);const X=fa(l),Y=da(l);f.dragRotate=new xo(l,X,Y),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]),l.interactive&&l.dragRotate&&f.dragRotate.enable();const de=(({enable:Je,clickTolerance:Le})=>{const je=new qo({checkCorrectEvent:Qe=>w.mouseButton(Qe)===0&&!Qe.ctrlKey});return new ha({clickTolerance:Le,move:(Qe,rt)=>({around:rt,panDelta:rt.sub(Qe)}),activateOnStart:!0,moveStateManager:je,enable:Je,assignEvents:Xl})})(l),Se=new lf(l,f);f.dragPan=new pf(g,de,Se),this._add("mousePan",de),this._add("touchPan",Se,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&f.dragPan.enable(l.dragPan);const ke=new au,Me=new uf;f.touchZoomRotate=new tl(g,Me,ke,B),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&f.touchZoomRotate.enable(l.touchZoomRotate);const ye=f.scrollZoom=new Ql(f,()=>this._triggerRenderFrame());this._add("scrollZoom",ye,["mousePan"]),l.interactive&&l.scrollZoom&&f.scrollZoom.enable(l.scrollZoom);const Re=f.keyboard=new ws(f);this._add("keyboard",Re),l.interactive&&l.keyboard&&f.keyboard.enable(),this._add("blockableMapEvent",new Vo(f))}_add(l,f,g){this._handlers.push({handlerName:l,handler:f,allowed:g}),this._handlersById[l]=f}stop(l){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!un(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,f,g){for(const b in l)if(b!==g&&(!f||f.indexOf(b)<0))return!0;return!1}_getMapTouches(l){const f=[];for(const g of l)this._el.contains(g.target)&&f.push(g);return f}mergeHandlerResult(l,f,g,b,k){if(!g)return;a.e(l,g);const E={handlerName:b,originalEvent:g.originalEvent||k};g.zoomDelta!==void 0&&(f.zoom=E),g.panDelta!==void 0&&(f.drag=E),g.pitchDelta!==void 0&&(f.pitch=E),g.bearingDelta!==void 0&&(f.rotate=E)}_applyChanges(){const l={},f={},g={};for(const[b,k,E]of this._changes)b.panDelta&&(l.panDelta=(l.panDelta||new a.P(0,0))._add(b.panDelta)),b.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+b.zoomDelta),b.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+b.bearingDelta),b.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+b.pitchDelta),b.around!==void 0&&(l.around=b.around),b.pinchAround!==void 0&&(l.pinchAround=b.pinchAround),b.noInertia&&(l.noInertia=b.noInertia),a.e(f,k),a.e(g,E);this._updateMapTransform(l,f,g),this._changes=[]}_updateMapTransform(l,f,g){const b=this._map,k=b._getTransformForUpdate(),E=b.terrain;if(!(nl(l)||E&&this._terrainMovement))return this._fireEvents(f,g,!0);let{panDelta:A,zoomDelta:B,bearingDelta:G,pitchDelta:X,around:Y,pinchAround:de}=l;de!==void 0&&(Y=de),b._stop(!0),Y=Y||b.transform.centerPoint;const Se=k.pointLocation(A?Y.sub(A):Y);G&&(k.bearing+=G),X&&(k.pitch+=X),B&&(k.zoom+=B),E?this._terrainMovement||!f.drag&&!f.zoom?f.drag&&this._terrainMovement?k.center=k.pointLocation(k.centerPoint.sub(A)):k.setLocationAtPoint(Se,Y):(this._terrainMovement=!0,this._map._elevationFreeze=!0,k.setLocationAtPoint(Se,Y),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,k.recalculateZoom(b.terrain)})):k.setLocationAtPoint(Se,Y),b._applyUpdatedTransform(k),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,g,!0)}_fireEvents(l,f,g){const b=un(this._eventsInProgress),k=un(l),E={};for(const X in l){const{originalEvent:Y}=l[X];this._eventsInProgress[X]||(E[`${X}start`]=Y),this._eventsInProgress[X]=l[X]}!b&&k&&this._fireEvent("movestart",k.originalEvent);for(const X in E)this._fireEvent(X,E[X]);k&&this._fireEvent("move",k.originalEvent);for(const X in l){const{originalEvent:Y}=l[X];this._fireEvent(X,Y)}const A={};let B;for(const X in this._eventsInProgress){const{handlerName:Y,originalEvent:de}=this._eventsInProgress[X];this._handlersById[Y].isActive()||(delete this._eventsInProgress[X],B=f[Y]||de,A[`${X}end`]=B)}for(const X in A)this._fireEvent(X,A[X]);const G=un(this._eventsInProgress);if(g&&(b||k)&&!G){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=de=>de!==0&&-this._bearingSnap<de&&de<this._bearingSnap;!X||!X.essential&&y.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:B})),Y(this._map.getBearing())&&this._map.resetNorth()):(Y(X.bearing||this._map.getBearing())&&(X.bearing=0),X.freezeElevation=!0,this._map.easeTo(X,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(l,f){this._map.fire(new a.k(l,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new ec("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Fi extends a.E{constructor(l,f){super(),this._renderFrameCallback=()=>{const g=Math.min((y.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=f.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,f){return this.jumpTo({center:l},f)}panBy(l,f,g){return l=a.P.convert(l).mult(-1),this.panTo(this.transform.center,a.e({offset:l},f),g)}panTo(l,f,g){return this.easeTo(a.e({center:l},f),g)}getZoom(){return this.transform.zoom}setZoom(l,f){return this.jumpTo({zoom:l},f),this}zoomTo(l,f,g){return this.easeTo(a.e({zoom:l},f),g)}zoomIn(l,f){return this.zoomTo(this.getZoom()+1,l,f),this}zoomOut(l,f){return this.zoomTo(this.getZoom()-1,l,f),this}getBearing(){return this.transform.bearing}setBearing(l,f){return this.jumpTo({bearing:l},f),this}getPadding(){return this.transform.padding}setPadding(l,f){return this.jumpTo({padding:l},f),this}rotateTo(l,f,g){return this.easeTo(a.e({bearing:l},f),g)}resetNorth(l,f){return this.rotateTo(0,a.e({duration:1e3},l),f),this}resetNorthPitch(l,f){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},l),f),this}snapToNorth(l,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,f):this}getPitch(){return this.transform.pitch}setPitch(l,f){return this.jumpTo({pitch:l},f),this}cameraForBounds(l,f){l=Ve.convert(l);const g=f&&f.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),g,f)}_cameraForBoxAndBearing(l,f,g,b){const k={top:0,bottom:0,right:0,left:0};if(typeof(b=a.e({padding:k,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){const Dt=b.padding;b.padding={top:Dt,bottom:Dt,right:Dt,left:Dt}}b.padding=a.e(k,b.padding);const E=this.transform,A=E.padding,B=new Ve(l,f),G=E.project(B.getNorthWest()),X=E.project(B.getNorthEast()),Y=E.project(B.getSouthEast()),de=E.project(B.getSouthWest()),Se=a.b8(-g),ke=G.rotate(Se),Me=X.rotate(Se),ye=Y.rotate(Se),Re=de.rotate(Se),Je=new a.P(Math.max(ke.x,Me.x,Re.x,ye.x),Math.max(ke.y,Me.y,Re.y,ye.y)),Le=new a.P(Math.min(ke.x,Me.x,Re.x,ye.x),Math.min(ke.y,Me.y,Re.y,ye.y)),je=Je.sub(Le),Qe=(E.width-(A.left+A.right+b.padding.left+b.padding.right))/je.x,rt=(E.height-(A.top+A.bottom+b.padding.top+b.padding.bottom))/je.y;if(rt<0||Qe<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ot=Math.min(E.scaleZoom(E.scale*Math.min(Qe,rt)),b.maxZoom),_t=a.P.convert(b.offset),pt=new a.P((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(a.b8(g)),At=_t.add(pt).mult(E.scale/E.zoomScale(ot));return{center:E.unproject(G.add(Y).div(2).sub(At)),zoom:ot,bearing:g}}fitBounds(l,f,g){return this._fitInternal(this.cameraForBounds(l,f),f,g)}fitScreenCoordinates(l,f,g,b,k){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(l)),this.transform.pointLocation(a.P.convert(f)),g,b),b,k)}_fitInternal(l,f,g){return l?(delete(f=a.e(l,f)).padding,f.linear?this.easeTo(f,g):this.flyTo(f,g)):this}jumpTo(l,f){this.stop();const g=this._getTransformForUpdate();let b=!1,k=!1,E=!1;return"zoom"in l&&g.zoom!==+l.zoom&&(b=!0,g.zoom=+l.zoom),l.center!==void 0&&(g.center=a.M.convert(l.center)),"bearing"in l&&g.bearing!==+l.bearing&&(k=!0,g.bearing=+l.bearing),"pitch"in l&&g.pitch!==+l.pitch&&(E=!0,g.pitch=+l.pitch),l.padding==null||g.isPaddingEqual(l.padding)||(g.padding=l.padding),this._applyUpdatedTransform(g),this.fire(new a.k("movestart",f)).fire(new a.k("move",f)),b&&this.fire(new a.k("zoomstart",f)).fire(new a.k("zoom",f)).fire(new a.k("zoomend",f)),k&&this.fire(new a.k("rotatestart",f)).fire(new a.k("rotate",f)).fire(new a.k("rotateend",f)),E&&this.fire(new a.k("pitchstart",f)).fire(new a.k("pitch",f)).fire(new a.k("pitchend",f)),this.fire(new a.k("moveend",f))}calculateCameraOptionsFromTo(l,f,g,b=0){const k=a.Y.fromLngLat(l,f),E=a.Y.fromLngLat(g,b),A=E.x-k.x,B=E.y-k.y,G=E.z-k.z,X=Math.hypot(A,B,G);if(X===0)throw new Error("Can't calculate camera options with same From and To");const Y=Math.hypot(A,B),de=this.transform.scaleZoom(this.transform.cameraToCenterDistance/X/this.transform.tileSize),Se=180*Math.atan2(A,-B)/Math.PI;let ke=180*Math.acos(Y/X)/Math.PI;return ke=G<0?90-ke:90+ke,{center:E.toLngLat(),zoom:de,pitch:ke,bearing:Se}}easeTo(l,f){var g;this._stop(!1,l.easeId),((l=a.e({offset:[0,0],duration:500,easing:a.b7},l)).animate===!1||!l.essential&&y.prefersReducedMotion)&&(l.duration=0);const b=this._getTransformForUpdate(),k=this.getZoom(),E=this.getBearing(),A=this.getPitch(),B=this.getPadding(),G="bearing"in l?this._normalizeBearing(l.bearing,E):E,X="pitch"in l?+l.pitch:A,Y="padding"in l?l.padding:b.padding,de=a.P.convert(l.offset);let Se=b.centerPoint.add(de);const ke=b.pointLocation(Se),{center:Me,zoom:ye}=b.getConstrained(a.M.convert(l.center||ke),(g=l.zoom)!==null&&g!==void 0?g:k);this._normalizeCenter(Me);const Re=b.project(ke),Je=b.project(Me).sub(Re),Le=b.zoomScale(ye-k);let je,Qe;l.around&&(je=a.M.convert(l.around),Qe=b.locationPoint(je));const rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ye!==k,this._rotating=this._rotating||E!==G,this._pitching=this._pitching||X!==A,this._padding=!b.isPaddingEqual(Y),this._easeId=l.easeId,this._prepareEase(f,l.noMoveStart,rt),this.terrain&&this._prepareElevation(Me),this._ease(ot=>{if(this._zooming&&(b.zoom=a.z.number(k,ye,ot)),this._rotating&&(b.bearing=a.z.number(E,G,ot)),this._pitching&&(b.pitch=a.z.number(A,X,ot)),this._padding&&(b.interpolatePadding(B,Y,ot),Se=b.centerPoint.add(de)),this.terrain&&!l.freezeElevation&&this._updateElevation(ot),je)b.setLocationAtPoint(je,Qe);else{const _t=b.zoomScale(b.zoom-k),pt=ye>k?Math.min(2,Le):Math.max(.5,Le),At=Math.pow(pt,1-ot),Dt=b.unproject(Re.add(Je.mult(ot*At)).mult(_t));b.setLocationAtPoint(b.renderWorldCopies?Dt.wrap():Dt,Se)}this._applyUpdatedTransform(b),this._fireMoveEvents(f)},ot=>{this.terrain&&this._finalizeElevation(),this._afterEase(f,ot)},l),this}_prepareEase(l,f,g={}){this._moving=!0,f||g.moving||this.fire(new a.k("movestart",l)),this._zooming&&!g.zooming&&this.fire(new a.k("zoomstart",l)),this._rotating&&!g.rotating&&this.fire(new a.k("rotatestart",l)),this._pitching&&!g.pitching&&this.fire(new a.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const f=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&f!==this._elevationTarget){const g=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(g-(f-(g*l+this._elevationStart))/(1-l)),this._elevationTarget=f}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const f=l.clone(),{center:g,zoom:b,pitch:k,bearing:E,elevation:A}=this.transformCameraUpdate(f);g&&(f.center=g),b!==void 0&&(f.zoom=b),k!==void 0&&(f.pitch=k),E!==void 0&&(f.bearing=E),A!==void 0&&(f.elevation=A),this.transform.apply(f)}_fireMoveEvents(l){this.fire(new a.k("move",l)),this._zooming&&this.fire(new a.k("zoom",l)),this._rotating&&this.fire(new a.k("rotate",l)),this._pitching&&this.fire(new a.k("pitch",l))}_afterEase(l,f){if(this._easeId&&f&&this._easeId===f)return;delete this._easeId;const g=this._zooming,b=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new a.k("zoomend",l)),b&&this.fire(new a.k("rotateend",l)),k&&this.fire(new a.k("pitchend",l)),this.fire(new a.k("moveend",l))}flyTo(l,f){var g;if(!l.essential&&y.prefersReducedMotion){const Zn=a.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Zn,f)}this.stop(),l=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},l);const b=this._getTransformForUpdate(),k=this.getZoom(),E=this.getBearing(),A=this.getPitch(),B=this.getPadding(),G="bearing"in l?this._normalizeBearing(l.bearing,E):E,X="pitch"in l?+l.pitch:A,Y="padding"in l?l.padding:b.padding,de=a.P.convert(l.offset);let Se=b.centerPoint.add(de);const ke=b.pointLocation(Se),{center:Me,zoom:ye}=b.getConstrained(a.M.convert(l.center||ke),(g=l.zoom)!==null&&g!==void 0?g:k);this._normalizeCenter(Me);const Re=b.zoomScale(ye-k),Je=b.project(ke),Le=b.project(Me).sub(Je);let je=l.curve;const Qe=Math.max(b.width,b.height),rt=Qe/Re,ot=Le.mag();if("minZoom"in l){const Zn=a.ac(Math.min(l.minZoom,k,ye),b.minZoom,b.maxZoom),_n=Qe/b.zoomScale(Zn-k);je=Math.sqrt(_n/ot*2)}const _t=je*je;function pt(Zn){const _n=(rt*rt-Qe*Qe+(Zn?-1:1)*_t*_t*ot*ot)/(2*(Zn?rt:Qe)*_t*ot);return Math.log(Math.sqrt(_n*_n+1)-_n)}function At(Zn){return(Math.exp(Zn)-Math.exp(-Zn))/2}function Dt(Zn){return(Math.exp(Zn)+Math.exp(-Zn))/2}const bn=pt(!1);let Ft=function(Zn){return Dt(bn)/Dt(bn+je*Zn)},pn=function(Zn){return Qe*((Dt(bn)*(At(_n=bn+je*Zn)/Dt(_n))-At(bn))/_t)/ot;var _n},vn=(pt(!0)-bn)/je;if(Math.abs(ot)<1e-6||!isFinite(vn)){if(Math.abs(Qe-rt)<1e-6)return this.easeTo(l,f);const Zn=rt<Qe?-1:1;vn=Math.abs(Math.log(rt/Qe))/je,pn=function(){return 0},Ft=function(_n){return Math.exp(Zn*je*_n)}}return l.duration="duration"in l?+l.duration:1e3*vn/("screenSpeed"in l?+l.screenSpeed/je:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=E!==G,this._pitching=X!==A,this._padding=!b.isPaddingEqual(Y),this._prepareEase(f,!1),this.terrain&&this._prepareElevation(Me),this._ease(Zn=>{const _n=Zn*vn,Sn=1/Ft(_n);b.zoom=Zn===1?ye:k+b.scaleZoom(Sn),this._rotating&&(b.bearing=a.z.number(E,G,Zn)),this._pitching&&(b.pitch=a.z.number(A,X,Zn)),this._padding&&(b.interpolatePadding(B,Y,Zn),Se=b.centerPoint.add(de)),this.terrain&&!l.freezeElevation&&this._updateElevation(Zn);const zn=Zn===1?Me:b.unproject(Je.add(Le.mult(pn(_n))).mult(Sn));b.setLocationAtPoint(b.renderWorldCopies?zn.wrap():zn,Se),this._applyUpdatedTransform(b),this._fireMoveEvents(f)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(f)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const g=this._onEaseEnd;delete this._onEaseEnd,g.call(this,f)}if(!l){const g=this.handlers;g&&g.stop(!1)}return this}_ease(l,f,g){g.animate===!1||g.duration===0?(l(1),f()):(this._easeStart=y.now(),this._easeOptions=g,this._onEaseFrame=l,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,f){l=a.b1(l,-180,180);const g=Math.abs(l-f);return Math.abs(l-360-f)<g&&(l-=360),Math.abs(l+360-f)<g&&(l+=360),l}_normalizeCenter(l){const f=this.transform;if(!f.renderWorldCopies||f.lngRange)return;const g=l.lng-f.center.lng;l.lng+=g>180?-360:g<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const uu={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ko{constructor(l=uu){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=f=>{!f||f.sourceDataType!=="metadata"&&f.sourceDataType!=="visibility"&&f.dataType!=="style"&&f.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,f){const g=this._map._getUIString(`AttributionControl.${f}`);l.title=g,l.setAttribute("aria-label",g)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(b=>typeof b!="string"?"":b)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const b=this._map.style.stylesheet;this.styleOwner=b.owner,this.styleId=b.id}const f=this._map.style.sourceCaches;for(const b in f){const k=f[b];if(k.used||k.usedForTerrain){const E=k.getSource();E.attribution&&l.indexOf(E.attribution)<0&&l.push(E.attribution)}}l=l.filter(b=>String(b).trim()),l.sort((b,k)=>b.length-k.length),l=l.filter((b,k)=>{for(let E=k+1;E<l.length;E++)if(l[E].indexOf(b)>=0)return!1;return!0});const g=l.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,l.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class mf{constructor(l={}){this._updateCompact=()=>{const f=this._container.children;if(f.length){const g=f[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&g.classList.add("maplibregl-compact"):g.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const f=w.create("a","maplibregl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://maplibre.org/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class rl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f}remove(l){const f=this._currentlyRunning,g=f?this._queue.concat(f):this._queue;for(const b of g)if(b.id===l)return void(b.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const f=this._currentlyRunning=this._queue;this._queue=[];for(const g of f)if(!g.cancelled&&(g.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Dr=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ur extends a.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,f){this.sourceCache.update(l,f),this._renderableTilesKeys=[];const g={};for(const b of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:f}))g[b.key]=!0,this._renderableTilesKeys.push(b.key),this._tiles[b.key]||(b.posMatrix=new Float64Array(16),a.aN(b.posMatrix,0,a.W,0,a.W,0,1),this._tiles[b.key]=new Bn(b,this.tileSize));for(const b in this._tiles)g[b]||delete this._tiles[b]}freeRtt(l){for(const f in this._tiles){const g=this._tiles[f];(!l||g.tileID.equals(l)||g.tileID.isChildOf(l)||l.isChildOf(g.tileID))&&(g.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const f={};for(const g of this._renderableTilesKeys){const b=this._tiles[g].tileID;if(b.canonical.equals(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16),a.aN(k.posMatrix,0,a.W,0,a.W,0,1),f[g]=k}else if(b.canonical.isChildOf(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const E=b.canonical.z-l.canonical.z,A=b.canonical.x-(b.canonical.x>>E<<E),B=b.canonical.y-(b.canonical.y>>E<<E),G=a.W>>E;a.aN(k.posMatrix,0,G,0,G,0,1),a.H(k.posMatrix,k.posMatrix,[-A*G,-B*G,0]),f[g]=k}else if(l.canonical.isChildOf(b.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const E=l.canonical.z-b.canonical.z,A=l.canonical.x-(l.canonical.x>>E<<E),B=l.canonical.y-(l.canonical.y>>E<<E),G=a.W>>E;a.aN(k.posMatrix,0,a.W,0,a.W,0,1),a.H(k.posMatrix,k.posMatrix,[A*G,B*G,0]),a.J(k.posMatrix,k.posMatrix,[1/2**E,1/2**E,0]),f[g]=k}}return f}getSourceTile(l,f){const g=this.sourceCache._source;let b=l.overscaledZ-this.deltaZoom;if(b>g.maxzoom&&(b=g.maxzoom),b<g.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(b).key);let k=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!k||!k.dem)&&f)for(;b>=g.minzoom&&(!k||!k.dem);)k=this.sourceCache.getTileByID(l.scaledTo(b--).key);return k}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(f=>f.timeAdded>=l)}}class gf{constructor(l,f,g){this.painter=l,this.sourceCache=new Ur(f),this.options=g,this.exaggeration=typeof g.exaggeration=="number"?g.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,f,g,b=a.W){var k;if(!(f>=0&&f<b&&g>=0&&g<b))return 0;const E=this.getTerrainData(l),A=(k=E.tile)===null||k===void 0?void 0:k.dem;if(!A)return 0;const B=function(ke,Me,ye){var Re=Me[0],Je=Me[1];return ke[0]=ye[0]*Re+ye[4]*Je+ye[12],ke[1]=ye[1]*Re+ye[5]*Je+ye[13],ke}([],[f/b*a.W,g/b*a.W],E.u_terrain_matrix),G=[B[0]*A.dim,B[1]*A.dim],X=Math.floor(G[0]),Y=Math.floor(G[1]),de=G[0]-X,Se=G[1]-Y;return A.get(X,Y)*(1-de)*(1-Se)+A.get(X+1,Y)*de*(1-Se)+A.get(X,Y+1)*(1-de)*Se+A.get(X+1,Y+1)*de*Se}getElevationForLngLatZoom(l,f){const{tileID:g,mercatorX:b,mercatorY:k}=this._getOverscaledTileIDFromLngLatZoom(l,f);return this.getElevation(g,b%a.W,k%a.W,a.W)}getElevation(l,f,g,b=a.W){return this.getDEMElevation(l,f,g,b)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const b=this.painter.context,k=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Q(b,k,b.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Q(b,new a.R({width:1,height:1}),b.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const f=this.sourceCache.getSourceTile(l,!0);if(f&&f.dem&&(!f.demTexture||f.needsTerrainPrepare)){const b=this.painter.context;f.demTexture=this.painter.getTileTexture(f.dem.stride),f.demTexture?f.demTexture.update(f.dem.getPixels(),{premultiply:!1}):f.demTexture=new Q(b,f.dem.getPixels(),b.gl.RGBA,{premultiply:!1}),f.demTexture.bind(b.gl.NEAREST,b.gl.CLAMP_TO_EDGE),f.needsTerrainPrepare=!1}const g=f&&f+f.tileID.key+l.key;if(g&&!this._demMatrixCache[g]){const b=this.sourceCache.sourceCache._source.maxzoom;let k=l.canonical.z-f.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=b?k=l.canonical.z-b:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=l.canonical.x-(l.canonical.x>>k<<k),A=l.canonical.y-(l.canonical.y>>k<<k),B=a.b9(new Float64Array(16),[1/(a.W<<k),1/(a.W<<k),0]);a.H(B,B,[E*a.W,A*a.W,0]),this._demMatrixCache[l.key]={matrix:B,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:f&&f.dem&&f.dem.dim||1,u_terrain_matrix:g?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:f&&f.dem&&f.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(f&&f.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:f}}getFramebuffer(l){const f=this.painter,g=f.width/devicePixelRatio,b=f.height/devicePixelRatio;return!this._fbo||this._fbo.width===g&&this._fbo.height===b||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Q(f.context,{width:g,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Q(f.context,{width:g,height:b,data:null},f.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(f.context.gl.NEAREST,f.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=f.context.createFramebuffer(g,b,!0,!1),this._fbo.depthAttachment.set(f.context.createRenderbuffer(f.context.gl.DEPTH_COMPONENT16,g,b))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const f=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let k=0,E=0;k<this._coordsTextureSize;k++)for(let A=0;A<this._coordsTextureSize;A++,E+=4)f[E+0]=255&A,f[E+1]=255&k,f[E+2]=A>>8<<4|k>>8,f[E+3]=0;const g=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(f.buffer)),b=new Q(l,g,l.gl.RGBA,{premultiply:!1});return b.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=b,b}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const f=new Uint8Array(4),g=this.painter.context,b=g.gl,k=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),A=Math.round(this.painter.height/devicePixelRatio);g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),b.readPixels(k,A-E-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),g.bindFramebuffer.set(null);const B=f[0]+(f[2]>>4<<8),G=f[1]+((15&f[2])<<8),X=this.coordsIndex[255-f[3]],Y=X&&this.sourceCache.getTileByID(X);if(!Y)return null;const de=this._coordsTextureSize,Se=(1<<Y.tileID.canonical.z)*de;return new a.Y((Y.tileID.canonical.x*de+B)/Se+Y.tileID.wrap,(Y.tileID.canonical.y*de+G)/Se,this.getElevation(Y.tileID,B,G,de))}depthAtPoint(l){const f=new Uint8Array(4),g=this.painter.context,b=g.gl;return g.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),b.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,b.RGBA,b.UNSIGNED_BYTE,f),g.bindFramebuffer.set(null),(f[0]/16777216+f[1]/65536+f[2]/256+f[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,f=new a.ba,g=new a.aX,b=this.meshSize,k=a.W/b,E=b*b;for(let Y=0;Y<=b;Y++)for(let de=0;de<=b;de++)f.emplaceBack(de*k,Y*k,0);for(let Y=0;Y<E;Y+=b+1)for(let de=0;de<b;de++)g.emplaceBack(de+Y,b+de+Y+1,b+de+Y+2),g.emplaceBack(de+Y,b+de+Y+2,de+Y+1);const A=f.length,B=A+2*(b+1);for(const Y of[0,1])for(let de=0;de<=b;de++)for(const Se of[0,1])f.emplaceBack(de*k,Y*a.W,Se);for(let Y=0;Y<2*b;Y+=2)g.emplaceBack(B+Y,B+Y+1,B+Y+3),g.emplaceBack(B+Y,B+Y+3,B+Y+2),g.emplaceBack(A+Y,A+Y+3,A+Y+1),g.emplaceBack(A+Y,A+Y+2,A+Y+3);const G=f.length,X=G+2*(b+1);for(const Y of[0,1])for(let de=0;de<=b;de++)for(const Se of[0,1])f.emplaceBack(Y*a.W,de*k,Se);for(let Y=0;Y<2*b;Y+=2)g.emplaceBack(G+Y,G+Y+1,G+Y+3),g.emplaceBack(G+Y,G+Y+3,G+Y+2),g.emplaceBack(X+Y,X+Y+3,X+Y+1),g.emplaceBack(X+Y,X+Y+2,X+Y+3);return this._mesh={indexBuffer:l.createIndexBuffer(g),vertexBuffer:l.createVertexBuffer(f,Dr.members),segments:a.$.simpleSegment(0,0,f.length,g.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*a.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,f){var g;const{tileID:b}=this._getOverscaledTileIDFromLngLatZoom(l,f);return(g=this.getMinMaxElevation(b).minElevation)!==null&&g!==void 0?g:0}getMinMaxElevation(l){const f=this.getTerrainData(l).tile,g={minElevation:null,maxElevation:null};return f&&f.dem&&(g.minElevation=f.dem.min*this.exaggeration,g.maxElevation=f.dem.max*this.exaggeration),g}_getOverscaledTileIDFromLngLatZoom(l,f){const g=a.Y.fromLngLat(l.wrap()),b=(1<<f)*a.W,k=g.x*b,E=g.y*b,A=Math.floor(k/a.W),B=Math.floor(E/a.W);return{tileID:new a.Q(f,0,f,A,B),mercatorX:k,mercatorY:E}}}class il{constructor(l,f,g){this._context=l,this._size=f,this._tileSize=g,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const f=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),g=new Q(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return g.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),f.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),f.colorAttachment.set(g.texture),{id:l,fbo:f,texture:g,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(f=>l.id!==f),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const f of this._recentlyUsed)if(!this._objects[f].inUse)return this._objects[f];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const ns={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class hu{constructor(l,f){this.painter=l,this.terrain=f,this.pool=new il(l.context,30,f.sourceCache.tileSize*f.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,f){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(g=>!l._layers[g].isHidden(f)),this._coordsDescendingInv={};for(const g in l.sourceCaches){this._coordsDescendingInv[g]={};const b=l.sourceCaches[g].getVisibleCoordinates();for(const k of b){const E=this.terrain.sourceCache.getTerrainCoords(k);for(const A in E)this._coordsDescendingInv[g][A]||(this._coordsDescendingInv[g][A]=[]),this._coordsDescendingInv[g][A].push(E[A])}}this._coordsDescendingInvStr={};for(const g of l._order){const b=l._layers[g],k=b.source;if(ns[b.type]&&!this._coordsDescendingInvStr[k]){this._coordsDescendingInvStr[k]={};for(const E in this._coordsDescendingInv[k])this._coordsDescendingInvStr[k][E]=this._coordsDescendingInv[k][E].map(A=>A.key).sort().join()}}for(const g of this._renderableTiles)for(const b in this._coordsDescendingInvStr){const k=this._coordsDescendingInvStr[b][g.tileID.key];k&&k!==g.rttCoords[b]&&(g.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const f=l.type,g=this.painter,b=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(ns[f]&&(this._prevType&&ns[this._prevType]||this._stacks.push([]),this._prevType=f,this._stacks[this._stacks.length-1].push(l.id),!b))return!0;if(ns[this._prevType]||ns[f]&&b){this._prevType=f;const k=this._stacks.length-1,E=this._stacks[k]||[];for(const A of this._renderableTiles){if(this.pool.isFull()&&(Wl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(A),A.rtt[k]){const G=this.pool.getObjectForId(A.rtt[k].id);if(G.stamp===A.rtt[k].stamp){this.pool.useObject(G);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),A.rtt[k]={id:B.id,stamp:B.stamp},g.context.bindFramebuffer.set(B.fbo.framebuffer),g.context.clear({color:a.aO.transparent,stencil:0}),g.currentStencilSource=void 0;for(let G=0;G<E.length;G++){const X=g.style._layers[E[G]],Y=X.source?this._coordsDescendingInv[X.source][A.tileID.key]:[A.tileID];g.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),g._renderTileClippingMasks(X,Y),g.renderLayer(g,g.style.sourceCaches[X.source],X,Y),X.source&&(A.rttCoords[X.source]=this._coordsDescendingInvStr[X.source][A.tileID.key])}}return Wl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ns[f]}return!1}}const fu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},du=d,ol={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:uu,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},tc=x=>{x.touchstart=x.dragStart,x.touchmoveWindow=x.dragMove,x.touchend=x.dragEnd},pu={showCompass:!0,showZoom:!0,visualizePitch:!1};class mu{constructor(l,f,g=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),w.mousePos(this.element,E)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,w.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const b=l.dragRotate._mouseRotate.getClickTolerance(),k=l.dragRotate._mousePitch.getClickTolerance();this.element=f,this.mouseRotate=fa({clickTolerance:b,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:A,bearingDegreesPerPixelMoved:B=.8})=>{const G=new Ht;return new ha({clickTolerance:A,move:(X,Y)=>({bearingDelta:(Y.x-X.x)*B}),moveStateManager:G,enable:E,assignEvents:tc})})({clickTolerance:b,enable:!0}),this.map=l,g&&(this.mousePitch=da({clickTolerance:k,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:A,pitchDegreesPerPixelMoved:B=-.5})=>{const G=new Ht;return new ha({clickTolerance:A,move:(X,Y)=>({pitchDelta:(Y.y-X.y)*B}),moveStateManager:G,enable:E,assignEvents:tc})})({clickTolerance:k,enable:!0})),w.addEventListener(f,"mousedown",this.mousedown),w.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(f,"touchcancel",this.reset)}startMouse(l,f){this.mouseRotate.dragStart(l,f),this.mousePitch&&this.mousePitch.dragStart(l,f),w.disableDrag()}startTouch(l,f){this.touchRotate.dragStart(l,f),this.touchPitch&&this.touchPitch.dragStart(l,f),w.disableDrag()}moveMouse(l,f){const g=this.map,{bearingDelta:b}=this.mouseRotate.dragMove(l,f)||{};if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const{pitchDelta:k}=this.mousePitch.dragMove(l,f)||{};k&&g.setPitch(g.getPitch()+k)}}moveTouch(l,f){const g=this.map,{bearingDelta:b}=this.touchRotate.dragMove(l,f)||{};if(b&&g.setBearing(g.getBearing()+b),this.touchPitch){const{pitchDelta:k}=this.touchPitch.dragMove(l,f)||{};k&&g.setPitch(g.getPitch()+k)}}off(){const l=this.element;w.removeEventListener(l,"mousedown",this.mousedown),w.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}}let rs;function nc(x,l,f){const g=new a.M(x.lng,x.lat);if(x=new a.M(x.lng,x.lat),l){const b=new a.M(x.lng-360,x.lat),k=new a.M(x.lng+360,x.lat),E=f.locationPoint(x).distSqr(l);f.locationPoint(b).distSqr(l)<E?x=b:f.locationPoint(k).distSqr(l)<E&&(x=k)}for(;Math.abs(x.lng-f.center.lng)>180;){const b=f.locationPoint(x);if(b.x>=0&&b.y>=0&&b.x<=f.width&&b.y<=f.height)break;x.lng>f.center.lng?x.lng-=360:x.lng+=360}return x.lng!==g.lng&&f.locationPoint(x).y>f.height/2-f.getHorizon()?x:g}const sl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function rc(x,l,f){const g=x.classList;for(const b in sl)g.remove(`maplibregl-${f}-anchor-${b}`);g.add(`maplibregl-${f}-anchor-${l}`)}class al extends a.E{constructor(l){if(super(),this._onKeyPress=f=>{const g=f.code,b=f.charCode||f.keyCode;g!=="Space"&&g!=="Enter"&&b!==32&&b!==13||this.togglePopup()},this._onMapClick=f=>{const g=f.originalEvent.target,b=this._element;this._popup&&(g===b||b.contains(g))&&this.togglePopup()},this._update=f=>{var g;if(!this._map)return;const b=this._map.loaded()&&!this._map.isMoving();((f==null?void 0:f.type)==="terrain"||(f==null?void 0:f.type)==="render"&&!b)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?nc(this._lngLat,this._flatPos,this._map.transform):(g=this._lngLat)===null||g===void 0?void 0:g.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let k="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?k=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(k=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),f&&f.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${sl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${k}`),y.frameAsync(new AbortController).then(()=>{this._updateOpacity(f&&f.type==="moveend")}).catch(()=>{})},this._onMove=f=>{if(!this._isDragging){const g=this._clickTolerance||this._map._clickTolerance;this._isDragging=f.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=f.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=f=>{this._element.contains(f.originalEvent.target)&&(f.preventDefault(),this._positionDelta=f.point.sub(this._pos).add(this._offset),this._pointerdownPos=f.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=a.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div"),this._element.setAttribute("aria-label","Map marker");const f=w.createNS("http://www.w3.org/2000/svg","svg"),g=41,b=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${g}px`),f.setAttributeNS(null,"width",`${b}px`),f.setAttributeNS(null,"viewBox",`0 0 ${b} ${g}`);const k=w.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"stroke","none"),k.setAttributeNS(null,"stroke-width","1"),k.setAttributeNS(null,"fill","none"),k.setAttributeNS(null,"fill-rule","evenodd");const E=w.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const A=w.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(3.0, 29.0)"),A.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Re of B){const Je=w.createNS("http://www.w3.org/2000/svg","ellipse");Je.setAttributeNS(null,"opacity","0.04"),Je.setAttributeNS(null,"cx","10.5"),Je.setAttributeNS(null,"cy","5.80029008"),Je.setAttributeNS(null,"rx",Re.rx),Je.setAttributeNS(null,"ry",Re.ry),A.appendChild(Je)}const G=w.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill",this._color);const X=w.createNS("http://www.w3.org/2000/svg","path");X.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),G.appendChild(X);const Y=w.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"fill","#000000");const de=w.createNS("http://www.w3.org/2000/svg","path");de.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Y.appendChild(de);const Se=w.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Se.setAttributeNS(null,"fill","#FFFFFF");const ke=w.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=w.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const ye=w.createNS("http://www.w3.org/2000/svg","circle");ye.setAttributeNS(null,"fill","#FFFFFF"),ye.setAttributeNS(null,"cx","5.5"),ye.setAttributeNS(null,"cy","5.5"),ye.setAttributeNS(null,"r","5.4999962"),ke.appendChild(Me),ke.appendChild(ye),E.appendChild(A),E.appendChild(G),E.appendChild(Y),E.appendChild(Se),E.appendChild(ke),f.appendChild(E),f.setAttributeNS(null,"height",g*this._scale+"px"),f.setAttributeNS(null,"width",b*this._scale+"px"),this._element.appendChild(f),this._offset=a.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),rc(this._element,this._anchor,"marker"),l&&l.className)for(const f of l.className.split(" "))this._element.classList.add(f);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=a.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const b=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[b,-1*(38.1-13.5+b)],"bottom-right":[-b,-1*(38.1-13.5+b)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var f,g;if(!(!((f=this._map)===null||f===void 0)&&f.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const b=this._map,k=b.terrain.depthAtPoint(this._pos),E=b.terrain.getElevationForLngLatZoom(this._lngLat,b.transform.tileZoom);if(b.transform.lngLatToCameraDepth(this._lngLat,E)-k<.006)return void(this._element.style.opacity=this._opacity);const A=-this._offset.y/b.transform._pixelPerMeter,B=Math.sin(b.getPitch()*Math.PI/180)*A,G=b.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),X=b.transform.lngLatToCameraDepth(this._lngLat,E+B)-G>.006;!((g=this._popup)===null||g===void 0)&&g.isOpen()&&X&&this._popup.remove(),this._element.style.opacity=X?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=a.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,f){return l===void 0&&f===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),f!==void 0&&(this._opacityWhenCovered=f),this._map&&this._updateOpacity(!0),this}}const ic={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ma=0,$s=!1;const oc={maxWidth:100,unit:"metric"};function sc(x,l,f){const g=f&&f.maxWidth||100,b=x._container.clientHeight/2,k=x.unproject([0,b]),E=x.unproject([g,b]),A=k.distanceTo(E);if(f&&f.unit==="imperial"){const B=3.2808*A;B>5280?Rs(l,g,B/5280,x._getUIString("ScaleControl.Miles")):Rs(l,g,B,x._getUIString("ScaleControl.Feet"))}else f&&f.unit==="nautical"?Rs(l,g,A/1852,x._getUIString("ScaleControl.NauticalMiles")):A>=1e3?Rs(l,g,A/1e3,x._getUIString("ScaleControl.Kilometers")):Rs(l,g,A,x._getUIString("ScaleControl.Meters"))}function Rs(x,l,f,g){const b=function(k){const E=Math.pow(10,`${Math.floor(k)}`.length-1);let A=k/E;return A=A>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(B){const G=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*G)/G}(A),E*A}(f);x.style.width=l*(b/f)+"px",x.innerHTML=`${b}&nbsp;${g}`}const gu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},_u=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ac(x){if(x){if(typeof x=="number"){const l=Math.round(Math.abs(x)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,x),"top-left":new a.P(l,l),"top-right":new a.P(-l,l),bottom:new a.P(0,-x),"bottom-left":new a.P(l,-l),"bottom-right":new a.P(-l,-l),left:new a.P(x,0),right:new a.P(-x,0)}}if(x instanceof a.P||Array.isArray(x)){const l=a.P.convert(x);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:a.P.convert(x.center||[0,0]),top:a.P.convert(x.top||[0,0]),"top-left":a.P.convert(x["top-left"]||[0,0]),"top-right":a.P.convert(x["top-right"]||[0,0]),bottom:a.P.convert(x.bottom||[0,0]),"bottom-left":a.P.convert(x["bottom-left"]||[0,0]),"bottom-right":a.P.convert(x["bottom-right"]||[0,0]),left:a.P.convert(x.left||[0,0]),right:a.P.convert(x.right||[0,0])}}return ac(new a.P(0,0))}const _f=d;c.AJAXError=a.be,c.Evented=a.E,c.LngLat=a.M,c.MercatorCoordinate=a.Y,c.Point=a.P,c.addProtocol=a.bf,c.config=a.a,c.removeProtocol=a.bg,c.AttributionControl=ko,c.BoxZoomHandler=wo,c.CanvasSource=ur,c.CooperativeGesturesHandler=on,c.DoubleClickZoomHandler=lu,c.DragPanHandler=pf,c.DragRotateHandler=xo,c.EdgeInsets=ca,c.FullscreenControl=class extends a.E{constructor(x={}){super(),this._onFullscreenChange=()=>{var l;let f=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=f==null?void 0:f.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)f=f.shadowRoot.fullscreenElement;f===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},c.GeoJSONSource=Ne,c.GeolocateControl=class extends a.E{constructor(x){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const f=new a.M(l.coords.longitude,l.coords.latitude),g=l.coords.accuracy,b=this._map.getBearing(),k=a.e({bearing:b},this.options.fitBoundsOptions),E=Ve.fromLngLat(f,g);this._map.fitBounds(E,k,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const f=new a.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(f).addTo(this._map),this._userLocationDotMarker.setLngLat(f).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&$s)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",f=>f.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const f=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}else{const f=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=f,this._geolocateButton.setAttribute("aria-label",f)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new al({element:this._dotElement}),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new al({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",f=>{f.geolocateSource||this._watchState!=="ACTIVE_LOCK"||f.originalEvent&&f.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},ic,x)}onAdd(x){return this._map=x,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(l=!1){if(rs!==void 0&&!l)return rs;if(window.navigator.permissions===void 0)return rs=!!window.navigator.geolocation,rs;try{rs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{rs=!!window.navigator.geolocation}return rs})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ma=0,$s=!1}_isOutOfMapMaxBounds(x){const l=this._map.getMaxBounds(),f=x.coords;return l&&(f.longitude<l.getWest()||f.longitude>l.getEast()||f.latitude<l.getSouth()||f.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const x=this._map.getBounds(),l=x.getSouthEast(),f=x.getNorthEast(),g=l.distanceTo(f),b=Math.ceil(this._accuracy/(g/this._map._container.clientHeight)*2);this._circleElement.style.width=`${b}px`,this._circleElement.style.height=`${b}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ma--,$s=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ma++,ma>1?(x={maximumAge:6e5,timeout:0},$s=!0):(x=this.options.positionOptions,$s=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},c.Hash=iu,c.ImageSource=Kt,c.KeyboardHandler=ws,c.LngLatBounds=Ve,c.LogoControl=mf,c.Map=class extends Fi{constructor(x){if(a.bc.mark(a.bd.create),(x=a.e({},ol,x)).minZoom!=null&&x.maxZoom!=null&&x.minZoom>x.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(x.minPitch!=null&&x.maxPitch!=null&&x.minPitch>x.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(x.minPitch!=null&&x.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(x.maxPitch!=null&&x.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Kl(x.minZoom,x.maxZoom,x.minPitch,x.maxPitch,x.renderWorldCopies),{bearingSnap:x.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=x.interactive,this._maxTileCacheSize=x.maxTileCacheSize,this._maxTileCacheZoomLevels=x.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=x.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=x.preserveDrawingBuffer,this._antialias=x.antialias,this._trackResize=x.trackResize,this._bearingSnap=x.bearingSnap,this._refreshExpiredTiles=x.refreshExpiredTiles,this._fadeDuration=x.fadeDuration,this._crossSourceCollisions=x.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=x.collectResourceTiming,this._renderTaskQueue=new rl,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},fu,x.locale),this._clickTolerance=x.clickTolerance,this._overridePixelRatio=x.pixelRatio,this._maxCanvasSize=x.maxCanvasSize,this.transformCameraUpdate=x.transformCameraUpdate,this._imageQueueHandle=F.addThrottleControl(()=>this.isMoving()),this._requestManager=new N(x.transformRequest),typeof x.container=="string"){if(this._container=document.getElementById(x.container),!this._container)throw new Error(`Container '${x.container}' not found.`)}else{if(!(x.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=x.container}if(x.maxBounds&&this.setMaxBounds(x.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const f=ru(g=>{this._trackResize&&!this._removed&&this.resize(g)._update()},50);this._resizeObserver=new ResizeObserver(g=>{l?f(g):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new cu(this,x),this._hash=x.hash&&new iu(typeof x.hash=="string"&&x.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:x.center,zoom:x.zoom,bearing:x.bearing,pitch:x.pitch}),x.bounds&&(this.resize(),this.fitBounds(x.bounds,a.e({},x.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=x.localIdeographFontFamily,this._validateStyle=x.validateStyle,x.style&&this.setStyle(x.style,{localIdeographFontFamily:x.localIdeographFontFamily}),x.attributionControl&&this.addControl(new ko(typeof x.attributionControl=="boolean"?void 0:x.attributionControl)),x.maplibreLogo&&this.addControl(new mf,x.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new a.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new a.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new a.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(x,l){if(l===void 0&&(l=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=x.onAdd(this);this._controls.push(x);const g=this._controlPositions[l];return l.indexOf("bottom")!==-1?g.insertBefore(f,g.firstChild):g.appendChild(f),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(x);return l>-1&&this._controls.splice(l,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}calculateCameraOptionsFromTo(x,l,f,g){return g==null&&this.terrain&&(g=this.terrain.getElevationForLngLatZoom(f,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,l,f,g)}resize(x){var l;const f=this._containerDimensions(),g=f[0],b=f[1],k=this._getClampedPixelRatio(g,b);if(this._resizeCanvas(g,b,k),this.painter.resize(g,b,k),this.painter.overLimit()){const A=this.painter.context.gl;this._maxCanvasSize=[A.drawingBufferWidth,A.drawingBufferHeight];const B=this._getClampedPixelRatio(g,b);this._resizeCanvas(g,b,B),this.painter.resize(g,b,B)}this.transform.resize(g,b),(l=this._requestedCameraState)===null||l===void 0||l.resize(g,b);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",x)).fire(new a.k("move",x))),this.fire(new a.k("resize",x)),E&&this.fire(new a.k("moveend",x)),this}_getClampedPixelRatio(x,l){const{0:f,1:g}=this._maxCanvasSize,b=this.getPixelRatio(),k=x*b,E=l*b;return Math.min(k>f?f/k:1,E>g?g/E:1)*b}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(Ve.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this._update()}project(x){return this.transform.locationPoint(a.M.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.pointLocation(a.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,l,f){if(x==="mouseenter"||x==="mouseover"){let g=!1;return{layer:l,listener:f,delegates:{mousemove:k=>{const E=this.getLayer(l)?this.queryRenderedFeatures(k.point,{layers:[l]}):[];E.length?g||(g=!0,f.call(this,new Ri(x,this,k.originalEvent,{features:E}))):g=!1},mouseout:()=>{g=!1}}}}if(x==="mouseleave"||x==="mouseout"){let g=!1;return{layer:l,listener:f,delegates:{mousemove:E=>{(this.getLayer(l)?this.queryRenderedFeatures(E.point,{layers:[l]}):[]).length?g=!0:g&&(g=!1,f.call(this,new Ri(x,this,E.originalEvent)))},mouseout:E=>{g&&(g=!1,f.call(this,new Ri(x,this,E.originalEvent)))}}}}{const g=b=>{const k=this.getLayer(l)?this.queryRenderedFeatures(b.point,{layers:[l]}):[];k.length&&(b.features=k,f.call(this,b),delete b.features)};return{layer:l,listener:f,delegates:{[x]:g}}}}on(x,l,f){if(f===void 0)return super.on(x,l);const g=this._createDelegatedListener(x,l,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(g);for(const b in g.delegates)this.on(b,g.delegates[b]);return this}once(x,l,f){if(f===void 0)return super.once(x,l);const g=this._createDelegatedListener(x,l,f);for(const b in g.delegates)this.once(b,g.delegates[b]);return this}off(x,l,f){return f===void 0?super.off(x,l):(this._delegatedListeners&&this._delegatedListeners[x]&&(g=>{const b=this._delegatedListeners[x];for(let k=0;k<b.length;k++){const E=b[k];if(E.layer===l&&E.listener===f){for(const A in E.delegates)this.off(A,E.delegates[A]);return b.splice(k,1),this}}})(),this)}queryRenderedFeatures(x,l){if(!this.style)return[];let f;const g=x instanceof a.P||Array.isArray(x),b=g?x:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(g?{}:x)||{},b instanceof a.P||typeof b[0]=="number")f=[a.P.convert(b)];else{const k=a.P.convert(b[0]),E=a.P.convert(b[1]);f=[k,new a.P(E.x,k.y),E,new a.P(k.x,E.y),k]}return this.style.queryRenderedFeatures(f,l,this.transform)}querySourceFeatures(x,l){return this.style.querySourceFeatures(x,l)}setStyle(x,l){return(l=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(x,l))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const l=this._locale[x];if(l==null)throw new Error(`Missing UI string '${x}'`);return l}_updateStyle(x,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(x,l));const f=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new Xi(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,l,f):this.style.loadJSON(x,l,f),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Xi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,l){if(typeof x=="string"){const f=this._requestManager.transformRequest(x,"Style");a.h(f,new AbortController).then(g=>{this._updateDiff(g.data,l)}).catch(g=>{g&&this.fire(new a.j(g))})}else typeof x=="object"&&this._updateDiff(x,l)}_updateDiff(x,l){try{this.style.setState(x,l)&&this._update(!0)}catch(f){a.w(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(x,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(x,l){return this._lazyInitEmptyStyle(),this.style.addSource(x,l),this._update(!0)}isSourceLoaded(x){const l=this.style&&this.style.sourceCaches[x];if(l!==void 0)return l.loaded();this.fire(new a.j(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const l=this.style.sourceCaches[x.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&l.reload();for(const f in this.style._layers){const g=this.style._layers[f];g.type==="hillshade"&&g.source===x.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gf(this.painter,l,x),this.painter.renderToTexture=new hu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=f=>{f.dataType==="style"?this.terrain.sourceCache.freeRtt():f.dataType==="source"&&f.tile&&(f.sourceId!==x.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(f.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:x})),this}getTerrain(){var x,l;return(l=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const l in x){const f=x[l]._tiles;for(const g in f){const b=f[g];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}addImage(x,l,f={}){const{pixelRatio:g=1,sdf:b=!1,stretchX:k,stretchY:E,content:A}=f;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||a.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:G,data:X}=l,Y=l;return this.style.addImage(x,{data:new a.R({width:B,height:G},new Uint8Array(X)),pixelRatio:g,stretchX:k,stretchY:E,content:A,sdf:b,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,x),this}}{const{width:B,height:G,data:X}=y.getImageData(l);this.style.addImage(x,{data:new a.R({width:B,height:G},X),pixelRatio:g,stretchX:k,stretchY:E,content:A,sdf:b,version:0})}}updateImage(x,l){const f=this.style.getImage(x);if(!f)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=l instanceof HTMLImageElement||a.b(l)?y.getImageData(l):l,{width:b,height:k,data:E}=g;if(b===void 0||k===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==f.data.width||k!==f.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const A=!(l instanceof HTMLImageElement||a.b(l));return f.data.replace(E,A),this.style.updateImage(x,f),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return F.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,l){return this._lazyInitEmptyStyle(),this.style.addLayer(x,l),this._update(!0)}moveLayer(x,l){return this.style.moveLayer(x,l),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,l,f){return this.style.setLayerZoomRange(x,l,f),this._update(!0)}setFilter(x,l,f={}){return this.style.setFilter(x,l,f),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,l,f,g={}){return this.style.setPaintProperty(x,l,f,g),this._update(!0)}getPaintProperty(x,l){return this.style.getPaintProperty(x,l)}setLayoutProperty(x,l,f,g={}){return this.style.setLayoutProperty(x,l,f,g),this._update(!0)}getLayoutProperty(x,l){return this.style.getLayoutProperty(x,l)}setGlyphs(x,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,l,f={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,l,f,g=>{g||this._update(!0)}),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,l,f=>{f||this._update(!0)}),this}setLight(x,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(x,l){return this.style.setFeatureState(x,l),this._update()}removeFeatureState(x,l){return this.style.removeFeatureState(x,l),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,l=0;return this._container&&(x=this._container.clientWidth||400,l=this._container.clientHeight||300),[x,l]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const l=this._canvasContainer=w.create("div","maplibregl-canvas-container",x);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const f=this._containerDimensions(),g=this._getClampedPixelRatio(f[0],f[1]);this._resizeCanvas(f[0],f[1],g);const b=this._controlContainer=w.create("div","maplibregl-control-container",x),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{k[E]=w.create("div",`maplibregl-ctrl-${E} `,b)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,l,f){this._canvas.width=Math.floor(f*x),this._canvas.height=Math.floor(f*l),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const x={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",g=>{l={requestedAttributes:x},g&&(l.statusMessage=g.statusMessage,l.type=g.type)},{once:!0});const f=this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x);if(!f){const g="Failed to initialize WebGL";throw l?(l.message=g,new Error(JSON.stringify(l))):new Error(g)}this.painter=new nf(f,this.transform),T.testSupport(f)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let f=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const b=this.transform.zoom,k=y.now();this.style.zoomHistory.update(b,k);const E=new a.a8(b,{now:k,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),A=E.crossFadingFactor();A===1&&A===this._crossFadingFactor||(f=!0,this._crossFadingFactor=A),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||f)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const f of this._controls)f.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),F.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,y.frameAsync(this._frameRequest).then(x=>{a.bc.frame(x),this._frameRequest=null,this._render(x)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return du}getCameraTargetElevation(){return this.transform.elevation}},c.MapMouseEvent=Ri,c.MapTouchEvent=Uo,c.MapWheelEvent=ou,c.Marker=al,c.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const l=this._map.getZoom(),f=l===this._map.getMaxZoom(),g=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,f)=>{const g=this._map._getUIString(`NavigationControl.${f}`);l.title=g,l.setAttribute("aria-label",g)},this.options=a.e({},pu,x),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new mu(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,l){const f=w.create("button",x,this._container);return f.type="button",f.addEventListener("click",l),f}},c.Popup=class extends a.E{constructor(x){super(),this.remove=()=>(this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var f;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const A of this.options.className.split(" "))this._container.classList.add(A);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?nc(this._lngLat,this._flatPos,this._map.transform):(f=this._lngLat)===null||f===void 0?void 0:f.wrap(),this._trackPointer&&!l)return;const g=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let b=this.options.anchor;const k=ac(this.options.offset);if(!b){const A=this._container.offsetWidth,B=this._container.offsetHeight;let G;G=g.y+k.bottom.y<B?["top"]:g.y>this._map.transform.height-B?["bottom"]:[],g.x<A/2?G.push("left"):g.x>this._map.transform.width-A/2&&G.push("right"),b=G.length===0?"bottom":G.join("-")}let E=g.add(k[b]);this.options.subpixelPositioning||(E=E.round()),w.setTransform(this._container,`${sl[b]} translate(${E.x}px,${E.y}px)`),rc(this._container,b,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(gu),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=a.M.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const l=document.createDocumentFragment(),f=document.createElement("body");let g;for(f.innerHTML=x;g=f.firstChild,g;)l.appendChild(g);return this.setDOMContent(l)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){this._container&&this._container.classList.add(x)}removeClassName(x){this._container&&this._container.classList.remove(x)}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(_u);x&&x.focus()}},c.RasterDEMTileSource=Pn,c.RasterTileSource=_e,c.ScaleControl=class{constructor(x){this._onMove=()=>{sc(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,sc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},oc),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},c.ScrollZoomHandler=Ql,c.Style=Xi,c.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},c.TwoFingersTouchPitchHandler=hf,c.TwoFingersTouchRotateHandler=au,c.TwoFingersTouchZoomHandler=uf,c.TwoFingersTouchZoomRotateHandler=tl,c.VectorTileSource=Ut,c.VideoSource=er,c.addSourceType=(x,l)=>a._(void 0,void 0,void 0,function*(){if(Qr(x))throw new Error(`A source type called "${x}" already exists.`);((f,g)=>{gr[f]=g})(x,l)}),c.clearPrewarmedResources=function(){const x=$t;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(mt),$t=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},c.getRTLTextPluginStatus=function(){return bt().getRTLTextPluginStatus()},c.getVersion=function(){return _f},c.getWorkerCount=function(){return dt.workerCount},c.getWorkerUrl=function(){return a.a.WORKER_URL},c.importScriptInWorkers=function(x){return Qt().broadcast("IS",x)},c.prewarm=function(){Rt().acquire(mt)},c.setMaxParallelImageRequests=function(x){a.a.MAX_PARALLEL_IMAGE_REQUESTS=x},c.setRTLTextPlugin=function(x,l){return bt().setRTLTextPlugin(x,l)},c.setWorkerCount=function(x){dt.workerCount=x},c.setWorkerUrl=function(x){a.a.WORKER_URL=x}});var o=t;return o})})(xb);var Ks=xb.exports;const Jr=wb(Ks),ux=V2({__proto__:null,default:Jr},[Ks]);let sn;const Sb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Sb.decode();let Ku=null;function rh(){return(Ku===null||Ku.byteLength===0)&&(Ku=new Uint8Array(sn.memory.buffer)),Ku}function Ko(r,e){return r=r>>>0,Sb.decode(rh().subarray(r,r+e))}const Zs=new Array(128).fill(void 0);Zs.push(void 0,null,!0,!1);let ih=Zs.length;function Xr(r){ih===Zs.length&&Zs.push(Zs.length+1);const e=ih;return ih=Zs[e],Zs[e]=r,e}function Gn(r){return Zs[r]}function hx(r){r<132||(Zs[r]=ih,ih=r)}function Lc(r){const e=Gn(r);return hx(r),e}function Op(r){return r==null}let Xu=null;function fx(){return(Xu===null||Xu.byteLength===0)&&(Xu=new Float64Array(sn.memory.buffer)),Xu}let Ju=null;function Xn(){return(Ju===null||Ju.byteLength===0)&&(Ju=new Int32Array(sn.memory.buffer)),Ju}let Ca=0;const Kf=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},dx=typeof Kf.encodeInto=="function"?function(r,e){return Kf.encodeInto(r,e)}:function(r,e){const t=Kf.encode(r);return e.set(t),{read:r.length,written:t.length}};function jf(r,e,t){if(t===void 0){const a=Kf.encode(r),d=e(a.length,1)>>>0;return rh().subarray(d,d+a.length).set(a),Ca=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=rh();let c=0;for(;c<n;c++){const a=r.charCodeAt(c);if(a>127)break;o[i+c]=a}if(c!==n){c!==0&&(r=r.slice(c)),i=t(i,n,n=c+r.length*3,1)>>>0;const a=rh().subarray(i+c,i+n),d=dx(r,a);c+=d.written}return Ca=c,i}function nm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=nm(r[0]));for(let c=1;c<i;c++)o+=", "+nm(r[c]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function px(r,e){const t=e(r.length*1,1)>>>0;return rh().set(r,t/1),Ca=r.length,t}function Np(r,e){try{return r.apply(this,e)}catch(t){sn.__wbindgen_exn_store(Xr(t))}}class sd{static __wrap(e){e=e>>>0;const t=Object.create(sd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();sn.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=sn.__wbindgen_add_to_stack_pointer(-16),c=px(e,sn.__wbindgen_malloc),a=Ca;sn.jsroutesnapper_new(o,c,a);var t=Xn()[o/4+0],n=Xn()[o/4+1],i=Xn()[o/4+2];if(i)throw Lc(n);return sd.__wrap(t)}finally{sn.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){sn.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Xr(e))}setAreaMode(){sn.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=sn.__wbindgen_add_to_stack_pointer(-16);sn.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=Xn()[o/4+0],i=Xn()[o/4+1];return e=n,t=i,Ko(n,i)}finally{sn.__wbindgen_add_to_stack_pointer(16),sn.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=sn.__wbindgen_add_to_stack_pointer(-16);sn.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Xn()[n/4+0],t=Xn()[n/4+1];let i;return e!==0&&(i=Ko(e,t).slice(),sn.__wbindgen_free(e,t*1)),i}finally{sn.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=sn.__wbindgen_add_to_stack_pointer(-16);sn.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=Xn()[o/4+0],i=Xn()[o/4+1];return e=n,t=i,Ko(n,i)}finally{sn.__wbindgen_add_to_stack_pointer(16),sn.__wbindgen_free(e,t,1)}}toggleSnapMode(){sn.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return sn.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){sn.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return sn.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return sn.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){sn.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=sn.__wbindgen_add_to_stack_pointer(-16);sn.jsroutesnapper_editExisting(i,this.__wbg_ptr,Xr(e));var t=Xn()[i/4+0],n=Xn()[i/4+1];if(n)throw Lc(t)}finally{sn.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=sn.__wbindgen_add_to_stack_pointer(-16);sn.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=Xn()[o/4+0],i=Xn()[o/4+1];return e=n,t=i,Ko(n,i)}finally{sn.__wbindgen_add_to_stack_pointer(16),sn.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=sn.__wbindgen_add_to_stack_pointer(-16);sn.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=Xn()[o/4+0],i=Xn()[o/4+1];return e=n,t=i,Ko(n,i)}finally{sn.__wbindgen_add_to_stack_pointer(16),sn.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const _=sn.__wbindgen_add_to_stack_pointer(-16);sn.jsroutesnapper_routeNameForWaypoints(_,this.__wbg_ptr,Xr(e));var i=Xn()[_/4+0],o=Xn()[_/4+1],c=Xn()[_/4+2],a=Xn()[_/4+3],d=i,p=o;if(a)throw d=0,p=0,Lc(c);return t=d,n=p,Ko(d,p)}finally{sn.__wbindgen_add_to_stack_pointer(16),sn.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){sn.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){sn.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const _=sn.__wbindgen_add_to_stack_pointer(-16);sn.jsroutesnapper_calculateRoute(_,this.__wbg_ptr,Xr(e));var i=Xn()[_/4+0],o=Xn()[_/4+1],c=Xn()[_/4+2],a=Xn()[_/4+3],d=i,p=o;if(a)throw d=0,p=0,Lc(c);return t=d,n=p,Ko(d,p)}finally{sn.__wbindgen_add_to_stack_pointer(16),sn.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const y=sn.__wbindgen_add_to_stack_pointer(-16);sn.jsroutesnapper_getExtraNodes(y,this.__wbg_ptr,Xr(e),Xr(t));var o=Xn()[y/4+0],c=Xn()[y/4+1],a=Xn()[y/4+2],d=Xn()[y/4+3],p=o,_=c;if(d)throw p=0,_=0,Lc(a);return n=p,i=_,Ko(p,_)}finally{sn.__wbindgen_add_to_stack_pointer(16),sn.__wbindgen_free(n,i,1)}}}async function mx(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function gx(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ko(e,t);return Xr(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Lc(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ko(e,t));return Xr(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Gn(t),i=typeof n=="number"?n:void 0;fx()[e/8+1]=Op(i)?0:i,Xn()[e/4+0]=!Op(i)},r.wbg.__wbindgen_is_object=function(e){const t=Gn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Gn(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Gn(e)in Gn(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Gn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Gn(e)==Gn(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Gn(t),i=typeof n=="string"?n:void 0;var o=Op(i)?0:jf(i,sn.__wbindgen_malloc,sn.__wbindgen_realloc),c=Ca;Xn()[e/4+1]=c,Xn()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Gn(t)),i=jf(n,sn.__wbindgen_malloc,sn.__wbindgen_realloc),o=Ca;Xn()[e/4+1]=o,Xn()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Gn(e);return Xr(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Gn(e)[Gn(t)];return Xr(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Xr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Gn(t).stack,i=jf(n,sn.__wbindgen_malloc,sn.__wbindgen_realloc),o=Ca;Xn()[e/4+1]=o,Xn()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Ko(e,t))}finally{sn.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Gn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Gn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Gn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Gn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Gn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Gn(e)[t>>>0];return Xr(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Gn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Gn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Gn(e).next;return Xr(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Np(function(e){const t=Gn(e).next();return Xr(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Gn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Gn(e).value;return Xr(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Xr(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Np(function(e,t){const n=Reflect.get(Gn(e),Gn(t));return Xr(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Np(function(e,t){const n=Gn(e).call(Gn(t));return Xr(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Gn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Gn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Gn(e).buffer;return Xr(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Gn(e));return Xr(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Gn(e).set(Gn(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Gn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Gn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=nm(Gn(t)),i=jf(n,sn.__wbindgen_malloc,sn.__wbindgen_realloc),o=Ca;Xn()[e/4+1]=o,Xn()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ko(e,t))},r.wbg.__wbindgen_memory=function(){const e=sn.memory;return Xr(e)},r}function _x(r,e){return sn=r.exports,Cb.__wbindgen_wasm_module=e,Xu=null,Ju=null,Ku=null,sn}async function Cb(r){if(sn!==void 0)return sn;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=gx();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await mx(await r,e);return _x(t,n)}var qi=63710088e-1,Fm={centimeters:qi*100,centimetres:qi*100,degrees:qi/111325,feet:qi*3.28084,inches:qi*39.37,kilometers:qi/1e3,kilometres:qi/1e3,meters:qi,metres:qi,miles:qi/1609.344,millimeters:qi*1e3,millimetres:qi*1e3,nauticalmiles:qi/1852,radians:1,yards:qi*1.0936},yx={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/qi,yards:1.0936133},rm={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ts(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function bx(r,e,t){switch(r){case"Point":return _o(e).geometry;case"LineString":return Jo(e).geometry;case"Polygon":return Bm(e).geometry;case"MultiPoint":return Mb(e).geometry;case"MultiLineString":return Tb(e).geometry;case"MultiPolygon":return Lb(e).geometry;default:throw new Error(r+" is invalid")}}function _o(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ad(r[0])||!ad(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return ts(n,e,t)}function vx(r,e,t){return t===void 0&&(t={}),gl(r.map(function(n){return _o(n,e)}),t)}function Bm(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var c=0;c<o[o.length-1].length;c++)if(o[o.length-1][c]!==o[0][c])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:r};return ts(a,e,t)}function wx(r,e,t){return t===void 0&&(t={}),gl(r.map(function(n){return Bm(n,e)}),t)}function Jo(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return ts(n,e,t)}function xx(r,e,t){return t===void 0&&(t={}),gl(r.map(function(n){return Jo(n,e)}),t)}function gl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Tb(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return ts(n,e,t)}function Mb(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return ts(n,e,t)}function Lb(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return ts(n,e,t)}function kx(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return ts(n,e,t)}function Sx(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function Om(r,e){e===void 0&&(e="kilometers");var t=Fm[e];if(!t)throw new Error(e+" units is invalid");return r*t}function vd(r,e){e===void 0&&(e="kilometers");var t=Fm[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Cx(r,e){return dh(vd(r,e))}function Tx(r){var e=r%360;return e<0&&(e+=360),e}function dh(r){var e=r%(2*Math.PI);return e*180/Math.PI}function Yo(r){var e=r%360;return e*Math.PI/180}function Mx(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return Om(vd(r,e),t)}function Lx(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=rm[e];if(!n)throw new Error("invalid original units");var i=rm[t];if(!i)throw new Error("invalid final units");return r/n*i}function ad(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Nm(r){return!!r&&r.constructor===Object}function Ex(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!ad(e))throw new Error("bbox must only contain numbers")})}function Ix(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const Ax=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:rm,bearingToAzimuth:Tx,convertArea:Lx,convertLength:Mx,degreesToRadians:Yo,earthRadius:qi,factors:Fm,feature:ts,featureCollection:gl,geometry:bx,geometryCollection:kx,isNumber:ad,isObject:Nm,lengthToDegrees:Cx,lengthToRadians:vd,lineString:Jo,lineStrings:xx,multiLineString:Tb,multiPoint:Mb,multiPolygon:Lb,point:_o,points:vx,polygon:Bm,polygons:wx,radiansToDegrees:dh,radiansToLength:Om,round:Sx,unitsFactors:yx,validateBBox:Ex,validateId:Ix},Symbol.toStringTag,{value:"Module"}));function ph(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Rc(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Nu(r,e,t){t===void 0&&(t={});var n=ph(r),i=ph(e),o=Yo(i[1]-n[1]),c=Yo(i[0]-n[0]),a=Yo(n[1]),d=Yo(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(a)*Math.cos(d);return Om(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function Mh(r,e,t){if(r!==null)for(var n,i,o,c,a,d,p,_=0,y=0,w,T=r.type,M=T==="FeatureCollection",$=T==="Feature",D=M?r.features.length:1,z=0;z<D;z++){p=M?r.features[z].geometry:$?r.geometry:r,w=p?p.type==="GeometryCollection":!1,a=w?p.geometries.length:1;for(var I=0;I<a;I++){var F=0,N=0;if(c=w?p.geometries[I]:p,c!==null){d=c.coordinates;var W=c.type;switch(_=t&&(W==="Polygon"||W==="MultiPolygon")?1:0,W){case null:break;case"Point":if(e(d,y,z,F,N)===!1)return!1;y++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,z,F,N)===!1)return!1;y++,W==="MultiPoint"&&F++}W==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-_;i++){if(e(d[n][i],y,z,F,N)===!1)return!1;y++}W==="MultiLineString"&&F++,W==="Polygon"&&N++}W==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(N=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-_;o++){if(e(d[n][i][o],y,z,F,N)===!1)return!1;y++}N++}F++}break;case"GeometryCollection":for(n=0;n<c.geometries.length;n++)if(Mh(c.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Px(r,e,t,n){var i=t;return Mh(r,function(o,c,a,d,p){c===0&&t===void 0?i=o:i=e(i,o,c,a,d,p)},n),i}function Eb(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function zx(r,e,t){var n=t;return Eb(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function ld(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function Dx(r,e,t){var n=t;return ld(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function $x(r){var e=[];return Mh(r,function(t){e.push(t)}),e}function jm(r,e){var t,n,i,o,c,a,d,p,_,y,w=0,T=r.type==="FeatureCollection",M=r.type==="Feature",$=T?r.features.length:1;for(t=0;t<$;t++){for(a=T?r.features[t].geometry:M?r.geometry:r,p=T?r.features[t].properties:M?r.properties:{},_=T?r.features[t].bbox:M?r.bbox:void 0,y=T?r.features[t].id:M?r.id:void 0,d=a?a.type==="GeometryCollection":!1,c=d?a.geometries.length:1,i=0;i<c;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,w,p,_,y)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,w,p,_,y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],w,p,_,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function Rx(r,e,t){var n=t;return jm(r,function(i,o,c,a,d){o===0&&t===void 0?n=i:n=e(n,i,o,c,a,d)}),n}function Oc(r,e){jm(r,function(t,n,i,o,c){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(ts(t,i,{bbox:o,id:c}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var _=t.coordinates[p],y={type:d,coordinates:_};if(e(ts(y,i),n,p)===!1)return!1}})}function Fx(r,e,t){var n=t;return Oc(r,function(i,o,c){o===0&&c===0&&t===void 0?n=i:n=e(n,i,o,c)}),n}function Ib(r,e){Oc(r,function(t,n,i){var o=0;if(t.geometry){var c=t.geometry.type;if(!(c==="Point"||c==="MultiPoint")){var a,d=0,p=0,_=0;if(Mh(t,function(y,w,T,M,$){if(a===void 0||n>d||M>p||$>_){a=y,d=n,p=M,_=$,o=0;return}var D=Jo([a,y],t.properties);if(e(D,n,i,$,o)===!1)return!1;o++,a=y})===!1)return!1}}})}function Bx(r,e,t){var n=t,i=!1;return Ib(r,function(o,c,a,d,p){i===!1&&t===void 0?n=o:n=e(n,o,c,a,d,p),i=!0}),n}function Ab(r,e){if(!r)throw new Error("geojson is required");Oc(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,c=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<c.length;a++)if(e(Jo(c[a],t.properties),n,i,a)===!1)return!1;break}}})}function Ox(r,e,t){var n=t;return Ab(r,function(i,o,c,a){o===0&&t===void 0?n=i:n=e(n,i,o,c,a)}),n}function Nx(r,e){if(e=e||{},!Nm(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,c=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),c=c||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":c=c||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),Jo([d[o],d[o+1]],c,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),Jo([d[i][o],d[i][o+1]],c,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),Jo([d[n][o],d[n][o+1]],c,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o-1),Jo([d[n][i][o],d[n][i][o+1]],c,e)}throw new Error("geojson is invalid")}function jx(r,e){if(e=e||{},!Nm(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,c=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),c=c||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":c=c||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":return _o(d,c,e);case"MultiPoint":return n<0&&(n=d.length+n),_o(d[n],c,e);case"LineString":return o<0&&(o=d.length+o),_o(d[o],c,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),_o(d[i][o],c,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),_o(d[n][o],c,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o),_o(d[n][i][o],c,e)}throw new Error("geojson is invalid")}const Ux=Object.freeze(Object.defineProperty({__proto__:null,coordAll:$x,coordEach:Mh,coordReduce:Px,featureEach:ld,featureReduce:Dx,findPoint:jx,findSegment:Nx,flattenEach:Oc,flattenReduce:Fx,geomEach:jm,geomReduce:Rx,lineEach:Ab,lineReduce:Ox,propEach:Eb,propReduce:zx,segmentEach:Ib,segmentReduce:Bx},Symbol.toStringTag,{value:"Module"}));function Pb(r,e,t){if(t===void 0&&(t={}),t.final===!0)return Vx(r,e);var n=ph(r),i=ph(e),o=Yo(n[0]),c=Yo(i[0]),a=Yo(n[1]),d=Yo(i[1]),p=Math.sin(c-o)*Math.cos(d),_=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(c-o);return dh(Math.atan2(p,_))}function Vx(r,e){var t=Pb(e,r);return t=(t+180)%360,t}function N_(r,e,t,n){n===void 0&&(n={});var i=ph(r),o=Yo(i[0]),c=Yo(i[1]),a=Yo(t),d=vd(e,n.units),p=Math.asin(Math.sin(c)*Math.cos(d)+Math.cos(c)*Math.sin(d)*Math.cos(a)),_=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(c),Math.cos(d)-Math.sin(c)*Math.sin(p)),y=dh(_),w=dh(p);return _o([y,w],n.properties)}function j_(r){if(!r)throw new Error("geojson is required");var e=[];return Oc(r,function(t){qx(t,e)}),gl(e)}function qx(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Rc(n);break;case"LineString":t=[Rc(n)]}t.forEach(function(i){var o=Zx(i,r.properties);o.forEach(function(c){c.id=e.length,e.push(c)})})}}function Zx(r,e){var t=[];return r.reduce(function(n,i){var o=Jo([n,i],e);return o.bbox=Gx(n,i),t.push(o),i}),t}function Gx(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],c=t<i?t:i,a=n<o?n:o,d=t>i?t:i,p=n>o?n:o;return[c,a,d,p]}var Um={exports:{}},zb={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(vb,function(){function t(I,F,N,W,oe){(function J(ee,pe,Ie,Q,ae){for(;Q>Ie;){if(Q-Ie>600){var Pe=Q-Ie+1,ve=pe-Ie+1,nt=Math.log(Pe),Ge=.5*Math.exp(2*nt/3),Ee=.5*Math.sqrt(nt*Ge*(Pe-Ge)/Pe)*(ve-Pe/2<0?-1:1),De=Math.max(Ie,Math.floor(pe-ve*Ge/Pe+Ee)),Ct=Math.min(Q,Math.floor(pe+(Pe-ve)*Ge/Pe+Ee));J(ee,pe,De,Ct,ae)}var it=ee[pe],lt=Ie,mt=Q;for(n(ee,Ie,pe),ae(ee[Q],it)>0&&n(ee,Ie,Q);lt<mt;){for(n(ee,lt,mt),lt++,mt--;ae(ee[lt],it)<0;)lt++;for(;ae(ee[mt],it)>0;)mt--}ae(ee[Ie],it)===0?n(ee,Ie,mt):n(ee,++mt,Q),mt<=pe&&(Ie=mt+1),pe<=mt&&(Q=mt-1)}})(I,F,N||0,W||I.length-1,oe||i)}function n(I,F,N){var W=I[F];I[F]=I[N],I[N]=W}function i(I,F){return I<F?-1:I>F?1:0}var o=function(I){I===void 0&&(I=9),this._maxEntries=Math.max(4,I),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function c(I,F,N){if(!N)return F.indexOf(I);for(var W=0;W<F.length;W++)if(N(I,F[W]))return W;return-1}function a(I,F){d(I,0,I.children.length,F,I)}function d(I,F,N,W,oe){oe||(oe=D(null)),oe.minX=1/0,oe.minY=1/0,oe.maxX=-1/0,oe.maxY=-1/0;for(var J=F;J<N;J++){var ee=I.children[J];p(oe,I.leaf?W(ee):ee)}return oe}function p(I,F){return I.minX=Math.min(I.minX,F.minX),I.minY=Math.min(I.minY,F.minY),I.maxX=Math.max(I.maxX,F.maxX),I.maxY=Math.max(I.maxY,F.maxY),I}function _(I,F){return I.minX-F.minX}function y(I,F){return I.minY-F.minY}function w(I){return(I.maxX-I.minX)*(I.maxY-I.minY)}function T(I){return I.maxX-I.minX+(I.maxY-I.minY)}function M(I,F){return I.minX<=F.minX&&I.minY<=F.minY&&F.maxX<=I.maxX&&F.maxY<=I.maxY}function $(I,F){return F.minX<=I.maxX&&F.minY<=I.maxY&&F.maxX>=I.minX&&F.maxY>=I.minY}function D(I){return{children:I,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function z(I,F,N,W,oe){for(var J=[F,N];J.length;)if(!((N=J.pop())-(F=J.pop())<=W)){var ee=F+Math.ceil((N-F)/W/2)*W;t(I,ee,F,N,oe),J.push(F,ee,ee,N)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(I){var F=this.data,N=[];if(!$(I,F))return N;for(var W=this.toBBox,oe=[];F;){for(var J=0;J<F.children.length;J++){var ee=F.children[J],pe=F.leaf?W(ee):ee;$(I,pe)&&(F.leaf?N.push(ee):M(I,pe)?this._all(ee,N):oe.push(ee))}F=oe.pop()}return N},o.prototype.collides=function(I){var F=this.data;if(!$(I,F))return!1;for(var N=[];F;){for(var W=0;W<F.children.length;W++){var oe=F.children[W],J=F.leaf?this.toBBox(oe):oe;if($(I,J)){if(F.leaf||M(I,J))return!0;N.push(oe)}}F=N.pop()}return!1},o.prototype.load=function(I){if(!I||!I.length)return this;if(I.length<this._minEntries){for(var F=0;F<I.length;F++)this.insert(I[F]);return this}var N=this._build(I.slice(),0,I.length-1,0);if(this.data.children.length)if(this.data.height===N.height)this._splitRoot(this.data,N);else{if(this.data.height<N.height){var W=this.data;this.data=N,N=W}this._insert(N,this.data.height-N.height-1,!0)}else this.data=N;return this},o.prototype.insert=function(I){return I&&this._insert(I,this.data.height-1),this},o.prototype.clear=function(){return this.data=D([]),this},o.prototype.remove=function(I,F){if(!I)return this;for(var N,W,oe,J=this.data,ee=this.toBBox(I),pe=[],Ie=[];J||pe.length;){if(J||(J=pe.pop(),W=pe[pe.length-1],N=Ie.pop(),oe=!0),J.leaf){var Q=c(I,J.children,F);if(Q!==-1)return J.children.splice(Q,1),pe.push(J),this._condense(pe),this}oe||J.leaf||!M(J,ee)?W?(N++,J=W.children[N],oe=!1):J=null:(pe.push(J),Ie.push(N),N=0,W=J,J=J.children[0])}return this},o.prototype.toBBox=function(I){return I},o.prototype.compareMinX=function(I,F){return I.minX-F.minX},o.prototype.compareMinY=function(I,F){return I.minY-F.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(I){return this.data=I,this},o.prototype._all=function(I,F){for(var N=[];I;)I.leaf?F.push.apply(F,I.children):N.push.apply(N,I.children),I=N.pop();return F},o.prototype._build=function(I,F,N,W){var oe,J=N-F+1,ee=this._maxEntries;if(J<=ee)return a(oe=D(I.slice(F,N+1)),this.toBBox),oe;W||(W=Math.ceil(Math.log(J)/Math.log(ee)),ee=Math.ceil(J/Math.pow(ee,W-1))),(oe=D([])).leaf=!1,oe.height=W;var pe=Math.ceil(J/ee),Ie=pe*Math.ceil(Math.sqrt(ee));z(I,F,N,Ie,this.compareMinX);for(var Q=F;Q<=N;Q+=Ie){var ae=Math.min(Q+Ie-1,N);z(I,Q,ae,pe,this.compareMinY);for(var Pe=Q;Pe<=ae;Pe+=pe){var ve=Math.min(Pe+pe-1,ae);oe.children.push(this._build(I,Pe,ve,W-1))}}return a(oe,this.toBBox),oe},o.prototype._chooseSubtree=function(I,F,N,W){for(;W.push(F),!F.leaf&&W.length-1!==N;){for(var oe=1/0,J=1/0,ee=void 0,pe=0;pe<F.children.length;pe++){var Ie=F.children[pe],Q=w(Ie),ae=(Pe=I,ve=Ie,(Math.max(ve.maxX,Pe.maxX)-Math.min(ve.minX,Pe.minX))*(Math.max(ve.maxY,Pe.maxY)-Math.min(ve.minY,Pe.minY))-Q);ae<J?(J=ae,oe=Q<oe?Q:oe,ee=Ie):ae===J&&Q<oe&&(oe=Q,ee=Ie)}F=ee||F.children[0]}var Pe,ve;return F},o.prototype._insert=function(I,F,N){var W=N?I:this.toBBox(I),oe=[],J=this._chooseSubtree(W,this.data,F,oe);for(J.children.push(I),p(J,W);F>=0&&oe[F].children.length>this._maxEntries;)this._split(oe,F),F--;this._adjustParentBBoxes(W,oe,F)},o.prototype._split=function(I,F){var N=I[F],W=N.children.length,oe=this._minEntries;this._chooseSplitAxis(N,oe,W);var J=this._chooseSplitIndex(N,oe,W),ee=D(N.children.splice(J,N.children.length-J));ee.height=N.height,ee.leaf=N.leaf,a(N,this.toBBox),a(ee,this.toBBox),F?I[F-1].children.push(ee):this._splitRoot(N,ee)},o.prototype._splitRoot=function(I,F){this.data=D([I,F]),this.data.height=I.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(I,F,N){for(var W,oe,J,ee,pe,Ie,Q,ae=1/0,Pe=1/0,ve=F;ve<=N-F;ve++){var nt=d(I,0,ve,this.toBBox),Ge=d(I,ve,N,this.toBBox),Ee=(oe=nt,J=Ge,ee=void 0,pe=void 0,Ie=void 0,Q=void 0,ee=Math.max(oe.minX,J.minX),pe=Math.max(oe.minY,J.minY),Ie=Math.min(oe.maxX,J.maxX),Q=Math.min(oe.maxY,J.maxY),Math.max(0,Ie-ee)*Math.max(0,Q-pe)),De=w(nt)+w(Ge);Ee<ae?(ae=Ee,W=ve,Pe=De<Pe?De:Pe):Ee===ae&&De<Pe&&(Pe=De,W=ve)}return W||N-F},o.prototype._chooseSplitAxis=function(I,F,N){var W=I.leaf?this.compareMinX:_,oe=I.leaf?this.compareMinY:y;this._allDistMargin(I,F,N,W)<this._allDistMargin(I,F,N,oe)&&I.children.sort(W)},o.prototype._allDistMargin=function(I,F,N,W){I.children.sort(W);for(var oe=this.toBBox,J=d(I,0,F,oe),ee=d(I,N-F,N,oe),pe=T(J)+T(ee),Ie=F;Ie<N-F;Ie++){var Q=I.children[Ie];p(J,I.leaf?oe(Q):Q),pe+=T(J)}for(var ae=N-F-1;ae>=F;ae--){var Pe=I.children[ae];p(ee,I.leaf?oe(Pe):Pe),pe+=T(ee)}return pe},o.prototype._adjustParentBBoxes=function(I,F,N){for(var W=N;W>=0;W--)p(F[W],I)},o.prototype._condense=function(I){for(var F=I.length-1,N=void 0;F>=0;F--)I[F].children.length===0?F>0?(N=I[F-1].children).splice(N.indexOf(I[F]),1):this.clear():a(I[F],this.toBBox)},o})})(zb);var Hx=zb.exports;const Wx=Rm(Ax),Kx=Rm(Ux);function Db(r,e,t){if(r!==null)for(var n,i,o,c,a,d,p,_=0,y=0,w,T=r.type,M=T==="FeatureCollection",$=T==="Feature",D=M?r.features.length:1,z=0;z<D;z++){p=M?r.features[z].geometry:$?r.geometry:r,w=p?p.type==="GeometryCollection":!1,a=w?p.geometries.length:1;for(var I=0;I<a;I++){var F=0,N=0;if(c=w?p.geometries[I]:p,c!==null){d=c.coordinates;var W=c.type;switch(_=t&&(W==="Polygon"||W==="MultiPolygon")?1:0,W){case null:break;case"Point":if(e(d,y,z,F,N)===!1)return!1;y++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,z,F,N)===!1)return!1;y++,W==="MultiPoint"&&F++}W==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-_;i++){if(e(d[n][i],y,z,F,N)===!1)return!1;y++}W==="MultiLineString"&&F++,W==="Polygon"&&N++}W==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(N=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-_;o++){if(e(d[n][i][o],y,z,F,N)===!1)return!1;y++}N++}F++}break;case"GeometryCollection":for(n=0;n<c.geometries.length;n++)if(Db(c.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $b(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Db(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var Xx=$b;const Jx=Object.freeze(Object.defineProperty({__proto__:null,bbox:$b,default:Xx},Symbol.toStringTag,{value:"Module"})),Yx=Rm(Jx);var Ms=Hx,Rb=Wx,Fb=Kx,wc=Yx.default,Qx=Fb.featureEach;Fb.coordEach;Rb.polygon;var U_=Rb.featureCollection;function Bb(r){var e=new Ms(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:wc(t),Ms.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:wc(i),n.push(i)}):Qx(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:wc(i),n.push(i)}),Ms.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:wc(t),Ms.prototype.remove.call(this,t,n)},e.clear=function(){return Ms.prototype.clear.call(this)},e.search=function(t){var n=Ms.prototype.search.call(this,this.toBBox(t));return U_(n)},e.collides=function(t){return Ms.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Ms.prototype.all.call(this);return U_(t)},e.toJSON=function(){return Ms.prototype.toJSON.call(this)},e.fromJSON=function(t){return Ms.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=wc(t);else if(t.type==="FeatureCollection")n=wc(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Um.exports=Bb;Um.exports.default=Bb;var ek=Um.exports;const tk=wb(ek);function nk(r,e){var t={},n=[];if(r.type==="LineString"&&(r=ts(r)),e.type==="LineString"&&(e=ts(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=V_(r,e);return i&&n.push(i),gl(n)}var o=tk();return o.load(j_(e)),ld(j_(r),function(c){ld(o.search(c),function(a){var d=V_(c,a);if(d){var p=Rc(d).join(",");t[p]||(t[p]=!0,n.push(d))}})}),gl(n)}function V_(r,e){var t=Rc(r),n=Rc(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],c=t[1][0],a=t[1][1],d=n[0][0],p=n[0][1],_=n[1][0],y=n[1][1],w=(y-p)*(c-i)-(_-d)*(a-o),T=(_-d)*(o-p)-(y-p)*(i-d),M=(c-i)*(o-p)-(a-o)*(i-d);if(w===0)return null;var $=T/w,D=M/w;if($>=0&&$<=1&&D>=0&&D<=1){var z=i+$*(c-i),I=o+$*(a-o);return _o([z,I])}return null}function rk(r,e,t){t===void 0&&(t={});var n=_o([1/0,1/0],{dist:1/0}),i=0;return Oc(r,function(o){for(var c=Rc(o),a=0;a<c.length-1;a++){var d=_o(c[a]);d.properties.dist=Nu(e,d,t);var p=_o(c[a+1]);p.properties.dist=Nu(e,p,t);var _=Nu(d,p,t),y=Math.max(d.properties.dist,p.properties.dist),w=Pb(d,p),T=N_(e,y,w+90,t),M=N_(e,y,w-90,t),$=nk(Jo([T.geometry.coordinates,M.geometry.coordinates]),Jo([d.geometry.coordinates,p.geometry.coordinates])),D=null;$.features.length>0&&(D=$.features[0],D.properties.dist=Nu(e,D,t),D.properties.location=i+Nu(d,D,t)),d.properties.dist<n.properties.dist&&(n=d,n.properties.index=a,n.properties.location=i),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=a+1,n.properties.location=i+_),D&&D.properties.dist<n.properties.dist&&(n=D,n.properties.index=a),i+=_}}),n}const ik=30;class ok{constructor(e,t,n,i,o){this.onMouseMove=c=>{if(!this.active)return;const a=[c.point.x-ik,c.point.y],d=this.map.unproject(c.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(c.lngLat.lng,c.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=c=>{this.active&&(c.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=c=>{if(!this.active)return;let a=c.target.tagName;a=="INPUT"||a=="TEXTAREA"||c.key=="Escape"&&(c.stopPropagation(),this.cancel())},this.onKeyPress=c=>{if(!this.active)return;let a=c.target.tagName;a=="INPUT"||a=="TEXTAREA"||(c.key=="Enter"?(c.stopPropagation(),this.finish()):c.key=="s"||c.key=="S"?(c.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):c.key=="z"&&c.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new sd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const xc=[];function jp(r,e){return{subscribe:$n(r,e).subscribe}}function $n(r,e=tt){let t;const n=new Set;function i(a){if(wt(r,a)&&(r=a,t)){const d=!xc.length;for(const p of n)p[1](),xc.push(p,r);if(d){for(let p=0;p<xc.length;p+=2)xc[p][0](xc[p+1]);xc.length=0}}}function o(a){i(a(r))}function c(a,d=tt){const p=[a,d];return n.add(p),n.size===1&&(t=e(i,o)||tt),a(r),()=>{n.delete(p),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:c}}class sk{constructor(){tr(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty  nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,2 .toString());return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new Up(n,1,Xf);for(const[o,c]of ak(n))for(const{projectKey:a,projectName:d}of c){let p=window.localStorage.getItem(a);if(!p){console.warn(`Project features not found for ${a}, skipping migration`);continue}let _=JSON.parse(p);_.app_focus=n,_.study_area_name=o,_.project_name=d,console.log(`migrating project ${a}`);let y=i.createProject(_);console.log(`Successfully migrated v0->v1 project ${a} -> ${i.projectKey(y)}`),window.localStorage.removeItem(a)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new Up(n,2,Xf);for(const[o,c]of i.projects()){if(c.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}c.db_schema_version=2,i.saveProject(o,c),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,2 .toString()),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new Up(e,this.storedSchemaVersion,Xf)}}const Xf=Symbol("internal_method_token");class Up{constructor(e,t,n){tr(this,"appFocus");tr(this,"dbSchemaVersion");if(n!==Xf)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t=this.project(e),n=`${t.project_name} LTN`,i=t.features.filter(a=>{var d;return((d=a.properties)==null?void 0:d.kind)=="boundary"}),o=n,c=1;for(;i.some(a=>{var d;return((d=a.properties)==null?void 0:d.name)==o});)c++,o=`${n} #${c}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.globalAndCntProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}globalAndCntProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function ak(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[c,a,d]=o.split("/");e.has(a)||e.set(a,[]),e.get(a).push({projectKey:o,projectName:d})}catch(c){console.log(`error loading cnt project: ${o}`,c)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let c=o.split("ltn_"),a=c[c.length-1],d="";try{d=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(p){console.log(`error loading global project: ${o}`,p)}d&&d.length>0?(e.has(d)||e.set(d,[]),e.get(d).push({projectKey:o,projectName:a})):t.push({projectKey:o,projectName:a})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const Ob="MZEJTanw3WpxRvt7qDfo";let Ro=$n(null),Fo=$n("global"),_l=$n(void 0),Vm=new sk,Qs=$n(Vm.projectStorage(di(Fo)));Fo.subscribe(r=>{Qs.set(Vm.projectStorage(r))});let oh=$n(!1),Ar=$n(null),sh=$n(new Ks.LngLat(0,0)),ah=$n(new Ks.LngLat(0,0)),Uf=$n(new Ks.LngLat(0,0)),q_=$n(1),oo=$n(1),an=$n({mode:"title",firstLoad:!0}),cd=$n(!1),im=$n("streets-v2"),om=$n("walk_cycle_only"),Z_=$n(!1),ud=$n(!0),hd=$n("shortcuts"),sm=$n(!1),am=$n(!0),G_=$n(500);function mh(){const r=di(_l);try{di(Qs).saveProject(r,di(Ar).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let lm=$n(!1);function zo(r){return di(lm)?`/${r}`:`https://assets.od2net.org/${r}`}function Bo(){var e;an.set({mode:"title",firstLoad:!1});let r=[-180,-90,180,90];di(Fo)=="cnt"&&(r=[-8.943,54.631,-.901,59.489]),(e=di(Ro))==null||e.fitBounds(r,{duration:500})}function cm(r){var n;function e(i){const o=i.getEast()-i.getWest();let c=i.getWest()+Math.random()*o;const a=i.getNorth()-i.getSouth();let d=i.getSouth()+Math.random()*a;return new Ks.LngLat(c,d)}const t=(n=di(Ro))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(di(r))||r.set(e(t))}function lk(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D;return{c(){e=U("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=ie(),n=U("p"),n.innerHTML=`This is an <b>experimental</b>
    version of the
    <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
    . Most parts of it do not work yet, and you should probably use the other version
    of the tool instead.`,i=ie(),o=U("p"),o.textContent="To use this tool, you need to:",c=ie(),a=U("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
      restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
      effects</li>`,d=ie(),p=U("p"),p.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
    and relies heavily on
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    data.`,_=ie(),y=U("p"),y.textContent="Some road signs images  Crown copyright.",w=ie(),T=U("center"),M=U("button"),M.textContent="Start!"},m(z,I){q(z,e,I),q(z,t,I),q(z,n,I),q(z,i,I),q(z,o,I),q(z,c,I),q(z,a,I),q(z,d,I),q(z,p,I),q(z,_,I),q(z,y,I),q(z,w,I),q(z,T,I),R(T,M),$||(D=xt(M,"click",r[1]),$=!0)},p:tt,d(z){z&&(V(e),V(t),V(n),V(i),V(o),V(c),V(a),V(d),V(p),V(_),V(y),V(w),V(T)),$=!1,D()}}}function ck(r){let e,t,n;function i(c){r[2](c)}let o={$$slots:{default:[lk]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new yd({props:o}),hn.push(()=>An(e,"show",i)),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,[a]){const d={};a&9&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.show=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function uk(r,e,t){let n;at(r,oh,c=>t(0,n=c));const i=()=>Nt(oh,n=!1,n);function o(c){n=c,oh.set(n)}return[n,i,o]}class hk extends Et{constructor(e){super(),Lt(this,e,uk,ck,wt,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const fk={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},H_=fk;function W_(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Vp(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=Ot(n,t[i]);return{c(){e=ds(r[11]),od(e,n)},m(i,o){q(i,e,o)},p(i,o){od(e,n=Vn(t,[o&32&&i[12]]))},d(i){i&&V(e)}}}function K_(r){let e=r[11],t,n=r[11]&&Vp(r);return{c(){n&&n.c(),t=Qn()},m(i,o){n&&n.m(i,o),q(i,t,o)},p(i,o){i[11]?e?wt(e,i[11])?(n.d(1),n=Vp(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=Vp(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&V(t),n&&n.d(i)}}}function dk(r){let e,t,n,i,o,c=Nn(r[5]),a=[];for(let w=0;w<c.length;w+=1)a[w]=K_(W_(r,c,w));const d=r[10].default,p=Cn(d,r,r[9],null);let _=[H_,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],y={};for(let w=0;w<_.length;w+=1)y=Ot(y,_[w]);return{c(){e=ds("svg");for(let w=0;w<a.length;w+=1)a[w].c();t=Qn(),p&&p.c(),od(e,y)},m(w,T){q(w,e,T);for(let M=0;M<a.length;M+=1)a[M]&&a[M].m(e,null);R(e,t),p&&p.m(e,null),o=!0},p(w,[T]){if(T&32){c=Nn(w[5]);let M;for(M=0;M<c.length;M+=1){const $=W_(w,c,M);a[M]?a[M].p($,T):(a[M]=K_($),a[M].c(),a[M].m(e,t))}for(;M<a.length;M+=1)a[M].d(1);a.length=c.length}p&&p.p&&(!o||T&512)&&Mn(p,d,w,w[9],o?Tn(d,w[9],T,null):Ln(w[9]),null),od(e,y=Vn(_,[H_,T&128&&w[7],(!o||T&4)&&{width:w[2]},(!o||T&4)&&{height:w[2]},(!o||T&2)&&{stroke:w[1]},(!o||T&28&&n!==(n=w[4]?Number(w[3])*24/Number(w[2]):w[3]))&&{"stroke-width":n},(!o||T&257&&i!==(i=w[6]("lucide-icon","lucide",w[0]?`lucide-${w[0]}`:"",w[8].class)))&&{class:i}]))},i(w){o||(j(p,w),o=!0)},o(w){Z(p,w),o=!1},d(w){w&&V(e),pi(a,w),p&&p.d(w)}}}function pk(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=D_(e,n),{$$slots:o={},$$scope:c}=e,{name:a=void 0}=e,{color:d="currentColor"}=e,{size:p=24}=e,{strokeWidth:_=2}=e,{absoluteStrokeWidth:y=!1}=e,{iconNode:w=[]}=e;const T=(...M)=>M.filter(($,D,z)=>!!$&&z.indexOf($)===D).join(" ");return r.$$set=M=>{t(8,e=Ot(Ot({},e),mi(M))),t(7,i=D_(e,n)),"name"in M&&t(0,a=M.name),"color"in M&&t(1,d=M.color),"size"in M&&t(2,p=M.size),"strokeWidth"in M&&t(3,_=M.strokeWidth),"absoluteStrokeWidth"in M&&t(4,y=M.absoluteStrokeWidth),"iconNode"in M&&t(5,w=M.iconNode),"$$scope"in M&&t(9,c=M.$$scope)},e=mi(e),[a,d,p,_,y,w,T,i,e,c,o]}class mk extends Et{constructor(e){super(),Lt(this,e,pk,dk,wt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const ea=mk;function gk(r){let e;const t=r[2].default,n=Cn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Mn(n,t,i,i[3],e?Tn(t,i[3],o,null):Ln(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function _k(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[gk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new ea({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&3?Vn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function yk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=c=>{t(1,e=Ot(Ot({},e),mi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=mi(e),[o,e,n,i]}class bk extends Et{constructor(e){super(),Lt(this,e,yk,_k,wt,{})}}const vk=bk;function wk(r){let e;const t=r[2].default,n=Cn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Mn(n,t,i,i[3],e?Tn(t,i[3],o,null):Ln(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function xk(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[wk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new ea({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&3?Vn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function kk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=c=>{t(1,e=Ot(Ot({},e),mi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=mi(e),[o,e,n,i]}class Sk extends Et{constructor(e){super(),Lt(this,e,kk,xk,wt,{})}}const Ck=Sk;function Tk(r){let e;const t=r[2].default,n=Cn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Mn(n,t,i,i[3],e?Tn(t,i[3],o,null):Ln(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Mk(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Tk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new ea({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&3?Vn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Lk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=c=>{t(1,e=Ot(Ot({},e),mi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=mi(e),[o,e,n,i]}class Ek extends Et{constructor(e){super(),Lt(this,e,Lk,Mk,wt,{})}}const Nb=Ek;function Ik(r){let e;const t=r[2].default,n=Cn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Mn(n,t,i,i[3],e?Tn(t,i[3],o,null):Ln(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Ak(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Ik]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new ea({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&3?Vn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Pk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=c=>{t(1,e=Ot(Ot({},e),mi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=mi(e),[o,e,n,i]}class zk extends Et{constructor(e){super(),Lt(this,e,Pk,Ak,wt,{})}}const Dk=zk;function $k(r){let e;const t=r[2].default,n=Cn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Mn(n,t,i,i[3],e?Tn(t,i[3],o,null):Ln(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Rk(r){let e,t;const n=[{name:"paintbrush-vertical"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[$k]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new ea({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&3?Vn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Fk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M10 2v2"}],["path",{d:"M14 2v4"}],["path",{d:"M17 2a1 1 0 0 1 1 1v9H6V3a1 1 0 0 1 1-1z"}],["path",{d:"M6 12a1 1 0 0 0-1 1v1a2 2 0 0 0 2 2h2a1 1 0 0 1 1 1v2.9a2 2 0 1 0 4 0V17a1 1 0 0 1 1-1h2a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1"}]];return r.$$set=c=>{t(1,e=Ot(Ot({},e),mi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=mi(e),[o,e,n,i]}class Bk extends Et{constructor(e){super(),Lt(this,e,Fk,Rk,wt,{})}}const Ok=Bk;function Nk(r){let e;const t=r[2].default,n=Cn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Mn(n,t,i,i[3],e?Tn(t,i[3],o,null):Ln(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function jk(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Nk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new ea({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&3?Vn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Uk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=c=>{t(1,e=Ot(Ot({},e),mi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=mi(e),[o,e,n,i]}class Vk extends Et{constructor(e){super(),Lt(this,e,Uk,jk,wt,{})}}const jb=Vk;function qk(r){let e;const t=r[2].default,n=Cn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Mn(n,t,i,i[3],e?Tn(t,i[3],o,null):Ln(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Zk(r){let e,t;const n=[{name:"redo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[qk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new ea({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&3?Vn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Gk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 7v6h-6"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"}]];return r.$$set=c=>{t(1,e=Ot(Ot({},e),mi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=mi(e),[o,e,n,i]}class Hk extends Et{constructor(e){super(),Lt(this,e,Gk,Zk,wt,{})}}const Wk=Hk;function Kk(r){let e;const t=r[2].default,n=Cn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Mn(n,t,i,i[3],e?Tn(t,i[3],o,null):Ln(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Xk(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Kk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new ea({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&3?Vn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function Jk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=c=>{t(1,e=Ot(Ot({},e),mi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=mi(e),[o,e,n,i]}class Yk extends Et{constructor(e){super(),Lt(this,e,Jk,Xk,wt,{})}}const qm=Yk;function Qk(r){let e;const t=r[2].default,n=Cn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&Mn(n,t,i,i[3],e?Tn(t,i[3],o,null):Ln(i[3]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function e3(r){let e,t;const n=[{name:"undo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Qk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new ea({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&3?Vn(n,[n[0],c&2&&Ys(o[1]),c&1&&{iconNode:o[0]}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function t3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 7v6h6"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}]];return r.$$set=c=>{t(1,e=Ot(Ot({},e),mi(c))),"$$scope"in c&&t(3,i=c.$$scope)},e=mi(e),[o,e,n,i]}class n3 extends Et{constructor(e){super(),Lt(this,e,t3,e3,wt,{})}}const r3=n3;let i3=Date.now();function vl(r){return`${r}-${i3++}`}const Zm=Symbol.for("svelte-maplibre");function Da(){return Sh(Zm)}function o3(r){let e=new WeakMap;return t=>{var c;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(c=t.target.queryRenderedFeatures(t.point).find(a=>{var d;return(d=r.get(a.layer.id))==null?void 0:d.interactive}))==null?void 0:c.layer.id;return e.set(t.originalEvent,o),o}}function s3(){let r=new Map;return _d(Zm,{map:$n(null),source:jp(null),layer:jp(null),popupTarget:jp(null),cluster:$n(),loadedImages:$n(new Set),minzoom:$n(0),maxzoom:$n(24),layerEvent:$n(null),layerInfo:r,eventTopMost:o3(r),markerClickManager:new c3})}function X_(r){return{subscribe:r.subscribe}}function Gm({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=Da(),o=$n(null),c=X_(o),a={...i,[r]:X_(o)};if(e&&(a.popupTarget=c),n){let d=$n(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=$n()),_d(Zm,a),{...i,self:o}}function Ub(){return Gm({key:"source",setCluster:!0})}function Vb(r=!0){return Gm({key:"layer",setPopupTarget:r,setMouseEvent:r})}function a3(){return Gm({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function l3(r){return"layerType"in r&&r.layerType==="deckgl"}class c3{constructor(){tr(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function J_(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function u3(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function h3(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Jn(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var La=f3;function f3(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var c=o[n],a=r[c];a!=null&&(e[c]=a)}return e}}}function Y_(r){let e=r[0],t,n,i=Q_(r);return{c(){i.c(),t=Qn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c[0]&1&&wt(e,e=o[0])?(tn(),Z(i,1,1,tt),nn(),i=Q_(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function Q_(r){let e;const t=r[36].default,n=Cn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&Mn(n,t,i,i[35],e?Tn(t,i[35],o,null):Ln(i[35]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function d3(r){let e,t,n=r[0]&&Y_(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&j(n,1)):(n=Y_(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function p3(r,e,t){let n,i,o,c,a,d,p,_,y,w,T,M,{$$slots:$={},$$scope:D}=e,{id:z=vl("layer")}=e,{source:I=void 0}=e,{sourceLayer:F=void 0}=e,{beforeId:N=void 0}=e,{beforeLayerType:W=void 0}=e,{type:oe}=e,{paint:J=void 0}=e,{layout:ee=void 0}=e,{filter:pe=void 0}=e,{applyToClusters:Ie=void 0}=e,{minzoom:Q=void 0}=e,{maxzoom:ae=void 0}=e,{manageHoverState:Pe=!1}=e,{hovered:ve=null}=e,{interactive:nt=!0}=e,{hoverCursor:Ge=void 0}=e,{eventsIfTopMost:Ee=!1}=e;const De=ms(),{map:Ct,source:it,self:lt,minzoom:mt,maxzoom:dt,eventTopMost:Xe,layerInfo:$t}=Vb();at(r,Ct,Ze=>t(31,y=Ze)),at(r,it,Ze=>t(32,w=Ze)),at(r,lt,Ze=>t(0,_=Ze)),at(r,mt,Ze=>t(34,M=Ze)),at(r,dt,Ze=>t(33,T=Ze)),Yr(()=>{_&&y&&($t.delete(_),y==null||y.removeLayer(_))});let yt;function Rt(Ze){var _e,Pn;if(!nt||!_||!y||Ee&&Xe(Ze)!==_)return;let Ve=Ze.features??[],St=(Pn=(_e=Ve[0])==null?void 0:_e.properties)==null?void 0:Pn.cluster_id,Ut={event:Ze,map:y,clusterId:St,layer:_,source:a,features:Ve};De(Ze.type,Ut)}function It(Ze){var _e,Pn;if(!nt||!_||!y||Ee&&Xe(Ze)!==_)return;Ge&&(y.getCanvas().style.cursor=Ge);let Ve=Ze.features??[];t(6,ve=Ve[0]??null);let St=(Pn=(_e=Ve[0])==null?void 0:_e.properties)==null?void 0:Pn.cluster_id;De("mouseenter",{event:Ze,map:y,clusterId:St,layer:_,source:a,features:Ve})}function Qt(Ze){var _e,Pn,Ne;if(!nt||!y)return;if(Ee&&Xe(Ze)!==_){t(6,ve=null),Pe&&yt!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:F,id:yt},{hover:!1}),yt=void 0);return}y.getCanvas().style.cursor=Ge;let Ve=Ze.features??[],St=(Pn=(_e=Ve[0])==null?void 0:_e.properties)==null?void 0:Pn.cluster_id,Ut=(Ne=Ve[0])==null?void 0:Ne.id;Ut!==yt&&(Pe&&(yt!==void 0&&(y==null||y.setFeatureState({source:a,id:yt,sourceLayer:F},{hover:!1})),y==null||y.setFeatureState({source:a,id:Ut,sourceLayer:F},{hover:!0})),yt=Ut,t(6,ve=Ve[0]??null)),De("mousemove",{event:Ze,map:y,clusterId:St,layer:_,source:a,features:Ve})}function yn(Ze){if(!(!nt||!_||!y)){if(Ge&&(y.getCanvas().style.cursor=""),t(6,ve=null),Pe&&yt!==void 0){const Ve={source:a,id:yt,sourceLayer:F};y==null||y.setFeatureState(Ve,{hover:!1}),yt=void 0}De("mouseleave",{map:y,layer:_,source:a})}}let ut=!0;function Wt(Ze){y&&(y.off("click",Ze,Rt),y.off("dblclick",Ze,Rt),y.off("contextmenu",Ze,Rt),y.off("mouseenter",Ze,It),y.off("mousemove",Ze,Qt),y.off("mouseleave",Ze,yn))}return Yr(()=>{y&&_&&Wt(_)}),r.$$set=Ze=>{"id"in Ze&&t(7,z=Ze.id),"source"in Ze&&t(8,I=Ze.source),"sourceLayer"in Ze&&t(9,F=Ze.sourceLayer),"beforeId"in Ze&&t(10,N=Ze.beforeId),"beforeLayerType"in Ze&&t(11,W=Ze.beforeLayerType),"type"in Ze&&t(12,oe=Ze.type),"paint"in Ze&&t(13,J=Ze.paint),"layout"in Ze&&t(14,ee=Ze.layout),"filter"in Ze&&t(15,pe=Ze.filter),"applyToClusters"in Ze&&t(16,Ie=Ze.applyToClusters),"minzoom"in Ze&&t(17,Q=Ze.minzoom),"maxzoom"in Ze&&t(18,ae=Ze.maxzoom),"manageHoverState"in Ze&&t(19,Pe=Ze.manageHoverState),"hovered"in Ze&&t(6,ve=Ze.hovered),"interactive"in Ze&&t(20,nt=Ze.interactive),"hoverCursor"in Ze&&t(21,Ge=Ze.hoverCursor),"eventsIfTopMost"in Ze&&t(22,Ee=Ze.eventsIfTopMost),"$$scope"in Ze&&t(35,D=Ze.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=h3(Ie)),r.$$.dirty[0]&1073774592&&t(24,i=u3("all",n,pe)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=Q??M),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,c=ae??T),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=I||w),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&_!==z&&a){_&&(Wt(_),$t.delete(_));let Ze=N;if(!N&&W){let Ve=y.getStyle().layers,St=typeof W=="function"?W:_e=>_e.type===W,Ut=Ve==null?void 0:Ve.find(St);Ut&&(Ze=Ut.id)}Nt(lt,_=z,_),y.addLayer(La({id:_,type:oe,source:a,"source-layer":F,filter:i,paint:J,layout:ee,minzoom:o,maxzoom:c}),Ze),t(23,ut=!0),y.on("click",_,Rt),y.on("dblclick",_,Rt),y.on("contextmenu",_,Rt),y.on("mouseenter",_,It),y.on("mousemove",_,Qt),y.on("mouseleave",_,yn)}r.$$.dirty[0]&1048577&&_&&$t.set(_,{interactive:nt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=_?J_((Ze,Ve)=>{y!=null&&y.style._loaded?y.setPaintProperty(_,Ze,Ve):y==null||y.once("styledata",()=>y==null?void 0:y.setPaintProperty(_,Ze,Ve))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=_?J_((Ze,Ve)=>{y!=null&&y.style._loaded?y.setLayoutProperty(_,Ze,Ve):y==null||y.once("styledata",()=>y==null?void 0:y.setLayoutProperty(_,Ze,Ve))}):void 0),r.$$.dirty[0]&268443648&&(d==null||d(J)),r.$$.dirty[0]&134234112&&(p==null||p(ee)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&_&&(y==null||y.setLayerZoomRange(_,o,c)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&_&&(ut?t(23,ut=!1):y==null||y.setFilter(_,i))},[_,Ct,it,lt,mt,dt,ve,z,I,F,N,W,oe,J,ee,pe,Ie,Q,ae,Pe,nt,Ge,Ee,ut,i,c,o,p,d,a,n,y,w,T,M,D,$]}let wd=class extends Et{constructor(e){super(),Lt(this,e,p3,d3,wt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function m3(r){let e;const t=r[16].default,n=Cn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&Mn(n,t,i,i[24],e?Tn(t,i[24],o,null):Ln(i[24]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function g3(r){let e,t,n;function i(c){r[17](c)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[m3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new wd({props:o}),hn.push(()=>An(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.applyToClusters=c[9]),a&1024&&(d.minzoom=c[10]),a&2048&&(d.maxzoom=c[11]),a&4096&&(d.hoverCursor=c[12]),a&8192&&(d.manageHoverState=c[13]),a&16384&&(d.eventsIfTopMost=c[14]),a&32768&&(d.interactive=c[15]),a&16777216&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function _3(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=vl("circle")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:_}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:$=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:N=!0}=e;function W(ae){I=ae,t(0,I)}function oe(ae){Dn.call(this,r,ae)}function J(ae){Dn.call(this,r,ae)}function ee(ae){Dn.call(this,r,ae)}function pe(ae){Dn.call(this,r,ae)}function Ie(ae){Dn.call(this,r,ae)}function Q(ae){Dn.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,o=ae.id),"source"in ae&&t(2,c=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,d=ae.beforeId),"beforeLayerType"in ae&&t(5,p=ae.beforeLayerType),"paint"in ae&&t(6,_=ae.paint),"layout"in ae&&t(7,y=ae.layout),"filter"in ae&&t(8,w=ae.filter),"applyToClusters"in ae&&t(9,T=ae.applyToClusters),"minzoom"in ae&&t(10,M=ae.minzoom),"maxzoom"in ae&&t(11,$=ae.maxzoom),"hoverCursor"in ae&&t(12,D=ae.hoverCursor),"manageHoverState"in ae&&t(13,z=ae.manageHoverState),"hovered"in ae&&t(0,I=ae.hovered),"eventsIfTopMost"in ae&&t(14,F=ae.eventsIfTopMost),"interactive"in ae&&t(15,N=ae.interactive),"$$scope"in ae&&t(24,i=ae.$$scope)},[I,o,c,a,d,p,_,y,w,T,M,$,D,z,F,N,n,W,oe,J,ee,pe,Ie,Q,i]}let wl=class extends Et{constructor(e){super(),Lt(this,e,_3,g3,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function y3(r){let e,t;const n=r[7].default,i=Cn(n,r,r[6],null);return{c(){e=U("div"),i&&i.c(),fe(e,"class",r[1]),en(e,"maplibregl-ctrl",r[0])},m(o,c){q(o,e,c),i&&i.m(e,null),r[8](e),t=!0},p(o,[c]){i&&i.p&&(!t||c&64)&&Mn(i,n,o,o[6],t?Tn(n,o[6],c,null):Ln(o[6]),null),(!t||c&2)&&fe(e,"class",o[1]),(!t||c&3)&&en(e,"maplibregl-ctrl",o[0])},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o),r[8](null)}}}function b3(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:c=!0}=e,{position:a="top-right"}=e,{class:d=void 0}=e;const{map:p}=Da();at(r,p,T=>t(5,n=T));let _,y={onAdd(){return _},onRemove(){var T;(T=_==null?void 0:_.parentNode)==null||T.removeChild(_)}};Yr(()=>{n==null||n.removeControl(y)});function w(T){hn[T?"unshift":"push"](()=>{_=T,t(2,_)})}return r.$$set=T=>{"defaultStyling"in T&&t(0,c=T.defaultStyling),"position"in T&&t(4,a=T.position),"class"in T&&t(1,d=T.class),"$$scope"in T&&t(6,o=T.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&_&&n.addControl(y,a)},[c,d,_,p,a,n,o,i,w]}class v3 extends Et{constructor(e){super(),Lt(this,e,b3,y3,wt,{defaultStyling:0,position:4,class:1})}}function w3(r){let e;const t=r[15].default,n=Cn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&Mn(n,t,i,i[23],e?Tn(t,i[23],o,null):Ln(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function x3(r){let e,t,n;function i(c){r[16](c)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[w3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new wd({props:o}),hn.push(()=>An(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.minzoom=c[9]),a&1024&&(d.maxzoom=c[10]),a&2048&&(d.hoverCursor=c[11]),a&4096&&(d.manageHoverState=c[12]),a&8192&&(d.eventsIfTopMost=c[13]),a&16384&&(d.interactive=c[14]),a&8388608&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function k3(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=vl("fill")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:_}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:D=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(Q){z=Q,t(0,z)}function W(Q){Dn.call(this,r,Q)}function oe(Q){Dn.call(this,r,Q)}function J(Q){Dn.call(this,r,Q)}function ee(Q){Dn.call(this,r,Q)}function pe(Q){Dn.call(this,r,Q)}function Ie(Q){Dn.call(this,r,Q)}return r.$$set=Q=>{"id"in Q&&t(1,o=Q.id),"source"in Q&&t(2,c=Q.source),"sourceLayer"in Q&&t(3,a=Q.sourceLayer),"beforeId"in Q&&t(4,d=Q.beforeId),"beforeLayerType"in Q&&t(5,p=Q.beforeLayerType),"paint"in Q&&t(6,_=Q.paint),"layout"in Q&&t(7,y=Q.layout),"filter"in Q&&t(8,w=Q.filter),"minzoom"in Q&&t(9,T=Q.minzoom),"maxzoom"in Q&&t(10,M=Q.maxzoom),"hoverCursor"in Q&&t(11,$=Q.hoverCursor),"manageHoverState"in Q&&t(12,D=Q.manageHoverState),"hovered"in Q&&t(0,z=Q.hovered),"eventsIfTopMost"in Q&&t(13,I=Q.eventsIfTopMost),"interactive"in Q&&t(14,F=Q.interactive),"$$scope"in Q&&t(23,i=Q.$$scope)},[z,o,c,a,d,p,_,y,w,T,M,$,D,I,F,n,N,W,oe,J,ee,pe,Ie,i]}let zi=class extends Et{constructor(e){super(),Lt(this,e,k3,x3,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function S3(r,e,t){let n;const{map:i}=Da();at(r,i,d=>t(4,n=d));let{position:o="top-left"}=e,{container:c=void 0}=e,a=null;return Yr(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),r.$$set=d=>{"position"in d&&t(1,o=d.position),"container"in d&&t(2,c=d.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!a){let d;typeof c=="string"?d=document.querySelector(c)??void 0:d=c,t(3,a=new Jr.FullscreenControl({container:d})),n.addControl(a,o)}},[i,o,c,a,n]}class C3 extends Et{constructor(e){super(),Lt(this,e,S3,null,wt,{position:1,container:2})}}function qb(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const c=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):c())};a()}else c()}function Zb(r,e,t){yb().then(()=>{let n=di(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function e0(r){let e=r[0],t,n,i=t0(r);return{c(){i.c(),t=Qn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c&1&&wt(e,e=o[0])?(tn(),Z(i,1,1,tt),nn(),i=t0(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function t0(r){let e;const t=r[19].default,n=Cn(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&Mn(n,t,i,i[18],e?Tn(t,i[18],o,null):Ln(i[18]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function T3(r){let e,t,n=r[0]&&e0(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=e0(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function M3(r,e,t){let n,i,o,{$$slots:c={},$$scope:a}=e,{id:d=vl("geojson")}=e,{data:p}=e,{generateId:_=!1}=e,{promoteId:y=void 0}=e,{filter:w=void 0}=e,{lineMetrics:T=void 0}=e,{cluster:M=void 0}=e,{maxzoom:$=void 0}=e,{attribution:D=void 0}=e,{buffer:z=void 0}=e,{tolerance:I=void 0}=e;const{map:F,cluster:N,self:W}=Ub();at(r,F,ee=>t(17,i=ee)),at(r,N,ee=>t(20,o=ee)),at(r,W,ee=>t(0,n=ee));let oe,J=!0;return Yr(()=>{n&&oe&&i&&(Zb(F,n,oe),Nt(W,n=null,n),t(15,oe=void 0))}),r.$$set=ee=>{"id"in ee&&t(4,d=ee.id),"data"in ee&&t(5,p=ee.data),"generateId"in ee&&t(6,_=ee.generateId),"promoteId"in ee&&t(7,y=ee.promoteId),"filter"in ee&&t(8,w=ee.filter),"lineMetrics"in ee&&t(9,T=ee.lineMetrics),"cluster"in ee&&t(10,M=ee.cluster),"maxzoom"in ee&&t(11,$=ee.maxzoom),"attribution"in ee&&t(12,D=ee.attribution),"buffer"in ee&&t(13,z=ee.buffer),"tolerance"in ee&&t(14,I=ee.tolerance),"$$scope"in ee&&t(18,a=ee.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Nt(N,o=M,o),r.$$.dirty&196593&&i&&n!==d&&(Nt(W,n=d,n),qb(i,n,La({type:"geojson",data:p,filter:w,lineMetrics:T,generateId:_,promoteId:y,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties,maxzoom:$,attribution:D,buffer:z,tolerance:I}),ee=>i&&ee===n,()=>{n&&(t(15,oe=i==null?void 0:i.getSource(n)),t(16,J=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,oe=i==null?void 0:i.getSource(d))})),r.$$.dirty&98336&&oe&&(J?t(16,J=!1):oe.setData(p)),r.$$.dirty&33792&&(oe==null||oe.setClusterOptions(La({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[n,F,N,W,d,p,_,y,w,T,M,$,D,z,I,oe,J,i,a,c]}let pr=class extends Et{constructor(e){super(),Lt(this,e,M3,T3,wt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function L3(r,e,t){let n;const{map:i}=Da();at(r,i,w=>t(8,n=w));let{position:o="top-left"}=e,{positionOptions:c=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:p=!0}=e,{showUserLocation:_=!0}=e,{control:y=null}=e;return Yr(()=>{n!=null&&n.loaded()&&y&&n.removeControl(y)}),r.$$set=w=>{"position"in w&&t(2,o=w.position),"positionOptions"in w&&t(3,c=w.positionOptions),"fitBoundsOptions"in w&&t(4,a=w.fitBoundsOptions),"trackUserLocation"in w&&t(5,d=w.trackUserLocation),"showAccuracyCircle"in w&&t(6,p=w.showAccuracyCircle),"showUserLocation"in w&&t(7,_=w.showUserLocation),"control"in w&&t(1,y=w.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!y&&(t(1,y=new Jr.GeolocateControl({positionOptions:c,fitBoundsOptions:a,trackUserLocation:d,showAccuracyCircle:p,showUserLocation:_})),n.addControl(y,o))},[i,y,o,c,a,d,p,_,n]}class E3 extends Et{constructor(e){super(),Lt(this,e,L3,null,wt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function I3(r,e,t){let n,i,{data:o}=e,{idCol:c}=e,{sourceLayer:a=void 0}=e,d=new Set;const{map:p,source:_}=Vb();return at(r,p,y=>t(6,n=y)),at(r,_,y=>t(7,i=y)),r.$$set=y=>{"data"in y&&t(2,o=y.data),"idCol"in y&&t(3,c=y.idCol),"sourceLayer"in y&&t(4,a=y.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let y=new Set;for(const w of o){const T=w[c];if(!T)continue;d.delete(T),y.add(T);const M={id:T,source:i,sourceLayer:a},$=n.getFeatureState(M);let D=!1;for(const z of Object.keys(w))if($[z]!==w[z]){D=!0;break}D&&n.setFeatureState(M,w)}for(const w of d){const T={id:w,source:i,sourceLayer:a},M=n.getFeatureState(T);for(const $ of Object.keys(M))n.removeFeatureState(T,$)}t(5,d=y)}},[p,_,o,c,a,d,n,i]}class A3 extends Et{constructor(e){super(),Lt(this,e,I3,null,wt,{data:2,idCol:3,sourceLayer:4})}}function P3(r){let e;const t=r[15].default,n=Cn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&Mn(n,t,i,i[23],e?Tn(t,i[23],o,null):Ln(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function z3(r){let e,t,n;function i(c){r[16](c)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[P3]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new wd({props:o}),hn.push(()=>An(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.minzoom=c[9]),a&1024&&(d.maxzoom=c[10]),a&2048&&(d.hoverCursor=c[11]),a&4096&&(d.manageHoverState=c[12]),a&8192&&(d.eventsIfTopMost=c[13]),a&16384&&(d.interactive=c[14]),a&8388608&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function D3(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=vl("line")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:_}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:D=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(Q){z=Q,t(0,z)}function W(Q){Dn.call(this,r,Q)}function oe(Q){Dn.call(this,r,Q)}function J(Q){Dn.call(this,r,Q)}function ee(Q){Dn.call(this,r,Q)}function pe(Q){Dn.call(this,r,Q)}function Ie(Q){Dn.call(this,r,Q)}return r.$$set=Q=>{"id"in Q&&t(1,o=Q.id),"source"in Q&&t(2,c=Q.source),"sourceLayer"in Q&&t(3,a=Q.sourceLayer),"beforeId"in Q&&t(4,d=Q.beforeId),"beforeLayerType"in Q&&t(5,p=Q.beforeLayerType),"paint"in Q&&t(6,_=Q.paint),"layout"in Q&&t(7,y=Q.layout),"filter"in Q&&t(8,w=Q.filter),"minzoom"in Q&&t(9,T=Q.minzoom),"maxzoom"in Q&&t(10,M=Q.maxzoom),"hoverCursor"in Q&&t(11,$=Q.hoverCursor),"manageHoverState"in Q&&t(12,D=Q.manageHoverState),"hovered"in Q&&t(0,z=Q.hovered),"eventsIfTopMost"in Q&&t(13,I=Q.eventsIfTopMost),"interactive"in Q&&t(14,F=Q.interactive),"$$scope"in Q&&t(23,i=Q.$$scope)},[z,o,c,a,d,p,_,y,w,T,M,$,D,I,F,n,N,W,oe,J,ee,pe,Ie,i]}let rr=class extends Et{constructor(e){super(),Lt(this,e,D3,z3,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function $3(r,e,t){let n;const i=ms();let{layer:o=void 0}=e;const{map:c}=Da();at(r,c,_=>t(2,n=_));function a(_){i(_.type,{..._,map:c})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Yr(()=>{if(n)if(o)for(const _ of d)n.off(_,o,a);else for(const _ of p)n.off(_,a)}),r.$$set=_=>{"layer"in _&&t(1,o=_.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const _ of d)n.on(_,o,a);else for(const _ of p)n.on(_,a)},[c,o,n]}class Hm extends Et{constructor(e){super(),Lt(this,e,$3,null,wt,{layer:1})}}function R3(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,c=Math.round(e.lng*i)/i,a=`${t}/${o}/${c}`,d=r.getBearing(),p=r.getPitch();return(d||p)&&(a+=`/${Math.round(d*10)/10}`),p&&(a+=`/${Math.round(p)}`),`#${a}`}function F3(r){return r.replace("#","").split("/").map(parseFloat)}var kc=Wm;function Wm(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?n0(r,e):{}.toString.call(r)=="[object Set]"?n0(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?O3(r,e):B3(r,e)}function B3(r,e){return r.toString()===e.toString()}function n0(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Wm(r[n],e[n]))return!1;return!0}function O3(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&Wm(r[o],e[o])))return!1}return!0}function N3(r,e,t){let n;const{map:i}=Da();at(r,i,_=>t(6,n=_));let{position:o="top-left"}=e,{showCompass:c=!0}=e,{showZoom:a=!0}=e,{visualizePitch:d=!1}=e,p=null;return Yr(()=>{n!=null&&n.loaded()&&p&&n.removeControl(p)}),r.$$set=_=>{"position"in _&&t(1,o=_.position),"showCompass"in _&&t(2,c=_.showCompass),"showZoom"in _&&t(3,a=_.showZoom),"visualizePitch"in _&&t(4,d=_.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!p&&(t(5,p=new Jr.NavigationControl({showCompass:c,showZoom:a,visualizePitch:d})),n.addControl(p,o))},[i,o,c,a,d,p,n]}class Gb extends Et{constructor(e){super(),Lt(this,e,N3,null,wt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function j3(r,e,t){let n;const{map:i}=Da();at(r,i,p=>t(5,n=p));let{position:o="bottom-left"}=e,{maxWidth:c=void 0}=e,{unit:a="metric"}=e,d=null;return Yr(()=>{n!=null&&n.loaded()&&d&&n.removeControl(d)}),r.$$set=p=>{"position"in p&&t(1,o=p.position),"maxWidth"in p&&t(2,c=p.maxWidth),"unit"in p&&t(3,a=p.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!d&&(t(4,d=new Jr.ScaleControl({maxWidth:c,unit:a})),n.addControl(d,o))},[i,o,c,a,d,n]}class Hb extends Et{constructor(e){super(),Lt(this,e,j3,null,wt,{position:1,maxWidth:2,unit:3})}}const{window:U3}=mb,V3=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),r0=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function i0(r){let e,t,n=r[3]&&o0(r);const i=r[46].default,o=Cn(i,r,r[45],r0);return{c(){n&&n.c(),e=ie(),o&&o.c()},m(c,a){n&&n.m(c,a),q(c,e,a),o&&o.m(c,a),t=!0},p(c,a){c[3]?n?(n.p(c,a),a[0]&8&&j(n,1)):(n=o0(c),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn()),o&&o.p&&(!t||a[0]&112|a[1]&16384)&&Mn(o,i,c,c[45],t?Tn(i,c[45],a,V3):Ln(c[45]),r0)},i(c){t||(j(n),j(o,c),t=!0)},o(c){Z(n),Z(o,c),t=!1},d(c){c&&V(e),n&&n.d(c),o&&o.d(c)}}}function o0(r){let e,t,n,i,o,c,a,d;return e=new Gb({props:{position:r[7]}}),n=new E3({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new C3({props:{position:r[7]}}),a=new Hb({props:{position:r[7]}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),q(p,i,_),le(o,p,_),q(p,c,_),le(a,p,_),d=!0},p(p,_){const y={};_[0]&128&&(y.position=p[7]),e.$set(y);const w={};_[0]&128&&(w.position=p[7]),n.$set(w);const T={};_[0]&128&&(T.position=p[7]),o.$set(T);const M={};_[0]&128&&(M.position=p[7]),a.$set(M)},i(p){d||(j(e.$$.fragment,p),j(n.$$.fragment,p),j(o.$$.fragment,p),j(a.$$.fragment,p),d=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),Z(o.$$.fragment,p),Z(a.$$.fragment,p),d=!1},d(p){p&&(V(t),V(i),V(c)),ce(e,p),ce(n,p),ce(o,p),ce(a,p)}}}function q3(r){let e,t,n,i,o,c=r[4]&&r[0]&&i0(r);return{c(){e=U("div"),c&&c.c(),fe(e,"class",t=id(r[2])+" svelte-p00lfq"),fe(e,"data-testid","map-container"),en(e,"expand-map",!r[2])},m(a,d){q(a,e,d),c&&c.m(e,null),r[47](e),n=!0,i||(o=[xt(U3,"hashchange",r[11]),Qp(r[10].call(null,e))],i=!0)},p(a,d){a[4]&&a[0]?c?(c.p(a,d),d[0]&17&&j(c,1)):(c=i0(a),c.c(),j(c,1),c.m(e,null)):c&&(tn(),Z(c,1,1,()=>{c=null}),nn()),(!n||d[0]&4&&t!==(t=id(a[2])+" svelte-p00lfq"))&&fe(e,"class",t),(!n||d[0]&4)&&en(e,"expand-map",!a[2])},i(a){n||(j(c),n=!0)},o(a){Z(c),n=!1},d(a){a&&V(e),c&&c.d(),r[47](null),i=!1,mr(o)}}}function Z3(r,e,t){let n,i,o,c,{$$slots:a={},$$scope:d}=e,{map:p=null}=e,{mapContainer:_=void 0}=e,{class:y=void 0}=e,{style:w}=e,{diffStyleUpdates:T=!1}=e,{center:M=void 0}=e,{zoom:$=void 0}=e,{pitch:D=0}=e,{bearing:z=0}=e,{bounds:I=void 0}=e,{hash:F=!1}=e,{updateHash:N=Ne=>{window.history.replaceState(window.history.state,"",Ne)}}=e,{loaded:W=!1}=e,{minZoom:oe=0}=e,{maxZoom:J=22}=e,{minPitch:ee=0}=e,{maxPitch:pe=60}=e,{renderWorldCopies:Ie=void 0}=e,{dragPan:Q=void 0}=e,{dragRotate:ae=void 0}=e,{pitchWithRotate:Pe=void 0}=e,{antialias:ve=void 0}=e,{zoomOnDoubleClick:nt=!0}=e,{locale:Ge=void 0}=e,{interactive:Ee=!0}=e,{attributionControl:De=!0}=e,{cooperativeGestures:Ct=!1}=e,{preserveDrawingBuffer:it=!1}=e,{maxBounds:lt=void 0}=e,{images:mt=[]}=e,{standardControls:dt=!1}=e,{filterLayers:Xe=void 0}=e,{transformRequest:$t=void 0}=e;const yt=ms(),{map:Rt,loadedImages:It}=s3();at(r,Rt,Ne=>t(4,o=Ne)),at(r,It,Ne=>t(5,c=Ne));let Qt=new Set;async function yn(Ne,et=!1){if(o&&!(!o.loaded()&&!et))if("url"in Ne){Qt.add(Ne.id);try{let Kt=await o.loadImage(Ne.url);o==null||o.addImage(Ne.id,Kt.data,Ne.options),c.add(Ne.id),It.set(c)}catch(Kt){yt("error",Kt)}finally{Qt.delete(Ne.id)}}else o.addImage(Ne.id,Ne.data,Ne.options),c.add(Ne.id),It.set(c)}let ut,Wt,Ze,Ve;function St(Ne){return _e(),Nt(Rt,o=new Jr.Map(La({container:Ne,style:w,locale:Ge,center:M,zoom:$,pitch:D,bearing:z,minZoom:oe,maxZoom:J,minPitch:ee,maxPitch:pe,renderWorldCopies:Ie,dragPan:Q,dragRotate:ae,pitchWithRotate:Pe,antialias:ve,interactive:Ee,preserveDrawingBuffer:it,maxBounds:lt,bounds:I,attributionControl:De,transformRequest:$t,cooperativeGestures:Ct})),o),o.on("load",et=>{et.target.getContainer().setAttribute("data-testid","map"),et.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,W=!0),yt("load",o)}),o.on("error",et=>yt("error",{...et,map:o})),o.on("movestart",et=>yt("movestart",{...et,map:o})),o.on("moveend",et=>{if(t(12,M=et.target.getCenter()),t(13,$=et.target.getZoom()),t(14,D=et.target.getPitch()),t(15,z=et.target.getBearing()),t(16,I=et.target.getBounds()),yt("moveend",{...et,map:o}),F){let Kt=new URL(window.location.href.replace(/(#.+)?$/,R3(o)));N(Kt)}}),o.on("click",et=>yt("click",{...et,map:o})),o.on("dblclick",et=>yt("dblclick",{...et,map:o})),o.on("contextmenu",et=>yt("contextmenu",{...et,map:o})),o.on("zoomstart",et=>yt("zoomstart",{...et,map:o})),o.on("zoom",et=>{yt("zoom",{...et,map:o})}),o.on("zoomend",et=>{yt("zoomend",{...et,map:o})}),o.on("style.load",()=>{if(o){const et=o.getStyle();if(t(42,ut=et.layers.map(Kt=>Kt.id)),t(43,Wt=Object.keys(et.sources)),Ve)for(const[Kt,er]of Object.entries(Ve))o.addSource(Kt,er);if(Ze)for(const Kt of Ze)o.addLayer(Kt);for(const Kt of mt)yn(Kt,!0)}}),o.on("styledata",et=>{if(o&&Xe){const Kt=o.getStyle().layers;if(Kt)for(let er of Kt)Xe(er)||o.setLayoutProperty(er.id,"visibility","none")}yt("styledata",{...et,map:o})}),{destroy(){t(0,W=!1),o==null||o.remove(),Nt(Rt,o=null,o)}}}let Ut=w;function _e(){if(F){let Ne=F3(window.location.hash);Ne.length>=3&&(t(13,$=Ne[0]),t(12,M=[Ne[2],Ne[1]])),Ne.length==5&&(t(15,z=Ne[3]),t(14,D=Ne[4]))}}function Pn(Ne){hn[Ne?"unshift":"push"](()=>{_=Ne,t(1,_)})}return r.$$set=Ne=>{"map"in Ne&&t(17,p=Ne.map),"mapContainer"in Ne&&t(1,_=Ne.mapContainer),"class"in Ne&&t(2,y=Ne.class),"style"in Ne&&t(18,w=Ne.style),"diffStyleUpdates"in Ne&&t(19,T=Ne.diffStyleUpdates),"center"in Ne&&t(12,M=Ne.center),"zoom"in Ne&&t(13,$=Ne.zoom),"pitch"in Ne&&t(14,D=Ne.pitch),"bearing"in Ne&&t(15,z=Ne.bearing),"bounds"in Ne&&t(16,I=Ne.bounds),"hash"in Ne&&t(20,F=Ne.hash),"updateHash"in Ne&&t(21,N=Ne.updateHash),"loaded"in Ne&&t(0,W=Ne.loaded),"minZoom"in Ne&&t(22,oe=Ne.minZoom),"maxZoom"in Ne&&t(23,J=Ne.maxZoom),"minPitch"in Ne&&t(24,ee=Ne.minPitch),"maxPitch"in Ne&&t(25,pe=Ne.maxPitch),"renderWorldCopies"in Ne&&t(26,Ie=Ne.renderWorldCopies),"dragPan"in Ne&&t(27,Q=Ne.dragPan),"dragRotate"in Ne&&t(28,ae=Ne.dragRotate),"pitchWithRotate"in Ne&&t(29,Pe=Ne.pitchWithRotate),"antialias"in Ne&&t(30,ve=Ne.antialias),"zoomOnDoubleClick"in Ne&&t(31,nt=Ne.zoomOnDoubleClick),"locale"in Ne&&t(32,Ge=Ne.locale),"interactive"in Ne&&t(33,Ee=Ne.interactive),"attributionControl"in Ne&&t(34,De=Ne.attributionControl),"cooperativeGestures"in Ne&&t(35,Ct=Ne.cooperativeGestures),"preserveDrawingBuffer"in Ne&&t(36,it=Ne.preserveDrawingBuffer),"maxBounds"in Ne&&t(37,lt=Ne.maxBounds),"images"in Ne&&t(38,mt=Ne.images),"standardControls"in Ne&&t(3,dt=Ne.standardControls),"filterLayers"in Ne&&t(39,Xe=Ne.filterLayers),"transformRequest"in Ne&&t(40,$t=Ne.transformRequest),"$$scope"in Ne&&t(45,d=Ne.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof dt=="boolean"?void 0:dt),r.$$.dirty[0]&16&&t(17,p=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!kc(w,Ut)){const Ne=o.getStyle();if(ut&&(Ze=Ne.layers.filter(et=>!ut.includes(et.id))),Wt){const et=Object.keys(Ne.sources).filter(Kt=>!Wt.includes(Kt));Ve={};for(const Kt of et)Ve[Kt]=Ne.sources[Kt]}t(44,Ut=w),o.setStyle(w,{diff:T}),Nt(It,c=new Set,c),t(41,Qt=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&W&&o!=null&&o.loaded())for(let Ne of mt)!c.has(Ne.id)&&!Qt.has(Ne.id)&&!o.hasImage(Ne.id)&&yn(Ne);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=mt.every(Ne=>c.has(Ne.id))),r.$$.dirty[0]&61456&&o){let Ne={};M!=null&&!kc(M,o==null?void 0:o.getCenter())&&(Ne.center=M),$!=null&&!kc($,o==null?void 0:o.getZoom())&&(Ne.zoom=$),z!=null&&!kc(z,o==null?void 0:o.getBearing())&&(Ne.bearing=z),D!=null&&!kc(D,o==null?void 0:o.getPitch())&&(Ne.pitch=D),Object.keys(Ne).length&&o.easeTo(Ne)}r.$$.dirty[0]&65552&&I&&!kc(I,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(I)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(nt?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[W,_,y,dt,o,c,i,n,Rt,It,St,_e,M,$,D,z,I,p,w,T,F,N,oe,J,ee,pe,Ie,Q,ae,Pe,ve,nt,Ge,Ee,De,Ct,it,lt,mt,Xe,$t,Qt,ut,Wt,Ut,d,a,Pn]}class G3 extends Et{constructor(e){super(),Lt(this,e,Z3,q3,wt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const H3=r=>({marker:r&8}),s0=r=>({marker:r[3]});function W3(r){let e,t,n,i,o,c,a;const d=r[19].default,p=Cn(d,r,r[18],s0);return{c(){e=U("div"),p&&p.c(),fe(e,"tabindex",t=r[1]?0:void 0),fe(e,"role",n=r[1]?"button":void 0),st(e,"z-index",r[2])},m(_,y){q(_,e,y),p&&p.m(e,null),o=!0,c||(a=[Qp(r[7].call(null,e)),Qp(i=K3.call(null,e,r[0])),xt(e,"click",nh(r[20])),xt(e,"dblclick",nh(r[21])),xt(e,"contextmenu",nh(zm(r[22]))),xt(e,"mouseenter",r[23]),xt(e,"mouseleave",r[24]),xt(e,"mousemove",r[25]),xt(e,"keydown",r[8])],c=!0)},p(_,[y]){p&&p.p&&(!o||y&262152)&&Mn(p,d,_,_[18],o?Tn(d,_[18],y,H3):Ln(_[18]),s0),(!o||y&2&&t!==(t=_[1]?0:void 0))&&fe(e,"tabindex",t),(!o||y&2&&n!==(n=_[1]?"button":void 0))&&fe(e,"role",n),i&&bl(i.update)&&y&1&&i.update.call(null,_[0]),y&4&&st(e,"z-index",_[2])},i(_){o||(j(p,_),o=!0)},o(_){Z(p,_),o=!1},d(_){_&&V(e),p&&p.d(_),c=!1,mr(a)}}}function K3(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function X3(r,e,t){let n,i,o,{$$slots:c={},$$scope:a}=e,{marker:d=void 0}=e,{lngLat:p}=e,{class:_=void 0}=e,{interactive:y=!0}=e,{asButton:w=!1}=e,{draggable:T=!1}=e,{feature:M=null}=e,{offset:$=void 0}=e,{zIndex:D=void 0}=e,{rotation:z=0}=e,{opacity:I=1}=e;const F=ms(),{map:N,layerEvent:W,self:oe,markerClickManager:J}=a3();at(r,N,De=>t(27,o=De)),at(r,W,De=>t(26,n=De)),at(r,oe,De=>t(3,i=De));function ee(De){Nt(oe,i=new Jr.Marker({element:De,rotation:z,draggable:T,offset:$,opacity:I.toString()}).setLngLat(p).addTo(o),i),t(11,d=i);const Ct=()=>Q("dragstart"),it=()=>{pe(),Q("drag")},lt=()=>{pe(),Q("dragend")};return T&&(i.on("dragstart",Ct),i.on("drag",it),i.on("dragend",lt)),{destroy(){T&&(i==null||i.off("dragstart",Ct),i==null||i.off("drag",it),i==null||i.off("dragend",lt)),t(11,d=void 0),i==null||i.remove()}}}function pe(){let De=i==null?void 0:i.getLngLat();De&&(Array.isArray(p)?t(10,p=[De.lng,De.lat]):p&&"lon"in p?t(10,p={lon:De.lng,lat:De.lat}):t(10,p=De))}function Ie(De){De.key===" "&&(De.preventDefault(),De.stopPropagation(),Q("click"))}function Q(De){if(!y)return;let Ct=i==null?void 0:i.getLngLat();if(!Ct)return;const it=[Ct.lng,Ct.lat];let lt={map:o,marker:i,lngLat:it,features:[{type:"Feature",properties:(M==null?void 0:M.properties)??{},geometry:{type:"Point",coordinates:it}}]};(De==="click"||De==="contextmenu")&&J.handleClick(lt),Nt(W,n={...lt,layerType:"marker",type:De},n),F(De,lt)}const ae=()=>Q("click"),Pe=()=>Q("dblclick"),ve=()=>{Q("contextmenu")},nt=()=>{Q("mouseenter")},Ge=()=>{Q("mouseleave")},Ee=()=>Q("mousemove");return r.$$set=De=>{"marker"in De&&t(11,d=De.marker),"lngLat"in De&&t(10,p=De.lngLat),"class"in De&&t(0,_=De.class),"interactive"in De&&t(12,y=De.interactive),"asButton"in De&&t(1,w=De.asButton),"draggable"in De&&t(13,T=De.draggable),"feature"in De&&t(14,M=De.feature),"offset"in De&&t(15,$=De.offset),"zIndex"in De&&t(2,D=De.zIndex),"rotation"in De&&t(16,z=De.rotation),"opacity"in De&&t(17,I=De.opacity),"$$scope"in De&&t(18,a=De.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(p)),r.$$.dirty&32776&&(i==null||i.setOffset($??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(z)),r.$$.dirty&131080&&(i==null||i.setOpacity(I.toString()))},[_,w,D,i,N,W,oe,ee,Ie,Q,p,d,y,T,M,$,z,I,a,c,ae,Pe,ve,nt,Ge,Ee]}class xd extends Et{constructor(e){super(),Lt(this,e,X3,W3,wt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const J3=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),a0=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function l0(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof Jr.Marker)&&c0(r);return{c(){e=U("div"),n&&n.c()},m(o,c){q(o,e,c),n&&n.m(e,null),r[32](e),t=!0},p(o,c){var a;(a=o[4])!=null&&a.length||o[3]instanceof Jr.Marker?n?(n.p(o,c),c[0]&24&&j(n,1)):(n=c0(o),n.c(),j(n,1),n.m(e,null)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(o){t||(j(n),t=!0)},o(o){Z(n),t=!1},d(o){o&&V(e),n&&n.d(),r[32](null)}}}function c0(r){let e;const t=r[30].default,n=Cn(t,r,r[29],a0);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&Mn(n,t,i,i[29],e?Tn(t,i[29],o,J3):Ln(i[29]),a0)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Y3(r){let e,t,n=r[9].default&&l0(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&j(n,1)):(n=l0(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function Q3(r,e,t){let n,i,o,c,a,d,{$$slots:p={},$$scope:_}=e;const y=Pm(p);let{closeButton:w=void 0}=e,{closeOnClickOutside:T=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:$=!1}=e,{openOn:D="click"}=e,{openIfTopMost:z=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:F=void 0}=e,{offset:N=void 0}=e,{popupClass:W=void 0}=e,{maxWidth:oe=void 0}=e,{lngLat:J=void 0}=e,{html:ee=void 0}=e,{open:pe=!1}=e;const Ie=ms(),{map:Q,popupTarget:ae,layerEvent:Pe,layer:ve,eventTopMost:nt,markerClickManager:Ge}=Da();at(r,Q,_e=>t(2,o=_e)),at(r,ae,_e=>t(3,a=_e)),at(r,Pe,_e=>t(28,c=_e)),at(r,ve,_e=>t(35,d=_e));const Ee=["click","dblclick","contextmenu"];let De,Ct=!1,it;function lt(){if(!De)return;let _e=De.getElement();!_e||_e===it||(it=_e,D==="hover"&&(it.style.pointerEvents="none"),it.addEventListener("mouseenter",()=>{t(24,Ct=!0)},{passive:!0}),it.addEventListener("mouseleave",()=>{t(24,Ct=!1)},{passive:!0}),it.addEventListener("click",()=>{M&&t(0,pe=!1)},{passive:!0}))}Ls(()=>{if(o)return o.on("click",Wt),o.on("contextmenu",Wt),Ge.add(Ze),typeof a=="string"&&(o.on("click",a,yt),o.on("dblclick",a,yt),o.on("contextmenu",a,yt),o.on("mousemove",a,ut),o.on("mouseleave",a,yn),o.on("touchstart",a,It),o.on("touchend",a,Qt)),()=>{o!=null&&o.loaded()&&(De==null||De.remove(),o.off("click",Wt),o.off("contextmenu",Wt),Ge.remove(Ze),a instanceof Jr.Marker?a.getPopup()===De&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,yt),o.off("dblclick",a,yt),o.off("contextmenu",a,yt),o.off("mousemove",a,ut),o.off("mouseleave",a,yn),o.off("touchstart",a,It),o.off("touchend",a,Qt)))}});function mt(_e){return z?!("marker"in _e)&&!l3(_e)&&nt(_e)!==d:!1}let dt=null,Xe="normal";function $t(_e){"layerType"in _e&&_e.layerType==="deckgl"?(t(10,J=_e.coordinate),t(4,dt=_e.object?[_e.object]:null)):(t(10,J=_e.lngLat),t(4,dt=_e.features??[]))}function yt(_e){_e.type!==D||mt(_e)||($t(_e),setTimeout(()=>t(0,pe=!0)))}let Rt=null;function It(_e){Rt=_e.point}function Qt(_e){if(!Rt||D!=="hover")return;let Pn=Rt.dist(_e.point);Rt=null,Pn<3&&(t(10,J=_e.lngLat),t(4,dt=_e.features??[]),De.isOpen()?t(25,Xe="justOpened"):(t(25,Xe="opening"),t(0,pe=!0)))}function yn(_e){D!=="hover"||Rt||Xe!=="normal"||(t(0,pe=!1),t(4,dt=null))}function ut(_e){if(!(D!=="hover"||Rt||Xe!=="normal")){if(mt(_e)){t(0,pe=!1),t(4,dt=null);return}t(0,pe=!0),t(4,dt=_e.features??[]),t(10,J=_e.lngLat)}}function Wt(_e){if(Xe==="justOpened"){t(25,Xe="normal");return}if(!T)return;let Pn=[it,a instanceof Jr.Marker?a==null?void 0:a.getElement():null];pe&&De.isOpen()&&!Pn.some(Ne=>Ne==null?void 0:Ne.contains(_e.originalEvent.target))&&(_e.type==="contextmenu"&&D==="contextmenu"||_e.type!=="contextmenu")&&t(0,pe=!1)}function Ze(_e){T&&pe&&De.isOpen()&&_e.marker!==a&&t(0,pe=!1)}Yr(()=>{o&&(De!=null&&De.isOpen())&&De.remove()});let Ve;const St=()=>t(0,pe=!1);function Ut(_e){hn[_e?"unshift":"push"](()=>{Ve=_e,t(1,Ve)})}return r.$$set=_e=>{"closeButton"in _e&&t(11,w=_e.closeButton),"closeOnClickOutside"in _e&&t(12,T=_e.closeOnClickOutside),"closeOnClickInside"in _e&&t(13,M=_e.closeOnClickInside),"closeOnMove"in _e&&t(14,$=_e.closeOnMove),"openOn"in _e&&t(15,D=_e.openOn),"openIfTopMost"in _e&&t(16,z=_e.openIfTopMost),"focusAfterOpen"in _e&&t(17,I=_e.focusAfterOpen),"anchor"in _e&&t(18,F=_e.anchor),"offset"in _e&&t(19,N=_e.offset),"popupClass"in _e&&t(20,W=_e.popupClass),"maxWidth"in _e&&t(21,oe=_e.maxWidth),"lngLat"in _e&&t(10,J=_e.lngLat),"html"in _e&&t(22,ee=_e.html),"open"in _e&&t(0,pe=_e.open),"$$scope"in _e&&t(29,_=_e.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=w??(!T&&!M)),r.$$.dirty[0]&146685952&&(De||(t(23,De=new Jr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:$,focusAfterOpen:I,maxWidth:oe,className:W,anchor:F,offset:N})),it=De.getElement(),De.on("open",()=>{t(0,pe=!0),lt(),Ie("open",De)}),De.on("close",()=>{t(0,pe=!1),Ie("close",De)}),De.on("hover",()=>{Ie("hover",De)}))),r.$$.dirty[0]&8421384&&De&&a instanceof Jr.Marker&&(D==="click"?a.setPopup(De):a.getPopup()===De&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ee.includes(D)&&(c==null?void 0:c.type)===D&&(yt(c),Nt(Pe,c=null,c)),r.$$.dirty[0]&268468224&&t(26,i=D==="hover"&&((c==null?void 0:c.type)==="mousemove"||(c==null?void 0:c.type)==="mouseenter")),r.$$.dirty[0]&352354304&&D==="hover"&&Pe&&(i&&c&&$t(c),t(0,pe=(i||Ct)??!1)),r.$$.dirty[0]&12582914&&(Ve?De.setDOMContent(Ve):ee&&De.setHTML(ee)),r.$$.dirty[0]&8389632&&J&&De.setLngLat(J),r.$$.dirty[0]&41943045&&o){let _e=De.isOpen();pe&&!_e?(De.addTo(o),Xe==="opening"&&t(25,Xe="justOpened")):!pe&&_e&&De.remove()}},[pe,Ve,o,a,dt,Q,ae,Pe,ve,y,J,w,T,M,$,D,z,I,F,N,W,oe,ee,De,Ct,Xe,i,n,c,_,p,St,Ut]}let Wb=class extends Et{constructor(e){super(),Lt(this,e,Q3,Y3,wt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var zc=Math.pow,Gi=(r,e,t)=>new Promise((n,i)=>{var o=d=>{try{a(t.next(d))}catch(p){i(p)}},c=d=>{try{a(t.throw(d))}catch(p){i(p)}},a=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,c);a((t=t.apply(r,e)).next())}),$o=Uint8Array,Ac=Uint16Array,e4=Int32Array,Kb=new $o([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Xb=new $o([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),t4=new $o([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Jb=function(r,e){for(var t=new Ac(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new e4(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},Yb=Jb(Kb,2),Qb=Yb.b,n4=Yb.r;Qb[28]=258,n4[258]=28;var r4=Jb(Xb,0),i4=r4.b,um=new Ac(32768);for(cr=0;cr<32768;++cr)Vs=(cr&43690)>>1|(cr&21845)<<1,Vs=(Vs&52428)>>2|(Vs&13107)<<2,Vs=(Vs&61680)>>4|(Vs&3855)<<4,um[cr]=((Vs&65280)>>8|(Vs&255)<<8)>>1;var Vs,cr,lh=function(r,e,t){for(var n=r.length,i=0,o=new Ac(e);i<n;++i)r[i]&&++o[r[i]-1];var c=new Ac(e);for(i=1;i<e;++i)c[i]=c[i-1]+o[i-1]<<1;var a;if(t){a=new Ac(1<<e);var d=15-e;for(i=0;i<n;++i)if(r[i])for(var p=i<<4|r[i],_=e-r[i],y=c[r[i]-1]++<<_,w=y|(1<<_)-1;y<=w;++y)a[um[y]>>d]=p}else for(a=new Ac(n),i=0;i<n;++i)r[i]&&(a[i]=um[c[r[i]-1]++]>>15-r[i]);return a},Lh=new $o(288);for(cr=0;cr<144;++cr)Lh[cr]=8;var cr;for(cr=144;cr<256;++cr)Lh[cr]=9;var cr;for(cr=256;cr<280;++cr)Lh[cr]=7;var cr;for(cr=280;cr<288;++cr)Lh[cr]=8;var cr,ev=new $o(32);for(cr=0;cr<32;++cr)ev[cr]=5;var cr,o4=lh(Lh,9,1),s4=lh(ev,5,1),qp=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},ls=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Zp=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},a4=function(r){return(r+7)/8|0},l4=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new $o(t-e);return n.set(r.subarray(e,t)),n},c4=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Ao=function(r,e,t){var n=new Error(e||c4[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Ao),!t)throw n;return n},Km=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new $o(0);var c=!t||e.i!=2,a=e.i;t||(t=new $o(i*3));var d=function(yn){var ut=t.length;if(yn>ut){var Wt=new $o(Math.max(ut*2,yn));Wt.set(t),t=Wt}},p=e.f||0,_=e.p||0,y=e.b||0,w=e.l,T=e.d,M=e.m,$=e.n,D=i*8;do{if(!w){p=ls(r,_,1);var z=ls(r,_+1,3);if(_+=3,z)if(z==1)w=o4,T=s4,M=9,$=5;else if(z==2){var W=ls(r,_,31)+257,oe=ls(r,_+10,15)+4,J=W+ls(r,_+5,31)+1;_+=14;for(var ee=new $o(J),pe=new $o(19),Ie=0;Ie<oe;++Ie)pe[t4[Ie]]=ls(r,_+Ie*3,7);_+=oe*3;for(var Q=qp(pe),ae=(1<<Q)-1,Pe=lh(pe,Q,1),Ie=0;Ie<J;){var ve=Pe[ls(r,_,ae)];_+=ve&15;var I=ve>>4;if(I<16)ee[Ie++]=I;else{var nt=0,Ge=0;for(I==16?(Ge=3+ls(r,_,3),_+=2,nt=ee[Ie-1]):I==17?(Ge=3+ls(r,_,7),_+=3):I==18&&(Ge=11+ls(r,_,127),_+=7);Ge--;)ee[Ie++]=nt}}var Ee=ee.subarray(0,W),De=ee.subarray(W);M=qp(Ee),$=qp(De),w=lh(Ee,M,1),T=lh(De,$,1)}else Ao(1);else{var I=a4(_)+4,F=r[I-4]|r[I-3]<<8,N=I+F;if(N>i){a&&Ao(0);break}c&&d(y+F),t.set(r.subarray(I,N),y),e.b=y+=F,e.p=_=N*8,e.f=p;continue}if(_>D){a&&Ao(0);break}}c&&d(y+131072);for(var Ct=(1<<M)-1,it=(1<<$)-1,lt=_;;lt=_){var nt=w[Zp(r,_)&Ct],mt=nt>>4;if(_+=nt&15,_>D){a&&Ao(0);break}if(nt||Ao(2),mt<256)t[y++]=mt;else if(mt==256){lt=_,w=null;break}else{var dt=mt-254;if(mt>264){var Ie=mt-257,Xe=Kb[Ie];dt=ls(r,_,(1<<Xe)-1)+Qb[Ie],_+=Xe}var $t=T[Zp(r,_)&it],yt=$t>>4;$t||Ao(3),_+=$t&15;var De=i4[yt];if(yt>3){var Xe=Xb[yt];De+=Zp(r,_)&(1<<Xe)-1,_+=Xe}if(_>D){a&&Ao(0);break}c&&d(y+131072);var Rt=y+dt;if(y<De){var It=o-De,Qt=Math.min(De,Rt);for(It+y<0&&Ao(3);y<Qt;++y)t[y]=n[It+y]}for(;y<Rt;y+=4)t[y]=t[y-De],t[y+1]=t[y+1-De],t[y+2]=t[y+2-De],t[y+3]=t[y+3-De];y=Rt}}e.l=w,e.p=lt,e.b=y,e.f=p,w&&(p=1,e.m=M,e.d=T,e.n=$)}while(!p);return y==t.length?t:l4(t,0,y)},u4=new $o(0),h4=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Ao(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},f4=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},d4=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Ao(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Ao(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function p4(r,e){return Km(r,{i:2},e&&e.out,e&&e.dictionary)}function m4(r,e){var t=h4(r);return t+8>r.length&&Ao(6,"invalid gzip data"),Km(r.subarray(t,-8),{i:2},e&&e.out||new $o(f4(r)),e&&e.dictionary)}function g4(r,e){return Km(r.subarray(d4(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function hm(r,e){return r[0]==31&&r[1]==139&&r[2]==8?m4(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?p4(r,e):g4(r,e)}var _4=typeof TextDecoder<"u"&&new TextDecoder,y4=0;try{_4.decode(u4,{stream:!0}),y4=1}catch{}var tv=(r,e)=>r*zc(2,e),ju=(r,e)=>Math.floor(r/zc(2,e)),fd=(r,e)=>tv(r.getUint16(e+1,!0),8)+r.getUint8(e),nv=(r,e)=>tv(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),b4=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=fd(n,i+1);if(e!==o)return e-o;const c=fd(n,i+4);return t!==c?t-c:0},v4=(r,e,t,n)=>{const i=rv(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},u0=(r,e,t,n)=>{const i=rv(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},rv=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const c=o+i>>1,a=b4(e,t,n,r,c*17);if(a>0)i=c+1;else if(a<0)o=c-1;else return[nv(r,c*17+7),r.getUint32(c*17+13,!0)]}return null},w4=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,iv=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:fd(r,e*17+1),y:fd(r,e*17+4),offset:nv(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},h0=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(iv(t,n));return x4(e)},x4=r=>{r.sort(w4);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=ju(i.offset,8)&255,t[n*17+9]=ju(i.offset,16)&255,t[n*17+10]=ju(i.offset,24)&255,t[n*17+11]=ju(i.offset,32)&255,t[n*17+12]=ju(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},k4=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=iv(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,c=Math.trunc(e.x/(1<<o)),a=Math.trunc(e.y/(1<<o));return{z:i,x:c,y:a}}return null};function S4(r){return Gi(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),c=JSON.parse(o.decode(new DataView(e.data,10,n)));let a=0;c.compression==="gzip"&&(a=2);let d=0;"minzoom"in c&&(d=+c.minzoom);let p=0;"maxzoom"in c&&(p=+c.maxzoom);let _=0,y=0,w=0,T=-180,M=-85,$=180,D=85;if(c.bounds){const I=c.bounds.split(",");T=+I[0],M=+I[1],$=+I[2],D=+I[3]}if(c.center){const I=c.center.split(",");_=+I[0],y=+I[1],w=+I[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:d,maxZoom:p,minLon:T,minLat:M,maxLon:$,maxLat:D,centerZoom:w,centerLon:_,centerLat:y,etag:e.etag}})}function C4(r,e,t,n,i,o,c){return Gi(this,null,function*(){let a=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=h0(a));const d=u0(new DataView(a),n,i,o);if(d){let y=(yield e.getBytes(d.offset,d.length,c)).data;const w=new DataView(y);return w.getUint8(0)===31&&w.getUint8(1)===139&&(y=hm(new Uint8Array(y))),{data:y}}const p=k4(new DataView(a),{z:n,x:i,y:o});if(p){const _=v4(new DataView(a),p.z,p.x,p.y);if(_){let y=yield t.getArrayBuffer(e,_.offset,_.length,r);r.specVersion===1&&(y=h0(y));const w=u0(new DataView(y),n,i,o);if(w){let M=(yield e.getBytes(w.offset,w.length,c)).data;const $=new DataView(M);return $.getUint8(0)===31&&$.getUint8(1)===139&&(M=hm(new Uint8Array(M))),{data:M}}}}})}var ov={getHeader:S4,getZxy:C4},T4=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},M4=class{constructor(){this.tilev4=(r,e)=>Gi(this,null,function*(){if(r.type==="json"){const y=r.url.substr(10);let w=this.tiles.get(y);w||(w=new f0(y),this.tiles.set(y,w));const T=yield w.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:T.minZoom,maxzoom:T.maxZoom,bounds:[T.minLon,T.minLat,T.maxLon,T.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=r.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const i=n[1];let o=this.tiles.get(i);o||(o=new f0(i),this.tiles.set(i,o));const c=n[2],a=n[3],d=n[4],p=yield o.getHeader(),_=yield o==null?void 0:o.getZxy(+c,+a,+d,e.signal);return _?{data:new Uint8Array(_.data),cacheControl:_.cacheControl,expires:_.expires}:p.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=T4(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function Sc(r,e){return(e>>>0)*4294967296+(r>>>0)}function L4(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return Sc(r,i);throw new Error("Expected varint not more than 10 bytes")}function Uu(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,L4(n,r))}function E4(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var I4=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function A4(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>zc(2,r)-1||t>zc(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=I4[r],i=zc(2,r);let o=0,c=0,a=0;const d=[e,t];let p=i/2;for(;p>0;)o=(d[0]&p)>0?1:0,c=(d[1]&p)>0?1:0,a+=p*p*(3*o^c),E4(p,d,o,c),p=p/2;return n+a}function sv(r,e){return Gi(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return hm(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var P4=127;function z4(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var D4=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Gi(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const c=new Headers(this.customHeaders);c.set("range",`bytes=${r}-${r+e-1}`);let a;this.mustReload&&(a="reload");let d=yield fetch(this.url,{signal:o,cache:a,headers:c});if(r===0&&d.status===416){const w=d.headers.get("Content-Range");if(!w||!w.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const T=+w.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${T-1}`}})}let p=d.headers.get("Etag");if(p!=null&&p.startsWith("W/")&&(p=null),d.status===416||n&&p&&p!==n)throw this.mustReload=!0,new fm(n);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const _=d.headers.get("Content-Length");if(d.status===200&&(!_||+_>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function cs(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*zc(2,32)+n}function $4(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:cs(t,8),rootDirectoryLength:cs(t,16),jsonMetadataOffset:cs(t,24),jsonMetadataLength:cs(t,32),leafDirectoryOffset:cs(t,40),leafDirectoryLength:cs(t,48),tileDataOffset:cs(t,56),tileDataLength:cs(t,64),numAddressedTiles:cs(t,72),numTileEntries:cs(t,80),numTileContents:cs(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function av(r){const e={buf:new Uint8Array(r),pos:0},t=Uu(e),n=[];let i=0;for(let o=0;o<t;o++){const c=Uu(e);n.push({tileId:i+c,offset:0,length:0,runLength:1}),i+=c}for(let o=0;o<t;o++)n[o].runLength=Uu(e);for(let o=0;o<t;o++)n[o].length=Uu(e);for(let o=0;o<t;o++){const c=Uu(e);c===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=c-1}return n}function R4(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var fm=class extends Error{};function F4(r,e){return Gi(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(R4(t.data)<3)return[yield ov.getHeader(r)];const i=t.data.slice(0,P4),o=$4(i,t.etag),c=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),a=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=av(yield e(c,o.internalCompression));return[o,[a,d.length,d]]})}function B4(r,e,t,n,i){return Gi(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),c=yield e(o.data,i.internalCompression),a=av(c);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var O4=class{constructor(r=100,e=!0,t=sv){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Gi(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{F4(r,this.decompress).then(c=>{c[1]&&this.cache.set(c[1][0],{lastUsed:this.counter++,data:Promise.resolve(c[1][2])}),i(c[0]),this.prune()}).catch(c=>{o(c)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Gi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const c=new Promise((a,d)=>{B4(r,this.decompress,e,t,n).then(p=>{a(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:c}),c})}getArrayBuffer(r,e,t,n){return Gi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const c=new Promise((a,d)=>{r.getBytes(e,t,void 0,n.etag).then(p=>{a(p.data),this.cache.has(i),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:c}),c})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Gi(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},f0=class{constructor(r,e,t){typeof r=="string"?this.source=new D4(r):this.source=r,t?this.decompress=t:this.decompress=sv,e?this.cache=e:this.cache=new O4}getHeader(){return Gi(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Gi(this,null,function*(){const i=A4(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return ov.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let c=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let d=0;d<=3;d++){const p=yield this.cache.getDirectory(this.source,c,a,o),_=z4(p,i);if(_){if(_.runLength>0){const y=yield this.source.getBytes(o.tileDataOffset+_.offset,_.length,n,o.etag);return{data:yield this.decompress(y.data,o.tileCompression),cacheControl:y.cacheControl,expires:y.expires}}c=o.leafDirectoryOffset+_.offset,a=_.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Gi(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof fm)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Gi(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Gi(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof fm)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};function N4(r){let e;const t=r[16].default,n=Cn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&Mn(n,t,i,i[24],e?Tn(t,i[24],o,null):Ln(i[24]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function j4(r){let e,t,n;function i(c){r[17](c)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[N4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new wd({props:o}),hn.push(()=>An(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.applyToClusters=c[9]),a&1024&&(d.minzoom=c[10]),a&2048&&(d.maxzoom=c[11]),a&4096&&(d.hoverCursor=c[12]),a&8192&&(d.manageHoverState=c[13]),a&16384&&(d.eventsIfTopMost=c[14]),a&32768&&(d.interactive=c[15]),a&16777216&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function U4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=vl("symbol")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:_=void 0}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:$=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:N=!0}=e;function W(ae){I=ae,t(0,I)}function oe(ae){Dn.call(this,r,ae)}function J(ae){Dn.call(this,r,ae)}function ee(ae){Dn.call(this,r,ae)}function pe(ae){Dn.call(this,r,ae)}function Ie(ae){Dn.call(this,r,ae)}function Q(ae){Dn.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,o=ae.id),"source"in ae&&t(2,c=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,d=ae.beforeId),"beforeLayerType"in ae&&t(5,p=ae.beforeLayerType),"paint"in ae&&t(6,_=ae.paint),"layout"in ae&&t(7,y=ae.layout),"filter"in ae&&t(8,w=ae.filter),"applyToClusters"in ae&&t(9,T=ae.applyToClusters),"minzoom"in ae&&t(10,M=ae.minzoom),"maxzoom"in ae&&t(11,$=ae.maxzoom),"hoverCursor"in ae&&t(12,D=ae.hoverCursor),"manageHoverState"in ae&&t(13,z=ae.manageHoverState),"hovered"in ae&&t(0,I=ae.hovered),"eventsIfTopMost"in ae&&t(14,F=ae.eventsIfTopMost),"interactive"in ae&&t(15,N=ae.interactive),"$$scope"in ae&&t(24,i=ae.$$scope)},[I,o,c,a,d,p,_,y,w,T,M,$,D,z,F,N,n,W,oe,J,ee,pe,Ie,Q,i]}class gh extends Et{constructor(e){super(),Lt(this,e,U4,j4,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function d0(r){let e=r[0],t,n,i=p0(r);return{c(){i.c(),t=Qn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c&1&&wt(e,e=o[0])?(tn(),Z(i,1,1,tt),nn(),i=p0(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function p0(r){let e;const t=r[15].default,n=Cn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&Mn(n,t,i,i[14],e?Tn(t,i[14],o,null):Ln(i[14]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function V4(r){let e,t,n=r[0]&&d0(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=d0(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function q4(r,e,t){let n,i,{$$slots:o={},$$scope:c}=e,{id:a=vl("vector")}=e,{url:d=null}=e,{tiles:p=null}=e,{promoteId:_=null}=e,{bounds:y=null}=e,{scheme:w=null}=e,{attribution:T=null}=e,{minzoom:M=null}=e,{maxzoom:$=null}=e,{volatile:D=null}=e;if(d&&d.includes("pmtiles://")&&!Jr.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let N=new M4;Jr.addProtocol("pmtiles",N.tile)}const{map:z,self:I}=Ub();at(r,z,N=>t(13,i=N)),at(r,I,N=>t(0,n=N));let F;return Yr(()=>{n&&i&&(Zb(z,n,F),Nt(I,n=null,n),F=void 0)}),r.$$set=N=>{"id"in N&&t(3,a=N.id),"url"in N&&t(4,d=N.url),"tiles"in N&&t(5,p=N.tiles),"promoteId"in N&&t(6,_=N.promoteId),"bounds"in N&&t(7,y=N.bounds),"scheme"in N&&t(8,w=N.scheme),"attribution"in N&&t(9,T=N.attribution),"minzoom"in N&&t(10,M=N.minzoom),"maxzoom"in N&&t(11,$=N.maxzoom),"volatile"in N&&t(12,D=N.volatile),"$$scope"in N&&t(14,c=N.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==a&&(Nt(I,n=a,n),qb(i,n,La({type:"vector",url:d,tiles:p,promoteId:_,bounds:y,scheme:w,attribution:T,minzoom:M,maxzoom:$,volatile:D}),N=>i&&N===n,()=>{n&&(F=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{F=i==null?void 0:i.getSource(a)}))},[n,z,I,a,d,p,_,y,w,T,M,$,D,i,c,o]}class Eh extends Et{constructor(e){super(),Lt(this,e,q4,V4,wt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}function Z4(r){let e,t,n,i,o,c,a,d,p;return{c(){e=U("label"),t=xe(`Basemap:
  `),n=U("select"),i=U("option"),i.textContent="MapTiler Dataviz",o=U("option"),o.textContent="MapTiler Streets",c=U("option"),c.textContent="MapTiler Satellite",a=U("option"),a.textContent="OS Open Zoomstack",i.__value="dataviz",Wn(i,i.__value),o.__value="streets-v2",Wn(o,o.__value),c.__value="hybrid",Wn(c,c.__value),a.__value="uk-openzoomstack-light",Wn(a,a.__value),r[0]===void 0&&us(()=>r[1].call(n))},m(_,y){q(_,e,y),R(e,t),R(e,n),R(n,i),R(n,o),R(n,c),R(n,a),Zi(n,r[0],!0),d||(p=xt(n,"change",r[1]),d=!0)},p(_,[y]){y&1&&Zi(n,_[0])},i:tt,o:tt,d(_){_&&V(e),d=!1,p()}}}function G4(r,e,t){let n;at(r,im,o=>t(0,n=o));function i(){n=Sa(this),im.set(n)}return[n,i]}class H4 extends Et{constructor(e){super(),Lt(this,e,G4,Z4,wt,{})}}const W4=r=>({}),m0=r=>({}),K4=r=>({}),g0=r=>({});function _0(r){let e,t;return e=new Xm({props:{color:"var(--pico-secondary-inverse)",$$slots:{default:[X4]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function X4(r){let e,t;const n=r[3].help,i=Cn(n,r,r[6],g0);return{c(){e=U("div"),i&&i.c(),fe(e,"class","context-layer-help-content")},m(o,c){q(o,e,c),i&&i.m(e,null),t=!0},p(o,c){i&&i.p&&(!t||c&64)&&Mn(i,n,o,o[6],t?Tn(n,o[6],c,K4):Ln(o[6]),g0)},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function y0(r){let e,t;const n=r[3].legend,i=Cn(n,r,r[6],m0);return{c(){e=U("div"),i&&i.c(),fe(e,"class","legend svelte-wh5rsr")},m(o,c){q(o,e,c),i&&i.m(e,null),t=!0},p(o,c){i&&i.p&&(!t||c&64)&&Mn(i,n,o,o[6],t?Tn(n,o[6],c,W4):Ln(o[6]),m0)},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function J4(r){let e,t,n,i,o,c,a,d,p,_,y=r[2].help&&_0(r),w=r[0]&&r[2].legend&&y0(r);return{c(){e=U("button"),t=U("input"),n=ie(),i=xe(r[1]),o=ie(),y&&y.c(),c=ie(),w&&w.c(),a=Qn(),st(t,"aspect-ratio","1.0"),fe(t,"type","checkbox"),st(e,"display","flex"),st(e,"align-items","center"),st(e,"justify-content","leading"),st(e,"gap","8px"),st(e,"text-align","left"),fe(e,"class","secondary")},m(T,M){q(T,e,M),R(e,t),t.checked=r[0],R(e,n),R(e,i),R(e,o),y&&y.m(e,null),q(T,c,M),w&&w.m(T,M),q(T,a,M),d=!0,p||(_=[xt(t,"change",r[4]),xt(e,"click",r[5])],p=!0)},p(T,[M]){M&1&&(t.checked=T[0]),(!d||M&2)&&Mt(i,T[1]),T[2].help?y?(y.p(T,M),M&4&&j(y,1)):(y=_0(T),y.c(),j(y,1),y.m(e,null)):y&&(tn(),Z(y,1,1,()=>{y=null}),nn()),T[0]&&T[2].legend?w?(w.p(T,M),M&5&&j(w,1)):(w=y0(T),w.c(),j(w,1),w.m(a.parentNode,a)):w&&(tn(),Z(w,1,1,()=>{w=null}),nn())},i(T){d||(j(y),j(w),d=!0)},o(T){Z(y),Z(w),d=!1},d(T){T&&(V(e),V(c),V(a)),y&&y.d(),w&&w.d(T),p=!1,mr(_)}}}function Y4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=Pm(n);let{label:c}=e,{show:a=!1}=e;function d(){a=this.checked,t(0,a)}const p=()=>t(0,a=!a);return r.$$set=_=>{"label"in _&&t(1,c=_.label),"show"in _&&t(0,a=_.show),"$$scope"in _&&t(6,i=_.$$scope)},[a,c,o,n,d,p,i]}class es extends Et{constructor(e){super(),Lt(this,e,Y4,J4,wt,{label:1,show:0})}}let Jf=$n(!0);function Q4(r){let e,t;return e=new zi({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function eS(r){let e,t;return e=new pr({props:{data:r[1],$$slots:{default:[Q4]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function tS(r,e,t){let n;return at(r,Jf,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class nS extends Et{constructor(e){super(),Lt(this,e,tS,eS,wt,{})}}function rS(r){let e,t;return e=new xd({props:{lngLat:r[0],$$slots:{default:[oS]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function iS(r){let e,t,n;function i(c){r[3](c)}let o={draggable:!0,$$slots:{default:[sS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new xd({props:o}),hn.push(()=>An(e,"lngLat",i)),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,a){const d={};a&16&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.lngLat=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function oS(r){let e,t;const n=r[2].default,i=Cn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),fe(e,"class","dot svelte-nb4dgc")},m(o,c){q(o,e,c),i&&i.m(e,null),t=!0},p(o,c){i&&i.p&&(!t||c&16)&&Mn(i,n,o,o[4],t?Tn(n,o[4],c,null):Ln(o[4]),null)},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function sS(r){let e,t;const n=r[2].default,i=Cn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),fe(e,"class","dot svelte-nb4dgc")},m(o,c){q(o,e,c),i&&i.m(e,null),t=!0},p(o,c){i&&i.p&&(!t||c&16)&&Mn(i,n,o,o[4],t?Tn(n,o[4],c,null):Ln(o[4]),null)},i(o){t||(j(i,o),t=!0)},o(o){Z(i,o),t=!1},d(o){o&&V(e),i&&i.d(o)}}}function aS(r){let e,t,n,i;const o=[iS,rS],c=[];function a(d,p){return d[1]?0:1}return e=a(r),t=c[e]=o[e](r),{c(){t.c(),n=Qn()},m(d,p){c[e].m(d,p),q(d,n,p),i=!0},p(d,[p]){let _=e;e=a(d),e===_?c[e].p(d,p):(tn(),Z(c[_],1,1,()=>{c[_]=null}),nn(),t=c[e],t?t.p(d,p):(t=c[e]=o[e](d),t.c()),j(t,1),t.m(n.parentNode,n))},i(d){i||(j(t),i=!0)},o(d){Z(t),i=!1},d(d){d&&V(n),c[e].d(d)}}}function lS(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:c=!1}=e;function a(d){o=d,t(0,o)}return r.$$set=d=>{"lngLat"in d&&t(0,o=d.lngLat),"draggable"in d&&t(1,c=d.draggable),"$$scope"in d&&t(4,i=d.$$scope)},[o,c,n,a,i]}class yl extends Et{constructor(e){super(),Lt(this,e,lS,aS,wt,{lngLat:0,draggable:1})}}function cS(r){let e,t,n;const i=r[2].default,o=Cn(i,r,r[5],null);return{c(){e=U("h2"),e.textContent="Help",t=ie(),o&&o.c()},m(c,a){q(c,e,a),q(c,t,a),o&&o.m(c,a),n=!0},p(c,a){o&&o.p&&(!n||a&32)&&Mn(o,i,c,c[5],n?Tn(i,c[5],a,null):Ln(c[5]),null)},i(c){n||(j(o,c),n=!0)},o(c){Z(o,c),n=!1},d(c){c&&(V(e),V(t)),o&&o.d(c)}}}function uS(r){let e,t,n,i,o,c,a,d;t=new vk({props:{color:r[0]}});function p(y){r[4](y)}let _={$$slots:{default:[cS]},$$scope:{ctx:r}};return r[1]!==void 0&&(_.show=r[1]),i=new yd({props:_}),hn.push(()=>An(i,"show",p)),{c(){e=U("button"),he(t.$$.fragment),n=ie(),he(i.$$.fragment),fe(e,"class","icon-btn help svelte-my65h"),fe(e,"title","Help")},m(y,w){q(y,e,w),le(t,e,null),q(y,n,w),le(i,y,w),c=!0,a||(d=xt(e,"click",nh(r[3])),a=!0)},p(y,[w]){const T={};w&1&&(T.color=y[0]),t.$set(T);const M={};w&32&&(M.$$scope={dirty:w,ctx:y}),!o&&w&2&&(o=!0,M.show=y[1],In(()=>o=!1)),i.$set(M)},i(y){c||(j(t.$$.fragment,y),j(i.$$.fragment,y),c=!0)},o(y){Z(t.$$.fragment,y),Z(i.$$.fragment,y),c=!1},d(y){y&&(V(e),V(n)),ce(t),ce(i,y),a=!1,d()}}}function hS(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:c="black"}=e;const a=()=>t(1,o=!0);function d(p){o=p,t(1,o)}return r.$$set=p=>{"color"in p&&t(0,c=p.color),"$$scope"in p&&t(5,i=p.$$scope)},[c,o,n,a,d,i]}class Xm extends Et{constructor(e){super(),Lt(this,e,hS,uS,wt,{color:0})}}function fS(r){let e,t,n,i;const o=r[1].default,c=Cn(o,r,r[0],null);return{c(){e=U("a"),c&&c.c(),fe(e,"href","#")},m(a,d){q(a,e,d),c&&c.m(e,null),t=!0,n||(i=xt(e,"click",zm(r[2])),n=!0)},p(a,[d]){c&&c.p&&(!t||d&1)&&Mn(c,o,a,a[0],t?Tn(o,a[0],d,null):Ln(a[0]),null)},i(a){t||(j(c,a),t=!0)},o(a){Z(c,a),t=!1},d(a){a&&V(e),c&&c.d(a),n=!1,i()}}}function dS(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(c){Dn.call(this,r,c)}return r.$$set=c=>{"$$scope"in c&&t(0,i=c.$$scope)},[i,n,o]}class On extends Et{constructor(e){super(),Lt(this,e,dS,fS,wt,{})}}function pS(r){let e,t,n,i,o,c=r[0]+1+"",a,d,p=r[1].length+"",_,y,w,T,M,$,D;return{c(){e=U("div"),t=U("button"),n=xe("Previous"),o=ie(),a=xe(c),d=xe(" / "),_=xe(p),y=ie(),w=U("button"),T=xe("Next"),t.disabled=i=r[0]==0,fe(t,"data-tooltip","Left"),w.disabled=M=r[0]==r[1].length-1,fe(w,"data-tooltip","Right"),st(e,"display","flex"),st(e,"justify-content","space-between"),st(e,"align-items","center")},m(z,I){q(z,e,I),R(e,t),R(t,n),R(e,o),R(e,a),R(e,d),R(e,_),R(e,y),R(e,w),R(w,T),$||(D=[xt(window,"keydown",r[2]),xt(t,"click",r[3]),xt(w,"click",r[4])],$=!0)},p(z,[I]){I&1&&i!==(i=z[0]==0)&&(t.disabled=i),I&1&&c!==(c=z[0]+1+"")&&Mt(a,c),I&2&&p!==(p=z[1].length+"")&&Mt(_,p),I&3&&M!==(M=z[0]==z[1].length-1)&&(w.disabled=M)},i:tt,o:tt,d(z){z&&V(e),$=!1,mr(D)}}}function mS(r,e,t){let n;at(r,Ro,p=>t(5,n=p));let{list:i}=e,{idx:o=0}=e;Ls(()=>{n==null||n.keyboard.disable()}),Yr(()=>{n==null||n.keyboard.enable()});function c(p){p.key=="ArrowLeft"&&(p.stopPropagation(),a()),p.key=="ArrowRight"&&(p.stopPropagation(),d())}function a(){o!=0&&t(0,o--,o)}function d(){o!=i.length-1&&t(0,o++,o)}return r.$$set=p=>{"list"in p&&t(1,i=p.list),"idx"in p&&t(0,o=p.idx)},[o,i,c,a,d]}class kd extends Et{constructor(e){super(),Lt(this,e,mS,pS,wt,{list:1,idx:0})}}function b0(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function v0(r){let e,t,n,i,o=r[4]+"",c,a;return{c(){e=U("div"),t=U("span"),i=ie(),c=xe(o),a=ie(),fe(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),st(t,"background",r[5]),st(e,"display","flex"),st(e,"align-items","center"),st(e,"gap","6px")},m(d,p){q(d,e,p),R(e,t),R(e,i),R(e,c),R(e,a)},p(d,p){p&2&&n!==(n="color-swatch "+d[1]+" svelte-1enycr6")&&fe(t,"class",n),p&1&&st(t,"background",d[5]),p&1&&o!==(o=d[4]+"")&&Mt(c,o)},d(d){d&&V(e)}}}function gS(r){let e,t=Nn(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=v0(b0(r,t,i));return{c(){e=U("div");for(let i=0;i<n.length;i+=1)n[i].c();st(e,"display","grid"),st(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),st(e,"gap","10px")},m(i,o){q(i,e,o);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null)},p(i,[o]){if(o&3){t=Nn(Object.entries(i[0]));let c;for(c=0;c<t.length;c+=1){const a=b0(i,t,c);n[c]?n[c].p(a,o):(n[c]=v0(a),n[c].c(),n[c].m(e,null))}for(;c<n.length;c+=1)n[c].d(1);n.length=t.length}},i:tt,o:tt,d(i){i&&V(e),pi(n,i)}}}function _S(r,e,t){let{labelColors:n}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e,c=`${100/o}%`;return r.$$set=a=>{"labelColors"in a&&t(0,n=a.labelColors),"swatchClass"in a&&t(1,i=a.swatchClass),"itemsPerRow"in a&&t(3,o=a.itemsPerRow)},[n,i,c,o]}class Jm extends Et{constructor(e){super(),Lt(this,e,_S,gS,wt,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function w0(r,e,t){const n=r.slice();return n[6]=e[t],n}function x0(r,e,t){const n=r.slice();return n[9]=e[t],n}function k0(r){let e,t;return{c(){e=U("span"),t=xe(""),fe(e,"class","bucket svelte-3plrz9"),st(e,"background",r[9])},m(n,i){q(n,e,i),R(e,t)},p(n,i){i&1&&st(e,"background",n[9])},d(n){n&&V(e)}}}function S0(r){let e;return{c(){e=U("span"),e.textContent=`${r[6]}`,fe(e,"class","svelte-3plrz9")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function yS(r){let e,t,n,i,o=Nn(r[0]),c=[];for(let p=0;p<o.length;p+=1)c[p]=k0(x0(r,o,p));let a=Nn(r[3]),d=[];for(let p=0;p<a.length;p+=1)d[p]=S0(w0(r,a,p));return{c(){e=U("div"),t=U("div");for(let p=0;p<c.length;p+=1)c[p].c();n=ie(),i=U("div");for(let p=0;p<d.length;p+=1)d[p].c();fe(t,"class","colors svelte-3plrz9"),fe(i,"class","labels svelte-3plrz9"),fe(e,"class","svelte-3plrz9"),en(e,"full-width-bucket-legend",r[2]),en(e,"bucketed",r[1].hasOwnProperty("buckets")),en(e,"limits",r[1].hasOwnProperty("limits"))},m(p,_){q(p,e,_),R(e,t);for(let y=0;y<c.length;y+=1)c[y]&&c[y].m(t,null);R(e,n),R(e,i);for(let y=0;y<d.length;y+=1)d[y]&&d[y].m(i,null)},p(p,[_]){if(_&1){o=Nn(p[0]);let y;for(y=0;y<o.length;y+=1){const w=x0(p,o,y);c[y]?c[y].p(w,_):(c[y]=k0(w),c[y].c(),c[y].m(t,null))}for(;y<c.length;y+=1)c[y].d(1);c.length=o.length}if(_&8){a=Nn(p[3]);let y;for(y=0;y<a.length;y+=1){const w=w0(p,a,y);d[y]?d[y].p(w,_):(d[y]=S0(w),d[y].c(),d[y].m(i,null))}for(;y<d.length;y+=1)d[y].d(1);d.length=a.length}_&4&&en(e,"full-width-bucket-legend",p[2]),_&2&&en(e,"bucketed",p[1].hasOwnProperty("buckets")),_&2&&en(e,"limits",p[1].hasOwnProperty("limits"))},i:tt,o:tt,d(p){p&&V(e),pi(c,p),pi(d,p)}}}function bS(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:c=!1}=e,a=[];"limits"in i?a=i.limits:a=i.buckets;let d=a.map(p=>typeof p=="number"?o>0?p.toFixed(o):p.toLocaleString():p);return r.$$set=p=>{"colorScale"in p&&t(0,n=p.colorScale),"labels"in p&&t(1,i=p.labels),"decimalPlaces"in p&&t(4,o=p.decimalPlaces),"fullWidthBucketLegend"in p&&t(2,c=p.fullWidthBucketLegend)},[n,i,c,d,o]}class Oo extends Et{constructor(e){super(),Lt(this,e,bS,yS,wt,{colorScale:0,labels:1,decimalPlaces:4,fullWidthBucketLegend:2})}}function vS(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:wS}=mb;function xS(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$;return T=Dm(r[8][0]),{c(){e=U("button"),e.textContent="Stop StreetView",t=ie(),n=U("fieldset"),i=U("legend"),i.textContent="Source:",o=ie(),c=U("label"),a=U("input"),d=xe(`
      Google Street View`),p=ie(),_=U("label"),y=U("input"),w=xe(`
      Bing Streetside`),fe(e,"class","secondary"),fe(a,"type","radio"),a.__value="google",Wn(a,a.__value),fe(y,"type","radio"),y.__value="bing",Wn(y,y.__value),T.p(a,y)},m(D,z){q(D,e,z),q(D,t,z),q(D,n,z),R(n,i),R(n,o),R(n,c),R(c,a),a.checked=a.__value===r[0],R(c,d),R(n,p),R(n,_),R(_,y),y.checked=y.__value===r[0],R(_,w),M||($=[xt(e,"click",r[3]),xt(a,"change",r[7]),xt(y,"change",r[9])],M=!0)},p(D,z){z&1&&(a.checked=a.__value===D[0]),z&1&&(y.checked=y.__value===D[0])},d(D){D&&(V(e),V(t),V(n)),T.r(),M=!1,mr($)}}}function kS(r){let e,t,n;return{c(){e=U("button"),e.textContent="StreetView",fe(e,"class","secondary")},m(i,o){q(i,e,o),t||(n=xt(e,"click",r[2]),t=!0)},p:tt,d(i){i&&V(e),t=!1,n()}}}function SS(r){let e,t,n;function i(a,d){return a[1]?kS:xS}let o=i(r),c=o(r);return{c(){c.c(),e=Qn()},m(a,d){c.m(a,d),q(a,e,d),t||(n=xt(wS,"keydown",r[4]),t=!0)},p(a,[d]){o===(o=i(a))&&c?c.p(a,d):(c.d(1),c=o(a),c&&(c.c(),c.m(e.parentNode,e)))},i:tt,o:tt,d(a){a&&V(e),c.d(a),t=!1,n()}}}function CS(r,e,t){let n;at(r,Jf,$=>t(1,n=$));let{map:i}=e,{maptilerBasemap:o}=e,c="google",a=[];function d(){Nt(Jf,n=!1,n),i.on("click",_),i.getCanvas().style.cursor="crosshair";for(let $ of vS(i,o))a.push([$,i.getPaintProperty($,"line-color")]),i.setPaintProperty($,"line-color","cyan")}function p(){Nt(Jf,n=!0,n),i.off("click",_),i.getCanvas().style.cursor="inherit";for(let[$,D]of a)i.setPaintProperty($,"line-color",D);a=[]}Yr(p);function _($){let D=$.lngLat.lng,z=$.lngLat.lat;c=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${z},${D}&cbp=11,0,0,0,0`,"_blank"):c=="bing"&&window.open(`https://www.bing.com/maps?cp=${z}~${D}&style=x`,"_blank")}function y($){!n&&$.key=="Escape"&&($.stopPropagation(),p())}const w=[[]];function T(){c=this.__value,t(0,c)}function M(){c=this.__value,t(0,c)}return r.$$set=$=>{"map"in $&&t(5,i=$.map),"maptilerBasemap"in $&&t(6,o=$.maptilerBasemap)},[c,n,d,p,y,i,o,T,w,M]}class TS extends Et{constructor(e){super(),Lt(this,e,CS,SS,wt,{map:5,maptilerBasemap:6})}}function gn(r,e=!0){return{id:r,beforeId:MS(r),eventsIfTopMost:e}}function MS(r){let e=di(Ro);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=C0.length-1;i>=0;i--){let o=C0[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Gp=r=>r,Hp=r=>r;const C0=[Gp(Hp("Background")),"neighbourhood-boundaries",Gp("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","main-roads-outlines","main-roads","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",Hp("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","debug-demand-fill","debug-demand-outline","one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19",Hp("Road labels"),Gp("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let lv=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],cv=[20,30,40,50,60,70],xl=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],Sd=xl,Cd=[0,20,40,60,80,100],Td=xl.toReversed(),Md=[0,1300,3e3,4200,5900,52e3],Yf=xl.toReversed(),LS=[0,.3,.6,1,1.5,2],ES=xl.toReversed(),uv=[0,1,10,50,100,1e3],hv=xl.toReversed(),fv=[0,1,10,50,100,1e3],dv=xl.toReversed(),Ld=[0,20,40,60,80,100],Ed=xl;function pv(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const IS="#0C793A",yo={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function qs(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function Ea(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function Ia(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function Fc(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function ch(r){return r?di(Fo)=="cnt"?pm(r,"LAD_"):r:"custom area"}function mv(r){let e=di(Qs).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;bd(n,JSON.stringify(e))}function dm(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function xa(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function T0(r){return r.reduce((e,t)=>e+t,0)}function pm(r,e){return r.startsWith(e)?r.slice(e.length):r}function M0(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}function AS(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function PS(r){let e,t;const n=[gn("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":qs(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a=c&1?Vn(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function zS(r){let e,t,n,i,o;function c(d){r[1](d)}let a={label:"Bus routes",$$slots:{help:[AS]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new es({props:a}),hn.push(()=>An(e,"show",c)),i=new Eh({props:{url:`pmtiles://${zo("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[PS]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),n=ie(),he(i.$$.fragment)},m(d,p){le(e,d,p),q(d,n,p),le(i,d,p),o=!0},p(d,[p]){const _={};p&4&&(_.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,_.show=d[0],In(()=>t=!1)),e.$set(_);const y={};p&5&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){Z(e.$$.fragment,d),Z(i.$$.fragment,d),o=!1},d(d){d&&V(n),ce(e,d),ce(i,d)}}}function DS(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class $S extends Et{constructor(e){super(),Lt(this,e,DS,zS,wt,{})}}var RS=Object.defineProperty,gv=r=>{throw TypeError(r)},FS=(r,e,t)=>e in r?RS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Eo=(r,e,t)=>FS(r,typeof e!="symbol"?e+"":e,t),_v=(r,e,t)=>e.has(r)||gv("Cannot "+t),_i=(r,e,t)=>(_v(r,e,"read from private field"),t?t.call(r):e.get(r)),L0=(r,e,t)=>e.has(r)?gv("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),E0=(r,e,t,n)=>(_v(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function Fr(){}function BS(r,e){for(const t in e)r[t]=e[t];return r}function yv(r){return r()}function I0(){return Object.create(null)}function ta(r){r.forEach(yv)}function bv(r){return typeof r=="function"}function $a(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let Vf;function Hi(r,e){return r===e?!0:(Vf||(Vf=document.createElement("a")),Vf.href=e,r===Vf.href)}function OS(r){return Object.keys(r).length===0}function NS(r,e,t,n){if(r){const i=vv(r,e,t,n);return r[0](i)}}function vv(r,e,t,n){return r[1]&&n?BS(t.ctx.slice(),r[1](n(e))):t.ctx}function jS(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],c=Math.max(e.dirty.length,i.length);for(let a=0;a<c;a+=1)o[a]=e.dirty[a]|i[a];return o}return e.dirty|i}return e.dirty}function US(r,e,t,n,i,o){if(i){const c=vv(e,t,n,o);r.p(c,i)}}function VS(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function A0(r){return r??""}function Yn(r,e){r.appendChild(e)}function Nr(r,e,t){r.insertBefore(e,t||null)}function Br(r){r.parentNode&&r.parentNode.removeChild(r)}function wr(r){return document.createElement(r)}function ps(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Aa(r){return document.createTextNode(r)}function Po(){return Aa(" ")}function qS(){return Aa("")}function so(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function ZS(r){return function(e){return e.preventDefault(),r.call(this,e)}}function vt(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function GS(r){return Array.from(r.childNodes)}function _h(r,e){e=""+e,r.data!==e&&(r.data=e)}function P0(r,e){r.value=e??""}function Qo(r,e,t){r.classList.toggle(e,!!t)}function HS(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let yh;function uh(r){yh=r}function wv(){if(!yh)throw new Error("Function called outside component initialization");return yh}function WS(r){wv().$$.on_destroy.push(r)}function KS(){const r=wv();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=HS(e,t,{cancelable:n});return i.slice().forEach(c=>{c.call(r,o)}),!o.defaultPrevented}return!0}}function z0(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Ec=[],mm=[];let Dc=[];const D0=[],XS=Promise.resolve();let gm=!1;function JS(){gm||(gm=!0,XS.then(xv))}function _m(r){Dc.push(r)}const Wp=new Set;let Cc=0;function xv(){if(Cc!==0)return;const r=yh;do{try{for(;Cc<Ec.length;){const e=Ec[Cc];Cc++,uh(e),YS(e.$$)}}catch(e){throw Ec.length=0,Cc=0,e}for(uh(null),Ec.length=0,Cc=0;mm.length;)mm.pop()();for(let e=0;e<Dc.length;e+=1){const t=Dc[e];Wp.has(t)||(Wp.add(t),t())}Dc.length=0}while(Ec.length);for(;D0.length;)D0.pop()();gm=!1,Wp.clear(),uh(r)}function YS(r){if(r.fragment!==null){r.update(),ta(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(_m)}}function QS(r){const e=[],t=[];Dc.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Dc=e}const Qf=new Set;let pl;function ed(){pl={r:0,c:[],p:pl}}function td(){pl.r||ta(pl.c),pl=pl.p}function ui(r,e){r&&r.i&&(Qf.delete(r),r.i(e))}function Si(r,e,t,n){if(r&&r.o){if(Qf.has(r))return;Qf.add(r),pl.c.push(()=>{Qf.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function $0(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function e5(r,e){Si(r,1,1,()=>{e.delete(r.key)})}function t5(r,e,t,n,i,o,c,a,d,p,_,y){let w=r.length,T=o.length,M=w;const $={};for(;M--;)$[r[M].key]=M;const D=[],z=new Map,I=new Map,F=[];for(M=T;M--;){const J=y(i,o,M),ee=t(J);let pe=c.get(ee);pe?F.push(()=>pe.p(J,e)):(pe=p(ee,J),pe.c()),z.set(ee,D[M]=pe),ee in $&&I.set(ee,Math.abs(M-$[ee]))}const N=new Set,W=new Set;function oe(J){ui(J,1),J.m(a,_),c.set(J.key,J),_=J.first,T--}for(;w&&T;){const J=D[T-1],ee=r[w-1],pe=J.key,Ie=ee.key;J===ee?(_=J.first,w--,T--):z.has(Ie)?!c.has(pe)||N.has(pe)?oe(J):W.has(Ie)?w--:I.get(pe)>I.get(Ie)?(W.add(pe),oe(J)):(N.add(Ie),w--):(d(ee,c),w--)}for(;w--;){const J=r[w];z.has(J.key)||d(J,c)}for(;T;)oe(D[T-1]);return ta(F),D}function Pa(r){r&&r.c()}function Xs(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),_m(()=>{const o=r.$$.on_mount.map(yv).filter(bv);r.$$.on_destroy?r.$$.on_destroy.push(...o):ta(o),r.$$.on_mount=[]}),i.forEach(_m)}function Js(r,e){const t=r.$$;t.fragment!==null&&(QS(t.after_update),ta(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function n5(r,e){r.$$.dirty[0]===-1&&(Ec.push(r),JS(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ra(r,e,t,n,i,o,c=null,a=[-1]){const d=yh;uh(r);const p=r.$$={fragment:null,ctx:[],props:o,update:Fr,not_equal:i,bound:I0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:I0(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};c&&c(p.root);let _=!1;if(p.ctx=t?t(r,e.props||{},(y,w,...T)=>{const M=T.length?T[0]:w;return p.ctx&&i(p.ctx[y],p.ctx[y]=M)&&(!p.skip_bound&&p.bound[y]&&p.bound[y](M),_&&n5(r,y)),w}):[],p.update(),_=!0,ta(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const y=GS(e.target);p.fragment&&p.fragment.l(y),y.forEach(Br)}else p.fragment&&p.fragment.c();e.intro&&ui(r.$$.fragment),Xs(r,e.target,e.anchor),xv()}uh(d)}class Fa{constructor(){Eo(this,"$$"),Eo(this,"$$set")}$destroy(){Js(this,1),this.$destroy=Fr}$on(e,t){if(!bv(t))return Fr;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!OS(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const r5="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(r5);function i5(r){let e,t;return{c(){e=ps("svg"),t=ps("path"),vt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),vt(e,"viewBox","0 0 14 14"),vt(e,"width","13"),vt(e,"height","13"),vt(e,"class","svelte-en2qvf")},m(n,i){Nr(n,e,i),Yn(e,t)},p:Fr,i:Fr,o:Fr,d(n){n&&Br(e)}}}class kv extends Fa{constructor(e){super(),Ra(this,e,null,i5,$a,{})}}function o5(r){let e,t;return{c(){e=ps("svg"),t=ps("path"),vt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),vt(e,"viewBox","0 0 30 30"),vt(e,"fill","none"),vt(e,"xmlns","http://www.w3.org/2000/svg"),vt(e,"class","svelte-d2loi5")},m(n,i){Nr(n,e,i),Yn(e,t)},p:Fr,i:Fr,o:Fr,d(n){n&&Br(e)}}}class Sv extends Fa{constructor(e){super(),Ra(this,e,null,o5,$a,{})}}function s5(r){let e,t;return{c(){e=wr("img"),Hi(e.src,t=r[3]+"area.svg")||vt(e,"src",t),vt(e,"alt",r[6]),vt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Hi(e.src,t=n[3]+"area.svg")&&vt(e,"src",t),i&64&&vt(e,"alt",n[6])},d(n){n&&Br(e)}}}function a5(r){let e,t;return{c(){e=wr("img"),Hi(e.src,t=r[3]+"reverse.svg")||vt(e,"src",t),vt(e,"alt",r[6]),vt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Hi(e.src,t=n[3]+"reverse.svg")&&vt(e,"src",t),i&64&&vt(e,"alt",n[6])},d(n){n&&Br(e)}}}function l5(r){let e,t;return{c(){e=wr("img"),Hi(e.src,t=r[3]+"poi.svg")||vt(e,"src",t),vt(e,"alt",r[6]),vt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Hi(e.src,t=n[3]+"poi.svg")&&vt(e,"src",t),i&64&&vt(e,"alt",n[6])},d(n){n&&Br(e)}}}function c5(r){let e,t;return{c(){e=wr("img"),Hi(e.src,t=r[3]+"postal_code.svg")||vt(e,"src",t),vt(e,"alt",r[6]),vt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Hi(e.src,t=n[3]+"postal_code.svg")&&vt(e,"src",t),i&64&&vt(e,"alt",n[6])},d(n){n&&Br(e)}}}function u5(r){let e,t;return{c(){e=wr("img"),Hi(e.src,t=r[3]+"street.svg")||vt(e,"src",t),vt(e,"alt",r[6]),vt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Hi(e.src,t=n[3]+"street.svg")&&vt(e,"src",t),i&64&&vt(e,"alt",n[6])},d(n){n&&Br(e)}}}function h5(r){let e,t;return{c(){e=wr("img"),Hi(e.src,t=r[3]+"road.svg")||vt(e,"src",t),vt(e,"alt",r[6]),vt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Hi(e.src,t=n[3]+"road.svg")&&vt(e,"src",t),i&64&&vt(e,"alt",n[6])},d(n){n&&Br(e)}}}function f5(r){let e,t;return{c(){e=wr("img"),Hi(e.src,t=r[3]+"housenumber.svg")||vt(e,"src",t),vt(e,"alt",r[6]),vt(e,"class","svelte-ltkwvy")},m(n,i){Nr(n,e,i)},p(n,i){i&8&&!Hi(e.src,t=n[3]+"housenumber.svg")&&vt(e,"src",t),i&64&&vt(e,"alt",n[6])},d(n){n&&Br(e)}}}function d5(r){let e,t,n,i;return{c(){e=wr("img"),Hi(e.src,t=r[5])||vt(e,"src",t),vt(e,"alt",r[4]),vt(e,"class","svelte-ltkwvy")},m(o,c){Nr(o,e,c),n||(i=so(e,"error",r[14]),n=!0)},p(o,c){c&32&&!Hi(e.src,t=o[5])&&vt(e,"src",t),c&16&&vt(e,"alt",o[4])},d(o){o&&Br(e),n=!1,i()}}}function R0(r){let e,t;return{c(){e=wr("span"),t=Aa(r[6]),vt(e,"class","secondary svelte-ltkwvy")},m(n,i){Nr(n,e,i),Yn(e,t)},p(n,i){i&64&&_h(t,n[6])},d(n){n&&Br(e)}}}function p5(r){let e,t,n,i,o,c,a,d,p,_=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,w,T=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],M,$,D=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",z,I,F;function N(ee,pe){return pe&1&&(t=null),pe&1&&(n=null),pe&1&&(i=null),pe&1&&(o=null),ee[5]?d5:ee[0].address?f5:(t==null&&(t=!!ee[0].id.startsWith("road.")),t?h5:(n==null&&(n=!!ee[0].id.startsWith("address.")),n?u5:(i==null&&(i=!!ee[0].id.startsWith("postal_code.")),i?c5:(o==null&&(o=!!ee[0].id.startsWith("poi.")),o?l5:ee[7]?a5:s5))))}let W=N(r,-1),oe=W(r),J=T&&R0(r);return{c(){e=wr("li"),oe.c(),c=Po(),a=wr("span"),d=wr("span"),p=wr("span"),y=Aa(_),w=Po(),J&&J.c(),M=Po(),$=wr("span"),z=Aa(D),vt(p,"class","primary svelte-ltkwvy"),vt(d,"class","svelte-ltkwvy"),vt($,"class","line2 svelte-ltkwvy"),vt(a,"class","texts svelte-ltkwvy"),vt(e,"tabindex","0"),vt(e,"data-selected",r[1]),vt(e,"class","svelte-ltkwvy"),Qo(e,"selected",r[1])},m(ee,pe){Nr(ee,e,pe),oe.m(e,null),Yn(e,c),Yn(e,a),Yn(a,d),Yn(d,p),Yn(p,y),Yn(d,w),J&&J.m(d,null),Yn(a,M),Yn(a,$),Yn($,z),I||(F=[so(e,"mouseenter",r[12]),so(e,"focus",r[13])],I=!0)},p(ee,[pe]){W===(W=N(ee,pe))&&oe?oe.p(ee,pe):(oe.d(1),oe=W(ee),oe&&(oe.c(),oe.m(e,c))),pe&1&&_!==(_=(ee[7]?ee[0].place_name:ee[0].place_name.replace(/,.*/,""))+"")&&_h(y,_),pe&37&&(T=ee[2]==="always"||ee[2]!=="never"&&!ee[0].address&&!ee[0].id.startsWith("road.")&&!ee[0].id.startsWith("address.")&&!ee[0].id.startsWith("postal_code.")&&(!ee[0].id.startsWith("poi.")||!ee[5])&&!ee[7]),T?J?J.p(ee,pe):(J=R0(ee),J.c(),J.m(d,null)):J&&(J.d(1),J=null),pe&1&&D!==(D=(ee[7]?"":ee[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&_h(z,D),pe&2&&vt(e,"data-selected",ee[1]),pe&2&&Qo(e,"selected",ee[1])},i:Fr,o:Fr,d(ee){ee&&Br(e),oe.d(),J&&J.d(),I=!1,ta(F)}}}function m5(r,e,t){var n;let i,o,{feature:c}=e,{selected:a=!1}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:_}=e;const y=(n=c.properties)==null?void 0:n.categories;let w,T,M=0,$=c.place_type[0]==="reverse";function D(){T&&p.add(T),t(10,M++,M)}function z(N){z0.call(this,r,N)}function I(N){z0.call(this,r,N)}const F=()=>D();return r.$$set=N=>{"feature"in N&&t(0,c=N.feature),"selected"in N&&t(1,a=N.selected),"showPlaceType"in N&&t(2,d=N.showPlaceType),"missingIconsCache"in N&&t(9,p=N.missingIconsCache),"iconsBaseUrl"in N&&t(3,_=N.iconsBaseUrl)},r.$$.update=()=>{var N,W,oe,J;if(r.$$.dirty&3640)do t(11,i--,i),t(4,w=y==null?void 0:y[i]),t(5,T=w?_+w.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!T||p.has(T)));r.$$.dirty&1&&t(6,o=((W=(N=c.properties)==null?void 0:N.categories)==null?void 0:W.join(", "))??((J=(oe=c.properties)==null?void 0:oe.place_type_name)==null?void 0:J[0])??c.place_type[0])},t(11,i=(y==null?void 0:y.length)??0),[c,a,d,_,w,T,o,$,D,p,M,i,z,I,F]}class g5 extends Fa{constructor(e){super(),Ra(this,e,m5,p5,$a,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function _5(r){let e;return{c(){e=wr("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',vt(e,"class","svelte-7cmwmc")},m(t,n){Nr(t,e,n)},p:Fr,i:Fr,o:Fr,d(t){t&&Br(e)}}}class y5 extends Fa{constructor(e){super(),Ra(this,e,null,_5,$a,{})}}function b5(r){let e,t,n;return{c(){e=ps("svg"),t=ps("path"),vt(t,"stroke-width","4"),vt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),vt(t,"class","svelte-gzo3ar"),vt(e,"width",n=r[0]==="list"?20:void 0),vt(e,"viewBox","0 0 70 85"),vt(e,"fill","none"),vt(e,"class","svelte-gzo3ar"),Qo(e,"in-map",r[0]!=="list"),Qo(e,"list-icon",r[0]==="list")},m(i,o){Nr(i,e,o),Yn(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&vt(e,"width",n),o&1&&Qo(e,"in-map",i[0]!=="list"),o&1&&Qo(e,"list-icon",i[0]==="list")},i:Fr,o:Fr,d(i){i&&Br(e)}}}function v5(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class w5 extends Fa{constructor(e){super(),Ra(this,e,v5,b5,$a,{displayIn:0})}}function x5(r){let e,t;return{c(){e=ps("svg"),t=ps("path"),vt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),vt(e,"viewBox","0 0 60.006 21.412"),vt(e,"width","14"),vt(e,"height","20"),vt(e,"class","svelte-en2qvf")},m(n,i){Nr(n,e,i),Yn(e,t)},p:Fr,i:Fr,o:Fr,d(n){n&&Br(e)}}}class k5 extends Fa{constructor(e){super(),Ra(this,e,null,x5,$a,{})}}function S5(r){let e,t,n;return{c(){e=ps("svg"),t=ps("circle"),n=ps("path"),vt(t,"cx","4.789"),vt(t,"cy","4.787"),vt(t,"r","3.85"),vt(t,"class","svelte-1aq105l"),vt(n,"d","M12.063 12.063 7.635 7.635"),vt(n,"class","svelte-1aq105l"),vt(e,"xmlns","http://www.w3.org/2000/svg"),vt(e,"width","13"),vt(e,"height","13"),vt(e,"viewBox","0 0 13 13"),vt(e,"class","svelte-1aq105l")},m(i,o){Nr(i,e,o),Yn(e,t),Yn(e,n)},p:Fr,i:Fr,o:Fr,d(i){i&&Br(e)}}}class C5 extends Fa{constructor(e){super(),Ra(this,e,null,S5,$a,{})}}function T5(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function dd(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Vu;async function M5(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(Vu&&i.cachedLocationExpiry&&Vu.time+i.cachedLocationExpiry>Date.now()){if(!Vu.coords)break e;return Vu.coords}let o;try{return o=await new Promise((c,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{c([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{a(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(Vu={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const L5=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,F0=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,B0=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,O0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,N0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,j0=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function E5(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(T=>Number(T.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),c=t>0?"N":"S",a=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${c}, ${o} ${a}`);const p=Math.floor(i),_=Math.floor(o),y=(i-p)*60,w=(o-_)*60;if(r=="DM"){let T=U0(y,3).toFixed(3).padStart(6,"0"),M=U0(w,3).toFixed(3).padStart(6,"0");T.endsWith(".000")&&M.endsWith(".000")&&(T=T.replace(/\.000$/,""),M=M.replace(/\.000$/,"")),d=`${p} ${T}' ${c}, ${_} ${M}' ${a}`}if(r=="DMS"){const T=Math.floor(y),M=Math.floor(w);let $=((y-T)*60).toFixed(1).padStart(4,"0"),D=((w-M)*60).toFixed(1).padStart(4,"0");const z=T.toString().padStart(2,"0"),I=M.toString().padStart(2,"0");$.endsWith(".0")&&D.endsWith(".0")&&($=$.replace(/\.0$/,""),D=D.replace(/\.0$/,"")),d=`${p} ${z}' ${$}" ${c}, ${_} ${I}' ${D}" ${a}`}return d}else throw new Error("no decimal coordinates to convert")}function U0(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function Ym(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",c=null,a=[],d=!1;if(L5.test(r))throw new Error("invalid coordinate value");if(F0.test(r))if(a=F0.exec(r),d=qu(a),d)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),c="DM";else throw new Error("invalid coordinate format");else if(B0.test(r))if(a=B0.exec(r),d=qu(a),d){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),c="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],o=a[5]):a[4]&&(i=a[4],o=a[8])}else throw new Error("invalid decimal coordinate format");else if(O0.test(r))if(a=O0.exec(r),d=qu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,c="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],o=a[8]):a[7]&&(i=a[7],o=a[14]);else throw new Error("invalid DMS coordinates format");else if(N0.test(r))if(a=N0.exec(r),d=qu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,c="DM"),a[6]&&(t+=a[6]/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid DMS coordinates format");else if(j0.test(r)){if(a=j0.exec(r),d=qu(a),a.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,c="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const _=a[0].trim();let y,w;const T=/[,/;\u0020]/g,M=_.match(T);if(M==null){const z=Math.floor(r.length/2);y=_.substring(0,z).trim(),w=_.substring(z).trim()}else{let z;M.length%2==1?z=Math.floor(M.length/2):z=M.length/2-1;let I=0;if(z==0)I=_.indexOf(M[0]),y=_.substring(0,I).trim(),w=_.substring(I+1).trim();else{let F=0,N=0;for(;F<=z;)I=_.indexOf(M[F],N),N=I+1,F++;y=_.substring(0,I).trim(),w=_.substring(I+1).trim()}}const $=y.split(".");if($.length==2&&$[1]==0&&$[1].length!=2)throw new Error("invalid coordinates format");const D=w.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(w))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:_,verbatimLatitude:y,verbatimLongitude:w,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:c,closeEnough:I5,toCoordinateFormat:E5})}else throw new Error("coordinates pattern match failed")}function qu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const c=e[o],a=e[o+i],d=t.test(c)&&t.test(a),p=n.test(c)&&n.test(a),_=c==a;if(!(c==null&&a==null)){if(c==null||a==null)return!1;if(d||p||_)continue;return!1}}return!0}function V0(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function I5(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return V0(this.decimalLatitude,Number(e[0]))&&V0(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const A5=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});Ym.to=A5;const P5=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],z5={decimalLatitude:40.123,decimalLongitude:-74.123},D5=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],$5=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function R5(){const r=[];return P5.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...z5})}),[...r,...D5,...$5]}const F5=R5();Ym.formats=F5.map(r=>r.verbatimCoordinates);const B5=Ym;function q0(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function Z0(r){let e,t;return e=new y5({}),{c(){Pa(e.$$.fragment)},m(n,i){Xs(e,n,i),t=!0},i(n){t||(ui(e.$$.fragment,n),t=!0)},o(n){Si(e.$$.fragment,n),t=!1},d(n){Js(e,n)}}}function G0(r){let e,t,n,i,o;return t=new k5({}),{c(){e=wr("button"),Pa(t.$$.fragment),vt(e,"type","button"),vt(e,"title",r[9]),vt(e,"class","svelte-bz0zu3"),Qo(e,"active",r[0])},m(c,a){Nr(c,e,a),Xs(t,e,null),n=!0,i||(o=so(e,"click",r[69]),i=!0)},p(c,a){(!n||a[0]&512)&&vt(e,"title",c[9]),(!n||a[0]&1)&&Qo(e,"active",c[0])},i(c){n||(ui(t.$$.fragment,c),n=!0)},o(c){Si(t.$$.fragment,c),n=!1},d(c){c&&Br(e),Js(t),i=!1,o()}}}function O5(r){let e,t=[],n=new Map,i,o,c,a=$0(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<a.length;p+=1){let _=q0(r,a,p),y=d(_);n.set(y,t[p]=H0(y,_))}return{c(){e=wr("ul");for(let p=0;p<t.length;p+=1)t[p].c();vt(e,"class","options svelte-bz0zu3")},m(p,_){Nr(p,e,_);for(let y=0;y<t.length;y+=1)t[y]&&t[y].m(e,null);i=!0,o||(c=[so(e,"mouseleave",r[73]),so(e,"blur",r[74])],o=!0)},p(p,_){_[0]&17880064&&(a=$0(p[14]),ed(),t=t5(t,_,d,1,p,a,n,e,e5,H0,null,q0),td())},i(p){if(!i){for(let _=0;_<a.length;_+=1)ui(t[_]);i=!0}},o(p){for(let _=0;_<t.length;_+=1)Si(t[_]);i=!1},d(p){p&&Br(e);for(let _=0;_<t.length;_+=1)t[_].d();o=!1,ta(c)}}}function N5(r){let e,t,n,i,o,c;return t=new Sv({}),{c(){e=wr("div"),Pa(t.$$.fragment),n=Po(),i=wr("div"),o=Aa(r[7]),vt(i,"class","svelte-bz0zu3"),vt(e,"class","no-results svelte-bz0zu3")},m(a,d){Nr(a,e,d),Xs(t,e,null),Yn(e,n),Yn(e,i),Yn(i,o),c=!0},p(a,d){(!c||d[0]&128)&&_h(o,a[7])},i(a){c||(ui(t.$$.fragment,a),c=!0)},o(a){Si(t.$$.fragment,a),c=!1},d(a){a&&Br(e),Js(t)}}}function j5(r){let e="",t;return{c(){t=Aa(e)},m(n,i){Nr(n,t,i)},p:Fr,i:Fr,o:Fr,d(n){n&&Br(t)}}}function U5(r){let e,t,n,i,o,c,a,d,p,_,y;return t=new Sv({}),d=new kv({}),{c(){e=wr("div"),Pa(t.$$.fragment),n=Po(),i=wr("div"),o=Aa(r[6]),c=Po(),a=wr("button"),Pa(d.$$.fragment),vt(i,"class","svelte-bz0zu3"),vt(a,"class","svelte-bz0zu3"),vt(e,"class","error svelte-bz0zu3")},m(w,T){Nr(w,e,T),Xs(t,e,null),Yn(e,n),Yn(e,i),Yn(i,o),Yn(e,c),Yn(e,a),Xs(d,a,null),p=!0,_||(y=so(a,"click",r[70]),_=!0)},p(w,T){(!p||T[0]&64)&&_h(o,w[6])},i(w){p||(ui(t.$$.fragment,w),ui(d.$$.fragment,w),p=!0)},o(w){Si(t.$$.fragment,w),Si(d.$$.fragment,w),p=!1},d(w){w&&Br(e),Js(t),Js(d),_=!1,y()}}}function H0(r,e){let t,n,i;function o(){return e[71](e[86])}function c(){return e[72](e[84])}return n=new g5({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",c),{key:r,first:null,c(){t=qS(),Pa(n.$$.fragment),this.first=t},m(a,d){Nr(a,t,d),Xs(n,a,d),i=!0},p(a,d){e=a;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(a){i||(ui(n.$$.fragment,a),i=!0)},o(a){Si(n.$$.fragment,a),i=!1},d(a){a&&Br(t),Js(n,a)}}}function V5(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe=!1;o=new C5({}),y=new kv({});let J=r[19]&&Z0(),ee=r[5]==="button"&&G0(r);const pe=r[61].default,Ie=NS(pe,r,r[60],null),Q=[U5,j5,N5,O5],ae=[];function Pe(ve,nt){var Ge,Ee;return ve[18]?0:ve[16]?((Ge=ve[14])==null?void 0:Ge.length)===0?2:ve[16]&&(Ee=ve[14])!=null&&Ee.length?3:-1:1}return~(D=Pe(r))&&(z=ae[D]=Q[D](r)),{c(){e=Po(),t=wr("form"),n=wr("div"),i=wr("button"),Pa(o.$$.fragment),c=Po(),a=wr("input"),d=Po(),p=wr("div"),_=wr("button"),Pa(y.$$.fragment),w=Po(),J&&J.c(),T=Po(),ee&&ee.c(),M=Po(),Ie&&Ie.c(),$=Po(),z&&z.c(),vt(i,"class","search-button svelte-bz0zu3"),vt(i,"type","button"),vt(a,"placeholder",r[8]),vt(a,"aria-label",r[8]),vt(a,"class","svelte-bz0zu3"),vt(_,"type","button"),vt(_,"title",r[3]),vt(_,"class","svelte-bz0zu3"),vt(p,"class","clear-button-container svelte-bz0zu3"),Qo(p,"displayable",r[1]!==""),vt(n,"class","input-group svelte-bz0zu3"),vt(t,"tabindex","0"),vt(t,"class",I=A0(r[2])+" svelte-bz0zu3"),Qo(t,"can-collapse",r[4]&&r[1]==="")},m(ve,nt){Nr(ve,e,nt),Nr(ve,t,nt),Yn(t,n),Yn(n,i),Xs(o,i,null),Yn(n,c),Yn(n,a),r[63](a),P0(a,r[1]),Yn(n,d),Yn(n,p),Yn(p,_),Xs(y,_,null),Yn(p,w),J&&J.m(p,null),Yn(n,T),ee&&ee.m(n,null),Yn(n,M),Ie&&Ie.m(n,null),Yn(t,$),~D&&ae[D].m(t,null),F=!0,N||(W=[so(i,"click",r[62]),so(a,"input",r[64]),so(a,"focus",r[65]),so(a,"blur",r[66]),so(a,"keydown",r[22]),so(a,"input",r[67]),so(_,"click",r[68]),so(t,"submit",ZS(r[21]))],N=!0)},p(ve,nt){(!F||nt[0]&256)&&vt(a,"placeholder",ve[8]),(!F||nt[0]&256)&&vt(a,"aria-label",ve[8]),nt[0]&2&&a.value!==ve[1]&&P0(a,ve[1]),(!F||nt[0]&8)&&vt(_,"title",ve[3]),ve[19]?J?nt[0]&524288&&ui(J,1):(J=Z0(),J.c(),ui(J,1),J.m(p,null)):J&&(ed(),Si(J,1,1,()=>{J=null}),td()),(!F||nt[0]&2)&&Qo(p,"displayable",ve[1]!==""),ve[5]==="button"?ee?(ee.p(ve,nt),nt[0]&32&&ui(ee,1)):(ee=G0(ve),ee.c(),ui(ee,1),ee.m(n,M)):ee&&(ed(),Si(ee,1,1,()=>{ee=null}),td()),Ie&&Ie.p&&(!F||nt[1]&536870912)&&US(Ie,pe,ve,ve[60],F?jS(pe,ve[60],nt,null):VS(ve[60]),null);let Ge=D;D=Pe(ve),D===Ge?~D&&ae[D].p(ve,nt):(z&&(ed(),Si(ae[Ge],1,1,()=>{ae[Ge]=null}),td()),~D?(z=ae[D],z?z.p(ve,nt):(z=ae[D]=Q[D](ve),z.c()),ui(z,1),z.m(t,null)):z=null),(!F||nt[0]&4&&I!==(I=A0(ve[2])+" svelte-bz0zu3"))&&vt(t,"class",I),(!F||nt[0]&22)&&Qo(t,"can-collapse",ve[4]&&ve[1]==="")},i(ve){F||(ui(oe),ui(o.$$.fragment,ve),ui(y.$$.fragment,ve),ui(J),ui(ee),ui(Ie,ve),ui(z),F=!0)},o(ve){Si(oe),Si(o.$$.fragment,ve),Si(y.$$.fragment,ve),Si(J),Si(ee),Si(Ie,ve),Si(z),F=!1},d(ve){ve&&(Br(e),Br(t)),Js(o),r[63](null),Js(y),J&&J.d(),ee&&ee.d(),Ie&&Ie.d(ve),~D&&ae[D].d(),N=!1,ta(W)}}}function q5(r,e,t){let n,i,{$$slots:o={},$$scope:c}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:_=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:w=!1}=e,{collapsed:T=!1}=e,{country:M=void 0}=e,{debounceSearch:$=200}=e,{enableReverse:D="never"}=e,{errorMessage:z="Something went wrong"}=e,{filter:I=()=>!0}=e,{flyTo:F=!0}=e,{fuzzyMatch:N=!0}=e,{language:W=void 0}=e,{limit:oe=void 0}=e,{mapController:J=void 0}=e,{minLength:ee=2}=e,{noResultsMessage:pe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ie="Search"}=e,{proximity:Q=[{type:"server-geolocation"}]}=e,{reverseActive:ae=D==="always"}=e,{reverseButtonTitle:Pe="toggle reverse geocoding"}=e,{searchValue:ve=""}=e,{pickedResultStyle:nt="full-geometry"}=e,{showPlaceType:Ge="if-needed"}=e,{showResultsWhileTyping:Ee=!0}=e,{selectFirst:De=!0}=e,{flyToSelected:Ct=!1}=e,{markerOnSelected:it=!0}=e,{types:lt=void 0}=e,{exhaustiveReverseGeocoding:mt=!1}=e,{excludeTypes:dt=!1}=e,{zoom:Xe=a}=e,{apiUrl:$t="https://api.maptiler.com/geocoding"}=e,{fetchParameters:yt={}}=e,{iconsBaseUrl:Rt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:It=()=>{}}=e;function Qt(){Ne.focus()}function yn(){Ne.blur()}function ut(te,He=!0,Ke=!1){t(1,ve=te),He?(t(15,et=-1),bt()):(mn(!Ke,Ke),setTimeout(()=>{Ne.focus(),Ne.select()}))}function Wt(){t(14,St=void 0),t(56,_e=void 0),t(15,et=-1)}function Ze(){t(55,Ut=[]),t(56,_e=void 0)}let Ve=!1,St,Ut,_e,Pn="",Ne,et=-1,Kt,er=[],ur,gr,Qr,ei;const co=new Set,hr=KS();WS(()=>{J&&(J.setEventHandler(void 0),J.indicateReverse(!1),J.setSelectedMarker(-1),J.setFeatures(void 0,void 0,!1))});function bt(te){if(gr&&(clearTimeout(gr),gr=void 0),et>-1&&St)t(56,_e=St[et]),t(1,ve=_e.place_type[0]==="reverse"?_e.place_name:_e.place_name.replace(/,.*/,"")),t(18,Kt=void 0),t(55,Ut=void 0),t(15,et=-1);else if(ve){const He=te||!Bn(ve);xr(ve,{exact:!0}).then(()=>{t(55,Ut=St),t(56,_e=void 0),He&&uo()}).catch(Ke=>t(18,Kt=Ke))}}function Bn(te){try{return B5(te,6)}catch{return!1}}async function xr(te,{byId:He=!1,exact:Ke=!1}={}){t(18,Kt=void 0),ur==null||ur.abort();const Ye=new AbortController;t(19,ur=Ye);try{const ct=Bn(te),Tt=new URLSearchParams;if(W!==void 0&&Tt.set("language",Array.isArray(W)?W.join(","):W??""),lt&&Tt.set("types",lt.join(",")),dt&&Tt.set("excludeTypes",String(dt)),_&&Tt.set("bbox",_.map(jn=>jn.toFixed(6)).join(",")),M&&Tt.set("country",Array.isArray(M)?M.join(","):M),!He&&!ct){const jn=await M5(J,Q,Ye);jn&&Tt.set("proximity",jn),(Ke||!Ee)&&Tt.set("autocomplete","false"),Tt.set("fuzzyMatch",String(N))}oe!==void 0&&(mt||!ct||(lt==null?void 0:lt.length)===1)&&Tt.set("limit",String(oe)),Tt.set("key",p),It(Tt);const Jt=$t+"/"+encodeURIComponent(ct?ct.decimalLongitude+","+ct.decimalLatitude:te)+".json?"+Tt.toString();if(Jt===Pn){He?(t(14,St=void 0),t(56,_e=er[0])):t(14,St=er);return}Pn=Jt;const dn=await fetch(Jt,{signal:Ye.signal,...yt});if(!dn.ok)throw new Error(await dn.text());const xn=await dn.json();hr("response",{url:Jt,featureCollection:xn}),He?(t(14,St=void 0),t(56,_e=xn.features[0]),er=[_e]):(t(14,St=xn.features.filter(I)),ct&&St.unshift({type:"Feature",properties:{},id:"reverse_"+ct.decimalLongitude+"_"+ct.decimalLatitude,text:ct.decimalLatitude+", "+ct.decimalLongitude,place_name:ct.decimalLatitude+", "+ct.decimalLongitude,place_type:["reverse"],center:[ct.decimalLongitude,ct.decimalLatitude],bbox:[ct.decimalLongitude,ct.decimalLatitude,ct.decimalLongitude,ct.decimalLatitude],geometry:{type:"Point",coordinates:[ct.decimalLongitude,ct.decimalLatitude]}}),er=St,ct&&Ne.focus())}catch(ct){if(ct&&typeof ct=="object"&&"name"in ct&&ct.name==="AbortError")return;throw ct}finally{Ye===ur&&t(19,ur=void 0)}}function uo(){var te;if(!(Ut!=null&&Ut.length)||!F)return;const He=[180,90,-180,-90],Ke=!Ut.some(ct=>!ct.matching_text);let Ye;for(const ct of Ut){const Tt=Rn(ct);if(Ye=Ye===void 0?Tt:Tt===void 0?Ye:Math.max(Ye,Tt),Ke||!ct.matching_text)for(const Jt of[0,1,2,3])He[Jt]=Math[Jt<2?"min":"max"](He[Jt],((te=ct.bbox)==null?void 0:te[Jt])??ct.center[Jt%2])}J&&Ut.length>0&&(_e&&He[0]===He[2]&&He[1]===He[3]?J.flyTo(_e.center,Rn(_e)):J.fitBounds(dd(He),50,Ye))}function Rn(te){var He;if(!te.bbox||te.bbox[0]!==te.bbox[2]&&te.bbox[1]!==te.bbox[3])return;const Ke=te.id.replace(/\..*/,"");return(Array.isArray((He=te.properties)==null?void 0:He.categories)?te.properties.categories.reduce((Ye,ct)=>{const Tt=Xe[Ke+"."+ct];return Ye===void 0?Tt:Tt===void 0?Ye:Math.max(Ye,Tt)},void 0):void 0)??Xe[Ke]}function Pt(te){t(0,ae=D==="always"),t(14,St=void 0),t(56,_e=void 0),t(15,et=-1),ut(te[1].toFixed(6)+", "+T5(te[0],[-180,180],!0).toFixed(6),!1,!0)}function fn(te){if(!St)return;let He=te.key==="ArrowDown"?1:te.key==="ArrowUp"?-1:0;He&&(et===(De?0:-1)&&He===-1&&t(15,et=St.length),t(15,et+=He),et>=St.length&&t(15,et=-1),et<0&&De&&t(15,et=0),te.preventDefault())}function mn(te=!0,He=!1){if(t(18,Kt=void 0),Ee||He){if(gr&&clearTimeout(gr),ve.length<ee)return;const Ke=ve;gr=window.setTimeout(()=>{xr(Ke).catch(Ye=>t(18,Kt=Ye))},te?$:0)}else t(14,St=void 0),t(18,Kt=void 0)}function wn(te){t(56,_e=te),t(1,ve=te.place_name),t(15,et=-1)}const ln=()=>Ne.focus();function Gt(te){mm[te?"unshift":"push"](()=>{Ne=te,t(17,Ne)})}function Ci(){ve=this.value,t(1,ve),t(13,Ve),t(28,w)}const _r=()=>t(13,Ve=!0),Ce=()=>t(13,Ve=!1),ne=()=>mn(),se=()=>{t(1,ve=""),Ne.focus()},ge=()=>t(0,ae=!ae),we=()=>t(18,Kt=void 0),Fe=te=>t(15,et=te),Be=te=>wn(te),Ue=()=>{De||t(15,et=-1)},ze=()=>{};return r.$$set=te=>{"class"in te&&t(2,d=te.class),"apiKey"in te&&t(26,p=te.apiKey),"bbox"in te&&t(27,_=te.bbox),"clearButtonTitle"in te&&t(3,y=te.clearButtonTitle),"clearOnBlur"in te&&t(28,w=te.clearOnBlur),"collapsed"in te&&t(4,T=te.collapsed),"country"in te&&t(29,M=te.country),"debounceSearch"in te&&t(30,$=te.debounceSearch),"enableReverse"in te&&t(5,D=te.enableReverse),"errorMessage"in te&&t(6,z=te.errorMessage),"filter"in te&&t(31,I=te.filter),"flyTo"in te&&t(32,F=te.flyTo),"fuzzyMatch"in te&&t(33,N=te.fuzzyMatch),"language"in te&&t(34,W=te.language),"limit"in te&&t(35,oe=te.limit),"mapController"in te&&t(36,J=te.mapController),"minLength"in te&&t(37,ee=te.minLength),"noResultsMessage"in te&&t(7,pe=te.noResultsMessage),"placeholder"in te&&t(8,Ie=te.placeholder),"proximity"in te&&t(38,Q=te.proximity),"reverseActive"in te&&t(0,ae=te.reverseActive),"reverseButtonTitle"in te&&t(9,Pe=te.reverseButtonTitle),"searchValue"in te&&t(1,ve=te.searchValue),"pickedResultStyle"in te&&t(39,nt=te.pickedResultStyle),"showPlaceType"in te&&t(10,Ge=te.showPlaceType),"showResultsWhileTyping"in te&&t(40,Ee=te.showResultsWhileTyping),"selectFirst"in te&&t(11,De=te.selectFirst),"flyToSelected"in te&&t(41,Ct=te.flyToSelected),"markerOnSelected"in te&&t(42,it=te.markerOnSelected),"types"in te&&t(43,lt=te.types),"exhaustiveReverseGeocoding"in te&&t(44,mt=te.exhaustiveReverseGeocoding),"excludeTypes"in te&&t(45,dt=te.excludeTypes),"zoom"in te&&t(46,Xe=te.zoom),"apiUrl"in te&&t(47,$t=te.apiUrl),"fetchParameters"in te&&t(48,yt=te.fetchParameters),"iconsBaseUrl"in te&&t(12,Rt=te.iconsBaseUrl),"adjustUrlQuery"in te&&t(49,It=te.adjustUrlQuery),"$$scope"in te&&t(60,c=te.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ae=D==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Qr=Ve),w&&!Ve&&t(1,ve="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ve.length<ee&&(t(56,_e=void 0),t(14,St=void 0),t(18,Kt=void 0),t(55,Ut=St)),r.$$.dirty[1]&33554688&&nt!=="marker-only"&&_e&&!_e.address&&_e.geometry.type==="Point"&&_e.place_type[0]!=="reverse"&&xr(_e.id,{byId:!0}).catch(te=>t(18,Kt=te)),r.$$.dirty[1]&100663330&&(J&&_e&&_e.id!==ei&&F&&(!_e.bbox||_e.bbox[0]===_e.bbox[2]&&_e.bbox[1]===_e.bbox[3]?J.flyTo(_e.center,Rn(_e)):J.fitBounds(dd(_e.bbox),50,Rn(_e)),t(14,St=void 0),t(55,Ut=void 0),t(15,et=-1)),t(57,ei=_e==null?void 0:_e.id)),r.$$.dirty[0]&18432&&De&&St!=null&&St.length&&t(15,et=0),r.$$.dirty[0]&2&&t(15,et=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Ut!==St&&t(55,Ut=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&J&&J.setEventHandler(te=>{switch(te.type){case"mapClick":ae&&Pt(te.coordinates);break;case"markerClick":{const He=St==null?void 0:St.find(Ke=>Ke.id===te.id);He&&wn(He)}break;case"markerMouseEnter":Ut&&t(15,et=Qr?(St==null?void 0:St.findIndex(He=>He.id===te.id))??-1:-1);break;case"markerMouseLeave":Ut&&t(15,et=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=St==null?void 0:St[et]),r.$$.dirty[1]&134218786&&J&&i&&F&&Ct&&J.flyTo(i.center,Rn(i)),r.$$.dirty[1]&256&&t(59,n=nt==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(it||J==null||J.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&J&&it&&!Ut&&(J.setFeatures(i?[i]:void 0,void 0,n),J.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&J&&J.setFeatures(Ut,_e,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Ut&&J&&J.setSelectedMarker(et),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&J){const te=Bn(ve);J.setReverseMarker(te?[te.decimalLongitude,te.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&hr("select",{feature:i}),r.$$.dirty[1]&33554432&&hr("pick",{feature:_e}),r.$$.dirty[0]&81920&&hr("optionsvisibilitychange",{optionsVisible:Qr&&!!St}),r.$$.dirty[0]&16384&&hr("featureslisted",{features:St}),r.$$.dirty[1]&16777216&&hr("featuresmarked",{features:Ut}),r.$$.dirty[0]&1&&hr("reversetoggle",{reverse:ae}),r.$$.dirty[0]&2&&hr("querychange",{query:ve}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&J&&J.indicateReverse(ae)},[ae,ve,d,y,T,D,z,pe,Ie,Pe,Ge,De,Rt,Ve,St,et,Qr,Ne,Kt,ur,co,bt,fn,mn,wn,a,p,_,w,M,$,I,F,N,W,oe,J,ee,Q,nt,Ee,Ct,it,lt,mt,dt,Xe,$t,yt,It,Qt,yn,ut,Wt,Ze,Ut,_e,ei,i,n,c,o,ln,Gt,Ci,_r,Ce,ne,se,ge,we,Fe,Be,Ue,ze]}let Z5=class extends Fa{constructor(r){super(),Ra(this,r,q5,V5,$a,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function bh(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Qm(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return bh({type:"Polygon",coordinates:r},e,t)}function vh(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Cv(r,e,t={}){return bh({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function G5(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,c;return c={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function a(p){return function(_){return d([p,_])}}function d(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=p[0]&2?i.return:p[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,p[1])).done)return o;switch(i=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(r,t)}catch(_){p=[6,_],i=0}finally{n=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var za=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function H5(r,e){return r>e?1:r<e?-1:0}function ka(r,e,t){for(var n=new za(null,null),i=n,o=n;;){var c=t(r,e.key);if(c<0){if(e.left===null)break;if(t(r,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}o.left=e,o=e,e=e.left}else if(c>0){if(e.right===null)break;if(t(r,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Kp(r,e,t,n){var i=new za(r,e);if(t===null)return i.left=i.right=null,i;t=ka(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function W0(r,e,t){var n=null,i=null;if(e){e=ka(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function W5(r,e,t){return e===null?r:(r===null||(e=ka(r.key,e,t),e.left=r),e)}function ym(r,e,t,n,i){if(r){n(""+e+(t?" ":" ")+i(r)+`
`);var o=e+(t?"    ":"   ");r.left&&ym(r.left,o,!1,n,i),r.right&&ym(r.right,o,!0,n,i)}}var eg=function(){function r(e){e===void 0&&(e=H5),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Kp(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new za(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=ka(e,this._root,i),c=i(e,o.key);return c===0?this._root=o:(c<0?(n.left=o.left,n.right=o,o.left=null):c>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=ka(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=ka(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ka(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=ka(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],c=this._comparator,a=this._root,d;o.length!==0||a;)if(a)o.push(a),a=a.left;else{if(a=o.pop(),d=c(a.key,t),d>0)break;if(c(a.key,e)>=0&&n.call(i,a))return this;a=a.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return X5(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&wm(e,t,0,i-1,o),this._root===null)this._root=bm(e,t,0,i),this._size=i;else{var c=J5(this.toList(),K5(e,t),o);i=this._size+i,this._root=vm({head:c},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return ym(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=W0(e,this._root,i),c=o.left,a=o.right;i(e,t)<0?a=Kp(t,n,a,i):c=Kp(t,n,c,i),this._root=W5(c,a,i)},r.prototype.split=function(e){return W0(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return G5(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function bm(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),c=r[o],a=e[o],d=new za(c,a);return d.left=bm(r,e,t,o),d.right=bm(r,e,o+1,n),d}return null}function K5(r,e){for(var t=new za(null,null),n=t,i=0;i<r.length;i++)n=n.next=new za(r[i],e[i]);return n.next=null,t.next}function X5(r){for(var e=r,t=[],n=!1,i=new za(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function vm(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=vm(r,e,i),c=r.head;return c.left=o,r.head=r.head.next,c.right=vm(r,i+1,t),c}return null}function J5(r,e,t){for(var n=new za(null,null),i=n,o=r,c=e;o!==null&&c!==null;)t(o.key,c.key)<0?(i.next=o,o=o.next):(i.next=c,c=c.next),i=i.next;return o!==null?i.next=o:c!==null&&(i.next=c),n.next}function wm(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],c=t-1,a=n+1;;){do c++;while(i(r[c],o)<0);do a--;while(i(r[a],o)>0);if(c>=a)break;var d=r[c];r[c]=r[a],r[a]=d,d=e[c],e[c]=e[a],e[a]=d}wm(r,e,t,a,i),wm(r,e,a+1,n,i)}}const Ws=11102230246251565e-32,Vi=134217729,Y5=(3+8*Ws)*Ws;function Xp(r,e,t,n,i){let o,c,a,d,p=e[0],_=n[0],y=0,w=0;_>p==_>-p?(o=p,p=e[++y]):(o=_,_=n[++w]);let T=0;if(y<r&&w<t)for(_>p==_>-p?(c=p+o,a=o-(c-p),p=e[++y]):(c=_+o,a=o-(c-_),_=n[++w]),o=c,a!==0&&(i[T++]=a);y<r&&w<t;)_>p==_>-p?(c=o+p,d=c-o,a=o-(c-d)+(p-d),p=e[++y]):(c=o+_,d=c-o,a=o-(c-d)+(_-d),_=n[++w]),o=c,a!==0&&(i[T++]=a);for(;y<r;)c=o+p,d=c-o,a=o-(c-d)+(p-d),p=e[++y],o=c,a!==0&&(i[T++]=a);for(;w<t;)c=o+_,d=c-o,a=o-(c-d)+(_-d),_=n[++w],o=c,a!==0&&(i[T++]=a);return(o!==0||T===0)&&(i[T++]=o),T}function Q5(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function Ih(r){return new Float64Array(r)}const eC=(3+16*Ws)*Ws,tC=(2+12*Ws)*Ws,nC=(9+64*Ws)*Ws*Ws,Tc=Ih(4),K0=Ih(8),X0=Ih(12),J0=Ih(16),io=Ih(4);function rC(r,e,t,n,i,o,c){let a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe,J,ee;const pe=r-i,Ie=t-i,Q=e-o,ae=n-o;N=pe*ae,w=Vi*pe,T=w-(w-pe),M=pe-T,w=Vi*ae,$=w-(w-ae),D=ae-$,W=M*D-(N-T*$-M*$-T*D),oe=Q*Ie,w=Vi*Q,T=w-(w-Q),M=Q-T,w=Vi*Ie,$=w-(w-Ie),D=Ie-$,J=M*D-(oe-T*$-M*$-T*D),z=W-J,y=W-z,Tc[0]=W-(z+y)+(y-J),I=N+z,y=I-N,F=N-(I-y)+(z-y),z=F-oe,y=F-z,Tc[1]=F-(z+y)+(y-oe),ee=I+z,y=ee-I,Tc[2]=I-(ee-y)+(z-y),Tc[3]=ee;let Pe=Q5(4,Tc),ve=tC*c;if(Pe>=ve||-Pe>=ve||(y=r-pe,a=r-(pe+y)+(y-i),y=t-Ie,p=t-(Ie+y)+(y-i),y=e-Q,d=e-(Q+y)+(y-o),y=n-ae,_=n-(ae+y)+(y-o),a===0&&d===0&&p===0&&_===0)||(ve=nC*c+Y5*Math.abs(Pe),Pe+=pe*_+ae*a-(Q*p+Ie*d),Pe>=ve||-Pe>=ve))return Pe;N=a*ae,w=Vi*a,T=w-(w-a),M=a-T,w=Vi*ae,$=w-(w-ae),D=ae-$,W=M*D-(N-T*$-M*$-T*D),oe=d*Ie,w=Vi*d,T=w-(w-d),M=d-T,w=Vi*Ie,$=w-(w-Ie),D=Ie-$,J=M*D-(oe-T*$-M*$-T*D),z=W-J,y=W-z,io[0]=W-(z+y)+(y-J),I=N+z,y=I-N,F=N-(I-y)+(z-y),z=F-oe,y=F-z,io[1]=F-(z+y)+(y-oe),ee=I+z,y=ee-I,io[2]=I-(ee-y)+(z-y),io[3]=ee;const nt=Xp(4,Tc,4,io,K0);N=pe*_,w=Vi*pe,T=w-(w-pe),M=pe-T,w=Vi*_,$=w-(w-_),D=_-$,W=M*D-(N-T*$-M*$-T*D),oe=Q*p,w=Vi*Q,T=w-(w-Q),M=Q-T,w=Vi*p,$=w-(w-p),D=p-$,J=M*D-(oe-T*$-M*$-T*D),z=W-J,y=W-z,io[0]=W-(z+y)+(y-J),I=N+z,y=I-N,F=N-(I-y)+(z-y),z=F-oe,y=F-z,io[1]=F-(z+y)+(y-oe),ee=I+z,y=ee-I,io[2]=I-(ee-y)+(z-y),io[3]=ee;const Ge=Xp(nt,K0,4,io,X0);N=a*_,w=Vi*a,T=w-(w-a),M=a-T,w=Vi*_,$=w-(w-_),D=_-$,W=M*D-(N-T*$-M*$-T*D),oe=d*p,w=Vi*d,T=w-(w-d),M=d-T,w=Vi*p,$=w-(w-p),D=p-$,J=M*D-(oe-T*$-M*$-T*D),z=W-J,y=W-z,io[0]=W-(z+y)+(y-J),I=N+z,y=I-N,F=N-(I-y)+(z-y),z=F-oe,y=F-z,io[1]=F-(z+y)+(y-oe),ee=I+z,y=ee-I,io[2]=I-(ee-y)+(z-y),io[3]=ee;const Ee=Xp(Ge,X0,4,io,J0);return J0[Ee-1]}function iC(r,e,t,n,i,o){const c=(e-o)*(t-i),a=(r-i)*(n-o),d=c-a,p=Math.abs(c+a);return Math.abs(d)>=eC*p?d:-rC(r,e,t,n,i,o,p)}const Zu=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,xm=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let Ta=Number.EPSILON;Ta===void 0&&(Ta=Math.pow(2,-52));const oC=Ta*Ta,Y0=(r,e)=>{if(-Ta<r&&r<Ta&&-Ta<e&&e<Ta)return 0;const t=r-e;return t*t<oC*r*e?0:r<e?-1:1};class sC{constructor(){this.reset()}reset(){this.xRounder=new Q0,this.yRounder=new Q0}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class Q0{constructor(){this.tree=new eg,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&Y0(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&Y0(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const wh=new sC,nd=(r,e)=>r.x*e.y-r.y*e.x,Tv=(r,e)=>r.x*e.x+r.y*e.y,ey=(r,e,t)=>{const n=iC(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},pd=r=>Math.sqrt(Tv(r,r)),aC=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return nd(i,n)/pd(i)/pd(n)},lC=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return Tv(i,n)/pd(i)/pd(n)},ty=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},ny=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},cC=(r,e,t,n)=>{if(e.x===0)return ny(t,n,r.x);if(n.x===0)return ny(r,e,t.x);if(e.y===0)return ty(t,n,r.y);if(n.y===0)return ty(r,e,t.y);const i=nd(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},c=nd(o,e)/i,a=nd(o,n)/i,d=r.x+a*e.x,p=t.x+c*n.x,_=r.y+a*e.y,y=t.y+c*n.y,w=(d+p)/2,T=(_+y)/2;return{x:w,y:T}};class Xo{static compare(e,t){const n=Xo.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Ma.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:aC(this.point,e.point,o.point),cosine:lC(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:c,cosine:a}=t.get(i),{sine:d,cosine:p}=t.get(o);return c>=0&&d>=0?a<p?1:a>p?-1:0:c<0&&d<0?a<p?-1:a>p?1:0:d<c?-1:d>c?1:0}}}let uC=0;class Ma{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,c=t.rightSE.point.x;if(c<n)return 1;if(o<i)return-1;const a=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,_=t.rightSE.point.y;if(n<i){if(d<a&&d<p)return 1;if(d>a&&d>p)return-1;const y=e.comparePoint(t.leftSE.point);if(y<0)return 1;if(y>0)return-1;const w=t.comparePoint(e.rightSE.point);return w!==0?w:-1}if(n>i){if(a<d&&a<_)return-1;if(a>d&&a>_)return 1;const y=t.comparePoint(e.leftSE.point);if(y!==0)return y;const w=e.comparePoint(t.rightSE.point);return w<0?1:w>0?-1:1}if(a<d)return-1;if(a>d)return 1;if(o<c){const y=t.comparePoint(e.rightSE.point);if(y!==0)return y}if(o>c){const y=e.comparePoint(t.rightSE.point);if(y<0)return 1;if(y>0)return-1}if(o!==c){const y=p-a,w=o-n,T=_-d,M=c-i;if(y>w&&T<M)return 1;if(y<w&&T>M)return-1}return o>c?1:o<c||p<_?-1:p>_?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++uC,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,c;const a=Xo.comparePoints(e,t);if(a<0)i=e,o=t,c=1;else if(a>0)i=t,o=e,c=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new Xo(i,!0),p=new Xo(o,!1);return new Ma(d,p,[n],[c])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,c=t.x+o*i.x;if(e.x===c)return 0;const a=(e.x-t.x)/i.x,d=t.y+a*i.y;return e.y===d?0:e.y<d?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=xm(t,n);if(i===null)return null;const o=this.leftSE.point,c=this.rightSE.point,a=e.leftSE.point,d=e.rightSE.point,p=Zu(t,a)&&this.comparePoint(a)===0,_=Zu(n,o)&&e.comparePoint(o)===0,y=Zu(t,d)&&this.comparePoint(d)===0,w=Zu(n,c)&&e.comparePoint(c)===0;if(_&&p)return w&&!y?c:!w&&y?d:null;if(_)return y&&o.x===d.x&&o.y===d.y?null:o;if(p)return w&&c.x===a.x&&c.y===a.y?null:a;if(w&&y)return null;if(w)return c;if(y)return d;const T=cC(o,this.vector(),a,e.vector());return T===null||!Zu(i,T)?null:wh.round(T.x,T.y)}split(e){const t=[],n=e.events!==void 0,i=new Xo(e,!0),o=new Xo(e,!1),c=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const a=new Ma(i,c,this.rings.slice(),this.windings.slice());return Xo.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Xo.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Ma.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,c=n.rings.length;o<c;o++){const a=n.rings[o],d=n.windings[o],p=t.rings.indexOf(a);p===-1?(t.rings.push(a),t.windings.push(d)):t.windings[p]+=d}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,d=this.rings.length;a<d;a++){const p=this.rings[a],_=this.windings[a],y=t.indexOf(p);y===-1?(t.push(p),n.push(_)):n[y]+=_}const o=[],c=[];for(let a=0,d=t.length;a<d;a++){if(n[a]===0)continue;const p=t[a],_=p.poly;if(c.indexOf(_)===-1)if(p.isExterior)o.push(_);else{c.indexOf(_)===-1&&c.push(_);const y=o.indexOf(p.poly);y!==-1&&o.splice(y,1)}}for(let a=0,d=o.length;a<d;a++){const p=o[a].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(hs.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===hs.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${hs.type}`)}return this._isInResult}}class ry{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=wh.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let c=1,a=e.length;c<a;c++){if(typeof e[c][0]!="number"||typeof e[c][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let d=wh.round(e[c][0],e[c][1]);d.x===o.x&&d.y===o.y||(this.segments.push(Ma.fromRing(o,d,this)),d.x<this.bbox.ll.x&&(this.bbox.ll.x=d.x),d.y<this.bbox.ll.y&&(this.bbox.ll.y=d.y),d.x>this.bbox.ur.x&&(this.bbox.ur.x=d.x),d.y>this.bbox.ur.y&&(this.bbox.ur.y=d.y),o=d)}(i.x!==o.x||i.y!==o.y)&&this.segments.push(Ma.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class hC{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new ry(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new ry(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,c=i.length;o<c;o++)e.push(i[o])}return e}}class iy{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new hC(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,c=i.length;o<c;o++)e.push(i[o])}return e}}class md{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let c=null,a=o.leftSE,d=o.rightSE;const p=[a],_=a.point,y=[];for(;c=a,a=d,p.push(a),a.point!==_;)for(;;){const w=a.getAvailableLinkedEvents();if(w.length===0){const $=p[0].point,D=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${$.x}, ${$.y}]. Last matching segment found ends at [${D.x}, ${D.y}].`)}if(w.length===1){d=w[0].otherSE;break}let T=null;for(let $=0,D=y.length;$<D;$++)if(y[$].point===a.point){T=$;break}if(T!==null){const $=y.splice(T)[0],D=p.splice($.index);D.unshift(D[0].otherSE),t.push(new md(D.reverse()));continue}y.push({index:p.length,point:a.point});const M=a.getLeftmostComparator(c);d=w.sort(M)[0].otherSE;break}t.push(new md(p))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,_=this.events.length-1;p<_;p++){const y=this.events[p].point,w=this.events[p+1].point;ey(y,e,w)!==0&&(t.push(y),e=y)}if(t.length===1)return null;const n=t[0],i=t[1];ey(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,d=[];for(let p=c;p!=a;p+=o)d.push([t[p].x,t[p].y]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const c=this.events[i];Xo.compare(e,c)>0&&(e=c)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class oy{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class fC{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new oy(o));else{const c=o.enclosingRing();c.poly||t.push(new oy(c)),c.poly.addInterior(o)}}return t}}class dC{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Ma.compare;this.queue=e,this.tree=new eg(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,c=i,a,d;for(;a===void 0;)o=this.tree.prev(o),o===null?a=null:o.key.consumedBy===void 0&&(a=o.key);for(;d===void 0;)c=this.tree.next(c),c===null?d=null:c.key.consumedBy===void 0&&(d=c.key);if(e.isLeft){let p=null;if(a){const y=a.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(p=y),!a.isAnEndpoint(y))){const w=this._splitSafely(a,y);for(let T=0,M=w.length;T<M;T++)n.push(w[T])}}let _=null;if(d){const y=d.getIntersection(t);if(y!==null&&(t.isAnEndpoint(y)||(_=y),!d.isAnEndpoint(y))){const w=this._splitSafely(d,y);for(let T=0,M=w.length;T<M;T++)n.push(w[T])}}if(p!==null||_!==null){let y=null;p===null?y=_:_===null?y=p:y=Xo.comparePoints(p,_)<=0?p:_,this.queue.remove(t.rightSE),n.push(t.rightSE);const w=t.split(y);for(let T=0,M=w.length;T<M;T++)n.push(w[T])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&d){const p=a.getIntersection(d);if(p!==null){if(!a.isAnEndpoint(p)){const _=this._splitSafely(a,p);for(let y=0,w=_.length;y<w;y++)n.push(_[y])}if(!d.isAnEndpoint(p)){const _=this._splitSafely(d,p);for(let y=0,w=_.length;y<w;y++)n.push(_[y])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const sy=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,pC=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class mC{run(e,t,n){hs.type=e,wh.reset();const i=[new iy(t,!0)];for(let _=0,y=n.length;_<y;_++)i.push(new iy(n[_],!1));if(hs.numMultiPolys=i.length,hs.type==="difference"){const _=i[0];let y=1;for(;y<i.length;)xm(i[y].bbox,_.bbox)!==null?y++:i.splice(y,1)}if(hs.type==="intersection")for(let _=0,y=i.length;_<y;_++){const w=i[_];for(let T=_+1,M=i.length;T<M;T++)if(xm(w.bbox,i[T].bbox)===null)return[]}const o=new eg(Xo.compare);for(let _=0,y=i.length;_<y;_++){const w=i[_].getSweepEvents();for(let T=0,M=w.length;T<M;T++)if(o.insert(w[T]),o.size>sy)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const c=new dC(o);let a=o.size,d=o.pop();for(;d;){const _=d.key;if(o.size===a){const w=_.segment;throw new Error(`Unable to pop() ${_.isLeft?"left":"right"} SweepEvent [${_.point.x}, ${_.point.y}] from segment #${w.id} [${w.leftSE.point.x}, ${w.leftSE.point.y}] -> [${w.rightSE.point.x}, ${w.rightSE.point.y}] from queue.`)}if(o.size>sy)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(c.segments.length>pC)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const y=c.process(_);for(let w=0,T=y.length;w<T;w++){const M=y[w];M.consumedBy===void 0&&o.insert(M)}a=o.size,d=o.pop()}wh.reset();const p=md.factory(c.segments);return new fC(p).getGeom()}}const hs=new mC,gC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return hs.run("union",r,t)},_C=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return hs.run("intersection",r,t)},yC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return hs.run("xor",r,t)},bC=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return hs.run("difference",r,t)};var Mv={union:gC,intersection:_C,xor:yC,difference:bC};function Lv(r,e,t){if(r!==null)for(var n,i,o,c,a,d,p,_=0,y=0,w,T=r.type,M=T==="FeatureCollection",$=T==="Feature",D=M?r.features.length:1,z=0;z<D;z++){p=M?r.features[z].geometry:$?r.geometry:r,w=p?p.type==="GeometryCollection":!1,a=w?p.geometries.length:1;for(var I=0;I<a;I++){var F=0,N=0;if(c=w?p.geometries[I]:p,c!==null){d=c.coordinates;var W=c.type;switch(_=0,W){case null:break;case"Point":if(e(d,y,z,F,N)===!1)return!1;y++,F++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],y,z,F,N)===!1)return!1;y++,W==="MultiPoint"&&F++}W==="LineString"&&F++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-_;i++){if(e(d[n][i],y,z,F,N)===!1)return!1;y++}W==="MultiLineString"&&F++,W==="Polygon"&&N++}W==="Polygon"&&F++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(N=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-_;o++){if(e(d[n][i][o],y,z,F,N)===!1)return!1;y++}N++}F++}break;case"GeometryCollection":for(n=0;n<c.geometries.length;n++)if(Lv(c.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function tg(r,e){var t,n,i,o,c,a,d,p,_,y,w=0,T=r.type==="FeatureCollection",M=r.type==="Feature",$=T?r.features.length:1;for(t=0;t<$;t++){for(a=T?r.features[t].geometry:M?r.geometry:r,p=T?r.features[t].properties:M?r.properties:{},_=T?r.features[t].bbox:M?r.bbox:void 0,y=T?r.features[t].id:M?r.id:void 0,d=a?a.type==="GeometryCollection":!1,c=d?a.geometries.length:1,i=0;i<c;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,w,p,_,y)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,w,p,_,y)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],w,p,_,y)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}w++}}function vC(r,e){tg(r,function(t,n,i,o,c){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(bh(t,i,{bbox:o,id:c}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var _=t.coordinates[p],y={type:d,coordinates:_};if(e(bh(y,i),n,p)===!1)return!1}})}function wC(r,e={}){const t=[];if(tg(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=Mv.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?Qm(n[0],e.properties):Cv(n,e.properties)}var Ev=wC;function xC(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return Lv(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var ay=xC;function kC(r){const e=[];if(tg(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=Mv.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?Qm(n[0],t):Cv(n,t)}var SC=kC;function CC(r){if(!r)throw new Error("geojson is required");var e=[];return vC(r,function(t){e.push(t)}),vh(e)}var TC=CC;function ly(r,e){const t=SC(vh([Qm([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=dd(ay(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,c=n[2]>180,a=TC(r);if(a.features.length>1&&(o||c))for(const d of a.features){const p=dd(ay(d));if(c&&p[0]<-180+i)for(const _ of d.geometry.coordinates)for(const y of _)y[0]+=360-i;if(o&&p[2]>180-i)for(const _ of d.geometry.coordinates)for(const y of _)y[0]-=360-i}e(vh([a.features.length<2?r:Ev(a)??r,t]))}const cy={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},qf="mtlr-gc-full-geom",uy="mtlr-gc-full-geom-fill",hy="mtlr-gc-full-geom-line";function Iv(r,e,t=!0,n=!0,i={},o={},c=cy){let a;const d=[];let p,_,y;function w(){if(!r.loaded){r.once("load",w);return}const D=c?c===!0?cy:c:void 0;if(!(D!=null&&D.fill)&&!(D!=null&&D.line))return;const z=r.getSource(qf);if(z)z.setData(y??vh([]));else if(y)r.addSource(qf,{type:"geojson",data:y});else return;!r.getLayer(uy)&&D!=null&&D.fill&&r.addLayer({...D==null?void 0:D.fill,id:uy,type:"fill",source:qf}),!r.getLayer(hy)&&D!=null&&D.line&&r.addLayer({...D==null?void 0:D.line,id:hy,type:"line",source:qf})}function T(D){y=D,w()}r.on("styledata",()=>{setTimeout(()=>{y&&w()})});const M=D=>{a==null||a({type:"mapClick",coordinates:[D.lngLat.lng,D.lngLat.lat]})};function $(D=!1){if(!e)throw new Error;const z=document.createElement("div");return D&&z.classList.add("marker-interactive"),new w5({props:{displayIn:"maplibre"},target:z}),new e.Marker({element:z,offset:[1,-13]})}return{setEventHandler(D){D?(a=D,r.on("click",M)):(a=void 0,r.off("click",M))},flyTo(D,z){r.flyTo({center:D,...z?{zoom:z}:{},...i})},fitBounds(D,z,I){r.fitBounds([[D[0],D[1]],[D[2],D[3]]],{padding:z,...I?{maxZoom:I}:{},...o})},indicateReverse(D){r.getCanvasContainer().style.cursor=D?"crosshair":""},setReverseMarker(D){!e||!t||(_?D?_.setLngLat(D):(_.remove(),_=void 0):D&&(t instanceof Function?_=t(r)??void 0:(_=(typeof t=="object"?new e.Marker(t):$()).setLngLat(D).addTo(r),_.getElement().classList.add("marker-reverse"))))},setFeatures(D,z,I){for(const F of d)F.remove();if(d.length=0,T(void 0),!!e){if(z){let F=!1;if(z.geometry.type==="GeometryCollection"){const N=z.geometry.geometries.filter(W=>W.type==="Polygon"||W.type==="MultiPolygon");e:if(N.length>0){const W=Ev(vh(N.map(oe=>bh(oe))));if(!W)break e;ly({...z,geometry:W.geometry},T),F=!0}else{const W=z.geometry.geometries.filter(oe=>oe.type==="LineString"||oe.type==="MultiLineString");W.length>0&&(T({...z,geometry:{type:"GeometryCollection",geometries:W}}),F=!0)}}if(!F){if(z.geometry.type==="Polygon"||z.geometry.type==="MultiPolygon")ly(z,T);else if(z.geometry.type==="LineString"||z.geometry.type==="MultiLineString"){T(z);return}}if(!I&&z.geometry.type!=="Point")return;if(t instanceof Function){const N=t(r,z);N&&d.push(N)}else t&&d.push(typeof t=="object"?new e.Marker(t):$().setLngLat(z.center).addTo(r))}if(n)for(const F of D??[]){if(F===z)continue;let N;if(n instanceof Function){if(N=n(r,F),!N)continue}else N=(typeof n=="object"?new e.Marker(n):$(!0)).setLngLat(F.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(F.place_type[0]==="reverse"?F.place_name:F.place_name.replace(/,.*/,""))).addTo(r);const W=N.getElement();W.addEventListener("click",oe=>{oe.stopPropagation(),a==null||a({type:"markerClick",id:F.id})}),W.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:F.id}),N.togglePopup()}),W.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:F.id}),N.togglePopup()}),d.push(N)}}},setSelectedMarker(D){p&&p.getElement().classList.toggle("marker-selected",!1),p=D>-1?d[D]:void 0,p==null||p.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const D=r.getCenter();return[r.getZoom(),D.lng,D.lat]}}}function MC(r,e,t){var n,i;class o{constructor(D,z){Eo(this,"type"),Eo(this,"target"),this.type=z,this.target=D}}class c extends o{constructor(D,z){super(D,"select"),Eo(this,"feature"),Object.assign(this,z)}}class a extends o{constructor(D,z){super(D,"featureslisted"),Eo(this,"features"),this.features=z}}class d extends o{constructor(D,z){super(D,"featuresmarked"),Eo(this,"features"),this.features=z}}class p extends o{constructor(D,z){super(D,"optionsvisibilitychange"),Eo(this,"optionsVisible"),this.optionsVisible=z}}class _ extends o{constructor(D,z){super(D,"pick"),Eo(this,"feature"),this.feature=z}}class y extends o{constructor(D,z){super(D,"querychange"),Eo(this,"query"),this.query=z}}class w extends o{constructor(D,z,I){super(D,"response"),Eo(this,"url"),Eo(this,"featureCollection"),this.url=z,this.featureCollection=I}}class T extends o{constructor(D,z){super(D,"reversetoggle"),Eo(this,"reverse"),this.reverse=z}}class M extends r{constructor(D={}){super(),L0(this,n),L0(this,i),E0(this,i,D)}onAddInt(D){const z=document.createElement("div");z.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:I,showResultMarkers:F,flyTo:N,fullGeometryStyle:W,...oe}=_i(this,i),J=typeof N=="boolean"?{}:N,ee={mapController:Iv(D,e,I,F,J,J,W),flyTo:N===void 0?!0:!!N,apiKey:"",...t==null?void 0:t(D,z),...oe};if(!ee.apiKey)throw new Error("no apiKey provided");return E0(this,n,new Z5({target:z,props:ee})),_i(this,n).$on("select",pe=>{this.fire(new c(this,pe.detail))}),_i(this,n).$on("pick",pe=>{this.fire(new _(this,pe.detail.feature))}),_i(this,n).$on("featureslisted",pe=>{this.fire(new a(this,pe.detail.features))}),_i(this,n).$on("featuresmarked",pe=>{this.fire(new d(this,pe.detail.features))}),_i(this,n).$on("response",pe=>{this.fire(new w(this,pe.detail.url,pe.detail.featureCollection))}),_i(this,n).$on("optionsvisibilitychange",pe=>{this.fire(new p(this,pe.detail.optionsVisible))}),_i(this,n).$on("reversetoggle",pe=>{this.fire(new T(this,pe.detail.reverse))}),_i(this,n).$on("querychange",pe=>{this.fire(new y(this,pe.detail.query))}),z}on(D,z){return super.on(D,z)}once(D,z){return super.once(D,z)}off(D,z){return super.off(D,z)}listens(D){return super.listens(D)}setOptions(D){var z;Object.assign(_i(this,i),D);const{marker:I,showResultMarkers:F,flyTo:N,fullGeometryStyle:W,...oe}=_i(this,i);(z=_i(this,n))==null||z.$set(oe)}setQuery(D,z=!0){var I;(I=_i(this,n))==null||I.setQuery(D,z)}clearMap(){var D;(D=_i(this,n))==null||D.clearMap()}clearList(){var D;(D=_i(this,n))==null||D.clearList()}setReverseMode(D){var z;(z=_i(this,n))==null||z.$set({reverseActive:D})}focus(){var D;(D=_i(this,n))==null||D.focus()}blur(){var D;(D=_i(this,n))==null||D.blur()}onRemove(){var D;(D=_i(this,n))==null||D.$destroy()}}return n=new WeakMap,i=new WeakMap,{MapLibreBasedGeocodingControl:M,events:{SelectEvent:c,FeaturesListedEvent:a,FeaturesMarkedEvent:d,OptionsVisibilityChangeEvent:p,PickEvent:_,QueryChangeEvent:y,ResponseEvent:w,ReverseToggleEvent:T}}}const{MapLibreBasedGeocodingControl:Nz,events:Ba}=MC(Ks.Evented,ux);Ba.SelectEvent;Ba.FeaturesListedEvent;Ba.FeaturesMarkedEvent;Ba.OptionsVisibilityChangeEvent;Ba.PickEvent;Ba.QueryChangeEvent;Ba.ResponseEvent;Ba.ReverseToggleEvent;function LC(r){let e,t;return{c(){e=ds("svg"),t=ds("path"),fe(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),fe(e,"viewBox","0 0 14 14"),fe(e,"width","13"),fe(e,"height","13"),fe(e,"class","svelte-en2qvf")},m(n,i){q(n,e,i),R(e,t)},p:tt,i:tt,o:tt,d(n){n&&V(e)}}}class Av extends Et{constructor(e){super(),Lt(this,e,null,LC,wt,{})}}function EC(r){let e,t;return{c(){e=ds("svg"),t=ds("path"),fe(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),fe(e,"viewBox","0 0 30 30"),fe(e,"fill","none"),fe(e,"xmlns","http://www.w3.org/2000/svg"),fe(e,"class","svelte-d2loi5")},m(n,i){q(n,e,i),R(e,t)},p:tt,i:tt,o:tt,d(n){n&&V(e)}}}class Pv extends Et{constructor(e){super(),Lt(this,e,null,EC,wt,{})}}function IC(r){let e,t;return{c(){e=U("img"),dr(e.src,t=r[3]+"area.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"area.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&V(e)}}}function AC(r){let e,t;return{c(){e=U("img"),dr(e.src,t=r[3]+"reverse.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"reverse.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&V(e)}}}function PC(r){let e,t;return{c(){e=U("img"),dr(e.src,t=r[3]+"poi.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"poi.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&V(e)}}}function zC(r){let e,t;return{c(){e=U("img"),dr(e.src,t=r[3]+"postal_code.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"postal_code.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&V(e)}}}function DC(r){let e,t;return{c(){e=U("img"),dr(e.src,t=r[3]+"street.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"street.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&V(e)}}}function $C(r){let e,t;return{c(){e=U("img"),dr(e.src,t=r[3]+"road.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"road.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&V(e)}}}function RC(r){let e,t;return{c(){e=U("img"),dr(e.src,t=r[3]+"housenumber.svg")||fe(e,"src",t),fe(e,"alt",r[6]),fe(e,"class","svelte-ltkwvy")},m(n,i){q(n,e,i)},p(n,i){i&8&&!dr(e.src,t=n[3]+"housenumber.svg")&&fe(e,"src",t),i&64&&fe(e,"alt",n[6])},d(n){n&&V(e)}}}function FC(r){let e,t,n,i;return{c(){e=U("img"),dr(e.src,t=r[5])||fe(e,"src",t),fe(e,"alt",r[4]),fe(e,"class","svelte-ltkwvy")},m(o,c){q(o,e,c),n||(i=xt(e,"error",r[14]),n=!0)},p(o,c){c&32&&!dr(e.src,t=o[5])&&fe(e,"src",t),c&16&&fe(e,"alt",o[4])},d(o){o&&V(e),n=!1,i()}}}function fy(r){let e,t;return{c(){e=U("span"),t=xe(r[6]),fe(e,"class","secondary svelte-ltkwvy")},m(n,i){q(n,e,i),R(e,t)},p(n,i){i&64&&Mt(t,n[6])},d(n){n&&V(e)}}}function BC(r){let e,t,n,i,o,c,a,d,p,_=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",y,w,T=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],M,$,D=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",z,I,F;function N(ee,pe){return pe&1&&(t=null),pe&1&&(n=null),pe&1&&(i=null),pe&1&&(o=null),ee[5]?FC:ee[0].address?RC:(t==null&&(t=!!ee[0].id.startsWith("road.")),t?$C:(n==null&&(n=!!ee[0].id.startsWith("address.")),n?DC:(i==null&&(i=!!ee[0].id.startsWith("postal_code.")),i?zC:(o==null&&(o=!!ee[0].id.startsWith("poi.")),o?PC:ee[7]?AC:IC))))}let W=N(r,-1),oe=W(r),J=T&&fy(r);return{c(){e=U("li"),oe.c(),c=ie(),a=U("span"),d=U("span"),p=U("span"),y=xe(_),w=ie(),J&&J.c(),M=ie(),$=U("span"),z=xe(D),fe(p,"class","primary svelte-ltkwvy"),fe(d,"class","svelte-ltkwvy"),fe($,"class","line2 svelte-ltkwvy"),fe(a,"class","texts svelte-ltkwvy"),fe(e,"tabindex","0"),fe(e,"data-selected",r[1]),fe(e,"class","svelte-ltkwvy"),en(e,"selected",r[1])},m(ee,pe){q(ee,e,pe),oe.m(e,null),R(e,c),R(e,a),R(a,d),R(d,p),R(p,y),R(d,w),J&&J.m(d,null),R(a,M),R(a,$),R($,z),I||(F=[xt(e,"mouseenter",r[12]),xt(e,"focus",r[13])],I=!0)},p(ee,[pe]){W===(W=N(ee,pe))&&oe?oe.p(ee,pe):(oe.d(1),oe=W(ee),oe&&(oe.c(),oe.m(e,c))),pe&1&&_!==(_=(ee[7]?ee[0].place_name:ee[0].place_name.replace(/,.*/,""))+"")&&Mt(y,_),pe&37&&(T=ee[2]==="always"||ee[2]!=="never"&&!ee[0].address&&!ee[0].id.startsWith("road.")&&!ee[0].id.startsWith("address.")&&!ee[0].id.startsWith("postal_code.")&&(!ee[0].id.startsWith("poi.")||!ee[5])&&!ee[7]),T?J?J.p(ee,pe):(J=fy(ee),J.c(),J.m(d,null)):J&&(J.d(1),J=null),pe&1&&D!==(D=(ee[7]?"":ee[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Mt(z,D),pe&2&&fe(e,"data-selected",ee[1]),pe&2&&en(e,"selected",ee[1])},i:tt,o:tt,d(ee){ee&&V(e),oe.d(),J&&J.d(),I=!1,mr(F)}}}function OC(r,e,t){var F;let n,i,{feature:o}=e,{selected:c=!1}=e,{showPlaceType:a}=e,{missingIconsCache:d}=e,{iconsBaseUrl:p}=e;const _=(F=o.properties)==null?void 0:F.categories;let y,w,T=0,M=o.place_type[0]==="reverse";function $(){w&&d.add(w),t(10,T++,T)}function D(N){Dn.call(this,r,N)}function z(N){Dn.call(this,r,N)}const I=()=>$();return r.$$set=N=>{"feature"in N&&t(0,o=N.feature),"selected"in N&&t(1,c=N.selected),"showPlaceType"in N&&t(2,a=N.showPlaceType),"missingIconsCache"in N&&t(9,d=N.missingIconsCache),"iconsBaseUrl"in N&&t(3,p=N.iconsBaseUrl)},r.$$.update=()=>{var N,W,oe,J;if(r.$$.dirty&3640)do t(11,n--,n),t(4,y=_==null?void 0:_[n]),t(5,w=y?p+y.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!w||d.has(w)));r.$$.dirty&1&&t(6,i=((W=(N=o.properties)==null?void 0:N.categories)==null?void 0:W.join(", "))??((J=(oe=o.properties)==null?void 0:oe.place_type_name)==null?void 0:J[0])??o.place_type[0])},t(11,n=(_==null?void 0:_.length)??0),[o,c,a,p,y,w,i,M,$,d,T,n,D,z,I]}class NC extends Et{constructor(e){super(),Lt(this,e,OC,BC,wt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function jC(r){let e;return{c(){e=U("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',fe(e,"class","svelte-7cmwmc")},m(t,n){q(t,e,n)},p:tt,i:tt,o:tt,d(t){t&&V(e)}}}class UC extends Et{constructor(e){super(),Lt(this,e,null,jC,wt,{})}}function VC(r){let e,t;return{c(){e=ds("svg"),t=ds("path"),fe(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),fe(e,"viewBox","0 0 60.006 21.412"),fe(e,"width","14"),fe(e,"height","20"),fe(e,"class","svelte-en2qvf")},m(n,i){q(n,e,i),R(e,t)},p:tt,i:tt,o:tt,d(n){n&&V(e)}}}class qC extends Et{constructor(e){super(),Lt(this,e,null,VC,wt,{})}}function ZC(r){let e,t,n;return{c(){e=ds("svg"),t=ds("circle"),n=ds("path"),fe(t,"cx","4.789"),fe(t,"cy","4.787"),fe(t,"r","3.85"),fe(t,"class","svelte-1aq105l"),fe(n,"d","M12.063 12.063 7.635 7.635"),fe(n,"class","svelte-1aq105l"),fe(e,"xmlns","http://www.w3.org/2000/svg"),fe(e,"width","13"),fe(e,"height","13"),fe(e,"viewBox","0 0 13 13"),fe(e,"class","svelte-1aq105l")},m(i,o){q(i,e,o),R(e,t),R(e,n)},p:tt,i:tt,o:tt,d(i){i&&V(e)}}}class GC extends Et{constructor(e){super(),Lt(this,e,null,ZC,wt,{})}}function HC(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function dy(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let Gu;async function WC(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(Gu&&i.cachedLocationExpiry&&Gu.time+i.cachedLocationExpiry>Date.now()){if(!Gu.coords)break e;return Gu.coords}let o;try{return o=await new Promise((c,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{c([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{a(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(Gu={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const KC=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,py=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,my=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,gy=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,_y=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,yy=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function XC(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(T=>Number(T.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),c=t>0?"N":"S",a=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${c}, ${o} ${a}`);const p=Math.floor(i),_=Math.floor(o),y=(i-p)*60,w=(o-_)*60;if(r=="DM"){let T=by(y,3).toFixed(3).padStart(6,"0"),M=by(w,3).toFixed(3).padStart(6,"0");T.endsWith(".000")&&M.endsWith(".000")&&(T=T.replace(/\.000$/,""),M=M.replace(/\.000$/,"")),d=`${p} ${T}' ${c}, ${_} ${M}' ${a}`}if(r=="DMS"){const T=Math.floor(y),M=Math.floor(w);let $=((y-T)*60).toFixed(1).padStart(4,"0"),D=((w-M)*60).toFixed(1).padStart(4,"0");const z=T.toString().padStart(2,"0"),I=M.toString().padStart(2,"0");$.endsWith(".0")&&D.endsWith(".0")&&($=$.replace(/\.0$/,""),D=D.replace(/\.0$/,"")),d=`${p} ${z}' ${$}" ${c}, ${_} ${I}' ${D}" ${a}`}return d}else throw new Error("no decimal coordinates to convert")}function by(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function ng(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",c=null,a=[],d=!1;if(KC.test(r))throw new Error("invalid coordinate value");if(py.test(r))if(a=py.exec(r),d=Hu(a),d)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),c="DM";else throw new Error("invalid coordinate format");else if(my.test(r))if(a=my.exec(r),d=Hu(a),d){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),c="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],o=a[5]):a[4]&&(i=a[4],o=a[8])}else throw new Error("invalid decimal coordinate format");else if(gy.test(r))if(a=gy.exec(r),d=Hu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,c="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],o=a[8]):a[7]&&(i=a[7],o=a[14]);else throw new Error("invalid DMS coordinates format");else if(_y.test(r))if(a=_y.exec(r),d=Hu(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,c="DM"),a[6]&&(t+=a[6]/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid DMS coordinates format");else if(yy.test(r)){if(a=yy.exec(r),d=Hu(a),a.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,c="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,c="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const _=a[0].trim();let y,w;const T=/[,/;\u0020]/g,M=_.match(T);if(M==null){const z=Math.floor(r.length/2);y=_.substring(0,z).trim(),w=_.substring(z).trim()}else{let z;M.length%2==1?z=Math.floor(M.length/2):z=M.length/2-1;let I=0;if(z==0)I=_.indexOf(M[0]),y=_.substring(0,I).trim(),w=_.substring(I+1).trim();else{let F=0,N=0;for(;F<=z;)I=_.indexOf(M[F],N),N=I+1,F++;y=_.substring(0,I).trim(),w=_.substring(I+1).trim()}}const $=y.split(".");if($.length==2&&$[1]==0&&$[1].length!=2)throw new Error("invalid coordinates format");const D=w.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(y)||/^\d+$/.test(w))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:_,verbatimLatitude:y,verbatimLongitude:w,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:c,closeEnough:JC,toCoordinateFormat:XC})}else throw new Error("coordinates pattern match failed")}function Hu(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const c=e[o],a=e[o+i],d=t.test(c)&&t.test(a),p=n.test(c)&&n.test(a),_=c==a;if(!(c==null&&a==null)){if(c==null||a==null)return!1;if(d||p||_)continue;return!1}}return!0}function vy(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function JC(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return vy(this.decimalLatitude,Number(e[0]))&&vy(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const YC=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});ng.to=YC;const QC=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],eT={decimalLatitude:40.123,decimalLongitude:-74.123},tT=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],nT=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function rT(){const r=[];return QC.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...eT})}),[...r,...tT,...nT]}const iT=rT();ng.formats=iT.map(r=>r.verbatimCoordinates);const oT=ng;function wy(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function xy(r){let e,t;return e=new UC({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function ky(r){let e,t,n,i,o;return t=new qC({}),{c(){e=U("button"),he(t.$$.fragment),fe(e,"type","button"),fe(e,"title",r[9]),fe(e,"class","svelte-bz0zu3"),en(e,"active",r[0])},m(c,a){q(c,e,a),le(t,e,null),n=!0,i||(o=xt(e,"click",r[69]),i=!0)},p(c,a){(!n||a[0]&512)&&fe(e,"title",c[9]),(!n||a[0]&1)&&en(e,"active",c[0])},i(c){n||(j(t.$$.fragment,c),n=!0)},o(c){Z(t.$$.fragment,c),n=!1},d(c){c&&V(e),ce(t),i=!1,o()}}}function sT(r){let e,t=[],n=new Map,i,o,c,a=Nn(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<a.length;p+=1){let _=wy(r,a,p),y=d(_);n.set(y,t[p]=Sy(y,_))}return{c(){e=U("ul");for(let p=0;p<t.length;p+=1)t[p].c();fe(e,"class","options svelte-bz0zu3")},m(p,_){q(p,e,_);for(let y=0;y<t.length;y+=1)t[y]&&t[y].m(e,null);i=!0,o||(c=[xt(e,"mouseleave",r[73]),xt(e,"blur",r[74])],o=!0)},p(p,_){_[0]&17880064&&(a=Nn(p[14]),tn(),t=Q2(t,_,d,1,p,a,n,e,Y2,Sy,null,wy),nn())},i(p){if(!i){for(let _=0;_<a.length;_+=1)j(t[_]);i=!0}},o(p){for(let _=0;_<t.length;_+=1)Z(t[_]);i=!1},d(p){p&&V(e);for(let _=0;_<t.length;_+=1)t[_].d();o=!1,mr(c)}}}function aT(r){let e,t,n,i,o,c;return t=new Pv({}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("div"),o=xe(r[7]),fe(i,"class","svelte-bz0zu3"),fe(e,"class","no-results svelte-bz0zu3")},m(a,d){q(a,e,d),le(t,e,null),R(e,n),R(e,i),R(i,o),c=!0},p(a,d){(!c||d[0]&128)&&Mt(o,a[7])},i(a){c||(j(t.$$.fragment,a),c=!0)},o(a){Z(t.$$.fragment,a),c=!1},d(a){a&&V(e),ce(t)}}}function lT(r){let e="",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p:tt,i:tt,o:tt,d(n){n&&V(t)}}}function cT(r){let e,t,n,i,o,c,a,d,p,_,y;return t=new Pv({}),d=new Av({}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("div"),o=xe(r[6]),c=ie(),a=U("button"),he(d.$$.fragment),fe(i,"class","svelte-bz0zu3"),fe(a,"class","svelte-bz0zu3"),fe(e,"class","error svelte-bz0zu3")},m(w,T){q(w,e,T),le(t,e,null),R(e,n),R(e,i),R(i,o),R(e,c),R(e,a),le(d,a,null),p=!0,_||(y=xt(a,"click",r[70]),_=!0)},p(w,T){(!p||T[0]&64)&&Mt(o,w[6])},i(w){p||(j(t.$$.fragment,w),j(d.$$.fragment,w),p=!0)},o(w){Z(t.$$.fragment,w),Z(d.$$.fragment,w),p=!1},d(w){w&&V(e),ce(t),ce(d),_=!1,y()}}}function Sy(r,e){let t,n,i;function o(){return e[71](e[86])}function c(){return e[72](e[84])}return n=new NC({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",c),{key:r,first:null,c(){t=Qn(),he(n.$$.fragment),this.first=t},m(a,d){q(a,t,d),le(n,a,d),i=!0},p(a,d){e=a;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(a){i||(j(n.$$.fragment,a),i=!0)},o(a){Z(n.$$.fragment,a),i=!1},d(a){a&&V(t),ce(n,a)}}}function uT(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe=!1;o=new GC({}),y=new Av({});let J=r[19]&&xy(),ee=r[5]==="button"&&ky(r);const pe=r[61].default,Ie=Cn(pe,r,r[60],null),Q=[cT,lT,aT,sT],ae=[];function Pe(ve,nt){var Ge,Ee;return ve[18]?0:ve[16]?((Ge=ve[14])==null?void 0:Ge.length)===0?2:ve[16]&&((Ee=ve[14])!=null&&Ee.length)?3:-1:1}return~(D=Pe(r))&&(z=ae[D]=Q[D](r)),{c(){e=ie(),t=U("form"),n=U("div"),i=U("button"),he(o.$$.fragment),c=ie(),a=U("input"),d=ie(),p=U("div"),_=U("button"),he(y.$$.fragment),w=ie(),J&&J.c(),T=ie(),ee&&ee.c(),M=ie(),Ie&&Ie.c(),$=ie(),z&&z.c(),fe(i,"class","search-button svelte-bz0zu3"),fe(i,"type","button"),fe(a,"placeholder",r[8]),fe(a,"aria-label",r[8]),fe(a,"class","svelte-bz0zu3"),fe(_,"type","button"),fe(_,"title",r[3]),fe(_,"class","svelte-bz0zu3"),fe(p,"class","clear-button-container svelte-bz0zu3"),en(p,"displayable",r[1]!==""),fe(n,"class","input-group svelte-bz0zu3"),fe(t,"tabindex","0"),fe(t,"class",I=id(r[2])+" svelte-bz0zu3"),en(t,"can-collapse",r[4]&&r[1]==="")},m(ve,nt){q(ve,e,nt),q(ve,t,nt),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),r[63](a),Wn(a,r[1]),R(n,d),R(n,p),R(p,_),le(y,_,null),R(p,w),J&&J.m(p,null),R(n,T),ee&&ee.m(n,null),R(n,M),Ie&&Ie.m(n,null),R(t,$),~D&&ae[D].m(t,null),F=!0,N||(W=[xt(i,"click",r[62]),xt(a,"input",r[64]),xt(a,"focus",r[65]),xt(a,"blur",r[66]),xt(a,"keydown",r[22]),xt(a,"input",r[67]),xt(_,"click",r[68]),xt(t,"submit",zm(r[21]))],N=!0)},p(ve,nt){(!F||nt[0]&256)&&fe(a,"placeholder",ve[8]),(!F||nt[0]&256)&&fe(a,"aria-label",ve[8]),nt[0]&2&&a.value!==ve[1]&&Wn(a,ve[1]),(!F||nt[0]&8)&&fe(_,"title",ve[3]),ve[19]?J?nt[0]&524288&&j(J,1):(J=xy(),J.c(),j(J,1),J.m(p,null)):J&&(tn(),Z(J,1,1,()=>{J=null}),nn()),(!F||nt[0]&2)&&en(p,"displayable",ve[1]!==""),ve[5]==="button"?ee?(ee.p(ve,nt),nt[0]&32&&j(ee,1)):(ee=ky(ve),ee.c(),j(ee,1),ee.m(n,M)):ee&&(tn(),Z(ee,1,1,()=>{ee=null}),nn()),Ie&&Ie.p&&(!F||nt[1]&536870912)&&Mn(Ie,pe,ve,ve[60],F?Tn(pe,ve[60],nt,null):Ln(ve[60]),null);let Ge=D;D=Pe(ve),D===Ge?~D&&ae[D].p(ve,nt):(z&&(tn(),Z(ae[Ge],1,1,()=>{ae[Ge]=null}),nn()),~D?(z=ae[D],z?z.p(ve,nt):(z=ae[D]=Q[D](ve),z.c()),j(z,1),z.m(t,null)):z=null),(!F||nt[0]&4&&I!==(I=id(ve[2])+" svelte-bz0zu3"))&&fe(t,"class",I),(!F||nt[0]&22)&&en(t,"can-collapse",ve[4]&&ve[1]==="")},i(ve){F||(j(oe),j(o.$$.fragment,ve),j(y.$$.fragment,ve),j(J),j(ee),j(Ie,ve),j(z),F=!0)},o(ve){Z(oe),Z(o.$$.fragment,ve),Z(y.$$.fragment,ve),Z(J),Z(ee),Z(Ie,ve),Z(z),F=!1},d(ve){ve&&(V(e),V(t)),ce(o),r[63](null),ce(y),J&&J.d(),ee&&ee.d(),Ie&&Ie.d(ve),~D&&ae[D].d(),N=!1,mr(W)}}}function hT(r,e,t){let n,i,{$$slots:o={},$$scope:c}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:_=void 0}=e,{clearButtonTitle:y="clear"}=e,{clearOnBlur:w=!1}=e,{collapsed:T=!1}=e,{country:M=void 0}=e,{debounceSearch:$=200}=e,{enableReverse:D="never"}=e,{errorMessage:z="Something went wrong"}=e,{filter:I=()=>!0}=e,{flyTo:F=!0}=e,{fuzzyMatch:N=!0}=e,{language:W=void 0}=e,{limit:oe=void 0}=e,{mapController:J=void 0}=e,{minLength:ee=2}=e,{noResultsMessage:pe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Ie="Search"}=e,{proximity:Q=[{type:"server-geolocation"}]}=e,{reverseActive:ae=D==="always"}=e,{reverseButtonTitle:Pe="toggle reverse geocoding"}=e,{searchValue:ve=""}=e,{pickedResultStyle:nt="full-geometry"}=e,{showPlaceType:Ge="if-needed"}=e,{showResultsWhileTyping:Ee=!0}=e,{selectFirst:De=!0}=e,{flyToSelected:Ct=!1}=e,{markerOnSelected:it=!0}=e,{types:lt=void 0}=e,{exhaustiveReverseGeocoding:mt=!1}=e,{excludeTypes:dt=!1}=e,{zoom:Xe=a}=e,{apiUrl:$t="https://api.maptiler.com/geocoding"}=e,{fetchParameters:yt={}}=e,{iconsBaseUrl:Rt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:It=()=>{}}=e;function Qt(){Ne.focus()}function yn(){Ne.blur()}function ut(te,He=!0,Ke=!1){t(1,ve=te),He?(t(15,et=-1),bt()):(mn(!Ke,Ke),setTimeout(()=>{Ne.focus(),Ne.select()}))}function Wt(){t(14,St=void 0),t(56,_e=void 0),t(15,et=-1)}function Ze(){t(55,Ut=[]),t(56,_e=void 0)}let Ve=!1,St,Ut,_e,Pn="",Ne,et=-1,Kt,er=[],ur,gr,Qr,ei;const co=new Set,hr=ms();Yr(()=>{J&&(J.setEventHandler(void 0),J.indicateReverse(!1),J.setSelectedMarker(-1),J.setFeatures(void 0,void 0,!1))});function bt(te){if(gr&&(clearTimeout(gr),gr=void 0),et>-1&&St)t(56,_e=St[et]),t(1,ve=_e.place_type[0]==="reverse"?_e.place_name:_e.place_name.replace(/,.*/,"")),t(18,Kt=void 0),t(55,Ut=void 0),t(15,et=-1);else if(ve){const He=te||!Bn(ve);xr(ve,{exact:!0}).then(()=>{t(55,Ut=St),t(56,_e=void 0),He&&uo()}).catch(Ke=>t(18,Kt=Ke))}}function Bn(te){try{return oT(te,6)}catch{return!1}}async function xr(te,{byId:He=!1,exact:Ke=!1}={}){t(18,Kt=void 0),ur==null||ur.abort();const Ye=new AbortController;t(19,ur=Ye);try{const ct=Bn(te),Tt=new URLSearchParams;if(W!==void 0&&Tt.set("language",Array.isArray(W)?W.join(","):W??""),lt&&Tt.set("types",lt.join(",")),dt&&Tt.set("excludeTypes",String(dt)),_&&Tt.set("bbox",_.map(jn=>jn.toFixed(6)).join(",")),M&&Tt.set("country",Array.isArray(M)?M.join(","):M),!He&&!ct){const jn=await WC(J,Q,Ye);jn&&Tt.set("proximity",jn),(Ke||!Ee)&&Tt.set("autocomplete","false"),Tt.set("fuzzyMatch",String(N))}oe!==void 0&&(mt||!ct||(lt==null?void 0:lt.length)===1)&&Tt.set("limit",String(oe)),Tt.set("key",p),It(Tt);const Jt=$t+"/"+encodeURIComponent(ct?ct.decimalLongitude+","+ct.decimalLatitude:te)+".json?"+Tt.toString();if(Jt===Pn){He?(t(14,St=void 0),t(56,_e=er[0])):t(14,St=er);return}Pn=Jt;const dn=await fetch(Jt,{signal:Ye.signal,...yt});if(!dn.ok)throw new Error(await dn.text());const xn=await dn.json();hr("response",{url:Jt,featureCollection:xn}),He?(t(14,St=void 0),t(56,_e=xn.features[0]),er=[_e]):(t(14,St=xn.features.filter(I)),ct&&St.unshift({type:"Feature",properties:{},id:"reverse_"+ct.decimalLongitude+"_"+ct.decimalLatitude,text:ct.decimalLatitude+", "+ct.decimalLongitude,place_name:ct.decimalLatitude+", "+ct.decimalLongitude,place_type:["reverse"],center:[ct.decimalLongitude,ct.decimalLatitude],bbox:[ct.decimalLongitude,ct.decimalLatitude,ct.decimalLongitude,ct.decimalLatitude],geometry:{type:"Point",coordinates:[ct.decimalLongitude,ct.decimalLatitude]}}),er=St,ct&&Ne.focus())}catch(ct){if(ct&&typeof ct=="object"&&"name"in ct&&ct.name==="AbortError")return;throw ct}finally{Ye===ur&&t(19,ur=void 0)}}function uo(){var Ye;if(!(Ut!=null&&Ut.length)||!F)return;const te=[180,90,-180,-90],He=!Ut.some(ct=>!ct.matching_text);let Ke;for(const ct of Ut){const Tt=Rn(ct);if(Ke=Ke===void 0?Tt:Tt===void 0?Ke:Math.max(Ke,Tt),He||!ct.matching_text)for(const Jt of[0,1,2,3])te[Jt]=Math[Jt<2?"min":"max"](te[Jt],((Ye=ct.bbox)==null?void 0:Ye[Jt])??ct.center[Jt%2])}J&&Ut.length>0&&(_e&&te[0]===te[2]&&te[1]===te[3]?J.flyTo(_e.center,Rn(_e)):J.fitBounds(dy(te),50,Ke))}function Rn(te){var Ke;if(!te.bbox||te.bbox[0]!==te.bbox[2]&&te.bbox[1]!==te.bbox[3])return;const He=te.id.replace(/\..*/,"");return(Array.isArray((Ke=te.properties)==null?void 0:Ke.categories)?te.properties.categories.reduce((Ye,ct)=>{const Tt=Xe[He+"."+ct];return Ye===void 0?Tt:Tt===void 0?Ye:Math.max(Ye,Tt)},void 0):void 0)??Xe[He]}function Pt(te){t(0,ae=D==="always"),t(14,St=void 0),t(56,_e=void 0),t(15,et=-1),ut(te[1].toFixed(6)+", "+HC(te[0],[-180,180],!0).toFixed(6),!1,!0)}function fn(te){if(!St)return;let He=te.key==="ArrowDown"?1:te.key==="ArrowUp"?-1:0;He&&(et===(De?0:-1)&&He===-1&&t(15,et=St.length),t(15,et+=He),et>=St.length&&t(15,et=-1),et<0&&De&&t(15,et=0),te.preventDefault())}function mn(te=!0,He=!1){if(t(18,Kt=void 0),Ee||He){if(gr&&clearTimeout(gr),ve.length<ee)return;const Ke=ve;gr=window.setTimeout(()=>{xr(Ke).catch(Ye=>t(18,Kt=Ye))},te?$:0)}else t(14,St=void 0),t(18,Kt=void 0)}function wn(te){t(56,_e=te),t(1,ve=te.place_name),t(15,et=-1)}const ln=()=>Ne.focus();function Gt(te){hn[te?"unshift":"push"](()=>{Ne=te,t(17,Ne)})}function Ci(){ve=this.value,t(1,ve),t(13,Ve),t(28,w)}const _r=()=>t(13,Ve=!0),Ce=()=>t(13,Ve=!1),ne=()=>mn(),se=()=>{t(1,ve=""),Ne.focus()},ge=()=>t(0,ae=!ae),we=()=>t(18,Kt=void 0),Fe=te=>t(15,et=te),Be=te=>wn(te),Ue=()=>{De||t(15,et=-1)},ze=()=>{};return r.$$set=te=>{"class"in te&&t(2,d=te.class),"apiKey"in te&&t(26,p=te.apiKey),"bbox"in te&&t(27,_=te.bbox),"clearButtonTitle"in te&&t(3,y=te.clearButtonTitle),"clearOnBlur"in te&&t(28,w=te.clearOnBlur),"collapsed"in te&&t(4,T=te.collapsed),"country"in te&&t(29,M=te.country),"debounceSearch"in te&&t(30,$=te.debounceSearch),"enableReverse"in te&&t(5,D=te.enableReverse),"errorMessage"in te&&t(6,z=te.errorMessage),"filter"in te&&t(31,I=te.filter),"flyTo"in te&&t(32,F=te.flyTo),"fuzzyMatch"in te&&t(33,N=te.fuzzyMatch),"language"in te&&t(34,W=te.language),"limit"in te&&t(35,oe=te.limit),"mapController"in te&&t(36,J=te.mapController),"minLength"in te&&t(37,ee=te.minLength),"noResultsMessage"in te&&t(7,pe=te.noResultsMessage),"placeholder"in te&&t(8,Ie=te.placeholder),"proximity"in te&&t(38,Q=te.proximity),"reverseActive"in te&&t(0,ae=te.reverseActive),"reverseButtonTitle"in te&&t(9,Pe=te.reverseButtonTitle),"searchValue"in te&&t(1,ve=te.searchValue),"pickedResultStyle"in te&&t(39,nt=te.pickedResultStyle),"showPlaceType"in te&&t(10,Ge=te.showPlaceType),"showResultsWhileTyping"in te&&t(40,Ee=te.showResultsWhileTyping),"selectFirst"in te&&t(11,De=te.selectFirst),"flyToSelected"in te&&t(41,Ct=te.flyToSelected),"markerOnSelected"in te&&t(42,it=te.markerOnSelected),"types"in te&&t(43,lt=te.types),"exhaustiveReverseGeocoding"in te&&t(44,mt=te.exhaustiveReverseGeocoding),"excludeTypes"in te&&t(45,dt=te.excludeTypes),"zoom"in te&&t(46,Xe=te.zoom),"apiUrl"in te&&t(47,$t=te.apiUrl),"fetchParameters"in te&&t(48,yt=te.fetchParameters),"iconsBaseUrl"in te&&t(12,Rt=te.iconsBaseUrl),"adjustUrlQuery"in te&&t(49,It=te.adjustUrlQuery),"$$scope"in te&&t(60,c=te.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ae=D==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Qr=Ve),w&&!Ve&&t(1,ve="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ve.length<ee&&(t(56,_e=void 0),t(14,St=void 0),t(18,Kt=void 0),t(55,Ut=St)),r.$$.dirty[1]&33554688&&nt!=="marker-only"&&_e&&!_e.address&&_e.geometry.type==="Point"&&_e.place_type[0]!=="reverse"&&xr(_e.id,{byId:!0}).catch(te=>t(18,Kt=te)),r.$$.dirty[1]&100663330&&(J&&_e&&_e.id!==ei&&F&&(!_e.bbox||_e.bbox[0]===_e.bbox[2]&&_e.bbox[1]===_e.bbox[3]?J.flyTo(_e.center,Rn(_e)):J.fitBounds(dy(_e.bbox),50,Rn(_e)),t(14,St=void 0),t(55,Ut=void 0),t(15,et=-1)),t(57,ei=_e==null?void 0:_e.id)),r.$$.dirty[0]&18432&&De&&St!=null&&St.length&&t(15,et=0),r.$$.dirty[0]&2&&t(15,et=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&Ut!==St&&t(55,Ut=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&J&&J.setEventHandler(te=>{switch(te.type){case"mapClick":ae&&Pt(te.coordinates);break;case"markerClick":{const He=St==null?void 0:St.find(Ke=>Ke.id===te.id);He&&wn(He)}break;case"markerMouseEnter":Ut&&t(15,et=Qr?(St==null?void 0:St.findIndex(He=>He.id===te.id))??-1:-1);break;case"markerMouseLeave":Ut&&t(15,et=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=St==null?void 0:St[et]),r.$$.dirty[1]&134218786&&J&&i&&F&&Ct&&J.flyTo(i.center,Rn(i)),r.$$.dirty[1]&256&&t(59,n=nt==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(it||J==null||J.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&J&&it&&!Ut&&(J.setFeatures(i?[i]:void 0,void 0,n),J.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&J&&J.setFeatures(Ut,_e,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&Ut&&J&&J.setSelectedMarker(et),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&J){const te=Bn(ve);J.setReverseMarker(te?[te.decimalLongitude,te.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&hr("select",{feature:i}),r.$$.dirty[1]&33554432&&hr("pick",{feature:_e}),r.$$.dirty[0]&81920&&hr("optionsvisibilitychange",{optionsVisible:Qr&&!!St}),r.$$.dirty[0]&16384&&hr("featureslisted",{features:St}),r.$$.dirty[1]&16777216&&hr("featuresmarked",{features:Ut}),r.$$.dirty[0]&1&&hr("reversetoggle",{reverse:ae}),r.$$.dirty[0]&2&&hr("querychange",{query:ve}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&J&&J.indicateReverse(ae)},[ae,ve,d,y,T,D,z,pe,Ie,Pe,Ge,De,Rt,Ve,St,et,Qr,Ne,Kt,ur,co,bt,fn,mn,wn,a,p,_,w,M,$,I,F,N,W,oe,J,ee,Q,nt,Ee,Ct,it,lt,mt,dt,Xe,$t,yt,It,Qt,yn,ut,Wt,Ze,Ut,_e,ei,i,n,c,o,ln,Gt,Ci,_r,Ce,ne,se,ge,we,Fe,Be,Ue,ze]}class fT extends Et{constructor(e){super(),Lt(this,e,hT,uT,wt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function Cy(r){let e,t,n;return t=new fT({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"class","svelte-ixhnie")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o&4&&(c.mapController=i[2]),o&1&&(c.apiKey=i[0]),o&2&&(c.country=i[1]),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function dT(r){let e,t,n=r[2]&&Cy(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&j(n,1)):(n=Cy(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function pT(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:c}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function d(p){return p?Iv(p,Jr,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=p=>{"apiKey"in p&&t(0,i=p.apiKey),"map"in p&&t(4,o=p.map),"country"in p&&t(1,c=p.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=d(o))},[i,c,n,a,o]}class mT extends Et{constructor(e){super(),Lt(this,e,pT,dT,wt,{apiKey:0,map:4,country:1})}}const gT=Symbol.for("svelte-maplibre");function _T(){return Sh(gT)}function yT(r){return"layerType"in r&&r.layerType==="deckgl"}const bT=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Ty=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function My(r){let e,t,n=(r[4]||r[3]instanceof Jr.Marker)&&Ly(r);return{c(){e=U("div"),n&&n.c()},m(i,o){q(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof Jr.Marker?n?(n.p(i,o),o[0]&24&&j(n,1)):(n=Ly(i),n.c(),j(n,1),n.m(e,null)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(),r[32](null)}}}function Ly(r){let e;const t=r[30].default,n=Cn(t,r,r[29],Ty);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&Mn(n,t,i,i[29],e?Tn(t,i[29],o,bT):Ln(i[29]),Ty)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function vT(r){let e,t,n=r[9].default&&My(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&j(n,1)):(n=My(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function wT(r,e,t){let n,i,o,c,a,d,{$$slots:p={},$$scope:_}=e;const y=Pm(p);let{closeButton:w=void 0}=e,{closeOnClickOutside:T=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:$=!1}=e,{openOn:D="click"}=e,{openIfTopMost:z=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:F=void 0}=e,{offset:N=void 0}=e,{popupClass:W=void 0}=e,{maxWidth:oe=void 0}=e,{lngLat:J=void 0}=e,{html:ee=void 0}=e,{open:pe=!1}=e;const Ie=ms(),{map:Q,popupTarget:ae,layerEvent:Pe,layer:ve,eventTopMost:nt}=_T();at(r,Q,Ve=>t(2,o=Ve)),at(r,ae,Ve=>t(3,a=Ve)),at(r,Pe,Ve=>t(28,c=Ve)),at(r,ve,Ve=>t(35,d=Ve));const Ge=["click","dblclick","contextmenu"];let Ee,De=!1,Ct;function it(){if(!Ee)return;let Ve=Ee.getElement();!Ve||Ve===Ct||(Ct=Ve,D==="hover"&&(Ct.style.pointerEvents="none"),Ct.addEventListener("mouseenter",()=>{t(24,De=!0)},{passive:!0}),Ct.addEventListener("mouseleave",()=>{t(24,De=!1)},{passive:!0}),Ct.addEventListener("click",()=>{M&&t(0,pe=!1)},{passive:!0}))}Ls(()=>{if(o)return o.on("click",yn),o.on("contextmenu",yn),typeof a=="string"&&(o.on("click",a,Xe),o.on("dblclick",a,Xe),o.on("contextmenu",a,Xe),o.on("mousemove",a,Qt),o.on("mouseleave",a,It),o.on("touchstart",a,yt),o.on("touchend",a,Rt)),()=>{o!=null&&o.loaded()&&(Ee==null||Ee.remove(),o.off("click",yn),o.off("contextmenu",yn),a instanceof Jr.Marker?a.getPopup()===Ee&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,Xe),o.off("dblclick",a,Xe),o.off("contextmenu",a,Xe),o.off("mousemove",a,Qt),o.off("mouseleave",a,It),o.off("touchstart",a,yt),o.off("touchend",a,Rt)))}});function lt(Ve){return z?!("marker"in Ve)&&!yT(Ve)&&nt(Ve)!==d:!1}let mt=null,dt="normal";function Xe(Ve){Ve.type===D&&(lt(Ve)||("layerType"in Ve?Ve.layerType==="deckgl"?(t(10,J=Ve.coordinate),t(4,mt=Ve.object?[Ve.object]:null)):(t(10,J=Ve.lngLat),t(4,mt=Ve.features??[])):(t(10,J=Ve.lngLat),t(4,mt=Ve.features??[])),setTimeout(()=>t(0,pe=!0))))}let $t=null;function yt(Ve){$t=Ve.point}function Rt(Ve){if(!$t||D!=="hover")return;let St=$t.dist(Ve.point);$t=null,St<3&&(t(10,J=Ve.lngLat),t(4,mt=Ve.features??[]),Ee.isOpen()?t(25,dt="justOpened"):(t(25,dt="opening"),t(0,pe=!0)))}function It(Ve){D!=="hover"||$t||dt!=="normal"||(t(0,pe=!1),t(4,mt=null))}function Qt(Ve){if(!(D!=="hover"||$t||dt!=="normal")){if(lt(Ve)){t(0,pe=!1),t(4,mt=null);return}t(0,pe=!0),t(4,mt=Ve.features??[]),t(10,J=Ve.lngLat)}}function yn(Ve){if(dt==="justOpened"){t(25,dt="normal");return}if(!T)return;let St=[Ct,a instanceof Jr.Marker?a==null?void 0:a.getElement():null];pe&&Ee.isOpen()&&!St.some(Ut=>Ut==null?void 0:Ut.contains(Ve.originalEvent.target))&&(Ve.type==="contextmenu"&&D==="contextmenu"||Ve.type!=="contextmenu")&&t(0,pe=!1)}Yr(()=>{o&&(Ee!=null&&Ee.isOpen())&&Ee.remove()});let ut;const Wt=()=>t(0,pe=!1);function Ze(Ve){hn[Ve?"unshift":"push"](()=>{ut=Ve,t(1,ut)})}return r.$$set=Ve=>{"closeButton"in Ve&&t(11,w=Ve.closeButton),"closeOnClickOutside"in Ve&&t(12,T=Ve.closeOnClickOutside),"closeOnClickInside"in Ve&&t(13,M=Ve.closeOnClickInside),"closeOnMove"in Ve&&t(14,$=Ve.closeOnMove),"openOn"in Ve&&t(15,D=Ve.openOn),"openIfTopMost"in Ve&&t(16,z=Ve.openIfTopMost),"focusAfterOpen"in Ve&&t(17,I=Ve.focusAfterOpen),"anchor"in Ve&&t(18,F=Ve.anchor),"offset"in Ve&&t(19,N=Ve.offset),"popupClass"in Ve&&t(20,W=Ve.popupClass),"maxWidth"in Ve&&t(21,oe=Ve.maxWidth),"lngLat"in Ve&&t(10,J=Ve.lngLat),"html"in Ve&&t(22,ee=Ve.html),"open"in Ve&&t(0,pe=Ve.open),"$$scope"in Ve&&t(29,_=Ve.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=w??(!T&&!M)),r.$$.dirty[0]&146685952&&(Ee||(t(23,Ee=new Jr.Popup({closeButton:n,closeOnClick:!1,closeOnMove:$,focusAfterOpen:I,maxWidth:oe,className:W,anchor:F,offset:N})),Ct=Ee.getElement(),Ee.on("open",()=>{t(0,pe=!0),it(),Ie("open",Ee)}),Ee.on("close",()=>{t(0,pe=!1),Ie("close",Ee)}),Ee.on("hover",()=>{Ie("hover",Ee)}))),r.$$.dirty[0]&8421384&&Ee&&a instanceof Jr.Marker&&(D==="click"?a.setPopup(Ee):a.getPopup()===Ee&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ge.includes(D)&&(c==null?void 0:c.type)===D&&(Xe(c),Nt(Pe,c=null,c)),r.$$.dirty[0]&268468224&&t(26,i=D==="hover"&&((c==null?void 0:c.type)==="mousemove"||(c==null?void 0:c.type)==="mouseenter")),r.$$.dirty[0]&352354304&&D==="hover"&&Pe&&(i&&c&&(c.layerType==="deckgl"?(t(10,J=c.coordinate),t(4,mt=c.object?[c.object]:null)):(t(10,J=c.lngLat),t(4,mt=c.features??[]))),t(0,pe=(i||De)??!1)),r.$$.dirty[0]&12582914&&(ut?Ee.setDOMContent(ut):ee&&Ee.setHTML(ee)),r.$$.dirty[0]&8389632&&J&&Ee.setLngLat(J),r.$$.dirty[0]&41943045&&o){let Ve=Ee.isOpen();pe&&!Ve?(Ee.addTo(o),dt==="opening"&&t(25,dt="justOpened")):!pe&&Ve&&Ee.remove()}},[pe,ut,o,a,mt,Q,ae,Pe,ve,y,J,w,T,M,$,D,z,I,F,N,W,oe,ee,Ee,De,dt,i,n,c,_,p,Wt,Ze]}class xT extends Et{constructor(e){super(),Lt(this,e,wT,vT,wt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const kT=r=>({props:r&8}),Ey=r=>({props:TT(r[3])});function ST(r){let e;const t=r[1].default,n=Cn(t,r,r[2],Ey);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&Mn(n,t,i,i[2],e?Tn(t,i[2],o,kT):Ln(i[2]),Ey)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function CT(r){let e,t;return e=new xT({props:{openOn:r[0],$$slots:{default:[ST,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function TT(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function MT(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=c=>{"openOn"in c&&t(0,o=c.openOn),"$$scope"in c&&t(2,i=c.$$scope)},[o,n,i]}class hi extends Et{constructor(e){super(),Lt(this,e,MT,CT,wt,{openOn:0})}}function Do(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function lo(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function Wi(){return{type:"FeatureCollection",features:[]}}function LT(r){let e,t,n;return t=new Oo({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","legend")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p:tt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function ET(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function IT(r){let e,t,n;return t=new Oo({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","legend")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p:tt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function AT(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function PT(r){let e,t,n;return t=new Jm({props:{labelColors:r[5]}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","legend")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p:tt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function zT(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function DT(r){let e,t,n,i,o,c;const a=[gn("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Do(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":qs(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let d={};for(let T=0;T<a.length;T+=1)d=Ot(d,a[T]);e=new rr({props:d});const p=[gn("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Do(["get","Level of Service"],r[4],"cyan"),"line-width":qs(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let _={};for(let T=0;T<p.length;T+=1)_=Ot(_,p[T]);n=new rr({props:_});const y=[gn("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Do(["get","Infrastructure type"],r[5],"cyan"),"line-width":qs(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let w={};for(let T=0;T<y.length;T+=1)w=Ot(w,y[T]);return o=new rr({props:w}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment)},m(T,M){le(e,T,M),q(T,t,M),le(n,T,M),q(T,i,M),le(o,T,M),c=!0},p(T,M){const $=M&9?Vn(a,[a[0],a[1],a[2],M&8&&{paint:{"line-color":Do(["get","Traffic volume category"],{"0 to 1999":T[3].colorScale[0],"2000 to 3999":T[3].colorScale[1],"4000+":T[3].colorScale[2]},"cyan"),"line-width":qs(0)}},M&1&&{layout:{visibility:T[0]?"visible":"none"}}]):{};e.$set($);const D=M&18?Vn(p,[p[0],p[1],M&16&&{paint:{"line-color":Do(["get","Level of Service"],T[4],"cyan"),"line-width":qs(1)}},M&2&&{layout:{visibility:T[1]?"visible":"none"}}]):{};n.$set(D);const z=M&36?Vn(y,[y[0],y[1],y[2],M&32&&{paint:{"line-color":Do(["get","Infrastructure type"],T[5],"cyan"),"line-width":qs(1)}},M&4&&{layout:{visibility:T[2]?"visible":"none"}}]):{};o.$set(z)},i(T){c||(j(e.$$.fragment,T),j(n.$$.fragment,T),j(o.$$.fragment,T),c=!0)},o(T){Z(e.$$.fragment,T),Z(n.$$.fragment,T),Z(o.$$.fragment,T),c=!1},d(T){T&&(V(t),V(i)),ce(e,T),ce(n,T),ce(o,T)}}}function $T(r){let e,t,n,i,o,c,a,d,p,_,y;function w(I){r[6](I)}let T={label:"Traffic",$$slots:{help:[ET],legend:[LT]},$$scope:{ctx:r}};r[0]!==void 0&&(T.show=r[0]),e=new es({props:T}),hn.push(()=>An(e,"show",w));function M(I){r[7](I)}let $={label:"Level of Service",$$slots:{help:[AT],legend:[IT]},$$scope:{ctx:r}};r[1]!==void 0&&($.show=r[1]),i=new es({props:$}),hn.push(()=>An(i,"show",M));function D(I){r[8](I)}let z={label:"Cycle infrastructure",$$slots:{help:[zT],legend:[PT]},$$scope:{ctx:r}};return r[2]!==void 0&&(z.show=r[2]),a=new es({props:z}),hn.push(()=>An(a,"show",D)),_=new Eh({props:{url:`pmtiles://${zo("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[DT]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),n=ie(),he(i.$$.fragment),c=ie(),he(a.$$.fragment),p=ie(),he(_.$$.fragment)},m(I,F){le(e,I,F),q(I,n,F),le(i,I,F),q(I,c,F),le(a,I,F),q(I,p,F),le(_,I,F),y=!0},p(I,[F]){const N={};F&512&&(N.$$scope={dirty:F,ctx:I}),!t&&F&1&&(t=!0,N.show=I[0],In(()=>t=!1)),e.$set(N);const W={};F&512&&(W.$$scope={dirty:F,ctx:I}),!o&&F&2&&(o=!0,W.show=I[1],In(()=>o=!1)),i.$set(W);const oe={};F&512&&(oe.$$scope={dirty:F,ctx:I}),!d&&F&4&&(d=!0,oe.show=I[2],In(()=>d=!1)),a.$set(oe);const J={};F&519&&(J.$$scope={dirty:F,ctx:I}),_.$set(J)},i(I){y||(j(e.$$.fragment,I),j(i.$$.fragment,I),j(a.$$.fragment,I),j(_.$$.fragment,I),y=!0)},o(I){Z(e.$$.fragment,I),Z(i.$$.fragment,I),Z(a.$$.fragment,I),Z(_.$$.fragment,I),y=!1},d(I){I&&(V(n),V(c),V(p)),ce(e,I),ce(i,I),ce(a,I),ce(_,I)}}}function RT(r,e,t){let n=!1,i=!1,o=!1,c={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},a={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},d={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function p(w){n=w,t(0,n)}function _(w){i=w,t(1,i)}function y(w){o=w,t(2,o)}return[n,i,o,c,a,d,p,_,y]}class FT extends Et{constructor(e){super(),Lt(this,e,RT,$T,wt,{})}}function BT(r){let e,t,n;return t=new Jm({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","legend")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p:tt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function OT(r){let e;return{c(){e=U("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function Iy(r){let e,t;return e=new pr({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[UT]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function NT(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&Mt(t,e)},d(n){n&&V(t)}}}function jT(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[NT,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function UT(r){let e,t;const n=[gn("context-pois"),{paint:{"circle-color":Do(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[jT]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new wl({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a=c&5?Vn(n,[n[0],c&4&&{paint:{"circle-color":Do(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1}},c&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};c&32&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function VT(r){let e,t,n,i,o;function c(p){r[3](p)}let a={label:"POIs",$$slots:{help:[OT],legend:[BT]},$$scope:{ctx:r}};r[0]!==void 0&&(a.show=r[0]),e=new es({props:a}),hn.push(()=>An(e,"show",c));let d=r[1]&&Iy(r);return{c(){he(e.$$.fragment),n=ie(),d&&d.c(),i=Qn()},m(p,_){le(e,p,_),q(p,n,_),d&&d.m(p,_),q(p,i,_),o=!0},p(p,[_]){const y={};_&32&&(y.$$scope={dirty:_,ctx:p}),!t&&_&1&&(t=!0,y.show=p[0],In(()=>t=!1)),e.$set(y),p[1]?d?(d.p(p,_),_&2&&j(d,1)):(d=Iy(p),d.c(),j(d,1),d.m(i.parentNode,i)):d&&(tn(),Z(d,1,1,()=>{d=null}),nn())},i(p){o||(j(e.$$.fragment,p),j(d),o=!0)},o(p){Z(e.$$.fragment,p),Z(d),o=!1},d(p){p&&(V(n),V(i)),ce(e,p),d&&d.d(p)}}}function qT(r,e,t){let n;at(r,Ar,a=>t(1,n=a));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99"};function c(a){i=a,t(0,i)}return[i,n,o,c]}class ZT extends Et{constructor(e){super(),Lt(this,e,qT,VT,wt,{})}}function GT(r){let e,t,n,i,o;return t=new Oo({props:{colorScale:Sd,labels:{buckets:pv(Cd)}}}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("div"),i.innerHTML="<span>More deprived</span> <span>Less deprived</span>",st(i,"display","flex"),st(i,"justify-content","space-between"),fe(e,"slot","legend")},m(c,a){q(c,e,a),le(t,e,null),R(e,n),R(e,i),o=!0},p:tt,i(c){o||(j(t.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),o=!1},d(c){c&&V(e),ce(t)}}}function HT(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function WT(r){let e,t,n,i,o;return t=new Oo({props:{colorScale:Td,labels:{limits:Md}}}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("div"),i.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",st(i,"display","flex"),st(i,"justify-content","space-between"),fe(e,"slot","legend")},m(c,a){q(c,e,a),le(t,e,null),R(e,n),R(e,i),o=!0},p:tt,i(c){o||(j(t.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),o=!1},d(c){c&&V(e),ce(t)}}}function KT(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function XT(r){let e,t,n,i,o;return t=new Oo({props:{colorScale:Ed,labels:{limits:Ld.map(sM)}}}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',st(i,"display","flex"),st(i,"justify-content","space-between"),fe(e,"slot","legend")},m(c,a){q(c,e,a),le(t,e,null),R(e,n),R(e,i),o=!0},p:tt,i(c){o||(j(t.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),o=!1},d(c){c&&V(e),ce(t)}}}function JT(r){let e;return{c(){e=U("p"),e.textContent="Show households from the Scottish census with at least one car.",fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function YT(r){let e,t,n=r[6].id+"",i,o,c=r[6].population.toLocaleString()+"",a,d,p=r[6].imd_rank+"",_,y,w=r[6].imd_percentile+"",T,M;return{c(){e=U("p"),t=xe("Data zone "),i=xe(n),o=xe(`
        has `),a=xe(c),d=xe(`
        people, and a SIMD rank of `),_=xe(p),y=xe(`, making it less deprived
        than `),T=xe(w),M=xe("% of data zones.")},m($,D){q($,e,D),R(e,t),R(e,i),R(e,o),R(e,a),R(e,d),R(e,_),R(e,y),R(e,T),R(e,M)},p($,D){D&64&&n!==(n=$[6].id+"")&&Mt(i,n),D&64&&c!==(c=$[6].population.toLocaleString()+"")&&Mt(a,c),D&64&&p!==(p=$[6].imd_rank+"")&&Mt(_,p),D&64&&w!==(w=$[6].imd_percentile+"")&&Mt(T,w)},d($){$&&V(e)}}}function QT(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[YT,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function eM(r){let e,t,n=r[6].id+"",i,o,c=Fc(r[6].households_with_cars_or_vans,r[6].total_households)+"",a,d,p=r[6].total_households.toLocaleString()+"",_,y;return{c(){e=U("p"),t=xe("In data zone "),i=xe(n),o=ie(),a=xe(c),d=xe(" of approximately "),_=xe(p),y=xe(`
        households have at least one car or van.`)},m(w,T){q(w,e,T),R(e,t),R(e,i),R(e,o),R(e,a),R(e,d),R(e,_),R(e,y)},p(w,T){T&64&&n!==(n=w[6].id+"")&&Mt(i,n),T&64&&c!==(c=Fc(w[6].households_with_cars_or_vans,w[6].total_households)+"")&&Mt(a,c),T&64&&p!==(p=w[6].total_households.toLocaleString()+"")&&Mt(_,p)},d(w){w&&V(e)}}}function tM(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[eM,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function nM(r){let e,t,n=r[6].id+"",i,o,c=r[6].population.toLocaleString()+"",a,d,p=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",_,y;return{c(){e=U("p"),t=xe("Data zone "),i=xe(n),o=xe(`
        has `),a=xe(c),d=xe(`
        people, with a density of `),_=xe(p),y=xe(" people per square kilometer")},m(w,T){q(w,e,T),R(e,t),R(e,i),R(e,o),R(e,a),R(e,d),R(e,_),R(e,y)},p(w,T){T&64&&n!==(n=w[6].id+"")&&Mt(i,n),T&64&&c!==(c=w[6].population.toLocaleString()+"")&&Mt(a,c),T&64&&p!==(p=Math.round(w[6].population/(w[6].area/1e6)).toLocaleString()+"")&&Mt(_,p)},d(w){w&&V(e)}}}function rM(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[nM,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function iM(r){let e,t,n,i,o,c,a,d;const p=[gn("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":lo(["get","imd_percentile"],Cd,Sd),"fill-opacity":Jn(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let _={$$slots:{default:[QT]},$$scope:{ctx:r}};for(let z=0;z<p.length;z+=1)_=Ot(_,p[z]);e=new zi({props:_});const y=[gn("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":lo(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],Ld,Ed),"fill-opacity":Jn(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let w={$$slots:{default:[tM]},$$scope:{ctx:r}};for(let z=0;z<y.length;z+=1)w=Ot(w,y[z]);n=new zi({props:w});const T=[gn("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":lo(["/",["get","population"],["/",["get","area"],1e6]],Md,Td),"fill-opacity":Jn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let M={$$slots:{default:[rM]},$$scope:{ctx:r}};for(let z=0;z<T.length;z+=1)M=Ot(M,T[z]);o=new zi({props:M});const $=[gn("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let D={};for(let z=0;z<$.length;z+=1)D=Ot(D,$[z]);return a=new rr({props:D}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment)},m(z,I){le(e,z,I),q(z,t,I),le(n,z,I),q(z,i,I),le(o,z,I),q(z,c,I),le(a,z,I),d=!0},p(z,I){const F=I&1?Vn(p,[p[0],p[1],p[2],p[3],{layout:{visibility:z[0]?"visible":"none"}}]):{};I&128&&(F.$$scope={dirty:I,ctx:z}),e.$set(F);const N=I&4?Vn(y,[y[0],y[1],y[2],y[3],{layout:{visibility:z[2]?"visible":"none"}}]):{};I&128&&(N.$$scope={dirty:I,ctx:z}),n.$set(N);const W=I&2?Vn(T,[T[0],T[1],T[2],T[3],{layout:{visibility:z[1]?"visible":"none"}}]):{};I&128&&(W.$$scope={dirty:I,ctx:z}),o.$set(W);const oe=I&7?Vn($,[$[0],$[1],$[2],{layout:{visibility:z[0]||z[1]||z[2]?"visible":"none"}}]):{};a.$set(oe)},i(z){d||(j(e.$$.fragment,z),j(n.$$.fragment,z),j(o.$$.fragment,z),j(a.$$.fragment,z),d=!0)},o(z){Z(e.$$.fragment,z),Z(n.$$.fragment,z),Z(o.$$.fragment,z),Z(a.$$.fragment,z),d=!1},d(z){z&&(V(t),V(i),V(c)),ce(e,z),ce(n,z),ce(o,z),ce(a,z)}}}function oM(r){let e,t,n,i,o,c,a,d,p,_,y;function w(I){r[3](I)}let T={label:"SIMD",$$slots:{help:[HT],legend:[GT]},$$scope:{ctx:r}};r[0]!==void 0&&(T.show=r[0]),e=new es({props:T}),hn.push(()=>An(e,"show",w));function M(I){r[4](I)}let $={label:"Population density",$$slots:{help:[KT],legend:[WT]},$$scope:{ctx:r}};r[1]!==void 0&&($.show=r[1]),i=new es({props:$}),hn.push(()=>An(i,"show",M));function D(I){r[5](I)}let z={label:"Car ownership",$$slots:{help:[JT],legend:[XT]},$$scope:{ctx:r}};return r[2]!==void 0&&(z.show=r[2]),a=new es({props:z}),hn.push(()=>An(a,"show",D)),_=new Eh({props:{url:`pmtiles://${zo("cnt_layers/population.pmtiles")}`,$$slots:{default:[iM]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),n=ie(),he(i.$$.fragment),c=ie(),he(a.$$.fragment),p=ie(),he(_.$$.fragment)},m(I,F){le(e,I,F),q(I,n,F),le(i,I,F),q(I,c,F),le(a,I,F),q(I,p,F),le(_,I,F),y=!0},p(I,[F]){const N={};F&128&&(N.$$scope={dirty:F,ctx:I}),!t&&F&1&&(t=!0,N.show=I[0],In(()=>t=!1)),e.$set(N);const W={};F&128&&(W.$$scope={dirty:F,ctx:I}),!o&&F&2&&(o=!0,W.show=I[1],In(()=>o=!1)),i.$set(W);const oe={};F&128&&(oe.$$scope={dirty:F,ctx:I}),!d&&F&4&&(d=!0,oe.show=I[2],In(()=>d=!1)),a.$set(oe);const J={};F&135&&(J.$$scope={dirty:F,ctx:I}),_.$set(J)},i(I){y||(j(e.$$.fragment,I),j(i.$$.fragment,I),j(a.$$.fragment,I),j(_.$$.fragment,I),y=!0)},o(I){Z(e.$$.fragment,I),Z(i.$$.fragment,I),Z(a.$$.fragment,I),Z(_.$$.fragment,I),y=!1},d(I){I&&(V(n),V(c),V(p)),ce(e,I),ce(i,I),ce(a,I),ce(_,I)}}}const sM=r=>`${r}%`;function aM(r,e,t){let n=!1,i=!1,o=!1;function c(p){n=p,t(0,n)}function a(p){i=p,t(1,i)}function d(p){o=p,t(2,o)}return[n,i,o,c,a,d]}class lM extends Et{constructor(e){super(),Lt(this,e,aM,oM,wt,{})}}function cM(r){let e;return{c(){e=U("div"),e.innerHTML=`<img src="${bb}" alt="National Rail logo"/>
    Station`,fe(e,"slot","legend"),st(e,"display","flex"),st(e,"gap","8px"),st(e,"align-items","center")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function uM(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function hM(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=U("p"),n=xe(t)},m(i,o){q(i,e,o),R(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&Mt(n,t)},d(i){i&&V(e)}}}function fM(r){let e,t;return e=new hi({props:{$$slots:{default:[hM,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function dM(r){let e,t;const n=[gn("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[fM]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new gh({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a=c&1?Vn(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function pM(r){let e,t,n,i,o;function c(d){r[1](d)}let a={label:"Railway stations",$$slots:{help:[uM],legend:[cM]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new es({props:a}),hn.push(()=>An(e,"show",c)),i=new pr({props:{data:zo("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[dM]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),n=ie(),he(i.$$.fragment)},m(d,p){le(e,d,p),q(d,n,p),le(i,d,p),o=!0},p(d,[p]){const _={};p&8&&(_.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,_.show=d[0],In(()=>t=!1)),e.$set(_);const y={};p&9&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){Z(e.$$.fragment,d),Z(i.$$.fragment,d),o=!1},d(d){d&&V(n),ce(e,d),ce(i,d)}}}function mM(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class gM extends Et{constructor(e){super(),Lt(this,e,mM,pM,wt,{})}}function Ay(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Py(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function zy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Dy(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function $y(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Ry(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function _M(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function Fy(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],Wn(e,e.__value)},m(i,o){q(i,e,o),R(e,n)},p:tt,d(i){i&&V(e)}}}function By(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],Wn(e,e.__value)},m(i,o){q(i,e,o),R(e,n)},p:tt,d(i){i&&V(e)}}}function Oy(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],Wn(e,e.__value)},m(i,o){q(i,e,o),R(e,n)},p:tt,d(i){i&&V(e)}}}function Ny(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=xe(t),e.__value=r[18],Wn(e,e.__value)},m(i,o){q(i,e,o),R(e,n)},p:tt,d(i){i&&V(e)}}}function yM(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F=Nn(r[7]),N=[];for(let Q=0;Q<F.length;Q+=1)N[Q]=Fy(Ry(r,F,Q));let W=Nn(r[8]),oe=[];for(let Q=0;Q<W.length;Q+=1)oe[Q]=By($y(r,W,Q));let J=Nn(r[9]),ee=[];for(let Q=0;Q<J.length;Q+=1)ee[Q]=Oy(Dy(r,J,Q));let pe=Nn(r[10]),Ie=[];for(let Q=0;Q<pe.length;Q+=1)Ie[Q]=Ny(zy(r,pe,Q));return{c(){e=U("div"),t=U("label"),n=xe(`Trip purpose:
      `),i=U("select");for(let Q=0;Q<N.length;Q+=1)N[Q].c();o=ie(),c=U("label"),a=xe(`Scenario:
      `),d=U("select");for(let Q=0;Q<oe.length;Q+=1)oe[Q].c();p=ie(),_=U("label"),y=xe(`Network type:
      `),w=U("select");for(let Q=0;Q<ee.length;Q+=1)ee[Q].c();T=ie(),M=U("label"),$=xe(`Color by:
      `),D=U("select");for(let Q=0;Q<Ie.length;Q+=1)Ie[Q].c();r[0]===void 0&&us(()=>r[11].call(i)),r[1]===void 0&&us(()=>r[12].call(d)),r[2]===void 0&&us(()=>r[13].call(w)),r[3]===void 0&&us(()=>r[14].call(D)),fe(e,"slot","legend")},m(Q,ae){q(Q,e,ae),R(e,t),R(t,n),R(t,i);for(let Pe=0;Pe<N.length;Pe+=1)N[Pe]&&N[Pe].m(i,null);Zi(i,r[0],!0),R(e,o),R(e,c),R(c,a),R(c,d);for(let Pe=0;Pe<oe.length;Pe+=1)oe[Pe]&&oe[Pe].m(d,null);Zi(d,r[1],!0),R(e,p),R(e,_),R(_,y),R(_,w);for(let Pe=0;Pe<ee.length;Pe+=1)ee[Pe]&&ee[Pe].m(w,null);Zi(w,r[2],!0),R(e,T),R(e,M),R(M,$),R(M,D);for(let Pe=0;Pe<Ie.length;Pe+=1)Ie[Pe]&&Ie[Pe].m(D,null);Zi(D,r[3],!0),z||(I=[xt(i,"change",r[11]),xt(d,"change",r[12]),xt(w,"change",r[13]),xt(D,"change",r[14])],z=!0)},p(Q,ae){if(ae[0]&128){F=Nn(Q[7]);let Pe;for(Pe=0;Pe<F.length;Pe+=1){const ve=Ry(Q,F,Pe);N[Pe]?N[Pe].p(ve,ae):(N[Pe]=Fy(ve),N[Pe].c(),N[Pe].m(i,null))}for(;Pe<N.length;Pe+=1)N[Pe].d(1);N.length=F.length}if(ae[0]&129&&Zi(i,Q[0]),ae[0]&256){W=Nn(Q[8]);let Pe;for(Pe=0;Pe<W.length;Pe+=1){const ve=$y(Q,W,Pe);oe[Pe]?oe[Pe].p(ve,ae):(oe[Pe]=By(ve),oe[Pe].c(),oe[Pe].m(d,null))}for(;Pe<oe.length;Pe+=1)oe[Pe].d(1);oe.length=W.length}if(ae[0]&258&&Zi(d,Q[1]),ae[0]&512){J=Nn(Q[9]);let Pe;for(Pe=0;Pe<J.length;Pe+=1){const ve=Dy(Q,J,Pe);ee[Pe]?ee[Pe].p(ve,ae):(ee[Pe]=Oy(ve),ee[Pe].c(),ee[Pe].m(w,null))}for(;Pe<ee.length;Pe+=1)ee[Pe].d(1);ee.length=J.length}if(ae[0]&516&&Zi(w,Q[2]),ae[0]&1024){pe=Nn(Q[10]);let Pe;for(Pe=0;Pe<pe.length;Pe+=1){const ve=zy(Q,pe,Pe);Ie[Pe]?Ie[Pe].p(ve,ae):(Ie[Pe]=Ny(ve),Ie[Pe].c(),Ie[Pe].m(D,null))}for(;Pe<Ie.length;Pe+=1)Ie[Pe].d(1);Ie.length=pe.length}ae[0]&1032&&Zi(D,Q[3])},d(Q){Q&&V(e),pi(N,Q),pi(oe,Q),pi(ee,Q),pi(Ie,Q),z=!1,mr(I)}}}function jy(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",c,a,d,p=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",_,y,w,T=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",M,$;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=ie(),i=U("td"),c=xe(o),a=ie(),d=U("td"),_=xe(p),y=ie(),w=U("td"),M=xe(T),$=ie()},m(D,z){q(D,e,z),R(e,t),R(e,n),R(e,i),R(i,c),R(e,a),R(e,d),R(d,_),R(e,y),R(e,w),R(w,M),R(e,$)},p(D,z){z[0]&131072&&o!==(o=D[17][`${D[18]}_fastest_bicycle`].toLocaleString()+"")&&Mt(c,o),z[0]&131072&&p!==(p=D[17][`${D[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&Mt(_,p),z[0]&131072&&T!==(T=D[17][`${D[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&Mt(M,T)},d(D){D&&V(e)}}}function Uy(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",c,a,d,p=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",_,y,w,T=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",M,$;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=ie(),i=U("td"),c=xe(o),a=ie(),d=U("td"),_=xe(p),y=ie(),w=U("td"),M=xe(T),$=ie()},m(D,z){q(D,e,z),R(e,t),R(e,n),R(e,i),R(i,c),R(e,a),R(e,d),R(d,_),R(e,y),R(e,w),R(w,M),R(e,$)},p(D,z){z[0]&131072&&o!==(o=D[17][`${D[18]}_quietest_bicycle`].toLocaleString()+"")&&Mt(c,o),z[0]&131072&&p!==(p=D[17][`${D[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&Mt(_,p),z[0]&131072&&T!==(T=D[17][`${D[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&Mt(M,T)},d(D){D&&V(e)}}}function bM(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,c,a,d,p=r[17].gradient+"",_,y,w,T,M,$=r[17].quietness+"",D,z,I,F,N,W,oe,J,ee,pe,Ie,Q,ae,Pe,ve,nt,Ge,Ee=Nn(r[7]),De=[];for(let lt=0;lt<Ee.length;lt+=1)De[lt]=jy(Py(r,Ee,lt));let Ct=Nn(r[7]),it=[];for(let lt=0;lt<Ct.length;lt+=1)it[lt]=Uy(Ay(r,Ct,lt));return{c(){e=U("div"),t=U("p"),n=xe("Cyclists: "),o=xe(i),c=ie(),a=U("p"),d=xe("Gradient: "),_=xe(p),y=xe("%"),w=ie(),T=U("p"),M=xe("Cycle-friendliness: "),D=xe($),z=xe("%"),I=ie(),F=U("details"),N=U("summary"),N.textContent="All network details",W=ie(),oe=U("p"),oe.textContent="Fast/Direct network",J=ie(),ee=U("table"),pe=U("tr"),pe.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ie=ie();for(let lt=0;lt<De.length;lt+=1)De[lt].c();Q=ie(),ae=U("p"),ae.textContent="Quiet/Indirect network",Pe=ie(),ve=U("table"),nt=U("tr"),nt.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Ge=ie();for(let lt=0;lt<it.length;lt+=1)it[lt].c();st(e,"max-width","30vw"),st(e,"max-height","60vh"),st(e,"overflow","auto")},m(lt,mt){q(lt,e,mt),R(e,t),R(t,n),R(t,o),R(e,c),R(e,a),R(a,d),R(a,_),R(a,y),R(e,w),R(e,T),R(T,M),R(T,D),R(T,z),R(e,I),R(e,F),R(F,N),R(F,W),R(F,oe),R(F,J),R(F,ee),R(ee,pe),R(ee,Ie);for(let dt=0;dt<De.length;dt+=1)De[dt]&&De[dt].m(ee,null);R(F,Q),R(F,ae),R(F,Pe),R(F,ve),R(ve,nt),R(ve,Ge);for(let dt=0;dt<it.length;dt+=1)it[dt]&&it[dt].m(ve,null)},p(lt,mt){if(mt[0]&131088&&i!==(i=lt[17][lt[4]].toLocaleString()+"")&&Mt(o,i),mt[0]&131072&&p!==(p=lt[17].gradient+"")&&Mt(_,p),mt[0]&131072&&$!==($=lt[17].quietness+"")&&Mt(D,$),mt[0]&131200){Ee=Nn(lt[7]);let dt;for(dt=0;dt<Ee.length;dt+=1){const Xe=Py(lt,Ee,dt);De[dt]?De[dt].p(Xe,mt):(De[dt]=jy(Xe),De[dt].c(),De[dt].m(ee,null))}for(;dt<De.length;dt+=1)De[dt].d(1);De.length=Ee.length}if(mt[0]&131200){Ct=Nn(lt[7]);let dt;for(dt=0;dt<Ct.length;dt+=1){const Xe=Ay(lt,Ct,dt);it[dt]?it[dt].p(Xe,mt):(it[dt]=Uy(Xe),it[dt].c(),it[dt].m(ve,null))}for(;dt<it.length;dt+=1)it[dt].d(1);it.length=Ct.length}},d(lt){lt&&V(e),pi(De,lt),pi(it,lt)}}}function vM(r){let e,t;return e=new hi({props:{openOn:"click",$$slots:{default:[bM,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function wM(r){let e,t;const n=[gn("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":Vy(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[vM]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a=c[0]&112?Vn(n,[n[0],n[1],c[0]&80&&{paint:{"line-color":o[6],"line-width":Vy(["get",o[4]])}},c[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};c[0]&16|c[1]&2&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function xM(r){let e,t,n,i,o;function c(d){r[15](d)}let a={label:"Route network",$$slots:{legend:[yM],help:[_M]},$$scope:{ctx:r}};return r[5]!==void 0&&(a.show=r[5]),e=new es({props:a}),hn.push(()=>An(e,"show",c)),i=new Eh({props:{url:`pmtiles://${zo("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[wM]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),n=ie(),he(i.$$.fragment)},m(d,p){le(e,d,p),q(d,n,p),le(i,d,p),o=!0},p(d,p){const _={};p[0]&15|p[1]&2&&(_.$$scope={dirty:p,ctx:d}),!t&&p[0]&32&&(t=!0,_.show=d[5],In(()=>t=!1)),e.$set(_);const y={};p[0]&112|p[1]&2&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){Z(e.$$.fragment,d),Z(i.$$.fragment,d),o=!1},d(d){d&&V(n),ce(e,d),ce(i,d)}}}function Vy(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function kM(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function SM(r,e,t){let n,i,o=!1,c="all",a="bicycle_go_dutch",d="fastest",p="flow",_=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],y=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],w=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],T=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],M={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function $(){c=Sa(this),t(0,c),t(7,_)}function D(){a=Sa(this),t(1,a),t(8,y)}function z(){d=Sa(this),t(2,d),t(9,w)}function I(){p=Sa(this),t(3,p),t(10,T)}function F(N){o=N,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${c}_${d}_${a}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:kM(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:lo(["abs",["get","gradient"]],M.limits,M.colorScale)}[p])},[c,a,d,p,n,o,i,_,y,w,T,$,D,z,I,F]}class CM extends Et{constructor(e){super(),Lt(this,e,SM,xM,wt,{},null,[-1,-1])}}function TM(r){let e;return{c(){e=U("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data  Crown copyright and database right 2025.</p>`,fe(e,"slot","help")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function MM(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe,J;return N=new Jm({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=U("div"),t=U("fieldset"),n=U("label"),i=U("input"),o=xe(`
        Pedestrians`),c=ie(),a=U("label"),d=U("input"),p=xe(`
        Cyclists`),_=ie(),y=U("fieldset"),w=U("label"),T=xe(`From
        `),M=U("input"),$=ie(),D=U("label"),z=xe(`To
        `),I=U("input"),F=ie(),he(N.$$.fragment),fe(i,"type","checkbox"),fe(i,"class","svelte-rvrx5w"),fe(d,"type","checkbox"),fe(d,"class","svelte-rvrx5w"),st(t,"display","flex"),st(t,"gap","3em"),fe(t,"class","svelte-rvrx5w"),fe(M,"type","number"),fe(M,"min",2017),fe(M,"max",2023),fe(M,"class","svelte-rvrx5w"),fe(I,"type","number"),fe(I,"min",2017),fe(I,"max",2023),fe(I,"class","svelte-rvrx5w"),fe(y,"class","year-filter svelte-rvrx5w"),fe(e,"slot","legend")},m(ee,pe){q(ee,e,pe),R(e,t),R(t,n),R(n,i),i.checked=r[1].pedestrians,R(n,o),R(t,c),R(t,a),R(a,d),d.checked=r[1].cyclists,R(a,p),R(e,_),R(e,y),R(y,w),R(w,T),R(w,M),Wn(M,r[1].minYear),R(y,$),R(y,D),R(D,z),R(D,I),Wn(I,r[1].maxYear),R(e,F),le(N,e,null),W=!0,oe||(J=[xt(i,"change",r[7]),xt(d,"change",r[8]),xt(M,"input",r[9]),xt(I,"input",r[10])],oe=!0)},p(ee,pe){pe&2&&(i.checked=ee[1].pedestrians),pe&2&&(d.checked=ee[1].cyclists),pe&2&&ml(M.value)!==ee[1].minYear&&Wn(M,ee[1].minYear),pe&2&&ml(I.value)!==ee[1].maxYear&&Wn(I,ee[1].maxYear)},i(ee){W||(j(N.$$.fragment,ee),W=!0)},o(ee){Z(N.$$.fragment,ee),W=!1},d(ee){ee&&V(e),ce(N),oe=!1,mr(J)}}}function qy(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=U("p"),t=xe("Pedestrian location: "),n=U("b"),o=xe(i)},m(c,a){q(c,e,a),R(e,t),R(e,n),R(n,o)},p(c,a){a&4096&&i!==(i=c[3][c[12].pedestrian_location]+"")&&Mt(o,i)},d(c){c&&V(e)}}}function Zy(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=U("p"),t=xe("Pedestrian movement: "),n=U("b"),o=xe(i)},m(c,a){q(c,e,a),R(e,t),R(e,n),R(n,o)},p(c,a){a&4096&&i!==(i=c[4][c[12].pedestrian_movement]+"")&&Mt(o,i)},d(c){c&&V(e)}}}function LM(r){let e,t,n,i=r[12].year+"",o,c,a,d,p,_=r[5][r[12].severity]+"",y,w,T,M,$,D=Gy(r[12])+"",z,I,F,N,W,oe=r[12].pedestrian_location&&qy(r),J=r[12].pedestrian_movement&&Zy(r);return{c(){e=U("p"),t=xe("Year: "),n=U("b"),o=xe(i),c=ie(),a=U("p"),d=xe("Severity: "),p=U("b"),y=xe(_),w=ie(),T=U("p"),M=xe("Casualties: "),$=U("b"),z=xe(D),I=ie(),oe&&oe.c(),F=ie(),J&&J.c(),N=ie(),W=U("p"),W.textContent="Click to open full report in CycleStreets"},m(ee,pe){q(ee,e,pe),R(e,t),R(e,n),R(n,o),q(ee,c,pe),q(ee,a,pe),R(a,d),R(a,p),R(p,y),q(ee,w,pe),q(ee,T,pe),R(T,M),R(T,$),R($,z),q(ee,I,pe),oe&&oe.m(ee,pe),q(ee,F,pe),J&&J.m(ee,pe),q(ee,N,pe),q(ee,W,pe)},p(ee,pe){pe&4096&&i!==(i=ee[12].year+"")&&Mt(o,i),pe&4096&&_!==(_=ee[5][ee[12].severity]+"")&&Mt(y,_),pe&4096&&D!==(D=Gy(ee[12])+"")&&Mt(z,D),ee[12].pedestrian_location?oe?oe.p(ee,pe):(oe=qy(ee),oe.c(),oe.m(F.parentNode,F)):oe&&(oe.d(1),oe=null),ee[12].pedestrian_movement?J?J.p(ee,pe):(J=Zy(ee),J.c(),J.m(N.parentNode,N)):J&&(J.d(1),J=null)},d(ee){ee&&(V(e),V(c),V(a),V(w),V(T),V(I),V(F),V(N),V(W)),oe&&oe.d(ee),J&&J.d(ee)}}}function EM(r){let e,t;return e=new hi({props:{$$slots:{default:[LM,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function IM(r){let e,t;const n=[gn("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":lo(["get","severity"],[1,2,3],[km,Sm,Cm]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[EM]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new wl({props:i}),e.$on("click",PM),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a=c&7?Vn(n,[n[0],n[1],c&0&&{paint:{"circle-color":lo(["get","severity"],[1,2,3],[km,Sm,Cm]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},c&6&&{filter:o[2](o[1])},c&1&&{layout:{visibility:o[0]?"visible":"none"}},n[5]]):{};c&8192&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function AM(r){let e,t,n,i,o;function c(d){r[11](d)}let a={label:"Collisions",$$slots:{legend:[MM],help:[TM]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new es({props:a}),hn.push(()=>An(e,"show",c)),i=new Eh({props:{url:`pmtiles://${zo("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[IM]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),n=ie(),he(i.$$.fragment)},m(d,p){le(e,d,p),q(d,n,p),le(i,d,p),o=!0},p(d,[p]){const _={};p&8194&&(_.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,_.show=d[0],In(()=>t=!1)),e.$set(_);const y={};p&8195&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){o||(j(e.$$.fragment,d),j(i.$$.fragment,d),o=!0)},o(d){Z(e.$$.fragment,d),Z(i.$$.fragment,d),o=!1},d(d){d&&V(n),ce(e,d),ce(i,d)}}}let km="#080C54",Sm="#1F9EB7",Cm="#CDE594";function Gy(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function PM(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function zM(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o($){let D=["any"];return i.pedestrians&&D.push(["get","pedestrian"]),i.cyclists&&D.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],D]}let c={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},a={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},d={1:"Fatal",2:"Serious",3:"Slight"},p={Slight:Cm,Serious:Sm,Fatal:km};function _(){i.pedestrians=this.checked,t(1,i)}function y(){i.cyclists=this.checked,t(1,i)}function w(){i.minYear=ml(this.value),t(1,i)}function T(){i.maxYear=ml(this.value),t(1,i)}function M($){n=$,t(0,n)}return[n,i,o,c,a,d,p,_,y,w,T,M]}class DM extends Et{constructor(e){super(),Lt(this,e,zM,AM,wt,{})}}function Hy(r){let e;return{c(){e=xe("Layers")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function Wy(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M;return e=new ZT({}),n=new lM({}),o=new gM({}),a=new $S({}),p=new FT({}),y=new CM({}),T=new DM({}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment),d=ie(),he(p.$$.fragment),_=ie(),he(y.$$.fragment),w=ie(),he(T.$$.fragment)},m($,D){le(e,$,D),q($,t,D),le(n,$,D),q($,i,D),le(o,$,D),q($,c,D),le(a,$,D),q($,d,D),le(p,$,D),q($,_,D),le(y,$,D),q($,w,D),le(T,$,D),M=!0},i($){M||(j(e.$$.fragment,$),j(n.$$.fragment,$),j(o.$$.fragment,$),j(a.$$.fragment,$),j(p.$$.fragment,$),j(y.$$.fragment,$),j(T.$$.fragment,$),M=!0)},o($){Z(e.$$.fragment,$),Z(n.$$.fragment,$),Z(o.$$.fragment,$),Z(a.$$.fragment,$),Z(p.$$.fragment,$),Z(y.$$.fragment,$),Z(T.$$.fragment,$),M=!1},d($){$&&(V(t),V(i),V(c),V(d),V(_),V(w)),ce(e,$),ce(n,$),ce(o,$),ce(a,$),ce(p,$),ce(y,$),ce(T,$)}}}function $M(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M;i=new Dk({props:{color:"#333"}});let $=r[0]&&Hy();function D(F){r[4](F)}let z={label:"Existing modal filters and turn restrictions"};r[1]!==void 0&&(z.show=r[1]),p=new es({props:z}),hn.push(()=>An(p,"show",D));let I=r[2]=="cnt"&&Wy();return{c(){e=U("div"),t=U("button"),n=U("div"),he(i.$$.fragment),o=ie(),$&&$.c(),a=ie(),d=U("div"),he(p.$$.fragment),y=ie(),I&&I.c(),st(n,"display","flex"),st(n,"gap","12px"),st(n,"color","#333"),st(n,"align-items","center"),st(n,"justify-content","center"),fe(t,"class",c="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-8cnrrn"),fe(t,"aria-label","Layers"),st(d,"flex-direction","column"),st(d,"display",r[0]?"flex":"none"),st(d,"background-color","#515f7A"),fe(e,"class","pico contextual-layers svelte-8cnrrn"),st(e,"display","flex"),st(e,"flex-direction","column"),st(e,"max-height","80vh"),st(e,"overflow","auto"),st(e,"border-radius","5px"),st(e,"width",r[0]?"300px":"auto")},m(F,N){q(F,e,N),R(e,t),R(t,n),le(i,n,null),R(n,o),$&&$.m(n,null),R(e,a),R(e,d),le(p,d,null),R(d,y),I&&I.m(d,null),w=!0,T||(M=xt(t,"click",r[3]),T=!0)},p(F,N){F[0]?$||($=Hy(),$.c(),$.m(n,null)):$&&($.d(1),$=null),(!w||N&1&&c!==(c="show-layers-button icon-btn "+(F[0]?"expanded":"")+" svelte-8cnrrn"))&&fe(t,"class",c);const W={};!_&&N&2&&(_=!0,W.show=F[1],In(()=>_=!1)),p.$set(W),F[2]=="cnt"?I?N&4&&j(I,1):(I=Wy(),I.c(),j(I,1),I.m(d,null)):I&&(tn(),Z(I,1,1,()=>{I=null}),nn()),N&1&&st(d,"display",F[0]?"flex":"none"),N&1&&st(e,"width",F[0]?"300px":"auto")},i(F){w||(j(i.$$.fragment,F),j(p.$$.fragment,F),j(I),w=!0)},o(F){Z(i.$$.fragment,F),Z(p.$$.fragment,F),Z(I),w=!1},d(F){F&&V(e),ce(i),$&&$.d(),ce(p),I&&I.d(),T=!1,M()}}}function RM(r){let e,t;return e=new v3({props:{defaultStyling:!0,$$slots:{default:[$M]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&39&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function FM(r,e,t){let n,i;at(r,ud,d=>t(1,n=d)),at(r,Fo,d=>t(2,i=d));let o=!1;const c=()=>t(0,o=!o);function a(d){n=d,ud.set(n)}return[o,n,i,c,a]}class BM extends Et{constructor(e){super(),Lt(this,e,FM,RM,wt,{})}}let We;const zv=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&zv.decode();let Yu=null;function $c(){return(Yu===null||Yu.byteLength===0)&&(Yu=new Uint8Array(We.memory.buffer)),Yu}function Rr(r,e){return r=r>>>0,zv.decode($c().subarray(r,r+e))}const Gs=new Array(128).fill(void 0);Gs.push(void 0,null,!0,!1);let hh=Gs.length;function lr(r){hh===Gs.length&&Gs.push(Gs.length+1);const e=hh;return hh=Gs[e],Gs[e]=r,e}function En(r){return Gs[r]}function OM(r){r<132||(Gs[r]=hh,hh=r)}function nr(r){const e=En(r);return OM(r),e}let bi=0;const rd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},NM=typeof rd.encodeInto=="function"?function(r,e){return rd.encodeInto(r,e)}:function(r,e){const t=rd.encode(r);return e.set(t),{read:r.length,written:t.length}};function Io(r,e,t){if(t===void 0){const a=rd.encode(r),d=e(a.length,1)>>>0;return $c().subarray(d,d+a.length).set(a),bi=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=$c();let c=0;for(;c<n;c++){const a=r.charCodeAt(c);if(a>127)break;o[i+c]=a}if(c!==n){c!==0&&(r=r.slice(c)),i=t(i,n,n=c+r.length*3,1)>>>0;const a=$c().subarray(i+c,i+n),d=NM(r,a);c+=d.written}return bi=c,i}function Ic(r){return r==null}let Qu=null;function gt(){return(Qu===null||Qu.byteLength===0)&&(Qu=new Int32Array(We.memory.buffer)),Qu}let eh=null;function Dv(){return(eh===null||eh.byteLength===0)&&(eh=new Float64Array(We.memory.buffer)),eh}let th=null;function jM(){return(th===null||th.byteLength===0)&&(th=new BigInt64Array(We.memory.buffer)),th}function Tm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Tm(r[0]));for(let c=1;c<i;c++)o+=", "+Tm(r[c]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function Jp(r,e){const t=e(r.length*1,1)>>>0;return $c().set(r,t/1),bi=r.length,t}function UM(r,e){return r=r>>>0,Dv().subarray(r/8,r/8+e)}function VM(r,e){return r=r>>>0,$c().subarray(r/1,r/1+e)}function fl(r,e){try{return r.apply(this,e)}catch(t){We.__wbindgen_exn_store(lr(t))}}class qM{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();We.__wbg_ltn_free(e)}constructor(e,t,n,i,o,c,a,d){try{const M=We.__wbindgen_add_to_stack_pointer(-16),$=Jp(e,We.__wbindgen_malloc),D=bi,z=Jp(t,We.__wbindgen_malloc),I=bi,F=Jp(n,We.__wbindgen_malloc),N=bi,W=Io(o,We.__wbindgen_malloc,We.__wbindgen_realloc),oe=bi;var p=Ic(c)?0:Io(c,We.__wbindgen_malloc,We.__wbindgen_realloc),_=bi;const J=Io(a,We.__wbindgen_malloc,We.__wbindgen_realloc),ee=bi;We.ltn_new(M,$,D,z,I,F,N,lr(i),W,oe,p,_,J,ee,d);var y=gt()[M/4+0],w=gt()[M/4+1],T=gt()[M/4+2];if(T)throw nr(w);return this.__wbg_ptr=y>>>0,this}finally{We.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getInvertedBoundary(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getBounds(){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getBounds(i,this.__wbg_ptr);var e=gt()[i/4+0],t=gt()[i/4+1],n=UM(e,t).slice();return We.__wbindgen_free(e,t*8,8),n}finally{We.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toRouteSnapper(i,this.__wbg_ptr);var e=gt()[i/4+0],t=gt()[i/4+1],n=VM(e,t).slice();return We.__wbindgen_free(e,t*1,1),n}finally{We.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toRouteSnapperGj(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_renderModalFilters(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_renderTurnRestrictions(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_renderNeighbourhood(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_generatedBoundaries(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const _=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_generateMergedBoundary(_,this.__wbg_ptr,lr(e));var i=gt()[_/4+0],o=gt()[_/4+1],c=gt()[_/4+2],a=gt()[_/4+3],d=i,p=o;if(a)throw d=0,p=0,nr(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}setNeighbourhoodBoundary(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16),c=Io(e,We.__wbindgen_malloc,We.__wbindgen_realloc),a=bi;We.ltn_setNeighbourhoodBoundary(o,this.__wbg_ptr,c,a,lr(t));var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw nr(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Io(e,We.__wbindgen_malloc,We.__wbindgen_realloc),n=bi;We.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Io(e,We.__wbindgen_malloc,We.__wbindgen_realloc),i=bi,o=Io(t,We.__wbindgen_malloc,We.__wbindgen_realloc),c=bi;We.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,c)}setCurrentNeighbourhood(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16),o=Io(e,We.__wbindgen_malloc,We.__wbindgen_realloc),c=bi;We.ltn_setCurrentNeighbourhood(i,this.__wbg_ptr,o,c);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw nr(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16),c=Io(t,We.__wbindgen_malloc,We.__wbindgen_realloc),a=bi;We.ltn_addModalFilter(o,this.__wbg_ptr,lr(e),c,a);var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw nr(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16),c=Io(t,We.__wbindgen_malloc,We.__wbindgen_realloc),a=bi;We.ltn_addManyModalFilters(o,this.__wbg_ptr,lr(e),c,a);var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw nr(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){We.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_addDiagonalFilter(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw nr(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_rotateDiagonalFilter(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw nr(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_deleteDiagonalFilter(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw nr(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}addTurnRestriction(e,t){try{const o=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_addTurnRestriction(o,this.__wbg_ptr,e,t);var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw nr(n)}finally{We.__wbindgen_add_to_stack_pointer(16)}}deleteTurnRestriction(e,t,n){try{const c=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_deleteTurnRestriction(c,this.__wbg_ptr,e,t,n);var i=gt()[c/4+0],o=gt()[c/4+1];if(o)throw nr(i)}finally{We.__wbindgen_add_to_stack_pointer(16)}}getTurnRestrictionTargets(e){let t,n;try{const _=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getTurnRestrictionTargets(_,this.__wbg_ptr,e);var i=gt()[_/4+0],o=gt()[_/4+1],c=gt()[_/4+2],a=gt()[_/4+3],d=i,p=o;if(a)throw d=0,p=0,nr(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){We.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toggleMainRoad(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw nr(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}undo(){We.ltn_undo(this.__wbg_ptr)}redo(){We.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,n;try{const _=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getShortcutsCrossingRoad(_,this.__wbg_ptr,e);var i=gt()[_/4+0],o=gt()[_/4+1],c=gt()[_/4+2],a=gt()[_/4+3],d=i,p=o;if(a)throw d=0,p=0,nr(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getAllShortcuts(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_toSavefile(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const i=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_loadSavefile(i,this.__wbg_ptr,lr(e));var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw nr(t)}finally{We.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,i,o){let c,a;try{const M=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_compareRoute(M,this.__wbg_ptr,e,t,n,i,o);var d=gt()[M/4+0],p=gt()[M/4+1],_=gt()[M/4+2],y=gt()[M/4+3],w=d,T=p;if(y)throw w=0,T=0,nr(_);return c=w,a=T,Rr(w,T)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(c,a,1)}}impactToOneDestination(e,t){let n,i;try{const y=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_impactToOneDestination(y,this.__wbg_ptr,e,t);var o=gt()[y/4+0],c=gt()[y/4+1],a=gt()[y/4+2],d=gt()[y/4+3],p=o,_=c;if(d)throw p=0,_=0,nr(a);return n=p,i=_,Rr(p,_)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const _=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_predictImpact(_,this.__wbg_ptr,e);var i=gt()[_/4+0],o=gt()[_/4+1],c=gt()[_/4+2],a=gt()[_/4+3],d=i,p=o;if(a)throw d=0,p=0,nr(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const y=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getImpactsOnRoad(y,this.__wbg_ptr,e,t);var o=gt()[y/4+0],c=gt()[y/4+1],a=gt()[y/4+2],d=gt()[y/4+3],p=o,_=c;if(d)throw p=0,_=0,nr(a);return n=p,i=_,Rr(p,_)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(n,i,1)}}getAllNeighbourhoods(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getAllNeighbourhoods(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getAllIntersections(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const _=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getMovements(_,this.__wbg_ptr,e);var i=gt()[_/4+0],o=gt()[_/4+1],c=gt()[_/4+2],a=gt()[_/4+3],d=i,p=o;if(a)throw d=0,p=0,nr(c);return t=d,n=p,Rr(d,p)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getDemandModel(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const p=We.__wbindgen_add_to_stack_pointer(-16);We.ltn_getPOIs(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],c=gt()[p/4+3],a=n,d=i;if(c)throw a=0,d=0,nr(o);return e=a,t=d,Rr(a,d)}finally{We.__wbindgen_add_to_stack_pointer(16),We.__wbindgen_free(e,t,1)}}}async function ZM(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function GM(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Rr(e,t));return lr(n)},r.wbg.__wbindgen_object_drop_ref=function(e){nr(e)},r.wbg.__wbindgen_string_get=function(e,t){const n=En(t),i=typeof n=="string"?n:void 0;var o=Ic(i)?0:Io(i,We.__wbindgen_malloc,We.__wbindgen_realloc),c=bi;gt()[e/4+1]=c,gt()[e/4+0]=o},r.wbg.__wbindgen_boolean_get=function(e){const t=En(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof En(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=En(t),i=typeof n=="number"?n:void 0;Dv()[e/8+1]=Ic(i)?0:i,gt()[e/4+0]=!Ic(i)},r.wbg.__wbindgen_is_object=function(e){const t=En(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return En(e)in En(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return lr(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return En(e)===En(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return lr(t)},r.wbg.__wbindgen_is_undefined=function(e){return En(e)===void 0},r.wbg.__wbindgen_string_new=function(e,t){const n=Rr(e,t);return lr(n)},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return En(e)==En(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=En(e);return lr(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=En(e)[En(t)];return lr(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(En(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(En(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(En(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(En(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(En(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return lr(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=En(t).stack,i=Io(n,We.__wbindgen_malloc,We.__wbindgen_realloc),o=bi;gt()[e/4+1]=o,gt()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Rr(e,t))}finally{We.__wbindgen_free(n,i,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=En(e).performance;return lr(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return En(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=En(e)[t>>>0];return lr(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return En(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof En(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Rr(e,t));return lr(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=En(e).next;return lr(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return fl(function(e){const t=En(e).next();return lr(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return En(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=En(e).value;return lr(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return lr(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return fl(function(e,t){const n=Reflect.get(En(e),En(t));return lr(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return fl(function(e,t){const n=En(e).call(En(t));return lr(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return fl(function(){const e=self.self;return lr(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return fl(function(){const e=window.window;return lr(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return fl(function(){const e=globalThis.globalThis;return lr(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return fl(function(){const e=global.global;return lr(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(En(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=En(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(En(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(En(e));return lr(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=En(e).buffer;return lr(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(En(e));return lr(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){En(e).set(En(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return En(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=En(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=En(t),i=typeof n=="bigint"?n:void 0;jM()[e/8+1]=Ic(i)?BigInt(0):i,gt()[e/4+0]=!Ic(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=Tm(En(t)),i=Io(n,We.__wbindgen_malloc,We.__wbindgen_realloc),o=bi;gt()[e/4+1]=o,gt()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Rr(e,t))},r.wbg.__wbindgen_memory=function(){const e=We.memory;return lr(e)},r}function HM(r,e){return We=r.exports,$v.__wbindgen_wasm_module=e,th=null,eh=null,Qu=null,Yu=null,We}async function $v(r){if(We!==void 0)return We;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=GM();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await ZM(await r,e);return HM(t,n)}const WM=r=>({}),Ky=r=>({}),KM=r=>({}),Xy=r=>({}),XM=r=>({}),Jy=r=>({});function JM(r){let e,t,n,i,o,c,a,d;const p=r[1].top,_=Cn(p,r,r[0],Jy),y=r[1].left,w=Cn(y,r,r[0],Xy),T=r[1].main,M=Cn(T,r,r[0],Ky);return{c(){e=U("div"),t=U("div"),_&&_.c(),n=ie(),i=U("div"),o=U("div"),w&&w.c(),c=ie(),a=U("div"),M&&M.c(),fe(t,"class","top svelte-29q570"),fe(o,"class","left svelte-29q570"),fe(a,"class","main svelte-29q570"),fe(i,"class","content svelte-29q570"),fe(e,"class","flex-container svelte-29q570")},m($,D){q($,e,D),R(e,t),_&&_.m(t,null),R(e,n),R(e,i),R(i,o),w&&w.m(o,null),R(i,c),R(i,a),M&&M.m(a,null),d=!0},p($,[D]){_&&_.p&&(!d||D&1)&&Mn(_,p,$,$[0],d?Tn(p,$[0],D,XM):Ln($[0]),Jy),w&&w.p&&(!d||D&1)&&Mn(w,y,$,$[0],d?Tn(y,$[0],D,KM):Ln($[0]),Xy),M&&M.p&&(!d||D&1)&&Mn(M,T,$,$[0],d?Tn(T,$[0],D,WM):Ln($[0]),Ky)},i($){d||(j(_,$),j(w,$),j(M,$),d=!0)},o($){Z(_,$),Z(w,$),Z(M,$),d=!1},d($){$&&V(e),_&&_.d($),w&&w.d($),M&&M.d($)}}}function YM(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class QM extends Et{constructor(e){super(),Lt(this,e,YM,JM,wt,{})}}const e6=r=>({}),Yy=r=>({}),t6=r=>({}),Qy=r=>({}),n6=r=>({}),e1=r=>({});function r6(r){let e,t,n,i,o,c;const a=r[4].top,d=Cn(a,r,r[3],e1),p=r[4].sidebar,_=Cn(p,r,r[3],Qy),y=r[4].map,w=Cn(y,r,r[3],Yy);return{c(){e=U("div"),d&&d.c(),t=ie(),n=U("div"),_&&_.c(),i=ie(),o=U("div"),w&&w.c()},m(T,M){q(T,e,M),d&&d.m(e,null),r[5](e),q(T,t,M),q(T,n,M),_&&_.m(n,null),r[6](n),q(T,i,M),q(T,o,M),w&&w.m(o,null),r[7](o),c=!0},p(T,[M]){d&&d.p&&(!c||M&8)&&Mn(d,a,T,T[3],c?Tn(a,T[3],M,n6):Ln(T[3]),e1),_&&_.p&&(!c||M&8)&&Mn(_,p,T,T[3],c?Tn(p,T[3],M,t6):Ln(T[3]),Qy),w&&w.p&&(!c||M&8)&&Mn(w,y,T,T[3],c?Tn(y,T[3],M,e6):Ln(T[3]),Yy)},i(T){c||(j(d,T),j(_,T),j(w,T),c=!0)},o(T){Z(d,T),Z(_,T),Z(w,T),c=!1},d(T){T&&(V(e),V(t),V(n),V(i),V(o)),d&&d.d(T),r[5](null),_&&_.d(T),r[6](null),w&&w.d(T),r[7](null)}}}function i6(r,e,t){let n,i,o;at(r,Mm,y=>t(0,n=y)),at(r,Lm,y=>t(1,i=y)),at(r,Em,y=>t(2,o=y));let{$$slots:c={},$$scope:a}=e;function d(y){hn[y?"unshift":"push"](()=>{n=y,Mm.set(n)})}function p(y){hn[y?"unshift":"push"](()=>{i=y,Lm.set(i)})}function _(y){hn[y?"unshift":"push"](()=>{o=y,Em.set(o)})}return r.$$set=y=>{"$$scope"in y&&t(3,a=y.$$scope)},[n,i,o,a,c,d,p,_]}class bo extends Et{constructor(e){super(),Lt(this,e,i6,r6,wt,{})}}let Mm=$n(null),Lm=$n(null),Em=$n(null);const o6="/ltn/assets/streets-v2-style-b76f3b8b.json";function s6(r){let e;return{c(){e=xe("Back")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function a6(r){let e,t,n,i;return e=new On({props:{$$slots:{default:[s6]},$$scope:{ctx:r}}}),e.$on("click",r[2]),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0,n||(i=xt(window,"keydown",r[1]),n=!0)},p(o,[c]){const a={};c&8&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o),n=!1,i()}}}function l6(r){let e=ms();function t(i){i.key=="Escape"&&(i.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class na extends Et{constructor(e){super(),Lt(this,e,l6,a6,wt,{})}}let gd=$n(null);function t1(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function n1(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function c6(r){let e,t=r[6].length+"",n,i;return{c(){e=xe("Undo ("),n=xe(t),i=xe(")")},m(o,c){q(o,e,c),q(o,n,c),q(o,i,c)},p(o,c){c[0]&64&&t!==(t=o[6].length+"")&&Mt(n,t)},d(o){o&&(V(e),V(n),V(i))}}}function u6(r){let e;return{c(){e=xe("Undo")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function h6(r){let e;return{c(){e=U("span"),fe(e,"class","dot svelte-11yzwwb"),en(e,"snapped-node",r[40].snapped),en(e,"free-node",!r[40].snapped),en(e,"hide",r[4])},m(t,n){q(t,e,n)},p(t,n){n[0]&128&&en(e,"snapped-node",t[40].snapped),n[0]&128&&en(e,"free-node",!t[40].snapped),n[0]&16&&en(e,"hide",t[4])},d(t){t&&V(e)}}}function r1(r){let e,t,n;function i(p){r[23](p,r[40])}function o(){return r[24](r[40])}function c(){return r[25](r[40])}function a(){return r[26](r[40])}let d={draggable:!0,zIndex:0,$$slots:{default:[h6]},$$scope:{ctx:r}};return r[40].point!==void 0&&(d.lngLat=r[40].point),e=new xd({props:d}),hn.push(()=>An(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",c),e.$on("dragend",r[16]),e.$on("click",a),{c(){he(e.$$.fragment)},m(p,_){le(e,p,_),n=!0},p(p,_){r=p;const y={};_[0]&144|_[1]&4096&&(y.$$scope={dirty:_,ctx:r}),!t&&_[0]&128&&(t=!0,y.lngLat=r[40].point,In(()=>t=!1)),e.$set(y)},i(p){n||(j(e.$$.fragment,p),n=!0)},o(p){Z(e.$$.fragment,p),n=!1},d(p){ce(e,p)}}}function f6(r){let e;return{c(){e=U("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,st(e,"padding-right","0"),st(e,"padding-left","20px"),st(e,"margin","0")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function d6(r){let e,t,n,i;return n=new Wb({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[f6]},$$scope:{ctx:r}}}),{c(){e=U("span"),e.textContent=`${r[39]+1}`,t=ie(),he(n.$$.fragment),fe(e,"class","dot svelte-11yzwwb"),en(e,"snapped",r[37].snapped)},m(o,c){q(o,e,c),q(o,t,c),le(n,o,c),i=!0},p(o,c){(!i||c[0]&1)&&en(e,"snapped",o[37].snapped);const a={};c[1]&4096&&(a.$$scope={dirty:c,ctx:o}),n.$set(a)},i(o){i||(j(n.$$.fragment,o),i=!0)},o(o){Z(n.$$.fragment,o),i=!1},d(o){o&&(V(e),V(t)),ce(n,o)}}}function i1(r){let e,t,n;function i(d){r[27](d,r[37])}function o(){return r[28](r[39])}function c(){return r[29](r[39])}let a={draggable:!0,zIndex:1,$$slots:{default:[d6]},$$scope:{ctx:r}};return r[37].point!==void 0&&(a.lngLat=r[37].point),e=new xd({props:a}),hn.push(()=>An(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",c),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){he(e.$$.fragment)},m(d,p){le(e,d,p),n=!0},p(d,p){r=d;const _={};p[0]&1|p[1]&4096&&(_.$$scope={dirty:p,ctx:r}),!t&&p[0]&1&&(t=!0,_.lngLat=r[37].point,In(()=>t=!1)),e.$set(_)},i(d){n||(j(e.$$.fragment,d),n=!0)},o(d){Z(e.$$.fragment,d),n=!1},d(d){ce(e,d)}}}function p6(r){let e,t,n,i;const o=[gn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let c={};for(let p=0;p<o.length;p+=1)c=Ot(c,o[p]);e=new rr({props:c});const a=[gn("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let p=0;p<a.length;p+=1)d=Ot(d,a[p]);return n=new zi({props:d}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),i=!0},p(p,_){const y={};e.$set(y);const w={};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),ce(e,p),ce(n,p)}}}function m6(r){let e,t;const n=[gn("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function g6(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe;function J(Ge,Ee){return Ge[6].length==0?u6:c6}let ee=J(r),pe=ee(r);w=new Hm({}),w.$on("click",r[10]),w.$on("mousemove",r[11]);let Ie=Nn(r[7]),Q=[];for(let Ge=0;Ge<Ie.length;Ge+=1)Q[Ge]=r1(n1(r,Ie,Ge));const ae=Ge=>Z(Q[Ge],1,1,()=>{Q[Ge]=null});let Pe=Nn(r[0]),ve=[];for(let Ge=0;Ge<Pe.length;Ge+=1)ve[Ge]=i1(t1(r,Pe,Ge));const nt=Ge=>Z(ve[Ge],1,1,()=>{ve[Ge]=null});return D=new pr({props:{data:r[1]||Wi(),generateId:!0,$$slots:{default:[p6]},$$scope:{ctx:r}}}),I=new pr({props:{data:r[8],$$slots:{default:[m6]},$$scope:{ctx:r}}}),N=Dm(r[22][0]),{c(){e=U("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=ie(),n=U("div"),i=U("label"),o=U("input"),a=xe(`
    Snap boundary to roads`),d=ie(),p=U("button"),pe.c(),y=ie(),he(w.$$.fragment),T=ie();for(let Ge=0;Ge<Q.length;Ge+=1)Q[Ge].c();M=ie();for(let Ge=0;Ge<ve.length;Ge+=1)ve[Ge].c();$=ie(),he(D.$$.fragment),z=ie(),he(I.$$.fragment),o.disabled=c=r[0].length>=3,fe(o,"type","checkbox"),o.__value="snap",Wn(o,o.__value),fe(p,"class","secondary"),p.disabled=_=r[6].length==0,st(n,"display","flex"),st(n,"gap","16px"),N.p(o)},m(Ge,Ee){q(Ge,e,Ee),q(Ge,t,Ee),q(Ge,n,Ee),R(n,i),R(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),R(i,a),R(n,d),R(n,p),pe.m(p,null),q(Ge,y,Ee),le(w,Ge,Ee),q(Ge,T,Ee);for(let De=0;De<Q.length;De+=1)Q[De]&&Q[De].m(Ge,Ee);q(Ge,M,Ee);for(let De=0;De<ve.length;De+=1)ve[De]&&ve[De].m(Ge,Ee);q(Ge,$,Ee),le(D,Ge,Ee),q(Ge,z,Ee),le(I,Ge,Ee),F=!0,W||(oe=[xt(o,"change",r[21]),xt(p,"click",r[9])],W=!0)},p(Ge,Ee){if((!F||Ee[0]&1&&c!==(c=Ge[0].length>=3))&&(o.disabled=c),Ee[0]&32&&(o.checked=~(Ge[5]||[]).indexOf(o.__value)),ee===(ee=J(Ge))&&pe?pe.p(Ge,Ee):(pe.d(1),pe=ee(Ge),pe&&(pe.c(),pe.m(p,null))),(!F||Ee[0]&64&&_!==(_=Ge[6].length==0))&&(p.disabled=_),Ee[0]&114832){Ie=Nn(Ge[7]);let it;for(it=0;it<Ie.length;it+=1){const lt=n1(Ge,Ie,it);Q[it]?(Q[it].p(lt,Ee),j(Q[it],1)):(Q[it]=r1(lt),Q[it].c(),j(Q[it],1),Q[it].m(M.parentNode,M))}for(tn(),it=Ie.length;it<Q.length;it+=1)ae(it);nn()}if(Ee[0]&143373){Pe=Nn(Ge[0]);let it;for(it=0;it<Pe.length;it+=1){const lt=t1(Ge,Pe,it);ve[it]?(ve[it].p(lt,Ee),j(ve[it],1)):(ve[it]=i1(lt),ve[it].c(),j(ve[it],1),ve[it].m($.parentNode,$))}for(tn(),it=Pe.length;it<ve.length;it+=1)nt(it);nn()}const De={};Ee[0]&2&&(De.data=Ge[1]||Wi()),Ee[1]&4096&&(De.$$scope={dirty:Ee,ctx:Ge}),D.$set(De);const Ct={};Ee[0]&256&&(Ct.data=Ge[8]),Ee[1]&4096&&(Ct.$$scope={dirty:Ee,ctx:Ge}),I.$set(Ct)},i(Ge){if(!F){j(w.$$.fragment,Ge);for(let Ee=0;Ee<Ie.length;Ee+=1)j(Q[Ee]);for(let Ee=0;Ee<Pe.length;Ee+=1)j(ve[Ee]);j(D.$$.fragment,Ge),j(I.$$.fragment,Ge),F=!0}},o(Ge){Z(w.$$.fragment,Ge),Q=Q.filter(Boolean);for(let Ee=0;Ee<Q.length;Ee+=1)Z(Q[Ee]);ve=ve.filter(Boolean);for(let Ee=0;Ee<ve.length;Ee+=1)Z(ve[Ee]);Z(D.$$.fragment,Ge),Z(I.$$.fragment,Ge),F=!1},d(Ge){Ge&&(V(e),V(t),V(n),V(y),V(T),V(M),V($),V(z)),pe.d(),ce(w,Ge),pi(Q,Ge),pi(ve,Ge),ce(D,Ge),ce(I,Ge),N.r(),W=!1,mr(oe)}}}function _6(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function y6(r,e,t){let n,i;at(r,gd,Xe=>t(20,i=Xe));let{map:o}=e,{waypoints:c}=e,{drawnShapeOut:a=void 0}=e;Yr(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let d="snap",p=[],_=[],y=null,w=!1,T=!1,M=!1;function $(Xe){let $t=Xe.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=$t}function D(){let Xe=p.pop();t(6,p),Xe&&t(0,c=Xe)}function z(){p.length==100&&p.shift(),t(6,p=[...p,JSON.parse(JSON.stringify(c))])}function I(Xe){c.length>=3||(z(),c.push({point:Xe.detail.lngLat.toArray(),snapped:d=="snap"}),t(0,c))}function F(Xe){t(19,y={point:Xe.detail.lngLat.toArray(),snapped:d=="snap"})}function N(Xe){z(),t(0,c[Xe].snapped=!c[Xe].snapped,c),t(0,c)}function W(Xe){z(),c.splice(Xe,1),t(0,c),t(2,w=!1)}function oe(Xe,$t,yt,Rt){if(Rt||$t.length>=3)return Wi();try{if(Xe&&$t.length>0&&yt)return JSON.parse(Xe.inner.calculateRoute([$t[$t.length-1],yt]))}catch{}return Wi()}function J(Xe,$t,yt){if(yt)return;if(!Xe||$t.length<3){t(7,_=[]);return}let Rt=[],It=1,Qt=JSON.parse(JSON.stringify($t));Qt.push(Qt[0]);for(let yn=0;yn<Qt.length-1;yn++){let ut=JSON.parse(Xe.inner.getExtraNodes(Qt[yn],Qt[yn+1]));for(let[Wt,Ze,Ve]of ut)Rt.push({point:[Wt,Ze],snapped:Ve,insertIdx:It});It++}t(7,_=Rt)}function ee(Xe){z(),c.splice(Xe.insertIdx,0,{point:Xe.point,snapped:Xe.snapped}),t(0,c),t(4,M=!0)}function pe(Xe){t(0,c[Xe.insertIdx].point=Xe.point,c),t(0,c)}function Ie(){t(4,M=!1)}function Q(){z(),t(3,T=!0)}const ae=[[]];function Pe(){d=G2(ae[0],this.__value,this.checked),t(5,d)}function ve(Xe,$t){r.$$.not_equal($t.point,Xe)&&($t.point=Xe,t(7,_))}const nt=Xe=>ee(Xe),Ge=Xe=>pe(Xe),Ee=Xe=>{ee(Xe),t(4,M=!1)};function De(Xe,$t){r.$$.not_equal($t.point,Xe)&&($t.point=Xe,t(0,c))}const Ct=Xe=>N(Xe),it=Xe=>W(Xe),lt=()=>t(2,w=!0),mt=()=>t(2,w=!1),dt=()=>t(3,T=!1);return r.$$set=Xe=>{"map"in Xe&&t(18,o=Xe.map),"waypoints"in Xe&&t(0,c=Xe.waypoints),"drawnShapeOut"in Xe&&t(1,a=Xe.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,a=_6(i,c))}catch(Xe){console.log("error drawing shape",Xe),t(1,a=void 0)}r.$$.dirty[0]&1048593&&J(i,c,M),r.$$.dirty[0]&1572877&&t(8,n=oe(i,c,y,w||T)),r.$$.dirty[0]&1&&$(c)},[c,a,w,T,M,d,p,_,n,D,I,F,N,W,ee,pe,Ie,Q,o,y,i,Pe,ae,ve,nt,Ge,Ee,De,Ct,it,lt,mt,dt]}class Rv extends Et{constructor(e){super(),Lt(this,e,y6,g6,wt,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function o1(r){let e,t,n,i,o=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",c,a,d,p,_,y,w,T=r[0].properties.simd.toFixed(1)+"",M,$,D,z,I,F,N,W=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",oe,J,ee,pe,Ie,Q,ae,Pe=Fc(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",ve,nt,Ge,Ee,De,Ct,it,lt=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",mt,dt;return{c(){e=U("tr"),t=U("th"),t.textContent="Population density",n=ie(),i=U("td"),c=xe(o),a=xe(" people / km"),d=ie(),p=U("tr"),_=U("th"),_.textContent="SIMD",y=ie(),w=U("td"),M=xe(T),$=xe("%"),D=ie(),z=U("tr"),I=U("th"),I.textContent="Collision density",F=ie(),N=U("td"),oe=xe(W),J=xe(" / km"),ee=ie(),pe=U("tr"),Ie=U("th"),Ie.textContent="Car ownership",Q=ie(),ae=U("td"),ve=xe(Pe),nt=xe(" of households"),Ge=ie(),Ee=U("tr"),De=U("th"),De.textContent="POI density",Ct=ie(),it=U("td"),mt=xe(lt),dt=xe(" / km")},m(Xe,$t){q(Xe,e,$t),R(e,t),R(e,n),R(e,i),R(i,c),R(i,a),q(Xe,d,$t),q(Xe,p,$t),R(p,_),R(p,y),R(p,w),R(w,M),R(w,$),q(Xe,D,$t),q(Xe,z,$t),R(z,I),R(z,F),R(z,N),R(N,oe),R(N,J),q(Xe,ee,$t),q(Xe,pe,$t),R(pe,Ie),R(pe,Q),R(pe,ae),R(ae,ve),R(ae,nt),q(Xe,Ge,$t),q(Xe,Ee,$t),R(Ee,De),R(Ee,Ct),R(Ee,it),R(it,mt),R(it,dt)},p(Xe,$t){$t&1&&o!==(o=Math.round(Xe[0].properties.population/Xe[0].properties.area_km2).toLocaleString()+"")&&Mt(c,o),$t&1&&T!==(T=Xe[0].properties.simd.toFixed(1)+"")&&Mt(M,T),$t&1&&W!==(W=(Xe[0].properties.number_stats19_collisions/Xe[0].properties.area_km2).toFixed(1)+"")&&Mt(oe,W),$t&1&&Pe!==(Pe=Fc(Xe[0].properties.households_with_cars_or_vans,Xe[0].properties.total_households)+"")&&Mt(ve,Pe),$t&1&&lt!==(lt=(Xe[0].properties.number_pois/Xe[0].properties.area_km2).toFixed(1)+"")&&Mt(mt,lt)},d(Xe){Xe&&(V(e),V(d),V(p),V(D),V(z),V(ee),V(pe),V(Ge),V(Ee))}}}function b6(r){let e,t,n,i,o,c=r[0].properties.area_km2.toFixed(1)+"",a,d,p,_=r[1]=="cnt"&&o1(r);return{c(){e=U("table"),t=U("tr"),n=U("th"),n.textContent="Area",i=ie(),o=U("td"),a=xe(c),d=xe(" km"),p=ie(),_&&_.c(),fe(e,"class","svelte-1kpsyee")},m(y,w){q(y,e,w),R(e,t),R(t,n),R(t,i),R(t,o),R(o,a),R(o,d),R(e,p),_&&_.m(e,null)},p(y,[w]){w&1&&c!==(c=y[0].properties.area_km2.toFixed(1)+"")&&Mt(a,c),y[1]=="cnt"?_?_.p(y,w):(_=o1(y),_.c(),_.m(e,null)):_&&(_.d(1),_=null)},i:tt,o:tt,d(y){y&&V(e),_&&_.d()}}}function v6(r,e,t){let n;at(r,Fo,o=>t(1,n=o));let{neighbourhoodBoundary:i}=e;return r.$$set=o=>{"neighbourhoodBoundary"in o&&t(0,i=o.neighbourhoodBoundary)},[i,n]}class Fv extends Et{constructor(e){super(),Lt(this,e,v6,b6,wt,{neighbourhoodBoundary:0})}}function Bv(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function w6(r){let e,t,n,i;return e=new Oo({props:{colorScale:dv,labels:{limits:fv}}}),{c(){he(e.$$.fragment),t=ie(),n=U("div"),n.textContent="POIs / km",st(n,"text-align","center")},m(o,c){le(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),ce(e,o)}}}function x6(r){let e,t,n,i;return e=new Oo({props:{colorScale:hv,labels:{limits:uv}}}),{c(){he(e.$$.fragment),t=ie(),n=U("div"),n.textContent="collisions / km",st(n,"text-align","center")},m(o,c){le(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),ce(e,o)}}}function k6(r){let e,t,n,i;return e=new Oo({props:{colorScale:Sd,labels:{buckets:pv(Cd)}}}),{c(){he(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML="<span>More deprived</span> <span>Less deprived</span>",fe(n,"class","sub-labels svelte-3xhwrh")},m(o,c){le(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),ce(e,o)}}}function S6(r){let e,t,n,i;return e=new Oo({props:{colorScale:Ed,labels:{limits:Ld.map(M6)}}}),{c(){he(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',st(n,"display","flex"),st(n,"justify-content","space-between")},m(o,c){le(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),ce(e,o)}}}function C6(r){let e,t,n,i;return e=new Oo({props:{colorScale:Td,labels:{limits:Md}}}),{c(){he(e.$$.fragment),t=ie(),n=U("div"),n.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",fe(n,"class","sub-labels svelte-3xhwrh")},m(o,c){le(e,o,c),q(o,t,c),q(o,n,c),i=!0},i(o){i||(j(e.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),i=!1},d(o){o&&(V(t),V(n)),ce(e,o)}}}function T6(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z;const I=[C6,S6,k6,x6,w6],F=[];function N(W,oe){return W[0]=="density"?0:W[0]=="car_ownership"?1:W[0]=="simd"?2:W[0]=="stats19"?3:W[0]=="pois"?4:-1}return~(w=N(r))&&(T=F[w]=I[w](r)),{c(){e=U("div"),t=U("label"),t.textContent="Metric",n=ie(),i=U("select"),o=U("option"),o.textContent="None",c=U("option"),c.textContent="Density",a=U("option"),a.textContent="Collisions",d=U("option"),d.textContent="SIMD",p=U("option"),p.textContent="Points of interest",_=U("option"),_.textContent="Car ownership",y=ie(),T&&T.c(),M=Qn(),fe(t,"for","prioritization-selection"),o.__value="none",Wn(o,o.__value),c.__value="density",Wn(c,c.__value),a.__value="stats19",Wn(a,a.__value),d.__value="simd",Wn(d,d.__value),p.__value="pois",Wn(p,p.__value),_.__value="car_ownership",Wn(_,_.__value),fe(i,"id","prioritization-selection"),r[0]===void 0&&us(()=>r[1].call(i)),st(e,"display","flex"),st(e,"gap","16px"),st(e,"align-items","center")},m(W,oe){q(W,e,oe),R(e,t),R(e,n),R(e,i),R(i,o),R(i,c),R(i,a),R(i,d),R(i,p),R(i,_),Zi(i,r[0],!0),q(W,y,oe),~w&&F[w].m(W,oe),q(W,M,oe),$=!0,D||(z=xt(i,"change",r[1]),D=!0)},p(W,[oe]){oe&1&&Zi(i,W[0]);let J=w;w=N(W),w!==J&&(T&&(tn(),Z(F[J],1,1,()=>{F[J]=null}),nn()),~w?(T=F[w],T||(T=F[w]=I[w](W),T.c()),j(T,1),T.m(M.parentNode,M)):T=null)},i(W){$||(j(T),$=!0)},o(W){Z(T),$=!1},d(W){W&&(V(e),V(y),V(M)),~w&&F[w].d(W),D=!1,z()}}}const M6=r=>`${r}%`;function L6(r,e,t){let n;at(r,Fo,a=>t(2,n=a));let{selectedPrioritization:i}=e;function o(){let a=new URL(window.location.href).searchParams.get("prioritizationMetric");a=="density"?t(0,i="density"):a=="simd"?t(0,i="simd"):a=="stats19"?t(0,i="stats19"):a=="pois"?t(0,i="pois"):a=="car_ownership"&&t(0,i="car_ownership")}n=="cnt"?o():i="none";function c(){i=Sa(this),t(0,i)}return r.$$set=a=>{"selectedPrioritization"in a&&t(0,i=a.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const a=new URL(window.location.href);i=="none"?a.searchParams.delete("prioritizationMetric"):a.searchParams.set("prioritizationMetric",i),history.replaceState({},"",a)}},[i,c]}class Ov extends Et{constructor(e){super(),Lt(this,e,L6,T6,wt,{selectedPrioritization:0})}}function Nv(r,e){return{none:r.none,area:lo(["get","area_km2"],LS,ES),car_ownership:lo(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],Ld,Ed),density:lo(["/",["get","population"],["get","area_km2"]],Md,Td),pois:lo(["/",["get","number_pois"],["get","area_km2"]],fv,dv),simd:lo(["get","simd"],Cd,Sd),stats19:lo(["/",["get","number_stats19_collisions"],["get","area_km2"]],uv,hv)}[e]}function E6(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function I6(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function A6(r){let e,t,n,i,o,c,a,d,p,_,y;return o=new On({props:{$$slots:{default:[E6]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[I6]},$$scope:{ctx:r}}}),d.$on("click",r[27]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),_.textContent="Add a neighbourhood",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),y=!0},p(w,T){const M={};T[1]&1&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T[1]&1&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),y=!1},d(w){w&&V(e),ce(o),ce(d)}}}function s1(r){let e,t,n,i,o,c,a;function d(_){r[21](_)}let p={};return r[4]!==void 0&&(p.selectedPrioritization=r[4]),o=new Ov({props:p}),hn.push(()=>An(o,"selectedPrioritization",d)),{c(){e=U("h3"),e.textContent="Prioritization",t=ie(),n=U("p"),n.textContent="Compare metrics across candidate neighbourhoods.",i=ie(),he(o.$$.fragment)},m(_,y){q(_,e,y),q(_,t,y),q(_,n,y),q(_,i,y),le(o,_,y),a=!0},p(_,y){const w={};!c&&y[0]&16&&(c=!0,w.selectedPrioritization=_[4],In(()=>c=!1)),o.$set(w)},i(_){a||(j(o.$$.fragment,_),a=!0)},o(_){Z(o.$$.fragment,_),a=!1},d(_){_&&(V(e),V(t),V(n),V(i)),ce(o,_)}}}function a1(r){let e;return{c(){e=U("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function P6(r){let e,t,n,i,o,c,a,d;function p(w){r[24](w)}function _(w){r[25](w)}let y={map:vr(r[10])};return r[6]!==void 0&&(y.waypoints=r[6]),r[1]!==void 0&&(y.drawnShapeOut=r[1]),n=new Rv({props:y}),hn.push(()=>An(n,"waypoints",p)),hn.push(()=>An(n,"drawnShapeOut",_)),{c(){e=U("div"),e.innerHTML='<h3 class="svelte-qlwqvq">1. Draw your neighbourhood</h3>',t=ie(),he(n.$$.fragment),c=ie(),a=U("div"),a.innerHTML=`<h3 class="svelte-qlwqvq">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,fe(e,"class","step svelte-qlwqvq"),en(e,"active",!r[7]),en(e,"complete",r[7]),fe(a,"class","step svelte-qlwqvq"),st(a,"margin-top","16px"),en(a,"active",r[7]),en(a,"complete",r[5].size>1)},m(w,T){q(w,e,T),q(w,t,T),le(n,w,T),q(w,c,T),q(w,a,T),d=!0},p(w,T){(!d||T[0]&128)&&en(e,"active",!w[7]),(!d||T[0]&128)&&en(e,"complete",w[7]);const M={};T[0]&1024&&(M.map=vr(w[10])),!i&&T[0]&64&&(i=!0,M.waypoints=w[6],In(()=>i=!1)),!o&&T[0]&2&&(o=!0,M.drawnShapeOut=w[1],In(()=>o=!1)),n.$set(M),(!d||T[0]&128)&&en(a,"active",w[7]),(!d||T[0]&32)&&en(a,"complete",w[5].size>1)},i(w){d||(j(n.$$.fragment,w),d=!0)},o(w){Z(n.$$.fragment,w),d=!1},d(w){w&&(V(e),V(t),V(c),V(a)),ce(n,w)}}}function z6(r){let e,t,n;return{c(){e=U("div"),e.innerHTML=`<h3 class="svelte-qlwqvq">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=ie(),n=U("div"),n.innerHTML='<h3 class="svelte-qlwqvq">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',fe(e,"class","step svelte-qlwqvq"),en(e,"active",!r[7]),en(e,"complete",r[7]),fe(n,"class","step svelte-qlwqvq"),en(n,"active",r[7]),en(n,"complete",r[5].size>1)},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p(i,o){o[0]&128&&en(e,"active",!i[7]),o[0]&128&&en(e,"complete",i[7]),o[0]&128&&en(n,"active",i[7]),o[0]&32&&en(n,"complete",i[5].size>1)},i:tt,o:tt,d(i){i&&(V(e),V(t),V(n))}}}function D6(r){let e;function t(o,c){if(o[0]=="choose-area")return F6;if(o[0]=="draw-area")return R6}let n=t(r),i=n&&n(r);return{c(){e=U("span"),i&&i.c(),st(e,"text-align","center")},m(o,c){q(o,e,c),i&&i.m(e,null)},p(o,c){n===(n=t(o))&&i?i.p(o,c):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:tt,o:tt,d(o){o&&V(e),i&&i.d()}}}function $6(r){let e,t;return e=new Fv({props:{neighbourhoodBoundary:r[7]}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function R6(r){let e;function t(o,c){return o[6].length<3?O6:B6}let n=t(r),i=n(r);return{c(){i.c(),e=Qn()},m(o,c){i.m(o,c),q(o,e,c)},p(o,c){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i.d(o)}}}function F6(r){let e;return{c(){e=xe("Empty so far. Click an area to get started.")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function B6(r){let e;return{c(){e=xe(`Not a valid shape yet  try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function O6(r){let e;return{c(){e=xe(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function N6(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe,J,ee,pe,Ie,Q,ae,Pe,ve,nt,Ge,Ee,De,Ct,it,lt,mt,dt,Xe,$t,yt,Rt,It,Qt,yn;t=new na({}),t.$on("click",r[20]);let ut=r[9]=="cnt"&&s1(r),Wt=r[4]=="none"&&a1();const Ze=[z6,P6],Ve=[];function St(Ne,et){return Ne[0]=="choose-area"?0:Ne[0]=="draw-area"?1:-1}~(N=St(r))&&(W=Ve[N]=Ze[N](r)),nt=new qm({});const Ut=[$6,D6],_e=[];function Pn(Ne,et){return Ne[7]?0:1}return mt=Pn(r),dt=_e[mt]=Ut[mt](r),{c(){e=U("div"),he(t.$$.fragment),n=ie(),ut&&ut.c(),i=ie(),Wt&&Wt.c(),o=ie(),c=U("hr"),a=ie(),d=U("div"),p=U("div"),_=U("button"),y=xe("Choose area"),T=ie(),M=U("span"),M.textContent="or",$=ie(),D=U("button"),z=xe("Draw area"),F=ie(),W&&W.c(),oe=ie(),J=U("div"),J.innerHTML='<h3 class="svelte-qlwqvq">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',ee=ie(),pe=U("div"),Ie=U("button"),Q=xe("Create neighborhood"),Pe=ie(),ve=U("button"),he(nt.$$.fragment),Ge=xe(" Start over"),De=ie(),Ct=U("h3"),Ct.textContent="Your neighbourhood overall",it=ie(),lt=U("div"),dt.c(),Xe=ie(),$t=U("hr"),yt=ie(),Rt=U("button"),Rt.textContent="Export to GeoJSON",_.disabled=w=r[0]=="choose-area",fe(_,"class","svelte-qlwqvq"),en(_,"active",r[0]=="choose-area"),st(M,"margin","0 16px"),D.disabled=I=r[0]=="draw-area",fe(D,"class","svelte-qlwqvq"),en(D,"active",r[0]=="draw-area"),fe(p,"class","modes svelte-qlwqvq"),fe(J,"class","step svelte-qlwqvq"),en(J,"active",r[7]),Ie.disabled=ae=!r[7],fe(ve,"class","destructive"),st(ve,"display","flex"),st(ve,"gap","8px"),st(ve,"align-items","center"),ve.disabled=Ee=!(r[7]||r[0]=="draw-area"&&r[6].length>0),st(pe,"display","flex"),st(pe,"gap","16px"),st(pe,"justify-content","space-between"),st(pe,"margin-bottom","16px"),fe(lt,"class","neighbourhood-boundary-summary svelte-qlwqvq"),fe(Rt,"class","secondary"),fe(e,"slot","sidebar")},m(Ne,et){q(Ne,e,et),le(t,e,null),R(e,n),ut&&ut.m(e,null),R(e,i),Wt&&Wt.m(e,null),R(e,o),R(e,c),R(e,a),R(e,d),R(d,p),R(p,_),R(_,y),R(p,T),R(p,M),R(p,$),R(p,D),R(D,z),R(d,F),~N&&Ve[N].m(d,null),R(d,oe),R(d,J),R(d,ee),R(d,pe),R(pe,Ie),R(Ie,Q),R(pe,Pe),R(pe,ve),le(nt,ve,null),R(ve,Ge),R(d,De),R(d,Ct),R(d,it),R(d,lt),_e[mt].m(lt,null),R(e,Xe),R(e,$t),R(e,yt),R(e,Rt),It=!0,Qt||(yn=[xt(_,"click",r[22]),xt(D,"click",r[23]),xt(Ie,"click",r[26]),xt(ve,"click",r[16]),xt(Rt,"click",r[13])],Qt=!0)},p(Ne,et){Ne[9]=="cnt"?ut?(ut.p(Ne,et),et[0]&512&&j(ut,1)):(ut=s1(Ne),ut.c(),j(ut,1),ut.m(e,i)):ut&&(tn(),Z(ut,1,1,()=>{ut=null}),nn()),Ne[4]=="none"?Wt||(Wt=a1(),Wt.c(),Wt.m(e,o)):Wt&&(Wt.d(1),Wt=null),(!It||et[0]&1&&w!==(w=Ne[0]=="choose-area"))&&(_.disabled=w),(!It||et[0]&1)&&en(_,"active",Ne[0]=="choose-area"),(!It||et[0]&1&&I!==(I=Ne[0]=="draw-area"))&&(D.disabled=I),(!It||et[0]&1)&&en(D,"active",Ne[0]=="draw-area");let Kt=N;N=St(Ne),N===Kt?~N&&Ve[N].p(Ne,et):(W&&(tn(),Z(Ve[Kt],1,1,()=>{Ve[Kt]=null}),nn()),~N?(W=Ve[N],W?W.p(Ne,et):(W=Ve[N]=Ze[N](Ne),W.c()),j(W,1),W.m(d,oe)):W=null),(!It||et[0]&128)&&en(J,"active",Ne[7]),(!It||et[0]&128&&ae!==(ae=!Ne[7]))&&(Ie.disabled=ae),(!It||et[0]&193&&Ee!==(Ee=!(Ne[7]||Ne[0]=="draw-area"&&Ne[6].length>0)))&&(ve.disabled=Ee);let er=mt;mt=Pn(Ne),mt===er?_e[mt].p(Ne,et):(tn(),Z(_e[er],1,1,()=>{_e[er]=null}),nn(),dt=_e[mt],dt?dt.p(Ne,et):(dt=_e[mt]=Ut[mt](Ne),dt.c()),j(dt,1),dt.m(lt,null))},i(Ne){It||(j(t.$$.fragment,Ne),j(ut),j(W),j(nt.$$.fragment,Ne),j(dt),It=!0)},o(Ne){Z(t.$$.fragment,Ne),Z(ut),Z(W),Z(nt.$$.fragment,Ne),Z(dt),It=!1},d(Ne){Ne&&V(e),ce(t),ut&&ut.d(),Wt&&Wt.d(),~N&&Ve[N].d(),ce(nt),_e[mt].d(),Qt=!1,mr(yn)}}}function l1(r){let e,t;return e=new pr({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[j6]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function j6(r){let e,t,n,i;const o=[gn("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let c={};for(let p=0;p<o.length;p+=1)c=Ot(c,o[p]);e=new rr({props:c});const a=[gn("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let d={};for(let p=0;p<a.length;p+=1)d=Ot(d,a[p]);return n=new rr({props:d}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),i=!0},p(p,_){const y={};e.$set(y);const w={};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),ce(e,p),ce(n,p)}}}function c1(r){let e,t;return e=new pr({props:{data:r[3],generateId:!0,$$slots:{default:[K6]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&8&&(o.data=n[3]),i[0]&16|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function u1(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[H6,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&1073741840|i[1]&1&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function U6(r){let e,t,n,i,o=(r[30].number_pois/r[30].area_km2).toFixed(1)+"",c,a;return{c(){e=U("b"),e.textContent="Points of interest",t=ie(),n=U("br"),i=ie(),c=xe(o),a=xe(" / km")},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,c,p),q(d,a,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_pois/d[30].area_km2).toFixed(1)+"")&&Mt(c,o)},d(d){d&&(V(e),V(t),V(n),V(i),V(c),V(a))}}}function V6(r){let e,t,n,i,o=(r[30].number_stats19_collisions/r[30].area_km2).toFixed(1)+"",c,a;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions",t=ie(),n=U("br"),i=ie(),c=xe(o),a=xe(` /
                km`)},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,c,p),q(d,a,p)},p(d,p){p[0]&1073741824&&o!==(o=(d[30].number_stats19_collisions/d[30].area_km2).toFixed(1)+"")&&Mt(c,o)},d(d){d&&(V(e),V(t),V(n),V(i),V(c),V(a))}}}function q6(r){let e,t,n,i,o=Math.round(r[30].population/r[30].area_km2).toLocaleString()+"",c,a;return{c(){e=U("b"),e.textContent="Population density",t=ie(),n=U("br"),i=ie(),c=xe(o),a=xe(`
                people / km`)},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,c,p),q(d,a,p)},p(d,p){p[0]&1073741824&&o!==(o=Math.round(d[30].population/d[30].area_km2).toLocaleString()+"")&&Mt(c,o)},d(d){d&&(V(e),V(t),V(n),V(i),V(c),V(a))}}}function Z6(r){let e,t,n,i,o=Fc(r[30].households_with_cars_or_vans,r[30].total_households)+"",c,a,d=r[30].total_households.toLocaleString()+"",p,_;return{c(){e=U("b"),e.textContent="Car or van ownership",t=ie(),n=U("br"),i=ie(),c=xe(o),a=xe(" of approximately "),p=xe(d),_=xe(`
                households have at least one car or van.`)},m(y,w){q(y,e,w),q(y,t,w),q(y,n,w),q(y,i,w),q(y,c,w),q(y,a,w),q(y,p,w),q(y,_,w)},p(y,w){w[0]&1073741824&&o!==(o=Fc(y[30].households_with_cars_or_vans,y[30].total_households)+"")&&Mt(c,o),w[0]&1073741824&&d!==(d=y[30].total_households.toLocaleString()+"")&&Mt(p,d)},d(y){y&&(V(e),V(t),V(n),V(i),V(c),V(a),V(p),V(_))}}}function G6(r){let e,t,n=r[30].area_km2.toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Area:",t=ie(),i=xe(n),o=xe(" km")},m(c,a){q(c,e,a),q(c,t,a),q(c,i,a),q(c,o,a)},p(c,a){a[0]&1073741824&&n!==(n=c[30].area_km2.toFixed(1)+"")&&Mt(i,n)},d(c){c&&(V(e),V(t),V(i),V(o))}}}function H6(r){let e;function t(o,c){if(o[4]=="none")return G6;if(o[4]=="car_ownership")return Z6;if(o[4]=="density")return q6;if(o[4]=="stats19")return V6;if(o[4]=="pois")return U6}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=Qn()},m(o,c){i&&i.m(o,c),q(o,e,c)},p(o,c){n===(n=t(o))&&i?i.p(o,c):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i&&i.d(o)}}}function W6(r){let e,t,n=r[4]!="simd"&&u1(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o[0]&16&&j(n,1)):(n=u1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function K6(r){let e,t,n,i;const o=[gn("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let c={$$slots:{default:[W6]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)c=Ot(c,o[p]);e=new zi({props:c}),e.$on("click",r[11]);const a=[gn("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let d={};for(let p=0;p<a.length;p+=1)d=Ot(d,a[p]);return n=new rr({props:d}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),i=!0},p(p,_){const y=_[0]&49168?Vn(o,[o[0],{paint:{"fill-color":p[14](p[4]),"fill-opacity":p[15](p[4])}},o[2],o[3]]):{};_[0]&16|_[1]&1&&(y.$$scope={dirty:_,ctx:p}),e.$set(y);const w={};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),ce(e,p),ce(n,p)}}}function X6(r){let e,t,n,i=r[7]&&l1(r),o=r[0]=="choose-area"&&c1(r);return{c(){e=U("div"),i&&i.c(),t=ie(),o&&o.c(),fe(e,"slot","map")},m(c,a){q(c,e,a),i&&i.m(e,null),R(e,t),o&&o.m(e,null),n=!0},p(c,a){c[7]?i?(i.p(c,a),a[0]&128&&j(i,1)):(i=l1(c),i.c(),j(i,1),i.m(e,t)):i&&(tn(),Z(i,1,1,()=>{i=null}),nn()),c[0]=="choose-area"?o?(o.p(c,a),a[0]&1&&j(o,1)):(o=c1(c),o.c(),j(o,1),o.m(e,null)):o&&(tn(),Z(o,1,1,()=>{o=null}),nn())},i(c){n||(j(i),j(o),n=!0)},o(c){Z(i),Z(o),n=!1},d(c){c&&V(e),i&&i.d(),o&&o.d()}}}function J6(r){let e,t,n,i;return e=new Ch({props:{loading:r[2]}}),n=new bo({props:{$$slots:{map:[X6],sidebar:[N6],top:[A6]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(o,c){le(e,o,c),q(o,t,c),le(n,o,c),i=!0},p(o,c){const a={};c[0]&4&&(a.loading=o[2]),e.$set(a);const d={};c[0]&2043|c[1]&1&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),ce(e,o),ce(n,o)}}}function Y6(r,e,t){let n,i,o,c,a,d;at(r,an,Ee=>t(8,n=Ee)),at(r,Ar,Ee=>t(19,i=Ee)),at(r,_l,Ee=>t(28,o=Ee)),at(r,Qs,Ee=>t(29,c=Ee)),at(r,Fo,Ee=>t(9,a=Ee)),at(r,Ro,Ee=>t(10,d=Ee));let p="Generating severance boundaries...",_=Wi(),y="choose-area",w="none",T=null,M=new Map,$=[],D,z=null,I=null;Ls(async()=>{await new Promise(Ee=>{requestAnimationFrame(()=>{requestAnimationFrame(Ee)})}),t(3,_=i.generatedBoundaries()),t(2,p="")});function F(Ee){let De=Ee.detail.features[0].id,Ct=_.features[De],it=new Map(M);if(it.has(De)?it.delete(De):it.set(De,Ct),it.size===0)t(17,T=null),t(5,M=it);else if(it.size===1)t(17,T=it.values().next().value),t(5,M=it);else{let lt={type:"FeatureCollection",features:Array.from(it.values())};try{t(17,T=i.generateMergedBoundary(lt)),t(5,M=it)}catch(mt){console.log(`error merging boundaries: ${mt}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${mt}`)}}}function N(Ee){var it;let De=c.nextAvailableNeighbourhoodName(o),Ct=Bv(i,"What do you want to name the neighbourhood?",De);if(Ct)try{const lt={};y=="draw-area"&&((it=D==null?void 0:D.properties)!=null&&it.waypoints)&&(lt.waypoints=D.properties.waypoints);let mt={type:"Feature",properties:lt,geometry:Ee.geometry};i.setNeighbourhoodBoundary(Ct,mt),mh(),i.setCurrentNeighbourhood(Ct),Nt(an,n={mode:"neighbourhood"},n)}catch(lt){window.alert(`Sorry, this boundary is invalid: ${lt}`)}}function W(){bd("auto_boundaries.geojson",JSON.stringify(_,null,"  "))}function oe(Ee){return Nv({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},Ee)}function J(Ee){return{none:Jn(.3,.5),area:Jn(.7,.9),car_ownership:Jn(.7,.9),density:Jn(.7,.9),pois:Jn(.7,.9),simd:Jn(.7,.9),stats19:Jn(.7,.9)}[Ee]}function ee(){t(17,T=null),M.clear(),t(5,M),t(6,$=[]),t(18,z=null),t(7,I=null)}const pe=()=>Nt(an,n={mode:"pick-neighbourhood"},n);function Ie(Ee){w=Ee,t(4,w)}const Q=()=>t(0,y="choose-area"),ae=()=>t(0,y="draw-area");function Pe(Ee){$=Ee,t(6,$)}function ve(Ee){D=Ee,t(1,D)}const nt=()=>N(vr(I)),Ge=()=>Nt(an,n={mode:"pick-neighbourhood"},n);return r.$$.update=()=>{if(r.$$.dirty[0]&524290){let Ee=null;if(D&&D.geometry.coordinates[0].length>3){let De={type:"FeatureCollection",features:[D]};try{Ee=i.generateMergedBoundary(De)}catch(Ct){console.log(`error merging boundaries: ${Ct}`)}}t(18,z=Ee)}r.$$.dirty[0]&393217&&(y=="draw-area"?t(7,I=z):t(7,I=T))},[y,D,p,_,w,M,$,I,n,a,d,F,N,W,oe,J,ee,T,z,i,pe,Ie,Q,ae,Pe,ve,nt,Ge]}class Q6 extends Et{constructor(e){super(),Lt(this,e,Y6,J6,wt,{},null,[-1,-1])}}const yi=class yi{constructor(e,t,n){tr(this,"filterType");tr(this,"label");tr(this,"description");this.filterType=e,this.label=t,this.description=n}get iconURL(){return`/ltn//filters/${this.filterType}_icon.gif`}get largeImageURL(){return`/ltn//filters/${this.filterType}.gif`}static getFilter(e){switch(e){case"walk_cycle_only":return yi.walkCycleOnly;case"no_entry":return yi.noEntry;case"bus_gate":return yi.busGate;case"school_street":return yi.schoolStreet;default:console.assert(`unknown filter type: "${e}"`);return}}};tr(yi,"walkCycleOnly",new yi("walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter.")),tr(yi,"noEntry",new yi("no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through.")),tr(yi,"busGate",new yi("bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier.")),tr(yi,"schoolStreet",new yi("school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school.")),tr(yi,"allTypes",[yi.walkCycleOnly,yi.noEntry,yi.busGate,yi.schoolStreet]);let ao=yi;function eL(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function tL(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function nL(r){let e,t,n,i,o,c,a,d,p,_,y;return o=new On({props:{$$slots:{default:[eL]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[tL]},$$scope:{ctx:r}}}),d.$on("click",r[11]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),_.textContent="Explore origin/destination demand data",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),y=!0},p(w,T){const M={};T&32768&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T&32768&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),y=!1},d(w){w&&V(e),ce(o),ce(d)}}}function rL(r){let e;return{c(){e=U("p"),e.textContent="Hover on a zone"},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function iL(r){let e,t=r[6].properties.name+"",n,i,o,c,a=r[6].properties.sum_from.toLocaleString()+"",d,p,_,y,w=r[6].properties.sum_to.toLocaleString()+"",T,M,$,D,z=r[6].properties.counts_from[r[3]]+"",I;return{c(){e=U("u"),n=xe(t),i=ie(),o=U("p"),c=xe("Total trips from here: "),d=xe(a),p=ie(),_=U("p"),y=xe("Total trips to here: "),T=xe(w),M=ie(),$=U("p"),D=xe("Total intra-zonal trips starting and ending here: "),I=xe(z)},m(F,N){q(F,e,N),R(e,n),q(F,i,N),q(F,o,N),R(o,c),R(o,d),q(F,p,N),q(F,_,N),R(_,y),R(_,T),q(F,M,N),q(F,$,N),R($,D),R($,I)},p(F,N){N&64&&t!==(t=F[6].properties.name+"")&&Mt(n,t),N&64&&a!==(a=F[6].properties.sum_from.toLocaleString()+"")&&Mt(d,a),N&64&&w!==(w=F[6].properties.sum_to.toLocaleString()+"")&&Mt(T,w),N&72&&z!==(z=F[6].properties.counts_from[F[3]]+"")&&Mt(I,z)},d(F){F&&(V(e),V(i),V(o),V(p),V(_),V(M),V($))}}}function oL(r){let e,t,n,i,o,c=r[0].features.length.toLocaleString()+"",a,d,p,_,y,w,T,M,$,D,z=r[1]?"from":"to",I,F,N=r[3]==null?"each zone":"this zone",W,oe,J,ee,pe,Ie,Q,ae,Pe,ve;t=new na({}),t.$on("click",r[9]),ee=new Oo({props:{colorScale:Yf,labels:{limits:r[5]}}});function nt(De,Ct){return De[6]&&De[3]!=null?iL:rL}let Ge=nt(r),Ee=Ge(r);return{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("p"),o=xe("Trips begin and end in "),a=xe(c),d=xe(" zones"),p=ie(),_=U("label"),y=xe(`Trips from
      `),w=U("input"),T=xe(`
      Trips to`),M=ie(),$=U("p"),D=xe("Trips "),I=xe(z),F=ie(),W=xe(N),oe=xe(":"),J=ie(),he(ee.$$.fragment),pe=ie(),Ie=U("hr"),Q=ie(),Ee.c(),fe(w,"type","checkbox"),fe(w,"role","switch"),fe(e,"slot","sidebar")},m(De,Ct){q(De,e,Ct),le(t,e,null),R(e,n),R(e,i),R(i,o),R(i,a),R(i,d),R(e,p),R(e,_),R(_,y),R(_,w),w.checked=r[1],R(_,T),R(e,M),R(e,$),R($,D),R($,I),R($,F),R($,W),R($,oe),R(e,J),le(ee,e,null),R(e,pe),R(e,Ie),R(e,Q),Ee.m(e,null),ae=!0,Pe||(ve=xt(w,"change",r[10]),Pe=!0)},p(De,Ct){(!ae||Ct&1)&&c!==(c=De[0].features.length.toLocaleString()+"")&&Mt(a,c),Ct&2&&(w.checked=De[1]),(!ae||Ct&2)&&z!==(z=De[1]?"from":"to")&&Mt(I,z),(!ae||Ct&8)&&N!==(N=De[3]==null?"each zone":"this zone")&&Mt(W,N);const it={};Ct&32&&(it.labels={limits:De[5]}),ee.$set(it),Ge===(Ge=nt(De))&&Ee?Ee.p(De,Ct):(Ee.d(1),Ee=Ge(De),Ee&&(Ee.c(),Ee.m(e,null)))},i(De){ae||(j(t.$$.fragment,De),j(ee.$$.fragment,De),ae=!0)},o(De){Z(t.$$.fragment,De),Z(ee.$$.fragment,De),ae=!1},d(De){De&&V(e),ce(t),ce(ee),Ee.d(),Pe=!1,ve()}}}function sL(r){let e,t,n,i,o;const c=[gn("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":Jn(.5,.1)}},{manageHoverState:!0}];function a(y){r[8](y)}let d={};for(let y=0;y<c.length;y+=1)d=Ot(d,c[y]);r[2]!==void 0&&(d.hovered=r[2]),e=new zi({props:d}),hn.push(()=>An(e,"hovered",a));const p=[gn("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let _={};for(let y=0;y<p.length;y+=1)_=Ot(_,p[y]);return i=new rr({props:_}),{c(){he(e.$$.fragment),n=ie(),he(i.$$.fragment)},m(y,w){le(e,y,w),q(y,n,w),le(i,y,w),o=!0},p(y,w){const T=w&16?Vn(c,[c[0],{paint:{"fill-color":y[4],"fill-opacity":Jn(.5,.1)}},c[2]]):{};!t&&w&4&&(t=!0,T.hovered=y[2],In(()=>t=!1)),e.$set(T);const M={};i.$set(M)},i(y){o||(j(e.$$.fragment,y),j(i.$$.fragment,y),o=!0)},o(y){Z(e.$$.fragment,y),Z(i.$$.fragment,y),o=!1},d(y){y&&V(n),ce(e,y),ce(i,y)}}}function aL(r){let e,t,n;return t=new pr({props:{data:r[0],generateId:!0,$$slots:{default:[sL]},$$scope:{ctx:r}}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","map")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o&1&&(c.data=i[0]),o&32788&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function lL(r){let e,t;return e=new bo({props:{$$slots:{map:[aL],sidebar:[oL],top:[nL]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&33023&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function cL(r,e,t){let n,i,o,c,a,d;at(r,an,I=>t(7,a=I)),at(r,Ar,I=>t(12,d=I));let p=Wi();try{p=d.getDemandModel()}catch{window.alert("No demand model for this area"),Nt(an,a={mode:"pick-neighbourhood"},a)}let _=!1,y=null;function w(I,F){if(I==null){let N=F?"sum_to":"sum_from",W=Math.max(...p.features.map(J=>J.properties[N])),oe=T(W);return[oe,lo(["get",N],oe,Yf)]}else{let N=F?"counts_to":"counts_from",W=[...p.features.map(ee=>ee.properties[N][I])],oe=Math.max(...W),J=T(oe);return[J,lo(["at",["id"],["literal",W]],J,Yf)]}}function T(I){let F=Yf.length+1;return Array.from(Array(F).keys()).map(N=>Math.round(I/(F-1)*N))}function M(I){y=I,t(2,y)}const $=()=>Nt(an,a={mode:"predict-impact"},a);function D(){_=this.checked,t(1,_)}const z=()=>Nt(an,a={mode:"pick-neighbourhood"},a);return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=y==null?null:y.id),r.$$.dirty&9&&t(6,i=n!=null?p.features[n]:null),r.$$.dirty&10&&t(5,[o,c]=w(n,_),o,(t(4,c),t(3,n),t(1,_),t(2,y)))},[p,_,y,n,c,o,i,a,M,$,D,z]}class uL extends Et{constructor(e){super(),Lt(this,e,cL,lL,wt,{})}}function hL(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function fL(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function dL(r){let e,t,n,i,o,c,a,d,p,_,y;return o=new On({props:{$$slots:{default:[hL]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[fL]},$$scope:{ctx:r}}}),d.$on("click",r[9]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),_.textContent="Debug intersections",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),y=!0},p(w,T){const M={};T&1024&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T&1024&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),y=!1},d(w){w&&V(e),ce(o),ce(d)}}}function h1(r){let e,t,n,i,o,c,a;function d(_){r[8](_)}let p={list:r[1].features};return r[2]!==void 0&&(p.idx=r[2]),n=new kd({props:p}),hn.push(()=>An(n,"idx",d)),{c(){e=U("button"),e.textContent="Pick another intersection",t=ie(),he(n.$$.fragment),fe(e,"class","secondary")},m(_,y){q(_,e,y),q(_,t,y),le(n,_,y),o=!0,c||(a=xt(e,"click",r[7]),c=!0)},p(_,y){const w={};y&2&&(w.list=_[1].features),!i&&y&4&&(i=!0,w.idx=_[2],In(()=>i=!1)),n.$set(w)},i(_){o||(j(n.$$.fragment,_),o=!0)},o(_){Z(n.$$.fragment,_),o=!1},d(_){_&&(V(e),V(t)),ce(n,_),c=!1,a()}}}function f1(r){let e,t;return{c(){e=U("a"),t=xe("Open OSM"),fe(e,"href",r[0]),fe(e,"target","_blank")},m(n,i){q(n,e,i),R(e,t)},p(n,i){i&1&&fe(e,"href",n[0])},d(n){n&&V(e)}}}function pL(r){let e,t,n,i,o,c,a;t=new na({}),t.$on("click",r[6]);let d=r[1].features.length>0&&h1(r),p=r[0]&&f1(r);return{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=ie(),d&&d.c(),c=ie(),p&&p.c(),fe(e,"slot","sidebar")},m(_,y){q(_,e,y),le(t,e,null),R(e,n),R(e,i),R(e,o),d&&d.m(e,null),R(e,c),p&&p.m(e,null),a=!0},p(_,y){_[1].features.length>0?d?(d.p(_,y),y&2&&j(d,1)):(d=h1(_),d.c(),j(d,1),d.m(e,c)):d&&(tn(),Z(d,1,1,()=>{d=null}),nn()),_[0]?p?p.p(_,y):(p=f1(_),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(_){a||(j(t.$$.fragment,_),j(d),a=!0)},o(_){Z(t.$$.fragment,_),Z(d),a=!1},d(_){_&&V(e),ce(t),d&&d.d(),p&&p.d()}}}function mL(r){let e,t;const n=[gn("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new wl({props:i}),e.$on("click",r[5]),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function gL(r){let e,t,n,i;const o=[gn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let c={};for(let p=0;p<o.length;p+=1)c=Ot(c,o[p]);e=new rr({props:c});const a=[gn("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<a.length;p+=1)d=Ot(d,a[p]);return n=new zi({props:d}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),i=!0},p(p,_){const y={};e.$set(y);const w=_&4?Vn(a,[a[0],{filter:["==",["id"],p[2]]},a[2]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),ce(e,p),ce(n,p)}}}function _L(r){let e,t,n,i,o;return t=new pr({props:{data:vr(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[mL]},$$scope:{ctx:r}}}),i=new pr({props:{data:r[1],generateId:!0,$$slots:{default:[gL]},$$scope:{ctx:r}}}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),he(i.$$.fragment),fe(e,"slot","map")},m(c,a){q(c,e,a),le(t,e,null),R(e,n),le(i,e,null),o=!0},p(c,a){const d={};a&8&&(d.data=vr(c[3]).getAllIntersections()),a&1024&&(d.$$scope={dirty:a,ctx:c}),t.$set(d);const p={};a&2&&(p.data=c[1]),a&1028&&(p.$$scope={dirty:a,ctx:c}),i.$set(p)},i(c){o||(j(t.$$.fragment,c),j(i.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),Z(i.$$.fragment,c),o=!1},d(c){c&&V(e),ce(t),ce(i)}}}function yL(r){let e,t;return e=new bo({props:{$$slots:{map:[_L],sidebar:[pL],top:[dL]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1055&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function bL(r,e,t){let n,i;at(r,Ar,T=>t(3,n=T)),at(r,an,T=>t(4,i=T));let o=null,c=Wi(),a=0;function d(T){t(0,o=T.detail.features[0].properties.osm),t(1,c=n.getMovements(T.detail.features[0].id)),t(2,a=0)}const p=()=>Nt(an,i={mode:"pick-neighbourhood"},i),_=()=>t(1,c=Wi());function y(T){a=T,t(2,a)}return[o,c,a,n,i,d,p,_,y,()=>Nt(an,i={mode:"pick-neighbourhood"},i)]}class vL extends Et{constructor(e){super(),Lt(this,e,bL,yL,wt,{})}}function wL(r){let e,t,n,i,o,c;const a=[gn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let d={};for(let T=0;T<a.length;T+=1)d=Ot(d,a[T]);e=new zi({props:d});const p=[gn("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}},{minzoom:14}];let _={};for(let T=0;T<p.length;T+=1)_=Ot(_,p[T]);n=new zi({props:_});const y=[gn("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}},{minzoom:14}];let w={};for(let T=0;T<y.length;T+=1)w=Ot(w,y[T]);return o=new rr({props:w}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment)},m(T,M){le(e,T,M),q(T,t,M),le(n,T,M),q(T,i,M),le(o,T,M),c=!0},p(T,[M]){const $=M&1?Vn(a,[a[0],a[1],{layout:{visibility:T[0]=="cells"?"none":"visible"}},a[3]]):{};e.$set($);const D={};n.$set(D);const z={};o.$set(z)},i(T){c||(j(e.$$.fragment,T),j(n.$$.fragment,T),j(o.$$.fragment,T),c=!0)},o(T){Z(e.$$.fragment,T),Z(n.$$.fragment,T),Z(o.$$.fragment,T),c=!1},d(T){T&&(V(t),V(i)),ce(e,T),ce(n,T),ce(o,T)}}}function xL(r,e,t){let n;return at(r,hd,i=>t(0,n=i)),[n]}class Id extends Et{constructor(e){super(),Lt(this,e,xL,wL,wt,{})}}function kL(r){let e,t;const n=[gn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new zi({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}class Ad extends Et{constructor(e){super(),Lt(this,e,null,kL,wt,{})}}const SL=r=>({}),d1=r=>({}),CL=r=>({}),p1=r=>({});function m1(r){let e;const t=r[7]["line-popup"],n=Cn(t,r,r[10],p1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&Mn(n,t,i,i[10],e?Tn(t,i[10],o,CL):Ln(i[10]),p1)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function TL(r){let e,t,n=r[0]&&m1(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=m1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function g1(r){let e;const t=r[7]["line-popup"],n=Cn(t,r,r[10],d1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&Mn(n,t,i,i[10],e?Tn(t,i[10],o,SL):Ln(i[10]),d1)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function ML(r){let e,t,n=r[0]&&g1(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=g1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function LL(r){let e,t,n,i,o,c,a,d;const p=[gn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,1),"line-color":"black"}},{minzoom:13}];let _={};for(let z=0;z<p.length;z+=1)_=Ot(_,p[z]);e=new rr({props:_});const y=[gn("interior-roads",!1),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":Jn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let w={$$slots:{default:[TL]},$$scope:{ctx:r}};for(let z=0;z<y.length;z+=1)w=Ot(w,y[z]);n=new rr({props:w}),n.$on("click",r[8]);const T=[gn("main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,6),"line-color":"black"}},{minzoom:13}];let M={};for(let z=0;z<T.length;z+=1)M=Ot(M,T[z]);o=new rr({props:M});const $=[gn("main-roads",!1),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,4),"line-color":Jn("gray",yo.mapFeature.hover.backgroundColor),"line-opacity":Jn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let D={$$slots:{default:[ML]},$$scope:{ctx:r}};for(let z=0;z<$.length;z+=1)D=Ot(D,$[z]);return a=new rr({props:D}),a.$on("click",r[9]),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment)},m(z,I){le(e,z,I),q(z,t,I),le(n,z,I),q(z,i,I),le(o,z,I),q(z,c,I),le(a,z,I),d=!0},p(z,[I]){const F=I&84?Vn(p,[p[0],p[1],{paint:{"line-width":z[6](z[2],z[4].maxShortcuts,1),"line-color":"black"}},p[3]]):{};e.$set(F);const N=I&125?Vn(y,[y[0],y[1],I&124&&{paint:{"line-width":z[6](z[2],z[4].maxShortcuts,0),"line-color":z[5](z[3],z[4].maxShortcuts),"line-opacity":Jn(1,.5)}},y[3],y[4],I&1&&{manageHoverState:z[0]},I&1&&{hoverCursor:z[0]?"pointer":void 0}]):{};I&1025&&(N.$$scope={dirty:I,ctx:z}),n.$set(N);const W=I&84?Vn(T,[T[0],T[1],{paint:{"line-width":z[6](z[2],z[4].maxShortcuts,6),"line-color":"black"}},T[3]]):{};o.$set(W);const oe=I&85?Vn($,[$[0],$[1],I&84&&{paint:{"line-width":z[6](z[2],z[4].maxShortcuts,4),"line-color":Jn("gray",yo.mapFeature.hover.backgroundColor),"line-opacity":Jn(1,.5)}},$[3],$[4],I&1&&{manageHoverState:z[0]},I&1&&{hoverCursor:z[0]?"pointer":void 0}]):{};I&1025&&(oe.$$scope={dirty:I,ctx:z}),a.$set(oe)},i(z){d||(j(e.$$.fragment,z),j(n.$$.fragment,z),j(o.$$.fragment,z),j(a.$$.fragment,z),d=!0)},o(z){Z(e.$$.fragment,z),Z(n.$$.fragment,z),Z(o.$$.fragment,z),Z(a.$$.fragment,z),d=!1},d(z){z&&(V(t),V(i),V(c)),ce(e,z),ce(n,z),ce(o,z),ce(a,z)}}}function EL(r,e,t){let n,i;at(r,sm,M=>t(2,n=M)),at(r,hd,M=>t(3,i=M));let{$$slots:o={},$$scope:c}=e,a=Sh("neighbourhoodGj"),{interactive:d=!0}=e,{onClickLine:p=(M,$)=>{}}=e;function _(M,$){return M=="cells"?["get","color"]:M=="edits"?Jn(["case",["get","edited"],IS,"white"],yo.mapFeature.hover.backgroundColor):M=="speeds"?lo(["get","speed_mph"],cv,lv):$<=2?Jn("white","blue"):(console.assert(M=="shortcuts"),Jn(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",$,"#A32015"],yo.mapFeature.hover.backgroundColor))}function y(M,$,D){return!M||$<=2?qs(D):["interpolate",["linear"],["get","shortcuts"],0,5+D,$,25+D]}const w=M=>d&&p(M.detail.features[0],M.detail.event.lngLat),T=M=>d&&p(M.detail.features[0],M.detail.event.lngLat);return r.$$set=M=>{"interactive"in M&&t(0,d=M.interactive),"onClickLine"in M&&t(1,p=M.onClickLine),"$$scope"in M&&t(10,c=M.$$scope)},[d,p,n,i,a,_,y,o,w,T,c]}class Ah extends Et{constructor(e){super(),Lt(this,e,EL,LL,wt,{interactive:0,onClickLine:1})}}function IL(r){let e;const t=r[7].default,n=Cn(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&Mn(n,t,i,i[9],e?Tn(t,i[9],o,null):Ln(i[9]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function AL(r){let e,t,n;const i=[gn("turn-restrictions"),{minzoom:13},{filter:r[4]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(a){r[8](a)}let c={$$slots:{default:[IL]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)c=Ot(c,i[a]);return r[1]!==void 0&&(c.hovered=r[1]),e=new gh({props:c}),hn.push(()=>An(e,"hovered",o)),e.$on("click",function(){bl(r[0])&&r[0].apply(this,arguments)}),{c(){he(e.$$.fragment)},m(a,d){le(e,a,d),n=!0},p(a,d){r=a;const p=d&16?Vn(i,[i[0],i[1],{filter:r[4]?void 0:["get","edited"]},i[3],i[4]]):{};d&512&&(p.$$scope={dirty:d,ctx:r}),!t&&d&2&&(t=!0,p.hovered=r[1],In(()=>t=!1)),e.$set(p)},i(a){n||(j(e.$$.fragment,a),n=!0)},o(a){Z(e.$$.fragment,a),n=!1},d(a){ce(e,a)}}}function PL(r){let e,t;const n=[gn("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function zL(r){let e,t,n,i;return e=new pr({props:{data:r[2],generateId:!0,$$slots:{default:[AL]},$$scope:{ctx:r}}}),n=new pr({props:{data:r[3],$$slots:{default:[PL]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(o,c){le(e,o,c),q(o,t,c),le(n,o,c),i=!0},p(o,[c]){const a={};c&4&&(a.data=o[2]),c&531&&(a.$$scope={dirty:c,ctx:o}),e.$set(a);const d={};c&8&&(d.data=o[3]),c&512&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),ce(e,o),ce(n,o)}}}function DL(r,e,t){let n,i,o,c,a;at(r,Ar,T=>t(5,o=T)),at(r,oo,T=>t(6,c=T)),at(r,ud,T=>t(4,a=T));let{$$slots:d={},$$scope:p}=e,{onClickTurnRestriction:_=()=>{}}=e,y=null;function w(T){y=T,t(1,y)}return r.$$set=T=>{"onClickTurnRestriction"in T&&t(0,_=T.onClickTurnRestriction),"$$scope"in T&&t(9,p=T.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=y==null?Wi():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(y.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(y.properties.to_geometry),properties:{}}]}),r.$$.dirty&96&&t(2,i=c>0?o.renderTurnRestrictions():Wi())},[_,y,i,n,a,o,c,d,w,p]}class $L extends Et{constructor(e){super(),Lt(this,e,DL,zL,wt,{onClickTurnRestriction:0})}}const RL=r=>({}),_1=r=>({}),FL=r=>({}),y1=r=>({});function BL(r){let e;const t=r[6]["modal-filter"],n=Cn(t,r,r[7],y1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&128)&&Mn(n,t,i,i[7],e?Tn(t,i[7],o,FL):Ln(i[7]),y1)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function OL(r){let e,t,n,i;const o=[gn("modal-filters"),{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[3]?["literal",!0]:["get","edited"]]},{minzoom:Zf},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let c={$$slots:{default:[BL]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)c=Ot(c,o[p]);e=new gh({props:c}),e.$on("click",function(){bl(r[0])&&r[0].apply(this,arguments)});const a=[gn("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Zf},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let d={};for(let p=0;p<a.length;p+=1)d=Ot(d,a[p]);return n=new gh({props:d}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),i=!0},p(p,_){r=p;const y=_&8?Vn(o,[o[0],_&8&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[3]?["literal",!0]:["get","edited"]]},_&0&&{minzoom:Zf},o[3],o[4]]):{};_&128&&(y.$$scope={dirty:_,ctx:r}),e.$set(y);const w=_&0?Vn(a,[a[0],a[1],{minzoom:Zf},a[3],a[4]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),ce(e,p),ce(n,p)}}}function NL(r){let e;const t=r[6]["turn-restriction"],n=Cn(t,r,r[7],_1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&128)&&Mn(n,t,i,i[7],e?Tn(t,i[7],o,RL):Ln(i[7]),_1)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function jL(r){let e,t,n,i;return e=new pr({props:{data:r[2],generateId:!0,$$slots:{default:[OL]},$$scope:{ctx:r}}}),n=new $L({props:{onClickTurnRestriction:r[1],$$slots:{default:[NL]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(o,c){le(e,o,c),q(o,t,c),le(n,o,c),i=!0},p(o,[c]){const a={};c&4&&(a.data=o[2]),c&137&&(a.$$scope={dirty:c,ctx:o}),e.$set(a);const d={};c&2&&(d.onClickTurnRestriction=o[1]),c&128&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),ce(e,o),ce(n,o)}}}let Zf=13;function UL(r,e,t){let n,i,o,c;at(r,Ar,y=>t(4,i=y)),at(r,oo,y=>t(5,o=y)),at(r,ud,y=>t(3,c=y));let{$$slots:a={},$$scope:d}=e,{onClickModalFilter:p=()=>{}}=e,{onClickTurnRestriction:_=()=>{}}=e;return r.$$set=y=>{"onClickModalFilter"in y&&t(0,p=y.onClickModalFilter),"onClickTurnRestriction"in y&&t(1,_=y.onClickTurnRestriction),"$$scope"in y&&t(7,d=y.$$scope)},r.$$.update=()=>{r.$$.dirty&48&&t(2,n=o>0?i.renderModalFilters():Wi())},[p,_,n,c,i,o,a,d]}class Oa extends Et{constructor(e){super(),Lt(this,e,UL,jL,wt,{onClickModalFilter:0,onClickTurnRestriction:1})}}function VL(r){let e,t;const n=[gn("one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new gh({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}class Pd extends Et{constructor(e){super(),Lt(this,e,null,VL,wt,{})}}function qL(r){let e;const t=r[3].default,n=Cn(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&Mn(n,t,i,i[4],e?Tn(t,i[4],o,null):Ln(i[4]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function ZL(r){let e,t;return e=new pr({props:{data:r[0],generateId:!0,$$slots:{default:[qL]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function GL(r,e,t){let n,i;at(r,Ar,d=>t(2,i=d));let{$$slots:o={},$$scope:c}=e,{input:a=null}=e;return r.$$set=d=>{"input"in d&&t(1,a=d.input),"$$scope"in d&&t(4,c=d.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=a||i.renderNeighbourhood()),r.$$.dirty&1&&_d("neighbourhoodGj",n)},[n,a,i,o,c]}class Ph extends Et{constructor(e){super(),Lt(this,e,GL,ZL,wt,{input:1})}}function HL(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function WL(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function KL(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function XL(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M;return o=new On({props:{$$slots:{default:[HL]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[WL]},$$scope:{ctx:r}}}),d.$on("click",r[8]),y=new On({props:{$$slots:{default:[KL]},$$scope:{ctx:r}}}),y.$on("click",r[9]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),he(y.$$.fragment),w=ie(),T=U("li"),T.textContent="Debug mode",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m($,D){q($,e,D),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),le(y,_,null),R(n,w),R(n,T),M=!0},p($,D){const z={};D&2048&&(z.$$scope={dirty:D,ctx:$}),o.$set(z);const I={};D&2048&&(I.$$scope={dirty:D,ctx:$}),d.$set(I);const F={};D&2048&&(F.$$scope={dirty:D,ctx:$}),y.$set(F)},i($){M||(j(o.$$.fragment,$),j(d.$$.fragment,$),j(y.$$.fragment,$),M=!0)},o($){Z(o.$$.fragment,$),Z(d.$$.fragment,$),Z(y.$$.fragment,$),M=!1},d($){$&&V(e),ce(o),ce(d),ce(y)}}}function b1(r){let e,t,n;return{c(){e=U("button"),e.textContent="",fe(e,"class","close-btn svelte-khnvno")},m(i,o){q(i,e,o),t||(n=xt(e,"click",r[6]),t=!0)},p:tt,d(i){i&&V(e),t=!1,n()}}}function JL(r){let e;return{c(){e=U("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){q(t,e,n)},p:tt,i:tt,o:tt,d(t){t&&V(e)}}}function YL(r){let e,t,n,i,o,c,a;e=new Th({props:{properties:r[0].feature.properties}});function d(_){r[7](_)}let p={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(p.idx=r[0].movementIdx),o=new kd({props:p}),hn.push(()=>An(o,"idx",d)),{c(){he(e.$$.fragment),t=ie(),n=U("h5"),n.textContent="Turn restrictions:",i=ie(),he(o.$$.fragment)},m(_,y){le(e,_,y),q(_,t,y),q(_,n,y),q(_,i,y),le(o,_,y),a=!0},p(_,y){const w={};y&1&&(w.properties=_[0].feature.properties),e.$set(w);const T={};y&1&&(T.list=_[0].movements.features),!c&&y&1&&(c=!0,T.idx=_[0].movementIdx,In(()=>c=!1)),o.$set(T)},i(_){a||(j(e.$$.fragment,_),j(o.$$.fragment,_),a=!0)},o(_){Z(e.$$.fragment,_),Z(o.$$.fragment,_),a=!1},d(_){_&&(V(t),V(n),V(i)),ce(e,_),ce(o,_)}}}function QL(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M;t=new na({}),t.$on("click",r[5]);let $=r[0]&&b1(r);const D=[YL,JL],z=[];function I(F,N){return F[0]?0:1}return w=I(r),T=z[w]=D[w](r),{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("h4"),i.textContent="Roads",o=ie(),c=U("p"),c.textContent="Click a road to visit its OSM object.",a=ie(),d=U("div"),p=U("h4"),p.textContent="Intersections",_=ie(),$&&$.c(),y=ie(),T.c(),st(d,"display","flex"),st(d,"align-items","start"),st(d,"justify-content","space-between"),fe(e,"slot","sidebar")},m(F,N){q(F,e,N),le(t,e,null),R(e,n),R(e,i),R(e,o),R(e,c),R(e,a),R(e,d),R(d,p),R(d,_),$&&$.m(d,null),R(e,y),z[w].m(e,null),M=!0},p(F,N){F[0]?$?$.p(F,N):($=b1(F),$.c(),$.m(d,null)):$&&($.d(1),$=null);let W=w;w=I(F),w===W?z[w].p(F,N):(tn(),Z(z[W],1,1,()=>{z[W]=null}),nn(),T=z[w],T?T.p(F,N):(T=z[w]=D[w](F),T.c()),j(T,1),T.m(e,null))},i(F){M||(j(t.$$.fragment,F),j(T),M=!0)},o(F){Z(t.$$.fragment,F),Z(T),M=!1},d(F){F&&V(e),ce(t),$&&$.d(),z[w].d()}}}function eE(r){let e,t;return e=new Th({props:{properties:r[10]}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function tE(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[eE,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function nE(r){let e,t;return e=new Th({props:{properties:r[10]}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function rE(r){let e,t,n;return t=new hi({props:{openOn:"hover",$$slots:{default:[nE,({props:i})=>({10:i}),({props:i})=>i?1024:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","line-popup")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o&3072&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function iE(r){let e,t,n,i,o,c,a,d,p,_;e=new Ad({}),n=new Id({}),o=new Pd({});const y=[gn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let w={$$slots:{default:[tE]},$$scope:{ctx:r}};for(let T=0;T<y.length;T+=1)w=Ot(w,y[T]);return a=new wl({props:w}),p=new Ah({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[rE]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment),d=ie(),he(p.$$.fragment)},m(T,M){le(e,T,M),q(T,t,M),le(n,T,M),q(T,i,M),le(o,T,M),q(T,c,M),le(a,T,M),q(T,d,M),le(p,T,M),_=!0},p(T,M){const $={};M&2048&&($.$$scope={dirty:M,ctx:T}),a.$set($);const D={};M&2048&&(D.$$scope={dirty:M,ctx:T}),p.$set(D)},i(T){_||(j(e.$$.fragment,T),j(n.$$.fragment,T),j(o.$$.fragment,T),j(a.$$.fragment,T),j(p.$$.fragment,T),_=!0)},o(T){Z(e.$$.fragment,T),Z(n.$$.fragment,T),Z(o.$$.fragment,T),Z(a.$$.fragment,T),Z(p.$$.fragment,T),_=!1},d(T){T&&(V(t),V(i),V(c),V(d)),ce(e,T),ce(n,T),ce(o,T),ce(a,T),ce(p,T)}}}function oE(r){let e,t;return e=new Th({props:{properties:r[10]}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function sE(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[oE,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function aE(r){let e,t;return e=new Th({props:{properties:r[10]}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.properties=n[10]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function lE(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[aE,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function cE(r){var o,c,a;let e,t;const n=[gn("debug-intersections"),{paint:{"circle-radius":dm(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Jn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((a=(c=(o=r[0])==null?void 0:o.feature)==null?void 0:c.properties)==null?void 0:a.intersection_id)??-1],.3,Jn(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[lE]},$$scope:{ctx:r}};for(let d=0;d<n.length;d+=1)i=Ot(i,n[d]);return e=new wl({props:i}),e.$on("click",r[3]),{c(){he(e.$$.fragment)},m(d,p){le(e,d,p),t=!0},p(d,p){var y,w,T;const _=p&1?Vn(n,[n[0],{paint:{"circle-radius":dm(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Jn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((T=(w=(y=d[0])==null?void 0:y.feature)==null?void 0:w.properties)==null?void 0:T.intersection_id)??-1],.3,Jn(0,.5)]}},n[2],n[3]]):{};p&2048&&(_.$$scope={dirty:p,ctx:d}),e.$set(_)},i(d){t||(j(e.$$.fragment,d),t=!0)},o(d){Z(e.$$.fragment,d),t=!1},d(d){ce(e,d)}}}function v1(r){let e,t;return e=new pr({props:{data:r[0].movements,generateId:!0,$$slots:{default:[uE]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&2049&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function uE(r){let e,t,n,i;const o=[gn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let c={};for(let p=0;p<o.length;p+=1)c=Ot(c,o[p]);e=new rr({props:c});const a=[gn("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<a.length;p+=1)d=Ot(d,a[p]);return n=new zi({props:d}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),i=!0},p(p,_){const y={};e.$set(y);const w=_&1?Vn(a,[a[0],{filter:["==",["id"],p[0].movementIdx]},a[2]]):{};n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),ce(e,p),ce(n,p)}}}function hE(r){let e,t,n,i,o,c,a,d;t=new Ph({props:{$$slots:{default:[iE]},$$scope:{ctx:r}}}),i=new Oa({props:{$$slots:{default:[sE]},$$scope:{ctx:r}}}),c=new pr({props:{data:vr(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[cE]},$$scope:{ctx:r}}});let p=r[0]&&v1(r);return{c(){e=U("div"),he(t.$$.fragment),n=ie(),he(i.$$.fragment),o=ie(),he(c.$$.fragment),a=ie(),p&&p.c(),fe(e,"slot","map")},m(_,y){q(_,e,y),le(t,e,null),R(e,n),le(i,e,null),R(e,o),le(c,e,null),R(e,a),p&&p.m(e,null),d=!0},p(_,y){const w={};y&2048&&(w.$$scope={dirty:y,ctx:_}),t.$set(w);const T={};y&2048&&(T.$$scope={dirty:y,ctx:_}),i.$set(T);const M={};y&2&&(M.data=vr(_[1]).getAllIntersections()),y&2049&&(M.$$scope={dirty:y,ctx:_}),c.$set(M),_[0]?p?(p.p(_,y),y&1&&j(p,1)):(p=v1(_),p.c(),j(p,1),p.m(e,null)):p&&(tn(),Z(p,1,1,()=>{p=null}),nn())},i(_){d||(j(t.$$.fragment,_),j(i.$$.fragment,_),j(c.$$.fragment,_),j(p),d=!0)},o(_){Z(t.$$.fragment,_),Z(i.$$.fragment,_),Z(c.$$.fragment,_),Z(p),d=!1},d(_){_&&V(e),ce(t),ce(i),ce(c),p&&p.d()}}}function fE(r){let e,t;return e=new bo({props:{$$slots:{map:[hE],sidebar:[QL],top:[XL]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&2055&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function dE(r,e,t){let n,i;at(r,Ar,T=>t(1,n=T)),at(r,an,T=>t(2,i=T));let o=null;function c(T){let M=T.detail.features[0],$=n.getMovements(M.properties.intersection_id);t(0,o={feature:M,movements:$,movementIdx:0})}const a=(T,M)=>window.open(vr(T.properties).way,"_blank"),d=()=>Nt(an,i={mode:"neighbourhood"},i),p=()=>t(0,o=null);function _(T){r.$$.not_equal(o.movementIdx,T)&&(o.movementIdx=T,t(0,o))}return[o,n,i,c,a,d,p,_,()=>Nt(an,i={mode:"pick-neighbourhood"},i),()=>Nt(an,i={mode:"neighbourhood"},i)]}class pE extends Et{constructor(e){super(),Lt(this,e,dE,fE,wt,{})}}const w1="/ltn/assets/one_way_left-9368d5dd.svg",mE="/ltn/assets/traffic_1-a90740ec.svg";var Lo=63710088e-1,jv={centimeters:Lo*100,centimetres:Lo*100,degrees:360/(2*Math.PI),feet:Lo*3.28084,inches:Lo*39.37,kilometers:Lo/1e3,kilometres:Lo/1e3,meters:Lo,metres:Lo,miles:Lo/1609.344,millimeters:Lo*1e3,millimetres:Lo*1e3,nauticalmiles:Lo/1852,radians:1,yards:Lo*1.0936};function gE(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Im(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!x1(r[0])||!x1(r[1]))throw new Error("coordinates must contain numbers");return gE({type:"Point",coordinates:r},e,t)}function _E(r,e="kilometers"){const t=jv[e];if(!t)throw new Error(e+" units is invalid");return r*t}function yE(r,e="kilometers"){const t=jv[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Am(r){return r%(2*Math.PI)*180/Math.PI}function fs(r){return r%360*Math.PI/180}function x1(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function xh(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function bE(r){return r.type==="Feature"?r.geometry:r}function Uv(r,e,t={}){if(t.final===!0)return vE(r,e);const n=xh(r),i=xh(e),o=fs(n[0]),c=fs(i[0]),a=fs(n[1]),d=fs(i[1]),p=Math.sin(c-o)*Math.cos(d),_=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(c-o);return Am(Math.atan2(p,_))}function vE(r,e){let t=Uv(e,r);return t=(t+180)%360,t}function wE(r,e,t,n={}){const i=xh(r),o=fs(i[0]),c=fs(i[1]),a=fs(t),d=yE(e,n.units),p=Math.asin(Math.sin(c)*Math.cos(d)+Math.cos(c)*Math.sin(d)*Math.cos(a)),_=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(c),Math.cos(d)-Math.sin(c)*Math.sin(p)),y=Am(_),w=Am(p);return Im([y,w],n.properties)}function xE(r,e,t={}){var n=xh(r),i=xh(e),o=fs(i[1]-n[1]),c=fs(i[0]-n[0]),a=fs(n[1]),d=fs(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(c/2),2)*Math.cos(a)*Math.cos(d);return _E(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function kE(r,e,t={}){const i=bE(r).coordinates;let o=0;for(let c=0;c<i.length&&!(e>=o&&c===i.length-1);c++)if(o>=e){const a=e-o;if(a){const d=Uv(i[c],i[c-1])-180;return wE(i[c],a,d,t)}else return Im(i[c])}else o+=xE(i[c],i[c+1],t);return Im(i[i.length-1])}var SE=kE;function CE(r){let e,t;const n=[gn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new wl({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function TE(r){let e,t;return e=new pr({props:{data:r[0],$$slots:{default:[CE]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}let ME=50,LE=100,EE=.01;function IE(r,e,t){let{paths:n}=e,i=d(),o=p(),c=y(),a=setInterval(w,LE);Yr(()=>clearInterval(a));function d(){return n.features.map(T=>1/T.properties.directness).reduce((T,M)=>T+M,0)}function p(){return n.features.length==0?[]:Array.from({length:ME},_)}function _(){let T=Math.random()*i,M=0;for(let[$,D]of n.features.entries())if(M+=1/D.properties.directness,T<M)return{idx:$,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function y(){return{type:"FeatureCollection",features:o.map(({idx:T,distance:M})=>SE(n.features[T],M,{units:"kilometers"}))}}function w(){for(let[T,M]of o.entries())M.distance+=EE,M.distance>=n.features[M.idx].properties.length_meters/1e3&&(o[T]=_());t(0,c=y())}return r.$$set=T=>{"paths"in T&&t(1,n=T.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=d(),o=p())},[c,n]}class AE extends Et{constructor(e){super(),Lt(this,e,IE,TE,wt,{paths:1})}}class PE{constructor(e){tr(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function zE(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="+",t=ie(),n=U("img"),o=xe(`
    Add diagonal filter`),st(e,"font-size","200%"),st(e,"margin-top","-12px"),fe(e,"class","icon"),dr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||fe(n,"src",i),fe(n,"alt","Add diagonal filter"),st(n,"transform","rotate(135deg)"),fe(n,"class","svelte-j2s60j")},m(c,a){q(c,e,a),q(c,t,a),q(c,n,a),q(c,o,a)},p:tt,d(c){c&&(V(e),V(t),V(n),V(o))}}}function DE(r){let e;function t(o,c){return o[0].hasRotatedFilter?RE:$E}let n=t(r),i=n(r);return{c(){i.c(),e=Qn()},m(o,c){i.m(o,c),q(o,e,c)},p(o,c){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i.d(o)}}}function $E(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="",t=ie(),n=U("img"),o=xe(`
      Rotate diagonal filter`),st(e,"font-size","200%"),st(e,"padding-bottom","4px"),fe(e,"class","icon"),dr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||fe(n,"src",i),fe(n,"alt","Rotate diagonal filter"),st(n,"transform","rotate(45deg)"),fe(n,"class","svelte-j2s60j")},m(c,a){q(c,e,a),q(c,t,a),q(c,n,a),q(c,o,a)},d(c){c&&(V(e),V(t),V(n),V(o))}}}function RE(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="",t=ie(),n=U("img"),o=xe(`
      Delete diagonal filter`),fe(e,"class","icon"),dr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||fe(n,"src",i),fe(n,"alt","Remove diagonal filter"),st(n,"transform","rotate(45deg)"),fe(n,"class","svelte-j2s60j")},m(c,a){q(c,e,a),q(c,t,a),q(c,n,a),q(c,o,a)},d(c){c&&(V(e),V(t),V(n),V(o))}}}function FE(r){let e;function t(o,c){return o[0].filter?DE:zE}let n=t(r),i=n(r);return{c(){e=U("div"),i.c(),st(e,"display","flex"),st(e,"align-items","center")},m(o,c){q(o,e,c),i.m(e,null)},p(o,[c]){n===(n=t(o))&&i?i.p(o,c):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:tt,o:tt,d(o){o&&V(e),i.d()}}}function BE(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class OE extends Et{constructor(e){super(),Lt(this,e,BE,FE,wt,{intersection:0})}}function NE(r){let e,t;return e=new OE({props:{intersection:r[2](r[6])}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.intersection=n[2](n[6])),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function jE(r){let e,t;return e=new Wb({props:{openOn:"hover",$$slots:{default:[NE,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function UE(r){let e,t;const n=[gn("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":dm(30),"circle-color":yo.mapFeature.hover.backgroundColor,"circle-opacity":Jn(0,.5),"circle-stroke-color":yo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Jn(0,3)}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[jE]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new wl({props:i}),e.$on("click",r[4]),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,[c]){const a=c&2?Vn(n,[n[0],n[1],n[2],n[3],{interactive:o[1]},n[5],n[6]]):{};c&128&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function VE(r,e,t){let{neighbourhood:n=Sh("neighbourhoodGj")}=e,{onClickIntersection:i=p=>{}}=e,{interactive:o=!1}=e;function c(p){let _=n.features[p];return new PE(_)}function a(p){return c(p[0].id)}const d=p=>i(a(p.detail.features));return r.$$set=p=>{"neighbourhood"in p&&t(3,n=p.neighbourhood),"onClickIntersection"in p&&t(0,i=p.onClickIntersection),"interactive"in p&&t(1,o=p.interactive)},[i,o,a,n,d]}class qE extends Et{constructor(e){super(),Lt(this,e,VE,UE,wt,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function k1(r,e,t){const n=r.slice();return n[6]=e[t],n}function S1(r){let e,t,n,i,o,c,a=r[6].label+"",d,p,_,y,w;function T(){return r[3](r[6])}return{c(){e=U("button"),t=U("img"),i=ie(),o=U("br"),c=ie(),d=xe(a),p=ie(),dr(t.src,n=r[6].iconURL)||fe(t,"src",n),fe(t,"width","80"),fe(t,"alt",r[6].label),fe(e,"class","outline"),st(e,"width","100%"),e.disabled=_=r[1]==r[6].filterType},m(M,$){q(M,e,$),R(e,t),R(e,i),R(e,o),R(e,c),R(e,d),R(e,p),y||(w=xt(e,"click",T),y=!0)},p(M,$){r=M,$&2&&_!==(_=r[1]==r[6].filterType)&&(e.disabled=_)},d(M){M&&V(e),y=!1,w()}}}function ZE(r){let e,t,n,i,o,c,a,d,p,_,y,w,T=r[2].description+"",M,$,D,z,I,F,N=Nn(ao.allTypes),W=[];for(let oe=0;oe<N.length;oe+=1)W[oe]=S1(k1(r,N,oe));return{c(){e=U("h3"),e.textContent="Choose a modal filter to place on streets",t=ie(),n=U("table"),i=U("tr"),o=U("td");for(let oe=0;oe<W.length;oe+=1)W[oe].c();c=ie(),a=U("td"),d=U("img"),y=ie(),w=U("p"),M=xe(T),$=ie(),D=U("center"),z=U("button"),z.textContent="Confirm",dr(d.src,p=r[2].largeImageURL)||fe(d,"src",p),fe(d,"height","300"),fe(d,"alt",_=r[2].label)},m(oe,J){q(oe,e,J),q(oe,t,J),q(oe,n,J),R(n,i),R(i,o);for(let ee=0;ee<W.length;ee+=1)W[ee]&&W[ee].m(o,null);R(i,c),R(i,a),R(a,d),R(a,y),R(a,w),R(w,M),q(oe,$,J),q(oe,D,J),R(D,z),I||(F=xt(z,"click",r[4]),I=!0)},p(oe,J){if(J&2){N=Nn(ao.allTypes);let ee;for(ee=0;ee<N.length;ee+=1){const pe=k1(oe,N,ee);W[ee]?W[ee].p(pe,J):(W[ee]=S1(pe),W[ee].c(),W[ee].m(o,null))}for(;ee<W.length;ee+=1)W[ee].d(1);W.length=N.length}J&4&&!dr(d.src,p=oe[2].largeImageURL)&&fe(d,"src",p),J&4&&_!==(_=oe[2].label)&&fe(d,"alt",_),J&4&&T!==(T=oe[2].description+"")&&Mt(M,T)},d(oe){oe&&(V(e),V(t),V(n),V($),V(D)),pi(W,oe),I=!1,F()}}}function GE(r){let e,t,n;function i(c){r[5](c)}let o={$$slots:{default:[ZE]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new yd({props:o}),hn.push(()=>An(e,"show",i)),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,[a]){const d={};a&519&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.show=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function HE(r,e,t){let n,i;at(r,om,p=>t(1,i=p));let{show:o}=e;const c=p=>Nt(om,i=p.filterType,i),a=()=>t(0,o=!1);function d(p){o=p,t(0,o)}return r.$$set=p=>{"show"in p&&t(0,o=p.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=ao.allTypes.find(p=>p.filterType==i))},[o,i,n,c,a,d]}class WE extends Et{constructor(e){super(),Lt(this,e,HE,GE,wt,{show:0})}}function C1(r){let e,t;return e=new pr({props:{data:r[0],$$slots:{default:[KE]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function KE(r){let e,t;const n=[gn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function XE(r){let e,t,n=r[0]&&C1(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=C1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function JE(r,e,t){let{map:n}=e,i=null;const o=ms();n.on("dragstart",c),n.on("mousemove",a),n.on("mouseup",d),Yr(()=>{n.dragPan.enable(),n.off("dragstart",c),n.off("mousemove",a),n.off("mouseup",d)});function c(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(p){i&&(i.geometry.coordinates.push(p.lngLat.toArray()),t(0,i))}function d(){i&&(o("done",i),t(0,i=null))}return r.$$set=p=>{"map"in p&&t(1,n=p.map)},[i,n]}class YE extends Et{constructor(e){super(),Lt(this,e,JE,XE,wt,{map:1})}}function QE(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function eI(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function tI(r){let e;return{c(){e=U("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function nI(r){let e;return{c(){e=xe("View shortcuts")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function rI(r){let e;return{c(){e=xe("Route")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function iI(r){let e;return{c(){e=xe("Impact routing to one destination")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function oI(r){let e;return{c(){e=xe("Change this boundary")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function T1(r){let e,t,n;return t=new On({props:{$$slots:{default:[sI]},$$scope:{ctx:r}}}),t.$on("click",r[41]),{c(){e=U("li"),he(t.$$.fragment)},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o[1]&16384&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function sI(r){let e;return{c(){e=xe("Debug")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function aI(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe,J,ee,pe,Ie,Q,ae;o=new On({props:{$$slots:{default:[QE]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[eI]},$$scope:{ctx:r}}}),d.$on("click",r[36]),w=new Xm({props:{$$slots:{default:[tI]},$$scope:{ctx:r}}}),z=new On({props:{$$slots:{default:[nI]},$$scope:{ctx:r}}}),z.$on("click",r[37]),N=new On({props:{$$slots:{default:[rI]},$$scope:{ctx:r}}}),N.$on("click",r[38]),J=new On({props:{$$slots:{default:[iI]},$$scope:{ctx:r}}}),J.$on("click",r[39]),Ie=new On({props:{$$slots:{default:[oI]},$$scope:{ctx:r}}}),Ie.$on("click",r[40]);let Pe=r[13]&&T1(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),y=xe(`Editing
          `),he(w.$$.fragment),T=ie(),M=U("nav"),$=U("ul"),D=U("li"),he(z.$$.fragment),I=ie(),F=U("li"),he(N.$$.fragment),W=ie(),oe=U("li"),he(J.$$.fragment),ee=ie(),pe=U("li"),he(Ie.$$.fragment),Q=ie(),Pe&&Pe.c(),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top"),st(e,"display","flex"),st(e,"justify-content","space-between")},m(ve,nt){q(ve,e,nt),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),R(_,y),le(w,_,null),R(e,T),R(e,M),R(M,$),R($,D),le(z,D,null),R($,I),R($,F),le(N,F,null),R($,W),R($,oe),le(J,oe,null),R($,ee),R($,pe),le(Ie,pe,null),R($,Q),Pe&&Pe.m($,null),ae=!0},p(ve,nt){const Ge={};nt[1]&16384&&(Ge.$$scope={dirty:nt,ctx:ve}),o.$set(Ge);const Ee={};nt[1]&16384&&(Ee.$$scope={dirty:nt,ctx:ve}),d.$set(Ee);const De={};nt[1]&16384&&(De.$$scope={dirty:nt,ctx:ve}),w.$set(De);const Ct={};nt[1]&16384&&(Ct.$$scope={dirty:nt,ctx:ve}),z.$set(Ct);const it={};nt[1]&16384&&(it.$$scope={dirty:nt,ctx:ve}),N.$set(it);const lt={};nt[1]&16384&&(lt.$$scope={dirty:nt,ctx:ve}),J.$set(lt);const mt={};nt[1]&16384&&(mt.$$scope={dirty:nt,ctx:ve}),Ie.$set(mt),ve[13]?Pe?(Pe.p(ve,nt),nt[0]&8192&&j(Pe,1)):(Pe=T1(ve),Pe.c(),j(Pe,1),Pe.m($,null)):Pe&&(tn(),Z(Pe,1,1,()=>{Pe=null}),nn())},i(ve){ae||(j(o.$$.fragment,ve),j(d.$$.fragment,ve),j(w.$$.fragment,ve),j(z.$$.fragment,ve),j(N.$$.fragment,ve),j(J.$$.fragment,ve),j(Ie.$$.fragment,ve),j(Pe),ae=!0)},o(ve){Z(o.$$.fragment,ve),Z(d.$$.fragment,ve),Z(w.$$.fragment,ve),Z(z.$$.fragment,ve),Z(N.$$.fragment,ve),Z(J.$$.fragment,ve),Z(Ie.$$.fragment,ve),Z(Pe),ae=!1},d(ve){ve&&V(e),ce(o),ce(d),ce(w),ce(z),ce(N),ce(J),ce(Ie),Pe&&Pe.d()}}}function M1(r){let e;return{c(){e=U("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function lI(r){let e,t,n,i,o;return{c(){e=U("h3"),e.textContent="Reclassify main roads",t=ie(),n=U("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically using
          data from
          <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=ie(),o=U("p"),o.textContent=`Main roads are typically better suited to support higher levels of
          traffic than neighbourhood roads.`},m(c,a){q(c,e,a),q(c,t,a),q(c,n,a),q(c,i,a),q(c,o,a)},p:tt,i:tt,o:tt,d(c){c&&(V(e),V(t),V(n),V(i),V(o))}}}function cI(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Restrict turns",t=ie(),n=U("p"),n.textContent=`To restrict certain turns, first click on the source road, then the
          destination road. Traffic will no longer be able to turn from the
          source road to the destination road.`},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p:tt,i:tt,o:tt,d(i){i&&(V(e),V(t),V(n))}}}function uI(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Toggle one-way",t=ie(),n=U("p"),n.textContent=`Click on a road segment to toggle its direction. This will change the
          direction of traffic flow on that road.`},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p:tt,i:tt,o:tt,d(i){i&&(V(e),V(t),V(n))}}}function hI(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I;function F(W){r[30](W)}let N={};return r[3]!==void 0&&(N.show=r[3]),o=new WE({props:N}),hn.push(()=>An(o,"show",F)),T=new Ok({}),{c(){e=U("h3"),e.textContent="Add modal filter",t=ie(),n=U("p"),n.textContent=`Modal filters restrict what kind of traffic can pass through a road
          segment. Place them strategically to deter shortcuts through your
          neighbourhood.`,i=ie(),he(o.$$.fragment),a=ie(),d=U("div"),p=U("button"),p.textContent="Change modal filter type",_=ie(),y=U("button"),w=U("div"),he(T.$$.fragment),M=ie(),$=U("span"),$.textContent="Add along a line",fe(p,"class","outline"),st(w,"display","flex"),st(w,"align-items","center"),st(w,"gap","8px"),fe(y,"data-tooltip","Add many modal filters along a line"),en(y,"active",r[0].freehand),en(y,"outline",!r[0].freehand),st(d,"display","flex"),st(d,"gap","8px"),st(d,"align-items","center")},m(W,oe){q(W,e,oe),q(W,t,oe),q(W,n,oe),q(W,i,oe),le(o,W,oe),q(W,a,oe),q(W,d,oe),R(d,p),R(d,_),R(d,y),R(y,w),le(T,w,null),R(w,M),R(w,$),D=!0,z||(I=[xt(p,"click",r[31]),xt(y,"click",function(){bl(r[0].freehand?r[32]:r[33])&&(r[0].freehand?r[32]:r[33]).apply(this,arguments)})],z=!0)},p(W,oe){r=W;const J={};!c&&oe[0]&8&&(c=!0,J.show=r[3],In(()=>c=!1)),o.$set(J),(!D||oe[0]&1)&&en(y,"active",r[0].freehand),(!D||oe[0]&1)&&en(y,"outline",!r[0].freehand)},i(W){D||(j(o.$$.fragment,W),j(T.$$.fragment,W),D=!0)},o(W){Z(o.$$.fragment,W),Z(T.$$.fragment,W),D=!1},d(W){W&&(V(e),V(t),V(n),V(i),V(a),V(d)),ce(o,W),ce(T),z=!1,mr(I)}}}function L1(r){let e,t;return e=new Oo({props:{colorScale:lv,labels:{limits:cv}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function fI(r){let e,t,n=vr(r[6]).properties.name+"",i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe,J,ee,pe,Ie,Q,ae,Pe,ve,nt,Ge,Ee,De,Ct,it,lt,mt,dt,Xe,$t,yt,Rt,It,Qt,yn,ut,Wt,Ze,Ve,St,Ut,_e,Pn,Ne,et,Kt,er,ur,gr,Qr,ei,co,hr,bt,Bn,xr,uo,Rn=r[8]>0&&M1();Ge=new r3({}),lt=new Wk({});const Pt=[hI,uI,cI,lI],fn=[];function mn(ln,Gt){return ln[0].kind=="filter"?0:ln[0].kind=="oneway"?1:ln[0].kind=="turn_restriction"?2:ln[0].kind=="main-roads"?3:-1}~(yt=mn(r))&&(Rt=fn[yt]=Pt[yt](r));let wn=r[11]=="speeds"&&L1();return bt=new Fv({props:{neighbourhoodBoundary:vr(r[6])}}),{c(){e=U("div"),t=U("h1"),i=xe(n),o=ie(),Rn&&Rn.c(),c=ie(),a=U("h2"),a.textContent="Editing tools",d=ie(),p=U("div"),_=U("div"),y=U("button"),w=U("img"),$=ie(),D=U("button"),z=U("div"),z.innerHTML=`<img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${w1}" alt="Reverse directions" class="svelte-1x77jt8"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${w1}" alt="Reverse directions" class="svelte-1x77jt8"/>`,F=ie(),N=U("button"),W=U("img"),ee=ie(),pe=U("button"),Ie=U("img"),Pe=ie(),ve=U("div"),nt=U("button"),he(Ge.$$.fragment),Ct=ie(),it=U("button"),he(lt.$$.fragment),Xe=ie(),$t=U("div"),Rt&&Rt.c(),It=ie(),Qt=U("h2"),Qt.textContent="Map style",yn=ie(),ut=U("label"),Wt=U("input"),Ze=xe(`
      Animate shortcuts`),Ve=ie(),St=U("p"),St.innerHTML=`<i>Shortcuts</i>
      are routes from one main road to another, which cut through the neighborhood&#39;s
      interior.`,Ut=ie(),_e=U("div"),Pn=U("label"),Ne=xe(`Draw roads:
        `),et=U("select"),Kt=U("option"),Kt.textContent="Worst shortcuts",er=U("option"),er.textContent="Cell",ur=U("option"),ur.textContent="Edits (either filter or direction)",gr=U("option"),gr.textContent="Speed limit",Qr=ie(),wn&&wn.c(),ei=ie(),co=U("h2"),co.textContent="Neighbourhood stats",hr=ie(),he(bt.$$.fragment),dr(w.src,T=vr(ao.getFilter(r[9])).iconURL)||fe(w,"src",T),fe(w,"alt","Add a modal filter"),fe(w,"class","svelte-1x77jt8"),y.disabled=M=r[0].kind=="filter",fe(y,"class","icon-btn svelte-1x77jt8"),fe(y,"data-tooltip","Add a modal filter (hotkey 1)"),en(y,"active",r[0].kind=="filter"),en(y,"outline",r[0].kind!="filter"),st(z,"height","100%"),st(z,"width","100%"),st(z,"position","relative"),D.disabled=I=r[0].kind=="oneway",fe(D,"class","icon-btn svelte-1x77jt8"),fe(D,"data-tooltip","Toggle one-way (hotkey 3)"),en(D,"active",r[0].kind=="oneway"),en(D,"outline",r[0].kind!="oneway"),dr(W.src,oe="/ltn//filters/no_right_turn.svg")||fe(W,"src",oe),fe(W,"alt","Restrict turns"),fe(W,"class","svelte-1x77jt8"),N.disabled=J=r[0].kind=="turn_restriction",fe(N,"class","icon-btn svelte-1x77jt8"),fe(N,"data-tooltip","Restrict turns (hotkey 4)"),en(N,"active",r[0].kind=="turn_restriction"),en(N,"outline",r[0].kind!="turn_restriction"),dr(Ie.src,Q=mE)||fe(Ie,"src",Q),fe(Ie,"alt","Change main/minor roads"),fe(Ie,"class","svelte-1x77jt8"),pe.disabled=ae=r[0].kind=="main-roads",fe(pe,"class","icon-btn svelte-1x77jt8"),fe(pe,"data-tooltip","Reclassify main roads (hotkey 5)"),en(pe,"active",r[0].kind=="main-roads"),en(pe,"outline",r[0].kind!="main-roads"),st(_,"display","flex"),st(_,"justify-content","left"),st(_,"gap","8px"),fe(nt,"class","outline icon-btn svelte-1x77jt8"),nt.disabled=Ee=r[4]==0,fe(nt,"data-tooltip",De=r[4]==0?"Undo Ctrl+Z":`Undo (${r[4]}) Ctrl+Z`),fe(it,"class","outline icon-btn svelte-1x77jt8"),it.disabled=mt=r[5]==0,fe(it,"data-tooltip",dt=r[5]==0?"Redo Ctrl+Y":`Redo (${r[5]}) Ctrl+Y`),st(ve,"display","flex"),st(ve,"justify-content","right"),st(ve,"gap","8px"),fe(p,"class","tool-palette svelte-1x77jt8"),st(p,"height","54px"),st(p,"display","flex"),st(p,"justify-content","space-between"),st(p,"gap","32px"),st($t,"min-height","200px"),st($t,"padding-bottom","16px"),st($t,"border-bottom","solid var(--pico-muted-border-color) 1px"),fe(Wt,"type","checkbox"),Kt.__value="shortcuts",Wn(Kt,Kt.__value),er.__value="cells",Wn(er,er.__value),ur.__value="edits",Wn(ur,ur.__value),gr.__value="speeds",Wn(gr,gr.__value),r[11]===void 0&&us(()=>r[35].call(et)),st(_e,"border","1px solid black"),st(_e,"padding","4px"),fe(e,"slot","sidebar")},m(ln,Gt){q(ln,e,Gt),R(e,t),R(t,i),R(e,o),Rn&&Rn.m(e,null),R(e,c),R(e,a),R(e,d),R(e,p),R(p,_),R(_,y),R(y,w),R(_,$),R(_,D),R(D,z),R(_,F),R(_,N),R(N,W),R(_,ee),R(_,pe),R(pe,Ie),R(p,Pe),R(p,ve),R(ve,nt),le(Ge,nt,null),R(ve,Ct),R(ve,it),le(lt,it,null),R(e,Xe),R(e,$t),~yt&&fn[yt].m($t,null),R(e,It),R(e,Qt),R(e,yn),R(e,ut),R(ut,Wt),Wt.checked=r[10],R(ut,Ze),R(e,Ve),R(e,St),R(e,Ut),R(e,_e),R(_e,Pn),R(Pn,Ne),R(Pn,et),R(et,Kt),R(et,er),R(et,ur),R(et,gr),Zi(et,r[11],!0),R(_e,Qr),wn&&wn.m(_e,null),R(e,ei),R(e,co),R(e,hr),le(bt,e,null),Bn=!0,xr||(uo=[xt(y,"click",r[26]),xt(D,"click",r[27]),xt(N,"click",r[28]),xt(pe,"click",r[29]),xt(nt,"click",r[22]),xt(it,"click",r[23]),xt(Wt,"change",r[34]),xt(et,"change",r[35])],xr=!0)},p(ln,Gt){(!Bn||Gt[0]&64)&&n!==(n=vr(ln[6]).properties.name+"")&&Mt(i,n),ln[8]>0?Rn||(Rn=M1(),Rn.c(),Rn.m(e,c)):Rn&&(Rn.d(1),Rn=null),(!Bn||Gt[0]&512&&!dr(w.src,T=vr(ao.getFilter(ln[9])).iconURL))&&fe(w,"src",T),(!Bn||Gt[0]&1&&M!==(M=ln[0].kind=="filter"))&&(y.disabled=M),(!Bn||Gt[0]&1)&&en(y,"active",ln[0].kind=="filter"),(!Bn||Gt[0]&1)&&en(y,"outline",ln[0].kind!="filter"),(!Bn||Gt[0]&1&&I!==(I=ln[0].kind=="oneway"))&&(D.disabled=I),(!Bn||Gt[0]&1)&&en(D,"active",ln[0].kind=="oneway"),(!Bn||Gt[0]&1)&&en(D,"outline",ln[0].kind!="oneway"),(!Bn||Gt[0]&1&&J!==(J=ln[0].kind=="turn_restriction"))&&(N.disabled=J),(!Bn||Gt[0]&1)&&en(N,"active",ln[0].kind=="turn_restriction"),(!Bn||Gt[0]&1)&&en(N,"outline",ln[0].kind!="turn_restriction"),(!Bn||Gt[0]&1&&ae!==(ae=ln[0].kind=="main-roads"))&&(pe.disabled=ae),(!Bn||Gt[0]&1)&&en(pe,"active",ln[0].kind=="main-roads"),(!Bn||Gt[0]&1)&&en(pe,"outline",ln[0].kind!="main-roads"),(!Bn||Gt[0]&16&&Ee!==(Ee=ln[4]==0))&&(nt.disabled=Ee),(!Bn||Gt[0]&16&&De!==(De=ln[4]==0?"Undo Ctrl+Z":`Undo (${ln[4]}) Ctrl+Z`))&&fe(nt,"data-tooltip",De),(!Bn||Gt[0]&32&&mt!==(mt=ln[5]==0))&&(it.disabled=mt),(!Bn||Gt[0]&32&&dt!==(dt=ln[5]==0?"Redo Ctrl+Y":`Redo (${ln[5]}) Ctrl+Y`))&&fe(it,"data-tooltip",dt);let Ci=yt;yt=mn(ln),yt===Ci?~yt&&fn[yt].p(ln,Gt):(Rt&&(tn(),Z(fn[Ci],1,1,()=>{fn[Ci]=null}),nn()),~yt?(Rt=fn[yt],Rt?Rt.p(ln,Gt):(Rt=fn[yt]=Pt[yt](ln),Rt.c()),j(Rt,1),Rt.m($t,null)):Rt=null),Gt[0]&1024&&(Wt.checked=ln[10]),Gt[0]&2048&&Zi(et,ln[11]),ln[11]=="speeds"?wn?Gt[0]&2048&&j(wn,1):(wn=L1(),wn.c(),j(wn,1),wn.m(_e,null)):wn&&(tn(),Z(wn,1,1,()=>{wn=null}),nn());const _r={};Gt[0]&64&&(_r.neighbourhoodBoundary=vr(ln[6])),bt.$set(_r)},i(ln){Bn||(j(Ge.$$.fragment,ln),j(lt.$$.fragment,ln),j(Rt),j(wn),j(bt.$$.fragment,ln),Bn=!0)},o(ln){Z(Ge.$$.fragment,ln),Z(lt.$$.fragment,ln),Z(Rt),Z(wn),Z(bt.$$.fragment,ln),Bn=!1},d(ln){ln&&V(e),Rn&&Rn.d(),ce(Ge),ce(lt),~yt&&fn[yt].d(),wn&&wn.d(),ce(bt),xr=!1,mr(uo)}}}function dI(r){let e,t,n=(r[44].name??"unnamed road")+"",i,o,c=Math.round(r[44].speed_mph)+"",a,d;return{c(){e=U("p"),t=xe("Main road: "),i=xe(n),o=xe(`
                (`),a=xe(c),d=xe(" mph)")},m(p,_){q(p,e,_),R(e,t),R(e,i),R(e,o),R(e,a),R(e,d)},p(p,_){_[1]&8192&&n!==(n=(p[44].name??"unnamed road")+"")&&Mt(i,n),_[1]&8192&&c!==(c=Math.round(p[44].speed_mph)+"")&&Mt(a,c)},d(p){p&&V(e)}}}function pI(r){let e,t=r[44].shortcuts+"",n,i,o=(r[44].name??"unnamed road")+"",c,a,d=Math.round(r[44].speed_mph)+"",p,_;return{c(){e=U("p"),n=xe(t),i=xe(" shortcuts through "),c=xe(o),a=xe(`
                (`),p=xe(d),_=xe(" mph)")},m(y,w){q(y,e,w),R(e,n),R(e,i),R(e,c),R(e,a),R(e,p),R(e,_)},p(y,w){w[1]&8192&&t!==(t=y[44].shortcuts+"")&&Mt(n,t),w[1]&8192&&o!==(o=(y[44].name??"unnamed road")+"")&&Mt(c,o),w[1]&8192&&d!==(d=Math.round(y[44].speed_mph)+"")&&Mt(p,d)},d(y){y&&V(e)}}}function mI(r){let e;return{c(){e=U("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function gI(r){let e;return{c(){e=U("p"),e.textContent="Click to designate a main road or not"},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function _I(r){let e;return{c(){e=U("p"),e.textContent="Click to change direction"},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function yI(r){let e,t,n,i;return{c(){e=U("div"),t=U("img"),i=xe(`
                Click to add modal filter`),dr(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||fe(t,"src",n),fe(t,"width","20"),fe(t,"alt","Add modal filter")},m(o,c){q(o,e,c),R(e,t),R(e,i)},p(o,c){c[0]&512&&!dr(t.src,n=`/ltn//filters/${o[9]}_icon.gif`)&&fe(t,"src",n)},d(o){o&&V(e)}}}function bI(r){let e,t;function n(p,_){if(p[44].kind=="interior_road")return pI;if(p[44].kind=="main_road")return dI}let i=n(r),o=i&&i(r);function c(p,_){if(p[0].kind=="filter")return yI;if(p[0].kind=="oneway")return _I;if(p[0].kind=="main-roads")return gI;if(p[0].kind=="turn_restriction")return mI}let a=c(r),d=a&&a(r);return{c(){o&&o.c(),e=ie(),d&&d.c(),t=Qn()},m(p,_){o&&o.m(p,_),q(p,e,_),d&&d.m(p,_),q(p,t,_)},p(p,_){i===(i=n(p))&&o?o.p(p,_):(o&&o.d(1),o=i&&i(p),o&&(o.c(),o.m(e.parentNode,e))),a===(a=c(p))&&d?d.p(p,_):(d&&d.d(1),d=a&&a(p),d&&(d.c(),d.m(t.parentNode,t)))},d(p){p&&(V(e),V(t)),o&&o.d(p),d&&d.d(p)}}}function vI(r){let e,t,n;return t=new hi({props:{openOn:"hover",$$slots:{default:[bI,({props:i})=>({44:i}),({props:i})=>[0,i?8192:0]]},$$scope:{ctx:r}}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","line-popup")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o[0]&513|o[1]&24576&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function wI(r){let e,t,n,i,o,c,a,d,p,_;return e=new Ad({}),n=new Id({}),o=new Pd({}),a=new Ah({props:{interactive:r[0].kind=="filter"||r[0].kind=="oneway"||r[0].kind=="main-roads"||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[15],$$slots:{"line-popup":[vI]},$$scope:{ctx:r}}}),p=new qE({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[20]}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment),d=ie(),he(p.$$.fragment)},m(y,w){le(e,y,w),q(y,t,w),le(n,y,w),q(y,i,w),le(o,y,w),q(y,c,w),le(a,y,w),q(y,d,w),le(p,y,w),_=!0},p(y,w){const T={};w[0]&1&&(T.interactive=y[0].kind=="filter"||y[0].kind=="oneway"||y[0].kind=="main-roads"||y[0].kind=="turn_restriction"&&y[0].from_road_id==null),w[0]&513|w[1]&16384&&(T.$$scope={dirty:w,ctx:y}),a.$set(T);const M={};w[0]&1&&(M.interactive=y[0].kind=="filter"),w[0]&2&&(M.neighbourhood=y[1]),p.$set(M)},i(y){_||(j(e.$$.fragment,y),j(n.$$.fragment,y),j(o.$$.fragment,y),j(a.$$.fragment,y),j(p.$$.fragment,y),_=!0)},o(y){Z(e.$$.fragment,y),Z(n.$$.fragment,y),Z(o.$$.fragment,y),Z(a.$$.fragment,y),Z(p.$$.fragment,y),_=!1},d(y){y&&(V(t),V(i),V(c),V(d)),ce(e,y),ce(n,y),ce(o,y),ce(a,y),ce(p,y)}}}function E1(r){let e,t;return e=new AE({props:{paths:r[7]}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.paths=n[7]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function xI(r){let e;return{c(){e=xe("Click to delete filter")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function kI(r){let e,t,n;return t=new hi({props:{openOn:"hover",$$slots:{default:[xI]},$$scope:{ctx:r}}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","modal-filter")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o[1]&16384&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function SI(r){let e;return{c(){e=xe("Click to delete turn restriction")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function CI(r){let e,t,n;return t=new hi({props:{openOn:"hover",$$slots:{default:[SI]},$$scope:{ctx:r}}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","turn-restriction")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o[1]&16384&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function I1(r){let e,t;return e=new YE({props:{map:vr(r[2])}}),e.$on("done",r[24]),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=vr(n[2])),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function A1(r){let e,t;return e=new pr({props:{data:r[0].possible_targets||Wi(),generateId:!0,$$slots:{default:[LI]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||Wi()),i[0]&1|i[1]&16384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function TI(r){let e,t,n,i,o=r[0].from_road_name+"",c,a,d=(r[44].name||"unnamed road")+"",p;return{c(){e=U("div"),t=U("img"),i=xe(`

              Create a turn restriction from `),c=xe(o),a=xe(" to "),p=xe(d),dr(t.src,n=`/ltn//filters/no_${r[44].kind}_turn.png`)||fe(t,"src",n),fe(t,"width","20"),fe(t,"alt","Add turn restriction")},m(_,y){q(_,e,y),R(e,t),R(e,i),R(e,c),R(e,a),R(e,p)},p(_,y){y[1]&8192&&!dr(t.src,n=`/ltn//filters/no_${_[44].kind}_turn.png`)&&fe(t,"src",n),y[0]&1&&o!==(o=_[0].from_road_name+"")&&Mt(c,o),y[1]&8192&&d!==(d=(_[44].name||"unnamed road")+"")&&Mt(p,d)},d(_){_&&V(e)}}}function MI(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[TI,({props:n})=>({44:n}),({props:n})=>[0,n?8192:0]]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&24576&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function LI(r){let e,t;const n=[gn("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":Jn(.5,1),"line-width":qs(1)}}];let i={$$slots:{default:[MI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),e.$on("click",r[17]),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};c[0]&1|c[1]&16384&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function EI(r){let e,t,n,i,o,c,a,d,p,_;t=new Hm({}),t.$on("click",r[16]),i=new Ph({props:{input:r[1],$$slots:{default:[wI]},$$scope:{ctx:r}}});let y=r[10]&&E1(r);a=new Oa({props:{onClickModalFilter:r[18],onClickTurnRestriction:r[19],$$slots:{"turn-restriction":[CI],"modal-filter":[kI]},$$scope:{ctx:r}}});let w=r[0].kind=="filter"&&r[0].freehand&&I1(r),T=r[0].kind=="turn_restriction"&&A1(r);return{c(){e=U("div"),he(t.$$.fragment),n=ie(),he(i.$$.fragment),o=ie(),y&&y.c(),c=ie(),he(a.$$.fragment),d=ie(),w&&w.c(),p=ie(),T&&T.c(),fe(e,"slot","map")},m(M,$){q(M,e,$),le(t,e,null),R(e,n),le(i,e,null),R(e,o),y&&y.m(e,null),R(e,c),le(a,e,null),R(e,d),w&&w.m(e,null),R(e,p),T&&T.m(e,null),_=!0},p(M,$){const D={};$[0]&2&&(D.input=M[1]),$[0]&515|$[1]&16384&&(D.$$scope={dirty:$,ctx:M}),i.$set(D),M[10]?y?(y.p(M,$),$[0]&1024&&j(y,1)):(y=E1(M),y.c(),j(y,1),y.m(e,c)):y&&(tn(),Z(y,1,1,()=>{y=null}),nn());const z={};$[1]&16384&&(z.$$scope={dirty:$,ctx:M}),a.$set(z),M[0].kind=="filter"&&M[0].freehand?w?(w.p(M,$),$[0]&1&&j(w,1)):(w=I1(M),w.c(),j(w,1),w.m(e,p)):w&&(tn(),Z(w,1,1,()=>{w=null}),nn()),M[0].kind=="turn_restriction"?T?(T.p(M,$),$[0]&1&&j(T,1)):(T=A1(M),T.c(),j(T,1),T.m(e,null)):T&&(tn(),Z(T,1,1,()=>{T=null}),nn())},i(M){_||(j(t.$$.fragment,M),j(i.$$.fragment,M),j(y),j(a.$$.fragment,M),j(w),j(T),_=!0)},o(M){Z(t.$$.fragment,M),Z(i.$$.fragment,M),Z(y),Z(a.$$.fragment,M),Z(w),Z(T),_=!1},d(M){M&&V(e),ce(t),ce(i),y&&y.d(),ce(a),w&&w.d(),T&&T.d()}}}function II(r){let e,t,n,i;return e=new bo({props:{$$slots:{map:[EI],sidebar:[fI],top:[aI]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0,n||(i=xt(window,"keydown",r[21]),n=!0)},p(o,c){const a={};c[0]&16383|c[1]&16384&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o),n=!1,i()}}}function AI(r,e,t){let n,i,o,c,a,d,p,_,y;at(r,oo,ut=>t(25,i=ut)),at(r,om,ut=>t(9,o=ut)),at(r,Ar,ut=>t(42,c=ut)),at(r,Ro,ut=>t(2,a=ut)),at(r,Z_,ut=>t(10,d=ut)),at(r,hd,ut=>t(11,p=ut)),at(r,an,ut=>t(12,_=ut)),at(r,cd,ut=>t(13,y=ut));function w(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:Wi()}}let T={kind:"filter",freehand:!1},M=!1,$=0,D=0,z,I,F=c.getAllShortcuts();Yr(()=>{a.doubleClickZoom.enable()});function N(ut){t(1,I=c.renderNeighbourhood()),t(6,z=I.features.find(Wt=>Wt.properties.kind=="boundary")),t(4,$=I.undo_length),t(5,D=I.redo_length),t(7,F=c.getAllShortcuts()),mh()}function W(ut,Wt){T.kind=="filter"?(c.addModalFilter(Wt,o),Nt(oo,i++,i)):T.kind=="oneway"?(c.toggleTravelFlow(ut.properties.road),Nt(oo,i++,i)):T.kind=="main-roads"?(c.toggleMainRoad(ut.properties.road),Nt(oo,i++,i)):T.kind=="turn_restriction"&&(t(0,T.from_road_id=ut.properties.road,T),t(0,T.from_road_name=ut.properties.name||"unnamed road",T),t(0,T.possible_targets=c.getTurnRestrictionTargets(ut.properties.road),T))}function oe(ut){T.kind=="turn_restriction"&&(a.queryRenderedFeatures(ut.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,T=w()))}function J(ut){if(T.kind=="turn_restriction"&&T.from_road_id!=null){let Wt=ut.detail.features[0].properties.road;c.addTurnRestriction(T.from_road_id,Wt),Nt(oo,i++,i)}t(0,T=w())}function ee(ut){let Wt=ut.detail.features[0];c.deleteModalFilter(Wt.properties.road),Nt(oo,i++,i)}function pe(ut){let Wt=ut.detail.features[0];c.deleteTurnRestriction(Wt.properties.intersection,Wt.properties.from_road,Wt.properties.to_road),Nt(oo,i++,i)}function Ie(ut){if(T.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${T.kind}`);return}ut.hasRotatedFilter?(c.deleteDiagonalFilter(ut),Nt(oo,i++,i)):ut.filter?(c.rotateDiagonalFilter(ut),Nt(oo,i++,i)):(c.addDiagonalFilter(ut),Nt(oo,i++,i))}function Q(ut){ut.target.tagName!="INPUT"&&(ut.ctrlKey&&ut.key=="z"&&ae(),ut.ctrlKey&&ut.key=="y"&&Pe(),ut.key=="1"&&t(0,T={kind:"filter",freehand:!1}),ut.key=="2"&&t(0,T={kind:"oneway"}),ut.key=="3"&&t(0,T=w()),ut.key=="4"&&t(0,T={kind:"main-roads"}))}function ae(){c.undo(),Nt(oo,i++,i)}function Pe(){c.redo(),Nt(oo,i++,i)}function ve(ut){let Wt=ut.detail;Wt&&(c.addManyModalFilters(Wt,o),Nt(oo,i++,i)),t(0,T={kind:"filter",freehand:!1})}const nt=()=>t(0,T={kind:"filter",freehand:!1}),Ge=()=>t(0,T={kind:"oneway"}),Ee=()=>t(0,T=w()),De=()=>t(0,T={kind:"main-roads"});function Ct(ut){M=ut,t(3,M)}const it=()=>t(3,M=!0),lt=()=>t(0,T={kind:"filter",freehand:!1}),mt=()=>t(0,T={kind:"filter",freehand:!0});function dt(){d=this.checked,Z_.set(d)}function Xe(){p=Sa(this),hd.set(p)}const $t=()=>Nt(an,_={mode:"pick-neighbourhood"},_),yt=()=>Nt(an,_={mode:"view-shortcuts"},_),Rt=()=>Nt(an,_={mode:"route",prevMode:"neighbourhood"},_),It=()=>Nt(an,_={mode:"impact-one-destination"},_),Qt=()=>Nt(an,_={mode:"set-boundary",name:vr(z).properties.name,existing:vr(z)},_),yn=()=>Nt(an,_={mode:"debug-neighbourhood"},_);return r.$$.update=()=>{r.$$.dirty[0]&5&&(T.kind=="oneway"||T.kind=="main-roads"?a.doubleClickZoom.disable():a.doubleClickZoom.enable()),r.$$.dirty[0]&33554432&&N(),r.$$.dirty[0]&2&&t(8,n=I.features.filter(ut=>ut.properties.kind=="cell"&&ut.properties.cell_color=="disconnected").length)},[T,I,a,M,$,D,z,F,n,o,d,p,_,y,w,W,oe,J,ee,pe,Ie,Q,ae,Pe,ve,i,nt,Ge,Ee,De,Ct,it,lt,mt,dt,Xe,$t,yt,Rt,It,Qt,yn]}class PI extends Et{constructor(e){super(),Lt(this,e,AI,II,wt,{},null,[-1,-1])}}function zI(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function DI(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function $I(r){let e,t,n,i,o,c,a,d,p,_,y;return o=new On({props:{$$slots:{default:[zI]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[DI]},$$scope:{ctx:r}}}),d.$on("click",r[11]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),_.textContent="Predict impact",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),y=!0},p(w,T){const M={};T&16384&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T&16384&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),y=!1},d(w){w&&V(e),ce(o),ce(d)}}}function P1(r){let e,t,n,i,o,c,a;function d(T){r[10](T)}let p={list:r[1]};r[2]!==void 0&&(p.idx=r[2]),e=new kd({props:p}),hn.push(()=>An(e,"idx",d));let _=r[1][r[2]].count>1&&z1(r),y=r[1][r[2]].before==null&&D1(),w=r[1][r[2]].after==null&&$1();return{c(){he(e.$$.fragment),n=ie(),_&&_.c(),i=ie(),y&&y.c(),o=ie(),w&&w.c(),c=Qn()},m(T,M){le(e,T,M),q(T,n,M),_&&_.m(T,M),q(T,i,M),y&&y.m(T,M),q(T,o,M),w&&w.m(T,M),q(T,c,M),a=!0},p(T,M){const $={};M&2&&($.list=T[1]),!t&&M&4&&(t=!0,$.idx=T[2],In(()=>t=!1)),e.$set($),T[1][T[2]].count>1?_?_.p(T,M):(_=z1(T),_.c(),_.m(i.parentNode,i)):_&&(_.d(1),_=null),T[1][T[2]].before==null?y||(y=D1(),y.c(),y.m(o.parentNode,o)):y&&(y.d(1),y=null),T[1][T[2]].after==null?w||(w=$1(),w.c(),w.m(c.parentNode,c)):w&&(w.d(1),w=null)},i(T){a||(j(e.$$.fragment,T),a=!0)},o(T){Z(e.$$.fragment,T),a=!1},d(T){T&&(V(n),V(i),V(o),V(c)),ce(e,T),_&&_.d(T),y&&y.d(T),w&&w.d(T)}}}function z1(r){let e,t,n=r[1][r[2]].count.toLocaleString()+"",i,o,c,a;return{c(){e=U("p"),t=xe(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=xe(n),o=xe(` trips between the
          same points.`),c=ie(),a=U("i"),a.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(d,p){q(d,e,p),R(e,t),R(e,i),R(e,o),q(d,c,p),q(d,a,p)},p(d,p){p&6&&n!==(n=d[1][d[2]].count.toLocaleString()+"")&&Mt(i,n)},d(d){d&&(V(e),V(c),V(a))}}}function D1(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,st(e,"color","red")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function $1(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,st(e,"color","blue")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function RI(r){let e,t,n,i,o=r[0].before.toLocaleString()+"",c,a,d,p,_=r[0].after.toLocaleString()+"",y,w,T,M,$=Math.round(100*r[0].after/r[0].before)+"",D,z,I,F;t=new na({}),t.$on("click",r[9]);let N=r[1].length>0&&P1(r);return{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("p"),c=xe(o),a=xe(` routes cross here
      `),d=U("span"),d.textContent="before your changes",p=xe(`
      , and `),y=xe(_),w=ie(),T=U("span"),T.textContent="after your changes",M=xe(`
      . That's
      `),D=xe($),z=xe("% of the original traffic."),I=ie(),N&&N.c(),st(d,"color","red"),st(T,"color","blue"),fe(e,"slot","sidebar")},m(W,oe){q(W,e,oe),le(t,e,null),R(e,n),R(e,i),R(i,c),R(i,a),R(i,d),R(i,p),R(i,y),R(i,w),R(i,T),R(i,M),R(i,D),R(i,z),R(e,I),N&&N.m(e,null),F=!0},p(W,oe){(!F||oe&1)&&o!==(o=W[0].before.toLocaleString()+"")&&Mt(c,o),(!F||oe&1)&&_!==(_=W[0].after.toLocaleString()+"")&&Mt(y,_),(!F||oe&1)&&$!==($=Math.round(100*W[0].after/W[0].before)+"")&&Mt(D,$),W[1].length>0?N?(N.p(W,oe),oe&2&&j(N,1)):(N=P1(W),N.c(),j(N,1),N.m(e,null)):N&&(tn(),Z(N,1,1,()=>{N=null}),nn())},i(W){F||(j(t.$$.fragment,W),j(N),F=!0)},o(W){Z(t.$$.fragment,W),Z(N),F=!1},d(W){W&&V(e),ce(t),N&&N.d()}}}function R1(r){let e,t,n,i,o,c;return e=new pr({props:{data:r[5](r[2]),$$slots:{default:[FI]},$$scope:{ctx:r}}}),n=new yl({props:{lngLat:r[6](r[2]),$$slots:{default:[BI]},$$scope:{ctx:r}}}),o=new yl({props:{lngLat:r[7](r[2]),$$slots:{default:[OI]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment)},m(a,d){le(e,a,d),q(a,t,d),le(n,a,d),q(a,i,d),le(o,a,d),c=!0},p(a,d){const p={};d&4&&(p.data=a[5](a[2])),d&16384&&(p.$$scope={dirty:d,ctx:a}),e.$set(p);const _={};d&4&&(_.lngLat=a[6](a[2])),d&16384&&(_.$$scope={dirty:d,ctx:a}),n.$set(_);const y={};d&4&&(y.lngLat=a[7](a[2])),d&16384&&(y.$$scope={dirty:d,ctx:a}),o.$set(y)},i(a){c||(j(e.$$.fragment,a),j(n.$$.fragment,a),j(o.$$.fragment,a),c=!0)},o(a){Z(e.$$.fragment,a),Z(n.$$.fragment,a),Z(o.$$.fragment,a),c=!1},d(a){a&&(V(t),V(i)),ce(e,a),ce(n,a),ce(o,a)}}}function FI(r){let e,t;const n=[gn("predict-impact"),{paint:{"line-width":Do(["get","kind"],{focus:8},5),"line-color":Do(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Do(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function BI(r){let e;return{c(){e=xe("A")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function OI(r){let e;return{c(){e=xe("B")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function NI(r){let e,t,n,i,o=r[1].length>0&&R1(r);return n=new Oa({}),{c(){e=U("div"),o&&o.c(),t=ie(),he(n.$$.fragment),fe(e,"slot","map")},m(c,a){q(c,e,a),o&&o.m(e,null),R(e,t),le(n,e,null),i=!0},p(c,a){c[1].length>0?o?(o.p(c,a),a&2&&j(o,1)):(o=R1(c),o.c(),j(o,1),o.m(e,t)):o&&(tn(),Z(o,1,1,()=>{o=null}),nn())},i(c){i||(j(o),j(n.$$.fragment,c),i=!0)},o(c){Z(o),Z(n.$$.fragment,c),i=!1},d(c){c&&V(e),o&&o.d(),ce(n)}}}function jI(r){let e,t,n,i;return e=new Ch({props:{loading:r[3]}}),n=new bo({props:{$$slots:{map:[NI],sidebar:[RI],top:[$I]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(o,c){le(e,o,c),q(o,t,c),le(n,o,c),i=!0},p(o,[c]){const a={};c&8&&(a.loading=o[3]),e.$set(a);const d={};c&16407&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),ce(e,o),ce(n,o)}}}function UI(r,e,t){let n,i,o;at(r,an,z=>t(4,n=z)),at(r,am,z=>t(12,i=z)),at(r,Ar,z=>t(13,o=z));let{road:c}=e,a=c.properties;a.kind="focus";let d=[],p=0,_="Finding changes to this road";Ls(async()=>{await new Promise(z=>{requestAnimationFrame(()=>{requestAnimationFrame(z)})}),t(1,d=o.getImpactsOnRoad(a.id,i)),t(3,_=""),d.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),Nt(an,n={mode:"predict-impact"},n))});function y(z){return{type:"FeatureCollection",features:[d[z].before,d[z].after,c].filter(I=>I!=null)}}function w(z){return d[z].before!=null?d[z].before.geometry.coordinates[0]:d[z].after.geometry.coordinates[0]}function T(z){let I=d[z].before!=null?d[z].before.geometry.coordinates:d[z].after.geometry.coordinates;return I[I.length-1]}const M=()=>Nt(an,n={mode:"predict-impact"},n);function $(z){p=z,t(2,p)}const D=()=>Nt(an,n={mode:"pick-neighbourhood"},n);return r.$$set=z=>{"road"in z&&t(8,c=z.road)},[a,d,p,_,n,y,w,T,c,M,$,D]}class VI extends Et{constructor(e){super(),Lt(this,e,UI,jI,wt,{road:8})}}function qI(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function ZI(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function GI(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function HI(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M;return o=new On({props:{$$slots:{default:[qI]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[ZI]},$$scope:{ctx:r}}}),d.$on("click",r[14]),y=new On({props:{$$slots:{default:[GI]},$$scope:{ctx:r}}}),y.$on("click",r[7]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),he(y.$$.fragment),w=ie(),T=U("li"),T.textContent="Impact routing to one destination",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m($,D){q($,e,D),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),le(y,_,null),R(n,w),R(n,T),M=!0},p($,D){const z={};D&524288&&(z.$$scope={dirty:D,ctx:$}),o.$set(z);const I={};D&524288&&(I.$$scope={dirty:D,ctx:$}),d.$set(I);const F={};D&524288&&(F.$$scope={dirty:D,ctx:$}),y.$set(F)},i($){M||(j(o.$$.fragment,$),j(d.$$.fragment,$),j(y.$$.fragment,$),M=!0)},o($){Z(o.$$.fragment,$),Z(d.$$.fragment,$),Z(y.$$.fragment,$),M=!1},d($){$&&V(e),ce(o),ce(d),ce(y)}}}function WI(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function KI(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function XI(r){let e,t=Ea(r[4].properties.distance)+"",n,i,o=Ia(r[4].properties.time)+"",c;return{c(){e=U("p"),n=xe(t),i=xe(", "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&16&&t!==(t=Ea(a[4].properties.distance)+"")&&Mt(n,t),d&16&&o!==(o=Ia(a[4].properties.time)+"")&&Mt(c,o)},d(a){a&&V(e)}}}function JI(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function YI(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function QI(r){let e,t=Ea(r[3].properties.distance)+"",n,i,o=Ia(r[3].properties.time)+"",c;return{c(){e=U("p"),n=xe(t),i=xe(", "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&8&&t!==(t=Ea(a[3].properties.distance)+"")&&Mt(n,t),d&8&&o!==(o=Ia(a[3].properties.time)+"")&&Mt(c,o)},d(a){a&&V(e)}}}function eA(r){let e,t,n,i,o,c,a,d,p,_,y;t=new na({}),t.$on("click",r[7]);function w(I,F){return I[4]?XI:I[3]?KI:WI}let T=w(r),M=T(r);function $(I,F){return I[3]?QI:I[4]?YI:JI}let D=$(r),z=D(r);return{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=ie(),c=U("u"),c.textContent="Route before changes",a=ie(),M.c(),d=ie(),p=U("u"),p.textContent="Route after changes",_=ie(),z.c(),st(c,"color","red"),st(p,"color","blue"),fe(e,"slot","sidebar")},m(I,F){q(I,e,F),le(t,e,null),R(e,n),R(e,i),R(e,o),R(e,c),R(e,a),M.m(e,null),R(e,d),R(e,p),R(e,_),z.m(e,null),y=!0},p(I,F){T===(T=w(I))&&M?M.p(I,F):(M.d(1),M=T(I),M&&(M.c(),M.m(e,d))),D===(D=$(I))&&z?z.p(I,F):(z.d(1),z=D(I),z&&(z.c(),z.m(e,null)))},i(I){y||(j(t.$$.fragment,I),y=!0)},o(I){Z(t.$$.fragment,I),y=!1},d(I){I&&V(e),ce(t),M.d(),z.d()}}}function tA(r){let e,t;const n=[gn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new zi({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function nA(r){let e,t,n=(r[18].time_after/r[18].time_before).toFixed(1)+"",i;return{c(){e=U("p"),t=xe("Time ratio: "),i=xe(n)},m(o,c){q(o,e,c),R(e,t),R(e,i)},p(o,c){c&262144&&n!==(n=(o[18].time_after/o[18].time_before).toFixed(1)+"")&&Mt(i,n)},d(o){o&&V(e)}}}function rA(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[nA,({props:n})=>({18:n}),({props:n})=>n?262144:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function iA(r){let e,t,n;const i=[gn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(a){r[11](a)}let c={$$slots:{default:[rA]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)c=Ot(c,i[a]);return r[0]!==void 0&&(c.hovered=r[0]),e=new rr({props:c}),hn.push(()=>An(e,"hovered",o)),e.$on("click",r[12]),{c(){he(e.$$.fragment)},m(a,d){le(e,a,d),n=!0},p(a,d){const p=d&32?Vn(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(a[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};d&524288&&(p.$$scope={dirty:d,ctx:a}),!t&&d&1&&(t=!0,p.hovered=a[0],In(()=>t=!1)),e.$set(p)},i(a){n||(j(e.$$.fragment,a),n=!0)},o(a){Z(e.$$.fragment,a),n=!1},d(a){ce(e,a)}}}function oA(r){let e,t;const n=[gn("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Do(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function sA(r){let e;return{c(){e=xe("X")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function aA(r){let e,t,n,i,o,c,a,d,p,_,y,w;t=new Ph({props:{$$slots:{default:[tA]},$$scope:{ctx:r}}}),i=new pr({props:{data:r[5],generateId:!0,$$slots:{default:[iA]},$$scope:{ctx:r}}}),c=new pr({props:{data:r[1],$$slots:{default:[oA]},$$scope:{ctx:r}}}),d=new Oa({});function T($){r[13]($)}let M={draggable:!0,$$slots:{default:[sA]},$$scope:{ctx:r}};return r[2]!==void 0&&(M.lngLat=r[2]),_=new yl({props:M}),hn.push(()=>An(_,"lngLat",T)),{c(){e=U("div"),he(t.$$.fragment),n=ie(),he(i.$$.fragment),o=ie(),he(c.$$.fragment),a=ie(),he(d.$$.fragment),p=ie(),he(_.$$.fragment),fe(e,"slot","map")},m($,D){q($,e,D),le(t,e,null),R(e,n),le(i,e,null),R(e,o),le(c,e,null),R(e,a),le(d,e,null),R(e,p),le(_,e,null),w=!0},p($,D){const z={};D&524288&&(z.$$scope={dirty:D,ctx:$}),t.$set(z);const I={};D&32&&(I.data=$[5]),D&524321&&(I.$$scope={dirty:D,ctx:$}),i.$set(I);const F={};D&2&&(F.data=$[1]),D&524288&&(F.$$scope={dirty:D,ctx:$}),c.$set(F);const N={};D&524288&&(N.$$scope={dirty:D,ctx:$}),!y&&D&4&&(y=!0,N.lngLat=$[2],In(()=>y=!1)),_.$set(N)},i($){w||(j(t.$$.fragment,$),j(i.$$.fragment,$),j(c.$$.fragment,$),j(d.$$.fragment,$),j(_.$$.fragment,$),w=!0)},o($){Z(t.$$.fragment,$),Z(i.$$.fragment,$),Z(c.$$.fragment,$),Z(d.$$.fragment,$),Z(_.$$.fragment,$),w=!1},d($){$&&V(e),ce(t),ce(i),ce(c),ce(d),ce(_)}}}function lA(r){let e,t,n,i;return e=new Hm({}),e.$on("contextmenu",r[9]),n=new bo({props:{$$slots:{map:[aA],sidebar:[eA],top:[HI]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(o,c){le(e,o,c),q(o,t,c),le(n,o,c),i=!0},p(o,[c]){const a={};c&524415&&(a.$$scope={dirty:c,ctx:o}),n.$set(a)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),ce(e,o),ce(n,o)}}}function cA(r,e,t){let n,i,o,c,a,d,p,_,y;at(r,Uf,W=>t(2,a=W)),at(r,an,W=>t(6,d=W)),at(r,ah,W=>t(15,p=W)),at(r,sh,W=>t(16,_=W)),at(r,Ar,W=>t(10,y=W));function w(){Nt(an,d={mode:"neighbourhood"},d)}let T=null;Ls(()=>{setTimeout(()=>{a&&cm(Uf)},10)});function M(W){return W?y.compareRoute(new Ks.LngLat(W.properties.pt1_x,W.properties.pt1_y),a,1):Wi()}function $(W){Nt(sh,_=new Ks.LngLat(W.properties.pt1_x,W.properties.pt1_y),_),Nt(ah,p=a,p),Nt(an,d={mode:"route",prevMode:"impact-one-destination"},d)}function D(W){Nt(Uf,a=W.detail.lngLat,a)}function z(W){T=W,t(0,T)}const I=W=>$(W.detail.features[0]);function F(W){a=W,Uf.set(a)}const N=()=>Nt(an,d={mode:"pick-neighbourhood"},d);return r.$$.update=()=>{r.$$.dirty&1028&&t(5,n=y.impactToOneDestination(a)),r.$$.dirty&1&&t(1,i=M(T)),r.$$.dirty&2&&t(4,o=i.features.find(W=>W.properties.kind=="before")),r.$$.dirty&2&&t(3,c=i.features.find(W=>W.properties.kind=="after"))},[T,i,a,c,o,n,d,w,$,D,y,z,I,F,N]}class uA extends Et{constructor(e){super(),Lt(this,e,cA,lA,wt,{})}}function F1(r,e,t){const n=r.slice();return n[31]=e[t].properties.name,n}function hA(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function fA(r){let e;return{c(){e=U("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function dA(r){let e;return{c(){e=xe("Route")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function pA(r){let e;return{c(){e=xe("Predict impact")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function B1(r){let e,t,n;return t=new On({props:{$$slots:{default:[mA]},$$scope:{ctx:r}}}),t.$on("click",r[29]),{c(){e=U("li"),he(t.$$.fragment)},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o[1]&8&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function mA(r){let e;return{c(){e=xe("Debug intersections")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function gA(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F;o=new On({props:{$$slots:{default:[hA]},$$scope:{ctx:r}}}),o.$on("click",Bo),p=new Xm({props:{$$slots:{default:[fA]},$$scope:{ctx:r}}}),M=new On({props:{$$slots:{default:[dA]},$$scope:{ctx:r}}}),M.$on("click",r[27]),z=new On({props:{$$slots:{default:[pA]},$$scope:{ctx:r}}}),z.$on("click",r[28]);let N=r[9]&&B1(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),d=xe(`Pick neighbourhood
          `),he(p.$$.fragment),_=ie(),y=U("nav"),w=U("ul"),T=U("li"),he(M.$$.fragment),$=ie(),D=U("li"),he(z.$$.fragment),I=ie(),N&&N.c(),fe(t,"aria-label","breadcrumb"),fe(e,"slot","top"),st(e,"display","flex"),st(e,"justify-content","space-between")},m(W,oe){q(W,e,oe),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),R(a,d),le(p,a,null),R(e,_),R(e,y),R(y,w),R(w,T),le(M,T,null),R(w,$),R(w,D),le(z,D,null),R(w,I),N&&N.m(w,null),F=!0},p(W,oe){const J={};oe[1]&8&&(J.$$scope={dirty:oe,ctx:W}),o.$set(J);const ee={};oe[1]&8&&(ee.$$scope={dirty:oe,ctx:W}),p.$set(ee);const pe={};oe[1]&8&&(pe.$$scope={dirty:oe,ctx:W}),M.$set(pe);const Ie={};oe[1]&8&&(Ie.$$scope={dirty:oe,ctx:W}),z.$set(Ie),W[9]?N?(N.p(W,oe),oe[0]&512&&j(N,1)):(N=B1(W),N.c(),j(N,1),N.m(w,null)):N&&(tn(),Z(N,1,1,()=>{N=null}),nn())},i(W){F||(j(o.$$.fragment,W),j(p.$$.fragment,W),j(M.$$.fragment,W),j(z.$$.fragment,W),j(N),F=!0)},o(W){Z(o.$$.fragment,W),Z(p.$$.fragment,W),Z(M.$$.fragment,W),Z(z.$$.fragment,W),Z(N),F=!1},d(W){W&&V(e),ce(o),ce(p),ce(M),ce(z),N&&N.d()}}}function _A(r){let e=r[31]+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i[0]&1&&e!==(e=n[31]+"")&&Mt(t,e)},d(n){n&&V(t)}}}function O1(r){let e,t,n,i,o,c,a,d,p,_,y,w,T;function M(){return r[20](r[31])}n=new On({props:{$$slots:{default:[_A]},$$scope:{ctx:r}}}),n.$on("click",M),a=new jb({props:{color:"black"}});function $(){return r[21](r[31])}_=new qm({props:{color:"white"}});function D(){return r[22](r[31])}function z(){return r[23](r[31])}return{c(){var I;e=U("li"),t=U("h3"),he(n.$$.fragment),i=ie(),o=U("span"),c=U("button"),he(a.$$.fragment),d=ie(),p=U("button"),he(_.$$.fragment),fe(c,"class","outline icon-btn"),fe(c,"title","Rename neighbourhood"),fe(p,"class","icon-btn destructive"),fe(p,"title","Delete neighbourhood"),fe(o,"class","actions"),fe(e,"class","actionable-cell svelte-qhjp0j"),en(e,"highlighted",((I=r[3])==null?void 0:I.properties.name)==r[31]||r[2]==r[31])},m(I,F){q(I,e,F),R(e,t),le(n,t,null),R(e,i),R(e,o),R(o,c),le(a,c,null),R(o,d),R(o,p),le(_,p,null),y=!0,w||(T=[xt(c,"click",$),xt(p,"click",D),xt(e,"mouseenter",z),xt(e,"mouseleave",r[24])],w=!0)},p(I,F){var W;r=I;const N={};F[0]&1|F[1]&8&&(N.$$scope={dirty:F,ctx:r}),n.$set(N),(!y||F[0]&13)&&en(e,"highlighted",((W=r[3])==null?void 0:W.properties.name)==r[31]||r[2]==r[31])},i(I){y||(j(n.$$.fragment,I),j(a.$$.fragment,I),j(_.$$.fragment,I),y=!0)},o(I){Z(n.$$.fragment,I),Z(a.$$.fragment,I),Z(_.$$.fragment,I),y=!1},d(I){I&&V(e),ce(n),ce(a),ce(_),w=!1,mr(T)}}}function yA(r){let e,t,n;return e=new Ck({}),{c(){he(e.$$.fragment),t=xe(`
          Add a new neighbourhood`)},m(i,o){le(e,i,o),q(i,t,o),n=!0},i(i){n||(j(e.$$.fragment,i),n=!0)},o(i){Z(e.$$.fragment,i),n=!1},d(i){i&&V(t),ce(e,i)}}}function N1(r){let e,t,n,i,o,c,a,d,p;function _(w){r[26](w)}let y={};return r[1]!==void 0&&(y.selectedPrioritization=r[1]),o=new Ov({props:y}),hn.push(()=>An(o,"selectedPrioritization",_)),{c(){e=U("h3"),e.textContent="Prioritization",t=ie(),n=U("p"),n.textContent="Compare metrics across your neighbourhoods.",i=ie(),he(o.$$.fragment),a=ie(),d=U("hr")},m(w,T){q(w,e,T),q(w,t,T),q(w,n,T),q(w,i,T),le(o,w,T),q(w,a,T),q(w,d,T),p=!0},p(w,T){const M={};!c&&T[0]&2&&(c=!0,M.selectedPrioritization=w[1],In(()=>c=!1)),o.$set(M)},i(w){p||(j(o.$$.fragment,w),p=!0)},o(w){Z(o.$$.fragment,w),p=!1},d(w){w&&(V(e),V(t),V(n),V(i),V(a),V(d)),ce(o,w)}}}function j1(r){let e,t,n;return{c(){e=U("button"),e.textContent="Debug route-snapper",fe(e,"class","secondary")},m(i,o){q(i,e,o),t||(n=xt(e,"click",r[13]),t=!0)},p:tt,d(i){i&&V(e),t=!1,n()}}}function bA(r){let e,t,n,i=r[6].projectName(vr(r[7]))+"",o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe=r[4].modalFilters+"",J,ee,pe,Ie,Q=r[4].deletedModalFilters+"",ae,Pe,ve,nt,Ge=r[4].travelFlows+"",Ee,De,Ct,it,lt,mt;p=new Nb({});let dt=Nn(r[0].features),Xe=[];for(let It=0;It<dt.length;It+=1)Xe[It]=O1(F1(r,dt,It));const $t=It=>Z(Xe[It],1,1,()=>{Xe[It]=null});I=new On({props:{$$slots:{default:[yA]},$$scope:{ctx:r}}}),I.$on("click",r[25]);let yt=r[8]=="cnt"&&N1(r),Rt=r[9]&&j1(r);return{c(){e=U("div"),t=U("div"),n=U("h1"),o=xe(i),c=ie(),a=U("button"),d=U("div"),he(p.$$.fragment),_=ie(),y=U("span"),y.textContent="Export",w=ie(),T=U("h2"),T.textContent="Neighbourhoods",M=ie(),$=U("ul");for(let It=0;It<Xe.length;It+=1)Xe[It].c();D=ie(),z=U("li"),he(I.$$.fragment),F=ie(),yt&&yt.c(),N=ie(),W=U("p"),J=xe(oe),ee=xe(" new modal filter(s) added"),pe=ie(),Ie=U("p"),ae=xe(Q),Pe=xe(`
      existing modal filter(s) removed`),ve=ie(),nt=U("p"),Ee=xe(Ge),De=xe(" road segment direction(s) changed"),Ct=ie(),Rt&&Rt.c(),st(y,"margin-right","2px"),st(d,"display","flex"),st(d,"align-items","center"),st(d,"gap","8px"),st(d,"color","black"),fe(a,"class","outline icon-btn"),st(a,"margin-right","8px"),fe(a,"title","Download project as GeoJSON"),st(t,"display","flex"),st(t,"justify-content","space-between"),st(t,"align-items","center"),st(t,"gap","16px"),fe($,"class","navigable-list"),fe(e,"slot","sidebar")},m(It,Qt){q(It,e,Qt),R(e,t),R(t,n),R(n,o),R(t,c),R(t,a),R(a,d),le(p,d,null),R(d,_),R(d,y),R(e,w),R(e,T),R(e,M),R(e,$);for(let yn=0;yn<Xe.length;yn+=1)Xe[yn]&&Xe[yn].m($,null);R($,D),R($,z),le(I,z,null),R(e,F),yt&&yt.m(e,null),R(e,N),R(e,W),R(W,J),R(W,ee),R(e,pe),R(e,Ie),R(Ie,ae),R(Ie,Pe),R(e,ve),R(e,nt),R(nt,Ee),R(nt,De),R(e,Ct),Rt&&Rt.m(e,null),it=!0,lt||(mt=xt(a,"click",r[19]),lt=!0)},p(It,Qt){if((!it||Qt[0]&192)&&i!==(i=It[6].projectName(vr(It[7]))+"")&&Mt(o,i),Qt[0]&7181){dt=Nn(It[0].features);let ut;for(ut=0;ut<dt.length;ut+=1){const Wt=F1(It,dt,ut);Xe[ut]?(Xe[ut].p(Wt,Qt),j(Xe[ut],1)):(Xe[ut]=O1(Wt),Xe[ut].c(),j(Xe[ut],1),Xe[ut].m($,D))}for(tn(),ut=dt.length;ut<Xe.length;ut+=1)$t(ut);nn()}const yn={};Qt[1]&8&&(yn.$$scope={dirty:Qt,ctx:It}),I.$set(yn),It[8]=="cnt"?yt?(yt.p(It,Qt),Qt[0]&256&&j(yt,1)):(yt=N1(It),yt.c(),j(yt,1),yt.m(e,N)):yt&&(tn(),Z(yt,1,1,()=>{yt=null}),nn()),(!it||Qt[0]&16)&&oe!==(oe=It[4].modalFilters+"")&&Mt(J,oe),(!it||Qt[0]&16)&&Q!==(Q=It[4].deletedModalFilters+"")&&Mt(ae,Q),(!it||Qt[0]&16)&&Ge!==(Ge=It[4].travelFlows+"")&&Mt(Ee,Ge),It[9]?Rt?Rt.p(It,Qt):(Rt=j1(It),Rt.c(),Rt.m(e,null)):Rt&&(Rt.d(1),Rt=null)},i(It){if(!it){j(p.$$.fragment,It);for(let Qt=0;Qt<dt.length;Qt+=1)j(Xe[Qt]);j(I.$$.fragment,It),j(yt),it=!0}},o(It){Z(p.$$.fragment,It),Xe=Xe.filter(Boolean);for(let Qt=0;Qt<Xe.length;Qt+=1)Z(Xe[Qt]);Z(I.$$.fragment,It),Z(yt),it=!1},d(It){It&&V(e),ce(p),pi(Xe,It),ce(I),yt&&yt.d(),Rt&&Rt.d(),lt=!1,mt()}}}function vA(r){let e,t,n=(r[30].number_pois/r[30].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Points of interest:",t=ie(),i=xe(n),o=xe(" / km")},m(c,a){q(c,e,a),q(c,t,a),q(c,i,a),q(c,o,a)},p(c,a){a[0]&1073741824&&n!==(n=(c[30].number_pois/c[30].area_km2).toFixed(1)+"")&&Mt(i,n)},d(c){c&&(V(e),V(t),V(i),V(o))}}}function wA(r){let e,t,n=(r[30].number_stats19_collisions/r[30].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions:",t=ie(),i=xe(n),o=xe(" / km")},m(c,a){q(c,e,a),q(c,t,a),q(c,i,a),q(c,o,a)},p(c,a){a[0]&1073741824&&n!==(n=(c[30].number_stats19_collisions/c[30].area_km2).toFixed(1)+"")&&Mt(i,n)},d(c){c&&(V(e),V(t),V(i),V(o))}}}function xA(r){let e,t,n=Math.round(r[30].population/r[30].area_km2).toLocaleString()+"",i,o;return{c(){e=U("b"),e.textContent="Population density:",t=ie(),i=xe(n),o=xe(` people
            / km`)},m(c,a){q(c,e,a),q(c,t,a),q(c,i,a),q(c,o,a)},p(c,a){a[0]&1073741824&&n!==(n=Math.round(c[30].population/c[30].area_km2).toLocaleString()+"")&&Mt(i,n)},d(c){c&&(V(e),V(t),V(i),V(o))}}}function kA(r){let e,t=r[30].name+"",n,i,o;function c(p,_){if(p[1]=="density")return xA;if(p[1]=="stats19")return wA;if(p[1]=="pois")return vA}let a=c(r),d=a&&a(r);return{c(){e=U("h2"),n=xe(t),i=ie(),d&&d.c(),o=Qn()},m(p,_){q(p,e,_),R(e,n),q(p,i,_),d&&d.m(p,_),q(p,o,_)},p(p,_){_[0]&1073741824&&t!==(t=p[30].name+"")&&Mt(n,t),a===(a=c(p))&&d?d.p(p,_):(d&&d.d(1),d=a&&a(p),d&&(d.c(),d.m(o.parentNode,o)))},d(p){p&&(V(e),V(i),V(o)),d&&d.d(p)}}}function SA(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[kA,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&1073741826|i[1]&8&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function CA(r){let e,t,n,i,o,c,a,d,p;e=new A3({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const _=[{filter:["==",["get","kind"],"boundary"]},gn("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let y={};for(let z=0;z<_.length;z+=1)y=Ot(y,_[z]);n=new rr({props:y});const w=[{filter:["==",["get","kind"],"boundary"]},gn("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let T={};for(let z=0;z<w.length;z+=1)T=Ot(T,w[z]);o=new rr({props:T});const M=[gn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[14](r[1]),"fill-opacity":r[15](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function $(z){r[17](z)}let D={$$slots:{default:[SA]},$$scope:{ctx:r}};for(let z=0;z<M.length;z+=1)D=Ot(D,M[z]);return r[3]!==void 0&&(D.hovered=r[3]),a=new zi({props:D}),hn.push(()=>An(a,"hovered",$)),a.$on("click",r[18]),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment)},m(z,I){le(e,z,I),q(z,t,I),le(n,z,I),q(z,i,I),le(o,z,I),q(z,c,I),le(a,z,I),p=!0},p(z,I){const F={};I[0]&4&&(F.data=z[2]?[{name:z[2],highlight:"yes"}]:[]),e.$set(F);const N={};n.$set(N);const W={};o.$set(W);const oe=I[0]&49154?Vn(M,[M[0],M[1],{paint:{"fill-color":z[14](z[1]),"fill-opacity":z[15](z[1])}},M[3],M[4]]):{};I[0]&2|I[1]&8&&(oe.$$scope={dirty:I,ctx:z}),!d&&I[0]&8&&(d=!0,oe.hovered=z[3],In(()=>d=!1)),a.$set(oe)},i(z){p||(j(e.$$.fragment,z),j(n.$$.fragment,z),j(o.$$.fragment,z),j(a.$$.fragment,z),p=!0)},o(z){Z(e.$$.fragment,z),Z(n.$$.fragment,z),Z(o.$$.fragment,z),Z(a.$$.fragment,z),p=!1},d(z){z&&(V(t),V(i),V(c)),ce(e,z),ce(n,z),ce(o,z),ce(a,z)}}}function TA(r){let e,t,n,i,o;return t=new pr({props:{data:r[0],promoteId:"name",$$slots:{default:[CA]},$$scope:{ctx:r}}}),i=new Oa({}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),he(i.$$.fragment),fe(e,"slot","map")},m(c,a){q(c,e,a),le(t,e,null),R(e,n),le(i,e,null),o=!0},p(c,a){const d={};a[0]&1&&(d.data=c[0]),a[0]&14|a[1]&8&&(d.$$scope={dirty:a,ctx:c}),t.$set(d)},i(c){o||(j(t.$$.fragment,c),j(i.$$.fragment,c),o=!0)},o(c){Z(t.$$.fragment,c),Z(i.$$.fragment,c),o=!1},d(c){c&&V(e),ce(t),ce(i)}}}function MA(r){let e,t;return e=new bo({props:{$$slots:{map:[TA],sidebar:[bA],top:[gA]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i[0]&1023|i[1]&8&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function LA(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function EA(r,e,t){let n,i,o,c,a,d,p,_;at(r,Ar,Ee=>t(16,o=Ee)),at(r,an,Ee=>t(5,c=Ee)),at(r,Qs,Ee=>t(6,a=Ee)),at(r,_l,Ee=>t(7,d=Ee)),at(r,Fo,Ee=>t(8,p=Ee)),at(r,cd,Ee=>t(9,_=Ee));let y="none",w=null,T=null;function M(Ee){o.setCurrentNeighbourhood(Ee),Nt(an,c={mode:"neighbourhood"},c)}function $(Ee){window.confirm(`Really delete neighbourhood ${Ee}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(Ee),mh(),t(0,n=o.getAllNeighbourhoods()))}function D(Ee){let De=Bv(o,`Rename neighbourhood ${Ee} to what?`,Ee);De&&(o.renameNeighbourhoodBoundary(Ee,De),mh(),t(0,n=o.getAllNeighbourhoods()))}function z(){bd("debug_route_snapper.geojson",o.toRouteSnapperGj())}function I(Ee){let De=yo.mapFeature.hover.backgroundColor,Ct=Nv({none:De},Ee);return["case",["==",["feature-state","highlight"],"yes"],De,Ct]}function F(Ee){let De=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],De,Jn(.3,De)],area:Jn(.7,.9),density:Jn(.7,.9),simd:Jn(.7,.9),stats19:Jn(.7,.9),pois:Jn(.7,.9),car_ownership:Jn(.7,.9)}[Ee]}function N(Ee){T=Ee,t(3,T)}const W=Ee=>M(vr(Ee.detail.features[0].properties).name),oe=()=>mv(vr(d)),J=Ee=>M(Ee),ee=Ee=>D(Ee),pe=Ee=>$(Ee),Ie=Ee=>t(2,w=Ee),Q=()=>t(2,w=null),ae=()=>Nt(an,c={mode:"add-neighbourhood"},c);function Pe(Ee){y=Ee,t(1,y)}const ve=()=>Nt(an,c={mode:"route",prevMode:"pick-neighbourhood"},c),nt=()=>Nt(an,c={mode:"predict-impact"},c),Ge=()=>Nt(an,c={mode:"debug-intersections"},c);return r.$$.update=()=>{r.$$.dirty[0]&65536&&t(0,n=o.getAllNeighbourhoods()),r.$$.dirty[0]&1&&t(4,i=LA(n))},[n,y,w,T,i,c,a,d,p,_,M,$,D,z,I,F,o,N,W,oe,J,ee,pe,Ie,Q,ae,Pe,ve,nt,Ge]}class IA extends Et{constructor(e){super(),Lt(this,e,EA,MA,wt,{},null,[-1,-1])}}function AA(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function PA(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function zA(r){let e,t,n,i,o,c,a,d,p,_,y;return o=new On({props:{$$slots:{default:[AA]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[PA]},$$scope:{ctx:r}}}),d.$on("click",r[17]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),_.textContent="Predict impact",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(w,T){q(w,e,T),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),y=!0},p(w,T){const M={};T&2097152&&(M.$$scope={dirty:T,ctx:w}),o.$set(M);const $={};T&2097152&&($.$$scope={dirty:T,ctx:w}),d.$set($)},i(w){y||(j(o.$$.fragment,w),j(d.$$.fragment,w),y=!0)},o(w){Z(o.$$.fragment,w),Z(d.$$.fragment,w),y=!1},d(w){w&&V(e),ce(o),ce(d)}}}function DA(r){let e;return{c(){e=xe("Explore the origin/destination demand data used")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function $A(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W,oe,J,ee,pe,Ie,Q;return t=new na({}),t.$on("click",r[11]),c=new On({props:{$$slots:{default:[DA]},$$scope:{ctx:r}}}),c.$on("click",r[12]),J=new Oo({props:{colorScale:r[5],labels:{limits:["0%","50%","same","150%","200%"]}}}),pe=Dm(r[14][0]),{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("p"),o=xe(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),he(c.$$.fragment),a=ie(),d=U("fieldset"),p=U("label"),_=U("input"),y=xe(`
        Calculate quickly`),w=ie(),T=U("label"),M=U("input"),$=xe(`
        Calculate more accurately`),D=ie(),z=U("p"),z.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,I=ie(),F=U("label"),N=xe(`Only show roads with at least this many daily trips before or after
      `),W=U("input"),oe=ie(),he(J.$$.fragment),fe(_,"type","radio"),_.__value="fast",Wn(_,_.__value),fe(M,"type","radio"),M.__value="accurate",Wn(M,M.__value),fe(W,"type","number"),fe(W,"min",0),fe(e,"slot","sidebar"),pe.p(_,M)},m(ae,Pe){q(ae,e,Pe),le(t,e,null),R(e,n),R(e,i),R(i,o),le(c,i,null),R(e,a),R(e,d),R(d,p),R(p,_),_.checked=_.__value===r[2],R(p,y),R(d,w),R(d,T),R(T,M),M.checked=M.__value===r[2],R(T,$),R(e,D),R(e,z),R(e,I),R(e,F),R(F,N),R(F,W),Wn(W,r[4]),R(e,oe),le(J,e,null),ee=!0,Ie||(Q=[xt(_,"change",r[13]),xt(_,"change",r[8]),xt(M,"change",r[15]),xt(M,"change",r[8]),xt(W,"input",r[16])],Ie=!0)},p(ae,Pe){const ve={};Pe&2097152&&(ve.$$scope={dirty:Pe,ctx:ae}),c.$set(ve),Pe&4&&(_.checked=_.__value===ae[2]),Pe&4&&(M.checked=M.__value===ae[2]),Pe&16&&ml(W.value)!==ae[4]&&Wn(W,ae[4])},i(ae){ee||(j(t.$$.fragment,ae),j(c.$$.fragment,ae),j(J.$$.fragment,ae),ee=!0)},o(ae){Z(t.$$.fragment,ae),Z(c.$$.fragment,ae),Z(J.$$.fragment,ae),ee=!1},d(ae){ae&&V(e),ce(t),ce(c),ce(J),pe.r(),Ie=!1,mr(Q)}}}function RA(r){let e,t;const n=[gn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new zi({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function FA(r){let e,t=r[20].before.toLocaleString()+"",n,i,o=r[20].after.toLocaleString()+"",c,a,d,p,_=Math.round(100*r[20].after/r[20].before)+"",y,w;return{c(){e=U("p"),n=xe(t),i=xe(" before, "),c=xe(o),a=xe(`
            after`),d=ie(),p=U("p"),y=xe(_),w=xe("%")},m(T,M){q(T,e,M),R(e,n),R(e,i),R(e,c),R(e,a),q(T,d,M),q(T,p,M),R(p,y),R(p,w)},p(T,M){M&1048576&&t!==(t=T[20].before.toLocaleString()+"")&&Mt(n,t),M&1048576&&o!==(o=T[20].after.toLocaleString()+"")&&Mt(c,o),M&1048576&&_!==(_=Math.round(100*T[20].after/T[20].before)+"")&&Mt(y,_)},d(T){T&&(V(e),V(d),V(p))}}}function BA(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[FA,({props:n})=>({20:n}),({props:n})=>n?1048576:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&3145728&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function OA(r){let e,t,n,i;const o=[gn("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[4]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Gf,r[1].max_count,1.5*Hf],"line-color":"black"}}];let c={};for(let p=0;p<o.length;p+=1)c=Ot(c,o[p]);e=new rr({props:c});const a=[gn("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[4]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Gf,r[1].max_count,Hf],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[5][0],50,r[5][1],100,r[5][2],150,r[5][3],200,r[5][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let d={$$slots:{default:[BA]},$$scope:{ctx:r}};for(let p=0;p<a.length;p+=1)d=Ot(d,a[p]);return n=new rr({props:d}),n.$on("click",r[10]),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),i=!0},p(p,_){const y=_&18?Vn(o,[o[0],_&16&&{filter:[">=",["max",["get","before"],["get","after"]],p[4]]},_&2&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Gf,p[1].max_count,1.5*Hf],"line-color":"black"}}]):{};e.$set(y);const w=_&50?Vn(a,[a[0],_&16&&{filter:[">=",["max",["get","before"],["get","after"]],p[4]]},_&34&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Gf,p[1].max_count,Hf],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,p[5][0],50,p[5][1],100,p[5][2],150,p[5][3],200,p[5][4]]]}},a[3],a[4]]):{};_&2097152&&(w.$$scope={dirty:_,ctx:p}),n.$set(w)},i(p){i||(j(e.$$.fragment,p),j(n.$$.fragment,p),i=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),i=!1},d(p){p&&V(t),ce(e,p),ce(n,p)}}}function NA(r){let e,t,n,i,o,c,a;return t=new pr({props:{data:r[6],$$slots:{default:[RA]},$$scope:{ctx:r}}}),i=new pr({props:{data:r[1],generateId:!0,$$slots:{default:[OA]},$$scope:{ctx:r}}}),c=new Oa({}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),he(i.$$.fragment),o=ie(),he(c.$$.fragment),fe(e,"slot","map")},m(d,p){q(d,e,p),le(t,e,null),R(e,n),le(i,e,null),R(e,o),le(c,e,null),a=!0},p(d,p){const _={};p&2097152&&(_.$$scope={dirty:p,ctx:d}),t.$set(_);const y={};p&2&&(y.data=d[1]),p&2097170&&(y.$$scope={dirty:p,ctx:d}),i.$set(y)},i(d){a||(j(t.$$.fragment,d),j(i.$$.fragment,d),j(c.$$.fragment,d),a=!0)},o(d){Z(t.$$.fragment,d),Z(i.$$.fragment,d),Z(c.$$.fragment,d),a=!1},d(d){d&&V(e),ce(t),ce(i),ce(c)}}}function jA(r){let e,t,n,i;return e=new Ch({props:{loading:r[0]}}),n=new bo({props:{$$slots:{map:[NA],sidebar:[$A],top:[zA]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(o,c){le(e,o,c),q(o,t,c),le(n,o,c),i=!0},p(o,[c]){const a={};c&1&&(a.loading=o[0]),e.$set(a);const d={};c&2097182&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),ce(e,o),ce(n,o)}}}let Gf=3,Hf=10;function UA(r,e,t){let n,i,o,c;at(r,am,J=>t(9,n=J)),at(r,Ar,J=>t(18,i=J)),at(r,an,J=>t(3,o=J)),at(r,G_,J=>t(4,c=J));let a=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],d="",p={type:"FeatureCollection",features:[],max_count:1},_=i.getAllNeighbourhoods();function y(J){Nt(an,o={mode:"impact-detail",road:J},o)}async function w(J){t(0,d="Calculating impact"),await new Promise(ee=>{requestAnimationFrame(()=>{requestAnimationFrame(ee)})}),t(1,p=i.predictImpact(J)),t(0,d="")}let T=n?"fast":"accurate";function M(){Nt(am,n=T=="fast",n)}const $=[[]],D=J=>y(J.detail.features[0]),z=()=>Nt(an,o={mode:"pick-neighbourhood"},o),I=()=>Nt(an,o={mode:"debug-demand"},o);function F(){T=this.__value,t(2,T)}function N(){T=this.__value,t(2,T)}function W(){c=ml(this.value),G_.set(c)}const oe=()=>Nt(an,o={mode:"pick-neighbourhood"},o);return r.$$.update=()=>{r.$$.dirty&512&&w(n)},[d,p,T,o,c,a,_,y,M,n,D,z,I,F,$,N,W,oe]}class VA extends Et{constructor(e){super(),Lt(this,e,UA,jA,wt,{})}}function qA(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function ZA(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function U1(r){let e,t,n;return t=new On({props:{$$slots:{default:[GA]},$$scope:{ctx:r}}}),t.$on("click",r[14]),{c(){e=U("li"),he(t.$$.fragment)},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o&32768&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function GA(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function HA(r){let e,t,n,i,o,c,a,d,p,_,y,w;o=new On({props:{$$slots:{default:[qA]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[ZA]},$$scope:{ctx:r}}}),d.$on("click",r[13]);let T=r[0]=="neighbourhood"&&U1(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),T&&T.c(),_=ie(),y=U("li"),y.textContent="Routing",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(M,$){q(M,e,$),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),T&&T.m(n,null),R(n,_),R(n,y),w=!0},p(M,$){const D={};$&32768&&(D.$$scope={dirty:$,ctx:M}),o.$set(D);const z={};$&32768&&(z.$$scope={dirty:$,ctx:M}),d.$set(z),M[0]=="neighbourhood"?T?(T.p(M,$),$&1&&j(T,1)):(T=U1(M),T.c(),j(T,1),T.m(n,_)):T&&(tn(),Z(T,1,1,()=>{T=null}),nn())},i(M){w||(j(o.$$.fragment,M),j(d.$$.fragment,M),j(T),w=!0)},o(M){Z(o.$$.fragment,M),Z(d.$$.fragment,M),Z(T),w=!1},d(M){M&&V(e),ce(o),ce(d),T&&T.d()}}}function WA(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function KA(r){let e,t=Ea(r[6].properties.distance)+"",n,i,o=Ia(r[6].properties.time)+"",c;return{c(){e=U("p"),n=xe(t),i=xe(", "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&64&&t!==(t=Ea(a[6].properties.distance)+"")&&Mt(n,t),d&64&&o!==(o=Ia(a[6].properties.time)+"")&&Mt(c,o)},d(a){a&&V(e)}}}function XA(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function JA(r){let e,t=Ea(r[5].properties.distance)+"",n,i,o=Ia(r[5].properties.time)+"",c;return{c(){e=U("p"),n=xe(t),i=xe(", "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&32&&t!==(t=Ea(a[5].properties.distance)+"")&&Mt(n,t),d&32&&o!==(o=Ia(a[5].properties.time)+"")&&Mt(c,o)},d(a){a&&V(e)}}}function YA(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z,I,F,N,W;t=new na({}),t.$on("click",r[8]);function oe(ae,Pe){return ae[6]?KA:WA}let J=oe(r),ee=J(r);function pe(ae,Pe){return ae[5]?JA:XA}let Ie=pe(r),Q=Ie(r);return{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("p"),i.textContent="Drag markers for a route",o=ie(),c=U("u"),c.textContent="Route before changes",a=ie(),ee.c(),d=ie(),p=U("u"),p.textContent="Route after changes",_=ie(),Q.c(),y=ie(),w=U("label"),T=xe("Slow-down factor for main roads: "),M=xe(r[2]),$=ie(),D=U("input"),z=ie(),I=U("i"),I.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,st(c,"color","red"),st(p,"color","blue"),fe(D,"type","range"),fe(D,"min","1.0"),fe(D,"max","5.0"),fe(D,"step","0.1"),fe(e,"slot","sidebar")},m(ae,Pe){q(ae,e,Pe),le(t,e,null),R(e,n),R(e,i),R(e,o),R(e,c),R(e,a),ee.m(e,null),R(e,d),R(e,p),R(e,_),Q.m(e,null),R(e,y),R(e,w),R(w,T),R(w,M),R(w,$),R(w,D),Wn(D,r[2]),R(e,z),R(e,I),F=!0,N||(W=[xt(D,"change",r[12]),xt(D,"input",r[12])],N=!0)},p(ae,Pe){J===(J=oe(ae))&&ee?ee.p(ae,Pe):(ee.d(1),ee=J(ae),ee&&(ee.c(),ee.m(e,d))),Ie===(Ie=pe(ae))&&Q?Q.p(ae,Pe):(Q.d(1),Q=Ie(ae),Q&&(Q.c(),Q.m(e,y))),(!F||Pe&4)&&Mt(M,ae[2]),Pe&4&&Wn(D,ae[2])},i(ae){F||(j(t.$$.fragment,ae),F=!0)},o(ae){Z(t.$$.fragment,ae),F=!1},d(ae){ae&&V(e),ce(t),ee.d(),Q.d(),N=!1,mr(W)}}}function V1(r){let e,t;return e=new Ph({props:{$$slots:{default:[QA]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function QA(r){let e,t,n,i,o,c,a,d;return e=new Ad({}),n=new Id({}),o=new Pd({}),a=new Ah({props:{interactive:!1}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),q(p,i,_),le(o,p,_),q(p,c,_),le(a,p,_),d=!0},p:tt,i(p){d||(j(e.$$.fragment,p),j(n.$$.fragment,p),j(o.$$.fragment,p),j(a.$$.fragment,p),d=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),Z(o.$$.fragment,p),Z(a.$$.fragment,p),d=!1},d(p){p&&(V(t),V(i),V(c)),ce(e,p),ce(n,p),ce(o,p),ce(a,p)}}}function e8(r){let e,t;const n=[gn("compare-route"),{paint:{"line-width":10,"line-color":Do(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function t8(r){let e;return{c(){e=xe("A")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function n8(r){let e;return{c(){e=xe("B")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function r8(r){let e,t,n,i,o,c,a,d,p,_,y,w,T=r[0]=="neighbourhood"&&V1(r);n=new Oa({}),o=new pr({props:{data:r[1],$$slots:{default:[e8]},$$scope:{ctx:r}}});function M(I){r[10](I)}let $={draggable:!0,$$slots:{default:[t8]},$$scope:{ctx:r}};r[4]!==void 0&&($.lngLat=r[4]),a=new yl({props:$}),hn.push(()=>An(a,"lngLat",M));function D(I){r[11](I)}let z={draggable:!0,$$slots:{default:[n8]},$$scope:{ctx:r}};return r[3]!==void 0&&(z.lngLat=r[3]),_=new yl({props:z}),hn.push(()=>An(_,"lngLat",D)),{c(){e=U("div"),T&&T.c(),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment),p=ie(),he(_.$$.fragment),fe(e,"slot","map")},m(I,F){q(I,e,F),T&&T.m(e,null),R(e,t),le(n,e,null),R(e,i),le(o,e,null),R(e,c),le(a,e,null),R(e,p),le(_,e,null),w=!0},p(I,F){I[0]=="neighbourhood"?T?F&1&&j(T,1):(T=V1(I),T.c(),j(T,1),T.m(e,t)):T&&(tn(),Z(T,1,1,()=>{T=null}),nn());const N={};F&2&&(N.data=I[1]),F&32768&&(N.$$scope={dirty:F,ctx:I}),o.$set(N);const W={};F&32768&&(W.$$scope={dirty:F,ctx:I}),!d&&F&16&&(d=!0,W.lngLat=I[4],In(()=>d=!1)),a.$set(W);const oe={};F&32768&&(oe.$$scope={dirty:F,ctx:I}),!y&&F&8&&(y=!0,oe.lngLat=I[3],In(()=>y=!1)),_.$set(oe)},i(I){w||(j(T),j(n.$$.fragment,I),j(o.$$.fragment,I),j(a.$$.fragment,I),j(_.$$.fragment,I),w=!0)},o(I){Z(T),Z(n.$$.fragment,I),Z(o.$$.fragment,I),Z(a.$$.fragment,I),Z(_.$$.fragment,I),w=!1},d(I){I&&V(e),T&&T.d(),ce(n),ce(o),ce(a),ce(_)}}}function i8(r){let e,t;return e=new bo({props:{$$slots:{map:[r8],sidebar:[YA],top:[HA]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&33023&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function o8(r,e,t){let n,i,o,c,a,d,p,_;at(r,an,I=>t(7,c=I)),at(r,q_,I=>t(2,a=I)),at(r,ah,I=>t(3,d=I)),at(r,sh,I=>t(4,p=I)),at(r,Ar,I=>t(9,_=I));let{prevMode:y}=e;Ls(()=>{setTimeout(()=>{cm(sh),cm(ah)},10)});function w(){Nt(an,c={mode:y},c)}function T(I){p=I,sh.set(p)}function M(I){d=I,ah.set(d)}function $(){a=ml(this.value),q_.set(a)}const D=()=>Nt(an,c={mode:"pick-neighbourhood"},c),z=()=>Nt(an,c={mode:"neighbourhood"},c);return r.$$set=I=>{"prevMode"in I&&t(0,y=I.prevMode)},r.$$.update=()=>{r.$$.dirty&540&&t(1,n=_.compareRoute(p,d,a)),r.$$.dirty&2&&t(6,i=n.features.find(I=>I.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(I=>I.properties.kind=="after"))},[y,n,a,d,p,o,i,c,w,_,T,M,$,D,z]}class s8 extends Et{constructor(e){super(),Lt(this,e,o8,i8,wt,{prevMode:0})}}function a8(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function l8(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function c8(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function u8(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M;return o=new On({props:{$$slots:{default:[a8]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[l8]},$$scope:{ctx:r}}}),d.$on("click",r[10]),y=new On({props:{$$slots:{default:[c8]},$$scope:{ctx:r}}}),y.$on("click",r[11]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),he(y.$$.fragment),w=ie(),T=U("li"),T.textContent="Changing neighbourhood boundary",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m($,D){q($,e,D),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),le(y,_,null),R(n,w),R(n,T),M=!0},p($,D){const z={};D&8192&&(z.$$scope={dirty:D,ctx:$}),o.$set(z);const I={};D&8192&&(I.$$scope={dirty:D,ctx:$}),d.$set(I);const F={};D&8192&&(F.$$scope={dirty:D,ctx:$}),y.$set(F)},i($){M||(j(o.$$.fragment,$),j(d.$$.fragment,$),j(y.$$.fragment,$),M=!0)},o($){Z(o.$$.fragment,$),Z(d.$$.fragment,$),Z(y.$$.fragment,$),M=!1},d($){$&&V(e),ce(o),ce(d),ce(y)}}}function h8(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D;function z(N){r[8](N)}function I(N){r[9](N)}let F={map:vr(r[3])};return r[0]!==void 0&&(F.waypoints=r[0]),r[1]!==void 0&&(F.drawnShapeOut=r[1]),i=new Rv({props:F}),hn.push(()=>An(i,"waypoints",z)),hn.push(()=>An(i,"drawnShapeOut",I)),{c(){e=U("div"),t=U("h1"),t.textContent="Edit boundary",n=ie(),he(i.$$.fragment),a=ie(),d=U("div"),p=U("button"),_=xe("Finish"),w=ie(),T=U("button"),T.textContent="Cancel",p.disabled=y=r[0].length<3,fe(T,"class","secondary"),st(d,"display","flex"),st(d,"gap","16px"),fe(e,"slot","sidebar")},m(N,W){q(N,e,W),R(e,t),R(e,n),le(i,e,null),R(e,a),R(e,d),R(d,p),R(p,_),R(d,w),R(d,T),M=!0,$||(D=[xt(p,"click",r[4]),xt(T,"click",r[5])],$=!0)},p(N,W){const oe={};W&8&&(oe.map=vr(N[3])),!o&&W&1&&(o=!0,oe.waypoints=N[0],In(()=>o=!1)),!c&&W&2&&(c=!0,oe.drawnShapeOut=N[1],In(()=>c=!1)),i.$set(oe),(!M||W&1&&y!==(y=N[0].length<3))&&(p.disabled=y)},i(N){M||(j(i.$$.fragment,N),M=!0)},o(N){Z(i.$$.fragment,N),M=!1},d(N){N&&V(e),ce(i),$=!1,mr(D)}}}function f8(r){let e,t;return e=new bo({props:{$$slots:{sidebar:[h8],top:[u8]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&8207&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function d8(r,e,t){let n,i,o;at(r,an,D=>t(2,n=D)),at(r,Ar,D=>t(12,i=D)),at(r,Ro,D=>t(3,o=D));let{name:c}=e,{existing:a}=e,d=[],p;a.properties.waypoints?d=a.properties.waypoints.map(D=>({point:[D.lon,D.lat],snapped:D.snapped})):d=a.geometry.coordinates[1].slice(1).map(D=>({point:D,snapped:!1}));function _(){if(p)try{i.setNeighbourhoodBoundary(c,p),mh(),i.setCurrentNeighbourhood(c),Nt(an,n={mode:"neighbourhood"},n)}catch(D){window.alert(`Sorry, this boundary is invalid: ${D}`),y()}}function y(){Nt(an,n={mode:"neighbourhood"},n)}function w(D){d=D,t(0,d)}function T(D){p=D,t(1,p)}const M=()=>Nt(an,n={mode:"pick-neighbourhood"},n),$=()=>Nt(an,n={mode:"neighbourhood"},n);return r.$$set=D=>{"name"in D&&t(6,c=D.name),"existing"in D&&t(7,a=D.existing)},[d,p,n,o,_,y,c,a,w,T,M,$]}class p8 extends Et{constructor(e){super(),Lt(this,e,d8,f8,wt,{name:6,existing:7})}}const m8="/ltn/assets/settings-342fb430.svg";function g8(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D,z;return n=new H4({}),{c(){e=U("h1"),e.textContent="Settings",t=ie(),he(n.$$.fragment),i=ie(),o=U("label"),c=U("input"),a=xe(`
    Road thickness depends on shortcuts`),d=ie(),p=U("label"),_=U("input"),y=xe(`
    Developer mode`),w=ie(),T=U("center"),M=U("button"),M.textContent="Confirm",fe(c,"type","checkbox"),fe(_,"type","checkbox")},m(I,F){q(I,e,F),q(I,t,F),le(n,I,F),q(I,i,F),q(I,o,F),R(o,c),c.checked=r[1],R(o,a),q(I,d,F),q(I,p,F),R(p,_),_.checked=r[2],R(p,y),q(I,w,F),q(I,T,F),R(T,M),$=!0,D||(z=[xt(c,"change",r[4]),xt(_,"change",r[5]),xt(M,"click",r[6])],D=!0)},p(I,F){F&2&&(c.checked=I[1]),F&4&&(_.checked=I[2])},i(I){$||(j(n.$$.fragment,I),$=!0)},o(I){Z(n.$$.fragment,I),$=!1},d(I){I&&(V(e),V(t),V(i),V(o),V(d),V(p),V(w),V(T)),ce(n,I),D=!1,mr(z)}}}function _8(r){let e,t,n,i,o,c,a;function d(_){r[7](_)}let p={$$slots:{default:[g8]},$$scope:{ctx:r}};return r[0]!==void 0&&(p.show=r[0]),n=new yd({props:p}),hn.push(()=>An(n,"show",d)),{c(){e=U("button"),e.innerHTML=`<img src="${m8}" alt="Settings"/>`,t=ie(),he(n.$$.fragment),fe(e,"class","outline")},m(_,y){q(_,e,y),q(_,t,y),le(n,_,y),o=!0,c||(a=xt(e,"click",r[3]),c=!0)},p(_,[y]){const w={};y&263&&(w.$$scope={dirty:y,ctx:_}),!i&&y&1&&(i=!0,w.show=_[0],In(()=>i=!1)),n.$set(w)},i(_){o||(j(n.$$.fragment,_),o=!0)},o(_){Z(n.$$.fragment,_),o=!1},d(_){_&&(V(e),V(t)),ce(n,_),c=!1,a()}}}function y8(r,e,t){let n,i;at(r,sm,y=>t(1,n=y)),at(r,cd,y=>t(2,i=y));let o=!1;const c=()=>t(0,o=!0);function a(){n=this.checked,sm.set(n)}function d(){i=this.checked,cd.set(i)}const p=()=>t(0,o=!1);function _(y){o=y,t(0,o)}return[o,n,i,c,a,d,p,_]}class b8 extends Et{constructor(e){super(),Lt(this,e,y8,_8,wt,{})}}const v8=["==",["geometry-type"],"Polygon"],w8=["==",["geometry-type"],"LineString"],x8=["==",["geometry-type"],"Point"];function Vv(){return{type:"FeatureCollection",features:[]}}function Yp(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:qv(r)}}}function qv(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Zv=$n(Vv()),Gv=$n(0),k8=100;class S8{constructor(e){tr(this,"map");tr(this,"active");tr(this,"eventListenersSuccess");tr(this,"eventListenersUpdated");tr(this,"eventListenersFailure");tr(this,"points");tr(this,"cursor");tr(this,"hover");tr(this,"dragFrom");tr(this,"previousStates");tr(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});tr(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(q1(this.points).forEach((n,i)=>{t.push([i+1,rk(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});tr(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Yp(e.lngLat.toArray()),this.onClick(e),this.finish())});tr(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});tr(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});tr(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});tr(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=Vv();this.points.forEach((i,o)=>{let c=Yp(i);c.properties.hover=this.hover==o,c.properties.idx=o,e.features.push(c)}),e.features=e.features.concat(q1(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Zv.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,Gv.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Yp(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(qv),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>k8&&this.previousStates.shift()}}function q1(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function C8(r){let e,t,n;return{c(){e=xe("Undo ("),t=xe(r[1]),n=xe(")")},m(i,o){q(i,e,o),q(i,t,o),q(i,n,o)},p(i,o){o&2&&Mt(t,i[1])},d(i){i&&(V(e),V(t),V(n))}}}function T8(r){let e;return{c(){e=xe("Undo")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function M8(r){let e,t,n,i,o,c,a,d,p,_,y;function w($,D){return $[1]==0?T8:C8}let T=w(r),M=T(r);return{c(){e=U("div"),t=U("button"),t.textContent="Finish",n=ie(),i=U("button"),i.textContent="Cancel",o=ie(),c=U("button"),M.c(),d=ie(),p=U("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,c.disabled=a=r[1]==0,st(e,"display","flex"),st(e,"justify-content","space-between")},m($,D){q($,e,D),R(e,t),R(e,n),R(e,i),R(e,o),R(e,c),M.m(c,null),q($,d,D),q($,p,D),_||(y=[xt(t,"click",r[2]),xt(i,"click",r[3]),xt(c,"click",r[4])],_=!0)},p($,[D]){T===(T=w($))&&M?M.p($,D):(M.d(1),M=T($),M&&(M.c(),M.m(c,null))),D&2&&a!==(a=$[1]==0)&&(c.disabled=a)},i:tt,o:tt,d($){$&&(V(e),V(d),V(p)),M.d(),_=!1,mr(y)}}}function L8(r,e,t){let n;at(r,Gv,d=>t(1,n=d));let{polygonTool:i}=e;const o=()=>i.finish(),c=()=>i.cancel(),a=()=>i.undo();return r.$$set=d=>{"polygonTool"in d&&t(0,i=d.polygonTool)},[i,n,o,c,a]}class E8 extends Et{constructor(e){super(),Lt(this,e,L8,M8,wt,{polygonTool:0})}}let I8=Date.now();function zh(r){return`${r}-${I8++}`}const Hv=Symbol.for("svelte-maplibre");function A8(){return Sh(Hv)}function Z1(r){return{subscribe:r.subscribe}}function Wv({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=A8(),o=$n(null),c=Z1(o),a={...i,[r]:Z1(o)};if(e&&(a.popupTarget=c),n){let d=$n(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=$n()),_d(Hv,a),{...i,self:o}}function P8(){return Wv({key:"source",setCluster:!0})}function z8(r=!0){return Wv({key:"layer",setPopupTarget:r,setMouseEvent:r})}function G1(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function D8(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function $8(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function H1(r){let e=r[0],t,n,i=W1(r);return{c(){i.c(),t=Qn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c[0]&1&&wt(e,e=o[0])?(tn(),Z(i,1,1,tt),nn(),i=W1(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function W1(r){let e;const t=r[36].default,n=Cn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&Mn(n,t,i,i[35],e?Tn(t,i[35],o,null):Ln(i[35]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function R8(r){let e,t,n=r[0]&&H1(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&j(n,1)):(n=H1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function F8(r,e,t){let n,i,o,c,a,d,p,_,y,w,T,M,{$$slots:$={},$$scope:D}=e,{id:z=zh("layer")}=e,{source:I=void 0}=e,{sourceLayer:F=void 0}=e,{beforeId:N=void 0}=e,{beforeLayerType:W=void 0}=e,{type:oe}=e,{paint:J=void 0}=e,{layout:ee=void 0}=e,{filter:pe=void 0}=e,{applyToClusters:Ie=void 0}=e,{minzoom:Q=void 0}=e,{maxzoom:ae=void 0}=e,{manageHoverState:Pe=!1}=e,{hovered:ve=null}=e,{interactive:nt=!0}=e,{hoverCursor:Ge=void 0}=e,{eventsIfTopMost:Ee=!1}=e;const De=ms(),{map:Ct,source:it,self:lt,minzoom:mt,maxzoom:dt,eventTopMost:Xe,layerInfo:$t}=z8();at(r,Ct,Ze=>t(31,y=Ze)),at(r,it,Ze=>t(32,w=Ze)),at(r,lt,Ze=>t(0,_=Ze)),at(r,mt,Ze=>t(34,M=Ze)),at(r,dt,Ze=>t(33,T=Ze)),Yr(()=>{_&&y&&($t.delete(_),y==null||y.removeLayer(_))});let yt;function Rt(Ze){var _e,Pn;if(!nt||!_||!y||Ee&&Xe(Ze)!==_)return;let Ve=Ze.features??[],St=(Pn=(_e=Ve[0])==null?void 0:_e.properties)==null?void 0:Pn.cluster_id,Ut={event:Ze,map:y,clusterId:St,layer:_,source:a,features:Ve};De(Ze.type,Ut)}function It(Ze){var _e,Pn;if(!nt||!_||!y||Ee&&Xe(Ze)!==_)return;Ge&&(y.getCanvas().style.cursor=Ge);let Ve=Ze.features??[];t(6,ve=Ve[0]??null);let St=(Pn=(_e=Ve[0])==null?void 0:_e.properties)==null?void 0:Pn.cluster_id;De("mouseenter",{event:Ze,map:y,clusterId:St,layer:_,source:a,features:Ve})}function Qt(Ze){var _e,Pn,Ne;if(!nt||!y)return;if(Ee&&Xe(Ze)!==_){t(6,ve=null),Pe&&yt!==void 0&&(y==null||y.setFeatureState({source:a,sourceLayer:F,id:yt},{hover:!1}),yt=void 0);return}y.getCanvas().style.cursor=Ge;let Ve=Ze.features??[],St=(Pn=(_e=Ve[0])==null?void 0:_e.properties)==null?void 0:Pn.cluster_id,Ut=(Ne=Ve[0])==null?void 0:Ne.id;Ut!==yt&&(Pe&&(yt!==void 0&&(y==null||y.setFeatureState({source:a,id:yt,sourceLayer:F},{hover:!1})),y==null||y.setFeatureState({source:a,id:Ut,sourceLayer:F},{hover:!0})),yt=Ut,t(6,ve=Ve[0]??null)),De("mousemove",{event:Ze,map:y,clusterId:St,layer:_,source:a,features:Ve})}function yn(Ze){if(!(!nt||!_||!y)){if(Ge&&(y.getCanvas().style.cursor=""),t(6,ve=null),Pe&&yt!==void 0){const Ve={source:a,id:yt,sourceLayer:F};y==null||y.setFeatureState(Ve,{hover:!1}),yt=void 0}De("mouseleave",{map:y,layer:_,source:a})}}let ut=!0;function Wt(Ze){y&&(y.off("click",Ze,Rt),y.off("dblclick",Ze,Rt),y.off("contextmenu",Ze,Rt),y.off("mouseenter",Ze,It),y.off("mousemove",Ze,Qt),y.off("mouseleave",Ze,yn))}return Yr(()=>{y&&_&&Wt(_)}),r.$$set=Ze=>{"id"in Ze&&t(7,z=Ze.id),"source"in Ze&&t(8,I=Ze.source),"sourceLayer"in Ze&&t(9,F=Ze.sourceLayer),"beforeId"in Ze&&t(10,N=Ze.beforeId),"beforeLayerType"in Ze&&t(11,W=Ze.beforeLayerType),"type"in Ze&&t(12,oe=Ze.type),"paint"in Ze&&t(13,J=Ze.paint),"layout"in Ze&&t(14,ee=Ze.layout),"filter"in Ze&&t(15,pe=Ze.filter),"applyToClusters"in Ze&&t(16,Ie=Ze.applyToClusters),"minzoom"in Ze&&t(17,Q=Ze.minzoom),"maxzoom"in Ze&&t(18,ae=Ze.maxzoom),"manageHoverState"in Ze&&t(19,Pe=Ze.manageHoverState),"hovered"in Ze&&t(6,ve=Ze.hovered),"interactive"in Ze&&t(20,nt=Ze.interactive),"hoverCursor"in Ze&&t(21,Ge=Ze.hoverCursor),"eventsIfTopMost"in Ze&&t(22,Ee=Ze.eventsIfTopMost),"$$scope"in Ze&&t(35,D=Ze.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=$8(Ie)),r.$$.dirty[0]&1073774592&&t(24,i=D8("all",n,pe)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=Q??M),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,c=ae??T),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=I||w),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&y&&_!==z&&a){_&&(Wt(_),$t.delete(_));let Ze=N;if(!N&&W){let Ve=y.getStyle().layers,St=typeof W=="function"?W:_e=>_e.type===W,Ut=Ve==null?void 0:Ve.find(St);Ut&&(Ze=Ut.id)}Nt(lt,_=z,_),y.addLayer(La({id:_,type:oe,source:a,"source-layer":F,filter:i,paint:J,layout:ee,minzoom:o,maxzoom:c}),Ze),t(23,ut=!0),y.on("click",_,Rt),y.on("dblclick",_,Rt),y.on("contextmenu",_,Rt),y.on("mouseenter",_,It),y.on("mousemove",_,Qt),y.on("mouseleave",_,yn)}r.$$.dirty[0]&1048577&&_&&$t.set(_,{interactive:nt}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=_?G1((Ze,Ve)=>y==null?void 0:y.setPaintProperty(_,Ze,Ve)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=_?G1((Ze,Ve)=>y==null?void 0:y.setLayoutProperty(_,Ze,Ve)):void 0),r.$$.dirty[0]&268443648&&(d==null||d(J)),r.$$.dirty[0]&134234112&&(p==null||p(ee)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&_&&(y==null||y.setLayerZoomRange(_,o,c)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&_&&(ut?t(23,ut=!1):y==null||y.setFilter(_,i))},[_,Ct,it,lt,mt,dt,ve,z,I,F,N,W,oe,J,ee,pe,Ie,Q,ae,Pe,nt,Ge,Ee,ut,i,c,o,p,d,a,n,y,w,T,M,D,$]}class rg extends Et{constructor(e){super(),Lt(this,e,F8,R8,wt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function B8(r){let e;const t=r[16].default,n=Cn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&Mn(n,t,i,i[24],e?Tn(t,i[24],o,null):Ln(i[24]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function O8(r){let e,t,n;function i(c){r[17](c)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[B8]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new rg({props:o}),hn.push(()=>An(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.applyToClusters=c[9]),a&1024&&(d.minzoom=c[10]),a&2048&&(d.maxzoom=c[11]),a&4096&&(d.hoverCursor=c[12]),a&8192&&(d.manageHoverState=c[13]),a&16384&&(d.eventsIfTopMost=c[14]),a&32768&&(d.interactive=c[15]),a&16777216&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function N8(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=zh("circle")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:_}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:$=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:z=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:N=!0}=e;function W(ae){I=ae,t(0,I)}function oe(ae){Dn.call(this,r,ae)}function J(ae){Dn.call(this,r,ae)}function ee(ae){Dn.call(this,r,ae)}function pe(ae){Dn.call(this,r,ae)}function Ie(ae){Dn.call(this,r,ae)}function Q(ae){Dn.call(this,r,ae)}return r.$$set=ae=>{"id"in ae&&t(1,o=ae.id),"source"in ae&&t(2,c=ae.source),"sourceLayer"in ae&&t(3,a=ae.sourceLayer),"beforeId"in ae&&t(4,d=ae.beforeId),"beforeLayerType"in ae&&t(5,p=ae.beforeLayerType),"paint"in ae&&t(6,_=ae.paint),"layout"in ae&&t(7,y=ae.layout),"filter"in ae&&t(8,w=ae.filter),"applyToClusters"in ae&&t(9,T=ae.applyToClusters),"minzoom"in ae&&t(10,M=ae.minzoom),"maxzoom"in ae&&t(11,$=ae.maxzoom),"hoverCursor"in ae&&t(12,D=ae.hoverCursor),"manageHoverState"in ae&&t(13,z=ae.manageHoverState),"hovered"in ae&&t(0,I=ae.hovered),"eventsIfTopMost"in ae&&t(14,F=ae.eventsIfTopMost),"interactive"in ae&&t(15,N=ae.interactive),"$$scope"in ae&&t(24,i=ae.$$scope)},[I,o,c,a,d,p,_,y,w,T,M,$,D,z,F,N,n,W,oe,J,ee,pe,Ie,Q,i]}class j8 extends Et{constructor(e){super(),Lt(this,e,N8,O8,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function U8(r){let e;const t=r[15].default,n=Cn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&Mn(n,t,i,i[23],e?Tn(t,i[23],o,null):Ln(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function V8(r){let e,t,n;function i(c){r[16](c)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[U8]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new rg({props:o}),hn.push(()=>An(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.minzoom=c[9]),a&1024&&(d.maxzoom=c[10]),a&2048&&(d.hoverCursor=c[11]),a&4096&&(d.manageHoverState=c[12]),a&8192&&(d.eventsIfTopMost=c[13]),a&16384&&(d.interactive=c[14]),a&8388608&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function q8(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=zh("fill")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:_}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:D=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(Q){z=Q,t(0,z)}function W(Q){Dn.call(this,r,Q)}function oe(Q){Dn.call(this,r,Q)}function J(Q){Dn.call(this,r,Q)}function ee(Q){Dn.call(this,r,Q)}function pe(Q){Dn.call(this,r,Q)}function Ie(Q){Dn.call(this,r,Q)}return r.$$set=Q=>{"id"in Q&&t(1,o=Q.id),"source"in Q&&t(2,c=Q.source),"sourceLayer"in Q&&t(3,a=Q.sourceLayer),"beforeId"in Q&&t(4,d=Q.beforeId),"beforeLayerType"in Q&&t(5,p=Q.beforeLayerType),"paint"in Q&&t(6,_=Q.paint),"layout"in Q&&t(7,y=Q.layout),"filter"in Q&&t(8,w=Q.filter),"minzoom"in Q&&t(9,T=Q.minzoom),"maxzoom"in Q&&t(10,M=Q.maxzoom),"hoverCursor"in Q&&t(11,$=Q.hoverCursor),"manageHoverState"in Q&&t(12,D=Q.manageHoverState),"hovered"in Q&&t(0,z=Q.hovered),"eventsIfTopMost"in Q&&t(13,I=Q.eventsIfTopMost),"interactive"in Q&&t(14,F=Q.interactive),"$$scope"in Q&&t(23,i=Q.$$scope)},[z,o,c,a,d,p,_,y,w,T,M,$,D,I,F,n,N,W,oe,J,ee,pe,Ie,i]}class Z8 extends Et{constructor(e){super(),Lt(this,e,q8,V8,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function G8(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const c=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):c())};a()}else c()}function H8(r,e,t){yb().then(()=>{let n=di(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function K1(r){let e=r[0],t,n,i=X1(r);return{c(){i.c(),t=Qn()},m(o,c){i.m(o,c),q(o,t,c),n=!0},p(o,c){c&1&&wt(e,e=o[0])?(tn(),Z(i,1,1,tt),nn(),i=X1(o),i.c(),j(i,1),i.m(t.parentNode,t)):i.p(o,c)},i(o){n||(j(i),n=!0)},o(o){Z(i),n=!1},d(o){o&&V(t),i.d(o)}}}function X1(r){let e;const t=r[15].default,n=Cn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&Mn(n,t,i,i[14],e?Tn(t,i[14],o,null):Ln(i[14]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function W8(r){let e,t,n=r[0]&&K1(r);return{c(){n&&n.c(),e=Qn()},m(i,o){n&&n.m(i,o),q(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&j(n,1)):(n=K1(i),n.c(),j(n,1),n.m(e.parentNode,e)):n&&(tn(),Z(n,1,1,()=>{n=null}),nn())},i(i){t||(j(n),t=!0)},o(i){Z(n),t=!1},d(i){i&&V(e),n&&n.d(i)}}}function K8(r,e,t){let n,i,o,{$$slots:c={},$$scope:a}=e,{id:d=zh("geojson")}=e,{data:p}=e,{generateId:_=!1}=e,{promoteId:y=void 0}=e,{filter:w=void 0}=e,{lineMetrics:T=void 0}=e,{cluster:M=void 0}=e;const{map:$,cluster:D,self:z}=P8();at(r,$,N=>t(13,i=N)),at(r,D,N=>t(16,o=N)),at(r,z,N=>t(0,n=N));let I,F=!0;return Yr(()=>{n&&I&&i&&(H8($,n,I),Nt(z,n=null,n),t(11,I=void 0))}),r.$$set=N=>{"id"in N&&t(4,d=N.id),"data"in N&&t(5,p=N.data),"generateId"in N&&t(6,_=N.generateId),"promoteId"in N&&t(7,y=N.promoteId),"filter"in N&&t(8,w=N.filter),"lineMetrics"in N&&t(9,T=N.lineMetrics),"cluster"in N&&t(10,M=N.cluster),"$$scope"in N&&t(14,a=N.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&Nt(D,o=M,o),r.$$.dirty&12273&&i&&n!==d&&(Nt(z,n=d,n),G8(i,n,La({type:"geojson",data:p,filter:w,lineMetrics:T,generateId:_,promoteId:y,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties}),N=>i&&N===n,()=>{n&&(t(11,I=i==null?void 0:i.getSource(n)),t(12,F=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,I=i==null?void 0:i.getSource(d))})),r.$$.dirty&6176&&I&&(F?t(12,F=!1):I.setData(p)),r.$$.dirty&3072&&(I==null||I.setClusterOptions(La({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[n,$,D,z,d,p,_,y,w,T,M,I,F,i,a,c]}class X8 extends Et{constructor(e){super(),Lt(this,e,K8,W8,wt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function J8(r){let e;const t=r[15].default,n=Cn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&Mn(n,t,i,i[23],e?Tn(t,i[23],o,null):Ln(i[23]),null)},i(i){e||(j(n,i),e=!0)},o(i){Z(n,i),e=!1},d(i){n&&n.d(i)}}}function Y8(r){let e,t,n;function i(c){r[16](c)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[J8]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new rg({props:o}),hn.push(()=>An(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,[a]){const d={};a&2&&(d.id=c[1]),a&4&&(d.source=c[2]),a&8&&(d.sourceLayer=c[3]),a&16&&(d.beforeId=c[4]),a&32&&(d.beforeLayerType=c[5]),a&64&&(d.paint=c[6]),a&128&&(d.layout=c[7]),a&256&&(d.filter=c[8]),a&512&&(d.minzoom=c[9]),a&1024&&(d.maxzoom=c[10]),a&2048&&(d.hoverCursor=c[11]),a&4096&&(d.manageHoverState=c[12]),a&8192&&(d.eventsIfTopMost=c[13]),a&16384&&(d.interactive=c[14]),a&8388608&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.hovered=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function Q8(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=zh("line")}=e,{source:c=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:_}=e,{layout:y=void 0}=e,{filter:w=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:$=void 0}=e,{manageHoverState:D=!1}=e,{hovered:z=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:F=!0}=e;function N(Q){z=Q,t(0,z)}function W(Q){Dn.call(this,r,Q)}function oe(Q){Dn.call(this,r,Q)}function J(Q){Dn.call(this,r,Q)}function ee(Q){Dn.call(this,r,Q)}function pe(Q){Dn.call(this,r,Q)}function Ie(Q){Dn.call(this,r,Q)}return r.$$set=Q=>{"id"in Q&&t(1,o=Q.id),"source"in Q&&t(2,c=Q.source),"sourceLayer"in Q&&t(3,a=Q.sourceLayer),"beforeId"in Q&&t(4,d=Q.beforeId),"beforeLayerType"in Q&&t(5,p=Q.beforeLayerType),"paint"in Q&&t(6,_=Q.paint),"layout"in Q&&t(7,y=Q.layout),"filter"in Q&&t(8,w=Q.filter),"minzoom"in Q&&t(9,T=Q.minzoom),"maxzoom"in Q&&t(10,M=Q.maxzoom),"hoverCursor"in Q&&t(11,$=Q.hoverCursor),"manageHoverState"in Q&&t(12,D=Q.manageHoverState),"hovered"in Q&&t(0,z=Q.hovered),"eventsIfTopMost"in Q&&t(13,I=Q.eventsIfTopMost),"interactive"in Q&&t(14,F=Q.interactive),"$$scope"in Q&&t(23,i=Q.$$scope)},[z,o,c,a,d,p,_,y,w,T,M,$,D,I,F,n,N,W,oe,J,ee,pe,Ie,i]}class eP extends Et{constructor(e){super(),Lt(this,e,Q8,Y8,wt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function tP(r){let e,t,n,i,o,c;return e=new Z8({props:{id:"edit-polygon-fill",filter:v8,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new eP({props:{id:"edit-polygon-lines",filter:w8,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new j8({props:{id:"edit-polygon-vertices",filter:x8,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment)},m(a,d){le(e,a,d),q(a,t,d),le(n,a,d),q(a,i,d),le(o,a,d),c=!0},p:tt,i(a){c||(j(e.$$.fragment,a),j(n.$$.fragment,a),j(o.$$.fragment,a),c=!0)},o(a){Z(e.$$.fragment,a),Z(n.$$.fragment,a),Z(o.$$.fragment,a),c=!1},d(a){a&&(V(t),V(i)),ce(e,a),ce(n,a),ce(o,a)}}}function nP(r){let e,t;return e=new X8({props:{data:r[0],$$slots:{default:[tP]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function rP(r,e,t){let n;return at(r,Zv,i=>t(0,n=i)),[n]}class iP extends Et{constructor(e){super(),Lt(this,e,rP,nP,wt,{})}}function oP(r){let e,t,n,i,o,c,a;return{c(){e=U("button"),e.textContent="Import current view",t=ie(),n=U("i"),n.textContent="or...",i=ie(),o=U("button"),o.textContent="Draw an area to import on the map",fe(e,"type","button"),fe(o,"type","button")},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p),q(d,i,p),q(d,o,p),c||(a=[xt(e,"click",r[2]),xt(o,"click",r[3])],c=!0)},p:tt,i:tt,o:tt,d(d){d&&(V(e),V(t),V(n),V(i),V(o)),c=!1,mr(a)}}}function sP(r){let e,t;return e=new E8({props:{polygonTool:r[0]}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function aP(r){let e,t,n,i,o,c,a,d,p;const _=[sP,oP],y=[];function w(T,M){return T[0]?0:1}return e=w(r),t=y[e]=_[e](r),{c(){t.c(),n=ie(),i=U("label"),o=U("input"),c=xe(`Save a copy of the osm.xml
  after importing`),fe(o,"type","checkbox")},m(T,M){y[e].m(T,M),q(T,n,M),q(T,i,M),R(i,o),o.checked=r[1],R(i,c),a=!0,d||(p=xt(o,"change",r[5]),d=!0)},p(T,[M]){let $=e;e=w(T),e===$?y[e].p(T,M):(tn(),Z(y[$],1,1,()=>{y[$]=null}),nn(),t=y[e],t?t.p(T,M):(t=y[e]=_[e](T),t.c()),j(t,1),t.m(n.parentNode,n)),M&2&&(o.checked=T[1])},i(T){a||(j(t),a=!0)},o(T){Z(t),a=!1},d(T){T&&(V(n),V(i)),y[e].d(T),d=!1,p()}}}function Wu(r){return[r.lng,r.lat]}function lP(r,e,t){let{map:n}=e;const i=ms();let o=null,c=!1;async function a(w){try{i("loading","Loading from Overpass");let M=await(await fetch(Kv(w))).text();c&&bd("osm.xml",M),i("gotXml",{xml:M,boundary:w})}catch(T){i("error",T.toString())}}function d(){let w=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[Wu(w.getSouthWest()),Wu(w.getNorthWest()),Wu(w.getNorthEast()),Wu(w.getSouthEast()),Wu(w.getSouthWest())]],type:"Polygon"}}}async function p(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await a(d())}}function _(){n&&(t(0,o=new S8(n)),o.startNew(),o.addEventListenerSuccess(async w=>{t(0,o=null),await a(w)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function y(){c=this.checked,t(1,c)}return r.$$set=w=>{"map"in w&&t(4,n=w.map)},[o,c,p,_,n,y]}class cP extends Et{constructor(e){super(),Lt(this,e,lP,aP,wt,{map:4})}}function Kv(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class Xv{constructor(e,t,n,i,o,c,a,d){tr(this,"inner");this.inner=new qM(e,t||new Uint8Array,n||new Uint8Array,i,o,c,a,d)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=uP(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,c]=n;return{count:i,before:o,after:c}})}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=T0(t.properties.counts_from),t.properties.sum_to=T0(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}}function uP(r){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of r.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return r}async function kh(r){let e=di(Qs).project(r);try{console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:i,boundary:o}=await hP(e);console.timeEnd("get input files"),console.time("load"),Ar.set(new Xv(new Uint8Array(t),n?new Uint8Array(n):void 0,i?new Uint8Array(i):void 0,o,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),di(Ar).loadSavefile(e),_l.set(r),console.timeEnd("load"),fP(r)}catch(t){window.alert(`Couldn't open project: ${t}`),_l.set(void 0)}}async function hP(r){if(r.app_focus=="cnt"){console.assert(r.study_area_name,"CNT projects must have a study area name");let e=zo(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${e}`);let n=await(await xa(e)).arrayBuffer(),i=zo(`cnt_boundaries/${r.study_area_name}.geojson`),c=await(await xa(i)).json(),a=zo(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${a}`);let d;try{d=await(await xa(a)).arrayBuffer()}catch(y){console.log(`No demand model: ${y}`)}let p=zo(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${p}`);let _;try{_=await(await xa(p)).arrayBuffer()}catch(y){console.log(`No context data for prioritization: ${y}`)}return{osmBuffer:n,boundary:c,demandBuffer:d,contextDataBuffer:_}}else if(r.study_area_name){let e=zo(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${e}`);let n=await(await xa(e)).arrayBuffer(),i=zo(`boundaries/${r.study_area_name}.geojson`),c=await(await xa(i)).json();return{osmBuffer:n,boundary:c}}else{console.log("Grabbing from Overpass");let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await xa(Kv(e))).arrayBuffer(),boundary:e}}}function fP(r){gd.set(new ok(di(Ro),di(Ar).toRouteSnapper(),$n(Wi()),$n(!0),$n(0))),di(Ro).fitBounds(di(Ar).getBounds(),{duration:500});let e=new URL(window.location.href);e.searchParams.set("project",r),window.history.replaceState(null,"",e.toString())}function J1(r,e,t){const n=r.slice();return n[16]=e[t][0],n[17]=e[t][1],n}function Y1(r,e,t){const n=r.slice();return n[20]=e[t][0],n[21]=e[t][1],n}function dP(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function pP(r){let e,t,n,i,o,c,a,d;return o=new On({props:{$$slots:{default:[dP]},$$scope:{ctx:r}}}),o.$on("click",Bo),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),a.textContent="New project",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m(p,_){q(p,e,_),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),d=!0},p(p,_){const y={};_&16777216&&(y.$$scope={dirty:_,ctx:p}),o.$set(y)},i(p){d||(j(o.$$.fragment,p),d=!0)},o(p){Z(o.$$.fragment,p),d=!1},d(p){p&&V(e),ce(o)}}}function Q1(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M;e=new Ch({props:{loading:r[4]}});let $=Nn(r[3]),D=[];for(let z=0;z<$.length;z+=1)D[z]=tb(J1(r,$,z));return y=new cP({props:{map:r[5]}}),y.$on("gotXml",r[6]),y.$on("loading",r[10]),y.$on("error",r[11]),{c(){he(e.$$.fragment),t=ie(),n=U("label"),i=xe(`Load a built-in area:
        `),o=U("select"),c=U("option");for(let z=0;z<D.length;z+=1)D[z].c();a=ie(),d=U("i"),d.textContent="or...",p=ie(),_=U("div"),he(y.$$.fragment),c.__value="",Wn(c,c.__value),r[2]===void 0&&us(()=>r[8].call(o))},m(z,I){le(e,z,I),q(z,t,I),q(z,n,I),R(n,i),R(n,o),R(o,c);for(let F=0;F<D.length;F+=1)D[F]&&D[F].m(o,null);Zi(o,r[2],!0),q(z,a,I),q(z,d,I),q(z,p,I),q(z,_,I),le(y,_,null),w=!0,T||(M=[xt(o,"change",r[8]),xt(o,"change",r[9])],T=!0)},p(z,I){const F={};if(I&16&&(F.loading=z[4]),e.$set(F),I&8){$=Nn(z[3]);let W;for(W=0;W<$.length;W+=1){const oe=J1(z,$,W);D[W]?D[W].p(oe,I):(D[W]=tb(oe),D[W].c(),D[W].m(o,null))}for(;W<D.length;W+=1)D[W].d(1);D.length=$.length}I&12&&Zi(o,z[2]);const N={};I&32&&(N.map=z[5]),y.$set(N)},i(z){w||(j(e.$$.fragment,z),j(y.$$.fragment,z),w=!0)},o(z){Z(e.$$.fragment,z),Z(y.$$.fragment,z),w=!1},d(z){z&&(V(t),V(n),V(a),V(d),V(p),V(_)),ce(e,z),pi(D,z),ce(y),T=!1,mr(M)}}}function eb(r){let e,t=r[21]+"",n,i;return{c(){e=U("option"),n=xe(t),e.__value=i=r[20],Wn(e,e.__value)},m(o,c){q(o,e,c),R(e,n)},p(o,c){c&8&&t!==(t=o[21]+"")&&Mt(n,t),c&8&&i!==(i=o[20])&&(e.__value=i,Wn(e,e.__value))},d(o){o&&V(e)}}}function tb(r){let e,t,n=Nn(r[17]),i=[];for(let o=0;o<n.length;o+=1)i[o]=eb(Y1(r,n,o));return{c(){e=U("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();fe(e,"label",t=r[16])},m(o,c){q(o,e,c);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null)},p(o,c){if(c&8){n=Nn(o[17]);let a;for(a=0;a<n.length;a+=1){const d=Y1(o,n,a);i[a]?i[a].p(d,c):(i[a]=eb(d),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}c&8&&t!==(t=o[16])&&fe(e,"label",t)},d(o){o&&V(e),pi(i,o)}}}function mP(r){let e,t,n,i,o,c,a,d,p,_=r[1]&&Q1(r);return{c(){e=U("div"),t=U("div"),n=U("label"),i=xe(`Project name:
        `),o=U("input"),c=ie(),_&&_.c(),fe(o,"type","text"),fe(e,"slot","sidebar")},m(y,w){q(y,e,w),R(e,t),R(t,n),R(n,i),R(n,o),Wn(o,r[1]),R(e,c),_&&_.m(e,null),a=!0,d||(p=xt(o,"input",r[7]),d=!0)},p(y,w){w&2&&o.value!==y[1]&&Wn(o,y[1]),y[1]?_?(_.p(y,w),w&2&&j(_,1)):(_=Q1(y),_.c(),j(_,1),_.m(e,null)):_&&(tn(),Z(_,1,1,()=>{_=null}),nn())},i(y){a||(j(_),a=!0)},o(y){Z(_),a=!1},d(y){y&&V(e),_&&_.d(),d=!1,p()}}}function gP(r){let e,t,n;return t=new iP({}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","map")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p:tt,i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function _P(r){let e,t;return e=new bo({props:{$$slots:{map:[gP],sidebar:[mP],top:[pP]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&16777278&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function yP(r,e,t){let n,i,o,c,a;at(r,an,F=>t(12,n=F)),at(r,Qs,F=>t(13,i=F)),at(r,Ar,F=>t(14,o=F)),at(r,Fo,F=>t(15,c=F)),at(r,Ro,F=>t(5,a=F));let d="",p=null,_=[],y="";Ls(async()=>{let F=await xa(zo("severance_pbfs/areas.json"));t(3,_=await F.json())});async function w(F){t(4,y="Loading OSM");try{let N;Nt(Ar,o=new Xv(new TextEncoder().encode(F.detail.xml),void 0,void 0,F.detail.boundary,c,N,d,i.dbSchemaVersion),o);const W=i.createProject(o.toSavefile());await kh(W),Nt(an,n={mode:"add-neighbourhood"},n)}catch(N){window.alert(`Couldn't import from Overpass: ${N}`)}t(4,y="")}async function T(){if(!p)return;let F;try{F=i.createEmptyProject(d,p)}catch(N){t(2,p=null),window.alert(`Couldn't create project: ${N}`);return}t(4,y=`Loading pre-clipped OSM area ${p}`),await kh(F),Nt(an,n={mode:"add-neighbourhood"},n),t(4,y="")}function M(){d=this.value,t(1,d)}function $(){p=Sa(this),t(2,p),t(3,_)}return[T,d,p,_,y,a,w,M,$,()=>T(),F=>t(4,y=F.detail),F=>window.alert(F.detail)]}class bP extends Et{constructor(e){super(),Lt(this,e,yP,_P,wt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const vP="/ltn/assets/boundaries-2701bb3b.geojson";function nb(r,e,t){const n=r.slice();return n[9]=e[t],n}function wP(r){let e=r[9]+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i&2&&e!==(e=n[9]+"")&&Mt(t,e)},d(n){n&&V(t)}}}function rb(r){let e,t,n;function i(){return r[5](r[9])}return t=new On({props:{$$slots:{default:[wP]},$$scope:{ctx:r}}}),t.$on("click",i),{c(){e=U("li"),he(t.$$.fragment)},m(o,c){q(o,e,c),le(t,e,null),n=!0},p(o,c){r=o;const a={};c&4098&&(a.$$scope={dirty:c,ctx:r}),t.$set(a)},i(o){n||(j(t.$$.fragment,o),n=!0)},o(o){Z(t.$$.fragment,o),n=!1},d(o){o&&V(e),ce(t)}}}function xP(r){let e,t,n=r[8].name+"",i;return{c(){e=U("p"),t=xe("Click to start a new project in "),i=xe(n)},m(o,c){q(o,e,c),R(e,t),R(e,i)},p(o,c){c&256&&n!==(n=o[8].name+"")&&Mt(i,n)},d(o){o&&V(e)}}}function kP(r){let e,t;return e=new hi({props:{openOn:"hover",$$slots:{default:[xP,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&4352&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function SP(r){let e,t,n,i;return e=new zi({props:{paint:{"fill-color":yo.mapFeature.hover.backgroundColor,"fill-outline-color":yo.mapFeature.hover.backgroundColor,"fill-opacity":Jn(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[kP]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new rr({props:{paint:{"line-color":yo.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(o,c){le(e,o,c),q(o,t,c),le(n,o,c),i=!0},p(o,c){const a={};c&4096&&(a.$$scope={dirty:c,ctx:o}),e.$set(a)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),ce(e,o),ce(n,o)}}}function CP(r){let e,t,n,i,o,c,a=Nn(r[1]),d=[];for(let _=0;_<a.length;_+=1)d[_]=rb(nb(r,a,_));const p=_=>Z(d[_],1,1,()=>{d[_]=null});return o=new pr({props:{data:r[0],generateId:!0,$$slots:{default:[SP]},$$scope:{ctx:r}}}),{c(){e=U("p"),e.textContent="Choose a boundary below or on the map to begin sketching:",t=ie(),n=U("ul");for(let _=0;_<d.length;_+=1)d[_].c();i=ie(),he(o.$$.fragment),st(n,"columns","3")},m(_,y){q(_,e,y),q(_,t,y),q(_,n,y);for(let w=0;w<d.length;w+=1)d[w]&&d[w].m(n,null);q(_,i,y),le(o,_,y),c=!0},p(_,[y]){if(y&10){a=Nn(_[1]);let T;for(T=0;T<a.length;T+=1){const M=nb(_,a,T);d[T]?(d[T].p(M,y),j(d[T],1)):(d[T]=rb(M),d[T].c(),j(d[T],1),d[T].m(n,null))}for(tn(),T=a.length;T<d.length;T+=1)p(T);nn()}const w={};y&1&&(w.data=_[0]),y&4096&&(w.$$scope={dirty:y,ctx:_}),o.$set(w)},i(_){if(!c){for(let y=0;y<a.length;y+=1)j(d[y]);j(o.$$.fragment,_),c=!0}},o(_){d=d.filter(Boolean);for(let y=0;y<d.length;y+=1)Z(d[y]);Z(o.$$.fragment,_),c=!1},d(_){_&&(V(e),V(t),V(n),V(i)),pi(d,_),ce(o,_)}}}function TP(r,e,t){let n,i;at(r,an,y=>t(6,n=y)),at(r,Qs,y=>t(7,i=y));let{activityIndicatorText:o}=e,c={type:"FeatureCollection",features:[]},a=[];Ls(async()=>{let y=await fetch(vP);t(0,c=await y.json());for(let w of c.features)a.push(w.properties.name);a.sort(),t(1,a)});function d(y){let w=y.detail.features[0].properties;p(`${w.kind}_${w.name}`)}async function p(y){let w,T=!1;for(;!T;){let M=w||i.nextAvailableProjectName(ch(y));if(w=window.prompt(`Please pick a project name to create in ${ch(y)}`,M),w===null)return;if(w=w.trim(),w===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}t(4,o=`Loading pre-clipped OSM area ${ch(y)}`);try{let $=i.createEmptyProject(w,y);await kh($),Nt(an,n={mode:"add-neighbourhood"},n),T=!0}catch($){window.alert($)}t(4,o="")}}const _=y=>p(`LAD_${y}`);return r.$$set=y=>{"activityIndicatorText"in y&&t(4,o=y.activityIndicatorText)},[c,a,d,p,o,_]}class MP extends Et{constructor(e){super(),Lt(this,e,TP,CP,wt,{activityIndicatorText:4})}}function LP(r){let e,t,n,i,o,c;return{c(){e=U("label"),t=U("strong"),t.textContent="Load a project from a file",n=ie(),i=U("input"),fe(i,"type","file"),st(e,"margin-top","16px")},m(a,d){q(a,e,d),R(e,t),R(e,n),R(e,i),r[3](i),o||(c=xt(i,"change",r[1]),o=!0)},p:tt,i:tt,o:tt,d(a){a&&V(e),r[3](null),o=!1,c()}}}function EP(r,e,t){let n;at(r,an,d=>t(4,n=d));let{loading:i}=e,o;async function c(d){let p=o.files[0].name;t(2,i=`Loading from file ${p}`);let _=await o.files[0].text(),y=JSON.parse(_),w,T,M;y.app_focus&&(console.assert(y.app_focus=="global"||y.app_focus=="cnt"),w=y.app_focus),y.study_area_name&&(T=y.study_area_name),y.project_name&&(M=y.project_name),(!y.app_focus||!y.project_name)&&(y.study_area_name&&y.study_area_name.startsWith("LAD_")?(w="cnt",M=M0(pm(p,`ltn_cnt_${y.study_area_name}_`),".geojson")):(w="global",M=M0(pm(p,"ltn_"),".geojson"))),M=M,w=w;let $=Vm.projectStorage(w);M=$.nextAvailableProjectName(M),y.project_name=M,y.app_focus=w,y.study_area_name=T;let D=$.createProject(y);await kh(D),Nt(an,n={mode:"pick-neighbourhood"},n),t(2,i="")}function a(d){hn[d?"unshift":"push"](()=>{o=d,t(0,o)})}return r.$$set=d=>{"loading"in d&&t(2,i=d.loading)},[o,c,i,a]}class IP extends Et{constructor(e){super(),Lt(this,e,EP,LP,wt,{loading:2})}}function ib(r,e,t){const n=r.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function ob(r,e,t){const n=r.slice();return n[26]=e[t].projectID,n[27]=e[t].projectName,n}function AP(r){let e;return{c(){e=U("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',fe(e,"slot","top")},m(t,n){q(t,e,n)},p:tt,d(t){t&&V(e)}}}function PP(r){let e;return{c(){e=U("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){q(t,e,n)},p:tt,i:tt,o:tt,d(t){t&&V(e)}}}function zP(r){let e,t,n,i,o,c,a,d,p,_=r[2].length>0&&sb(r);const y=[RP,$P],w=[];function T(D,z){return D[5]=="global"?0:D[5]=="cnt"?1:-1}~(i=T(r))&&(o=w[i]=y[i](r));function M(D){r[16](D)}let $={};return r[1]!==void 0&&($.loading=r[1]),a=new IP({props:$}),hn.push(()=>An(a,"loading",M)),{c(){_&&_.c(),e=ie(),t=U("h1"),t.textContent="Start a new project",n=ie(),o&&o.c(),c=ie(),he(a.$$.fragment)},m(D,z){_&&_.m(D,z),q(D,e,z),q(D,t,z),q(D,n,z),~i&&w[i].m(D,z),q(D,c,z),le(a,D,z),p=!0},p(D,z){D[2].length>0?_?(_.p(D,z),z&4&&j(_,1)):(_=sb(D),_.c(),j(_,1),_.m(e.parentNode,e)):_&&(tn(),Z(_,1,1,()=>{_=null}),nn());let I=i;i=T(D),i===I?~i&&w[i].p(D,z):(o&&(tn(),Z(w[I],1,1,()=>{w[I]=null}),nn()),~i?(o=w[i],o?o.p(D,z):(o=w[i]=y[i](D),o.c()),j(o,1),o.m(c.parentNode,c)):o=null);const F={};!d&&z&2&&(d=!0,F.loading=D[1],In(()=>d=!1)),a.$set(F)},i(D){p||(j(_),j(o),j(a.$$.fragment,D),p=!0)},o(D){Z(_),Z(o),Z(a.$$.fragment,D),p=!1},d(D){D&&(V(e),V(t),V(n),V(c)),_&&_.d(D),~i&&w[i].d(D),ce(a,D)}}}function sb(r){let e,t,n,i,o=Nn(r[2]),c=[];for(let d=0;d<o.length;d+=1)c[d]=lb(ib(r,o,d));const a=d=>Z(c[d],1,1,()=>{c[d]=null});return{c(){e=U("h1"),e.textContent="Your projects",t=ie(),n=U("div");for(let d=0;d<c.length;d+=1)c[d].c();fe(n,"class","project-list svelte-s5f8l2")},m(d,p){q(d,e,p),q(d,t,p),q(d,n,p);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(n,null);i=!0},p(d,p){if(p&452){o=Nn(d[2]);let _;for(_=0;_<o.length;_+=1){const y=ib(d,o,_);c[_]?(c[_].p(y,p),j(c[_],1)):(c[_]=lb(y),c[_].c(),j(c[_],1),c[_].m(n,null))}for(tn(),_=o.length;_<c.length;_+=1)a(_);nn()}},i(d){if(!i){for(let p=0;p<o.length;p+=1)j(c[p]);i=!0}},o(d){c=c.filter(Boolean);for(let p=0;p<c.length;p+=1)Z(c[p]);i=!1},d(d){d&&(V(e),V(t),V(n)),pi(c,d)}}}function DP(r){let e=r[27]+"",t;return{c(){t=xe(e)},m(n,i){q(n,t,i)},p(n,i){i&4&&e!==(e=n[27]+"")&&Mt(t,e)},d(n){n&&V(t)}}}function ab(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M,$,D;function z(){return r[10](r[26],r[27])}n=new On({props:{$$slots:{default:[DP]},$$scope:{ctx:r}}}),n.$on("click",z),a=new Nb({props:{color:"black"}});function I(){return r[11](r[26])}_=new jb({props:{color:"black"}});function F(){return r[12](r[26],r[27])}T=new qm({props:{color:"white"}});function N(){return r[13](r[26],r[27])}return{c(){e=U("li"),t=U("h3"),he(n.$$.fragment),i=ie(),o=U("span"),c=U("button"),he(a.$$.fragment),d=ie(),p=U("button"),he(_.$$.fragment),y=ie(),w=U("button"),he(T.$$.fragment),fe(c,"class","outline icon-btn"),fe(c,"title","Download project as GeoJSON"),fe(p,"class","outline icon-btn"),fe(p,"title","Rename project"),fe(w,"class","icon-btn destructive"),fe(w,"title","Delete project"),fe(o,"class","actions"),fe(e,"class","actionable-cell svelte-s5f8l2")},m(W,oe){q(W,e,oe),R(e,t),le(n,t,null),R(e,i),R(e,o),R(o,c),le(a,c,null),R(o,d),R(o,p),le(_,p,null),R(o,y),R(o,w),le(T,w,null),M=!0,$||(D=[xt(c,"click",I),xt(p,"click",F),xt(w,"click",N)],$=!0)},p(W,oe){r=W;const J={};oe&1073741828&&(J.$$scope={dirty:oe,ctx:r}),n.$set(J)},i(W){M||(j(n.$$.fragment,W),j(a.$$.fragment,W),j(_.$$.fragment,W),j(T.$$.fragment,W),M=!0)},o(W){Z(n.$$.fragment,W),Z(a.$$.fragment,W),Z(_.$$.fragment,W),Z(T.$$.fragment,W),M=!1},d(W){W&&V(e),ce(n),ce(a),ce(_),ce(T),$=!1,mr(D)}}}function lb(r){let e,t=ch(r[22])+"",n,i,o,c,a,d=Nn(r[23]),p=[];for(let y=0;y<d.length;y+=1)p[y]=ab(ob(r,d,y));const _=y=>Z(p[y],1,1,()=>{p[y]=null});return{c(){e=U("h2"),n=xe(t),i=ie(),o=U("ul");for(let y=0;y<p.length;y+=1)p[y].c();c=ie(),fe(e,"class","study-area-name svelte-s5f8l2"),fe(o,"class","navigable-list")},m(y,w){q(y,e,w),R(e,n),q(y,i,w),q(y,o,w);for(let T=0;T<p.length;T+=1)p[T]&&p[T].m(o,null);R(o,c),a=!0},p(y,w){if((!a||w&4)&&t!==(t=ch(y[22])+"")&&Mt(n,t),w&452){d=Nn(y[23]);let T;for(T=0;T<d.length;T+=1){const M=ob(y,d,T);p[T]?(p[T].p(M,w),j(p[T],1)):(p[T]=ab(M),p[T].c(),j(p[T],1),p[T].m(o,c))}for(tn(),T=d.length;T<p.length;T+=1)_(T);nn()}},i(y){if(!a){for(let w=0;w<d.length;w+=1)j(p[w]);a=!0}},o(y){p=p.filter(Boolean);for(let w=0;w<p.length;w+=1)Z(p[w]);a=!1},d(y){y&&(V(e),V(i),V(o)),pi(p,y)}}}function $P(r){let e,t,n;function i(c){r[15](c)}let o={};return r[1]!==void 0&&(o.activityIndicatorText=r[1]),e=new MP({props:o}),hn.push(()=>An(e,"activityIndicatorText",i)),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,a){const d={};!t&&a&2&&(t=!0,d.activityIndicatorText=c[1],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function RP(r){let e,t,n;return{c(){e=U("button"),e.textContent="New project"},m(i,o){q(i,e,o),t||(n=xt(e,"click",r[14]),t=!0)},p:tt,i:tt,o:tt,d(i){i&&V(e),t=!1,n()}}}function FP(r){let e,t,n,i;const o=[zP,PP],c=[];function a(d,p){return d[4]&&d[0]?0:1}return t=a(r),n=c[t]=o[t](r),{c(){e=U("div"),n.c(),fe(e,"slot","sidebar")},m(d,p){q(d,e,p),c[t].m(e,null),i=!0},p(d,p){let _=t;t=a(d),t===_?c[t].p(d,p):(tn(),Z(c[_],1,1,()=>{c[_]=null}),nn(),n=c[t],n?n.p(d,p):(n=c[t]=o[t](d),n.c()),j(n,1),n.m(e,null))},i(d){i||(j(n),i=!0)},o(d){Z(n),i=!1},d(d){d&&V(e),c[t].d()}}}function BP(r){let e,t,n,i;return e=new Ch({props:{loading:r[1]}}),n=new bo({props:{$$slots:{sidebar:[FP],top:[AP]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment)},m(o,c){le(e,o,c),q(o,t,c),le(n,o,c),i=!0},p(o,[c]){const a={};c&2&&(a.loading=o[1]),e.$set(a);const d={};c&1073741887&&(d.$$scope={dirty:c,ctx:o}),n.$set(d)},i(o){i||(j(e.$$.fragment,o),j(n.$$.fragment,o),i=!0)},o(o){Z(e.$$.fragment,o),Z(n.$$.fragment,o),i=!1},d(o){o&&V(t),ce(e,o),ce(n,o)}}}function OP(r,e,t){let n,i,o,c,a,d,p;at(r,an,pe=>t(3,n=pe)),at(r,Qs,pe=>t(17,i=pe)),at(r,_l,pe=>t(18,o=pe)),at(r,gd,pe=>t(19,c=pe)),at(r,Ar,pe=>t(20,a=pe)),at(r,Ro,pe=>t(4,d=pe)),at(r,Fo,pe=>t(5,p=pe));let{wasmReady:_}=e,{firstLoad:y}=e,w="";if(Nt(Ar,a=null,a),Nt(gd,c=null,c),Nt(_l,o=void 0,o),y){let Ie=new URLSearchParams(window.location.search).get("project");Ie&&M(Ie)}else{let pe=new URL(window.location.href);pe.searchParams.delete("project"),window.history.replaceState(null,"",pe.toString())}let T=i.studyAreaProjects();function M(pe){let Ie=pe;try{let Q=i.projectName(Ie);if(!Q){console.error(`Project ${Ie} from URL not found`);return}z(Ie,Q)}catch{console.error(`Error trying to fetch project from URL: ${Ie}`)}}function $(pe,Ie){window.confirm(`Really delete project ${Ie}? You can't undo this.`)&&(i.removeProject(pe),t(2,T=i.studyAreaProjects()))}function D(pe,Ie){let Q=window.prompt(`Rename project ${Ie} to what?`,Ie);if(Q){try{i.renameProject(pe,Q)}catch(ae){window.alert(`Couldn't rename project: ${ae}`)}t(2,T=i.studyAreaProjects())}}async function z(pe,Ie){t(1,w=`Loading project ${Ie}`),await kh(pe),Nt(an,n={mode:"pick-neighbourhood"},n),t(1,w="")}const I=(pe,Ie)=>z(pe,Ie),F=pe=>mv(pe),N=(pe,Ie)=>D(pe,Ie),W=(pe,Ie)=>$(pe,Ie),oe=()=>Nt(an,n={mode:"new-project"},n);function J(pe){w=pe,t(1,w)}function ee(pe){w=pe,t(1,w)}return r.$$set=pe=>{"wasmReady"in pe&&t(0,_=pe.wasmReady),"firstLoad"in pe&&t(9,y=pe.firstLoad)},[_,w,T,n,d,p,$,D,z,y,I,F,N,W,oe,J,ee]}class NP extends Et{constructor(e){super(),Lt(this,e,OP,BP,wt,{wasmReady:0,firstLoad:9})}}function jP(r){let e;return{c(){e=xe("Choose project")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function UP(r){let e;return{c(){e=xe("Pick neighbourhood")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function VP(r){let e;return{c(){e=xe("Editing")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function qP(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M;return o=new On({props:{$$slots:{default:[jP]},$$scope:{ctx:r}}}),o.$on("click",Bo),d=new On({props:{$$slots:{default:[UP]},$$scope:{ctx:r}}}),d.$on("click",r[6]),y=new On({props:{$$slots:{default:[VP]},$$scope:{ctx:r}}}),y.$on("click",r[3]),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),he(o.$$.fragment),c=ie(),a=U("li"),he(d.$$.fragment),p=ie(),_=U("li"),he(y.$$.fragment),w=ie(),T=U("li"),T.textContent="Viewing shortcuts",fe(t,"aria-label","breadcrumb"),fe(e,"slot","top")},m($,D){q($,e,D),R(e,t),R(t,n),R(n,i),le(o,i,null),R(n,c),R(n,a),le(d,a,null),R(n,p),R(n,_),le(y,_,null),R(n,w),R(n,T),M=!0},p($,D){const z={};D&512&&(z.$$scope={dirty:D,ctx:$}),o.$set(z);const I={};D&512&&(I.$$scope={dirty:D,ctx:$}),d.$set(I);const F={};D&512&&(F.$$scope={dirty:D,ctx:$}),y.$set(F)},i($){M||(j(o.$$.fragment,$),j(d.$$.fragment,$),j(y.$$.fragment,$),M=!0)},o($){Z(o.$$.fragment,$),Z(d.$$.fragment,$),Z(y.$$.fragment,$),M=!1},d($){$&&V(e),ce(o),ce(d),ce(y)}}}function ZP(r){let e,t,n,i,o,c,a,d,p,_,y=vr(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",w,T,M,$,D,z;function I(N){r[5](N)}let F={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(F.idx=r[0].shortcutIndex),o=new kd({props:F}),hn.push(()=>An(o,"idx",I)),{c(){e=U("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=ie(),n=U("button"),n.textContent="Pick a different road",i=ie(),he(o.$$.fragment),a=ie(),d=U("p"),p=xe("This shortcut is "),_=U("b"),w=xe(y),T=xe("x"),M=xe(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(N,W){q(N,e,W),q(N,t,W),q(N,n,W),q(N,i,W),le(o,N,W),q(N,a,W),q(N,d,W),R(d,p),R(d,_),R(_,w),R(_,T),R(d,M),$=!0,D||(z=xt(n,"click",r[4]),D=!0)},p(N,W){const oe={};W&1&&(oe.list=N[0].gj.features),!c&&W&1&&(c=!0,oe.idx=N[0].shortcutIndex,In(()=>c=!1)),o.$set(oe),(!$||W&1)&&y!==(y=vr(N[0].gj.features[N[0].shortcutIndex].properties).directness.toFixed(1)+"")&&Mt(w,y)},i(N){$||(j(o.$$.fragment,N),$=!0)},o(N){Z(o.$$.fragment,N),$=!1},d(N){N&&(V(e),V(t),V(n),V(i),V(a),V(d)),ce(o,N),D=!1,z()}}}function GP(r){let e;return{c(){e=U("p"),e.textContent="Click a road to see shortcuts"},m(t,n){q(t,e,n)},p:tt,i:tt,o:tt,d(t){t&&V(e)}}}function HP(r){let e,t,n,i,o,c;t=new na({}),t.$on("click",r[3]);const a=[GP,ZP],d=[];function p(_,y){return _[0].state=="neutral"?0:_[0].state=="chose-road"?1:-1}return~(i=p(r))&&(o=d[i]=a[i](r)),{c(){e=U("div"),he(t.$$.fragment),n=ie(),o&&o.c(),fe(e,"slot","sidebar")},m(_,y){q(_,e,y),le(t,e,null),R(e,n),~i&&d[i].m(e,null),c=!0},p(_,y){let w=i;i=p(_),i===w?~i&&d[i].p(_,y):(o&&(tn(),Z(d[w],1,1,()=>{d[w]=null}),nn()),~i?(o=d[i],o?o.p(_,y):(o=d[i]=a[i](_),o.c()),j(o,1),o.m(e,null)):o=null)},i(_){c||(j(t.$$.fragment,_),j(o),c=!0)},o(_){Z(t.$$.fragment,_),Z(o),c=!1},d(_){_&&V(e),ce(t),~i&&d[i].d()}}}function WP(r){let e,t;return e=new Ah({props:{interactive:!1}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function KP(r){let e,t;return e=new Ah({props:{onClickLine:r[2],$$slots:{"line-popup":[QP]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&512&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function XP(r){let e,t,n=(r[8].name??"unnamed road")+"",i;return{c(){e=U("p"),t=xe("Main road: "),i=xe(n)},m(o,c){q(o,e,c),R(e,t),R(e,i)},p(o,c){c&256&&n!==(n=(o[8].name??"unnamed road")+"")&&Mt(i,n)},d(o){o&&V(e)}}}function JP(r){let e,t=r[8].shortcuts+"",n,i,o=(r[8].name??"unnamed road")+"",c;return{c(){e=U("p"),n=xe(t),i=xe(" shortcuts through "),c=xe(o)},m(a,d){q(a,e,d),R(e,n),R(e,i),R(e,c)},p(a,d){d&256&&t!==(t=a[8].shortcuts+"")&&Mt(n,t),d&256&&o!==(o=(a[8].name??"unnamed road")+"")&&Mt(c,o)},d(a){a&&V(e)}}}function YP(r){let e;function t(o,c){if(o[8].kind=="interior_road")return JP;if(o[8].kind=="main_road")return XP}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=Qn()},m(o,c){i&&i.m(o,c),q(o,e,c)},p(o,c){n===(n=t(o))&&i?i.p(o,c):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&V(e),i&&i.d(o)}}}function QP(r){let e,t,n;return t=new hi({props:{openOn:"hover",$$slots:{default:[YP,({props:i})=>({8:i}),({props:i})=>i?256:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),he(t.$$.fragment),fe(e,"slot","line-popup")},m(i,o){q(i,e,o),le(t,e,null),n=!0},p(i,o){const c={};o&768&&(c.$$scope={dirty:o,ctx:i}),t.$set(c)},i(i){n||(j(t.$$.fragment,i),n=!0)},o(i){Z(t.$$.fragment,i),n=!1},d(i){i&&V(e),ce(t)}}}function ez(r){let e,t,n,i,o,c,a,d,p,_;e=new Ad({}),n=new Id({}),o=new Pd({});const y=[KP,WP],w=[];function T(M,$){return M[0].state=="neutral"?0:M[0].state=="chose-road"?1:-1}return~(a=T(r))&&(d=w[a]=y[a](r)),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),d&&d.c(),p=Qn()},m(M,$){le(e,M,$),q(M,t,$),le(n,M,$),q(M,i,$),le(o,M,$),q(M,c,$),~a&&w[a].m(M,$),q(M,p,$),_=!0},p(M,$){let D=a;a=T(M),a===D?~a&&w[a].p(M,$):(d&&(tn(),Z(w[D],1,1,()=>{w[D]=null}),nn()),~a?(d=w[a],d?d.p(M,$):(d=w[a]=y[a](M),d.c()),j(d,1),d.m(p.parentNode,p)):d=null)},i(M){_||(j(e.$$.fragment,M),j(n.$$.fragment,M),j(o.$$.fragment,M),j(d),_=!0)},o(M){Z(e.$$.fragment,M),Z(n.$$.fragment,M),Z(o.$$.fragment,M),Z(d),_=!1},d(M){M&&(V(t),V(i),V(c),V(p)),ce(e,M),ce(n,M),ce(o,M),~a&&w[a].d(M)}}}function cb(r){let e,t,n,i,o,c,a,d;return e=new pr({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[tz]},$$scope:{ctx:r}}}),n=new pr({props:{data:r[0].roadGj,$$slots:{default:[nz]},$$scope:{ctx:r}}}),o=new yl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[rz]},$$scope:{ctx:r}}}),a=new yl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[iz]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),he(a.$$.fragment)},m(p,_){le(e,p,_),q(p,t,_),le(n,p,_),q(p,i,_),le(o,p,_),q(p,c,_),le(a,p,_),d=!0},p(p,_){const y={};_&1&&(y.data=p[0].gj.features[p[0].shortcutIndex]),_&512&&(y.$$scope={dirty:_,ctx:p}),e.$set(y);const w={};_&1&&(w.data=p[0].roadGj),_&512&&(w.$$scope={dirty:_,ctx:p}),n.$set(w);const T={};_&1&&(T.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[0]),_&512&&(T.$$scope={dirty:_,ctx:p}),o.$set(T);const M={};_&1&&(M.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[p[0].gj.features[p[0].shortcutIndex].geometry.coordinates.length-1]),_&512&&(M.$$scope={dirty:_,ctx:p}),a.$set(M)},i(p){d||(j(e.$$.fragment,p),j(n.$$.fragment,p),j(o.$$.fragment,p),j(a.$$.fragment,p),d=!0)},o(p){Z(e.$$.fragment,p),Z(n.$$.fragment,p),Z(o.$$.fragment,p),Z(a.$$.fragment,p),d=!1},d(p){p&&(V(t),V(i),V(c)),ce(e,p),ce(n,p),ce(o,p),ce(a,p)}}}function tz(r){let e,t;const n=[gn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function nz(r){let e,t;const n=[gn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new rr({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function rz(r){let e;return{c(){e=xe("A")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function iz(r){let e;return{c(){e=xe("B")},m(t,n){q(t,e,n)},d(t){t&&V(e)}}}function oz(r){let e,t,n,i,o,c;t=new Ph({props:{$$slots:{default:[ez]},$$scope:{ctx:r}}});let a=r[0].state=="chose-road"&&cb(r);return o=new Oa({}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),a&&a.c(),i=ie(),he(o.$$.fragment),fe(e,"slot","map")},m(d,p){q(d,e,p),le(t,e,null),R(e,n),a&&a.m(e,null),R(e,i),le(o,e,null),c=!0},p(d,p){const _={};p&513&&(_.$$scope={dirty:p,ctx:d}),t.$set(_),d[0].state=="chose-road"?a?(a.p(d,p),p&1&&j(a,1)):(a=cb(d),a.c(),j(a,1),a.m(e,i)):a&&(tn(),Z(a,1,1,()=>{a=null}),nn())},i(d){c||(j(t.$$.fragment,d),j(a),j(o.$$.fragment,d),c=!0)},o(d){Z(t.$$.fragment,d),Z(a),Z(o.$$.fragment,d),c=!1},d(d){d&&V(e),ce(t),a&&a.d(),ce(o)}}}function sz(r){let e,t;return e=new bo({props:{$$slots:{map:[oz],sidebar:[HP],top:[qP]},$$scope:{ctx:r}}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,[i]){const o={};i&515&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function az(r,e,t){let n,i;at(r,an,y=>t(1,n=y)),at(r,Ar,y=>t(7,i=y));let o={state:"neutral"};function c(y,w){let T=i.getShortcutsCrossingRoad(y.properties.id);if(T.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:y,gj:T,shortcutIndex:0})}function a(){Nt(an,n={mode:"neighbourhood"},n)}const d=()=>t(0,o={state:"neutral"});function p(y){r.$$.not_equal(o.shortcutIndex,y)&&(o.shortcutIndex=y,t(0,o))}return[o,n,c,a,d,p,()=>Nt(an,n={mode:"pick-neighbourhood"},n)]}class lz extends Et{constructor(e){super(),Lt(this,e,az,sz,wt,{})}}function cz(r){let e,t,n,i,o,c,a,d,p;return i=new b8({}),{c(){e=U("div"),t=U("button"),t.innerHTML=`<img src="${rx}" alt="A/B Street logo"/>`,n=ie(),he(i.$$.fragment),o=ie(),c=U("span"),fe(t,"class","outline"),st(c,"width","100%"),fe(e,"slot","top"),fe(e,"class","pico"),st(e,"display","flex"),st(e,"align-items","center"),st(e,"gap","8px")},m(_,y){q(_,e,y),R(e,t),R(e,n),le(i,e,null),R(e,o),R(e,c),r[23](c),a=!0,d||(p=xt(t,"click",r[22]),d=!0)},p:tt,i(_){a||(j(i.$$.fragment,_),a=!0)},o(_){Z(i.$$.fragment,_),a=!1},d(_){_&&V(e),ce(i),r[23](null),d=!1,p()}}}function ub(r){let e,t,n,i,o,c;return n=new TS({props:{map:vr(r[7]),maptilerBasemap:r[9]}}),{c(){e=U("button"),e.textContent="Zoom to fit study area",t=ie(),he(n.$$.fragment),fe(e,"class","secondary")},m(a,d){q(a,e,d),q(a,t,d),le(n,a,d),i=!0,o||(c=xt(e,"click",r[12]),o=!0)},p(a,d){const p={};d&128&&(p.map=vr(a[7])),d&512&&(p.maptilerBasemap=a[9]),n.$set(p)},i(a){i||(j(n.$$.fragment,a),i=!0)},o(a){Z(n.$$.fragment,a),i=!1},d(a){a&&(V(e),V(t)),ce(n,a),o=!1,c()}}}function uz(r){let e,t,n,i,o,c,a=r[6]&&ub(r);return{c(){e=U("div"),t=U("div"),n=ie(),i=U("hr"),o=ie(),a&&a.c(),fe(e,"class","pico"),fe(e,"slot","left")},m(d,p){q(d,e,p),R(e,t),r[21](t),R(e,n),R(e,i),R(e,o),a&&a.m(e,null),c=!0},p(d,p){d[6]?a?(a.p(d,p),p&64&&j(a,1)):(a=ub(d),a.c(),j(a,1),a.m(e,null)):a&&(tn(),Z(a,1,1,()=>{a=null}),nn())},i(d){c||(j(a),c=!0)},o(d){Z(a),c=!1},d(d){d&&V(e),r[21](null),a&&a.d()}}}function hz(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function fz(r){let e,t,n;function i(c){r[19](c)}let o={style:r[25],hash:!0,bounds:r[5],maxZoom:19,images:[{id:ao.walkCycleOnly.filterType,url:ao.walkCycleOnly.iconURL},{id:ao.noEntry.filterType,url:ao.noEntry.iconURL},{id:ao.busGate.filterType,url:ao.busGate.iconURL},{id:ao.schoolStreet.filterType,url:ao.schoolStreet.iconURL},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"no_straight_turn",url:"/ltn//filters/no_straight_turn.png"},{id:"no_left_turn",url:"/ltn//filters/no_left_turn.png"},{id:"no_right_turn",url:"/ltn//filters/no_right_turn.png"},{id:"no_u_left_to_right_turn",url:"/ltn//filters/no_u_left_to_right_turn.png"},{id:"no_u_right_to_left_turn",url:"/ltn//filters/no_u_right_to_left_turn.png"},{id:"oneway_arrow",url:nx},{id:"national_rail",url:bb}],$$slots:{default:[Lz]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.map=r[0]),e=new G3({props:o}),hn.push(()=>An(e,"map",i)),e.$on("error",r[20]),{c(){he(e.$$.fragment)},m(c,a){le(e,c,a),n=!0},p(c,a){const d={};a&512&&(d.style=c[25]),a&32&&(d.bounds=c[5]),a&67109977&&(d.$$scope={dirty:a,ctx:c}),!t&&a&1&&(t=!0,d.map=c[0],In(()=>t=!1)),e.$set(d)},i(c){n||(j(e.$$.fragment,c),n=!0)},o(c){Z(e.$$.fragment,c),n=!1},d(c){ce(e,c)}}}function dz(r){let e,t;return e=new bP({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function pz(r){let e,t;return e=new NP({props:{wasmReady:r[4],firstLoad:r[10].firstLoad}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&16&&(o.wasmReady=n[4]),i&1024&&(o.firstLoad=n[10].firstLoad),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function hb(r){let e,t,n,i,o,c,a,d;e=new BM({}),n=new pr({props:{data:r[6].getInvertedBoundary(),$$slots:{default:[mz]},$$scope:{ctx:r}}});const p=[Mz,Tz,Cz,Sz,kz,xz,wz,vz,bz,yz,_z,gz],_=[];function y(w,T){return w[10].mode=="pick-neighbourhood"?0:w[10].mode=="set-boundary"?1:w[10].mode=="add-neighbourhood"?2:w[10].mode=="neighbourhood"?3:w[10].mode=="view-shortcuts"?4:w[10].mode=="impact-one-destination"?5:w[10].mode=="route"?6:w[10].mode=="predict-impact"?7:w[10].mode=="impact-detail"?8:w[10].mode=="debug-neighbourhood"?9:w[10].mode=="debug-intersections"?10:w[10].mode=="debug-demand"?11:-1}return~(o=y(r))&&(c=_[o]=p[o](r)),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),c&&c.c(),a=Qn()},m(w,T){le(e,w,T),q(w,t,T),le(n,w,T),q(w,i,T),~o&&_[o].m(w,T),q(w,a,T),d=!0},p(w,T){const M={};T&64&&(M.data=w[6].getInvertedBoundary()),T&67108864&&(M.$$scope={dirty:T,ctx:w}),n.$set(M);let $=o;o=y(w),o===$?~o&&_[o].p(w,T):(c&&(tn(),Z(_[$],1,1,()=>{_[$]=null}),nn()),~o?(c=_[o],c?c.p(w,T):(c=_[o]=p[o](w),c.c()),j(c,1),c.m(a.parentNode,a)):c=null)},i(w){d||(j(e.$$.fragment,w),j(n.$$.fragment,w),j(c),d=!0)},o(w){Z(e.$$.fragment,w),Z(n.$$.fragment,w),Z(c),d=!1},d(w){w&&(V(t),V(i),V(a)),ce(e,w),ce(n,w),~o&&_[o].d(w)}}}function mz(r){let e,t;const n=[gn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=Ot(i,n[o]);return e=new zi({props:i}),{c(){he(e.$$.fragment)},m(o,c){le(e,o,c),t=!0},p(o,c){const a={};e.$set(a)},i(o){t||(j(e.$$.fragment,o),t=!0)},o(o){Z(e.$$.fragment,o),t=!1},d(o){ce(e,o)}}}function gz(r){let e,t;return e=new uL({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function _z(r){let e,t;return e=new vL({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function yz(r){let e,t;return e=new pE({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function bz(r){let e,t;return e=new VI({props:{road:r[10].road}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.road=n[10].road),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function vz(r){let e,t;return e=new VA({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function wz(r){let e,t;return e=new s8({props:{prevMode:r[10].prevMode}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function xz(r){let e,t;return e=new uA({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function kz(r){let e,t;return e=new lz({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function Sz(r){let e,t;return e=new PI({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function Cz(r){let e,t;return e=new Q6({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function Tz(r){let e,t;return e=new p8({props:{name:r[10].name,existing:r[10].existing}}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.name=n[10].name),i&1024&&(o.existing=n[10].existing),e.$set(o)},i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function Mz(r){let e,t;return e=new IA({}),{c(){he(e.$$.fragment)},m(n,i){le(e,n,i),t=!0},p:tt,i(n){t||(j(e.$$.fragment,n),t=!0)},o(n){Z(e.$$.fragment,n),t=!1},d(n){ce(e,n)}}}function Lz(r){let e,t,n,i,o,c,a,d,p,_,y,w,T,M;e=new Gb({}),n=new Hb({}),o=new mT({props:{map:r[0],apiKey:Ob,country:void 0}});const $=[pz,dz],D=[];function z(F,N){return F[10].mode=="title"?0:F[10].mode=="new-project"?1:-1}~(p=z(r))&&(_=D[p]=$[p](r));let I=r[6]&&hb(r);return T=new nS({}),{c(){he(e.$$.fragment),t=ie(),he(n.$$.fragment),i=ie(),he(o.$$.fragment),c=ie(),a=U("div"),d=ie(),_&&_.c(),y=ie(),I&&I.c(),w=ie(),he(T.$$.fragment)},m(F,N){le(e,F,N),q(F,t,N),le(n,F,N),q(F,i,N),le(o,F,N),q(F,c,N),q(F,a,N),r[18](a),q(F,d,N),~p&&D[p].m(F,N),q(F,y,N),I&&I.m(F,N),q(F,w,N),le(T,F,N),M=!0},p(F,N){const W={};N&1&&(W.map=F[0]),o.$set(W);let oe=p;p=z(F),p===oe?~p&&D[p].p(F,N):(_&&(tn(),Z(D[oe],1,1,()=>{D[oe]=null}),nn()),~p?(_=D[p],_?_.p(F,N):(_=D[p]=$[p](F),_.c()),j(_,1),_.m(y.parentNode,y)):_=null),F[6]?I?(I.p(F,N),N&64&&j(I,1)):(I=hb(F),I.c(),j(I,1),I.m(w.parentNode,w)):I&&(tn(),Z(I,1,1,()=>{I=null}),nn())},i(F){M||(j(e.$$.fragment,F),j(n.$$.fragment,F),j(o.$$.fragment,F),j(_),j(I),j(T.$$.fragment,F),M=!0)},o(F){Z(e.$$.fragment,F),Z(n.$$.fragment,F),Z(o.$$.fragment,F),Z(_),Z(I),Z(T.$$.fragment,F),M=!1},d(F){F&&(V(t),V(i),V(c),V(a),V(d),V(y),V(w)),ce(e,F),ce(n,F),ce(o,F),r[18](null),~p&&D[p].d(F),I&&I.d(F),ce(T,F)}}}function Ez(r){return{c:tt,m:tt,p:tt,i:tt,o:tt,d:tt}}function Iz(r){let e,t,n,i={ctx:r,current:null,token:null,hasCatch:!1,pending:Ez,then:fz,catch:hz,value:25,blocks:[,,,]};return $_(t=r[13](r[9]),i),{c(){e=U("div"),i.block.c(),fe(e,"slot","main"),st(e,"position","relative"),st(e,"width","100%"),st(e,"height","100%")},m(o,c){q(o,e,c),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,n=!0},p(o,c){r=o,i.ctx=r,c&512&&t!==(t=r[13](r[9]))&&$_(t,i)||J2(i,r,c)},i(o){n||(j(i.block),n=!0)},o(o){for(let c=0;c<3;c+=1){const a=i.blocks[c];Z(a)}n=!1},d(o){o&&V(e),i.block.d(),i.token=null,i=null}}}function Az(r){let e,t,n,i,o,c,a;return t=new hk({}),o=new QM({props:{$$slots:{main:[Iz],left:[uz],top:[cz]},$$scope:{ctx:r}}}),{c(){e=U("div"),he(t.$$.fragment),n=ie(),i=U("div"),he(o.$$.fragment),fe(e,"class","pico"),fe(i,"class",c="app-focus-"+r[8])},m(d,p){q(d,e,p),le(t,e,null),q(d,n,p),q(d,i,p),le(o,i,null),a=!0},p(d,[p]){const _={};p&67112703&&(_.$$scope={dirty:p,ctx:d}),o.$set(_),(!a||p&256&&c!==(c="app-focus-"+d[8]))&&fe(i,"class",c)},i(d){a||(j(t.$$.fragment,d),j(o.$$.fragment,d),a=!0)},o(d){Z(t.$$.fragment,d),Z(o.$$.fragment,d),a=!1},d(d){d&&(V(e),V(n),V(i)),ce(t),ce(o)}}}function Pz(r,e,t){let n,i,o,c,a,d,p,_,y,w;at(r,Em,ae=>t(15,n=ae)),at(r,Lm,ae=>t(16,i=ae)),at(r,Mm,ae=>t(17,o=ae)),at(r,Ar,ae=>t(6,c=ae)),at(r,Ro,ae=>t(7,a=ae)),at(r,lm,ae=>t(24,d=ae)),at(r,Fo,ae=>t(8,p=ae)),at(r,im,ae=>t(9,_=ae)),at(r,an,ae=>t(10,y=ae)),at(r,oh,ae=>t(11,w=ae));let{appFocus:T="global"}=e;Fo.set(T);let M=!1;Ls(async()=>{await $v(),await Cb(),t(4,M=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(Nt(lm,d=!0,d),console.log("Using local cache, not od2net.org"))}catch{}});let $=null;function D(){a.fitBounds(c.getBounds(),{animate:!1})}let z,I,F,N;T=="cnt"&&(N=[-8.943,54.631,-.901,59.489]);async function W(ae){return ae=="streets-v2"?o6:`https://api.maptiler.com/maps/${ae}/style.json?key=${Ob}`}function oe(ae){hn[ae?"unshift":"push"](()=>{F=ae,t(3,F),t(15,n)})}function J(ae){$=ae,t(0,$)}const ee=ae=>{console.log(ae.detail.error)};function pe(ae){hn[ae?"unshift":"push"](()=>{I=ae,t(2,I),t(16,i)})}const Ie=()=>Nt(oh,w=!0,w);function Q(ae){hn[ae?"unshift":"push"](()=>{z=ae,t(1,z),t(17,o)})}return r.$$set=ae=>{"appFocus"in ae&&t(14,T=ae.appFocus)},r.$$.update=()=>{r.$$.dirty&1&&$&&Ro.set($),r.$$.dirty&131074&&z&&o&&(t(1,z.innerHTML="",z),z.appendChild(o)),r.$$.dirty&65540&&I&&i&&(t(2,I.innerHTML="",I),I.appendChild(i)),r.$$.dirty&32776&&F&&n&&(t(3,F.innerHTML="",F),F.appendChild(n))},[$,z,I,F,M,N,c,a,p,_,y,w,D,W,T,n,i,o,oe,J,ee,pe,Ie,Q]}class jz extends Et{constructor(e){super(),Lt(this,e,Pz,Az,wt,{appFocus:14})}}export{jz as A};
