var Xv=Object.defineProperty;var Kv=(o,e,t)=>e in o?Xv(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Rn=(o,e,t)=>(Kv(o,typeof e!="symbol"?e+"":e,t),t);function Jv(o,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const l in i)if(l!=="default"&&!(l in o)){const u=Object.getOwnPropertyDescriptor(i,l);u&&Object.defineProperty(o,l,u.get?u:{enumerable:!0,get:()=>i[l]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const u of l)if(u.type==="childList")for(const d of u.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function t(l){const u={};return l.integrity&&(u.integrity=l.integrity),l.referrerPolicy&&(u.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?u.credentials="include":l.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function i(l){if(l.ep)return;l.ep=!0;const u=t(l);fetch(l.href,u)}})();function Lt(){}function Xi(o,e){for(const t in e)o[t]=e[t];return o}function qy(o){return o()}function xg(){return Object.create(null)}function on(o){o.forEach(qy)}function Yl(o){return typeof o=="function"}function Bt(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let td;function Tn(o,e){return o===e?!0:(td||(td=document.createElement("a")),td.href=e,o===td.href)}function Yv(o){return Object.keys(o).length===0}function Zy(o,...e){if(o==null){for(const i of e)i(void 0);return Lt}const t=o.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ar(o){let e;return Zy(o,t=>e=t)(),e}function lt(o,e,t){o.$$.on_destroy.push(Zy(e,t))}function Bi(o,e,t,i){if(o){const l=Gy(o,e,t,i);return o[0](l)}}function Gy(o,e,t,i){return o[1]&&i?Xi(t.ctx.slice(),o[1](i(e))):t.ctx}function Fi(o,e,t,i){if(o[2]&&i){const l=o[2](i(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Oi(o,e,t,i,l,u){if(l){const d=Gy(e,t,i,u);o.p(d,l)}}function Ni(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function Qv(o){const e={};for(const t in o)e[t]=!0;return e}function gd(o){return o??""}function Tt(o,e,t){return o.set(t),e}function ip(o){return o&&Yl(o.destroy)?o.destroy:Lt}const Cd=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function X(o,e){o.appendChild(e)}function le(o,e,t){o.insertBefore(e,t||null)}function ae(o){o.parentNode&&o.parentNode.removeChild(o)}function Ss(o,e){for(let t=0;t<o.length;t+=1)o[t]&&o[t].d(e)}function oe(o){return document.createElement(o)}function xs(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function Xe(o){return document.createTextNode(o)}function ze(){return Xe(" ")}function En(){return Xe("")}function xt(o,e,t,i){return o.addEventListener(e,t,i),()=>o.removeEventListener(e,t,i)}function Cp(o){return function(e){return e.preventDefault(),o.call(this,e)}}function qf(o){return function(e){return e.stopPropagation(),o.call(this,e)}}function ke(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Wy(o){let e;return{p(...t){e=t,e.forEach(i=>o.push(i))},r(){e.forEach(t=>o.splice(o.indexOf(t),1))}}}function Ep(o){return o===""?null:+o}function eb(o){return Array.from(o.childNodes)}function xi(o,e){e=""+e,o.data!==e&&(o.data=e)}function Fn(o,e){o.value=e??""}function nn(o,e,t,i){t==null?o.style.removeProperty(e):o.style.setProperty(e,t,i?"important":"")}function Ql(o,e,t){for(let i=0;i<o.options.length;i+=1){const l=o.options[i];if(l.__value===e){l.selected=!0;return}}(!t||e!==void 0)&&(o.selectedIndex=-1)}function Mp(o){const e=o.querySelector(":checked");return e&&e.__value}function lr(o,e,t){o.classList.toggle(e,!!t)}function tb(o,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:i})}let Iu;function ku(o){Iu=o}function Vu(){if(!Iu)throw new Error("Function called outside component initialization");return Iu}function $u(o){Vu().$$.on_mount.push(o)}function Jn(o){Vu().$$.on_destroy.push(o)}function ns(){const o=Vu();return(e,t,{cancelable:i=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=tb(e,t,{cancelable:i});return l.slice().forEach(d=>{d.call(o,u)}),!u.defaultPrevented}return!0}}function Ed(o,e){return Vu().$$.context.set(o,e),e}function Md(o){return Vu().$$.context.get(o)}function ui(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const ql=[],Ki=[];let Hl=[];const np=[],Hy=Promise.resolve();let rp=!1;function Xy(){rp||(rp=!0,Hy.then(Jy))}function Ky(){return Xy(),Hy}function ec(o){Hl.push(o)}function Zr(o){np.push(o)}const Zf=new Set;let Ol=0;function Jy(){if(Ol!==0)return;const o=Iu;do{try{for(;Ol<ql.length;){const e=ql[Ol];Ol++,ku(e),ib(e.$$)}}catch(e){throw ql.length=0,Ol=0,e}for(ku(null),ql.length=0,Ol=0;Ki.length;)Ki.pop()();for(let e=0;e<Hl.length;e+=1){const t=Hl[e];Zf.has(t)||(Zf.add(t),t())}Hl.length=0}while(ql.length);for(;np.length;)np.pop()();rp=!1,Zf.clear(),ku(o)}function ib(o){if(o.fragment!==null){o.update(),on(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(ec)}}function nb(o){const e=[],t=[];Hl.forEach(i=>o.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Hl=e}const sd=new Set;let Da;function gi(){Da={r:0,c:[],p:Da}}function _i(){Da.r||on(Da.c),Da=Da.p}function Q(o,e){o&&o.i&&(sd.delete(o),o.i(e))}function re(o,e,t,i){if(o&&o.o){if(sd.has(o))return;sd.add(o),Da.c.push(()=>{sd.delete(o),i&&(t&&o.d(1),i())}),o.o(e)}else i&&i()}function Kn(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function rb(o,e){re(o,1,1,()=>{e.delete(o.key)})}function ob(o,e,t,i,l,u,d,a,_,v,k,S){let E=o.length,A=u.length,z=E;const R={};for(;z--;)R[o[z].key]=z;const D=[],B=new Map,O=new Map,j=[];for(z=A;z--;){const Z=S(l,u,z),Y=t(Z);let ye=d.get(Y);ye?i&&j.push(()=>ye.p(Z,e)):(ye=v(Y,Z),ye.c()),B.set(Y,D[z]=ye),Y in R&&O.set(Y,Math.abs(z-R[Y]))}const V=new Set,se=new Set;function ce(Z){Q(Z,1),Z.m(a,k),d.set(Z.key,Z),k=Z.first,A--}for(;E&&A;){const Z=D[A-1],Y=o[E-1],ye=Z.key,Oe=Y.key;Z===Y?(k=Z.first,E--,A--):B.has(Oe)?!d.has(ye)||V.has(ye)?ce(Z):se.has(Oe)?E--:O.get(ye)>O.get(Oe)?(se.add(ye),ce(Z)):(V.add(Oe),E--):(_(Y,d),E--)}for(;E--;){const Z=o[E];B.has(Z.key)||_(Z,d)}for(;A;)ce(D[A-1]);return on(j),D}function tc(o,e){const t={},i={},l={$$scope:1};let u=o.length;for(;u--;){const d=o[u],a=e[u];if(a){for(const _ in d)_ in a||(i[_]=1);for(const _ in a)l[_]||(t[_]=a[_],l[_]=1);o[u]=a}else for(const _ in d)l[_]=1}for(const d in i)d in t||(t[d]=void 0);return t}function Gr(o,e,t){const i=o.$$.props[e];i!==void 0&&(o.$$.bound[i]=t,t(o.$$.ctx[i]))}function Ie(o){o&&o.c()}function Ee(o,e,t){const{fragment:i,after_update:l}=o.$$;i&&i.m(e,t),ec(()=>{const u=o.$$.on_mount.map(qy).filter(Yl);o.$$.on_destroy?o.$$.on_destroy.push(...u):on(u),o.$$.on_mount=[]}),l.forEach(ec)}function Me(o,e){const t=o.$$;t.fragment!==null&&(nb(t.after_update),on(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function sb(o,e){o.$$.dirty[0]===-1&&(ql.push(o),Xy(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function $t(o,e,t,i,l,u,d=null,a=[-1]){const _=Iu;ku(o);const v=o.$$={fragment:null,ctx:[],props:u,update:Lt,not_equal:l,bound:xg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:xg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(v.root);let k=!1;if(v.ctx=t?t(o,e.props||{},(S,E,...A)=>{const z=A.length?A[0]:E;return v.ctx&&l(v.ctx[S],v.ctx[S]=z)&&(!v.skip_bound&&v.bound[S]&&v.bound[S](z),k&&sb(o,S)),E}):[],v.update(),k=!0,on(v.before_update),v.fragment=i?i(v.ctx):!1,e.target){if(e.hydrate){const S=eb(e.target);v.fragment&&v.fragment.l(S),S.forEach(ae)}else v.fragment&&v.fragment.c();e.intro&&Q(o.$$.fragment),Ee(o,e.target,e.anchor),Jy()}ku(_)}class qt{constructor(){Rn(this,"$$");Rn(this,"$$set")}$destroy(){Me(this,1),this.$destroy=Lt}$on(e,t){if(!Yl(t))return Lt;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!Yv(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const ab="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(ab);const lb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",cb="/ltn/assets/logo-97f2d067.svg";function kg(o){let e,t;return{c(){e=oe("div"),t=Xe(o[0]),ke(e,"class","svelte-1uuov7f")},m(i,l){le(i,e,l),X(e,t)},p(i,l){l&1&&xi(t,i[0])},d(i){i&&ae(e)}}}function ub(o){let e,t=o[0]&&kg(o);return{c(){t&&t.c(),e=En()},m(i,l){t&&t.m(i,l),le(i,e,l)},p(i,[l]){i[0]?t?t.p(i,l):(t=kg(i),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:Lt,o:Lt,d(i){i&&ae(e),t&&t.d(i)}}}function hb(o,e,t){let{loading:i}=e;return o.$$set=l=>{"loading"in l&&t(0,i=l.loading)},[i]}class Yy extends qt{constructor(e){super(),$t(this,e,hb,ub,Bt,{loading:0})}}const db=o=>({dialog:o&1}),Sg=o=>({dialog:o[0]});function fb(o){let e,t,i,l,u;const d=o[4].default,a=Bi(d,o,o[3],Sg);return{c(){e=oe("dialog"),t=oe("article"),a&&a.c(),e.open=!0},m(_,v){le(_,e,v),X(e,t),a&&a.m(t,null),o[6](e),i=!0,l||(u=[xt(window,"click",o[1]),xt(window,"keydown",o[2]),xt(e,"close",o[5])],l=!0)},p(_,[v]){a&&a.p&&(!i||v&9)&&Oi(a,d,_,_[3],i?Fi(d,_[3],v,db):Ni(_[3]),Sg)},i(_){i||(Q(a,_),i=!0)},o(_){re(a,_),i=!1},d(_){_&&ae(e),a&&a.d(_),o[6](null),l=!1,on(u)}}}function pb(o,e,t){let{$$slots:i={},$$scope:l}=e,u;function d(k){u.open&&k.target==u&&u.close()}function a(k){(k.key=="Escape"||k.key=="Enter")&&(k.stopPropagation(),u.close())}function _(k){ui.call(this,o,k)}function v(k){Ki[k?"unshift":"push"](()=>{u=k,t(0,u)})}return o.$$set=k=>{"$$scope"in k&&t(3,l=k.$$scope)},[u,d,a,l,i,_,v]}class Id extends qt{constructor(e){super(),$t(this,e,pb,fb,Bt,{})}}function Tg(o,e,t){const i=o.slice();return i[1]=e[t][0],i[2]=e[t][1],i}function Cg(o){let e,t,i=o[1]+"",l,u,d,a=o[2]+"",_,v;return{c(){e=oe("tr"),t=oe("td"),l=Xe(i),u=ze(),d=oe("td"),_=Xe(a),v=ze()},m(k,S){le(k,e,S),X(e,t),X(t,l),X(e,u),X(e,d),X(d,_),X(e,v)},p(k,S){S&1&&i!==(i=k[1]+"")&&xi(l,i),S&1&&a!==(a=k[2]+"")&&xi(_,a)},d(k){k&&ae(e)}}}function mb(o){let e,t,i=Kn(Object.entries(o[0])),l=[];for(let u=0;u<i.length;u+=1)l[u]=Cg(Tg(o,i,u));return{c(){e=oe("table"),t=oe("tbody");for(let u=0;u<l.length;u+=1)l[u].c();ke(e,"class","svelte-lh2o9l")},m(u,d){le(u,e,d),X(e,t);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(t,null)},p(u,[d]){if(d&1){i=Kn(Object.entries(u[0]));let a;for(a=0;a<i.length;a+=1){const _=Tg(u,i,a);l[a]?l[a].p(_,d):(l[a]=Cg(_),l[a].c(),l[a].m(t,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=i.length}},i:Lt,o:Lt,d(u){u&&ae(e),Ss(l,u)}}}function gb(o,e,t){let{properties:i}=e;return o.$$set=l=>{"properties"in l&&t(0,i=l.properties)},[i]}class Ld extends qt{constructor(e){super(),$t(this,e,gb,mb,Bt,{properties:0})}}function _d(o,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",o),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function yr(o){if(o==null||o==null)throw new Error("Oops, notNull given something null");return o}var Qy=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function e0(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function Ip(o){if(o.__esModule)return o;var e=o.default;if(typeof e=="function"){var t=function i(){return this instanceof i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(o).forEach(function(i){var l=Object.getOwnPropertyDescriptor(o,i);Object.defineProperty(t,i,l.get?l:{enumerable:!0,get:function(){return o[i]}})}),t}var t0={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(o,e){(function(t,i){o.exports=i()})(Qy,function(){var t={},i={};function l(d,a,_){if(i[d]=_,d==="index"){var v="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",k={};return i.shared(k),i.index(t,k),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),t}}l("shared",["exports"],function(d){function a(s,n,c,f){return new(c||(c=Promise))(function(g,w){function x(P){try{I(f.next(P))}catch(N){w(N)}}function T(P){try{I(f.throw(P))}catch(N){w(N)}}function I(P){var N;P.done?g(P.value):(N=P.value,N instanceof c?N:new c(function(U){U(N)})).then(x,T)}I((f=f.apply(s,n||[])).next())})}function _(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var v=k;function k(s,n){this.x=s,this.y=n}k.prototype={clone:function(){return new k(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,n){return this.clone()._rotateAround(s,n)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var n=s.x-this.x,c=s.y-this.y;return n*n+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,n){return Math.atan2(this.x*n-this.y*s,this.x*s+this.y*n)},_matMult:function(s){var n=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=n,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var n=Math.cos(s),c=Math.sin(s),f=c*this.x+n*this.y;return this.x=n*this.x-c*this.y,this.y=f,this},_rotateAround:function(s,n){var c=Math.cos(s),f=Math.sin(s),g=n.y+f*(this.x-n.x)+c*(this.y-n.y);return this.x=n.x+c*(this.x-n.x)-f*(this.y-n.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},k.convert=function(s){return s instanceof k?s:Array.isArray(s)?new k(s[0],s[1]):s};var S=_(v),E=A;function A(s,n,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=n,this.p2x=c,this.p2y=f}A.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,n){if(n===void 0&&(n=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=g/w}var x=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<n));f++)s>g?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,n){return this.sampleCurveY(this.solveCurveX(s,n))}};var z=_(E);let R,D;function B(){return R==null&&(R=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),R}function O(){if(D==null&&(D=!1,B())){const n=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(n){for(let f=0;f<5*5;f++){const g=4*f;n.fillStyle=`rgb(${g},${g+1},${g+2})`,n.fillRect(f%5,Math.floor(f/5),1,1)}const c=n.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&c[f]!==f){D=!0;break}}}return D||!1}function j(s,n,c,f){const g=new z(s,n,c,f);return function(w){return g.solve(w)}}const V=j(.25,.1,.25,1);function se(s,n,c){return Math.min(c,Math.max(n,s))}function ce(s,n,c){const f=c-n,g=((s-n)%f+f)%f+n;return g===n?c:g}function Z(s,...n){for(const c of n)for(const f in c)s[f]=c[f];return s}let Y=1;function ye(s,n,c){const f={};for(const g in s)f[g]=n.call(c||this,s[g],g,s);return f}function Oe(s,n,c){const f={};for(const g in s)n.call(c||this,s[g],g,s)&&(f[g]=s[g]);return f}function ne(s){return Array.isArray(s)?s.map(ne):typeof s=="object"&&s?ye(s,ne):s}const ve={};function Je(s){ve[s]||(typeof console<"u"&&console.warn(s),ve[s]=!0)}function Le(s,n,c){return(c.y-s.y)*(n.x-s.x)>(n.y-s.y)*(c.x-s.x)}function et(s){let n=0;for(let c,f,g=0,w=s.length,x=w-1;g<w;x=g++)c=s[g],f=s[x],n+=(f.x-c.x)*(c.y+f.y);return n}function bt(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let pt=null;function at(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Xt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ni(s,n,c,f,g){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(s,{timestamp:0});try{const x=w==null?void 0:w.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const T=x.startsWith("BGR"),I=new Uint8ClampedArray(f*g*4);if(yield w.copyTo(I,function(P,N,U,H,J){const te=4*Math.max(-N,0),he=(Math.max(0,U)-U)*H*4+te,ge=4*H,xe=Math.max(0,N),Fe=Math.max(0,U);return{rect:{x:xe,y:Fe,width:Math.min(P.width,N+H)-xe,height:Math.min(P.height,U+J)-Fe},layout:[{offset:he,stride:ge}]}}(s,n,c,f,g)),T)for(let P=0;P<I.length;P+=4){const N=I[P];I[P]=I[P+2],I[P+2]=N}return I}finally{w.close()}})}let Nt,zt;const Yt="AbortError";function It(){return new Error(Yt)}const ti={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Zt(s){return ti.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const hi="global-dispatcher";class ki extends Error{constructor(n,c,f,g){super(`AJAXError: ${c} (${n}): ${f}`),this.status=n,this.statusText=c,this.url=f,this.body=g}}const yi=()=>bt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Pi=function(s,n){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=Zt(s.url);if(f)return f(s,n);if(bt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:hi},n)}if(!(/^file:/.test(c=s.url)||/^file:/.test(yi())&&!/^\w+:/.test(c))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return a(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:yi(),signal:g.signal});f.type==="json"&&w.headers.set("Accept","application/json");const x=yield fetch(w);if(!x.ok){const P=yield x.blob();throw new ki(x.status,x.statusText,f.url,P)}let T;T=f.type==="arrayBuffer"||f.type==="image"?x.arrayBuffer():f.type==="json"?x.json():x.text();const I=yield T;if(g.signal.aborted)throw It();return{data:I,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,n);if(bt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:hi},n)}var c;return function(f,g){return new Promise((w,x)=>{const T=new XMLHttpRequest;T.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(T.responseType="arraybuffer");for(const I in f.headers)T.setRequestHeader(I,f.headers[I]);f.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=f.credentials==="include",T.onerror=()=>{x(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let I=T.response;if(f.type==="json")try{I=JSON.parse(T.response)}catch(P){return void x(P)}w({data:I,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const I=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});x(new ki(T.status,T.statusText,f.url,I))}},g.signal.addEventListener("abort",()=>{T.abort(),x(It())}),T.send(f.body)})}(s,n)};function ut(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const n=new URL(s),c=window.location;return n.protocol===c.protocol&&n.host===c.host}function At(s,n,c){c[s]&&c[s].indexOf(n)!==-1||(c[s]=c[s]||[],c[s].push(n))}function Ne(s,n,c){if(c&&c[s]){const f=c[s].indexOf(n);f!==-1&&c[s].splice(f,1)}}class je{constructor(n,c={}){Z(this,c),this.type=n}}class ot extends je{constructor(n,c={}){super("error",Z({error:n},c))}}class kt{on(n,c){return this._listeners=this._listeners||{},At(n,c,this._listeners),this}off(n,c){return Ne(n,c,this._listeners),Ne(n,c,this._oneTimeListeners),this}once(n,c){return c?(this._oneTimeListeners=this._oneTimeListeners||{},At(n,c,this._oneTimeListeners),this):new Promise(f=>this.once(n,f))}fire(n,c){typeof n=="string"&&(n=new je(n,c||{}));const f=n.type;if(this.listens(f)){n.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const T of g)T.call(this,n);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const T of w)Ne(f,T,this._oneTimeListeners),T.call(this,n);const x=this._eventedParent;x&&(Z(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(n))}else n instanceof ot&&console.error(n.error);return this}listens(n){return this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n)}setEventedParent(n,c){return this._eventedParent=n,this._eventedParentData=c,this}}var we={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const di=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ve(s,n){const c={};for(const f in s)f!=="ref"&&(c[f]=s[f]);return di.forEach(f=>{f in n&&(c[f]=n[f])}),c}function We(s,n){if(Array.isArray(s)){if(!Array.isArray(n)||s.length!==n.length)return!1;for(let c=0;c<s.length;c++)if(!We(s[c],n[c]))return!1;return!0}if(typeof s=="object"&&s!==null&&n!==null){if(typeof n!="object"||Object.keys(s).length!==Object.keys(n).length)return!1;for(const c in s)if(!We(s[c],n[c]))return!1;return!0}return s===n}function St(s,n){s.push(n)}function vn(s,n,c){St(c,{command:"addSource",args:[s,n[s]]})}function bn(s,n,c){St(n,{command:"removeSource",args:[s]}),c[s]=!0}function Mn(s,n,c,f){bn(s,c,f),vn(s,n,c)}function tr(s,n,c){let f;for(f in s[c])if(Object.prototype.hasOwnProperty.call(s[c],f)&&f!=="data"&&!We(s[c][f],n[c][f]))return!1;for(f in n[c])if(Object.prototype.hasOwnProperty.call(n[c],f)&&f!=="data"&&!We(s[c][f],n[c][f]))return!1;return!0}function ir(s,n,c,f,g,w){s=s||{},n=n||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(We(s[x],n[x])||c.push({command:w,args:[f,x,n[x],g]}));for(const x in n)Object.prototype.hasOwnProperty.call(n,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(We(s[x],n[x])||c.push({command:w,args:[f,x,n[x],g]}))}function qo(s){return s.id}function Ji(s,n){return s[n.id]=n,s}class ht{constructor(n,c,f,g){this.message=(n?`${n}: `:"")+f,g&&(this.identifier=g),c!=null&&c.__line__&&(this.line=c.__line__)}}function Hn(s,...n){for(const c of n)for(const f in c)s[f]=c[f];return s}class wn extends Error{constructor(n,c){super(c),this.message=c,this.key=n}}class Ao{constructor(n,c=[]){this.parent=n,this.bindings={};for(const[f,g]of c)this.bindings[f]=g}concat(n){return new Ao(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Vi={kind:"null"},gt={kind:"number"},ri={kind:"string"},Qt={kind:"boolean"},$i={kind:"color"},vr={kind:"object"},ii={kind:"value"},to={kind:"collator"},un={kind:"formatted"},me={kind:"padding"},W={kind:"resolvedImage"},K={kind:"variableAnchorOffsetCollection"};function ie(s,n){return{kind:"array",itemType:s,N:n}}function de(s){if(s.kind==="array"){const n=de(s.itemType);return typeof s.N=="number"?`array<${n}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${n}>`}return s.kind}const Ae=[Vi,gt,ri,Qt,$i,un,vr,ie(ii),me,W,K];function Pe(s,n){if(n.kind==="error")return null;if(s.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Pe(s.itemType,n.itemType))&&(typeof s.N!="number"||s.N===n.N))return null}else{if(s.kind===n.kind)return null;if(s.kind==="value"){for(const c of Ae)if(!Pe(c,n))return null}}return`Expected ${de(s)} but found ${de(n)} instead.`}function Be(s,n){return n.some(c=>c.kind===s.kind)}function Se(s,n){return n.some(c=>c==="null"?s===null:c==="array"?Array.isArray(s):c==="object"?s&&!Array.isArray(s)&&typeof s=="object":c===typeof s)}function G(s,n){return s.kind==="array"&&n.kind==="array"?s.itemType.kind===n.itemType.kind&&typeof s.N=="number":s.kind===n.kind}const Ue=.96422,$e=.82521,Ze=4/29,Ye=6/29,dt=3*Ye*Ye,Ft=Ye*Ye*Ye,Kt=Math.PI/180,ai=180/Math.PI;function vi(s){return(s%=360)<0&&(s+=360),s}function Yi([s,n,c,f]){let g,w;const x=li((.2225045*(s=In(s))+.7168786*(n=In(n))+.0606169*(c=In(c)))/1);s===n&&n===c?g=w=x:(g=li((.4360747*s+.3850649*n+.1430804*c)/Ue),w=li((.0139322*s+.0971045*n+.7141733*c)/$e));const T=116*x-16;return[T<0?0:T,500*(g-x),200*(x-w),f]}function In(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function li(s){return s>Ft?Math.pow(s,1/3):s/dt+Ze}function hn([s,n,c,f]){let g=(s+16)/116,w=isNaN(n)?g:g+n/500,x=isNaN(c)?g:g-c/200;return g=1*ur(g),w=Ue*ur(w),x=$e*ur(x),[On(3.1338561*w-1.6168667*g-.4906146*x),On(-.9787684*w+1.9161415*g+.033454*x),On(.0719453*w-.2289914*g+1.4052427*x),f]}function On(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function ur(s){return s>Ye?s*s*s:dt*(s-Ze)}function br(s){return parseInt(s.padEnd(2,s),16)/255}function Xn(s,n){return po(n?s/100:s,0,1)}function po(s,n,c){return Math.min(Math.max(n,s),c)}function Ku(s){return!s.some(Number.isNaN)}const Od={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class zi{constructor(n,c,f,g=1,w=!0){this.r=n,this.g=c,this.b=f,this.a=g,w||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[n,c,f,g]))}static parse(n){if(n instanceof zi)return n;if(typeof n!="string")return;const c=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=Od[f];if(g){const[x,T,I]=g;return[x/255,T/255,I/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const x=f.length<6?1:2;let T=1;return[br(f.slice(T,T+=x)),br(f.slice(T,T+=x)),br(f.slice(T,T+=x)),br(f.slice(T,T+x)||"ff")]}if(f.startsWith("rgb")){const x=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[T,I,P,N,U,H,J,te,he,ge,xe,Fe]=x,Te=[N||" ",J||" ",ge].join("");if(Te==="  "||Te==="  /"||Te===",,"||Te===",,,"){const De=[P,H,he].join(""),Qe=De==="%%%"?100:De===""?255:0;if(Qe){const tt=[po(+I/Qe,0,1),po(+U/Qe,0,1),po(+te/Qe,0,1),xe?Xn(+xe,Fe):1];if(Ku(tt))return tt}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[x,T,I,P,N,U,H,J,te]=w,he=[I||" ",N||" ",H].join("");if(he==="  "||he==="  /"||he===",,"||he===",,,"){const ge=[+T,po(+P,0,100),po(+U,0,100),J?Xn(+J,te):1];if(Ku(ge))return function([xe,Fe,Te,De]){function Qe(tt){const Mt=(tt+xe/30)%12,Ot=Fe*Math.min(Te,1-Te);return Te-Ot*Math.max(-1,Math.min(Mt-3,9-Mt,1))}return xe=vi(xe),Fe/=100,Te/=100,[Qe(0),Qe(8),Qe(4),De]}(ge)}}}(n);return c?new zi(...c,!1):void 0}get rgb(){const{r:n,g:c,b:f,a:g}=this,w=g||1/0;return this.overwriteGetter("rgb",[n/w,c/w,f/w,g])}get hcl(){return this.overwriteGetter("hcl",function(n){const[c,f,g,w]=Yi(n),x=Math.sqrt(f*f+g*g);return[Math.round(1e4*x)?vi(Math.atan2(g,f)*ai):NaN,x,c,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Yi(this.rgb))}overwriteGetter(n,c){return Object.defineProperty(this,n,{value:c}),c}toString(){const[n,c,f,g]=this.rgb;return`rgba(${[n,c,f].map(w=>Math.round(255*w)).join(",")},${g})`}}zi.black=new zi(0,0,0,1),zi.white=new zi(1,1,1,1),zi.transparent=new zi(0,0,0,0),zi.red=new zi(1,0,0,1);class cc{constructor(n,c,f){this.sensitivity=n?c?"variant":"case":c?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,c){return this.collator.compare(n,c)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class uc{constructor(n,c,f,g,w){this.text=n,this.image=c,this.scale=f,this.fontStack=g,this.textColor=w}}class zr{constructor(n){this.sections=n}static fromString(n){return new zr([new uc(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof zr?n:zr.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}}class wr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof wr)return n;if(typeof n=="number")return new wr([n,n,n,n]);if(Array.isArray(n)&&!(n.length<1||n.length>4)){for(const c of n)if(typeof c!="number")return;switch(n.length){case 1:n=[n[0],n[0],n[0],n[0]];break;case 2:n=[n[0],n[1],n[0],n[1]];break;case 3:n=[n[0],n[1],n[2],n[1]]}return new wr(n)}}toString(){return JSON.stringify(this.values)}}const aa=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Hr{constructor(n){this.values=n.slice()}static parse(n){if(n instanceof Hr)return n;if(Array.isArray(n)&&!(n.length<1)&&n.length%2==0){for(let c=0;c<n.length;c+=2){const f=n[c],g=n[c+1];if(typeof f!="string"||!aa.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Hr(n)}}toString(){return JSON.stringify(this.values)}}class Xr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Xr({name:n,available:!1}):null}}function As(s,n,c,f){return typeof s=="number"&&s>=0&&s<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof c=="number"&&c>=0&&c<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,n,c,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,n,c,f]:[s,n,c]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ua(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof zi||s instanceof cc||s instanceof zr||s instanceof wr||s instanceof Hr||s instanceof Xr)return!0;if(Array.isArray(s)){for(const n of s)if(!Ua(n))return!1;return!0}if(typeof s=="object"){for(const n in s)if(!Ua(s[n]))return!1;return!0}return!1}function Ln(s){if(s===null)return Vi;if(typeof s=="string")return ri;if(typeof s=="boolean")return Qt;if(typeof s=="number")return gt;if(s instanceof zi)return $i;if(s instanceof cc)return to;if(s instanceof zr)return un;if(s instanceof wr)return me;if(s instanceof Hr)return K;if(s instanceof Xr)return W;if(Array.isArray(s)){const n=s.length;let c;for(const f of s){const g=Ln(f);if(c){if(c===g)continue;c=ii;break}c=g}return ie(c||ii,n)}return vr}function la(s){const n=typeof s;return s===null?"":n==="string"||n==="number"||n==="boolean"?String(s):s instanceof zi||s instanceof zr||s instanceof wr||s instanceof Hr||s instanceof Xr?s.toString():JSON.stringify(s)}class Zo{constructor(n,c){this.type=n,this.value=c}static parse(n,c){if(n.length!==2)return c.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!Ua(n[1]))return c.error("invalid value");const f=n[1];let g=Ln(f);const w=c.expectedType;return g.kind!=="array"||g.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(g=w),new Zo(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class sn{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Va={string:ri,number:gt,boolean:Qt,object:vr};class Dr{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");let f,g=1;const w=n[0];if(w==="array"){let T,I;if(n.length>2){const P=n[1];if(typeof P!="string"||!(P in Va)||P==="object")return c.error('The item type argument of "array" must be one of string, number, boolean',1);T=Va[P],g++}else T=ii;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return c.error('The length argument to "array" must be a positive integer literal',2);I=n[2],g++}f=ie(T,I)}else{if(!Va[w])throw new Error(`Types doesn't contain name = ${w}`);f=Va[w]}const x=[];for(;g<n.length;g++){const T=c.parse(n[g],g,ii);if(!T)return null;x.push(T)}return new Dr(f,x)}evaluate(n){for(let c=0;c<this.args.length;c++){const f=this.args[c].evaluate(n);if(!Pe(this.type,Ln(f)))return f;if(c===this.args.length-1)throw new sn(`Expected value to be of type ${de(this.type)}, but found ${de(Ln(f))} instead.`)}throw new Error}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const $a={"to-boolean":Qt,"to-color":$i,"to-number":gt,"to-string":ri};class mo{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[0];if(!$a[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&n.length!==2)return c.error("Expected one argument.");const g=$a[f],w=[];for(let x=1;x<n.length;x++){const T=c.parse(n[x],x,ii);if(!T)return null;w.push(T)}return new mo(g,w)}evaluate(n){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(n);case"color":{let c,f;for(const g of this.args){if(c=g.evaluate(n),f=null,c instanceof zi)return c;if(typeof c=="string"){const w=n.parseColor(c);if(w)return w}else if(Array.isArray(c)&&(f=c.length<3||c.length>4?`Invalid rbga value ${JSON.stringify(c)}: expected an array containing either three or four numeric values.`:As(c[0],c[1],c[2],c[3]),!f))return new zi(c[0]/255,c[1]/255,c[2]/255,c[3])}throw new sn(f||`Could not parse color from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"padding":{let c;for(const f of this.args){c=f.evaluate(n);const g=wr.parse(c);if(g)return g}throw new sn(`Could not parse padding from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"variableAnchorOffsetCollection":{let c;for(const f of this.args){c=f.evaluate(n);const g=Hr.parse(c);if(g)return g}throw new sn(`Could not parse variableAnchorOffsetCollection from value '${typeof c=="string"?c:JSON.stringify(c)}'`)}case"number":{let c=null;for(const f of this.args){if(c=f.evaluate(n),c===null)return 0;const g=Number(c);if(!isNaN(g))return g}throw new sn(`Could not convert ${JSON.stringify(c)} to number.`)}case"formatted":return zr.fromString(la(this.args[0].evaluate(n)));case"resolvedImage":return Xr.fromString(la(this.args[0].evaluate(n)));default:return la(this.args[0].evaluate(n))}}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}const ca=["Unknown","Point","LineString","Polygon"];class Di{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ca[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(n){let c=this._parseColorCache[n];return c||(c=this._parseColorCache[n]=zi.parse(n)),c}}class qa{constructor(n,c,f=[],g,w=new Ao,x=[]){this.registry=n,this.path=f,this.key=f.map(T=>`[${T}]`).join(""),this.scope=w,this.errors=x,this.expectedType=g,this._isConstant=c}parse(n,c,f,g,w={}){return c?this.concat(c,f,g)._parse(n,w):this._parse(n,w)}_parse(n,c){function f(g,w,x){return x==="assert"?new Dr(w,[g]):x==="coerce"?new mo(w,[g]):g}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=n[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[g];if(w){let x=w.parse(n,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,I=x.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||I.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(T.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(T,I))return null}else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"coerce");else x=f(x,T,c.typeAnnotation||"assert")}if(!(x instanceof Zo)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const T=new Di;try{x=new Zo(x.type,x.evaluate(T))}catch(I){return this.error(I.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,c,f){const g=typeof n=="number"?this.path.concat(n):this.path,w=f?this.scope.concat(f):this.scope;return new qa(this.registry,this._isConstant,g,c||null,w,this.errors)}error(n,...c){const f=`${this.key}${c.map(g=>`[${g}]`).join("")}`;this.errors.push(new wn(f,n))}checkSubtype(n,c){const f=Pe(n,c);return f&&this.error(f),f}}class Ps{constructor(n,c,f){this.type=to,this.locale=f,this.caseSensitive=n,this.diacriticSensitive=c}static parse(n,c){if(n.length!==2)return c.error("Expected one argument.");const f=n[1];if(typeof f!="object"||Array.isArray(f))return c.error("Collator options argument must be an object.");const g=c.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Qt);if(!g)return null;const w=c.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Qt);if(!w)return null;let x=null;return f.locale&&(x=c.parse(f.locale,1,ri),!x)?null:new Ps(g,w,x)}evaluate(n){return new cc(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}}const Go=8192;function Za(s,n){s[0]=Math.min(s[0],n[0]),s[1]=Math.min(s[1],n[1]),s[2]=Math.max(s[2],n[0]),s[3]=Math.max(s[3],n[1])}function ua(s,n){return!(s[0]<=n[0]||s[2]>=n[2]||s[1]<=n[1]||s[3]>=n[3])}function Nd(s,n){const c=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,n.z);return[Math.round(c*g*Go),Math.round(f*g*Go)]}function Ju(s,n,c){const f=s[0]-n[0],g=s[1]-n[1],w=s[0]-c[0],x=s[1]-c[1];return f*x-w*g==0&&f*w<=0&&g*x<=0}function Ga(s,n){let c=!1;for(let x=0,T=n.length;x<T;x++){const I=n[x];for(let P=0,N=I.length;P<N-1;P++){if(Ju(s,I[P],I[P+1]))return!1;(g=I[P])[1]>(f=s)[1]!=(w=I[P+1])[1]>f[1]&&f[0]<(w[0]-g[0])*(f[1]-g[1])/(w[1]-g[1])+g[0]&&(c=!c)}}var f,g,w;return c}function jd(s,n){for(let c=0;c<n.length;c++)if(Ga(s,n[c]))return!0;return!1}function Yu(s,n,c,f){const g=f[0]-c[0],w=f[1]-c[1],x=(s[0]-c[0])*w-g*(s[1]-c[1]),T=(n[0]-c[0])*w-g*(n[1]-c[1]);return x>0&&T<0||x<0&&T>0}function Ud(s,n,c){for(const P of c)for(let N=0;N<P.length-1;++N)if((T=[(x=P[N+1])[0]-(w=P[N])[0],x[1]-w[1]])[0]*(I=[(g=n)[0]-(f=s)[0],g[1]-f[1]])[1]-T[1]*I[0]!=0&&Yu(f,g,w,x)&&Yu(w,x,f,g))return!0;var f,g,w,x,T,I;return!1}function Qu(s,n){for(let c=0;c<s.length;++c)if(!Ga(s[c],n))return!1;for(let c=0;c<s.length-1;++c)if(Ud(s[c],s[c+1],n))return!1;return!0}function eh(s,n){for(let c=0;c<n.length;c++)if(Qu(s,n[c]))return!0;return!1}function Wa(s,n,c){const f=[];for(let g=0;g<s.length;g++){const w=[];for(let x=0;x<s[g].length;x++){const T=Nd(s[g][x],c);Za(n,T),w.push(T)}f.push(w)}return f}function th(s,n,c){const f=[];for(let g=0;g<s.length;g++){const w=Wa(s[g],n,c);f.push(w)}return f}function ih(s,n,c,f){if(s[0]<c[0]||s[0]>c[2]){const g=.5*f;let w=s[0]-c[0]>g?-f:c[0]-s[0]>g?f:0;w===0&&(w=s[0]-c[2]>g?-f:c[2]-s[0]>g?f:0),s[0]+=w}Za(n,s)}function Ha(s,n,c,f){const g=Math.pow(2,f.z)*Go,w=[f.x*Go,f.y*Go],x=[];for(const T of s)for(const I of T){const P=[I.x+w[0],I.y+w[1]];ih(P,n,c,g),x.push(P)}return x}function nh(s,n,c,f){const g=Math.pow(2,f.z)*Go,w=[f.x*Go,f.y*Go],x=[];for(const I of s){const P=[];for(const N of I){const U=[N.x+w[0],N.y+w[1]];Za(n,U),P.push(U)}x.push(P)}if(n[2]-n[0]<=g/2){(T=n)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of x)for(const P of I)ih(P,n,c,g)}var T;return x}class rs{constructor(n,c){this.type=Qt,this.geojson=n,this.geometries=c}static parse(n,c){if(n.length!==2)return c.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(Ua(n[1])){const f=n[1];if(f.type==="FeatureCollection"){const g=[];for(const w of f.features){const{type:x,coordinates:T}=w.geometry;x==="Polygon"&&g.push(T),x==="MultiPolygon"&&g.push(...T)}if(g.length)return new rs(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new rs(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new rs(f,f)}return c.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Wa(f.coordinates,w,x),I=Ha(c.geometry(),g,w,x);if(!ua(g,w))return!1;for(const P of I)if(!Ga(P,T))return!1}if(f.type==="MultiPolygon"){const T=th(f.coordinates,w,x),I=Ha(c.geometry(),g,w,x);if(!ua(g,w))return!1;for(const P of I)if(!jd(P,T))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(c,f){const g=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],x=c.canonicalID();if(f.type==="Polygon"){const T=Wa(f.coordinates,w,x),I=nh(c.geometry(),g,w,x);if(!ua(g,w))return!1;for(const P of I)if(!Qu(P,T))return!1}if(f.type==="MultiPolygon"){const T=th(f.coordinates,w,x),I=nh(c.geometry(),g,w,x);if(!ua(g,w))return!1;for(const P of I)if(!eh(P,T))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Xa{constructor(n,c){this.type=c.type,this.name=n,this.boundExpression=c}static parse(n,c){if(n.length!==2||typeof n[1]!="string")return c.error("'var' expression requires exactly one string literal argument.");const f=n[1];return c.scope.has(f)?new Xa(f,c.scope.get(f)):c.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}}class Rr{constructor(n,c,f,g){this.name=n,this.type=c,this._evaluate=f,this.args=g}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}static parse(n,c){const f=n[0],g=Rr.definitions[f];if(!g)return c.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=x.filter(([P])=>!Array.isArray(P)||P.length===n.length-1);let I=null;for(const[P,N]of T){I=new qa(c.registry,ha,c.path,null,c.scope);const U=[];let H=!1;for(let J=1;J<n.length;J++){const te=n[J],he=Array.isArray(P)?P[J-1]:P.type,ge=I.parse(te,1+U.length,he);if(!ge){H=!0;break}U.push(ge)}if(!H)if(Array.isArray(P)&&P.length!==U.length)I.error(`Expected ${P.length} arguments, but found ${U.length} instead.`);else{for(let J=0;J<U.length;J++){const te=Array.isArray(P)?P[J]:P.type,he=U[J];I.concat(J+1).checkSubtype(te,he.type)}if(I.errors.length===0)return new Rr(f,w,N,U)}}if(T.length===1)c.errors.push(...I.errors);else{const P=(T.length?T:x).map(([U])=>{return H=U,Array.isArray(H)?`(${H.map(de).join(", ")})`:`(${de(H.type)}...)`;var H}).join(" | "),N=[];for(let U=1;U<n.length;U++){const H=c.parse(n[U],1+N.length);if(!H)return null;N.push(de(H.type))}c.error(`Expected arguments of type ${P}, but found (${N.join(", ")}) instead.`)}return null}static register(n,c){Rr.definitions=c;for(const f in c)n[f]=Rr}}function ha(s){if(s instanceof Xa)return ha(s.boundExpression);if(s instanceof Rr&&s.name==="error"||s instanceof Ps||s instanceof rs)return!1;const n=s instanceof mo||s instanceof Dr;let c=!0;return s.eachChild(f=>{c=n?c&&ha(f):c&&f instanceof Zo}),!!c&&Ka(s)&&fa(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ka(s){if(s instanceof Rr&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof rs)return!1;let n=!0;return s.eachChild(c=>{n&&!Ka(c)&&(n=!1)}),n}function da(s){if(s instanceof Rr&&s.name==="feature-state")return!1;let n=!0;return s.eachChild(c=>{n&&!da(c)&&(n=!1)}),n}function fa(s,n){if(s instanceof Rr&&n.indexOf(s.name)>=0)return!1;let c=!0;return s.eachChild(f=>{c&&!fa(f,n)&&(c=!1)}),c}function pa(s,n){const c=s.length-1;let f,g,w=0,x=c,T=0;for(;w<=x;)if(T=Math.floor((w+x)/2),f=s[T],g=s[T+1],f<=n){if(T===c||n<g)return T;w=T+1}else{if(!(f>n))throw new sn("Input is not a number.");x=T-1}return 0}class ma{constructor(n,c,f){this.type=n,this.input=c,this.labels=[],this.outputs=[];for(const[g,w]of f)this.labels.push(g),this.outputs.push(w)}static parse(n,c){if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");const f=c.parse(n[1],1,gt);if(!f)return null;const g=[];let w=null;c.expectedType&&c.expectedType.kind!=="value"&&(w=c.expectedType);for(let x=1;x<n.length;x+=2){const T=x===1?-1/0:n[x],I=n[x+1],P=x,N=x+1;if(typeof T!="number")return c.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(g.length&&g[g.length-1][0]>=T)return c.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',P);const U=c.parse(I,N,w);if(!U)return null;w=w||U.type,g.push([T,U])}return new ma(w,f,g)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const g=this.input.evaluate(n);if(g<=c[0])return f[0].evaluate(n);const w=c.length;return g>=c[w-1]?f[w-1].evaluate(n):f[pa(c,g)].evaluate(n)}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Vd(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var $d=rh;function rh(s,n,c,f){this.cx=3*s,this.bx=3*(c-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(f-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=n,this.p2x=c,this.p2y=f}rh.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,n){if(n===void 0&&(n=1e-6),s<0)return 0;if(s>1)return 1;for(var c=s,f=0;f<8;f++){var g=this.sampleCurveX(c)-s;if(Math.abs(g)<n)return c;var w=this.sampleCurveDerivativeX(c);if(Math.abs(w)<1e-6)break;c-=g/w}var x=0,T=1;for(c=s,f=0;f<20&&(g=this.sampleCurveX(c),!(Math.abs(g-s)<n));f++)s>g?x=c:T=c,c=.5*(T-x)+x;return c},solve:function(s,n){return this.sampleCurveY(this.solveCurveX(s,n))}};var qd=Vd($d);function os(s,n,c){return s+c*(n-s)}function Ja(s,n,c){return s.map((f,g)=>os(f,n[g],c))}const hr={number:os,color:function(s,n,c,f="rgb"){switch(f){case"rgb":{const[g,w,x,T]=Ja(s.rgb,n.rgb,c);return new zi(g,w,x,T,!1)}case"hcl":{const[g,w,x,T]=s.hcl,[I,P,N,U]=n.hcl;let H,J;if(isNaN(g)||isNaN(I))isNaN(g)?isNaN(I)?H=NaN:(H=I,x!==1&&x!==0||(J=P)):(H=g,N!==1&&N!==0||(J=w));else{let Fe=I-g;I>g&&Fe>180?Fe-=360:I<g&&g-I>180&&(Fe+=360),H=g+c*Fe}const[te,he,ge,xe]=function([Fe,Te,De,Qe]){return Fe=isNaN(Fe)?0:Fe*Kt,hn([De,Math.cos(Fe)*Te,Math.sin(Fe)*Te,Qe])}([H,J??os(w,P,c),os(x,N,c),os(T,U,c)]);return new zi(te,he,ge,xe,!1)}case"lab":{const[g,w,x,T]=hn(Ja(s.lab,n.lab,c));return new zi(g,w,x,T,!1)}}},array:Ja,padding:function(s,n,c){return new wr(Ja(s.values,n.values,c))},variableAnchorOffsetCollection:function(s,n,c){const f=s.values,g=n.values;if(f.length!==g.length)throw new sn(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${n.toString()}`);const w=[];for(let x=0;x<f.length;x+=2){if(f[x]!==g[x])throw new sn(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${f[x]}, to[${x}]: ${g[x]}`);w.push(f[x]);const[T,I]=f[x+1],[P,N]=g[x+1];w.push([os(T,P,c),os(I,N,c)])}return new Hr(w)}};class nr{constructor(n,c,f,g,w){this.type=n,this.operator=c,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[x,T]of w)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(n,c,f,g){let w=0;if(n.name==="exponential")w=Ii(c,n.base,f,g);else if(n.name==="linear")w=Ii(c,1,f,g);else if(n.name==="cubic-bezier"){const x=n.controlPoints;w=new qd(x[0],x[1],x[2],x[3]).solve(Ii(c,1,f,g))}return w}static parse(n,c){let[f,g,w,...x]=n;if(!Array.isArray(g)||g.length===0)return c.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const P=g[1];if(typeof P!="number")return c.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:P}}else{if(g[0]!=="cubic-bezier")return c.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const P=g.slice(1);if(P.length!==4||P.some(N=>typeof N!="number"||N<0||N>1))return c.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:P}}}if(n.length-1<4)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return c.error("Expected an even number of arguments.");if(w=c.parse(w,2,gt),!w)return null;const T=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=$i:c.expectedType&&c.expectedType.kind!=="value"&&(I=c.expectedType);for(let P=0;P<x.length;P+=2){const N=x[P],U=x[P+1],H=P+3,J=P+4;if(typeof N!="number")return c.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',H);if(T.length&&T[T.length-1][0]>=N)return c.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',H);const te=c.parse(U,J,I);if(!te)return null;I=I||te.type,T.push([N,te])}return G(I,gt)||G(I,$i)||G(I,me)||G(I,K)||G(I,ie(gt))?new nr(I,f,g,w,T):c.error(`Type ${de(I)} is not interpolatable.`)}evaluate(n){const c=this.labels,f=this.outputs;if(c.length===1)return f[0].evaluate(n);const g=this.input.evaluate(n);if(g<=c[0])return f[0].evaluate(n);const w=c.length;if(g>=c[w-1])return f[w-1].evaluate(n);const x=pa(c,g),T=nr.interpolationFactor(this.interpolation,g,c[x],c[x+1]),I=f[x].evaluate(n),P=f[x+1].evaluate(n);switch(this.operator){case"interpolate":return hr[this.type.kind](I,P,T);case"interpolate-hcl":return hr.color(I,P,T,"hcl");case"interpolate-lab":return hr.color(I,P,T,"lab")}}eachChild(n){n(this.input);for(const c of this.outputs)n(c)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}}function Ii(s,n,c,f){const g=f-c,w=s-c;return g===0?0:n===1?w/g:(Math.pow(n,w)-1)/(Math.pow(n,g)-1)}class Ya{constructor(n,c){this.type=n,this.args=c}static parse(n,c){if(n.length<2)return c.error("Expectected at least one argument.");let f=null;const g=c.expectedType;g&&g.kind!=="value"&&(f=g);const w=[];for(const T of n.slice(1)){const I=c.parse(T,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,w.push(I)}if(!f)throw new Error("No output type");const x=g&&w.some(T=>Pe(g,T.type));return new Ya(x?ii:f,w)}evaluate(n){let c,f=null,g=0;for(const w of this.args)if(g++,f=w.evaluate(n),f&&f instanceof Xr&&!f.available&&(c||(c=f.name),f=null,g===this.args.length&&(f=c)),f!==null)break;return f}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}}class Qa{constructor(n,c){this.type=c.type,this.bindings=[].concat(n),this.result=c}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const c of this.bindings)n(c[1]);n(this.result)}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const f=[];for(let w=1;w<n.length-1;w+=2){const x=n[w];if(typeof x!="string")return c.error(`Expected string, but found ${typeof x} instead.`,w);if(/[^a-zA-Z0-9_]/.test(x))return c.error("Variable names must contain only alphanumeric characters or '_'.",w);const T=c.parse(n[w+1],w+1);if(!T)return null;f.push([x,T])}const g=c.parse(n[n.length-1],n.length-1,c.expectedType,f);return g?new Qa(f,g):null}outputDefined(){return this.result.outputDefined()}}class hc{constructor(n,c,f){this.type=n,this.index=c,this.input=f}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,gt),g=c.parse(n[2],2,ie(c.expectedType||ii));return f&&g?new hc(g.type.itemType,f,g):null}evaluate(n){const c=this.index.evaluate(n),f=this.input.evaluate(n);if(c<0)throw new sn(`Array index out of bounds: ${c} < 0.`);if(c>=f.length)throw new sn(`Array index out of bounds: ${c} > ${f.length-1}.`);if(c!==Math.floor(c))throw new sn(`Array index must be an integer, but found ${c} instead.`);return f[c]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}}class dc{constructor(n,c){this.type=Qt,this.needle=n,this.haystack=c}static parse(n,c){if(n.length!==3)return c.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ii),g=c.parse(n[2],2,ii);return f&&g?Be(f.type,[Qt,ri,gt,Vi,ii])?new dc(f,g):c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(f.type)} instead`):null}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!f)return!1;if(!Se(c,["boolean","string","number","null"]))throw new sn(`Expected first argument to be of type boolean, string, number or null, but found ${de(Ln(c))} instead.`);if(!Se(f,["string","array"]))throw new sn(`Expected second argument to be of type array or string, but found ${de(Ln(f))} instead.`);return f.indexOf(c)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}}class el{constructor(n,c,f){this.type=gt,this.needle=n,this.haystack=c,this.fromIndex=f}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ii),g=c.parse(n[2],2,ii);if(!f||!g)return null;if(!Be(f.type,[Qt,ri,gt,Vi,ii]))return c.error(`Expected first argument to be of type boolean, string, number or null, but found ${de(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,gt);return w?new el(f,g,w):null}return new el(f,g)}evaluate(n){const c=this.needle.evaluate(n),f=this.haystack.evaluate(n);if(!Se(c,["boolean","string","number","null"]))throw new sn(`Expected first argument to be of type boolean, string, number or null, but found ${de(Ln(c))} instead.`);if(!Se(f,["string","array"]))throw new sn(`Expected second argument to be of type array or string, but found ${de(Ln(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(n);return f.indexOf(c,g)}return f.indexOf(c)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}}class fc{constructor(n,c,f,g,w,x){this.inputType=n,this.type=c,this.input=f,this.cases=g,this.outputs=w,this.otherwise=x}static parse(n,c){if(n.length<5)return c.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return c.error("Expected an even number of arguments.");let f,g;c.expectedType&&c.expectedType.kind!=="value"&&(g=c.expectedType);const w={},x=[];for(let P=2;P<n.length-1;P+=2){let N=n[P];const U=n[P+1];Array.isArray(N)||(N=[N]);const H=c.concat(P);if(N.length===0)return H.error("Expected at least one branch label.");for(const te of N){if(typeof te!="number"&&typeof te!="string")return H.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return H.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof te=="number"&&Math.floor(te)!==te)return H.error("Numeric branch labels must be integer values.");if(f){if(H.checkSubtype(f,Ln(te)))return null}else f=Ln(te);if(w[String(te)]!==void 0)return H.error("Branch labels must be unique.");w[String(te)]=x.length}const J=c.parse(U,P,g);if(!J)return null;g=g||J.type,x.push(J)}const T=c.parse(n[1],1,ii);if(!T)return null;const I=c.parse(n[n.length-1],n.length-1,g);return I?T.type.kind!=="value"&&c.concat(1).checkSubtype(f,T.type)?null:new fc(f,g,T,w,x,I):null}evaluate(n){const c=this.input.evaluate(n);return(Ln(c)===this.inputType&&this.outputs[this.cases[c]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}}class pc{constructor(n,c,f){this.type=n,this.branches=c,this.otherwise=f}static parse(n,c){if(n.length<4)return c.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return c.error("Expected an odd number of arguments.");let f;c.expectedType&&c.expectedType.kind!=="value"&&(f=c.expectedType);const g=[];for(let x=1;x<n.length-1;x+=2){const T=c.parse(n[x],x,Qt);if(!T)return null;const I=c.parse(n[x+1],x+1,f);if(!I)return null;g.push([T,I]),f=f||I.type}const w=c.parse(n[n.length-1],n.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new pc(f,g,w)}evaluate(n){for(const[c,f]of this.branches)if(c.evaluate(n))return f.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[c,f]of this.branches)n(c),n(f);n(this.otherwise)}outputDefined(){return this.branches.every(([n,c])=>c.outputDefined())&&this.otherwise.outputDefined()}}class tl{constructor(n,c,f,g){this.type=n,this.input=c,this.beginIndex=f,this.endIndex=g}static parse(n,c){if(n.length<=2||n.length>=5)return c.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const f=c.parse(n[1],1,ii),g=c.parse(n[2],2,gt);if(!f||!g)return null;if(!Be(f.type,[ie(ii),ri,ii]))return c.error(`Expected first argument to be of type array or string, but found ${de(f.type)} instead`);if(n.length===4){const w=c.parse(n[3],3,gt);return w?new tl(f.type,f,g,w):null}return new tl(f.type,f,g)}evaluate(n){const c=this.input.evaluate(n),f=this.beginIndex.evaluate(n);if(!Se(c,["string","array"]))throw new sn(`Expected first argument to be of type array or string, but found ${de(Ln(c))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(n);return c.slice(f,g)}return c.slice(f)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}}function oh(s,n){return s==="=="||s==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function sh(s,n,c,f){return f.compare(n,c)===0}function zs(s,n,c){const f=s!=="=="&&s!=="!=";return class i0{constructor(w,x,T){this.type=Qt,this.lhs=w,this.rhs=x,this.collator=T,this.hasUntypedArgument=w.type.kind==="value"||x.type.kind==="value"}static parse(w,x){if(w.length!==3&&w.length!==4)return x.error("Expected two or three arguments.");const T=w[0];let I=x.parse(w[1],1,ii);if(!I)return null;if(!oh(T,I.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${de(I.type)}'.`);let P=x.parse(w[2],2,ii);if(!P)return null;if(!oh(T,P.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${de(P.type)}'.`);if(I.type.kind!==P.type.kind&&I.type.kind!=="value"&&P.type.kind!=="value")return x.error(`Cannot compare types '${de(I.type)}' and '${de(P.type)}'.`);f&&(I.type.kind==="value"&&P.type.kind!=="value"?I=new Dr(P.type,[I]):I.type.kind!=="value"&&P.type.kind==="value"&&(P=new Dr(I.type,[P])));let N=null;if(w.length===4){if(I.type.kind!=="string"&&P.type.kind!=="string"&&I.type.kind!=="value"&&P.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(N=x.parse(w[3],3,to),!N)return null}return new i0(I,P,N)}evaluate(w){const x=this.lhs.evaluate(w),T=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const I=Ln(x),P=Ln(T);if(I.kind!==P.kind||I.kind!=="string"&&I.kind!=="number")throw new sn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${I.kind}, ${P.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=Ln(x),P=Ln(T);if(I.kind!=="string"||P.kind!=="string")return n(w,x,T)}return this.collator?c(w,x,T,this.collator.evaluate(w)):n(w,x,T)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const Zd=zs("==",function(s,n,c){return n===c},sh),Gd=zs("!=",function(s,n,c){return n!==c},function(s,n,c,f){return!sh(0,n,c,f)}),Wd=zs("<",function(s,n,c){return n<c},function(s,n,c,f){return f.compare(n,c)<0}),Hd=zs(">",function(s,n,c){return n>c},function(s,n,c,f){return f.compare(n,c)>0}),Xd=zs("<=",function(s,n,c){return n<=c},function(s,n,c,f){return f.compare(n,c)<=0}),Kd=zs(">=",function(s,n,c){return n>=c},function(s,n,c,f){return f.compare(n,c)>=0});class mc{constructor(n,c,f,g,w){this.type=ri,this.number=n,this.locale=c,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=w}static parse(n,c){if(n.length!==3)return c.error("Expected two arguments.");const f=c.parse(n[1],1,gt);if(!f)return null;const g=n[2];if(typeof g!="object"||Array.isArray(g))return c.error("NumberFormat options argument must be an object.");let w=null;if(g.locale&&(w=c.parse(g.locale,1,ri),!w))return null;let x=null;if(g.currency&&(x=c.parse(g.currency,1,ri),!x))return null;let T=null;if(g["min-fraction-digits"]&&(T=c.parse(g["min-fraction-digits"],1,gt),!T))return null;let I=null;return g["max-fraction-digits"]&&(I=c.parse(g["max-fraction-digits"],1,gt),!I)?null:new mc(f,w,x,T,I)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}}class il{constructor(n){this.type=un,this.sections=n}static parse(n,c){if(n.length<2)return c.error("Expected at least one argument.");const f=n[1];if(!Array.isArray(f)&&typeof f=="object")return c.error("First argument must be an image or text section.");const g=[];let w=!1;for(let x=1;x<=n.length-1;++x){const T=n[x];if(w&&typeof T=="object"&&!Array.isArray(T)){w=!1;let I=null;if(T["font-scale"]&&(I=c.parse(T["font-scale"],1,gt),!I))return null;let P=null;if(T["text-font"]&&(P=c.parse(T["text-font"],1,ie(ri)),!P))return null;let N=null;if(T["text-color"]&&(N=c.parse(T["text-color"],1,$i),!N))return null;const U=g[g.length-1];U.scale=I,U.font=P,U.textColor=N}else{const I=c.parse(n[x],1,ii);if(!I)return null;const P=I.type.kind;if(P!=="string"&&P!=="value"&&P!=="null"&&P!=="resolvedImage")return c.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,g.push({content:I,scale:null,font:null,textColor:null})}}return new il(g)}evaluate(n){return new zr(this.sections.map(c=>{const f=c.content.evaluate(n);return Ln(f)===W?new uc("",f,null,null,null):new uc(la(f),null,c.scale?c.scale.evaluate(n):null,c.font?c.font.evaluate(n).join(","):null,c.textColor?c.textColor.evaluate(n):null)}))}eachChild(n){for(const c of this.sections)n(c.content),c.scale&&n(c.scale),c.font&&n(c.font),c.textColor&&n(c.textColor)}outputDefined(){return!1}}class gc{constructor(n){this.type=W,this.input=n}static parse(n,c){if(n.length!==2)return c.error("Expected two arguments.");const f=c.parse(n[1],1,ri);return f?new gc(f):c.error("No image name provided.")}evaluate(n){const c=this.input.evaluate(n),f=Xr.fromString(c);return f&&n.availableImages&&(f.available=n.availableImages.indexOf(c)>-1),f}eachChild(n){n(this.input)}outputDefined(){return!1}}class _c{constructor(n){this.type=gt,this.input=n}static parse(n,c){if(n.length!==2)return c.error(`Expected 1 argument, but found ${n.length-1} instead.`);const f=c.parse(n[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?c.error(`Expected argument of type string or array, but found ${de(f.type)} instead.`):new _c(f):null}evaluate(n){const c=this.input.evaluate(n);if(typeof c=="string"||Array.isArray(c))return c.length;throw new sn(`Expected value to be of type string or array, but found ${de(Ln(c))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}}const Ds={"==":Zd,"!=":Gd,">":Hd,"<":Wd,">=":Kd,"<=":Xd,array:Dr,at:hc,boolean:Dr,case:pc,coalesce:Ya,collator:Ps,format:il,image:gc,in:dc,"index-of":el,interpolate:nr,"interpolate-hcl":nr,"interpolate-lab":nr,length:_c,let:Qa,literal:Zo,match:fc,number:Dr,"number-format":mc,object:Dr,slice:tl,step:ma,string:Dr,"to-boolean":mo,"to-color":mo,"to-number":mo,"to-string":mo,var:Xa,within:rs};function ah(s,[n,c,f,g]){n=n.evaluate(s),c=c.evaluate(s),f=f.evaluate(s);const w=g?g.evaluate(s):1,x=As(n,c,f,w);if(x)throw new sn(x);return new zi(n/255,c/255,f/255,w,!1)}function lh(s,n){return s in n}function yc(s,n){const c=n[s];return c===void 0?null:c}function ss(s){return{type:s}}function ch(s){return{result:"success",value:s}}function Rs(s){return{result:"error",value:s}}function Bs(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function uh(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function vc(s){return!!s.expression&&s.expression.interpolated}function Mi(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function nl(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Jd(s){return s}function hh(s,n){const c=n.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",g=f||!(f||s.property!==void 0),w=s.type||(vc(n)?"exponential":"interval");if(c||n.type==="padding"){const N=c?zi.parse:wr.parse;(s=Hn({},s)).stops&&(s.stops=s.stops.map(U=>[U[0],N(U[1])])),s.default=N(s.default?s.default:n.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let T,I,P;if(w==="exponential")T=Si;else if(w==="interval")T=Yd;else if(w==="categorical"){T=xn,I=Object.create(null);for(const N of s.stops)I[N[0]]=N[1];P=typeof s.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);T=bc}if(f){const N={},U=[];for(let te=0;te<s.stops.length;te++){const he=s.stops[te],ge=he[0].zoom;N[ge]===void 0&&(N[ge]={zoom:ge,type:s.type,property:s.property,default:s.default,stops:[]},U.push(ge)),N[ge].stops.push([he[0].value,he[1]])}const H=[];for(const te of U)H.push([N[te].zoom,hh(N[te],n)]);const J={name:"linear"};return{kind:"composite",interpolationType:J,interpolationFactor:nr.interpolationFactor.bind(void 0,J),zoomStops:H.map(te=>te[0]),evaluate:({zoom:te},he)=>Si({stops:H,base:s.base},n,te).evaluate(te,he)}}if(g){const N=w==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:nr.interpolationFactor.bind(void 0,N),zoomStops:s.stops.map(U=>U[0]),evaluate:({zoom:U})=>T(s,n,U,I,P)}}return{kind:"source",evaluate(N,U){const H=U&&U.properties?U.properties[s.property]:void 0;return H===void 0?ga(s.default,n.default):T(s,n,H,I,P)}}}function ga(s,n,c){return s!==void 0?s:n!==void 0?n:c!==void 0?c:void 0}function xn(s,n,c,f,g){return ga(typeof c===g?f[c]:void 0,s.default,n.default)}function Yd(s,n,c){if(Mi(c)!=="number")return ga(s.default,n.default);const f=s.stops.length;if(f===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[f-1][0])return s.stops[f-1][1];const g=pa(s.stops.map(w=>w[0]),c);return s.stops[g][1]}function Si(s,n,c){const f=s.base!==void 0?s.base:1;if(Mi(c)!=="number")return ga(s.default,n.default);const g=s.stops.length;if(g===1||c<=s.stops[0][0])return s.stops[0][1];if(c>=s.stops[g-1][0])return s.stops[g-1][1];const w=pa(s.stops.map(N=>N[0]),c),x=function(N,U,H,J){const te=J-H,he=N-H;return te===0?0:U===1?he/te:(Math.pow(U,he)-1)/(Math.pow(U,te)-1)}(c,f,s.stops[w][0],s.stops[w+1][0]),T=s.stops[w][1],I=s.stops[w+1][1],P=hr[n.type]||Jd;return typeof T.evaluate=="function"?{evaluate(...N){const U=T.evaluate.apply(void 0,N),H=I.evaluate.apply(void 0,N);if(U!==void 0&&H!==void 0)return P(U,H,x,s.colorSpace)}}:P(T,I,x,s.colorSpace)}function bc(s,n,c){switch(n.type){case"color":c=zi.parse(c);break;case"formatted":c=zr.fromString(c.toString());break;case"resolvedImage":c=Xr.fromString(c.toString());break;case"padding":c=wr.parse(c);break;default:Mi(c)===n.type||n.type==="enum"&&n.values[c]||(c=void 0)}return ga(c,s.default,n.default)}Rr.register(Ds,{error:[{kind:"error"},[ri],(s,[n])=>{throw new sn(n.evaluate(s))}],typeof:[ri,[ii],(s,[n])=>de(Ln(n.evaluate(s)))],"to-rgba":[ie(gt,4),[$i],(s,[n])=>{const[c,f,g,w]=n.evaluate(s).rgb;return[255*c,255*f,255*g,w]}],rgb:[$i,[gt,gt,gt],ah],rgba:[$i,[gt,gt,gt,gt],ah],has:{type:Qt,overloads:[[[ri],(s,[n])=>lh(n.evaluate(s),s.properties())],[[ri,vr],(s,[n,c])=>lh(n.evaluate(s),c.evaluate(s))]]},get:{type:ii,overloads:[[[ri],(s,[n])=>yc(n.evaluate(s),s.properties())],[[ri,vr],(s,[n,c])=>yc(n.evaluate(s),c.evaluate(s))]]},"feature-state":[ii,[ri],(s,[n])=>yc(n.evaluate(s),s.featureState||{})],properties:[vr,[],s=>s.properties()],"geometry-type":[ri,[],s=>s.geometryType()],id:[ii,[],s=>s.id()],zoom:[gt,[],s=>s.globals.zoom],"heatmap-density":[gt,[],s=>s.globals.heatmapDensity||0],"line-progress":[gt,[],s=>s.globals.lineProgress||0],accumulated:[ii,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[gt,ss(gt),(s,n)=>{let c=0;for(const f of n)c+=f.evaluate(s);return c}],"*":[gt,ss(gt),(s,n)=>{let c=1;for(const f of n)c*=f.evaluate(s);return c}],"-":{type:gt,overloads:[[[gt,gt],(s,[n,c])=>n.evaluate(s)-c.evaluate(s)],[[gt],(s,[n])=>-n.evaluate(s)]]},"/":[gt,[gt,gt],(s,[n,c])=>n.evaluate(s)/c.evaluate(s)],"%":[gt,[gt,gt],(s,[n,c])=>n.evaluate(s)%c.evaluate(s)],ln2:[gt,[],()=>Math.LN2],pi:[gt,[],()=>Math.PI],e:[gt,[],()=>Math.E],"^":[gt,[gt,gt],(s,[n,c])=>Math.pow(n.evaluate(s),c.evaluate(s))],sqrt:[gt,[gt],(s,[n])=>Math.sqrt(n.evaluate(s))],log10:[gt,[gt],(s,[n])=>Math.log(n.evaluate(s))/Math.LN10],ln:[gt,[gt],(s,[n])=>Math.log(n.evaluate(s))],log2:[gt,[gt],(s,[n])=>Math.log(n.evaluate(s))/Math.LN2],sin:[gt,[gt],(s,[n])=>Math.sin(n.evaluate(s))],cos:[gt,[gt],(s,[n])=>Math.cos(n.evaluate(s))],tan:[gt,[gt],(s,[n])=>Math.tan(n.evaluate(s))],asin:[gt,[gt],(s,[n])=>Math.asin(n.evaluate(s))],acos:[gt,[gt],(s,[n])=>Math.acos(n.evaluate(s))],atan:[gt,[gt],(s,[n])=>Math.atan(n.evaluate(s))],min:[gt,ss(gt),(s,n)=>Math.min(...n.map(c=>c.evaluate(s)))],max:[gt,ss(gt),(s,n)=>Math.max(...n.map(c=>c.evaluate(s)))],abs:[gt,[gt],(s,[n])=>Math.abs(n.evaluate(s))],round:[gt,[gt],(s,[n])=>{const c=n.evaluate(s);return c<0?-Math.round(-c):Math.round(c)}],floor:[gt,[gt],(s,[n])=>Math.floor(n.evaluate(s))],ceil:[gt,[gt],(s,[n])=>Math.ceil(n.evaluate(s))],"filter-==":[Qt,[ri,ii],(s,[n,c])=>s.properties()[n.value]===c.value],"filter-id-==":[Qt,[ii],(s,[n])=>s.id()===n.value],"filter-type-==":[Qt,[ri],(s,[n])=>s.geometryType()===n.value],"filter-<":[Qt,[ri,ii],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Qt,[ii],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c<f}],"filter->":[Qt,[ri,ii],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f>g}],"filter-id->":[Qt,[ii],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c>f}],"filter-<=":[Qt,[ri,ii],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Qt,[ii],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c<=f}],"filter->=":[Qt,[ri,ii],(s,[n,c])=>{const f=s.properties()[n.value],g=c.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Qt,[ii],(s,[n])=>{const c=s.id(),f=n.value;return typeof c==typeof f&&c>=f}],"filter-has":[Qt,[ii],(s,[n])=>n.value in s.properties()],"filter-has-id":[Qt,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Qt,[ie(ri)],(s,[n])=>n.value.indexOf(s.geometryType())>=0],"filter-id-in":[Qt,[ie(ii)],(s,[n])=>n.value.indexOf(s.id())>=0],"filter-in-small":[Qt,[ri,ie(ii)],(s,[n,c])=>c.value.indexOf(s.properties()[n.value])>=0],"filter-in-large":[Qt,[ri,ie(ii)],(s,[n,c])=>function(f,g,w,x){for(;w<=x;){const T=w+x>>1;if(g[T]===f)return!0;g[T]>f?x=T-1:w=T+1}return!1}(s.properties()[n.value],c.value,0,c.value.length-1)],all:{type:Qt,overloads:[[[Qt,Qt],(s,[n,c])=>n.evaluate(s)&&c.evaluate(s)],[ss(Qt),(s,n)=>{for(const c of n)if(!c.evaluate(s))return!1;return!0}]]},any:{type:Qt,overloads:[[[Qt,Qt],(s,[n,c])=>n.evaluate(s)||c.evaluate(s)],[ss(Qt),(s,n)=>{for(const c of n)if(c.evaluate(s))return!0;return!1}]]},"!":[Qt,[Qt],(s,[n])=>!n.evaluate(s)],"is-supported-script":[Qt,[ri],(s,[n])=>{const c=s.globals&&s.globals.isSupportedScript;return!c||c(n.evaluate(s))}],upcase:[ri,[ri],(s,[n])=>n.evaluate(s).toUpperCase()],downcase:[ri,[ri],(s,[n])=>n.evaluate(s).toLowerCase()],concat:[ri,ss(ii),(s,n)=>n.map(c=>la(c.evaluate(s))).join("")],"resolved-locale":[ri,[to],(s,[n])=>n.evaluate(s).resolvedLocale()]});class Gi{constructor(n,c){var f;this.expression=n,this._warningHistory={},this._evaluator=new Di,this._defaultValue=c?(f=c).type==="color"&&nl(f.default)?new zi(0,0,0,0):f.type==="color"?zi.parse(f.default)||null:f.type==="padding"?wr.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Hr.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=c&&c.type==="enum"?c.values:null}evaluateWithoutErrorHandling(n,c,f,g,w,x){return this._evaluator.globals=n,this._evaluator.feature=c,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(n,c,f,g,w,x){this._evaluator.globals=n,this._evaluator.feature=c||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=x||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new sn(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function qi(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ds}function as(s,n){const c=new qa(Ds,ha,[],n?function(g){const w={color:$i,string:ri,number:gt,enum:ri,boolean:Qt,formatted:un,padding:me,resolvedImage:W,variableAnchorOffsetCollection:K};return g.type==="array"?ie(w[g.value]||ii,g.length):w[g.type]}(n):void 0),f=c.parse(s,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?ch(new Gi(f,n)):Rs(c.errors)}class rl{constructor(n,c){this.kind=n,this._styleExpression=c,this.isStateDependent=n!=="constant"&&!da(c.expression)}evaluateWithoutErrorHandling(n,c,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,g,w,x)}evaluate(n,c,f,g,w,x){return this._styleExpression.evaluate(n,c,f,g,w,x)}}class wc{constructor(n,c,f,g){this.kind=n,this.zoomStops=f,this._styleExpression=c,this.isStateDependent=n!=="camera"&&!da(c.expression),this.interpolationType=g}evaluateWithoutErrorHandling(n,c,f,g,w,x){return this._styleExpression.evaluateWithoutErrorHandling(n,c,f,g,w,x)}evaluate(n,c,f,g,w,x){return this._styleExpression.evaluate(n,c,f,g,w,x)}interpolationFactor(n,c,f){return this.interpolationType?nr.interpolationFactor(this.interpolationType,n,c,f):0}}function dh(s,n){const c=as(s,n);if(c.result==="error")return c;const f=c.value.expression,g=Ka(f);if(!g&&!Bs(n))return Rs([new wn("","data expressions not supported")]);const w=fa(f,["zoom"]);if(!w&&!uh(n))return Rs([new wn("","zoom expressions not supported")]);const x=sl(f);return x||w?x instanceof wn?Rs([x]):x instanceof nr&&!vc(n)?Rs([new wn("",'"interpolate" expressions cannot be used with this property')]):ch(x?new wc(g?"camera":"composite",c.value,x.labels,x instanceof nr?x.interpolation:void 0):new rl(g?"constant":"source",c.value)):Rs([new wn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ol{constructor(n,c){this._parameters=n,this._specification=c,Hn(this,hh(this._parameters,this._specification))}static deserialize(n){return new ol(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function sl(s){let n=null;if(s instanceof Qa)n=sl(s.result);else if(s instanceof Ya){for(const c of s.args)if(n=sl(c),n)break}else(s instanceof ma||s instanceof nr)&&s.input instanceof Rr&&s.input.name==="zoom"&&(n=s);return n instanceof wn||s.eachChild(c=>{const f=sl(c);f instanceof wn?n=f:!n&&f?n=new wn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&f&&n!==f&&(n=new wn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}function al(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const n of s.slice(1))if(!al(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}const fh={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ll(s){if(s==null)return{filter:()=>!0,needGeometry:!1};al(s)||(s=ul(s));const n=as(s,fh);if(n.result==="error")throw new Error(n.value.map(c=>`${c.key}: ${c.message}`).join(", "));return{filter:(c,f,g)=>n.value.evaluate(c,f,{},g),needGeometry:cl(s)}}function ph(s,n){return s<n?-1:s>n?1:0}function cl(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let n=1;n<s.length;n++)if(cl(s[n]))return!0;return!1}function ul(s){if(!s)return!0;const n=s[0];return s.length<=1?n!=="any":n==="=="?xc(s[1],s[2],"=="):n==="!="?hl(xc(s[1],s[2],"==")):n==="<"||n===">"||n==="<="||n===">="?xc(s[1],s[2],n):n==="any"?(c=s.slice(1),["any"].concat(c.map(ul))):n==="all"?["all"].concat(s.slice(1).map(ul)):n==="none"?["all"].concat(s.slice(1).map(ul).map(hl)):n==="in"?mh(s[1],s.slice(2)):n==="!in"?hl(mh(s[1],s.slice(2))):n==="has"?gh(s[1]):n==="!has"?hl(gh(s[1])):n!=="within"||s;var c}function xc(s,n,c){switch(s){case"$type":return[`filter-type-${c}`,n];case"$id":return[`filter-id-${c}`,n];default:return[`filter-${c}`,s,n]}}function mh(s,n){if(n.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(c=>typeof c!=typeof n[0])?["filter-in-large",s,["literal",n.sort(ph)]]:["filter-in-small",s,["literal",n]]}}function gh(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function hl(s){return["!",s]}function kc(s){const n=typeof s;if(n==="number"||n==="boolean"||n==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const w of s)g+=`${kc(w)},`;return`${g}]`}const c=Object.keys(s).sort();let f="{";for(let g=0;g<c.length;g++)f+=`${JSON.stringify(c[g])}:${kc(s[c[g]])},`;return`${f}}`}function Qd(s){let n="";for(const c of di)n+=`/${kc(s[c])}`;return n}function _h(s){const n=s.value;return n?[new ht(s.key,n,"constants have been deprecated as of v8")]:[]}function dn(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Wo(s){if(Array.isArray(s))return s.map(Wo);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const n={};for(const c in s)n[c]=Wo(s[c]);return n}return dn(s)}function dr(s){const n=s.key,c=s.value,f=s.valueSpec||{},g=s.objectElementValidators||{},w=s.style,x=s.styleSpec,T=s.validateSpec;let I=[];const P=Mi(c);if(P!=="object")return[new ht(n,c,`object expected, ${P} found`)];for(const N in c){const U=N.split(".")[0],H=f[U]||f["*"];let J;if(g[U])J=g[U];else if(f[U])J=T;else if(g["*"])J=g["*"];else{if(!f["*"]){I.push(new ht(n,c[N],`unknown property "${N}"`));continue}J=T}I=I.concat(J({key:(n&&`${n}.`)+N,value:c[N],valueSpec:H,style:w,styleSpec:x,object:c,objectKey:N,validateSpec:T},c))}for(const N in f)g[N]||f[N].required&&f[N].default===void 0&&c[N]===void 0&&I.push(new ht(n,c,`missing required property "${N}"`));return I}function Sc(s){const n=s.value,c=s.valueSpec,f=s.style,g=s.styleSpec,w=s.key,x=s.arrayElementValidator||s.validateSpec;if(Mi(n)!=="array")return[new ht(w,n,`array expected, ${Mi(n)} found`)];if(c.length&&n.length!==c.length)return[new ht(w,n,`array length ${c.length} expected, length ${n.length} found`)];if(c["min-length"]&&n.length<c["min-length"])return[new ht(w,n,`array length at least ${c["min-length"]} expected, length ${n.length} found`)];let T={type:c.value,values:c.values};g.$version<7&&(T.function=c.function),Mi(c.value)==="object"&&(T=c.value);let I=[];for(let P=0;P<n.length;P++)I=I.concat(x({array:n,arrayIndex:P,value:n[P],valueSpec:T,validateSpec:s.validateSpec,style:f,styleSpec:g,key:`${w}[${P}]`}));return I}function dl(s){const n=s.key,c=s.value,f=s.valueSpec;let g=Mi(c);return g==="number"&&c!=c&&(g="NaN"),g!=="number"?[new ht(n,c,`number expected, ${g} found`)]:"minimum"in f&&c<f.minimum?[new ht(n,c,`${c} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&c>f.maximum?[new ht(n,c,`${c} is greater than the maximum value ${f.maximum}`)]:[]}function yh(s){const n=s.valueSpec,c=dn(s.value.type);let f,g,w,x={};const T=c!=="categorical"&&s.value.property===void 0,I=!T,P=Mi(s.value.stops)==="array"&&Mi(s.value.stops[0])==="array"&&Mi(s.value.stops[0][0])==="object",N=dr({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(J){if(c==="identity")return[new ht(J.key,J.value,'identity function may not have a "stops" property')];let te=[];const he=J.value;return te=te.concat(Sc({key:J.key,value:he,valueSpec:J.valueSpec,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,arrayElementValidator:U})),Mi(he)==="array"&&he.length===0&&te.push(new ht(J.key,he,"array must have at least one stop")),te},default:function(J){return J.validateSpec({key:J.key,value:J.value,valueSpec:n,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec})}}});return c==="identity"&&T&&N.push(new ht(s.key,s.value,'missing required property "property"')),c==="identity"||s.value.stops||N.push(new ht(s.key,s.value,'missing required property "stops"')),c==="exponential"&&s.valueSpec.expression&&!vc(s.valueSpec)&&N.push(new ht(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(I&&!Bs(s.valueSpec)?N.push(new ht(s.key,s.value,"property functions not supported")):T&&!uh(s.valueSpec)&&N.push(new ht(s.key,s.value,"zoom functions not supported"))),c!=="categorical"&&!P||s.value.property!==void 0||N.push(new ht(s.key,s.value,'"property" property is required')),N;function U(J){let te=[];const he=J.value,ge=J.key;if(Mi(he)!=="array")return[new ht(ge,he,`array expected, ${Mi(he)} found`)];if(he.length!==2)return[new ht(ge,he,`array length 2 expected, length ${he.length} found`)];if(P){if(Mi(he[0])!=="object")return[new ht(ge,he,`object expected, ${Mi(he[0])} found`)];if(he[0].zoom===void 0)return[new ht(ge,he,"object stop key must have zoom")];if(he[0].value===void 0)return[new ht(ge,he,"object stop key must have value")];if(w&&w>dn(he[0].zoom))return[new ht(ge,he[0].zoom,"stop zoom values must appear in ascending order")];dn(he[0].zoom)!==w&&(w=dn(he[0].zoom),g=void 0,x={}),te=te.concat(dr({key:`${ge}[0]`,value:he[0],valueSpec:{zoom:{}},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec,objectElementValidators:{zoom:dl,value:H}}))}else te=te.concat(H({key:`${ge}[0]`,value:he[0],valueSpec:{},validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec},he));return qi(Wo(he[1]))?te.concat([new ht(`${ge}[1]`,he[1],"expressions are not allowed in function stops.")]):te.concat(J.validateSpec({key:`${ge}[1]`,value:he[1],valueSpec:n,validateSpec:J.validateSpec,style:J.style,styleSpec:J.styleSpec}))}function H(J,te){const he=Mi(J.value),ge=dn(J.value),xe=J.value!==null?J.value:te;if(f){if(he!==f)return[new ht(J.key,xe,`${he} stop domain type must match previous stop domain type ${f}`)]}else f=he;if(he!=="number"&&he!=="string"&&he!=="boolean")return[new ht(J.key,xe,"stop domain value must be a number, string, or boolean")];if(he!=="number"&&c!=="categorical"){let Fe=`number expected, ${he} found`;return Bs(n)&&c===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ht(J.key,xe,Fe)]}return c!=="categorical"||he!=="number"||isFinite(ge)&&Math.floor(ge)===ge?c!=="categorical"&&he==="number"&&g!==void 0&&ge<g?[new ht(J.key,xe,"stop domain values must appear in ascending order")]:(g=ge,c==="categorical"&&ge in x?[new ht(J.key,xe,"stop domain values must be unique")]:(x[ge]=!0,[])):[new ht(J.key,xe,`integer expected, found ${ge}`)]}}function Ho(s){const n=(s.expressionContext==="property"?dh:as)(Wo(s.value),s.valueSpec);if(n.result==="error")return n.value.map(f=>new ht(`${s.key}${f.key}`,s.value,f.message));const c=n.value.expression||n.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!c.outputDefined())return[new ht(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!da(c))return[new ht(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!da(c))return[new ht(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!fa(c,["zoom","feature-state"]))return[new ht(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ka(c))return[new ht(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Xo(s){const n=s.key,c=s.value,f=s.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(dn(c))===-1&&g.push(new ht(n,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(dn(c))===-1&&g.push(new ht(n,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),g}function Fs(s){return al(Wo(s.value))?Ho(Hn({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Tc(s)}function Tc(s){const n=s.value,c=s.key;if(Mi(n)!=="array")return[new ht(c,n,`array expected, ${Mi(n)} found`)];const f=s.styleSpec;let g,w=[];if(n.length<1)return[new ht(c,n,"filter array must have at least 1 element")];switch(w=w.concat(Xo({key:`${c}[0]`,value:n[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),dn(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&dn(n[1])==="$type"&&w.push(new ht(c,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&w.push(new ht(c,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(g=Mi(n[1]),g!=="string"&&w.push(new ht(`${c}[1]`,n[1],`string expected, ${g} found`)));for(let x=2;x<n.length;x++)g=Mi(n[x]),dn(n[1])==="$type"?w=w.concat(Xo({key:`${c}[${x}]`,value:n[x],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&w.push(new ht(`${c}[${x}]`,n[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<n.length;x++)w=w.concat(Tc({key:`${c}[${x}]`,value:n[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Mi(n[1]),n.length!==2?w.push(new ht(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="string"&&w.push(new ht(`${c}[1]`,n[1],`string expected, ${g} found`));break;case"within":g=Mi(n[1]),n.length!==2?w.push(new ht(c,n,`filter array for "${n[0]}" operator must have 2 elements`)):g!=="object"&&w.push(new ht(`${c}[1]`,n[1],`object expected, ${g} found`))}return w}function fl(s,n){const c=s.key,f=s.validateSpec,g=s.style,w=s.styleSpec,x=s.value,T=s.objectKey,I=w[`${n}_${s.layerType}`];if(!I)return[];const P=T.match(/^(.*)-transition$/);if(n==="paint"&&P&&I[P[1]]&&I[P[1]].transition)return f({key:c,value:x,valueSpec:w.transition,style:g,styleSpec:w});const N=s.valueSpec||I[T];if(!N)return[new ht(c,x,`unknown property "${T}"`)];let U;if(Mi(x)==="string"&&Bs(N)&&!N.tokens&&(U=/^{([^}]+)}$/.exec(x)))return[new ht(c,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(U[1])} }\`.`)];const H=[];return s.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&H.push(new ht(c,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&nl(Wo(x))&&dn(x.type)==="identity"&&H.push(new ht(c,x,'"text-font" does not support identity functions'))),H.concat(f({key:s.key,value:x,valueSpec:N,style:g,styleSpec:w,expressionContext:"property",propertyType:n,propertyKey:T}))}function Cc(s){return fl(s,"paint")}function Ec(s){return fl(s,"layout")}function _a(s){let n=[];const c=s.value,f=s.key,g=s.style,w=s.styleSpec;c.type||c.ref||n.push(new ht(f,c,'either "type" or "ref" is required'));let x=dn(c.type);const T=dn(c.ref);if(c.id){const I=dn(c.id);for(let P=0;P<s.arrayIndex;P++){const N=g.layers[P];dn(N.id)===I&&n.push(new ht(f,c.id,`duplicate layer id "${c.id}", previously used at line ${N.id.__line__}`))}}if("ref"in c){let I;["type","source","source-layer","filter","layout"].forEach(P=>{P in c&&n.push(new ht(f,c[P],`"${P}" is prohibited for ref layers`))}),g.layers.forEach(P=>{dn(P.id)===T&&(I=P)}),I?I.ref?n.push(new ht(f,c.ref,"ref cannot reference another ref layer")):x=dn(I.type):n.push(new ht(f,c.ref,`ref layer "${T}" not found`))}else if(x!=="background")if(c.source){const I=g.sources&&g.sources[c.source],P=I&&dn(I.type);I?P==="vector"&&x==="raster"?n.push(new ht(f,c.source,`layer "${c.id}" requires a raster source`)):P!=="raster-dem"&&x==="hillshade"?n.push(new ht(f,c.source,`layer "${c.id}" requires a raster-dem source`)):P==="raster"&&x!=="raster"?n.push(new ht(f,c.source,`layer "${c.id}" requires a vector source`)):P!=="vector"||c["source-layer"]?P==="raster-dem"&&x!=="hillshade"?n.push(new ht(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!c.paint||!c.paint["line-gradient"]||P==="geojson"&&I.lineMetrics||n.push(new ht(f,c,`layer "${c.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new ht(f,c,`layer "${c.id}" must specify a "source-layer"`)):n.push(new ht(f,c.source,`source "${c.source}" not found`))}else n.push(new ht(f,c,'missing required property "source"'));return n=n.concat(dr({key:f,value:c,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:c.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:c,objectKey:"type"}),filter:Fs,layout:I=>dr({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":P=>Ec(Hn({layerType:x},P))}}),paint:I=>dr({layer:c,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":P=>Cc(Hn({layerType:x},P))}})}})),n}function ls(s){const n=s.value,c=s.key,f=Mi(n);return f!=="string"?[new ht(c,n,`string expected, ${f} found`)]:[]}const vh={promoteId:function({key:s,value:n}){if(Mi(n)==="string")return ls({key:s,value:n});{const c=[];for(const f in n)c.push(...ls({key:`${s}.${f}`,value:n[f]}));return c}}};function bh(s){const n=s.value,c=s.key,f=s.styleSpec,g=s.style,w=s.validateSpec;if(!n.type)return[new ht(c,n,'"type" is required')];const x=dn(n.type);let T;switch(x){case"vector":case"raster":return T=dr({key:c,value:n,valueSpec:f[`source_${x.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:vh,validateSpec:w}),T;case"raster-dem":return T=function(I){var P;const N=(P=I.sourceName)!==null&&P!==void 0?P:"",U=I.value,H=I.styleSpec,J=H.source_raster_dem,te=I.style;let he=[];const ge=Mi(U);if(U===void 0)return he;if(ge!=="object")return he.push(new ht("source_raster_dem",U,`object expected, ${ge} found`)),he;const xe=dn(U.encoding)==="custom",Fe=["redFactor","greenFactor","blueFactor","baseShift"],Te=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const De in U)!xe&&Fe.includes(De)?he.push(new ht(De,U[De],`In "${N}": "${De}" is only valid when "encoding" is set to "custom". ${Te} encoding found`)):J[De]?he=he.concat(I.validateSpec({key:De,value:U[De],valueSpec:J[De],validateSpec:I.validateSpec,style:te,styleSpec:H})):he.push(new ht(De,U[De],`unknown property "${De}"`));return he}({sourceName:c,value:n,style:s.style,styleSpec:f,validateSpec:w}),T;case"geojson":if(T=dr({key:c,value:n,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:w,objectElementValidators:vh}),n.cluster)for(const I in n.clusterProperties){const[P,N]=n.clusterProperties[I],U=typeof P=="string"?[P,["accumulated"],["get",I]]:P;T.push(...Ho({key:`${c}.${I}.map`,value:N,validateSpec:w,expressionContext:"cluster-map"})),T.push(...Ho({key:`${c}.${I}.reduce`,value:U,validateSpec:w,expressionContext:"cluster-reduce"}))}return T;case"video":return dr({key:c,value:n,valueSpec:f.source_video,style:g,validateSpec:w,styleSpec:f});case"image":return dr({key:c,value:n,valueSpec:f.source_image,style:g,validateSpec:w,styleSpec:f});case"canvas":return[new ht(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Xo({key:`${c}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:w,styleSpec:f})}}function wh(s){const n=s.value,c=s.styleSpec,f=c.light,g=s.style;let w=[];const x=Mi(n);if(n===void 0)return w;if(x!=="object")return w=w.concat([new ht("light",n,`object expected, ${x} found`)]),w;for(const T in n){const I=T.match(/^(.*)-transition$/);w=w.concat(I&&f[I[1]]&&f[I[1]].transition?s.validateSpec({key:T,value:n[T],valueSpec:c.transition,validateSpec:s.validateSpec,style:g,styleSpec:c}):f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new ht(T,n[T],`unknown property "${T}"`)])}return w}function xh(s){const n=s.value,c=s.styleSpec,f=c.sky,g=s.style,w=Mi(n);if(n===void 0)return[];if(w!=="object")return[new ht("sky",n,`object expected, ${w} found`)];let x=[];for(const T in n)x=x.concat(f[T]?go({key:T,value:n[T],valueSpec:f[T],style:g,styleSpec:c}):[new ht(T,n[T],`unknown property "${T}"`)]);return x}function ya(s){const n=s.value,c=s.styleSpec,f=c.terrain,g=s.style;let w=[];const x=Mi(n);if(n===void 0)return w;if(x!=="object")return w=w.concat([new ht("terrain",n,`object expected, ${x} found`)]),w;for(const T in n)w=w.concat(f[T]?s.validateSpec({key:T,value:n[T],valueSpec:f[T],validateSpec:s.validateSpec,style:g,styleSpec:c}):[new ht(T,n[T],`unknown property "${T}"`)]);return w}function va(s){let n=[];const c=s.value,f=s.key;if(Array.isArray(c)){const g=[],w=[];for(const x in c)c[x].id&&g.includes(c[x].id)&&n.push(new ht(f,c,`all the sprites' ids must be unique, but ${c[x].id} is duplicated`)),g.push(c[x].id),c[x].url&&w.includes(c[x].url)&&n.push(new ht(f,c,`all the sprites' URLs must be unique, but ${c[x].url} is duplicated`)),w.push(c[x].url),n=n.concat(dr({key:`${f}[${x}]`,value:c[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return n}return ls({key:f,value:c})}const xr={"*":()=>[],array:Sc,boolean:function(s){const n=s.value,c=s.key,f=Mi(n);return f!=="boolean"?[new ht(c,n,`boolean expected, ${f} found`)]:[]},number:dl,color:function(s){const n=s.key,c=s.value,f=Mi(c);return f!=="string"?[new ht(n,c,`color expected, ${f} found`)]:zi.parse(String(c))?[]:[new ht(n,c,`color expected, "${c}" found`)]},constants:_h,enum:Xo,filter:Fs,function:yh,layer:_a,object:dr,source:bh,light:wh,sky:xh,terrain:ya,string:ls,formatted:function(s){return ls(s).length===0?[]:Ho(s)},resolvedImage:function(s){return ls(s).length===0?[]:Ho(s)},padding:function(s){const n=s.key,c=s.value;if(Mi(c)==="array"){if(c.length<1||c.length>4)return[new ht(n,c,`padding requires 1 to 4 values; ${c.length} values found`)];const f={type:"number"};let g=[];for(let w=0;w<c.length;w++)g=g.concat(s.validateSpec({key:`${n}[${w}]`,value:c[w],validateSpec:s.validateSpec,valueSpec:f}));return g}return dl({key:n,value:c,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const n=s.key,c=s.value,f=Mi(c),g=s.styleSpec;if(f!=="array"||c.length<1||c.length%2!=0)return[new ht(n,c,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let x=0;x<c.length;x+=2)w=w.concat(Xo({key:`${n}[${x}]`,value:c[x],valueSpec:g.layout_symbol["text-anchor"]})),w=w.concat(Sc({key:`${n}[${x+1}]`,value:c[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return w},sprite:va};function go(s){const n=s.value,c=s.valueSpec,f=s.styleSpec;return s.validateSpec=go,c.expression&&nl(dn(n))?yh(s):c.expression&&qi(Wo(n))?Ho(s):c.type&&xr[c.type]?xr[c.type](s):dr(Hn({},s,{valueSpec:c.type?f[c.type]:c}))}function Mc(s){const n=s.value,c=s.key,f=ls(s);return f.length||(n.indexOf("{fontstack}")===-1&&f.push(new ht(c,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&f.push(new ht(c,n,'"glyphs" url must include a "{range}" token'))),f}function io(s,n=we){let c=[];return c=c.concat(go({key:"",value:s,valueSpec:n.$root,styleSpec:n,style:s,validateSpec:go,objectElementValidators:{glyphs:Mc,"*":()=>[]}})),s.constants&&(c=c.concat(_h({key:"constants",value:s.constants,style:s,styleSpec:n,validateSpec:go}))),Os(c)}function _o(s){return function(n){return s({...n,validateSpec:go})}}function Os(s){return[].concat(s).sort((n,c)=>n.line-c.line)}function no(s){return function(...n){return Os(s.apply(this,n))}}io.source=no(_o(bh)),io.sprite=no(_o(va)),io.glyphs=no(_o(Mc)),io.light=no(_o(wh)),io.sky=no(_o(xh)),io.terrain=no(_o(ya)),io.layer=no(_o(_a)),io.filter=no(_o(Fs)),io.paintProperty=no(_o(Cc)),io.layoutProperty=no(_o(Ec));const cs=io,ef=cs.light,Ic=cs.paintProperty,tf=cs.layoutProperty;function Ns(s,n){let c=!1;if(n&&n.length)for(const f of n)s.fire(new ot(new Error(f.message))),c=!0;return c}class ba{constructor(n,c,f){const g=this.cells=[];if(n instanceof ArrayBuffer){this.arrayBuffer=n;const x=new Int32Array(this.arrayBuffer);n=x[0],this.d=(c=x[1])+2*(f=x[2]);for(let I=0;I<this.d*this.d;I++){const P=x[3+I],N=x[3+I+1];g.push(P===N?null:x.subarray(P,N))}const T=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],T),this.bboxes=x.subarray(T),this.insert=this._insertReadonly}else{this.d=c+2*f;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=c,this.extent=n,this.padding=f,this.scale=c/n,this.uid=0;const w=f/c*n;this.min=-w,this.max=n+w}insert(n,c,f,g,w){this._forEachCell(c,f,g,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(n),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(n,c,f,g,w,x){this.cells[w].push(x)}query(n,c,f,g,w){const x=this.min,T=this.max;if(n<=x&&c<=x&&T<=f&&T<=g&&!w)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(n,c,f,g,this._queryCell,I,{},w),I}}_queryCell(n,c,f,g,w,x,T,I){const P=this.cells[w];if(P!==null){const N=this.keys,U=this.bboxes;for(let H=0;H<P.length;H++){const J=P[H];if(T[J]===void 0){const te=4*J;(I?I(U[te+0],U[te+1],U[te+2],U[te+3]):n<=U[te+2]&&c<=U[te+3]&&f>=U[te+0]&&g>=U[te+1])?(T[J]=!0,x.push(N[J])):T[J]=!1}}}}_forEachCell(n,c,f,g,w,x,T,I){const P=this._convertToCellCoord(n),N=this._convertToCellCoord(c),U=this._convertToCellCoord(f),H=this._convertToCellCoord(g);for(let J=P;J<=U;J++)for(let te=N;te<=H;te++){const he=this.d*te+J;if((!I||I(this._convertFromCellCoord(J),this._convertFromCellCoord(te),this._convertFromCellCoord(J+1),this._convertFromCellCoord(te+1)))&&w.call(this,n,c,f,g,he,x,T,I))return}}_convertFromCellCoord(n){return(n-this.padding)/this.scale}_convertToCellCoord(n){return Math.max(0,Math.min(this.d-1,Math.floor(n*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const n=this.cells,c=3+this.cells.length+1+1;let f=0;for(let x=0;x<this.cells.length;x++)f+=this.cells[x].length;const g=new Int32Array(c+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let w=c;for(let x=0;x<n.length;x++){const T=n[x];g[3+x]=w,g.set(T,w),w+=T.length}return g[3+n.length]=w,g.set(this.keys,w),w+=this.keys.length,g[3+n.length+1]=w,g.set(this.bboxes,w),w+=this.bboxes.length,g.buffer}static serialize(n,c){const f=n.toArrayBuffer();return c&&c.push(f),{buffer:f}}static deserialize(n){return new ba(n.buffer)}}const yo={};function Pt(s,n,c={}){if(yo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(n,"_classRegistryKey",{value:s,writeable:!1}),yo[s]={klass:n,omit:c.omit||[],shallow:c.shallow||[]}}Pt("Object",Object),Pt("TransferableGridIndex",ba),Pt("Color",zi),Pt("Error",Error),Pt("AJAXError",ki),Pt("ResolvedImage",Xr),Pt("StylePropertyFunction",ol),Pt("StyleExpression",Gi,{omit:["_evaluator"]}),Pt("ZoomDependentExpression",wc),Pt("ZoomConstantExpression",rl),Pt("CompoundExpression",Rr,{omit:["_evaluate"]});for(const s in Ds)Ds[s]._classRegistryKey||Pt(`Expression_${s}`,Ds[s]);function pl(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function js(s,n){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(pl(s)||at(s))return n&&n.push(s),s;if(ArrayBuffer.isView(s)){const c=s;return n&&n.push(c.buffer),c}if(s instanceof ImageData)return n&&n.push(s.data.buffer),s;if(Array.isArray(s)){const c=[];for(const f of s)c.push(js(f,n));return c}if(typeof s=="object"){const c=s.constructor,f=c._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${c.name}`);if(!yo[f])throw new Error(`${f} is not registered.`);const g=c.serialize?c.serialize(s,n):{};if(c.serialize){if(n&&g===n[n.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in s){if(!s.hasOwnProperty(w)||yo[f].omit.indexOf(w)>=0)continue;const x=s[w];g[w]=yo[f].shallow.indexOf(w)>=0?x:js(x,n)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof s)}function Us(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||pl(s)||at(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Us);if(typeof s=="object"){const n=s.$name||"Object";if(!yo[n])throw new Error(`can't deserialize unregistered class ${n}`);const{klass:c}=yo[n];if(!c)throw new Error(`can't deserialize unregistered class ${n}`);if(c.deserialize)return c.deserialize(s);const f=Object.create(c.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const w=s[g];f[g]=yo[n].shallow.indexOf(g)>=0?w:Us(w)}return f}throw new Error("can't deserialize object of type "+typeof s)}class kh{constructor(){this.first=!0}update(n,c){const f=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=c):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=c),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=f,!0))}}const Ct={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Vs(s){for(const n of s)if(ml(n.charCodeAt(0)))return!0;return!1}function Sh(s){for(const n of s)if(!Th(n.charCodeAt(0)))return!1;return!0}function Th(s){return!(Ct.Arabic(s)||Ct["Arabic Supplement"](s)||Ct["Arabic Extended-A"](s)||Ct["Arabic Presentation Forms-A"](s)||Ct["Arabic Presentation Forms-B"](s))}function ml(s){return!(s!==746&&s!==747&&(s<4352||!(Ct["Bopomofo Extended"](s)||Ct.Bopomofo(s)||Ct["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||Ct["CJK Compatibility Ideographs"](s)||Ct["CJK Compatibility"](s)||Ct["CJK Radicals Supplement"](s)||Ct["CJK Strokes"](s)||!(!Ct["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Ct["CJK Unified Ideographs Extension A"](s)||Ct["CJK Unified Ideographs"](s)||Ct["Enclosed CJK Letters and Months"](s)||Ct["Hangul Compatibility Jamo"](s)||Ct["Hangul Jamo Extended-A"](s)||Ct["Hangul Jamo Extended-B"](s)||Ct["Hangul Jamo"](s)||Ct["Hangul Syllables"](s)||Ct.Hiragana(s)||Ct["Ideographic Description Characters"](s)||Ct.Kanbun(s)||Ct["Kangxi Radicals"](s)||Ct["Katakana Phonetic Extensions"](s)||Ct.Katakana(s)&&s!==12540||!(!Ct["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Ct["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||Ct["Unified Canadian Aboriginal Syllabics"](s)||Ct["Unified Canadian Aboriginal Syllabics Extended"](s)||Ct["Vertical Forms"](s)||Ct["Yijing Hexagram Symbols"](s)||Ct["Yi Syllables"](s)||Ct["Yi Radicals"](s))))}function Lc(s){return!(ml(s)||function(n){return!!(Ct["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||Ct["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||Ct["Letterlike Symbols"](n)||Ct["Number Forms"](n)||Ct["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||Ct["Control Pictures"](n)&&n!==9251||Ct["Optical Character Recognition"](n)||Ct["Enclosed Alphanumerics"](n)||Ct["Geometric Shapes"](n)||Ct["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||Ct["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Ct["CJK Symbols and Punctuation"](n)||Ct.Katakana(n)||Ct["Private Use Area"](n)||Ct["CJK Compatibility Forms"](n)||Ct["Small Form Variants"](n)||Ct["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(s))}function gl(s){return s>=1424&&s<=2303||Ct["Arabic Presentation Forms-A"](s)||Ct["Arabic Presentation Forms-B"](s)}function Ch(s,n){return!(!n&&gl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||Ct.Khmer(s))}function nf(s){for(const n of s)if(gl(n.charCodeAt(0)))return!0;return!1}const Ko=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Qi{constructor(n,c){this.zoom=n,c?(this.now=c.now,this.fadeDuration=c.fadeDuration,this.zoomHistory=c.zoomHistory,this.transition=c.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new kh,this.transition={})}isSupportedScript(n){return function(c,f){for(const g of c)if(!Ch(g.charCodeAt(0),f))return!1;return!0}(n,Ko.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,c=n-Math.floor(n),f=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:c+(1-c)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*c}}}class wa{constructor(n,c){this.property=n,this.value=c,this.expression=function(f,g){if(nl(f))return new ol(f,g);if(qi(f)){const w=dh(f,g);if(w.result==="error")throw new Error(w.value.map(x=>`${x.key}: ${x.message}`).join(", "));return w.value}{let w=f;return g.type==="color"&&typeof f=="string"?w=zi.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=Hr.parse(f)):w=wr.parse(f),{kind:"constant",evaluate:()=>w}}}(c===void 0?n.specification.default:c,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,c,f){return this.property.possiblyEvaluate(this,n,c,f)}}class _l{constructor(n){this.property=n,this.value=new wa(n,void 0)}transitioned(n,c){return new Eh(this.property,this.value,c,Z({},n.transition,this.transition),n.now)}untransitioned(){return new Eh(this.property,this.value,null,{},0)}}class Ac{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return ne(this._values[n].value.value)}setValue(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new _l(this._values[n].property)),this._values[n].value=new wa(this._values[n].property,c===null?void 0:ne(c))}getTransition(n){return ne(this._values[n].transition)}setTransition(n,c){Object.prototype.hasOwnProperty.call(this._values,n)||(this._values[n]=new _l(this._values[n].property)),this._values[n].transition=ne(c)||void 0}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f);const g=this.getTransition(c);g!==void 0&&(n[`${c}-transition`]=g)}return n}transitioned(n,c){const f=new Mh(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(n,c._values[g]);return f}untransitioned(){const n=new Mh(this._properties);for(const c of Object.keys(this._values))n._values[c]=this._values[c].untransitioned();return n}}class Eh{constructor(n,c,f,g,w){this.property=n,this.value=c,this.begin=w+g.delay||0,this.end=this.begin+g.duration||0,n.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(n,c,f){const g=n.now||0,w=this.value.possiblyEvaluate(n,c,f),x=this.prior;if(x){if(g>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(g<this.begin)return x.possiblyEvaluate(n,c,f);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(n,c,f),w,function(I){if(I<=0)return 0;if(I>=1)return 1;const P=I*I,N=P*I;return 4*(I<.5?N:3*(I-P)+N-.75)}(T))}}return w}}class Mh{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,c,f){const g=new xa(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(n,c,f);return g}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class Ih{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}hasValue(n){return this._values[n].value!==void 0}getValue(n){return ne(this._values[n].value)}setValue(n,c){this._values[n]=new wa(this._values[n].property,c===null?void 0:ne(c))}serialize(){const n={};for(const c of Object.keys(this._values)){const f=this.getValue(c);f!==void 0&&(n[c]=f)}return n}possiblyEvaluate(n,c,f){const g=new xa(this._properties);for(const w of Object.keys(this._values))g._values[w]=this._values[w].possiblyEvaluate(n,c,f);return g}}class ro{constructor(n,c,f){this.property=n,this.value=c,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,c,f,g){return this.property.evaluate(this.value,this.parameters,n,c,f,g)}}class xa{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Ut{constructor(n){this.specification=n}possiblyEvaluate(n,c){if(n.isDataDriven())throw new Error("Value should not be data driven");return n.expression.evaluate(c)}interpolate(n,c,f){const g=hr[this.specification.type];return g?g(n,c,f):n}}class Wt{constructor(n,c){this.specification=n,this.overrides=c}possiblyEvaluate(n,c,f,g){return new ro(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(c,null,{},f,g)}:n.expression,c)}interpolate(n,c,f){if(n.value.kind!=="constant"||c.value.kind!=="constant")return n;if(n.value.value===void 0||c.value.value===void 0)return new ro(this,{kind:"constant",value:void 0},n.parameters);const g=hr[this.specification.type];if(g){const w=g(n.value.value,c.value.value,f);return new ro(this,{kind:"constant",value:w},n.parameters)}return n}evaluate(n,c,f,g,w,x){return n.kind==="constant"?n.value:n.evaluate(c,f,g,w,x)}}class yl extends Wt{possiblyEvaluate(n,c,f,g){if(n.value===void 0)return new ro(this,{kind:"constant",value:void 0},c);if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,g),x=n.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,T=this._calculate(x,x,x,c);return new ro(this,{kind:"constant",value:T},c)}if(n.expression.kind==="camera"){const w=this._calculate(n.expression.evaluate({zoom:c.zoom-1}),n.expression.evaluate({zoom:c.zoom}),n.expression.evaluate({zoom:c.zoom+1}),c);return new ro(this,{kind:"constant",value:w},c)}return new ro(this,n.expression,c)}evaluate(n,c,f,g,w,x){if(n.kind==="source"){const T=n.evaluate(c,f,g,w,x);return this._calculate(T,T,T,c)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(c.zoom)-1},f,g),n.evaluate({zoom:Math.floor(c.zoom)},f,g),n.evaluate({zoom:Math.floor(c.zoom)+1},f,g),c):n.value}_calculate(n,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class ka{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,g){if(n.value!==void 0){if(n.expression.kind==="constant"){const w=n.expression.evaluate(c,null,{},f,g);return this._calculate(w,w,w,c)}return this._calculate(n.expression.evaluate(new Qi(Math.floor(c.zoom-1),c)),n.expression.evaluate(new Qi(Math.floor(c.zoom),c)),n.expression.evaluate(new Qi(Math.floor(c.zoom+1),c)),c)}}_calculate(n,c,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:n,to:c}:{from:f,to:c}}interpolate(n){return n}}class Pc{constructor(n){this.specification=n}possiblyEvaluate(n,c,f,g){return!!n.expression.evaluate(c,null,{},f,g)}interpolate(){return!1}}class kr{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const c in n){const f=n[c];f.specification.overridable&&this.overridableProperties.push(c);const g=this.defaultPropertyValues[c]=new wa(f,void 0),w=this.defaultTransitionablePropertyValues[c]=new _l(f);this.defaultTransitioningPropertyValues[c]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[c]=g.possiblyEvaluate({})}}}Pt("DataDrivenProperty",Wt),Pt("DataConstantProperty",Ut),Pt("CrossFadedDataDrivenProperty",yl),Pt("CrossFadedProperty",ka),Pt("ColorRampProperty",Pc);const zc="-transition";class oo extends kt{constructor(n,c){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1},n.type!=="custom"&&(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),c.layout&&(this._unevaluatedLayout=new Ih(c.layout)),c.paint)){this._transitionablePaint=new Ac(c.paint);for(const f in n.paint)this.setPaintProperty(f,n.paint[f],{validate:!1});for(const f in n.layout)this.setLayoutProperty(f,n.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xa(c.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,c,f={}){c!=null&&this._validate(tf,`layers.${this.id}.layout.${n}`,n,c,f)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,c):this.visibility=c)}getPaintProperty(n){return n.endsWith(zc)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,c,f={}){if(c!=null&&this._validate(Ic,`layers.${this.id}.paint.${n}`,n,c,f))return!1;if(n.endsWith(zc))return this._transitionablePaint.setTransition(n.slice(0,-11),c||void 0),!1;{const g=this._transitionablePaint._values[n],w=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(n,c),this._handleSpecialPaintPropertyUpdate(n);const I=this._transitionablePaint._values[n].value;return I.isDataDriven()||x||w||this._handleOverridablePaintPropertyUpdate(n,T,I)}}_handleSpecialPaintPropertyUpdate(n){}_handleOverridablePaintPropertyUpdate(n,c,f){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,c){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,c)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,c)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),Oe(n,(c,f)=>!(c===void 0||f==="layout"&&!Object.keys(c).length||f==="paint"&&!Object.keys(c).length))}_validate(n,c,f,g,w={}){return(!w||w.validate!==!1)&&Ns(this,n.call(cs,{key:c,layerType:this.type,objectKey:f,value:g,styleSpec:we,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const c=this.paint.get(n);if(c instanceof ro&&Bs(c.property.specification)&&(c.value.kind==="source"||c.value.kind==="composite")&&c.value.isStateDependent)return!0}return!1}}const Lh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Sa{constructor(n,c){this._structArray=n,this._pos1=c*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,c){return n._trim(),c&&(n.isTransferred=!0,c.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const c=Object.create(this.prototype);return c.arrayBuffer=n.arrayBuffer,c.length=n.length,c.capacity=n.arrayBuffer.byteLength/c.bytesPerElement,c._refreshViews(),c}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const c=this.uint8;this._refreshViews(),c&&this.uint8.set(c)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function kn(s,n=1){let c=0,f=0;return{members:s.map(g=>{const w=Lh[g.type].BYTES_PER_ELEMENT,x=c=Ah(c,Math.max(n,w)),T=g.components||1;return f=Math.max(f,w),c+=w*T,{name:g.name,type:g.type,components:T,offset:x}}),size:Ah(c,Math.max(f,n)),alignment:n}}function Ah(s,n){return Math.ceil(s/n)*n}class Ta extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const g=2*n;return this.int16[g+0]=c,this.int16[g+1]=f,n}}Ta.prototype.bytesPerElement=4,Pt("StructArrayLayout2i4",Ta);class Po extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.int16[w+0]=c,this.int16[w+1]=f,this.int16[w+2]=g,n}}Po.prototype.bytesPerElement=6,Pt("StructArrayLayout3i6",Po);class Dc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,g)}emplace(n,c,f,g,w){const x=4*n;return this.int16[x+0]=c,this.int16[x+1]=f,this.int16[x+2]=g,this.int16[x+3]=w,n}}Dc.prototype.bytesPerElement=8,Pt("StructArrayLayout4i8",Dc);class Rc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,g,w,x)}emplace(n,c,f,g,w,x,T){const I=6*n;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=w,this.int16[I+4]=x,this.int16[I+5]=T,n}}Rc.prototype.bytesPerElement=12,Pt("StructArrayLayout2i4i12",Rc);class Bc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,g,w,x)}emplace(n,c,f,g,w,x,T){const I=4*n,P=8*n;return this.int16[I+0]=c,this.int16[I+1]=f,this.uint8[P+4]=g,this.uint8[P+5]=w,this.uint8[P+6]=x,this.uint8[P+7]=T,n}}Bc.prototype.bytesPerElement=8,Pt("StructArrayLayout2i4ub8",Bc);class Ca extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const g=2*n;return this.float32[g+0]=c,this.float32[g+1]=f,n}}Ca.prototype.bytesPerElement=8,Pt("StructArrayLayout2f8",Ca);class vl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,P,N){const U=this.length;return this.resize(U+1),this.emplace(U,n,c,f,g,w,x,T,I,P,N)}emplace(n,c,f,g,w,x,T,I,P,N,U){const H=10*n;return this.uint16[H+0]=c,this.uint16[H+1]=f,this.uint16[H+2]=g,this.uint16[H+3]=w,this.uint16[H+4]=x,this.uint16[H+5]=T,this.uint16[H+6]=I,this.uint16[H+7]=P,this.uint16[H+8]=N,this.uint16[H+9]=U,n}}vl.prototype.bytesPerElement=20,Pt("StructArrayLayout10ui20",vl);class Fc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,P,N,U,H){const J=this.length;return this.resize(J+1),this.emplace(J,n,c,f,g,w,x,T,I,P,N,U,H)}emplace(n,c,f,g,w,x,T,I,P,N,U,H,J){const te=12*n;return this.int16[te+0]=c,this.int16[te+1]=f,this.int16[te+2]=g,this.int16[te+3]=w,this.uint16[te+4]=x,this.uint16[te+5]=T,this.uint16[te+6]=I,this.uint16[te+7]=P,this.int16[te+8]=N,this.int16[te+9]=U,this.int16[te+10]=H,this.int16[te+11]=J,n}}Fc.prototype.bytesPerElement=24,Pt("StructArrayLayout4i4ui4i24",Fc);class Oc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.float32[w+0]=c,this.float32[w+1]=f,this.float32[w+2]=g,n}}Oc.prototype.bytesPerElement=12,Pt("StructArrayLayout3f12",Oc);class zo extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint32[1*n+0]=c,n}}zo.prototype.bytesPerElement=4,Pt("StructArrayLayout1ul4",zo);class bl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,P){const N=this.length;return this.resize(N+1),this.emplace(N,n,c,f,g,w,x,T,I,P)}emplace(n,c,f,g,w,x,T,I,P,N){const U=10*n,H=5*n;return this.int16[U+0]=c,this.int16[U+1]=f,this.int16[U+2]=g,this.int16[U+3]=w,this.int16[U+4]=x,this.int16[U+5]=T,this.uint32[H+3]=I,this.uint16[U+8]=P,this.uint16[U+9]=N,n}}bl.prototype.bytesPerElement=20,Pt("StructArrayLayout6i1ul2ui20",bl);class Ea extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x){const T=this.length;return this.resize(T+1),this.emplace(T,n,c,f,g,w,x)}emplace(n,c,f,g,w,x,T){const I=6*n;return this.int16[I+0]=c,this.int16[I+1]=f,this.int16[I+2]=g,this.int16[I+3]=w,this.int16[I+4]=x,this.int16[I+5]=T,n}}Ea.prototype.bytesPerElement=12,Pt("StructArrayLayout2i2i2i12",Ea);class wl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w){const x=this.length;return this.resize(x+1),this.emplace(x,n,c,f,g,w)}emplace(n,c,f,g,w,x){const T=4*n,I=8*n;return this.float32[T+0]=c,this.float32[T+1]=f,this.float32[T+2]=g,this.int16[I+6]=w,this.int16[I+7]=x,n}}wl.prototype.bytesPerElement=16,Pt("StructArrayLayout2f1f2i16",wl);class Ma extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,g)}emplace(n,c,f,g,w){const x=12*n,T=3*n;return this.uint8[x+0]=c,this.uint8[x+1]=f,this.float32[T+1]=g,this.float32[T+2]=w,n}}Ma.prototype.bytesPerElement=12,Pt("StructArrayLayout2ub2f12",Ma);class xl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.uint16[w+0]=c,this.uint16[w+1]=f,this.uint16[w+2]=g,n}}xl.prototype.bytesPerElement=6,Pt("StructArrayLayout3ui6",xl);class $s extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,P,N,U,H,J,te,he,ge,xe){const Fe=this.length;return this.resize(Fe+1),this.emplace(Fe,n,c,f,g,w,x,T,I,P,N,U,H,J,te,he,ge,xe)}emplace(n,c,f,g,w,x,T,I,P,N,U,H,J,te,he,ge,xe,Fe){const Te=24*n,De=12*n,Qe=48*n;return this.int16[Te+0]=c,this.int16[Te+1]=f,this.uint16[Te+2]=g,this.uint16[Te+3]=w,this.uint32[De+2]=x,this.uint32[De+3]=T,this.uint32[De+4]=I,this.uint16[Te+10]=P,this.uint16[Te+11]=N,this.uint16[Te+12]=U,this.float32[De+7]=H,this.float32[De+8]=J,this.uint8[Qe+36]=te,this.uint8[Qe+37]=he,this.uint8[Qe+38]=ge,this.uint32[De+10]=xe,this.int16[Te+22]=Fe,n}}$s.prototype.bytesPerElement=48,Pt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$s);class us extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g,w,x,T,I,P,N,U,H,J,te,he,ge,xe,Fe,Te,De,Qe,tt,Mt,Ot,Et,wt,mt,Dt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,n,c,f,g,w,x,T,I,P,N,U,H,J,te,he,ge,xe,Fe,Te,De,Qe,tt,Mt,Ot,Et,wt,mt,Dt)}emplace(n,c,f,g,w,x,T,I,P,N,U,H,J,te,he,ge,xe,Fe,Te,De,Qe,tt,Mt,Ot,Et,wt,mt,Dt,vt){const ct=32*n,Gt=16*n;return this.int16[ct+0]=c,this.int16[ct+1]=f,this.int16[ct+2]=g,this.int16[ct+3]=w,this.int16[ct+4]=x,this.int16[ct+5]=T,this.int16[ct+6]=I,this.int16[ct+7]=P,this.uint16[ct+8]=N,this.uint16[ct+9]=U,this.uint16[ct+10]=H,this.uint16[ct+11]=J,this.uint16[ct+12]=te,this.uint16[ct+13]=he,this.uint16[ct+14]=ge,this.uint16[ct+15]=xe,this.uint16[ct+16]=Fe,this.uint16[ct+17]=Te,this.uint16[ct+18]=De,this.uint16[ct+19]=Qe,this.uint16[ct+20]=tt,this.uint16[ct+21]=Mt,this.uint16[ct+22]=Ot,this.uint32[Gt+12]=Et,this.float32[Gt+13]=wt,this.float32[Gt+14]=mt,this.uint16[ct+30]=Dt,this.uint16[ct+31]=vt,n}}us.prototype.bytesPerElement=64,Pt("StructArrayLayout8i15ui1ul2f2ui64",us);class kl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.float32[1*n+0]=c,n}}kl.prototype.bytesPerElement=4,Pt("StructArrayLayout1f4",kl);class Sl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=3*n;return this.uint16[6*n+0]=c,this.float32[w+1]=f,this.float32[w+2]=g,n}}Sl.prototype.bytesPerElement=12,Pt("StructArrayLayout1ui2f12",Sl);class hs extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c,f){const g=this.length;return this.resize(g+1),this.emplace(g,n,c,f)}emplace(n,c,f,g){const w=4*n;return this.uint32[2*n+0]=c,this.uint16[w+2]=f,this.uint16[w+3]=g,n}}hs.prototype.bytesPerElement=8,Pt("StructArrayLayout1ul2ui8",hs);class Nc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,c){const f=this.length;return this.resize(f+1),this.emplace(f,n,c)}emplace(n,c,f){const g=2*n;return this.uint16[g+0]=c,this.uint16[g+1]=f,n}}Nc.prototype.bytesPerElement=4,Pt("StructArrayLayout2ui4",Nc);class jc extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const c=this.length;return this.resize(c+1),this.emplace(c,n)}emplace(n,c){return this.uint16[1*n+0]=c,n}}jc.prototype.bytesPerElement=2,Pt("StructArrayLayout1ui2",jc);class Tl extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,c,f,g){const w=this.length;return this.resize(w+1),this.emplace(w,n,c,f,g)}emplace(n,c,f,g,w){const x=4*n;return this.float32[x+0]=c,this.float32[x+1]=f,this.float32[x+2]=g,this.float32[x+3]=w,n}}Tl.prototype.bytesPerElement=16,Pt("StructArrayLayout4f16",Tl);class Ph extends Sa{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new S(this.anchorPointX,this.anchorPointY)}}Ph.prototype.size=20;class y extends bl{get(n){return new Ph(this,n)}}Pt("CollisionBoxArray",y);class r extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(n){this._structArray.uint8[this._pos1+37]=n}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(n){this._structArray.uint8[this._pos1+38]=n}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(n){this._structArray.uint32[this._pos4+10]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}r.prototype.size=48;class h extends $s{get(n){return new r(this,n)}}Pt("PlacedSymbolArray",h);class p extends Sa{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(n){this._structArray.uint32[this._pos4+12]=n}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}p.prototype.size=64;class m extends us{get(n){return new p(this,n)}}Pt("SymbolInstanceArray",m);class b extends kl{getoffsetX(n){return this.float32[1*n+0]}}Pt("GlyphOffsetArray",b);class C extends Po{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}Pt("SymbolLineVertexArray",C);class M extends Sa{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}M.prototype.size=12;class L extends Sl{get(n){return new M(this,n)}}Pt("TextAnchorOffsetArray",L);class F extends Sa{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}F.prototype.size=8;class $ extends hs{get(n){return new F(this,n)}}Pt("FeatureIndexArray",$);class q extends Ta{}class ee extends Ta{}class pe extends Ta{}class fe extends Rc{}class _e extends Bc{}class ue extends Ca{}class Ce extends vl{}class qe extends Fc{}class be extends Oc{}class Re extends zo{}class Ge extends Ea{}class He extends Ma{}class Ke extends xl{}class nt extends Nc{}const it=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:ft}=it;class _t{constructor(n=[]){this.segments=n}prepareSegment(n,c,f,g){let w=this.segments[this.segments.length-1];return n>_t.MAX_VERTEX_ARRAY_LENGTH&&Je(`Max vertices per segment is ${_t.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!w||w.vertexLength+n>_t.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==g)&&(w={vertexOffset:c.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(w.sortKey=g),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const n of this.segments)for(const c in n.vaos)n.vaos[c].destroy()}static simpleSegment(n,c,f,g){return new _t([{vertexOffset:n,primitiveOffset:c,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function oi(s,n){return 256*(s=se(Math.floor(s),0,255))+se(Math.floor(n),0,255)}_t.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Pt("SegmentVector",_t);const yt=kn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Jt={exports:{}},si={exports:{}};si.exports=function(s,n){var c,f,g,w,x,T,I,P;for(f=s.length-(c=3&s.length),g=n,x=3432918353,T=461845907,P=0;P<f;)I=255&s.charCodeAt(P)|(255&s.charCodeAt(++P))<<8|(255&s.charCodeAt(++P))<<16|(255&s.charCodeAt(++P))<<24,++P,g=27492+(65535&(w=5*(65535&(g=(g^=I=(65535&(I=(I=(65535&I)*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(I=0,c){case 3:I^=(255&s.charCodeAt(P+2))<<16;case 2:I^=(255&s.charCodeAt(P+1))<<8;case 1:g^=I=(65535&(I=(I=(65535&(I^=255&s.charCodeAt(P)))*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Ti=si.exports,ei={exports:{}};ei.exports=function(s,n){for(var c,f=s.length,g=n^f,w=0;f>=4;)c=1540483477*(65535&(c=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:g^=(255&s.charCodeAt(w+2))<<16;case 2:g^=(255&s.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var ci=Ti,pi=ei.exports;Jt.exports=ci,Jt.exports.murmur3=ci,Jt.exports.murmur2=pi;var pn=_(Jt.exports);class Ri{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,c,f,g){this.ids.push(Br(n)),this.positions.push(c,f,g)}getPositions(n){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const c=Br(n);let f=0,g=this.ids.length-1;for(;f<g;){const x=f+g>>1;this.ids[x]>=c?g=x:f=x+1}const w=[];for(;this.ids[f]===c;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(n,c){const f=new Float64Array(n.ids),g=new Uint32Array(n.positions);return Nn(f,g,0,f.length-1),c&&c.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(n){const c=new Ri;return c.ids=n.ids,c.positions=n.positions,c.indexed=!0,c}}function Br(s){const n=+s;return!isNaN(n)&&n<=Number.MAX_SAFE_INTEGER?n:pn(String(s))}function Nn(s,n,c,f){for(;c<f;){const g=s[c+f>>1];let w=c-1,x=f+1;for(;;){do w++;while(s[w]<g);do x--;while(s[x]>g);if(w>=x)break;an(s,w,x),an(n,3*w,3*x),an(n,3*w+1,3*x+1),an(n,3*w+2,3*x+2)}x-c<f-x?(Nn(s,n,c,x),c=x+1):(Nn(s,n,x+1,f),f=x)}}function an(s,n,c){const f=s[n];s[n]=s[c],s[c]=f}Pt("FeaturePositionMap",Ri);class jn{constructor(n,c){this.gl=n.gl,this.location=c}}class Fr extends jn{constructor(n,c){super(n,c),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class vo extends jn{constructor(n,c){super(n,c),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class Jo extends jn{constructor(n,c){super(n,c),this.current=zi.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const Ia=new Float32Array(16);function Yo(s){return[oi(255*s.r,255*s.g),oi(255*s.b,255*s.a)]}class bo{constructor(n,c,f){this.value=n,this.uniformNames=c.map(g=>`u_${g}`),this.type=f}setUniform(n,c,f){n.set(f.constantOr(this.value))}getBinding(n,c,f){return this.type==="color"?new Jo(n,c):new Fr(n,c)}}class An{constructor(n,c){this.uniformNames=c.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,c){this.pixelRatioFrom=c.pixelRatio,this.pixelRatioTo=n.pixelRatio,this.patternFrom=c.tlbr,this.patternTo=n.tlbr}setUniform(n,c,f,g){const w=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&n.set(w)}getBinding(n,c,f){return f.substr(0,9)==="u_pattern"?new vo(n,c):new Fr(n,c)}}class ln{constructor(n,c,f,g){this.expression=n,this.type=f,this.maxValue=0,this.paintVertexAttributes=c.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(n,c,f,g,w){const x=this.paintVertexArray.length,T=this.expression.evaluate(new Qi(0),c,{},g,[],w);this.paintVertexArray.resize(n),this._setPaintValue(x,n,T)}updatePaintArray(n,c,f,g){const w=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(n,c,w)}_setPaintValue(n,c,f){if(this.type==="color"){const g=Yo(f);for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,g[0],g[1])}else{for(let g=n;g<c;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class en{constructor(n,c,f,g,w,x){this.expression=n,this.uniformNames=c.map(T=>`u_${T}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=c.map(T=>({name:`a_${T}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(n,c,f,g,w){const x=this.expression.evaluate(new Qi(this.zoom),c,{},g,[],w),T=this.expression.evaluate(new Qi(this.zoom+1),c,{},g,[],w),I=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(I,n,x,T)}updatePaintArray(n,c,f,g){const w=this.expression.evaluate({zoom:this.zoom},f,g),x=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(n,c,w,x)}_setPaintValue(n,c,f,g){if(this.type==="color"){const w=Yo(f),x=Yo(g);for(let T=n;T<c;T++)this.paintVertexArray.emplace(T,w[0],w[1],x[0],x[1])}else{for(let w=n;w<c;w++)this.paintVertexArray.emplace(w,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,c){const f=this.useIntegerZoom?Math.floor(c.zoom):c.zoom,g=se(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);n.set(g)}getBinding(n,c,f){return new Fr(n,c)}}class Kr{constructor(n,c,f,g,w,x){this.expression=n,this.type=c,this.useIntegerZoom=f,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(n,c,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(g,n,c.patterns&&c.patterns[this.layerId],f)}updatePaintArray(n,c,f,g,w){this._setPaintValues(n,c,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(n,c,f,g){if(!g||!f)return;const{min:w,mid:x,max:T}=f,I=g[w],P=g[x],N=g[T];if(I&&P&&N)for(let U=n;U<c;U++)this.zoomInPaintVertexArray.emplace(U,P.tl[0],P.tl[1],P.br[0],P.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],P.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(U,P.tl[0],P.tl[1],P.br[0],P.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],P.pixelRatio,N.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,yt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,yt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Pn{constructor(n,c,f){this.binders={},this._buffers=[];const g=[];for(const w in n.paint._values){if(!f(w))continue;const x=n.paint.get(w);if(!(x instanceof ro&&Bs(x.property.specification)))continue;const T=Jr(w,n.type),I=x.value,P=x.property.specification.type,N=x.property.useIntegerZoom,U=x.property.specification["property-type"],H=U==="cross-faded"||U==="cross-faded-data-driven";if(I.kind==="constant")this.binders[w]=H?new An(I.value,T):new bo(I.value,T,P),g.push(`/u_${w}`);else if(I.kind==="source"||H){const J=zn(w,P,"source");this.binders[w]=H?new Kr(I,P,N,c,J,n.id):new ln(I,T,P,J),g.push(`/a_${w}`)}else{const J=zn(w,P,"composite");this.binders[w]=new en(I,T,P,N,c,J),g.push(`/z_${w}`)}}this.cacheKey=g.sort().join("")}getMaxValue(n){const c=this.binders[n];return c instanceof ln||c instanceof en?c.maxValue:0}populatePaintArrays(n,c,f,g,w){for(const x in this.binders){const T=this.binders[x];(T instanceof ln||T instanceof en||T instanceof Kr)&&T.populatePaintArray(n,c,f,g,w)}}setConstantPatternPositions(n,c){for(const f in this.binders){const g=this.binders[f];g instanceof An&&g.setConstantPatternPositions(n,c)}}updatePaintArrays(n,c,f,g,w){let x=!1;for(const T in n){const I=c.getPositions(T);for(const P of I){const N=f.feature(P.index);for(const U in this.binders){const H=this.binders[U];if((H instanceof ln||H instanceof en||H instanceof Kr)&&H.expression.isStateDependent===!0){const J=g.paint.get(U);H.expression=J.value,H.updatePaintArray(P.start,P.end,N,n[T],w),x=!0}}}}return x}defines(){const n=[];for(const c in this.binders){const f=this.binders[c];(f instanceof bo||f instanceof An)&&n.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return n}getBinderAttributes(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof ln||f instanceof en)for(let g=0;g<f.paintVertexAttributes.length;g++)n.push(f.paintVertexAttributes[g].name);else if(f instanceof Kr)for(let g=0;g<yt.members.length;g++)n.push(yt.members[g].name)}return n}getBinderUniforms(){const n=[];for(const c in this.binders){const f=this.binders[c];if(f instanceof bo||f instanceof An||f instanceof en)for(const g of f.uniformNames)n.push(g)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,c){const f=[];for(const g in this.binders){const w=this.binders[g];if(w instanceof bo||w instanceof An||w instanceof en){for(const x of w.uniformNames)if(c[x]){const T=w.getBinding(n,c[x],x);f.push({name:x,property:g,binding:T})}}}return f}setUniforms(n,c,f,g){for(const{name:w,property:x,binding:T}of c)this.binders[x].setUniform(T,g,f.get(x),w)}updatePaintBuffers(n){this._buffers=[];for(const c in this.binders){const f=this.binders[c];if(n&&f instanceof Kr){const g=n.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof ln||f instanceof en)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(n){for(const c in this.binders){const f=this.binders[c];(f instanceof ln||f instanceof en||f instanceof Kr)&&f.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const c=this.binders[n];(c instanceof ln||c instanceof en||c instanceof Kr)&&c.destroy()}}}class cn{constructor(n,c,f=()=>!0){this.programConfigurations={};for(const g of n)this.programConfigurations[g.id]=new Pn(g,c,f);this.needsUpload=!1,this._featureMap=new Ri,this._bufferOffset=0}populatePaintArrays(n,c,f,g,w,x){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(n,c,g,w,x);c.id!==void 0&&this._featureMap.add(c.id,f,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,c,f,g){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(n,this._featureMap,c,w,g)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const c in this.programConfigurations)this.programConfigurations[c].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}function Jr(s,n){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${n}-`,"").replace(/-/g,"_")]}function zn(s,n,c){const f={color:{source:Ca,composite:Tl},number:{source:kl,composite:Ca}},g=function(w){return{"line-pattern":{source:Ce,composite:Ce},"fill-pattern":{source:Ce,composite:Ce},"fill-extrusion-pattern":{source:Ce,composite:Ce}}[w]}(s);return g&&g[c]||f[n][c]}Pt("ConstantBinder",bo),Pt("CrossFadedConstantBinder",An),Pt("SourceExpressionBinder",ln),Pt("CrossFadedCompositeBinder",Kr),Pt("CompositeExpressionBinder",en),Pt("ProgramConfiguration",Pn,{omit:["_buffers"]}),Pt("ProgramConfigurationSet",cn);const _n=8192,Uc=Math.pow(2,14)-1,zh=-Uc-1;function ds(s){const n=_n/s.extent,c=s.loadGeometry();for(let f=0;f<c.length;f++){const g=c[f];for(let w=0;w<g.length;w++){const x=g[w],T=Math.round(x.x*n),I=Math.round(x.y*n);x.x=se(T,zh,Uc),x.y=se(I,zh,Uc),(T<x.x||T>x.x+1||I<x.y||I>x.y+1)&&Je("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return c}function fs(s,n){return{type:s.type,id:s.id,properties:s.properties,geometry:n?ds(s):[]}}function Cl(s,n,c,f,g){s.emplaceBack(2*n+(f+1)/2,2*c+(g+1)/2)}class Qo{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new ee,this.indexArray=new Ke,this.segments=new _t,this.programConfigurations=new cn(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){const g=this.layers[0],w=[];let x=null,T=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),T=!x.isConstant());for(const{feature:I,id:P,index:N,sourceLayerIndex:U}of n){const H=this.layers[0]._featureFilter.needGeometry,J=fs(I,H);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),J,f))continue;const te=T?x.evaluate(J,{},f):void 0,he={id:P,properties:I.properties,type:I.type,sourceLayerIndex:U,index:N,geometry:H?J.geometry:ds(I),patterns:{},sortKey:te};w.push(he)}T&&w.sort((I,P)=>I.sortKey-P.sortKey);for(const I of w){const{geometry:P,index:N,sourceLayerIndex:U}=I,H=n[N].feature;this.addFeature(I,P,N,f),c.featureIndex.insert(H,P,N,U,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,ft),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,c,f,g){for(const w of c)for(const x of w){const T=x.x,I=x.y;if(T<0||T>=_n||I<0||I>=_n)continue;const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),N=P.vertexLength;Cl(this.layoutVertexArray,T,I,-1,-1),Cl(this.layoutVertexArray,T,I,1,-1),Cl(this.layoutVertexArray,T,I,1,1),Cl(this.layoutVertexArray,T,I,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,{},g)}}function Vc(s,n){for(let c=0;c<s.length;c++)if(Ml(n,s[c]))return!0;for(let c=0;c<n.length;c++)if(Ml(s,n[c]))return!0;return!!El(s,n)}function Dh(s,n,c){return!!Ml(s,n)||!!rf(n,s,c)}function $c(s,n){if(s.length===1)return Hp(n,s[0]);for(let c=0;c<n.length;c++){const f=n[c];for(let g=0;g<f.length;g++)if(Ml(s,f[g]))return!0}for(let c=0;c<s.length;c++)if(Hp(n,s[c]))return!0;for(let c=0;c<n.length;c++)if(El(s,n[c]))return!0;return!1}function qc(s,n,c){if(s.length>1){if(El(s,n))return!0;for(let f=0;f<n.length;f++)if(rf(n[f],s,c))return!0}for(let f=0;f<s.length;f++)if(rf(s[f],n,c))return!0;return!1}function El(s,n){if(s.length===0||n.length===0)return!1;for(let c=0;c<s.length-1;c++){const f=s[c],g=s[c+1];for(let w=0;w<n.length-1;w++)if(Zc(f,g,n[w],n[w+1]))return!0}return!1}function Zc(s,n,c,f){return Le(s,c,f)!==Le(n,c,f)&&Le(s,n,c)!==Le(s,n,f)}function rf(s,n,c){const f=c*c;if(n.length===1)return s.distSqr(n[0])<f;for(let g=1;g<n.length;g++)if(Wp(s,n[g-1],n[g])<f)return!0;return!1}function Wp(s,n,c){const f=n.distSqr(c);if(f===0)return s.distSqr(n);const g=((s.x-n.x)*(c.x-n.x)+(s.y-n.y)*(c.y-n.y))/f;return s.distSqr(g<0?n:g>1?c:c.sub(n)._mult(g)._add(n))}function Hp(s,n){let c,f,g,w=!1;for(let x=0;x<s.length;x++){c=s[x];for(let T=0,I=c.length-1;T<c.length;I=T++)f=c[T],g=c[I],f.y>n.y!=g.y>n.y&&n.x<(g.x-f.x)*(n.y-f.y)/(g.y-f.y)+f.x&&(w=!w)}return w}function Ml(s,n){let c=!1;for(let f=0,g=s.length-1;f<s.length;g=f++){const w=s[f],x=s[g];w.y>n.y!=x.y>n.y&&n.x<(x.x-w.x)*(n.y-w.y)/(x.y-w.y)+w.x&&(c=!c)}return c}function o1(s,n,c){const f=c[0],g=c[2];if(s.x<f.x&&n.x<f.x||s.x>g.x&&n.x>g.x||s.y<f.y&&n.y<f.y||s.y>g.y&&n.y>g.y)return!1;const w=Le(s,n,c[0]);return w!==Le(s,n,c[1])||w!==Le(s,n,c[2])||w!==Le(s,n,c[3])}function Gc(s,n,c){const f=n.paint.get(s).value;return f.kind==="constant"?f.value:c.programConfigurations.get(n.id).getMaxValue(s)}function Rh(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Bh(s,n,c,f,g){if(!n[0]&&!n[1])return s;const w=S.convert(n)._mult(g);c==="viewport"&&w._rotate(-f);const x=[];for(let T=0;T<s.length;T++)x.push(s[T].sub(w));return x}let Xp,Kp;Pt("CircleBucket",Qo,{omit:["layers"]});var s1={get paint(){return Kp=Kp||new kr({"circle-radius":new Wt(we.paint_circle["circle-radius"]),"circle-color":new Wt(we.paint_circle["circle-color"]),"circle-blur":new Wt(we.paint_circle["circle-blur"]),"circle-opacity":new Wt(we.paint_circle["circle-opacity"]),"circle-translate":new Ut(we.paint_circle["circle-translate"]),"circle-translate-anchor":new Ut(we.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ut(we.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ut(we.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wt(we.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wt(we.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wt(we.paint_circle["circle-stroke-opacity"])})},get layout(){return Xp=Xp||new kr({"circle-sort-key":new Wt(we.layout_circle["circle-sort-key"])})}},Sr=1e-6,Il=typeof Float32Array<"u"?Float32Array:Array;function of(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Jp(s,n,c){var f=n[0],g=n[1],w=n[2],x=n[3],T=n[4],I=n[5],P=n[6],N=n[7],U=n[8],H=n[9],J=n[10],te=n[11],he=n[12],ge=n[13],xe=n[14],Fe=n[15],Te=c[0],De=c[1],Qe=c[2],tt=c[3];return s[0]=Te*f+De*T+Qe*U+tt*he,s[1]=Te*g+De*I+Qe*H+tt*ge,s[2]=Te*w+De*P+Qe*J+tt*xe,s[3]=Te*x+De*N+Qe*te+tt*Fe,s[4]=(Te=c[4])*f+(De=c[5])*T+(Qe=c[6])*U+(tt=c[7])*he,s[5]=Te*g+De*I+Qe*H+tt*ge,s[6]=Te*w+De*P+Qe*J+tt*xe,s[7]=Te*x+De*N+Qe*te+tt*Fe,s[8]=(Te=c[8])*f+(De=c[9])*T+(Qe=c[10])*U+(tt=c[11])*he,s[9]=Te*g+De*I+Qe*H+tt*ge,s[10]=Te*w+De*P+Qe*J+tt*xe,s[11]=Te*x+De*N+Qe*te+tt*Fe,s[12]=(Te=c[12])*f+(De=c[13])*T+(Qe=c[14])*U+(tt=c[15])*he,s[13]=Te*g+De*I+Qe*H+tt*ge,s[14]=Te*w+De*P+Qe*J+tt*xe,s[15]=Te*x+De*N+Qe*te+tt*Fe,s}Math.hypot||(Math.hypot=function(){for(var s=0,n=arguments.length;n--;)s+=arguments[n]*arguments[n];return Math.sqrt(s)});var Wc,a1=Jp;function Fh(s,n,c){var f=n[0],g=n[1],w=n[2],x=n[3];return s[0]=c[0]*f+c[4]*g+c[8]*w+c[12]*x,s[1]=c[1]*f+c[5]*g+c[9]*w+c[13]*x,s[2]=c[2]*f+c[6]*g+c[10]*w+c[14]*x,s[3]=c[3]*f+c[7]*g+c[11]*w+c[15]*x,s}Wc=new Il(4),Il!=Float32Array&&(Wc[0]=0,Wc[1]=0,Wc[2]=0,Wc[3]=0);class l1 extends oo{constructor(n){super(n,s1)}createBucket(n){return new Qo(n)}queryRadius(n){const c=n;return Gc("circle-radius",this,c)+Gc("circle-stroke-width",this,c)+Rh(this.paint.get("circle-translate"))}queryIntersectsFeature(n,c,f,g,w,x,T,I){const P=Bh(n,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,T),N=this.paint.get("circle-radius").evaluate(c,f)+this.paint.get("circle-stroke-width").evaluate(c,f),U=this.paint.get("circle-pitch-alignment")==="map",H=U?P:function(te,he){return te.map(ge=>Yp(ge,he))}(P,I),J=U?N*T:N;for(const te of g)for(const he of te){const ge=U?he:Yp(he,I);let xe=J;const Fe=Fh([],[he.x,he.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xe*=Fe[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xe*=x.cameraToCenterDistance/Fe[3]),Dh(H,ge,xe))return!0}return!1}}function Yp(s,n){const c=Fh([],[s.x,s.y,0,1],n);return new S(c[0]/c[3],c[1]/c[3])}class Qp extends Qo{}let em;Pt("HeatmapBucket",Qp,{omit:["layers"]});var c1={get paint(){return em=em||new kr({"heatmap-radius":new Wt(we.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wt(we.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ut(we.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Pc(we.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ut(we.paint_heatmap["heatmap-opacity"])})}};function sf(s,{width:n,height:c},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==n*c*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${n*c*f}`)}else g=new Uint8Array(n*c*f);return s.width=n,s.height=c,s.data=g,s}function tm(s,{width:n,height:c},f){if(n===s.width&&c===s.height)return;const g=sf({},{width:n,height:c},f);af(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,n),height:Math.min(s.height,c)},f),s.width=n,s.height=c,s.data=g.data}function af(s,n,c,f,g,w){if(g.width===0||g.height===0)return n;if(g.width>s.width||g.height>s.height||c.x>s.width-g.width||c.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>n.width||g.height>n.height||f.x>n.width-g.width||f.y>n.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,T=n.data;if(x===T)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<g.height;I++){const P=((c.y+I)*s.width+c.x)*w,N=((f.y+I)*n.width+f.x)*w;for(let U=0;U<g.width*w;U++)T[N+U]=x[P+U]}return n}class Hc{constructor(n,c){sf(this,n,1,c)}resize(n){tm(this,n,1)}clone(){return new Hc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,g,w){af(n,c,f,g,w,1)}}class so{constructor(n,c){sf(this,n,4,c)}resize(n){tm(this,n,4)}replace(n,c){c?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new so({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,c,f,g,w){af(n,c,f,g,w,4)}}function im(s){const n={},c=s.resolution||256,f=s.clips?s.clips.length:1,g=s.image||new so({width:c,height:f});if(Math.log(c)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${c}`);const w=(x,T,I)=>{n[s.evaluationKey]=I;const P=s.expression.evaluate(n);g.data[x+T+0]=Math.floor(255*P.r/P.a),g.data[x+T+1]=Math.floor(255*P.g/P.a),g.data[x+T+2]=Math.floor(255*P.b/P.a),g.data[x+T+3]=Math.floor(255*P.a)};if(s.clips)for(let x=0,T=0;x<f;++x,T+=4*c)for(let I=0,P=0;I<c;I++,P+=4){const N=I/(c-1),{start:U,end:H}=s.clips[x];w(T,P,U*(1-N)+H*N)}else for(let x=0,T=0;x<c;x++,T+=4)w(0,T,x/(c-1));return g}Pt("AlphaImage",Hc),Pt("RGBAImage",so);class u1 extends oo{createBucket(n){return new Qp(n)}constructor(n){super(n,c1),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(n){n==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=im({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let nm;var h1={get paint(){return nm=nm||new kr({"hillshade-illumination-direction":new Ut(we.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ut(we.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ut(we.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ut(we.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ut(we.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ut(we.paint_hillshade["hillshade-accent-color"])})}};class d1 extends oo{constructor(n){super(n,h1)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const f1=kn([{name:"a_pos",components:2,type:"Int16"}],4),{members:p1}=f1;var lf={exports:{}};function Oh(s,n,c){c=c||2;var f,g,w,x,T,I,P,N=n&&n.length,U=N?n[0]*c:s.length,H=rm(s,0,U,c,!0),J=[];if(!H||H.next===H.prev)return J;if(N&&(H=function(he,ge,xe,Fe){var Te,De,Qe,tt=[];for(Te=0,De=ge.length;Te<De;Te++)(Qe=rm(he,ge[Te]*Fe,Te<De-1?ge[Te+1]*Fe:he.length,Fe,!1))===Qe.next&&(Qe.steiner=!0),tt.push(x1(Qe));for(tt.sort(v1),Te=0;Te<tt.length;Te++)xe=b1(tt[Te],xe);return xe}(s,n,H,c)),s.length>80*c){f=w=s[0],g=x=s[1];for(var te=c;te<U;te+=c)(T=s[te])<f&&(f=T),(I=s[te+1])<g&&(g=I),T>w&&(w=T),I>x&&(x=I);P=(P=Math.max(w-f,x-g))!==0?32767/P:0}return Xc(H,J,c,f,g,P,0),J}function rm(s,n,c,f,g){var w,x;if(g===hf(s,n,c,f)>0)for(w=n;w<c;w+=f)x=am(w,s[w],s[w+1],x);else for(w=c-f;w>=n;w-=f)x=am(w,s[w],s[w+1],x);return x&&Nh(x,x.next)&&(Jc(x),x=x.next),x}function La(s,n){if(!s)return s;n||(n=s);var c,f=s;do if(c=!1,f.steiner||!Nh(f,f.next)&&Sn(f.prev,f,f.next)!==0)f=f.next;else{if(Jc(f),(f=n=f.prev)===f.next)break;c=!0}while(c||f!==n);return n}function Xc(s,n,c,f,g,w,x){if(s){!x&&w&&function(N,U,H,J){var te=N;do te.z===0&&(te.z=cf(te.x,te.y,U,H,J)),te.prevZ=te.prev,te.nextZ=te.next,te=te.next;while(te!==N);te.prevZ.nextZ=null,te.prevZ=null,function(he){var ge,xe,Fe,Te,De,Qe,tt,Mt,Ot=1;do{for(xe=he,he=null,De=null,Qe=0;xe;){for(Qe++,Fe=xe,tt=0,ge=0;ge<Ot&&(tt++,Fe=Fe.nextZ);ge++);for(Mt=Ot;tt>0||Mt>0&&Fe;)tt!==0&&(Mt===0||!Fe||xe.z<=Fe.z)?(Te=xe,xe=xe.nextZ,tt--):(Te=Fe,Fe=Fe.nextZ,Mt--),De?De.nextZ=Te:he=Te,Te.prevZ=De,De=Te;xe=Fe}De.nextZ=null,Ot*=2}while(Qe>1)}(te)}(s,f,g,w);for(var T,I,P=s;s.prev!==s.next;)if(T=s.prev,I=s.next,w?g1(s,f,g,w):m1(s))n.push(T.i/c|0),n.push(s.i/c|0),n.push(I.i/c|0),Jc(s),s=I.next,P=I.next;else if((s=I)===P){x?x===1?Xc(s=_1(La(s),n,c),n,c,f,g,w,2):x===2&&y1(s,n,c,f,g,w):Xc(La(s),n,c,f,g,w,1);break}}}function m1(s){var n=s.prev,c=s,f=s.next;if(Sn(n,c,f)>=0)return!1;for(var g=n.x,w=c.x,x=f.x,T=n.y,I=c.y,P=f.y,N=g<w?g<x?g:x:w<x?w:x,U=T<I?T<P?T:P:I<P?I:P,H=g>w?g>x?g:x:w>x?w:x,J=T>I?T>P?T:P:I>P?I:P,te=f.next;te!==n;){if(te.x>=N&&te.x<=H&&te.y>=U&&te.y<=J&&Ll(g,T,w,I,x,P,te.x,te.y)&&Sn(te.prev,te,te.next)>=0)return!1;te=te.next}return!0}function g1(s,n,c,f){var g=s.prev,w=s,x=s.next;if(Sn(g,w,x)>=0)return!1;for(var T=g.x,I=w.x,P=x.x,N=g.y,U=w.y,H=x.y,J=T<I?T<P?T:P:I<P?I:P,te=N<U?N<H?N:H:U<H?U:H,he=T>I?T>P?T:P:I>P?I:P,ge=N>U?N>H?N:H:U>H?U:H,xe=cf(J,te,n,c,f),Fe=cf(he,ge,n,c,f),Te=s.prevZ,De=s.nextZ;Te&&Te.z>=xe&&De&&De.z<=Fe;){if(Te.x>=J&&Te.x<=he&&Te.y>=te&&Te.y<=ge&&Te!==g&&Te!==x&&Ll(T,N,I,U,P,H,Te.x,Te.y)&&Sn(Te.prev,Te,Te.next)>=0||(Te=Te.prevZ,De.x>=J&&De.x<=he&&De.y>=te&&De.y<=ge&&De!==g&&De!==x&&Ll(T,N,I,U,P,H,De.x,De.y)&&Sn(De.prev,De,De.next)>=0))return!1;De=De.nextZ}for(;Te&&Te.z>=xe;){if(Te.x>=J&&Te.x<=he&&Te.y>=te&&Te.y<=ge&&Te!==g&&Te!==x&&Ll(T,N,I,U,P,H,Te.x,Te.y)&&Sn(Te.prev,Te,Te.next)>=0)return!1;Te=Te.prevZ}for(;De&&De.z<=Fe;){if(De.x>=J&&De.x<=he&&De.y>=te&&De.y<=ge&&De!==g&&De!==x&&Ll(T,N,I,U,P,H,De.x,De.y)&&Sn(De.prev,De,De.next)>=0)return!1;De=De.nextZ}return!0}function _1(s,n,c){var f=s;do{var g=f.prev,w=f.next.next;!Nh(g,w)&&om(g,f,f.next,w)&&Kc(g,w)&&Kc(w,g)&&(n.push(g.i/c|0),n.push(f.i/c|0),n.push(w.i/c|0),Jc(f),Jc(f.next),f=s=w),f=f.next}while(f!==s);return La(f)}function y1(s,n,c,f,g,w){var x=s;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&k1(x,T)){var I=sm(x,T);return x=La(x,x.next),I=La(I,I.next),Xc(x,n,c,f,g,w,0),void Xc(I,n,c,f,g,w,0)}T=T.next}x=x.next}while(x!==s)}function v1(s,n){return s.x-n.x}function b1(s,n){var c=function(g,w){var x,T=w,I=g.x,P=g.y,N=-1/0;do{if(P<=T.y&&P>=T.next.y&&T.next.y!==T.y){var U=T.x+(P-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(U<=I&&U>N&&(N=U,x=T.x<T.next.x?T:T.next,U===I))return x}T=T.next}while(T!==w);if(!x)return null;var H,J=x,te=x.x,he=x.y,ge=1/0;T=x;do I>=T.x&&T.x>=te&&I!==T.x&&Ll(P<he?I:N,P,te,he,P<he?N:I,P,T.x,T.y)&&(H=Math.abs(P-T.y)/(I-T.x),Kc(T,g)&&(H<ge||H===ge&&(T.x>x.x||T.x===x.x&&w1(x,T)))&&(x=T,ge=H)),T=T.next;while(T!==J);return x}(s,n);if(!c)return n;var f=sm(c,s);return La(f,f.next),La(c,c.next)}function w1(s,n){return Sn(s.prev,s,n.prev)<0&&Sn(n.next,s,s.next)<0}function cf(s,n,c,f,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-c)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-f)*g|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function x1(s){var n=s,c=s;do(n.x<c.x||n.x===c.x&&n.y<c.y)&&(c=n),n=n.next;while(n!==s);return c}function Ll(s,n,c,f,g,w,x,T){return(g-x)*(n-T)>=(s-x)*(w-T)&&(s-x)*(f-T)>=(c-x)*(n-T)&&(c-x)*(w-T)>=(g-x)*(f-T)}function k1(s,n){return s.next.i!==n.i&&s.prev.i!==n.i&&!function(c,f){var g=c;do{if(g.i!==c.i&&g.next.i!==c.i&&g.i!==f.i&&g.next.i!==f.i&&om(g,g.next,c,f))return!0;g=g.next}while(g!==c);return!1}(s,n)&&(Kc(s,n)&&Kc(n,s)&&function(c,f){var g=c,w=!1,x=(c.x+f.x)/2,T=(c.y+f.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&x<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(w=!w),g=g.next;while(g!==c);return w}(s,n)&&(Sn(s.prev,s,n.prev)||Sn(s,n.prev,n))||Nh(s,n)&&Sn(s.prev,s,s.next)>0&&Sn(n.prev,n,n.next)>0)}function Sn(s,n,c){return(n.y-s.y)*(c.x-n.x)-(n.x-s.x)*(c.y-n.y)}function Nh(s,n){return s.x===n.x&&s.y===n.y}function om(s,n,c,f){var g=Uh(Sn(s,n,c)),w=Uh(Sn(s,n,f)),x=Uh(Sn(c,f,s)),T=Uh(Sn(c,f,n));return g!==w&&x!==T||!(g!==0||!jh(s,c,n))||!(w!==0||!jh(s,f,n))||!(x!==0||!jh(c,s,f))||!(T!==0||!jh(c,n,f))}function jh(s,n,c){return n.x<=Math.max(s.x,c.x)&&n.x>=Math.min(s.x,c.x)&&n.y<=Math.max(s.y,c.y)&&n.y>=Math.min(s.y,c.y)}function Uh(s){return s>0?1:s<0?-1:0}function Kc(s,n){return Sn(s.prev,s,s.next)<0?Sn(s,n,s.next)>=0&&Sn(s,s.prev,n)>=0:Sn(s,n,s.prev)<0||Sn(s,s.next,n)<0}function sm(s,n){var c=new uf(s.i,s.x,s.y),f=new uf(n.i,n.x,n.y),g=s.next,w=n.prev;return s.next=n,n.prev=s,c.next=g,g.prev=c,f.next=c,c.prev=f,w.next=f,f.prev=w,f}function am(s,n,c,f){var g=new uf(s,n,c);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function Jc(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function uf(s,n,c){this.i=s,this.x=n,this.y=c,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hf(s,n,c,f){for(var g=0,w=n,x=c-f;w<c;w+=f)g+=(s[x]-s[w])*(s[w+1]+s[x+1]),x=w;return g}lf.exports=Oh,lf.exports.default=Oh,Oh.deviation=function(s,n,c,f){var g=n&&n.length,w=Math.abs(hf(s,0,g?n[0]*c:s.length,c));if(g)for(var x=0,T=n.length;x<T;x++)w-=Math.abs(hf(s,n[x]*c,x<T-1?n[x+1]*c:s.length,c));var I=0;for(x=0;x<f.length;x+=3){var P=f[x]*c,N=f[x+1]*c,U=f[x+2]*c;I+=Math.abs((s[P]-s[U])*(s[N+1]-s[P+1])-(s[P]-s[N])*(s[U+1]-s[P+1]))}return w===0&&I===0?0:Math.abs((I-w)/w)},Oh.flatten=function(s){for(var n=s[0][0].length,c={vertices:[],holes:[],dimensions:n},f=0,g=0;g<s.length;g++){for(var w=0;w<s[g].length;w++)for(var x=0;x<n;x++)c.vertices.push(s[g][w][x]);g>0&&c.holes.push(f+=s[g-1].length)}return c};var lm=_(lf.exports);function S1(s,n,c,f,g){cm(s,n,c||0,f||s.length-1,g||T1)}function cm(s,n,c,f,g){for(;f>c;){if(f-c>600){var w=f-c+1,x=n-c+1,T=Math.log(w),I=.5*Math.exp(2*T/3),P=.5*Math.sqrt(T*I*(w-I)/w)*(x-w/2<0?-1:1);cm(s,n,Math.max(c,Math.floor(n-x*I/w+P)),Math.min(f,Math.floor(n+(w-x)*I/w+P)),g)}var N=s[n],U=c,H=f;for(Yc(s,c,n),g(s[f],N)>0&&Yc(s,c,f);U<H;){for(Yc(s,U,H),U++,H--;g(s[U],N)<0;)U++;for(;g(s[H],N)>0;)H--}g(s[c],N)===0?Yc(s,c,H):Yc(s,++H,f),H<=n&&(c=H+1),n<=H&&(f=H-1)}}function Yc(s,n,c){var f=s[n];s[n]=s[c],s[c]=f}function T1(s,n){return s<n?-1:s>n?1:0}function df(s,n){const c=s.length;if(c<=1)return[s];const f=[];let g,w;for(let x=0;x<c;x++){const T=et(s[x]);T!==0&&(s[x].area=Math.abs(T),w===void 0&&(w=T<0),w===T<0?(g&&f.push(g),g=[s[x]]):g.push(s[x]))}if(g&&f.push(g),n>1)for(let x=0;x<f.length;x++)f[x].length<=n||(S1(f[x],n,1,f[x].length-1,C1),f[x]=f[x].slice(0,n));return f}function C1(s,n){return n.area-s.area}function ff(s,n,c){const f=c.patternDependencies;let g=!1;for(const w of n){const x=w.paint.get(`${s}-pattern`);x.isConstant()||(g=!0);const T=x.constantOr(null);T&&(g=!0,f[T.to]=!0,f[T.from]=!0)}return g}function pf(s,n,c,f,g){const w=g.patternDependencies;for(const x of n){const T=x.paint.get(`${s}-pattern`).value;if(T.kind!=="constant"){let I=T.evaluate({zoom:f-1},c,{},g.availableImages),P=T.evaluate({zoom:f},c,{},g.availableImages),N=T.evaluate({zoom:f+1},c,{},g.availableImages);I=I&&I.name?I.name:I,P=P&&P.name?P.name:P,N=N&&N.name?N.name:N,w[I]=!0,w[P]=!0,w[N]=!0,c.patterns[x.id]={min:I,mid:P,max:N}}}return c}class mf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pe,this.indexArray=new Ke,this.indexArray2=new nt,this.programConfigurations=new cn(n.layers,n.zoom),this.segments=new _t,this.segments2=new _t,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=ff("fill",this.layers,c);const g=this.layers[0].layout.get("fill-sort-key"),w=!g.isConstant(),x=[];for(const{feature:T,id:I,index:P,sourceLayerIndex:N}of n){const U=this.layers[0]._featureFilter.needGeometry,H=fs(T,U);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),H,f))continue;const J=w?g.evaluate(H,{},f,c.availableImages):void 0,te={id:I,properties:T.properties,type:T.type,sourceLayerIndex:N,index:P,geometry:U?H.geometry:ds(T),patterns:{},sortKey:J};x.push(te)}w&&x.sort((T,I)=>T.sortKey-I.sortKey);for(const T of x){const{geometry:I,index:P,sourceLayerIndex:N}=T;if(this.hasPattern){const U=pf("fill",this.layers,T,this.zoom,c);this.patternFeatures.push(U)}else this.addFeature(T,I,P,f,{});c.featureIndex.insert(n[P].feature,I,P,N,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,p1),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,c,f,g,w){for(const x of df(c,500)){let T=0;for(const J of x)T+=J.length;const I=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),P=I.vertexLength,N=[],U=[];for(const J of x){if(J.length===0)continue;J!==x[0]&&U.push(N.length/2);const te=this.segments2.prepareSegment(J.length,this.layoutVertexArray,this.indexArray2),he=te.vertexLength;this.layoutVertexArray.emplaceBack(J[0].x,J[0].y),this.indexArray2.emplaceBack(he+J.length-1,he),N.push(J[0].x),N.push(J[0].y);for(let ge=1;ge<J.length;ge++)this.layoutVertexArray.emplaceBack(J[ge].x,J[ge].y),this.indexArray2.emplaceBack(he+ge-1,he+ge),N.push(J[ge].x),N.push(J[ge].y);te.vertexLength+=J.length,te.primitiveLength+=J.length}const H=lm(N,U);for(let J=0;J<H.length;J+=3)this.indexArray.emplaceBack(P+H[J],P+H[J+1],P+H[J+2]);I.vertexLength+=T,I.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,g)}}let um,hm;Pt("FillBucket",mf,{omit:["layers","patternFeatures"]});var E1={get paint(){return hm=hm||new kr({"fill-antialias":new Ut(we.paint_fill["fill-antialias"]),"fill-opacity":new Wt(we.paint_fill["fill-opacity"]),"fill-color":new Wt(we.paint_fill["fill-color"]),"fill-outline-color":new Wt(we.paint_fill["fill-outline-color"]),"fill-translate":new Ut(we.paint_fill["fill-translate"]),"fill-translate-anchor":new Ut(we.paint_fill["fill-translate-anchor"]),"fill-pattern":new yl(we.paint_fill["fill-pattern"])})},get layout(){return um=um||new kr({"fill-sort-key":new Wt(we.layout_fill["fill-sort-key"])})}};class M1 extends oo{constructor(n){super(n,E1)}recalculate(n,c){super.recalculate(n,c);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(n){return new mf(n)}queryRadius(){return Rh(this.paint.get("fill-translate"))}queryIntersectsFeature(n,c,f,g,w,x,T){return $c(Bh(n,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,T),g)}isTileClipped(){return!0}}const I1=kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),L1=kn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:A1}=I1;var qs={},P1=v,dm=Al;function Al(s,n,c,f,g){this.properties={},this.extent=c,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=g,s.readFields(z1,this,n)}function z1(s,n,c){s==1?n.id=c.readVarint():s==2?function(f,g){for(var w=f.readVarint()+f.pos;f.pos<w;){var x=g._keys[f.readVarint()],T=g._values[f.readVarint()];g.properties[x]=T}}(c,n):s==3?n.type=c.readVarint():s==4&&(n._geometry=c.pos)}function D1(s){for(var n,c,f=0,g=0,w=s.length,x=w-1;g<w;x=g++)f+=((c=s[x]).x-(n=s[g]).x)*(n.y+c.y);return f}Al.types=["Unknown","Point","LineString","Polygon"],Al.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var n,c=s.readVarint()+s.pos,f=1,g=0,w=0,x=0,T=[];s.pos<c;){if(g<=0){var I=s.readVarint();f=7&I,g=I>>3}if(g--,f===1||f===2)w+=s.readSVarint(),x+=s.readSVarint(),f===1&&(n&&T.push(n),n=[]),n.push(new P1(w,x));else{if(f!==7)throw new Error("unknown command "+f);n&&n.push(n[0].clone())}}return n&&T.push(n),T},Al.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var n=s.readVarint()+s.pos,c=1,f=0,g=0,w=0,x=1/0,T=-1/0,I=1/0,P=-1/0;s.pos<n;){if(f<=0){var N=s.readVarint();c=7&N,f=N>>3}if(f--,c===1||c===2)(g+=s.readSVarint())<x&&(x=g),g>T&&(T=g),(w+=s.readSVarint())<I&&(I=w),w>P&&(P=w);else if(c!==7)throw new Error("unknown command "+c)}return[x,I,T,P]},Al.prototype.toGeoJSON=function(s,n,c){var f,g,w=this.extent*Math.pow(2,c),x=this.extent*s,T=this.extent*n,I=this.loadGeometry(),P=Al.types[this.type];function N(J){for(var te=0;te<J.length;te++){var he=J[te];J[te]=[360*(he.x+x)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(he.y+T)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var U=[];for(f=0;f<I.length;f++)U[f]=I[f][0];N(I=U);break;case 2:for(f=0;f<I.length;f++)N(I[f]);break;case 3:for(I=function(J){var te=J.length;if(te<=1)return[J];for(var he,ge,xe=[],Fe=0;Fe<te;Fe++){var Te=D1(J[Fe]);Te!==0&&(ge===void 0&&(ge=Te<0),ge===Te<0?(he&&xe.push(he),he=[J[Fe]]):he.push(J[Fe]))}return he&&xe.push(he),xe}(I),f=0;f<I.length;f++)for(g=0;g<I[f].length;g++)N(I[f][g])}I.length===1?I=I[0]:P="Multi"+P;var H={type:"Feature",geometry:{type:P,coordinates:I},properties:this.properties};return"id"in this&&(H.id=this.id),H};var R1=dm,fm=pm;function pm(s,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(B1,this,n),this.length=this._features.length}function B1(s,n,c){s===15?n.version=c.readVarint():s===1?n.name=c.readString():s===5?n.extent=c.readVarint():s===2?n._features.push(c.pos):s===3?n._keys.push(c.readString()):s===4&&n._values.push(function(f){for(var g=null,w=f.readVarint()+f.pos;f.pos<w;){var x=f.readVarint()>>3;g=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return g}(c))}pm.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var n=this._pbf.readVarint()+this._pbf.pos;return new R1(this._pbf,n,this.extent,this._keys,this._values)};var F1=fm;function O1(s,n,c){if(s===3){var f=new F1(c,c.readVarint()+c.pos);f.length&&(n[f.name]=f)}}qs.VectorTile=function(s,n){this.layers=s.readFields(O1,{},n)},qs.VectorTileFeature=dm,qs.VectorTileLayer=fm;const N1=qs.VectorTileFeature.types,gf=Math.pow(2,13);function Qc(s,n,c,f,g,w,x,T){s.emplaceBack(n,c,2*Math.floor(f*gf)+x,g*gf*2,w*gf*2,Math.round(T))}class _f{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.layoutVertexArray=new fe,this.centroidVertexArray=new q,this.indexArray=new Ke,this.programConfigurations=new cn(n.layers,n.zoom),this.segments=new _t,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.features=[],this.hasPattern=ff("fill-extrusion",this.layers,c);for(const{feature:g,id:w,index:x,sourceLayerIndex:T}of n){const I=this.layers[0]._featureFilter.needGeometry,P=fs(g,I);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),P,f))continue;const N={id:w,sourceLayerIndex:T,index:x,geometry:I?P.geometry:ds(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(pf("fill-extrusion",this.layers,N,this.zoom,c)):this.addFeature(N,N.geometry,x,f,{}),c.featureIndex.insert(g,N.geometry,x,T,this.index,!0)}}addFeatures(n,c,f){for(const g of this.features){const{geometry:w}=g;this.addFeature(g,w,g.index,c,f)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,A1),this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,L1.members,!0),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(n,c,f,g,w){const x={x:0,y:0,vertexCount:0};for(const T of df(c,500)){let I=0;for(const te of T)I+=te.length;let P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const te of T){if(te.length===0||U1(te))continue;let he=0;for(let ge=0;ge<te.length;ge++){const xe=te[ge];if(ge>=1){const Fe=te[ge-1];if(!j1(xe,Fe)){P.vertexLength+4>_t.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Te=xe.sub(Fe)._perp()._unit(),De=Fe.dist(xe);he+De>32768&&(he=0),Qc(this.layoutVertexArray,xe.x,xe.y,Te.x,Te.y,0,0,he),Qc(this.layoutVertexArray,xe.x,xe.y,Te.x,Te.y,0,1,he),x.x+=2*xe.x,x.y+=2*xe.y,x.vertexCount+=2,he+=De,Qc(this.layoutVertexArray,Fe.x,Fe.y,Te.x,Te.y,0,0,he),Qc(this.layoutVertexArray,Fe.x,Fe.y,Te.x,Te.y,0,1,he),x.x+=2*Fe.x,x.y+=2*Fe.y,x.vertexCount+=2;const Qe=P.vertexLength;this.indexArray.emplaceBack(Qe,Qe+2,Qe+1),this.indexArray.emplaceBack(Qe+1,Qe+2,Qe+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+I>_t.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),N1[n.type]!=="Polygon")continue;const N=[],U=[],H=P.vertexLength;for(const te of T)if(te.length!==0){te!==T[0]&&U.push(N.length/2);for(let he=0;he<te.length;he++){const ge=te[he];Qc(this.layoutVertexArray,ge.x,ge.y,0,0,1,1,0),x.x+=ge.x,x.y+=ge.y,x.vertexCount+=1,N.push(ge.x),N.push(ge.y)}}const J=lm(N,U);for(let te=0;te<J.length;te+=3)this.indexArray.emplaceBack(H+J[te],H+J[te+2],H+J[te+1]);P.primitiveLength+=J.length/3,P.vertexLength+=I}for(let T=0;T<x.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,g)}}function j1(s,n){return s.x===n.x&&(s.x<0||s.x>_n)||s.y===n.y&&(s.y<0||s.y>_n)}function U1(s){return s.every(n=>n.x<0)||s.every(n=>n.x>_n)||s.every(n=>n.y<0)||s.every(n=>n.y>_n)}let mm;Pt("FillExtrusionBucket",_f,{omit:["layers","features"]});var V1={get paint(){return mm=mm||new kr({"fill-extrusion-opacity":new Ut(we["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wt(we["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ut(we["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ut(we["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new yl(we["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wt(we["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wt(we["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ut(we["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class $1 extends oo{constructor(n){super(n,V1)}createBucket(n){return new _f(n)}queryRadius(){return Rh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(n,c,f,g,w,x,T,I){const P=Bh(n,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,T),N=this.paint.get("fill-extrusion-height").evaluate(c,f),U=this.paint.get("fill-extrusion-base").evaluate(c,f),H=function(te,he,ge,xe){const Fe=[];for(const Te of te){const De=[Te.x,Te.y,0,1];Fh(De,De,he),Fe.push(new S(De[0]/De[3],De[1]/De[3]))}return Fe}(P,I),J=function(te,he,ge,xe){const Fe=[],Te=[],De=xe[8]*he,Qe=xe[9]*he,tt=xe[10]*he,Mt=xe[11]*he,Ot=xe[8]*ge,Et=xe[9]*ge,wt=xe[10]*ge,mt=xe[11]*ge;for(const Dt of te){const vt=[],ct=[];for(const Gt of Dt){const jt=Gt.x,mi=Gt.y,Wi=xe[0]*jt+xe[4]*mi+xe[12],tn=xe[1]*jt+xe[5]*mi+xe[13],Vn=xe[2]*jt+xe[6]*mi+xe[14],Yr=xe[3]*jt+xe[7]*mi+xe[15],Tr=Vn+tt,Dn=Yr+Mt,Yn=Wi+Ot,or=tn+Et,Cr=Vn+wt,Er=Yr+mt,$n=new S((Wi+De)/Dn,(tn+Qe)/Dn);$n.z=Tr/Dn,vt.push($n);const qn=new S(Yn/Er,or/Er);qn.z=Cr/Er,ct.push(qn)}Fe.push(vt),Te.push(ct)}return[Fe,Te]}(g,U,N,I);return function(te,he,ge){let xe=1/0;$c(ge,he)&&(xe=gm(ge,he[0]));for(let Fe=0;Fe<he.length;Fe++){const Te=he[Fe],De=te[Fe];for(let Qe=0;Qe<Te.length-1;Qe++){const tt=Te[Qe],Mt=[tt,Te[Qe+1],De[Qe+1],De[Qe],tt];Vc(ge,Mt)&&(xe=Math.min(xe,gm(ge,Mt)))}}return xe!==1/0&&xe}(J[0],J[1],H)}}function eu(s,n){return s.x*n.x+s.y*n.y}function gm(s,n){if(s.length===1){let c=0;const f=n[c++];let g;for(;!g||f.equals(g);)if(g=n[c++],!g)return 1/0;for(;c<n.length;c++){const w=n[c],x=s[0],T=g.sub(f),I=w.sub(f),P=x.sub(f),N=eu(T,T),U=eu(T,I),H=eu(I,I),J=eu(P,T),te=eu(P,I),he=N*H-U*U,ge=(H*J-U*te)/he,xe=(N*te-U*J)/he,Fe=f.z*(1-ge-xe)+g.z*ge+w.z*xe;if(isFinite(Fe))return Fe}return 1/0}{let c=1/0;for(const f of n)c=Math.min(c,f.z);return c}}const q1=kn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Z1}=q1,G1=kn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:W1}=G1,H1=qs.VectorTileFeature.types,X1=Math.cos(Math.PI/180*37.5),_m=Math.pow(2,14)/.5;class yf{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(c=>c.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(c=>{this.gradients[c.id]={}}),this.layoutVertexArray=new _e,this.layoutVertexArray2=new ue,this.indexArray=new Ke,this.programConfigurations=new cn(n.layers,n.zoom),this.segments=new _t,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(c=>c.isStateDependent()).map(c=>c.id)}populate(n,c,f){this.hasPattern=ff("line",this.layers,c);const g=this.layers[0].layout.get("line-sort-key"),w=!g.isConstant(),x=[];for(const{feature:T,id:I,index:P,sourceLayerIndex:N}of n){const U=this.layers[0]._featureFilter.needGeometry,H=fs(T,U);if(!this.layers[0]._featureFilter.filter(new Qi(this.zoom),H,f))continue;const J=w?g.evaluate(H,{},f):void 0,te={id:I,properties:T.properties,type:T.type,sourceLayerIndex:N,index:P,geometry:U?H.geometry:ds(T),patterns:{},sortKey:J};x.push(te)}w&&x.sort((T,I)=>T.sortKey-I.sortKey);for(const T of x){const{geometry:I,index:P,sourceLayerIndex:N}=T;if(this.hasPattern){const U=pf("line",this.layers,T,this.zoom,c);this.patternFeatures.push(U)}else this.addFeature(T,I,P,f,{});c.featureIndex.insert(n[P].feature,I,P,N,this.index)}}update(n,c,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,c,this.stateDependentLayers,f)}addFeatures(n,c,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,c,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,W1)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Z1),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(n.properties,"mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,c,f,g,w){const x=this.layers[0].layout,T=x.get("line-join").evaluate(n,{}),I=x.get("line-cap"),P=x.get("line-miter-limit"),N=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const U of c)this.addLine(U,n,T,I,P,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,f,w,g)}addLine(n,c,f,g,w,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<n.length-1;xe++)this.totalDistance+=n[xe].dist(n[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=H1[c.type]==="Polygon";let I=n.length;for(;I>=2&&n[I-1].equals(n[I-2]);)I--;let P=0;for(;P<I-1&&n[P].equals(n[P+1]);)P++;if(I<(T?3:2))return;f==="bevel"&&(w=1.05);const N=this.overscaling<=16?15*_n/(512*this.overscaling):0,U=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let H,J,te,he,ge;this.e1=this.e2=-1,T&&(H=n[I-2],ge=n[P].sub(H)._unit()._perp());for(let xe=P;xe<I;xe++){if(te=xe===I-1?T?n[P+1]:void 0:n[xe+1],te&&n[xe].equals(te))continue;ge&&(he=ge),H&&(J=H),H=n[xe],ge=te?te.sub(H)._unit()._perp():he,he=he||ge;let Fe=he.add(ge);Fe.x===0&&Fe.y===0||Fe._unit();const Te=he.x*ge.x+he.y*ge.y,De=Fe.x*ge.x+Fe.y*ge.y,Qe=De!==0?1/De:1/0,tt=2*Math.sqrt(2-2*De),Mt=De<X1&&J&&te,Ot=he.x*ge.y-he.y*ge.x>0;if(Mt&&xe>P){const mt=H.dist(J);if(mt>2*N){const Dt=H.sub(H.sub(J)._mult(N/mt)._round());this.updateDistance(J,Dt),this.addCurrentVertex(Dt,he,0,0,U),J=Dt}}const Et=J&&te;let wt=Et?f:T?"butt":g;if(Et&&wt==="round"&&(Qe<x?wt="miter":Qe<=2&&(wt="fakeround")),wt==="miter"&&Qe>w&&(wt="bevel"),wt==="bevel"&&(Qe>2&&(wt="flipbevel"),Qe<w&&(wt="miter")),J&&this.updateDistance(J,H),wt==="miter")Fe._mult(Qe),this.addCurrentVertex(H,Fe,0,0,U);else if(wt==="flipbevel"){if(Qe>100)Fe=ge.mult(-1);else{const mt=Qe*he.add(ge).mag()/he.sub(ge).mag();Fe._perp()._mult(mt*(Ot?-1:1))}this.addCurrentVertex(H,Fe,0,0,U),this.addCurrentVertex(H,Fe.mult(-1),0,0,U)}else if(wt==="bevel"||wt==="fakeround"){const mt=-Math.sqrt(Qe*Qe-1),Dt=Ot?mt:0,vt=Ot?0:mt;if(J&&this.addCurrentVertex(H,he,Dt,vt,U),wt==="fakeround"){const ct=Math.round(180*tt/Math.PI/20);for(let Gt=1;Gt<ct;Gt++){let jt=Gt/ct;if(jt!==.5){const Wi=jt-.5;jt+=jt*Wi*(jt-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*Wi*Wi+(.848013+Te*(.215638*Te-1.06021)))}const mi=ge.sub(he)._mult(jt)._add(he)._unit()._mult(Ot?-1:1);this.addHalfVertex(H,mi.x,mi.y,!1,Ot,0,U)}}te&&this.addCurrentVertex(H,ge,-Dt,-vt,U)}else if(wt==="butt")this.addCurrentVertex(H,Fe,0,0,U);else if(wt==="square"){const mt=J?1:-1;this.addCurrentVertex(H,Fe,mt,mt,U)}else wt==="round"&&(J&&(this.addCurrentVertex(H,he,0,0,U),this.addCurrentVertex(H,he,1,1,U,!0)),te&&(this.addCurrentVertex(H,ge,-1,-1,U,!0),this.addCurrentVertex(H,ge,0,0,U)));if(Mt&&xe<I-1){const mt=H.dist(te);if(mt>2*N){const Dt=H.add(te.sub(H)._mult(N/mt)._round());this.updateDistance(H,Dt),this.addCurrentVertex(Dt,ge,0,0,U),H=Dt}}}}addCurrentVertex(n,c,f,g,w,x=!1){const T=c.y*g-c.x,I=-c.y-c.x*g;this.addHalfVertex(n,c.x+c.y*f,c.y-c.x*f,x,!1,f,w),this.addHalfVertex(n,T,I,x,!0,-g,w),this.distance>_m/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(n,c,f,g,w,x))}addHalfVertex({x:n,y:c},f,g,w,x,T,I){const P=.5*(this.lineClips?this.scaledDistance*(_m-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((n<<1)+(w?1:0),(c<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),I.primitiveLength++),x?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(n,c){this.distance+=n.dist(c),this.updateScaledDistance()}}let ym,vm;Pt("LineBucket",yf,{omit:["layers","patternFeatures"]});var bm={get paint(){return vm=vm||new kr({"line-opacity":new Wt(we.paint_line["line-opacity"]),"line-color":new Wt(we.paint_line["line-color"]),"line-translate":new Ut(we.paint_line["line-translate"]),"line-translate-anchor":new Ut(we.paint_line["line-translate-anchor"]),"line-width":new Wt(we.paint_line["line-width"]),"line-gap-width":new Wt(we.paint_line["line-gap-width"]),"line-offset":new Wt(we.paint_line["line-offset"]),"line-blur":new Wt(we.paint_line["line-blur"]),"line-dasharray":new ka(we.paint_line["line-dasharray"]),"line-pattern":new yl(we.paint_line["line-pattern"]),"line-gradient":new Pc(we.paint_line["line-gradient"])})},get layout(){return ym=ym||new kr({"line-cap":new Ut(we.layout_line["line-cap"]),"line-join":new Wt(we.layout_line["line-join"]),"line-miter-limit":new Ut(we.layout_line["line-miter-limit"]),"line-round-limit":new Ut(we.layout_line["line-round-limit"]),"line-sort-key":new Wt(we.layout_line["line-sort-key"])})}};class K1 extends Wt{possiblyEvaluate(n,c){return c=new Qi(Math.floor(c.zoom),{now:c.now,fadeDuration:c.fadeDuration,zoomHistory:c.zoomHistory,transition:c.transition}),super.possiblyEvaluate(n,c)}evaluate(n,c,f,g){return c=Z({},c,{zoom:Math.floor(c.zoom)}),super.evaluate(n,c,f,g)}}let Vh;class J1 extends oo{constructor(n){super(n,bm),this.gradientVersion=0,Vh||(Vh=new K1(bm.paint.properties["line-width"].specification),Vh.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(n){if(n==="line-gradient"){const c=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(c)&&c._styleExpression.expression instanceof ma,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(n,c){super.recalculate(n,c),this.paint._values["line-floorwidth"]=Vh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,n)}createBucket(n){return new yf(n)}queryRadius(n){const c=n,f=wm(Gc("line-width",this,c),Gc("line-gap-width",this,c)),g=Gc("line-offset",this,c);return f/2+Math.abs(g)+Rh(this.paint.get("line-translate"))}queryIntersectsFeature(n,c,f,g,w,x,T){const I=Bh(n,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,T),P=T/2*wm(this.paint.get("line-width").evaluate(c,f),this.paint.get("line-gap-width").evaluate(c,f)),N=this.paint.get("line-offset").evaluate(c,f);return N&&(g=function(U,H){const J=[];for(let te=0;te<U.length;te++){const he=U[te],ge=[];for(let xe=0;xe<he.length;xe++){const Fe=he[xe-1],Te=he[xe],De=he[xe+1],Qe=xe===0?new S(0,0):Te.sub(Fe)._unit()._perp(),tt=xe===he.length-1?new S(0,0):De.sub(Te)._unit()._perp(),Mt=Qe._add(tt)._unit(),Ot=Mt.x*tt.x+Mt.y*tt.y;Ot!==0&&Mt._mult(1/Ot),ge.push(Mt._mult(H)._add(Te))}J.push(ge)}return J}(g,N*T)),function(U,H,J){for(let te=0;te<H.length;te++){const he=H[te];if(U.length>=3){for(let ge=0;ge<he.length;ge++)if(Ml(U,he[ge]))return!0}if(qc(U,he,J))return!0}return!1}(I,g,P)}isTileClipped(){return!0}}function wm(s,n){return n>0?n+2*s:s}const Y1=kn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Q1=kn([{name:"a_projected_pos",components:3,type:"Float32"}],4);kn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ev=kn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);kn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const xm=kn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),tv=kn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function iv(s,n,c){return s.sections.forEach(f=>{f.text=function(g,w,x){const T=w.layout.get("text-transform").evaluate(x,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),Ko.applyArabicShaping&&(g=Ko.applyArabicShaping(g)),g}(f.text,n,c)}),s}kn([{name:"triangle",components:3,type:"Uint16"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),kn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),kn([{type:"Float32",name:"offsetX"}]),kn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),kn([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const tu={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Un=24,km=ji,Sm=function(s,n,c,f,g){var w,x,T=8*g-f-1,I=(1<<T)-1,P=I>>1,N=-7,U=c?g-1:0,H=c?-1:1,J=s[n+U];for(U+=H,w=J&(1<<-N)-1,J>>=-N,N+=T;N>0;w=256*w+s[n+U],U+=H,N-=8);for(x=w&(1<<-N)-1,w>>=-N,N+=f;N>0;x=256*x+s[n+U],U+=H,N-=8);if(w===0)w=1-P;else{if(w===I)return x?NaN:1/0*(J?-1:1);x+=Math.pow(2,f),w-=P}return(J?-1:1)*x*Math.pow(2,w-f)},Tm=function(s,n,c,f,g,w){var x,T,I,P=8*w-g-1,N=(1<<P)-1,U=N>>1,H=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,J=f?0:w-1,te=f?1:-1,he=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(T=isNaN(n)?1:0,x=N):(x=Math.floor(Math.log(n)/Math.LN2),n*(I=Math.pow(2,-x))<1&&(x--,I*=2),(n+=x+U>=1?H/I:H*Math.pow(2,1-U))*I>=2&&(x++,I/=2),x+U>=N?(T=0,x=N):x+U>=1?(T=(n*I-1)*Math.pow(2,g),x+=U):(T=n*Math.pow(2,U-1)*Math.pow(2,g),x=0));g>=8;s[c+J]=255&T,J+=te,T/=256,g-=8);for(x=x<<g|T,P+=g;P>0;s[c+J]=255&x,J+=te,x/=256,P-=8);s[c+J-te]|=128*he};function ji(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}ji.Varint=0,ji.Fixed64=1,ji.Bytes=2,ji.Fixed32=5;var vf=4294967296,Cm=1/vf,Em=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ps(s){return s.type===ji.Bytes?s.readVarint()+s.pos:s.pos+1}function Pl(s,n,c){return c?4294967296*n+(s>>>0):4294967296*(n>>>0)+(s>>>0)}function Mm(s,n,c){var f=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));c.realloc(f);for(var g=c.pos-1;g>=s;g--)c.buf[g+f]=c.buf[g]}function nv(s,n){for(var c=0;c<s.length;c++)n.writeVarint(s[c])}function rv(s,n){for(var c=0;c<s.length;c++)n.writeSVarint(s[c])}function ov(s,n){for(var c=0;c<s.length;c++)n.writeFloat(s[c])}function sv(s,n){for(var c=0;c<s.length;c++)n.writeDouble(s[c])}function av(s,n){for(var c=0;c<s.length;c++)n.writeBoolean(s[c])}function lv(s,n){for(var c=0;c<s.length;c++)n.writeFixed32(s[c])}function cv(s,n){for(var c=0;c<s.length;c++)n.writeSFixed32(s[c])}function uv(s,n){for(var c=0;c<s.length;c++)n.writeFixed64(s[c])}function hv(s,n){for(var c=0;c<s.length;c++)n.writeSFixed64(s[c])}function $h(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+16777216*s[n+3]}function zl(s,n,c){s[c]=n,s[c+1]=n>>>8,s[c+2]=n>>>16,s[c+3]=n>>>24}function Im(s,n){return(s[n]|s[n+1]<<8|s[n+2]<<16)+(s[n+3]<<24)}ji.prototype={destroy:function(){this.buf=null},readFields:function(s,n,c){for(c=c||this.length;this.pos<c;){var f=this.readVarint(),g=f>>3,w=this.pos;this.type=7&f,s(g,n,this),this.pos===w&&this.skip(f)}return n},readMessage:function(s,n){return this.readFields(s,n,this.readVarint()+this.pos)},readFixed32:function(){var s=$h(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Im(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=$h(this.buf,this.pos)+$h(this.buf,this.pos+4)*vf;return this.pos+=8,s},readSFixed64:function(){var s=$h(this.buf,this.pos)+Im(this.buf,this.pos+4)*vf;return this.pos+=8,s},readFloat:function(){var s=Sm(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Sm(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var n,c,f=this.buf;return n=127&(c=f[this.pos++]),c<128?n:(n|=(127&(c=f[this.pos++]))<<7,c<128?n:(n|=(127&(c=f[this.pos++]))<<14,c<128?n:(n|=(127&(c=f[this.pos++]))<<21,c<128?n:function(g,w,x){var T,I,P=x.buf;if(T=(112&(I=P[x.pos++]))>>4,I<128||(T|=(127&(I=P[x.pos++]))<<3,I<128)||(T|=(127&(I=P[x.pos++]))<<10,I<128)||(T|=(127&(I=P[x.pos++]))<<17,I<128)||(T|=(127&(I=P[x.pos++]))<<24,I<128)||(T|=(1&(I=P[x.pos++]))<<31,I<128))return Pl(g,T,w);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(c=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,n=this.pos;return this.pos=s,s-n>=12&&Em?function(c,f,g){return Em.decode(c.subarray(f,g))}(this.buf,n,s):function(c,f,g){for(var w="",x=f;x<g;){var T,I,P,N=c[x],U=null,H=N>239?4:N>223?3:N>191?2:1;if(x+H>g)break;H===1?N<128&&(U=N):H===2?(192&(T=c[x+1]))==128&&(U=(31&N)<<6|63&T)<=127&&(U=null):H===3?(I=c[x+2],(192&(T=c[x+1]))==128&&(192&I)==128&&((U=(15&N)<<12|(63&T)<<6|63&I)<=2047||U>=55296&&U<=57343)&&(U=null)):H===4&&(I=c[x+2],P=c[x+3],(192&(T=c[x+1]))==128&&(192&I)==128&&(192&P)==128&&((U=(15&N)<<18|(63&T)<<12|(63&I)<<6|63&P)<=65535||U>=1114112)&&(U=null)),U===null?(U=65533,H=1):U>65535&&(U-=65536,w+=String.fromCharCode(U>>>10&1023|55296),U=56320|1023&U),w+=String.fromCharCode(U),x+=H}return w}(this.buf,n,s)},readBytes:function(){var s=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,s);return this.pos=s,n},readPackedVarint:function(s,n){if(this.type!==ji.Bytes)return s.push(this.readVarint(n));var c=ps(this);for(s=s||[];this.pos<c;)s.push(this.readVarint(n));return s},readPackedSVarint:function(s){if(this.type!==ji.Bytes)return s.push(this.readSVarint());var n=ps(this);for(s=s||[];this.pos<n;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==ji.Bytes)return s.push(this.readBoolean());var n=ps(this);for(s=s||[];this.pos<n;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==ji.Bytes)return s.push(this.readFloat());var n=ps(this);for(s=s||[];this.pos<n;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==ji.Bytes)return s.push(this.readDouble());var n=ps(this);for(s=s||[];this.pos<n;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==ji.Bytes)return s.push(this.readFixed32());var n=ps(this);for(s=s||[];this.pos<n;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==ji.Bytes)return s.push(this.readSFixed32());var n=ps(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==ji.Bytes)return s.push(this.readFixed64());var n=ps(this);for(s=s||[];this.pos<n;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==ji.Bytes)return s.push(this.readSFixed64());var n=ps(this);for(s=s||[];this.pos<n;)s.push(this.readSFixed64());return s},skip:function(s){var n=7&s;if(n===ji.Varint)for(;this.buf[this.pos++]>127;);else if(n===ji.Bytes)this.pos=this.readVarint()+this.pos;else if(n===ji.Fixed32)this.pos+=4;else{if(n!==ji.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(s,n){this.writeVarint(s<<3|n)},realloc:function(s){for(var n=this.length||16;n<this.pos+s;)n*=2;if(n!==this.length){var c=new Uint8Array(n);c.set(this.buf),this.buf=c,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),zl(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),zl(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),zl(this.buf,-1&s,this.pos),zl(this.buf,Math.floor(s*Cm),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),zl(this.buf,-1&s,this.pos),zl(this.buf,Math.floor(s*Cm),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(n,c){var f,g;if(n>=0?(f=n%4294967296|0,g=n/4294967296|0):(g=~(-n/4294967296),4294967295^(f=~(-n%4294967296))?f=f+1|0:(f=0,g=g+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(w,x,T){T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,w>>>=7,T.buf[T.pos++]=127&w|128,T.buf[T.pos]=127&(w>>>=7)}(f,0,c),function(w,x){var T=(7&w)<<4;x.buf[x.pos++]|=T|((w>>>=3)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w|((w>>>=7)?128:0),w&&(x.buf[x.pos++]=127&w)))))}(g,c)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var n=this.pos;this.pos=function(f,g,w){for(var x,T,I=0;I<g.length;I++){if((x=g.charCodeAt(I))>55295&&x<57344){if(!T){x>56319||I+1===g.length?(f[w++]=239,f[w++]=191,f[w++]=189):T=x;continue}if(x<56320){f[w++]=239,f[w++]=191,f[w++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(f[w++]=239,f[w++]=191,f[w++]=189,T=null);x<128?f[w++]=x:(x<2048?f[w++]=x>>6|192:(x<65536?f[w++]=x>>12|224:(f[w++]=x>>18|240,f[w++]=x>>12&63|128),f[w++]=x>>6&63|128),f[w++]=63&x|128)}return w}(this.buf,s,this.pos);var c=this.pos-n;c>=128&&Mm(n,c,this),this.pos=n-1,this.writeVarint(c),this.pos+=c},writeFloat:function(s){this.realloc(4),Tm(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Tm(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var n=s.length;this.writeVarint(n),this.realloc(n);for(var c=0;c<n;c++)this.buf[this.pos++]=s[c]},writeRawMessage:function(s,n){this.pos++;var c=this.pos;s(n,this);var f=this.pos-c;f>=128&&Mm(c,f,this),this.pos=c-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,n,c){this.writeTag(s,ji.Bytes),this.writeRawMessage(n,c)},writePackedVarint:function(s,n){n.length&&this.writeMessage(s,nv,n)},writePackedSVarint:function(s,n){n.length&&this.writeMessage(s,rv,n)},writePackedBoolean:function(s,n){n.length&&this.writeMessage(s,av,n)},writePackedFloat:function(s,n){n.length&&this.writeMessage(s,ov,n)},writePackedDouble:function(s,n){n.length&&this.writeMessage(s,sv,n)},writePackedFixed32:function(s,n){n.length&&this.writeMessage(s,lv,n)},writePackedSFixed32:function(s,n){n.length&&this.writeMessage(s,cv,n)},writePackedFixed64:function(s,n){n.length&&this.writeMessage(s,uv,n)},writePackedSFixed64:function(s,n){n.length&&this.writeMessage(s,hv,n)},writeBytesField:function(s,n){this.writeTag(s,ji.Bytes),this.writeBytes(n)},writeFixed32Field:function(s,n){this.writeTag(s,ji.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(s,n){this.writeTag(s,ji.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(s,n){this.writeTag(s,ji.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(s,n){this.writeTag(s,ji.Fixed64),this.writeSFixed64(n)},writeVarintField:function(s,n){this.writeTag(s,ji.Varint),this.writeVarint(n)},writeSVarintField:function(s,n){this.writeTag(s,ji.Varint),this.writeSVarint(n)},writeStringField:function(s,n){this.writeTag(s,ji.Bytes),this.writeString(n)},writeFloatField:function(s,n){this.writeTag(s,ji.Fixed32),this.writeFloat(n)},writeDoubleField:function(s,n){this.writeTag(s,ji.Fixed64),this.writeDouble(n)},writeBooleanField:function(s,n){this.writeVarintField(s,!!n)}};var bf=_(km);const wf=3;function dv(s,n,c){s===1&&c.readMessage(fv,n)}function fv(s,n,c){if(s===3){const{id:f,bitmap:g,width:w,height:x,left:T,top:I,advance:P}=c.readMessage(pv,{});n.push({id:f,bitmap:new Hc({width:w+2*wf,height:x+2*wf},g),metrics:{width:w,height:x,left:T,top:I,advance:P}})}}function pv(s,n,c){s===1?n.id=c.readVarint():s===2?n.bitmap=c.readBytes():s===3?n.width=c.readVarint():s===4?n.height=c.readVarint():s===5?n.left=c.readSVarint():s===6?n.top=c.readSVarint():s===7&&(n.advance=c.readVarint())}const Lm=wf;function Am(s){let n=0,c=0;for(const x of s)n+=x.w*x.h,c=Math.max(c,x.w);s.sort((x,T)=>T.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),c),h:1/0}];let g=0,w=0;for(const x of s)for(let T=f.length-1;T>=0;T--){const I=f[T];if(!(x.w>I.w||x.h>I.h)){if(x.x=I.x,x.y=I.y,w=Math.max(w,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===I.w&&x.h===I.h){const P=f.pop();T<f.length&&(f[T]=P)}else x.h===I.h?(I.x+=x.w,I.w-=x.w):x.w===I.w?(I.y+=x.h,I.h-=x.h):(f.push({x:I.x+x.w,y:I.y,w:I.w-x.w,h:x.h}),I.y+=x.h,I.h-=x.h);break}}return{w:g,h:w,fill:n/(g*w)||0}}const Or=1;class xf{constructor(n,{pixelRatio:c,version:f,stretchX:g,stretchY:w,content:x}){this.paddedRect=n,this.pixelRatio=c,this.stretchX=g,this.stretchY=w,this.content=x,this.version=f}get tl(){return[this.paddedRect.x+Or,this.paddedRect.y+Or]}get br(){return[this.paddedRect.x+this.paddedRect.w-Or,this.paddedRect.y+this.paddedRect.h-Or]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Or)/this.pixelRatio,(this.paddedRect.h-2*Or)/this.pixelRatio]}}class Pm{constructor(n,c){const f={},g={};this.haveRenderCallbacks=[];const w=[];this.addImages(n,f,w),this.addImages(c,g,w);const{w:x,h:T}=Am(w),I=new so({width:x||1,height:T||1});for(const P in n){const N=n[P],U=f[P].paddedRect;so.copy(N.data,I,{x:0,y:0},{x:U.x+Or,y:U.y+Or},N.data)}for(const P in c){const N=c[P],U=g[P].paddedRect,H=U.x+Or,J=U.y+Or,te=N.data.width,he=N.data.height;so.copy(N.data,I,{x:0,y:0},{x:H,y:J},N.data),so.copy(N.data,I,{x:0,y:he-1},{x:H,y:J-1},{width:te,height:1}),so.copy(N.data,I,{x:0,y:0},{x:H,y:J+he},{width:te,height:1}),so.copy(N.data,I,{x:te-1,y:0},{x:H-1,y:J},{width:1,height:he}),so.copy(N.data,I,{x:0,y:0},{x:H+te,y:J},{width:1,height:he})}this.image=I,this.iconPositions=f,this.patternPositions=g}addImages(n,c,f){for(const g in n){const w=n[g],x={x:0,y:0,w:w.data.width+2*Or,h:w.data.height+2*Or};f.push(x),c[g]=new xf(x,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(n,c){n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in n.updatedImages)this.patchUpdatedImage(this.iconPositions[f],n.getImage(f),c),this.patchUpdatedImage(this.patternPositions[f],n.getImage(f),c)}patchUpdatedImage(n,c,f){if(!n||!c||n.version===c.version)return;n.version=c.version;const[g,w]=n.tl;f.update(c.data,void 0,{x:g,y:w})}}var Zs;Pt("ImagePosition",xf),Pt("ImageAtlas",Pm),d.ah=void 0,(Zs=d.ah||(d.ah={}))[Zs.none=0]="none",Zs[Zs.horizontal=1]="horizontal",Zs[Zs.vertical=2]="vertical",Zs[Zs.horizontalOnly=3]="horizontalOnly";const iu=-17;class nu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,c){const f=new nu;return f.scale=n||1,f.fontStack=c,f}static forImage(n){const c=new nu;return c.imageName=n,c}}class Dl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,c){const f=new Dl;for(let g=0;g<n.sections.length;g++){const w=n.sections[g];w.image?f.addImageSection(w):f.addTextSection(w,c)}return f}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(){this.text=function(n){let c="";for(let f=0;f<n.length;f++){const g=n.charCodeAt(f+1)||null,w=n.charCodeAt(f-1)||null;c+=g&&Lc(g)&&!tu[n[f+1]]||w&&Lc(w)&&!tu[n[f-1]]||!tu[n[f]]?n[f]:tu[n[f]]}return c}(this.text)}trim(){let n=0;for(let f=0;f<this.text.length&&Zh[this.text.charCodeAt(f)];f++)n++;let c=this.text.length;for(let f=this.text.length-1;f>=0&&f>=n&&Zh[this.text.charCodeAt(f)];f--)c--;this.text=this.text.substring(n,c),this.sectionIndex=this.sectionIndex.slice(n,c)}substring(n,c){const f=new Dl;return f.text=this.text.substring(n,c),f.sectionIndex=this.sectionIndex.slice(n,c),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,c)=>Math.max(n,this.sections[c].scale),0)}addTextSection(n,c){this.text+=n.text,this.sections.push(nu.forText(n.scale,n.fontStack||c));const f=this.sections.length-1;for(let g=0;g<n.text.length;++g)this.sectionIndex.push(f)}addImageSection(n){const c=n.image?n.image.name:"";if(c.length===0)return void Je("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(nu.forImage(c)),this.sectionIndex.push(this.sections.length-1)):Je("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function qh(s,n,c,f,g,w,x,T,I,P,N,U,H,J,te,he){const ge=Dl.fromFeature(s,g);let xe;U===d.ah.vertical&&ge.verticalizePunctuation();const{processBidirectionalText:Fe,processStyledBidirectionalText:Te}=Ko;if(Fe&&ge.sections.length===1){xe=[];const tt=Fe(ge.toString(),kf(ge,P,w,n,f,J,te));for(const Mt of tt){const Ot=new Dl;Ot.text=Mt,Ot.sections=ge.sections;for(let Et=0;Et<Mt.length;Et++)Ot.sectionIndex.push(0);xe.push(Ot)}}else if(Te){xe=[];const tt=Te(ge.text,ge.sectionIndex,kf(ge,P,w,n,f,J,te));for(const Mt of tt){const Ot=new Dl;Ot.text=Mt[0],Ot.sectionIndex=Mt[1],Ot.sections=ge.sections,xe.push(Ot)}}else xe=function(tt,Mt){const Ot=[],Et=tt.text;let wt=0;for(const mt of Mt)Ot.push(tt.substring(wt,mt)),wt=mt;return wt<Et.length&&Ot.push(tt.substring(wt,Et.length)),Ot}(ge,kf(ge,P,w,n,f,J,te));const De=[],Qe={positionedLines:De,text:ge.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:U,iconsInText:!1,verticalizable:!1};return function(tt,Mt,Ot,Et,wt,mt,Dt,vt,ct,Gt,jt,mi){let Wi=0,tn=iu,Vn=0,Yr=0;const Tr=vt==="right"?1:vt==="left"?0:.5;let Dn=0;for(const $n of wt){$n.trim();const qn=$n.getMaxScale(),fr=(qn-1)*Un,Mr={positionedGlyphs:[],lineOffset:0};tt.positionedLines[Dn]=Mr;const pr=Mr.positionedGlyphs;let Nr=0;if(!$n.length()){tn+=mt,++Dn;continue}for(let Zn=0;Zn<$n.length();Zn++){const bi=$n.getSection(Zn),mr=$n.getSectionIndex(Zn),sr=$n.getCharCode(Zn);let Gn=0,wo=null,Do=null,Ro=null,ms=Un;const xo=!(ct===d.ah.horizontal||!jt&&!ml(sr)||jt&&(Zh[sr]||(Yn=sr,Ct.Arabic(Yn)||Ct["Arabic Supplement"](Yn)||Ct["Arabic Extended-A"](Yn)||Ct["Arabic Presentation Forms-A"](Yn)||Ct["Arabic Presentation Forms-B"](Yn))));if(bi.imageName){const lo=Et[bi.imageName];if(!lo)continue;Ro=bi.imageName,tt.iconsInText=tt.iconsInText||!0,Do=lo.paddedRect;const Ur=lo.displaySize;bi.scale=bi.scale*Un/mi,wo={width:Ur[0],height:Ur[1],left:Or,top:-Lm,advance:xo?Ur[1]:Ur[0]},Gn=fr+(Un-Ur[1]*bi.scale),ms=wo.advance;const gs=xo?Ur[0]*bi.scale-Un*qn:Ur[1]*bi.scale-Un*qn;gs>0&&gs>Nr&&(Nr=gs)}else{const lo=Ot[bi.fontStack],Ur=lo&&lo[sr];if(Ur&&Ur.rect)Do=Ur.rect,wo=Ur.metrics;else{const gs=Mt[bi.fontStack],lu=gs&&gs[sr];if(!lu)continue;wo=lu.metrics}Gn=(qn-bi.scale)*Un}xo?(tt.verticalizable=!0,pr.push({glyph:sr,imageName:Ro,x:Wi,y:tn+Gn,vertical:xo,scale:bi.scale,fontStack:bi.fontStack,sectionIndex:mr,metrics:wo,rect:Do}),Wi+=ms*bi.scale+Gt):(pr.push({glyph:sr,imageName:Ro,x:Wi,y:tn+Gn,vertical:xo,scale:bi.scale,fontStack:bi.fontStack,sectionIndex:mr,metrics:wo,rect:Do}),Wi+=wo.advance*bi.scale+Gt)}pr.length!==0&&(Vn=Math.max(Wi-Gt,Vn),_v(pr,0,pr.length-1,Tr,Nr)),Wi=0;const jr=mt*qn+Nr;Mr.lineOffset=Math.max(Nr,fr),tn+=jr,Yr=Math.max(jr,Yr),++Dn}var Yn;const or=tn-iu,{horizontalAlign:Cr,verticalAlign:Er}=Sf(Dt);(function($n,qn,fr,Mr,pr,Nr,jr,Zn,bi){const mr=(qn-fr)*pr;let sr=0;sr=Nr!==jr?-Zn*Mr-iu:(-Mr*bi+.5)*jr;for(const Gn of $n)for(const wo of Gn.positionedGlyphs)wo.x+=mr,wo.y+=sr})(tt.positionedLines,Tr,Cr,Er,Vn,Yr,mt,or,wt.length),tt.top+=-Er*or,tt.bottom=tt.top+or,tt.left+=-Cr*Vn,tt.right=tt.left+Vn}(Qe,n,c,f,xe,x,T,I,U,P,H,he),!function(tt){for(const Mt of tt)if(Mt.positionedGlyphs.length!==0)return!1;return!0}(De)&&Qe}const Zh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mv={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function zm(s,n,c,f,g,w){if(n.imageName){const x=f[n.imageName];return x?x.displaySize[0]*n.scale*Un/w+g:0}{const x=c[n.fontStack],T=x&&x[s];return T?T.metrics.advance*n.scale+g:0}}function Dm(s,n,c,f){const g=Math.pow(s-n,2);return f?s<n?g/2:2*g:g+Math.abs(c)*c}function gv(s,n,c){let f=0;return s===10&&(f-=1e4),c&&(f+=150),s!==40&&s!==65288||(f+=50),n!==41&&n!==65289||(f+=50),f}function Rm(s,n,c,f,g,w){let x=null,T=Dm(n,c,g,w);for(const I of f){const P=Dm(n-I.x,c,g,w)+I.badness;P<=T&&(x=I,T=P)}return{index:s,x:n,priorBreak:x,badness:T}}function Bm(s){return s?Bm(s.priorBreak).concat(s.index):[]}function kf(s,n,c,f,g,w,x){if(w!=="point")return[];if(!s)return[];const T=[],I=function(H,J,te,he,ge,xe){let Fe=0;for(let Te=0;Te<H.length();Te++){const De=H.getSection(Te);Fe+=zm(H.getCharCode(Te),De,he,ge,J,xe)}return Fe/Math.max(1,Math.ceil(Fe/te))}(s,n,c,f,g,x),P=s.text.indexOf("")>=0;let N=0;for(let H=0;H<s.length();H++){const J=s.getSection(H),te=s.getCharCode(H);if(Zh[te]||(N+=zm(te,J,f,g,n,x)),H<s.length()-1){const he=!((U=te)<11904||!(Ct["Bopomofo Extended"](U)||Ct.Bopomofo(U)||Ct["CJK Compatibility Forms"](U)||Ct["CJK Compatibility Ideographs"](U)||Ct["CJK Compatibility"](U)||Ct["CJK Radicals Supplement"](U)||Ct["CJK Strokes"](U)||Ct["CJK Symbols and Punctuation"](U)||Ct["CJK Unified Ideographs Extension A"](U)||Ct["CJK Unified Ideographs"](U)||Ct["Enclosed CJK Letters and Months"](U)||Ct["Halfwidth and Fullwidth Forms"](U)||Ct.Hiragana(U)||Ct["Ideographic Description Characters"](U)||Ct["Kangxi Radicals"](U)||Ct["Katakana Phonetic Extensions"](U)||Ct.Katakana(U)||Ct["Vertical Forms"](U)||Ct["Yi Radicals"](U)||Ct["Yi Syllables"](U)));(mv[te]||he||J.imageName)&&T.push(Rm(H+1,N,I,T,gv(te,s.getCharCode(H+1),he&&P),!1))}}var U;return Bm(Rm(s.length(),N,I,T,0,!0))}function Sf(s){let n=.5,c=.5;switch(s){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:n,verticalAlign:c}}function _v(s,n,c,f,g){if(!f&&!g)return;const w=s[c],x=(s[c].x+w.metrics.advance*w.scale)*f;for(let T=n;T<=c;T++)s[T].x-=x,s[T].y+=g}function yv(s,n,c){const{horizontalAlign:f,verticalAlign:g}=Sf(c),w=n[0]-s.displaySize[0]*f,x=n[1]-s.displaySize[1]*g;return{image:s,top:x,bottom:x+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function Fm(s,n,c,f,g,w){const x=s.image;let T;if(x.content){const ge=x.content,xe=x.pixelRatio||1;T=[ge[0]/xe,ge[1]/xe,x.displaySize[0]-ge[2]/xe,x.displaySize[1]-ge[3]/xe]}const I=n.left*w,P=n.right*w;let N,U,H,J;c==="width"||c==="both"?(J=g[0]+I-f[3],U=g[0]+P+f[1]):(J=g[0]+(I+P-x.displaySize[0])/2,U=J+x.displaySize[0]);const te=n.top*w,he=n.bottom*w;return c==="height"||c==="both"?(N=g[1]+te-f[0],H=g[1]+he+f[2]):(N=g[1]+(te+he-x.displaySize[1])/2,H=N+x.displaySize[1]),{image:x,top:N,right:U,bottom:H,left:J,collisionPadding:T}}const ru=255,es=128,Gs=ru*es;function Om(s,n){const{expression:c}=n;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Qi(s+1))};if(c.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=c;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let x=w;for(;x<f.length&&f[x]<s+1;)x++;x=Math.min(f.length-1,x);const T=f[w],I=f[x];return c.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:I,minSize:c.evaluate(new Qi(T)),maxSize:c.evaluate(new Qi(I)),interpolationType:g}}}function Tf(s,n,c){let f="never";const g=s.get(n);return g?f=g:s.get(c)&&(f="always"),f}const vv=qs.VectorTileFeature.types,bv=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gh(s,n,c,f,g,w,x,T,I,P,N,U,H){const J=T?Math.min(Gs,Math.round(T[0])):0,te=T?Math.min(Gs,Math.round(T[1])):0;s.emplaceBack(n,c,Math.round(32*f),Math.round(32*g),w,x,(J<<1)+(I?1:0),te,16*P,16*N,256*U,256*H)}function Cf(s,n,c){s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c),s.emplaceBack(n.x,n.y,c)}function wv(s){for(const n of s.sections)if(nf(n.text))return!0;return!1}class Ef{constructor(n){this.layoutVertexArray=new qe,this.indexArray=new Ke,this.programConfigurations=n,this.segments=new _t,this.dynamicLayoutVertexArray=new be,this.opacityVertexArray=new Re,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,c,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Y1.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,c),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,Q1.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,bv,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Pt("SymbolBuffers",Ef);class Mf{constructor(n,c,f){this.layoutVertexArray=new n,this.layoutAttributes=c,this.indexArray=new f,this.segments=new _t,this.collisionVertexArray=new He}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,ev.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Pt("CollisionBuffers",Mf);class Rl{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(x=>x.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=of([]),this.placementViewportMatrix=of([]);const c=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Om(this.zoom,c["text-size"]),this.iconSizeData=Om(this.zoom,c["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=Tf(f,"text-overlap","text-allow-overlap")!=="never"||Tf(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(x=>d.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=n.sourceID}createArrays(){this.text=new Ef(new cn(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Ef(new cn(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new b,this.lineVertexArray=new C,this.symbolInstances=new m,this.textAnchorOffsets=new L}calculateGlyphDependencies(n,c,f,g,w){for(let x=0;x<n.length;x++)if(c[n.charCodeAt(x)]=!0,(f||g)&&w){const T=tu[n.charAt(x)];T&&(c[T.charCodeAt(0)]=!0)}}populate(n,c,f){const g=this.layers[0],w=g.layout,x=w.get("text-font"),T=w.get("text-field"),I=w.get("icon-image"),P=(T.value.kind!=="constant"||T.value.value instanceof zr&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),N=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,U=w.get("symbol-sort-key");if(this.features=[],!P&&!N)return;const H=c.iconDependencies,J=c.glyphDependencies,te=c.availableImages,he=new Qi(this.zoom);for(const{feature:ge,id:xe,index:Fe,sourceLayerIndex:Te}of n){const De=g._featureFilter.needGeometry,Qe=fs(ge,De);if(!g._featureFilter.filter(he,Qe,f))continue;let tt,Mt;if(De||(Qe.geometry=ds(ge)),P){const Et=g.getValueAndResolveTokens("text-field",Qe,f,te),wt=zr.factory(Et),mt=this.hasRTLText=this.hasRTLText||wv(wt);(!mt||Ko.getRTLTextPluginStatus()==="unavailable"||mt&&Ko.isParsed())&&(tt=iv(wt,g,Qe))}if(N){const Et=g.getValueAndResolveTokens("icon-image",Qe,f,te);Mt=Et instanceof Xr?Et:Xr.fromString(Et)}if(!tt&&!Mt)continue;const Ot=this.sortFeaturesByKey?U.evaluate(Qe,{},f):void 0;if(this.features.push({id:xe,text:tt,icon:Mt,index:Fe,sourceLayerIndex:Te,geometry:Qe.geometry,properties:ge.properties,type:vv[ge.type],sortKey:Ot}),Mt&&(H[Mt.name]=!0),tt){const Et=x.evaluate(Qe,{},f).join(","),wt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(d.ah.vertical)>=0;for(const mt of tt.sections)if(mt.image)H[mt.image.name]=!0;else{const Dt=Vs(tt.toString()),vt=mt.fontStack||Et,ct=J[vt]=J[vt]||{};this.calculateGlyphDependencies(mt.text,ct,wt,this.allowVerticalPlacement,Dt)}}}w.get("symbol-placement")==="line"&&(this.features=function(ge){const xe={},Fe={},Te=[];let De=0;function Qe(Et){Te.push(ge[Et]),De++}function tt(Et,wt,mt){const Dt=Fe[Et];return delete Fe[Et],Fe[wt]=Dt,Te[Dt].geometry[0].pop(),Te[Dt].geometry[0]=Te[Dt].geometry[0].concat(mt[0]),Dt}function Mt(Et,wt,mt){const Dt=xe[wt];return delete xe[wt],xe[Et]=Dt,Te[Dt].geometry[0].shift(),Te[Dt].geometry[0]=mt[0].concat(Te[Dt].geometry[0]),Dt}function Ot(Et,wt,mt){const Dt=mt?wt[0][wt[0].length-1]:wt[0][0];return`${Et}:${Dt.x}:${Dt.y}`}for(let Et=0;Et<ge.length;Et++){const wt=ge[Et],mt=wt.geometry,Dt=wt.text?wt.text.toString():null;if(!Dt){Qe(Et);continue}const vt=Ot(Dt,mt),ct=Ot(Dt,mt,!0);if(vt in Fe&&ct in xe&&Fe[vt]!==xe[ct]){const Gt=Mt(vt,ct,mt),jt=tt(vt,ct,Te[Gt].geometry);delete xe[vt],delete Fe[ct],Fe[Ot(Dt,Te[jt].geometry,!0)]=jt,Te[Gt].geometry=null}else vt in Fe?tt(vt,ct,mt):ct in xe?Mt(vt,ct,mt):(Qe(Et),xe[vt]=De-1,Fe[ct]=De-1)}return Te.filter(Et=>Et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ge,xe)=>ge.sortKey-xe.sortKey)}update(n,c,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,c,this.layers,f),this.icon.programConfigurations.updatePaintArrays(n,c,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,c){const f=this.lineVertexArray.length;if(n.segment!==void 0){let g=n.dist(c[n.segment+1]),w=n.dist(c[n.segment]);const x={};for(let T=n.segment+1;T<c.length;T++)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:g},T<c.length-1&&(g+=c[T+1].dist(c[T]));for(let T=n.segment||0;T>=0;T--)x[T]={x:c[T].x,y:c[T].y,tileUnitDistanceFromAnchor:w},T>0&&(w+=c[T-1].dist(c[T]));for(let T=0;T<c.length;T++){const I=x[T];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(n,c,f,g,w,x,T,I,P,N,U,H){const J=n.indexArray,te=n.layoutVertexArray,he=n.segments.prepareSegment(4*c.length,te,J,this.canOverlap?x.sortKey:void 0),ge=this.glyphOffsetArray.length,xe=he.vertexLength,Fe=this.allowVerticalPlacement&&T===d.ah.vertical?Math.PI/2:0,Te=x.text&&x.text.sections;for(let De=0;De<c.length;De++){const{tl:Qe,tr:tt,bl:Mt,br:Ot,tex:Et,pixelOffsetTL:wt,pixelOffsetBR:mt,minFontScaleX:Dt,minFontScaleY:vt,glyphOffset:ct,isSDF:Gt,sectionIndex:jt}=c[De],mi=he.vertexLength,Wi=ct[1];Gh(te,I.x,I.y,Qe.x,Wi+Qe.y,Et.x,Et.y,f,Gt,wt.x,wt.y,Dt,vt),Gh(te,I.x,I.y,tt.x,Wi+tt.y,Et.x+Et.w,Et.y,f,Gt,mt.x,wt.y,Dt,vt),Gh(te,I.x,I.y,Mt.x,Wi+Mt.y,Et.x,Et.y+Et.h,f,Gt,wt.x,mt.y,Dt,vt),Gh(te,I.x,I.y,Ot.x,Wi+Ot.y,Et.x+Et.w,Et.y+Et.h,f,Gt,mt.x,mt.y,Dt,vt),Cf(n.dynamicLayoutVertexArray,I,Fe),J.emplaceBack(mi,mi+1,mi+2),J.emplaceBack(mi+1,mi+2,mi+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ct[0]),De!==c.length-1&&jt===c[De+1].sectionIndex||n.programConfigurations.populatePaintArrays(te.length,x,x.index,{},H,Te&&Te[jt])}n.placedSymbolArray.emplaceBack(I.x,I.y,ge,this.glyphOffsetArray.length-ge,xe,P,N,I.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],T,0,!1,0,U)}_addCollisionDebugVertex(n,c,f,g,w,x){return c.emplaceBack(0,0),n.emplaceBack(f.x,f.y,g,w,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(n,c,f,g,w,x,T){const I=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),P=I.vertexLength,N=w.layoutVertexArray,U=w.collisionVertexArray,H=T.anchorX,J=T.anchorY;this._addCollisionDebugVertex(N,U,x,H,J,new S(n,c)),this._addCollisionDebugVertex(N,U,x,H,J,new S(f,c)),this._addCollisionDebugVertex(N,U,x,H,J,new S(f,g)),this._addCollisionDebugVertex(N,U,x,H,J,new S(n,g)),I.vertexLength+=4;const te=w.indexArray;te.emplaceBack(P,P+1),te.emplaceBack(P+1,P+2),te.emplaceBack(P+2,P+3),te.emplaceBack(P+3,P),I.primitiveLength+=4}addDebugCollisionBoxes(n,c,f,g){for(let w=n;w<c;w++){const x=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Mf(Ge,xm.members,nt),this.iconCollisionBox=new Mf(Ge,xm.members,nt);for(let n=0;n<this.symbolInstances.length;n++){const c=this.symbolInstances.get(n);this.addDebugCollisionBoxes(c.textBoxStartIndex,c.textBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c,!0),this.addDebugCollisionBoxes(c.iconBoxStartIndex,c.iconBoxEndIndex,c,!1),this.addDebugCollisionBoxes(c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex,c,!1)}}_deserializeCollisionBoxesForSymbol(n,c,f,g,w,x,T,I,P){const N={};for(let U=c;U<f;U++){const H=n.get(U);N.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},N.textFeatureIndex=H.featureIndex;break}for(let U=g;U<w;U++){const H=n.get(U);N.verticalTextBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},N.verticalTextFeatureIndex=H.featureIndex;break}for(let U=x;U<T;U++){const H=n.get(U);N.iconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},N.iconFeatureIndex=H.featureIndex;break}for(let U=I;U<P;U++){const H=n.get(U);N.verticalIconBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},N.verticalIconFeatureIndex=H.featureIndex;break}return N}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let c=0;c<this.symbolInstances.length;c++){const f=this.symbolInstances.get(c);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,c){const f=n.placedSymbolArray.get(c),g=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<g;w+=4)n.indexArray.emplaceBack(w,w+1,w+2),n.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const c=Math.sin(n),f=Math.cos(n),g=[],w=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const I=this.symbolInstances.get(T);g.push(0|Math.round(c*I.anchorX+f*I.anchorY)),w.push(I.featureIndex)}return x.sort((T,I)=>g[T]-g[I]||w[I]-w[T]),x}addToSortKeyRanges(n,c){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===c?f.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:c,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const c of this.symbolInstanceIndexes){const f=this.symbolInstances.get(c);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,w,x)=>{g>=0&&x.indexOf(g)===w&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Nm,jm;Pt("SymbolBucket",Rl,{omit:["layers","collisionBoxArray","features","compareText"]}),Rl.MAX_GLYPHS=65535,Rl.addDynamicAttributes=Cf;var If={get paint(){return jm=jm||new kr({"icon-opacity":new Wt(we.paint_symbol["icon-opacity"]),"icon-color":new Wt(we.paint_symbol["icon-color"]),"icon-halo-color":new Wt(we.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wt(we.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wt(we.paint_symbol["icon-halo-blur"]),"icon-translate":new Ut(we.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ut(we.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wt(we.paint_symbol["text-opacity"]),"text-color":new Wt(we.paint_symbol["text-color"],{runtimeType:$i,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Wt(we.paint_symbol["text-halo-color"]),"text-halo-width":new Wt(we.paint_symbol["text-halo-width"]),"text-halo-blur":new Wt(we.paint_symbol["text-halo-blur"]),"text-translate":new Ut(we.paint_symbol["text-translate"]),"text-translate-anchor":new Ut(we.paint_symbol["text-translate-anchor"])})},get layout(){return Nm=Nm||new kr({"symbol-placement":new Ut(we.layout_symbol["symbol-placement"]),"symbol-spacing":new Ut(we.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ut(we.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wt(we.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ut(we.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ut(we.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ut(we.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ut(we.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ut(we.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ut(we.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wt(we.layout_symbol["icon-size"]),"icon-text-fit":new Ut(we.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ut(we.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wt(we.layout_symbol["icon-image"]),"icon-rotate":new Wt(we.layout_symbol["icon-rotate"]),"icon-padding":new Wt(we.layout_symbol["icon-padding"]),"icon-keep-upright":new Ut(we.layout_symbol["icon-keep-upright"]),"icon-offset":new Wt(we.layout_symbol["icon-offset"]),"icon-anchor":new Wt(we.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ut(we.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ut(we.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ut(we.layout_symbol["text-rotation-alignment"]),"text-field":new Wt(we.layout_symbol["text-field"]),"text-font":new Wt(we.layout_symbol["text-font"]),"text-size":new Wt(we.layout_symbol["text-size"]),"text-max-width":new Wt(we.layout_symbol["text-max-width"]),"text-line-height":new Ut(we.layout_symbol["text-line-height"]),"text-letter-spacing":new Wt(we.layout_symbol["text-letter-spacing"]),"text-justify":new Wt(we.layout_symbol["text-justify"]),"text-radial-offset":new Wt(we.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ut(we.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Wt(we.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Wt(we.layout_symbol["text-anchor"]),"text-max-angle":new Ut(we.layout_symbol["text-max-angle"]),"text-writing-mode":new Ut(we.layout_symbol["text-writing-mode"]),"text-rotate":new Wt(we.layout_symbol["text-rotate"]),"text-padding":new Ut(we.layout_symbol["text-padding"]),"text-keep-upright":new Ut(we.layout_symbol["text-keep-upright"]),"text-transform":new Wt(we.layout_symbol["text-transform"]),"text-offset":new Wt(we.layout_symbol["text-offset"]),"text-allow-overlap":new Ut(we.layout_symbol["text-allow-overlap"]),"text-overlap":new Ut(we.layout_symbol["text-overlap"]),"text-ignore-placement":new Ut(we.layout_symbol["text-ignore-placement"]),"text-optional":new Ut(we.layout_symbol["text-optional"])})}};class Um{constructor(n){if(n.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=n.property.overrides?n.property.overrides.runtimeType:Vi,this.defaultValue=n}evaluate(n){if(n.formattedSection){const c=this.defaultValue.property.overrides;if(c&&c.hasOverride(n.formattedSection))return c.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Pt("FormatSectionOverride",Um,{omit:["defaultValue"]});class Wh extends oo{constructor(n){super(n,If)}recalculate(n,c){if(super.recalculate(n,c),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const w of f)g.indexOf(w)<0&&g.push(w);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(n,c,f,g){const w=this.layout.get(n).evaluate(c,{},f,g),x=this._unevaluatedLayout._values[n];return x.isDataDriven()||qi(x.value)||!w?w:function(T,I){return I.replace(/{([^{}]+)}/g,(P,N)=>T&&N in T?String(T[N]):"")}(c.properties,w)}createBucket(n){return new Rl(n)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const n of If.paint.overridableProperties){if(!Wh.hasPaintOverride(this.layout,n))continue;const c=this.paint.get(n),f=new Um(c),g=new Gi(f,c.property.specification);let w=null;w=c.value.kind==="constant"||c.value.kind==="source"?new rl("source",g):new wc("composite",g,c.value.zoomStops),this.paint._values[n]=new ro(c.property,w,c.parameters)}}_handleOverridablePaintPropertyUpdate(n,c,f){return!(!this.layout||c.isDataDriven()||f.isDataDriven())&&Wh.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,c){const f=n.get("text-field"),g=If.paint.properties[c];let w=!1;const x=T=>{for(const I of T)if(g.overrides&&g.overrides.hasOverride(I))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof zr)x(f.value.value.sections);else if(f.value.kind==="source"){const T=P=>{w||(P instanceof Zo&&Ln(P.value)===un?x(P.value.sections):P instanceof il?x(P.sections):P.eachChild(T))},I=f.value;I._styleExpression&&T(I._styleExpression.expression)}return w}}let Vm;var xv={get paint(){return Vm=Vm||new kr({"background-color":new Ut(we.paint_background["background-color"]),"background-pattern":new ka(we.paint_background["background-pattern"]),"background-opacity":new Ut(we.paint_background["background-opacity"])})}};class kv extends oo{constructor(n){super(n,xv)}}let $m;var Sv={get paint(){return $m=$m||new kr({"raster-opacity":new Ut(we.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ut(we.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ut(we.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ut(we.paint_raster["raster-brightness-max"]),"raster-saturation":new Ut(we.paint_raster["raster-saturation"]),"raster-contrast":new Ut(we.paint_raster["raster-contrast"]),"raster-resampling":new Ut(we.paint_raster["raster-resampling"]),"raster-fade-duration":new Ut(we.paint_raster["raster-fade-duration"])})}};class Tv extends oo{constructor(n){super(n,Sv)}}class Cv extends oo{constructor(n){super(n,{}),this.onAdd=c=>{this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},this.onRemove=c=>{this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Ev{constructor(n){this._methodToThrottle=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Lf=63710088e-1;class Ws{constructor(n,c){if(isNaN(n)||isNaN(c))throw new Error(`Invalid LngLat object: (${n}, ${c})`);if(this.lng=+n,this.lat=+c,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ws(ce(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const c=Math.PI/180,f=this.lat*c,g=n.lat*c,w=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((n.lng-this.lng)*c);return Lf*Math.acos(Math.min(w,1))}static convert(n){if(n instanceof Ws)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Ws(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Ws(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const qm=2*Math.PI*Lf;function Zm(s){return qm*Math.cos(s*Math.PI/180)}function Gm(s){return(180+s)/360}function Wm(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Hm(s,n){return s/Zm(n)}function Af(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Hh{constructor(n,c,f=0){this.x=+n,this.y=+c,this.z=+f}static fromLngLat(n,c=0){const f=Ws.convert(n);return new Hh(Gm(f.lng),Wm(f.lat),Hm(c,f.lat))}toLngLat(){return new Ws(360*this.x-180,Af(this.y))}toAltitude(){return this.z*Zm(Af(this.y))}meterInMercatorCoordinateUnits(){return 1/qm*(n=Af(this.y),1/Math.cos(n*Math.PI/180));var n}}function Xm(s,n,c){var f=2*Math.PI*6378137/256/Math.pow(2,c);return[s*f-2*Math.PI*6378137/2,n*f-2*Math.PI*6378137/2]}class Pf{constructor(n,c,f){if(n<0||n>25||f<0||f>=Math.pow(2,n)||c<0||c>=Math.pow(2,n))throw new Error(`x=${c}, y=${f}, z=${n} outside of bounds. 0<=x<${Math.pow(2,n)}, 0<=y<${Math.pow(2,n)} 0<=z<=25 `);this.z=n,this.x=c,this.y=f,this.key=ou(0,n,n,c,f)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,c,f){const g=(x=this.y,T=this.z,I=Xm(256*(w=this.x),256*(x=Math.pow(2,T)-x-1),T),P=Xm(256*(w+1),256*(x+1),T),I[0]+","+I[1]+","+P[0]+","+P[1]);var w,x,T,I,P;const N=function(U,H,J){let te,he="";for(let ge=U;ge>0;ge--)te=1<<ge-1,he+=(H&te?1:0)+(J&te?2:0);return he}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,c>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,g)}isChildOf(n){const c=this.z-n.z;return c>0&&n.x===this.x>>c&&n.y===this.y>>c}getTilePoint(n){const c=Math.pow(2,this.z);return new S((n.x*c-this.x)*_n,(n.y*c-this.y)*_n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Km{constructor(n,c){this.wrap=n,this.canonical=c,this.key=ou(n,c.z,c.z,c.x,c.y)}}class ao{constructor(n,c,f,g,w){if(n<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${n}; z = ${f}`);this.overscaledZ=n,this.wrap=c,this.canonical=new Pf(f,+g,+w),this.key=ou(c,n,f,g,w)}clone(){return new ao(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const c=this.canonical.z-n;return n>this.canonical.z?new ao(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ao(n,this.wrap,n,this.canonical.x>>c,this.canonical.y>>c)}calculateScaledKey(n,c){if(n>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${n}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-n;return n>this.canonical.z?ou(this.wrap*+c,n,this.canonical.z,this.canonical.x,this.canonical.y):ou(this.wrap*+c,n,n,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(n){if(n.wrap!==this.wrap)return!1;const c=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>c&&n.canonical.y===this.canonical.y>>c}children(n){if(this.overscaledZ>=n)return[new ao(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const c=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new ao(c,this.wrap,c,f,g),new ao(c,this.wrap,c,f+1,g),new ao(c,this.wrap,c,f,g+1),new ao(c,this.wrap,c,f+1,g+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new ao(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new ao(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Km(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(n){return this.canonical.getTilePoint(new Hh(n.x-this.wrap,n.y))}}function ou(s,n,c,f,g){(s*=2)<0&&(s=-1*s-1);const w=1<<c;return(w*w*s+w*g+f).toString(36)+c.toString(36)+n.toString(36)}Pt("CanonicalTileID",Pf),Pt("OverscaledTileID",ao,{omit:["posMatrix"]});class Jm{constructor(n,c,f,g=1,w=1,x=1,T=0){if(this.uid=n,c.height!==c.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Je(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=c.height;const I=this.dim=c.height-2;switch(this.data=new Uint32Array(c.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=w,this.blueFactor=x,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let P=0;P<I;P++)this.data[this._idx(-1,P)]=this.data[this._idx(0,P)],this.data[this._idx(I,P)]=this.data[this._idx(I-1,P)],this.data[this._idx(P,-1)]=this.data[this._idx(P,0)],this.data[this._idx(P,I)]=this.data[this._idx(P,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let P=0;P<I;P++)for(let N=0;N<I;N++){const U=this.get(P,N);U>this.max&&(this.max=U),U<this.min&&(this.min=U)}}get(n,c){const f=new Uint8Array(this.data.buffer),g=4*this._idx(n,c);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(n,c){if(n<-1||n>=this.dim+1||c<-1||c>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(c+1)*this.stride+(n+1)}unpack(n,c,f){return n*this.redFactor+c*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new so({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(n,c,f){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let g=c*this.dim,w=c*this.dim+this.dim,x=f*this.dim,T=f*this.dim+this.dim;switch(c){case-1:g=w-1;break;case 1:w=g+1}switch(f){case-1:x=T-1;break;case 1:T=x+1}const I=-c*this.dim,P=-f*this.dim;for(let N=x;N<T;N++)for(let U=g;U<w;U++)this.data[this._idx(U,N)]=n.data[this._idx(U+I,N+P)]}}Pt("DEMData",Jm);class Ym{constructor(n){this._stringToNumber={},this._numberToString=[];for(let c=0;c<n.length;c++){const f=n[c];this._stringToNumber[f]=c,this._numberToString[c]=f}}encode(n){return this._stringToNumber[n]}decode(n){if(n>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${n} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[n]}}class Qm{constructor(n,c,f,g,w){this.type="Feature",this._vectorTileFeature=n,n._z=c,n._x=f,n._y=g,this.properties=n.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={geometry:this.geometry};for(const c in this)c!=="_geometry"&&c!=="_vectorTileFeature"&&(n[c]=this[c]);return n}}class eg{constructor(n,c){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new ba(_n,16,0),this.grid3D=new ba(_n,16,0),this.featureIndexArray=new $,this.promoteId=c}insert(n,c,f,g,w,x){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,w);const I=x?this.grid3D:this.grid;for(let P=0;P<c.length;P++){const N=c[P],U=[1/0,1/0,-1/0,-1/0];for(let H=0;H<N.length;H++){const J=N[H];U[0]=Math.min(U[0],J.x),U[1]=Math.min(U[1],J.y),U[2]=Math.max(U[2],J.x),U[3]=Math.max(U[3],J.y)}U[0]<_n&&U[1]<_n&&U[2]>=0&&U[3]>=0&&I.insert(T,U[0],U[1],U[2],U[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new qs.VectorTile(new bf(this.rawTileData)).layers,this.sourceLayerCoder=new Ym(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(n,c,f,g){this.loadVTLayers();const w=n.params||{},x=_n/n.tileSize/n.scale,T=ll(w.filter),I=n.queryGeometry,P=n.queryPadding*x,N=ig(I),U=this.grid.query(N.minX-P,N.minY-P,N.maxX+P,N.maxY+P),H=ig(n.cameraQueryGeometry),J=this.grid3D.query(H.minX-P,H.minY-P,H.maxX+P,H.maxY+P,(ge,xe,Fe,Te)=>function(De,Qe,tt,Mt,Ot){for(const wt of De)if(Qe<=wt.x&&tt<=wt.y&&Mt>=wt.x&&Ot>=wt.y)return!0;const Et=[new S(Qe,tt),new S(Qe,Ot),new S(Mt,Ot),new S(Mt,tt)];if(De.length>2){for(const wt of Et)if(Ml(De,wt))return!0}for(let wt=0;wt<De.length-1;wt++)if(o1(De[wt],De[wt+1],Et))return!0;return!1}(n.cameraQueryGeometry,ge-P,xe-P,Fe+P,Te+P));for(const ge of J)U.push(ge);U.sort(Mv);const te={};let he;for(let ge=0;ge<U.length;ge++){const xe=U[ge];if(xe===he)continue;he=xe;const Fe=this.featureIndexArray.get(xe);let Te=null;this.loadMatchingFeature(te,Fe.bucketIndex,Fe.sourceLayerIndex,Fe.featureIndex,T,w.layers,w.availableImages,c,f,g,(De,Qe,tt)=>(Te||(Te=ds(De)),Qe.queryIntersectsFeature(I,De,tt,Te,this.z,n.transform,x,n.pixelPosMatrix)))}return te}loadMatchingFeature(n,c,f,g,w,x,T,I,P,N,U){const H=this.bucketLayerIDs[c];if(x&&!function(ge,xe){for(let Fe=0;Fe<ge.length;Fe++)if(xe.indexOf(ge[Fe])>=0)return!0;return!1}(x,H))return;const J=this.sourceLayerCoder.decode(f),te=this.vtLayers[J].feature(g);if(w.needGeometry){const ge=fs(te,!0);if(!w.filter(new Qi(this.tileID.overscaledZ),ge,this.tileID.canonical))return}else if(!w.filter(new Qi(this.tileID.overscaledZ),te))return;const he=this.getId(te,J);for(let ge=0;ge<H.length;ge++){const xe=H[ge];if(x&&x.indexOf(xe)<0)continue;const Fe=I[xe];if(!Fe)continue;let Te={};he&&N&&(Te=N.getState(Fe.sourceLayer||"_geojsonTileLayer",he));const De=Z({},P[xe]);De.paint=tg(De.paint,Fe.paint,te,Te,T),De.layout=tg(De.layout,Fe.layout,te,Te,T);const Qe=!U||U(te,Fe,Te);if(!Qe)continue;const tt=new Qm(te,this.z,this.x,this.y,he);tt.layer=De;let Mt=n[xe];Mt===void 0&&(Mt=n[xe]=[]),Mt.push({featureIndex:g,feature:tt,intersectionZ:Qe})}}lookupSymbolFeatures(n,c,f,g,w,x,T,I){const P={};this.loadVTLayers();const N=ll(w);for(const U of n)this.loadMatchingFeature(P,f,g,U,N,x,T,I,c);return P}hasLayer(n){for(const c of this.bucketLayerIDs)for(const f of c)if(n===f)return!0;return!1}getId(n,c){let f=n.id;return this.promoteId&&(f=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[c]],typeof f=="boolean"&&(f=Number(f))),f}}function tg(s,n,c,f,g){return ye(s,(w,x)=>{const T=n instanceof xa?n.get(x):null;return T&&T.evaluate?T.evaluate(c,f,g):T})}function ig(s){let n=1/0,c=1/0,f=-1/0,g=-1/0;for(const w of s)n=Math.min(n,w.x),c=Math.min(c,w.y),f=Math.max(f,w.x),g=Math.max(g,w.y);return{minX:n,minY:c,maxX:f,maxY:g}}function Mv(s,n){return n-s}function ng(s,n,c,f,g){const w=[];for(let x=0;x<s.length;x++){const T=s[x];let I;for(let P=0;P<T.length-1;P++){let N=T[P],U=T[P+1];N.x<n&&U.x<n||(N.x<n?N=new S(n,N.y+(n-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x<n&&(U=new S(n,N.y+(n-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y<c&&U.y<c||(N.y<c?N=new S(N.x+(c-N.y)/(U.y-N.y)*(U.x-N.x),c)._round():U.y<c&&(U=new S(N.x+(c-N.y)/(U.y-N.y)*(U.x-N.x),c)._round()),N.x>=f&&U.x>=f||(N.x>=f?N=new S(f,N.y+(f-N.x)/(U.x-N.x)*(U.y-N.y))._round():U.x>=f&&(U=new S(f,N.y+(f-N.x)/(U.x-N.x)*(U.y-N.y))._round()),N.y>=g&&U.y>=g||(N.y>=g?N=new S(N.x+(g-N.y)/(U.y-N.y)*(U.x-N.x),g)._round():U.y>=g&&(U=new S(N.x+(g-N.y)/(U.y-N.y)*(U.x-N.x),g)._round()),I&&N.equals(I[I.length-1])||(I=[N],w.push(I)),I.push(U)))))}}return w}Pt("FeatureIndex",eg,{omit:["rawTileData","sourceLayerCoder"]});class Hs extends S{constructor(n,c,f,g){super(n,c),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new Hs(this.x,this.y,this.angle,this.segment)}}function rg(s,n,c,f,g){if(n.segment===void 0||c===0)return!0;let w=n,x=n.segment+1,T=0;for(;T>-c/2;){if(x--,x<0)return!1;T-=s[x].dist(w),w=s[x]}T+=s[x].dist(s[x+1]),x++;const I=[];let P=0;for(;T<c/2;){const N=s[x],U=s[x+1];if(!U)return!1;let H=s[x-1].angleTo(N)-N.angleTo(U);for(H=Math.abs((H+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:H}),P+=H;T-I[0].distance>f;)P-=I.shift().angleDelta;if(P>g)return!1;x++,T+=N.dist(U)}return!0}function og(s){let n=0;for(let c=0;c<s.length-1;c++)n+=s[c].dist(s[c+1]);return n}function sg(s,n,c){return s?.6*n*c:0}function ag(s,n){return Math.max(s?s.right-s.left:0,n?n.right-n.left:0)}function Iv(s,n,c,f,g,w){const x=sg(c,g,w),T=ag(c,f)*w;let I=0;const P=og(s)/2;for(let N=0;N<s.length-1;N++){const U=s[N],H=s[N+1],J=U.dist(H);if(I+J>P){const te=(P-I)/J,he=hr.number(U.x,H.x,te),ge=hr.number(U.y,H.y,te),xe=new Hs(he,ge,H.angleTo(U),N);return xe._round(),!x||rg(s,xe,T,x,n)?xe:void 0}I+=J}}function Lv(s,n,c,f,g,w,x,T,I){const P=sg(f,w,x),N=ag(f,g),U=N*x,H=s[0].x===0||s[0].x===I||s[0].y===0||s[0].y===I;return n-U<n/4&&(n=U+n/4),lg(s,H?n/2*T%n:(N/2+2*w)*x*T%n,n,P,c,U,H,!1,I)}function lg(s,n,c,f,g,w,x,T,I){const P=w/2,N=og(s);let U=0,H=n-c,J=[];for(let te=0;te<s.length-1;te++){const he=s[te],ge=s[te+1],xe=he.dist(ge),Fe=ge.angleTo(he);for(;H+c<U+xe;){H+=c;const Te=(H-U)/xe,De=hr.number(he.x,ge.x,Te),Qe=hr.number(he.y,ge.y,Te);if(De>=0&&De<I&&Qe>=0&&Qe<I&&H-P>=0&&H+P<=N){const tt=new Hs(De,Qe,Fe,te);tt._round(),f&&!rg(s,tt,w,f,g)||J.push(tt)}}U+=xe}return T||J.length||x||(J=lg(s,U/2,c,f,g,w,x,!0,I)),J}Pt("Anchor",Hs);const Bl=Or;function cg(s,n,c,f){const g=[],w=s.image,x=w.pixelRatio,T=w.paddedRect.w-2*Bl,I=w.paddedRect.h-2*Bl,P=s.right-s.left,N=s.bottom-s.top,U=w.stretchX||[[0,T]],H=w.stretchY||[[0,I]],J=(mt,Dt)=>mt+Dt[1]-Dt[0],te=U.reduce(J,0),he=H.reduce(J,0),ge=T-te,xe=I-he;let Fe=0,Te=te,De=0,Qe=he,tt=0,Mt=ge,Ot=0,Et=xe;if(w.content&&f){const mt=w.content;Fe=Xh(U,0,mt[0]),De=Xh(H,0,mt[1]),Te=Xh(U,mt[0],mt[2]),Qe=Xh(H,mt[1],mt[3]),tt=mt[0]-Fe,Ot=mt[1]-De,Mt=mt[2]-mt[0]-Te,Et=mt[3]-mt[1]-Qe}const wt=(mt,Dt,vt,ct)=>{const Gt=Kh(mt.stretch-Fe,Te,P,s.left),jt=Jh(mt.fixed-tt,Mt,mt.stretch,te),mi=Kh(Dt.stretch-De,Qe,N,s.top),Wi=Jh(Dt.fixed-Ot,Et,Dt.stretch,he),tn=Kh(vt.stretch-Fe,Te,P,s.left),Vn=Jh(vt.fixed-tt,Mt,vt.stretch,te),Yr=Kh(ct.stretch-De,Qe,N,s.top),Tr=Jh(ct.fixed-Ot,Et,ct.stretch,he),Dn=new S(Gt,mi),Yn=new S(tn,mi),or=new S(tn,Yr),Cr=new S(Gt,Yr),Er=new S(jt/x,Wi/x),$n=new S(Vn/x,Tr/x),qn=n*Math.PI/180;if(qn){const pr=Math.sin(qn),Nr=Math.cos(qn),jr=[Nr,-pr,pr,Nr];Dn._matMult(jr),Yn._matMult(jr),Cr._matMult(jr),or._matMult(jr)}const fr=mt.stretch+mt.fixed,Mr=Dt.stretch+Dt.fixed;return{tl:Dn,tr:Yn,bl:Cr,br:or,tex:{x:w.paddedRect.x+Bl+fr,y:w.paddedRect.y+Bl+Mr,w:vt.stretch+vt.fixed-fr,h:ct.stretch+ct.fixed-Mr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Er,pixelOffsetBR:$n,minFontScaleX:Mt/x/P,minFontScaleY:Et/x/N,isSDF:c}};if(f&&(w.stretchX||w.stretchY)){const mt=ug(U,ge,te),Dt=ug(H,xe,he);for(let vt=0;vt<mt.length-1;vt++){const ct=mt[vt],Gt=mt[vt+1];for(let jt=0;jt<Dt.length-1;jt++)g.push(wt(ct,Dt[jt],Gt,Dt[jt+1]))}}else g.push(wt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return g}function Xh(s,n,c){let f=0;for(const g of s)f+=Math.max(n,Math.min(c,g[1]))-Math.max(n,Math.min(c,g[0]));return f}function ug(s,n,c){const f=[{fixed:-Bl,stretch:0}];for(const[g,w]of s){const x=f[f.length-1];f.push({fixed:g-x.stretch,stretch:x.stretch}),f.push({fixed:g-x.stretch,stretch:x.stretch+(w-g)})}return f.push({fixed:n+Bl,stretch:c}),f}function Kh(s,n,c,f){return s/n*c+f}function Jh(s,n,c,f){return s-n*c/f}class Yh{constructor(n,c,f,g,w,x,T,I,P,N){if(this.boxStartIndex=n.length,P){let U=x.top,H=x.bottom;const J=x.collisionPadding;J&&(U-=J[1],H+=J[3]);let te=H-U;te>0&&(te=Math.max(10,te),this.circleDiameter=te)}else{let U=x.top*T-I[0],H=x.bottom*T+I[2],J=x.left*T-I[3],te=x.right*T+I[1];const he=x.collisionPadding;if(he&&(J-=he[0]*T,U-=he[1]*T,te+=he[2]*T,H+=he[3]*T),N){const ge=new S(J,U),xe=new S(te,U),Fe=new S(J,H),Te=new S(te,H),De=N*Math.PI/180;ge._rotate(De),xe._rotate(De),Fe._rotate(De),Te._rotate(De),J=Math.min(ge.x,xe.x,Fe.x,Te.x),te=Math.max(ge.x,xe.x,Fe.x,Te.x),U=Math.min(ge.y,xe.y,Fe.y,Te.y),H=Math.max(ge.y,xe.y,Fe.y,Te.y)}n.emplaceBack(c.x,c.y,J,U,te,H,f,g,w)}this.boxEndIndex=n.length}}class Av{constructor(n=[],c=Pv){if(this.data=n,this.length=this.data.length,this.compare=c,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],c=this.data.pop();return this.length--,this.length>0&&(this.data[0]=c,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:c,compare:f}=this,g=c[n];for(;n>0;){const w=n-1>>1,x=c[w];if(f(g,x)>=0)break;c[n]=x,n=w}c[n]=g}_down(n){const{data:c,compare:f}=this,g=this.length>>1,w=c[n];for(;n<g;){let x=1+(n<<1),T=c[x];const I=x+1;if(I<this.length&&f(c[I],T)<0&&(x=I,T=c[I]),f(T,w)>=0)break;c[n]=T,n=x}c[n]=w}}function Pv(s,n){return s<n?-1:s>n?1:0}function zv(s,n=1,c=!1){let f=1/0,g=1/0,w=-1/0,x=-1/0;const T=s[0];for(let J=0;J<T.length;J++){const te=T[J];(!J||te.x<f)&&(f=te.x),(!J||te.y<g)&&(g=te.y),(!J||te.x>w)&&(w=te.x),(!J||te.y>x)&&(x=te.y)}const I=Math.min(w-f,x-g);let P=I/2;const N=new Av([],Dv);if(I===0)return new S(f,g);for(let J=f;J<w;J+=I)for(let te=g;te<x;te+=I)N.push(new Fl(J+P,te+P,P,s));let U=function(J){let te=0,he=0,ge=0;const xe=J[0];for(let Fe=0,Te=xe.length,De=Te-1;Fe<Te;De=Fe++){const Qe=xe[Fe],tt=xe[De],Mt=Qe.x*tt.y-tt.x*Qe.y;he+=(Qe.x+tt.x)*Mt,ge+=(Qe.y+tt.y)*Mt,te+=3*Mt}return new Fl(he/te,ge/te,0,J)}(s),H=N.length;for(;N.length;){const J=N.pop();(J.d>U.d||!U.d)&&(U=J,c&&console.log("found best %d after %d probes",Math.round(1e4*J.d)/1e4,H)),J.max-U.d<=n||(P=J.h/2,N.push(new Fl(J.p.x-P,J.p.y-P,P,s)),N.push(new Fl(J.p.x+P,J.p.y-P,P,s)),N.push(new Fl(J.p.x-P,J.p.y+P,P,s)),N.push(new Fl(J.p.x+P,J.p.y+P,P,s)),H+=4)}return c&&(console.log(`num probes: ${H}`),console.log(`best distance: ${U.d}`)),U.p}function Dv(s,n){return n.max-s.max}function Fl(s,n,c,f){this.p=new S(s,n),this.h=c,this.d=function(g,w){let x=!1,T=1/0;for(let I=0;I<w.length;I++){const P=w[I];for(let N=0,U=P.length,H=U-1;N<U;H=N++){const J=P[N],te=P[H];J.y>g.y!=te.y>g.y&&g.x<(te.x-J.x)*(g.y-J.y)/(te.y-J.y)+J.x&&(x=!x),T=Math.min(T,Wp(g,J,te))}}return(x?1:-1)*Math.sqrt(T)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var rr;d.ap=void 0,(rr=d.ap||(d.ap={}))[rr.center=1]="center",rr[rr.left=2]="left",rr[rr.right=3]="right",rr[rr.top=4]="top",rr[rr.bottom=5]="bottom",rr[rr["top-left"]=6]="top-left",rr[rr["top-right"]=7]="top-right",rr[rr["bottom-left"]=8]="bottom-left",rr[rr["bottom-right"]=9]="bottom-right";const Xs=7,zf=Number.POSITIVE_INFINITY;function hg(s,n){return n[1]!==zf?function(c,f,g){let w=0,x=0;switch(f=Math.abs(f),g=Math.abs(g),c){case"top-right":case"top-left":case"top":x=g-Xs;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+Xs}switch(c){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,x]}(s,n[0],n[1]):function(c,f){let g=0,w=0;f<0&&(f=0);const x=f/Math.SQRT2;switch(c){case"top-right":case"top-left":w=x-Xs;break;case"bottom-right":case"bottom-left":w=-x+Xs;break;case"bottom":w=-f+Xs;break;case"top":w=f-Xs}switch(c){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=f;break;case"right":g=-f}return[g,w]}(s,n[0])}function dg(s,n,c){var f;const g=s.layout,w=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(n,{},c);if(w){const T=w.values,I=[];for(let P=0;P<T.length;P+=2){const N=I[P]=T[P],U=T[P+1].map(H=>H*Un);N.startsWith("top")?U[1]-=Xs:N.startsWith("bottom")&&(U[1]+=Xs),I[P+1]=U}return new Hr(I)}const x=g.get("text-variable-anchor");if(x){let T;T=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(n,{},c)*Un,zf]:g.get("text-offset").evaluate(n,{},c).map(P=>P*Un);const I=[];for(const P of x)I.push(P,hg(P,T));return new Hr(I)}return null}function Df(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Rv(s,n,c,f,g,w,x,T,I,P,N){let U=w.textMaxSize.evaluate(n,{});U===void 0&&(U=x);const H=s.layers[0].layout,J=H.get("icon-offset").evaluate(n,{},N),te=pg(c.horizontal),he=x/24,ge=s.tilePixelRatio*he,xe=s.tilePixelRatio*U/24,Fe=s.tilePixelRatio*T,Te=s.tilePixelRatio*H.get("symbol-spacing"),De=H.get("text-padding")*s.tilePixelRatio,Qe=function(ct,Gt,jt,mi=1){const Wi=ct.get("icon-padding").evaluate(Gt,{},jt),tn=Wi&&Wi.values;return[tn[0]*mi,tn[1]*mi,tn[2]*mi,tn[3]*mi]}(H,n,N,s.tilePixelRatio),tt=H.get("text-max-angle")/180*Math.PI,Mt=H.get("text-rotation-alignment")!=="viewport"&&H.get("symbol-placement")!=="point",Ot=H.get("icon-rotation-alignment")==="map"&&H.get("symbol-placement")!=="point",Et=H.get("symbol-placement"),wt=Te/2,mt=H.get("icon-text-fit");let Dt;f&&mt!=="none"&&(s.allowVerticalPlacement&&c.vertical&&(Dt=Fm(f,c.vertical,mt,H.get("icon-text-fit-padding"),J,he)),te&&(f=Fm(f,te,mt,H.get("icon-text-fit-padding"),J,he)));const vt=(ct,Gt)=>{Gt.x<0||Gt.x>=_n||Gt.y<0||Gt.y>=_n||function(jt,mi,Wi,tn,Vn,Yr,Tr,Dn,Yn,or,Cr,Er,$n,qn,fr,Mr,pr,Nr,jr,Zn,bi,mr,sr,Gn,wo){const Do=jt.addToLineVertexArray(mi,Wi);let Ro,ms,xo,lo,Ur=0,gs=0,lu=0,yg=0,Vf=-1,$f=-1;const _s={};let vg=pn("");if(jt.allowVerticalPlacement&&tn.vertical){const gr=Dn.layout.get("text-rotate").evaluate(bi,{},Gn)+90;xo=new Yh(Yn,mi,or,Cr,Er,tn.vertical,$n,qn,fr,gr),Tr&&(lo=new Yh(Yn,mi,or,Cr,Er,Tr,pr,Nr,fr,gr))}if(Vn){const gr=Dn.layout.get("icon-rotate").evaluate(bi,{}),co=Dn.layout.get("icon-text-fit")!=="none",Aa=cg(Vn,gr,sr,co),Fo=Tr?cg(Tr,gr,sr,co):void 0;ms=new Yh(Yn,mi,or,Cr,Er,Vn,pr,Nr,!1,gr),Ur=4*Aa.length;const Pa=jt.iconSizeData;let ts=null;Pa.kind==="source"?(ts=[es*Dn.layout.get("icon-size").evaluate(bi,{})],ts[0]>Gs&&Je(`${jt.layerIds[0]}: Value for "icon-size" is >= ${ru}. Reduce your "icon-size".`)):Pa.kind==="composite"&&(ts=[es*mr.compositeIconSizes[0].evaluate(bi,{},Gn),es*mr.compositeIconSizes[1].evaluate(bi,{},Gn)],(ts[0]>Gs||ts[1]>Gs)&&Je(`${jt.layerIds[0]}: Value for "icon-size" is >= ${ru}. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,Aa,ts,Zn,jr,bi,d.ah.none,mi,Do.lineStartIndex,Do.lineLength,-1,Gn),Vf=jt.icon.placedSymbolArray.length-1,Fo&&(gs=4*Fo.length,jt.addSymbols(jt.icon,Fo,ts,Zn,jr,bi,d.ah.vertical,mi,Do.lineStartIndex,Do.lineLength,-1,Gn),$f=jt.icon.placedSymbolArray.length-1)}const bg=Object.keys(tn.horizontal);for(const gr of bg){const co=tn.horizontal[gr];if(!Ro){vg=pn(co.text);const Fo=Dn.layout.get("text-rotate").evaluate(bi,{},Gn);Ro=new Yh(Yn,mi,or,Cr,Er,co,$n,qn,fr,Fo)}const Aa=co.positionedLines.length===1;if(lu+=fg(jt,mi,co,Yr,Dn,fr,bi,Mr,Do,tn.vertical?d.ah.horizontal:d.ah.horizontalOnly,Aa?bg:[gr],_s,Vf,mr,Gn),Aa)break}tn.vertical&&(yg+=fg(jt,mi,tn.vertical,Yr,Dn,fr,bi,Mr,Do,d.ah.vertical,["vertical"],_s,$f,mr,Gn));const Ov=Ro?Ro.boxStartIndex:jt.collisionBoxArray.length,Nv=Ro?Ro.boxEndIndex:jt.collisionBoxArray.length,jv=xo?xo.boxStartIndex:jt.collisionBoxArray.length,Uv=xo?xo.boxEndIndex:jt.collisionBoxArray.length,Vv=ms?ms.boxStartIndex:jt.collisionBoxArray.length,$v=ms?ms.boxEndIndex:jt.collisionBoxArray.length,qv=lo?lo.boxStartIndex:jt.collisionBoxArray.length,Zv=lo?lo.boxEndIndex:jt.collisionBoxArray.length;let Bo=-1;const ed=(gr,co)=>gr&&gr.circleDiameter?Math.max(gr.circleDiameter,co):co;Bo=ed(Ro,Bo),Bo=ed(xo,Bo),Bo=ed(ms,Bo),Bo=ed(lo,Bo);const wg=Bo>-1?1:0;wg&&(Bo*=wo/Un),jt.glyphOffsetArray.length>=Rl.MAX_GLYPHS&&Je("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bi.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,bi.sortKey);const Gv=dg(Dn,bi,Gn),[Wv,Hv]=function(gr,co){const Aa=gr.length,Fo=co==null?void 0:co.values;if((Fo==null?void 0:Fo.length)>0)for(let Pa=0;Pa<Fo.length;Pa+=2){const ts=Fo[Pa+1];gr.emplaceBack(d.ap[Fo[Pa]],ts[0],ts[1])}return[Aa,gr.length]}(jt.textAnchorOffsets,Gv);jt.symbolInstances.emplaceBack(mi.x,mi.y,_s.right>=0?_s.right:-1,_s.center>=0?_s.center:-1,_s.left>=0?_s.left:-1,_s.vertical||-1,Vf,$f,vg,Ov,Nv,jv,Uv,Vv,$v,qv,Zv,or,lu,yg,Ur,gs,wg,0,$n,Bo,Wv,Hv)}(s,Gt,ct,c,f,g,Dt,s.layers[0],s.collisionBoxArray,n.index,n.sourceLayerIndex,s.index,ge,[De,De,De,De],Mt,I,Fe,Qe,Ot,J,n,w,P,N,x)};if(Et==="line")for(const ct of ng(n.geometry,0,0,_n,_n)){const Gt=Lv(ct,Te,tt,c.vertical||te,f,24,xe,s.overscaling,_n);for(const jt of Gt)te&&Bv(s,te.text,wt,jt)||vt(ct,jt)}else if(Et==="line-center"){for(const ct of n.geometry)if(ct.length>1){const Gt=Iv(ct,tt,c.vertical||te,f,24,xe);Gt&&vt(ct,Gt)}}else if(n.type==="Polygon")for(const ct of df(n.geometry,0)){const Gt=zv(ct,16);vt(ct[0],new Hs(Gt.x,Gt.y,0))}else if(n.type==="LineString")for(const ct of n.geometry)vt(ct,new Hs(ct[0].x,ct[0].y,0));else if(n.type==="Point")for(const ct of n.geometry)for(const Gt of ct)vt([Gt],new Hs(Gt.x,Gt.y,0))}function fg(s,n,c,f,g,w,x,T,I,P,N,U,H,J,te){const he=function(Fe,Te,De,Qe,tt,Mt,Ot,Et){const wt=Qe.layout.get("text-rotate").evaluate(Mt,{})*Math.PI/180,mt=[];for(const Dt of Te.positionedLines)for(const vt of Dt.positionedGlyphs){if(!vt.rect)continue;const ct=vt.rect||{};let Gt=Lm+1,jt=!0,mi=1,Wi=0;const tn=(tt||Et)&&vt.vertical,Vn=vt.metrics.advance*vt.scale/2;if(Et&&Te.verticalizable&&(Wi=Dt.lineOffset/2-(vt.imageName?-(Un-vt.metrics.width*vt.scale)/2:(vt.scale-1)*Un)),vt.imageName){const Zn=Ot[vt.imageName];jt=Zn.sdf,mi=Zn.pixelRatio,Gt=Or/mi}const Yr=tt?[vt.x+Vn,vt.y]:[0,0];let Tr=tt?[0,0]:[vt.x+Vn+De[0],vt.y+De[1]-Wi],Dn=[0,0];tn&&(Dn=Tr,Tr=[0,0]);const Yn=vt.metrics.isDoubleResolution?2:1,or=(vt.metrics.left-Gt)*vt.scale-Vn+Tr[0],Cr=(-vt.metrics.top-Gt)*vt.scale+Tr[1],Er=or+ct.w/Yn*vt.scale/mi,$n=Cr+ct.h/Yn*vt.scale/mi,qn=new S(or,Cr),fr=new S(Er,Cr),Mr=new S(or,$n),pr=new S(Er,$n);if(tn){const Zn=new S(-Vn,Vn-iu),bi=-Math.PI/2,mr=Un/2-Vn,sr=new S(5-iu-mr,-(vt.imageName?mr:0)),Gn=new S(...Dn);qn._rotateAround(bi,Zn)._add(sr)._add(Gn),fr._rotateAround(bi,Zn)._add(sr)._add(Gn),Mr._rotateAround(bi,Zn)._add(sr)._add(Gn),pr._rotateAround(bi,Zn)._add(sr)._add(Gn)}if(wt){const Zn=Math.sin(wt),bi=Math.cos(wt),mr=[bi,-Zn,Zn,bi];qn._matMult(mr),fr._matMult(mr),Mr._matMult(mr),pr._matMult(mr)}const Nr=new S(0,0),jr=new S(0,0);mt.push({tl:qn,tr:fr,bl:Mr,br:pr,tex:ct,writingMode:Te.writingMode,glyphOffset:Yr,sectionIndex:vt.sectionIndex,isSDF:jt,pixelOffsetTL:Nr,pixelOffsetBR:jr,minFontScaleX:0,minFontScaleY:0})}return mt}(0,c,T,g,w,x,f,s.allowVerticalPlacement),ge=s.textSizeData;let xe=null;ge.kind==="source"?(xe=[es*g.layout.get("text-size").evaluate(x,{})],xe[0]>Gs&&Je(`${s.layerIds[0]}: Value for "text-size" is >= ${ru}. Reduce your "text-size".`)):ge.kind==="composite"&&(xe=[es*J.compositeTextSizes[0].evaluate(x,{},te),es*J.compositeTextSizes[1].evaluate(x,{},te)],(xe[0]>Gs||xe[1]>Gs)&&Je(`${s.layerIds[0]}: Value for "text-size" is >= ${ru}. Reduce your "text-size".`)),s.addSymbols(s.text,he,xe,T,w,x,P,n,I.lineStartIndex,I.lineLength,H,te);for(const Fe of N)U[Fe]=s.text.placedSymbolArray.length-1;return 4*he.length}function pg(s){for(const n in s)return s[n];return null}function Bv(s,n,c,f){const g=s.compareText;if(n in g){const w=g[n];for(let x=w.length-1;x>=0;x--)if(f.dist(w[x])<c)return!0}else g[n]=[];return g[n].push(f),!1}const mg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Rf{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[c,f]=new Uint8Array(n,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const w=mg[15&f];if(!w)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(n,2,1),[T]=new Uint32Array(n,4,1);return new Rf(T,x,w,n)}constructor(n,c=64,f=Float64Array,g){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=f,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const w=mg.indexOf(this.ArrayType),x=2*n*this.ArrayType.BYTES_PER_ELEMENT,T=n*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-T%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+I,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+x+T+I),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+T+I,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=n)}add(n,c){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=n,this.coords[this._pos++]=c,f}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return Bf(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,c,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:x,nodeSize:T}=this,I=[0,w.length-1,0],P=[];for(;I.length;){const N=I.pop()||0,U=I.pop()||0,H=I.pop()||0;if(U-H<=T){for(let ge=H;ge<=U;ge++){const xe=x[2*ge],Fe=x[2*ge+1];xe>=n&&xe<=f&&Fe>=c&&Fe<=g&&P.push(w[ge])}continue}const J=H+U>>1,te=x[2*J],he=x[2*J+1];te>=n&&te<=f&&he>=c&&he<=g&&P.push(w[J]),(N===0?n<=te:c<=he)&&(I.push(H),I.push(J-1),I.push(1-N)),(N===0?f>=te:g>=he)&&(I.push(J+1),I.push(U),I.push(1-N))}return P}within(n,c,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:w,nodeSize:x}=this,T=[0,g.length-1,0],I=[],P=f*f;for(;T.length;){const N=T.pop()||0,U=T.pop()||0,H=T.pop()||0;if(U-H<=x){for(let ge=H;ge<=U;ge++)_g(w[2*ge],w[2*ge+1],n,c)<=P&&I.push(g[ge]);continue}const J=H+U>>1,te=w[2*J],he=w[2*J+1];_g(te,he,n,c)<=P&&I.push(g[J]),(N===0?n-f<=te:c-f<=he)&&(T.push(H),T.push(J-1),T.push(1-N)),(N===0?n+f>=te:c+f>=he)&&(T.push(J+1),T.push(U),T.push(1-N))}return I}}function Bf(s,n,c,f,g,w){if(g-f<=c)return;const x=f+g>>1;gg(s,n,x,f,g,w),Bf(s,n,c,f,x-1,1-w),Bf(s,n,c,x+1,g,1-w)}function gg(s,n,c,f,g,w){for(;g>f;){if(g-f>600){const P=g-f+1,N=c-f+1,U=Math.log(P),H=.5*Math.exp(2*U/3),J=.5*Math.sqrt(U*H*(P-H)/P)*(N-P/2<0?-1:1);gg(s,n,c,Math.max(f,Math.floor(c-N*H/P+J)),Math.min(g,Math.floor(c+(P-N)*H/P+J)),w)}const x=n[2*c+w];let T=f,I=g;for(su(s,n,f,c),n[2*g+w]>x&&su(s,n,f,g);T<I;){for(su(s,n,T,I),T++,I--;n[2*T+w]<x;)T++;for(;n[2*I+w]>x;)I--}n[2*f+w]===x?su(s,n,f,I):(I++,su(s,n,I,g)),I<=c&&(f=I+1),c<=I&&(g=I-1)}}function su(s,n,c,f){Ff(s,c,f),Ff(n,2*c,2*f),Ff(n,2*c+1,2*f+1)}function Ff(s,n,c){const f=s[n];s[n]=s[c],s[c]=f}function _g(s,n,c,f){const g=s-c,w=n-f;return g*g+w*w}var Of;d.bd=void 0,(Of=d.bd||(d.bd={})).create="create",Of.load="load",Of.fullLoad="fullLoad";let Qh=null,au=[];const Nf=1e3/60,jf="loadTime",Uf="fullLoadTime",Fv={mark(s){performance.mark(s)},frame(s){const n=s;Qh!=null&&au.push(n-Qh),Qh=n},clearMetrics(){Qh=null,au=[],performance.clearMeasures(jf),performance.clearMeasures(Uf);for(const s in d.bd)performance.clearMarks(d.bd[s])},getPerformanceMetrics(){performance.measure(jf,d.bd.create,d.bd.load),performance.measure(Uf,d.bd.create,d.bd.fullLoad);const s=performance.getEntriesByName(jf)[0].duration,n=performance.getEntriesByName(Uf)[0].duration,c=au.length,f=1/(au.reduce((w,x)=>w+x,0)/c/1e3),g=au.filter(w=>w>Nf).reduce((w,x)=>w+(x-Nf)/Nf,0);return{loadTime:s,fullLoadTime:n,fps:f,percentDroppedFrames:g/(c+g)*100,totalFrames:c}}};d.$=_t,d.A=Il,d.B=function(s){if(pt==null){const n=s.navigator?s.navigator.userAgent:null;pt=!!s.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return pt},d.C=class{constructor(s,n){this.target=s,this.mapId=n,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Ev(()=>this.process()),this.subscription=function(c,f,g,w){return c.addEventListener(f,g,!1),{unsubscribe:()=>{c.removeEventListener(f,g,!1)}}}(this.target,"message",c=>this.receive(c)),this.globalScope=bt(self)?s:window}registerMessageHandler(s,n){this.messageHandlers[s]=n}sendAsync(s,n){return new Promise((c,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:c,reject:f},n&&n.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const w=[],x=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:js(s.data,w)});this.target.postMessage(x,{transfer:w})})}receive(s){const n=s.data,c=n.id;if(!(n.origin!=="file://"&&location.origin!=="file://"&&n.origin!==location.origin||n.targetMapId&&this.mapId!==n.targetMapId)){if(n.type==="<cancel>"){delete this.tasks[c];const f=this.abortControllers[c];return delete this.abortControllers[c],void(f&&f.abort())}if(bt(self)||n.mustQueue)return this.tasks[c]=n,this.taskQueue.push(c),void this.invoker.trigger();this.processTask(c,n)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),n=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),n&&this.processTask(s,n)}processTask(s,n){return a(this,void 0,void 0,function*(){if(n.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(n.error?g.reject(Us(n.error)):g.resolve(Us(n.data))):void 0}if(!this.messageHandlers[n.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${n.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const c=Us(n.data),f=new AbortController;this.abortControllers[s]=f;try{const g=yield this.messageHandlers[n.type](n.sourceMapId,c,f);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,n,c){const f=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:n?js(n):null,data:js(c,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},d.D=Ut,d.E=kt,d.F=function(){var s=new Il(16);return Il!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},d.G=hi,d.H=function(s,n,c){var f,g,w,x,T,I,P,N,U,H,J,te,he=c[0],ge=c[1],xe=c[2];return n===s?(s[12]=n[0]*he+n[4]*ge+n[8]*xe+n[12],s[13]=n[1]*he+n[5]*ge+n[9]*xe+n[13],s[14]=n[2]*he+n[6]*ge+n[10]*xe+n[14],s[15]=n[3]*he+n[7]*ge+n[11]*xe+n[15]):(g=n[1],w=n[2],x=n[3],T=n[4],I=n[5],P=n[6],N=n[7],U=n[8],H=n[9],J=n[10],te=n[11],s[0]=f=n[0],s[1]=g,s[2]=w,s[3]=x,s[4]=T,s[5]=I,s[6]=P,s[7]=N,s[8]=U,s[9]=H,s[10]=J,s[11]=te,s[12]=f*he+T*ge+U*xe+n[12],s[13]=g*he+I*ge+H*xe+n[13],s[14]=w*he+P*ge+J*xe+n[14],s[15]=x*he+N*ge+te*xe+n[15]),s},d.I=xf,d.J=function(s,n,c){var f=c[0],g=c[1],w=c[2];return s[0]=n[0]*f,s[1]=n[1]*f,s[2]=n[2]*f,s[3]=n[3]*f,s[4]=n[4]*g,s[5]=n[5]*g,s[6]=n[6]*g,s[7]=n[7]*g,s[8]=n[8]*w,s[9]=n[9]*w,s[10]=n[10]*w,s[11]=n[11]*w,s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},d.K=Jp,d.L=function(s,n){const c={};for(let f=0;f<n.length;f++){const g=n[f];g in s&&(c[g]=s[g])}return c},d.M=Ws,d.N=Gm,d.O=Wm,d.P=S,d.Q=ao,d.R=so,d.S=B,d.T=Ac,d.U=O,d.V=ni,d.W=_n,d.X=kn,d.Y=Hh,d.Z=class extends Dc{},d._=a,d.a=ti,d.a$=function(s,n,c){return s[0]=n[0]*c[0],s[1]=n[1]*c[1],s[2]=n[2]*c[2],s[3]=n[3]*c[3],s},d.a0=Pf,d.a1=ht,d.a2=s=>{const n=window.document.createElement("video");return n.muted=!0,new Promise(c=>{n.onloadstart=()=>{c(n)};for(const f of s){const g=window.document.createElement("source");ut(f)||(n.crossOrigin="Anonymous"),g.src=f,n.appendChild(g)}})},d.a3=function(){return Y++},d.a4=y,d.a5=Rl,d.a6=ll,d.a7=fs,d.a8=Qi,d.a9=Qm,d.aA=ne,d.aB=function(s,n){if(!s)return[{command:"setStyle",args:[n]}];let c=[];try{if(!We(s.version,n.version))return[{command:"setStyle",args:[n]}];We(s.center,n.center)||c.push({command:"setCenter",args:[n.center]}),We(s.zoom,n.zoom)||c.push({command:"setZoom",args:[n.zoom]}),We(s.bearing,n.bearing)||c.push({command:"setBearing",args:[n.bearing]}),We(s.pitch,n.pitch)||c.push({command:"setPitch",args:[n.pitch]}),We(s.sprite,n.sprite)||c.push({command:"setSprite",args:[n.sprite]}),We(s.glyphs,n.glyphs)||c.push({command:"setGlyphs",args:[n.glyphs]}),We(s.transition,n.transition)||c.push({command:"setTransition",args:[n.transition]}),We(s.light,n.light)||c.push({command:"setLight",args:[n.light]}),We(s.terrain,n.terrain)||c.push({command:"setTerrain",args:[n.terrain]}),We(s.sky,n.sky)||c.push({command:"setSky",args:[n.sky]});const f={},g=[];(function(x,T,I,P){let N;for(N in T=T||{},x=x||{})Object.prototype.hasOwnProperty.call(x,N)&&(Object.prototype.hasOwnProperty.call(T,N)||bn(N,I,P));for(N in T)Object.prototype.hasOwnProperty.call(T,N)&&(Object.prototype.hasOwnProperty.call(x,N)?We(x[N],T[N])||(x[N].type==="geojson"&&T[N].type==="geojson"&&tr(x,T,N)?St(I,{command:"setGeoJSONSourceData",args:[N,T[N].data]}):Mn(N,T,I,P)):vn(N,T,I))})(s.sources,n.sources,g,f);const w=[];s.layers&&s.layers.forEach(x=>{"source"in x&&f[x.source]?c.push({command:"removeLayer",args:[x.id]}):w.push(x)}),c=c.concat(g),function(x,T,I){T=T||[];const P=(x=x||[]).map(qo),N=T.map(qo),U=x.reduce(Ji,{}),H=T.reduce(Ji,{}),J=P.slice(),te=Object.create(null);let he,ge,xe,Fe,Te;for(let De=0,Qe=0;De<P.length;De++)he=P[De],Object.prototype.hasOwnProperty.call(H,he)?Qe++:(St(I,{command:"removeLayer",args:[he]}),J.splice(J.indexOf(he,Qe),1));for(let De=0,Qe=0;De<N.length;De++)he=N[N.length-1-De],J[J.length-1-De]!==he&&(Object.prototype.hasOwnProperty.call(U,he)?(St(I,{command:"removeLayer",args:[he]}),J.splice(J.lastIndexOf(he,J.length-Qe),1)):Qe++,Fe=J[J.length-De],St(I,{command:"addLayer",args:[H[he],Fe]}),J.splice(J.length-De,0,he),te[he]=!0);for(let De=0;De<N.length;De++)if(he=N[De],ge=U[he],xe=H[he],!te[he]&&!We(ge,xe))if(We(ge.source,xe.source)&&We(ge["source-layer"],xe["source-layer"])&&We(ge.type,xe.type)){for(Te in ir(ge.layout,xe.layout,I,he,null,"setLayoutProperty"),ir(ge.paint,xe.paint,I,he,null,"setPaintProperty"),We(ge.filter,xe.filter)||St(I,{command:"setFilter",args:[he,xe.filter]}),We(ge.minzoom,xe.minzoom)&&We(ge.maxzoom,xe.maxzoom)||St(I,{command:"setLayerZoomRange",args:[he,xe.minzoom,xe.maxzoom]}),ge)Object.prototype.hasOwnProperty.call(ge,Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?ir(ge[Te],xe[Te],I,he,Te.slice(6),"setPaintProperty"):We(ge[Te],xe[Te])||St(I,{command:"setLayerProperty",args:[he,Te,xe[Te]]}));for(Te in xe)Object.prototype.hasOwnProperty.call(xe,Te)&&!Object.prototype.hasOwnProperty.call(ge,Te)&&Te!=="layout"&&Te!=="paint"&&Te!=="filter"&&Te!=="metadata"&&Te!=="minzoom"&&Te!=="maxzoom"&&(Te.indexOf("paint.")===0?ir(ge[Te],xe[Te],I,he,Te.slice(6),"setPaintProperty"):We(ge[Te],xe[Te])||St(I,{command:"setLayerProperty",args:[he,Te,xe[Te]]}))}else St(I,{command:"removeLayer",args:[he]}),Fe=J[J.lastIndexOf(he)+1],St(I,{command:"addLayer",args:[xe,Fe]})}(w,n.layers,c)}catch(f){console.warn("Unable to compute style diff:",f),c=[{command:"setStyle",args:[n]}]}return c},d.aC=function(s){const n=[],c=s.id;return c===void 0&&n.push({message:`layers.${c}: missing required property "id"`}),s.render===void 0&&n.push({message:`layers.${c}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&n.push({message:`layers.${c}: property "renderingMode" must be either "2d" or "3d"`}),n},d.aD=function s(n,c){if(Array.isArray(n)){if(!Array.isArray(c)||n.length!==c.length)return!1;for(let f=0;f<n.length;f++)if(!s(n[f],c[f]))return!1;return!0}if(typeof n=="object"&&n!==null&&c!==null){if(typeof c!="object"||Object.keys(n).length!==Object.keys(c).length)return!1;for(const f in n)if(!s(n[f],c[f]))return!1;return!0}return n===c},d.aE=ye,d.aF=Oe,d.aG=class extends jn{constructor(s,n){super(s,n),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},d.aH=Fr,d.aI=class extends jn{constructor(s,n){super(s,n),this.current=Ia}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let n=1;n<16;n++)if(s[n]!==this.current[n]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},d.aJ=vo,d.aK=class extends jn{constructor(s,n){super(s,n),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},d.aL=class extends jn{constructor(s,n){super(s,n),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},d.aM=Jo,d.aN=function(s,n,c,f,g,w,x){var T=1/(n-c),I=1/(f-g),P=1/(w-x);return s[0]=-2*T,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*I,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*P,s[11]=0,s[12]=(n+c)*T,s[13]=(g+f)*I,s[14]=(x+w)*P,s[15]=1,s},d.aO=zi,d.aP=a1,d.aQ=class extends wl{},d.aR=tv,d.aS=class extends xl{},d.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},d.aU=im,d.aV=q,d.aW=class extends jc{},d.aX=Ke,d.aY=function(s,n){return s[0]===n[0]&&s[1]===n[1]&&s[2]===n[2]&&s[3]===n[3]&&s[4]===n[4]&&s[5]===n[5]&&s[6]===n[6]&&s[7]===n[7]&&s[8]===n[8]&&s[9]===n[9]&&s[10]===n[10]&&s[11]===n[11]&&s[12]===n[12]&&s[13]===n[13]&&s[14]===n[14]&&s[15]===n[15]},d.aZ=function(s,n){var c=s[0],f=s[1],g=s[2],w=s[3],x=s[4],T=s[5],I=s[6],P=s[7],N=s[8],U=s[9],H=s[10],J=s[11],te=s[12],he=s[13],ge=s[14],xe=s[15],Fe=n[0],Te=n[1],De=n[2],Qe=n[3],tt=n[4],Mt=n[5],Ot=n[6],Et=n[7],wt=n[8],mt=n[9],Dt=n[10],vt=n[11],ct=n[12],Gt=n[13],jt=n[14],mi=n[15];return Math.abs(c-Fe)<=Sr*Math.max(1,Math.abs(c),Math.abs(Fe))&&Math.abs(f-Te)<=Sr*Math.max(1,Math.abs(f),Math.abs(Te))&&Math.abs(g-De)<=Sr*Math.max(1,Math.abs(g),Math.abs(De))&&Math.abs(w-Qe)<=Sr*Math.max(1,Math.abs(w),Math.abs(Qe))&&Math.abs(x-tt)<=Sr*Math.max(1,Math.abs(x),Math.abs(tt))&&Math.abs(T-Mt)<=Sr*Math.max(1,Math.abs(T),Math.abs(Mt))&&Math.abs(I-Ot)<=Sr*Math.max(1,Math.abs(I),Math.abs(Ot))&&Math.abs(P-Et)<=Sr*Math.max(1,Math.abs(P),Math.abs(Et))&&Math.abs(N-wt)<=Sr*Math.max(1,Math.abs(N),Math.abs(wt))&&Math.abs(U-mt)<=Sr*Math.max(1,Math.abs(U),Math.abs(mt))&&Math.abs(H-Dt)<=Sr*Math.max(1,Math.abs(H),Math.abs(Dt))&&Math.abs(J-vt)<=Sr*Math.max(1,Math.abs(J),Math.abs(vt))&&Math.abs(te-ct)<=Sr*Math.max(1,Math.abs(te),Math.abs(ct))&&Math.abs(he-Gt)<=Sr*Math.max(1,Math.abs(he),Math.abs(Gt))&&Math.abs(ge-jt)<=Sr*Math.max(1,Math.abs(ge),Math.abs(jt))&&Math.abs(xe-mi)<=Sr*Math.max(1,Math.abs(xe),Math.abs(mi))},d.a_=function(s,n){return s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[4]=n[4],s[5]=n[5],s[6]=n[6],s[7]=n[7],s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15],s},d.aa=function(s){const n={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(c,f,g,w)=>{const x=g||w;return n[f]=!x||x.toLowerCase(),""}),n["max-age"]){const c=parseInt(n["max-age"],10);isNaN(c)?delete n["max-age"]:n["max-age"]=c}return n},d.ab=function(s,n){const c=[];for(const f in s)f in n||c.push(f);return c},d.ac=se,d.ad=function(s,n,c){var f=Math.sin(c),g=Math.cos(c),w=n[0],x=n[1],T=n[2],I=n[3],P=n[4],N=n[5],U=n[6],H=n[7];return n!==s&&(s[8]=n[8],s[9]=n[9],s[10]=n[10],s[11]=n[11],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[0]=w*g+P*f,s[1]=x*g+N*f,s[2]=T*g+U*f,s[3]=I*g+H*f,s[4]=P*g-w*f,s[5]=N*g-x*f,s[6]=U*g-T*f,s[7]=H*g-I*f,s},d.ae=function(s){var n=new Il(16);return n[0]=s[0],n[1]=s[1],n[2]=s[2],n[3]=s[3],n[4]=s[4],n[5]=s[5],n[6]=s[6],n[7]=s[7],n[8]=s[8],n[9]=s[9],n[10]=s[10],n[11]=s[11],n[12]=s[12],n[13]=s[13],n[14]=s[14],n[15]=s[15],n},d.af=Fh,d.ag=function(s,n){let c=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:w,maxZoom:x}=s,T=g?se(nr.interpolationFactor(g,n,w,x),0,1):0;s.kind==="camera"?f=hr.number(s.minSize,s.maxSize,T):c=T}return{uSizeT:c,uSize:f}},d.ai=function(s,{uSize:n,uSizeT:c},{lowerSize:f,upperSize:g}){return s.kind==="source"?f/es:s.kind==="composite"?hr.number(f/es,g/es,c):n},d.aj=Cf,d.ak=function(s,n,c,f){const g=n.y-s.y,w=n.x-s.x,x=f.y-c.y,T=f.x-c.x,I=x*w-T*g;if(I===0)return null;const P=(T*(s.y-c.y)-x*(s.x-c.x))/I;return new S(s.x+P*w,s.y+P*g)},d.al=ng,d.am=Vc,d.an=of,d.ao=Un,d.aq=Tf,d.ar=function(s,n){var c=n[0],f=n[1],g=n[2],w=n[3],x=n[4],T=n[5],I=n[6],P=n[7],N=n[8],U=n[9],H=n[10],J=n[11],te=n[12],he=n[13],ge=n[14],xe=n[15],Fe=c*T-f*x,Te=c*I-g*x,De=c*P-w*x,Qe=f*I-g*T,tt=f*P-w*T,Mt=g*P-w*I,Ot=N*he-U*te,Et=N*ge-H*te,wt=N*xe-J*te,mt=U*ge-H*he,Dt=U*xe-J*he,vt=H*xe-J*ge,ct=Fe*vt-Te*Dt+De*mt+Qe*wt-tt*Et+Mt*Ot;return ct?(s[0]=(T*vt-I*Dt+P*mt)*(ct=1/ct),s[1]=(g*Dt-f*vt-w*mt)*ct,s[2]=(he*Mt-ge*tt+xe*Qe)*ct,s[3]=(H*tt-U*Mt-J*Qe)*ct,s[4]=(I*wt-x*vt-P*Et)*ct,s[5]=(c*vt-g*wt+w*Et)*ct,s[6]=(ge*De-te*Mt-xe*Te)*ct,s[7]=(N*Mt-H*De+J*Te)*ct,s[8]=(x*Dt-T*wt+P*Ot)*ct,s[9]=(f*wt-c*Dt-w*Ot)*ct,s[10]=(te*tt-he*De+xe*Fe)*ct,s[11]=(U*De-N*tt-J*Fe)*ct,s[12]=(T*Et-x*mt-I*Ot)*ct,s[13]=(c*mt-f*Et+g*Ot)*ct,s[14]=(he*Te-te*Qe-ge*Fe)*ct,s[15]=(N*Qe-U*Te+H*Fe)*ct,s):null},d.as=Df,d.at=Sf,d.au=Rf,d.av=function(){const s={},n=we.$version;for(const c in we.$root){const f=we.$root[c];if(f.required){let g=null;g=c==="version"?n:f.type==="array"?[]:{},g!=null&&(s[c]=g)}}return s},d.aw=kh,d.ax=yi,d.ay=function(s){s=s.slice();const n=Object.create(null);for(let c=0;c<s.length;c++)n[s[c].id]=s[c];for(let c=0;c<s.length;c++)"ref"in s[c]&&(s[c]=Ve(s[c],n[s[c].ref]));return s},d.az=function(s){if(s.type==="custom")return new Cv(s);switch(s.type){case"background":return new kv(s);case"circle":return new l1(s);case"fill":return new M1(s);case"fill-extrusion":return new $1(s);case"heatmap":return new u1(s);case"hillshade":return new d1(s);case"line":return new J1(s);case"raster":return new Tv(s);case"symbol":return new Wh(s)}},d.b=at,d.b0=function(s,n){return s[0]*n[0]+s[1]*n[1]+s[2]*n[2]+s[3]*n[3]},d.b1=ce,d.b2=Km,d.b3=Hm,d.b4=function(s,n,c,f,g){var w,x=1/Math.tan(n/2);return s[0]=x/c,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+f)*(w=1/(f-g)),s[14]=2*g*f*w):(s[10]=-1,s[14]=-2*f),s},d.b5=function(s,n,c){var f=Math.sin(c),g=Math.cos(c),w=n[4],x=n[5],T=n[6],I=n[7],P=n[8],N=n[9],U=n[10],H=n[11];return n!==s&&(s[0]=n[0],s[1]=n[1],s[2]=n[2],s[3]=n[3],s[12]=n[12],s[13]=n[13],s[14]=n[14],s[15]=n[15]),s[4]=w*g+P*f,s[5]=x*g+N*f,s[6]=T*g+U*f,s[7]=I*g+H*f,s[8]=P*g-w*f,s[9]=N*g-x*f,s[10]=U*g-T*f,s[11]=H*g-I*f,s},d.b6=j,d.b7=V,d.b8=function(s){return s*Math.PI/180},d.b9=function(s,n){return s[0]=n[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=n[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},d.bA=Ko,d.ba=class extends Po{},d.bb=Lf,d.bc=Fv,d.be=ki,d.bf=function(s,n){ti.REGISTERED_PROTOCOLS[s]=n},d.bg=function(s){delete ti.REGISTERED_PROTOCOLS[s]},d.bh=function(s,n){const c={};for(let g=0;g<s.length;g++){const w=n&&n[s[g].id]||Qd(s[g]);n&&(n[s[g].id]=w);let x=c[w];x||(x=c[w]=[]),x.push(s[g])}const f=[];for(const g in c)f.push(c[g]);return f},d.bi=Pt,d.bj=Ym,d.bk=eg,d.bl=Pm,d.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=_n/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const n=s.bucket.layers[0],c=n.layout,f=n._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new Qi(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Qi(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Qi(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:P,maxZoom:N}=s.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Qi(P),s.canonical),f["text-size"].possiblyEvaluate(new Qi(N),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:P,maxZoom:N}=s.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Qi(P),s.canonical),f["icon-size"].possiblyEvaluate(new Qi(N),s.canonical)]}const w=c.get("text-line-height")*Un,x=c.get("text-rotation-alignment")!=="viewport"&&c.get("symbol-placement")!=="point",T=c.get("text-keep-upright"),I=c.get("text-size");for(const P of s.bucket.features){const N=c.get("text-font").evaluate(P,{},s.canonical).join(","),U=I.evaluate(P,{},s.canonical),H=g.layoutTextSize.evaluate(P,{},s.canonical),J=g.layoutIconSize.evaluate(P,{},s.canonical),te={horizontal:{},vertical:void 0},he=P.text;let ge,xe=[0,0];if(he){const De=he.toString(),Qe=c.get("text-letter-spacing").evaluate(P,{},s.canonical)*Un,tt=Sh(De)?Qe:0,Mt=c.get("text-anchor").evaluate(P,{},s.canonical),Ot=dg(n,P,s.canonical);if(!Ot){const vt=c.get("text-radial-offset").evaluate(P,{},s.canonical);xe=vt?hg(Mt,[vt*Un,zf]):c.get("text-offset").evaluate(P,{},s.canonical).map(ct=>ct*Un)}let Et=x?"center":c.get("text-justify").evaluate(P,{},s.canonical);const wt=c.get("symbol-placement"),mt=wt==="point"?c.get("text-max-width").evaluate(P,{},s.canonical)*Un:0,Dt=()=>{s.bucket.allowVerticalPlacement&&Vs(De)&&(te.vertical=qh(he,s.glyphMap,s.glyphPositions,s.imagePositions,N,mt,w,Mt,"left",tt,xe,d.ah.vertical,!0,wt,H,U))};if(!x&&Ot){const vt=new Set;if(Et==="auto")for(let Gt=0;Gt<Ot.values.length;Gt+=2)vt.add(Df(Ot.values[Gt]));else vt.add(Et);let ct=!1;for(const Gt of vt)if(!te.horizontal[Gt])if(ct)te.horizontal[Gt]=te.horizontal[0];else{const jt=qh(he,s.glyphMap,s.glyphPositions,s.imagePositions,N,mt,w,"center",Gt,tt,xe,d.ah.horizontal,!1,wt,H,U);jt&&(te.horizontal[Gt]=jt,ct=jt.positionedLines.length===1)}Dt()}else{Et==="auto"&&(Et=Df(Mt));const vt=qh(he,s.glyphMap,s.glyphPositions,s.imagePositions,N,mt,w,Mt,Et,tt,xe,d.ah.horizontal,!1,wt,H,U);vt&&(te.horizontal[Et]=vt),Dt(),Vs(De)&&x&&T&&(te.vertical=qh(he,s.glyphMap,s.glyphPositions,s.imagePositions,N,mt,w,Mt,Et,tt,xe,d.ah.vertical,!1,wt,H,U))}}let Fe=!1;if(P.icon&&P.icon.name){const De=s.imageMap[P.icon.name];De&&(ge=yv(s.imagePositions[P.icon.name],c.get("icon-offset").evaluate(P,{},s.canonical),c.get("icon-anchor").evaluate(P,{},s.canonical)),Fe=!!De.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=Fe:s.bucket.sdfIcons!==Fe&&Je("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(De.pixelRatio!==s.bucket.pixelRatio||c.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const Te=pg(te.horizontal)||te.vertical;s.bucket.iconsInText=!!Te&&Te.iconsInText,(Te||ge)&&Rv(s.bucket,P,te,ge,s.imageMap,g,H,J,xe,Fe,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},d.bn=yf,d.bo=mf,d.bp=_f,d.bq=qs,d.br=bf,d.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},d.bt=function(s,n,c,f,g){return a(this,void 0,void 0,function*(){if(O())try{return yield ni(s,n,c,f,g)}catch{}return function(w,x,T,I,P){const N=w.width,U=w.height;Nt&&zt||(Nt=new OffscreenCanvas(N,U),zt=Nt.getContext("2d",{willReadFrequently:!0})),Nt.width=N,Nt.height=U,zt.drawImage(w,0,0,N,U);const H=zt.getImageData(x,T,I,P);return zt.clearRect(0,0,N,U),H.data}(s,n,c,f,g)})},d.bu=Jm,d.bv=_,d.bw=v,d.bx=km,d.by=as,d.bz=function(s){return s.message===Yt},d.c=It,d.d=s=>a(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const n=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(n)}catch(c){throw new Error(`Could not load image because of ${c.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),d.e=Z,d.f=s=>new Promise((n,c)=>{const f=new Image;f.onload=()=>{n(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Xt})},f.onerror=()=>c(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(g):Xt}),d.g=Zt,d.h=(s,n)=>Pi(Z(s,{type:"json"}),n),d.i=bt,d.j=ot,d.k=je,d.l=(s,n)=>Pi(Z(s,{type:"arrayBuffer"}),n),d.m=Pi,d.n=function(s){return new bf(s).readFields(dv,[])},d.o=Hc,d.p=Am,d.q=kr,d.r=ef,d.s=ut,d.t=Ns,d.u=Ct,d.v=we,d.w=Je,d.x=cs,d.y=function([s,n,c]){return n+=90,n*=Math.PI/180,c*=Math.PI/180,{x:s*Math.cos(n)*Math.sin(c),y:s*Math.sin(n)*Math.sin(c),z:s*Math.cos(c)}},d.z=hr}),l("worker",["./shared"],function(d){class a{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,K){for(const de of W){this._layerConfigs[de.id]=de;const Ae=this._layers[de.id]=d.az(de);Ae._featureFilter=d.a6(Ae.filter),this.keyCache[de.id]&&delete this.keyCache[de.id]}for(const de of K)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const ie=d.bh(Object.values(this._layerConfigs),this.keyCache);for(const de of ie){const Ae=de.map($e=>this._layers[$e.id]),Pe=Ae[0];if(Pe.visibility==="none")continue;const Be=Pe.source||"";let Se=this.familiesBySource[Be];Se||(Se=this.familiesBySource[Be]={});const G=Pe.sourceLayer||"_geojsonTileLayer";let Ue=Se[G];Ue||(Ue=Se[G]=[]),Ue.push(Ae)}}}class _{constructor(W){const K={},ie=[];for(const Be in W){const Se=W[Be],G=K[Be]={};for(const Ue in Se){const $e=Se[+Ue];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const Ze={x:0,y:0,w:$e.bitmap.width+2,h:$e.bitmap.height+2};ie.push(Ze),G[Ue]={rect:Ze,metrics:$e.metrics}}}const{w:de,h:Ae}=d.p(ie),Pe=new d.o({width:de||1,height:Ae||1});for(const Be in W){const Se=W[Be];for(const G in Se){const Ue=Se[+G];if(!Ue||Ue.bitmap.width===0||Ue.bitmap.height===0)continue;const $e=K[Be][G].rect;d.o.copy(Ue.bitmap,Pe,{x:0,y:0},{x:$e.x+1,y:$e.y+1},Ue.bitmap)}}this.image=Pe,this.positions=K}}d.bi("GlyphAtlas",_);class v{constructor(W){this.tileID=new d.Q(W.tileID.overscaledZ,W.tileID.wrap,W.tileID.canonical.z,W.tileID.canonical.x,W.tileID.canonical.y),this.uid=W.uid,this.zoom=W.zoom,this.pixelRatio=W.pixelRatio,this.tileSize=W.tileSize,this.source=W.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=W.showCollisionBoxes,this.collectResourceTiming=!!W.collectResourceTiming,this.returnDependencies=!!W.returnDependencies,this.promoteId=W.promoteId,this.inFlightDependencies=[]}parse(W,K,ie,de){return d._(this,void 0,void 0,function*(){this.status="parsing",this.data=W,this.collisionBoxArray=new d.a4;const Ae=new d.bj(Object.keys(W.layers).sort()),Pe=new d.bk(this.tileID,this.promoteId);Pe.bucketLayerIDs=[];const Be={},Se={featureIndex:Pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ie},G=K.familiesBySource[this.source];for(const li in G){const hn=W.layers[li];if(!hn)continue;hn.version===1&&d.w(`Vector tile source "${this.source}" layer "${li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const On=Ae.encode(li),ur=[];for(let br=0;br<hn.length;br++){const Xn=hn.feature(br),po=Pe.getId(Xn,li);ur.push({feature:Xn,id:po,index:br,sourceLayerIndex:On})}for(const br of G[li]){const Xn=br[0];Xn.source!==this.source&&d.w(`layer.source = ${Xn.source} does not equal this.source = ${this.source}`),Xn.minzoom&&this.zoom<Math.floor(Xn.minzoom)||Xn.maxzoom&&this.zoom>=Xn.maxzoom||Xn.visibility!=="none"&&(k(br,this.zoom,ie),(Be[Xn.id]=Xn.createBucket({index:Pe.bucketLayerIDs.length,layers:br,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:On,sourceID:this.source})).populate(ur,Se,this.tileID.canonical),Pe.bucketLayerIDs.push(br.map(po=>po.id)))}}const Ue=d.aE(Se.glyphDependencies,li=>Object.keys(li).map(Number));this.inFlightDependencies.forEach(li=>li==null?void 0:li.abort()),this.inFlightDependencies=[];let $e=Promise.resolve({});if(Object.keys(Ue).length){const li=new AbortController;this.inFlightDependencies.push(li),$e=de.sendAsync({type:"GG",data:{stacks:Ue,source:this.source,tileID:this.tileID,type:"glyphs"}},li)}const Ze=Object.keys(Se.iconDependencies);let Ye=Promise.resolve({});if(Ze.length){const li=new AbortController;this.inFlightDependencies.push(li),Ye=de.sendAsync({type:"GI",data:{icons:Ze,source:this.source,tileID:this.tileID,type:"icons"}},li)}const dt=Object.keys(Se.patternDependencies);let Ft=Promise.resolve({});if(dt.length){const li=new AbortController;this.inFlightDependencies.push(li),Ft=de.sendAsync({type:"GI",data:{icons:dt,source:this.source,tileID:this.tileID,type:"patterns"}},li)}const[Kt,ai,vi]=yield Promise.all([$e,Ye,Ft]),Yi=new _(Kt),In=new d.bl(ai,vi);for(const li in Be){const hn=Be[li];hn instanceof d.a5?(k(hn.layers,this.zoom,ie),d.bm({bucket:hn,glyphMap:Kt,glyphPositions:Yi.positions,imageMap:ai,imagePositions:In.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):hn.hasPattern&&(hn instanceof d.bn||hn instanceof d.bo||hn instanceof d.bp)&&(k(hn.layers,this.zoom,ie),hn.addFeatures(Se,this.tileID.canonical,In.patternPositions))}return this.status="done",{buckets:Object.values(Be).filter(li=>!li.isEmpty()),featureIndex:Pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yi.image,imageAtlas:In,glyphMap:this.returnDependencies?Kt:null,iconMap:this.returnDependencies?ai:null,glyphPositions:this.returnDependencies?Yi.positions:null}})}}function k(me,W,K){const ie=new d.a8(W);for(const de of me)de.recalculate(ie,K)}class S{constructor(W,K,ie){this.actor=W,this.layerIndex=K,this.availableImages=ie,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(W,K){return d._(this,void 0,void 0,function*(){const ie=yield d.l(W.request,K);try{return{vectorTile:new d.bq.VectorTile(new d.br(ie.data)),rawData:ie.data,cacheControl:ie.cacheControl,expires:ie.expires}}catch(de){const Ae=new Uint8Array(ie.data);let Pe=`Unable to parse the tile at ${W.request.url}, `;throw Pe+=Ae[0]===31&&Ae[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${de.messge}`,new Error(Pe)}})}loadTile(W){return d._(this,void 0,void 0,function*(){const K=W.uid,ie=!!(W&&W.request&&W.request.collectResourceTiming)&&new d.bs(W.request),de=new v(W);this.loading[K]=de;const Ae=new AbortController;de.abort=Ae;try{const Pe=yield this.loadVectorTile(W,Ae);if(delete this.loading[K],!Pe)return null;const Be=Pe.rawData,Se={};Pe.expires&&(Se.expires=Pe.expires),Pe.cacheControl&&(Se.cacheControl=Pe.cacheControl);const G={};if(ie){const $e=ie.finish();$e&&(G.resourceTiming=JSON.parse(JSON.stringify($e)))}de.vectorTile=Pe.vectorTile;const Ue=de.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[K]=de,this.fetching[K]={rawTileData:Be,cacheControl:Se,resourceTiming:G};try{const $e=yield Ue;return d.e({rawTileData:Be.slice(0)},$e,Se,G)}finally{delete this.fetching[K]}}catch(Pe){throw delete this.loading[K],de.status="done",this.loaded[K]=de,Pe}})}reloadTile(W){return d._(this,void 0,void 0,function*(){const K=W.uid;if(!this.loaded||!this.loaded[K])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ie=this.loaded[K];if(ie.showCollisionBoxes=W.showCollisionBoxes,ie.status==="parsing"){const de=yield ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ae;if(this.fetching[K]){const{rawTileData:Pe,cacheControl:Be,resourceTiming:Se}=this.fetching[K];delete this.fetching[K],Ae=d.e({rawTileData:Pe.slice(0)},de,Be,Se)}else Ae=de;return Ae}if(ie.status==="done"&&ie.vectorTile)return ie.parse(ie.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(W){return d._(this,void 0,void 0,function*(){const K=this.loading,ie=W.uid;K&&K[ie]&&K[ie].abort&&(K[ie].abort.abort(),delete K[ie])})}removeTile(W){return d._(this,void 0,void 0,function*(){this.loaded&&this.loaded[W.uid]&&delete this.loaded[W.uid]})}}class E{constructor(){this.loaded={}}loadTile(W){return d._(this,void 0,void 0,function*(){const{uid:K,encoding:ie,rawImageData:de,redFactor:Ae,greenFactor:Pe,blueFactor:Be,baseShift:Se}=W,G=de.width+2,Ue=de.height+2,$e=d.b(de)?new d.R({width:G,height:Ue},yield d.bt(de,-1,-1,G,Ue)):de,Ze=new d.bu(K,$e,ie,Ae,Pe,Be,Se);return this.loaded=this.loaded||{},this.loaded[K]=Ze,Ze})}removeTile(W){const K=this.loaded,ie=W.uid;K&&K[ie]&&delete K[ie]}}function A(me,W){if(me.length!==0){z(me[0],W);for(var K=1;K<me.length;K++)z(me[K],!W)}}function z(me,W){for(var K=0,ie=0,de=0,Ae=me.length,Pe=Ae-1;de<Ae;Pe=de++){var Be=(me[de][0]-me[Pe][0])*(me[Pe][1]+me[de][1]),Se=K+Be;ie+=Math.abs(K)>=Math.abs(Be)?K-Se+Be:Be-Se+K,K=Se}K+ie>=0!=!!W&&me.reverse()}var R=d.bv(function me(W,K){var ie,de=W&&W.type;if(de==="FeatureCollection")for(ie=0;ie<W.features.length;ie++)me(W.features[ie],K);else if(de==="GeometryCollection")for(ie=0;ie<W.geometries.length;ie++)me(W.geometries[ie],K);else if(de==="Feature")me(W.geometry,K);else if(de==="Polygon")A(W.coordinates,K);else if(de==="MultiPolygon")for(ie=0;ie<W.coordinates.length;ie++)A(W.coordinates[ie],K);return W});const D=d.bq.VectorTileFeature.prototype.toGeoJSON;var B={exports:{}},O=d.bw,j=d.bq.VectorTileFeature,V=se;function se(me,W){this.options=W||{},this.features=me,this.length=me.length}function ce(me,W){this.id=typeof me.id=="number"?me.id:void 0,this.type=me.type,this.rawGeometry=me.type===1?[me.geometry]:me.geometry,this.properties=me.tags,this.extent=W||4096}se.prototype.feature=function(me){return new ce(this.features[me],this.options.extent)},ce.prototype.loadGeometry=function(){var me=this.rawGeometry;this.geometry=[];for(var W=0;W<me.length;W++){for(var K=me[W],ie=[],de=0;de<K.length;de++)ie.push(new O(K[de][0],K[de][1]));this.geometry.push(ie)}return this.geometry},ce.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var me=this.geometry,W=1/0,K=-1/0,ie=1/0,de=-1/0,Ae=0;Ae<me.length;Ae++)for(var Pe=me[Ae],Be=0;Be<Pe.length;Be++){var Se=Pe[Be];W=Math.min(W,Se.x),K=Math.max(K,Se.x),ie=Math.min(ie,Se.y),de=Math.max(de,Se.y)}return[W,ie,K,de]},ce.prototype.toGeoJSON=j.prototype.toGeoJSON;var Z=d.bx,Y=V;function ye(me){var W=new Z;return function(K,ie){for(var de in K.layers)ie.writeMessage(3,Oe,K.layers[de])}(me,W),W.finish()}function Oe(me,W){var K;W.writeVarintField(15,me.version||1),W.writeStringField(1,me.name||""),W.writeVarintField(5,me.extent||4096);var ie={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<me.length;K++)ie.feature=me.feature(K),W.writeMessage(2,ne,ie);var de=ie.keys;for(K=0;K<de.length;K++)W.writeStringField(3,de[K]);var Ae=ie.values;for(K=0;K<Ae.length;K++)W.writeMessage(4,bt,Ae[K])}function ne(me,W){var K=me.feature;K.id!==void 0&&W.writeVarintField(1,K.id),W.writeMessage(2,ve,me),W.writeVarintField(3,K.type),W.writeMessage(4,et,K)}function ve(me,W){var K=me.feature,ie=me.keys,de=me.values,Ae=me.keycache,Pe=me.valuecache;for(var Be in K.properties){var Se=K.properties[Be],G=Ae[Be];if(Se!==null){G===void 0&&(ie.push(Be),Ae[Be]=G=ie.length-1),W.writeVarint(G);var Ue=typeof Se;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(Se=JSON.stringify(Se));var $e=Ue+":"+Se,Ze=Pe[$e];Ze===void 0&&(de.push(Se),Pe[$e]=Ze=de.length-1),W.writeVarint(Ze)}}}function Je(me,W){return(W<<3)+(7&me)}function Le(me){return me<<1^me>>31}function et(me,W){for(var K=me.loadGeometry(),ie=me.type,de=0,Ae=0,Pe=K.length,Be=0;Be<Pe;Be++){var Se=K[Be],G=1;ie===1&&(G=Se.length),W.writeVarint(Je(1,G));for(var Ue=ie===3?Se.length-1:Se.length,$e=0;$e<Ue;$e++){$e===1&&ie!==1&&W.writeVarint(Je(2,Ue-1));var Ze=Se[$e].x-de,Ye=Se[$e].y-Ae;W.writeVarint(Le(Ze)),W.writeVarint(Le(Ye)),de+=Ze,Ae+=Ye}ie===3&&W.writeVarint(Je(7,1))}}function bt(me,W){var K=typeof me;K==="string"?W.writeStringField(1,me):K==="boolean"?W.writeBooleanField(7,me):K==="number"&&(me%1!=0?W.writeDoubleField(3,me):me<0?W.writeSVarintField(6,me):W.writeVarintField(5,me))}B.exports=ye,B.exports.fromVectorTileJs=ye,B.exports.fromGeojsonVt=function(me,W){W=W||{};var K={};for(var ie in me)K[ie]=new Y(me[ie].features,W),K[ie].name=ie,K[ie].version=W.version,K[ie].extent=W.extent;return ye({layers:K})},B.exports.GeoJSONWrapper=Y;var pt=d.bv(B.exports);const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:me=>me},Xt=Math.fround||(ni=new Float32Array(1),me=>(ni[0]=+me,ni[0]));var ni;const Nt=3,zt=5,Yt=6;class It{constructor(W){this.options=Object.assign(Object.create(at),W),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(W){const{log:K,minZoom:ie,maxZoom:de}=this.options;K&&console.time("total time");const Ae=`prepare ${W.length} points`;K&&console.time(Ae),this.points=W;const Pe=[];for(let Se=0;Se<W.length;Se++){const G=W[Se];if(!G.geometry)continue;const[Ue,$e]=G.geometry.coordinates,Ze=Xt(hi(Ue)),Ye=Xt(ki($e));Pe.push(Ze,Ye,1/0,Se,-1,1),this.options.reduce&&Pe.push(0)}let Be=this.trees[de+1]=this._createTree(Pe);K&&console.timeEnd(Ae);for(let Se=de;Se>=ie;Se--){const G=+Date.now();Be=this.trees[Se]=this._createTree(this._cluster(Be,Se)),K&&console.log("z%d: %d clusters in %dms",Se,Be.numItems,+Date.now()-G)}return K&&console.timeEnd("total time"),this}getClusters(W,K){let ie=((W[0]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,W[1]));let Ae=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ie=-180,Ae=180;else if(ie>Ae){const $e=this.getClusters([ie,de,180,Pe],K),Ze=this.getClusters([-180,de,Ae,Pe],K);return $e.concat(Ze)}const Be=this.trees[this._limitZoom(K)],Se=Be.range(hi(ie),ki(Pe),hi(Ae),ki(de)),G=Be.data,Ue=[];for(const $e of Se){const Ze=this.stride*$e;Ue.push(G[Ze+zt]>1?ti(G,Ze,this.clusterProps):this.points[G[Ze+Nt]])}return Ue}getChildren(W){const K=this._getOriginId(W),ie=this._getOriginZoom(W),de="No cluster with the specified id.",Ae=this.trees[ie];if(!Ae)throw new Error(de);const Pe=Ae.data;if(K*this.stride>=Pe.length)throw new Error(de);const Be=this.options.radius/(this.options.extent*Math.pow(2,ie-1)),Se=Ae.within(Pe[K*this.stride],Pe[K*this.stride+1],Be),G=[];for(const Ue of Se){const $e=Ue*this.stride;Pe[$e+4]===W&&G.push(Pe[$e+zt]>1?ti(Pe,$e,this.clusterProps):this.points[Pe[$e+Nt]])}if(G.length===0)throw new Error(de);return G}getLeaves(W,K,ie){const de=[];return this._appendLeaves(de,W,K=K||10,ie=ie||0,0),de}getTile(W,K,ie){const de=this.trees[this._limitZoom(W)],Ae=Math.pow(2,W),{extent:Pe,radius:Be}=this.options,Se=Be/Pe,G=(ie-Se)/Ae,Ue=(ie+1+Se)/Ae,$e={features:[]};return this._addTileFeatures(de.range((K-Se)/Ae,G,(K+1+Se)/Ae,Ue),de.data,K,ie,Ae,$e),K===0&&this._addTileFeatures(de.range(1-Se/Ae,G,1,Ue),de.data,Ae,ie,Ae,$e),K===Ae-1&&this._addTileFeatures(de.range(0,G,Se/Ae,Ue),de.data,-1,ie,Ae,$e),$e.features.length?$e:null}getClusterExpansionZoom(W){let K=this._getOriginZoom(W)-1;for(;K<=this.options.maxZoom;){const ie=this.getChildren(W);if(K++,ie.length!==1)break;W=ie[0].properties.cluster_id}return K}_appendLeaves(W,K,ie,de,Ae){const Pe=this.getChildren(K);for(const Be of Pe){const Se=Be.properties;if(Se&&Se.cluster?Ae+Se.point_count<=de?Ae+=Se.point_count:Ae=this._appendLeaves(W,Se.cluster_id,ie,de,Ae):Ae<de?Ae++:W.push(Be),W.length===ie)break}return Ae}_createTree(W){const K=new d.au(W.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ie=0;ie<W.length;ie+=this.stride)K.add(W[ie],W[ie+1]);return K.finish(),K.data=W,K}_addTileFeatures(W,K,ie,de,Ae,Pe){for(const Be of W){const Se=Be*this.stride,G=K[Se+zt]>1;let Ue,$e,Ze;if(G)Ue=Zt(K,Se,this.clusterProps),$e=K[Se],Ze=K[Se+1];else{const Ft=this.points[K[Se+Nt]];Ue=Ft.properties;const[Kt,ai]=Ft.geometry.coordinates;$e=hi(Kt),Ze=ki(ai)}const Ye={type:1,geometry:[[Math.round(this.options.extent*($e*Ae-ie)),Math.round(this.options.extent*(Ze*Ae-de))]],tags:Ue};let dt;dt=G||this.options.generateId?K[Se+Nt]:this.points[K[Se+Nt]].id,dt!==void 0&&(Ye.id=dt),Pe.features.push(Ye)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,K){const{radius:ie,extent:de,reduce:Ae,minPoints:Pe}=this.options,Be=ie/(de*Math.pow(2,K)),Se=W.data,G=[],Ue=this.stride;for(let $e=0;$e<Se.length;$e+=Ue){if(Se[$e+2]<=K)continue;Se[$e+2]=K;const Ze=Se[$e],Ye=Se[$e+1],dt=W.within(Se[$e],Se[$e+1],Be),Ft=Se[$e+zt];let Kt=Ft;for(const ai of dt){const vi=ai*Ue;Se[vi+2]>K&&(Kt+=Se[vi+zt])}if(Kt>Ft&&Kt>=Pe){let ai,vi=Ze*Ft,Yi=Ye*Ft,In=-1;const li=(($e/Ue|0)<<5)+(K+1)+this.points.length;for(const hn of dt){const On=hn*Ue;if(Se[On+2]<=K)continue;Se[On+2]=K;const ur=Se[On+zt];vi+=Se[On]*ur,Yi+=Se[On+1]*ur,Se[On+4]=li,Ae&&(ai||(ai=this._map(Se,$e,!0),In=this.clusterProps.length,this.clusterProps.push(ai)),Ae(ai,this._map(Se,On)))}Se[$e+4]=li,G.push(vi/Kt,Yi/Kt,1/0,li,-1,Kt),Ae&&G.push(In)}else{for(let ai=0;ai<Ue;ai++)G.push(Se[$e+ai]);if(Kt>1)for(const ai of dt){const vi=ai*Ue;if(!(Se[vi+2]<=K)){Se[vi+2]=K;for(let Yi=0;Yi<Ue;Yi++)G.push(Se[vi+Yi])}}}}return G}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,K,ie){if(W[K+zt]>1){const Pe=this.clusterProps[W[K+Yt]];return ie?Object.assign({},Pe):Pe}const de=this.points[W[K+Nt]].properties,Ae=this.options.map(de);return ie&&Ae===de?Object.assign({},Ae):Ae}}function ti(me,W,K){return{type:"Feature",id:me[W+Nt],properties:Zt(me,W,K),geometry:{type:"Point",coordinates:[(ie=me[W],360*(ie-.5)),yi(me[W+1])]}};var ie}function Zt(me,W,K){const ie=me[W+zt],de=ie>=1e4?`${Math.round(ie/1e3)}k`:ie>=1e3?Math.round(ie/100)/10+"k":ie,Ae=me[W+Yt],Pe=Ae===-1?{}:Object.assign({},K[Ae]);return Object.assign(Pe,{cluster:!0,cluster_id:me[W+Nt],point_count:ie,point_count_abbreviated:de})}function hi(me){return me/360+.5}function ki(me){const W=Math.sin(me*Math.PI/180),K=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return K<0?0:K>1?1:K}function yi(me){const W=(180-360*me)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Pi(me,W,K,ie){for(var de,Ae=ie,Pe=K-W>>1,Be=K-W,Se=me[W],G=me[W+1],Ue=me[K],$e=me[K+1],Ze=W+3;Ze<K;Ze+=3){var Ye=ut(me[Ze],me[Ze+1],Se,G,Ue,$e);if(Ye>Ae)de=Ze,Ae=Ye;else if(Ye===Ae){var dt=Math.abs(Ze-Pe);dt<Be&&(de=Ze,Be=dt)}}Ae>ie&&(de-W>3&&Pi(me,W,de,ie),me[de+2]=Ae,K-de>3&&Pi(me,de,K,ie))}function ut(me,W,K,ie,de,Ae){var Pe=de-K,Be=Ae-ie;if(Pe!==0||Be!==0){var Se=((me-K)*Pe+(W-ie)*Be)/(Pe*Pe+Be*Be);Se>1?(K=de,ie=Ae):Se>0&&(K+=Pe*Se,ie+=Be*Se)}return(Pe=me-K)*Pe+(Be=W-ie)*Be}function At(me,W,K,ie){var de={id:me===void 0?null:me,type:W,geometry:K,tags:ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ae){var Pe=Ae.geometry,Be=Ae.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")Ne(Ae,Pe);else if(Be==="Polygon"||Be==="MultiLineString")for(var Se=0;Se<Pe.length;Se++)Ne(Ae,Pe[Se]);else if(Be==="MultiPolygon")for(Se=0;Se<Pe.length;Se++)for(var G=0;G<Pe[Se].length;G++)Ne(Ae,Pe[Se][G])}(de),de}function Ne(me,W){for(var K=0;K<W.length;K+=3)me.minX=Math.min(me.minX,W[K]),me.minY=Math.min(me.minY,W[K+1]),me.maxX=Math.max(me.maxX,W[K]),me.maxY=Math.max(me.maxY,W[K+1])}function je(me,W,K,ie){if(W.geometry){var de=W.geometry.coordinates,Ae=W.geometry.type,Pe=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),Be=[],Se=W.id;if(K.promoteId?Se=W.properties[K.promoteId]:K.generateId&&(Se=ie||0),Ae==="Point")ot(de,Be);else if(Ae==="MultiPoint")for(var G=0;G<de.length;G++)ot(de[G],Be);else if(Ae==="LineString")kt(de,Be,Pe,!1);else if(Ae==="MultiLineString"){if(K.lineMetrics){for(G=0;G<de.length;G++)kt(de[G],Be=[],Pe,!1),me.push(At(Se,"LineString",Be,W.properties));return}we(de,Be,Pe,!1)}else if(Ae==="Polygon")we(de,Be,Pe,!0);else{if(Ae!=="MultiPolygon"){if(Ae==="GeometryCollection"){for(G=0;G<W.geometry.geometries.length;G++)je(me,{id:Se,geometry:W.geometry.geometries[G],properties:W.properties},K,ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(G=0;G<de.length;G++){var Ue=[];we(de[G],Ue,Pe,!0),Be.push(Ue)}}me.push(At(Se,Ae,Be,W.properties))}}function ot(me,W){W.push(di(me[0])),W.push(Ve(me[1])),W.push(0)}function kt(me,W,K,ie){for(var de,Ae,Pe=0,Be=0;Be<me.length;Be++){var Se=di(me[Be][0]),G=Ve(me[Be][1]);W.push(Se),W.push(G),W.push(0),Be>0&&(Pe+=ie?(de*G-Se*Ae)/2:Math.sqrt(Math.pow(Se-de,2)+Math.pow(G-Ae,2))),de=Se,Ae=G}var Ue=W.length-3;W[2]=1,Pi(W,0,Ue,K),W[Ue+2]=1,W.size=Math.abs(Pe),W.start=0,W.end=W.size}function we(me,W,K,ie){for(var de=0;de<me.length;de++){var Ae=[];kt(me[de],Ae,K,ie),W.push(Ae)}}function di(me){return me/360+.5}function Ve(me){var W=Math.sin(me*Math.PI/180),K=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return K<0?0:K>1?1:K}function We(me,W,K,ie,de,Ae,Pe,Be){if(ie/=W,Ae>=(K/=W)&&Pe<ie)return me;if(Pe<K||Ae>=ie)return null;for(var Se=[],G=0;G<me.length;G++){var Ue=me[G],$e=Ue.geometry,Ze=Ue.type,Ye=de===0?Ue.minX:Ue.minY,dt=de===0?Ue.maxX:Ue.maxY;if(Ye>=K&&dt<ie)Se.push(Ue);else if(!(dt<K||Ye>=ie)){var Ft=[];if(Ze==="Point"||Ze==="MultiPoint")St($e,Ft,K,ie,de);else if(Ze==="LineString")vn($e,Ft,K,ie,de,!1,Be.lineMetrics);else if(Ze==="MultiLineString")Mn($e,Ft,K,ie,de,!1);else if(Ze==="Polygon")Mn($e,Ft,K,ie,de,!0);else if(Ze==="MultiPolygon")for(var Kt=0;Kt<$e.length;Kt++){var ai=[];Mn($e[Kt],ai,K,ie,de,!0),ai.length&&Ft.push(ai)}if(Ft.length){if(Be.lineMetrics&&Ze==="LineString"){for(Kt=0;Kt<Ft.length;Kt++)Se.push(At(Ue.id,Ze,Ft[Kt],Ue.tags));continue}Ze!=="LineString"&&Ze!=="MultiLineString"||(Ft.length===1?(Ze="LineString",Ft=Ft[0]):Ze="MultiLineString"),Ze!=="Point"&&Ze!=="MultiPoint"||(Ze=Ft.length===3?"Point":"MultiPoint"),Se.push(At(Ue.id,Ze,Ft,Ue.tags))}}}return Se.length?Se:null}function St(me,W,K,ie,de){for(var Ae=0;Ae<me.length;Ae+=3){var Pe=me[Ae+de];Pe>=K&&Pe<=ie&&(W.push(me[Ae]),W.push(me[Ae+1]),W.push(me[Ae+2]))}}function vn(me,W,K,ie,de,Ae,Pe){for(var Be,Se,G=bn(me),Ue=de===0?ir:qo,$e=me.start,Ze=0;Ze<me.length-3;Ze+=3){var Ye=me[Ze],dt=me[Ze+1],Ft=me[Ze+2],Kt=me[Ze+3],ai=me[Ze+4],vi=de===0?Ye:dt,Yi=de===0?Kt:ai,In=!1;Pe&&(Be=Math.sqrt(Math.pow(Ye-Kt,2)+Math.pow(dt-ai,2))),vi<K?Yi>K&&(Se=Ue(G,Ye,dt,Kt,ai,K),Pe&&(G.start=$e+Be*Se)):vi>ie?Yi<ie&&(Se=Ue(G,Ye,dt,Kt,ai,ie),Pe&&(G.start=$e+Be*Se)):tr(G,Ye,dt,Ft),Yi<K&&vi>=K&&(Se=Ue(G,Ye,dt,Kt,ai,K),In=!0),Yi>ie&&vi<=ie&&(Se=Ue(G,Ye,dt,Kt,ai,ie),In=!0),!Ae&&In&&(Pe&&(G.end=$e+Be*Se),W.push(G),G=bn(me)),Pe&&($e+=Be)}var li=me.length-3;Ye=me[li],dt=me[li+1],Ft=me[li+2],(vi=de===0?Ye:dt)>=K&&vi<=ie&&tr(G,Ye,dt,Ft),li=G.length-3,Ae&&li>=3&&(G[li]!==G[0]||G[li+1]!==G[1])&&tr(G,G[0],G[1],G[2]),G.length&&W.push(G)}function bn(me){var W=[];return W.size=me.size,W.start=me.start,W.end=me.end,W}function Mn(me,W,K,ie,de,Ae){for(var Pe=0;Pe<me.length;Pe++)vn(me[Pe],W,K,ie,de,Ae,!1)}function tr(me,W,K,ie){me.push(W),me.push(K),me.push(ie)}function ir(me,W,K,ie,de,Ae){var Pe=(Ae-W)/(ie-W);return me.push(Ae),me.push(K+(de-K)*Pe),me.push(1),Pe}function qo(me,W,K,ie,de,Ae){var Pe=(Ae-K)/(de-K);return me.push(W+(ie-W)*Pe),me.push(Ae),me.push(1),Pe}function Ji(me,W){for(var K=[],ie=0;ie<me.length;ie++){var de,Ae=me[ie],Pe=Ae.type;if(Pe==="Point"||Pe==="MultiPoint"||Pe==="LineString")de=ht(Ae.geometry,W);else if(Pe==="MultiLineString"||Pe==="Polygon"){de=[];for(var Be=0;Be<Ae.geometry.length;Be++)de.push(ht(Ae.geometry[Be],W))}else if(Pe==="MultiPolygon")for(de=[],Be=0;Be<Ae.geometry.length;Be++){for(var Se=[],G=0;G<Ae.geometry[Be].length;G++)Se.push(ht(Ae.geometry[Be][G],W));de.push(Se)}K.push(At(Ae.id,Pe,de,Ae.tags))}return K}function ht(me,W){var K=[];K.size=me.size,me.start!==void 0&&(K.start=me.start,K.end=me.end);for(var ie=0;ie<me.length;ie+=3)K.push(me[ie]+W,me[ie+1],me[ie+2]);return K}function Hn(me,W){if(me.transformed)return me;var K,ie,de,Ae=1<<me.z,Pe=me.x,Be=me.y;for(K=0;K<me.features.length;K++){var Se=me.features[K],G=Se.geometry,Ue=Se.type;if(Se.geometry=[],Ue===1)for(ie=0;ie<G.length;ie+=2)Se.geometry.push(wn(G[ie],G[ie+1],W,Ae,Pe,Be));else for(ie=0;ie<G.length;ie++){var $e=[];for(de=0;de<G[ie].length;de+=2)$e.push(wn(G[ie][de],G[ie][de+1],W,Ae,Pe,Be));Se.geometry.push($e)}}return me.transformed=!0,me}function wn(me,W,K,ie,de,Ae){return[Math.round(K*(me*ie-de)),Math.round(K*(W*ie-Ae))]}function Ao(me,W,K,ie,de){for(var Ae=W===de.maxZoom?0:de.tolerance/((1<<W)*de.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:K,y:ie,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Be=0;Be<me.length;Be++){Pe.numFeatures++,Vi(Pe,me[Be],Ae,de);var Se=me[Be].minX,G=me[Be].minY,Ue=me[Be].maxX,$e=me[Be].maxY;Se<Pe.minX&&(Pe.minX=Se),G<Pe.minY&&(Pe.minY=G),Ue>Pe.maxX&&(Pe.maxX=Ue),$e>Pe.maxY&&(Pe.maxY=$e)}return Pe}function Vi(me,W,K,ie){var de=W.geometry,Ae=W.type,Pe=[];if(Ae==="Point"||Ae==="MultiPoint")for(var Be=0;Be<de.length;Be+=3)Pe.push(de[Be]),Pe.push(de[Be+1]),me.numPoints++,me.numSimplified++;else if(Ae==="LineString")gt(Pe,de,me,K,!1,!1);else if(Ae==="MultiLineString"||Ae==="Polygon")for(Be=0;Be<de.length;Be++)gt(Pe,de[Be],me,K,Ae==="Polygon",Be===0);else if(Ae==="MultiPolygon")for(var Se=0;Se<de.length;Se++){var G=de[Se];for(Be=0;Be<G.length;Be++)gt(Pe,G[Be],me,K,!0,Be===0)}if(Pe.length){var Ue=W.tags||null;if(Ae==="LineString"&&ie.lineMetrics){for(var $e in Ue={},W.tags)Ue[$e]=W.tags[$e];Ue.mapbox_clip_start=de.start/de.size,Ue.mapbox_clip_end=de.end/de.size}var Ze={geometry:Pe,type:Ae==="Polygon"||Ae==="MultiPolygon"?3:Ae==="LineString"||Ae==="MultiLineString"?2:1,tags:Ue};W.id!==null&&(Ze.id=W.id),me.features.push(Ze)}}function gt(me,W,K,ie,de,Ae){var Pe=ie*ie;if(ie>0&&W.size<(de?Pe:ie))K.numPoints+=W.length/3;else{for(var Be=[],Se=0;Se<W.length;Se+=3)(ie===0||W[Se+2]>Pe)&&(K.numSimplified++,Be.push(W[Se]),Be.push(W[Se+1])),K.numPoints++;de&&function(G,Ue){for(var $e=0,Ze=0,Ye=G.length,dt=Ye-2;Ze<Ye;dt=Ze,Ze+=2)$e+=(G[Ze]-G[dt])*(G[Ze+1]+G[dt+1]);if($e>0===Ue)for(Ze=0,Ye=G.length;Ze<Ye/2;Ze+=2){var Ft=G[Ze],Kt=G[Ze+1];G[Ze]=G[Ye-2-Ze],G[Ze+1]=G[Ye-1-Ze],G[Ye-2-Ze]=Ft,G[Ye-1-Ze]=Kt}}(Be,Ae),me.push(Be)}}function ri(me,W){var K=(W=this.options=function(de,Ae){for(var Pe in Ae)de[Pe]=Ae[Pe];return de}(Object.create(this.options),W)).debug;if(K&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var ie=function(de,Ae){var Pe=[];if(de.type==="FeatureCollection")for(var Be=0;Be<de.features.length;Be++)je(Pe,de.features[Be],Ae,Be);else je(Pe,de.type==="Feature"?de:{geometry:de},Ae);return Pe}(me,W);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ie=function(de,Ae){var Pe=Ae.buffer/Ae.extent,Be=de,Se=We(de,1,-1-Pe,Pe,0,-1,2,Ae),G=We(de,1,1-Pe,2+Pe,0,-1,2,Ae);return(Se||G)&&(Be=We(de,1,-Pe,1+Pe,0,-1,2,Ae)||[],Se&&(Be=Ji(Se,1).concat(Be)),G&&(Be=Be.concat(Ji(G,-1)))),Be}(ie,W),ie.length&&this.splitTile(ie,0,0,0),K&&(ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Qt(me,W,K){return 32*((1<<me)*K+W)+me}function $i(me,W){return W?me.properties[W]:me.id}function vr(me,W){if(me==null)return!0;if(me.type==="Feature")return $i(me,W)!=null;if(me.type==="FeatureCollection"){const K=new Set;for(const ie of me.features){const de=$i(ie,W);if(de==null||K.has(de))return!1;K.add(de)}return!0}return!1}function ii(me,W){const K=new Map;if(me!=null)if(me.type==="Feature")K.set($i(me,W),me);else for(const ie of me.features)K.set($i(ie,W),ie);return K}ri.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ri.prototype.splitTile=function(me,W,K,ie,de,Ae,Pe){for(var Be=[me,W,K,ie],Se=this.options,G=Se.debug;Be.length;){ie=Be.pop(),K=Be.pop(),W=Be.pop(),me=Be.pop();var Ue=1<<W,$e=Qt(W,K,ie),Ze=this.tiles[$e];if(!Ze&&(G>1&&console.time("creation"),Ze=this.tiles[$e]=Ao(me,W,K,ie,Se),this.tileCoords.push({z:W,x:K,y:ie}),G)){G>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,K,ie,Ze.numFeatures,Ze.numPoints,Ze.numSimplified),console.timeEnd("creation"));var Ye="z"+W;this.stats[Ye]=(this.stats[Ye]||0)+1,this.total++}if(Ze.source=me,de){if(W===Se.maxZoom||W===de)continue;var dt=1<<de-W;if(K!==Math.floor(Ae/dt)||ie!==Math.floor(Pe/dt))continue}else if(W===Se.indexMaxZoom||Ze.numPoints<=Se.indexMaxPoints)continue;if(Ze.source=null,me.length!==0){G>1&&console.time("clipping");var Ft,Kt,ai,vi,Yi,In,li=.5*Se.buffer/Se.extent,hn=.5-li,On=.5+li,ur=1+li;Ft=Kt=ai=vi=null,Yi=We(me,Ue,K-li,K+On,0,Ze.minX,Ze.maxX,Se),In=We(me,Ue,K+hn,K+ur,0,Ze.minX,Ze.maxX,Se),me=null,Yi&&(Ft=We(Yi,Ue,ie-li,ie+On,1,Ze.minY,Ze.maxY,Se),Kt=We(Yi,Ue,ie+hn,ie+ur,1,Ze.minY,Ze.maxY,Se),Yi=null),In&&(ai=We(In,Ue,ie-li,ie+On,1,Ze.minY,Ze.maxY,Se),vi=We(In,Ue,ie+hn,ie+ur,1,Ze.minY,Ze.maxY,Se),In=null),G>1&&console.timeEnd("clipping"),Be.push(Ft||[],W+1,2*K,2*ie),Be.push(Kt||[],W+1,2*K,2*ie+1),Be.push(ai||[],W+1,2*K+1,2*ie),Be.push(vi||[],W+1,2*K+1,2*ie+1)}}},ri.prototype.getTile=function(me,W,K){var ie=this.options,de=ie.extent,Ae=ie.debug;if(me<0||me>24)return null;var Pe=1<<me,Be=Qt(me,W=(W%Pe+Pe)%Pe,K);if(this.tiles[Be])return Hn(this.tiles[Be],de);Ae>1&&console.log("drilling down to z%d-%d-%d",me,W,K);for(var Se,G=me,Ue=W,$e=K;!Se&&G>0;)G--,Ue=Math.floor(Ue/2),$e=Math.floor($e/2),Se=this.tiles[Qt(G,Ue,$e)];return Se&&Se.source?(Ae>1&&console.log("found parent tile z%d-%d-%d",G,Ue,$e),Ae>1&&console.time("drilling down"),this.splitTile(Se.source,G,Ue,$e,me,W,K),Ae>1&&console.timeEnd("drilling down"),this.tiles[Be]?Hn(this.tiles[Be],de):null):null};class to extends S{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(W,K){return d._(this,void 0,void 0,function*(){const ie=W.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const de=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!de)return null;const Ae=new class{constructor(Be){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.W,this.length=Be.length,this._features=Be}feature(Be){return new class{constructor(Se){this._feature=Se,this.extent=d.W,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){const Se=[];for(const G of this._feature.geometry)Se.push([new d.P(G[0],G[1])]);return Se}{const Se=[];for(const G of this._feature.geometry){const Ue=[];for(const $e of G)Ue.push(new d.P($e[0],$e[1]));Se.push(Ue)}return Se}}toGeoJSON(Se,G,Ue){return D.call(this,Se,G,Ue)}}(this._features[Be])}}(de.features);let Pe=pt(Ae);return Pe.byteOffset===0&&Pe.byteLength===Pe.buffer.byteLength||(Pe=new Uint8Array(Pe)),{vectorTile:Ae,rawData:Pe.buffer}})}loadData(W){return d._(this,void 0,void 0,function*(){var K;(K=this._pendingRequest)===null||K===void 0||K.abort();const ie=!!(W&&W.request&&W.request.collectResourceTiming)&&new d.bs(W.request);this._pendingRequest=new AbortController;try{let de=yield this.loadGeoJSON(W,this._pendingRequest);if(delete this._pendingRequest,typeof de!="object")throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(R(de,!0),W.filter){const Pe=d.by(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Pe.result==="error")throw new Error(Pe.value.map(Se=>`${Se.key}: ${Se.message}`).join(", "));de={type:"FeatureCollection",features:de.features.filter(Se=>Pe.value.evaluate({zoom:0},Se))}}this._geoJSONIndex=W.cluster?new It(function({superclusterOptions:Pe,clusterProperties:Be}){if(!Be||!Pe)return Pe;const Se={},G={},Ue={accumulated:null,zoom:0},$e={properties:null},Ze=Object.keys(Be);for(const Ye of Ze){const[dt,Ft]=Be[Ye],Kt=d.by(Ft),ai=d.by(typeof dt=="string"?[dt,["accumulated"],["get",Ye]]:dt);Se[Ye]=Kt.value,G[Ye]=ai.value}return Pe.map=Ye=>{$e.properties=Ye;const dt={};for(const Ft of Ze)dt[Ft]=Se[Ft].evaluate(Ue,$e);return dt},Pe.reduce=(Ye,dt)=>{$e.properties=dt;for(const Ft of Ze)Ue.accumulated=Ye[Ft],Ye[Ft]=G[Ft].evaluate(Ue,$e)},Pe}(W)).load(de.features):function(Pe,Be){return new ri(Pe,Be)}(de,W.geojsonVtOptions),this.loaded={};const Ae={};if(ie){const Pe=ie.finish();Pe&&(Ae.resourceTiming={},Ae.resourceTiming[W.source]=JSON.parse(JSON.stringify(Pe)))}return Ae}catch(de){if(delete this._pendingRequest,d.bz(de))return{abandoned:!0};throw de}})}reloadTile(W){const K=this.loaded;return K&&K[W.uid]?super.reloadTile(W):this.loadTile(W)}loadGeoJSON(W,K){return d._(this,void 0,void 0,function*(){const{promoteId:ie}=W;if(W.request){const de=yield d.h(W.request,K);return this._dataUpdateable=vr(de.data,ie)?ii(de.data,ie):void 0,de.data}if(typeof W.data=="string")try{const de=JSON.parse(W.data);return this._dataUpdateable=vr(de,ie)?ii(de,ie):void 0,de}catch{throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`)}if(!W.dataDiff)throw new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${W.source}`);return function(de,Ae,Pe){var Be,Se,G,Ue;if(Ae.removeAll&&de.clear(),Ae.remove)for(const $e of Ae.remove)de.delete($e);if(Ae.add)for(const $e of Ae.add){const Ze=$i($e,Pe);Ze!=null&&de.set(Ze,$e)}if(Ae.update)for(const $e of Ae.update){let Ze=de.get($e.id);if(Ze==null)continue;const Ye=!$e.removeAllProperties&&(((Be=$e.removeProperties)===null||Be===void 0?void 0:Be.length)>0||((Se=$e.addOrUpdateProperties)===null||Se===void 0?void 0:Se.length)>0);if(($e.newGeometry||$e.removeAllProperties||Ye)&&(Ze=Object.assign({},Ze),de.set($e.id,Ze),Ye&&(Ze.properties=Object.assign({},Ze.properties))),$e.newGeometry&&(Ze.geometry=$e.newGeometry),$e.removeAllProperties)Ze.properties={};else if(((G=$e.removeProperties)===null||G===void 0?void 0:G.length)>0)for(const dt of $e.removeProperties)Object.prototype.hasOwnProperty.call(Ze.properties,dt)&&delete Ze.properties[dt];if(((Ue=$e.addOrUpdateProperties)===null||Ue===void 0?void 0:Ue.length)>0)for(const{key:dt,value:Ft}of $e.addOrUpdateProperties)Ze.properties[dt]=Ft}}(this._dataUpdateable,W.dataDiff,ie),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(W){return d._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(W){return this._geoJSONIndex.getClusterExpansionZoom(W.clusterId)}getClusterChildren(W){return this._geoJSONIndex.getChildren(W.clusterId)}getClusterLeaves(W){return this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset)}}class un{constructor(W){this.self=W,this.actor=new d.C(W),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(K,ie)=>{if(this.externalWorkerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.externalWorkerSourceTypes[K]=ie},this.self.addProtocol=d.bf,this.self.removeProtocol=d.bg,this.self.registerRTLTextPlugin=K=>{if(d.bA.isParsed())throw new Error("RTL text plugin already registered.");d.bA.setMethods(K)},this.actor.registerMessageHandler("LDT",(K,ie)=>this._getDEMWorkerSource(K,ie.source).loadTile(ie)),this.actor.registerMessageHandler("RDT",(K,ie)=>d._(this,void 0,void 0,function*(){this._getDEMWorkerSource(K,ie.source).removeTile(ie)})),this.actor.registerMessageHandler("GCEZ",(K,ie)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ie.type,ie.source).getClusterExpansionZoom(ie)})),this.actor.registerMessageHandler("GCC",(K,ie)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ie.type,ie.source).getClusterChildren(ie)})),this.actor.registerMessageHandler("GCL",(K,ie)=>d._(this,void 0,void 0,function*(){return this._getWorkerSource(K,ie.type,ie.source).getClusterLeaves(ie)})),this.actor.registerMessageHandler("LD",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).loadData(ie)),this.actor.registerMessageHandler("LT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).loadTile(ie)),this.actor.registerMessageHandler("RT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).reloadTile(ie)),this.actor.registerMessageHandler("AT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).abortTile(ie)),this.actor.registerMessageHandler("RMT",(K,ie)=>this._getWorkerSource(K,ie.type,ie.source).removeTile(ie)),this.actor.registerMessageHandler("RS",(K,ie)=>d._(this,void 0,void 0,function*(){if(!this.workerSources[K]||!this.workerSources[K][ie.type]||!this.workerSources[K][ie.type][ie.source])return;const de=this.workerSources[K][ie.type][ie.source];delete this.workerSources[K][ie.type][ie.source],de.removeSource!==void 0&&de.removeSource(ie)})),this.actor.registerMessageHandler("RM",K=>d._(this,void 0,void 0,function*(){delete this.layerIndexes[K],delete this.availableImages[K],delete this.workerSources[K],delete this.demWorkerSources[K]})),this.actor.registerMessageHandler("SR",(K,ie)=>d._(this,void 0,void 0,function*(){this.referrer=ie})),this.actor.registerMessageHandler("SRPS",(K,ie)=>this._syncRTLPluginState(K,ie)),this.actor.registerMessageHandler("IS",(K,ie)=>d._(this,void 0,void 0,function*(){this.self.importScripts(ie)})),this.actor.registerMessageHandler("SI",(K,ie)=>this._setImages(K,ie)),this.actor.registerMessageHandler("UL",(K,ie)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(K).update(ie.layers,ie.removedIds)})),this.actor.registerMessageHandler("SL",(K,ie)=>d._(this,void 0,void 0,function*(){this._getLayerIndex(K).replace(ie)}))}_setImages(W,K){return d._(this,void 0,void 0,function*(){this.availableImages[W]=K;for(const ie in this.workerSources[W]){const de=this.workerSources[W][ie];for(const Ae in de)de[Ae].availableImages=K}})}_syncRTLPluginState(W,K){return d._(this,void 0,void 0,function*(){if(d.bA.isParsed())return d.bA.getState();if(K.pluginStatus!=="loading")return d.bA.setState(K),K;const ie=K.pluginURL;if(this.self.importScripts(ie),d.bA.isParsed()){const de={pluginStatus:"loaded",pluginURL:ie};return d.bA.setState(de),de}throw d.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ie}`)})}_getAvailableImages(W){let K=this.availableImages[W];return K||(K=[]),K}_getLayerIndex(W){let K=this.layerIndexes[W];return K||(K=this.layerIndexes[W]=new a),K}_getWorkerSource(W,K,ie){if(this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][K]||(this.workerSources[W][K]={}),!this.workerSources[W][K][ie]){const de={sendAsync:(Ae,Pe)=>(Ae.targetMapId=W,this.actor.sendAsync(Ae,Pe))};switch(K){case"vector":this.workerSources[W][K][ie]=new S(de,this._getLayerIndex(W),this._getAvailableImages(W));break;case"geojson":this.workerSources[W][K][ie]=new to(de,this._getLayerIndex(W),this._getAvailableImages(W));break;default:this.workerSources[W][K][ie]=new this.externalWorkerSourceTypes[K](de,this._getLayerIndex(W),this._getAvailableImages(W))}}return this.workerSources[W][K][ie]}_getDEMWorkerSource(W,K){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][K]||(this.demWorkerSources[W][K]=new E),this.demWorkerSources[W][K]}}return d.i(self)&&(self.worker=new un(self)),un}),l("index",["exports","./shared"],function(d,a){var _="4.1.3";let v,k;const S={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((r,h)=>{const p=requestAnimationFrame(r);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),h(a.c())})}),getImageData(y,r=0){return this.getImageCanvasContext(y).getImageData(-r,-r,y.width+2*r,y.height+2*r)},getImageCanvasContext(y){const r=window.document.createElement("canvas"),h=r.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return r.width=y.width,r.height=y.height,h.drawImage(y,0,0,y.width,y.height),h},resolveURL:y=>(v||(v=document.createElement("a")),v.href=y,v.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(k==null&&(k=matchMedia("(prefers-reduced-motion: reduce)")),k.matches)}};class E{static testProp(r){if(!E.docStyle)return r[0];for(let h=0;h<r.length;h++)if(r[h]in E.docStyle)return r[h];return r[0]}static create(r,h,p){const m=window.document.createElement(r);return h!==void 0&&(m.className=h),p&&p.appendChild(m),m}static createNS(r,h){return window.document.createElementNS(r,h)}static disableDrag(){E.docStyle&&E.selectProp&&(E.userSelect=E.docStyle[E.selectProp],E.docStyle[E.selectProp]="none")}static enableDrag(){E.docStyle&&E.selectProp&&(E.docStyle[E.selectProp]=E.userSelect)}static setTransform(r,h){r.style[E.transformProp]=h}static addEventListener(r,h,p,m={}){r.addEventListener(h,p,"passive"in m?m:m.capture)}static removeEventListener(r,h,p,m={}){r.removeEventListener(h,p,"passive"in m?m:m.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",E.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",E.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",E.suppressClickInternal,!0)},0)}static getScale(r){const h=r.getBoundingClientRect();return{x:h.width/r.offsetWidth||1,y:h.height/r.offsetHeight||1,boundingClientRect:h}}static getPoint(r,h,p){const m=h.boundingClientRect;return new a.P((p.clientX-m.left)/h.x-r.clientLeft,(p.clientY-m.top)/h.y-r.clientTop)}static mousePos(r,h){const p=E.getScale(r);return E.getPoint(r,p,h)}static touchPos(r,h){const p=[],m=E.getScale(r);for(let b=0;b<h.length;b++)p.push(E.getPoint(r,m,h[b]));return p}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}}E.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,E.selectProp=E.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),E.transformProp=E.testProp(["transform","WebkitTransform"]);const A={supported:!1,testSupport:function(y){!D&&R&&(B?O(y):z=y)}};let z,R,D=!1,B=!1;function O(y){const r=y.createTexture();y.bindTexture(y.TEXTURE_2D,r);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,R),y.isContextLost())return;A.supported=!0}catch{}y.deleteTexture(r),D=!0}var j;typeof document<"u"&&(R=document.createElement("img"),R.onload=function(){z&&O(z),z=null,B=!0},R.onerror=function(){D=!0,z=null},R.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let r,h,p,m;y.resetRequestQueue=()=>{r=[],h=0,p=0,m={}},y.addThrottleControl=L=>{const F=p++;return m[F]=L,F},y.removeThrottleControl=L=>{delete m[L],C()},y.getImage=(L,F,$=!0)=>new Promise((q,ee)=>{A.supported&&(L.headers||(L.headers={}),L.headers.accept="image/webp,*/*"),a.e(L,{type:"image"}),r.push({abortController:F,requestParameters:L,supportImageRefresh:$,state:"queued",onError:pe=>{ee(pe)},onSuccess:pe=>{q(pe)}}),C()});const b=L=>a._(this,void 0,void 0,function*(){L.state="running";const{requestParameters:F,supportImageRefresh:$,onError:q,onSuccess:ee,abortController:pe}=L,fe=$===!1&&!a.i(self)&&!a.g(F.url)&&(!F.headers||Object.keys(F.headers).reduce((Ce,qe)=>Ce&&qe==="accept",!0));h++;const _e=fe?M(F,pe):a.m(F,pe);try{const Ce=yield _e;delete L.abortController,L.state="completed",Ce.data instanceof HTMLImageElement||a.b(Ce.data)?ee(Ce):Ce.data&&ee({data:yield(ue=Ce.data,typeof createImageBitmap=="function"?a.d(ue):a.f(ue)),cacheControl:Ce.cacheControl,expires:Ce.expires})}catch(Ce){delete L.abortController,q(Ce)}finally{h--,C()}var ue}),C=()=>{const L=(()=>{for(const F of Object.keys(m))if(m[F]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let F=h;F<L&&r.length>0;F++){const $=r.shift();$.abortController.signal.aborted?F--:b($)}},M=(L,F)=>new Promise(($,q)=>{const ee=new Image,pe=L.url,fe=L.credentials;fe&&fe==="include"?ee.crossOrigin="use-credentials":(fe&&fe==="same-origin"||!a.s(pe))&&(ee.crossOrigin="anonymous"),F.signal.addEventListener("abort",()=>{ee.src="",q(a.c())}),ee.fetchPriority="high",ee.onload=()=>{ee.onerror=ee.onload=null,$({data:ee})},ee.onerror=()=>{ee.onerror=ee.onload=null,F.signal.aborted||q(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ee.src=pe})}(j||(j={})),j.resetRequestQueue();class V{constructor(r){this._transformRequestFn=r}transformRequest(r,h){return this._transformRequestFn&&this._transformRequestFn(r,h)||{url:r}}normalizeSpriteURL(r,h,p){const m=function(b){const C=b.match(se);if(!C)throw new Error(`Unable to parse URL "${b}"`);return{protocol:C[1],authority:C[2],path:C[3]||"/",params:C[4]?C[4].split("&"):[]}}(r);return m.path+=`${h}${p}`,function(b){const C=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${C}`}(m)}setTransformRequest(r){this._transformRequestFn=r}}const se=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ce(y){var r=new a.A(3);return r[0]=y[0],r[1]=y[1],r[2]=y[2],r}var Z,Y=function(y,r,h){return y[0]=r[0]-h[0],y[1]=r[1]-h[1],y[2]=r[2]-h[2],y};Z=new a.A(3),a.A!=Float32Array&&(Z[0]=0,Z[1]=0,Z[2]=0);var ye=function(y){var r=y[0],h=y[1];return r*r+h*h};function Oe(y){const r=[];if(typeof y=="string")r.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:p,url:m}of y){const b=`${p}${m}`;h.indexOf(b)===-1&&(h.push(b),r.push({id:p,url:m}))}}return r}(function(){var y=new a.A(2);a.A!=Float32Array&&(y[0]=0,y[1]=0)})();class ne{constructor(r,h,p,m){this.context=r,this.format=p,this.texture=r.gl.createTexture(),this.update(h,m)}update(r,h,p){const{width:m,height:b}=r,C=!(this.size&&this.size[0]===m&&this.size[1]===b||p),{context:M}=this,{gl:L}=M;if(this.useMipmap=!!(h&&h.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),M.pixelStoreUnpackFlipY.set(!1),M.pixelStoreUnpack.set(1),M.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!h||h.premultiply!==!1)),C)this.size=[m,b],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.b(r)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,r):L.texImage2D(L.TEXTURE_2D,0,this.format,m,b,0,this.format,L.UNSIGNED_BYTE,r.data);else{const{x:F,y:$}=p||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||a.b(r)?L.texSubImage2D(L.TEXTURE_2D,0,F,$,L.RGBA,L.UNSIGNED_BYTE,r):L.texSubImage2D(L.TEXTURE_2D,0,F,$,m,b,L.RGBA,L.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(r,h,p){const{context:m}=this,{gl:b}=m;b.bindTexture(b.TEXTURE_2D,this.texture),p!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=b.LINEAR),r!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,r),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,p||r),this.filter=r),h!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function ve(y){const{userImage:r}=y;return!!(r&&r.render&&r.render())&&(y.data.replace(new Uint8Array(r.data.buffer)),!0)}class Je extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:h,promiseResolve:p}of this.requestors)p(this._getImagesForIds(h));this.requestors=[]}}getImage(r){const h=this.images[r];if(h&&!h.data&&h.spriteData){const p=h.spriteData;h.data=new a.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),h.spriteData=null}return h}addImage(r,h){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,h)&&(this.images[r]=h)}_validate(r,h){let p=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "stretchX" value`))),p=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "stretchY" value`))),p=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${r}" has invalid "content" value`))),p=!1),p}_validateStretch(r,h){if(!r)return!0;let p=0;for(const m of r){if(m[0]<p||m[1]<m[0]||h<m[1])return!1;p=m[1]}return!0}_validateContent(r,h){if(!r)return!0;if(r.length!==4)return!1;const p=h.spriteData,m=p&&p.width||h.data.width,b=p&&p.height||h.data.height;return!(r[0]<0||m<r[0]||r[1]<0||b<r[1]||r[2]<0||m<r[2]||r[3]<0||b<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,h,p=!0){const m=this.getImage(r);if(p&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[r]=h,this.updatedImages[r]=!0}removeImage(r){const h=this.images[r];delete this.images[r],delete this.patterns[r],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise((h,p)=>{let m=!0;if(!this.isLoaded())for(const b of r)this.images[b]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:h})})}_getImagesForIds(r){const h={};for(const p of r){let m=this.getImage(p);m||(this.fire(new a.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?h[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:a.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:r,height:h}=this.atlasImage;return{width:r,height:h}}getPattern(r){const h=this.patterns[r],p=this.getImage(r);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},b=new a.I(m,p);this.patterns[r]={bin:m,position:b}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const h=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ne(r,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const b in this.patterns)r.push(this.patterns[b].bin);const{w:h,h:p}=a.p(r),m=this.atlasImage;m.resize({width:h||1,height:p||1});for(const b in this.patterns){const{bin:C}=this.patterns[b],M=C.x+1,L=C.y+1,F=this.getImage(b).data,$=F.width,q=F.height;a.R.copy(F,m,{x:0,y:0},{x:M,y:L},{width:$,height:q}),a.R.copy(F,m,{x:0,y:q-1},{x:M,y:L-1},{width:$,height:1}),a.R.copy(F,m,{x:0,y:0},{x:M,y:L+q},{width:$,height:1}),a.R.copy(F,m,{x:$-1,y:0},{x:M-1,y:L},{width:1,height:q}),a.R.copy(F,m,{x:0,y:0},{x:M+$,y:L},{width:1,height:q})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const h of r){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const p=this.getImage(h);p||a.w(`Image with ID: "${h}" was not found`),ve(p)&&this.updateImage(h,p)}}}const Le=1e20;function et(y,r,h,p,m,b,C,M,L){for(let F=r;F<r+p;F++)bt(y,h*b+F,b,m,C,M,L);for(let F=h;F<h+m;F++)bt(y,F*b+r,1,p,C,M,L)}function bt(y,r,h,p,m,b,C){b[0]=0,C[0]=-Le,C[1]=Le,m[0]=y[r];for(let M=1,L=0,F=0;M<p;M++){m[M]=y[r+M*h];const $=M*M;do{const q=b[L];F=(m[M]-m[q]+$-q*q)/(M-q)/2}while(F<=C[L]&&--L>-1);L++,b[L]=M,C[L]=F,C[L+1]=Le}for(let M=0,L=0;M<p;M++){for(;C[L+1]<M;)L++;const F=b[L],$=M-F;y[r+M*h]=m[F]+$*$}}class pt{constructor(r,h){this.requestManager=r,this.localIdeographFontFamily=h,this.entries={}}setURL(r){this.url=r}getGlyphs(r){return a._(this,void 0,void 0,function*(){const h=[];for(const b in r)for(const C of r[b])h.push(this._getAndCacheGlyphsPromise(b,C));const p=yield Promise.all(h),m={};for(const{stack:b,id:C,glyph:M}of p)m[b]||(m[b]={}),m[b][C]=M&&{id:M.id,bitmap:M.bitmap.clone(),metrics:M.metrics};return m})}_getAndCacheGlyphsPromise(r,h){return a._(this,void 0,void 0,function*(){let p=this.entries[r];p||(p=this.entries[r]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[h];if(m!==void 0)return{stack:r,id:h,glyph:m};if(m=this._tinySDF(p,r,h),m)return p.glyphs[h]=m,{stack:r,id:h,glyph:m};const b=Math.floor(h/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[b])return{stack:r,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[b]){const M=pt.loadGlyphRange(r,b,this.url,this.requestManager);p.requests[b]=M}const C=yield p.requests[b];for(const M in C)this._doesCharSupportLocalGlyph(+M)||(p.glyphs[+M]=C[+M]);return p.ranges[b]=!0,{stack:r,id:h,glyph:C[h]||null}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&(a.u["CJK Unified Ideographs"](r)||a.u["Hangul Syllables"](r)||a.u.Hiragana(r)||a.u.Katakana(r))}_tinySDF(r,h,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let b=r.tinySDF;if(!b){let M="400";/bold/i.test(h)?M="900":/medium/i.test(h)?M="500":/light/i.test(h)&&(M="200"),b=r.tinySDF=new pt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:M})}const C=b.draw(String.fromCharCode(p));return{id:p,bitmap:new a.o({width:C.width||60,height:C.height||60},C.data),metrics:{width:C.glyphWidth/2||24,height:C.glyphHeight/2||24,left:C.glyphLeft/2+.5||0,top:C.glyphTop/2-27.5||-8,advance:C.glyphAdvance/2||24,isDoubleResolution:!0}}}}pt.loadGlyphRange=function(y,r,h,p){return a._(this,void 0,void 0,function*(){const m=256*r,b=m+255,C=p.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${m}-${b}`),"Glyphs"),M=yield a.l(C,new AbortController);if(!M||!M.data)throw new Error(`Could not load glyph range. range: ${r}, ${m}-${b}`);const L={};for(const F of a.n(M.data))L[F.id]=F;return L})},pt.TinySDF=class{constructor({fontSize:y=24,buffer:r=3,radius:h=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:b="normal",fontStyle:C="normal"}={}){this.buffer=r,this.cutoff=p,this.radius=h;const M=this.size=y+4*r,L=this._createCanvas(M),F=this.ctx=L.getContext("2d",{willReadFrequently:!0});F.font=`${C} ${b} ${y}px ${m}`,F.textBaseline="alphabetic",F.textAlign="left",F.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(y){const r=document.createElement("canvas");return r.width=r.height=y,r}draw(y){const{width:r,actualBoundingBoxAscent:h,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:b}=this.ctx.measureText(y),C=Math.ceil(h),M=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-m))),L=Math.min(this.size-this.buffer,C+Math.ceil(p)),F=M+2*this.buffer,$=L+2*this.buffer,q=Math.max(F*$,0),ee=new Uint8ClampedArray(q),pe={data:ee,width:F,height:$,glyphWidth:M,glyphHeight:L,glyphTop:C,glyphLeft:0,glyphAdvance:r};if(M===0||L===0)return pe;const{ctx:fe,buffer:_e,gridInner:ue,gridOuter:Ce}=this;fe.clearRect(_e,_e,M,L),fe.fillText(y,_e,_e+C);const qe=fe.getImageData(_e,_e,M,L);Ce.fill(Le,0,q),ue.fill(0,0,q);for(let be=0;be<L;be++)for(let Re=0;Re<M;Re++){const Ge=qe.data[4*(be*M+Re)+3]/255;if(Ge===0)continue;const He=(be+_e)*F+Re+_e;if(Ge===1)Ce[He]=0,ue[He]=Le;else{const Ke=.5-Ge;Ce[He]=Ke>0?Ke*Ke:0,ue[He]=Ke<0?Ke*Ke:0}}et(Ce,0,0,F,$,F,this.f,this.v,this.z),et(ue,_e,_e,M,L,F,this.f,this.v,this.z);for(let be=0;be<q;be++){const Re=Math.sqrt(Ce[be])-Math.sqrt(ue[be]);ee[be]=Math.round(255-255*(Re/this.radius+this.cutoff))}return pe}};class at{constructor(){this.specification=a.v.light.position}possiblyEvaluate(r,h){return a.y(r.expression.evaluate(h))}interpolate(r,h,p){return{x:a.z.number(r.x,h.x,p),y:a.z.number(r.y,h.y,p),z:a.z.number(r.z,h.z,p)}}}let Xt;class ni extends a.E{constructor(r){super(),Xt=Xt||new a.q({anchor:new a.D(a.v.light.anchor),position:new at,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Xt),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,h={}){if(!this._validate(a.r,r,h))for(const p in r){const m=r[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,h,p){return(!p||p.validate!==!1)&&a.t(this,r.call(a.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}class Nt{constructor(r,h){this.width=r,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,h){const p=r.join(",")+String(h);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(r,h)),this.dashEntry[p]}getDashRanges(r,h,p){const m=[];let b=r.length%2==1?-r[r.length-1]*p:0,C=r[0]*p,M=!0;m.push({left:b,right:C,isDash:M,zeroLength:r[0]===0});let L=r[0];for(let F=1;F<r.length;F++){M=!M;const $=r[F];b=L*p,L+=$,C=L*p,m.push({left:b,right:C,isDash:M,zeroLength:$===0})}return m}addRoundDash(r,h,p){const m=h/2;for(let b=-p;b<=p;b++){const C=this.width*(this.nextRow+p+b);let M=0,L=r[M];for(let F=0;F<this.width;F++){F/L.right>1&&(L=r[++M]);const $=Math.abs(F-L.left),q=Math.abs(F-L.right),ee=Math.min($,q);let pe;const fe=b/p*(m+1);if(L.isDash){const _e=m-Math.abs(fe);pe=Math.sqrt(ee*ee+_e*_e)}else pe=m-Math.sqrt(ee*ee+fe*fe);this.data[C+F]=Math.max(0,Math.min(255,pe+128))}}}addRegularDash(r){for(let M=r.length-1;M>=0;--M){const L=r[M],F=r[M+1];L.zeroLength?r.splice(M,1):F&&F.isDash===L.isDash&&(F.left=L.left,r.splice(M,1))}const h=r[0],p=r[r.length-1];h.isDash===p.isDash&&(h.left=p.left-this.width,p.right=h.right+this.width);const m=this.width*this.nextRow;let b=0,C=r[b];for(let M=0;M<this.width;M++){M/C.right>1&&(C=r[++b]);const L=Math.abs(M-C.left),F=Math.abs(M-C.right),$=Math.min(L,F);this.data[m+M]=Math.max(0,Math.min(255,(C.isDash?$:-$)+128))}}addDash(r,h){const p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return a.w("LineAtlas out of space"),null;let b=0;for(let M=0;M<r.length;M++)b+=r[M];if(b!==0){const M=this.width/b,L=this.getDashRanges(r,this.width,M);h?this.addRoundDash(L,M,p):this.addRegularDash(L)}const C={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:b};return this.nextRow+=m,this.dirty=!0,C}bind(r){const h=r.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const zt="maplibre_preloaded_worker_pool";class Yt{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Yt.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zt]}numActive(){return Object.keys(this.active).length}}const It=Math.floor(S.hardwareConcurrency/2);let ti,Zt;function hi(){return ti||(ti=new Yt),ti}Yt.workerCount=a.B(globalThis)?Math.max(Math.min(It,3),1):1;class ki{constructor(r,h){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=h;const p=this.workerPool.acquire(h);for(let m=0;m<p.length;m++){const b=new a.C(p[m],h);b.name=`Worker ${m}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,h){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:r,data:h}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,h){for(const p of this.actors)p.registerMessageHandler(r,h)}}function yi(){return Zt||(Zt=new ki(hi(),a.G),Zt.registerMessageHandler("GR",(y,r,h)=>a.m(r,h))),Zt}function Pi(y,r){const h=a.F();return a.H(h,h,[1,1,0]),a.J(h,h,[.5*y.width,.5*y.height,1]),a.K(h,h,y.calculatePosMatrix(r.toUnwrapped()))}function ut(y,r,h,p,m,b){const C=function(q,ee,pe){if(q)for(const fe of q){const _e=ee[fe];if(_e&&_e.source===pe&&_e.type==="fill-extrusion")return!0}else for(const fe in ee){const _e=ee[fe];if(_e.source===pe&&_e.type==="fill-extrusion")return!0}return!1}(m&&m.layers,r,y.id),M=b.maxPitchScaleFactor(),L=y.tilesIn(p,M,C);L.sort(At);const F=[];for(const q of L)F.push({wrappedTileID:q.tileID.wrapped().key,queryResults:q.tile.queryRenderedFeatures(r,h,y._state,q.queryGeometry,q.cameraQueryGeometry,q.scale,m,b,M,Pi(y.transform,q.tileID))});const $=function(q){const ee={},pe={};for(const fe of q){const _e=fe.queryResults,ue=fe.wrappedTileID,Ce=pe[ue]=pe[ue]||{};for(const qe in _e){const be=_e[qe],Re=Ce[qe]=Ce[qe]||{},Ge=ee[qe]=ee[qe]||[];for(const He of be)Re[He.featureIndex]||(Re[He.featureIndex]=!0,Ge.push(He))}}return ee}(F);for(const q in $)$[q].forEach(ee=>{const pe=ee.feature,fe=y.getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=fe});return $}function At(y,r){const h=y.tileID,p=r.tileID;return h.overscaledZ-p.overscaledZ||h.canonical.y-p.canonical.y||h.wrap-p.wrap||h.canonical.x-p.canonical.x}function Ne(y,r,h){return a._(this,void 0,void 0,function*(){let p=y;if(y.url?p=(yield a.h(r.transformRequest(y.url,"Source"),h)).data:yield S.frameAsync(h),!p)return null;const m=a.L(a.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(b=>b.id)),m})}class je{constructor(r,h){r&&(h?this.setSouthWest(r).setNorthEast(h):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof a.M?new a.M(r.lng,r.lat):a.M.convert(r),this}setSouthWest(r){return this._sw=r instanceof a.M?new a.M(r.lng,r.lat):a.M.convert(r),this}extend(r){const h=this._sw,p=this._ne;let m,b;if(r instanceof a.M)m=r,b=r;else{if(!(r instanceof je))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(je.convert(r)):this.extend(a.M.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(a.M.convert(r)):this;if(m=r._sw,b=r._ne,!m||!b)return this}return h||p?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),p.lng=Math.max(b.lng,p.lng),p.lat=Math.max(b.lat,p.lat)):(this._sw=new a.M(m.lng,m.lat),this._ne=new a.M(b.lng,b.lat)),this}getCenter(){return new a.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.M(this.getWest(),this.getNorth())}getSouthEast(){return new a.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:h,lat:p}=a.M.convert(r);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(r){return r instanceof je?r:r&&new je(r)}static fromLngLat(r,h=0){const p=360*h/40075017,m=p/Math.cos(Math.PI/180*r.lat);return new je(new a.M(r.lng-m,r.lat-p),new a.M(r.lng+m,r.lat+p))}}class ot{constructor(r,h,p){this.bounds=je.convert(this.validateBounds(r)),this.minzoom=h||0,this.maxzoom=p||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const h=Math.pow(2,r.z),p=Math.floor(a.N(this.bounds.getWest())*h),m=Math.floor(a.O(this.bounds.getNorth())*h),b=Math.ceil(a.N(this.bounds.getEast())*h),C=Math.ceil(a.O(this.bounds.getSouth())*h);return r.x>=p&&r.x<b&&r.y>=m&&r.y<C}}class kt extends a.E{constructor(r,h,p,m){if(super(),this.id=r,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.L(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r&&(a.e(this,r),r.bounds&&(this.tileBounds=new ot(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new a.j(r))}})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(h,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise((b,C)=>{r.reloadPromise={resolve:b,reject:C}})}else r.actor=this.dispatcher.getActor(),m="LT";r.abortController=new AbortController;try{const b=yield r.actor.sendAsync({type:m,data:p},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,b)}catch(b){if(delete r.abortController,r.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(r,null)}})}_afterTileLoadWorkerResponse(r,h){if(h&&h.resourceTiming&&(r.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&r.setExpiryData(h),r.loadVectorData(h,this.map.painter),r.reloadPromise){const p=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(p.resolve).catch(p.reject)}}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class we extends a.E{constructor(r,h,p,m){super(),this.id=r,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.L(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield Ne(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,r&&(a.e(this,r),r.bounds&&(this.tileBounds=new ot(r.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new a.j(r))}})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}serialize(){return a.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const p=yield j.getImage(this.map._requestManager.transformRequest(h,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&r.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,b=m.gl,C=p.data;r.texture=this.map.painter.getTileTexture(C.width),r.texture?r.texture.update(C,{useMipmap:!0}):(r.texture=new ne(m,C,b.RGBA,{useMipmap:!0}),r.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),r.state="loaded"}}catch(p){if(delete r.abortController,r.aborted)r.state="unloaded";else if(p)throw r.state="errored",p}})}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)})}hasTransition(){return!1}}class di extends we{constructor(r,h,p,m){super(r,h,p,m),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(h,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const m=yield j.getImage(p,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(m&&m.data){const b=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&r.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const C=a.b(b)&&a.S()?b:yield this.readImageNow(b),M={type:this.type,uid:r.uid,source:this.id,rawImageData:C,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const L=yield r.actor.sendAsync({type:"LDT",data:M});r.dem=L,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(m){if(delete r.abortController,r.aborted)r.state="unloaded";else if(m)throw r.state="errored",m}})}readImageNow(r){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.U()){const h=r.width+2,p=r.height+2;try{return new a.R({width:h,height:p},yield a.V(r,-1,-1,h,p))}catch{}}return S.getImageData(r,1)})}_getNeighboringTiles(r){const h=r.canonical,p=Math.pow(2,h.z),m=(h.x-1+p)%p,b=h.x===0?r.wrap-1:r.wrap,C=(h.x+1+p)%p,M=h.x+1===p?r.wrap+1:r.wrap,L={};return L[new a.Q(r.overscaledZ,b,h.z,m,h.y).key]={backfilled:!1},L[new a.Q(r.overscaledZ,M,h.z,C,h.y).key]={backfilled:!1},h.y>0&&(L[new a.Q(r.overscaledZ,b,h.z,m,h.y-1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,r.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,M,h.z,C,h.y-1).key]={backfilled:!1}),h.y+1<p&&(L[new a.Q(r.overscaledZ,b,h.z,m,h.y+1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,r.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},L[new a.Q(r.overscaledZ,M,h.z,C,h.y+1).key]={backfilled:!1}),L}unloadTile(r){return a._(this,void 0,void 0,function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))})}}class Ve extends a.E{constructor(r,h,p,m){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const b=a.W/this.tileSize;this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*b,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*b,extent:a.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.W,radius:(h.clusterRadius||50)*b,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=r.clusterRadius),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,h,p){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:h,offset:p}})}_updateWorkerData(r){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);r?h.dataDiff=r:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(S.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&a.e(b,{resourceTiming:m}),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(r){return a._(this,void 0,void 0,function*(){const h=r.actor?"RT":"LT";r.actor=this.actor;const p={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};r.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:p},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(r){return a._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0})}unloadTile(r){return a._(this,void 0,void 0,function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var We=a.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class St extends a.E{constructor(r,h,p,m){super(),this.id=r,this.dispatcher=p,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(r){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield j.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,r&&(this.coordinates=r),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const h=r.map(a.Y.fromLngLat);this.tileID=function(m){let b=1/0,C=1/0,M=-1/0,L=-1/0;for(const ee of m)b=Math.min(b,ee.x),C=Math.min(C,ee.y),M=Math.max(M,ee.x),L=Math.max(L,ee.y);const F=Math.max(M-b,L-C),$=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),q=Math.pow(2,$);return new a.a0($,Math.floor((b+M)/2*q),Math.floor((C+L)/2*q))}(h),this.minzoom=this.maxzoom=this.tileID.z;const p=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new a.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,a.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,a.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,a.W,a.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,h=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,We.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ne(r,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class vn extends St{constructor(r,h,p,m){super(r,h,p,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const h of r.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const h=this.video.seekable;r<h.start(0)||r>h.end(0)?this.fire(new a.j(new a.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,h=r.gl;this.boundsBuffer||(this.boundsBuffer=r.createVertexBuffer(this._boundsArray,We.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ne(r,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,p=!0)}p&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class bn extends St{constructor(r,h,p,m){super(r,h,p,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(C=>typeof C!="number"))||this.fire(new a.j(new a.a1(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a1(`sources.${r}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a1(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a1(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a1(`sources.${r}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,p=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,We.members)),this.boundsSegments||(this.boundsSegments=a.$.simpleSegment(0,0,4,2)),this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ne(h,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const b in this.tiles){const C=this.tiles[b];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture,m=!0)}m&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Mn={},tr=y=>{switch(y){case"geojson":return Ve;case"image":return St;case"raster":return we;case"raster-dem":return di;case"vector":return kt;case"video":return vn;case"canvas":return bn}return Mn[y]},ir="RTLPluginLoaded";class qo extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=yi()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return a._(this,arguments,void 0,function*(h,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=S.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(ir))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ji=null;function ht(){return Ji||(Ji=new qo),Ji}class Hn{constructor(r,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=a.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const h=r+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,h,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(m,b){const C={};if(!b)return C;for(const M of m){const L=M.layerIds.map(F=>b.getLayer(F)).filter(Boolean);if(L.length!==0){M.layers=L,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(F=>L.filter($=>$.id===F)[0]));for(const F of L)C[F.id]=M}}return C}(r.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a5){if(this.hasSymbolBuckets=!0,!p)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const b=this.buckets[m];if(b instanceof a.a5&&b.hasRTLText){this.hasRTLText=!0,ht().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const b=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(b))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new a.a4}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(r)}const h=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ne(r,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ne(r,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,h,p,m,b,C,M,L,F,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:b,scale:C,tileSize:this.tileSize,pixelPosMatrix:$,transform:L,params:M,queryPadding:this.queryPadding*F},r,h,p):{}}querySourceFeatures(r,h){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),b=h&&h.sourceLayer?h.sourceLayer:"",C=m._geojsonTileLayer||m[b];if(!C)return;const M=a.a6(h&&h.filter),{z:L,x:F,y:$}=this.tileID.canonical,q={z:L,x:F,y:$};for(let ee=0;ee<C.length;ee++){const pe=C.feature(ee);if(M.needGeometry){const ue=a.a7(pe,!0);if(!M.filter(new a.a8(this.tileID.overscaledZ),ue,this.tileID.canonical))continue}else if(!M.filter(new a.a8(this.tileID.overscaledZ),pe))continue;const fe=p.getId(pe,b),_e=new a.a9(pe,L,F,$,fe);_e.tile=q,r.push(_e)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const h=this.expirationTime;if(r.cacheControl){const p=a.aa(r.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const b=this.expirationTime-h;b?this.expirationTime=p+Math.max(b,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const b=this.buckets[m],C=b.layers[0].sourceLayer||"_geojsonTileLayer",M=p[C],L=r[C];if(!M||!L||Object.keys(L).length===0)continue;b.update(L,M,this.imageAtlas&&this.imageAtlas.patternPositions||{});const F=h&&h.style&&h.style.getLayer(m);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<S.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=S.now()+r}setDependencies(r,h){const p={};for(const m of h)p[m]=!0;this.dependencies[r]=p}hasDependency(r,h){for(const p of r){const m=this.dependencies[p];if(m){for(const b of h)if(m[b])return!0}}return!1}}class wn{constructor(r,h){this.max=r,this.onRemove=h,this.reset()}reset(){for(const r in this.data)for(const h of this.data[r])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(r,h,p){const m=r.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const b={value:h,timeout:void 0};if(p!==void 0&&(b.timeout=setTimeout(()=>{this.remove(r,b)},p)),this.data[m].push(b),this.order.push(m),this.order.length>this.max){const C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const h=this.data[r].shift();return h.timeout&&clearTimeout(h.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),h.value}getByKey(r){const h=this.data[r];return h?h[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,h){if(!this.has(r))return this;const p=r.wrapped().key,m=h===void 0?0:this.data[p].indexOf(h),b=this.data[p][m];return this.data[p].splice(m,1),b.timeout&&clearTimeout(b.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(b.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(r){const h=[];for(const p in this.data)for(const m of this.data[p])r(m.value)||h.push(m);for(const p of h)this.remove(p.value.tileID,p)}}class Ao{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,h,p){const m=String(h);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][m]=this.stateChanges[r][m]||{},a.e(this.stateChanges[r][m],p),this.deletedStates[r]===null){this.deletedStates[r]={};for(const b in this.state[r])b!==m&&(this.deletedStates[r][b]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][m]===null){this.deletedStates[r][m]={};for(const b in this.state[r][m])p[b]||(this.deletedStates[r][m][b]=null)}else for(const b in p)this.deletedStates[r]&&this.deletedStates[r][m]&&this.deletedStates[r][m][b]===null&&delete this.deletedStates[r][m][b]}removeFeatureState(r,h,p){if(this.deletedStates[r]===null)return;const m=String(h);if(this.deletedStates[r]=this.deletedStates[r]||{},p&&h!==void 0)this.deletedStates[r][m]!==null&&(this.deletedStates[r][m]=this.deletedStates[r][m]||{},this.deletedStates[r][m][p]=null);else if(h!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][m])for(p in this.deletedStates[r][m]={},this.stateChanges[r][m])this.deletedStates[r][m][p]=null;else this.deletedStates[r][m]=null;else this.deletedStates[r]=null}getState(r,h){const p=String(h),m=a.e({},(this.state[r]||{})[p],(this.stateChanges[r]||{})[p]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const b=this.deletedStates[r][h];if(b===null)return{};for(const C in b)delete m[C]}return m}initializeTileState(r,h){r.setFeatureState(this.state,h)}coalesceChanges(r,h){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const b={};for(const C in this.stateChanges[m])this.state[m][C]||(this.state[m][C]={}),a.e(this.state[m][C],this.stateChanges[m][C]),b[C]=this.state[m][C];p[m]=b}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const b={};if(this.deletedStates[m]===null)for(const C in this.state[m])b[C]={},this.state[m][C]={};else for(const C in this.deletedStates[m]){if(this.deletedStates[m][C]===null)this.state[m][C]={};else for(const M of Object.keys(this.deletedStates[m][C]))delete this.state[m][C][M];b[C]=this.state[m][C]}p[m]=p[m]||{},a.e(p[m],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in r)r[m].setFeatureState(p,h)}}class Vi extends a.E{constructor(r,h,p){super(),this.id=r,this.dispatcher=p,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,b,C,M)=>{const L=new(tr(b.type))(m,b,C,M);if(L.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${L.id}`);return L})(r,h,p,this),this._tiles={},this._cache=new wn(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ao,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const h=this._tiles[r];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,h,p){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,h,p)}catch(m){r.state="errored",m.status!==404?this._source.fire(new a.j(m,{tile:r})):this.update(this.transform,this.terrain)}})}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new a.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const p=this._tiles[h];p.upload(r),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(gt).map(r=>r.key)}getRenderableIds(r){const h=[];for(const p in this._tiles)this._isIdRenderable(p,r)&&h.push(this._tiles[p]);return r?h.sort((p,m)=>{const b=p.tileID,C=m.tileID,M=new a.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),L=new a.P(C.canonical.x,C.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-C.overscaledZ||L.y-M.y||L.x-M.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(gt).map(p=>p.key)}hasRenderableParent(r){const h=this.findLoadedParent(r,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(r,h){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(h||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(r,"reloading")}}_reloadTile(r,h){return a._(this,void 0,void 0,function*(){const p=this._tiles[r];p&&(p.state!=="loading"&&(p.state=h),yield this._loadTile(p,r,h))})}_tileLoaded(r,h,p){r.timeAdded=S.now(),p==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(h,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const b=h[m];if(r.neighboringTiles&&r.neighboringTiles[b]){const C=this.getTileByID(b);p(r,C),p(C,r)}}function p(m,b){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let C=b.tileID.canonical.x-m.tileID.canonical.x;const M=b.tileID.canonical.y-m.tileID.canonical.y,L=Math.pow(2,m.tileID.canonical.z),F=b.tileID.key;C===0&&M===0||Math.abs(M)>1||(Math.abs(C)>1&&(Math.abs(C+L)===1?C+=L:Math.abs(C-L)===1&&(C-=L)),b.dem&&m.dem&&(m.dem.backfillBorder(b.dem,C,M),m.neighboringTiles&&m.neighboringTiles[F]&&(m.neighboringTiles[F].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,h,p,m){for(const b in this._tiles){let C=this._tiles[b];if(m[b]||!C.hasData()||C.tileID.overscaledZ<=h||C.tileID.overscaledZ>p)continue;let M=C.tileID;for(;C&&C.tileID.overscaledZ>h+1;){const F=C.tileID.scaledTo(C.tileID.overscaledZ-1);C=this._tiles[F.key],C&&C.hasData()&&(M=F)}let L=M;for(;L.overscaledZ>h;)if(L=L.scaledTo(L.overscaledZ-1),r[L.key]){m[M.key]=M;break}}}findLoadedParent(r,h){if(r.key in this._loadedParentTiles){const p=this._loadedParentTiles[r.key];return p&&p.tileID.overscaledZ>=h?p:null}for(let p=r.overscaledZ-1;p>=h;p--){const m=r.scaledTo(p),b=this._getLoadedTile(m);if(b)return b}}_getLoadedTile(r){const h=this._tiles[r.key];return h&&h.hasData()?h:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const h=Math.ceil(r.width/this._source.tileSize)+1,p=Math.ceil(r.height/this._source.tileSize)+1,m=Math.floor(h*p*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(b)}handleWrapJump(r){const h=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,h){const p={};for(const m in this._tiles){const b=this._tiles[m];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+h),p[b.tileID.key]=b}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(r,h){if(!this._sourceLoaded||this._paused)return;let p;this.transform=r,this.terrain=h,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=r.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new a.Q($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y)):(p=r.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(p=p.filter($=>this._source.hasTile($)))):p=[];const m=r.coveringZoomLevel(this._source),b=Math.max(m-Vi.maxOverzooming,this._source.minzoom),C=Math.max(m+Vi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const $={};for(const q of p)if(q.canonical.z>this._source.minzoom){const ee=q.scaledTo(q.canonical.z-1);$[ee.key]=ee;const pe=q.scaledTo(Math.max(this._source.minzoom,Math.min(q.canonical.z,5)));$[pe.key]=pe}p=p.concat(Object.values($))}const M=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,M&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const L=this._updateRetainedTiles(p,m);if(ri(this._source.type)){const $={},q={},ee=Object.keys(L),pe=S.now();for(const fe of ee){const _e=L[fe],ue=this._tiles[fe];if(!ue||ue.fadeEndTime!==0&&ue.fadeEndTime<=pe)continue;const Ce=this.findLoadedParent(_e,b);Ce&&(this._addTile(Ce.tileID),$[Ce.tileID.key]=Ce.tileID),q[fe]=_e}this._retainLoadedChildren(q,m,C,L);for(const fe in $)L[fe]||(this._coveredTiles[fe]=!0,L[fe]=$[fe]);if(h){const fe={},_e={};for(const ue of p)this._tiles[ue.key].hasData()?fe[ue.key]=ue:_e[ue.key]=ue;for(const ue in _e){const Ce=_e[ue].children(this._source.maxzoom);this._tiles[Ce[0].key]&&this._tiles[Ce[1].key]&&this._tiles[Ce[2].key]&&this._tiles[Ce[3].key]&&(fe[Ce[0].key]=L[Ce[0].key]=Ce[0],fe[Ce[1].key]=L[Ce[1].key]=Ce[1],fe[Ce[2].key]=L[Ce[2].key]=Ce[2],fe[Ce[3].key]=L[Ce[3].key]=Ce[3],delete _e[ue])}for(const ue in _e){const Ce=this.findLoadedParent(_e[ue],this._source.minzoom);if(Ce){fe[Ce.tileID.key]=L[Ce.tileID.key]=Ce.tileID;for(const qe in fe)fe[qe].isChildOf(Ce.tileID)&&delete fe[qe]}}for(const ue in this._tiles)fe[ue]||(this._coveredTiles[ue]=!0)}}for(const $ in L)this._tiles[$].clearFadeHold();const F=a.ab(this._tiles,L);for(const $ of F){const q=this._tiles[$];q.hasSymbolBuckets&&!q.holdingForFade()?q.setHoldDuration(this.map._fadeDuration):q.hasSymbolBuckets&&!q.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,h){const p={},m={},b=Math.max(h-Vi.maxOverzooming,this._source.minzoom),C=Math.max(h+Vi.maxUnderzooming,this._source.minzoom),M={};for(const L of r){const F=this._addTile(L);p[L.key]=L,F.hasData()||h<this._source.maxzoom&&(M[L.key]=L)}this._retainLoadedChildren(M,h,C,p);for(const L of r){let F=this._tiles[L.key];if(F.hasData())continue;if(h+1>this._source.maxzoom){const q=L.children(this._source.maxzoom)[0],ee=this.getTile(q);if(ee&&ee.hasData()){p[q.key]=q;continue}}else{const q=L.children(this._source.maxzoom);if(p[q[0].key]&&p[q[1].key]&&p[q[2].key]&&p[q[3].key])continue}let $=F.wasRequested();for(let q=L.overscaledZ-1;q>=b;--q){const ee=L.scaledTo(q);if(m[ee.key])break;if(m[ee.key]=!0,F=this.getTile(ee),!F&&$&&(F=this._addTile(ee)),F){const pe=F.hasData();if(($||pe)&&(p[ee.key]=ee),$=F.wasRequested(),pe)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const h=[];let p,m=this._tiles[r].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}h.push(m.key);const b=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(b),p)break;m=b}for(const b of h)this._loadedParentTiles[b]=p}}_addTile(r){let h=this._tiles[r.key];if(h)return h;h=this._cache.getAndRemove(r),h&&(this._setTileReloadTimer(r.key,h),h.tileID=r,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,h)));const p=h;return h||(h=new Hn(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(h,r.key,h.state)),h.uses++,this._tiles[r.key]=h,p||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(r,h){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const p=h.getExpiryTimeout();p&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},p))}_removeTile(r){const h=this._tiles[r];h&&(h.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(r){const h=r.sourceDataType;r.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&r.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,h,p){const m=[],b=this.transform;if(!b)return m;const C=p?b.getCameraQueryGeometry(r):r,M=r.map(fe=>b.pointCoordinate(fe,this.terrain)),L=C.map(fe=>b.pointCoordinate(fe,this.terrain)),F=this.getIds();let $=1/0,q=1/0,ee=-1/0,pe=-1/0;for(const fe of L)$=Math.min($,fe.x),q=Math.min(q,fe.y),ee=Math.max(ee,fe.x),pe=Math.max(pe,fe.y);for(let fe=0;fe<F.length;fe++){const _e=this._tiles[F[fe]];if(_e.holdingForFade())continue;const ue=_e.tileID,Ce=Math.pow(2,b.zoom-_e.tileID.overscaledZ),qe=h*_e.queryPadding*a.W/_e.tileSize/Ce,be=[ue.getTilePoint(new a.Y($,q)),ue.getTilePoint(new a.Y(ee,pe))];if(be[0].x-qe<a.W&&be[0].y-qe<a.W&&be[1].x+qe>=0&&be[1].y+qe>=0){const Re=M.map(He=>ue.getTilePoint(He)),Ge=L.map(He=>ue.getTilePoint(He));m.push({tile:_e,tileID:ue,queryGeometry:Re,cameraQueryGeometry:Ge,scale:Ce})}}return m}getVisibleCoordinates(r){const h=this.getRenderableIds(r).map(p=>this._tiles[p].tileID);for(const p of h)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(ri(this._source.type)){const r=S.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=r)return!0}return!1}setFeatureState(r,h,p){this._state.updateState(r=r||"_geojsonTileLayer",h,p)}removeFeatureState(r,h,p){this._state.removeFeatureState(r=r||"_geojsonTileLayer",h,p)}getFeatureState(r,h){return this._state.getState(r=r||"_geojsonTileLayer",h)}setDependencies(r,h,p){const m=this._tiles[r];m&&m.setDependencies(h,p)}reloadTilesForDependencies(r,h){for(const p in this._tiles)this._tiles[p].hasDependency(r,h)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(r,h))}}function gt(y,r){const h=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*r.wrap)-+(r.wrap<0);return y.overscaledZ-r.overscaledZ||p-h||r.canonical.y-y.canonical.y||r.canonical.x-y.canonical.x}function ri(y){return y==="raster"||y==="image"||y==="video"}Vi.maxOverzooming=10,Vi.maxUnderzooming=3;class Qt{constructor(r,h){this.reset(r,h)}reset(r,h){this.points=r||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=a.ac(r,0,1);let h=1,p=this._distances[h];const m=r*this.paddedLength+this.padding;for(;p<m&&h<this._distances.length;)p=this._distances[++h];const b=h-1,C=this._distances[b],M=p-C,L=M>0?(m-C)/M:0;return this.points[b].mult(1-L).add(this.points[h].mult(L))}}function $i(y,r){let h=!0;return y==="always"||y!=="never"&&r!=="never"||(h=!1),h}class vr{constructor(r,h,p){const m=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(r/p),this.yCellCount=Math.ceil(h/p);for(let C=0;C<this.xCellCount*this.yCellCount;C++)m.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=h,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,h,p,m,b){this._forEachCell(h,p,m,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(b)}insertCircle(r,h,p,m){this._forEachCell(h-m,p-m,h+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(h),this.circles.push(p),this.circles.push(m)}_insertBoxCell(r,h,p,m,b,C){this.boxCells[b].push(C)}_insertCircleCell(r,h,p,m,b,C){this.circleCells[b].push(C)}_query(r,h,p,m,b,C,M){if(p<0||r>this.width||m<0||h>this.height)return[];const L=[];if(r<=0&&h<=0&&this.width<=p&&this.height<=m){if(b)return[{key:null,x1:r,y1:h,x2:p,y2:m}];for(let F=0;F<this.boxKeys.length;F++)L.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const $=this.circles[3*F],q=this.circles[3*F+1],ee=this.circles[3*F+2];L.push({key:this.circleKeys[F],x1:$-ee,y1:q-ee,x2:$+ee,y2:q+ee})}}else this._forEachCell(r,h,p,m,this._queryCell,L,{hitTest:b,overlapMode:C,seenUids:{box:{},circle:{}}},M);return L}query(r,h,p,m){return this._query(r,h,p,m,!1,null)}hitTest(r,h,p,m,b,C){return this._query(r,h,p,m,!0,b,C).length>0}hitTestCircle(r,h,p,m,b){const C=r-p,M=r+p,L=h-p,F=h+p;if(M<0||C>this.width||F<0||L>this.height)return!1;const $=[];return this._forEachCell(C,L,M,F,this._queryCellCircle,$,{hitTest:!0,overlapMode:m,circle:{x:r,y:h,radius:p},seenUids:{box:{},circle:{}}},b),$.length>0}_queryCell(r,h,p,m,b,C,M,L){const{seenUids:F,hitTest:$,overlapMode:q}=M,ee=this.boxCells[b];if(ee!==null){const fe=this.bboxes;for(const _e of ee)if(!F.box[_e]){F.box[_e]=!0;const ue=4*_e,Ce=this.boxKeys[_e];if(r<=fe[ue+2]&&h<=fe[ue+3]&&p>=fe[ue+0]&&m>=fe[ue+1]&&(!L||L(Ce))&&(!$||!$i(q,Ce.overlapMode))&&(C.push({key:Ce,x1:fe[ue],y1:fe[ue+1],x2:fe[ue+2],y2:fe[ue+3]}),$))return!0}}const pe=this.circleCells[b];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!F.circle[_e]){F.circle[_e]=!0;const ue=3*_e,Ce=this.circleKeys[_e];if(this._circleAndRectCollide(fe[ue],fe[ue+1],fe[ue+2],r,h,p,m)&&(!L||L(Ce))&&(!$||!$i(q,Ce.overlapMode))){const qe=fe[ue],be=fe[ue+1],Re=fe[ue+2];if(C.push({key:Ce,x1:qe-Re,y1:be-Re,x2:qe+Re,y2:be+Re}),$)return!0}}}return!1}_queryCellCircle(r,h,p,m,b,C,M,L){const{circle:F,seenUids:$,overlapMode:q}=M,ee=this.boxCells[b];if(ee!==null){const fe=this.bboxes;for(const _e of ee)if(!$.box[_e]){$.box[_e]=!0;const ue=4*_e,Ce=this.boxKeys[_e];if(this._circleAndRectCollide(F.x,F.y,F.radius,fe[ue+0],fe[ue+1],fe[ue+2],fe[ue+3])&&(!L||L(Ce))&&!$i(q,Ce.overlapMode))return C.push(!0),!0}}const pe=this.circleCells[b];if(pe!==null){const fe=this.circles;for(const _e of pe)if(!$.circle[_e]){$.circle[_e]=!0;const ue=3*_e,Ce=this.circleKeys[_e];if(this._circlesCollide(fe[ue],fe[ue+1],fe[ue+2],F.x,F.y,F.radius)&&(!L||L(Ce))&&!$i(q,Ce.overlapMode))return C.push(!0),!0}}}_forEachCell(r,h,p,m,b,C,M,L){const F=this._convertToXCellCoord(r),$=this._convertToYCellCoord(h),q=this._convertToXCellCoord(p),ee=this._convertToYCellCoord(m);for(let pe=F;pe<=q;pe++)for(let fe=$;fe<=ee;fe++)if(b.call(this,r,h,p,m,this.xCellCount*fe+pe,C,M,L))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,h,p,m,b,C){const M=m-r,L=b-h,F=p+C;return F*F>M*M+L*L}_circleAndRectCollide(r,h,p,m,b,C,M){const L=(C-m)/2,F=Math.abs(r-(m+L));if(F>L+p)return!1;const $=(M-b)/2,q=Math.abs(h-(b+$));if(q>$+p)return!1;if(F<=L||q<=$)return!0;const ee=F-L,pe=q-$;return ee*ee+pe*pe<=p*p}}function ii(y,r,h,p,m){const b=a.F();return r?(a.J(b,b,[1/m,1/m,1]),h||a.ad(b,b,p.angle)):a.K(b,p.labelPlaneMatrix,y),b}function to(y,r,h,p,m){if(r){const b=a.ae(y);return a.J(b,b,[m,m,1]),h||a.ad(b,b,-p.angle),b}return p.glCoordMatrix}function un(y,r,h){let p;h?(p=[y.x,y.y,h(y.x,y.y),1],a.af(p,p,r)):(p=[y.x,y.y,0,1],Ye(p,p,r));const m=p[3];return{point:new a.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function me(y,r){return .5+y/r*.5}function W(y,r){const h=y[0]/y[3],p=y[1]/y[3];return h>=-r[0]&&h<=r[0]&&p>=-r[1]&&p<=r[1]}function K(y,r,h,p,m,b,C,M,L,F){const $=p?y.textSizeData:y.iconSizeData,q=a.ag($,h.transform.zoom),ee=[256/h.width*2+1,256/h.height*2+1],pe=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;pe.clear();const fe=y.lineVertexArray,_e=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,ue=h.transform.width/h.transform.height;let Ce=!1;for(let qe=0;qe<_e.length;qe++){const be=_e.get(qe);if(be.hidden||be.writingMode===a.ah.vertical&&!Ce){Ze(be.numGlyphs,pe);continue}let Re;if(Ce=!1,F?(Re=[be.anchorX,be.anchorY,F(be.anchorX,be.anchorY),1],a.af(Re,Re,r)):(Re=[be.anchorX,be.anchorY,0,1],Ye(Re,Re,r)),!W(Re,ee)){Ze(be.numGlyphs,pe);continue}const Ge=me(h.transform.cameraToCenterDistance,Re[3]),He=a.ai($,q,be),Ke=C?He/Ge:He*Ge,nt=new a.P(be.anchorX,be.anchorY),it=un(nt,m,F).point,ft={projections:{},offsets:{}},_t=Ae(be,Ke,!1,M,r,m,b,y.glyphOffsetArray,fe,pe,it,nt,ft,ue,L,F);Ce=_t.useVertical,(_t.notEnoughRoom||Ce||_t.needsFlipping&&Ae(be,Ke,!0,M,r,m,b,y.glyphOffsetArray,fe,pe,it,nt,ft,ue,L,F).notEnoughRoom)&&Ze(be.numGlyphs,pe)}p?y.text.dynamicLayoutVertexBuffer.updateData(pe):y.icon.dynamicLayoutVertexBuffer.updateData(pe)}function ie(y,r,h,p,m,b,C,M,L,F,$,q,ee){const pe=M.glyphStartIndex+M.numGlyphs,fe=M.lineStartIndex,_e=M.lineStartIndex+M.lineLength,ue=r.getoffsetX(M.glyphStartIndex),Ce=r.getoffsetX(pe-1),qe=Ue(y*ue,h,p,m,b,C,M.segment,fe,_e,L,F,$,q,ee);if(!qe)return null;const be=Ue(y*Ce,h,p,m,b,C,M.segment,fe,_e,L,F,$,q,ee);return be?{first:qe,last:be}:null}function de(y,r,h,p){return y===a.ah.horizontal&&Math.abs(h.y-r.y)>Math.abs(h.x-r.x)*p?{useVertical:!0}:(y===a.ah.vertical?r.y<h.y:r.x>h.x)?{needsFlipping:!0}:null}function Ae(y,r,h,p,m,b,C,M,L,F,$,q,ee,pe,fe,_e){const ue=r/24,Ce=y.lineOffsetX*ue,qe=y.lineOffsetY*ue;let be;if(y.numGlyphs>1){const Re=y.glyphStartIndex+y.numGlyphs,Ge=y.lineStartIndex,He=y.lineStartIndex+y.lineLength,Ke=ie(ue,M,Ce,qe,h,$,q,y,L,b,ee,fe,_e);if(!Ke)return{notEnoughRoom:!0};const nt=un(Ke.first.point,C,_e).point,it=un(Ke.last.point,C,_e).point;if(p&&!h){const ft=de(y.writingMode,nt,it,pe);if(ft)return ft}be=[Ke.first];for(let ft=y.glyphStartIndex+1;ft<Re-1;ft++)be.push(Ue(ue*M.getoffsetX(ft),Ce,qe,h,$,q,y.segment,Ge,He,L,b,ee,fe,_e));be.push(Ke.last)}else{if(p&&!h){const Ge=un(q,m,_e).point,He=y.lineStartIndex+y.segment+1,Ke=new a.P(L.getx(He),L.gety(He)),nt=un(Ke,m,_e),it=nt.signedDistanceFromCamera>0?nt.point:Pe(q,Ke,Ge,1,m,_e),ft=de(y.writingMode,Ge,it,pe);if(ft)return ft}const Re=Ue(ue*M.getoffsetX(y.glyphStartIndex),Ce,qe,h,$,q,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,L,b,ee,fe,_e);if(!Re)return{notEnoughRoom:!0};be=[Re]}for(const Re of be)a.aj(F,Re.point,Re.angle);return{}}function Pe(y,r,h,p,m,b){const C=un(y.add(y.sub(r)._unit()),m,b).point,M=h.sub(C);return h.add(M._mult(p/M.mag()))}function Be(y,r){const{projectionCache:h,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:b,distanceFromAnchor:C,getElevation:M,previousVertex:L,direction:F,absOffsetX:$}=r;if(h.projections[y])return h.projections[y];const q=new a.P(p.getx(y),p.gety(y)),ee=un(q,m,M);if(ee.signedDistanceFromCamera>0)return h.projections[y]=ee.point,ee.point;const pe=y-F;return Pe(C===0?b:new a.P(p.getx(pe),p.gety(pe)),q,L,$-C+1,m,M)}function Se(y,r,h){return y._unit()._perp()._mult(r*h)}function G(y,r,h,p,m,b,C,M){const{projectionCache:L,direction:F}=M;if(L.offsets[y])return L.offsets[y];const $=h.add(r);if(y+F<p||y+F>=m)return L.offsets[y]=$,$;const q=Be(y+F,M),ee=Se(q.sub(h),C,F),pe=h.add(ee),fe=q.add(ee);return L.offsets[y]=a.ak(b,$,pe,fe)||$,L.offsets[y]}function Ue(y,r,h,p,m,b,C,M,L,F,$,q,ee,pe){const fe=p?y-r:y+r;let _e=fe>0?1:-1,ue=0;p&&(_e*=-1,ue=Math.PI),_e<0&&(ue+=Math.PI);let Ce,qe,be=_e>0?M+C:M+C+1,Re=m,Ge=m,He=0,Ke=0;const nt=Math.abs(fe),it=[];let ft;for(;He+Ke<=nt;){if(be+=_e,be<M||be>=L)return null;He+=Ke,Ge=Re,qe=Ce;const yt={projectionCache:q,lineVertexArray:F,labelPlaneMatrix:$,tileAnchorPoint:b,distanceFromAnchor:He,getElevation:pe,previousVertex:Ge,direction:_e,absOffsetX:nt};if(Re=Be(be,yt),h===0)it.push(Ge),ft=Re.sub(Ge);else{let Jt;const si=Re.sub(Ge);Jt=si.mag()===0?Se(Be(be+_e,yt).sub(Re),h,_e):Se(si,h,_e),qe||(qe=Ge.add(Jt)),Ce=G(be,Jt,Re,M,L,qe,h,yt),it.push(qe),ft=Ce.sub(qe)}Ke=ft.mag()}const _t=ft._mult((nt-He)/Ke)._add(qe||Ge),oi=ue+Math.atan2(Re.y-Ge.y,Re.x-Ge.x);return it.push(_t),{point:_t,angle:ee?oi:0,path:it}}const $e=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ze(y,r){for(let h=0;h<y;h++){const p=r.length;r.resize(p+4),r.float32.set($e,3*p)}}function Ye(y,r,h){const p=r[0],m=r[1];return y[0]=h[0]*p+h[4]*m+h[12],y[1]=h[1]*p+h[5]*m+h[13],y[3]=h[3]*p+h[7]*m+h[15],y}const dt=100;class Ft{constructor(r,h=new vr(r.width+200,r.height+200,25),p=new vr(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+dt,this.screenBottomBoundary=r.height+dt,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,h,p,m,b,C){const M=this.projectAndGetPerspectiveRatio(m,r.anchorPointX,r.anchorPointY,C),L=p*M.perspectiveRatio,F=r.x1*L+M.point.x,$=r.y1*L+M.point.y,q=r.x2*L+M.point.x,ee=r.y2*L+M.point.y;return!this.isInsideGrid(F,$,q,ee)||h!=="always"&&this.grid.hitTest(F,$,q,ee,h,b)||M.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[F,$,q,ee],offscreen:this.isOffscreen(F,$,q,ee)}}placeCollisionCircles(r,h,p,m,b,C,M,L,F,$,q,ee,pe,fe){const _e=[],ue=new a.P(h.anchorX,h.anchorY),Ce=un(ue,C,fe),qe=me(this.transform.cameraToCenterDistance,Ce.signedDistanceFromCamera),be=($?b/qe:b*qe)/a.ao,Re=un(ue,M,fe).point,Ge=ie(be,m,h.lineOffsetX*be,h.lineOffsetY*be,!1,Re,ue,h,p,M,{projections:{},offsets:{}},!1,fe);let He=!1,Ke=!1,nt=!0;if(Ge){const it=.5*ee*qe+pe,ft=new a.P(-100,-100),_t=new a.P(this.screenRightBoundary,this.screenBottomBoundary),oi=new Qt,yt=Ge.first,Jt=Ge.last;let si=[];for(let ci=yt.path.length-1;ci>=1;ci--)si.push(yt.path[ci]);for(let ci=1;ci<Jt.path.length;ci++)si.push(Jt.path[ci]);const Ti=2.5*it;if(L){const ci=si.map(pi=>un(pi,L,fe));si=ci.some(pi=>pi.signedDistanceFromCamera<=0)?[]:ci.map(pi=>pi.point)}let ei=[];if(si.length>0){const ci=si[0].clone(),pi=si[0].clone();for(let pn=1;pn<si.length;pn++)ci.x=Math.min(ci.x,si[pn].x),ci.y=Math.min(ci.y,si[pn].y),pi.x=Math.max(pi.x,si[pn].x),pi.y=Math.max(pi.y,si[pn].y);ei=ci.x>=ft.x&&pi.x<=_t.x&&ci.y>=ft.y&&pi.y<=_t.y?[si]:pi.x<ft.x||ci.x>_t.x||pi.y<ft.y||ci.y>_t.y?[]:a.al([si],ft.x,ft.y,_t.x,_t.y)}for(const ci of ei){oi.reset(ci,.25*it);let pi=0;pi=oi.length<=.5*it?1:Math.ceil(oi.paddedLength/Ti)+1;for(let pn=0;pn<pi;pn++){const Ri=pn/Math.max(pi-1,1),Br=oi.lerp(Ri),Nn=Br.x+dt,an=Br.y+dt;_e.push(Nn,an,it,0);const jn=Nn-it,Fr=an-it,vo=Nn+it,Jo=an+it;if(nt=nt&&this.isOffscreen(jn,Fr,vo,Jo),Ke=Ke||this.isInsideGrid(jn,Fr,vo,Jo),r!=="always"&&this.grid.hitTestCircle(Nn,an,it,r,q)&&(He=!0,!F))return{circles:[],offscreen:!1,collisionDetected:He}}}}return{circles:!F&&He||!Ke||qe<this.perspectiveRatioCutoff?[]:_e,offscreen:nt,collisionDetected:He}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let p=1/0,m=1/0,b=-1/0,C=-1/0;for(const $ of r){const q=new a.P($.x+dt,$.y+dt);p=Math.min(p,q.x),m=Math.min(m,q.y),b=Math.max(b,q.x),C=Math.max(C,q.y),h.push(q)}const M=this.grid.query(p,m,b,C).concat(this.ignoredGrid.query(p,m,b,C)),L={},F={};for(const $ of M){const q=$.key;if(L[q.bucketInstanceId]===void 0&&(L[q.bucketInstanceId]={}),L[q.bucketInstanceId][q.featureIndex])continue;const ee=[new a.P($.x1,$.y1),new a.P($.x2,$.y1),new a.P($.x2,$.y2),new a.P($.x1,$.y2)];a.am(h,ee)&&(L[q.bucketInstanceId][q.featureIndex]=!0,F[q.bucketInstanceId]===void 0&&(F[q.bucketInstanceId]=[]),F[q.bucketInstanceId].push(q.featureIndex))}return F}insertCollisionBox(r,h,p,m,b,C){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:b,collisionGroupID:C,overlapMode:h},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,h,p,m,b,C){const M=p?this.ignoredGrid:this.grid,L={bucketInstanceId:m,featureIndex:b,collisionGroupID:C,overlapMode:h};for(let F=0;F<r.length;F+=4)M.insertCircle(L,r[F],r[F+1],r[F+2])}projectAndGetPerspectiveRatio(r,h,p,m){let b;return m?(b=[h,p,m(h,p),1],a.af(b,b,r)):(b=[h,p,0,1],Ye(b,b,r)),{point:new a.P((b[0]/b[3]+1)/2*this.transform.width+dt,(-b[1]/b[3]+1)/2*this.transform.height+dt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(r,h,p,m){return p<dt||r>=this.screenRightBoundary||m<dt||h>this.screenBottomBoundary}isInsideGrid(r,h,p,m){return p>=0&&r<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const r=a.an([]);return a.H(r,r,[-100,-100,0]),r}}function Kt(y,r,h){return r*(a.W/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class ai{constructor(r,h,p,m){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?h:-h))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class vi{constructor(r,h,p,m,b){this.text=new ai(r?r.text:null,h,p,b),this.icon=new ai(r?r.icon:null,h,m,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yi{constructor(r,h,p){this.text=r,this.icon=h,this.skipFade=p}}class In{constructor(){this.invProjMatrix=a.F(),this.viewportMatrix=a.F(),this.circles=[]}}class li{constructor(r,h,p,m,b){this.bucketInstanceId=r,this.featureIndex=h,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=b}}class hn{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const h=++this.maxGroupID;this.collisionGroups[r]={ID:h,predicate:p=>p.collisionGroupID===h}}return this.collisionGroups[r]}}function On(y,r,h,p,m){const{horizontalAlign:b,verticalAlign:C}=a.at(y);return new a.P(-(b-.5)*r+p[0]*m,-(C-.5)*h+p[1]*m)}function ur(y,r,h,p,m,b){const{x1:C,x2:M,y1:L,y2:F,anchorPointX:$,anchorPointY:q}=y,ee=new a.P(r,h);return p&&ee._rotate(m?b:-b),{x1:C+ee.x,y1:L+ee.y,x2:M+ee.x,y2:F+ee.y,anchorPointX:$,anchorPointY:q}}class br{constructor(r,h,p,m,b){this.transform=r.clone(),this.terrain=h,this.collisionIndex=new Ft(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new hn(m),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,h,p,m){const b=p.getBucket(h),C=p.latestFeatureIndex;if(!b||!C||h.id!==b.layerIds[0])return;const M=p.collisionBoxArray,L=b.layers[0].layout,F=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),$=p.tileSize/a.W,q=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),ee=L.get("text-pitch-alignment")==="map",pe=L.get("text-rotation-alignment")==="map",fe=Kt(p,1,this.transform.zoom),_e=ii(q,ee,pe,this.transform,fe);let ue=null;if(ee){const qe=to(q,ee,pe,this.transform,fe);ue=a.K([],this.transform.labelPlaneMatrix,qe)}this.retainedQueryData[b.bucketInstanceId]=new li(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,p.tileID);const Ce={bucket:b,layout:L,posMatrix:q,textLabelPlaneMatrix:_e,labelToScreenMatrix:ue,scale:F,textPixelRatio:$,holdingForFade:p.holdingForFade(),collisionBoxArray:M,partiallyEvaluatedTextSize:a.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(m)for(const qe of b.sortKeyRanges){const{sortKey:be,symbolInstanceStart:Re,symbolInstanceEnd:Ge}=qe;r.push({sortKey:be,symbolInstanceStart:Re,symbolInstanceEnd:Ge,parameters:Ce})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(r,h,p,m,b,C,M,L,F,$,q,ee,pe,fe,_e,ue){const Ce=a.ap[r.textAnchor],qe=[r.textOffset0,r.textOffset1],be=On(Ce,p,m,qe,b),Re=this.collisionIndex.placeCollisionBox(ur(h,be.x,be.y,C,M,this.transform.angle),q,L,F,$.predicate,ue);if((!_e||this.collisionIndex.placeCollisionBox(ur(_e,be.x,be.y,C,M,this.transform.angle),q,L,F,$.predicate,ue).box.length!==0)&&Re.box.length>0){let Ge;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[ee.crossTileID].anchor),ee.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ee.crossTileID]={textOffset:qe,width:p,height:m,anchor:Ce,textBoxScale:b,prevAnchor:Ge},this.markUsedJustification(pe,Ce,ee,fe),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,fe,ee),this.placedOrientations[ee.crossTileID]=fe),{shift:be,placedGlyphBoxes:Re}}}placeLayerBucketPart(r,h,p){const{bucket:m,layout:b,posMatrix:C,textLabelPlaneMatrix:M,labelToScreenMatrix:L,textPixelRatio:F,holdingForFade:$,collisionBoxArray:q,partiallyEvaluatedTextSize:ee,collisionGroup:pe}=r.parameters,fe=b.get("text-optional"),_e=b.get("icon-optional"),ue=a.aq(b,"text-overlap","text-allow-overlap"),Ce=ue==="always",qe=a.aq(b,"icon-overlap","icon-allow-overlap"),be=qe==="always",Re=b.get("text-rotation-alignment")==="map",Ge=b.get("text-pitch-alignment")==="map",He=b.get("icon-text-fit")!=="none",Ke=b.get("symbol-z-order")==="viewport-y",nt=Ce&&(be||!m.hasIconData()||_e),it=be&&(Ce||!m.hasTextData()||fe);!m.collisionArrays&&q&&m.deserializeCollisionBoxes(q);const ft=this.retainedQueryData[m.bucketInstanceId].tileID,_t=this.terrain?(yt,Jt)=>this.terrain.getElevation(ft,yt,Jt):null,oi=(yt,Jt)=>{var si,Ti;if(h[yt.crossTileID])return;if($)return void(this.placements[yt.crossTileID]=new Yi(!1,!1,!1));let ei=!1,ci=!1,pi=!0,pn=null,Ri={box:null,offscreen:null},Br={box:null,offscreen:null},Nn=null,an=null,jn=null,Fr=0,vo=0,Jo=0;Jt.textFeatureIndex?Fr=Jt.textFeatureIndex:yt.useRuntimeCollisionCircles&&(Fr=yt.featureIndex),Jt.verticalTextFeatureIndex&&(vo=Jt.verticalTextFeatureIndex);const Ia=Jt.textBox;if(Ia){const An=Pn=>{let cn=a.ah.horizontal;if(m.allowVerticalPlacement&&!Pn&&this.prevPlacement){const Jr=this.prevPlacement.placedOrientations[yt.crossTileID];Jr&&(this.placedOrientations[yt.crossTileID]=Jr,cn=Jr,this.markUsedOrientation(m,cn,yt))}return cn},ln=(Pn,cn)=>{if(m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&Jt.verticalTextBox){for(const Jr of m.writingModes)if(Jr===a.ah.vertical?(Ri=cn(),Br=Ri):Ri=Pn(),Ri&&Ri.box&&Ri.box.length)break}else Ri=Pn()},en=yt.textAnchorOffsetStartIndex,Kr=yt.textAnchorOffsetEndIndex;if(Kr===en){const Pn=(cn,Jr)=>{const zn=this.collisionIndex.placeCollisionBox(cn,ue,F,C,pe.predicate,_t);return zn&&zn.box&&zn.box.length&&(this.markUsedOrientation(m,Jr,yt),this.placedOrientations[yt.crossTileID]=Jr),zn};ln(()=>Pn(Ia,a.ah.horizontal),()=>{const cn=Jt.verticalTextBox;return m.allowVerticalPlacement&&yt.numVerticalGlyphVertices>0&&cn?Pn(cn,a.ah.vertical):{box:null,offscreen:null}}),An(Ri&&Ri.box&&Ri.box.length)}else{let Pn=a.ap[(Ti=(si=this.prevPlacement)===null||si===void 0?void 0:si.variableOffsets[yt.crossTileID])===null||Ti===void 0?void 0:Ti.anchor];const cn=(zn,_n,Uc)=>{const zh=zn.x2-zn.x1,ds=zn.y2-zn.y1,fs=yt.textBoxScale,Cl=He&&qe==="never"?_n:null;let Qo={box:[],offscreen:!1},Vc=ue==="never"?1:2,Dh="never";Pn&&Vc++;for(let $c=0;$c<Vc;$c++){for(let qc=en;qc<Kr;qc++){const El=m.textAnchorOffsets.get(qc);if(Pn&&El.textAnchor!==Pn)continue;const Zc=this.attemptAnchorPlacement(El,zn,zh,ds,fs,Re,Ge,F,C,pe,Dh,yt,m,Uc,Cl,_t);if(Zc&&(Qo=Zc.placedGlyphBoxes,Qo&&Qo.box&&Qo.box.length))return ei=!0,pn=Zc.shift,Qo}Pn?Pn=null:Dh=ue}return Qo};ln(()=>cn(Ia,Jt.iconBox,a.ah.horizontal),()=>{const zn=Jt.verticalTextBox;return m.allowVerticalPlacement&&!(Ri&&Ri.box&&Ri.box.length)&&yt.numVerticalGlyphVertices>0&&zn?cn(zn,Jt.verticalIconBox,a.ah.vertical):{box:null,offscreen:null}}),Ri&&(ei=Ri.box,pi=Ri.offscreen);const Jr=An(Ri&&Ri.box);if(!ei&&this.prevPlacement){const zn=this.prevPlacement.variableOffsets[yt.crossTileID];zn&&(this.variableOffsets[yt.crossTileID]=zn,this.markUsedJustification(m,zn.anchor,yt,Jr))}}}if(Nn=Ri,ei=Nn&&Nn.box&&Nn.box.length>0,pi=Nn&&Nn.offscreen,yt.useRuntimeCollisionCircles){const An=m.text.placedSymbolArray.get(yt.centerJustifiedTextSymbolIndex),ln=a.ai(m.textSizeData,ee,An),en=b.get("text-padding");an=this.collisionIndex.placeCollisionCircles(ue,An,m.lineVertexArray,m.glyphOffsetArray,ln,C,M,L,p,Ge,pe.predicate,yt.collisionCircleDiameter,en,_t),an.circles.length&&an.collisionDetected&&!p&&a.w("Collisions detected, but collision boxes are not shown"),ei=Ce||an.circles.length>0&&!an.collisionDetected,pi=pi&&an.offscreen}if(Jt.iconFeatureIndex&&(Jo=Jt.iconFeatureIndex),Jt.iconBox){const An=ln=>{const en=He&&pn?ur(ln,pn.x,pn.y,Re,Ge,this.transform.angle):ln;return this.collisionIndex.placeCollisionBox(en,qe,F,C,pe.predicate,_t)};Br&&Br.box&&Br.box.length&&Jt.verticalIconBox?(jn=An(Jt.verticalIconBox),ci=jn.box.length>0):(jn=An(Jt.iconBox),ci=jn.box.length>0),pi=pi&&jn.offscreen}const Yo=fe||yt.numHorizontalGlyphVertices===0&&yt.numVerticalGlyphVertices===0,bo=_e||yt.numIconVertices===0;if(Yo||bo?bo?Yo||(ci=ci&&ei):ei=ci&&ei:ci=ei=ci&&ei,ei&&Nn&&Nn.box&&this.collisionIndex.insertCollisionBox(Nn.box,ue,b.get("text-ignore-placement"),m.bucketInstanceId,Br&&Br.box&&vo?vo:Fr,pe.ID),ci&&jn&&this.collisionIndex.insertCollisionBox(jn.box,qe,b.get("icon-ignore-placement"),m.bucketInstanceId,Jo,pe.ID),an&&(ei&&this.collisionIndex.insertCollisionCircles(an.circles,ue,b.get("text-ignore-placement"),m.bucketInstanceId,Fr,pe.ID),p)){const An=m.bucketInstanceId;let ln=this.collisionCircleArrays[An];ln===void 0&&(ln=this.collisionCircleArrays[An]=new In);for(let en=0;en<an.circles.length;en+=4)ln.circles.push(an.circles[en+0]),ln.circles.push(an.circles[en+1]),ln.circles.push(an.circles[en+2]),ln.circles.push(an.collisionDetected?1:0)}if(yt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[yt.crossTileID]=new Yi(ei||nt,ci||it,pi||m.justReloaded),h[yt.crossTileID]=!0};if(Ke){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const yt=m.getSortedSymbolIndexes(this.transform.angle);for(let Jt=yt.length-1;Jt>=0;--Jt){const si=yt[Jt];oi(m.symbolInstances.get(si),m.collisionArrays[si])}}else for(let yt=r.symbolInstanceStart;yt<r.symbolInstanceEnd;yt++)oi(m.symbolInstances.get(yt),m.collisionArrays[yt]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const yt=this.collisionCircleArrays[m.bucketInstanceId];a.ar(yt.invProjMatrix,C),yt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(r,h,p,m){let b;b=m===a.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[a.as(h)];const C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const M of C)M>=0&&(r.text.placedSymbolArray.get(M).crossTileID=b>=0&&M!==b?0:p.crossTileID)}markUsedOrientation(r,h,p){const m=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,b=h===a.ah.vertical?h:0,C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const M of C)r.text.placedSymbolArray.get(M).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let p=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(r):1,b=h?h.opacities:{},C=h?h.variableOffsets:{},M=h?h.placedOrientations:{};for(const L in this.placements){const F=this.placements[L],$=b[L];$?(this.opacities[L]=new vi($,m,F.text,F.icon),p=p||F.text!==$.text.placed||F.icon!==$.icon.placed):(this.opacities[L]=new vi(null,m,F.text,F.icon,F.skipFade),p=p||F.text||F.icon)}for(const L in b){const F=b[L];if(!this.opacities[L]){const $=new vi(F,m,!1,!1);$.isHidden()||(this.opacities[L]=$,p=p||F.text.placed||F.icon.placed)}}for(const L in C)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=C[L]);for(const L in M)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=M[L]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:r)}updateLayerOpacities(r,h){const p={};for(const m of h){const b=m.getBucket(r);b&&m.latestFeatureIndex&&r.id===b.layerIds[0]&&this.updateBucketOpacities(b,p,m.collisionBoxArray)}}updateBucketOpacities(r,h,p){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const m=r.layers[0],b=m.layout,C=new vi(null,0,!1,!1,!0),M=b.get("text-allow-overlap"),L=b.get("icon-allow-overlap"),F=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=b.get("text-rotation-alignment")==="map",q=b.get("text-pitch-alignment")==="map",ee=b.get("icon-text-fit")!=="none",pe=new vi(null,0,M&&(L||!r.hasIconData()||b.get("icon-optional")),L&&(M||!r.hasTextData()||b.get("text-optional")),!0);!r.collisionArrays&&p&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(p);const fe=(_e,ue,Ce)=>{for(let qe=0;qe<ue/4;qe++)_e.opacityVertexArray.emplaceBack(Ce);_e.hasVisibleVertices=_e.hasVisibleVertices||Ce!==aa};for(let _e=0;_e<r.symbolInstances.length;_e++){const ue=r.symbolInstances.get(_e),{numHorizontalGlyphVertices:Ce,numVerticalGlyphVertices:qe,crossTileID:be}=ue;let Re=this.opacities[be];h[be]?Re=C:Re||(Re=pe,this.opacities[be]=Re),h[be]=!0;const Ge=ue.numIconVertices>0,He=this.placedOrientations[ue.crossTileID],Ke=He===a.ah.vertical,nt=He===a.ah.horizontal||He===a.ah.horizontalOnly;if(Ce>0||qe>0){const it=wr(Re.text);fe(r.text,Ce,Ke?aa:it),fe(r.text,qe,nt?aa:it);const ft=Re.text.isHidden();[ue.rightJustifiedTextSymbolIndex,ue.centerJustifiedTextSymbolIndex,ue.leftJustifiedTextSymbolIndex].forEach(yt=>{yt>=0&&(r.text.placedSymbolArray.get(yt).hidden=ft||Ke?1:0)}),ue.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(ue.verticalPlacedTextSymbolIndex).hidden=ft||nt?1:0);const _t=this.variableOffsets[ue.crossTileID];_t&&this.markUsedJustification(r,_t.anchor,ue,He);const oi=this.placedOrientations[ue.crossTileID];oi&&(this.markUsedJustification(r,"left",ue,oi),this.markUsedOrientation(r,oi,ue))}if(Ge){const it=wr(Re.icon),ft=!(ee&&ue.verticalPlacedIconSymbolIndex&&Ke);ue.placedIconSymbolIndex>=0&&(fe(r.icon,ue.numIconVertices,ft?it:aa),r.icon.placedSymbolArray.get(ue.placedIconSymbolIndex).hidden=Re.icon.isHidden()),ue.verticalPlacedIconSymbolIndex>=0&&(fe(r.icon,ue.numVerticalIconVertices,ft?aa:it),r.icon.placedSymbolArray.get(ue.verticalPlacedIconSymbolIndex).hidden=Re.icon.isHidden())}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const it=r.collisionArrays[_e];if(it){let ft=new a.P(0,0);if(it.textBox||it.verticalTextBox){let oi=!0;if(F){const yt=this.variableOffsets[be];yt?(ft=On(yt.anchor,yt.width,yt.height,yt.textOffset,yt.textBoxScale),$&&ft._rotate(q?this.transform.angle:-this.transform.angle)):oi=!1}it.textBox&&Xn(r.textCollisionBox.collisionVertexArray,Re.text.placed,!oi||Ke,ft.x,ft.y),it.verticalTextBox&&Xn(r.textCollisionBox.collisionVertexArray,Re.text.placed,!oi||nt,ft.x,ft.y)}const _t=!!(!nt&&it.verticalIconBox);it.iconBox&&Xn(r.iconCollisionBox.collisionVertexArray,Re.icon.placed,_t,ee?ft.x:0,ee?ft.y:0),it.verticalIconBox&&Xn(r.iconCollisionBox.collisionVertexArray,Re.icon.placed,!_t,ee?ft.x:0,ee?ft.y:0)}}}if(r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);if(r.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=_e.invProjMatrix,r.placementViewportMatrix=_e.viewportMatrix,r.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,h){const p=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*p>r}setStale(){this.stale=!0}}function Xn(y,r,h,p,m){y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0),y.emplaceBack(r?1:0,h?1:0,p||0,m||0)}const po=Math.pow(2,25),Ku=Math.pow(2,24),Od=Math.pow(2,17),zi=Math.pow(2,16),cc=Math.pow(2,9),uc=Math.pow(2,8),zr=Math.pow(2,1);function wr(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const r=y.placed?1:0,h=Math.floor(127*y.opacity);return h*po+r*Ku+h*Od+r*zi+h*cc+r*uc+h*zr+r}const aa=0;class Hr{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,h,p,m,b){const C=this._bucketParts;for(;this._currentTileIndex<r.length;)if(h.getBucketParts(C,m,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort((M,L)=>M.sortKey-L.sortKey));this._currentPartIndex<C.length;)if(h.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,b())return!0;return!1}}class Xr{constructor(r,h,p,m,b,C,M,L){this.placement=new br(r,h,C,M,L),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(r,h,p){const m=S.now(),b=()=>!this._forceFullPlacement&&S.now()-m>2;for(;this._currentPlacementIndex>=0;){const C=h[r[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=M)&&(!C.maxzoom||C.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Hr(C)),this._inProgressLayer.continuePlacement(p[C.source],this.placement,this._showCollisionBoxes,C,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const As=512/a.W/2;class Ua{constructor(r,h,p){this.tileID=r,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let b=0;b<h.length;b++){const C=h.get(b),M=C.key,L=m.get(M);L?L.push(C):m.set(M,[C])}for(const[b,C]of m){const M={positions:C.map(L=>({x:Math.floor(L.anchorX*As),y:Math.floor(L.anchorY*As)})),crossTileIDs:C.map(L=>L.crossTileID)};if(M.positions.length>128){const L=new a.au(M.positions.length,16,Uint16Array);for(const{x:F,y:$}of M.positions)L.add(F,$);L.finish(),delete M.positions,M.index=L}this._symbolsByKey[b]=M}}getScaledCoordinates(r,h){const{x:p,y:m,z:b}=this.tileID.canonical,{x:C,y:M,z:L}=h.canonical,F=As/Math.pow(2,L-b),$=(M*a.W+r.anchorY)*F,q=m*a.W*As;return{x:Math.floor((C*a.W+r.anchorX)*F-p*a.W*As),y:Math.floor($-q)}}findMatches(r,h,p){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let b=0;b<r.length;b++){const C=r.get(b);if(C.crossTileID)continue;const M=this._symbolsByKey[C.key];if(!M)continue;const L=this.getScaledCoordinates(C,h);if(M.index){const F=M.index.range(L.x-m,L.y-m,L.x+m,L.y+m).sort();for(const $ of F){const q=M.crossTileIDs[$];if(!p[q]){p[q]=!0,C.crossTileID=q;break}}}else if(M.positions)for(let F=0;F<M.positions.length;F++){const $=M.positions[F],q=M.crossTileIDs[F];if(Math.abs($.x-L.x)<=m&&Math.abs($.y-L.y)<=m&&!p[q]){p[q]=!0,C.crossTileID=q;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class Ln{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class la{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const h=Math.round((r-this.lng)/360);if(h!==0)for(const p in this.indexes){const m=this.indexes[p],b={};for(const C in m){const M=m[C];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+h),b[M.tileID.key]=M}this.indexes[p]=b}this.lng=r}addBucket(r,h,p){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let b=0;b<h.symbolInstances.length;b++)h.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const m=this.usedCrossTileIDs[r.overscaledZ];for(const b in this.indexes){const C=this.indexes[b];if(Number(b)>r.overscaledZ)for(const M in C){const L=C[M];L.tileID.isChildOf(r)&&L.findMatches(h.symbolInstances,r,m)}else{const M=C[r.scaledTo(Number(b)).key];M&&M.findMatches(h.symbolInstances,r,m)}}for(let b=0;b<h.symbolInstances.length;b++){const C=h.symbolInstances.get(b);C.crossTileID||(C.crossTileID=p.generate(),m[C.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Ua(r,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(r,h){for(const p of h.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[r][m]}removeStaleBuckets(r){let h=!1;for(const p in this.indexes){const m=this.indexes[p];for(const b in m)r[m[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[b]),delete m[b],h=!0)}return h}}class Zo{constructor(){this.layerIndexes={},this.crossTileIDs=new Ln,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,h,p){let m=this.layerIndexes[r.id];m===void 0&&(m=this.layerIndexes[r.id]=new la);let b=!1;const C={};m.handleWrapJump(p);for(const M of h){const L=M.getBucket(r);L&&r.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(M.tileID,L,this.crossTileIDs)&&(b=!0),C[L.bucketInstanceId]=!0)}return m.removeStaleBuckets(C)&&(b=!0),b}pruneUnusedLayers(r){const h={};r.forEach(p=>{h[p]=!0});for(const p in this.layerIndexes)h[p]||delete this.layerIndexes[p]}}const sn=(y,r)=>a.t(y,r&&r.filter(h=>h.identifier!=="source.canvas")),Va=a.av();class Dr extends a.E{constructor(r,h={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=r,this.dispatcher=new ki(hi(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("GI",(p,m)=>this.getImages(p,m)),this.imageManager=new Je,this.imageManager.setEventedParent(this),this.glyphManager=new pt(r._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Nt(256,512),this.crossTileSymbolIndex=new Zo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ax()),ht().on(ir,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const b=m.getSource();if(b&&b.vectorLayerIds)for(const C in this._layers){const M=this._layers[C];M.source===b.id&&this._validateLayer(M)}})}loadURL(r,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController,a.h(m,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,h,p)}).catch(b=>{this._loadStyleRequest=null,b&&this.fire(new a.j(b))})}loadJSON(r,h={},p){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(r,h,p)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(Va,{validate:!1})}_load(r,h,p){var m;const b=h.transformStyle?h.transformStyle(p,r):r;if(!h.validate||!sn(this,a.x(b))){this._loaded=!0,this.stylesheet=b;for(const C in b.sources)this.addSource(C,b.sources[C],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new ni(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const r=a.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",r),this._order=r.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of r){const p=a.az(h);p.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=p}}_loadSprite(r,h=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,C,M,L){return a._(this,void 0,void 0,function*(){const F=Oe(b),$=M>1?"@2x":"",q={},ee={};for(const{id:pe,url:fe}of F){const _e=C.transformRequest(C.normalizeSpriteURL(fe,$,".json"),"SpriteJSON");q[pe]=a.h(_e,L);const ue=C.transformRequest(C.normalizeSpriteURL(fe,$,".png"),"SpriteImage");ee[pe]=j.getImage(ue,L)}return yield Promise.all([...Object.values(q),...Object.values(ee)]),function(pe,fe){return a._(this,void 0,void 0,function*(){const _e={};for(const ue in pe){_e[ue]={};const Ce=S.getImageCanvasContext((yield fe[ue]).data),qe=(yield pe[ue]).data;for(const be in qe){const{width:Re,height:Ge,x:He,y:Ke,sdf:nt,pixelRatio:it,stretchX:ft,stretchY:_t,content:oi}=qe[be];_e[ue][be]={data:null,pixelRatio:it,sdf:nt,stretchX:ft,stretchY:_t,content:oi,spriteData:{width:Re,height:Ge,x:He,y:Ke,context:Ce}}}}return _e})}(q,ee)})}(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const C in b){this._spritesImagesIds[C]=[];const M=this._spritesImagesIds[C]?this._spritesImagesIds[C].filter(L=>!(L in b)):[];for(const L of M)this.imageManager.removeImage(L),this._changedImages[L]=!0;for(const L in b[C]){const F=C==="default"?L:`${C}:${L}`;this._spritesImagesIds[C].push(F),F in this.imageManager.images?this.imageManager.updateImage(F,b[C][L],!1):this.imageManager.addImage(F,b[C][L]),h&&(this._changedImages[F]=!0)}}}).catch(b=>{this._spriteRequest=null,m=b,this.fire(new a.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(r){const h=this.sourceCaches[r.source];if(!h)return;const p=r.sourceLayer;if(!p)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new a.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r){const h=this._serializedAllLayers();if(!r||r.length===0)return Object.values(h);const p=[];for(const m of r)h[m]&&p.push(h[m]);return p}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const h=Object.keys(this._layers);for(const p of h){const m=this._layers[p];m.type!=="custom"&&(r[p]=m.serialize())}return r}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const r in this.sourceCaches)if(this.sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(m.length||b.length)&&this._updateWorkerLayers(m,b);for(const C in this._updatedSources){const M=this._updatedSources[C];if(M==="reload")this._reloadSource(C);else{if(M!=="clear")throw new Error(`Invalid action ${M}`);this._clearSource(C)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const C in this._updatedPaintProps)this._layers[C].updateTransitions(r);this.light.updateTransitions(r),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const b=this.sourceCaches[m];p[m]=b.used,b.used=!1}for(const m of this._order){const b=this._layers[m];b.recalculate(r,this._availableImages),!b.isHidden(r.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const m in p){const b=this.sourceCaches[m];!!p[m]!=!!b.used&&b.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(r),this.z=r.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,h={}){var p;this._checkLoaded();const m=this.serialize();if(r=h.transformStyle?h.transformStyle(m,r):r,((p=h.validate)===null||p===void 0||p)&&sn(this,a.x(r)))return!1;(r=a.aA(r)).layers=a.ay(r.layers);const b=a.aB(m,r),C=this._getOperationsToPerform(b);if(C.unimplemented.length>0)throw new Error(`Unimplemented: ${C.unimplemented.join(", ")}.`);if(C.operations.length===0)return!1;for(const M of C.operations)M();return this.stylesheet=r,this._serializedLayers=null,!0}_getOperationsToPerform(r){const h=[],p=[];for(const m of r)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:p.push(m.command)}return{operations:h,unimplemented:p}}addImage(r,h){if(this.getImage(r))return this.fire(new a.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,h),this._afterImageUpdated(r)}updateImage(r,h){this.imageManager.updateImage(r,h)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new a.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,h,p={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.x.source,`sources.${r}`,h,null,p))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[r]=new Vi(r,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:r})),m.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===r)return this.fire(new a.j(new Error(`Source "${r}" cannot be removed while layer "${p}" is using it.`)));const h=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,h){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const p=this.sourceCaches[r].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(h),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,h,p={}){this._checkLoaded();const m=r.id;if(this.getLayer(m))return void this.fire(new a.j(new Error(`Layer "${m}" already exists on this map.`)));let b;if(r.type==="custom"){if(sn(this,a.aC(r)))return;b=a.az(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(m,r.source),r=a.aA(r),r=a.e(r,{source:m})),this._validate(a.x.layer,`layers.${m}`,r,{arrayIndex:-1},p))return;b=a.az(r),this._validateLayer(b),b.setEventedParent(this,{layer:{id:m}})}const C=h?this._order.indexOf(h):this._order.length;if(h&&C===-1)this.fire(new a.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(C,0,m),this._layerOrderChanged=!0,this._layers[m]=b,this._removedLayers[m]&&b.source&&b.type!=="custom"){const M=this._removedLayers[m];delete this._removedLayers[m],M.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(r,h){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new a.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===h)return;const p=this._order.indexOf(r);this._order.splice(p,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new a.j(new Error(`Cannot move layer "${r}" before non-existing layer "${h}".`))):(this._order.splice(m,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const h=this._layers[r];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${r}".`)));h.setEventedParent(null);const p=this._order.indexOf(r);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=h,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],h.onRemove&&h.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,h,p){this._checkLoaded();const m=this.getLayer(r);m?m.minzoom===h&&m.maxzoom===p||(h!=null&&(m.minzoom=h),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,h,p={}){this._checkLoaded();const m=this.getLayer(r);if(m){if(!a.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(a.x.filter,`layers.${m.id}.filter`,h,null,p)||(m.filter=a.aA(h),this._updateLayer(m)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return a.aA(this.getLayer(r).filter)}setLayoutProperty(r,h,p,m={}){this._checkLoaded();const b=this.getLayer(r);b?a.aD(b.getLayoutProperty(h),p)||(b.setLayoutProperty(h,p,m),this._updateLayer(b)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,h){const p=this.getLayer(r);if(p)return p.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,h,p,m={}){this._checkLoaded();const b=this.getLayer(r);b?a.aD(b.getPaintProperty(h),p)||(b.setPaintProperty(h,p,m)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[r]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,h){return this.getLayer(r).getPaintProperty(h)}setFeatureState(r,h){this._checkLoaded();const p=r.source,m=r.sourceLayer,b=this.sourceCaches[p];if(b===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const C=b.getSource().type;C==="geojson"&&m?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):C!=="vector"||m?(r.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(m,r.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,h){this._checkLoaded();const p=r.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new a.j(new Error(`The source '${p}' does not exist in the map's style.`)));const b=m.getSource().type,C=b==="vector"?r.sourceLayer:void 0;b!=="vector"||C?h&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(C,r.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const h=r.source,p=r.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||p?(r.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,r.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=a.aE(this.sourceCaches,b=>b.serialize()),h=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return a.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:r,layers:h,terrain:p},b=>b!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const h=C=>this._layers[C].type==="fill-extrusion",p={},m=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(h(M)){p[M]=C;for(const L of r){const F=L[M];if(F)for(const $ of F)m.push($)}}}m.sort((C,M)=>M.intersectionZ-C.intersectionZ);const b=[];for(let C=this._order.length-1;C>=0;C--){const M=this._order[C];if(h(M))for(let L=m.length-1;L>=0;L--){const F=m[L].feature;if(p[F.layer.id]<C)break;b.push(F),m.pop()}else for(const L of r){const F=L[M];if(F)for(const $ of F)b.push($.feature)}}return b}queryRenderedFeatures(r,h,p){h&&h.filter&&this._validate(a.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const M of h.layers){const L=this._layers[M];if(!L)return this.fire(new a.j(new Error(`The layer '${M}' does not exist in the map's style and cannot be queried for features.`))),[];m[L.source]=!0}}const b=[];h.availableImages=this._availableImages;const C=this._serializedAllLayers();for(const M in this.sourceCaches)h.layers&&!m[M]||b.push(ut(this.sourceCaches[M],this._layers,C,r,h,p));return this.placement&&b.push(function(M,L,F,$,q,ee,pe){const fe={},_e=ee.queryRenderedSymbols($),ue=[];for(const Ce of Object.keys(_e).map(Number))ue.push(pe[Ce]);ue.sort(At);for(const Ce of ue){const qe=Ce.featureIndex.lookupSymbolFeatures(_e[Ce.bucketInstanceId],L,Ce.bucketIndex,Ce.sourceLayerIndex,q.filter,q.layers,q.availableImages,M);for(const be in qe){const Re=fe[be]=fe[be]||[],Ge=qe[be];Ge.sort((He,Ke)=>{const nt=Ce.featureSortOrder;if(nt){const it=nt.indexOf(He.featureIndex);return nt.indexOf(Ke.featureIndex)-it}return Ke.featureIndex-He.featureIndex});for(const He of Ge)Re.push(He)}}for(const Ce in fe)fe[Ce].forEach(qe=>{const be=qe.feature,Re=F[M[Ce].source].getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Re});return fe}(this._layers,C,this.sourceCaches,r,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(r,h){h&&h.filter&&this._validate(a.x.filter,"querySourceFeatures.filter",h.filter,null,h);const p=this.sourceCaches[r];return p?function(m,b){const C=m.getRenderableIds().map(F=>m.getTileByID(F)),M=[],L={};for(let F=0;F<C.length;F++){const $=C[F],q=$.tileID.canonical.key;L[q]||(L[q]=!0,$.querySourceFeatures(M,b))}return M}(p,h):[]}getLight(){return this.light.getLight()}setLight(r,h={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const C in r)if(!a.aD(r[C],p[C])){m=!0;break}if(!m)return;const b={now:S.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,h),this.light.updateTransitions(b)}_validate(r,h,p,m,b={}){return(!b||b.validate!==!1)&&sn(this,r.call(a.x,a.e({key:h,style:this.serialize(),value:p,styleSpec:a.v},m)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ht().off(ir,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const p=this.sourceCaches[h];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const h in this.sourceCaches)this.sourceCaches[h].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,h,p,m,b=!1){let C=!1,M=!1;const L={};for(const F of this._order){const $=this._layers[F];if($.type!=="symbol")continue;if(!L[$.source]){const ee=this.sourceCaches[$.source];L[$.source]=ee.getRenderableIds(!0).map(pe=>ee.getTileByID(pe)).sort((pe,fe)=>fe.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(fe.tileID)?-1:1))}const q=this.crossTileSymbolIndex.addLayer($,L[$.source],r.center.lng);C=C||q}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(S.now(),r.zoom))&&(this.pauseablePlacement=new Xr(r,this.map.terrain,this._order,b,h,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(S.now()),M=!0),C&&this.pauseablePlacement.placement.setStale()),M||C)for(const F of this._order){const $=this._layers[F];$.type==="symbol"&&this.placement.updateLayerOpacities($,L[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(S.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,h){return a._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),p})}getGlyphs(r,h){return a._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,h={}){this._checkLoaded(),r&&this._validate(a.x.glyphs,"glyphs",r,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,h,p={},m){this._checkLoaded();const b=[{id:r,url:h}],C=[...Oe(this.stylesheet.sprite),...b];this._validate(a.x.sprite,"sprite",C,null,p)||(this.stylesheet.sprite=C,this._loadSprite(b,!0,m))}removeSprite(r){this._checkLoaded();const h=Oe(this.stylesheet.sprite);if(h.find(p=>p.id===r)){if(this._spritesImagesIds[r])for(const p of this._spritesImagesIds[r])this.imageManager.removeImage(p),this._changedImages[p]=!0;h.splice(h.findIndex(p=>p.id===r),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Oe(this.stylesheet.sprite)}setSprite(r,h={},p){this._checkLoaded(),r&&this._validate(a.x.sprite,"sprite",r,null,h)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,p):(this._unloadSprite(),p&&p(null)))}}var $a=a.X([{name:"a_pos",type:"Int16",components:2}]),mo="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ca={prelude:Di(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Di(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Di(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Di(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Di("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Di(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Di("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Di("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Di(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Di(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Di(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Di(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Di(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Di(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Di(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Di(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Di(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Di(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Di(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Di("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",mo),terrainDepth:Di("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",mo),terrainCoords:Di("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",mo)};function Di(y,r){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=r.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=b?b.concat(m):m,M={};return{fragmentSource:y=y.replace(h,(L,F,$,q,ee)=>(M[ee]=!0,F==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
varying ${$} ${q} ${ee};
#else
uniform ${$} ${q} u_${ee};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ee}
    ${$} ${q} ${ee} = u_${ee};
#endif
`)),vertexSource:r=r.replace(h,(L,F,$,q,ee)=>{const pe=q==="float"?"vec2":"vec4",fe=ee.match(/color/)?"color":pe;return M[ee]?F==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
attribute ${$} ${pe} a_${ee};
varying ${$} ${q} ${ee};
#else
uniform ${$} ${q} u_${ee};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = a_${ee};
#else
    ${$} ${q} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = unpack_mix_${fe}(a_${ee}, u_${ee}_t);
#else
    ${$} ${q} ${ee} = u_${ee};
#endif
`:F==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
attribute ${$} ${pe} a_${ee};
#else
uniform ${$} ${q} u_${ee};
#endif
`:fe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${$} ${q} ${ee} = a_${ee};
#else
    ${$} ${q} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${$} ${q} ${ee} = unpack_mix_${fe}(a_${ee}, u_${ee}_t);
#else
    ${$} ${q} ${ee} = u_${ee};
#endif
`}),staticAttributes:p,staticUniforms:C}}class qa{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,h,p,m,b,C,M,L,F){this.context=r;let $=this.boundPaintVertexBuffers.length!==m.length;for(let q=0;!$&&q<m.length;q++)this.boundPaintVertexBuffers[q]!==m[q]&&($=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==p||$||this.boundIndexBuffer!==b||this.boundVertexOffset!==C||this.boundDynamicVertexBuffer!==M||this.boundDynamicVertexBuffer2!==L||this.boundDynamicVertexBuffer3!==F?this.freshBind(h,p,m,b,C,M,L,F):(r.bindVertexArray.set(this.vao),M&&M.bind(),b&&b.dynamicDraw&&b.bind(),L&&L.bind(),F&&F.bind())}freshBind(r,h,p,m,b,C,M,L){const F=r.numAttributes,$=this.context,q=$.gl;this.vao&&this.destroy(),this.vao=$.createVertexArray(),$.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=M,this.boundDynamicVertexBuffer3=L,h.enableAttributes(q,r);for(const ee of p)ee.enableAttributes(q,r);C&&C.enableAttributes(q,r),M&&M.enableAttributes(q,r),L&&L.enableAttributes(q,r),h.bind(),h.setVertexAttribPointers(q,r,b);for(const ee of p)ee.bind(),ee.setVertexAttribPointers(q,r,b);C&&(C.bind(),C.setVertexAttribPointers(q,r,b)),m&&m.bind(),M&&(M.bind(),M.setVertexAttribPointers(q,r,b)),L&&(L.bind(),L.setVertexAttribPointers(q,r,b)),$.currentNumAttributes=F}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ps(y){const r=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const p=y[h].split(" ");r.push(p.pop())}return r}class Go{constructor(r,h,p,m,b,C){const M=r.gl;this.program=M.createProgram();const L=Ps(h.staticAttributes),F=p?p.getBinderAttributes():[],$=L.concat(F),q=ca.prelude.staticUniforms?Ps(ca.prelude.staticUniforms):[],ee=h.staticUniforms?Ps(h.staticUniforms):[],pe=p?p.getBinderUniforms():[],fe=q.concat(ee).concat(pe),_e=[];for(const He of fe)_e.indexOf(He)<0&&_e.push(He);const ue=p?p.defines():[];b&&ue.push("#define OVERDRAW_INSPECTOR;"),C&&ue.push("#define TERRAIN3D;");const Ce=ue.concat(ca.prelude.fragmentSource,h.fragmentSource).join(`
`),qe=ue.concat(ca.prelude.vertexSource,h.vertexSource).join(`
`),be=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(be,Ce),M.compileShader(be),!M.getShaderParameter(be,M.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${M.getShaderInfoLog(be)}`);M.attachShader(this.program,be);const Re=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);if(M.shaderSource(Re,qe),M.compileShader(Re),!M.getShaderParameter(Re,M.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${M.getShaderInfoLog(Re)}`);M.attachShader(this.program,Re),this.attributes={};const Ge={};this.numAttributes=$.length;for(let He=0;He<this.numAttributes;He++)$[He]&&(M.bindAttribLocation(this.program,He,$[He]),this.attributes[$[He]]=He);if(M.linkProgram(this.program),!M.getProgramParameter(this.program,M.LINK_STATUS))throw new Error(`Program failed to link: ${M.getProgramInfoLog(this.program)}`);M.deleteShader(Re),M.deleteShader(be);for(let He=0;He<_e.length;He++){const Ke=_e[He];if(Ke&&!Ge[Ke]){const nt=M.getUniformLocation(this.program,Ke);nt&&(Ge[Ke]=nt)}}this.fixedUniforms=m(r,Ge),this.terrainUniforms=((He,Ke)=>({u_depth:new a.aG(He,Ke.u_depth),u_terrain:new a.aG(He,Ke.u_terrain),u_terrain_dim:new a.aH(He,Ke.u_terrain_dim),u_terrain_matrix:new a.aI(He,Ke.u_terrain_matrix),u_terrain_unpack:new a.aJ(He,Ke.u_terrain_unpack),u_terrain_exaggeration:new a.aH(He,Ke.u_terrain_exaggeration)}))(r,Ge),this.binderUniforms=p?p.getUniforms(r,Ge):[]}draw(r,h,p,m,b,C,M,L,F,$,q,ee,pe,fe,_e,ue,Ce,qe){const be=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(p),r.setStencilMode(m),r.setColorMode(b),r.setCullFace(C),L){r.activeTexture.set(be.TEXTURE2),be.bindTexture(be.TEXTURE_2D,L.depthTexture),r.activeTexture.set(be.TEXTURE3),be.bindTexture(be.TEXTURE_2D,L.texture);for(const Ge in this.terrainUniforms)this.terrainUniforms[Ge].set(L[Ge])}for(const Ge in this.fixedUniforms)this.fixedUniforms[Ge].set(M[Ge]);_e&&_e.setUniforms(r,this.binderUniforms,pe,{zoom:fe});let Re=0;switch(h){case be.LINES:Re=2;break;case be.TRIANGLES:Re=3;break;case be.LINE_STRIP:Re=1}for(const Ge of ee.get()){const He=Ge.vaos||(Ge.vaos={});(He[F]||(He[F]=new qa)).bind(r,this,$,_e?_e.getPaintVertexBuffers():[],q,Ge.vertexOffset,ue,Ce,qe),be.drawElements(h,Ge.primitiveLength*Re,be.UNSIGNED_SHORT,Ge.primitiveOffset*Re*2)}}}function Za(y,r,h){const p=1/Kt(h,1,r.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),b=h.tileSize*Math.pow(2,r.transform.tileZoom)/m,C=b*(h.tileID.canonical.x+h.tileID.wrap*m),M=b*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[C>>16,M>>16],u_pixel_coord_lower:[65535&C,65535&M]}}const ua=(y,r,h,p)=>{const m=r.style.light,b=m.properties.get("position"),C=[b.x,b.y,b.z],M=function(){var F=new a.A(9);return a.A!=Float32Array&&(F[1]=0,F[2]=0,F[3]=0,F[5]=0,F[6]=0,F[7]=0),F[0]=1,F[4]=1,F[8]=1,F}();m.properties.get("anchor")==="viewport"&&function(F,$){var q=Math.sin($),ee=Math.cos($);F[0]=ee,F[1]=q,F[2]=0,F[3]=-q,F[4]=ee,F[5]=0,F[6]=0,F[7]=0,F[8]=1}(M,-r.transform.angle),function(F,$,q){var ee=$[0],pe=$[1],fe=$[2];F[0]=ee*q[0]+pe*q[3]+fe*q[6],F[1]=ee*q[1]+pe*q[4]+fe*q[7],F[2]=ee*q[2]+pe*q[5]+fe*q[8]}(C,C,M);const L=m.properties.get("color");return{u_matrix:y,u_lightpos:C,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+h,u_opacity:p}},Nd=(y,r,h,p,m,b,C)=>a.e(ua(y,r,h,p),Za(b,r,C),{u_height_factor:-Math.pow(2,m.overscaledZ)/C.tileSize/8}),Ju=y=>({u_matrix:y}),Ga=(y,r,h,p)=>a.e(Ju(y),Za(h,r,p)),jd=(y,r)=>({u_matrix:y,u_world:r}),Yu=(y,r,h,p,m)=>a.e(Ga(y,r,h,p),{u_world:m}),Ud=(y,r,h,p)=>{const m=y.transform;let b,C;if(p.paint.get("circle-pitch-alignment")==="map"){const M=Kt(h,1,m.zoom);b=!0,C=[M,M]}else b=!1,C=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(r.posMatrix,h,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:C}},Qu=(y,r,h)=>{const p=Kt(h,1,r.zoom),m=Math.pow(2,r.zoom-h.tileID.overscaledZ),b=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:r.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[r.pixelsToGLUnits[0]/(p*m),r.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:b}},eh=(y,r,h=1)=>({u_matrix:y,u_color:r,u_overlay:0,u_overlay_scale:h}),Wa=y=>({u_matrix:y}),th=(y,r,h,p)=>({u_matrix:y,u_extrude_scale:Kt(r,1,h),u_intensity:p});function ih(y,r){const h=Math.pow(2,r.canonical.z),p=r.canonical.y;return[new a.Y(0,p/h).toLngLat().lat,new a.Y(0,(p+1)/h).toLngLat().lat]}const Ha=(y,r,h,p)=>{const m=y.transform;return{u_matrix:ha(y,r,h,p),u_ratio:1/Kt(r,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},nh=(y,r,h,p,m)=>a.e(Ha(y,r,h,m),{u_image:0,u_image_height:p}),rs=(y,r,h,p,m)=>{const b=y.transform,C=Rr(r,b);return{u_matrix:ha(y,r,h,m),u_texsize:r.imageAtlasTexture.size,u_ratio:1/Kt(r,1,b.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[C,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Xa=(y,r,h,p,m,b)=>{const C=y.lineAtlas,M=Rr(r,y.transform),L=h.layout.get("line-cap")==="round",F=C.getDash(p.from,L),$=C.getDash(p.to,L),q=F.width*m.fromScale,ee=$.width*m.toScale;return a.e(Ha(y,r,h,b),{u_patternscale_a:[M/q,-F.height/2],u_patternscale_b:[M/ee,-$.height/2],u_sdfgamma:C.width/(256*Math.min(q,ee)*y.pixelRatio)/2,u_image:0,u_tex_y_a:F.y,u_tex_y_b:$.y,u_mix:m.t})};function Rr(y,r){return 1/Kt(y,1,r.tileZoom)}function ha(y,r,h,p){return y.translatePosMatrix(p?p.posMatrix:r.tileID.posMatrix,r,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Ka=(y,r,h,p,m)=>{return{u_matrix:y,u_tl_parent:r,u_scale_parent:h,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(C=m.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(b=m.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:da(m.paint.get("raster-hue-rotate"))};var b,C};function da(y){y*=Math.PI/180;const r=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*r-h+1)/3,(Math.sqrt(3)*r-h+1)/3]}const fa=(y,r,h,p,m,b,C,M,L,F)=>{const $=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:$.width/$.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:C,u_coord_matrix:M,u_is_text:+L,u_pitch_with_map:+p,u_texsize:F,u_texture:0}},pa=(y,r,h,p,m,b,C,M,L,F,$)=>{const q=m.transform;return a.e(fa(y,r,h,p,m,b,C,M,L,F),{u_gamma_scale:p?Math.cos(q._pitch)*q.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+$})},ma=(y,r,h,p,m,b,C,M,L,F)=>a.e(pa(y,r,h,p,m,b,C,M,!0,L,!0),{u_texsize_icon:F,u_texture_icon:1}),Vd=(y,r,h)=>({u_matrix:y,u_opacity:r,u_color:h}),$d=(y,r,h,p,m,b)=>a.e(function(C,M,L,F){const $=L.imageManager.getPattern(C.from.toString()),q=L.imageManager.getPattern(C.to.toString()),{width:ee,height:pe}=L.imageManager.getPixelSize(),fe=Math.pow(2,F.tileID.overscaledZ),_e=F.tileSize*Math.pow(2,L.transform.tileZoom)/fe,ue=_e*(F.tileID.canonical.x+F.tileID.wrap*fe),Ce=_e*F.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:q.tl,u_pattern_br_b:q.br,u_texsize:[ee,pe],u_mix:M.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:q.displaySize,u_scale_a:M.fromScale,u_scale_b:M.toScale,u_tile_units_to_pixels:1/Kt(F,1,L.transform.tileZoom),u_pixel_coord_upper:[ue>>16,Ce>>16],u_pixel_coord_lower:[65535&ue,65535&Ce]}}(p,b,h,m),{u_matrix:y,u_opacity:r}),rh={fillExtrusion:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_lightpos:new a.aK(y,r.u_lightpos),u_lightintensity:new a.aH(y,r.u_lightintensity),u_lightcolor:new a.aK(y,r.u_lightcolor),u_vertical_gradient:new a.aH(y,r.u_vertical_gradient),u_opacity:new a.aH(y,r.u_opacity)}),fillExtrusionPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_lightpos:new a.aK(y,r.u_lightpos),u_lightintensity:new a.aH(y,r.u_lightintensity),u_lightcolor:new a.aK(y,r.u_lightcolor),u_vertical_gradient:new a.aH(y,r.u_vertical_gradient),u_height_factor:new a.aH(y,r.u_height_factor),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade),u_opacity:new a.aH(y,r.u_opacity)}),fill:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix)}),fillPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),fillOutline:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world)}),fillOutlinePattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world),u_image:new a.aG(y,r.u_image),u_texsize:new a.aL(y,r.u_texsize),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),circle:(y,r)=>({u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_scale_with_map:new a.aG(y,r.u_scale_with_map),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_extrude_scale:new a.aL(y,r.u_extrude_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_matrix:new a.aI(y,r.u_matrix)}),collisionBox:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pixels_to_tile_units:new a.aH(y,r.u_pixels_to_tile_units),u_extrude_scale:new a.aL(y,r.u_extrude_scale),u_overscale_factor:new a.aH(y,r.u_overscale_factor)}),collisionCircle:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_inv_matrix:new a.aI(y,r.u_inv_matrix),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_viewport_size:new a.aL(y,r.u_viewport_size)}),debug:(y,r)=>({u_color:new a.aM(y,r.u_color),u_matrix:new a.aI(y,r.u_matrix),u_overlay:new a.aG(y,r.u_overlay),u_overlay_scale:new a.aH(y,r.u_overlay_scale)}),clippingMask:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix)}),heatmap:(y,r)=>({u_extrude_scale:new a.aH(y,r.u_extrude_scale),u_intensity:new a.aH(y,r.u_intensity),u_matrix:new a.aI(y,r.u_matrix)}),heatmapTexture:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_world:new a.aL(y,r.u_world),u_image:new a.aG(y,r.u_image),u_color_ramp:new a.aG(y,r.u_color_ramp),u_opacity:new a.aH(y,r.u_opacity)}),hillshade:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_latrange:new a.aL(y,r.u_latrange),u_light:new a.aL(y,r.u_light),u_shadow:new a.aM(y,r.u_shadow),u_highlight:new a.aM(y,r.u_highlight),u_accent:new a.aM(y,r.u_accent)}),hillshadePrepare:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_image:new a.aG(y,r.u_image),u_dimension:new a.aL(y,r.u_dimension),u_zoom:new a.aH(y,r.u_zoom),u_unpack:new a.aJ(y,r.u_unpack)}),line:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels)}),lineGradient:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_image:new a.aG(y,r.u_image),u_image_height:new a.aH(y,r.u_image_height)}),linePattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texsize:new a.aL(y,r.u_texsize),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_image:new a.aG(y,r.u_image),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_scale:new a.aK(y,r.u_scale),u_fade:new a.aH(y,r.u_fade)}),lineSDF:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ratio:new a.aH(y,r.u_ratio),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_units_to_pixels:new a.aL(y,r.u_units_to_pixels),u_patternscale_a:new a.aL(y,r.u_patternscale_a),u_patternscale_b:new a.aL(y,r.u_patternscale_b),u_sdfgamma:new a.aH(y,r.u_sdfgamma),u_image:new a.aG(y,r.u_image),u_tex_y_a:new a.aH(y,r.u_tex_y_a),u_tex_y_b:new a.aH(y,r.u_tex_y_b),u_mix:new a.aH(y,r.u_mix)}),raster:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_tl_parent:new a.aL(y,r.u_tl_parent),u_scale_parent:new a.aH(y,r.u_scale_parent),u_buffer_scale:new a.aH(y,r.u_buffer_scale),u_fade_t:new a.aH(y,r.u_fade_t),u_opacity:new a.aH(y,r.u_opacity),u_image0:new a.aG(y,r.u_image0),u_image1:new a.aG(y,r.u_image1),u_brightness_low:new a.aH(y,r.u_brightness_low),u_brightness_high:new a.aH(y,r.u_brightness_high),u_saturation_factor:new a.aH(y,r.u_saturation_factor),u_contrast_factor:new a.aH(y,r.u_contrast_factor),u_spin_weights:new a.aK(y,r.u_spin_weights)}),symbolIcon:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texture:new a.aG(y,r.u_texture)}),symbolSDF:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texture:new a.aG(y,r.u_texture),u_gamma_scale:new a.aH(y,r.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_is_halo:new a.aG(y,r.u_is_halo)}),symbolTextAndIcon:(y,r)=>({u_is_size_zoom_constant:new a.aG(y,r.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aG(y,r.u_is_size_feature_constant),u_size_t:new a.aH(y,r.u_size_t),u_size:new a.aH(y,r.u_size),u_camera_to_center_distance:new a.aH(y,r.u_camera_to_center_distance),u_pitch:new a.aH(y,r.u_pitch),u_rotate_symbol:new a.aG(y,r.u_rotate_symbol),u_aspect_ratio:new a.aH(y,r.u_aspect_ratio),u_fade_change:new a.aH(y,r.u_fade_change),u_matrix:new a.aI(y,r.u_matrix),u_label_plane_matrix:new a.aI(y,r.u_label_plane_matrix),u_coord_matrix:new a.aI(y,r.u_coord_matrix),u_is_text:new a.aG(y,r.u_is_text),u_pitch_with_map:new a.aG(y,r.u_pitch_with_map),u_texsize:new a.aL(y,r.u_texsize),u_texsize_icon:new a.aL(y,r.u_texsize_icon),u_texture:new a.aG(y,r.u_texture),u_texture_icon:new a.aG(y,r.u_texture_icon),u_gamma_scale:new a.aH(y,r.u_gamma_scale),u_device_pixel_ratio:new a.aH(y,r.u_device_pixel_ratio),u_is_halo:new a.aG(y,r.u_is_halo)}),background:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_opacity:new a.aH(y,r.u_opacity),u_color:new a.aM(y,r.u_color)}),backgroundPattern:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_opacity:new a.aH(y,r.u_opacity),u_image:new a.aG(y,r.u_image),u_pattern_tl_a:new a.aL(y,r.u_pattern_tl_a),u_pattern_br_a:new a.aL(y,r.u_pattern_br_a),u_pattern_tl_b:new a.aL(y,r.u_pattern_tl_b),u_pattern_br_b:new a.aL(y,r.u_pattern_br_b),u_texsize:new a.aL(y,r.u_texsize),u_mix:new a.aH(y,r.u_mix),u_pattern_size_a:new a.aL(y,r.u_pattern_size_a),u_pattern_size_b:new a.aL(y,r.u_pattern_size_b),u_scale_a:new a.aH(y,r.u_scale_a),u_scale_b:new a.aH(y,r.u_scale_b),u_pixel_coord_upper:new a.aL(y,r.u_pixel_coord_upper),u_pixel_coord_lower:new a.aL(y,r.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aH(y,r.u_tile_units_to_pixels)}),terrain:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texture:new a.aG(y,r.u_texture),u_ele_delta:new a.aH(y,r.u_ele_delta)}),terrainDepth:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_ele_delta:new a.aH(y,r.u_ele_delta)}),terrainCoords:(y,r)=>({u_matrix:new a.aI(y,r.u_matrix),u_texture:new a.aG(y,r.u_texture),u_terrain_coords_id:new a.aH(y,r.u_terrain_coords_id),u_ele_delta:new a.aH(y,r.u_ele_delta)})};class qd{constructor(r,h,p){this.context=r;const m=r.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const os={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ja{constructor(r,h,p,m){this.length=h.length,this.attributes=p,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=r;const b=r.gl;this.buffer=b.createBuffer(),r.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,h){for(let p=0;p<this.attributes.length;p++){const m=h.attributes[this.attributes[p].name];m!==void 0&&r.enableVertexAttribArray(m)}}setVertexAttribPointers(r,h,p){for(let m=0;m<this.attributes.length;m++){const b=this.attributes[m],C=h.attributes[b.name];C!==void 0&&r.vertexAttribPointer(C,b.components,r[os[b.type]],!1,this.itemSize,b.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hr=new WeakMap;function nr(y){var r;if(hr.has(y))return hr.get(y);{const h=(r=y.getParameter(y.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return hr.set(y,h),h}}class Ii{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ya extends Ii{getDefault(){return a.aO.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Qa extends Ii{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class hc extends Ii{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class dc extends Ii{getDefault(){return[!0,!0,!0,!0]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class el extends Ii{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class fc extends Ii{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class pc extends Ii{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const h=this.current;(r.func!==h.func||r.ref!==h.ref||r.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class tl extends Ii{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class oh extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=r,this.dirty=!1}}class sh extends Ii{getDefault(){return[0,1]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class zs extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=r,this.dirty=!1}}class Zd extends Ii{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Gd extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.BLEND):h.disable(h.BLEND),this.current=r,this.dirty=!1}}class Wd extends Ii{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Hd extends Ii{getDefault(){return a.aO.transparent}set(r){const h=this.current;(r.r!==h.r||r.g!==h.g||r.b!==h.b||r.a!==h.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Xd extends Ii{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Kd extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;r?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=r,this.dirty=!1}}class mc extends Ii{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class il extends Ii{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class gc extends Ii{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class _c extends Ii{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Ds extends Ii{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const h=this.current;(r[0]!==h[0]||r[1]!==h[1]||r[2]!==h[2]||r[3]!==h[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class ah extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class lh extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class yc extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class ss extends Ii{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class ch extends Ii{getDefault(){return null}set(r){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Rs extends Ii{getDefault(){return null}set(r){var h;if(r===this.current&&!this.dirty)return;const p=this.gl;nr(p)?p.bindVertexArray(r):(h=p.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class Bs extends Ii{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class uh extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class vc extends Ii{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Mi extends Ii{constructor(r,h){super(r),this.context=r,this.parent=h}getDefault(){return null}}class nl extends Mi{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Jd extends Mi{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class hh extends Mi{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ga{constructor(r,h,p,m,b){this.context=r,this.width=h,this.height=p;const C=r.gl,M=this.framebuffer=C.createFramebuffer();if(this.colorAttachment=new nl(r,M),m)this.depthAttachment=b?new hh(r,M):new Jd(r,M);else if(b)throw new Error("Stencil cannot be set without depth");if(C.checkFramebufferStatus(C.FRAMEBUFFER)!==C.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const r=this.context.gl,h=this.colorAttachment.get();if(h&&r.deleteTexture(h),this.depthAttachment){const p=this.depthAttachment.get();p&&r.deleteRenderbuffer(p)}r.deleteFramebuffer(this.framebuffer)}}class xn{constructor(r,h,p){this.blendFunction=r,this.blendColor=h,this.mask=p}}xn.Replace=[1,0],xn.disabled=new xn(xn.Replace,a.aO.transparent,[!1,!1,!1,!1]),xn.unblended=new xn(xn.Replace,a.aO.transparent,[!0,!0,!0,!0]),xn.alphaBlended=new xn([1,771],a.aO.transparent,[!0,!0,!0,!0]);class Yd{constructor(r){var h,p;if(this.gl=r,this.clearColor=new Ya(this),this.clearDepth=new Qa(this),this.clearStencil=new hc(this),this.colorMask=new dc(this),this.depthMask=new el(this),this.stencilMask=new fc(this),this.stencilFunc=new pc(this),this.stencilOp=new tl(this),this.stencilTest=new oh(this),this.depthRange=new sh(this),this.depthTest=new zs(this),this.depthFunc=new Zd(this),this.blend=new Gd(this),this.blendFunc=new Wd(this),this.blendColor=new Hd(this),this.blendEquation=new Xd(this),this.cullFace=new Kd(this),this.cullFaceSide=new mc(this),this.frontFace=new il(this),this.program=new gc(this),this.activeTexture=new _c(this),this.viewport=new Ds(this),this.bindFramebuffer=new ah(this),this.bindRenderbuffer=new lh(this),this.bindTexture=new yc(this),this.bindVertexBuffer=new ss(this),this.bindElementBuffer=new ch(this),this.bindVertexArray=new Rs(this),this.pixelStoreUnpack=new Bs(this),this.pixelStoreUnpackPremultiplyAlpha=new uh(this),this.pixelStoreUnpackFlipY=new vc(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),nr(r)){this.HALF_FLOAT=r.HALF_FLOAT;const m=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=r.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=r.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const m=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,h){return new qd(this,r,h)}createVertexBuffer(r,h,p){return new Ja(this,r,h,p)}createRenderbuffer(r,h,p){const m=this.gl,b=m.createRenderbuffer();return this.bindRenderbuffer.set(b),m.renderbufferStorage(m.RENDERBUFFER,r,h,p),this.bindRenderbuffer.set(null),b}createFramebuffer(r,h,p,m){return new ga(this,r,h,p,m)}clear({color:r,depth:h,stencil:p}){const m=this.gl;let b=0;r&&(b|=m.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(b|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),p!==void 0&&(b|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(b)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){a.aD(r.blendFunction,xn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return nr(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var h;return nr(this.gl)?this.gl.deleteVertexArray(r):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}class Si{constructor(r,h,p){this.func=r,this.mask=h,this.range=p}}Si.ReadOnly=!1,Si.ReadWrite=!0,Si.disabled=new Si(519,Si.ReadOnly,[0,1]);const bc=7680;class Gi{constructor(r,h,p,m,b,C){this.test=r,this.ref=h,this.mask=p,this.fail=m,this.depthFail=b,this.pass=C}}Gi.disabled=new Gi({func:519,mask:0},0,0,bc,bc,bc);class qi{constructor(r,h,p){this.enable=r,this.mode=h,this.frontFace=p}}let as;function rl(y,r,h,p,m,b,C){const M=y.context,L=M.gl,F=y.useProgram("collisionBox"),$=[];let q=0,ee=0;for(let be=0;be<p.length;be++){const Re=p[be],Ge=r.getTile(Re),He=Ge.getBucket(h);if(!He)continue;let Ke=Re.posMatrix;m[0]===0&&m[1]===0||(Ke=y.translatePosMatrix(Re.posMatrix,Ge,m,b));const nt=C?He.textCollisionBox:He.iconCollisionBox,it=He.collisionCircleArray;if(it.length>0){const ft=a.F(),_t=Ke;a.aP(ft,He.placementInvProjMatrix,y.transform.glCoordMatrix),a.aP(ft,ft,He.placementViewportMatrix),$.push({circleArray:it,circleOffset:ee,transform:_t,invTransform:ft,coord:Re}),q+=it.length/4,ee=q}nt&&F.draw(M,L.LINES,Si.disabled,Gi.disabled,y.colorModeForRenderPass(),qi.disabled,Qu(Ke,y.transform,Ge),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Re),h.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,y.transform.zoom,null,null,nt.collisionVertexBuffer)}if(!C||!$.length)return;const pe=y.useProgram("collisionCircle"),fe=new a.aQ;fe.resize(4*q),fe._trim();let _e=0;for(const be of $)for(let Re=0;Re<be.circleArray.length/4;Re++){const Ge=4*Re,He=be.circleArray[Ge+0],Ke=be.circleArray[Ge+1],nt=be.circleArray[Ge+2],it=be.circleArray[Ge+3];fe.emplace(_e++,He,Ke,nt,it,0),fe.emplace(_e++,He,Ke,nt,it,1),fe.emplace(_e++,He,Ke,nt,it,2),fe.emplace(_e++,He,Ke,nt,it,3)}(!as||as.length<2*q)&&(as=function(be){const Re=2*be,Ge=new a.aS;Ge.resize(Re),Ge._trim();for(let He=0;He<Re;He++){const Ke=6*He;Ge.uint16[Ke+0]=4*He+0,Ge.uint16[Ke+1]=4*He+1,Ge.uint16[Ke+2]=4*He+2,Ge.uint16[Ke+3]=4*He+2,Ge.uint16[Ke+4]=4*He+3,Ge.uint16[Ke+5]=4*He+0}return Ge}(q));const ue=M.createIndexBuffer(as,!0),Ce=M.createVertexBuffer(fe,a.aR.members,!0);for(const be of $){const Re={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(qe=y.transform).cameraToCenterDistance,u_viewport_size:[qe.width,qe.height]};pe.draw(M,L.TRIANGLES,Si.disabled,Gi.disabled,y.colorModeForRenderPass(),qi.disabled,Re,y.style.map.terrain&&y.style.map.terrain.getTerrainData(be.coord),h.id,Ce,ue,a.$.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,y.transform.zoom,null,null,null)}var qe;Ce.destroy(),ue.destroy()}qi.disabled=new qi(!1,1029,2305),qi.backCCW=new qi(!0,1029,2305);const wc=a.an(new Float32Array(16));function dh(y,r,h,p,m,b){const{horizontalAlign:C,verticalAlign:M}=a.at(y);return new a.P((-(C-.5)*r/m+p[0])*b,(-(M-.5)*h/m+p[1])*b)}function ol(y,r,h,p,m,b,C,M,L,F,$){const q=y.text.placedSymbolArray,ee=y.text.dynamicLayoutVertexArray,pe=y.icon.dynamicLayoutVertexArray,fe={};ee.clear();for(let _e=0;_e<q.length;_e++){const ue=q.get(_e),Ce=ue.hidden||!ue.crossTileID||y.allowVerticalPlacement&&!ue.placedOrientation?null:p[ue.crossTileID];if(Ce){const qe=new a.P(ue.anchorX,ue.anchorY),be=un(qe,h?C:b,$),Re=me(m.cameraToCenterDistance,be.signedDistanceFromCamera);let Ge=a.ai(y.textSizeData,L,ue)*Re/a.ao;h&&(Ge*=y.tilePixelRatio/M);const{width:He,height:Ke,anchor:nt,textOffset:it,textBoxScale:ft}=Ce,_t=dh(nt,He,Ke,it,ft,Ge),oi=h?un(qe.add(_t),b,$).point:be.point.add(r?_t.rotate(-m.angle):_t),yt=y.allowVerticalPlacement&&ue.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let Jt=0;Jt<ue.numGlyphs;Jt++)a.aj(ee,oi,yt);F&&ue.associatedIconIndex>=0&&(fe[ue.associatedIconIndex]={shiftedAnchor:oi,angle:yt})}else Ze(ue.numGlyphs,ee)}if(F){pe.clear();const _e=y.icon.placedSymbolArray;for(let ue=0;ue<_e.length;ue++){const Ce=_e.get(ue);if(Ce.hidden)Ze(Ce.numGlyphs,pe);else{const qe=fe[ue];if(qe)for(let be=0;be<Ce.numGlyphs;be++)a.aj(pe,qe.shiftedAnchor,qe.angle);else Ze(Ce.numGlyphs,pe)}}y.icon.dynamicLayoutVertexBuffer.updateData(pe)}y.text.dynamicLayoutVertexBuffer.updateData(ee)}function sl(y,r,h){return h.iconsInText&&r?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function al(y,r,h,p,m,b,C,M,L,F,$,q){const ee=y.context,pe=ee.gl,fe=y.transform,_e=M==="map",ue=L==="map",Ce=M!=="viewport"&&h.layout.get("symbol-placement")!=="point",qe=_e&&!ue&&!Ce,be=!h.layout.get("symbol-sort-key").isConstant();let Re=!1;const Ge=y.depthModeForSublayer(0,Si.ReadOnly),He=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Ke=[];for(const nt of p){const it=r.getTile(nt),ft=it.getBucket(h);if(!ft)continue;const _t=m?ft.text:ft.icon;if(!_t||!_t.segments.get().length||!_t.hasVisibleVertices)continue;const oi=_t.programConfigurations.get(h.id),yt=m||ft.sdfIcons,Jt=m?ft.textSizeData:ft.iconSizeData,si=ue||fe.pitch!==0,Ti=y.useProgram(sl(yt,m,ft),oi),ei=a.ag(Jt,fe.zoom),ci=y.style.map.terrain&&y.style.map.terrain.getTerrainData(nt);let pi,pn,Ri,Br,Nn=[0,0],an=null;if(m)pn=it.glyphAtlasTexture,Ri=pe.LINEAR,pi=it.glyphAtlasTexture.size,ft.iconsInText&&(Nn=it.imageAtlasTexture.size,an=it.imageAtlasTexture,Br=si||y.options.rotating||y.options.zooming||Jt.kind==="composite"||Jt.kind==="camera"?pe.LINEAR:pe.NEAREST);else{const Pn=h.layout.get("icon-size").constantOr(0)!==1||ft.iconsNeedLinear;pn=it.imageAtlasTexture,Ri=yt||y.options.rotating||y.options.zooming||Pn||si?pe.LINEAR:pe.NEAREST,pi=it.imageAtlasTexture.size}const jn=Kt(it,1,y.transform.zoom),Fr=ii(nt.posMatrix,ue,_e,y.transform,jn),vo=to(nt.posMatrix,ue,_e,y.transform,jn),Jo=He&&ft.hasTextData(),Ia=h.layout.get("icon-text-fit")!=="none"&&Jo&&ft.hasIconData();if(Ce){const Pn=y.style.map.terrain?(Jr,zn)=>y.style.map.terrain.getElevation(nt,Jr,zn):null,cn=h.layout.get("text-rotation-alignment")==="map";K(ft,nt.posMatrix,y,m,Fr,vo,ue,F,cn,Pn)}const Yo=y.translatePosMatrix(nt.posMatrix,it,b,C),bo=Ce||m&&He||Ia?wc:Fr,An=y.translatePosMatrix(vo,it,b,C,!0),ln=yt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let en;en=yt?ft.iconsInText?ma(Jt.kind,ei,qe,ue,y,Yo,bo,An,pi,Nn):pa(Jt.kind,ei,qe,ue,y,Yo,bo,An,m,pi,!0):fa(Jt.kind,ei,qe,ue,y,Yo,bo,An,m,pi);const Kr={program:Ti,buffers:_t,uniformValues:en,atlasTexture:pn,atlasTextureIcon:an,atlasInterpolation:Ri,atlasInterpolationIcon:Br,isSDF:yt,hasHalo:ln};if(be&&ft.canOverlap){Re=!0;const Pn=_t.segments.get();for(const cn of Pn)Ke.push({segments:new a.$([cn]),sortKey:cn.sortKey,state:Kr,terrainData:ci})}else Ke.push({segments:_t.segments,sortKey:0,state:Kr,terrainData:ci})}Re&&Ke.sort((nt,it)=>nt.sortKey-it.sortKey);for(const nt of Ke){const it=nt.state;if(ee.activeTexture.set(pe.TEXTURE0),it.atlasTexture.bind(it.atlasInterpolation,pe.CLAMP_TO_EDGE),it.atlasTextureIcon&&(ee.activeTexture.set(pe.TEXTURE1),it.atlasTextureIcon&&it.atlasTextureIcon.bind(it.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),it.isSDF){const ft=it.uniformValues;it.hasHalo&&(ft.u_is_halo=1,fh(it.buffers,nt.segments,h,y,it.program,Ge,$,q,ft,nt.terrainData)),ft.u_is_halo=0}fh(it.buffers,nt.segments,h,y,it.program,Ge,$,q,it.uniformValues,nt.terrainData)}}function fh(y,r,h,p,m,b,C,M,L,F){const $=p.context;m.draw($,$.gl.TRIANGLES,b,C,M,qi.disabled,L,F,h.id,y.layoutVertexBuffer,y.indexBuffer,r,h.paint,p.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function ll(y,r,h,p,m){if(!h||!p||!p.imageAtlas)return;const b=p.imageAtlas.patternPositions;let C=b[h.to.toString()],M=b[h.from.toString()];if(!C&&M&&(C=M),!M&&C&&(M=C),!C||!M){const L=m.getPaintProperty(r);C=b[L],M=b[L]}C&&M&&y.setConstantPatternPositions(C,M)}function ph(y,r,h,p,m,b,C){const M=y.context.gl,L="fill-pattern",F=h.paint.get(L),$=F&&F.constantOr(1),q=h.getCrossfadeParameters();let ee,pe,fe,_e,ue;C?(pe=$&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ee=M.LINES):(pe=$?"fillPattern":"fill",ee=M.TRIANGLES);const Ce=F.constantOr(null);for(const qe of p){const be=r.getTile(qe);if($&&!be.patternsLoaded())continue;const Re=be.getBucket(h);if(!Re)continue;const Ge=Re.programConfigurations.get(h.id),He=y.useProgram(pe,Ge),Ke=y.style.map.terrain&&y.style.map.terrain.getTerrainData(qe);$&&(y.context.activeTexture.set(M.TEXTURE0),be.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Ge.updatePaintBuffers(q)),ll(Ge,L,Ce,be,h);const nt=Ke?qe:null,it=y.translatePosMatrix(nt?nt.posMatrix:qe.posMatrix,be,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(C){_e=Re.indexBuffer2,ue=Re.segments2;const ft=[M.drawingBufferWidth,M.drawingBufferHeight];fe=pe==="fillOutlinePattern"&&$?Yu(it,y,q,be,ft):jd(it,ft)}else _e=Re.indexBuffer,ue=Re.segments,fe=$?Ga(it,y,q,be):Ju(it);He.draw(y.context,ee,m,y.stencilModeForClipping(qe),b,qi.disabled,fe,Ke,h.id,Re.layoutVertexBuffer,_e,ue,h.paint,y.transform.zoom,Ge)}}function cl(y,r,h,p,m,b,C){const M=y.context,L=M.gl,F="fill-extrusion-pattern",$=h.paint.get(F),q=$.constantOr(1),ee=h.getCrossfadeParameters(),pe=h.paint.get("fill-extrusion-opacity"),fe=$.constantOr(null);for(const _e of p){const ue=r.getTile(_e),Ce=ue.getBucket(h);if(!Ce)continue;const qe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(_e),be=Ce.programConfigurations.get(h.id),Re=y.useProgram(q?"fillExtrusionPattern":"fillExtrusion",be);q&&(y.context.activeTexture.set(L.TEXTURE0),ue.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),be.updatePaintBuffers(ee)),ll(be,F,fe,ue,h);const Ge=y.translatePosMatrix(_e.posMatrix,ue,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),He=h.paint.get("fill-extrusion-vertical-gradient"),Ke=q?Nd(Ge,y,He,pe,_e,ee,ue):ua(Ge,y,He,pe);Re.draw(M,M.gl.TRIANGLES,m,b,C,qi.backCCW,Ke,qe,h.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,h.paint,y.transform.zoom,be,y.style.map.terrain&&Ce.centroidVertexBuffer)}}function ul(y,r,h,p,m,b,C){const M=y.context,L=M.gl,F=h.fbo;if(!F)return;const $=y.useProgram("hillshade"),q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(r);M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,F.colorAttachment.get()),$.draw(M,L.TRIANGLES,m,b,C,qi.disabled,((ee,pe,fe,_e)=>{const ue=fe.paint.get("hillshade-shadow-color"),Ce=fe.paint.get("hillshade-highlight-color"),qe=fe.paint.get("hillshade-accent-color");let be=fe.paint.get("hillshade-illumination-direction")*(Math.PI/180);fe.paint.get("hillshade-illumination-anchor")==="viewport"&&(be-=ee.transform.angle);const Re=!ee.options.moving;return{u_matrix:_e?_e.posMatrix:ee.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Re),u_image:0,u_latrange:ih(0,pe.tileID),u_light:[fe.paint.get("hillshade-exaggeration"),be],u_shadow:ue,u_highlight:Ce,u_accent:qe}})(y,h,p,q?r:null),q,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function xc(y,r,h,p,m,b){const C=y.context,M=C.gl,L=r.dem;if(L&&L.data){const F=L.dim,$=L.stride,q=L.getPixels();if(C.activeTexture.set(M.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||y.getTileTexture($),r.demTexture){const pe=r.demTexture;pe.update(q,{premultiply:!1}),pe.bind(M.NEAREST,M.CLAMP_TO_EDGE)}else r.demTexture=new ne(C,q,M.RGBA,{premultiply:!1}),r.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);C.activeTexture.set(M.TEXTURE0);let ee=r.fbo;if(!ee){const pe=new ne(C,{width:F,height:F,data:null},M.RGBA);pe.bind(M.LINEAR,M.CLAMP_TO_EDGE),ee=r.fbo=C.createFramebuffer(F,F,!0,!1),ee.colorAttachment.set(pe.texture)}C.bindFramebuffer.set(ee.framebuffer),C.viewport.set([0,0,F,F]),y.useProgram("hillshadePrepare").draw(C,M.TRIANGLES,p,m,b,qi.disabled,((pe,fe)=>{const _e=fe.stride,ue=a.F();return a.aN(ue,0,a.W,-a.W,0,0,1),a.H(ue,ue,[0,-a.W,0]),{u_matrix:ue,u_image:1,u_dimension:[_e,_e],u_zoom:pe.overscaledZ,u_unpack:fe.getUnpackVector()}})(r.tileID,L),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),r.needsHillshadePrepare=!1}}function mh(y,r,h,p,m,b){const C=p.paint.get("raster-fade-duration");if(!b&&C>0){const M=S.now(),L=(M-y.timeAdded)/C,F=r?(M-r.timeAdded)/C:-1,$=h.getSource(),q=m.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),ee=!r||Math.abs(r.tileID.overscaledZ-q)>Math.abs(y.tileID.overscaledZ-q),pe=ee&&y.refreshedUponExpiration?1:a.ac(ee?L:1-F,0,1);return y.refreshedUponExpiration&&L>=1&&(y.refreshedUponExpiration=!1),r?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}const gh=new a.aO(1,0,0,1),hl=new a.aO(0,1,0,1),kc=new a.aO(0,0,1,1),Qd=new a.aO(1,0,1,1),_h=new a.aO(0,1,1,1);function dn(y,r,h,p){dr(y,0,r+h/2,y.transform.width,h,p)}function Wo(y,r,h,p){dr(y,r-h/2,0,h,y.transform.height,p)}function dr(y,r,h,p,m,b){const C=y.context,M=C.gl;M.enable(M.SCISSOR_TEST),M.scissor(r*y.pixelRatio,h*y.pixelRatio,p*y.pixelRatio,m*y.pixelRatio),C.clear({color:b}),M.disable(M.SCISSOR_TEST)}function Sc(y,r,h){const p=y.context,m=p.gl,b=h.posMatrix,C=y.useProgram("debug"),M=Si.disabled,L=Gi.disabled,F=y.colorModeForRenderPass(),$="$debug",q=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);p.activeTexture.set(m.TEXTURE0);const ee=r.getTileByID(h.key).latestRawTileData,pe=Math.floor((ee&&ee.byteLength||0)/1024),fe=r.getTile(h).tileSize,_e=512/Math.min(fe,512)*(h.overscaledZ/y.transform.zoom)*.5;let ue=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(ue+=` => ${h.overscaledZ}`),function(Ce,qe){Ce.initDebugOverlayCanvas();const be=Ce.debugOverlayCanvas,Re=Ce.context.gl,Ge=Ce.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,be.width,be.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(qe,5,5),Ge.strokeText(qe,5,5),Ce.debugOverlayTexture.update(be),Ce.debugOverlayTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE)}(y,`${ue} ${pe}kB`),C.draw(p,m.TRIANGLES,M,L,xn.alphaBlended,qi.disabled,eh(b,a.aO.transparent,_e),null,$,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),C.draw(p,m.LINE_STRIP,M,L,F,qi.disabled,eh(b,a.aO.red),q,$,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function dl(y,r,h){const p=y.context,m=p.gl,b=y.colorModeForRenderPass(),C=new Si(m.LEQUAL,Si.ReadWrite,y.depthRangeFor3D),M=y.useProgram("terrain"),L=r.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const F of h){const $=y.renderToTexture.getTexture(F),q=r.getTerrainData(F.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,$.texture);const ee={u_matrix:y.transform.calculatePosMatrix(F.tileID.toUnwrapped()),u_texture:0,u_ele_delta:r.getMeshFrameDelta(y.transform.zoom)};M.draw(p,m.TRIANGLES,C,Gi.disabled,b,qi.backCCW,ee,q,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}class yh{constructor(r,h){this.context=new Yd(r),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Vi.maxUnderzooming+Vi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Zo}resize(r,h,p){if(this.width=Math.floor(r*p),this.height=Math.floor(h*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const r=this.context,h=new a.aV;h.emplaceBack(0,0),h.emplaceBack(a.W,0),h.emplaceBack(0,a.W),h.emplaceBack(a.W,a.W),this.tileExtentBuffer=r.createVertexBuffer(h,$a.members),this.tileExtentSegments=a.$.simpleSegment(0,0,4,2);const p=new a.aV;p.emplaceBack(0,0),p.emplaceBack(a.W,0),p.emplaceBack(0,a.W),p.emplaceBack(a.W,a.W),this.debugBuffer=r.createVertexBuffer(p,$a.members),this.debugSegments=a.$.simpleSegment(0,0,4,5);const m=new a.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(a.W,0,a.W,0),m.emplaceBack(0,a.W,0,a.W),m.emplaceBack(a.W,a.W,a.W,a.W),this.rasterBoundsBuffer=r.createVertexBuffer(m,We.members),this.rasterBoundsSegments=a.$.simpleSegment(0,0,4,2);const b=new a.aV;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(b,$a.members),this.viewportSegments=a.$.simpleSegment(0,0,4,2);const C=new a.aW;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(C);const M=new a.aX;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(M);const L=this.context.gl;this.stencilClearMode=new Gi({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const r=this.context,h=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=a.F();a.aN(p,0,this.width,this.height,0,0,1),a.J(p,p,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(r,h.TRIANGLES,Si.disabled,this.stencilClearMode,xn.disabled,qi.disabled,Wa(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,h){if(this.currentStencilSource===r.source||!r.isTileClipped()||!h||!h.length)return;this.currentStencilSource=r.source;const p=this.context,m=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(xn.disabled),p.setDepthMode(Si.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const C of h){const M=this._tileClippingMaskIDs[C.key]=this.nextStencilID++,L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(C);b.draw(p,m.TRIANGLES,Si.disabled,new Gi({func:m.ALWAYS,mask:0},M,255,m.KEEP,m.KEEP,m.REPLACE),xn.disabled,qi.disabled,Wa(C.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,h=this.context.gl;return new Gi({func:h.NOTEQUAL,mask:255},r,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(r){const h=this.context.gl;return new Gi({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(r){const h=this.context.gl,p=r.sort((C,M)=>M.overscaledZ-C.overscaledZ),m=p[p.length-1].overscaledZ,b=p[0].overscaledZ-m+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const C={};for(let M=0;M<b;M++)C[M+m]=new Gi({func:h.GEQUAL,mask:255},M+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=b,[C,p]}return[{[m]:Gi.disabled},p]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new xn([r.CONSTANT_COLOR,r.ONE],new a.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xn.unblended:xn.alphaBlended}depthModeForSublayer(r,h,p){if(!this.opaquePassEnabledForLayer())return Si.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Si(p||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,h){this.style=r,this.options=h,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(S.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,b={},C={},M={};for(const L in m){const F=m[L];F.used&&F.prepare(this.context),b[L]=F.getVisibleCoordinates(),C[L]=b[L].slice().reverse(),M[L]=F.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<p.length;L++)if(this.style._layers[p[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of p){const F=this.style._layers[L];if(!F.hasOffscreenPass()||F.isHidden(this.transform.zoom))continue;const $=C[F.source];(F.type==="custom"||$.length)&&this.renderLayer(this,m[F.source],F,$)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aO.black:a.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[p[this.currentLayer]],F=m[L.source],$=b[L.source];this._renderTileClippingMasks(L,$),this.renderLayer(this,F,L,$)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const L=this.style._layers[p[this.currentLayer]],F=m[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L))continue;const $=(L.type==="symbol"?M:C)[L.source];this._renderTileClippingMasks(L,b[L.source]),this.renderLayer(this,F,L,$)}if(this.options.showTileBoundaries){const L=function(F,$){let q=null;const ee=Object.values(F._layers).flatMap(ue=>ue.source&&!ue.isHidden($)?[F.sourceCaches[ue.source]]:[]),pe=ee.filter(ue=>ue.getSource().type==="vector"),fe=ee.filter(ue=>ue.getSource().type!=="vector"),_e=ue=>{(!q||q.getSource().maxzoom<ue.getSource().maxzoom)&&(q=ue)};return pe.forEach(ue=>_e(ue)),q||fe.forEach(ue=>_e(ue)),q}(this.style,this.transform.zoom);L&&function(F,$,q){for(let ee=0;ee<q.length;ee++)Sc(F,$,q[ee])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const F=L.transform.padding;dn(L,L.transform.height-(F.top||0),3,gh),dn(L,F.bottom||0,3,hl),Wo(L,F.left||0,3,kc),Wo(L,L.transform.width-(F.right||0),3,Qd);const $=L.transform.centerPoint;(function(q,ee,pe,fe){dr(q,ee-1,pe-10,2,20,fe),dr(q,ee-10,pe-1,20,2,fe)})(L,$.x,L.transform.height-$.y,_h)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=r?!a.aY(h,p):!a.aZ(h,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(a.a_(h,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,C){const M=b.context,L=M.gl,F=xn.unblended,$=new Si(L.LEQUAL,Si.ReadWrite,[0,1]),q=C.getTerrainMesh(),ee=C.sourceCache.getRenderableTiles(),pe=b.useProgram("terrainDepth");M.bindFramebuffer.set(C.getFramebuffer("depth").framebuffer),M.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1});for(const fe of ee){const _e=C.getTerrainData(fe.tileID),ue={u_matrix:b.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),u_ele_delta:C.getMeshFrameDelta(b.transform.zoom)};pe.draw(M,L.TRIANGLES,$,Gi.disabled,F,qi.backCCW,ue,_e,"terrain",q.vertexBuffer,q.indexBuffer,q.segments)}M.bindFramebuffer.set(null),M.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,C){const M=b.context,L=M.gl,F=xn.unblended,$=new Si(L.LEQUAL,Si.ReadWrite,[0,1]),q=C.getTerrainMesh(),ee=C.getCoordsTexture(),pe=C.sourceCache.getRenderableTiles(),fe=b.useProgram("terrainCoords");M.bindFramebuffer.set(C.getFramebuffer("coords").framebuffer),M.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),M.clear({color:a.aO.transparent,depth:1}),C.coordsIndex=[];for(const _e of pe){const ue=C.getTerrainData(_e.tileID);M.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,ee.texture);const Ce={u_matrix:b.transform.calculatePosMatrix(_e.tileID.toUnwrapped()),u_terrain_coords_id:(255-C.coordsIndex.length)/255,u_texture:0,u_ele_delta:C.getMeshFrameDelta(b.transform.zoom)};fe.draw(M,L.TRIANGLES,$,Gi.disabled,F,qi.backCCW,Ce,ue,"terrain",q.vertexBuffer,q.indexBuffer,q.segments),C.coordsIndex.push(_e.tileID.key)}M.bindFramebuffer.set(null),M.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(r,h,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(b,C,M,L,F){if(b.renderPass!=="translucent")return;const $=Gi.disabled,q=b.colorModeForRenderPass();(M._unevaluatedLayout.hasValue("text-variable-anchor")||M._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ee,pe,fe,_e,ue,Ce,qe){const be=pe.transform,Re=ue==="map",Ge=Ce==="map";for(const He of ee){const Ke=_e.getTile(He),nt=Ke.getBucket(fe);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const it=a.ag(nt.textSizeData,be.zoom),ft=Kt(Ke,1,pe.transform.zoom),_t=ii(He.posMatrix,Ge,Re,pe.transform,ft),oi=fe.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(it){const yt=Math.pow(2,be.zoom-Ke.tileID.overscaledZ);ol(nt,Re,Ge,qe,be,_t,He.posMatrix,yt,it,oi,pe.style.map.terrain?(Jt,si)=>pe.style.map.terrain.getElevation(He,Jt,si):null)}}}(L,b,M,C,M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),F),M.paint.get("icon-opacity").constantOr(1)!==0&&al(b,C,M,L,!1,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),M.layout.get("icon-rotation-alignment"),M.layout.get("icon-pitch-alignment"),M.layout.get("icon-keep-upright"),$,q),M.paint.get("text-opacity").constantOr(1)!==0&&al(b,C,M,L,!0,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),M.layout.get("text-rotation-alignment"),M.layout.get("text-pitch-alignment"),M.layout.get("text-keep-upright"),$,q),C.map.showCollisionBoxes&&(rl(b,C,M,L,M.paint.get("text-translate"),M.paint.get("text-translate-anchor"),!0),rl(b,C,M,L,M.paint.get("icon-translate"),M.paint.get("icon-translate-anchor"),!1))})(r,h,p,m,this.style.placement.variableOffsets);break;case"circle":(function(b,C,M,L){if(b.renderPass!=="translucent")return;const F=M.paint.get("circle-opacity"),$=M.paint.get("circle-stroke-width"),q=M.paint.get("circle-stroke-opacity"),ee=!M.layout.get("circle-sort-key").isConstant();if(F.constantOr(1)===0&&($.constantOr(1)===0||q.constantOr(1)===0))return;const pe=b.context,fe=pe.gl,_e=b.depthModeForSublayer(0,Si.ReadOnly),ue=Gi.disabled,Ce=b.colorModeForRenderPass(),qe=[];for(let be=0;be<L.length;be++){const Re=L[be],Ge=C.getTile(Re),He=Ge.getBucket(M);if(!He)continue;const Ke=He.programConfigurations.get(M.id),nt=b.useProgram("circle",Ke),it=He.layoutVertexBuffer,ft=He.indexBuffer,_t=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Re),oi={programConfiguration:Ke,program:nt,layoutVertexBuffer:it,indexBuffer:ft,uniformValues:Ud(b,Re,Ge,M),terrainData:_t};if(ee){const yt=He.segments.get();for(const Jt of yt)qe.push({segments:new a.$([Jt]),sortKey:Jt.sortKey,state:oi})}else qe.push({segments:He.segments,sortKey:0,state:oi})}ee&&qe.sort((be,Re)=>be.sortKey-Re.sortKey);for(const be of qe){const{programConfiguration:Re,program:Ge,layoutVertexBuffer:He,indexBuffer:Ke,uniformValues:nt,terrainData:it}=be.state;Ge.draw(pe,fe.TRIANGLES,_e,ue,Ce,qi.disabled,nt,it,M.id,He,Ke,be.segments,M.paint,b.transform.zoom,Re)}})(r,h,p,m);break;case"heatmap":(function(b,C,M,L){if(M.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const F=b.context,$=F.gl,q=Gi.disabled,ee=new xn([$.ONE,$.ONE],a.aO.transparent,[!0,!0,!0,!0]);(function(pe,fe,_e){const ue=pe.gl;pe.activeTexture.set(ue.TEXTURE1),pe.viewport.set([0,0,fe.width/4,fe.height/4]);let Ce=_e.heatmapFbo;if(Ce)ue.bindTexture(ue.TEXTURE_2D,Ce.colorAttachment.get()),pe.bindFramebuffer.set(Ce.framebuffer);else{const qe=ue.createTexture();ue.bindTexture(ue.TEXTURE_2D,qe),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_WRAP_S,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_WRAP_T,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_MIN_FILTER,ue.LINEAR),ue.texParameteri(ue.TEXTURE_2D,ue.TEXTURE_MAG_FILTER,ue.LINEAR),Ce=_e.heatmapFbo=pe.createFramebuffer(fe.width/4,fe.height/4,!1,!1),function(be,Re,Ge,He){var Ke,nt;const it=be.gl,ft=(Ke=be.HALF_FLOAT)!==null&&Ke!==void 0?Ke:it.UNSIGNED_BYTE,_t=(nt=be.RGBA16F)!==null&&nt!==void 0?nt:it.RGBA;it.texImage2D(it.TEXTURE_2D,0,_t,Re.width/4,Re.height/4,0,it.RGBA,ft,null),He.colorAttachment.set(Ge)}(pe,fe,qe,Ce)}})(F,b,M),F.clear({color:a.aO.transparent});for(let pe=0;pe<L.length;pe++){const fe=L[pe];if(C.hasRenderableParent(fe))continue;const _e=C.getTile(fe),ue=_e.getBucket(M);if(!ue)continue;const Ce=ue.programConfigurations.get(M.id),qe=b.useProgram("heatmap",Ce),{zoom:be}=b.transform;qe.draw(F,$.TRIANGLES,Si.disabled,q,ee,qi.disabled,th(fe.posMatrix,_e,be,M.paint.get("heatmap-intensity")),null,M.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,M.paint,b.transform.zoom,Ce)}F.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(F,$){const q=F.context,ee=q.gl,pe=$.heatmapFbo;if(!pe)return;q.activeTexture.set(ee.TEXTURE0),ee.bindTexture(ee.TEXTURE_2D,pe.colorAttachment.get()),q.activeTexture.set(ee.TEXTURE1);let fe=$.colorRampTexture;fe||(fe=$.colorRampTexture=new ne(q,$.colorRamp,ee.RGBA)),fe.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),F.useProgram("heatmapTexture").draw(q,ee.TRIANGLES,Si.disabled,Gi.disabled,F.colorModeForRenderPass(),qi.disabled,((_e,ue,Ce,qe)=>{const be=a.F();a.aN(be,0,_e.width,_e.height,0,0,1);const Re=_e.context.gl;return{u_matrix:be,u_world:[Re.drawingBufferWidth,Re.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ue.paint.get("heatmap-opacity")}})(F,$),null,$.id,F.viewportBuffer,F.quadTriangleIndexBuffer,F.viewportSegments,$.paint,F.transform.zoom)}(b,M))})(r,h,p,m);break;case"line":(function(b,C,M,L){if(b.renderPass!=="translucent")return;const F=M.paint.get("line-opacity"),$=M.paint.get("line-width");if(F.constantOr(1)===0||$.constantOr(1)===0)return;const q=b.depthModeForSublayer(0,Si.ReadOnly),ee=b.colorModeForRenderPass(),pe=M.paint.get("line-dasharray"),fe=M.paint.get("line-pattern"),_e=fe.constantOr(1),ue=M.paint.get("line-gradient"),Ce=M.getCrossfadeParameters(),qe=_e?"linePattern":pe?"lineSDF":ue?"lineGradient":"line",be=b.context,Re=be.gl;let Ge=!0;for(const He of L){const Ke=C.getTile(He);if(_e&&!Ke.patternsLoaded())continue;const nt=Ke.getBucket(M);if(!nt)continue;const it=nt.programConfigurations.get(M.id),ft=b.context.program.get(),_t=b.useProgram(qe,it),oi=Ge||_t.program!==ft,yt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(He),Jt=fe.constantOr(null);if(Jt&&Ke.imageAtlas){const ei=Ke.imageAtlas,ci=ei.patternPositions[Jt.to.toString()],pi=ei.patternPositions[Jt.from.toString()];ci&&pi&&it.setConstantPatternPositions(ci,pi)}const si=yt?He:null,Ti=_e?rs(b,Ke,M,Ce,si):pe?Xa(b,Ke,M,pe,Ce,si):ue?nh(b,Ke,M,nt.lineClipsArray.length,si):Ha(b,Ke,M,si);if(_e)be.activeTexture.set(Re.TEXTURE0),Ke.imageAtlasTexture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE),it.updatePaintBuffers(Ce);else if(pe&&(oi||b.lineAtlas.dirty))be.activeTexture.set(Re.TEXTURE0),b.lineAtlas.bind(be);else if(ue){const ei=nt.gradients[M.id];let ci=ei.texture;if(M.gradientVersion!==ei.version){let pi=256;if(M.stepInterpolant){const pn=C.getSource().maxzoom,Ri=He.canonical.z===pn?Math.ceil(1<<b.transform.maxZoom-He.canonical.z):1;pi=a.ac(a.aT(nt.maxLineLength/a.W*1024*Ri),256,be.maxTextureSize)}ei.gradient=a.aU({expression:M.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:ei.gradient||void 0,clips:nt.lineClipsArray}),ei.texture?ei.texture.update(ei.gradient):ei.texture=new ne(be,ei.gradient,Re.RGBA),ei.version=M.gradientVersion,ci=ei.texture}be.activeTexture.set(Re.TEXTURE0),ci.bind(M.stepInterpolant?Re.NEAREST:Re.LINEAR,Re.CLAMP_TO_EDGE)}_t.draw(be,Re.TRIANGLES,q,b.stencilModeForClipping(He),ee,qi.disabled,Ti,yt,M.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,M.paint,b.transform.zoom,it,nt.layoutVertexBuffer2),Ge=!1}})(r,h,p,m);break;case"fill":(function(b,C,M,L){const F=M.paint.get("fill-color"),$=M.paint.get("fill-opacity");if($.constantOr(1)===0)return;const q=b.colorModeForRenderPass(),ee=M.paint.get("fill-pattern"),pe=b.opaquePassEnabledForLayer()&&!ee.constantOr(1)&&F.constantOr(a.aO.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===pe){const fe=b.depthModeForSublayer(1,b.renderPass==="opaque"?Si.ReadWrite:Si.ReadOnly);ph(b,C,M,L,fe,q,!1)}if(b.renderPass==="translucent"&&M.paint.get("fill-antialias")){const fe=b.depthModeForSublayer(M.getPaintProperty("fill-outline-color")?2:0,Si.ReadOnly);ph(b,C,M,L,fe,q,!0)}})(r,h,p,m);break;case"fill-extrusion":(function(b,C,M,L){const F=M.paint.get("fill-extrusion-opacity");if(F!==0&&b.renderPass==="translucent"){const $=new Si(b.context.gl.LEQUAL,Si.ReadWrite,b.depthRangeFor3D);if(F!==1||M.paint.get("fill-extrusion-pattern").constantOr(1))cl(b,C,M,L,$,Gi.disabled,xn.disabled),cl(b,C,M,L,$,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const q=b.colorModeForRenderPass();cl(b,C,M,L,$,Gi.disabled,q)}}})(r,h,p,m);break;case"hillshade":(function(b,C,M,L){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const F=b.context,$=b.depthModeForSublayer(0,Si.ReadOnly),q=b.colorModeForRenderPass(),[ee,pe]=b.renderPass==="translucent"?b.stencilConfigForOverlap(L):[{},L];for(const fe of pe){const _e=C.getTile(fe);_e.needsHillshadePrepare!==void 0&&_e.needsHillshadePrepare&&b.renderPass==="offscreen"?xc(b,_e,M,$,Gi.disabled,q):b.renderPass==="translucent"&&ul(b,fe,_e,M,$,ee[fe.overscaledZ],q)}F.viewport.set([0,0,b.width,b.height])})(r,h,p,m);break;case"raster":(function(b,C,M,L){if(b.renderPass!=="translucent"||M.paint.get("raster-opacity")===0||!L.length)return;const F=b.context,$=F.gl,q=C.getSource(),ee=b.useProgram("raster"),pe=b.colorModeForRenderPass(),[fe,_e]=q instanceof St?[{},L]:b.stencilConfigForOverlap(L),ue=_e[_e.length-1].overscaledZ,Ce=!b.options.moving;for(const qe of _e){const be=b.depthModeForSublayer(qe.overscaledZ-ue,M.paint.get("raster-opacity")===1?Si.ReadWrite:Si.ReadOnly,$.LESS),Re=C.getTile(qe);Re.registerFadeDuration(M.paint.get("raster-fade-duration"));const Ge=C.findLoadedParent(qe,0),He=mh(Re,Ge,C,M,b.transform,b.style.map.terrain);let Ke,nt;const it=M.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;F.activeTexture.set($.TEXTURE0),Re.texture.bind(it,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),F.activeTexture.set($.TEXTURE1),Ge?(Ge.texture.bind(it,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),Ke=Math.pow(2,Ge.tileID.overscaledZ-Re.tileID.overscaledZ),nt=[Re.tileID.canonical.x*Ke%1,Re.tileID.canonical.y*Ke%1]):Re.texture.bind(it,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const ft=b.style.map.terrain&&b.style.map.terrain.getTerrainData(qe),_t=ft?qe:null,oi=_t?_t.posMatrix:b.transform.calculatePosMatrix(qe.toUnwrapped(),Ce),yt=Ka(oi,nt||[0,0],Ke||1,He,M);q instanceof St?ee.draw(F,$.TRIANGLES,be,Gi.disabled,pe,qi.disabled,yt,ft,M.id,q.boundsBuffer,b.quadTriangleIndexBuffer,q.boundsSegments):ee.draw(F,$.TRIANGLES,be,fe[qe.overscaledZ],pe,qi.disabled,yt,ft,M.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(r,h,p,m);break;case"background":(function(b,C,M,L){const F=M.paint.get("background-color"),$=M.paint.get("background-opacity");if($===0)return;const q=b.context,ee=q.gl,pe=b.transform,fe=pe.tileSize,_e=M.paint.get("background-pattern");if(b.isPatternMissing(_e))return;const ue=!_e&&F.a===1&&$===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==ue)return;const Ce=Gi.disabled,qe=b.depthModeForSublayer(0,ue==="opaque"?Si.ReadWrite:Si.ReadOnly),be=b.colorModeForRenderPass(),Re=b.useProgram(_e?"backgroundPattern":"background"),Ge=L||pe.coveringTiles({tileSize:fe,terrain:b.style.map.terrain});_e&&(q.activeTexture.set(ee.TEXTURE0),b.imageManager.bind(b.context));const He=M.getCrossfadeParameters();for(const Ke of Ge){const nt=L?Ke.posMatrix:b.transform.calculatePosMatrix(Ke.toUnwrapped()),it=_e?$d(nt,$,b,_e,{tileID:Ke,tileSize:fe},He):Vd(nt,$,F),ft=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Ke);Re.draw(q,ee.TRIANGLES,qe,Ce,be,qi.disabled,it,ft,M.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(r,0,p,m);break;case"custom":(function(b,C,M){const L=b.context,F=M.implementation;if(b.renderPass==="offscreen"){const $=F.prerender;$&&(b.setCustomLayerDefaults(),L.setColorMode(b.colorModeForRenderPass()),$.call(F,L.gl,b.transform.customLayerMatrix()),L.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),L.setColorMode(b.colorModeForRenderPass()),L.setStencilMode(Gi.disabled);const $=F.renderingMode==="3d"?new Si(b.context.gl.LEQUAL,Si.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,Si.ReadOnly);L.setDepthMode($),F.render(L.gl,b.transform.customLayerMatrix()),L.setDirty(),b.setBaseState(),L.bindFramebuffer.set(null)}})(r,0,p)}}translatePosMatrix(r,h,p,m,b){if(!p[0]&&!p[1])return r;const C=b?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(C){const F=Math.sin(C),$=Math.cos(C);p=[p[0]*$-p[1]*F,p[0]*F+p[1]*$]}const M=[b?p[0]:Kt(h,p[0],this.transform.zoom),b?p[1]:Kt(h,p[1],this.transform.zoom),0],L=new Float32Array(16);return a.H(L,r,M),L}saveTileTexture(r){const h=this._tileTextures[r.size[0]];h?h.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const h=this._tileTextures[r];return h&&h.length>0?h.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const h=this.imageManager.getPattern(r.from.toString()),p=this.imageManager.getPattern(r.to.toString());return!h||!p}useProgram(r,h){this.cache=this.cache||{};const p=r+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Go(this.context,ca[r],h,rh[r],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ne(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:h}=this.context.gl;return this.width!==r||this.height!==h}}class Ho{constructor(r,h){this.points=r,this.planes=h}static fromInvProjectionMatrix(r,h,p){const m=Math.pow(2,p),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(M=>{const L=1/(M=a.af([],M,r))[3]/h*m;return a.a$(M,M,[L,L,1/M[3],L])}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(M=>{const L=function(ee,pe){var fe=pe[0],_e=pe[1],ue=pe[2],Ce=fe*fe+_e*_e+ue*ue;return Ce>0&&(Ce=1/Math.sqrt(Ce)),ee[0]=pe[0]*Ce,ee[1]=pe[1]*Ce,ee[2]=pe[2]*Ce,ee}([],function(ee,pe,fe){var _e=pe[0],ue=pe[1],Ce=pe[2],qe=fe[0],be=fe[1],Re=fe[2];return ee[0]=ue*Re-Ce*be,ee[1]=Ce*qe-_e*Re,ee[2]=_e*be-ue*qe,ee}([],Y([],b[M[0]],b[M[1]]),Y([],b[M[2]],b[M[1]]))),F=-(($=L)[0]*(q=b[M[1]])[0]+$[1]*q[1]+$[2]*q[2]);var $,q;return L.concat(F)});return new Ho(b,C)}}class Xo{constructor(r,h){this.min=r,this.max=h,this.center=function(p,m,b){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,b){return p[0]=m[0]+b[0],p[1]=m[1]+b[1],p[2]=m[2]+b[2],p}([],this.min,this.max))}quadrant(r){const h=[r%2==0,r<2],p=ce(this.min),m=ce(this.max);for(let b=0;b<h.length;b++)p[b]=h[b]?this.min[b]:this.center[b],m[b]=h[b]?this.center[b]:this.max[b];return m[2]=this.max[2],new Xo(p,m)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersects(r){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<r.planes.length;m++){const b=r.planes[m];let C=0;for(let M=0;M<h.length;M++)a.b0(b,h[M])>=0&&C++;if(C===0)return 0;C!==h.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let b=Number.MAX_VALUE,C=-Number.MAX_VALUE;for(let M=0;M<r.points.length;M++){const L=r.points[M][m]-this.min[m];b=Math.min(b,L),C=Math.max(C,L)}if(C<0||b>this.max[m]-this.min[m])return 0}return 1}}class Fs{constructor(r=0,h=0,p=0,m=0){if(isNaN(r)||r<0||isNaN(h)||h<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=h,this.left=p,this.right=m}interpolate(r,h,p){return h.top!=null&&r.top!=null&&(this.top=a.z.number(r.top,h.top,p)),h.bottom!=null&&r.bottom!=null&&(this.bottom=a.z.number(r.bottom,h.bottom,p)),h.left!=null&&r.left!=null&&(this.left=a.z.number(r.left,h.left,p)),h.right!=null&&r.right!=null&&(this.right=a.z.number(r.right,h.right,p)),this}getCenter(r,h){const p=a.ac((this.left+r-this.right)/2,0,r),m=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(p,m)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Tc=85.051129;class fl{constructor(r,h,p,m,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=r||0,this._maxZoom=h||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const r=new fl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return r.apply(this),r}apply(r){this.tileSize=r.tileSize,this.latRange=r.latRange,this.width=r.width,this.height=r.height,this._center=r._center,this._elevation=r._elevation,this.minElevationForCurrentTile=r.minElevationForCurrentTile,this.zoom=r.zoom,this.angle=r.angle,this._fov=r._fov,this._pitch=r._pitch,this._unmodified=r._unmodified,this._edgeInsets=r._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(r){const h=-a.b1(r,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var p=new a.A(4);return a.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,b){var C=m[0],M=m[1],L=m[2],F=m[3],$=Math.sin(b),q=Math.cos(b);p[0]=C*q+L*$,p[1]=M*q+F*$,p[2]=C*-$+L*q,p[3]=M*-$+F*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const h=a.ac(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=r/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(r){const h=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,h,p){this._unmodified=!1,this._edgeInsets.interpolate(r,h,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const h=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(r){const h=[new a.b2(0,r)];if(this._renderWorldCopies){const p=this.pointCoordinate(new a.P(0,0)),m=this.pointCoordinate(new a.P(this.width,0)),b=this.pointCoordinate(new a.P(this.width,this.height)),C=this.pointCoordinate(new a.P(0,this.height)),M=Math.floor(Math.min(p.x,m.x,b.x,C.x)),L=Math.floor(Math.max(p.x,m.x,b.x,C.x)),F=1;for(let $=M-F;$<=L+F;$++)$!==0&&h.push(new a.b2($,r))}return h}coveringTiles(r){var h,p;let m=this.coveringZoomLevel(r);const b=m;if(r.minzoom!==void 0&&m<r.minzoom)return[];r.maxzoom!==void 0&&m>r.maxzoom&&(m=r.maxzoom);const C=this.pointCoordinate(this.getCameraPoint()),M=a.Y.fromLngLat(this.center),L=Math.pow(2,m),F=[L*C.x,L*C.y,0],$=[L*M.x,L*M.y,0],q=Ho.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let ee=r.minzoom||0;!r.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ee=m);const pe=r.terrain?2/Math.min(this.tileSize,r.tileSize)*this.tileSize:3,fe=be=>({aabb:new Xo([be*L,0,0],[(be+1)*L,L,0]),zoom:0,x:0,y:0,wrap:be,fullyVisible:!1}),_e=[],ue=[],Ce=m,qe=r.reparseOverscaled?b:m;if(this._renderWorldCopies)for(let be=1;be<=3;be++)_e.push(fe(-be)),_e.push(fe(be));for(_e.push(fe(0));_e.length>0;){const be=_e.pop(),Re=be.x,Ge=be.y;let He=be.fullyVisible;if(!He){const _t=be.aabb.intersects(q);if(_t===0)continue;He=_t===2}const Ke=r.terrain?F:$,nt=be.aabb.distanceX(Ke),it=be.aabb.distanceY(Ke),ft=Math.max(Math.abs(nt),Math.abs(it));if(be.zoom===Ce||ft>pe+(1<<Ce-be.zoom)-2&&be.zoom>=ee){const _t=Ce-be.zoom,oi=F[0]-.5-(Re<<_t),yt=F[1]-.5-(Ge<<_t);ue.push({tileID:new a.Q(be.zoom===Ce?qe:be.zoom,be.wrap,be.zoom,Re,Ge),distanceSq:ye([$[0]-.5-Re,$[1]-.5-Ge]),tileDistanceToCamera:Math.sqrt(oi*oi+yt*yt)})}else for(let _t=0;_t<4;_t++){const oi=(Re<<1)+_t%2,yt=(Ge<<1)+(_t>>1),Jt=be.zoom+1;let si=be.aabb.quadrant(_t);if(r.terrain){const Ti=new a.Q(Jt,be.wrap,Jt,oi,yt),ei=r.terrain.getMinMaxElevation(Ti),ci=(h=ei.minElevation)!==null&&h!==void 0?h:this.elevation,pi=(p=ei.maxElevation)!==null&&p!==void 0?p:this.elevation;si=new Xo([si.min[0],si.min[1],ci],[si.max[0],si.max[1],pi])}_e.push({aabb:si,zoom:Jt,x:oi,y:yt,wrap:be.wrap,fullyVisible:He})}}return ue.sort((be,Re)=>be.distanceSq-Re.distanceSq).map(be=>be.tileID)}resize(r,h){this.width=r,this.height=h,this.pixelsToGLUnits=[2/r,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const h=a.ac(r.lat,-85.051129,Tc);return new a.P(a.N(r.lng)*this.worldSize,a.O(h)*this.worldSize)}unproject(r){return new a.Y(r.x/this.worldSize,r.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(r){const h=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,r),b=r.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-b))return;const C=p+h-b,M=Math.cos(this._pitch)*this.cameraToCenterDistance/C/a.b3(1,m.lat),L=this.scaleZoom(M/this.tileSize);this._elevation=b,this._center=m,this.zoom=L}setLocationAtPoint(r,h){const p=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(r),C=new a.Y(b.x-(p.x-m.x),b.y-(p.y-m.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(r,h){return h?this.coordinatePoint(this.locationCoordinate(r),h.getElevationForLngLatZoom(r,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(r))}pointLocation(r,h){return this.coordinateLocation(this.pointCoordinate(r,h))}locationCoordinate(r){return a.Y.fromLngLat(r)}coordinateLocation(r){return r&&r.toLngLat()}pointCoordinate(r,h){if(h){const ee=h.pointCoordinate(r);if(ee!=null)return ee}const p=[r.x,r.y,0,1],m=[r.x,r.y,1,1];a.af(p,p,this.pixelMatrixInverse),a.af(m,m,this.pixelMatrixInverse);const b=p[3],C=m[3],M=p[1]/b,L=m[1]/C,F=p[2]/b,$=m[2]/C,q=F===$?0:(0-F)/($-F);return new a.Y(a.z.number(p[0]/b,m[0]/C,q)/this.worldSize,a.z.number(M,L,q)/this.worldSize)}coordinatePoint(r,h=0,p=this.pixelMatrix){const m=[r.x*this.worldSize,r.y*this.worldSize,h,1];return a.af(m,m,p),new a.P(m[0]/m[3],m[1]/m[3])}getBounds(){const r=Math.max(0,this.height/2-this.getHorizon());return new je().extend(this.pointLocation(new a.P(0,r))).extend(this.pointLocation(new a.P(this.width,r))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new je([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(r){r?(this.lngRange=[r.getWest(),r.getEast()],this.latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Tc])}calculatePosMatrix(r,h=!1){const p=r.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const b=r.canonical,C=this.worldSize/this.zoomScale(b.z),M=b.x+Math.pow(2,b.z)*r.wrap,L=a.an(new Float64Array(16));return a.H(L,L,[M*C,b.y*C,0]),a.J(L,L,[C/a.W,C/a.W,1]),a.K(L,h?this.alignedProjMatrix:this.projMatrix,L),m[p]=new Float32Array(L),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(r,h){h=a.ac(+h,this.minZoom,this.maxZoom);const p={center:new a.M(r.lng,r.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const be=179.9999999999;m=[-be,be]}const b=this.tileSize*this.zoomScale(p.zoom);let C=0,M=b,L=0,F=b,$=0,q=0;const{x:ee,y:pe}=this.size;if(this.latRange){const be=this.latRange;C=a.O(be[1])*b,M=a.O(be[0])*b,M-C<pe&&($=pe/(M-C))}m&&(L=a.b1(a.N(m[0])*b,0,b),F=a.b1(a.N(m[1])*b,0,b),F<L&&(F+=b),F-L<ee&&(q=ee/(F-L)));const{x:fe,y:_e}=this.project.call({worldSize:b},r);let ue,Ce;const qe=Math.max(q||0,$||0);if(qe){const be=new a.P(q?(F+L)/2:fe,$?(M+C)/2:_e);return p.center=this.unproject.call({worldSize:b},be).wrap(),p.zoom+=this.scaleZoom(qe),p}if(this.latRange){const be=pe/2;_e-be<C&&(Ce=C+be),_e+be>M&&(Ce=M-be)}if(m){const be=(L+F)/2;let Re=fe;this._renderWorldCopies&&(Re=a.b1(fe,be-b/2,be+b/2));const Ge=ee/2;Re-Ge<L&&(ue=L+Ge),Re+Ge>F&&(ue=F-Ge)}if(ue!==void 0||Ce!==void 0){const be=new a.P(ue??fe,Ce??_e);p.center=this.unproject.call({worldSize:b},be).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:h,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=p,this._unmodified=r,this._constraining=!1}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,h=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b3(1,this.center.lat)*this.worldSize;let m=a.an(new Float64Array(16));a.J(m,m,[this.width/2,-this.height/2,1]),a.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=a.an(new Float64Array(16)),a.J(m,m,[1,-1,1]),a.H(m,m,[-1,-1,0]),a.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),C=Math.min(this.elevation,this.minElevationForCurrentTile),M=b-C*this._pixelPerMeter/Math.cos(this._pitch),L=C<0?M:b,F=Math.PI/2+this._pitch,$=this._fov*(.5+r.y/this.height),q=Math.sin($)*L/Math.sin(a.ac(Math.PI-F-$,.01,Math.PI-.01)),ee=this.getHorizon(),pe=2*Math.atan(ee/this.cameraToCenterDistance)*(.5+r.y/(2*ee)),fe=Math.sin(pe)*L/Math.sin(a.ac(Math.PI-F-pe,.01,Math.PI-.01)),_e=Math.min(q,fe),ue=1.01*(Math.cos(Math.PI/2-this._pitch)*_e+L),Ce=this.height/50;m=new Float64Array(16),a.b4(m,this._fov,this.width/this.height,Ce,ue),m[8]=2*-r.x/this.width,m[9]=2*r.y/this.height,a.J(m,m,[1,-1,1]),a.H(m,m,[0,0,-this.cameraToCenterDistance]),a.b5(m,m,this._pitch),a.ad(m,m,this.angle),a.H(m,m,[-h,-p,0]),this.mercatorMatrix=a.J([],m,[this.worldSize,this.worldSize,this.worldSize]),a.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.K(new Float64Array(16),this.labelPlaneMatrix,m),a.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=a.ar([],m),this.pixelMatrix3D=a.K(new Float64Array(16),this.labelPlaneMatrix,m);const qe=this.width%2/2,be=this.height%2/2,Re=Math.cos(this.angle),Ge=Math.sin(this.angle),He=h-Math.round(h)+Re*qe+Ge*be,Ke=p-Math.round(p)+Re*be+Ge*qe,nt=new Float64Array(m);if(a.H(nt,nt,[He>.5?He-1:He,Ke>.5?Ke-1:Ke,0]),this.alignedProjMatrix=nt,m=a.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const r=this.pointCoordinate(new a.P(0,0)),h=[r.x*this.worldSize,r.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,r))}getCameraQueryGeometry(r){const h=this.getCameraPoint();if(r.length===1)return[r[0],h];{let p=h.x,m=h.y,b=h.x,C=h.y;for(const M of r)p=Math.min(p,M.x),m=Math.min(m,M.y),b=Math.max(b,M.x),C=Math.max(C,M.y);return[new a.P(p,m),new a.P(b,m),new a.P(b,C),new a.P(p,C),new a.P(p,m)]}}lngLatToCameraDepth(r,h){const p=this.locationCoordinate(r),m=[p.x*this.worldSize,p.y*this.worldSize,h,1];return a.af(m,m,this.projMatrix),m[2]/m[3]}}function Cc(y,r){let h,p=!1,m=null,b=null;const C=()=>{m=null,p&&(y.apply(b,h),m=setTimeout(C,r),p=!1)};return(...M)=>(p=!0,b=this,h=M,m||C(),m)}class Ec{constructor(r){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let p;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:p,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Cc(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(r){const h=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,m),C=Math.round(h.lng*b)/b,M=Math.round(h.lat*b)/b,L=this._map.getBearing(),F=this._map.getPitch();let $="";if($+=r?`/${C}/${M}/${p}`:`${p}/${M}/${C}`,(L||F)&&($+="/"+Math.round(10*L)/10),F&&($+=`/${Math.round(F)}`),this._hashName){const q=this._hashName;let ee=!1;const pe=window.location.hash.slice(1).split("&").map(fe=>{const _e=fe.split("=")[0];return _e===q?(ee=!0,`${_e}=${$}`):fe}).filter(fe=>fe);return ee||pe.push(`${q}=${$}`),`#${pe.join("&")}`}return`#${$}`}}const _a={linearity:.3,easing:a.b6(0,0,.3,1)},ls=a.e({deceleration:2500,maxSpeed:1400},_a),vh=a.e({deceleration:20,maxSpeed:1400},_a),bh=a.e({deceleration:1e3,maxSpeed:360},_a),wh=a.e({deceleration:1e3,maxSpeed:90},_a);class xh{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:S.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,h=S.now();for(;r.length>0&&h-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)h.zoom+=b.zoomDelta||0,h.bearing+=b.bearingDelta||0,h.pitch+=b.pitchDelta||0,b.panDelta&&h.pan._add(b.panDelta),b.around&&(h.around=b.around),b.pinchAround&&(h.pinchAround=b.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const b=va(h.pan.mag(),p,a.e({},ls,r||{}));m.offset=h.pan.mult(b.amount/h.pan.mag()),m.center=this._map.transform.center,ya(m,b)}if(h.zoom){const b=va(h.zoom,p,vh);m.zoom=this._map.transform.zoom+b.amount,ya(m,b)}if(h.bearing){const b=va(h.bearing,p,bh);m.bearing=this._map.transform.bearing+a.ac(b.amount,-179,179),ya(m,b)}if(h.pitch){const b=va(h.pitch,p,wh);m.pitch=this._map.transform.pitch+b.amount,ya(m,b)}if(m.zoom||m.bearing){const b=h.pinchAround===void 0?h.around:h.pinchAround;m.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),a.e(m,{noMoveStart:!0})}}function ya(y,r){(!y.duration||y.duration<r.duration)&&(y.duration=r.duration,y.easing=r.easing)}function va(y,r,h){const{maxSpeed:p,linearity:m,deceleration:b}=h,C=a.ac(y*m/(r/1e3),-p,p),M=Math.abs(C)/(b*m);return{easing:h.easing,duration:1e3*M,amount:C*(M/2)}}class xr extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p,m={}){const b=E.mousePos(h.getCanvas(),p),C=h.unproject(b);super(r,a.e({point:b,lngLat:C,originalEvent:p},m)),this._defaultPrevented=!1,this.target=h}}class go extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p){const m=r==="touchend"?p.changedTouches:p.touches,b=E.touchPos(h.getCanvasContainer(),m),C=b.map(L=>h.unproject(L)),M=b.reduce((L,F,$,q)=>L.add(F.div(q.length)),new a.P(0,0));super(r,{points:b,point:M,lngLats:C,lngLat:h.unproject(M),originalEvent:p}),this._defaultPrevented=!1}}class Mc extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,h,p){super(r,{originalEvent:p}),this._defaultPrevented=!1}}class io{constructor(r,h){this._map=r,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Mc(r.type,this._map,r))}mousedown(r,h){return this._mousedownPos=h,this._firePreventable(new xr(r.type,this._map,r))}mouseup(r){this._map.fire(new xr(r.type,this._map,r))}click(r,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new xr(r.type,this._map,r))}dblclick(r){return this._firePreventable(new xr(r.type,this._map,r))}mouseover(r){this._map.fire(new xr(r.type,this._map,r))}mouseout(r){this._map.fire(new xr(r.type,this._map,r))}touchstart(r){return this._firePreventable(new go(r.type,this._map,r))}touchmove(r){this._map.fire(new go(r.type,this._map,r))}touchend(r){this._map.fire(new go(r.type,this._map,r))}touchcancel(r){this._map.fire(new go(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _o{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new xr(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new xr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new xr(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Os{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.pointLocation(a.P.convert(r),this._map.terrain)}}class no{constructor(r,h){this._map=r,this._tr=new Os(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,h){this.isEnabled()&&r.shiftKey&&r.button===0&&(E.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(r,h){if(!this._active)return;const p=h;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=E.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const b=Math.min(m.x,p.x),C=Math.max(m.x,p.x),M=Math.min(m.y,p.y),L=Math.max(m.y,p.y);E.setTransform(this._box,`translate(${b}px,${M}px)`),this._box.style.width=C-b+"px",this._box.style.height=L-M+"px"}mouseupWindow(r,h){if(!this._active||r.button!==0)return;const p=this._startPos,m=h;if(this.reset(),E.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:r})),{cameraAnimation:b=>b.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(E.remove(this._box),this._box=null),E.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,h){return this._map.fire(new a.k(r,{originalEvent:h}))}}function cs(y,r){if(y.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${r.length}`);const h={};for(let p=0;p<y.length;p++)h[y[p].identifier]=r[p];return h}class ef{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,h,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const b=new a.P(0,0);for(const C of m)b._add(C);return b.div(m.length)}(h),this.touches=cs(p,h)))}touchmove(r,h,p){if(this.aborted||!this.centroid)return;const m=cs(p,h);for(const b in this.touches){const C=m[b];(!C||C.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(r,h,p){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Ic{constructor(r){this.singleTap=new ef(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,h,p){this.singleTap.touchstart(r,h,p)}touchmove(r,h,p){this.singleTap.touchmove(r,h,p)}touchend(r,h,p){const m=this.singleTap.touchend(r,h,p);if(m){const b=r.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(m)<30;if(b&&C||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class tf{constructor(r){this._tr=new Os(r),this._zoomIn=new Ic({numTouches:1,numTaps:2}),this._zoomOut=new Ic({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,h,p){this._zoomIn.touchstart(r,h,p),this._zoomOut.touchstart(r,h,p)}touchmove(r,h,p){this._zoomIn.touchmove(r,h,p),this._zoomOut.touchmove(r,h,p)}touchend(r,h,p){const m=this._zoomIn.touchend(r,h,p),b=this._zoomOut.touchend(r,h,p),C=this._tr;return m?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:C.zoom+1,around:C.unproject(m)},{originalEvent:r})}):b?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:C.zoom-1,around:C.unproject(b)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ns{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const h=this._moveFunction(...r);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(r,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,h){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const m=h.length?h[0]:h;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&E.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ba={0:1,2:2};class yo{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const h=E.mouseButton(r);this._eventButton=h}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(h,p){const m=ba[p];return h.buttons===void 0||(h.buttons&m)!==m}(r,this._eventButton)}isValidEndEvent(r){return E.mouseButton(r)===this._eventButton}}class Pt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}const pl=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(r){r.preventDefault()}},js=({enable:y,clickTolerance:r,bearingDegreesPerPixelMoved:h=.8})=>{const p=new yo({checkCorrectEvent:m=>E.mouseButton(m)===0&&m.ctrlKey||E.mouseButton(m)===2});return new Ns({clickTolerance:r,move:(m,b)=>({bearingDelta:(b.x-m.x)*h}),moveStateManager:p,enable:y,assignEvents:pl})},Us=({enable:y,clickTolerance:r,pitchDegreesPerPixelMoved:h=-.5})=>{const p=new yo({checkCorrectEvent:m=>E.mouseButton(m)===0&&m.ctrlKey||E.mouseButton(m)===2});return new Ns({clickTolerance:r,move:(m,b)=>({pitchDelta:(b.y-m.y)*h}),moveStateManager:p,enable:y,assignEvents:pl})};class kh{constructor(r,h){this._clickTolerance=r.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(r,h,p){return this._calculateTransform(r,h,p)}touchmove(r,h,p){if(this._active&&!(p.length<this.minTouchs()))return r.preventDefault(),this._calculateTransform(r,h,p)}touchend(r,h,p){this._calculateTransform(r,h,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,h,p){p.length>0&&(this._active=!0);const m=cs(p,h),b=new a.P(0,0),C=new a.P(0,0);let M=0;for(const F in m){const $=m[F],q=this._touches[F];q&&(b._add($),C._add($.sub(q)),M++,m[F]=$)}if(this._touches=m,M<this.minTouchs()||!C.mag())return;const L=C.div(M);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ct{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,h,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([h[0],h[1]]))}touchmove(r,h,p){if(!this._firstTwoTouches)return;r.preventDefault();const[m,b]=this._firstTwoTouches,C=Vs(p,h,m),M=Vs(p,h,b);if(!C||!M)return;const L=this._aroundCenter?null:C.add(M).div(2);return this._move([C,M],L,r)}touchend(r,h,p){if(!this._firstTwoTouches)return;const[m,b]=this._firstTwoTouches,C=Vs(p,h,m),M=Vs(p,h,b);C&&M||(this._active&&E.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Vs(y,r,h){for(let p=0;p<y.length;p++)if(y[p].identifier===h)return r[p]}function Sh(y,r){return Math.log(y/r)/Math.LN2}class Th extends Ct{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,h){const p=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Sh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sh(this._distance,p),pinchAround:h}}}function ml(y,r){return 180*y.angleWith(r)/Math.PI}class Lc extends Ct{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,h,p){const m=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ml(this._vector,m),pinchAround:h}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const h=25/(Math.PI*this._minDiameter)*360,p=ml(r,this._startVector);return Math.abs(p)<h}}function gl(y){return Math.abs(y.y)>Math.abs(y.x)}class Ch extends Ct{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,h,p){super.touchstart(r,h,p),this._currentTouchCount=p.length}_start(r){this._lastPoints=r,gl(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,h,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=r[0].sub(this._lastPoints[0]),b=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,b,p.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(m.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(r,h,p){if(this._valid!==void 0)return this._valid;const m=r.mag()>=2,b=h.mag()>=2;if(!m&&!b)return;if(!m||!b)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const C=r.y>0==h.y>0;return gl(r)&&gl(h)&&C}}const nf={panStep:100,bearingStep:15,pitchStep:10};class Ko{constructor(r){this._tr=new Os(r);const h=nf;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let h=0,p=0,m=0,b=0,C=0;switch(r.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:r.shiftKey?p=-1:(r.preventDefault(),b=-1);break;case 39:r.shiftKey?p=1:(r.preventDefault(),b=1);break;case 38:r.shiftKey?m=1:(r.preventDefault(),C=-1);break;case 40:r.shiftKey?m=-1:(r.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:M=>{const L=this._tr;M.easeTo({duration:300,easeId:"keyboardHandler",easing:Qi,zoom:h?Math.round(L.zoom)+h*(r.shiftKey?2:1):L.zoom,bearing:L.bearing+p*this._bearingStep,pitch:L.pitch+m*this._pitchStep,offset:[-b*this._panStep,-C*this._panStep],center:L.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qi(y){return y*(2-y)}const wa=4.000244140625;class _l{constructor(r,h){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=r,this._tr=new Os(r),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(r){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!r[this._map.cooperativeGestures._bypassKey])return;let h=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const p=S.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,h!==0&&h%wa==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),r.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=r,this._delta-=h,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=E.mousePos(this._map.getCanvas(),r),p=this._tr;this._around=h.y>p.transform.height/2-p.transform.getHorizon()?a.M.convert(this._aroundCenter?p.center:p.unproject(h)):a.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(this._delta!==0){const M=this._type==="wheel"&&Math.abs(this._delta)>wa?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*M)));this._delta<0&&L!==0&&(L=1/L);const F=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):r.scale;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(F*L))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:r.zoom,p=this._startZoom,m=this._easing;let b,C=!1;if(this._type==="wheel"&&p&&m){const M=Math.min((S.now()-this._lastWheelEventTime)/200,1),L=m(M);b=a.z.number(p,h,L),M<1?this._frameId||(this._frameId=!0):C=!0}else b=h,C=!0;return this._active=!0,C&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!C,zoomDelta:b-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let h=a.b7;if(this._prevEase){const p=this._prevEase,m=(S.now()-p.start)/p.duration,b=p.easing(m+.01)-p.easing(m),C=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-C*C);h=a.b6(C,M,.25,1)}return this._prevEase={start:S.now(),duration:r,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Ac{constructor(r,h){this._clickZoom=r,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Eh{constructor(r){this._tr=new Os(r),this.reset()}reset(){this._active=!1}dblclick(r,h){return r.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mh{constructor(){this._tap=new Ic({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,h,p){if(!this._swipePoint)if(this._tapTime){const m=h[0],b=r.timeStamp-this._tapTime<500,C=this._tapPoint.dist(m)<30;b&&C?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(r,h,p)}touchmove(r,h,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=h[0],b=m.y-this._swipePoint.y;return this._swipePoint=m,r.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(r,h,p)}touchend(r,h,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(r,h,p);m&&(this._tapTime=r.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ih{constructor(r,h,p){this._el=r,this._mousePan=h,this._touchPan=p}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ro{constructor(r,h,p){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=h,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class xa{constructor(r,h,p,m){this._el=r,this._touchZoom=h,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Ut{constructor(r,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=E.create("div","maplibregl-cooperative-gesture-screen",r);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=p,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(E.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(r){this._onCooperativeGesture(r.touches.length===1)}wheel(r){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!r[this._bypassKey])}_onCooperativeGesture(r){this._enabled&&r&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Wt=y=>y.zoom||y.drag||y.pitch||y.rotate;class yl extends a.k{}function ka(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Pc{constructor(r,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,b)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const C=m.type==="renderFrame"?void 0:m,M={needsRenderFrame:!1},L={},F={},$=m.touches,q=$?this._getMapTouches($):void 0,ee=q?E.touchPos(this._map.getCanvas(),q):E.mousePos(this._map.getCanvas(),m);for(const{handlerName:_e,handler:ue,allowed:Ce}of this._handlers){if(!ue.isEnabled())continue;let qe;this._blockedByActive(F,Ce,_e)?ue.reset():ue[b||m.type]&&(qe=ue[b||m.type](m,ee,q),this.mergeHandlerResult(M,L,qe,_e,C),qe&&qe.needsRenderFrame&&this._triggerRenderFrame()),(qe||ue.isActive())&&(F[_e]=ue)}const pe={};for(const _e in this._previousActiveHandlers)F[_e]||(pe[_e]=C);this._previousActiveHandlers=F,(Object.keys(pe).length||ka(M))&&(this._changes.push([M,L,pe]),this._triggerRenderFrame()),(Object.keys(F).length||ka(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=M;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xh(r),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,b,C]of this._listeners)E.addEventListener(m,b,m===document?this.handleWindowEvent:this.handleEvent,C)}destroy(){for(const[r,h,p]of this._listeners)E.removeEventListener(r,h,r===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(r){const h=this._map,p=h.getCanvasContainer();this._add("mapEvent",new io(h,r));const m=h.boxZoom=new no(h,r);this._add("boxZoom",m),r.interactive&&r.boxZoom&&m.enable();const b=h.cooperativeGestures=new Ut(h,r.cooperativeGestures);this._add("cooperativeGestures",b),r.cooperativeGestures&&b.enable();const C=new tf(h),M=new Eh(h);h.doubleClickZoom=new Ac(M,C),this._add("tapZoom",C),this._add("clickZoom",M),r.interactive&&r.doubleClickZoom&&h.doubleClickZoom.enable();const L=new Mh;this._add("tapDragZoom",L);const F=h.touchPitch=new Ch(h);this._add("touchPitch",F),r.interactive&&r.touchPitch&&h.touchPitch.enable(r.touchPitch);const $=js(r),q=Us(r);h.dragRotate=new ro(r,$,q),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]),r.interactive&&r.dragRotate&&h.dragRotate.enable();const ee=(({enable:qe,clickTolerance:be})=>{const Re=new yo({checkCorrectEvent:Ge=>E.mouseButton(Ge)===0&&!Ge.ctrlKey});return new Ns({clickTolerance:be,move:(Ge,He)=>({around:He,panDelta:He.sub(Ge)}),activateOnStart:!0,moveStateManager:Re,enable:qe,assignEvents:pl})})(r),pe=new kh(r,h);h.dragPan=new Ih(p,ee,pe),this._add("mousePan",ee),this._add("touchPan",pe,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&h.dragPan.enable(r.dragPan);const fe=new Lc,_e=new Th;h.touchZoomRotate=new xa(p,_e,fe,L),this._add("touchRotate",fe,["touchPan","touchZoom"]),this._add("touchZoom",_e,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&h.touchZoomRotate.enable(r.touchZoomRotate);const ue=h.scrollZoom=new _l(h,()=>this._triggerRenderFrame());this._add("scrollZoom",ue,["mousePan"]),r.interactive&&r.scrollZoom&&h.scrollZoom.enable(r.scrollZoom);const Ce=h.keyboard=new Ko(h);this._add("keyboard",Ce),r.interactive&&r.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new _o(h))}_add(r,h,p){this._handlers.push({handlerName:r,handler:h,allowed:p}),this._handlersById[r]=h}stop(r){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Wt(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,h,p){for(const m in r)if(m!==p&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(r){const h=[];for(const p of r)this._el.contains(p.target)&&h.push(p);return h}mergeHandlerResult(r,h,p,m,b){if(!p)return;a.e(r,p);const C={handlerName:m,originalEvent:p.originalEvent||b};p.zoomDelta!==void 0&&(h.zoom=C),p.panDelta!==void 0&&(h.drag=C),p.pitchDelta!==void 0&&(h.pitch=C),p.bearingDelta!==void 0&&(h.rotate=C)}_applyChanges(){const r={},h={},p={};for(const[m,b,C]of this._changes)m.panDelta&&(r.panDelta=(r.panDelta||new a.P(0,0))._add(m.panDelta)),m.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(r.around=m.around),m.pinchAround!==void 0&&(r.pinchAround=m.pinchAround),m.noInertia&&(r.noInertia=m.noInertia),a.e(h,b),a.e(p,C);this._updateMapTransform(r,h,p),this._changes=[]}_updateMapTransform(r,h,p){const m=this._map,b=m._getTransformForUpdate(),C=m.terrain;if(!(ka(r)||C&&this._terrainMovement))return this._fireEvents(h,p,!0);let{panDelta:M,zoomDelta:L,bearingDelta:F,pitchDelta:$,around:q,pinchAround:ee}=r;ee!==void 0&&(q=ee),m._stop(!0),q=q||m.transform.centerPoint;const pe=b.pointLocation(M?q.sub(M):q);F&&(b.bearing+=F),$&&(b.pitch+=$),L&&(b.zoom+=L),C?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(M)):b.setLocationAtPoint(pe,q):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(pe,q),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(m.terrain)})):b.setLocationAtPoint(pe,q),m._applyUpdatedTransform(b),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(h,p,!0)}_fireEvents(r,h,p){const m=Wt(this._eventsInProgress),b=Wt(r),C={};for(const $ in r){const{originalEvent:q}=r[$];this._eventsInProgress[$]||(C[`${$}start`]=q),this._eventsInProgress[$]=r[$]}!m&&b&&this._fireEvent("movestart",b.originalEvent);for(const $ in C)this._fireEvent($,C[$]);b&&this._fireEvent("move",b.originalEvent);for(const $ in r){const{originalEvent:q}=r[$];this._fireEvent($,q)}const M={};let L;for(const $ in this._eventsInProgress){const{handlerName:q,originalEvent:ee}=this._eventsInProgress[$];this._handlersById[q].isActive()||(delete this._eventsInProgress[$],L=h[q]||ee,M[`${$}end`]=L)}for(const $ in M)this._fireEvent($,M[$]);const F=Wt(this._eventsInProgress);if(p&&(m||b)&&!F){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),q=ee=>ee!==0&&-this._bearingSnap<ee&&ee<this._bearingSnap;!$||!$.essential&&S.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:L})),q(this._map.getBearing())&&this._map.resetNorth()):(q($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:L})),this._updatingCamera=!1}}_fireEvent(r,h){this._map.fire(new a.k(r,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new yl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class kr extends a.E{constructor(r,h){super(),this._renderFrameCallback=()=>{const p=Math.min((S.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.M(this.transform.center.lng,this.transform.center.lat)}setCenter(r,h){return this.jumpTo({center:r},h)}panBy(r,h,p){return r=a.P.convert(r).mult(-1),this.panTo(this.transform.center,a.e({offset:r},h),p)}panTo(r,h,p){return this.easeTo(a.e({center:r},h),p)}getZoom(){return this.transform.zoom}setZoom(r,h){return this.jumpTo({zoom:r},h),this}zoomTo(r,h,p){return this.easeTo(a.e({zoom:r},h),p)}zoomIn(r,h){return this.zoomTo(this.getZoom()+1,r,h),this}zoomOut(r,h){return this.zoomTo(this.getZoom()-1,r,h),this}getBearing(){return this.transform.bearing}setBearing(r,h){return this.jumpTo({bearing:r},h),this}getPadding(){return this.transform.padding}setPadding(r,h){return this.jumpTo({padding:r},h),this}rotateTo(r,h,p){return this.easeTo(a.e({bearing:r},h),p)}resetNorth(r,h){return this.rotateTo(0,a.e({duration:1e3},r),h),this}resetNorthPitch(r,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},r),h),this}snapToNorth(r,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,h):this}getPitch(){return this.transform.pitch}setPitch(r,h){return this.jumpTo({pitch:r},h),this}cameraForBounds(r,h){r=je.convert(r);const p=h&&h.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),p,h)}_cameraForBoxAndBearing(r,h,p,m){const b={top:0,bottom:0,right:0,left:0};if(typeof(m=a.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const _t=m.padding;m.padding={top:_t,bottom:_t,right:_t,left:_t}}m.padding=a.e(b,m.padding);const C=this.transform,M=C.padding,L=new je(r,h),F=C.project(L.getNorthWest()),$=C.project(L.getNorthEast()),q=C.project(L.getSouthEast()),ee=C.project(L.getSouthWest()),pe=a.b8(-p),fe=F.rotate(pe),_e=$.rotate(pe),ue=q.rotate(pe),Ce=ee.rotate(pe),qe=new a.P(Math.max(fe.x,_e.x,Ce.x,ue.x),Math.max(fe.y,_e.y,Ce.y,ue.y)),be=new a.P(Math.min(fe.x,_e.x,Ce.x,ue.x),Math.min(fe.y,_e.y,Ce.y,ue.y)),Re=qe.sub(be),Ge=(C.width-(M.left+M.right+m.padding.left+m.padding.right))/Re.x,He=(C.height-(M.top+M.bottom+m.padding.top+m.padding.bottom))/Re.y;if(He<0||Ge<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ke=Math.min(C.scaleZoom(C.scale*Math.min(Ge,He)),m.maxZoom),nt=a.P.convert(m.offset),it=new a.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(a.b8(p)),ft=nt.add(it).mult(C.scale/C.zoomScale(Ke));return{center:C.unproject(F.add(q).div(2).sub(ft)),zoom:Ke,bearing:p}}fitBounds(r,h,p){return this._fitInternal(this.cameraForBounds(r,h),h,p)}fitScreenCoordinates(r,h,p,m,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(r)),this.transform.pointLocation(a.P.convert(h)),p,m),m,b)}_fitInternal(r,h,p){return r?(delete(h=a.e(r,h)).padding,h.linear?this.easeTo(h,p):this.flyTo(h,p)):this}jumpTo(r,h){this.stop();const p=this._getTransformForUpdate();let m=!1,b=!1,C=!1;return"zoom"in r&&p.zoom!==+r.zoom&&(m=!0,p.zoom=+r.zoom),r.center!==void 0&&(p.center=a.M.convert(r.center)),"bearing"in r&&p.bearing!==+r.bearing&&(b=!0,p.bearing=+r.bearing),"pitch"in r&&p.pitch!==+r.pitch&&(C=!0,p.pitch=+r.pitch),r.padding==null||p.isPaddingEqual(r.padding)||(p.padding=r.padding),this._applyUpdatedTransform(p),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),m&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),b&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),C&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(r,h,p,m=0){const b=a.Y.fromLngLat(r,h),C=a.Y.fromLngLat(p,m),M=C.x-b.x,L=C.y-b.y,F=C.z-b.z,$=Math.hypot(M,L,F);if($===0)throw new Error("Can't calculate camera options with same From and To");const q=Math.hypot(M,L),ee=this.transform.scaleZoom(this.transform.cameraToCenterDistance/$/this.transform.tileSize),pe=180*Math.atan2(M,-L)/Math.PI;let fe=180*Math.acos(q/$)/Math.PI;return fe=F<0?90-fe:90+fe,{center:C.toLngLat(),zoom:ee,pitch:fe,bearing:pe}}easeTo(r,h){var p;this._stop(!1,r.easeId),((r=a.e({offset:[0,0],duration:500,easing:a.b7},r)).animate===!1||!r.essential&&S.prefersReducedMotion)&&(r.duration=0);const m=this._getTransformForUpdate(),b=this.getZoom(),C=this.getBearing(),M=this.getPitch(),L=this.getPadding(),F="bearing"in r?this._normalizeBearing(r.bearing,C):C,$="pitch"in r?+r.pitch:M,q="padding"in r?r.padding:m.padding,ee=a.P.convert(r.offset);let pe=m.centerPoint.add(ee);const fe=m.pointLocation(pe),{center:_e,zoom:ue}=m.getConstrained(a.M.convert(r.center||fe),(p=r.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(_e);const Ce=m.project(fe),qe=m.project(_e).sub(Ce),be=m.zoomScale(ue-b);let Re,Ge;r.around&&(Re=a.M.convert(r.around),Ge=m.locationPoint(Re));const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||ue!==b,this._rotating=this._rotating||C!==F,this._pitching=this._pitching||$!==M,this._padding=!m.isPaddingEqual(q),this._easeId=r.easeId,this._prepareEase(h,r.noMoveStart,He),this.terrain&&this._prepareElevation(_e),this._ease(Ke=>{if(this._zooming&&(m.zoom=a.z.number(b,ue,Ke)),this._rotating&&(m.bearing=a.z.number(C,F,Ke)),this._pitching&&(m.pitch=a.z.number(M,$,Ke)),this._padding&&(m.interpolatePadding(L,q,Ke),pe=m.centerPoint.add(ee)),this.terrain&&!r.freezeElevation&&this._updateElevation(Ke),Re)m.setLocationAtPoint(Re,Ge);else{const nt=m.zoomScale(m.zoom-b),it=ue>b?Math.min(2,be):Math.max(.5,be),ft=Math.pow(it,1-Ke),_t=m.unproject(Ce.add(qe.mult(Ke*ft)).mult(nt));m.setLocationAtPoint(m.renderWorldCopies?_t.wrap():_t,pe)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Ke=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Ke)},r),this}_prepareEase(r,h,p={}){this._moving=!0,h||p.moving||this.fire(new a.k("movestart",r)),this._zooming&&!p.zooming&&this.fire(new a.k("zoomstart",r)),this._rotating&&!p.rotating&&this.fire(new a.k("rotatestart",r)),this._pitching&&!p.pitching&&this.fire(new a.k("pitchstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&h!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(p-(h-(p*r+this._elevationStart))/(1-r)),this._elevationTarget=h}this.transform.elevation=a.z.number(this._elevationStart,this._elevationTarget,r)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(r){if(!this.transformCameraUpdate)return;const h=r.clone(),{center:p,zoom:m,pitch:b,bearing:C,elevation:M}=this.transformCameraUpdate(h);p&&(h.center=p),m!==void 0&&(h.zoom=m),b!==void 0&&(h.pitch=b),C!==void 0&&(h.bearing=C),M!==void 0&&(h.elevation=M),this.transform.apply(h)}_fireMoveEvents(r){this.fire(new a.k("move",r)),this._zooming&&this.fire(new a.k("zoom",r)),this._rotating&&this.fire(new a.k("rotate",r)),this._pitching&&this.fire(new a.k("pitch",r))}_afterEase(r,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const p=this._zooming,m=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new a.k("zoomend",r)),m&&this.fire(new a.k("rotateend",r)),b&&this.fire(new a.k("pitchend",r)),this.fire(new a.k("moveend",r))}flyTo(r,h){var p;if(!r.essential&&S.prefersReducedMotion){const Ti=a.L(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ti,h)}this.stop(),r=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b7},r);const m=this._getTransformForUpdate(),b=this.getZoom(),C=this.getBearing(),M=this.getPitch(),L=this.getPadding(),F="bearing"in r?this._normalizeBearing(r.bearing,C):C,$="pitch"in r?+r.pitch:M,q="padding"in r?r.padding:m.padding,ee=a.P.convert(r.offset);let pe=m.centerPoint.add(ee);const fe=m.pointLocation(pe),{center:_e,zoom:ue}=m.getConstrained(a.M.convert(r.center||fe),(p=r.zoom)!==null&&p!==void 0?p:b);this._normalizeCenter(_e);const Ce=m.zoomScale(ue-b),qe=m.project(fe),be=m.project(_e).sub(qe);let Re=r.curve;const Ge=Math.max(m.width,m.height),He=Ge/Ce,Ke=be.mag();if("minZoom"in r){const Ti=a.ac(Math.min(r.minZoom,b,ue),m.minZoom,m.maxZoom),ei=Ge/m.zoomScale(Ti-b);Re=Math.sqrt(ei/Ke*2)}const nt=Re*Re;function it(Ti){const ei=(He*He-Ge*Ge+(Ti?-1:1)*nt*nt*Ke*Ke)/(2*(Ti?He:Ge)*nt*Ke);return Math.log(Math.sqrt(ei*ei+1)-ei)}function ft(Ti){return(Math.exp(Ti)-Math.exp(-Ti))/2}function _t(Ti){return(Math.exp(Ti)+Math.exp(-Ti))/2}const oi=it(!1);let yt=function(Ti){return _t(oi)/_t(oi+Re*Ti)},Jt=function(Ti){return Ge*((_t(oi)*(ft(ei=oi+Re*Ti)/_t(ei))-ft(oi))/nt)/Ke;var ei},si=(it(!0)-oi)/Re;if(Math.abs(Ke)<1e-6||!isFinite(si)){if(Math.abs(Ge-He)<1e-6)return this.easeTo(r,h);const Ti=He<Ge?-1:1;si=Math.abs(Math.log(He/Ge))/Re,Jt=function(){return 0},yt=function(ei){return Math.exp(Ti*Re*ei)}}return r.duration="duration"in r?+r.duration:1e3*si/("screenSpeed"in r?+r.screenSpeed/Re:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=C!==F,this._pitching=$!==M,this._padding=!m.isPaddingEqual(q),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(_e),this._ease(Ti=>{const ei=Ti*si,ci=1/yt(ei);m.zoom=Ti===1?ue:b+m.scaleZoom(ci),this._rotating&&(m.bearing=a.z.number(C,F,Ti)),this._pitching&&(m.pitch=a.z.number(M,$,Ti)),this._padding&&(m.interpolatePadding(L,q,Ti),pe=m.centerPoint.add(ee)),this.terrain&&!r.freezeElevation&&this._updateElevation(Ti);const pi=Ti===1?_e:m.unproject(qe.add(be.mult(Jt(ei))).mult(ci));m.setLocationAtPoint(m.renderWorldCopies?pi.wrap():pi,pe),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,h)}if(!r){const p=this.handlers;p&&p.stop(!1)}return this}_ease(r,h,p){p.animate===!1||p.duration===0?(r(1),h()):(this._easeStart=S.now(),this._easeOptions=p,this._onEaseFrame=r,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,h){r=a.b1(r,-180,180);const p=Math.abs(r-h);return Math.abs(r-360-h)<p&&(r-=360),Math.abs(r+360-h)<p&&(r+=360),r}_normalizeCenter(r){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const p=r.lng-h.center.lng;r.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(a.M.convert(r),this.transform.tileZoom)-this.transform.elevation:null}}const zc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class oo{constructor(r=zc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=E.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=E.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=E.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){E.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(r,h){const p=this._map._getUIString(`AttributionControl.${h}`);r.title=p,r.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const b=h[m];if(b.used||b.usedForTerrain){const C=b.getSource();C.attribution&&r.indexOf(C.attribution)<0&&r.push(C.attribution)}}r=r.filter(m=>String(m).trim()),r.sort((m,b)=>m.length-b.length),r=r.filter((m,b)=>{for(let C=b+1;C<r.length;C++)if(r[C].indexOf(m)>=0)return!1;return!0});const p=r.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,r.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Lh{constructor(r={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const p=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=E.create("div","maplibregl-ctrl");const h=E.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){E.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Sa{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const h=++this._id;return this._queue.push({callback:r,id:h,cancelled:!1}),h}remove(r){const h=this._currentlyRunning,p=h?this._queue.concat(h):this._queue;for(const m of p)if(m.id===r)return void(m.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const p of h)if(!p.cancelled&&(p.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var fn=a.X([{name:"a_pos3d",type:"Int16",components:3}]);class kn extends a.E{constructor(r){super(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,r.usedForTerrain=!0,r.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,h){this.sourceCache.update(r,h),this._renderableTilesKeys=[];const p={};for(const m of r.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),a.aN(m.posMatrix,0,a.W,0,a.W,0,1),this._tiles[m.key]=new Hn(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(r){for(const h in this._tiles){const p=this._tiles[h];(!r||p.tileID.equals(r)||p.tileID.isChildOf(r)||r.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const h={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(r.canonical)){const b=r.clone();b.posMatrix=new Float64Array(16),a.aN(b.posMatrix,0,a.W,0,a.W,0,1),h[p]=b}else if(m.canonical.isChildOf(r.canonical)){const b=r.clone();b.posMatrix=new Float64Array(16);const C=m.canonical.z-r.canonical.z,M=m.canonical.x-(m.canonical.x>>C<<C),L=m.canonical.y-(m.canonical.y>>C<<C),F=a.W>>C;a.aN(b.posMatrix,0,F,0,F,0,1),a.H(b.posMatrix,b.posMatrix,[-M*F,-L*F,0]),h[p]=b}else if(r.canonical.isChildOf(m.canonical)){const b=r.clone();b.posMatrix=new Float64Array(16);const C=r.canonical.z-m.canonical.z,M=r.canonical.x-(r.canonical.x>>C<<C),L=r.canonical.y-(r.canonical.y>>C<<C),F=a.W>>C;a.aN(b.posMatrix,0,a.W,0,a.W,0,1),a.H(b.posMatrix,b.posMatrix,[M*F,L*F,0]),a.J(b.posMatrix,b.posMatrix,[1/2**C,1/2**C,0]),h[p]=b}}return h}getSourceTile(r,h){const p=this.sourceCache._source;let m=r.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(m).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!b||!b.dem)&&h)for(;m>=p.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(r.scaledTo(m--).key);return b}tilesAfterTime(r=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=r)}}class Ah{constructor(r,h,p){this.painter=r,this.sourceCache=new kn(h),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,h,p,m=a.W){var b;if(!(h>=0&&h<m&&p>=0&&p<m))return 0;const C=this.getTerrainData(r),M=(b=C.tile)===null||b===void 0?void 0:b.dem;if(!M)return 0;const L=function(fe,_e,ue){var Ce=_e[0],qe=_e[1];return fe[0]=ue[0]*Ce+ue[4]*qe+ue[12],fe[1]=ue[1]*Ce+ue[5]*qe+ue[13],fe}([],[h/m*a.W,p/m*a.W],C.u_terrain_matrix),F=[L[0]*M.dim,L[1]*M.dim],$=Math.floor(F[0]),q=Math.floor(F[1]),ee=F[0]-$,pe=F[1]-q;return M.get($,q)*(1-ee)*(1-pe)+M.get($+1,q)*ee*(1-pe)+M.get($,q+1)*(1-ee)*pe+M.get($+1,q+1)*ee*pe}getElevationForLngLatZoom(r,h){const{tileID:p,mercatorX:m,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(r,h);return this.getElevation(p,m%a.W,b%a.W,a.W)}getElevation(r,h,p,m=a.W){return this.getDEMElevation(r,h,p,m)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const m=this.painter.context,b=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ne(m,b,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ne(m,new a.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(r,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ne(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const p=h&&h+h.tileID.key+r.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let b=r.canonical.z-h.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=m?b=r.canonical.z-m:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const C=r.canonical.x-(r.canonical.x>>b<<b),M=r.canonical.y-(r.canonical.y>>b<<b),L=a.b9(new Float64Array(16),[1/(a.W<<b),1/(a.W<<b),0]);a.H(L,L,[C*a.W,M*a.W,0]),this._demMatrixCache[r.key]={matrix:L,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(r){const h=this.painter,p=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ne(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ne(h.context,{width:p,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,C=0;b<this._coordsTextureSize;b++)for(let M=0;M<this._coordsTextureSize;M++,C+=4)h[C+0]=255&M,h[C+1]=255&b,h[C+2]=M>>8<<4|b>>8,h[C+3]=0;const p=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new ne(r,p,r.gl.RGBA,{premultiply:!1});return m.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),p=this.painter.context,m=p.gl,b=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),C=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),M=Math.round(this.painter.height/devicePixelRatio);p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(b,M-C-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null);const L=h[0]+(h[2]>>4<<8),F=h[1]+((15&h[2])<<8),$=this.coordsIndex[255-h[3]],q=$&&this.sourceCache.getTileByID($);if(!q)return null;const ee=this._coordsTextureSize,pe=(1<<q.tileID.canonical.z)*ee;return new a.Y((q.tileID.canonical.x*ee+L)/pe+q.tileID.wrap,(q.tileID.canonical.y*ee+F)/pe,this.getElevation(q.tileID,L,F,ee))}depthAtPoint(r){const h=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),p.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const r=this.painter.context,h=new a.ba,p=new a.aX,m=this.meshSize,b=a.W/m,C=m*m;for(let q=0;q<=m;q++)for(let ee=0;ee<=m;ee++)h.emplaceBack(ee*b,q*b,0);for(let q=0;q<C;q+=m+1)for(let ee=0;ee<m;ee++)p.emplaceBack(ee+q,m+ee+q+1,m+ee+q+2),p.emplaceBack(ee+q,m+ee+q+2,ee+q+1);const M=h.length,L=M+2*(m+1);for(const q of[0,1])for(let ee=0;ee<=m;ee++)for(const pe of[0,1])h.emplaceBack(ee*b,q*a.W,pe);for(let q=0;q<2*m;q+=2)p.emplaceBack(L+q,L+q+1,L+q+3),p.emplaceBack(L+q,L+q+3,L+q+2),p.emplaceBack(M+q,M+q+3,M+q+1),p.emplaceBack(M+q,M+q+2,M+q+3);const F=h.length,$=F+2*(m+1);for(const q of[0,1])for(let ee=0;ee<=m;ee++)for(const pe of[0,1])h.emplaceBack(q*a.W,ee*b,pe);for(let q=0;q<2*m;q+=2)p.emplaceBack(F+q,F+q+1,F+q+3),p.emplaceBack(F+q,F+q+3,F+q+2),p.emplaceBack($+q,$+q+3,$+q+1),p.emplaceBack($+q,$+q+2,$+q+3);return this._mesh={indexBuffer:r.createIndexBuffer(p),vertexBuffer:r.createVertexBuffer(h,fn.members),segments:a.$.simpleSegment(0,0,h.length,p.length)},this._mesh}getMeshFrameDelta(r){return 2*Math.PI*a.bb/Math.pow(2,r)/5}getMinTileElevationForLngLatZoom(r,h){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(r,h);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(r){const h=this.getTerrainData(r).tile,p={minElevation:null,maxElevation:null};return h&&h.dem&&(p.minElevation=h.dem.min*this.exaggeration,p.maxElevation=h.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(r,h){const p=a.Y.fromLngLat(r.wrap()),m=(1<<h)*a.W,b=p.x*m,C=p.y*m,M=Math.floor(b/a.W),L=Math.floor(C/a.W);return{tileID:new a.Q(h,0,h,M,L),mercatorX:b,mercatorY:C}}}class Ta{constructor(r,h,p){this._context=r,this._size=h,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new ne(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(p.texture),{id:r,fbo:h,texture:p,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>r.id!==h),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Po={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Dc{constructor(r,h){this.painter=r,this.terrain=h,this.pool=new Ta(r.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(p=>!r._layers[p].isHidden(h)),this._coordsDescendingInv={};for(const p in r.sourceCaches){this._coordsDescendingInv[p]={};const m=r.sourceCaches[p].getVisibleCoordinates();for(const b of m){const C=this.terrain.sourceCache.getTerrainCoords(b);for(const M in C)this._coordsDescendingInv[p][M]||(this._coordsDescendingInv[p][M]=[]),this._coordsDescendingInv[p][M].push(C[M])}}this._coordsDescendingInvStr={};for(const p of r._order){const m=r._layers[p],b=m.source;if(Po[m.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const C in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][C]=this._coordsDescendingInv[b][C].map(M=>M.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[m][p.tileID.key];b&&b!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(r){if(r.isHidden(this.painter.transform.zoom))return!1;const h=r.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Po[h]&&(this._prevType&&Po[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(r.id),!m))return!0;if(Po[this._prevType]||Po[h]&&m){this._prevType=h;const b=this._stacks.length-1,C=this._stacks[b]||[];for(const M of this._renderableTiles){if(this.pool.isFull()&&(dl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(M),M.rtt[b]){const F=this.pool.getObjectForId(M.rtt[b].id);if(F.stamp===M.rtt[b].stamp){this.pool.useObject(F);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),M.rtt[b]={id:L.id,stamp:L.stamp},p.context.bindFramebuffer.set(L.fbo.framebuffer),p.context.clear({color:a.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let F=0;F<C.length;F++){const $=p.style._layers[C[F]],q=$.source?this._coordsDescendingInv[$.source][M.tileID.key]:[M.tileID];p.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),p._renderTileClippingMasks($,q),p.renderLayer(p,p.style.sourceCaches[$.source],$,q),$.source&&(M.rttCoords[$.source]=this._coordsDescendingInvStr[$.source][M.tileID.key])}}return dl(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Po[h]}return!1}}const Rc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Bc=_,Ca={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:zc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},vl=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Fc={showCompass:!0,showZoom:!0,visualizePitch:!1};class Oc{constructor(r,h,p=!1){this.mousedown=C=>{this.startMouse(a.e({},C,{ctrlKey:!0,preventDefault:()=>C.preventDefault()}),E.mousePos(this.element,C)),E.addEventListener(window,"mousemove",this.mousemove),E.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=C=>{this.moveMouse(C,E.mousePos(this.element,C))},this.mouseup=C=>{this.mouseRotate.dragEnd(C),this.mousePitch&&this.mousePitch.dragEnd(C),this.offTemp()},this.touchstart=C=>{C.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=E.touchPos(this.element,C.targetTouches)[0],this.startTouch(C,this._startPos),E.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.addEventListener(window,"touchend",this.touchend))},this.touchmove=C=>{C.targetTouches.length!==1?this.reset():(this._lastPos=E.touchPos(this.element,C.targetTouches)[0],this.moveTouch(C,this._lastPos))},this.touchend=C=>{C.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=r.dragRotate._mouseRotate.getClickTolerance(),b=r.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=js({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:C,clickTolerance:M,bearingDegreesPerPixelMoved:L=.8})=>{const F=new Pt;return new Ns({clickTolerance:M,move:($,q)=>({bearingDelta:(q.x-$.x)*L}),moveStateManager:F,enable:C,assignEvents:vl})})({clickTolerance:m,enable:!0}),this.map=r,p&&(this.mousePitch=Us({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:C,clickTolerance:M,pitchDegreesPerPixelMoved:L=-.5})=>{const F=new Pt;return new Ns({clickTolerance:M,move:($,q)=>({pitchDelta:(q.y-$.y)*L}),moveStateManager:F,enable:C,assignEvents:vl})})({clickTolerance:b,enable:!0})),E.addEventListener(h,"mousedown",this.mousedown),E.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),E.addEventListener(h,"touchcancel",this.reset)}startMouse(r,h){this.mouseRotate.dragStart(r,h),this.mousePitch&&this.mousePitch.dragStart(r,h),E.disableDrag()}startTouch(r,h){this.touchRotate.dragStart(r,h),this.touchPitch&&this.touchPitch.dragStart(r,h),E.disableDrag()}moveMouse(r,h){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(r,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(r,h)||{};b&&p.setPitch(p.getPitch()+b)}}moveTouch(r,h){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(r,h)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(r,h)||{};b&&p.setPitch(p.getPitch()+b)}}off(){const r=this.element;E.removeEventListener(r,"mousedown",this.mousedown),E.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend),E.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){E.enableDrag(),E.removeEventListener(window,"mousemove",this.mousemove),E.removeEventListener(window,"mouseup",this.mouseup),E.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),E.removeEventListener(window,"touchend",this.touchend)}}let zo;function bl(y,r,h){const p=new a.M(y.lng,y.lat);if(y=new a.M(y.lng,y.lat),r){const m=new a.M(y.lng-360,y.lat),b=new a.M(y.lng+360,y.lat),C=h.locationPoint(y).distSqr(r);h.locationPoint(m).distSqr(r)<C?y=m:h.locationPoint(b).distSqr(r)<C&&(y=b)}for(;Math.abs(y.lng-h.center.lng)>180;){const m=h.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&h.locationPoint(y).y>h.height/2-h.getHorizon()?y:p}const Ea={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wl(y,r,h){const p=y.classList;for(const m in Ea)p.remove(`maplibregl-${h}-anchor-${m}`);p.add(`maplibregl-${h}-anchor-${r}`)}class Ma extends a.E{constructor(r){if(super(),this._onKeyPress=h=>{const p=h.code,m=h.charCode||h.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const p=h.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=h=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?bl(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let C="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?C="rotateX(0deg)":this._pitchAlignment==="map"&&(C=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),E.setTransform(this._element,`${Ea[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${C} ${b}`),S.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(r==null?void 0:r.opacity,r==null?void 0:r.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=a.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=E.create("div"),this._element.setAttribute("aria-label","Map marker");const h=E.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${p}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const b=E.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const C=E.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");const M=E.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"transform","translate(3.0, 29.0)"),M.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ce of L){const qe=E.createNS("http://www.w3.org/2000/svg","ellipse");qe.setAttributeNS(null,"opacity","0.04"),qe.setAttributeNS(null,"cx","10.5"),qe.setAttributeNS(null,"cy","5.80029008"),qe.setAttributeNS(null,"rx",Ce.rx),qe.setAttributeNS(null,"ry",Ce.ry),M.appendChild(qe)}const F=E.createNS("http://www.w3.org/2000/svg","g");F.setAttributeNS(null,"fill",this._color);const $=E.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),F.appendChild($);const q=E.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"opacity","0.25"),q.setAttributeNS(null,"fill","#000000");const ee=E.createNS("http://www.w3.org/2000/svg","path");ee.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),q.appendChild(ee);const pe=E.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),pe.setAttributeNS(null,"fill","#FFFFFF");const fe=E.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _e=E.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#000000"),_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962");const ue=E.createNS("http://www.w3.org/2000/svg","circle");ue.setAttributeNS(null,"fill","#FFFFFF"),ue.setAttributeNS(null,"cx","5.5"),ue.setAttributeNS(null,"cy","5.5"),ue.setAttributeNS(null,"r","5.4999962"),fe.appendChild(_e),fe.appendChild(ue),C.appendChild(M),C.appendChild(F),C.appendChild(q),C.appendChild(pe),C.appendChild(fe),h.appendChild(C),h.setAttributeNS(null,"height",p*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),wl(this._element,this._anchor,"marker"),r&&r.className)for(const h of r.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(r){return this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),E.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=a.M.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const m=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var h,p;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,b=m.terrain.depthAtPoint(this._pos),C=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,C)-b<.006)return void(this._element.style.opacity=this._opacity);const M=-this._offset.y/m.transform._pixelPerMeter,L=Math.sin(m.getPitch()*Math.PI/180)*M,F=m.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),$=m.transform.lngLatToCameraDepth(this._lngLat,C+L)-F>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=a.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,h){return r===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const xl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let $s=0,us=!1;const kl={maxWidth:100,unit:"metric"};function Sl(y,r,h){const p=h&&h.maxWidth||100,m=y._container.clientHeight/2,b=y.unproject([0,m]),C=y.unproject([p,m]),M=b.distanceTo(C);if(h&&h.unit==="imperial"){const L=3.2808*M;L>5280?hs(r,p,L/5280,y._getUIString("ScaleControl.Miles")):hs(r,p,L,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?hs(r,p,M/1852,y._getUIString("ScaleControl.NauticalMiles")):M>=1e3?hs(r,p,M/1e3,y._getUIString("ScaleControl.Kilometers")):hs(r,p,M,y._getUIString("ScaleControl.Meters"))}function hs(y,r,h,p){const m=function(b){const C=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/C;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(L){const F=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*F)/F}(M),C*M}(h);y.style.width=r*(m/h)+"px",y.innerHTML=`${m}&nbsp;${p}`}const Nc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},jc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Tl(y){if(y){if(typeof y=="number"){const r=Math.round(Math.abs(y)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,y),"top-left":new a.P(r,r),"top-right":new a.P(-r,r),bottom:new a.P(0,-y),"bottom-left":new a.P(r,-r),"bottom-right":new a.P(-r,-r),left:new a.P(y,0),right:new a.P(-y,0)}}if(y instanceof a.P||Array.isArray(y)){const r=a.P.convert(y);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:a.P.convert(y.center||[0,0]),top:a.P.convert(y.top||[0,0]),"top-left":a.P.convert(y["top-left"]||[0,0]),"top-right":a.P.convert(y["top-right"]||[0,0]),bottom:a.P.convert(y.bottom||[0,0]),"bottom-left":a.P.convert(y["bottom-left"]||[0,0]),"bottom-right":a.P.convert(y["bottom-right"]||[0,0]),left:a.P.convert(y.left||[0,0]),right:a.P.convert(y.right||[0,0])}}return Tl(new a.P(0,0))}const Ph=_;d.AJAXError=a.be,d.Evented=a.E,d.LngLat=a.M,d.MercatorCoordinate=a.Y,d.Point=a.P,d.addProtocol=a.bf,d.config=a.a,d.removeProtocol=a.bg,d.AttributionControl=oo,d.BoxZoomHandler=no,d.CanvasSource=bn,d.CooperativeGesturesHandler=Ut,d.DoubleClickZoomHandler=Ac,d.DragPanHandler=Ih,d.DragRotateHandler=ro,d.EdgeInsets=Fs,d.FullscreenControl=class extends a.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var r;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=h==null?void 0:h.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){E.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=E.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);E.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},d.GeoJSONSource=Ve,d.GeolocateControl=class extends a.E{constructor(y){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const h=new a.M(r.coords.longitude,r.coords.latitude),p=r.coords.accuracy,m=this._map.getBearing(),b=a.e({bearing:m},this.options.fitBoundsOptions),C=je.fromLngLat(h,p);this._map.fitBounds(C,b,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const h=new a.M(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&us)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=r=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=E.create("button","maplibregl-ctrl-geolocate",this._container),E.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",r===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=E.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ma({element:this._dotElement}),this._circleElement=E.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ma({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")))})}},this.options=a.e({},xl,y)}onAdd(y){return this._map=y,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return a._(this,arguments,void 0,function*(r=!1){if(zo!==void 0&&!r)return zo;if(window.navigator.permissions===void 0)return zo=!!window.navigator.geolocation,zo;try{zo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{zo=!!window.navigator.geolocation}return zo})}().then(r=>this._setupUI(r)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),E.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,$s=0,us=!1}_isOutOfMapMaxBounds(y){const r=this._map.getMaxBounds(),h=y.coords;return r&&(h.longitude<r.getWest()||h.longitude>r.getEast()||h.latitude<r.getSouth()||h.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),r=y.getSouthEast(),h=y.getNorthEast(),p=r.distanceTo(h),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":$s--,us=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),$s++,$s>1?(y={maximumAge:6e5,timeout:0},us=!0):(y=this.options.positionOptions,us=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},d.Hash=Ec,d.ImageSource=St,d.KeyboardHandler=Ko,d.LngLatBounds=je,d.LogoControl=Lh,d.Map=class extends kr{constructor(y){if(a.bc.mark(a.bd.create),(y=a.e({},Ca,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new fl(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=r=>{r.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:r}))},this._contextRestored=r=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:r}))},this._onMapScroll=r=>{if(r.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Sa,this._controls=[],this._mapId=a.a3(),this._locale=a.e({},Rc,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=j.addThrottleControl(()=>this.isMoving()),this._requestManager=new V(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let r=!1;const h=Cc(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{r?h(p):r=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Pc(this,y),this._hash=y.hash&&new Ec(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,a.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new oo(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Lh,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update(r.dataType==="style"),this.fire(new a.k(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new a.k(`${r.dataType}dataloading`,r))}),this.on("dataabort",r=>{this.fire(new a.k("sourcedataabort",r))})}_getMapId(){return this._mapId}addControl(y,r){if(r===void 0&&(r=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[r];return r.indexOf("bottom")!==-1?p.insertBefore(h,p.firstChild):p.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(y);return r>-1&&this._controls.splice(r,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,r,h,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,r,h,p)}resize(y){var r;const h=this._containerDimensions(),p=h[0],m=h[1],b=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,b),this.painter.resize(p,m,b),this.painter.overLimit()){const M=this.painter.context.gl;this._maxCanvasSize=[M.drawingBufferWidth,M.drawingBufferHeight];const L=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,L),this.painter.resize(p,m,L)}this.transform.resize(p,m),(r=this._requestedCameraState)===null||r===void 0||r.resize(p,m);const C=!this._moving;return C&&(this.stop(),this.fire(new a.k("movestart",y)).fire(new a.k("move",y))),this.fire(new a.k("resize",y)),C&&this.fire(new a.k("moveend",y)),this}_getClampedPixelRatio(y,r){const{0:h,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),b=y*m,C=r*m;return Math.min(b>h?h/b:1,C>p?p/C:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(je.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(a.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(a.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,r,h){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:r,listener:h,delegates:{mousemove:b=>{const C=this.getLayer(r)?this.queryRenderedFeatures(b.point,{layers:[r]}):[];C.length?p||(p=!0,h.call(this,new xr(y,this,b.originalEvent,{features:C}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:r,listener:h,delegates:{mousemove:C=>{(this.getLayer(r)?this.queryRenderedFeatures(C.point,{layers:[r]}):[]).length?p=!0:p&&(p=!1,h.call(this,new xr(y,this,C.originalEvent)))},mouseout:C=>{p&&(p=!1,h.call(this,new xr(y,this,C.originalEvent)))}}}}{const p=m=>{const b=this.getLayer(r)?this.queryRenderedFeatures(m.point,{layers:[r]}):[];b.length&&(m.features=b,h.call(this,m),delete m.features)};return{layer:r,listener:h,delegates:{[y]:p}}}}on(y,r,h){if(h===void 0)return super.on(y,r);const p=this._createDelegatedListener(y,r,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(y,r,h){if(h===void 0)return super.once(y,r);const p=this._createDelegatedListener(y,r,h);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(y,r,h){return h===void 0?super.off(y,r):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const m=this._delegatedListeners[y];for(let b=0;b<m.length;b++){const C=m[b];if(C.layer===r&&C.listener===h){for(const M in C.delegates)this.off(M,C.delegates[M]);return m.splice(b,1),this}}})(),this)}queryRenderedFeatures(y,r){if(!this.style)return[];let h;const p=y instanceof a.P||Array.isArray(y),m=p?y:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(p?{}:y)||{},m instanceof a.P||typeof m[0]=="number")h=[a.P.convert(m)];else{const b=a.P.convert(m[0]),C=a.P.convert(m[1]);h=[b,new a.P(C.x,b.y),C,new a.P(b.x,C.y),b]}return this.style.queryRenderedFeatures(h,r,this.transform)}querySourceFeatures(y,r){return this.style.querySourceFeatures(y,r)}setStyle(y,r){return(r=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(y,r))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const r=this._locale[y];if(r==null)throw new Error(`Missing UI string '${y}'`);return r}_updateStyle(y,r){if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,r));const h=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new Dr(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,r,h):this.style.loadJSON(y,r,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Dr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,r){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,"Style");a.h(h,new AbortController).then(p=>{this._updateDiff(p.data,r)}).catch(p=>{p&&this.fire(new a.j(p))})}else typeof y=="object"&&this._updateDiff(y,r)}_updateDiff(y,r){try{this.style.setState(y,r)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(y,r){return this._lazyInitEmptyStyle(),this.style.addSource(y,r),this._update(!0)}isSourceLoaded(y){const r=this.style&&this.style.sourceCaches[y];if(r!==void 0)return r.loaded();this.fire(new a.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const r=this.style.sourceCaches[y.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&r.reload();for(const h in this.style._layers){const p=this.style._layers[h];p.type==="hillshade"&&p.source===y.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ah(this.painter,r,y),this.painter.renderToTexture=new Dc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:y})),this}getTerrain(){var y,r;return(r=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const r in y){const h=y[r]._tiles;for(const p in h){const m=h[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,r,h={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:b,stretchY:C,content:M}=h;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||a.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:F,data:$}=r,q=r;return this.style.addImage(y,{data:new a.R({width:L,height:F},new Uint8Array($)),pixelRatio:p,stretchX:b,stretchY:C,content:M,sdf:m,version:0,userImage:q}),q.onAdd&&q.onAdd(this,y),this}}{const{width:L,height:F,data:$}=S.getImageData(r);this.style.addImage(y,{data:new a.R({width:L,height:F},$),pixelRatio:p,stretchX:b,stretchY:C,content:M,sdf:m,version:0})}}updateImage(y,r){const h=this.style.getImage(y);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=r instanceof HTMLImageElement||a.b(r)?S.getImageData(r):r,{width:m,height:b,data:C}=p;if(m===void 0||b===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||b!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const M=!(r instanceof HTMLImageElement||a.b(r));return h.data.replace(C,M),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return j.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,r){return this._lazyInitEmptyStyle(),this.style.addLayer(y,r),this._update(!0)}moveLayer(y,r){return this.style.moveLayer(y,r),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,r,h){return this.style.setLayerZoomRange(y,r,h),this._update(!0)}setFilter(y,r,h={}){return this.style.setFilter(y,r,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,r,h,p={}){return this.style.setPaintProperty(y,r,h,p),this._update(!0)}getPaintProperty(y,r){return this.style.getPaintProperty(y,r)}setLayoutProperty(y,r,h,p={}){return this.style.setLayoutProperty(y,r,h,p),this._update(!0)}getLayoutProperty(y,r){return this.style.getLayoutProperty(y,r)}setGlyphs(y,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,r,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,r,h,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,r,h=>{h||this._update(!0)}),this}setLight(y,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,r),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,r){return this.style.setFeatureState(y,r),this._update()}removeFeatureState(y,r){return this.style.removeFeatureState(y,r),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,r=0;return this._container&&(y=this._container.clientWidth||400,r=this._container.clientHeight||300),[y,r]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const r=this._canvasContainer=E.create("div","maplibregl-canvas-container",y);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=E.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),p=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],p);const m=this._controlContainer=E.create("div","maplibregl-control-container",y),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(C=>{b[C]=E.create("div",`maplibregl-ctrl-${C} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,r,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*r),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let r=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{r={requestedAttributes:y},p&&(r.statusMessage=p.statusMessage,r.type=p.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const p="Failed to initialize WebGL";throw r?(r.message=p,new Error(JSON.stringify(r))):new Error(p)}this.painter=new yh(h,this.transform),A.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const r=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,b=S.now();this.style.zoomHistory.update(m,b);const C=new a.a8(m,{now:b,fadeDuration:r,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),M=C.crossFadingFactor();M===1&&M===this._crossFadingFactor||(h=!0,this._crossFadingFactor=M),this.style.update(C)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,r,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:r,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bc.mark(a.bd.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,a.bc.mark(a.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),j.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),E.remove(this._canvasContainer),E.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bc.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,S.frameAsync(this._frameRequest).then(y=>{a.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Bc}getCameraTargetElevation(){return this.transform.elevation}},d.MapMouseEvent=xr,d.MapTouchEvent=go,d.MapWheelEvent=Mc,d.Marker=Ma,d.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const r=this._map.getZoom(),h=r===this._map.getMaxZoom(),p=r===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=r},this._setButtonTitle=(r,h)=>{const p=this._map._getUIString(`NavigationControl.${h}`);r.title=p,r.setAttribute("aria-label",p)},this.options=a.e({},Fc,y),this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),E.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),E.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=E.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Oc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){E.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,r){const h=E.create("button",y,this._container);return h.type="button",h.addEventListener("click",r),h}},d.Popup=class extends a.E{constructor(y){super(),this.remove=()=>(this._content&&E.remove(this._content),this._container&&(E.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=E.create("div","maplibregl-popup",this._map.getContainer()),this._tip=E.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const M of this.options.className.split(" "))this._container.classList.add(M);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?bl(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!r)return;const p=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const b=Tl(this.options.offset);if(!m){const M=this._container.offsetWidth,L=this._container.offsetHeight;let F;F=p.y+b.bottom.y<L?["top"]:p.y>this._map.transform.height-L?["bottom"]:[],p.x<M/2?F.push("left"):p.x>this._map.transform.width-M/2&&F.push("right"),m=F.length===0?"bottom":F.join("-")}let C=p.add(b[m]);this.options.subpixelPositioning||(C=C.round()),E.setTransform(this._container,`${Ea[m]} translate(${C.x}px,${C.y}px)`),wl(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(Nc),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=a.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const r=document.createDocumentFragment(),h=document.createElement("body");let p;for(h.innerHTML=y;p=h.firstChild,p;)r.appendChild(p);return this.setDOMContent(r)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=E.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=E.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(jc);y&&y.focus()}},d.RasterDEMTileSource=di,d.RasterTileSource=we,d.ScaleControl=class{constructor(y){this._onMove=()=>{Sl(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,Sl(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},kl),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){E.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},d.ScrollZoomHandler=_l,d.Style=Dr,d.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=E.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=E.create("button","maplibregl-ctrl-terrain",this._container),E.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){E.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},d.TwoFingersTouchPitchHandler=Ch,d.TwoFingersTouchRotateHandler=Lc,d.TwoFingersTouchZoomHandler=Th,d.TwoFingersTouchZoomRotateHandler=xa,d.VectorTileSource=kt,d.VideoSource=vn,d.addSourceType=(y,r)=>a._(void 0,void 0,void 0,function*(){if(tr(y))throw new Error(`A source type called "${y}" already exists.`);((h,p)=>{Mn[h]=p})(y,r)}),d.clearPrewarmedResources=function(){const y=ti;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(zt),ti=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},d.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},d.getRTLTextPluginStatus=function(){return ht().getRTLTextPluginStatus()},d.getVersion=function(){return Ph},d.getWorkerCount=function(){return Yt.workerCount},d.getWorkerUrl=function(){return a.a.WORKER_URL},d.importScriptInWorkers=function(y){return yi().broadcast("IS",y)},d.prewarm=function(){hi().acquire(zt)},d.setMaxParallelImageRequests=function(y){a.a.MAX_PARALLEL_IMAGE_REQUESTS=y},d.setRTLTextPlugin=function(y,r){return ht().setRTLTextPlugin(y,r)},d.setWorkerCount=function(y){Yt.workerCount=y},d.setWorkerUrl=function(y){a.a.WORKER_URL=y}});var u=t;return u})})(t0);var Ts=t0.exports;const eo=e0(Ts),_b=Jv({__proto__:null,default:eo},[Ts]);let Vt;const n0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&n0.decode();let gu=null;function Su(){return(gu===null||gu.byteLength===0)&&(gu=new Uint8Array(Vt.memory.buffer)),gu}function So(o,e){return o=o>>>0,n0.decode(Su().subarray(o,o+e))}const bs=new Array(128).fill(void 0);bs.push(void 0,null,!0,!1);let Tu=bs.length;function Bn(o){Tu===bs.length&&bs.push(bs.length+1);const e=Tu;return Tu=bs[e],bs[e]=o,e}function Ci(o){return bs[o]}function yb(o){o<132||(bs[o]=Tu,Tu=o)}function Zl(o){const e=Ci(o);return yb(o),e}function Gf(o){return o==null}let _u=null;function vb(){return(_u===null||_u.byteLength===0)&&(_u=new Float64Array(Vt.memory.buffer)),_u}let yu=null;function Li(){return(yu===null||yu.byteLength===0)&&(yu=new Int32Array(Vt.memory.buffer)),yu}let Js=0;const ad=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},bb=typeof ad.encodeInto=="function"?function(o,e){return ad.encodeInto(o,e)}:function(o,e){const t=ad.encode(o);return e.set(t),{read:o.length,written:t.length}};function id(o,e,t){if(t===void 0){const a=ad.encode(o),_=e(a.length,1)>>>0;return Su().subarray(_,_+a.length).set(a),Js=a.length,_}let i=o.length,l=e(i,1)>>>0;const u=Su();let d=0;for(;d<i;d++){const a=o.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==i){d!==0&&(o=o.slice(d)),l=t(l,i,i=d+o.length*3,1)>>>0;const a=Su().subarray(l+d,l+i),_=bb(o,a);d+=_.written}return Js=d,l}function op(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=op(o[0]));for(let d=1;d<l;d++)u+=", "+op(o[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let i;if(t.length>1)i=t[1];else return toString.call(o);if(i=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:i}function wb(o,e){const t=e(o.length*1,1)>>>0;return Su().set(o,t/1),Js=o.length,t}function Wf(o,e){try{return o.apply(this,e)}catch(t){Vt.__wbindgen_exn_store(Bn(t))}}class yd{static __wrap(e){e=e>>>0;const t=Object.create(yd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Vt.__wbg_jsroutesnapper_free(e)}constructor(e){try{const u=Vt.__wbindgen_add_to_stack_pointer(-16),d=wb(e,Vt.__wbindgen_malloc),a=Js;Vt.jsroutesnapper_new(u,d,a);var t=Li()[u/4+0],i=Li()[u/4+1],l=Li()[u/4+2];if(l)throw Zl(i);return yd.__wrap(t)}finally{Vt.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){Vt.jsroutesnapper_setRouteConfig(this.__wbg_ptr,Bn(e))}setAreaMode(){Vt.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const u=Vt.__wbindgen_add_to_stack_pointer(-16);Vt.jsroutesnapper_getConfig(u,this.__wbg_ptr);var i=Li()[u/4+0],l=Li()[u/4+1];return e=i,t=l,So(i,l)}finally{Vt.__wbindgen_add_to_stack_pointer(16),Vt.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const i=Vt.__wbindgen_add_to_stack_pointer(-16);Vt.jsroutesnapper_toFinalFeature(i,this.__wbg_ptr);var e=Li()[i/4+0],t=Li()[i/4+1];let l;return e!==0&&(l=So(e,t).slice(),Vt.__wbindgen_free(e,t*1)),l}finally{Vt.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const u=Vt.__wbindgen_add_to_stack_pointer(-16);Vt.jsroutesnapper_renderGeojson(u,this.__wbg_ptr);var i=Li()[u/4+0],l=Li()[u/4+1];return e=i,t=l,So(i,l)}finally{Vt.__wbindgen_add_to_stack_pointer(16),Vt.__wbindgen_free(e,t,1)}}toggleSnapMode(){Vt.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,i){return Vt.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,i)!==0}onClick(){Vt.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return Vt.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return Vt.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){Vt.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const l=Vt.__wbindgen_add_to_stack_pointer(-16);Vt.jsroutesnapper_editExisting(l,this.__wbg_ptr,Bn(e));var t=Li()[l/4+0],i=Li()[l/4+1];if(i)throw Zl(t)}finally{Vt.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const u=Vt.__wbindgen_add_to_stack_pointer(-16);Vt.jsroutesnapper_debugRenderGraph(u,this.__wbg_ptr);var i=Li()[u/4+0],l=Li()[u/4+1];return e=i,t=l,So(i,l)}finally{Vt.__wbindgen_add_to_stack_pointer(16),Vt.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const u=Vt.__wbindgen_add_to_stack_pointer(-16);Vt.jsroutesnapper_debugSnappableNodes(u,this.__wbg_ptr);var i=Li()[u/4+0],l=Li()[u/4+1];return e=i,t=l,So(i,l)}finally{Vt.__wbindgen_add_to_stack_pointer(16),Vt.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,i;try{const k=Vt.__wbindgen_add_to_stack_pointer(-16);Vt.jsroutesnapper_routeNameForWaypoints(k,this.__wbg_ptr,Bn(e));var l=Li()[k/4+0],u=Li()[k/4+1],d=Li()[k/4+2],a=Li()[k/4+3],_=l,v=u;if(a)throw _=0,v=0,Zl(d);return t=_,i=v,So(_,v)}finally{Vt.__wbindgen_add_to_stack_pointer(16),Vt.__wbindgen_free(t,i,1)}}addSnappedWaypoint(e,t){Vt.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){Vt.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,i;try{const k=Vt.__wbindgen_add_to_stack_pointer(-16);Vt.jsroutesnapper_calculateRoute(k,this.__wbg_ptr,Bn(e));var l=Li()[k/4+0],u=Li()[k/4+1],d=Li()[k/4+2],a=Li()[k/4+3],_=l,v=u;if(a)throw _=0,v=0,Zl(d);return t=_,i=v,So(_,v)}finally{Vt.__wbindgen_add_to_stack_pointer(16),Vt.__wbindgen_free(t,i,1)}}getExtraNodes(e,t){let i,l;try{const S=Vt.__wbindgen_add_to_stack_pointer(-16);Vt.jsroutesnapper_getExtraNodes(S,this.__wbg_ptr,Bn(e),Bn(t));var u=Li()[S/4+0],d=Li()[S/4+1],a=Li()[S/4+2],_=Li()[S/4+3],v=u,k=d;if(_)throw v=0,k=0,Zl(a);return i=v,l=k,So(v,k)}finally{Vt.__wbindgen_add_to_stack_pointer(16),Vt.__wbindgen_free(i,l,1)}}}async function xb(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(i){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function kb(){const o={};return o.wbg={},o.wbg.__wbindgen_string_new=function(e,t){const i=So(e,t);return Bn(i)},o.wbg.__wbindgen_object_drop_ref=function(e){Zl(e)},o.wbg.__wbindgen_error_new=function(e,t){const i=new Error(So(e,t));return Bn(i)},o.wbg.__wbindgen_number_get=function(e,t){const i=Ci(t),l=typeof i=="number"?i:void 0;vb()[e/8+1]=Gf(l)?0:l,Li()[e/4+0]=!Gf(l)},o.wbg.__wbindgen_is_object=function(e){const t=Ci(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_is_undefined=function(e){return Ci(e)===void 0},o.wbg.__wbindgen_in=function(e,t){return Ci(e)in Ci(t)},o.wbg.__wbindgen_boolean_get=function(e){const t=Ci(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ci(e)==Ci(t)},o.wbg.__wbindgen_string_get=function(e,t){const i=Ci(t),l=typeof i=="string"?i:void 0;var u=Gf(l)?0:id(l,Vt.__wbindgen_malloc,Vt.__wbindgen_realloc),d=Js;Li()[e/4+1]=d,Li()[e/4+0]=u},o.wbg.__wbg_String_4370c5505c674d30=function(e,t){const i=String(Ci(t)),l=id(i,Vt.__wbindgen_malloc,Vt.__wbindgen_realloc),u=Js;Li()[e/4+1]=u,Li()[e/4+0]=l},o.wbg.__wbindgen_object_clone_ref=function(e){const t=Ci(e);return Bn(t)},o.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const i=Ci(e)[Ci(t)];return Bn(i)},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Bn(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const i=Ci(t).stack,l=id(i,Vt.__wbindgen_malloc,Vt.__wbindgen_realloc),u=Js;Li()[e/4+1]=u,Li()[e/4+0]=l},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let i,l;try{i=e,l=t,console.error(So(e,t))}finally{Vt.__wbindgen_free(i,l,1)}},o.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Ci(e))},o.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Ci(e))},o.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Ci(e))},o.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Ci(e))},o.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Ci(e))},o.wbg.__wbg_get_44be0491f933a435=function(e,t){const i=Ci(e)[t>>>0];return Bn(i)},o.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Ci(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof Ci(e)=="function"},o.wbg.__wbg_next_526fc47e980da008=function(e){const t=Ci(e).next;return Bn(t)},o.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Wf(function(e){const t=Ci(e).next();return Bn(t)},arguments)},o.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Ci(e).done},o.wbg.__wbg_value_1695675138684bd5=function(e){const t=Ci(e).value;return Bn(t)},o.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return Bn(Symbol.iterator)},o.wbg.__wbg_get_97b561fb56f034b5=function(){return Wf(function(e,t){const i=Reflect.get(Ci(e),Ci(t));return Bn(i)},arguments)},o.wbg.__wbg_call_cb65541d95d71282=function(){return Wf(function(e,t){const i=Ci(e).call(Ci(t));return Bn(i)},arguments)},o.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Ci(e))},o.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Ci(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Ci(e).buffer;return Bn(t)},o.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Ci(e));return Bn(t)},o.wbg.__wbg_set_5cf90238115182c3=function(e,t,i){Ci(e).set(Ci(t),i>>>0)},o.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Ci(e).length},o.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Ci(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_debug_string=function(e,t){const i=op(Ci(t)),l=id(i,Vt.__wbindgen_malloc,Vt.__wbindgen_realloc),u=Js;Li()[e/4+1]=u,Li()[e/4+0]=l},o.wbg.__wbindgen_throw=function(e,t){throw new Error(So(e,t))},o.wbg.__wbindgen_memory=function(){const e=Vt.memory;return Bn(e)},o}function Sb(o,e){return Vt=o.exports,r0.__wbindgen_wasm_module=e,_u=null,yu=null,gu=null,Vt}async function r0(o){if(Vt!==void 0)return Vt;typeof o>"u"&&(o="/ltn/assets/route_snapper_bg.wasm");const e=kb();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:i}=await xb(await o,e);return Sb(t,i)}var Lr=63710088e-1,Lp={centimeters:Lr*100,centimetres:Lr*100,degrees:Lr/111325,feet:Lr*3.28084,inches:Lr*39.37,kilometers:Lr/1e3,kilometres:Lr/1e3,meters:Lr,metres:Lr,miles:Lr/1609.344,millimeters:Lr*1e3,millimetres:Lr*1e3,nauticalmiles:Lr/1852,radians:1,yards:Lr*1.0936},Tb={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Lr,yards:1.0936133},sp={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Io(o,e,t){t===void 0&&(t={});var i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=o,i}function Cb(o,e,t){switch(o){case"Point":return Qr(e).geometry;case"LineString":return Co(e).geometry;case"Polygon":return Ap(e).geometry;case"MultiPoint":return s0(e).geometry;case"MultiLineString":return o0(e).geometry;case"MultiPolygon":return a0(e).geometry;default:throw new Error(o+" is invalid")}}function Qr(o,e,t){if(t===void 0&&(t={}),!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!vd(o[0])||!vd(o[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:o};return Io(i,e,t)}function Eb(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(i){return Qr(i,e)}),t)}function Ap(o,e,t){t===void 0&&(t={});for(var i=0,l=o;i<l.length;i++){var u=l[i];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<u[u.length-1].length;d++)if(u[u.length-1][d]!==u[0][d])throw new Error("First and last Position are not equivalent.")}var a={type:"Polygon",coordinates:o};return Io(a,e,t)}function Mb(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(i){return Ap(i,e)}),t)}function Co(o,e,t){if(t===void 0&&(t={}),o.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:o};return Io(i,e,t)}function Ib(o,e,t){return t===void 0&&(t={}),Ba(o.map(function(i){return Co(i,e)}),t)}function Ba(o,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function o0(o,e,t){t===void 0&&(t={});var i={type:"MultiLineString",coordinates:o};return Io(i,e,t)}function s0(o,e,t){t===void 0&&(t={});var i={type:"MultiPoint",coordinates:o};return Io(i,e,t)}function a0(o,e,t){t===void 0&&(t={});var i={type:"MultiPolygon",coordinates:o};return Io(i,e,t)}function Lb(o,e,t){t===void 0&&(t={});var i={type:"GeometryCollection",geometries:o};return Io(i,e,t)}function Ab(o,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(o*t)/t}function Pp(o,e){e===void 0&&(e="kilometers");var t=Lp[e];if(!t)throw new Error(e+" units is invalid");return o*t}function Ad(o,e){e===void 0&&(e="kilometers");var t=Lp[e];if(!t)throw new Error(e+" units is invalid");return o/t}function Pb(o,e){return Lu(Ad(o,e))}function zb(o){var e=o%360;return e<0&&(e+=360),e}function Lu(o){var e=o%(2*Math.PI);return e*180/Math.PI}function Eo(o){var e=o%360;return e*Math.PI/180}function Db(o,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(o>=0))throw new Error("length must be a positive number");return Pp(Ad(o,e),t)}function Rb(o,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(o>=0))throw new Error("area must be a positive number");var i=sp[e];if(!i)throw new Error("invalid original units");var l=sp[t];if(!l)throw new Error("invalid final units");return o/i*l}function vd(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function zp(o){return!!o&&o.constructor===Object}function Bb(o){if(!o)throw new Error("bbox is required");if(!Array.isArray(o))throw new Error("bbox must be an Array");if(o.length!==4&&o.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");o.forEach(function(e){if(!vd(e))throw new Error("bbox must only contain numbers")})}function Fb(o){if(!o)throw new Error("id is required");if(["string","number"].indexOf(typeof o)===-1)throw new Error("id must be a number or a string")}const Ob=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:sp,bearingToAzimuth:zb,convertArea:Rb,convertLength:Db,degreesToRadians:Eo,earthRadius:Lr,factors:Lp,feature:Io,featureCollection:Ba,geometry:Cb,geometryCollection:Lb,isNumber:vd,isObject:zp,lengthToDegrees:Pb,lengthToRadians:Ad,lineString:Co,lineStrings:Ib,multiLineString:o0,multiPoint:s0,multiPolygon:a0,point:Qr,points:Eb,polygon:Ap,polygons:Mb,radiansToDegrees:Lu,radiansToLength:Pp,round:Ab,unitsFactors:Tb,validateBBox:Bb,validateId:Fb},Symbol.toStringTag,{value:"Module"}));function Au(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return o.geometry.coordinates;if(o.type==="Point")return o.coordinates}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return o;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ic(o){if(Array.isArray(o))return o;if(o.type==="Feature"){if(o.geometry!==null)return o.geometry.coordinates}else if(o.coordinates)return o.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function cu(o,e,t){t===void 0&&(t={});var i=Au(o),l=Au(e),u=Eo(l[1]-i[1]),d=Eo(l[0]-i[0]),a=Eo(i[1]),_=Eo(l[1]),v=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return Pp(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),t.units)}function qu(o,e,t){if(o!==null)for(var i,l,u,d,a,_,v,k=0,S=0,E,A=o.type,z=A==="FeatureCollection",R=A==="Feature",D=z?o.features.length:1,B=0;B<D;B++){v=z?o.features[B].geometry:R?o.geometry:o,E=v?v.type==="GeometryCollection":!1,a=E?v.geometries.length:1;for(var O=0;O<a;O++){var j=0,V=0;if(d=E?v.geometries[O]:v,d!==null){_=d.coordinates;var se=d.type;switch(k=t&&(se==="Polygon"||se==="MultiPolygon")?1:0,se){case null:break;case"Point":if(e(_,S,B,j,V)===!1)return!1;S++,j++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(e(_[i],S,B,j,V)===!1)return!1;S++,se==="MultiPoint"&&j++}se==="LineString"&&j++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(l=0;l<_[i].length-k;l++){if(e(_[i][l],S,B,j,V)===!1)return!1;S++}se==="MultiLineString"&&j++,se==="Polygon"&&V++}se==="Polygon"&&j++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(V=0,l=0;l<_[i].length;l++){for(u=0;u<_[i][l].length-k;u++){if(e(_[i][l][u],S,B,j,V)===!1)return!1;S++}V++}j++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(qu(d.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Nb(o,e,t,i){var l=t;return qu(o,function(u,d,a,_,v){d===0&&t===void 0?l=u:l=e(l,u,d,a,_,v)},i),l}function l0(o,e){var t;switch(o.type){case"FeatureCollection":for(t=0;t<o.features.length&&e(o.features[t].properties,t)!==!1;t++);break;case"Feature":e(o.properties,0);break}}function jb(o,e,t){var i=t;return l0(o,function(l,u){u===0&&t===void 0?i=l:i=e(i,l,u)}),i}function bd(o,e){if(o.type==="Feature")e(o,0);else if(o.type==="FeatureCollection")for(var t=0;t<o.features.length&&e(o.features[t],t)!==!1;t++);}function Ub(o,e,t){var i=t;return bd(o,function(l,u){u===0&&t===void 0?i=l:i=e(i,l,u)}),i}function Vb(o){var e=[];return qu(o,function(t){e.push(t)}),e}function Dp(o,e){var t,i,l,u,d,a,_,v,k,S,E=0,A=o.type==="FeatureCollection",z=o.type==="Feature",R=A?o.features.length:1;for(t=0;t<R;t++){for(a=A?o.features[t].geometry:z?o.geometry:o,v=A?o.features[t].properties:z?o.properties:{},k=A?o.features[t].bbox:z?o.bbox:void 0,S=A?o.features[t].id:z?o.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,E,v,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,E,v,k,S)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],E,v,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function $b(o,e,t){var i=t;return Dp(o,function(l,u,d,a,_){u===0&&t===void 0?i=l:i=e(i,l,u,d,a,_)}),i}function oc(o,e){Dp(o,function(t,i,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Io(t,l,{bbox:u,id:d}),i,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var v=0;v<t.coordinates.length;v++){var k=t.coordinates[v],S={type:_,coordinates:k};if(e(Io(S,l),i,v)===!1)return!1}})}function qb(o,e,t){var i=t;return oc(o,function(l,u,d){u===0&&d===0&&t===void 0?i=l:i=e(i,l,u,d)}),i}function c0(o,e){oc(o,function(t,i,l){var u=0;if(t.geometry){var d=t.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var a,_=0,v=0,k=0;if(qu(t,function(S,E,A,z,R){if(a===void 0||i>_||z>v||R>k){a=S,_=i,v=z,k=R,u=0;return}var D=Co([a,S],t.properties);if(e(D,i,l,R,u)===!1)return!1;u++,a=S})===!1)return!1}}})}function Zb(o,e,t){var i=t,l=!1;return c0(o,function(u,d,a,_,v){l===!1&&t===void 0?i=u:i=e(i,u,d,a,_,v),l=!0}),i}function u0(o,e){if(!o)throw new Error("geojson is required");oc(o,function(t,i,l){if(t.geometry!==null){var u=t.geometry.type,d=t.geometry.coordinates;switch(u){case"LineString":if(e(t,i,l,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<d.length;a++)if(e(Co(d[a],t.properties),i,l,a)===!1)return!1;break}}})}function Gb(o,e,t){var i=t;return u0(o,function(l,u,d,a){u===0&&t===void 0?i=l:i=e(i,l,u,d,a)}),i}function Wb(o,e){if(e=e||{},!zp(e))throw new Error("options is invalid");var t=e.featureIndex||0,i=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.segmentIndex||0,d=e.properties,a;switch(o.type){case"FeatureCollection":t<0&&(t=o.features.length+t),d=d||o.features[t].properties,a=o.features[t].geometry;break;case"Feature":d=d||o.properties,a=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=o;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=_.length+u-1),Co([_[u],_[u+1]],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u-1),Co([_[l][u],_[l][u+1]],d,e);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u-1),Co([_[i][u],_[i][u+1]],d,e);case"MultiPolygon":return i<0&&(i=_.length+i),l<0&&(l=_[i].length+l),u<0&&(u=_[i][l].length-u-1),Co([_[i][l][u],_[i][l][u+1]],d,e)}throw new Error("geojson is invalid")}function Hb(o,e){if(e=e||{},!zp(e))throw new Error("options is invalid");var t=e.featureIndex||0,i=e.multiFeatureIndex||0,l=e.geometryIndex||0,u=e.coordIndex||0,d=e.properties,a;switch(o.type){case"FeatureCollection":t<0&&(t=o.features.length+t),d=d||o.features[t].properties,a=o.features[t].geometry;break;case"Feature":d=d||o.properties,a=o.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=o;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var _=a.coordinates;switch(a.type){case"Point":return Qr(_,d,e);case"MultiPoint":return i<0&&(i=_.length+i),Qr(_[i],d,e);case"LineString":return u<0&&(u=_.length+u),Qr(_[u],d,e);case"Polygon":return l<0&&(l=_.length+l),u<0&&(u=_[l].length+u),Qr(_[l][u],d,e);case"MultiLineString":return i<0&&(i=_.length+i),u<0&&(u=_[i].length+u),Qr(_[i][u],d,e);case"MultiPolygon":return i<0&&(i=_.length+i),l<0&&(l=_[i].length+l),u<0&&(u=_[i][l].length-u),Qr(_[i][l][u],d,e)}throw new Error("geojson is invalid")}const Xb=Object.freeze(Object.defineProperty({__proto__:null,coordAll:Vb,coordEach:qu,coordReduce:Nb,featureEach:bd,featureReduce:Ub,findPoint:Hb,findSegment:Wb,flattenEach:oc,flattenReduce:qb,geomEach:Dp,geomReduce:$b,lineEach:u0,lineReduce:Gb,propEach:l0,propReduce:jb,segmentEach:c0,segmentReduce:Zb},Symbol.toStringTag,{value:"Module"}));function h0(o,e,t){if(t===void 0&&(t={}),t.final===!0)return Kb(o,e);var i=Au(o),l=Au(e),u=Eo(i[0]),d=Eo(l[0]),a=Eo(i[1]),_=Eo(l[1]),v=Math.sin(d-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return Lu(Math.atan2(v,k))}function Kb(o,e){var t=h0(e,o);return t=(t+180)%360,t}function Eg(o,e,t,i){i===void 0&&(i={});var l=Au(o),u=Eo(l[0]),d=Eo(l[1]),a=Eo(t),_=Ad(e,i.units),v=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(v)),S=Lu(k),E=Lu(v);return Qr([S,E],i.properties)}function Mg(o){if(!o)throw new Error("geojson is required");var e=[];return oc(o,function(t){Jb(t,e)}),Ba(e)}function Jb(o,e){var t=[],i=o.geometry;if(i!==null){switch(i.type){case"Polygon":t=ic(i);break;case"LineString":t=[ic(i)]}t.forEach(function(l){var u=Yb(l,o.properties);u.forEach(function(d){d.id=e.length,e.push(d)})})}}function Yb(o,e){var t=[];return o.reduce(function(i,l){var u=Co([i,l],e);return u.bbox=Qb(i,l),t.push(u),l}),t}function Qb(o,e){var t=o[0],i=o[1],l=e[0],u=e[1],d=t<l?t:l,a=i<u?i:u,_=t>l?t:l,v=i>u?i:u;return[d,a,_,v]}var Rp={exports:{}},d0={exports:{}};(function(o,e){(function(t,i){o.exports=i()})(Qy,function(){function t(O,j,V,se,ce){(function Z(Y,ye,Oe,ne,ve){for(;ne>Oe;){if(ne-Oe>600){var Je=ne-Oe+1,Le=ye-Oe+1,et=Math.log(Je),bt=.5*Math.exp(2*et/3),pt=.5*Math.sqrt(et*bt*(Je-bt)/Je)*(Le-Je/2<0?-1:1),at=Math.max(Oe,Math.floor(ye-Le*bt/Je+pt)),Xt=Math.min(ne,Math.floor(ye+(Je-Le)*bt/Je+pt));Z(Y,ye,at,Xt,ve)}var ni=Y[ye],Nt=Oe,zt=ne;for(i(Y,Oe,ye),ve(Y[ne],ni)>0&&i(Y,Oe,ne);Nt<zt;){for(i(Y,Nt,zt),Nt++,zt--;ve(Y[Nt],ni)<0;)Nt++;for(;ve(Y[zt],ni)>0;)zt--}ve(Y[Oe],ni)===0?i(Y,Oe,zt):i(Y,++zt,ne),zt<=ye&&(Oe=zt+1),ye<=zt&&(ne=zt-1)}})(O,j,V||0,se||O.length-1,ce||l)}function i(O,j,V){var se=O[j];O[j]=O[V],O[V]=se}function l(O,j){return O<j?-1:O>j?1:0}var u=function(O){O===void 0&&(O=9),this._maxEntries=Math.max(4,O),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function d(O,j,V){if(!V)return j.indexOf(O);for(var se=0;se<j.length;se++)if(V(O,j[se]))return se;return-1}function a(O,j){_(O,0,O.children.length,j,O)}function _(O,j,V,se,ce){ce||(ce=D(null)),ce.minX=1/0,ce.minY=1/0,ce.maxX=-1/0,ce.maxY=-1/0;for(var Z=j;Z<V;Z++){var Y=O.children[Z];v(ce,O.leaf?se(Y):Y)}return ce}function v(O,j){return O.minX=Math.min(O.minX,j.minX),O.minY=Math.min(O.minY,j.minY),O.maxX=Math.max(O.maxX,j.maxX),O.maxY=Math.max(O.maxY,j.maxY),O}function k(O,j){return O.minX-j.minX}function S(O,j){return O.minY-j.minY}function E(O){return(O.maxX-O.minX)*(O.maxY-O.minY)}function A(O){return O.maxX-O.minX+(O.maxY-O.minY)}function z(O,j){return O.minX<=j.minX&&O.minY<=j.minY&&j.maxX<=O.maxX&&j.maxY<=O.maxY}function R(O,j){return j.minX<=O.maxX&&j.minY<=O.maxY&&j.maxX>=O.minX&&j.maxY>=O.minY}function D(O){return{children:O,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function B(O,j,V,se,ce){for(var Z=[j,V];Z.length;)if(!((V=Z.pop())-(j=Z.pop())<=se)){var Y=j+Math.ceil((V-j)/se/2)*se;t(O,Y,j,V,ce),Z.push(j,Y,Y,V)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(O){var j=this.data,V=[];if(!R(O,j))return V;for(var se=this.toBBox,ce=[];j;){for(var Z=0;Z<j.children.length;Z++){var Y=j.children[Z],ye=j.leaf?se(Y):Y;R(O,ye)&&(j.leaf?V.push(Y):z(O,ye)?this._all(Y,V):ce.push(Y))}j=ce.pop()}return V},u.prototype.collides=function(O){var j=this.data;if(!R(O,j))return!1;for(var V=[];j;){for(var se=0;se<j.children.length;se++){var ce=j.children[se],Z=j.leaf?this.toBBox(ce):ce;if(R(O,Z)){if(j.leaf||z(O,Z))return!0;V.push(ce)}}j=V.pop()}return!1},u.prototype.load=function(O){if(!O||!O.length)return this;if(O.length<this._minEntries){for(var j=0;j<O.length;j++)this.insert(O[j]);return this}var V=this._build(O.slice(),0,O.length-1,0);if(this.data.children.length)if(this.data.height===V.height)this._splitRoot(this.data,V);else{if(this.data.height<V.height){var se=this.data;this.data=V,V=se}this._insert(V,this.data.height-V.height-1,!0)}else this.data=V;return this},u.prototype.insert=function(O){return O&&this._insert(O,this.data.height-1),this},u.prototype.clear=function(){return this.data=D([]),this},u.prototype.remove=function(O,j){if(!O)return this;for(var V,se,ce,Z=this.data,Y=this.toBBox(O),ye=[],Oe=[];Z||ye.length;){if(Z||(Z=ye.pop(),se=ye[ye.length-1],V=Oe.pop(),ce=!0),Z.leaf){var ne=d(O,Z.children,j);if(ne!==-1)return Z.children.splice(ne,1),ye.push(Z),this._condense(ye),this}ce||Z.leaf||!z(Z,Y)?se?(V++,Z=se.children[V],ce=!1):Z=null:(ye.push(Z),Oe.push(V),V=0,se=Z,Z=Z.children[0])}return this},u.prototype.toBBox=function(O){return O},u.prototype.compareMinX=function(O,j){return O.minX-j.minX},u.prototype.compareMinY=function(O,j){return O.minY-j.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(O){return this.data=O,this},u.prototype._all=function(O,j){for(var V=[];O;)O.leaf?j.push.apply(j,O.children):V.push.apply(V,O.children),O=V.pop();return j},u.prototype._build=function(O,j,V,se){var ce,Z=V-j+1,Y=this._maxEntries;if(Z<=Y)return a(ce=D(O.slice(j,V+1)),this.toBBox),ce;se||(se=Math.ceil(Math.log(Z)/Math.log(Y)),Y=Math.ceil(Z/Math.pow(Y,se-1))),(ce=D([])).leaf=!1,ce.height=se;var ye=Math.ceil(Z/Y),Oe=ye*Math.ceil(Math.sqrt(Y));B(O,j,V,Oe,this.compareMinX);for(var ne=j;ne<=V;ne+=Oe){var ve=Math.min(ne+Oe-1,V);B(O,ne,ve,ye,this.compareMinY);for(var Je=ne;Je<=ve;Je+=ye){var Le=Math.min(Je+ye-1,ve);ce.children.push(this._build(O,Je,Le,se-1))}}return a(ce,this.toBBox),ce},u.prototype._chooseSubtree=function(O,j,V,se){for(;se.push(j),!j.leaf&&se.length-1!==V;){for(var ce=1/0,Z=1/0,Y=void 0,ye=0;ye<j.children.length;ye++){var Oe=j.children[ye],ne=E(Oe),ve=(Je=O,Le=Oe,(Math.max(Le.maxX,Je.maxX)-Math.min(Le.minX,Je.minX))*(Math.max(Le.maxY,Je.maxY)-Math.min(Le.minY,Je.minY))-ne);ve<Z?(Z=ve,ce=ne<ce?ne:ce,Y=Oe):ve===Z&&ne<ce&&(ce=ne,Y=Oe)}j=Y||j.children[0]}var Je,Le;return j},u.prototype._insert=function(O,j,V){var se=V?O:this.toBBox(O),ce=[],Z=this._chooseSubtree(se,this.data,j,ce);for(Z.children.push(O),v(Z,se);j>=0&&ce[j].children.length>this._maxEntries;)this._split(ce,j),j--;this._adjustParentBBoxes(se,ce,j)},u.prototype._split=function(O,j){var V=O[j],se=V.children.length,ce=this._minEntries;this._chooseSplitAxis(V,ce,se);var Z=this._chooseSplitIndex(V,ce,se),Y=D(V.children.splice(Z,V.children.length-Z));Y.height=V.height,Y.leaf=V.leaf,a(V,this.toBBox),a(Y,this.toBBox),j?O[j-1].children.push(Y):this._splitRoot(V,Y)},u.prototype._splitRoot=function(O,j){this.data=D([O,j]),this.data.height=O.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(O,j,V){for(var se,ce,Z,Y,ye,Oe,ne,ve=1/0,Je=1/0,Le=j;Le<=V-j;Le++){var et=_(O,0,Le,this.toBBox),bt=_(O,Le,V,this.toBBox),pt=(ce=et,Z=bt,Y=void 0,ye=void 0,Oe=void 0,ne=void 0,Y=Math.max(ce.minX,Z.minX),ye=Math.max(ce.minY,Z.minY),Oe=Math.min(ce.maxX,Z.maxX),ne=Math.min(ce.maxY,Z.maxY),Math.max(0,Oe-Y)*Math.max(0,ne-ye)),at=E(et)+E(bt);pt<ve?(ve=pt,se=Le,Je=at<Je?at:Je):pt===ve&&at<Je&&(Je=at,se=Le)}return se||V-j},u.prototype._chooseSplitAxis=function(O,j,V){var se=O.leaf?this.compareMinX:k,ce=O.leaf?this.compareMinY:S;this._allDistMargin(O,j,V,se)<this._allDistMargin(O,j,V,ce)&&O.children.sort(se)},u.prototype._allDistMargin=function(O,j,V,se){O.children.sort(se);for(var ce=this.toBBox,Z=_(O,0,j,ce),Y=_(O,V-j,V,ce),ye=A(Z)+A(Y),Oe=j;Oe<V-j;Oe++){var ne=O.children[Oe];v(Z,O.leaf?ce(ne):ne),ye+=A(Z)}for(var ve=V-j-1;ve>=j;ve--){var Je=O.children[ve];v(Y,O.leaf?ce(Je):Je),ye+=A(Y)}return ye},u.prototype._adjustParentBBoxes=function(O,j,V){for(var se=V;se>=0;se--)v(j[se],O)},u.prototype._condense=function(O){for(var j=O.length-1,V=void 0;j>=0;j--)O[j].children.length===0?j>0?(V=O[j-1].children).splice(V.indexOf(O[j]),1):this.clear():a(O[j],this.toBBox)},u})})(d0);var ew=d0.exports;const tw=Ip(Ob),iw=Ip(Xb);function f0(o,e,t){if(o!==null)for(var i,l,u,d,a,_,v,k=0,S=0,E,A=o.type,z=A==="FeatureCollection",R=A==="Feature",D=z?o.features.length:1,B=0;B<D;B++){v=z?o.features[B].geometry:R?o.geometry:o,E=v?v.type==="GeometryCollection":!1,a=E?v.geometries.length:1;for(var O=0;O<a;O++){var j=0,V=0;if(d=E?v.geometries[O]:v,d!==null){_=d.coordinates;var se=d.type;switch(k=t&&(se==="Polygon"||se==="MultiPolygon")?1:0,se){case null:break;case"Point":if(e(_,S,B,j,V)===!1)return!1;S++,j++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(e(_[i],S,B,j,V)===!1)return!1;S++,se==="MultiPoint"&&j++}se==="LineString"&&j++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(l=0;l<_[i].length-k;l++){if(e(_[i][l],S,B,j,V)===!1)return!1;S++}se==="MultiLineString"&&j++,se==="Polygon"&&V++}se==="Polygon"&&j++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(V=0,l=0;l<_[i].length;l++){for(u=0;u<_[i][l].length-k;u++){if(e(_[i][l][u],S,B,j,V)===!1)return!1;S++}V++}j++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(f0(d.geometries[i],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function p0(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return f0(o,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var nw=p0;const rw=Object.freeze(Object.defineProperty({__proto__:null,bbox:p0,default:nw},Symbol.toStringTag,{value:"Module"})),ow=Ip(rw);var is=ew,m0=tw,g0=iw,Nl=ow.default,sw=g0.featureEach;g0.coordEach;m0.polygon;var Ig=m0.featureCollection;function _0(o){var e=new is(o);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Nl(t),is.prototype.insert.call(this,t)},e.load=function(t){var i=[];return Array.isArray(t)?t.forEach(function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Nl(l),i.push(l)}):sw(t,function(l){if(l.type!=="Feature")throw new Error("invalid features");l.bbox=l.bbox?l.bbox:Nl(l),i.push(l)}),is.prototype.load.call(this,i)},e.remove=function(t,i){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Nl(t),is.prototype.remove.call(this,t,i)},e.clear=function(){return is.prototype.clear.call(this)},e.search=function(t){var i=is.prototype.search.call(this,this.toBBox(t));return Ig(i)},e.collides=function(t){return is.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=is.prototype.all.call(this);return Ig(t)},e.toJSON=function(){return is.prototype.toJSON.call(this)},e.fromJSON=function(t){return is.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var i;if(t.bbox)i=t.bbox;else if(Array.isArray(t)&&t.length===4)i=t;else if(Array.isArray(t)&&t.length===6)i=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")i=Nl(t);else if(t.type==="FeatureCollection")i=Nl(t);else throw new Error("invalid geojson");return{minX:i[0],minY:i[1],maxX:i[2],maxY:i[3]}},e}Rp.exports=_0;Rp.exports.default=_0;var aw=Rp.exports;const lw=e0(aw);function cw(o,e){var t={},i=[];if(o.type==="LineString"&&(o=Io(o)),e.type==="LineString"&&(e=Io(e)),o.type==="Feature"&&e.type==="Feature"&&o.geometry!==null&&e.geometry!==null&&o.geometry.type==="LineString"&&e.geometry.type==="LineString"&&o.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var l=Lg(o,e);return l&&i.push(l),Ba(i)}var u=lw();return u.load(Mg(e)),bd(Mg(o),function(d){bd(u.search(d),function(a){var _=Lg(d,a);if(_){var v=ic(_).join(",");t[v]||(t[v]=!0,i.push(_))}})}),Ba(i)}function Lg(o,e){var t=ic(o),i=ic(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(i.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var l=t[0][0],u=t[0][1],d=t[1][0],a=t[1][1],_=i[0][0],v=i[0][1],k=i[1][0],S=i[1][1],E=(S-v)*(d-l)-(k-_)*(a-u),A=(k-_)*(u-v)-(S-v)*(l-_),z=(d-l)*(u-v)-(a-u)*(l-_);if(E===0)return null;var R=A/E,D=z/E;if(R>=0&&R<=1&&D>=0&&D<=1){var B=l+R*(d-l),O=u+R*(a-u);return Qr([B,O])}return null}function uw(o,e,t){t===void 0&&(t={});var i=Qr([1/0,1/0],{dist:1/0}),l=0;return oc(o,function(u){for(var d=ic(u),a=0;a<d.length-1;a++){var _=Qr(d[a]);_.properties.dist=cu(e,_,t);var v=Qr(d[a+1]);v.properties.dist=cu(e,v,t);var k=cu(_,v,t),S=Math.max(_.properties.dist,v.properties.dist),E=h0(_,v),A=Eg(e,S,E+90,t),z=Eg(e,S,E-90,t),R=cw(Co([A.geometry.coordinates,z.geometry.coordinates]),Co([_.geometry.coordinates,v.geometry.coordinates])),D=null;R.features.length>0&&(D=R.features[0],D.properties.dist=cu(e,D,t),D.properties.location=l+cu(_,D,t)),_.properties.dist<i.properties.dist&&(i=_,i.properties.index=a,i.properties.location=l),v.properties.dist<i.properties.dist&&(i=v,i.properties.index=a+1,i.properties.location=l+k),D&&D.properties.dist<i.properties.dist&&(i=D,i.properties.index=a),l+=k}}),i}const hw=30;class dw{constructor(e,t,i,l,u){this.onMouseMove=d=>{if(!this.active)return;const a=[d.point.x-hw,d.point.y],_=this.map.unproject(d.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(d.lngLat.lng,d.lngLat.lat,_)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=d=>{this.active&&(d.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||d.key=="Escape"&&(d.stopPropagation(),this.cancel())},this.onKeyPress=d=>{if(!this.active)return;let a=d.target.tagName;a=="INPUT"||a=="TEXTAREA"||(d.key=="Enter"?(d.stopPropagation(),this.finish()):d.key=="s"||d.key=="S"?(d.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):d.key=="z"&&d.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new yd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=i,this.snapMode=l,this.undoLength=u,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const jl=[];function Hf(o,e){return{subscribe:wi(o,e).subscribe}}function wi(o,e=Lt){let t;const i=new Set;function l(a){if(Bt(o,a)&&(o=a,t)){const _=!jl.length;for(const v of i)v[1](),jl.push(v,o);if(_){for(let v=0;v<jl.length;v+=2)jl[v][0](jl[v+1]);jl.length=0}}}function u(a){l(a(o))}function d(a,_=Lt){const v=[a,_];return i.add(v),i.size===1&&(t=e(l,u)||Lt),a(o),()=>{i.delete(v),i.size===0&&t&&(t(),t=null)}}return{set:l,update:u,subscribe:d}}const ap="MZEJTanw3WpxRvt7qDfo";let Vo=wi(null),Pu=wi(!1),Cs=wi(""),wd=wi(!0),Cn=wi(null),zu=wi(new Ts.LngLat(0,0)),Du=wi(new Ts.LngLat(0,0)),ld=wi(new Ts.LngLat(0,0)),Ag=wi(1),vs=wi(1),Ht=wi({mode:"title",firstLoad:!0}),lp=wi("streets-v2"),cp=wi("walk_cycle_only"),Pg=wi(!1),Ru=wi(!1),xd=wi("shortcuts"),up=wi(!1);function nc(){let o=Ar(Cs);o||window.alert("Autosave failed; no projectName set?!"),window.localStorage.setItem(o,JSON.stringify(Ar(Cn).toSavefile()))}function zg(o){let e,t;return e=new Id({props:{$$slots:{default:[fw,({dialog:i})=>({3:i}),({dialog:i})=>i?8:0]},$$scope:{ctx:o}}}),e.$on("close",o[2]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&24&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function fw(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z;function R(){return o[1](o[3])}return{c(){e=oe("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=ze(),i=oe("p"),i.innerHTML=`This is an <b>experimental</b>
      version of the
      <a href="https://a-b-street.github.io/docs/software/ltn/index.html" target="_blank">A/B Street LTN tool</a>
      . Most parts of it do not work yet, and you should probably use the other version
      of the tool instead.`,l=ze(),u=oe("p"),u.textContent="To use this tool, you need to:",d=ze(),a=oe("ol"),a.innerHTML=`<li>Choose your study area to analyze</li> <li>Define one or more neighbourhood boundaries</li> <li>Optionally, fix the basemap data on existing modal filters, turn
        restrictions, one-ways, etc</li> <li>Create one or more proposals with new modal filters, and explore their
        effects</li>`,_=ze(),v=oe("p"),v.innerHTML=`This tool is created by <a href="https://github.com/dabreegster/" target="_blank">Dustin Carlino</a>
      and relies heavily on
      <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
      data.`,k=ze(),S=oe("center"),E=oe("button"),E.textContent="Start!"},m(D,B){le(D,e,B),le(D,t,B),le(D,i,B),le(D,l,B),le(D,u,B),le(D,d,B),le(D,a,B),le(D,_,B),le(D,v,B),le(D,k,B),le(D,S,B),X(S,E),A||(z=xt(E,"click",R),A=!0)},p(D,B){o=D},d(D){D&&(ae(e),ae(t),ae(i),ae(l),ae(u),ae(d),ae(a),ae(_),ae(v),ae(k),ae(S)),A=!1,z()}}}function pw(o){let e,t,i=o[0]&&zg(o);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),le(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&Q(i,1)):(i=zg(l),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(l)}}}function mw(o,e,t){let i;return lt(o,wd,d=>t(0,i=d)),[i,d=>yr(d).close(),()=>Tt(wd,i=!1,i)]}class gw extends qt{constructor(e){super(),$t(this,e,mw,pw,Bt,{})}}let rt;const ws=new Array(128).fill(void 0);ws.push(void 0,null,!0,!1);function fi(o){return ws[o]}let Cu=ws.length;function _w(o){o<132||(ws[o]=Cu,Cu=o)}function er(o){const e=fi(o);return _w(o),e}let $r=0,vu=null;function Xl(){return(vu===null||vu.byteLength===0)&&(vu=new Uint8Array(rt.memory.buffer)),vu}const cd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},yw=typeof cd.encodeInto=="function"?function(o,e){return cd.encodeInto(o,e)}:function(o,e){const t=cd.encode(o);return e.set(t),{read:o.length,written:t.length}};function Oo(o,e,t){if(t===void 0){const a=cd.encode(o),_=e(a.length,1)>>>0;return Xl().subarray(_,_+a.length).set(a),$r=a.length,_}let i=o.length,l=e(i,1)>>>0;const u=Xl();let d=0;for(;d<i;d++){const a=o.charCodeAt(d);if(a>127)break;u[l+d]=a}if(d!==i){d!==0&&(o=o.slice(d)),l=t(l,i,i=d+o.length*3,1)>>>0;const a=Xl().subarray(l+d,l+i),_=yw(o,a);d+=_.written}return $r=d,l}function Gl(o){return o==null}let bu=null;function Rt(){return(bu===null||bu.byteLength===0)&&(bu=new Int32Array(rt.memory.buffer)),bu}let wu=null;function y0(){return(wu===null||wu.byteLength===0)&&(wu=new Float64Array(rt.memory.buffer)),wu}function Zi(o){Cu===ws.length&&ws.push(ws.length+1);const e=Cu;return Cu=ws[e],ws[e]=o,e}const v0=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&v0.decode();function _r(o,e){return o=o>>>0,v0.decode(Xl().subarray(o,o+e))}let xu=null;function vw(){return(xu===null||xu.byteLength===0)&&(xu=new BigInt64Array(rt.memory.buffer)),xu}function hp(o){const e=typeof o;if(e=="number"||e=="boolean"||o==null)return`${o}`;if(e=="string")return`"${o}"`;if(e=="symbol"){const l=o.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=o.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(o)){const l=o.length;let u="[";l>0&&(u+=hp(o[0]));for(let d=1;d<l;d++)u+=", "+hp(o[d]);return u+="]",u}const t=/\[object ([^\]]+)\]/.exec(toString.call(o));let i;if(t.length>1)i=t[1];else return toString.call(o);if(i=="Object")try{return"Object("+JSON.stringify(o)+")"}catch{return"Object"}return o instanceof Error?`${o.name}: ${o.message}
${o.stack}`:i}function bw(o,e){const t=e(o.length*1,1)>>>0;return Xl().set(o,t/1),$r=o.length,t}function ww(o,e){return o=o>>>0,y0().subarray(o/8,o/8+e)}function xw(o,e){return o=o>>>0,Xl().subarray(o/1,o/1+e)}function za(o,e){try{return o.apply(this,e)}catch(t){rt.__wbindgen_exn_store(Zi(t))}}class kw{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();rt.__wbg_ltn_free(e)}constructor(e,t,i){try{const v=rt.__wbindgen_add_to_stack_pointer(-16),k=bw(e,rt.__wbindgen_malloc),S=$r;var l=Gl(i)?0:Oo(i,rt.__wbindgen_malloc,rt.__wbindgen_realloc),u=$r;rt.ltn_new(v,k,S,Zi(t),l,u);var d=Rt()[v/4+0],a=Rt()[v/4+1],_=Rt()[v/4+2];if(_)throw er(a);return this.__wbg_ptr=d>>>0,this}finally{rt.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const v=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_getInvertedBoundary(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,er(u);return e=a,t=_,_r(a,_)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(e,t,1)}}getBounds(){try{const l=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_getBounds(l,this.__wbg_ptr);var e=Rt()[l/4+0],t=Rt()[l/4+1],i=ww(e,t).slice();return rt.__wbindgen_free(e,t*8,8),i}finally{rt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const l=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_toRouteSnapper(l,this.__wbg_ptr);var e=Rt()[l/4+0],t=Rt()[l/4+1],i=xw(e,t).slice();return rt.__wbindgen_free(e,t*1,1),i}finally{rt.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const v=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_toRouteSnapperGj(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,er(u);return e=a,t=_,_r(a,_)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const v=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_renderModalFilters(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,er(u);return e=a,t=_,_r(a,_)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const v=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_renderNeighbourhood(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,er(u);return e=a,t=_,_r(a,_)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(e,t,1)}}renderAutoBoundaries(){let e,t;try{const v=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_renderAutoBoundaries(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,er(u);return e=a,t=_,_r(a,_)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(e,t,1)}}setNeighbourhoodBoundary(e,t){try{const u=rt.__wbindgen_add_to_stack_pointer(-16),d=Oo(e,rt.__wbindgen_malloc,rt.__wbindgen_realloc),a=$r;rt.ltn_setNeighbourhoodBoundary(u,this.__wbg_ptr,d,a,Zi(t));var i=Rt()[u/4+0],l=Rt()[u/4+1];if(l)throw er(i)}finally{rt.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Oo(e,rt.__wbindgen_malloc,rt.__wbindgen_realloc),i=$r;rt.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,i)}renameNeighbourhoodBoundary(e,t){const i=Oo(e,rt.__wbindgen_malloc,rt.__wbindgen_realloc),l=$r,u=Oo(t,rt.__wbindgen_malloc,rt.__wbindgen_realloc),d=$r;rt.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,i,l,u,d)}setCurrentNeighbourhood(e,t){try{const u=rt.__wbindgen_add_to_stack_pointer(-16),d=Oo(e,rt.__wbindgen_malloc,rt.__wbindgen_realloc),a=$r;rt.ltn_setCurrentNeighbourhood(u,this.__wbg_ptr,d,a,t);var i=Rt()[u/4+0],l=Rt()[u/4+1];if(l)throw er(i)}finally{rt.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const u=rt.__wbindgen_add_to_stack_pointer(-16),d=Oo(t,rt.__wbindgen_malloc,rt.__wbindgen_realloc),a=$r;rt.ltn_addModalFilter(u,this.__wbg_ptr,Zi(e),d,a);var i=Rt()[u/4+0],l=Rt()[u/4+1];if(l)throw er(i)}finally{rt.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const u=rt.__wbindgen_add_to_stack_pointer(-16),d=Oo(t,rt.__wbindgen_malloc,rt.__wbindgen_realloc),a=$r;rt.ltn_addManyModalFilters(u,this.__wbg_ptr,Zi(e),d,a);var i=Rt()[u/4+0],l=Rt()[u/4+1];if(l)throw er(i)}finally{rt.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){rt.ltn_deleteModalFilter(this.__wbg_ptr,e)}toggleDirection(e){rt.ltn_toggleDirection(this.__wbg_ptr,e)}undo(){rt.ltn_undo(this.__wbg_ptr)}redo(){rt.ltn_redo(this.__wbg_ptr)}getShortcutsCrossingRoad(e){let t,i;try{const k=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_getShortcutsCrossingRoad(k,this.__wbg_ptr,e);var l=Rt()[k/4+0],u=Rt()[k/4+1],d=Rt()[k/4+2],a=Rt()[k/4+3],_=l,v=u;if(a)throw _=0,v=0,er(d);return t=_,i=v,_r(_,v)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(t,i,1)}}getAllShortcuts(){let e,t;try{const v=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_getAllShortcuts(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,er(u);return e=a,t=_,_r(a,_)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const v=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_toSavefile(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,er(u);return e=a,t=_,_r(a,_)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const l=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_loadSavefile(l,this.__wbg_ptr,Zi(e));var t=Rt()[l/4+0],i=Rt()[l/4+1];if(i)throw er(t)}finally{rt.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,i,l,u){let d,a;try{const z=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_compareRoute(z,this.__wbg_ptr,e,t,i,l,u);var _=Rt()[z/4+0],v=Rt()[z/4+1],k=Rt()[z/4+2],S=Rt()[z/4+3],E=_,A=v;if(S)throw E=0,A=0,er(k);return d=E,a=A,_r(E,A)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(d,a,1)}}impactToOneDestination(e,t){let i,l;try{const S=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_impactToOneDestination(S,this.__wbg_ptr,e,t);var u=Rt()[S/4+0],d=Rt()[S/4+1],a=Rt()[S/4+2],_=Rt()[S/4+3],v=u,k=d;if(_)throw v=0,k=0,er(a);return i=v,l=k,_r(v,k)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(i,l,1)}}predictImpact(){let e,t;try{const v=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_predictImpact(v,this.__wbg_ptr);var i=Rt()[v/4+0],l=Rt()[v/4+1],u=Rt()[v/4+2],d=Rt()[v/4+3],a=i,_=l;if(d)throw a=0,_=0,er(u);return e=a,t=_,_r(a,_)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(e,t,1)}}getImpactsOnRoad(e){let t,i;try{const k=rt.__wbindgen_add_to_stack_pointer(-16);rt.ltn_getImpactsOnRoad(k,this.__wbg_ptr,e);var l=Rt()[k/4+0],u=Rt()[k/4+1],d=Rt()[k/4+2],a=Rt()[k/4+3],_=l,v=u;if(a)throw _=0,v=0,er(d);return t=_,i=v,_r(_,v)}finally{rt.__wbindgen_add_to_stack_pointer(16),rt.__wbindgen_free(t,i,1)}}}async function Sw(o,e){if(typeof Response=="function"&&o instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(o,e)}catch(i){if(o.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const t=await o.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(o,e);return t instanceof WebAssembly.Instance?{instance:t,module:o}:t}}function Tw(){const o={};return o.wbg={},o.wbg.__wbindgen_object_drop_ref=function(e){er(e)},o.wbg.__wbindgen_string_get=function(e,t){const i=fi(t),l=typeof i=="string"?i:void 0;var u=Gl(l)?0:Oo(l,rt.__wbindgen_malloc,rt.__wbindgen_realloc),d=$r;Rt()[e/4+1]=d,Rt()[e/4+0]=u},o.wbg.__wbindgen_boolean_get=function(e){const t=fi(e);return typeof t=="boolean"?t?1:0:2},o.wbg.__wbindgen_is_bigint=function(e){return typeof fi(e)=="bigint"},o.wbg.__wbindgen_number_get=function(e,t){const i=fi(t),l=typeof i=="number"?i:void 0;y0()[e/8+1]=Gl(l)?0:l,Rt()[e/4+0]=!Gl(l)},o.wbg.__wbindgen_is_object=function(e){const t=fi(e);return typeof t=="object"&&t!==null},o.wbg.__wbindgen_in=function(e,t){return fi(e)in fi(t)},o.wbg.__wbindgen_bigint_from_i64=function(e){return Zi(e)},o.wbg.__wbindgen_jsval_eq=function(e,t){return fi(e)===fi(t)},o.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return Zi(t)},o.wbg.__wbindgen_error_new=function(e,t){const i=new Error(_r(e,t));return Zi(i)},o.wbg.__wbindgen_is_undefined=function(e){return fi(e)===void 0},o.wbg.__wbindgen_string_new=function(e,t){const i=_r(e,t);return Zi(i)},o.wbg.__wbindgen_jsval_loose_eq=function(e,t){return fi(e)==fi(t)},o.wbg.__wbindgen_object_clone_ref=function(e){const t=fi(e);return Zi(t)},o.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const i=fi(e)[fi(t)];return Zi(i)},o.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(fi(e))},o.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(fi(e))},o.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(fi(e))},o.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(fi(e))},o.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(fi(e))},o.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Zi(e)},o.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const i=fi(t).stack,l=Oo(i,rt.__wbindgen_malloc,rt.__wbindgen_realloc),u=$r;Rt()[e/4+1]=u,Rt()[e/4+0]=l},o.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let i,l;try{i=e,l=t,console.error(_r(e,t))}finally{rt.__wbindgen_free(i,l,1)}},o.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=fi(e).performance;return Zi(t)},o.wbg.__wbg_now_2fd65358804c9485=function(e){return fi(e).now()},o.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const i=fi(e)[t>>>0];return Zi(i)},o.wbg.__wbg_length_1009b1af0c481d7b=function(e){return fi(e).length},o.wbg.__wbindgen_is_function=function(e){return typeof fi(e)=="function"},o.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const i=new Function(_r(e,t));return Zi(i)},o.wbg.__wbg_next_9b877f231f476d01=function(e){const t=fi(e).next;return Zi(t)},o.wbg.__wbg_next_6529ee0cca8d57ed=function(){return za(function(e){const t=fi(e).next();return Zi(t)},arguments)},o.wbg.__wbg_done_5fe336b092d60cf2=function(e){return fi(e).done},o.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=fi(e).value;return Zi(t)},o.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return Zi(Symbol.iterator)},o.wbg.__wbg_get_7b48513de5dc5ea4=function(){return za(function(e,t){const i=Reflect.get(fi(e),fi(t));return Zi(i)},arguments)},o.wbg.__wbg_call_90c26b09837aba1c=function(){return za(function(e,t){const i=fi(e).call(fi(t));return Zi(i)},arguments)},o.wbg.__wbg_self_f0e34d89f33b99fd=function(){return za(function(){const e=self.self;return Zi(e)},arguments)},o.wbg.__wbg_window_d3b084224f4774d7=function(){return za(function(){const e=window.window;return Zi(e)},arguments)},o.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return za(function(){const e=globalThis.globalThis;return Zi(e)},arguments)},o.wbg.__wbg_global_35dfdd59a4da3e74=function(){return za(function(){const e=global.global;return Zi(e)},arguments)},o.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(fi(e))},o.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=fi(e)instanceof ArrayBuffer}catch{t=!1}return t},o.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(fi(e))},o.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(fi(e));return Zi(t)},o.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=fi(e).buffer;return Zi(t)},o.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(fi(e));return Zi(t)},o.wbg.__wbg_set_2357bf09366ee480=function(e,t,i){fi(e).set(fi(t),i>>>0)},o.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return fi(e).length},o.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=fi(e)instanceof Uint8Array}catch{t=!1}return t},o.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const i=fi(t),l=typeof i=="bigint"?i:void 0;vw()[e/8+1]=Gl(l)?BigInt(0):l,Rt()[e/4+0]=!Gl(l)},o.wbg.__wbindgen_debug_string=function(e,t){const i=hp(fi(t)),l=Oo(i,rt.__wbindgen_malloc,rt.__wbindgen_realloc),u=$r;Rt()[e/4+1]=u,Rt()[e/4+0]=l},o.wbg.__wbindgen_throw=function(e,t){throw new Error(_r(e,t))},o.wbg.__wbindgen_memory=function(){const e=rt.memory;return Zi(e)},o}function Cw(o,e){return rt=o.exports,b0.__wbindgen_wasm_module=e,xu=null,wu=null,bu=null,vu=null,rt}async function b0(o){if(rt!==void 0)return rt;typeof o>"u"&&(o="/ltn/assets/backend_bg.wasm");const e=Tw();(typeof o=="string"||typeof Request=="function"&&o instanceof Request||typeof URL=="function"&&o instanceof URL)&&(o=fetch(o));const{instance:t,module:i}=await Sw(await o,e);return Cw(t,i)}let Ew=Date.now();function sc(o){return`${o}-${Ew++}`}const Bp=Symbol.for("svelte-maplibre");function ac(){return Md(Bp)}function Mw(o){let e=new WeakMap;return t=>{var d;let i=e.get(t.originalEvent);if(i!==void 0)return i;let u=(d=t.target.queryRenderedFeatures(t.point).find(a=>{var _;return(_=o.get(a.layer.id))==null?void 0:_.interactive}))==null?void 0:d.layer.id;return e.set(t.originalEvent,u),u}}function Iw(){let o=new Map;return Ed(Bp,{map:wi(null),source:Hf(null),layer:Hf(null),popupTarget:Hf(null),cluster:wi(),loadedImages:wi(new Set),minzoom:wi(0),maxzoom:wi(24),layerEvent:wi(null),layerInfo:o,eventTopMost:Mw(o),markerClickManager:new zw})}function Dg(o){return{subscribe:o.subscribe}}function Fp({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:i=!1}){let l=ac(),u=wi(null),d=Dg(u),a={...l,[o]:Dg(u)};if(e&&(a.popupTarget=d),i){let _=wi(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=wi()),Ed(Bp,a),{...l,self:u}}function Lw(){return Fp({key:"source",setCluster:!0})}function Aw(o=!0){return Fp({key:"layer",setPopupTarget:o,setMouseEvent:o})}function Pw(){return Fp({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}class zw{constructor(){Rn(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function Rg(o){let e;return t=>{if(t)for(let i in t){let l=e==null?void 0:e[i],u=t[i];l!==u&&o(i,u,l)}else if(e)for(let i in e)o(i,void 0,e[i]);e=t}}function Dw(o,...e){let t=[o];for(let i of e)if(i)Array.isArray(i)&&i[0]===o?t.push(...i.slice(1)):t.push(i);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Rw(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function Fa(o,e){return["case",["boolean",["feature-state","hover"],!1],e,o]}var Oa=Bw;function Bw(o){var e,t,i;if(o){if(Array.isArray(o)){for(e=[],t=o.length,i=0;i<t;i++){var l=o[i];l!=null&&e.push(l)}return e}if(typeof o=="object"){e={};var u=Object.keys(o);for(t=u.length,i=0;i<t;i++){var d=u[i],a=o[d];a!=null&&(e[d]=a)}return e}}}function Bg(o){let e=o[0],t,i,l=Fg(o);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),le(u,t,d),i=!0},p(u,d){d[0]&1&&Bt(e,e=u[0])?(gi(),re(l,1,1,Lt),_i(),l=Fg(u),l.c(),Q(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(Q(l),i=!0)},o(u){re(l),i=!1},d(u){u&&ae(t),l.d(u)}}}function Fg(o){let e;const t=o[36].default,i=Bi(t,o,o[35],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u[1]&16)&&Oi(i,t,l,l[35],e?Fi(t,l[35],u,null):Ni(l[35]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function Fw(o){let e,t,i=o[0]&&Bg(o);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),le(l,e,u),t=!0},p(l,u){l[0]?i?(i.p(l,u),u[0]&1&&Q(i,1)):(i=Bg(l),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(l)}}}function Ow(o,e,t){let i,l,u,d,a,_,v,k,S,E,A,z,{$$slots:R={},$$scope:D}=e,{id:B=sc("layer")}=e,{source:O=void 0}=e,{sourceLayer:j=void 0}=e,{beforeId:V=void 0}=e,{beforeLayerType:se=void 0}=e,{type:ce}=e,{paint:Z=void 0}=e,{layout:Y=void 0}=e,{filter:ye=void 0}=e,{applyToClusters:Oe=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:ve=void 0}=e,{manageHoverState:Je=!1}=e,{hovered:Le=null}=e,{interactive:et=!0}=e,{hoverCursor:bt=void 0}=e,{eventsIfTopMost:pt=!1}=e;const at=ns(),{map:Xt,source:ni,self:Nt,minzoom:zt,maxzoom:Yt,eventTopMost:It,layerInfo:ti}=Aw();lt(o,Xt,Ne=>t(31,S=Ne)),lt(o,ni,Ne=>t(32,E=Ne)),lt(o,Nt,Ne=>t(0,k=Ne)),lt(o,zt,Ne=>t(34,z=Ne)),lt(o,Yt,Ne=>t(33,A=Ne)),Jn(()=>{k&&S&&(ti.delete(k),S==null||S.removeLayer(k))});let Zt;function hi(Ne){var we,di;if(!et||!k||!S||pt&&It(Ne)!==k)return;let je=Ne.features??[],ot=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,kt={event:Ne,map:S,clusterId:ot,layer:k,source:a,features:je};at(Ne.type,kt)}function ki(Ne){var we,di;if(!et||!k||!S||pt&&It(Ne)!==k)return;bt&&(S.getCanvas().style.cursor=bt);let je=Ne.features??[];t(6,Le=je[0]??null);let ot=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id;at("mouseenter",{event:Ne,map:S,clusterId:ot,layer:k,source:a,features:je})}function yi(Ne){var we,di,Ve;if(!et||!S)return;if(pt&&It(Ne)!==k){t(6,Le=null),Je&&Zt!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:j,id:Zt},{hover:!1}),Zt=void 0);return}S.getCanvas().style.cursor=bt;let je=Ne.features??[],ot=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,kt=(Ve=je[0])==null?void 0:Ve.id;kt!==Zt&&(Je&&(Zt!==void 0&&(S==null||S.setFeatureState({source:a,id:Zt,sourceLayer:j},{hover:!1})),S==null||S.setFeatureState({source:a,id:kt,sourceLayer:j},{hover:!0})),Zt=kt,t(6,Le=je[0]??null)),at("mousemove",{event:Ne,map:S,clusterId:ot,layer:k,source:a,features:je})}function Pi(Ne){if(!(!et||!k||!S)){if(bt&&(S.getCanvas().style.cursor=""),t(6,Le=null),Je&&Zt!==void 0){const je={source:a,id:Zt,sourceLayer:j};S==null||S.setFeatureState(je,{hover:!1}),Zt=void 0}at("mouseleave",{map:S,layer:k,source:a})}}let ut=!0;function At(Ne){S&&(S.off("click",Ne,hi),S.off("dblclick",Ne,hi),S.off("contextmenu",Ne,hi),S.off("mouseenter",Ne,ki),S.off("mousemove",Ne,yi),S.off("mouseleave",Ne,Pi))}return Jn(()=>{S&&k&&At(k)}),o.$$set=Ne=>{"id"in Ne&&t(7,B=Ne.id),"source"in Ne&&t(8,O=Ne.source),"sourceLayer"in Ne&&t(9,j=Ne.sourceLayer),"beforeId"in Ne&&t(10,V=Ne.beforeId),"beforeLayerType"in Ne&&t(11,se=Ne.beforeLayerType),"type"in Ne&&t(12,ce=Ne.type),"paint"in Ne&&t(13,Z=Ne.paint),"layout"in Ne&&t(14,Y=Ne.layout),"filter"in Ne&&t(15,ye=Ne.filter),"applyToClusters"in Ne&&t(16,Oe=Ne.applyToClusters),"minzoom"in Ne&&t(17,ne=Ne.minzoom),"maxzoom"in Ne&&t(18,ve=Ne.maxzoom),"manageHoverState"in Ne&&t(19,Je=Ne.manageHoverState),"hovered"in Ne&&t(6,Le=Ne.hovered),"interactive"in Ne&&t(20,et=Ne.interactive),"hoverCursor"in Ne&&t(21,bt=Ne.hoverCursor),"eventsIfTopMost"in Ne&&t(22,pt=Ne.eventsIfTopMost),"$$scope"in Ne&&t(35,D=Ne.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,i=Rw(Oe)),o.$$.dirty[0]&1073774592&&t(24,l=Dw("all",i,ye)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=ne??z),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,d=ve??A),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,a=O||E),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&S&&k!==B&&a){k&&(At(k),ti.delete(k));let Ne=V;if(!V&&se){let je=S.getStyle().layers,ot=typeof se=="function"?se:we=>we.type===se,kt=je==null?void 0:je.find(ot);kt&&(Ne=kt.id)}Tt(Nt,k=B,k),S.addLayer(Oa({id:k,type:ce,source:a,"source-layer":j,filter:l,paint:Z,layout:Y,minzoom:u,maxzoom:d}),Ne),t(23,ut=!0),S.on("click",k,hi),S.on("dblclick",k,hi),S.on("contextmenu",k,hi),S.on("mouseenter",k,ki),S.on("mousemove",k,yi),S.on("mouseleave",k,Pi)}o.$$.dirty[0]&1048577&&k&&ti.set(k,{interactive:et}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,_=k?Rg((Ne,je)=>{S!=null&&S.style._loaded?S.setPaintProperty(k,Ne,je):S==null||S.once("styledata",()=>S==null?void 0:S.setPaintProperty(k,Ne,je))}):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,v=k?Rg((Ne,je)=>{S!=null&&S.style._loaded?S.setLayoutProperty(k,Ne,je):S==null||S.once("styledata",()=>S==null?void 0:S.setLayoutProperty(k,Ne,je))}):void 0),o.$$.dirty[0]&268443648&&(_==null||_(Z)),o.$$.dirty[0]&134234112&&(v==null||v(Y)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,d)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&k&&(ut?t(23,ut=!1):S==null||S.setFilter(k,l))},[k,Xt,ni,Nt,zt,Yt,Le,B,O,j,V,se,ce,Z,Y,ye,Oe,ne,ve,Je,et,bt,pt,ut,l,d,u,v,_,a,i,S,E,A,z,D,R]}let Pd=class extends qt{constructor(e){super(),$t(this,e,Ow,Fw,Bt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function Nw(o){let e;const t=o[16].default,i=Bi(t,o,o[24],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16777216)&&Oi(i,t,l,l[24],e?Fi(t,l[24],u,null):Ni(l[24]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function jw(o){let e,t,i;function l(d){o[17](d)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[Nw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Pd({props:u}),Ki.push(()=>Gr(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Zr(()=>t=!1)),e.$set(_)},i(d){i||(Q(e.$$.fragment,d),i=!0)},o(d){re(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function Uw(o,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=sc("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{applyToClusters:A=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:B=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:j=!1}=e,{interactive:V=!0}=e;function se(ve){O=ve,t(0,O)}function ce(ve){ui.call(this,o,ve)}function Z(ve){ui.call(this,o,ve)}function Y(ve){ui.call(this,o,ve)}function ye(ve){ui.call(this,o,ve)}function Oe(ve){ui.call(this,o,ve)}function ne(ve){ui.call(this,o,ve)}return o.$$set=ve=>{"id"in ve&&t(1,u=ve.id),"source"in ve&&t(2,d=ve.source),"sourceLayer"in ve&&t(3,a=ve.sourceLayer),"beforeId"in ve&&t(4,_=ve.beforeId),"beforeLayerType"in ve&&t(5,v=ve.beforeLayerType),"paint"in ve&&t(6,k=ve.paint),"layout"in ve&&t(7,S=ve.layout),"filter"in ve&&t(8,E=ve.filter),"applyToClusters"in ve&&t(9,A=ve.applyToClusters),"minzoom"in ve&&t(10,z=ve.minzoom),"maxzoom"in ve&&t(11,R=ve.maxzoom),"hoverCursor"in ve&&t(12,D=ve.hoverCursor),"manageHoverState"in ve&&t(13,B=ve.manageHoverState),"hovered"in ve&&t(0,O=ve.hovered),"eventsIfTopMost"in ve&&t(14,j=ve.eventsIfTopMost),"interactive"in ve&&t(15,V=ve.interactive),"$$scope"in ve&&t(24,l=ve.$$scope)},[O,u,d,a,_,v,k,S,E,A,z,R,D,B,j,V,i,se,ce,Z,Y,ye,Oe,ne,l]}let Op=class extends qt{constructor(e){super(),$t(this,e,Uw,jw,Bt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function Vw(o){let e;const t=o[15].default,i=Bi(t,o,o[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Oi(i,t,l,l[23],e?Fi(t,l[23],u,null):Ni(l[23]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function $w(o){let e,t,i;function l(d){o[16](d)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[Vw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Pd({props:u}),Ki.push(()=>Gr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Zr(()=>t=!1)),e.$set(_)},i(d){i||(Q(e.$$.fragment,d),i=!0)},o(d){re(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function qw(o,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=sc("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:j=!0}=e;function V(ne){B=ne,t(0,B)}function se(ne){ui.call(this,o,ne)}function ce(ne){ui.call(this,o,ne)}function Z(ne){ui.call(this,o,ne)}function Y(ne){ui.call(this,o,ne)}function ye(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,d=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,v=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,E=ne.filter),"minzoom"in ne&&t(9,A=ne.minzoom),"maxzoom"in ne&&t(10,z=ne.maxzoom),"hoverCursor"in ne&&t(11,R=ne.hoverCursor),"manageHoverState"in ne&&t(12,D=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,O=ne.eventsIfTopMost),"interactive"in ne&&t(14,j=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,d,a,_,v,k,S,E,A,z,R,D,O,j,i,V,se,ce,Z,Y,ye,Oe,l]}let Es=class extends qt{constructor(e){super(),$t(this,e,qw,$w,Bt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function Zw(o,e,t){let i;const{map:l}=ac();lt(o,l,_=>t(4,i=_));let{position:u="top-left"}=e,{container:d=void 0}=e,a=null;return Jn(()=>{i!=null&&i.loaded()&&a&&i.removeControl(a)}),o.$$set=_=>{"position"in _&&t(1,u=_.position),"container"in _&&t(2,d=_.container)},o.$$.update=()=>{if(o.$$.dirty&30&&i&&!a){let _;typeof d=="string"?_=document.querySelector(d)??void 0:_=d,t(3,a=new eo.FullscreenControl({container:_})),i.addControl(a,u)}},[l,u,d,a,i]}class Gw extends qt{constructor(e){super(),$t(this,e,Zw,null,Bt,{position:1,container:2})}}function Ww(o,e,t,i,l){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const d=()=>{i(e)&&(o.addSource(e,t),l())};if(u){const a=()=>{e&&(o.getSource(e)?setTimeout(a,1):d())};a()}else d()}function Hw(o,e,t){Ky().then(()=>{let i=Ar(o);if(!i)return;i.getSource(e)===t&&i.removeSource(e)})}function Og(o){let e=o[0],t,i,l=Ng(o);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),le(u,t,d),i=!0},p(u,d){d&1&&Bt(e,e=u[0])?(gi(),re(l,1,1,Lt),_i(),l=Ng(u),l.c(),Q(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(Q(l),i=!0)},o(u){re(l),i=!1},d(u){u&&ae(t),l.d(u)}}}function Ng(o){let e;const t=o[19].default,i=Bi(t,o,o[18],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&262144)&&Oi(i,t,l,l[18],e?Fi(t,l[18],u,null):Ni(l[18]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function Xw(o){let e,t,i=o[0]&&Og(o);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),le(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&Q(i,1)):(i=Og(l),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(l)}}}function Kw(o,e,t){let i,l,u,{$$slots:d={},$$scope:a}=e,{id:_=sc("geojson")}=e,{data:v}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:E=void 0}=e,{lineMetrics:A=void 0}=e,{cluster:z=void 0}=e,{maxzoom:R=void 0}=e,{attribution:D=void 0}=e,{buffer:B=void 0}=e,{tolerance:O=void 0}=e;const{map:j,cluster:V,self:se}=Lw();lt(o,j,Y=>t(17,l=Y)),lt(o,V,Y=>t(20,u=Y)),lt(o,se,Y=>t(0,i=Y));let ce,Z=!0;return Jn(()=>{i&&ce&&l&&(Hw(j,i,ce),Tt(se,i=null,i),t(15,ce=void 0))}),o.$$set=Y=>{"id"in Y&&t(4,_=Y.id),"data"in Y&&t(5,v=Y.data),"generateId"in Y&&t(6,k=Y.generateId),"promoteId"in Y&&t(7,S=Y.promoteId),"filter"in Y&&t(8,E=Y.filter),"lineMetrics"in Y&&t(9,A=Y.lineMetrics),"cluster"in Y&&t(10,z=Y.cluster),"maxzoom"in Y&&t(11,R=Y.maxzoom),"attribution"in Y&&t(12,D=Y.attribution),"buffer"in Y&&t(13,B=Y.buffer),"tolerance"in Y&&t(14,O=Y.tolerance),"$$scope"in Y&&t(18,a=Y.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&Tt(V,u=z,u),o.$$.dirty&196593&&l&&i!==_&&(Tt(se,i=_,i),Ww(l,i,Oa({type:"geojson",data:v,filter:E,lineMetrics:A,generateId:k,promoteId:S,cluster:!!z,clusterMinPoints:z==null?void 0:z.minPoints,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius,clusterProperties:z==null?void 0:z.properties,maxzoom:R,attribution:D,buffer:B,tolerance:O}),Y=>l&&Y===i,()=>{i&&(t(15,ce=l==null?void 0:l.getSource(i)),t(16,Z=!0))})),o.$$.dirty&131088&&(l==null||l.on("style.load",()=>{t(15,ce=l==null?void 0:l.getSource(_))})),o.$$.dirty&98336&&ce&&(Z?t(16,Z=!1):ce.setData(v)),o.$$.dirty&33792&&(ce==null||ce.setClusterOptions(Oa({cluster:!!z,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius})))},[i,j,V,se,_,v,k,S,E,A,z,R,D,B,O,ce,Z,l,a,d]}let cr=class extends qt{constructor(e){super(),$t(this,e,Kw,Xw,Bt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function Jw(o,e,t){let i;const{map:l}=ac();lt(o,l,E=>t(8,i=E));let{position:u="top-left"}=e,{positionOptions:d=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:_=!1}=e,{showAccuracyCircle:v=!0}=e,{showUserLocation:k=!0}=e,{control:S=null}=e;return Jn(()=>{i!=null&&i.loaded()&&S&&i.removeControl(S)}),o.$$set=E=>{"position"in E&&t(2,u=E.position),"positionOptions"in E&&t(3,d=E.positionOptions),"fitBoundsOptions"in E&&t(4,a=E.fitBoundsOptions),"trackUserLocation"in E&&t(5,_=E.trackUserLocation),"showAccuracyCircle"in E&&t(6,v=E.showAccuracyCircle),"showUserLocation"in E&&t(7,k=E.showUserLocation),"control"in E&&t(1,S=E.control)},o.$$.update=()=>{o.$$.dirty&510&&i&&!S&&(t(1,S=new eo.GeolocateControl({positionOptions:d,fitBoundsOptions:a,trackUserLocation:_,showAccuracyCircle:v,showUserLocation:k})),i.addControl(S,u))},[l,S,u,d,a,_,v,k,i]}class Yw extends qt{constructor(e){super(),$t(this,e,Jw,null,Bt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function Qw(o){let e;const t=o[15].default,i=Bi(t,o,o[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Oi(i,t,l,l[23],e?Fi(t,l[23],u,null):Ni(l[23]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function ex(o){let e,t,i;function l(d){o[16](d)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[Qw]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Pd({props:u}),Ki.push(()=>Gr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Zr(()=>t=!1)),e.$set(_)},i(d){i||(Q(e.$$.fragment,d),i=!0)},o(d){re(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function tx(o,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=sc("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:j=!0}=e;function V(ne){B=ne,t(0,B)}function se(ne){ui.call(this,o,ne)}function ce(ne){ui.call(this,o,ne)}function Z(ne){ui.call(this,o,ne)}function Y(ne){ui.call(this,o,ne)}function ye(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,d=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,v=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,E=ne.filter),"minzoom"in ne&&t(9,A=ne.minzoom),"maxzoom"in ne&&t(10,z=ne.maxzoom),"hoverCursor"in ne&&t(11,R=ne.hoverCursor),"manageHoverState"in ne&&t(12,D=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,O=ne.eventsIfTopMost),"interactive"in ne&&t(14,j=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,d,a,_,v,k,S,E,A,z,R,D,O,j,i,V,se,ce,Z,Y,ye,Oe,l]}let Wr=class extends qt{constructor(e){super(),$t(this,e,tx,ex,Bt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function ix(o,e,t){let i;const l=ns();let{layer:u=void 0}=e;const{map:d}=ac();lt(o,d,k=>t(2,i=k));function a(k){l(k.type,{...k,map:d})}const _=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],v=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return Jn(()=>{if(i)if(u)for(const k of _)i.off(k,u,a);else for(const k of v)i.off(k,a)}),o.$$set=k=>{"layer"in k&&t(1,u=k.layer)},o.$$.update=()=>{if(o.$$.dirty&6&&i)if(u)for(const k of _)i.on(k,u,a);else for(const k of v)i.on(k,a)},[d,u,i]}class w0 extends qt{constructor(e){super(),$t(this,e,ix,null,Bt,{layer:1})}}function nx(o){let e=o.getCenter(),t=Math.round(o.getZoom()*100)/100,i=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),l=Math.pow(10,i),u=Math.round(e.lat*l)/l,d=Math.round(e.lng*l)/l,a=`${t}/${u}/${d}`,_=o.getBearing(),v=o.getPitch();return(_||v)&&(a+=`/${Math.round(_*10)/10}`),v&&(a+=`/${Math.round(v)}`),`#${a}`}function rx(o){return o.replace("#","").split("/").map(parseFloat)}var Ul=Np;function Np(o,e){return o===e||o!==o&&e!==e?!0:typeof o!=typeof e||{}.toString.call(o)!={}.toString.call(e)||o!==Object(o)||!o?!1:Array.isArray(o)?jg(o,e):{}.toString.call(o)=="[object Set]"?jg(Array.from(o),Array.from(e)):{}.toString.call(o)=="[object Object]"?sx(o,e):ox(o,e)}function ox(o,e){return o.toString()===e.toString()}function jg(o,e){var t=o.length;if(t!=e.length)return!1;for(var i=0;i<t;i++)if(!Np(o[i],e[i]))return!1;return!0}function sx(o,e){var t=Object.keys(o),i=t.length;if(i!=Object.keys(e).length)return!1;for(var l=0;l<i;l++){var u=t[l];if(!(e.hasOwnProperty(u)&&Np(o[u],e[u])))return!1}return!0}function ax(o,e,t){let i;const{map:l}=ac();lt(o,l,k=>t(6,i=k));let{position:u="top-left"}=e,{showCompass:d=!0}=e,{showZoom:a=!0}=e,{visualizePitch:_=!1}=e,v=null;return Jn(()=>{i!=null&&i.loaded()&&v&&i.removeControl(v)}),o.$$set=k=>{"position"in k&&t(1,u=k.position),"showCompass"in k&&t(2,d=k.showCompass),"showZoom"in k&&t(3,a=k.showZoom),"visualizePitch"in k&&t(4,_=k.visualizePitch)},o.$$.update=()=>{o.$$.dirty&126&&i&&!v&&(t(5,v=new eo.NavigationControl({showCompass:d,showZoom:a,visualizePitch:_})),i.addControl(v,u))},[l,u,d,a,_,v,i]}class x0 extends qt{constructor(e){super(),$t(this,e,ax,null,Bt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function lx(o,e,t){let i;const{map:l}=ac();lt(o,l,v=>t(5,i=v));let{position:u="bottom-left"}=e,{maxWidth:d=void 0}=e,{unit:a="metric"}=e,_=null;return Jn(()=>{i!=null&&i.loaded()&&_&&i.removeControl(_)}),o.$$set=v=>{"position"in v&&t(1,u=v.position),"maxWidth"in v&&t(2,d=v.maxWidth),"unit"in v&&t(3,a=v.unit)},o.$$.update=()=>{o.$$.dirty&62&&i&&!_&&(t(4,_=new eo.ScaleControl({maxWidth:d,unit:a})),i.addControl(_,u))},[l,u,d,a,_,i]}class k0 extends qt{constructor(e){super(),$t(this,e,lx,null,Bt,{position:1,maxWidth:2,unit:3})}}const{window:cx}=Cd,ux=o=>({map:o[0]&16,loadedImages:o[0]&32,allImagesLoaded:o[0]&64}),Ug=o=>({map:o[4],loadedImages:o[5],allImagesLoaded:o[6]});function Vg(o){let e,t,i=o[3]&&$g(o);const l=o[46].default,u=Bi(l,o,o[45],Ug);return{c(){i&&i.c(),e=ze(),u&&u.c()},m(d,a){i&&i.m(d,a),le(d,e,a),u&&u.m(d,a),t=!0},p(d,a){d[3]?i?(i.p(d,a),a[0]&8&&Q(i,1)):(i=$g(d),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i()),u&&u.p&&(!t||a[0]&112|a[1]&16384)&&Oi(u,l,d,d[45],t?Fi(l,d[45],a,ux):Ni(d[45]),Ug)},i(d){t||(Q(i),Q(u,d),t=!0)},o(d){re(i),re(u,d),t=!1},d(d){d&&ae(e),i&&i.d(d),u&&u.d(d)}}}function $g(o){let e,t,i,l,u,d,a,_;return e=new x0({props:{position:o[7]}}),i=new Yw({props:{position:o[7],fitBoundsOptions:{maxZoom:12}}}),u=new Gw({props:{position:o[7]}}),a=new k0({props:{position:o[7]}}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment),d=ze(),Ie(a.$$.fragment)},m(v,k){Ee(e,v,k),le(v,t,k),Ee(i,v,k),le(v,l,k),Ee(u,v,k),le(v,d,k),Ee(a,v,k),_=!0},p(v,k){const S={};k[0]&128&&(S.position=v[7]),e.$set(S);const E={};k[0]&128&&(E.position=v[7]),i.$set(E);const A={};k[0]&128&&(A.position=v[7]),u.$set(A);const z={};k[0]&128&&(z.position=v[7]),a.$set(z)},i(v){_||(Q(e.$$.fragment,v),Q(i.$$.fragment,v),Q(u.$$.fragment,v),Q(a.$$.fragment,v),_=!0)},o(v){re(e.$$.fragment,v),re(i.$$.fragment,v),re(u.$$.fragment,v),re(a.$$.fragment,v),_=!1},d(v){v&&(ae(t),ae(l),ae(d)),Me(e,v),Me(i,v),Me(u,v),Me(a,v)}}}function hx(o){let e,t,i,l,u,d=o[4]&&o[0]&&Vg(o);return{c(){e=oe("div"),d&&d.c(),ke(e,"class",t=gd(o[2])+" svelte-p00lfq"),ke(e,"data-testid","map-container"),lr(e,"expand-map",!o[2])},m(a,_){le(a,e,_),d&&d.m(e,null),o[47](e),i=!0,l||(u=[xt(cx,"hashchange",o[11]),ip(o[10].call(null,e))],l=!0)},p(a,_){a[4]&&a[0]?d?(d.p(a,_),_[0]&17&&Q(d,1)):(d=Vg(a),d.c(),Q(d,1),d.m(e,null)):d&&(gi(),re(d,1,1,()=>{d=null}),_i()),(!i||_[0]&4&&t!==(t=gd(a[2])+" svelte-p00lfq"))&&ke(e,"class",t),(!i||_[0]&4)&&lr(e,"expand-map",!a[2])},i(a){i||(Q(d),i=!0)},o(a){re(d),i=!1},d(a){a&&ae(e),d&&d.d(),o[47](null),l=!1,on(u)}}}function dx(o,e,t){let i,l,u,d,{$$slots:a={},$$scope:_}=e,{map:v=null}=e,{mapContainer:k=void 0}=e,{class:S=void 0}=e,{style:E}=e,{diffStyleUpdates:A=!1}=e,{center:z=void 0}=e,{zoom:R=void 0}=e,{pitch:D=0}=e,{bearing:B=0}=e,{bounds:O=void 0}=e,{hash:j=!1}=e,{updateHash:V=Ve=>{window.history.replaceState(window.history.state,"",Ve)}}=e,{loaded:se=!1}=e,{minZoom:ce=0}=e,{maxZoom:Z=22}=e,{minPitch:Y=0}=e,{maxPitch:ye=60}=e,{renderWorldCopies:Oe=void 0}=e,{dragPan:ne=void 0}=e,{dragRotate:ve=void 0}=e,{pitchWithRotate:Je=void 0}=e,{antialias:Le=void 0}=e,{zoomOnDoubleClick:et=!0}=e,{locale:bt=void 0}=e,{interactive:pt=!0}=e,{attributionControl:at=!0}=e,{cooperativeGestures:Xt=!1}=e,{preserveDrawingBuffer:ni=!1}=e,{maxBounds:Nt=void 0}=e,{images:zt=[]}=e,{standardControls:Yt=!1}=e,{filterLayers:It=void 0}=e,{transformRequest:ti=void 0}=e;const Zt=ns(),{map:hi,loadedImages:ki}=Iw();lt(o,hi,Ve=>t(4,u=Ve)),lt(o,ki,Ve=>t(5,d=Ve));let yi=new Set;async function Pi(Ve,We=!1){if(u&&!(!u.loaded()&&!We))if("url"in Ve){yi.add(Ve.id);try{let St=await u.loadImage(Ve.url);u==null||u.addImage(Ve.id,St.data,Ve.options),d.add(Ve.id),ki.set(d)}catch(St){Zt("error",St)}finally{yi.delete(Ve.id)}}else u.addImage(Ve.id,Ve.data,Ve.options),d.add(Ve.id),ki.set(d)}let ut,At,Ne,je;function ot(Ve){return we(),Tt(hi,u=new eo.Map(Oa({container:Ve,style:E,locale:bt,center:z,zoom:R,pitch:D,bearing:B,minZoom:ce,maxZoom:Z,minPitch:Y,maxPitch:ye,renderWorldCopies:Oe,dragPan:ne,dragRotate:ve,pitchWithRotate:Je,antialias:Le,interactive:pt,preserveDrawingBuffer:ni,maxBounds:Nt,bounds:O,attributionControl:at,transformRequest:ti,cooperativeGestures:Xt})),u),u.on("load",We=>{We.target.getContainer().setAttribute("data-testid","map"),We.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,se=!0),Zt("load",u)}),u.on("error",We=>Zt("error",{...We,map:u})),u.on("movestart",We=>Zt("movestart",{...We,map:u})),u.on("moveend",We=>{if(t(12,z=We.target.getCenter()),t(13,R=We.target.getZoom()),t(14,D=We.target.getPitch()),t(15,B=We.target.getBearing()),t(16,O=We.target.getBounds()),Zt("moveend",{...We,map:u}),j){let St=new URL(window.location.href.replace(/(#.+)?$/,nx(u)));V(St)}}),u.on("click",We=>Zt("click",{...We,map:u})),u.on("dblclick",We=>Zt("dblclick",{...We,map:u})),u.on("contextmenu",We=>Zt("contextmenu",{...We,map:u})),u.on("zoomstart",We=>Zt("zoomstart",{...We,map:u})),u.on("zoom",We=>{Zt("zoom",{...We,map:u})}),u.on("zoomend",We=>{Zt("zoomend",{...We,map:u})}),u.on("style.load",()=>{if(u){const We=u.getStyle();if(t(42,ut=We.layers.map(St=>St.id)),t(43,At=Object.keys(We.sources)),je)for(const[St,vn]of Object.entries(je))u.addSource(St,vn);if(Ne)for(const St of Ne)u.addLayer(St);for(const St of zt)Pi(St,!0)}}),u.on("styledata",We=>{if(u&&It){const St=u.getStyle().layers;if(St)for(let vn of St)It(vn)||u.setLayoutProperty(vn.id,"visibility","none")}Zt("styledata",{...We,map:u})}),{destroy(){t(0,se=!1),u==null||u.remove(),Tt(hi,u=null,u)}}}let kt=E;function we(){if(j){let Ve=rx(window.location.hash);Ve.length>=3&&(t(13,R=Ve[0]),t(12,z=[Ve[2],Ve[1]])),Ve.length==5&&(t(15,B=Ve[3]),t(14,D=Ve[4]))}}function di(Ve){Ki[Ve?"unshift":"push"](()=>{k=Ve,t(1,k)})}return o.$$set=Ve=>{"map"in Ve&&t(17,v=Ve.map),"mapContainer"in Ve&&t(1,k=Ve.mapContainer),"class"in Ve&&t(2,S=Ve.class),"style"in Ve&&t(18,E=Ve.style),"diffStyleUpdates"in Ve&&t(19,A=Ve.diffStyleUpdates),"center"in Ve&&t(12,z=Ve.center),"zoom"in Ve&&t(13,R=Ve.zoom),"pitch"in Ve&&t(14,D=Ve.pitch),"bearing"in Ve&&t(15,B=Ve.bearing),"bounds"in Ve&&t(16,O=Ve.bounds),"hash"in Ve&&t(20,j=Ve.hash),"updateHash"in Ve&&t(21,V=Ve.updateHash),"loaded"in Ve&&t(0,se=Ve.loaded),"minZoom"in Ve&&t(22,ce=Ve.minZoom),"maxZoom"in Ve&&t(23,Z=Ve.maxZoom),"minPitch"in Ve&&t(24,Y=Ve.minPitch),"maxPitch"in Ve&&t(25,ye=Ve.maxPitch),"renderWorldCopies"in Ve&&t(26,Oe=Ve.renderWorldCopies),"dragPan"in Ve&&t(27,ne=Ve.dragPan),"dragRotate"in Ve&&t(28,ve=Ve.dragRotate),"pitchWithRotate"in Ve&&t(29,Je=Ve.pitchWithRotate),"antialias"in Ve&&t(30,Le=Ve.antialias),"zoomOnDoubleClick"in Ve&&t(31,et=Ve.zoomOnDoubleClick),"locale"in Ve&&t(32,bt=Ve.locale),"interactive"in Ve&&t(33,pt=Ve.interactive),"attributionControl"in Ve&&t(34,at=Ve.attributionControl),"cooperativeGestures"in Ve&&t(35,Xt=Ve.cooperativeGestures),"preserveDrawingBuffer"in Ve&&t(36,ni=Ve.preserveDrawingBuffer),"maxBounds"in Ve&&t(37,Nt=Ve.maxBounds),"images"in Ve&&t(38,zt=Ve.images),"standardControls"in Ve&&t(3,Yt=Ve.standardControls),"filterLayers"in Ve&&t(39,It=Ve.filterLayers),"transformRequest"in Ve&&t(40,ti=Ve.transformRequest),"$$scope"in Ve&&t(45,_=Ve.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&8&&t(7,i=typeof Yt=="boolean"?void 0:Yt),o.$$.dirty[0]&16&&t(17,v=u),o.$$.dirty[0]&786448|o.$$.dirty[1]&14336&&u&&!Ul(E,kt)){const Ve=u.getStyle();if(ut&&(Ne=Ve.layers.filter(We=>!ut.includes(We.id))),At){const We=Object.keys(Ve.sources).filter(St=>!At.includes(St));je={};for(const St of We)je[St]=Ve.sources[St]}t(44,kt=E),u.setStyle(E,{diff:A}),Tt(ki,d=new Set,d),t(41,yi=new Set)}if(o.$$.dirty[0]&49|o.$$.dirty[1]&1152&&se&&u!=null&&u.loaded())for(let Ve of zt)!d.has(Ve.id)&&!yi.has(Ve.id)&&!u.hasImage(Ve.id)&&Pi(Ve);if(o.$$.dirty[0]&32|o.$$.dirty[1]&128&&t(6,l=zt.every(Ve=>d.has(Ve.id))),o.$$.dirty[0]&61456&&u){let Ve={};z!=null&&!Ul(z,u==null?void 0:u.getCenter())&&(Ve.center=z),R!=null&&!Ul(R,u==null?void 0:u.getZoom())&&(Ve.zoom=R),B!=null&&!Ul(B,u==null?void 0:u.getBearing())&&(Ve.bearing=B),D!=null&&!Ul(D,u==null?void 0:u.getPitch())&&(Ve.pitch=D),Object.keys(Ve).length&&u.easeTo(Ve)}o.$$.dirty[0]&65552&&O&&!Ul(O,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(O)),o.$$.dirty[0]&16|o.$$.dirty[1]&1&&(et?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[se,k,S,Yt,u,d,l,i,hi,ki,ot,we,z,R,D,B,O,v,E,A,j,V,ce,Z,Y,ye,Oe,ne,ve,Je,Le,et,bt,pt,at,Xt,ni,Nt,zt,It,ti,yi,ut,At,kt,_,a,di]}class fx extends qt{constructor(e){super(),$t(this,e,dx,hx,Bt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const px=o=>({marker:o&8}),qg=o=>({marker:o[3]});function mx(o){let e,t,i,l,u,d,a;const _=o[19].default,v=Bi(_,o,o[18],qg);return{c(){e=oe("div"),v&&v.c(),ke(e,"tabindex",t=o[1]?0:void 0),ke(e,"role",i=o[1]?"button":void 0),nn(e,"z-index",o[2])},m(k,S){le(k,e,S),v&&v.m(e,null),u=!0,d||(a=[ip(o[7].call(null,e)),ip(l=gx.call(null,e,o[0])),xt(e,"click",qf(o[20])),xt(e,"dblclick",qf(o[21])),xt(e,"contextmenu",qf(Cp(o[22]))),xt(e,"mouseenter",o[23]),xt(e,"mouseleave",o[24]),xt(e,"mousemove",o[25]),xt(e,"keydown",o[8])],d=!0)},p(k,[S]){v&&v.p&&(!u||S&262152)&&Oi(v,_,k,k[18],u?Fi(_,k[18],S,px):Ni(k[18]),qg),(!u||S&2&&t!==(t=k[1]?0:void 0))&&ke(e,"tabindex",t),(!u||S&2&&i!==(i=k[1]?"button":void 0))&&ke(e,"role",i),l&&Yl(l.update)&&S&1&&l.update.call(null,k[0]),S&4&&nn(e,"z-index",k[2])},i(k){u||(Q(v,k),u=!0)},o(k){re(v,k),u=!1},d(k){k&&ae(e),v&&v.d(k),d=!1,on(a)}}}function gx(o,e){const t=o.className;function i(l){l?o.className=`${t} ${l}`:o.className=t}return i(e),{update:i}}function _x(o,e,t){let i,l,u,{$$slots:d={},$$scope:a}=e,{marker:_=void 0}=e,{lngLat:v}=e,{class:k=void 0}=e,{interactive:S=!0}=e,{asButton:E=!1}=e,{draggable:A=!1}=e,{feature:z=null}=e,{offset:R=void 0}=e,{zIndex:D=void 0}=e,{rotation:B=0}=e,{opacity:O=1}=e;const j=ns(),{map:V,layerEvent:se,self:ce,markerClickManager:Z}=Pw();lt(o,V,at=>t(27,u=at)),lt(o,se,at=>t(26,i=at)),lt(o,ce,at=>t(3,l=at));function Y(at){Tt(ce,l=new eo.Marker({element:at,rotation:B,draggable:A,offset:R,opacity:O.toString()}).setLngLat(v).addTo(u),l),t(11,_=l);const Xt=()=>ne("dragstart"),ni=()=>{ye(),ne("drag")},Nt=()=>{ye(),ne("dragend")};return A&&(l.on("dragstart",Xt),l.on("drag",ni),l.on("dragend",Nt)),{destroy(){A&&(l==null||l.off("dragstart",Xt),l==null||l.off("drag",ni),l==null||l.off("dragend",Nt)),t(11,_=void 0),l==null||l.remove()}}}function ye(){let at=l==null?void 0:l.getLngLat();at&&(Array.isArray(v)?t(10,v=[at.lng,at.lat]):v&&"lon"in v?t(10,v={lon:at.lng,lat:at.lat}):t(10,v=at))}function Oe(at){at.key===" "&&(at.preventDefault(),at.stopPropagation(),ne("click"))}function ne(at){if(!S)return;let Xt=l==null?void 0:l.getLngLat();if(!Xt)return;const ni=[Xt.lng,Xt.lat];let Nt={map:u,marker:l,lngLat:ni,features:[{type:"Feature",properties:(z==null?void 0:z.properties)??{},geometry:{type:"Point",coordinates:ni}}]};(at==="click"||at==="contextmenu")&&Z.handleClick(Nt),Tt(se,i={...Nt,layerType:"marker",type:at},i),j(at,Nt)}const ve=()=>ne("click"),Je=()=>ne("dblclick"),Le=()=>{ne("contextmenu")},et=()=>{ne("mouseenter")},bt=()=>{ne("mouseleave")},pt=()=>ne("mousemove");return o.$$set=at=>{"marker"in at&&t(11,_=at.marker),"lngLat"in at&&t(10,v=at.lngLat),"class"in at&&t(0,k=at.class),"interactive"in at&&t(12,S=at.interactive),"asButton"in at&&t(1,E=at.asButton),"draggable"in at&&t(13,A=at.draggable),"feature"in at&&t(14,z=at.feature),"offset"in at&&t(15,R=at.offset),"zIndex"in at&&t(2,D=at.zIndex),"rotation"in at&&t(16,B=at.rotation),"opacity"in at&&t(17,O=at.opacity),"$$scope"in at&&t(18,a=at.$$scope)},o.$$.update=()=>{o.$$.dirty&1032&&(l==null||l.setLngLat(v)),o.$$.dirty&32776&&(l==null||l.setOffset(R??[0,0])),o.$$.dirty&65544&&(l==null||l.setRotation(B)),o.$$.dirty&131080&&(l==null||l.setOpacity(O.toString()))},[k,E,D,l,V,se,ce,Y,Oe,ne,v,_,S,A,z,R,B,O,a,d,ve,Je,Le,et,bt,pt]}class zd extends qt{constructor(e){super(),$t(this,e,_x,mx,Bt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}var Zu=Uint8Array,S0=Uint16Array,yx=Int32Array,vx=new Zu([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),bx=new Zu([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),T0=function(o,e){for(var t=new S0(31),i=0;i<31;++i)t[i]=e+=1<<o[i-1];for(var l=new yx(t[30]),i=1;i<30;++i)for(var u=t[i];u<t[i+1];++u)l[u]=u-t[i]<<5|i;return{b:t,r:l}},C0=T0(vx,2),wx=C0.b,xx=C0.r;wx[28]=258,xx[258]=28;T0(bx,0);var kx=new S0(32768);for(Ui=0;Ui<32768;++Ui)ys=(Ui&43690)>>1|(Ui&21845)<<1,ys=(ys&52428)>>2|(ys&13107)<<2,ys=(ys&61680)>>4|(ys&3855)<<4,kx[Ui]=((ys&65280)>>8|(ys&255)<<8)>>1;var ys,Ui,Dd=new Zu(288);for(Ui=0;Ui<144;++Ui)Dd[Ui]=8;var Ui;for(Ui=144;Ui<256;++Ui)Dd[Ui]=9;var Ui;for(Ui=256;Ui<280;++Ui)Dd[Ui]=7;var Ui;for(Ui=280;Ui<288;++Ui)Dd[Ui]=8;var Ui,Sx=new Zu(32);for(Ui=0;Ui<32;++Ui)Sx[Ui]=5;var Ui,Tx=new Zu(0),Cx=typeof TextDecoder<"u"&&new TextDecoder,Ex=0;try{Cx.decode(Tx,{stream:!0}),Ex=1}catch{}function Mx(o){let e;const t=o[16].default,i=Bi(t,o,o[24],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16777216)&&Oi(i,t,l,l[24],e?Fi(t,l[24],u,null):Ni(l[24]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function Ix(o){let e,t,i;function l(d){o[17](d)}let u={id:o[1],type:"symbol",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[Mx]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Pd({props:u}),Ki.push(()=>Gr(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Zr(()=>t=!1)),e.$set(_)},i(d){i||(Q(e.$$.fragment,d),i=!0)},o(d){re(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function Lx(o,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=sc("symbol")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k=void 0}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{applyToClusters:A=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:B=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:j=!1}=e,{interactive:V=!0}=e;function se(ve){O=ve,t(0,O)}function ce(ve){ui.call(this,o,ve)}function Z(ve){ui.call(this,o,ve)}function Y(ve){ui.call(this,o,ve)}function ye(ve){ui.call(this,o,ve)}function Oe(ve){ui.call(this,o,ve)}function ne(ve){ui.call(this,o,ve)}return o.$$set=ve=>{"id"in ve&&t(1,u=ve.id),"source"in ve&&t(2,d=ve.source),"sourceLayer"in ve&&t(3,a=ve.sourceLayer),"beforeId"in ve&&t(4,_=ve.beforeId),"beforeLayerType"in ve&&t(5,v=ve.beforeLayerType),"paint"in ve&&t(6,k=ve.paint),"layout"in ve&&t(7,S=ve.layout),"filter"in ve&&t(8,E=ve.filter),"applyToClusters"in ve&&t(9,A=ve.applyToClusters),"minzoom"in ve&&t(10,z=ve.minzoom),"maxzoom"in ve&&t(11,R=ve.maxzoom),"hoverCursor"in ve&&t(12,D=ve.hoverCursor),"manageHoverState"in ve&&t(13,B=ve.manageHoverState),"hovered"in ve&&t(0,O=ve.hovered),"eventsIfTopMost"in ve&&t(14,j=ve.eventsIfTopMost),"interactive"in ve&&t(15,V=ve.interactive),"$$scope"in ve&&t(24,l=ve.$$scope)},[O,u,d,a,_,v,k,S,E,A,z,R,D,B,j,V,i,se,ce,Z,Y,ye,Oe,ne,l]}class E0 extends qt{constructor(e){super(),$t(this,e,Lx,Ix,Bt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ax=Object.defineProperty,M0=o=>{throw TypeError(o)},Px=(o,e,t)=>e in o?Ax(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,ho=(o,e,t)=>Px(o,typeof e!="symbol"?e+"":e,t),I0=(o,e,t)=>e.has(o)||M0("Cannot "+t),Qn=(o,e,t)=>(I0(o,e,"read from private field"),t?t.call(o):e.get(o)),Zg=(o,e,t)=>e.has(o)?M0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(o):e.set(o,t),Gg=(o,e,t,i)=>(I0(o,e,"write to private field"),i?i.call(o,t):e.set(o,t),t);function mn(){}function zx(o,e){for(const t in e)o[t]=e[t];return o}function L0(o){return o()}function Wg(){return Object.create(null)}function Ls(o){o.forEach(L0)}function A0(o){return typeof o=="function"}function na(o,e){return o!=o?e==e:o!==e||o&&typeof o=="object"||typeof o=="function"}let nd;function Pr(o,e){return o===e?!0:(nd||(nd=document.createElement("a")),nd.href=e,o===nd.href)}function Dx(o){return Object.keys(o).length===0}function Rx(o,e,t,i){if(o){const l=P0(o,e,t,i);return o[0](l)}}function P0(o,e,t,i){return o[1]&&i?zx(t.ctx.slice(),o[1](i(e))):t.ctx}function Bx(o,e,t,i){if(o[2]&&i){const l=o[2](i(t));if(e.dirty===void 0)return l;if(typeof l=="object"){const u=[],d=Math.max(e.dirty.length,l.length);for(let a=0;a<d;a+=1)u[a]=e.dirty[a]|l[a];return u}return e.dirty|l}return e.dirty}function Fx(o,e,t,i,l,u){if(l){const d=P0(e,t,i,u);o.p(d,l)}}function Ox(o){if(o.ctx.length>32){const e=[],t=o.ctx.length/32;for(let i=0;i<t;i++)e[i]=-1;return e}return-1}function Hg(o){return o??""}function Ai(o,e){o.appendChild(e)}function yn(o,e,t){o.insertBefore(e,t||null)}function gn(o){o.parentNode&&o.parentNode.removeChild(o)}function Hi(o){return document.createElement(o)}function Uo(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function ea(o){return document.createTextNode(o)}function fo(){return ea(" ")}function Nx(){return ea("")}function qr(o,e,t,i){return o.addEventListener(e,t,i),()=>o.removeEventListener(e,t,i)}function jx(o){return function(e){return e.preventDefault(),o.call(this,e)}}function st(o,e,t){t==null?o.removeAttribute(e):o.getAttribute(e)!==t&&o.setAttribute(e,t)}function Ux(o){return Array.from(o.childNodes)}function Bu(o,e){e=""+e,o.data!==e&&(o.data=e)}function Xg(o,e){o.value=e??""}function Mo(o,e,t){o.classList.toggle(e,!!t)}function Vx(o,e,{bubbles:t=!1,cancelable:i=!1}={}){return new CustomEvent(o,{detail:e,bubbles:t,cancelable:i})}let Fu;function Eu(o){Fu=o}function z0(){if(!Fu)throw new Error("Function called outside component initialization");return Fu}function $x(o){z0().$$.on_destroy.push(o)}function qx(){const o=z0();return(e,t,{cancelable:i=!1}={})=>{const l=o.$$.callbacks[e];if(l){const u=Vx(e,t,{cancelable:i});return l.slice().forEach(d=>{d.call(o,u)}),!u.defaultPrevented}return!0}}function Kg(o,e){const t=o.$$.callbacks[e.type];t&&t.slice().forEach(i=>i.call(this,e))}const Wl=[],dp=[];let Kl=[];const Jg=[],Zx=Promise.resolve();let fp=!1;function Gx(){fp||(fp=!0,Zx.then(D0))}function pp(o){Kl.push(o)}const Xf=new Set;let Vl=0;function D0(){if(Vl!==0)return;const o=Fu;do{try{for(;Vl<Wl.length;){const e=Wl[Vl];Vl++,Eu(e),Wx(e.$$)}}catch(e){throw Wl.length=0,Vl=0,e}for(Eu(null),Wl.length=0,Vl=0;dp.length;)dp.pop()();for(let e=0;e<Kl.length;e+=1){const t=Kl[e];Xf.has(t)||(Xf.add(t),t())}Kl.length=0}while(Wl.length);for(;Jg.length;)Jg.pop()();fp=!1,Xf.clear(),Eu(o)}function Wx(o){if(o.fragment!==null){o.update(),Ls(o.before_update);const e=o.dirty;o.dirty=[-1],o.fragment&&o.fragment.p(o.ctx,e),o.after_update.forEach(pp)}}function Hx(o){const e=[],t=[];Kl.forEach(i=>o.indexOf(i)===-1?e.push(i):t.push(i)),t.forEach(i=>i()),Kl=e}const ud=new Set;let Ra;function hd(){Ra={r:0,c:[],p:Ra}}function dd(){Ra.r||Ls(Ra.c),Ra=Ra.p}function Wn(o,e){o&&o.i&&(ud.delete(o),o.i(e))}function ar(o,e,t,i){if(o&&o.o){if(ud.has(o))return;ud.add(o),Ra.c.push(()=>{ud.delete(o),i&&(t&&o.d(1),i())}),o.o(e)}else i&&i()}function Yg(o){return(o==null?void 0:o.length)!==void 0?o:Array.from(o)}function Xx(o,e){ar(o,1,1,()=>{e.delete(o.key)})}function Kx(o,e,t,i,l,u,d,a,_,v,k,S){let E=o.length,A=u.length,z=E;const R={};for(;z--;)R[o[z].key]=z;const D=[],B=new Map,O=new Map,j=[];for(z=A;z--;){const Z=S(l,u,z),Y=t(Z);let ye=d.get(Y);ye?j.push(()=>ye.p(Z,e)):(ye=v(Y,Z),ye.c()),B.set(Y,D[z]=ye),Y in R&&O.set(Y,Math.abs(z-R[Y]))}const V=new Set,se=new Set;function ce(Z){Wn(Z,1),Z.m(a,k),d.set(Z.key,Z),k=Z.first,A--}for(;E&&A;){const Z=D[A-1],Y=o[E-1],ye=Z.key,Oe=Y.key;Z===Y?(k=Z.first,E--,A--):B.has(Oe)?!d.has(ye)||V.has(ye)?ce(Z):se.has(Oe)?E--:O.get(ye)>O.get(Oe)?(se.add(ye),ce(Z)):(V.add(Oe),E--):(_(Y,d),E--)}for(;E--;){const Z=o[E];B.has(Z.key)||_(Z,d)}for(;A;)ce(D[A-1]);return Ls(j),D}function ta(o){o&&o.c()}function Ms(o,e,t){const{fragment:i,after_update:l}=o.$$;i&&i.m(e,t),pp(()=>{const u=o.$$.on_mount.map(L0).filter(A0);o.$$.on_destroy?o.$$.on_destroy.push(...u):Ls(u),o.$$.on_mount=[]}),l.forEach(pp)}function Is(o,e){const t=o.$$;t.fragment!==null&&(Hx(t.after_update),Ls(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function Jx(o,e){o.$$.dirty[0]===-1&&(Wl.push(o),Gx(),o.$$.dirty.fill(0)),o.$$.dirty[e/31|0]|=1<<e%31}function ra(o,e,t,i,l,u,d=null,a=[-1]){const _=Fu;Eu(o);const v=o.$$={fragment:null,ctx:[],props:u,update:mn,not_equal:l,bound:Wg(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(_?_.$$.context:[])),callbacks:Wg(),dirty:a,skip_bound:!1,root:e.target||_.$$.root};d&&d(v.root);let k=!1;if(v.ctx=t?t(o,e.props||{},(S,E,...A)=>{const z=A.length?A[0]:E;return v.ctx&&l(v.ctx[S],v.ctx[S]=z)&&(!v.skip_bound&&v.bound[S]&&v.bound[S](z),k&&Jx(o,S)),E}):[],v.update(),k=!0,Ls(v.before_update),v.fragment=i?i(v.ctx):!1,e.target){if(e.hydrate){const S=Ux(e.target);v.fragment&&v.fragment.l(S),S.forEach(gn)}else v.fragment&&v.fragment.c();e.intro&&Wn(o.$$.fragment),Ms(o,e.target,e.anchor),D0()}Eu(_)}class oa{constructor(){ho(this,"$$"),ho(this,"$$set")}$destroy(){Is(this,1),this.$destroy=mn}$on(e,t){if(!A0(t))return mn;const i=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return i.push(t),()=>{const l=i.indexOf(t);l!==-1&&i.splice(l,1)}}$set(e){this.$$set&&!Dx(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Yx="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Yx);function Qx(o){let e,t;return{c(){e=Uo("svg"),t=Uo("path"),st(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),st(e,"viewBox","0 0 14 14"),st(e,"width","13"),st(e,"height","13"),st(e,"class","svelte-en2qvf")},m(i,l){yn(i,e,l),Ai(e,t)},p:mn,i:mn,o:mn,d(i){i&&gn(e)}}}class R0 extends oa{constructor(e){super(),ra(this,e,null,Qx,na,{})}}function e2(o){let e,t;return{c(){e=Uo("svg"),t=Uo("path"),st(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),st(e,"viewBox","0 0 30 30"),st(e,"fill","none"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"class","svelte-d2loi5")},m(i,l){yn(i,e,l),Ai(e,t)},p:mn,i:mn,o:mn,d(i){i&&gn(e)}}}class B0 extends oa{constructor(e){super(),ra(this,e,null,e2,na,{})}}function t2(o){let e,t;return{c(){e=Hi("img"),Pr(e.src,t=o[3]+"area.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(i,l){yn(i,e,l)},p(i,l){l&8&&!Pr(e.src,t=i[3]+"area.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&gn(e)}}}function i2(o){let e,t;return{c(){e=Hi("img"),Pr(e.src,t=o[3]+"reverse.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(i,l){yn(i,e,l)},p(i,l){l&8&&!Pr(e.src,t=i[3]+"reverse.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&gn(e)}}}function n2(o){let e,t;return{c(){e=Hi("img"),Pr(e.src,t=o[3]+"poi.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(i,l){yn(i,e,l)},p(i,l){l&8&&!Pr(e.src,t=i[3]+"poi.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&gn(e)}}}function r2(o){let e,t;return{c(){e=Hi("img"),Pr(e.src,t=o[3]+"postal_code.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(i,l){yn(i,e,l)},p(i,l){l&8&&!Pr(e.src,t=i[3]+"postal_code.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&gn(e)}}}function o2(o){let e,t;return{c(){e=Hi("img"),Pr(e.src,t=o[3]+"street.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(i,l){yn(i,e,l)},p(i,l){l&8&&!Pr(e.src,t=i[3]+"street.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&gn(e)}}}function s2(o){let e,t;return{c(){e=Hi("img"),Pr(e.src,t=o[3]+"road.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(i,l){yn(i,e,l)},p(i,l){l&8&&!Pr(e.src,t=i[3]+"road.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&gn(e)}}}function a2(o){let e,t;return{c(){e=Hi("img"),Pr(e.src,t=o[3]+"housenumber.svg")||st(e,"src",t),st(e,"alt",o[6]),st(e,"class","svelte-ltkwvy")},m(i,l){yn(i,e,l)},p(i,l){l&8&&!Pr(e.src,t=i[3]+"housenumber.svg")&&st(e,"src",t),l&64&&st(e,"alt",i[6])},d(i){i&&gn(e)}}}function l2(o){let e,t,i,l;return{c(){e=Hi("img"),Pr(e.src,t=o[5])||st(e,"src",t),st(e,"alt",o[4]),st(e,"class","svelte-ltkwvy")},m(u,d){yn(u,e,d),i||(l=qr(e,"error",o[14]),i=!0)},p(u,d){d&32&&!Pr(e.src,t=u[5])&&st(e,"src",t),d&16&&st(e,"alt",u[4])},d(u){u&&gn(e),i=!1,l()}}}function Qg(o){let e,t;return{c(){e=Hi("span"),t=ea(o[6]),st(e,"class","secondary svelte-ltkwvy")},m(i,l){yn(i,e,l),Ai(e,t)},p(i,l){l&64&&Bu(t,i[6])},d(i){i&&gn(e)}}}function c2(o){let e,t,i,l,u,d,a,_,v,k=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",S,E,A=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],z,R,D=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,O,j;function V(Y,ye){return ye&1&&(t=null),ye&1&&(i=null),ye&1&&(l=null),ye&1&&(u=null),Y[5]?l2:Y[0].address?a2:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?s2:(i==null&&(i=!!Y[0].id.startsWith("address.")),i?o2:(l==null&&(l=!!Y[0].id.startsWith("postal_code.")),l?r2:(u==null&&(u=!!Y[0].id.startsWith("poi.")),u?n2:Y[7]?i2:t2))))}let se=V(o,-1),ce=se(o),Z=A&&Qg(o);return{c(){e=Hi("li"),ce.c(),d=fo(),a=Hi("span"),_=Hi("span"),v=Hi("span"),S=ea(k),E=fo(),Z&&Z.c(),z=fo(),R=Hi("span"),B=ea(D),st(v,"class","primary svelte-ltkwvy"),st(_,"class","svelte-ltkwvy"),st(R,"class","line2 svelte-ltkwvy"),st(a,"class","texts svelte-ltkwvy"),st(e,"tabindex","0"),st(e,"data-selected",o[1]),st(e,"class","svelte-ltkwvy"),Mo(e,"selected",o[1])},m(Y,ye){yn(Y,e,ye),ce.m(e,null),Ai(e,d),Ai(e,a),Ai(a,_),Ai(_,v),Ai(v,S),Ai(_,E),Z&&Z.m(_,null),Ai(a,z),Ai(a,R),Ai(R,B),O||(j=[qr(e,"mouseenter",o[12]),qr(e,"focus",o[13])],O=!0)},p(Y,[ye]){se===(se=V(Y,ye))&&ce?ce.p(Y,ye):(ce.d(1),ce=se(Y),ce&&(ce.c(),ce.m(e,d))),ye&1&&k!==(k=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&Bu(S,k),ye&37&&(A=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),A?Z?Z.p(Y,ye):(Z=Qg(Y),Z.c(),Z.m(_,null)):Z&&(Z.d(1),Z=null),ye&1&&D!==(D=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Bu(B,D),ye&2&&st(e,"data-selected",Y[1]),ye&2&&Mo(e,"selected",Y[1])},i:mn,o:mn,d(Y){Y&&gn(e),ce.d(),Z&&Z.d(),O=!1,Ls(j)}}}function u2(o,e,t){var i;let l,u,{feature:d}=e,{selected:a=!1}=e,{showPlaceType:_}=e,{missingIconsCache:v}=e,{iconsBaseUrl:k}=e;const S=(i=d.properties)==null?void 0:i.categories;let E,A,z=0,R=d.place_type[0]==="reverse";function D(){A&&v.add(A),t(10,z++,z)}function B(V){Kg.call(this,o,V)}function O(V){Kg.call(this,o,V)}const j=()=>D();return o.$$set=V=>{"feature"in V&&t(0,d=V.feature),"selected"in V&&t(1,a=V.selected),"showPlaceType"in V&&t(2,_=V.showPlaceType),"missingIconsCache"in V&&t(9,v=V.missingIconsCache),"iconsBaseUrl"in V&&t(3,k=V.iconsBaseUrl)},o.$$.update=()=>{var V,se,ce,Z;if(o.$$.dirty&3640)do t(11,l--,l),t(4,E=S==null?void 0:S[l]),t(5,A=E?k+E.replace(/ /g,"_")+".svg":void 0);while(l>-1&&(!A||v.has(A)));o.$$.dirty&1&&t(6,u=((se=(V=d.properties)==null?void 0:V.categories)==null?void 0:se.join(", "))??((Z=(ce=d.properties)==null?void 0:ce.place_type_name)==null?void 0:Z[0])??d.place_type[0])},t(11,l=(S==null?void 0:S.length)??0),[d,a,_,k,E,A,u,R,D,v,z,l,B,O,j]}class h2 extends oa{constructor(e){super(),ra(this,e,u2,c2,na,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function d2(o){let e;return{c(){e=Hi("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',st(e,"class","svelte-7cmwmc")},m(t,i){yn(t,e,i)},p:mn,i:mn,o:mn,d(t){t&&gn(e)}}}class f2 extends oa{constructor(e){super(),ra(this,e,null,d2,na,{})}}function p2(o){let e,t,i;return{c(){e=Uo("svg"),t=Uo("path"),st(t,"stroke-width","4"),st(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),st(t,"class","svelte-gzo3ar"),st(e,"width",i=o[0]==="list"?20:void 0),st(e,"viewBox","0 0 70 85"),st(e,"fill","none"),st(e,"class","svelte-gzo3ar"),Mo(e,"in-map",o[0]!=="list"),Mo(e,"list-icon",o[0]==="list")},m(l,u){yn(l,e,u),Ai(e,t)},p(l,[u]){u&1&&i!==(i=l[0]==="list"?20:void 0)&&st(e,"width",i),u&1&&Mo(e,"in-map",l[0]!=="list"),u&1&&Mo(e,"list-icon",l[0]==="list")},i:mn,o:mn,d(l){l&&gn(e)}}}function m2(o,e,t){let{displayIn:i}=e;return o.$$set=l=>{"displayIn"in l&&t(0,i=l.displayIn)},[i]}class g2 extends oa{constructor(e){super(),ra(this,e,m2,p2,na,{displayIn:0})}}function _2(o){let e,t;return{c(){e=Uo("svg"),t=Uo("path"),st(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),st(e,"viewBox","0 0 60.006 21.412"),st(e,"width","14"),st(e,"height","20"),st(e,"class","svelte-en2qvf")},m(i,l){yn(i,e,l),Ai(e,t)},p:mn,i:mn,o:mn,d(i){i&&gn(e)}}}class y2 extends oa{constructor(e){super(),ra(this,e,null,_2,na,{})}}function v2(o){let e,t,i;return{c(){e=Uo("svg"),t=Uo("circle"),i=Uo("path"),st(t,"cx","4.789"),st(t,"cy","4.787"),st(t,"r","3.85"),st(t,"class","svelte-1aq105l"),st(i,"d","M12.063 12.063 7.635 7.635"),st(i,"class","svelte-1aq105l"),st(e,"xmlns","http://www.w3.org/2000/svg"),st(e,"width","13"),st(e,"height","13"),st(e,"viewBox","0 0 13 13"),st(e,"class","svelte-1aq105l")},m(l,u){yn(l,e,u),Ai(e,t),Ai(e,i)},p:mn,i:mn,o:mn,d(l){l&&gn(e)}}}class b2 extends oa{constructor(e){super(),ra(this,e,null,v2,na,{})}}function w2(o,e,t){const i=e[1],l=e[0],u=i-l;return o===i&&t?o:((o-l)%u+u)%u+l}function kd(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let uu;async function x2(o,e,t){const i=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(i&&(l.minZoom!=null&&l.minZoom>i[0]||l.maxZoom!=null&&l.maxZoom<i[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(uu&&l.cachedLocationExpiry&&uu.time+l.cachedLocationExpiry>Date.now()){if(!uu.coords)break e;return uu.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(v=>v.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(uu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(i&&l.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const k2=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,e_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,t_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,i_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,n_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,r_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function S2(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(A=>Number(A.trim())),t=Number(e[0]),i=Number(e[1]),l=Math.abs(t),u=Math.abs(i),d=t>0?"N":"S",a=i>0?"E":"W";let _;o=="DD"&&(_=`${l} ${d}, ${u} ${a}`);const v=Math.floor(l),k=Math.floor(u),S=(l-v)*60,E=(u-k)*60;if(o=="DM"){let A=o_(S,3).toFixed(3).padStart(6,"0"),z=o_(E,3).toFixed(3).padStart(6,"0");A.endsWith(".000")&&z.endsWith(".000")&&(A=A.replace(/\.000$/,""),z=z.replace(/\.000$/,"")),_=`${v} ${A}' ${d}, ${k} ${z}' ${a}`}if(o=="DMS"){const A=Math.floor(S),z=Math.floor(E);let R=((S-A)*60).toFixed(1).padStart(4,"0"),D=((E-z)*60).toFixed(1).padStart(4,"0");const B=A.toString().padStart(2,"0"),O=z.toString().padStart(2,"0");R.endsWith(".0")&&D.endsWith(".0")&&(R=R.replace(/\.0$/,""),D=D.replace(/\.0$/,"")),_=`${v} ${B}' ${R}" ${d}, ${k} ${O}' ${D}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function o_(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function jp(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,i=null,l="",u="",d=null,a=[],_=!1;if(k2.test(o))throw new Error("invalid coordinate value");if(e_.test(o))if(a=e_.exec(o),_=hu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),i=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(i*=-1),d="DM";else throw new Error("invalid coordinate format");else if(t_.test(o))if(a=t_.exec(o),_=hu(a),_){if(t=a[2],i=a[6],t.includes(",")&&(t=t.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(i_.test(o))if(a=i_.exec(o),_=hu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[9])),a[11]&&(i+=a[11]/60),a[13]&&(i+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(i=-1*i),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(n_.test(o))if(a=n_.exec(o),_=hu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12]/60),a[14]&&(i+=a[14]/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(r_.test(o)){if(a=r_.exec(o),_=hu(a),a.filter(v=>v).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12].replace(",",".")/60),a[14]&&(i+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let v=/S|SOUTH/i;v.test(l)&&t>0&&(t=-1*t),v=/W|WEST/i,v.test(u)&&i>0&&(i=-1*i);const k=a[0].trim();let S,E;const A=/[,/;\u0020]/g,z=k.match(A);if(z==null){const B=Math.floor(o.length/2);S=k.substring(0,B).trim(),E=k.substring(B).trim()}else{let B;z.length%2==1?B=Math.floor(z.length/2):B=z.length/2-1;let O=0;if(B==0)O=k.indexOf(z[0]),S=k.substring(0,O).trim(),E=k.substring(O+1).trim();else{let j=0,V=0;for(;j<=B;)O=k.indexOf(z[j],V),V=O+1,j++;S=k.substring(0,O).trim(),E=k.substring(O+1).trim()}}const R=S.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");const D=E.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(E))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:E,decimalLatitude:t,decimalLongitude:i,decimalCoordinates:`${t},${i}`,originalFormat:d,closeEnough:T2,toCoordinateFormat:S2})}else throw new Error("coordinates pattern match failed")}function hu(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),v=i.test(d)&&i.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||v||k)continue;return!1}}return!0}function s_(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function T2(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return s_(this.decimalLatitude,Number(e[0]))&&s_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const C2=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});jp.to=C2;const E2=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],M2={decimalLatitude:40.123,decimalLongitude:-74.123},I2=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],L2=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function A2(){const o=[];return E2.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...M2})}),[...o,...I2,...L2]}const P2=A2();jp.formats=P2.map(o=>o.verbatimCoordinates);const z2=jp;function a_(o,e,t){const i=o.slice();return i[84]=e[t],i[86]=t,i}function l_(o){let e,t;return e=new f2({}),{c(){ta(e.$$.fragment)},m(i,l){Ms(e,i,l),t=!0},i(i){t||(Wn(e.$$.fragment,i),t=!0)},o(i){ar(e.$$.fragment,i),t=!1},d(i){Is(e,i)}}}function c_(o){let e,t,i,l,u;return t=new y2({}),{c(){e=Hi("button"),ta(t.$$.fragment),st(e,"type","button"),st(e,"title",o[9]),st(e,"class","svelte-bz0zu3"),Mo(e,"active",o[0])},m(d,a){yn(d,e,a),Ms(t,e,null),i=!0,l||(u=qr(e,"click",o[69]),l=!0)},p(d,a){(!i||a[0]&512)&&st(e,"title",d[9]),(!i||a[0]&1)&&Mo(e,"active",d[0])},i(d){i||(Wn(t.$$.fragment,d),i=!0)},o(d){ar(t.$$.fragment,d),i=!1},d(d){d&&gn(e),Is(t),l=!1,u()}}}function D2(o){let e,t=[],i=new Map,l,u,d,a=Yg(o[14]);const _=v=>v[84].id+(v[84].address?","+v[84].address:"");for(let v=0;v<a.length;v+=1){let k=a_(o,a,v),S=_(k);i.set(S,t[v]=u_(S,k))}return{c(){e=Hi("ul");for(let v=0;v<t.length;v+=1)t[v].c();st(e,"class","options svelte-bz0zu3")},m(v,k){yn(v,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[qr(e,"mouseleave",o[73]),qr(e,"blur",o[74])],u=!0)},p(v,k){k[0]&17880064&&(a=Yg(v[14]),hd(),t=Kx(t,k,_,1,v,a,i,e,Xx,u_,null,a_),dd())},i(v){if(!l){for(let k=0;k<a.length;k+=1)Wn(t[k]);l=!0}},o(v){for(let k=0;k<t.length;k+=1)ar(t[k]);l=!1},d(v){v&&gn(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,Ls(d)}}}function R2(o){let e,t,i,l,u,d;return t=new B0({}),{c(){e=Hi("div"),ta(t.$$.fragment),i=fo(),l=Hi("div"),u=ea(o[7]),st(l,"class","svelte-bz0zu3"),st(e,"class","no-results svelte-bz0zu3")},m(a,_){yn(a,e,_),Ms(t,e,null),Ai(e,i),Ai(e,l),Ai(l,u),d=!0},p(a,_){(!d||_[0]&128)&&Bu(u,a[7])},i(a){d||(Wn(t.$$.fragment,a),d=!0)},o(a){ar(t.$$.fragment,a),d=!1},d(a){a&&gn(e),Is(t)}}}function B2(o){let e="",t;return{c(){t=ea(e)},m(i,l){yn(i,t,l)},p:mn,i:mn,o:mn,d(i){i&&gn(t)}}}function F2(o){let e,t,i,l,u,d,a,_,v,k,S;return t=new B0({}),_=new R0({}),{c(){e=Hi("div"),ta(t.$$.fragment),i=fo(),l=Hi("div"),u=ea(o[6]),d=fo(),a=Hi("button"),ta(_.$$.fragment),st(l,"class","svelte-bz0zu3"),st(a,"class","svelte-bz0zu3"),st(e,"class","error svelte-bz0zu3")},m(E,A){yn(E,e,A),Ms(t,e,null),Ai(e,i),Ai(e,l),Ai(l,u),Ai(e,d),Ai(e,a),Ms(_,a,null),v=!0,k||(S=qr(a,"click",o[70]),k=!0)},p(E,A){(!v||A[0]&64)&&Bu(u,E[6])},i(E){v||(Wn(t.$$.fragment,E),Wn(_.$$.fragment,E),v=!0)},o(E){ar(t.$$.fragment,E),ar(_.$$.fragment,E),v=!1},d(E){E&&gn(e),Is(t),Is(_),k=!1,S()}}}function u_(o,e){let t,i,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return i=new h2({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),i.$on("mouseenter",u),i.$on("focus",d),{key:o,first:null,c(){t=Nx(),ta(i.$$.fragment),this.first=t},m(a,_){yn(a,t,_),Ms(i,a,_),l=!0},p(a,_){e=a;const v={};_[0]&16384&&(v.feature=e[84]),_[0]&1024&&(v.showPlaceType=e[10]),_[0]&49152&&(v.selected=e[15]===e[86]),_[0]&4096&&(v.iconsBaseUrl=e[12]),i.$set(v)},i(a){l||(Wn(i.$$.fragment,a),l=!0)},o(a){ar(i.$$.fragment,a),l=!1},d(a){a&&gn(t),Is(i,a)}}}function O2(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R,D,B,O,j,V,se,ce=!1;u=new b2({}),S=new R0({});let Z=o[19]&&l_(),Y=o[5]==="button"&&c_(o);const ye=o[61].default,Oe=Rx(ye,o,o[60],null),ne=[F2,B2,R2,D2],ve=[];function Je(Le,et){var bt,pt;return Le[18]?0:Le[16]?((bt=Le[14])==null?void 0:bt.length)===0?2:Le[16]&&(pt=Le[14])!=null&&pt.length?3:-1:1}return~(D=Je(o))&&(B=ve[D]=ne[D](o)),{c(){e=fo(),t=Hi("form"),i=Hi("div"),l=Hi("button"),ta(u.$$.fragment),d=fo(),a=Hi("input"),_=fo(),v=Hi("div"),k=Hi("button"),ta(S.$$.fragment),E=fo(),Z&&Z.c(),A=fo(),Y&&Y.c(),z=fo(),Oe&&Oe.c(),R=fo(),B&&B.c(),st(l,"class","search-button svelte-bz0zu3"),st(l,"type","button"),st(a,"placeholder",o[8]),st(a,"aria-label",o[8]),st(a,"class","svelte-bz0zu3"),st(k,"type","button"),st(k,"title",o[3]),st(k,"class","svelte-bz0zu3"),st(v,"class","clear-button-container svelte-bz0zu3"),Mo(v,"displayable",o[1]!==""),st(i,"class","input-group svelte-bz0zu3"),st(t,"tabindex","0"),st(t,"class",O=Hg(o[2])+" svelte-bz0zu3"),Mo(t,"can-collapse",o[4]&&o[1]==="")},m(Le,et){yn(Le,e,et),yn(Le,t,et),Ai(t,i),Ai(i,l),Ms(u,l,null),Ai(i,d),Ai(i,a),o[63](a),Xg(a,o[1]),Ai(i,_),Ai(i,v),Ai(v,k),Ms(S,k,null),Ai(v,E),Z&&Z.m(v,null),Ai(i,A),Y&&Y.m(i,null),Ai(i,z),Oe&&Oe.m(i,null),Ai(t,R),~D&&ve[D].m(t,null),j=!0,V||(se=[qr(l,"click",o[62]),qr(a,"input",o[64]),qr(a,"focus",o[65]),qr(a,"blur",o[66]),qr(a,"keydown",o[22]),qr(a,"input",o[67]),qr(k,"click",o[68]),qr(t,"submit",jx(o[21]))],V=!0)},p(Le,et){(!j||et[0]&256)&&st(a,"placeholder",Le[8]),(!j||et[0]&256)&&st(a,"aria-label",Le[8]),et[0]&2&&a.value!==Le[1]&&Xg(a,Le[1]),(!j||et[0]&8)&&st(k,"title",Le[3]),Le[19]?Z?et[0]&524288&&Wn(Z,1):(Z=l_(),Z.c(),Wn(Z,1),Z.m(v,null)):Z&&(hd(),ar(Z,1,1,()=>{Z=null}),dd()),(!j||et[0]&2)&&Mo(v,"displayable",Le[1]!==""),Le[5]==="button"?Y?(Y.p(Le,et),et[0]&32&&Wn(Y,1)):(Y=c_(Le),Y.c(),Wn(Y,1),Y.m(i,z)):Y&&(hd(),ar(Y,1,1,()=>{Y=null}),dd()),Oe&&Oe.p&&(!j||et[1]&536870912)&&Fx(Oe,ye,Le,Le[60],j?Bx(ye,Le[60],et,null):Ox(Le[60]),null);let bt=D;D=Je(Le),D===bt?~D&&ve[D].p(Le,et):(B&&(hd(),ar(ve[bt],1,1,()=>{ve[bt]=null}),dd()),~D?(B=ve[D],B?B.p(Le,et):(B=ve[D]=ne[D](Le),B.c()),Wn(B,1),B.m(t,null)):B=null),(!j||et[0]&4&&O!==(O=Hg(Le[2])+" svelte-bz0zu3"))&&st(t,"class",O),(!j||et[0]&22)&&Mo(t,"can-collapse",Le[4]&&Le[1]==="")},i(Le){j||(Wn(ce),Wn(u.$$.fragment,Le),Wn(S.$$.fragment,Le),Wn(Z),Wn(Y),Wn(Oe,Le),Wn(B),j=!0)},o(Le){ar(ce),ar(u.$$.fragment,Le),ar(S.$$.fragment,Le),ar(Z),ar(Y),ar(Oe,Le),ar(B),j=!1},d(Le){Le&&(gn(e),gn(t)),Is(u),o[63](null),Is(S),Z&&Z.d(),Y&&Y.d(),Oe&&Oe.d(Le),~D&&ve[D].d(),V=!1,Ls(se)}}}function N2(o,e,t){let i,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:v}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:E=!1}=e,{collapsed:A=!1}=e,{country:z=void 0}=e,{debounceSearch:R=200}=e,{enableReverse:D="never"}=e,{errorMessage:B="Something went wrong"}=e,{filter:O=()=>!0}=e,{flyTo:j=!0}=e,{fuzzyMatch:V=!0}=e,{language:se=void 0}=e,{limit:ce=void 0}=e,{mapController:Z=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:ye="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Oe="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:ve=D==="always"}=e,{reverseButtonTitle:Je="toggle reverse geocoding"}=e,{searchValue:Le=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:bt="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:at=!0}=e,{flyToSelected:Xt=!1}=e,{markerOnSelected:ni=!0}=e,{types:Nt=void 0}=e,{exhaustiveReverseGeocoding:zt=!1}=e,{excludeTypes:Yt=!1}=e,{zoom:It=a}=e,{apiUrl:ti="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Zt={}}=e,{iconsBaseUrl:hi="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:ki=()=>{}}=e;function yi(){Ve.focus()}function Pi(){Ve.blur()}function ut(G,Ue=!0,$e=!1){t(1,Le=G),Ue?(t(15,We=-1),ht()):(Qt(!$e,$e),setTimeout(()=>{Ve.focus(),Ve.select()}))}function At(){t(14,ot=void 0),t(56,we=void 0),t(15,We=-1)}function Ne(){t(55,kt=[]),t(56,we=void 0)}let je=!1,ot,kt,we,di="",Ve,We=-1,St,vn=[],bn,Mn,tr,ir;const qo=new Set,Ji=qx();$x(()=>{Z&&(Z.setEventHandler(void 0),Z.indicateReverse(!1),Z.setSelectedMarker(-1),Z.setFeatures(void 0,void 0,!1))});function ht(G){if(Mn&&(clearTimeout(Mn),Mn=void 0),We>-1&&ot)t(56,we=ot[We]),t(1,Le=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,St=void 0),t(55,kt=void 0),t(15,We=-1);else if(Le){const Ue=G||!Hn(Le);wn(Le,{exact:!0}).then(()=>{t(55,kt=ot),t(56,we=void 0),Ue&&Ao()}).catch($e=>t(18,St=$e))}}function Hn(G){try{return z2(G,6)}catch{return!1}}async function wn(G,{byId:Ue=!1,exact:$e=!1}={}){t(18,St=void 0),bn==null||bn.abort();const Ze=new AbortController;t(19,bn=Ze);try{const Ye=Hn(G),dt=new URLSearchParams;if(se!==void 0&&dt.set("language",Array.isArray(se)?se.join(","):se??""),Nt&&dt.set("types",Nt.join(",")),Yt&&dt.set("excludeTypes",String(Yt)),k&&dt.set("bbox",k.map(vi=>vi.toFixed(6)).join(",")),z&&dt.set("country",Array.isArray(z)?z.join(","):z),!Ue&&!Ye){const vi=await x2(Z,ne,Ze);vi&&dt.set("proximity",vi),($e||!pt)&&dt.set("autocomplete","false"),dt.set("fuzzyMatch",String(V))}ce!==void 0&&(zt||!Ye||(Nt==null?void 0:Nt.length)===1)&&dt.set("limit",String(ce)),dt.set("key",v),ki(dt);const Ft=ti+"/"+encodeURIComponent(Ye?Ye.decimalLongitude+","+Ye.decimalLatitude:G)+".json?"+dt.toString();if(Ft===di){Ue?(t(14,ot=void 0),t(56,we=vn[0])):t(14,ot=vn);return}di=Ft;const Kt=await fetch(Ft,{signal:Ze.signal,...Zt});if(!Kt.ok)throw new Error(await Kt.text());const ai=await Kt.json();Ji("response",{url:Ft,featureCollection:ai}),Ue?(t(14,ot=void 0),t(56,we=ai.features[0]),vn=[we]):(t(14,ot=ai.features.filter(O)),Ye&&ot.unshift({type:"Feature",properties:{},id:"reverse_"+Ye.decimalLongitude+"_"+Ye.decimalLatitude,text:Ye.decimalLatitude+", "+Ye.decimalLongitude,place_name:Ye.decimalLatitude+", "+Ye.decimalLongitude,place_type:["reverse"],center:[Ye.decimalLongitude,Ye.decimalLatitude],bbox:[Ye.decimalLongitude,Ye.decimalLatitude,Ye.decimalLongitude,Ye.decimalLatitude],geometry:{type:"Point",coordinates:[Ye.decimalLongitude,Ye.decimalLatitude]}}),vn=ot,Ye&&Ve.focus())}catch(Ye){if(Ye&&typeof Ye=="object"&&"name"in Ye&&Ye.name==="AbortError")return;throw Ye}finally{Ze===bn&&t(19,bn=void 0)}}function Ao(){var G;if(!(kt!=null&&kt.length)||!j)return;const Ue=[180,90,-180,-90],$e=!kt.some(Ye=>!Ye.matching_text);let Ze;for(const Ye of kt){const dt=Vi(Ye);if(Ze=Ze===void 0?dt:dt===void 0?Ze:Math.max(Ze,dt),$e||!Ye.matching_text)for(const Ft of[0,1,2,3])Ue[Ft]=Math[Ft<2?"min":"max"](Ue[Ft],((G=Ye.bbox)==null?void 0:G[Ft])??Ye.center[Ft%2])}Z&&kt.length>0&&(we&&Ue[0]===Ue[2]&&Ue[1]===Ue[3]?Z.flyTo(we.center,Vi(we)):Z.fitBounds(kd(Ue),50,Ze))}function Vi(G){var Ue;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const $e=G.id.replace(/\..*/,"");return(Array.isArray((Ue=G.properties)==null?void 0:Ue.categories)?G.properties.categories.reduce((Ze,Ye)=>{const dt=It[$e+"."+Ye];return Ze===void 0?dt:dt===void 0?Ze:Math.max(Ze,dt)},void 0):void 0)??It[$e]}function gt(G){t(0,ve=D==="always"),t(14,ot=void 0),t(56,we=void 0),t(15,We=-1),ut(G[1].toFixed(6)+", "+w2(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ri(G){if(!ot)return;let Ue=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;Ue&&(We===(at?0:-1)&&Ue===-1&&t(15,We=ot.length),t(15,We+=Ue),We>=ot.length&&t(15,We=-1),We<0&&at&&t(15,We=0),G.preventDefault())}function Qt(G=!0,Ue=!1){if(t(18,St=void 0),pt||Ue){if(Mn&&clearTimeout(Mn),Le.length<Y)return;const $e=Le;Mn=window.setTimeout(()=>{wn($e).catch(Ze=>t(18,St=Ze))},G?R:0)}else t(14,ot=void 0),t(18,St=void 0)}function $i(G){t(56,we=G),t(1,Le=G.place_name),t(15,We=-1)}const vr=()=>Ve.focus();function ii(G){dp[G?"unshift":"push"](()=>{Ve=G,t(17,Ve)})}function to(){Le=this.value,t(1,Le),t(13,je),t(28,E)}const un=()=>t(13,je=!0),me=()=>t(13,je=!1),W=()=>Qt(),K=()=>{t(1,Le=""),Ve.focus()},ie=()=>t(0,ve=!ve),de=()=>t(18,St=void 0),Ae=G=>t(15,We=G),Pe=G=>$i(G),Be=()=>{at||t(15,We=-1)},Se=()=>{};return o.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,v=G.apiKey),"bbox"in G&&t(27,k=G.bbox),"clearButtonTitle"in G&&t(3,S=G.clearButtonTitle),"clearOnBlur"in G&&t(28,E=G.clearOnBlur),"collapsed"in G&&t(4,A=G.collapsed),"country"in G&&t(29,z=G.country),"debounceSearch"in G&&t(30,R=G.debounceSearch),"enableReverse"in G&&t(5,D=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,O=G.filter),"flyTo"in G&&t(32,j=G.flyTo),"fuzzyMatch"in G&&t(33,V=G.fuzzyMatch),"language"in G&&t(34,se=G.language),"limit"in G&&t(35,ce=G.limit),"mapController"in G&&t(36,Z=G.mapController),"minLength"in G&&t(37,Y=G.minLength),"noResultsMessage"in G&&t(7,ye=G.noResultsMessage),"placeholder"in G&&t(8,Oe=G.placeholder),"proximity"in G&&t(38,ne=G.proximity),"reverseActive"in G&&t(0,ve=G.reverseActive),"reverseButtonTitle"in G&&t(9,Je=G.reverseButtonTitle),"searchValue"in G&&t(1,Le=G.searchValue),"pickedResultStyle"in G&&t(39,et=G.pickedResultStyle),"showPlaceType"in G&&t(10,bt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,pt=G.showResultsWhileTyping),"selectFirst"in G&&t(11,at=G.selectFirst),"flyToSelected"in G&&t(41,Xt=G.flyToSelected),"markerOnSelected"in G&&t(42,ni=G.markerOnSelected),"types"in G&&t(43,Nt=G.types),"exhaustiveReverseGeocoding"in G&&t(44,zt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Yt=G.excludeTypes),"zoom"in G&&t(46,It=G.zoom),"apiUrl"in G&&t(47,ti=G.apiUrl),"fetchParameters"in G&&t(48,Zt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,hi=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,ki=G.adjustUrlQuery),"$$scope"in G&&t(60,d=G.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ve=D==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,tr=je),E&&!je&&t(1,Le="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Le.length<Y&&(t(56,we=void 0),t(14,ot=void 0),t(18,St=void 0),t(55,kt=ot)),o.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&wn(we.id,{byId:!0}).catch(G=>t(18,St=G)),o.$$.dirty[1]&100663330&&(Z&&we&&we.id!==ir&&j&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?Z.flyTo(we.center,Vi(we)):Z.fitBounds(kd(we.bbox),50,Vi(we)),t(14,ot=void 0),t(55,kt=void 0),t(15,We=-1)),t(57,ir=we==null?void 0:we.id)),o.$$.dirty[0]&18432&&at&&ot!=null&&ot.length&&t(15,We=0),o.$$.dirty[0]&2&&t(15,We=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&kt!==ot&&t(55,kt=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&Z&&Z.setEventHandler(G=>{switch(G.type){case"mapClick":ve&&gt(G.coordinates);break;case"markerClick":{const Ue=ot==null?void 0:ot.find($e=>$e.id===G.id);Ue&&$i(Ue)}break;case"markerMouseEnter":kt&&t(15,We=tr?(ot==null?void 0:ot.findIndex(Ue=>Ue.id===G.id))??-1:-1);break;case"markerMouseLeave":kt&&t(15,We=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=ot==null?void 0:ot[We]),o.$$.dirty[1]&134218786&&Z&&l&&j&&Xt&&Z.flyTo(l.center,Vi(l)),o.$$.dirty[1]&256&&t(59,i=et==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(ni||Z==null||Z.setFeatures(void 0,void 0,i)),o.$$.dirty[1]&419432480&&Z&&ni&&!kt&&(Z.setFeatures(l?[l]:void 0,void 0,i),Z.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&Z&&Z.setFeatures(kt,we,i),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&kt&&Z&&Z.setSelectedMarker(We),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&Z){const G=Hn(Le);Z.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&Ji("select",{feature:l}),o.$$.dirty[1]&33554432&&Ji("pick",{feature:we}),o.$$.dirty[0]&81920&&Ji("optionsvisibilitychange",{optionsVisible:tr&&!!ot}),o.$$.dirty[0]&16384&&Ji("featureslisted",{features:ot}),o.$$.dirty[1]&16777216&&Ji("featuresmarked",{features:kt}),o.$$.dirty[0]&1&&Ji("reversetoggle",{reverse:ve}),o.$$.dirty[0]&2&&Ji("querychange",{query:Le}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&Z&&Z.indicateReverse(ve)},[ve,Le,_,S,A,D,B,ye,Oe,Je,bt,at,hi,je,ot,We,tr,Ve,St,bn,qo,ht,ri,Qt,$i,a,v,k,E,z,R,O,j,V,se,ce,Z,Y,ne,et,pt,Xt,ni,Nt,zt,Yt,It,ti,Zt,ki,yi,Pi,ut,At,Ne,kt,we,ir,l,i,d,u,vr,ii,to,un,me,W,K,ie,de,Ae,Pe,Be,Se]}let j2=class extends oa{constructor(o){super(),ra(this,o,N2,O2,na,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Ou(o,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=o,i}function Up(o,e,t={}){for(const i of o){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<i[i.length-1].length;l++)if(i[i.length-1][l]!==i[0][l])throw new Error("First and last Position are not equivalent.")}return Ou({type:"Polygon",coordinates:o},e,t)}function Nu(o,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=o,t}function F0(o,e,t={}){return Ou({type:"MultiPolygon",coordinates:o},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function U2(o,e){var t={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},i,l,u,d;return d={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function a(v){return function(k){return _([v,k])}}function _(v){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,l&&(u=v[0]&2?l.return:v[0]?l.throw||((u=l.return)&&u.call(l),0):l.next)&&!(u=u.call(l,v[1])).done)return u;switch(l=0,u&&(v=[v[0]&2,u.value]),v[0]){case 0:case 1:u=v;break;case 4:return t.label++,{value:v[1],done:!1};case 5:t.label++,l=v[1],v=[0];continue;case 7:v=t.ops.pop(),t.trys.pop();continue;default:if(u=t.trys,!(u=u.length>0&&u[u.length-1])&&(v[0]===6||v[0]===2)){t=0;continue}if(v[0]===3&&(!u||v[1]>u[0]&&v[1]<u[3])){t.label=v[1];break}if(v[0]===6&&t.label<u[1]){t.label=u[1],u=v;break}if(u&&t.label<u[2]){t.label=u[2],t.ops.push(v);break}u[2]&&t.ops.pop(),t.trys.pop();continue}v=e.call(o,t)}catch(k){v=[6,k],l=0}finally{i=u=0}if(v[0]&5)throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}}var ia=function(){function o(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return o}();function V2(o,e){return o>e?1:o<e?-1:0}function Ks(o,e,t){for(var i=new ia(null,null),l=i,u=i;;){var d=t(o,e.key);if(d<0){if(e.left===null)break;if(t(o,e.left.key)<0){var a=e.left;if(e.left=a.right,a.right=e,e=a,e.left===null)break}u.left=e,u=e,e=e.left}else if(d>0){if(e.right===null)break;if(t(o,e.right.key)>0){var a=e.right;if(e.right=a.left,a.left=e,e=a,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,u.left=e.right,e.left=i.right,e.right=i.left,e}function Kf(o,e,t,i){var l=new ia(o,e);if(t===null)return l.left=l.right=null,l;t=Ks(o,t,i);var u=i(o,t.key);return u<0?(l.left=t.left,l.right=t,t.left=null):u>=0&&(l.right=t.right,l.left=t,t.right=null),l}function h_(o,e,t){var i=null,l=null;if(e){e=Ks(o,e,t);var u=t(e.key,o);u===0?(i=e.left,l=e.right):u<0?(l=e.right,e.right=null,i=e):(i=e.left,e.left=null,l=e)}return{left:i,right:l}}function $2(o,e,t){return e===null?o:(o===null||(e=Ks(o.key,e,t),e.left=o),e)}function mp(o,e,t,i,l){if(o){i(""+e+(t?" ":" ")+l(o)+`
`);var u=e+(t?"    ":"   ");o.left&&mp(o.left,u,!1,i,l),o.right&&mp(o.right,u,!0,i,l)}}var Vp=function(){function o(e){e===void 0&&(e=V2),this._root=null,this._size=0,this._comparator=e}return o.prototype.insert=function(e,t){return this._size++,this._root=Kf(e,t,this._root,this._comparator)},o.prototype.add=function(e,t){var i=new ia(e,t);this._root===null&&(i.left=i.right=null,this._size++,this._root=i);var l=this._comparator,u=Ks(e,this._root,l),d=l(e,u.key);return d===0?this._root=u:(d<0?(i.left=u.left,i.right=u,u.left=null):d>0&&(i.right=u.right,i.left=u,u.right=null),this._size++,this._root=i),this._root},o.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},o.prototype._remove=function(e,t,i){var l;if(t===null)return null;t=Ks(e,t,i);var u=i(e,t.key);return u===0?(t.left===null?l=t.right:(l=Ks(e,t.left,i),l.right=t.right),this._size--,l):t},o.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Ks(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},o.prototype.findStatic=function(e){for(var t=this._root,i=this._comparator;t;){var l=i(e,t.key);if(l===0)return t;l<0?t=t.left:t=t.right}return null},o.prototype.find=function(e){return this._root&&(this._root=Ks(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},o.prototype.contains=function(e){for(var t=this._root,i=this._comparator;t;){var l=i(e,t.key);if(l===0)return!0;l<0?t=t.left:t=t.right}return!1},o.prototype.forEach=function(e,t){for(var i=this._root,l=[],u=!1;!u;)i!==null?(l.push(i),i=i.left):l.length!==0?(i=l.pop(),e.call(t,i),i=i.right):u=!0;return this},o.prototype.range=function(e,t,i,l){for(var u=[],d=this._comparator,a=this._root,_;u.length!==0||a;)if(a)u.push(a),a=a.left;else{if(a=u.pop(),_=d(a.key,t),_>0)break;if(d(a.key,e)>=0&&i.call(l,a))return this;a=a.right}return this},o.prototype.keys=function(){var e=[];return this.forEach(function(t){var i=t.key;return e.push(i)}),e},o.prototype.values=function(){var e=[];return this.forEach(function(t){var i=t.data;return e.push(i)}),e},o.prototype.min=function(){return this._root?this.minNode(this._root).key:null},o.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},o.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},o.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},o.prototype.at=function(e){for(var t=this._root,i=!1,l=0,u=[];!i;)if(t)u.push(t),t=t.left;else if(u.length>0){if(t=u.pop(),l===e)return t;l++,t=t.right}else i=!0;return null},o.prototype.next=function(e){var t=this._root,i=null;if(e.right){for(i=e.right;i.left;)i=i.left;return i}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?(i=t,t=t.left):t=t.right}return i},o.prototype.prev=function(e){var t=this._root,i=null;if(e.left!==null){for(i=e.left;i.right;)i=i.right;return i}for(var l=this._comparator;t;){var u=l(e.key,t.key);if(u===0)break;u<0?t=t.left:(i=t,t=t.right)}return i},o.prototype.clear=function(){return this._root=null,this._size=0,this},o.prototype.toList=function(){return Z2(this._root)},o.prototype.load=function(e,t,i){t===void 0&&(t=[]),i===void 0&&(i=!1);var l=e.length,u=this._comparator;if(i&&yp(e,t,0,l-1,u),this._root===null)this._root=gp(e,t,0,l),this._size=l;else{var d=G2(this.toList(),q2(e,t),u);l=this._size+l,this._root=_p({head:d},0,l)}return this},o.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(o.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(o.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),o.prototype.toString=function(e){e===void 0&&(e=function(i){return String(i.key)});var t=[];return mp(this._root,"",!0,function(i){return t.push(i)},e),t.join("")},o.prototype.update=function(e,t,i){var l=this._comparator,u=h_(e,this._root,l),d=u.left,a=u.right;l(e,t)<0?a=Kf(t,i,a,l):d=Kf(t,i,d,l),this._root=$2(d,a,l)},o.prototype.split=function(e){return h_(e,this._root,this._comparator)},o.prototype[Symbol.iterator]=function(){var e,t,i;return U2(this,function(l){switch(l.label){case 0:e=this._root,t=[],i=!1,l.label=1;case 1:return i?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:i=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},o}();function gp(o,e,t,i){var l=i-t;if(l>0){var u=t+Math.floor(l/2),d=o[u],a=e[u],_=new ia(d,a);return _.left=gp(o,e,t,u),_.right=gp(o,e,u+1,i),_}return null}function q2(o,e){for(var t=new ia(null,null),i=t,l=0;l<o.length;l++)i=i.next=new ia(o[l],e[l]);return i.next=null,t.next}function Z2(o){for(var e=o,t=[],i=!1,l=new ia(null,null),u=l;!i;)e?(t.push(e),e=e.left):t.length>0?(e=u=u.next=t.pop(),e=e.right):i=!0;return u.next=null,l.next}function _p(o,e,t){var i=t-e;if(i>0){var l=e+Math.floor(i/2),u=_p(o,e,l),d=o.head;return d.left=u,o.head=o.head.next,d.right=_p(o,l+1,t),d}return null}function G2(o,e,t){for(var i=new ia(null,null),l=i,u=o,d=e;u!==null&&d!==null;)t(u.key,d.key)<0?(l.next=u,u=u.next):(l.next=d,d=d.next),l=l.next;return u!==null?l.next=u:d!==null&&(l.next=d),i.next}function yp(o,e,t,i,l){if(!(t>=i)){for(var u=o[t+i>>1],d=t-1,a=i+1;;){do d++;while(l(o[d],u)<0);do a--;while(l(o[a],u)>0);if(d>=a)break;var _=o[d];o[d]=o[a],o[a]=_,_=e[d],e[d]=e[a],e[a]=_}yp(o,e,t,a,l),yp(o,e,a+1,i,l)}}const ks=11102230246251565e-32,Ir=134217729,W2=(3+8*ks)*ks;function Jf(o,e,t,i,l){let u,d,a,_,v=e[0],k=i[0],S=0,E=0;k>v==k>-v?(u=v,v=e[++S]):(u=k,k=i[++E]);let A=0;if(S<o&&E<t)for(k>v==k>-v?(d=v+u,a=u-(d-v),v=e[++S]):(d=k+u,a=u-(d-k),k=i[++E]),u=d,a!==0&&(l[A++]=a);S<o&&E<t;)k>v==k>-v?(d=u+v,_=d-u,a=u-(d-_)+(v-_),v=e[++S]):(d=u+k,_=d-u,a=u-(d-_)+(k-_),k=i[++E]),u=d,a!==0&&(l[A++]=a);for(;S<o;)d=u+v,_=d-u,a=u-(d-_)+(v-_),v=e[++S],u=d,a!==0&&(l[A++]=a);for(;E<t;)d=u+k,_=d-u,a=u-(d-_)+(k-_),k=i[++E],u=d,a!==0&&(l[A++]=a);return(u!==0||A===0)&&(l[A++]=u),A}function H2(o,e){let t=e[0];for(let i=1;i<o;i++)t+=e[i];return t}function Gu(o){return new Float64Array(o)}const X2=(3+16*ks)*ks,K2=(2+12*ks)*ks,J2=(9+64*ks)*ks*ks,$l=Gu(4),d_=Gu(8),f_=Gu(12),p_=Gu(16),Vr=Gu(4);function Y2(o,e,t,i,l,u,d){let a,_,v,k,S,E,A,z,R,D,B,O,j,V,se,ce,Z,Y;const ye=o-l,Oe=t-l,ne=e-u,ve=i-u;V=ye*ve,E=Ir*ye,A=E-(E-ye),z=ye-A,E=Ir*ve,R=E-(E-ve),D=ve-R,se=z*D-(V-A*R-z*R-A*D),ce=ne*Oe,E=Ir*ne,A=E-(E-ne),z=ne-A,E=Ir*Oe,R=E-(E-Oe),D=Oe-R,Z=z*D-(ce-A*R-z*R-A*D),B=se-Z,S=se-B,$l[0]=se-(B+S)+(S-Z),O=V+B,S=O-V,j=V-(O-S)+(B-S),B=j-ce,S=j-B,$l[1]=j-(B+S)+(S-ce),Y=O+B,S=Y-O,$l[2]=O-(Y-S)+(B-S),$l[3]=Y;let Je=H2(4,$l),Le=K2*d;if(Je>=Le||-Je>=Le||(S=o-ye,a=o-(ye+S)+(S-l),S=t-Oe,v=t-(Oe+S)+(S-l),S=e-ne,_=e-(ne+S)+(S-u),S=i-ve,k=i-(ve+S)+(S-u),a===0&&_===0&&v===0&&k===0)||(Le=J2*d+W2*Math.abs(Je),Je+=ye*k+ve*a-(ne*v+Oe*_),Je>=Le||-Je>=Le))return Je;V=a*ve,E=Ir*a,A=E-(E-a),z=a-A,E=Ir*ve,R=E-(E-ve),D=ve-R,se=z*D-(V-A*R-z*R-A*D),ce=_*Oe,E=Ir*_,A=E-(E-_),z=_-A,E=Ir*Oe,R=E-(E-Oe),D=Oe-R,Z=z*D-(ce-A*R-z*R-A*D),B=se-Z,S=se-B,Vr[0]=se-(B+S)+(S-Z),O=V+B,S=O-V,j=V-(O-S)+(B-S),B=j-ce,S=j-B,Vr[1]=j-(B+S)+(S-ce),Y=O+B,S=Y-O,Vr[2]=O-(Y-S)+(B-S),Vr[3]=Y;const et=Jf(4,$l,4,Vr,d_);V=ye*k,E=Ir*ye,A=E-(E-ye),z=ye-A,E=Ir*k,R=E-(E-k),D=k-R,se=z*D-(V-A*R-z*R-A*D),ce=ne*v,E=Ir*ne,A=E-(E-ne),z=ne-A,E=Ir*v,R=E-(E-v),D=v-R,Z=z*D-(ce-A*R-z*R-A*D),B=se-Z,S=se-B,Vr[0]=se-(B+S)+(S-Z),O=V+B,S=O-V,j=V-(O-S)+(B-S),B=j-ce,S=j-B,Vr[1]=j-(B+S)+(S-ce),Y=O+B,S=Y-O,Vr[2]=O-(Y-S)+(B-S),Vr[3]=Y;const bt=Jf(et,d_,4,Vr,f_);V=a*k,E=Ir*a,A=E-(E-a),z=a-A,E=Ir*k,R=E-(E-k),D=k-R,se=z*D-(V-A*R-z*R-A*D),ce=_*v,E=Ir*_,A=E-(E-_),z=_-A,E=Ir*v,R=E-(E-v),D=v-R,Z=z*D-(ce-A*R-z*R-A*D),B=se-Z,S=se-B,Vr[0]=se-(B+S)+(S-Z),O=V+B,S=O-V,j=V-(O-S)+(B-S),B=j-ce,S=j-B,Vr[1]=j-(B+S)+(S-ce),Y=O+B,S=Y-O,Vr[2]=O-(Y-S)+(B-S),Vr[3]=Y;const pt=Jf(bt,f_,4,Vr,p_);return p_[pt-1]}function Q2(o,e,t,i,l,u){const d=(e-u)*(t-l),a=(o-l)*(i-u),_=d-a,v=Math.abs(d+a);return Math.abs(_)>=X2*v?_:-Y2(o,e,t,i,l,u,v)}const du=(o,e)=>o.ll.x<=e.x&&e.x<=o.ur.x&&o.ll.y<=e.y&&e.y<=o.ur.y,vp=(o,e)=>{if(e.ur.x<o.ll.x||o.ur.x<e.ll.x||e.ur.y<o.ll.y||o.ur.y<e.ll.y)return null;const t=o.ll.x<e.ll.x?e.ll.x:o.ll.x,i=o.ur.x<e.ur.x?o.ur.x:e.ur.x,l=o.ll.y<e.ll.y?e.ll.y:o.ll.y,u=o.ur.y<e.ur.y?o.ur.y:e.ur.y;return{ll:{x:t,y:l},ur:{x:i,y:u}}};let Ys=Number.EPSILON;Ys===void 0&&(Ys=Math.pow(2,-52));const ek=Ys*Ys,m_=(o,e)=>{if(-Ys<o&&o<Ys&&-Ys<e&&e<Ys)return 0;const t=o-e;return t*t<ek*o*e?0:o<e?-1:1};class tk{constructor(){this.reset()}reset(){this.xRounder=new g_,this.yRounder=new g_}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class g_{constructor(){this.tree=new Vp,this.round(0)}round(e){const t=this.tree.add(e),i=this.tree.prev(t);if(i!==null&&m_(t.key,i.key)===0)return this.tree.remove(e),i.key;const l=this.tree.next(t);return l!==null&&m_(t.key,l.key)===0?(this.tree.remove(e),l.key):e}}const ju=new tk,fd=(o,e)=>o.x*e.y-o.y*e.x,O0=(o,e)=>o.x*e.x+o.y*e.y,__=(o,e,t)=>{const i=Q2(o.x,o.y,e.x,e.y,t.x,t.y);return i>0?-1:i<0?1:0},Sd=o=>Math.sqrt(O0(o,o)),ik=(o,e,t)=>{const i={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return fd(l,i)/Sd(l)/Sd(i)},nk=(o,e,t)=>{const i={x:e.x-o.x,y:e.y-o.y},l={x:t.x-o.x,y:t.y-o.y};return O0(l,i)/Sd(l)/Sd(i)},y_=(o,e,t)=>e.y===0?null:{x:o.x+e.x/e.y*(t-o.y),y:t},v_=(o,e,t)=>e.x===0?null:{x:t,y:o.y+e.y/e.x*(t-o.x)},rk=(o,e,t,i)=>{if(e.x===0)return v_(t,i,o.x);if(i.x===0)return v_(o,e,t.x);if(e.y===0)return y_(t,i,o.y);if(i.y===0)return y_(o,e,t.y);const l=fd(e,i);if(l==0)return null;const u={x:t.x-o.x,y:t.y-o.y},d=fd(u,e)/l,a=fd(u,i)/l,_=o.x+a*e.x,v=t.x+d*i.x,k=o.y+a*e.y,S=t.y+d*i.y,E=(_+v)/2,A=(k+S)/2;return{x:E,y:A}};class To{static compare(e,t){const i=To.comparePoints(e.point,t.point);return i!==0?i:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Qs.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let i=0,l=t.length;i<l;i++){const u=t[i];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const i=this.point.events[t];if(i.segment.consumedBy===void 0)for(let l=t+1;l<e;l++){const u=this.point.events[l];u.consumedBy===void 0&&i.otherSE.point.events===u.otherSE.point.events&&i.segment.consume(u.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,i=this.point.events.length;t<i;t++){const l=this.point.events[t];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}getLeftmostComparator(e){const t=new Map,i=l=>{const u=l.otherSE;t.set(l,{sine:ik(this.point,e.point,u.point),cosine:nk(this.point,e.point,u.point)})};return(l,u)=>{t.has(l)||i(l),t.has(u)||i(u);const{sine:d,cosine:a}=t.get(l),{sine:_,cosine:v}=t.get(u);return d>=0&&_>=0?a<v?1:a>v?-1:0:d<0&&_<0?a<v?-1:a>v?1:0:_<d?-1:_>d?1:0}}}let ok=0;class Qs{static compare(e,t){const i=e.leftSE.point.x,l=t.leftSE.point.x,u=e.rightSE.point.x,d=t.rightSE.point.x;if(d<i)return 1;if(u<l)return-1;const a=e.leftSE.point.y,_=t.leftSE.point.y,v=e.rightSE.point.y,k=t.rightSE.point.y;if(i<l){if(_<a&&_<v)return 1;if(_>a&&_>v)return-1;const S=e.comparePoint(t.leftSE.point);if(S<0)return 1;if(S>0)return-1;const E=t.comparePoint(e.rightSE.point);return E!==0?E:-1}if(i>l){if(a<_&&a<k)return-1;if(a>_&&a>k)return 1;const S=t.comparePoint(e.leftSE.point);if(S!==0)return S;const E=e.comparePoint(t.rightSE.point);return E<0?1:E>0?-1:1}if(a<_)return-1;if(a>_)return 1;if(u<d){const S=t.comparePoint(e.rightSE.point);if(S!==0)return S}if(u>d){const S=e.comparePoint(t.rightSE.point);if(S<0)return 1;if(S>0)return-1}if(u!==d){const S=v-a,E=u-i,A=k-_,z=d-l;if(S>E&&A<z)return 1;if(S<E&&A>z)return-1}return u>d?1:u<d||v<k?-1:v>k?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,i,l){this.id=++ok,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=i,this.windings=l}static fromRing(e,t,i){let l,u,d;const a=To.comparePoints(e,t);if(a<0)l=e,u=t,d=1;else if(a>0)l=t,u=e,d=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const _=new To(l,!0),v=new To(u,!1);return new Qs(_,v,[i],[d])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,i=this.rightSE.point,l=this.vector();if(t.x===i.x)return e.x===t.x?0:e.x<t.x?1:-1;const u=(e.y-t.y)/l.y,d=t.x+u*l.x;if(e.x===d)return 0;const a=(e.x-t.x)/l.x,_=t.y+a*l.y;return e.y===_?0:e.y<_?-1:1}getIntersection(e){const t=this.bbox(),i=e.bbox(),l=vp(t,i);if(l===null)return null;const u=this.leftSE.point,d=this.rightSE.point,a=e.leftSE.point,_=e.rightSE.point,v=du(t,a)&&this.comparePoint(a)===0,k=du(i,u)&&e.comparePoint(u)===0,S=du(t,_)&&this.comparePoint(_)===0,E=du(i,d)&&e.comparePoint(d)===0;if(k&&v)return E&&!S?d:!E&&S?_:null;if(k)return S&&u.x===_.x&&u.y===_.y?null:u;if(v)return E&&d.x===a.x&&d.y===a.y?null:a;if(E&&S)return null;if(E)return d;if(S)return _;const A=rk(u,this.vector(),a,e.vector());return A===null||!du(l,A)?null:ju.round(A.x,A.y)}split(e){const t=[],i=e.events!==void 0,l=new To(e,!0),u=new To(e,!1),d=this.rightSE;this.replaceRightSE(u),t.push(u),t.push(l);const a=new Qs(l,d,this.rings.slice(),this.windings.slice());return To.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),To.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),i&&(l.checkForConsuming(),u.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,i=this.windings.length;t<i;t++)this.windings[t]*=-1}consume(e){let t=this,i=e;for(;t.consumedBy;)t=t.consumedBy;for(;i.consumedBy;)i=i.consumedBy;const l=Qs.compare(t,i);if(l!==0){if(l>0){const u=t;t=i,i=u}if(t.prev===i){const u=t;t=i,i=u}for(let u=0,d=i.rings.length;u<d;u++){const a=i.rings[u],_=i.windings[u],v=t.rings.indexOf(a);v===-1?(t.rings.push(a),t.windings.push(_)):t.windings[v]+=_}i.rings=null,i.windings=null,i.consumedBy=t,i.leftSE.consumedBy=t.leftSE,i.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,i=this._afterState.windings,l=this._afterState.multiPolys;for(let a=0,_=this.rings.length;a<_;a++){const v=this.rings[a],k=this.windings[a],S=t.indexOf(v);S===-1?(t.push(v),i.push(k)):i[S]+=k}const u=[],d=[];for(let a=0,_=t.length;a<_;a++){if(i[a]===0)continue;const v=t[a],k=v.poly;if(d.indexOf(k)===-1)if(v.isExterior)u.push(k);else{d.indexOf(k)===-1&&d.push(k);const S=u.indexOf(v.poly);S!==-1&&u.splice(S,1)}}for(let a=0,_=u.length;a<_;a++){const v=u[a].multiPoly;l.indexOf(v)===-1&&l.push(v)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(No.type){case"union":{const i=e.length===0,l=t.length===0;this._isInResult=i!==l;break}case"intersection":{let i,l;e.length<t.length?(i=e.length,l=t.length):(i=t.length,l=e.length),this._isInResult=l===No.numMultiPolys&&i<l;break}case"xor":{const i=Math.abs(e.length-t.length);this._isInResult=i%2===1;break}case"difference":{const i=l=>l.length===1&&l[0].isSubject;this._isInResult=i(e)!==i(t);break}default:throw new Error(`Unrecognized operation type found ${No.type}`)}return this._isInResult}}class b_{constructor(e,t,i){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=i,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const l=ju.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};let u=l;for(let d=1,a=e.length;d<a;d++){if(typeof e[d][0]!="number"||typeof e[d][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let _=ju.round(e[d][0],e[d][1]);_.x===u.x&&_.y===u.y||(this.segments.push(Qs.fromRing(u,_,this)),_.x<this.bbox.ll.x&&(this.bbox.ll.x=_.x),_.y<this.bbox.ll.y&&(this.bbox.ll.y=_.y),_.x>this.bbox.ur.x&&(this.bbox.ur.x=_.x),_.y>this.bbox.ur.y&&(this.bbox.ur.y=_.y),u=_)}(l.x!==u.x||l.y!==u.y)&&this.segments.push(Qs.fromRing(u,l,this))}getSweepEvents(){const e=[];for(let t=0,i=this.segments.length;t<i;t++){const l=this.segments[t];e.push(l.leftSE),e.push(l.rightSE)}return e}}class sk{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new b_(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let i=1,l=e.length;i<l;i++){const u=new b_(e[i],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,i=this.interiorRings.length;t<i;t++){const l=this.interiorRings[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class w_{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let i=0,l=e.length;i<l;i++){const u=new sk(e[i],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const l=this.polys[t].getSweepEvents();for(let u=0,d=l.length;u<d;u++)e.push(l[u])}return e}}class Td{static factory(e){const t=[];for(let i=0,l=e.length;i<l;i++){const u=e[i];if(!u.isInResult()||u.ringOut)continue;let d=null,a=u.leftSE,_=u.rightSE;const v=[a],k=a.point,S=[];for(;d=a,a=_,v.push(a),a.point!==k;)for(;;){const E=a.getAvailableLinkedEvents();if(E.length===0){const R=v[0].point,D=v[v.length-1].point;throw new Error(`Unable to complete output ring starting at [${R.x}, ${R.y}]. Last matching segment found ends at [${D.x}, ${D.y}].`)}if(E.length===1){_=E[0].otherSE;break}let A=null;for(let R=0,D=S.length;R<D;R++)if(S[R].point===a.point){A=R;break}if(A!==null){const R=S.splice(A)[0],D=v.splice(R.index);D.unshift(D[0].otherSE),t.push(new Td(D.reverse()));continue}S.push({index:v.length,point:a.point});const z=a.getLeftmostComparator(d);_=E.sort(z)[0].otherSE;break}t.push(new Td(v))}return t}constructor(e){this.events=e;for(let t=0,i=e.length;t<i;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let v=1,k=this.events.length-1;v<k;v++){const S=this.events[v].point,E=this.events[v+1].point;__(S,e,E)!==0&&(t.push(S),e=S)}if(t.length===1)return null;const i=t[0],l=t[1];__(i,e,l)===0&&t.shift(),t.push(t[0]);const u=this.isExteriorRing()?1:-1,d=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,_=[];for(let v=d;v!=a;v+=u)_.push([t[v].x,t[v].y]);return _}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let l=1,u=this.events.length;l<u;l++){const d=this.events[l];To.compare(e,d)>0&&(e=d)}let t=e.segment.prevInResult(),i=t?t.prevInResult():null;for(;;){if(!t)return null;if(!i)return t.ringOut;if(i.ringOut!==t.ringOut)return i.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=i.prevInResult(),i=t?t.prevInResult():null}}}class x_{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,i=this.interiorRings.length;t<i;t++){const l=this.interiorRings[t].getGeom();l!==null&&e.push(l)}return e}}class ak{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,i=this.polys.length;t<i;t++){const l=this.polys[t].getGeom();l!==null&&e.push(l)}return e}_composePolys(e){const t=[];for(let i=0,l=e.length;i<l;i++){const u=e[i];if(!u.poly)if(u.isExteriorRing())t.push(new x_(u));else{const d=u.enclosingRing();d.poly||t.push(new x_(d)),d.poly.addInterior(u)}}return t}}class lk{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Qs.compare;this.queue=e,this.tree=new Vp(t),this.segments=[]}process(e){const t=e.segment,i=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),i;const l=e.isLeft?this.tree.add(t):this.tree.find(t);if(!l)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let u=l,d=l,a,_;for(;a===void 0;)u=this.tree.prev(u),u===null?a=null:u.key.consumedBy===void 0&&(a=u.key);for(;_===void 0;)d=this.tree.next(d),d===null?_=null:d.key.consumedBy===void 0&&(_=d.key);if(e.isLeft){let v=null;if(a){const S=a.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(v=S),!a.isAnEndpoint(S))){const E=this._splitSafely(a,S);for(let A=0,z=E.length;A<z;A++)i.push(E[A])}}let k=null;if(_){const S=_.getIntersection(t);if(S!==null&&(t.isAnEndpoint(S)||(k=S),!_.isAnEndpoint(S))){const E=this._splitSafely(_,S);for(let A=0,z=E.length;A<z;A++)i.push(E[A])}}if(v!==null||k!==null){let S=null;v===null?S=k:k===null?S=v:S=To.comparePoints(v,k)<=0?v:k,this.queue.remove(t.rightSE),i.push(t.rightSE);const E=t.split(S);for(let A=0,z=E.length;A<z;A++)i.push(E[A])}i.length>0?(this.tree.remove(t),i.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&_){const v=a.getIntersection(_);if(v!==null){if(!a.isAnEndpoint(v)){const k=this._splitSafely(a,v);for(let S=0,E=k.length;S<E;S++)i.push(k[S])}if(!_.isAnEndpoint(v)){const k=this._splitSafely(_,v);for(let S=0,E=k.length;S<E;S++)i.push(k[S])}}}this.tree.remove(t)}return i}_splitSafely(e,t){this.tree.remove(e);const i=e.rightSE;this.queue.remove(i);const l=e.split(t);return l.push(i),e.consumedBy===void 0&&this.tree.add(e),l}}const k_=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,ck=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class uk{run(e,t,i){No.type=e,ju.reset();const l=[new w_(t,!0)];for(let k=0,S=i.length;k<S;k++)l.push(new w_(i[k],!1));if(No.numMultiPolys=l.length,No.type==="difference"){const k=l[0];let S=1;for(;S<l.length;)vp(l[S].bbox,k.bbox)!==null?S++:l.splice(S,1)}if(No.type==="intersection")for(let k=0,S=l.length;k<S;k++){const E=l[k];for(let A=k+1,z=l.length;A<z;A++)if(vp(E.bbox,l[A].bbox)===null)return[]}const u=new Vp(To.compare);for(let k=0,S=l.length;k<S;k++){const E=l[k].getSweepEvents();for(let A=0,z=E.length;A<z;A++)if(u.insert(E[A]),u.size>k_)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const d=new lk(u);let a=u.size,_=u.pop();for(;_;){const k=_.key;if(u.size===a){const E=k.segment;throw new Error(`Unable to pop() ${k.isLeft?"left":"right"} SweepEvent [${k.point.x}, ${k.point.y}] from segment #${E.id} [${E.leftSE.point.x}, ${E.leftSE.point.y}] -> [${E.rightSE.point.x}, ${E.rightSE.point.y}] from queue.`)}if(u.size>k_)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(d.segments.length>ck)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const S=d.process(k);for(let E=0,A=S.length;E<A;E++){const z=S[E];z.consumedBy===void 0&&u.insert(z)}a=u.size,_=u.pop()}ju.reset();const v=Td.factory(d.segments);return new ak(v).getGeom()}}const No=new uk,hk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return No.run("union",o,t)},dk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return No.run("intersection",o,t)},fk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return No.run("xor",o,t)},pk=function(o){for(var e=arguments.length,t=new Array(e>1?e-1:0),i=1;i<e;i++)t[i-1]=arguments[i];return No.run("difference",o,t)};var N0={union:hk,intersection:dk,xor:fk,difference:pk};function j0(o,e,t){if(o!==null)for(var i,l,u,d,a,_,v,k=0,S=0,E,A=o.type,z=A==="FeatureCollection",R=A==="Feature",D=z?o.features.length:1,B=0;B<D;B++){v=z?o.features[B].geometry:R?o.geometry:o,E=v?v.type==="GeometryCollection":!1,a=E?v.geometries.length:1;for(var O=0;O<a;O++){var j=0,V=0;if(d=E?v.geometries[O]:v,d!==null){_=d.coordinates;var se=d.type;switch(k=0,se){case null:break;case"Point":if(e(_,S,B,j,V)===!1)return!1;S++,j++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(e(_[i],S,B,j,V)===!1)return!1;S++,se==="MultiPoint"&&j++}se==="LineString"&&j++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(l=0;l<_[i].length-k;l++){if(e(_[i][l],S,B,j,V)===!1)return!1;S++}se==="MultiLineString"&&j++,se==="Polygon"&&V++}se==="Polygon"&&j++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(V=0,l=0;l<_[i].length;l++){for(u=0;u<_[i][l].length-k;u++){if(e(_[i][l][u],S,B,j,V)===!1)return!1;S++}V++}j++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(j0(d.geometries[i],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function $p(o,e){var t,i,l,u,d,a,_,v,k,S,E=0,A=o.type==="FeatureCollection",z=o.type==="Feature",R=A?o.features.length:1;for(t=0;t<R;t++){for(a=A?o.features[t].geometry:z?o.geometry:o,v=A?o.features[t].properties:z?o.properties:{},k=A?o.features[t].bbox:z?o.bbox:void 0,S=A?o.features[t].id:z?o.id:void 0,_=a?a.type==="GeometryCollection":!1,d=_?a.geometries.length:1,l=0;l<d;l++){if(u=_?a.geometries[l]:a,u===null){if(e(null,E,v,k,S)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(u,E,v,k,S)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<u.geometries.length;i++)if(e(u.geometries[i],E,v,k,S)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}E++}}function mk(o,e){$p(o,function(t,i,l,u,d){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Ou(t,l,{bbox:u,id:d}),i,0)===!1?!1:void 0}var _;switch(a){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var v=0;v<t.coordinates.length;v++){var k=t.coordinates[v],S={type:_,coordinates:k};if(e(Ou(S,l),i,v)===!1)return!1}})}function gk(o,e={}){const t=[];if($p(o,l=>{t.push(l.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const i=N0.union(t[0],...t.slice(1));return i.length===0?null:i.length===1?Up(i[0],e.properties):F0(i,e.properties)}var U0=gk;function _k(o,e={}){if(o.bbox!=null&&e.recompute!==!0)return o.bbox;const t=[1/0,1/0,-1/0,-1/0];return j0(o,i=>{t[0]>i[0]&&(t[0]=i[0]),t[1]>i[1]&&(t[1]=i[1]),t[2]<i[0]&&(t[2]=i[0]),t[3]<i[1]&&(t[3]=i[1])}),t}var S_=_k;function yk(o){const e=[];if($p(o,l=>{e.push(l.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=o.features[0].properties||{},i=N0.difference(e[0],...e.slice(1));return i.length===0?null:i.length===1?Up(i[0],t):F0(i,t)}var vk=yk;function bk(o){if(!o)throw new Error("geojson is required");var e=[];return mk(o,function(t){e.push(t)}),Nu(e)}var wk=bk;function T_(o,e){const t=vk(Nu([Up([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),o]));if(!t)return;t.properties={isMask:!0};const i=kd(S_(o)),l=(i[2]-i[0])/360/1e3,u=i[0]<-180,d=i[2]>180,a=wk(o);if(a.features.length>1&&(u||d))for(const _ of a.features){const v=kd(S_(_));if(d&&v[0]<-180+l)for(const k of _.geometry.coordinates)for(const S of k)S[0]+=360-l;if(u&&v[2]>180-l)for(const k of _.geometry.coordinates)for(const S of k)S[0]-=360-l}e(Nu([a.features.length<2?o:U0(a)??o,t]))}const C_={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},rd="mtlr-gc-full-geom",E_="mtlr-gc-full-geom-fill",M_="mtlr-gc-full-geom-line";function V0(o,e,t=!0,i=!0,l={},u={},d=C_){let a;const _=[];let v,k,S;function E(){if(!o.loaded){o.once("load",E);return}const D=d?d===!0?C_:d:void 0;if(!(D!=null&&D.fill)&&!(D!=null&&D.line))return;const B=o.getSource(rd);if(B)B.setData(S??Nu([]));else if(S)o.addSource(rd,{type:"geojson",data:S});else return;!o.getLayer(E_)&&D!=null&&D.fill&&o.addLayer({...D==null?void 0:D.fill,id:E_,type:"fill",source:rd}),!o.getLayer(M_)&&D!=null&&D.line&&o.addLayer({...D==null?void 0:D.line,id:M_,type:"line",source:rd})}function A(D){S=D,E()}o.on("styledata",()=>{setTimeout(()=>{S&&E()})});const z=D=>{a==null||a({type:"mapClick",coordinates:[D.lngLat.lng,D.lngLat.lat]})};function R(D=!1){if(!e)throw new Error;const B=document.createElement("div");return D&&B.classList.add("marker-interactive"),new g2({props:{displayIn:"maplibre"},target:B}),new e.Marker({element:B,offset:[1,-13]})}return{setEventHandler(D){D?(a=D,o.on("click",z)):(a=void 0,o.off("click",z))},flyTo(D,B){o.flyTo({center:D,...B?{zoom:B}:{},...l})},fitBounds(D,B,O){o.fitBounds([[D[0],D[1]],[D[2],D[3]]],{padding:B,...O?{maxZoom:O}:{},...u})},indicateReverse(D){o.getCanvasContainer().style.cursor=D?"crosshair":""},setReverseMarker(D){!e||!t||(k?D?k.setLngLat(D):(k.remove(),k=void 0):D&&(t instanceof Function?k=t(o)??void 0:(k=(typeof t=="object"?new e.Marker(t):R()).setLngLat(D).addTo(o),k.getElement().classList.add("marker-reverse"))))},setFeatures(D,B,O){for(const j of _)j.remove();if(_.length=0,A(void 0),!!e){if(B){let j=!1;if(B.geometry.type==="GeometryCollection"){const V=B.geometry.geometries.filter(se=>se.type==="Polygon"||se.type==="MultiPolygon");e:if(V.length>0){const se=U0(Nu(V.map(ce=>Ou(ce))));if(!se)break e;T_({...B,geometry:se.geometry},A),j=!0}else{const se=B.geometry.geometries.filter(ce=>ce.type==="LineString"||ce.type==="MultiLineString");se.length>0&&(A({...B,geometry:{type:"GeometryCollection",geometries:se}}),j=!0)}}if(!j){if(B.geometry.type==="Polygon"||B.geometry.type==="MultiPolygon")T_(B,A);else if(B.geometry.type==="LineString"||B.geometry.type==="MultiLineString"){A(B);return}}if(!O&&B.geometry.type!=="Point")return;if(t instanceof Function){const V=t(o,B);V&&_.push(V)}else t&&_.push(typeof t=="object"?new e.Marker(t):R().setLngLat(B.center).addTo(o))}if(i)for(const j of D??[]){if(j===B)continue;let V;if(i instanceof Function){if(V=i(o,j),!V)continue}else V=(typeof i=="object"?new e.Marker(i):R(!0)).setLngLat(j.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(j.place_type[0]==="reverse"?j.place_name:j.place_name.replace(/,.*/,""))).addTo(o);const se=V.getElement();se.addEventListener("click",ce=>{ce.stopPropagation(),a==null||a({type:"markerClick",id:j.id})}),se.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:j.id}),V.togglePopup()}),se.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:j.id}),V.togglePopup()}),_.push(V)}}},setSelectedMarker(D){v&&v.getElement().classList.toggle("marker-selected",!1),v=D>-1?_[D]:void 0,v==null||v.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const D=o.getCenter();return[o.getZoom(),D.lng,D.lat]}}}function xk(o,e,t){var i,l;class u{constructor(D,B){ho(this,"type"),ho(this,"target"),this.type=B,this.target=D}}class d extends u{constructor(D,B){super(D,"select"),ho(this,"feature"),Object.assign(this,B)}}class a extends u{constructor(D,B){super(D,"featureslisted"),ho(this,"features"),this.features=B}}class _ extends u{constructor(D,B){super(D,"featuresmarked"),ho(this,"features"),this.features=B}}class v extends u{constructor(D,B){super(D,"optionsvisibilitychange"),ho(this,"optionsVisible"),this.optionsVisible=B}}class k extends u{constructor(D,B){super(D,"pick"),ho(this,"feature"),this.feature=B}}class S extends u{constructor(D,B){super(D,"querychange"),ho(this,"query"),this.query=B}}class E extends u{constructor(D,B,O){super(D,"response"),ho(this,"url"),ho(this,"featureCollection"),this.url=B,this.featureCollection=O}}class A extends u{constructor(D,B){super(D,"reversetoggle"),ho(this,"reverse"),this.reverse=B}}class z extends o{constructor(D={}){super(),Zg(this,i),Zg(this,l),Gg(this,l,D)}onAddInt(D){const B=document.createElement("div");B.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:O,showResultMarkers:j,flyTo:V,fullGeometryStyle:se,...ce}=Qn(this,l),Z=typeof V=="boolean"?{}:V,Y={mapController:V0(D,e,O,j,Z,Z,se),flyTo:V===void 0?!0:!!V,apiKey:"",...t==null?void 0:t(D,B),...ce};if(!Y.apiKey)throw new Error("no apiKey provided");return Gg(this,i,new j2({target:B,props:Y})),Qn(this,i).$on("select",ye=>{this.fire(new d(this,ye.detail))}),Qn(this,i).$on("pick",ye=>{this.fire(new k(this,ye.detail.feature))}),Qn(this,i).$on("featureslisted",ye=>{this.fire(new a(this,ye.detail.features))}),Qn(this,i).$on("featuresmarked",ye=>{this.fire(new _(this,ye.detail.features))}),Qn(this,i).$on("response",ye=>{this.fire(new E(this,ye.detail.url,ye.detail.featureCollection))}),Qn(this,i).$on("optionsvisibilitychange",ye=>{this.fire(new v(this,ye.detail.optionsVisible))}),Qn(this,i).$on("reversetoggle",ye=>{this.fire(new A(this,ye.detail.reverse))}),Qn(this,i).$on("querychange",ye=>{this.fire(new S(this,ye.detail.query))}),B}on(D,B){return super.on(D,B)}once(D,B){return super.once(D,B)}off(D,B){return super.off(D,B)}listens(D){return super.listens(D)}setOptions(D){var B;Object.assign(Qn(this,l),D);const{marker:O,showResultMarkers:j,flyTo:V,fullGeometryStyle:se,...ce}=Qn(this,l);(B=Qn(this,i))==null||B.$set(ce)}setQuery(D,B=!0){var O;(O=Qn(this,i))==null||O.setQuery(D,B)}clearMap(){var D;(D=Qn(this,i))==null||D.clearMap()}clearList(){var D;(D=Qn(this,i))==null||D.clearList()}setReverseMode(D){var B;(B=Qn(this,i))==null||B.$set({reverseActive:D})}focus(){var D;(D=Qn(this,i))==null||D.focus()}blur(){var D;(D=Qn(this,i))==null||D.blur()}onRemove(){var D;(D=Qn(this,i))==null||D.$destroy()}}return i=new WeakMap,l=new WeakMap,{MapLibreBasedGeocodingControl:z,events:{SelectEvent:d,FeaturesListedEvent:a,FeaturesMarkedEvent:_,OptionsVisibilityChangeEvent:v,PickEvent:k,QueryChangeEvent:S,ResponseEvent:E,ReverseToggleEvent:A}}}const{MapLibreBasedGeocodingControl:GE,events:sa}=xk(Ts.Evented,_b);sa.SelectEvent;sa.FeaturesListedEvent;sa.FeaturesMarkedEvent;sa.OptionsVisibilityChangeEvent;sa.PickEvent;sa.QueryChangeEvent;sa.ResponseEvent;sa.ReverseToggleEvent;function kk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),ke(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ke(e,"viewBox","0 0 14 14"),ke(e,"width","13"),ke(e,"height","13"),ke(e,"class","svelte-en2qvf")},m(i,l){le(i,e,l),X(e,t)},p:Lt,i:Lt,o:Lt,d(i){i&&ae(e)}}}class $0 extends qt{constructor(e){super(),$t(this,e,null,kk,Bt,{})}}function Sk(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),ke(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ke(e,"viewBox","0 0 30 30"),ke(e,"fill","none"),ke(e,"xmlns","http://www.w3.org/2000/svg"),ke(e,"class","svelte-d2loi5")},m(i,l){le(i,e,l),X(e,t)},p:Lt,i:Lt,o:Lt,d(i){i&&ae(e)}}}class q0 extends qt{constructor(e){super(),$t(this,e,null,Sk,Bt,{})}}function Tk(o){let e,t;return{c(){e=oe("img"),Tn(e.src,t=o[3]+"area.svg")||ke(e,"src",t),ke(e,"alt",o[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){le(i,e,l)},p(i,l){l&8&&!Tn(e.src,t=i[3]+"area.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&ae(e)}}}function Ck(o){let e,t;return{c(){e=oe("img"),Tn(e.src,t=o[3]+"reverse.svg")||ke(e,"src",t),ke(e,"alt",o[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){le(i,e,l)},p(i,l){l&8&&!Tn(e.src,t=i[3]+"reverse.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&ae(e)}}}function Ek(o){let e,t;return{c(){e=oe("img"),Tn(e.src,t=o[3]+"poi.svg")||ke(e,"src",t),ke(e,"alt",o[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){le(i,e,l)},p(i,l){l&8&&!Tn(e.src,t=i[3]+"poi.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&ae(e)}}}function Mk(o){let e,t;return{c(){e=oe("img"),Tn(e.src,t=o[3]+"postal_code.svg")||ke(e,"src",t),ke(e,"alt",o[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){le(i,e,l)},p(i,l){l&8&&!Tn(e.src,t=i[3]+"postal_code.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&ae(e)}}}function Ik(o){let e,t;return{c(){e=oe("img"),Tn(e.src,t=o[3]+"street.svg")||ke(e,"src",t),ke(e,"alt",o[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){le(i,e,l)},p(i,l){l&8&&!Tn(e.src,t=i[3]+"street.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&ae(e)}}}function Lk(o){let e,t;return{c(){e=oe("img"),Tn(e.src,t=o[3]+"road.svg")||ke(e,"src",t),ke(e,"alt",o[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){le(i,e,l)},p(i,l){l&8&&!Tn(e.src,t=i[3]+"road.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&ae(e)}}}function Ak(o){let e,t;return{c(){e=oe("img"),Tn(e.src,t=o[3]+"housenumber.svg")||ke(e,"src",t),ke(e,"alt",o[6]),ke(e,"class","svelte-ltkwvy")},m(i,l){le(i,e,l)},p(i,l){l&8&&!Tn(e.src,t=i[3]+"housenumber.svg")&&ke(e,"src",t),l&64&&ke(e,"alt",i[6])},d(i){i&&ae(e)}}}function Pk(o){let e,t,i,l;return{c(){e=oe("img"),Tn(e.src,t=o[5])||ke(e,"src",t),ke(e,"alt",o[4]),ke(e,"class","svelte-ltkwvy")},m(u,d){le(u,e,d),i||(l=xt(e,"error",o[14]),i=!0)},p(u,d){d&32&&!Tn(e.src,t=u[5])&&ke(e,"src",t),d&16&&ke(e,"alt",u[4])},d(u){u&&ae(e),i=!1,l()}}}function I_(o){let e,t;return{c(){e=oe("span"),t=Xe(o[6]),ke(e,"class","secondary svelte-ltkwvy")},m(i,l){le(i,e,l),X(e,t)},p(i,l){l&64&&xi(t,i[6])},d(i){i&&ae(e)}}}function zk(o){let e,t,i,l,u,d,a,_,v,k=(o[7]?o[0].place_name:o[0].place_name.replace(/,.*/,""))+"",S,E,A=o[2]==="always"||o[2]!=="never"&&!o[0].address&&!o[0].id.startsWith("road.")&&!o[0].id.startsWith("address.")&&!o[0].id.startsWith("postal_code.")&&(!o[0].id.startsWith("poi.")||!o[5])&&!o[7],z,R,D=(o[7]?"":o[0].place_name.replace(/[^,]*,?\s*/,""))+"",B,O,j;function V(Y,ye){return ye&1&&(t=null),ye&1&&(i=null),ye&1&&(l=null),ye&1&&(u=null),Y[5]?Pk:Y[0].address?Ak:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?Lk:(i==null&&(i=!!Y[0].id.startsWith("address.")),i?Ik:(l==null&&(l=!!Y[0].id.startsWith("postal_code.")),l?Mk:(u==null&&(u=!!Y[0].id.startsWith("poi.")),u?Ek:Y[7]?Ck:Tk))))}let se=V(o,-1),ce=se(o),Z=A&&I_(o);return{c(){e=oe("li"),ce.c(),d=ze(),a=oe("span"),_=oe("span"),v=oe("span"),S=Xe(k),E=ze(),Z&&Z.c(),z=ze(),R=oe("span"),B=Xe(D),ke(v,"class","primary svelte-ltkwvy"),ke(_,"class","svelte-ltkwvy"),ke(R,"class","line2 svelte-ltkwvy"),ke(a,"class","texts svelte-ltkwvy"),ke(e,"tabindex","0"),ke(e,"data-selected",o[1]),ke(e,"class","svelte-ltkwvy"),lr(e,"selected",o[1])},m(Y,ye){le(Y,e,ye),ce.m(e,null),X(e,d),X(e,a),X(a,_),X(_,v),X(v,S),X(_,E),Z&&Z.m(_,null),X(a,z),X(a,R),X(R,B),O||(j=[xt(e,"mouseenter",o[12]),xt(e,"focus",o[13])],O=!0)},p(Y,[ye]){se===(se=V(Y,ye))&&ce?ce.p(Y,ye):(ce.d(1),ce=se(Y),ce&&(ce.c(),ce.m(e,d))),ye&1&&k!==(k=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&xi(S,k),ye&37&&(A=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),A?Z?Z.p(Y,ye):(Z=I_(Y),Z.c(),Z.m(_,null)):Z&&(Z.d(1),Z=null),ye&1&&D!==(D=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&xi(B,D),ye&2&&ke(e,"data-selected",Y[1]),ye&2&&lr(e,"selected",Y[1])},i:Lt,o:Lt,d(Y){Y&&ae(e),ce.d(),Z&&Z.d(),O=!1,on(j)}}}function Dk(o,e,t){var j;let i,l,{feature:u}=e,{selected:d=!1}=e,{showPlaceType:a}=e,{missingIconsCache:_}=e,{iconsBaseUrl:v}=e;const k=(j=u.properties)==null?void 0:j.categories;let S,E,A=0,z=u.place_type[0]==="reverse";function R(){E&&_.add(E),t(10,A++,A)}function D(V){ui.call(this,o,V)}function B(V){ui.call(this,o,V)}const O=()=>R();return o.$$set=V=>{"feature"in V&&t(0,u=V.feature),"selected"in V&&t(1,d=V.selected),"showPlaceType"in V&&t(2,a=V.showPlaceType),"missingIconsCache"in V&&t(9,_=V.missingIconsCache),"iconsBaseUrl"in V&&t(3,v=V.iconsBaseUrl)},o.$$.update=()=>{var V,se,ce,Z;if(o.$$.dirty&3640)do t(11,i--,i),t(4,S=k==null?void 0:k[i]),t(5,E=S?v+S.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!E||_.has(E)));o.$$.dirty&1&&t(6,l=((se=(V=u.properties)==null?void 0:V.categories)==null?void 0:se.join(", "))??((Z=(ce=u.properties)==null?void 0:ce.place_type_name)==null?void 0:Z[0])??u.place_type[0])},t(11,i=(k==null?void 0:k.length)??0),[u,d,a,v,S,E,l,z,R,_,A,i,D,B,O]}class Rk extends qt{constructor(e){super(),$t(this,e,Dk,zk,Bt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function Bk(o){let e;return{c(){e=oe("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ke(e,"class","svelte-7cmwmc")},m(t,i){le(t,e,i)},p:Lt,i:Lt,o:Lt,d(t){t&&ae(e)}}}class Fk extends qt{constructor(e){super(),$t(this,e,null,Bk,Bt,{})}}function Ok(o){let e,t;return{c(){e=xs("svg"),t=xs("path"),ke(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ke(e,"viewBox","0 0 60.006 21.412"),ke(e,"width","14"),ke(e,"height","20"),ke(e,"class","svelte-en2qvf")},m(i,l){le(i,e,l),X(e,t)},p:Lt,i:Lt,o:Lt,d(i){i&&ae(e)}}}class Nk extends qt{constructor(e){super(),$t(this,e,null,Ok,Bt,{})}}function jk(o){let e,t,i;return{c(){e=xs("svg"),t=xs("circle"),i=xs("path"),ke(t,"cx","4.789"),ke(t,"cy","4.787"),ke(t,"r","3.85"),ke(t,"class","svelte-1aq105l"),ke(i,"d","M12.063 12.063 7.635 7.635"),ke(i,"class","svelte-1aq105l"),ke(e,"xmlns","http://www.w3.org/2000/svg"),ke(e,"width","13"),ke(e,"height","13"),ke(e,"viewBox","0 0 13 13"),ke(e,"class","svelte-1aq105l")},m(l,u){le(l,e,u),X(e,t),X(e,i)},p:Lt,i:Lt,o:Lt,d(l){l&&ae(e)}}}class Uk extends qt{constructor(e){super(),$t(this,e,null,jk,Bt,{})}}function Vk(o,e,t){const i=e[1],l=e[0],u=i-l;return o===i&&t?o:((o-l)%u+u)%u+l}function L_(o){const e=[...o];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let fu;async function $k(o,e,t){const i=o==null?void 0:o.getCenterAndZoom();for(const l of e??[])if(!(i&&(l.minZoom!=null&&l.minZoom>i[0]||l.maxZoom!=null&&l.maxZoom<i[0]))){if(l.type==="fixed")return l.coordinates.join(",");e:if(l.type==="client-geolocation"){if(fu&&l.cachedLocationExpiry&&fu.time+l.cachedLocationExpiry>Date.now()){if(!fu.coords)break e;return fu.coords}let u;try{return u=await new Promise((d,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(_=>{d([_.coords.longitude,_.coords.latitude].map(v=>v.toFixed(6)).join(","))},_=>{a(_)},l)}),u}catch{}finally{l.cachedLocationExpiry&&(fu={time:Date.now(),coords:u})}if(t.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(i&&l.type==="map-center")return i[1].toFixed(6)+","+i[2].toFixed(6)}}const qk=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,A_=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,P_=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,z_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,D_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,R_=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function Zk(o){if(!["DMS","DM","DD"].includes(o))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(A=>Number(A.trim())),t=Number(e[0]),i=Number(e[1]),l=Math.abs(t),u=Math.abs(i),d=t>0?"N":"S",a=i>0?"E":"W";let _;o=="DD"&&(_=`${l} ${d}, ${u} ${a}`);const v=Math.floor(l),k=Math.floor(u),S=(l-v)*60,E=(u-k)*60;if(o=="DM"){let A=B_(S,3).toFixed(3).padStart(6,"0"),z=B_(E,3).toFixed(3).padStart(6,"0");A.endsWith(".000")&&z.endsWith(".000")&&(A=A.replace(/\.000$/,""),z=z.replace(/\.000$/,"")),_=`${v} ${A}' ${d}, ${k} ${z}' ${a}`}if(o=="DMS"){const A=Math.floor(S),z=Math.floor(E);let R=((S-A)*60).toFixed(1).padStart(4,"0"),D=((E-z)*60).toFixed(1).padStart(4,"0");const B=A.toString().padStart(2,"0"),O=z.toString().padStart(2,"0");R.endsWith(".0")&&D.endsWith(".0")&&(R=R.replace(/\.0$/,""),D=D.replace(/\.0$/,"")),_=`${v} ${B}' ${R}" ${d}, ${k} ${O}' ${D}" ${a}`}return _}else throw new Error("no decimal coordinates to convert")}function B_(o,e){const t=Math.pow(10,e);return Math.round((o+Number.EPSILON)*t)/t}function qp(o,e){e||(e=5),o=o.replace(/\s+/g," ").trim();let t=null,i=null,l="",u="",d=null,a=[],_=!1;if(qk.test(o))throw new Error("invalid coordinate value");if(A_.test(o))if(a=A_.exec(o),_=pu(a),_)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),i=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(i*=-1),d="DM";else throw new Error("invalid coordinate format");else if(P_.test(o))if(a=P_.exec(o),_=pu(a),_){if(t=a[2],i=a[6],t.includes(",")&&(t=t.replace(",",".")),i.includes(",")&&(i=i.replace(",",".")),d="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(i))==Number(i))throw new Error("integer only coordinate provided");a[1]?(l=a[1],u=a[5]):a[4]&&(l=a[4],u=a[8])}else throw new Error("invalid decimal coordinate format");else if(z_.test(o))if(a=z_.exec(o),_=pu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[9])),a[11]&&(i+=a[11]/60),a[13]&&(i+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(i=-1*i),a[1]?(l=a[1],u=a[8]):a[7]&&(l=a[7],u=a[14]);else throw new Error("invalid DMS coordinates format");else if(D_.test(o))if(a=D_.exec(o),_=pu(a),_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,d="DM"),a[6]&&(t+=a[6]/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12]/60),a[14]&&(i+=a[14]/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid DMS coordinates format");else if(R_.test(o)){if(a=R_.exec(o),_=pu(a),a.filter(v=>v).length<=5)throw new Error("invalid coordinates format");if(_)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,d="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,d="DMS"),parseInt(a[2])<0&&(t=-1*t),i=Math.abs(parseInt(a[10])),a[12]&&(i+=a[12].replace(",",".")/60),a[14]&&(i+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(i=-1*i),a[1]?(l=a[1],u=a[9]):a[8]&&(l=a[8],u=a[16]);else throw new Error("invalid coordinates format")}if(_){if(Math.abs(i)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(l&&!u||!l&&u)throw new Error("invalid coordinates value");if(l&&l==u)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),i.toString().includes(",")&&(i=i.replace(",","."));let v=/S|SOUTH/i;v.test(l)&&t>0&&(t=-1*t),v=/W|WEST/i,v.test(u)&&i>0&&(i=-1*i);const k=a[0].trim();let S,E;const A=/[,/;\u0020]/g,z=k.match(A);if(z==null){const B=Math.floor(o.length/2);S=k.substring(0,B).trim(),E=k.substring(B).trim()}else{let B;z.length%2==1?B=Math.floor(z.length/2):B=z.length/2-1;let O=0;if(B==0)O=k.indexOf(z[0]),S=k.substring(0,O).trim(),E=k.substring(O+1).trim();else{let j=0,V=0;for(;j<=B;)O=k.indexOf(z[j],V),V=O+1,j++;S=k.substring(0,O).trim(),E=k.substring(O+1).trim()}}const R=S.split(".");if(R.length==2&&R[1]==0&&R[1].length!=2)throw new Error("invalid coordinates format");const D=E.split(".");if(D.length==2&&D[1]==0&&D[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(S)||/^\d+$/.test(E))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),i=Number(Number(i).toFixed(e)),Object.freeze({verbatimCoordinates:k,verbatimLatitude:S,verbatimLongitude:E,decimalLatitude:t,decimalLongitude:i,decimalCoordinates:`${t},${i}`,originalFormat:d,closeEnough:Gk,toCoordinateFormat:Zk})}else throw new Error("coordinates pattern match failed")}function pu(o){if(!isNaN(o[0]))return!1;const e=[...o];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,i=/[eastsouthnorthwest]+/i,l=e.length/2;for(let u=0;u<l;u++){const d=e[u],a=e[u+l],_=t.test(d)&&t.test(a),v=i.test(d)&&i.test(a),k=d==a;if(!(d==null&&a==null)){if(d==null||a==null)return!1;if(_||v||k)continue;return!1}}return!0}function F_(o,e){const t=Math.abs(o-e);return Number(t.toFixed(6))<=1e-5}function Gk(o){if(!o)throw new Error("coords must be provided");if(o.includes(",")){const e=o.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return F_(this.decimalLatitude,Number(e[0]))&&F_(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const Wk=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});qp.to=Wk;const Hk=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],Xk={decimalLatitude:40.123,decimalLongitude:-74.123},Kk=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],Jk=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function Yk(){const o=[];return Hk.forEach(e=>{e.decimalLatitude?o.push(e):o.push({...e,...Xk})}),[...o,...Kk,...Jk]}const Qk=Yk();qp.formats=Qk.map(o=>o.verbatimCoordinates);const e4=qp;function O_(o,e,t){const i=o.slice();return i[84]=e[t],i[86]=t,i}function N_(o){let e,t;return e=new Fk({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function j_(o){let e,t,i,l,u;return t=new Nk({}),{c(){e=oe("button"),Ie(t.$$.fragment),ke(e,"type","button"),ke(e,"title",o[9]),ke(e,"class","svelte-bz0zu3"),lr(e,"active",o[0])},m(d,a){le(d,e,a),Ee(t,e,null),i=!0,l||(u=xt(e,"click",o[69]),l=!0)},p(d,a){(!i||a[0]&512)&&ke(e,"title",d[9]),(!i||a[0]&1)&&lr(e,"active",d[0])},i(d){i||(Q(t.$$.fragment,d),i=!0)},o(d){re(t.$$.fragment,d),i=!1},d(d){d&&ae(e),Me(t),l=!1,u()}}}function t4(o){let e,t=[],i=new Map,l,u,d,a=Kn(o[14]);const _=v=>v[84].id+(v[84].address?","+v[84].address:"");for(let v=0;v<a.length;v+=1){let k=O_(o,a,v),S=_(k);i.set(S,t[v]=U_(S,k))}return{c(){e=oe("ul");for(let v=0;v<t.length;v+=1)t[v].c();ke(e,"class","options svelte-bz0zu3")},m(v,k){le(v,e,k);for(let S=0;S<t.length;S+=1)t[S]&&t[S].m(e,null);l=!0,u||(d=[xt(e,"mouseleave",o[73]),xt(e,"blur",o[74])],u=!0)},p(v,k){k[0]&17880064&&(a=Kn(v[14]),gi(),t=ob(t,k,_,1,v,a,i,e,rb,U_,null,O_),_i())},i(v){if(!l){for(let k=0;k<a.length;k+=1)Q(t[k]);l=!0}},o(v){for(let k=0;k<t.length;k+=1)re(t[k]);l=!1},d(v){v&&ae(e);for(let k=0;k<t.length;k+=1)t[k].d();u=!1,on(d)}}}function i4(o){let e,t,i,l,u,d;return t=new q0({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),l=oe("div"),u=Xe(o[7]),ke(l,"class","svelte-bz0zu3"),ke(e,"class","no-results svelte-bz0zu3")},m(a,_){le(a,e,_),Ee(t,e,null),X(e,i),X(e,l),X(l,u),d=!0},p(a,_){(!d||_[0]&128)&&xi(u,a[7])},i(a){d||(Q(t.$$.fragment,a),d=!0)},o(a){re(t.$$.fragment,a),d=!1},d(a){a&&ae(e),Me(t)}}}function n4(o){let e="",t;return{c(){t=Xe(e)},m(i,l){le(i,t,l)},p:Lt,i:Lt,o:Lt,d(i){i&&ae(t)}}}function r4(o){let e,t,i,l,u,d,a,_,v,k,S;return t=new q0({}),_=new $0({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),l=oe("div"),u=Xe(o[6]),d=ze(),a=oe("button"),Ie(_.$$.fragment),ke(l,"class","svelte-bz0zu3"),ke(a,"class","svelte-bz0zu3"),ke(e,"class","error svelte-bz0zu3")},m(E,A){le(E,e,A),Ee(t,e,null),X(e,i),X(e,l),X(l,u),X(e,d),X(e,a),Ee(_,a,null),v=!0,k||(S=xt(a,"click",o[70]),k=!0)},p(E,A){(!v||A[0]&64)&&xi(u,E[6])},i(E){v||(Q(t.$$.fragment,E),Q(_.$$.fragment,E),v=!0)},o(E){re(t.$$.fragment,E),re(_.$$.fragment,E),v=!1},d(E){E&&ae(e),Me(t),Me(_),k=!1,S()}}}function U_(o,e){let t,i,l;function u(){return e[71](e[86])}function d(){return e[72](e[84])}return i=new Rk({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),i.$on("mouseenter",u),i.$on("focus",d),{key:o,first:null,c(){t=En(),Ie(i.$$.fragment),this.first=t},m(a,_){le(a,t,_),Ee(i,a,_),l=!0},p(a,_){e=a;const v={};_[0]&16384&&(v.feature=e[84]),_[0]&1024&&(v.showPlaceType=e[10]),_[0]&49152&&(v.selected=e[15]===e[86]),_[0]&4096&&(v.iconsBaseUrl=e[12]),i.$set(v)},i(a){l||(Q(i.$$.fragment,a),l=!0)},o(a){re(i.$$.fragment,a),l=!1},d(a){a&&ae(t),Me(i,a)}}}function o4(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R,D,B,O,j,V,se,ce=!1;u=new Uk({}),S=new $0({});let Z=o[19]&&N_(),Y=o[5]==="button"&&j_(o);const ye=o[61].default,Oe=Bi(ye,o,o[60],null),ne=[r4,n4,i4,t4],ve=[];function Je(Le,et){var bt,pt;return Le[18]?0:Le[16]?((bt=Le[14])==null?void 0:bt.length)===0?2:Le[16]&&((pt=Le[14])!=null&&pt.length)?3:-1:1}return~(D=Je(o))&&(B=ve[D]=ne[D](o)),{c(){e=ze(),t=oe("form"),i=oe("div"),l=oe("button"),Ie(u.$$.fragment),d=ze(),a=oe("input"),_=ze(),v=oe("div"),k=oe("button"),Ie(S.$$.fragment),E=ze(),Z&&Z.c(),A=ze(),Y&&Y.c(),z=ze(),Oe&&Oe.c(),R=ze(),B&&B.c(),ke(l,"class","search-button svelte-bz0zu3"),ke(l,"type","button"),ke(a,"placeholder",o[8]),ke(a,"aria-label",o[8]),ke(a,"class","svelte-bz0zu3"),ke(k,"type","button"),ke(k,"title",o[3]),ke(k,"class","svelte-bz0zu3"),ke(v,"class","clear-button-container svelte-bz0zu3"),lr(v,"displayable",o[1]!==""),ke(i,"class","input-group svelte-bz0zu3"),ke(t,"tabindex","0"),ke(t,"class",O=gd(o[2])+" svelte-bz0zu3"),lr(t,"can-collapse",o[4]&&o[1]==="")},m(Le,et){le(Le,e,et),le(Le,t,et),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),o[63](a),Fn(a,o[1]),X(i,_),X(i,v),X(v,k),Ee(S,k,null),X(v,E),Z&&Z.m(v,null),X(i,A),Y&&Y.m(i,null),X(i,z),Oe&&Oe.m(i,null),X(t,R),~D&&ve[D].m(t,null),j=!0,V||(se=[xt(l,"click",o[62]),xt(a,"input",o[64]),xt(a,"focus",o[65]),xt(a,"blur",o[66]),xt(a,"keydown",o[22]),xt(a,"input",o[67]),xt(k,"click",o[68]),xt(t,"submit",Cp(o[21]))],V=!0)},p(Le,et){(!j||et[0]&256)&&ke(a,"placeholder",Le[8]),(!j||et[0]&256)&&ke(a,"aria-label",Le[8]),et[0]&2&&a.value!==Le[1]&&Fn(a,Le[1]),(!j||et[0]&8)&&ke(k,"title",Le[3]),Le[19]?Z?et[0]&524288&&Q(Z,1):(Z=N_(),Z.c(),Q(Z,1),Z.m(v,null)):Z&&(gi(),re(Z,1,1,()=>{Z=null}),_i()),(!j||et[0]&2)&&lr(v,"displayable",Le[1]!==""),Le[5]==="button"?Y?(Y.p(Le,et),et[0]&32&&Q(Y,1)):(Y=j_(Le),Y.c(),Q(Y,1),Y.m(i,z)):Y&&(gi(),re(Y,1,1,()=>{Y=null}),_i()),Oe&&Oe.p&&(!j||et[1]&536870912)&&Oi(Oe,ye,Le,Le[60],j?Fi(ye,Le[60],et,null):Ni(Le[60]),null);let bt=D;D=Je(Le),D===bt?~D&&ve[D].p(Le,et):(B&&(gi(),re(ve[bt],1,1,()=>{ve[bt]=null}),_i()),~D?(B=ve[D],B?B.p(Le,et):(B=ve[D]=ne[D](Le),B.c()),Q(B,1),B.m(t,null)):B=null),(!j||et[0]&4&&O!==(O=gd(Le[2])+" svelte-bz0zu3"))&&ke(t,"class",O),(!j||et[0]&22)&&lr(t,"can-collapse",Le[4]&&Le[1]==="")},i(Le){j||(Q(ce),Q(u.$$.fragment,Le),Q(S.$$.fragment,Le),Q(Z),Q(Y),Q(Oe,Le),Q(B),j=!0)},o(Le){re(ce),re(u.$$.fragment,Le),re(S.$$.fragment,Le),re(Z),re(Y),re(Oe,Le),re(B),j=!1},d(Le){Le&&(ae(e),ae(t)),Me(u),o[63](null),Me(S),Z&&Z.d(),Y&&Y.d(),Oe&&Oe.d(Le),~D&&ve[D].d(),V=!1,on(se)}}}function s4(o,e,t){let i,l,{$$slots:u={},$$scope:d}=e;const a={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:_=void 0}=e,{apiKey:v}=e,{bbox:k=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:E=!1}=e,{collapsed:A=!1}=e,{country:z=void 0}=e,{debounceSearch:R=200}=e,{enableReverse:D="never"}=e,{errorMessage:B="Something went wrong"}=e,{filter:O=()=>!0}=e,{flyTo:j=!0}=e,{fuzzyMatch:V=!0}=e,{language:se=void 0}=e,{limit:ce=void 0}=e,{mapController:Z=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:ye="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Oe="Search"}=e,{proximity:ne=[{type:"server-geolocation"}]}=e,{reverseActive:ve=D==="always"}=e,{reverseButtonTitle:Je="toggle reverse geocoding"}=e,{searchValue:Le=""}=e,{pickedResultStyle:et="full-geometry"}=e,{showPlaceType:bt="if-needed"}=e,{showResultsWhileTyping:pt=!0}=e,{selectFirst:at=!0}=e,{flyToSelected:Xt=!1}=e,{markerOnSelected:ni=!0}=e,{types:Nt=void 0}=e,{exhaustiveReverseGeocoding:zt=!1}=e,{excludeTypes:Yt=!1}=e,{zoom:It=a}=e,{apiUrl:ti="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Zt={}}=e,{iconsBaseUrl:hi="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:ki=()=>{}}=e;function yi(){Ve.focus()}function Pi(){Ve.blur()}function ut(G,Ue=!0,$e=!1){t(1,Le=G),Ue?(t(15,We=-1),ht()):(Qt(!$e,$e),setTimeout(()=>{Ve.focus(),Ve.select()}))}function At(){t(14,ot=void 0),t(56,we=void 0),t(15,We=-1)}function Ne(){t(55,kt=[]),t(56,we=void 0)}let je=!1,ot,kt,we,di="",Ve,We=-1,St,vn=[],bn,Mn,tr,ir;const qo=new Set,Ji=ns();Jn(()=>{Z&&(Z.setEventHandler(void 0),Z.indicateReverse(!1),Z.setSelectedMarker(-1),Z.setFeatures(void 0,void 0,!1))});function ht(G){if(Mn&&(clearTimeout(Mn),Mn=void 0),We>-1&&ot)t(56,we=ot[We]),t(1,Le=we.place_type[0]==="reverse"?we.place_name:we.place_name.replace(/,.*/,"")),t(18,St=void 0),t(55,kt=void 0),t(15,We=-1);else if(Le){const Ue=G||!Hn(Le);wn(Le,{exact:!0}).then(()=>{t(55,kt=ot),t(56,we=void 0),Ue&&Ao()}).catch($e=>t(18,St=$e))}}function Hn(G){try{return e4(G,6)}catch{return!1}}async function wn(G,{byId:Ue=!1,exact:$e=!1}={}){t(18,St=void 0),bn==null||bn.abort();const Ze=new AbortController;t(19,bn=Ze);try{const Ye=Hn(G),dt=new URLSearchParams;if(se!==void 0&&dt.set("language",Array.isArray(se)?se.join(","):se??""),Nt&&dt.set("types",Nt.join(",")),Yt&&dt.set("excludeTypes",String(Yt)),k&&dt.set("bbox",k.map(vi=>vi.toFixed(6)).join(",")),z&&dt.set("country",Array.isArray(z)?z.join(","):z),!Ue&&!Ye){const vi=await $k(Z,ne,Ze);vi&&dt.set("proximity",vi),($e||!pt)&&dt.set("autocomplete","false"),dt.set("fuzzyMatch",String(V))}ce!==void 0&&(zt||!Ye||(Nt==null?void 0:Nt.length)===1)&&dt.set("limit",String(ce)),dt.set("key",v),ki(dt);const Ft=ti+"/"+encodeURIComponent(Ye?Ye.decimalLongitude+","+Ye.decimalLatitude:G)+".json?"+dt.toString();if(Ft===di){Ue?(t(14,ot=void 0),t(56,we=vn[0])):t(14,ot=vn);return}di=Ft;const Kt=await fetch(Ft,{signal:Ze.signal,...Zt});if(!Kt.ok)throw new Error(await Kt.text());const ai=await Kt.json();Ji("response",{url:Ft,featureCollection:ai}),Ue?(t(14,ot=void 0),t(56,we=ai.features[0]),vn=[we]):(t(14,ot=ai.features.filter(O)),Ye&&ot.unshift({type:"Feature",properties:{},id:"reverse_"+Ye.decimalLongitude+"_"+Ye.decimalLatitude,text:Ye.decimalLatitude+", "+Ye.decimalLongitude,place_name:Ye.decimalLatitude+", "+Ye.decimalLongitude,place_type:["reverse"],center:[Ye.decimalLongitude,Ye.decimalLatitude],bbox:[Ye.decimalLongitude,Ye.decimalLatitude,Ye.decimalLongitude,Ye.decimalLatitude],geometry:{type:"Point",coordinates:[Ye.decimalLongitude,Ye.decimalLatitude]}}),vn=ot,Ye&&Ve.focus())}catch(Ye){if(Ye&&typeof Ye=="object"&&"name"in Ye&&Ye.name==="AbortError")return;throw Ye}finally{Ze===bn&&t(19,bn=void 0)}}function Ao(){var Ze;if(!(kt!=null&&kt.length)||!j)return;const G=[180,90,-180,-90],Ue=!kt.some(Ye=>!Ye.matching_text);let $e;for(const Ye of kt){const dt=Vi(Ye);if($e=$e===void 0?dt:dt===void 0?$e:Math.max($e,dt),Ue||!Ye.matching_text)for(const Ft of[0,1,2,3])G[Ft]=Math[Ft<2?"min":"max"](G[Ft],((Ze=Ye.bbox)==null?void 0:Ze[Ft])??Ye.center[Ft%2])}Z&&kt.length>0&&(we&&G[0]===G[2]&&G[1]===G[3]?Z.flyTo(we.center,Vi(we)):Z.fitBounds(L_(G),50,$e))}function Vi(G){var $e;if(!G.bbox||G.bbox[0]!==G.bbox[2]&&G.bbox[1]!==G.bbox[3])return;const Ue=G.id.replace(/\..*/,"");return(Array.isArray(($e=G.properties)==null?void 0:$e.categories)?G.properties.categories.reduce((Ze,Ye)=>{const dt=It[Ue+"."+Ye];return Ze===void 0?dt:dt===void 0?Ze:Math.max(Ze,dt)},void 0):void 0)??It[Ue]}function gt(G){t(0,ve=D==="always"),t(14,ot=void 0),t(56,we=void 0),t(15,We=-1),ut(G[1].toFixed(6)+", "+Vk(G[0],[-180,180],!0).toFixed(6),!1,!0)}function ri(G){if(!ot)return;let Ue=G.key==="ArrowDown"?1:G.key==="ArrowUp"?-1:0;Ue&&(We===(at?0:-1)&&Ue===-1&&t(15,We=ot.length),t(15,We+=Ue),We>=ot.length&&t(15,We=-1),We<0&&at&&t(15,We=0),G.preventDefault())}function Qt(G=!0,Ue=!1){if(t(18,St=void 0),pt||Ue){if(Mn&&clearTimeout(Mn),Le.length<Y)return;const $e=Le;Mn=window.setTimeout(()=>{wn($e).catch(Ze=>t(18,St=Ze))},G?R:0)}else t(14,ot=void 0),t(18,St=void 0)}function $i(G){t(56,we=G),t(1,Le=G.place_name),t(15,We=-1)}const vr=()=>Ve.focus();function ii(G){Ki[G?"unshift":"push"](()=>{Ve=G,t(17,Ve)})}function to(){Le=this.value,t(1,Le),t(13,je),t(28,E)}const un=()=>t(13,je=!0),me=()=>t(13,je=!1),W=()=>Qt(),K=()=>{t(1,Le=""),Ve.focus()},ie=()=>t(0,ve=!ve),de=()=>t(18,St=void 0),Ae=G=>t(15,We=G),Pe=G=>$i(G),Be=()=>{at||t(15,We=-1)},Se=()=>{};return o.$$set=G=>{"class"in G&&t(2,_=G.class),"apiKey"in G&&t(26,v=G.apiKey),"bbox"in G&&t(27,k=G.bbox),"clearButtonTitle"in G&&t(3,S=G.clearButtonTitle),"clearOnBlur"in G&&t(28,E=G.clearOnBlur),"collapsed"in G&&t(4,A=G.collapsed),"country"in G&&t(29,z=G.country),"debounceSearch"in G&&t(30,R=G.debounceSearch),"enableReverse"in G&&t(5,D=G.enableReverse),"errorMessage"in G&&t(6,B=G.errorMessage),"filter"in G&&t(31,O=G.filter),"flyTo"in G&&t(32,j=G.flyTo),"fuzzyMatch"in G&&t(33,V=G.fuzzyMatch),"language"in G&&t(34,se=G.language),"limit"in G&&t(35,ce=G.limit),"mapController"in G&&t(36,Z=G.mapController),"minLength"in G&&t(37,Y=G.minLength),"noResultsMessage"in G&&t(7,ye=G.noResultsMessage),"placeholder"in G&&t(8,Oe=G.placeholder),"proximity"in G&&t(38,ne=G.proximity),"reverseActive"in G&&t(0,ve=G.reverseActive),"reverseButtonTitle"in G&&t(9,Je=G.reverseButtonTitle),"searchValue"in G&&t(1,Le=G.searchValue),"pickedResultStyle"in G&&t(39,et=G.pickedResultStyle),"showPlaceType"in G&&t(10,bt=G.showPlaceType),"showResultsWhileTyping"in G&&t(40,pt=G.showResultsWhileTyping),"selectFirst"in G&&t(11,at=G.selectFirst),"flyToSelected"in G&&t(41,Xt=G.flyToSelected),"markerOnSelected"in G&&t(42,ni=G.markerOnSelected),"types"in G&&t(43,Nt=G.types),"exhaustiveReverseGeocoding"in G&&t(44,zt=G.exhaustiveReverseGeocoding),"excludeTypes"in G&&t(45,Yt=G.excludeTypes),"zoom"in G&&t(46,It=G.zoom),"apiUrl"in G&&t(47,ti=G.apiUrl),"fetchParameters"in G&&t(48,Zt=G.fetchParameters),"iconsBaseUrl"in G&&t(12,hi=G.iconsBaseUrl),"adjustUrlQuery"in G&&t(49,ki=G.adjustUrlQuery),"$$scope"in G&&t(60,d=G.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&32&&t(0,ve=D==="always"),o.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,tr=je),E&&!je&&t(1,Le="")}),o.$$.dirty[0]&16386|o.$$.dirty[1]&64&&Le.length<Y&&(t(56,we=void 0),t(14,ot=void 0),t(18,St=void 0),t(55,kt=ot)),o.$$.dirty[1]&33554688&&et!=="marker-only"&&we&&!we.address&&we.geometry.type==="Point"&&we.place_type[0]!=="reverse"&&wn(we.id,{byId:!0}).catch(G=>t(18,St=G)),o.$$.dirty[1]&100663330&&(Z&&we&&we.id!==ir&&j&&(!we.bbox||we.bbox[0]===we.bbox[2]&&we.bbox[1]===we.bbox[3]?Z.flyTo(we.center,Vi(we)):Z.fitBounds(L_(we.bbox),50,Vi(we)),t(14,ot=void 0),t(55,kt=void 0),t(15,We=-1)),t(57,ir=we==null?void 0:we.id)),o.$$.dirty[0]&18432&&at&&ot!=null&&ot.length&&t(15,We=0),o.$$.dirty[0]&2&&t(15,We=-1),o.$$.dirty[0]&16384|o.$$.dirty[1]&16777216&&kt!==ot&&t(55,kt=void 0),o.$$.dirty[0]&81921|o.$$.dirty[1]&16777248&&Z&&Z.setEventHandler(G=>{switch(G.type){case"mapClick":ve&&gt(G.coordinates);break;case"markerClick":{const Ue=ot==null?void 0:ot.find($e=>$e.id===G.id);Ue&&$i(Ue)}break;case"markerMouseEnter":kt&&t(15,We=tr?(ot==null?void 0:ot.findIndex(Ue=>Ue.id===G.id))??-1:-1);break;case"markerMouseLeave":kt&&t(15,We=-1);break}}),o.$$.dirty[0]&49152&&t(58,l=ot==null?void 0:ot[We]),o.$$.dirty[1]&134218786&&Z&&l&&j&&Xt&&Z.flyTo(l.center,Vi(l)),o.$$.dirty[1]&256&&t(59,i=et==="full-geometry-including-polygon-center-marker"),o.$$.dirty[1]&268437536&&(ni||Z==null||Z.setFeatures(void 0,void 0,i)),o.$$.dirty[1]&419432480&&Z&&ni&&!kt&&(Z.setFeatures(l?[l]:void 0,void 0,i),Z.setSelectedMarker(l?0:-1)),o.$$.dirty[1]&318767136&&Z&&Z.setFeatures(kt,we,i),o.$$.dirty[0]&32768|o.$$.dirty[1]&16777248&&kt&&Z&&Z.setSelectedMarker(We),o.$$.dirty[0]&2|o.$$.dirty[1]&32&&Z){const G=Hn(Le);Z.setReverseMarker(G?[G.decimalLongitude,G.decimalLatitude]:void 0)}o.$$.dirty[1]&134217728&&Ji("select",{feature:l}),o.$$.dirty[1]&33554432&&Ji("pick",{feature:we}),o.$$.dirty[0]&81920&&Ji("optionsvisibilitychange",{optionsVisible:tr&&!!ot}),o.$$.dirty[0]&16384&&Ji("featureslisted",{features:ot}),o.$$.dirty[1]&16777216&&Ji("featuresmarked",{features:kt}),o.$$.dirty[0]&1&&Ji("reversetoggle",{reverse:ve}),o.$$.dirty[0]&2&&Ji("querychange",{query:Le}),o.$$.dirty[0]&1|o.$$.dirty[1]&32&&Z&&Z.indicateReverse(ve)},[ve,Le,_,S,A,D,B,ye,Oe,Je,bt,at,hi,je,ot,We,tr,Ve,St,bn,qo,ht,ri,Qt,$i,a,v,k,E,z,R,O,j,V,se,ce,Z,Y,ne,et,pt,Xt,ni,Nt,zt,Yt,It,ti,Zt,ki,yi,Pi,ut,At,Ne,kt,we,ir,l,i,d,u,vr,ii,to,un,me,W,K,ie,de,Ae,Pe,Be,Se]}class a4 extends qt{constructor(e){super(),$t(this,e,s4,o4,Bt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function V_(o){let e,t,i;return t=new a4({props:{mapController:o[2],apiKey:o[0],country:o[1],types:o[3],proximity:[{type:"map-center"}]}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"class","svelte-ixhnie")},m(l,u){le(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&4&&(d.mapController=l[2]),u&1&&(d.apiKey=l[0]),u&2&&(d.country=l[1]),t.$set(d)},i(l){i||(Q(t.$$.fragment,l),i=!0)},o(l){re(t.$$.fragment,l),i=!1},d(l){l&&ae(e),Me(t)}}}function l4(o){let e,t,i=o[2]&&V_(o);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),le(l,e,u),t=!0},p(l,[u]){l[2]?i?(i.p(l,u),u&4&&Q(i,1)):(i=V_(l),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(l)}}}function c4(o,e,t){let i,{apiKey:l}=e,{map:u}=e,{country:d}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function _(v){return v?V0(v,eo,!0,!0,{duration:1e3},{duration:1e3}):null}return o.$$set=v=>{"apiKey"in v&&t(0,l=v.apiKey),"map"in v&&t(4,u=v.map),"country"in v&&t(1,d=v.country)},o.$$.update=()=>{o.$$.dirty&16&&t(2,i=_(u))},[l,d,i,a,u]}class u4 extends qt{constructor(e){super(),$t(this,e,c4,l4,Bt,{apiKey:0,map:4,country:1})}}const h4=Symbol.for("svelte-maplibre");function d4(){return Md(h4)}function f4(o){return"layerType"in o&&o.layerType==="deckgl"}const p4=o=>({features:o[0]&16,data:o[0]&16,map:o[0]&4,close:o[0]&1}),$_=o=>{var e;return{features:o[4],data:(e=o[4])==null?void 0:e[0],map:o[2],close:o[31]}};function q_(o){let e,t,i=(o[4]||o[3]instanceof eo.Marker)&&Z_(o);return{c(){e=oe("div"),i&&i.c()},m(l,u){le(l,e,u),i&&i.m(e,null),o[32](e),t=!0},p(l,u){l[4]||l[3]instanceof eo.Marker?i?(i.p(l,u),u[0]&24&&Q(i,1)):(i=Z_(l),i.c(),Q(i,1),i.m(e,null)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(),o[32](null)}}}function Z_(o){let e;const t=o[30].default,i=Bi(t,o,o[29],$_);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u[0]&536870933)&&Oi(i,t,l,l[29],e?Fi(t,l[29],u,p4):Ni(l[29]),$_)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function m4(o){let e,t,i=o[9].default&&q_(o);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),le(l,e,u),t=!0},p(l,u){l[9].default?i?(i.p(l,u),u[0]&512&&Q(i,1)):(i=q_(l),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(l)}}}function g4(o,e,t){let i,l,u,d,a,_,{$$slots:v={},$$scope:k}=e;const S=Qv(v);let{closeButton:E=void 0}=e,{closeOnClickOutside:A=!0}=e,{closeOnClickInside:z=!1}=e,{closeOnMove:R=!1}=e,{openOn:D="click"}=e,{openIfTopMost:B=!0}=e,{focusAfterOpen:O=!0}=e,{anchor:j=void 0}=e,{offset:V=void 0}=e,{popupClass:se=void 0}=e,{maxWidth:ce=void 0}=e,{lngLat:Z=void 0}=e,{html:Y=void 0}=e,{open:ye=!1}=e;const Oe=ns(),{map:ne,popupTarget:ve,layerEvent:Je,layer:Le,eventTopMost:et}=d4();lt(o,ne,je=>t(2,u=je)),lt(o,ve,je=>t(3,a=je)),lt(o,Je,je=>t(28,d=je)),lt(o,Le,je=>t(35,_=je));const bt=["click","dblclick","contextmenu"];let pt,at=!1,Xt;function ni(){if(!pt)return;let je=pt.getElement();!je||je===Xt||(Xt=je,D==="hover"&&(Xt.style.pointerEvents="none"),Xt.addEventListener("mouseenter",()=>{t(24,at=!0)},{passive:!0}),Xt.addEventListener("mouseleave",()=>{t(24,at=!1)},{passive:!0}),Xt.addEventListener("click",()=>{z&&t(0,ye=!1)},{passive:!0}))}$u(()=>{if(u)return u.on("click",Pi),u.on("contextmenu",Pi),typeof a=="string"&&(u.on("click",a,It),u.on("dblclick",a,It),u.on("contextmenu",a,It),u.on("mousemove",a,yi),u.on("mouseleave",a,ki),u.on("touchstart",a,Zt),u.on("touchend",a,hi)),()=>{u!=null&&u.loaded()&&(pt==null||pt.remove(),u.off("click",Pi),u.off("contextmenu",Pi),a instanceof eo.Marker?a.getPopup()===pt&&a.setPopup(void 0):typeof a=="string"&&(u.off("click",a,It),u.off("dblclick",a,It),u.off("contextmenu",a,It),u.off("mousemove",a,yi),u.off("mouseleave",a,ki),u.off("touchstart",a,Zt),u.off("touchend",a,hi)))}});function Nt(je){return B?!("marker"in je)&&!f4(je)&&et(je)!==_:!1}let zt=null,Yt="normal";function It(je){je.type===D&&(Nt(je)||("layerType"in je?je.layerType==="deckgl"?(t(10,Z=je.coordinate),t(4,zt=je.object?[je.object]:null)):(t(10,Z=je.lngLat),t(4,zt=je.features??[])):(t(10,Z=je.lngLat),t(4,zt=je.features??[])),setTimeout(()=>t(0,ye=!0))))}let ti=null;function Zt(je){ti=je.point}function hi(je){if(!ti||D!=="hover")return;let ot=ti.dist(je.point);ti=null,ot<3&&(t(10,Z=je.lngLat),t(4,zt=je.features??[]),pt.isOpen()?t(25,Yt="justOpened"):(t(25,Yt="opening"),t(0,ye=!0)))}function ki(je){D!=="hover"||ti||Yt!=="normal"||(t(0,ye=!1),t(4,zt=null))}function yi(je){if(!(D!=="hover"||ti||Yt!=="normal")){if(Nt(je)){t(0,ye=!1),t(4,zt=null);return}t(0,ye=!0),t(4,zt=je.features??[]),t(10,Z=je.lngLat)}}function Pi(je){if(Yt==="justOpened"){t(25,Yt="normal");return}if(!A)return;let ot=[Xt,a instanceof eo.Marker?a==null?void 0:a.getElement():null];ye&&pt.isOpen()&&!ot.some(kt=>kt==null?void 0:kt.contains(je.originalEvent.target))&&(je.type==="contextmenu"&&D==="contextmenu"||je.type!=="contextmenu")&&t(0,ye=!1)}Jn(()=>{u&&(pt!=null&&pt.isOpen())&&pt.remove()});let ut;const At=()=>t(0,ye=!1);function Ne(je){Ki[je?"unshift":"push"](()=>{ut=je,t(1,ut)})}return o.$$set=je=>{"closeButton"in je&&t(11,E=je.closeButton),"closeOnClickOutside"in je&&t(12,A=je.closeOnClickOutside),"closeOnClickInside"in je&&t(13,z=je.closeOnClickInside),"closeOnMove"in je&&t(14,R=je.closeOnMove),"openOn"in je&&t(15,D=je.openOn),"openIfTopMost"in je&&t(16,B=je.openIfTopMost),"focusAfterOpen"in je&&t(17,O=je.focusAfterOpen),"anchor"in je&&t(18,j=je.anchor),"offset"in je&&t(19,V=je.offset),"popupClass"in je&&t(20,se=je.popupClass),"maxWidth"in je&&t(21,ce=je.maxWidth),"lngLat"in je&&t(10,Z=je.lngLat),"html"in je&&t(22,Y=je.html),"open"in je&&t(0,ye=je.open),"$$scope"in je&&t(29,k=je.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&14336&&t(27,i=E??(!A&&!z)),o.$$.dirty[0]&146685952&&(pt||(t(23,pt=new eo.Popup({closeButton:i,closeOnClick:!1,closeOnMove:R,focusAfterOpen:O,maxWidth:ce,className:se,anchor:j,offset:V})),Xt=pt.getElement(),pt.on("open",()=>{t(0,ye=!0),ni(),Oe("open",pt)}),pt.on("close",()=>{t(0,ye=!1),Oe("close",pt)}),pt.on("hover",()=>{Oe("hover",pt)}))),o.$$.dirty[0]&8421384&&pt&&a instanceof eo.Marker&&(D==="click"?a.setPopup(pt):a.getPopup()===pt&&a.setPopup(void 0)),o.$$.dirty[0]&268468224&&bt.includes(D)&&(d==null?void 0:d.type)===D&&(It(d),Tt(Je,d=null,d)),o.$$.dirty[0]&268468224&&t(26,l=D==="hover"&&((d==null?void 0:d.type)==="mousemove"||(d==null?void 0:d.type)==="mouseenter")),o.$$.dirty[0]&352354304&&D==="hover"&&Je&&(l&&d&&(d.layerType==="deckgl"?(t(10,Z=d.coordinate),t(4,zt=d.object?[d.object]:null)):(t(10,Z=d.lngLat),t(4,zt=d.features??[]))),t(0,ye=(l||at)??!1)),o.$$.dirty[0]&12582914&&(ut?pt.setDOMContent(ut):Y&&pt.setHTML(Y)),o.$$.dirty[0]&8389632&&Z&&pt.setLngLat(Z),o.$$.dirty[0]&41943045&&u){let je=pt.isOpen();ye&&!je?(pt.addTo(u),Yt==="opening"&&t(25,Yt="justOpened")):!ye&&je&&pt.remove()}},[ye,ut,u,a,zt,ne,ve,Je,Le,S,Z,E,A,z,R,D,B,O,j,V,se,ce,Y,pt,at,Yt,l,i,d,k,v,At,Ne]}class _4 extends qt{constructor(e){super(),$t(this,e,g4,m4,Bt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const y4=o=>({props:o&8}),G_=o=>({props:w4(o[3])});function v4(o){let e;const t=o[1].default,i=Bi(t,o,o[2],G_);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&12)&&Oi(i,t,l,l[2],e?Fi(t,l[2],u,y4):Ni(l[2]),G_)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function b4(o){let e,t;return e=new _4({props:{openOn:o[0],$$slots:{default:[v4,({features:i})=>({3:i}),({features:i})=>i?8:0]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.openOn=i[0]),l&12&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function w4(o){return o?o[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function x4(o,e,t){let{$$slots:i={},$$scope:l}=e,{openOn:u="hover"}=e;return o.$$set=d=>{"openOn"in d&&t(0,u=d.openOn),"$$scope"in d&&t(2,l=d.$$scope)},[u,i,l]}class $o extends qt{constructor(e){super(),$t(this,e,x4,b4,Bt,{openOn:0})}}const k4=["==",["geometry-type"],"Polygon"],S4=["==",["geometry-type"],"LineString"];function Mu(o,e,t){let i=["match",o];for(let[l,u]of Object.entries(e))i.push(l),i.push(u);return i.push(t),i}function Jl(){return{type:"FeatureCollection",features:[]}}const T4=o=>({}),W_=o=>({}),C4=o=>({}),H_=o=>({}),E4=o=>({}),X_=o=>({});function M4(o){let e,t,i,l,u,d,a,_;const v=o[1].top,k=Bi(v,o,o[0],X_),S=o[1].left,E=Bi(S,o,o[0],H_),A=o[1].main,z=Bi(A,o,o[0],W_);return{c(){e=oe("div"),t=oe("div"),k&&k.c(),i=ze(),l=oe("div"),u=oe("div"),E&&E.c(),d=ze(),a=oe("div"),z&&z.c(),ke(t,"class","top svelte-29q570"),ke(u,"class","left svelte-29q570"),ke(a,"class","main svelte-29q570"),ke(l,"class","content svelte-29q570"),ke(e,"class","flex-container svelte-29q570")},m(R,D){le(R,e,D),X(e,t),k&&k.m(t,null),X(e,i),X(e,l),X(l,u),E&&E.m(u,null),X(l,d),X(l,a),z&&z.m(a,null),_=!0},p(R,[D]){k&&k.p&&(!_||D&1)&&Oi(k,v,R,R[0],_?Fi(v,R[0],D,E4):Ni(R[0]),X_),E&&E.p&&(!_||D&1)&&Oi(E,S,R,R[0],_?Fi(S,R[0],D,C4):Ni(R[0]),H_),z&&z.p&&(!_||D&1)&&Oi(z,A,R,R[0],_?Fi(A,R[0],D,T4):Ni(R[0]),W_)},i(R){_||(Q(k,R),Q(E,R),Q(z,R),_=!0)},o(R){re(k,R),re(E,R),re(z,R),_=!1},d(R){R&&ae(e),k&&k.d(R),E&&E.d(R),z&&z.d(R)}}}function I4(o,e,t){let{$$slots:i={},$$scope:l}=e;return o.$$set=u=>{"$$scope"in u&&t(0,l=u.$$scope)},[l,i]}class L4 extends qt{constructor(e){super(),$t(this,e,I4,M4,Bt,{})}}const A4=o=>({}),K_=o=>({}),P4=o=>({}),J_=o=>({}),z4=o=>({}),Y_=o=>({});function D4(o){let e,t,i,l,u,d;const a=o[4].top,_=Bi(a,o,o[3],Y_),v=o[4].sidebar,k=Bi(v,o,o[3],J_),S=o[4].map,E=Bi(S,o,o[3],K_);return{c(){e=oe("div"),_&&_.c(),t=ze(),i=oe("div"),k&&k.c(),l=ze(),u=oe("div"),E&&E.c()},m(A,z){le(A,e,z),_&&_.m(e,null),o[5](e),le(A,t,z),le(A,i,z),k&&k.m(i,null),o[6](i),le(A,l,z),le(A,u,z),E&&E.m(u,null),o[7](u),d=!0},p(A,[z]){_&&_.p&&(!d||z&8)&&Oi(_,a,A,A[3],d?Fi(a,A[3],z,z4):Ni(A[3]),Y_),k&&k.p&&(!d||z&8)&&Oi(k,v,A,A[3],d?Fi(v,A[3],z,P4):Ni(A[3]),J_),E&&E.p&&(!d||z&8)&&Oi(E,S,A,A[3],d?Fi(S,A[3],z,A4):Ni(A[3]),K_)},i(A){d||(Q(_,A),Q(k,A),Q(E,A),d=!0)},o(A){re(_,A),re(k,A),re(E,A),d=!1},d(A){A&&(ae(e),ae(t),ae(i),ae(l),ae(u)),_&&_.d(A),o[5](null),k&&k.d(A),o[6](null),E&&E.d(A),o[7](null)}}}function R4(o,e,t){let i,l,u;lt(o,bp,S=>t(0,i=S)),lt(o,wp,S=>t(1,l=S)),lt(o,xp,S=>t(2,u=S));let{$$slots:d={},$$scope:a}=e;function _(S){Ki[S?"unshift":"push"](()=>{i=S,bp.set(i)})}function v(S){Ki[S?"unshift":"push"](()=>{l=S,wp.set(l)})}function k(S){Ki[S?"unshift":"push"](()=>{u=S,xp.set(u)})}return o.$$set=S=>{"$$scope"in S&&t(3,a=S.$$scope)},[i,l,u,a,d,_,v,k]}class Lo extends qt{constructor(e){super(),$t(this,e,R4,D4,Bt,{})}}let bp=wi(null),wp=wi(null),xp=wi(null);function B4(o){let e,t,i,l,u,d,a,_,v;return{c(){e=oe("label"),t=Xe(`Basemap:
  `),i=oe("select"),l=oe("option"),l.textContent="MapTiler Dataviz",u=oe("option"),u.textContent="MapTiler Streets",d=oe("option"),d.textContent="MapTiler Satellite",a=oe("option"),a.textContent="OS Open Zoomstack",l.__value="dataviz",Fn(l,l.__value),u.__value="streets-v2",Fn(u,u.__value),d.__value="hybrid",Fn(d,d.__value),a.__value="uk-openzoomstack-light",Fn(a,a.__value),o[0]===void 0&&ec(()=>o[1].call(i))},m(k,S){le(k,e,S),X(e,t),X(e,i),X(i,l),X(i,u),X(i,d),X(i,a),Ql(i,o[0],!0),_||(v=xt(i,"change",o[1]),_=!0)},p(k,[S]){S&1&&Ql(i,k[0])},i:Lt,o:Lt,d(k){k&&ae(e),_=!1,v()}}}function F4(o,e,t){let i;lt(o,lp,u=>t(0,i=u));function l(){i=Mp(this),lp.set(i)}return[i,l]}class O4 extends qt{constructor(e){super(),$t(this,e,F4,B4,Bt,{})}}let pd=wi(!0);function N4(o){let e,t;return e=new Es({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:o[0]?"none":"visible"}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.layout={visibility:i[0]?"none":"visible"}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function j4(o){let e,t;return e=new cr({props:{data:o[1],$$slots:{default:[N4]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&5&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function U4(o,e,t){let i;return lt(o,pd,u=>t(0,i=u)),[i,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class V4 extends qt{constructor(e){super(),$t(this,e,U4,j4,Bt,{})}}function $4(o){let e,t;return e=new zd({props:{lngLat:o[0],$$slots:{default:[Z4]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.lngLat=i[0]),l&16&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function q4(o){let e,t,i;function l(d){o[3](d)}let u={draggable:!0,$$slots:{default:[G4]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.lngLat=o[0]),e=new zd({props:u}),Ki.push(()=>Gr(e,"lngLat",l)),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,a){const _={};a&16&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.lngLat=d[0],Zr(()=>t=!1)),e.$set(_)},i(d){i||(Q(e.$$.fragment,d),i=!0)},o(d){re(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function Z4(o){let e,t;const i=o[2].default,l=Bi(i,o,o[4],null);return{c(){e=oe("span"),l&&l.c(),ke(e,"class","dot svelte-1gcxp27")},m(u,d){le(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d&16)&&Oi(l,i,u,u[4],t?Fi(i,u[4],d,null):Ni(u[4]),null)},i(u){t||(Q(l,u),t=!0)},o(u){re(l,u),t=!1},d(u){u&&ae(e),l&&l.d(u)}}}function G4(o){let e,t;const i=o[2].default,l=Bi(i,o,o[4],null);return{c(){e=oe("span"),l&&l.c(),ke(e,"class","dot svelte-1gcxp27")},m(u,d){le(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d&16)&&Oi(l,i,u,u[4],t?Fi(i,u[4],d,null):Ni(u[4]),null)},i(u){t||(Q(l,u),t=!0)},o(u){re(l,u),t=!1},d(u){u&&ae(e),l&&l.d(u)}}}function W4(o){let e,t,i,l;const u=[q4,$4],d=[];function a(_,v){return _[1]?0:1}return e=a(o),t=d[e]=u[e](o),{c(){t.c(),i=En()},m(_,v){d[e].m(_,v),le(_,i,v),l=!0},p(_,[v]){let k=e;e=a(_),e===k?d[e].p(_,v):(gi(),re(d[k],1,1,()=>{d[k]=null}),_i(),t=d[e],t?t.p(_,v):(t=d[e]=u[e](_),t.c()),Q(t,1),t.m(i.parentNode,i))},i(_){l||(Q(t),l=!0)},o(_){re(t),l=!1},d(_){_&&ae(i),d[e].d(_)}}}function H4(o,e,t){let{$$slots:i={},$$scope:l}=e,{lngLat:u}=e,{draggable:d=!1}=e;function a(_){u=_,t(0,u)}return o.$$set=_=>{"lngLat"in _&&t(0,u=_.lngLat),"draggable"in _&&t(1,d=_.draggable),"$$scope"in _&&t(4,l=_.$$scope)},[u,d,i,a,l]}class Na extends qt{constructor(e){super(),$t(this,e,H4,W4,Bt,{lngLat:0,draggable:1})}}const X4="/ltn/assets/help-d011708a.svg";function Q_(o){let e,t;return e=new Id({props:{$$slots:{default:[K4]},$$scope:{ctx:o}}}),e.$on("close",o[3]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&16&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function K4(o){let e,t,i;const l=o[1].default,u=Bi(l,o,o[4],null);return{c(){e=oe("h2"),e.textContent="Help",t=ze(),u&&u.c()},m(d,a){le(d,e,a),le(d,t,a),u&&u.m(d,a),i=!0},p(d,a){u&&u.p&&(!i||a&16)&&Oi(u,l,d,d[4],i?Fi(l,d[4],a,null):Ni(d[4]),null)},i(d){i||(Q(u,d),i=!0)},o(d){re(u,d),i=!1},d(d){d&&(ae(e),ae(t)),u&&u.d(d)}}}function J4(o){let e,t,i,l,u,d,a=o[0]&&Q_(o);return{c(){e=oe("button"),e.innerHTML=`<img src="${X4}" title="Help" alt="Help"/>`,t=ze(),a&&a.c(),i=En(),ke(e,"class","svelte-gb6dzm")},m(_,v){le(_,e,v),le(_,t,v),a&&a.m(_,v),le(_,i,v),l=!0,u||(d=xt(e,"click",o[2]),u=!0)},p(_,[v]){_[0]?a?(a.p(_,v),v&1&&Q(a,1)):(a=Q_(_),a.c(),Q(a,1),a.m(i.parentNode,i)):a&&(gi(),re(a,1,1,()=>{a=null}),_i())},i(_){l||(Q(a),l=!0)},o(_){re(a),l=!1},d(_){_&&(ae(e),ae(t),ae(i)),a&&a.d(_),u=!1,d()}}}function Y4(o,e,t){let{$$slots:i={},$$scope:l}=e,u=!1;const d=()=>t(0,u=!0),a=()=>t(0,u=!1);return o.$$set=_=>{"$$scope"in _&&t(4,l=_.$$scope)},[u,i,d,a,l]}class Zp extends qt{constructor(e){super(),$t(this,e,Y4,J4,Bt,{})}}function Q4(o){let e,t,i,l;const u=o[1].default,d=Bi(u,o,o[0],null);return{c(){e=oe("a"),d&&d.c(),ke(e,"href","#")},m(a,_){le(a,e,_),d&&d.m(e,null),t=!0,i||(l=xt(e,"click",Cp(o[2])),i=!0)},p(a,[_]){d&&d.p&&(!t||_&1)&&Oi(d,u,a,a[0],t?Fi(u,a[0],_,null):Ni(a[0]),null)},i(a){t||(Q(d,a),t=!0)},o(a){re(d,a),t=!1},d(a){a&&ae(e),d&&d.d(a),i=!1,l()}}}function eS(o,e,t){let{$$slots:i={},$$scope:l}=e;function u(d){ui.call(this,o,d)}return o.$$set=d=>{"$$scope"in d&&t(0,l=d.$$scope)},[l,i,u]}class Ei extends qt{constructor(e){super(),$t(this,e,eS,Q4,Bt,{})}}function tS(o,e){let t=new Set(o.getStyle().layers.filter(i=>i.type=="line").map(i=>i.id));return e=="dataviz"?["Road network","Path"].filter(i=>t.has(i)):e=="hybrid"?["Path","Road","Tunnel"].filter(i=>t.has(i)):e=="streets-v2"?o.getStyle().layers.filter(i=>i["source-layer"]=="transportation"&&i.type=="line").map(i=>i.id):e=="uk-openzoomstack-light"?o.getStyle().layers.filter(i=>i["source-layer"]=="roads"&&i.type=="line").map(i=>i.id):[]}const{window:iS}=Cd;function nS(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R;return A=Wy(o[8][0]),{c(){e=oe("button"),e.textContent="Stop StreetView",t=ze(),i=oe("fieldset"),l=oe("legend"),l.textContent="Source:",u=ze(),d=oe("label"),a=oe("input"),_=Xe(`
      Google Street View`),v=ze(),k=oe("label"),S=oe("input"),E=Xe(`
      Bing Streetside`),ke(e,"class","secondary"),ke(a,"type","radio"),a.__value="google",Fn(a,a.__value),ke(S,"type","radio"),S.__value="bing",Fn(S,S.__value),A.p(a,S)},m(D,B){le(D,e,B),le(D,t,B),le(D,i,B),X(i,l),X(i,u),X(i,d),X(d,a),a.checked=a.__value===o[0],X(d,_),X(i,v),X(i,k),X(k,S),S.checked=S.__value===o[0],X(k,E),z||(R=[xt(e,"click",o[3]),xt(a,"change",o[7]),xt(S,"change",o[9])],z=!0)},p(D,B){B&1&&(a.checked=a.__value===D[0]),B&1&&(S.checked=S.__value===D[0])},d(D){D&&(ae(e),ae(t),ae(i)),A.r(),z=!1,on(R)}}}function rS(o){let e,t,i;return{c(){e=oe("button"),e.textContent="StreetView",ke(e,"class","secondary")},m(l,u){le(l,e,u),t||(i=xt(e,"click",o[2]),t=!0)},p:Lt,d(l){l&&ae(e),t=!1,i()}}}function oS(o){let e,t,i;function l(a,_){return a[1]?rS:nS}let u=l(o),d=u(o);return{c(){d.c(),e=En()},m(a,_){d.m(a,_),le(a,e,_),t||(i=xt(iS,"keydown",o[4]),t=!0)},p(a,[_]){u===(u=l(a))&&d?d.p(a,_):(d.d(1),d=u(a),d&&(d.c(),d.m(e.parentNode,e)))},i:Lt,o:Lt,d(a){a&&ae(e),d.d(a),t=!1,i()}}}function sS(o,e,t){let i;lt(o,pd,R=>t(1,i=R));let{map:l}=e,{maptilerBasemap:u}=e,d="google",a=[];function _(){Tt(pd,i=!1,i),l.on("click",k),l.getCanvas().style.cursor="crosshair";for(let R of tS(l,u))a.push([R,l.getPaintProperty(R,"line-color")]),l.setPaintProperty(R,"line-color","cyan")}function v(){Tt(pd,i=!0,i),l.off("click",k),l.getCanvas().style.cursor="inherit";for(let[R,D]of a)l.setPaintProperty(R,"line-color",D);a=[]}Jn(v);function k(R){let D=R.lngLat.lng,B=R.lngLat.lat;d=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${B},${D}&cbp=11,0,0,0,0`,"_blank"):d=="bing"&&window.open(`https://www.bing.com/maps?cp=${B}~${D}&style=x`,"_blank")}function S(R){!i&&R.key=="Escape"&&(R.stopPropagation(),v())}const E=[[]];function A(){d=this.__value,t(0,d)}function z(){d=this.__value,t(0,d)}return o.$$set=R=>{"map"in R&&t(5,l=R.map),"maptilerBasemap"in R&&t(6,u=R.maptilerBasemap)},[d,i,_,v,S,l,u,A,E,z]}class aS extends qt{constructor(e){super(),$t(this,e,sS,oS,Bt,{map:5,maptilerBasemap:6})}}function rn(o,e=!0){return{id:o,beforeId:lS(o),eventsIfTopMost:e}}function lS(o){let e=Ar(Vo);if(!e){console.warn(`getBeforeId(${o}) called before map is ready. Z-ordering may be incorrect.`);return}let t,i=!1;for(let l=ey.length-1;l>=0;l--){let u=ey[l];if(u==o){i=!0;break}e.getLayer(u)&&(t=u)}if(!i)throw new Error(`Layer ID ${o} not defined in layerZorder`);return t}let Yf=o=>o,Qf=o=>o;const ey=[Yf(Qf("Background")),"neighbourhood-boundaries",Yf("Ferry line"),"debug-borders","debug-crosses","debug-filters","cells","interior-roads-outlines","interior-roads","compare-route","shortcuts","shortcuts-focus","predict-impact",Qf("Building"),"draw-area-lines","draw-area-preview","one-ways",Qf("Road labels"),Yf("road_label"),"animate-shortcuts","modal-filters","boundary","neighbourhood-boundary","border-arrows","border-arrow-outlines","auto-boundaries-areas","auto-boundaries-severances","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];function cS(o){return["interpolate",["linear"],["zoom"],5,.5+o,10,1+o,12,1.5+o,14,4+o,16,7+o,20,24+o]}function uS(o){let e;return{c(){e=Xe("Back")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function hS(o){let e,t,i,l;return e=new Ei({props:{$$slots:{default:[uS]},$$scope:{ctx:o}}}),e.$on("click",o[2]),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=xt(window,"keydown",o[1]),i=!0)},p(u,[d]){const a={};d&8&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function dS(o){let e=ns();function t(l){l.key=="Escape"&&(l.stopPropagation(),e("click"))}return[e,t,()=>e("click")]}class lc extends qt{constructor(e){super(),$t(this,e,dS,hS,Bt,{})}}function kp(o,e,t){let i=new Set(o.toSavefile().features.filter(l=>l.properties.kind=="boundary").map(l=>l.properties.name));for(;;){let l=window.prompt(e,t);if(!l)return null;if(i.has(l))window.alert(`There is already a neighbourhood called ${l}; please pick another name`);else return l}}function fS(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function pS(o){let e;return{c(){e=Xe("Pick neighbourhood")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function mS(o){let e,t,i,l,u,d,a,_,v,k,S;return u=new Ei({props:{$$slots:{default:[fS]},$$scope:{ctx:o}}}),u.$on("click",o[10]),_=new Ei({props:{$$slots:{default:[pS]},$$scope:{ctx:o}}}),_.$on("click",o[11]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),Ie(_.$$.fragment),v=ze(),k=oe("li"),k.textContent="Use an auto-generated boundary",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(E,A){le(E,e,A),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),Ee(_,a,null),X(i,v),X(i,k),S=!0},p(E,A){const z={};A&32768&&(z.$$scope={dirty:A,ctx:E}),u.$set(z);const R={};A&32768&&(R.$$scope={dirty:A,ctx:E}),_.$set(R)},i(E){S||(Q(u.$$.fragment,E),Q(_.$$.fragment,E),S=!0)},o(E){re(u.$$.fragment,E),re(_.$$.fragment,E),S=!1},d(E){E&&ae(e),Me(u),Me(_)}}}function gS(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R,D,B;return t=new lc({}),t.$on("click",o[7]),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),l=oe("p"),l.textContent=`Click an area to use it as a neighbourhood. These are generated by finding
      roads, railways, and water that form severances. There are many bugs; this
      is experimental. The colors are arbitrary, just to distinguish better.`,u=ze(),d=oe("button"),d.textContent="Export to GeoJSON",a=ze(),_=oe("label"),v=Xe(`Minimum area (km)
      `),k=oe("input"),S=ze(),E=oe("label"),A=oe("input"),z=Xe(`
      Remove areas not touching a big road`),ke(d,"class","secondary"),ke(k,"type","number"),ke(k,"min","0"),ke(k,"max","1"),ke(k,"step","0.01"),ke(A,"type","checkbox"),ke(e,"slot","sidebar")},m(O,j){le(O,e,j),Ee(t,e,null),X(e,i),X(e,l),X(e,u),X(e,d),X(e,a),X(e,_),X(_,v),X(_,k),Fn(k,o[0]),X(e,S),X(e,E),X(E,A),A.checked=o[1],X(E,z),R=!0,D||(B=[xt(d,"click",o[5]),xt(k,"input",o[8]),xt(A,"change",o[9])],D=!0)},p(O,j){j&1&&Ep(k.value)!==O[0]&&Fn(k,O[0]),j&2&&(A.checked=O[1])},i(O){R||(Q(t.$$.fragment,O),R=!0)},o(O){re(t.$$.fragment,O),R=!1},d(O){O&&ae(e),Me(t),D=!1,on(B)}}}function _S(o){let e,t,i=o[14].area_km2.toFixed(1)+"",l,u,d,a,_,v=o[14].touches_big_road+"",k,S,E=o[14].touches_railway+"",A,z,R=o[14].touches_waterway+"",D;return{c(){e=oe("p"),t=Xe("Area: "),l=Xe(i),u=Xe(" km"),d=ze(),a=oe("p"),_=Xe("Borders roads = "),k=Xe(v),S=Xe(", railway = "),A=Xe(E),z=Xe(`,
            water = `),D=Xe(R)},m(B,O){le(B,e,O),X(e,t),X(e,l),X(e,u),le(B,d,O),le(B,a,O),X(a,_),X(a,k),X(a,S),X(a,A),X(a,z),X(a,D)},p(B,O){O&16384&&i!==(i=B[14].area_km2.toFixed(1)+"")&&xi(l,i),O&16384&&v!==(v=B[14].touches_big_road+"")&&xi(k,v),O&16384&&E!==(E=B[14].touches_railway+"")&&xi(A,E),O&16384&&R!==(R=B[14].touches_waterway+"")&&xi(D,R)},d(B){B&&(ae(e),ae(d),ae(a))}}}function yS(o){let e,t;return e=new $o({props:{openOn:"hover",$$slots:{default:[_S,({props:i})=>({14:i}),({props:i})=>i?16384:0]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&49152&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function vS(o){let e,t,i,l;const u=[rn("auto-boundaries-areas"),{filter:o[6](o[0],o[1])},{manageHoverState:!0},{paint:{"fill-color":["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"],"fill-opacity":Fa(.3,.7)}},{hoverCursor:"pointer"}];let d={$$slots:{default:[yS]},$$scope:{ctx:o}};for(let v=0;v<u.length;v+=1)d=Xi(d,u[v]);e=new Es({props:d}),e.$on("click",o[4]);const a=[rn("auto-boundaries-severances"),{filter:S4},{manageHoverState:!0},{paint:{"line-color":Fa("black","red"),"line-width":3}}];let _={};for(let v=0;v<a.length;v+=1)_=Xi(_,a[v]);return i=new Wr({props:_}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment)},m(v,k){Ee(e,v,k),le(v,t,k),Ee(i,v,k),l=!0},p(v,k){const S=k&67?tc(u,[u[0],{filter:v[6](v[0],v[1])},u[2],u[3],u[4]]):{};k&32768&&(S.$$scope={dirty:k,ctx:v}),e.$set(S);const E={};i.$set(E)},i(v){l||(Q(e.$$.fragment,v),Q(i.$$.fragment,v),l=!0)},o(v){re(e.$$.fragment,v),re(i.$$.fragment,v),l=!1},d(v){v&&ae(t),Me(e,v),Me(i,v)}}}function bS(o){let e,t,i;return t=new cr({props:{data:o[3],generateId:!0,$$slots:{default:[vS]},$$scope:{ctx:o}}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","map")},m(l,u){le(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&32771&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(Q(t.$$.fragment,l),i=!0)},o(l){re(t.$$.fragment,l),i=!1},d(l){l&&ae(e),Me(t)}}}function wS(o){let e,t;return e=new Lo({props:{$$slots:{map:[bS],sidebar:[gS],top:[mS]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&32775&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function xS(o,e,t){let i,l,u;lt(o,Ht,B=>t(2,i=B)),lt(o,Ru,B=>t(12,l=B)),lt(o,Cn,B=>t(13,u=B));let d=u.renderAutoBoundaries(),a=0,_=!0;function v(B){let O=kp(u,"What do you want to name the neighbourhood?","");if(O)try{let j={type:"Feature",properties:{},geometry:d.features[B.detail.features[0].id].geometry};u.setNeighbourhoodBoundary(O,j),nc(),u.setCurrentNeighbourhood(O,l),Tt(Ht,i={mode:"neighbourhood"},i)}catch(j){console.log(j),window.alert("Known georust bug hit, sorry. You may need to just refresh the page now.")}}function k(){_d("auto_boundaries.geojson",JSON.stringify(d,null,"  "))}function S(B,O){let j=["all",k4,[">=",["get","area_km2"],B]];return O&&j.push(["get","touches_big_road"]),j}const E=()=>Tt(Ht,i={mode:"network"},i);function A(){a=Ep(this.value),t(0,a)}function z(){_=this.checked,t(1,_)}return[a,_,i,d,v,k,S,E,A,z,()=>Tt(Ht,i={mode:"title",firstLoad:!1},i),()=>Tt(Ht,i={mode:"network"},i)]}class kS extends qt{constructor(e){super(),$t(this,e,xS,wS,Bt,{})}}function SS(o){let e,t,i,l,u,d;const a=[rn("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:o[0]=="cells"?"none":"visible"}},{paint:{"fill-color":["get","color"],"fill-opacity":.8}}];let _={};for(let A=0;A<a.length;A+=1)_=Xi(_,a[A]);e=new Es({props:_});const v=[rn("border-arrows"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"fill-color":["get","color"]}}];let k={};for(let A=0;A<v.length;A+=1)k=Xi(k,v[A]);i=new Es({props:k});const S=[rn("border-arrow-outlines"),{filter:["==",["get","kind"],"border_arrow"]},{paint:{"line-color":"black","line-width":2}}];let E={};for(let A=0;A<S.length;A+=1)E=Xi(E,S[A]);return u=new Wr({props:E}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment)},m(A,z){Ee(e,A,z),le(A,t,z),Ee(i,A,z),le(A,l,z),Ee(u,A,z),d=!0},p(A,[z]){const R=z&1?tc(a,[a[0],a[1],{layout:{visibility:A[0]=="cells"?"none":"visible"}},a[3]]):{};e.$set(R);const D={};i.$set(D);const B={};u.$set(B)},i(A){d||(Q(e.$$.fragment,A),Q(i.$$.fragment,A),Q(u.$$.fragment,A),d=!0)},o(A){re(e.$$.fragment,A),re(i.$$.fragment,A),re(u.$$.fragment,A),d=!1},d(A){A&&(ae(t),ae(l)),Me(e,A),Me(i,A),Me(u,A)}}}function TS(o,e,t){let i;return lt(o,xd,l=>t(0,i=l)),[i]}class Rd extends qt{constructor(e){super(),$t(this,e,TS,SS,Bt,{})}}function CS(o){let e,t;const i=[rn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Es({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,[d]){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}class Bd extends qt{constructor(e){super(),$t(this,e,null,CS,Bt,{})}}const ES=o=>({}),ty=o=>({});function iy(o){let e;const t=o[7]["line-popup"],i=Bi(t,o,o[9],ty);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&512)&&Oi(i,t,l,l[9],e?Fi(t,l[9],u,ES):Ni(l[9]),ty)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function MS(o){let e,t,i=o[0]&&iy(o);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),le(l,e,u),t=!0},p(l,u){l[0]?i?(i.p(l,u),u&1&&Q(i,1)):(i=iy(l),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(l)}}}function IS(o){let e,t,i,l;const u=[rn("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":o[6](o[2],o[4].maxShortcuts,0),"line-color":"black"}}];let d={};for(let v=0;v<u.length;v+=1)d=Xi(d,u[v]);e=new Wr({props:d});const a=[rn("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":o[6](o[2],o[4].maxShortcuts,0),"line-color":o[5](o[3],o[4].maxShortcuts),"line-opacity":Fa(1,.5)}},{manageHoverState:o[0]},{hoverCursor:o[0]?"pointer":void 0}];let _={$$slots:{default:[MS]},$$scope:{ctx:o}};for(let v=0;v<a.length;v+=1)_=Xi(_,a[v]);return i=new Wr({props:_}),i.$on("click",o[8]),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment)},m(v,k){Ee(e,v,k),le(v,t,k),Ee(i,v,k),l=!0},p(v,[k]){const S=k&84?tc(u,[u[0],u[1],{paint:{"line-width":v[6](v[2],v[4].maxShortcuts,0),"line-color":"black"}}]):{};e.$set(S);const E=k&125?tc(a,[a[0],a[1],k&124&&{paint:{"line-width":v[6](v[2],v[4].maxShortcuts,0),"line-color":v[5](v[3],v[4].maxShortcuts),"line-opacity":Fa(1,.5)}},k&1&&{manageHoverState:v[0]},k&1&&{hoverCursor:v[0]?"pointer":void 0}]):{};k&513&&(E.$$scope={dirty:k,ctx:v}),i.$set(E)},i(v){l||(Q(e.$$.fragment,v),Q(i.$$.fragment,v),l=!0)},o(v){re(e.$$.fragment,v),re(i.$$.fragment,v),l=!1},d(v){v&&ae(t),Me(e,v),Me(i,v)}}}function LS(o,e,t){let i,l;lt(o,up,A=>t(2,i=A)),lt(o,xd,A=>t(3,l=A));let{$$slots:u={},$$scope:d}=e,a=Md("neighbourhoodGj"),{interactive:_=!0}=e,{onClickLine:v=(A,z)=>{}}=e;function k(A,z){return A=="cells"?["get","color"]:A=="edits"?["case",["get","edited"],"grey","white"]:z<=2?Fa("white","blue"):Fa(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",z,"#A32015"],"blue")}function S(A,z,R){return!A||z<=2?cS(R):["interpolate",["linear"],["get","shortcuts"],0,5+R,z,25+R]}const E=A=>_&&v(A.detail.features[0],A.detail.event.lngLat);return o.$$set=A=>{"interactive"in A&&t(0,_=A.interactive),"onClickLine"in A&&t(1,v=A.onClickLine),"$$scope"in A&&t(9,d=A.$$scope)},[_,v,i,l,a,k,S,u,E,d]}class Wu extends qt{constructor(e){super(),$t(this,e,LS,IS,Bt,{interactive:0,onClickLine:1})}}function AS(o){let e;const t=o[3].default,i=Bi(t,o,o[5],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&32)&&Oi(i,t,l,l[5],e?Fi(t,l[5],u,null):Ni(l[5]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function PS(o){let e,t;const i=[rn("modal-filters"),{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let l={$$slots:{default:[AS]},$$scope:{ctx:o}};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new E0({props:l}),e.$on("click",o[4]),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};d&32&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function zS(o){let e,t;return e=new cr({props:{data:o[0],generateId:!0,$$slots:{default:[PS]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&32&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function DS(o,e,t){let i,l,u;lt(o,Cn,v=>t(1,l=v)),lt(o,vs,v=>t(2,u=v));let{$$slots:d={},$$scope:a}=e;function _(v){ui.call(this,o,v)}return o.$$set=v=>{"$$scope"in v&&t(5,a=v.$$scope)},o.$$.update=()=>{o.$$.dirty&6&&t(0,i=u>0?l.renderModalFilters():Jl())},[i,l,u,d,_,a]}class ja extends qt{constructor(e){super(),$t(this,e,DS,zS,Bt,{})}}function RS(o){let e,t;const i=[rn("one-ways"),{filter:["all",["==",["get","kind"],"interior_road"],["!=",["get","direction"],"both"]]},{layout:{"icon-image":"oneway-arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","direction"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","direction_edited"],1,.5]}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new E0({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,[d]){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}class Fd extends qt{constructor(e){super(),$t(this,e,null,RS,Bt,{})}}function BS(o){let e;const t=o[3].default,i=Bi(t,o,o[4],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16)&&Oi(i,t,l,l[4],e?Fi(t,l[4],u,null):Ni(l[4]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function FS(o){let e,t;return e=new cr({props:{data:o[0],generateId:!0,$$slots:{default:[BS]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&16&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function OS(o,e,t){let i,l;lt(o,Cn,_=>t(2,l=_));let{$$slots:u={},$$scope:d}=e,{input:a=null}=e;return o.$$set=_=>{"input"in _&&t(1,a=_.input),"$$scope"in _&&t(4,d=_.$$scope)},o.$$.update=()=>{o.$$.dirty&6&&t(0,i=a||l.renderNeighbourhood()),o.$$.dirty&1&&Ed("neighbourhoodGj",i)},[i,a,l,u,d]}class Hu extends qt{constructor(e){super(),$t(this,e,OS,FS,Bt,{input:1})}}function NS(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function jS(o){let e;return{c(){e=Xe("Pick neighbourhood")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function US(o){let e;return{c(){e=Xe("Editing")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function VS(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z;return u=new Ei({props:{$$slots:{default:[NS]},$$scope:{ctx:o}}}),u.$on("click",o[4]),_=new Ei({props:{$$slots:{default:[jS]},$$scope:{ctx:o}}}),_.$on("click",o[5]),S=new Ei({props:{$$slots:{default:[US]},$$scope:{ctx:o}}}),S.$on("click",o[6]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),Ie(_.$$.fragment),v=ze(),k=oe("li"),Ie(S.$$.fragment),E=ze(),A=oe("li"),A.textContent="Debug mode",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(R,D){le(R,e,D),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),Ee(_,a,null),X(i,v),X(i,k),Ee(S,k,null),X(i,E),X(i,A),z=!0},p(R,D){const B={};D&256&&(B.$$scope={dirty:D,ctx:R}),u.$set(B);const O={};D&256&&(O.$$scope={dirty:D,ctx:R}),_.$set(O);const j={};D&256&&(j.$$scope={dirty:D,ctx:R}),S.$set(j)},i(R){z||(Q(u.$$.fragment,R),Q(_.$$.fragment,R),Q(S.$$.fragment,R),z=!0)},o(R){re(u.$$.fragment,R),re(_.$$.fragment,R),re(S.$$.fragment,R),z=!1},d(R){R&&ae(e),Me(u),Me(_),Me(S)}}}function $S(o){let e,t,i;return t=new lc({}),t.$on("click",o[3]),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","sidebar")},m(l,u){le(l,e,u),Ee(t,e,null),i=!0},p:Lt,i(l){i||(Q(t.$$.fragment,l),i=!0)},o(l){re(t.$$.fragment,l),i=!1},d(l){l&&ae(e),Me(t)}}}function qS(o){let e,t;return e=new Ld({props:{properties:o[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function ZS(o){let e,t;return e=new $o({props:{openOn:"hover",$$slots:{default:[qS,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function GS(o){let e,t;return e=new Ld({props:{properties:o[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function WS(o){let e,t;return e=new $o({props:{openOn:"hover",$$slots:{default:[GS,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function HS(o){let e,t;return e=new Ld({props:{properties:o[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function XS(o){let e,t,i;return t=new $o({props:{openOn:"hover",$$slots:{default:[HS,({props:l})=>({7:l}),({props:l})=>l?128:0]},$$scope:{ctx:o}}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","line-popup")},m(l,u){le(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(Q(t.$$.fragment,l),i=!0)},o(l){re(t.$$.fragment,l),i=!1},d(l){l&&ae(e),Me(t)}}}function KS(o){let e,t,i,l,u,d,a,_,v,k,S,E;e=new Bd({}),i=new Rd({}),u=new Fd({});const A=[rn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let z={$$slots:{default:[ZS]},$$scope:{ctx:o}};for(let B=0;B<A.length;B+=1)z=Xi(z,A[B]);a=new Op({props:z});const R=[rn("debug-crosses"),{filter:["==",["get","kind"],"crosses"]},{paint:{"line-width":5,"line-color":"blue"}}];let D={$$slots:{default:[WS]},$$scope:{ctx:o}};for(let B=0;B<R.length;B+=1)D=Xi(D,R[B]);return v=new Wr({props:D}),S=new Wu({props:{interactive:!0,onClickLine:o[2],$$slots:{"line-popup":[XS]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment),d=ze(),Ie(a.$$.fragment),_=ze(),Ie(v.$$.fragment),k=ze(),Ie(S.$$.fragment)},m(B,O){Ee(e,B,O),le(B,t,O),Ee(i,B,O),le(B,l,O),Ee(u,B,O),le(B,d,O),Ee(a,B,O),le(B,_,O),Ee(v,B,O),le(B,k,O),Ee(S,B,O),E=!0},p(B,O){const j={};O&256&&(j.$$scope={dirty:O,ctx:B}),a.$set(j);const V={};O&256&&(V.$$scope={dirty:O,ctx:B}),v.$set(V);const se={};O&256&&(se.$$scope={dirty:O,ctx:B}),S.$set(se)},i(B){E||(Q(e.$$.fragment,B),Q(i.$$.fragment,B),Q(u.$$.fragment,B),Q(a.$$.fragment,B),Q(v.$$.fragment,B),Q(S.$$.fragment,B),E=!0)},o(B){re(e.$$.fragment,B),re(i.$$.fragment,B),re(u.$$.fragment,B),re(a.$$.fragment,B),re(v.$$.fragment,B),re(S.$$.fragment,B),E=!1},d(B){B&&(ae(t),ae(l),ae(d),ae(_),ae(k)),Me(e,B),Me(i,B),Me(u,B),Me(a,B),Me(v,B),Me(S,B)}}}function JS(o){let e,t;return e=new Ld({props:{properties:o[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&128&&(u.properties=i[7]),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function YS(o){let e,t;return e=new $o({props:{openOn:"hover",$$slots:{default:[JS,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&384&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function QS(o){let e,t;const i=[rn("debug-filters"),{paint:{"circle-radius":15,"circle-color":"black"}}];let l={$$slots:{default:[YS]},$$scope:{ctx:o}};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Op({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};d&256&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function e3(o){let e,t,i,l,u;return t=new Hu({props:{$$slots:{default:[KS]},$$scope:{ctx:o}}}),l=new cr({props:{data:yr(o[0]).renderModalFilters(),generateId:!0,$$slots:{default:[QS]},$$scope:{ctx:o}}}),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),Ie(l.$$.fragment),ke(e,"slot","map")},m(d,a){le(d,e,a),Ee(t,e,null),X(e,i),Ee(l,e,null),u=!0},p(d,a){const _={};a&256&&(_.$$scope={dirty:a,ctx:d}),t.$set(_);const v={};a&1&&(v.data=yr(d[0]).renderModalFilters()),a&256&&(v.$$scope={dirty:a,ctx:d}),l.$set(v)},i(d){u||(Q(t.$$.fragment,d),Q(l.$$.fragment,d),u=!0)},o(d){re(t.$$.fragment,d),re(l.$$.fragment,d),u=!1},d(d){d&&ae(e),Me(t),Me(l)}}}function t3(o){let e,t;return e=new Lo({props:{$$slots:{map:[e3],sidebar:[$S],top:[VS]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&259&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function i3(o,e,t){let i,l;return lt(o,Cn,k=>t(0,i=k)),lt(o,Ht,k=>t(1,l=k)),[i,l,(k,S)=>window.open(yr(k.properties).way,"_blank"),()=>Tt(Ht,l={mode:"neighbourhood"},l),()=>Tt(Ht,l={mode:"title",firstLoad:!1},l),()=>Tt(Ht,l={mode:"network"},l),()=>Tt(Ht,l={mode:"neighbourhood"},l)]}class n3 extends qt{constructor(e){super(),$t(this,e,i3,t3,Bt,{})}}var uo=63710088e-1,Z0={centimeters:uo*100,centimetres:uo*100,degrees:360/(2*Math.PI),feet:uo*3.28084,inches:uo*39.37,kilometers:uo/1e3,kilometres:uo/1e3,meters:uo,metres:uo,miles:uo/1609.344,millimeters:uo*1e3,millimetres:uo*1e3,nauticalmiles:uo/1852,radians:1,yards:uo*1.0936};function r3(o,e,t={}){const i={type:"Feature"};return(t.id===0||t.id)&&(i.id=t.id),t.bbox&&(i.bbox=t.bbox),i.properties=e||{},i.geometry=o,i}function Sp(o,e,t={}){if(!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ny(o[0])||!ny(o[1]))throw new Error("coordinates must contain numbers");return r3({type:"Point",coordinates:o},e,t)}function o3(o,e="kilometers"){const t=Z0[e];if(!t)throw new Error(e+" units is invalid");return o*t}function s3(o,e="kilometers"){const t=Z0[e];if(!t)throw new Error(e+" units is invalid");return o/t}function Tp(o){return o%(2*Math.PI)*180/Math.PI}function jo(o){return o%360*Math.PI/180}function ny(o){return!isNaN(o)&&o!==null&&!Array.isArray(o)}function Uu(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if(o.type==="Feature"&&o.geometry!==null&&o.geometry.type==="Point")return[...o.geometry.coordinates];if(o.type==="Point")return[...o.coordinates]}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return[...o];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function a3(o){return o.type==="Feature"?o.geometry:o}function G0(o,e,t={}){if(t.final===!0)return l3(o,e);const i=Uu(o),l=Uu(e),u=jo(i[0]),d=jo(l[0]),a=jo(i[1]),_=jo(l[1]),v=Math.sin(d-u)*Math.cos(_),k=Math.cos(a)*Math.sin(_)-Math.sin(a)*Math.cos(_)*Math.cos(d-u);return Tp(Math.atan2(v,k))}function l3(o,e){let t=G0(e,o);return t=(t+180)%360,t}function c3(o,e,t,i={}){const l=Uu(o),u=jo(l[0]),d=jo(l[1]),a=jo(t),_=s3(e,i.units),v=Math.asin(Math.sin(d)*Math.cos(_)+Math.cos(d)*Math.sin(_)*Math.cos(a)),k=u+Math.atan2(Math.sin(a)*Math.sin(_)*Math.cos(d),Math.cos(_)-Math.sin(d)*Math.sin(v)),S=Tp(k),E=Tp(v);return Sp([S,E],i.properties)}function u3(o,e,t={}){var i=Uu(o),l=Uu(e),u=jo(l[1]-i[1]),d=jo(l[0]-i[0]),a=jo(i[1]),_=jo(l[1]),v=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(a)*Math.cos(_);return o3(2*Math.atan2(Math.sqrt(v),Math.sqrt(1-v)),t.units)}function h3(o,e,t={}){const l=a3(o).coordinates;let u=0;for(let d=0;d<l.length&&!(e>=u&&d===l.length-1);d++)if(u>=e){const a=e-u;if(a){const _=G0(l[d],l[d-1])-180;return c3(l[d],a,_,t)}else return Sp(l[d])}else u+=u3(l[d],l[d+1],t);return Sp(l[l.length-1])}var d3=h3;function f3(o){let e,t;const i=[rn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Op({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function p3(o){let e,t;return e=new cr({props:{data:o[0],$$slots:{default:[f3]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&1024&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}let m3=50,g3=100,_3=.01;function y3(o,e,t){let{paths:i}=e,l=_(),u=v(),d=S(),a=setInterval(E,g3);Jn(()=>clearInterval(a));function _(){return i.features.map(A=>1/A.properties.directness).reduce((A,z)=>A+z,0)}function v(){return i.features.length==0?[]:Array.from({length:m3},k)}function k(){let A=Math.random()*l,z=0;for(let[R,D]of i.features.entries())if(z+=1/D.properties.directness,A<z)return{idx:R,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${l}`)}function S(){return{type:"FeatureCollection",features:u.map(({idx:A,distance:z})=>d3(i.features[A],z,{units:"kilometers"}))}}function E(){for(let[A,z]of u.entries())z.distance+=_3,z.distance>=i.features[z.idx].properties.length_meters/1e3&&(u[A]=k());t(0,d=S())}return o.$$set=A=>{"paths"in A&&t(1,i=A.paths)},o.$$.update=()=>{o.$$.dirty&2&&i&&(l=_(),u=v())},[d,i]}class v3 extends qt{constructor(e){super(),$t(this,e,y3,p3,Bt,{paths:1})}}function ry(o,e,t){const i=o.slice();return i[7]=e[t][0],i[8]=e[t][1],i[9]=e[t][2],i}function oy(o){let e,t,i,l,u,d,a=o[8]+"",_,v,k,S,E;function A(){return o[3](o[7])}return{c(){e=oe("button"),t=oe("img"),l=ze(),u=oe("br"),d=ze(),_=Xe(a),v=ze(),Tn(t.src,i=`/ltn//filters/${o[7]}_icon.gif`)||ke(t,"src",i),ke(t,"width","80"),ke(t,"alt",o[8]),ke(e,"class","outline"),nn(e,"width","100%"),e.disabled=k=o[0]==o[7]},m(z,R){le(z,e,R),X(e,t),X(e,l),X(e,u),X(e,d),X(e,_),X(e,v),S||(E=xt(e,"click",A),S=!0)},p(z,R){o=z,R&1&&k!==(k=o[0]==o[7])&&(e.disabled=k)},d(z){z&&ae(e),S=!1,E()}}}function b3(o){let e,t,i,l,u,d,a,_,v,k,S,E,A=o[1][2]+"",z,R,D,B,O,j,V=Kn(o[2]),se=[];for(let Z=0;Z<V.length;Z+=1)se[Z]=oy(ry(o,V,Z));function ce(){return o[4](o[6])}return{c(){e=oe("h3"),e.textContent="Choose a modal filter to place on streets",t=ze(),i=oe("table"),l=oe("tr"),u=oe("td");for(let Z=0;Z<se.length;Z+=1)se[Z].c();d=ze(),a=oe("td"),_=oe("img"),S=ze(),E=oe("p"),z=Xe(A),R=ze(),D=oe("center"),B=oe("button"),B.textContent="Confirm",Tn(_.src,v=`/ltn//filters/${o[0]}.gif`)||ke(_,"src",v),ke(_,"height","300"),ke(_,"alt",k=o[1][1])},m(Z,Y){le(Z,e,Y),le(Z,t,Y),le(Z,i,Y),X(i,l),X(l,u);for(let ye=0;ye<se.length;ye+=1)se[ye]&&se[ye].m(u,null);X(l,d),X(l,a),X(a,_),X(a,S),X(a,E),X(E,z),le(Z,R,Y),le(Z,D,Y),X(D,B),O||(j=xt(B,"click",ce),O=!0)},p(Z,Y){if(o=Z,Y&5){V=Kn(o[2]);let ye;for(ye=0;ye<V.length;ye+=1){const Oe=ry(o,V,ye);se[ye]?se[ye].p(Oe,Y):(se[ye]=oy(Oe),se[ye].c(),se[ye].m(u,null))}for(;ye<se.length;ye+=1)se[ye].d(1);se.length=V.length}Y&1&&!Tn(_.src,v=`/ltn//filters/${o[0]}.gif`)&&ke(_,"src",v),Y&2&&k!==(k=o[1][1])&&ke(_,"alt",k),Y&2&&A!==(A=o[1][2]+"")&&xi(z,A)},d(Z){Z&&(ae(e),ae(t),ae(i),ae(R),ae(D)),Ss(se,Z),O=!1,j()}}}function w3(o){let e,t;return e=new Id({props:{$$slots:{default:[b3,({dialog:i})=>({6:i}),({dialog:i})=>i?64:0]},$$scope:{ctx:o}}}),e.$on("close",o[5]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&4163&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function x3(o,e,t){let i,l;lt(o,cp,v=>t(0,l=v));let u=[["walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter."],["no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through."],["bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier."],["school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school."]];const d=v=>Tt(cp,l=v,l),a=v=>yr(v).close();function _(v){ui.call(this,o,v)}return o.$$.update=()=>{o.$$.dirty&1&&t(1,i=u.find(v=>v[0]==l))},[l,i,u,d,a,_]}class k3 extends qt{constructor(e){super(),$t(this,e,x3,w3,Bt,{})}}function sy(o){let e,t;return e=new cr({props:{data:o[0],$$slots:{default:[S3]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.data=i[0]),l&64&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function S3(o){let e,t;const i=[rn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Wr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function T3(o){let e,t,i=o[0]&&sy(o);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),le(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&Q(i,1)):(i=sy(l),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(l)}}}function C3(o,e,t){let{map:i}=e,l=null;const u=ns();i.on("dragstart",d),i.on("mousemove",a),i.on("mouseup",_),Jn(()=>{i.dragPan.enable(),i.off("dragstart",d),i.off("mousemove",a),i.off("mouseup",_)});function d(){i.dragPan.disable(),t(0,l={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(v){l&&(l.geometry.coordinates.push(v.lngLat.toArray()),t(0,l))}function _(){l&&(u("done",l),t(0,l=null))}return o.$$set=v=>{"map"in v&&t(1,i=v.map)},[l,i]}class E3 extends qt{constructor(e){super(),$t(this,e,C3,T3,Bt,{map:1})}}function M3(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function I3(o){let e;return{c(){e=Xe("Pick neighbourhood")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function L3(o){let e;return{c(){e=oe("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function A3(o){let e;return{c(){e=Xe("View shortcuts")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function P3(o){let e;return{c(){e=Xe("Route")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function z3(o){let e;return{c(){e=Xe("Impact routing to one destination")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function D3(o){let e;return{c(){e=Xe("Change this boundary")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function R3(o){let e;return{c(){e=Xe("Debug")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function B3(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R,D,B,O,j,V,se,ce,Z,Y,ye,Oe,ne,ve,Je,Le;return u=new Ei({props:{$$slots:{default:[M3]},$$scope:{ctx:o}}}),u.$on("click",o[28]),_=new Ei({props:{$$slots:{default:[I3]},$$scope:{ctx:o}}}),_.$on("click",o[29]),E=new Zp({props:{$$slots:{default:[L3]},$$scope:{ctx:o}}}),B=new Ei({props:{$$slots:{default:[A3]},$$scope:{ctx:o}}}),B.$on("click",o[30]),V=new Ei({props:{$$slots:{default:[P3]},$$scope:{ctx:o}}}),V.$on("click",o[31]),Z=new Ei({props:{$$slots:{default:[z3]},$$scope:{ctx:o}}}),Z.$on("click",o[32]),Oe=new Ei({props:{$$slots:{default:[D3]},$$scope:{ctx:o}}}),Oe.$on("click",o[33]),Je=new Ei({props:{$$slots:{default:[R3]},$$scope:{ctx:o}}}),Je.$on("click",o[34]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),Ie(_.$$.fragment),v=ze(),k=oe("li"),S=Xe(`Editing
          `),Ie(E.$$.fragment),A=ze(),z=oe("nav"),R=oe("ul"),D=oe("li"),Ie(B.$$.fragment),O=ze(),j=oe("li"),Ie(V.$$.fragment),se=ze(),ce=oe("li"),Ie(Z.$$.fragment),Y=ze(),ye=oe("li"),Ie(Oe.$$.fragment),ne=ze(),ve=oe("li"),Ie(Je.$$.fragment),ke(t,"aria-label","breadcrumb"),ke(e,"slot","top"),nn(e,"display","flex"),nn(e,"justify-content","space-between")},m(et,bt){le(et,e,bt),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),Ee(_,a,null),X(i,v),X(i,k),X(k,S),Ee(E,k,null),X(e,A),X(e,z),X(z,R),X(R,D),Ee(B,D,null),X(R,O),X(R,j),Ee(V,j,null),X(R,se),X(R,ce),Ee(Z,ce,null),X(R,Y),X(R,ye),Ee(Oe,ye,null),X(R,ne),X(R,ve),Ee(Je,ve,null),Le=!0},p(et,bt){const pt={};bt[1]&128&&(pt.$$scope={dirty:bt,ctx:et}),u.$set(pt);const at={};bt[1]&128&&(at.$$scope={dirty:bt,ctx:et}),_.$set(at);const Xt={};bt[1]&128&&(Xt.$$scope={dirty:bt,ctx:et}),E.$set(Xt);const ni={};bt[1]&128&&(ni.$$scope={dirty:bt,ctx:et}),B.$set(ni);const Nt={};bt[1]&128&&(Nt.$$scope={dirty:bt,ctx:et}),V.$set(Nt);const zt={};bt[1]&128&&(zt.$$scope={dirty:bt,ctx:et}),Z.$set(zt);const Yt={};bt[1]&128&&(Yt.$$scope={dirty:bt,ctx:et}),Oe.$set(Yt);const It={};bt[1]&128&&(It.$$scope={dirty:bt,ctx:et}),Je.$set(It)},i(et){Le||(Q(u.$$.fragment,et),Q(_.$$.fragment,et),Q(E.$$.fragment,et),Q(B.$$.fragment,et),Q(V.$$.fragment,et),Q(Z.$$.fragment,et),Q(Oe.$$.fragment,et),Q(Je.$$.fragment,et),Le=!0)},o(et){re(u.$$.fragment,et),re(_.$$.fragment,et),re(E.$$.fragment,et),re(B.$$.fragment,et),re(V.$$.fragment,et),re(Z.$$.fragment,et),re(Oe.$$.fragment,et),re(Je.$$.fragment,et),Le=!1},d(et){et&&ae(e),Me(u),Me(_),Me(E),Me(B),Me(V),Me(Z),Me(Oe),Me(Je)}}}function ay(o){let e;return{c(){e=oe("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function F3(o){let e,t,i;return{c(){e=Xe("Undo ("),t=Xe(o[4]),i=Xe(")")},m(l,u){le(l,e,u),le(l,t,u),le(l,i,u)},p(l,u){u[0]&16&&xi(t,l[4])},d(l){l&&(ae(e),ae(t),ae(i))}}}function O3(o){let e;return{c(){e=Xe("Undo")},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function N3(o){let e,t,i;return{c(){e=Xe("Redo ("),t=Xe(o[5]),i=Xe(")")},m(l,u){le(l,e,u),le(l,t,u),le(l,i,u)},p(l,u){u[0]&32&&xi(t,l[5])},d(l){l&&(ae(e),ae(t),ae(i))}}}function j3(o){let e;return{c(){e=Xe("Redo")},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function ly(o){let e,t;return e=new k3({}),e.$on("close",o[27]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function U3(o){let e,t,i,l,u=yr(o[6]).properties.name+"",d,a,_=o[1].area_km2.toFixed(1)+"",v,k,S,E,A,z,R,D,B,O,j,V,se,ce,Z,Y,ye,Oe,ne,ve,Je,Le,et,bt,pt,at,Xt,ni,Nt,zt,Yt,It,ti,Zt,hi,ki,yi,Pi,ut,At=o[8]>0&&ay();function Ne(We,St){return We[4]==0?O3:F3}let je=Ne(o),ot=je(o);function kt(We,St){return We[5]==0?j3:N3}let we=kt(o),di=we(o),Ve=o[3]&&ly(o);return{c(){e=oe("div"),t=oe("p"),i=Xe("Editing neighbourhood "),l=oe("u"),d=Xe(u),a=Xe(`
      , with an area of `),v=Xe(_),k=Xe(" km"),S=ze(),At&&At.c(),E=ze(),A=oe("div"),z=oe("button"),R=oe("img"),B=Xe(`
        Add a modal filter`),j=ze(),V=oe("button"),se=Xe("Add many modal filters along line"),Z=ze(),Y=oe("button"),ye=Xe("Reverse directions"),ne=ze(),ve=oe("button"),ve.textContent="Change modal filter type",Je=ze(),Le=oe("label"),et=oe("input"),bt=Xe(`
      Animate shortcuts`),pt=ze(),at=oe("label"),Xt=oe("input"),ni=Xe(`
      Include perimeter roads`),Nt=ze(),zt=oe("div"),Yt=oe("button"),ot.c(),ti=ze(),Zt=oe("button"),di.c(),ki=ze(),Ve&&Ve.c(),Tn(R.src,D=`/ltn//filters/${o[9]}_icon.gif`)||ke(R,"src",D),ke(R,"width","30"),ke(R,"alt","Add a modal filter"),z.disabled=O=o[0]=="filter",ke(z,"data-tooltip","hotkey 1"),V.disabled=ce=o[0]=="freehand-filters",ke(V,"data-tooltip","hotkey 2"),Y.disabled=Oe=o[0]=="oneway",ke(Y,"data-tooltip","hotkey 3"),nn(A,"display","flex"),nn(A,"justify-content","space-between"),ke(et,"type","checkbox"),ke(Xt,"type","checkbox"),Yt.disabled=It=o[4]==0,ke(Yt,"data-tooltip","Ctrl+Z"),Zt.disabled=hi=o[5]==0,ke(Zt,"data-tooltip","Ctrl+Y"),nn(zt,"display","flex"),nn(zt,"justify-content","space-between"),ke(e,"slot","sidebar")},m(We,St){le(We,e,St),X(e,t),X(t,i),X(t,l),X(l,d),X(t,a),X(t,v),X(t,k),X(e,S),At&&At.m(e,null),X(e,E),X(e,A),X(A,z),X(z,R),X(z,B),X(A,j),X(A,V),X(V,se),X(A,Z),X(A,Y),X(Y,ye),X(e,ne),X(e,ve),X(e,Je),X(e,Le),X(Le,et),et.checked=o[11],X(Le,bt),X(e,pt),X(e,at),X(at,Xt),Xt.checked=o[10],X(at,ni),X(e,Nt),X(e,zt),X(zt,Yt),ot.m(Yt,null),X(zt,ti),X(zt,Zt),di.m(Zt,null),X(e,ki),Ve&&Ve.m(e,null),yi=!0,Pi||(ut=[xt(z,"click",o[21]),xt(V,"click",o[22]),xt(Y,"click",o[23]),xt(ve,"click",o[24]),xt(et,"change",o[25]),xt(Xt,"change",o[26]),xt(Xt,"change",o[13]),xt(Yt,"click",o[17]),xt(Zt,"click",o[18])],Pi=!0)},p(We,St){(!yi||St[0]&64)&&u!==(u=yr(We[6]).properties.name+"")&&xi(d,u),(!yi||St[0]&2)&&_!==(_=We[1].area_km2.toFixed(1)+"")&&xi(v,_),We[8]>0?At||(At=ay(),At.c(),At.m(e,E)):At&&(At.d(1),At=null),(!yi||St[0]&512&&!Tn(R.src,D=`/ltn//filters/${We[9]}_icon.gif`))&&ke(R,"src",D),(!yi||St[0]&1&&O!==(O=We[0]=="filter"))&&(z.disabled=O),(!yi||St[0]&1&&ce!==(ce=We[0]=="freehand-filters"))&&(V.disabled=ce),(!yi||St[0]&1&&Oe!==(Oe=We[0]=="oneway"))&&(Y.disabled=Oe),St[0]&2048&&(et.checked=We[11]),St[0]&1024&&(Xt.checked=We[10]),je===(je=Ne(We))&&ot?ot.p(We,St):(ot.d(1),ot=je(We),ot&&(ot.c(),ot.m(Yt,null))),(!yi||St[0]&16&&It!==(It=We[4]==0))&&(Yt.disabled=It),we===(we=kt(We))&&di?di.p(We,St):(di.d(1),di=we(We),di&&(di.c(),di.m(Zt,null))),(!yi||St[0]&32&&hi!==(hi=We[5]==0))&&(Zt.disabled=hi),We[3]?Ve?(Ve.p(We,St),St[0]&8&&Q(Ve,1)):(Ve=ly(We),Ve.c(),Q(Ve,1),Ve.m(e,null)):Ve&&(gi(),re(Ve,1,1,()=>{Ve=null}),_i())},i(We){yi||(Q(Ve),yi=!0)},o(We){re(Ve),yi=!1},d(We){We&&ae(e),At&&At.d(),ot.d(),di.d(),Ve&&Ve.d(),Pi=!1,on(ut)}}}function cy(o){let e,t=Math.round(o[37].speed_mph)+"",i,l;return{c(){e=Xe("("),i=Xe(t),l=Xe(" mph)")},m(u,d){le(u,e,d),le(u,i,d),le(u,l,d)},p(u,d){d[1]&64&&t!==(t=Math.round(u[37].speed_mph)+"")&&xi(i,t)},d(u){u&&(ae(e),ae(i),ae(l))}}}function V3(o){let e;return{c(){e=oe("p"),e.textContent="Click to change direction"},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function $3(o){let e,t,i,l;return{c(){e=oe("div"),t=oe("img"),l=Xe(`
                Click to add modal filter`),Tn(t.src,i=`/ltn//filters/${o[9]}_icon.gif`)||ke(t,"src",i),ke(t,"width","20"),ke(t,"alt","Add modal filter")},m(u,d){le(u,e,d),X(e,t),X(e,l)},p(u,d){d[0]&512&&!Tn(t.src,i=`/ltn//filters/${u[9]}_icon.gif`)&&ke(t,"src",i)},d(u){u&&ae(e)}}}function q3(o){let e,t=o[37].shortcuts+"",i,l,u=(o[37].name??"unnamed road")+"",d,a,_,v,k=o[37].speed_mph&&cy(o);function S(z,R){return z[0]=="filter"?$3:V3}let E=S(o),A=E(o);return{c(){e=oe("p"),i=Xe(t),l=Xe(" shortcuts through "),d=Xe(u),a=ze(),k&&k.c(),_=ze(),A.c(),v=En()},m(z,R){le(z,e,R),X(e,i),X(e,l),X(e,d),X(e,a),k&&k.m(e,null),le(z,_,R),A.m(z,R),le(z,v,R)},p(z,R){R[1]&64&&t!==(t=z[37].shortcuts+"")&&xi(i,t),R[1]&64&&u!==(u=(z[37].name??"unnamed road")+"")&&xi(d,u),z[37].speed_mph?k?k.p(z,R):(k=cy(z),k.c(),k.m(e,null)):k&&(k.d(1),k=null),E===(E=S(z))&&A?A.p(z,R):(A.d(1),A=E(z),A&&(A.c(),A.m(v.parentNode,v)))},d(z){z&&(ae(e),ae(_),ae(v)),k&&k.d(),A.d(z)}}}function Z3(o){let e,t,i;return t=new $o({props:{openOn:"hover",$$slots:{default:[q3,({props:l})=>({37:l}),({props:l})=>[0,l?64:0]]},$$scope:{ctx:o}}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","line-popup")},m(l,u){le(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u[0]&513|u[1]&192&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(Q(t.$$.fragment,l),i=!0)},o(l){re(t.$$.fragment,l),i=!1},d(l){l&&ae(e),Me(t)}}}function G3(o){let e,t,i,l,u,d,a,_;return e=new Bd({}),i=new Rd({}),u=new Fd({}),a=new Wu({props:{interactive:o[0]=="filter"||o[0]=="oneway",onClickLine:o[14],$$slots:{"line-popup":[Z3]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment),d=ze(),Ie(a.$$.fragment)},m(v,k){Ee(e,v,k),le(v,t,k),Ee(i,v,k),le(v,l,k),Ee(u,v,k),le(v,d,k),Ee(a,v,k),_=!0},p(v,k){const S={};k[0]&1&&(S.interactive=v[0]=="filter"||v[0]=="oneway"),k[0]&513|k[1]&128&&(S.$$scope={dirty:k,ctx:v}),a.$set(S)},i(v){_||(Q(e.$$.fragment,v),Q(i.$$.fragment,v),Q(u.$$.fragment,v),Q(a.$$.fragment,v),_=!0)},o(v){re(e.$$.fragment,v),re(i.$$.fragment,v),re(u.$$.fragment,v),re(a.$$.fragment,v),_=!1},d(v){v&&(ae(t),ae(l),ae(d)),Me(e,v),Me(i,v),Me(u,v),Me(a,v)}}}function uy(o){let e,t;return e=new v3({props:{paths:o[7]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l[0]&128&&(u.paths=i[7]),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function W3(o){let e;return{c(){e=Xe("Click to delete")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function H3(o){let e,t;return e=new $o({props:{openOn:"hover",$$slots:{default:[W3]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l[1]&128&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function hy(o){let e,t;return e=new E3({props:{map:yr(o[2])}}),e.$on("done",o[19]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l[0]&4&&(u.map=yr(i[2])),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function X3(o){let e,t,i,l,u,d,a;t=new Hu({props:{input:o[1],$$slots:{default:[G3]},$$scope:{ctx:o}}});let _=o[11]&&uy(o);u=new ja({props:{$$slots:{default:[H3]},$$scope:{ctx:o}}}),u.$on("click",o[15]);let v=o[0]=="freehand-filters"&&hy(o);return{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),_&&_.c(),l=ze(),Ie(u.$$.fragment),d=ze(),v&&v.c(),ke(e,"slot","map")},m(k,S){le(k,e,S),Ee(t,e,null),X(e,i),_&&_.m(e,null),X(e,l),Ee(u,e,null),X(e,d),v&&v.m(e,null),a=!0},p(k,S){const E={};S[0]&2&&(E.input=k[1]),S[0]&513|S[1]&128&&(E.$$scope={dirty:S,ctx:k}),t.$set(E),k[11]?_?(_.p(k,S),S[0]&2048&&Q(_,1)):(_=uy(k),_.c(),Q(_,1),_.m(e,l)):_&&(gi(),re(_,1,1,()=>{_=null}),_i());const A={};S[1]&128&&(A.$$scope={dirty:S,ctx:k}),u.$set(A),k[0]=="freehand-filters"?v?(v.p(k,S),S[0]&1&&Q(v,1)):(v=hy(k),v.c(),Q(v,1),v.m(e,null)):v&&(gi(),re(v,1,1,()=>{v=null}),_i())},i(k){a||(Q(t.$$.fragment,k),Q(_),Q(u.$$.fragment,k),Q(v),a=!0)},o(k){re(t.$$.fragment,k),re(_),re(u.$$.fragment,k),re(v),a=!1},d(k){k&&ae(e),Me(t),_&&_.d(),Me(u),v&&v.d()}}}function K3(o){let e,t,i,l;return e=new Lo({props:{$$slots:{map:[X3],sidebar:[U3],top:[B3]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=xt(window,"keydown",o[16]),i=!0)},p(u,d){const a={};d[0]&8191|d[1]&128&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function J3(o,e,t){let i,l,u,d,a,_,v,k;lt(o,vs,It=>t(20,l=It)),lt(o,cp,It=>t(9,u=It)),lt(o,Cn,It=>t(35,d=It)),lt(o,Ru,It=>t(10,a=It)),lt(o,Vo,It=>t(2,_=It)),lt(o,Pg,It=>t(11,v=It)),lt(o,Ht,It=>t(12,k=It));let S="filter",E=!1,A=0,z=0,R,D,B=d.getAllShortcuts();Jn(()=>{_.doubleClickZoom.enable()});function O(It){t(1,D=d.renderNeighbourhood()),t(6,R=D.features.find(ti=>ti.properties.kind=="boundary")),t(4,A=D.undo_length),t(5,z=D.redo_length),t(7,B=d.getAllShortcuts()),nc()}function j(){d.setCurrentNeighbourhood(R.properties.name,a),Tt(vs,l++,l)}function V(It,ti){S=="filter"?(d.addModalFilter(ti,u),Tt(vs,l++,l)):S=="oneway"&&(d.toggleDirection(It.properties.road),Tt(vs,l++,l))}function se(It){let ti=It.detail.features[0];d.deleteModalFilter(ti.properties.road),Tt(vs,l++,l)}function ce(It){It.target.tagName!="INPUT"&&(It.ctrlKey&&It.key=="z"&&Z(),It.ctrlKey&&It.key=="y"&&Y(),It.key=="1"&&t(0,S="filter"),It.key=="2"&&t(0,S="freehand-filters"),It.key=="3"&&t(0,S="oneway"))}function Z(){d.undo(),Tt(vs,l++,l)}function Y(){d.redo(),Tt(vs,l++,l)}function ye(It){let ti=It.detail;ti&&(d.addManyModalFilters(ti,u),Tt(vs,l++,l)),t(0,S="filter")}const Oe=()=>t(0,S="filter"),ne=()=>t(0,S="freehand-filters"),ve=()=>t(0,S="oneway"),Je=()=>t(3,E=!0);function Le(){v=this.checked,Pg.set(v)}function et(){a=this.checked,Ru.set(a)}const bt=()=>t(3,E=!1),pt=()=>Tt(Ht,k={mode:"title",firstLoad:!1},k),at=()=>Tt(Ht,k={mode:"network"},k),Xt=()=>Tt(Ht,k={mode:"view-shortcuts"},k),ni=()=>Tt(Ht,k={mode:"route",prevMode:"neighbourhood"},k),Nt=()=>Tt(Ht,k={mode:"impact-one-destination"},k),zt=()=>Tt(Ht,k={mode:"set-boundary",name:yr(R).properties.name,existing:R},k),Yt=()=>Tt(Ht,k={mode:"debug"},k);return o.$$.update=()=>{o.$$.dirty[0]&5&&(S=="oneway"?_.doubleClickZoom.disable():_.doubleClickZoom.enable()),o.$$.dirty[0]&1048576&&O(),o.$$.dirty[0]&2&&t(8,i=D.features.filter(It=>It.properties.kind=="cell"&&It.properties.cell_color=="disconnected").length)},[S,D,_,E,A,z,R,B,i,u,a,v,k,j,V,se,ce,Z,Y,ye,l,Oe,ne,ve,Je,Le,et,bt,pt,at,Xt,ni,Nt,zt,Yt]}class Y3 extends qt{constructor(e){super(),$t(this,e,J3,K3,Bt,{},null,[-1,-1])}}function Q3(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function eT(o){let e;return{c(){e=Xe("Pick neighbourhood")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function tT(o){let e,t,i,l,u,d,a,_,v,k,S;return u=new Ei({props:{$$slots:{default:[Q3]},$$scope:{ctx:o}}}),u.$on("click",o[9]),_=new Ei({props:{$$slots:{default:[eT]},$$scope:{ctx:o}}}),_.$on("click",o[10]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),Ie(_.$$.fragment),v=ze(),k=oe("li"),k.textContent="Predict impact",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(E,A){le(E,e,A),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),Ee(_,a,null),X(i,v),X(i,k),S=!0},p(E,A){const z={};A&8192&&(z.$$scope={dirty:A,ctx:E}),u.$set(z);const R={};A&8192&&(R.$$scope={dirty:A,ctx:E}),_.$set(R)},i(E){S||(Q(u.$$.fragment,E),Q(_.$$.fragment,E),S=!0)},o(E){re(u.$$.fragment,E),re(_.$$.fragment,E),S=!1},d(E){E&&ae(e),Me(u),Me(_)}}}function iT(o){let e;return{c(){e=Xe("Pick a different road")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function nT(o){let e,t,i,l,u,d,a,_,v=o[0]+1+"",k,S,E=o[2].length+"",A,z,R,D,B,O,j,V,se,ce;return t=new Ei({props:{$$slots:{default:[iT]},$$scope:{ctx:o}}}),t.$on("click",o[8]),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),l=oe("div"),u=oe("button"),d=Xe("Previous"),_=ze(),k=Xe(v),S=Xe(" / "),A=Xe(E),z=ze(),R=oe("button"),D=Xe("Next"),O=ze(),j=oe("p"),j.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,u.disabled=a=o[0]==0,ke(u,"data-tooltip","Left"),R.disabled=B=o[0]==o[2].length-1,ke(R,"data-tooltip","Right"),nn(l,"display","flex"),nn(l,"justify-content","space-between"),ke(e,"slot","sidebar")},m(Z,Y){le(Z,e,Y),Ee(t,e,null),X(e,i),X(e,l),X(l,u),X(u,d),X(l,_),X(l,k),X(l,S),X(l,A),X(l,z),X(l,R),X(R,D),X(e,O),X(e,j),V=!0,se||(ce=[xt(u,"click",o[4]),xt(R,"click",o[5])],se=!0)},p(Z,Y){const ye={};Y&8192&&(ye.$$scope={dirty:Y,ctx:Z}),t.$set(ye),(!V||Y&1&&a!==(a=Z[0]==0))&&(u.disabled=a),(!V||Y&1)&&v!==(v=Z[0]+1+"")&&xi(k,v),(!V||Y&1&&B!==(B=Z[0]==Z[2].length-1))&&(R.disabled=B)},i(Z){V||(Q(t.$$.fragment,Z),V=!0)},o(Z){re(t.$$.fragment,Z),V=!1},d(Z){Z&&ae(e),Me(t),se=!1,on(ce)}}}function rT(o){let e,t;const i=[rn("predict-impact"),{paint:{"line-width":Mu(["get","kind"],{focus:8},5),"line-color":Mu(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Mu(["get","kind"],{focus:1},.5)}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Wr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function oT(o){let e;return{c(){e=Xe("A")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function sT(o){let e;return{c(){e=Xe("B")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function aT(o){let e,t,i,l,u,d,a,_,v;return t=new cr({props:{data:o[6](o[0]),$$slots:{default:[rT]},$$scope:{ctx:o}}}),l=new Na({props:{lngLat:o[2][o[0]][0].geometry.coordinates[0],$$slots:{default:[oT]},$$scope:{ctx:o}}}),d=new Na({props:{lngLat:o[2][o[0]][0].geometry.coordinates[o[2][o[0]][0].geometry.coordinates.length-1],$$slots:{default:[sT]},$$scope:{ctx:o}}}),_=new ja({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),Ie(l.$$.fragment),u=ze(),Ie(d.$$.fragment),a=ze(),Ie(_.$$.fragment),ke(e,"slot","map")},m(k,S){le(k,e,S),Ee(t,e,null),X(e,i),Ee(l,e,null),X(e,u),Ee(d,e,null),X(e,a),Ee(_,e,null),v=!0},p(k,S){const E={};S&1&&(E.data=k[6](k[0])),S&8192&&(E.$$scope={dirty:S,ctx:k}),t.$set(E);const A={};S&1&&(A.lngLat=k[2][k[0]][0].geometry.coordinates[0]),S&8192&&(A.$$scope={dirty:S,ctx:k}),l.$set(A);const z={};S&1&&(z.lngLat=k[2][k[0]][0].geometry.coordinates[k[2][k[0]][0].geometry.coordinates.length-1]),S&8192&&(z.$$scope={dirty:S,ctx:k}),d.$set(z)},i(k){v||(Q(t.$$.fragment,k),Q(l.$$.fragment,k),Q(d.$$.fragment,k),Q(_.$$.fragment,k),v=!0)},o(k){re(t.$$.fragment,k),re(l.$$.fragment,k),re(d.$$.fragment,k),re(_.$$.fragment,k),v=!1},d(k){k&&ae(e),Me(t),Me(l),Me(d),Me(_)}}}function lT(o){let e,t,i,l;return e=new Lo({props:{$$slots:{map:[aT],sidebar:[nT],top:[tT]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=xt(window,"keydown",o[3]),i=!0)},p(u,[d]){const a={};d&8195&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function cT(o,e,t){let i,l,u;lt(o,Vo,D=>t(11,i=D)),lt(o,Cn,D=>t(12,l=D)),lt(o,Ht,D=>t(1,u=D));let{road:d}=e;d.properties.kind="focus";let a=l.getImpactsOnRoad(d.properties.id),_=0;$u(()=>{i==null||i.keyboard.disable()}),Jn(()=>{i==null||i.keyboard.enable()});function v(D){D.key=="ArrowLeft"&&(D.stopPropagation(),k()),D.key=="ArrowRight"&&(D.stopPropagation(),S())}function k(){_!=0&&t(0,_--,_)}function S(){_!=a.length-1&&t(0,_++,_)}function E(D){return{type:"FeatureCollection",features:[a[D][0],a[D][1],d]}}const A=()=>Tt(Ht,u={mode:"predict-impact"},u),z=()=>Tt(Ht,u={mode:"title",firstLoad:!1},u),R=()=>Tt(Ht,u={mode:"network"},u);return o.$$set=D=>{"road"in D&&t(7,d=D.road)},[_,u,a,v,k,S,E,d,A,z,R]}class uT extends qt{constructor(e){super(),$t(this,e,cT,lT,Bt,{road:7})}}function hT(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function dT(o){let e;return{c(){e=Xe("Pick neighbourhood")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function fT(o){let e;return{c(){e=Xe("Editing")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function pT(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z;return u=new Ei({props:{$$slots:{default:[hT]},$$scope:{ctx:o}}}),u.$on("click",o[12]),_=new Ei({props:{$$slots:{default:[dT]},$$scope:{ctx:o}}}),_.$on("click",o[13]),S=new Ei({props:{$$slots:{default:[fT]},$$scope:{ctx:o}}}),S.$on("click",o[5]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),Ie(_.$$.fragment),v=ze(),k=oe("li"),Ie(S.$$.fragment),E=ze(),A=oe("li"),A.textContent="Impact routing to one destination",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(R,D){le(R,e,D),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),Ee(_,a,null),X(i,v),X(i,k),Ee(S,k,null),X(i,E),X(i,A),z=!0},p(R,D){const B={};D&262144&&(B.$$scope={dirty:D,ctx:R}),u.$set(B);const O={};D&262144&&(O.$$scope={dirty:D,ctx:R}),_.$set(O);const j={};D&262144&&(j.$$scope={dirty:D,ctx:R}),S.$set(j)},i(R){z||(Q(u.$$.fragment,R),Q(_.$$.fragment,R),Q(S.$$.fragment,R),z=!0)},o(R){re(u.$$.fragment,R),re(_.$$.fragment,R),re(S.$$.fragment,R),z=!1},d(R){R&&ae(e),Me(u),Me(_),Me(S)}}}function mT(o){let e,t,i,l,u,d,a,_,v,k=o[3].highest_ratio.toFixed(1)+"",S,E;return t=new lc({}),t.$on("click",o[5]),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),l=oe("p"),l.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin aroun to change that destination.`,u=ze(),d=oe("p"),d.textContent="TODO: It's just distance right now, not time",a=ze(),_=oe("p"),v=Xe("Highest ratio is "),S=Xe(k),ke(e,"slot","sidebar")},m(A,z){le(A,e,z),Ee(t,e,null),X(e,i),X(e,l),X(e,u),X(e,d),X(e,a),X(e,_),X(_,v),X(_,S),E=!0},p(A,z){(!E||z&8)&&k!==(k=A[3].highest_ratio.toFixed(1)+"")&&xi(S,k)},i(A){E||(Q(t.$$.fragment,A),E=!0)},o(A){re(t.$$.fragment,A),E=!1},d(A){A&&ae(e),Me(t)}}}function gT(o){let e,t;const i=[rn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Es({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function _T(o){let e,t=(o[17].distance_after/o[17].distance_before).toFixed(1)+"",i;return{c(){e=Xe("Ratio "),i=Xe(t)},m(l,u){le(l,e,u),le(l,i,u)},p(l,u){u&131072&&t!==(t=(l[17].distance_after/l[17].distance_before).toFixed(1)+"")&&xi(i,t)},d(l){l&&(ae(e),ae(i))}}}function yT(o){let e,t;return e=new $o({props:{openOn:"hover",$$slots:{default:[_T,({props:i})=>({17:i}),({props:i})=>i?131072:0]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&393216&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function vT(o){let e,t,i;const l=[rn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",Math.max(o[3].highest_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function u(a){o[9](a)}let d={$$slots:{default:[yT]},$$scope:{ctx:o}};for(let a=0;a<l.length;a+=1)d=Xi(d,l[a]);return o[0]!==void 0&&(d.hovered=o[0]),e=new Wr({props:d}),Ki.push(()=>Gr(e,"hovered",u)),e.$on("click",o[10]),{c(){Ie(e.$$.fragment)},m(a,_){Ee(e,a,_),i=!0},p(a,_){const v=_&8?tc(l,[l[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","distance_after"],["get","distance_before"]],1,"white",Math.max(a[3].highest_ratio,1.1),"red"],"line-width":5}},l[2]]):{};_&262144&&(v.$$scope={dirty:_,ctx:a}),!t&&_&1&&(t=!0,v.hovered=a[0],Zr(()=>t=!1)),e.$set(v)},i(a){i||(Q(e.$$.fragment,a),i=!0)},o(a){re(e.$$.fragment,a),i=!1},d(a){Me(e,a)}}}function bT(o){let e,t;const i=[rn("compare-route"),{paint:{"line-width":10,"line-color":Mu(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Wr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function wT(o){let e;return{c(){e=Xe("X")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function xT(o){let e,t,i,l,u,d,a,_,v,k,S,E;t=new Hu({props:{$$slots:{default:[gT]},$$scope:{ctx:o}}}),l=new cr({props:{data:o[3],generateId:!0,$$slots:{default:[vT]},$$scope:{ctx:o}}}),d=new cr({props:{data:o[2],$$slots:{default:[bT]},$$scope:{ctx:o}}}),_=new ja({});function A(R){o[11](R)}let z={draggable:!0,$$slots:{default:[wT]},$$scope:{ctx:o}};return o[1]!==void 0&&(z.lngLat=o[1]),k=new Na({props:z}),Ki.push(()=>Gr(k,"lngLat",A)),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),Ie(l.$$.fragment),u=ze(),Ie(d.$$.fragment),a=ze(),Ie(_.$$.fragment),v=ze(),Ie(k.$$.fragment),ke(e,"slot","map")},m(R,D){le(R,e,D),Ee(t,e,null),X(e,i),Ee(l,e,null),X(e,u),Ee(d,e,null),X(e,a),Ee(_,e,null),X(e,v),Ee(k,e,null),E=!0},p(R,D){const B={};D&262144&&(B.$$scope={dirty:D,ctx:R}),t.$set(B);const O={};D&8&&(O.data=R[3]),D&262153&&(O.$$scope={dirty:D,ctx:R}),l.$set(O);const j={};D&4&&(j.data=R[2]),D&262144&&(j.$$scope={dirty:D,ctx:R}),d.$set(j);const V={};D&262144&&(V.$$scope={dirty:D,ctx:R}),!S&&D&2&&(S=!0,V.lngLat=R[1],Zr(()=>S=!1)),k.$set(V)},i(R){E||(Q(t.$$.fragment,R),Q(l.$$.fragment,R),Q(d.$$.fragment,R),Q(_.$$.fragment,R),Q(k.$$.fragment,R),E=!0)},o(R){re(t.$$.fragment,R),re(l.$$.fragment,R),re(d.$$.fragment,R),re(_.$$.fragment,R),re(k.$$.fragment,R),E=!1},d(R){R&&ae(e),Me(t),Me(l),Me(d),Me(_),Me(k)}}}function kT(o){let e,t,i,l;return e=new w0({}),e.$on("contextmenu",o[7]),i=new Lo({props:{$$slots:{map:[xT],sidebar:[mT],top:[pT]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment)},m(u,d){Ee(e,u,d),le(u,t,d),Ee(i,u,d),l=!0},p(u,[d]){const a={};d&262175&&(a.$$scope={dirty:d,ctx:u}),i.$set(a)},i(u){l||(Q(e.$$.fragment,u),Q(i.$$.fragment,u),l=!0)},o(u){re(e.$$.fragment,u),re(i.$$.fragment,u),l=!1},d(u){u&&ae(t),Me(e,u),Me(i,u)}}}function ST(o,e,t){let i,l,u,d,a,_,v;lt(o,ld,V=>t(1,u=V)),lt(o,Ht,V=>t(4,d=V)),lt(o,Du,V=>t(14,a=V)),lt(o,zu,V=>t(15,_=V)),lt(o,Cn,V=>t(8,v=V));function k(){Tt(Ht,d={mode:"neighbourhood"},d)}let S=null;function E(V){return V?v.compareRoute(new Ts.LngLat(V.properties.pt1_x,V.properties.pt1_y),u,1):Jl()}function A(V){Tt(zu,_=new Ts.LngLat(V.properties.pt1_x,V.properties.pt1_y),_),Tt(Du,a=u,a),Tt(Ht,d={mode:"route",prevMode:"impact-one-destination"},d)}function z(V){Tt(ld,u=V.detail.lngLat,u)}function R(V){S=V,t(0,S)}const D=V=>A(V.detail.features[0]);function B(V){u=V,ld.set(u)}const O=()=>Tt(Ht,d={mode:"title",firstLoad:!1},d),j=()=>Tt(Ht,d={mode:"network"},d);return o.$$.update=()=>{o.$$.dirty&258&&t(3,i=v.impactToOneDestination(u)),o.$$.dirty&1&&t(2,l=E(S))},[S,u,l,i,d,k,A,z,v,R,D,B,O,j]}class TT extends qt{constructor(e){super(),$t(this,e,ST,kT,Bt,{})}}const W0="/ltn/assets/delete-ec75e756.svg",H0="/ltn/assets/edit-f3f51206.svg";function dy(o,e,t){const i=o.slice();return i[21]=e[t],i}function CT(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function ET(o){let e;return{c(){e=oe("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function MT(o){let e;return{c(){e=Xe("Route")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function IT(o){let e;return{c(){e=Xe("Predict impact")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function LT(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R,D,B,O;return u=new Ei({props:{$$slots:{default:[CT]},$$scope:{ctx:o}}}),u.$on("click",o[16]),v=new Zp({props:{$$slots:{default:[ET]},$$scope:{ctx:o}}}),z=new Ei({props:{$$slots:{default:[MT]},$$scope:{ctx:o}}}),z.$on("click",o[17]),B=new Ei({props:{$$slots:{default:[IT]},$$scope:{ctx:o}}}),B.$on("click",o[18]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),_=Xe(`Pick neighbourhood
          `),Ie(v.$$.fragment),k=ze(),S=oe("nav"),E=oe("ul"),A=oe("li"),Ie(z.$$.fragment),R=ze(),D=oe("li"),Ie(B.$$.fragment),ke(t,"aria-label","breadcrumb"),ke(e,"slot","top"),nn(e,"display","flex"),nn(e,"justify-content","space-between")},m(j,V){le(j,e,V),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),X(a,_),Ee(v,a,null),X(e,k),X(e,S),X(S,E),X(E,A),Ee(z,A,null),X(E,R),X(E,D),Ee(B,D,null),O=!0},p(j,V){const se={};V&16777216&&(se.$$scope={dirty:V,ctx:j}),u.$set(se);const ce={};V&16777216&&(ce.$$scope={dirty:V,ctx:j}),v.$set(ce);const Z={};V&16777216&&(Z.$$scope={dirty:V,ctx:j}),z.$set(Z);const Y={};V&16777216&&(Y.$$scope={dirty:V,ctx:j}),B.$set(Y)},i(j){O||(Q(u.$$.fragment,j),Q(v.$$.fragment,j),Q(z.$$.fragment,j),Q(B.$$.fragment,j),O=!0)},o(j){re(u.$$.fragment,j),re(v.$$.fragment,j),re(z.$$.fragment,j),re(B.$$.fragment,j),O=!1},d(j){j&&ae(e),Me(u),Me(v),Me(z),Me(B)}}}function AT(o){let e;return{c(){e=Xe("Draw a new boundary")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function PT(o){let e;return{c(){e=Xe("Use an auto-generated boundary")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function zT(o){let e=o[21]+"",t;return{c(){t=Xe(e)},m(i,l){le(i,t,l)},p(i,l){l&2&&e!==(e=i[21]+"")&&xi(t,e)},d(i){i&&ae(t)}}}function fy(o){let e,t,i,l,u,d,a,_,v,k,S;function E(){return o[13](o[21])}i=new Ei({props:{$$slots:{default:[zT]},$$scope:{ctx:o}}}),i.$on("click",E);function A(){return o[14](o[21])}function z(){return o[15](o[21])}return{c(){e=oe("li"),t=oe("span"),Ie(i.$$.fragment),l=ze(),u=oe("button"),u.innerHTML=`<img src="${H0}" alt="Rename neighbourhood"/>`,d=ze(),a=oe("button"),a.innerHTML=`<img src="${W0}" alt="Delete neighbourhood"/>`,_=ze(),ke(u,"class","secondary"),ke(a,"class","secondary"),nn(t,"display","flex"),nn(t,"justify-content","space-between")},m(R,D){le(R,e,D),X(e,t),Ee(i,t,null),X(t,l),X(t,u),X(t,d),X(t,a),X(e,_),v=!0,k||(S=[xt(u,"click",A),xt(a,"click",z)],k=!0)},p(R,D){o=R;const B={};D&16777218&&(B.$$scope={dirty:D,ctx:o}),i.$set(B)},i(R){v||(Q(i.$$.fragment,R),v=!0)},o(R){re(i.$$.fragment,R),v=!1},d(R){R&&ae(e),Me(i),k=!1,on(S)}}}function DT(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R,D,B,O,j,V,se;i=new Ei({props:{$$slots:{default:[AT]},$$scope:{ctx:o}}}),i.$on("click",o[7]),d=new Ei({props:{$$slots:{default:[PT]},$$scope:{ctx:o}}}),d.$on("click",o[12]);let ce=Kn(o[1]),Z=[];for(let ye=0;ye<ce.length;ye+=1)Z[ye]=fy(dy(o,ce,ye));const Y=ye=>re(Z[ye],1,1,()=>{Z[ye]=null});return{c(){e=oe("div"),t=oe("div"),Ie(i.$$.fragment),l=ze(),u=oe("div"),Ie(d.$$.fragment),a=ze(),_=oe("ul");for(let ye=0;ye<Z.length;ye+=1)Z[ye].c();v=ze(),k=oe("hr"),S=ze(),E=oe("p"),A=Xe("Current project: "),z=Xe(o[2]),R=ze(),D=oe("button"),D.textContent="Export project to GeoJSON",B=ze(),O=oe("button"),O.textContent="Debug route-snapper",ke(O,"class","secondary"),ke(e,"slot","sidebar")},m(ye,Oe){le(ye,e,Oe),X(e,t),Ee(i,t,null),X(e,l),X(e,u),Ee(d,u,null),X(e,a),X(e,_);for(let ne=0;ne<Z.length;ne+=1)Z[ne]&&Z[ne].m(_,null);X(e,v),X(e,k),X(e,S),X(e,E),X(E,A),X(E,z),X(e,R),X(e,D),X(e,B),X(e,O),j=!0,V||(se=[xt(D,"click",o[8]),xt(O,"click",o[9])],V=!0)},p(ye,Oe){const ne={};Oe&16777216&&(ne.$$scope={dirty:Oe,ctx:ye}),i.$set(ne);const ve={};if(Oe&16777216&&(ve.$$scope={dirty:Oe,ctx:ye}),d.$set(ve),Oe&114){ce=Kn(ye[1]);let Je;for(Je=0;Je<ce.length;Je+=1){const Le=dy(ye,ce,Je);Z[Je]?(Z[Je].p(Le,Oe),Q(Z[Je],1)):(Z[Je]=fy(Le),Z[Je].c(),Q(Z[Je],1),Z[Je].m(_,null))}for(gi(),Je=ce.length;Je<Z.length;Je+=1)Y(Je);_i()}(!j||Oe&4)&&xi(z,ye[2])},i(ye){if(!j){Q(i.$$.fragment,ye),Q(d.$$.fragment,ye);for(let Oe=0;Oe<ce.length;Oe+=1)Q(Z[Oe]);j=!0}},o(ye){re(i.$$.fragment,ye),re(d.$$.fragment,ye),Z=Z.filter(Boolean);for(let Oe=0;Oe<Z.length;Oe+=1)re(Z[Oe]);j=!1},d(ye){ye&&ae(e),Me(i),Me(d),Ss(Z,ye),V=!1,on(se)}}}function RT(o){let e,t=o[20].name+"",i;return{c(){e=oe("p"),i=Xe(t)},m(l,u){le(l,e,u),X(e,i)},p(l,u){u&1048576&&t!==(t=l[20].name+"")&&xi(i,t)},d(l){l&&ae(e)}}}function BT(o){let e,t;return e=new $o({props:{openOn:"hover",$$slots:{default:[RT,({props:i})=>({20:i}),({props:i})=>i?1048576:0]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&17825792&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function FT(o){let e,t;const i=[rn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":Fa(.3,.5)}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[BT]},$$scope:{ctx:o}};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Es({props:l}),e.$on("click",o[11]),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};d&16777216&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function OT(o){let e,t,i,l,u;return t=new cr({props:{data:o[0],generateId:!0,$$slots:{default:[FT]},$$scope:{ctx:o}}}),l=new ja({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),Ie(l.$$.fragment),ke(e,"slot","map")},m(d,a){le(d,e,a),Ee(t,e,null),X(e,i),Ee(l,e,null),u=!0},p(d,a){const _={};a&1&&(_.data=d[0]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(Q(t.$$.fragment,d),Q(l.$$.fragment,d),u=!0)},o(d){re(t.$$.fragment,d),re(l.$$.fragment,d),u=!1},d(d){d&&ae(e),Me(t),Me(l)}}}function NT(o){let e,t;return e=new Lo({props:{$$slots:{map:[OT],sidebar:[DT],top:[LT]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&16777231&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function jT(o,e,t){let i,l,u,d,a,_;lt(o,Cn,Z=>t(10,u=Z)),lt(o,Cs,Z=>t(2,d=Z)),lt(o,Ht,Z=>t(3,a=Z)),lt(o,Ru,Z=>t(19,_=Z));function v(Z){u.setCurrentNeighbourhood(Z,_),Tt(Ht,a={mode:"neighbourhood"},a)}function k(Z){window.confirm(`Really delete neighbourhood ${Z}? You can't undo this.`)&&(u.deleteNeighbourhoodBoundary(Z),nc(),t(0,i=u.toSavefile()))}function S(Z){let Y=kp(u,`Rename neighbourhood ${Z} to what?`,Z);Y&&(u.renameNeighbourhoodBoundary(Z,Y),nc(),t(0,i=u.toSavefile()))}function E(){let Z=kp(u,"What do you want to name the neighbourhood?","");Z&&Tt(Ht,a={mode:"set-boundary",name:Z,existing:null},a)}function A(){_d(d+".geojson",JSON.stringify(u.toSavefile()))}function z(){_d("debug_route_snapper.geojson",u.toRouteSnapperGj())}const R=Z=>v(yr(Z.detail.features[0].properties).name),D=()=>Tt(Ht,a={mode:"auto-boundaries"},a),B=Z=>v(Z),O=Z=>S(Z),j=Z=>k(Z),V=()=>Tt(Ht,a={mode:"title",firstLoad:!1},a),se=()=>Tt(Ht,a={mode:"route",prevMode:"network"},a),ce=()=>Tt(Ht,a={mode:"predict-impact"},a);return o.$$.update=()=>{o.$$.dirty&1024&&t(0,i=u.toSavefile()),o.$$.dirty&1&&t(1,l=i.features.filter(Z=>Z.properties.kind=="boundary").map(Z=>Z.properties.name))},[i,l,d,a,v,k,S,E,A,z,u,R,D,B,O,j,V,se,ce]}class UT extends qt{constructor(e){super(),$t(this,e,jT,NT,Bt,{})}}function VT(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function $T(o){let e;return{c(){e=Xe("Pick neighbourhood")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function qT(o){let e,t,i,l,u,d,a,_,v,k,S;return u=new Ei({props:{$$slots:{default:[VT]},$$scope:{ctx:o}}}),u.$on("click",o[6]),_=new Ei({props:{$$slots:{default:[$T]},$$scope:{ctx:o}}}),_.$on("click",o[7]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),Ie(_.$$.fragment),v=ze(),k=oe("li"),k.textContent="Predict impact",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(E,A){le(E,e,A),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),Ee(_,a,null),X(i,v),X(i,k),S=!0},p(E,A){const z={};A&1024&&(z.$$scope={dirty:A,ctx:E}),u.$set(z);const R={};A&1024&&(R.$$scope={dirty:A,ctx:E}),_.$set(R)},i(E){S||(Q(u.$$.fragment,E),Q(_.$$.fragment,E),S=!0)},o(E){re(u.$$.fragment,E),re(_.$$.fragment,E),S=!1},d(E){E&&ae(e),Me(u),Me(_)}}}function ZT(o){let e,t,i,l,u,d,a,_,v;return t=new lc({}),t.$on("click",o[5]),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),l=oe("p"),l.textContent=`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully.`,u=ze(),d=oe("p"),d.textContent=`Red roads have increased traffic, and green roads have decreased. If
      hovering on a road doesn't show anything, there was no change there. Click
      a road to see example routes through it that've changed.`,a=ze(),_=oe("p"),_.textContent=`Thicker roads have more traffic after edits, relative to the max count for
      any road: ${o[2].max_count.toLocaleString()}`,ke(e,"slot","sidebar")},m(k,S){le(k,e,S),Ee(t,e,null),X(e,i),X(e,l),X(e,u),X(e,d),X(e,a),X(e,_),v=!0},p:Lt,i(k){v||(Q(t.$$.fragment,k),v=!0)},o(k){re(t.$$.fragment,k),v=!1},d(k){k&&ae(e),Me(t)}}}function GT(o){let e,t=o[9].before.toLocaleString()+"",i,l,u=o[9].after.toLocaleString()+"",d,a,_,v,k=Math.round(100*o[9].after/o[9].before)+"",S,E;return{c(){e=oe("p"),i=Xe(t),l=Xe(" before, "),d=Xe(u),a=Xe(`
            after`),_=ze(),v=oe("p"),S=Xe(k),E=Xe("%")},m(A,z){le(A,e,z),X(e,i),X(e,l),X(e,d),X(e,a),le(A,_,z),le(A,v,z),X(v,S),X(v,E)},p(A,z){z&512&&t!==(t=A[9].before.toLocaleString()+"")&&xi(i,t),z&512&&u!==(u=A[9].after.toLocaleString()+"")&&xi(d,u),z&512&&k!==(k=Math.round(100*A[9].after/A[9].before)+"")&&xi(S,k)},d(A){A&&(ae(e),ae(_),ae(v))}}}function WT(o){let e,t;return e=new $o({props:{openOn:"hover",$$slots:{default:[GT,({props:i})=>({9:i}),({props:i})=>i?512:0]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1536&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function HT(o){let e,t;const i=[rn("predict-impact"),{paint:{"line-width":["interpolate",["linear"],["get","after"],0,py,o[2].max_count,my],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,o[1][0],50,o[1][1],100,o[1][2],150,o[1][3],200,o[1][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let l={$$slots:{default:[WT]},$$scope:{ctx:o}};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Wr({props:l}),e.$on("click",o[4]),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a=d&6?tc(i,[i[0],{paint:{"line-width":["interpolate",["linear"],["get","after"],0,py,u[2].max_count,my],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,u[1][0],50,u[1][1],100,u[1][2],150,u[1][3],200,u[1][4]]]}},i[2],i[3]]):{};d&1024&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function XT(o){let e,t,i,l,u;return t=new cr({props:{data:o[2],generateId:!0,$$slots:{default:[HT]},$$scope:{ctx:o}}}),l=new ja({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),Ie(l.$$.fragment),ke(e,"slot","map")},m(d,a){le(d,e,a),Ee(t,e,null),X(e,i),Ee(l,e,null),u=!0},p(d,a){const _={};a&1024&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(Q(t.$$.fragment,d),Q(l.$$.fragment,d),u=!0)},o(d){re(t.$$.fragment,d),re(l.$$.fragment,d),u=!1},d(d){d&&ae(e),Me(t),Me(l)}}}function KT(o){let e,t;return e=new Lo({props:{$$slots:{map:[XT],sidebar:[ZT],top:[qT]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1025&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}let py=3,my=10;function JT(o,e,t){let i,l;lt(o,Ht,E=>t(0,i=E)),lt(o,Cn,E=>t(8,l=E));let u=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],d=l.predictImpact();function a(E){Tt(Ht,i={mode:"impact-detail",road:E},i)}return[i,u,d,a,E=>a(E.detail.features[0]),()=>Tt(Ht,i={mode:"network"},i),()=>Tt(Ht,i={mode:"title",firstLoad:!1},i),()=>Tt(Ht,i={mode:"network"},i)]}class YT extends qt{constructor(e){super(),$t(this,e,JT,KT,Bt,{})}}function QT(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function e5(o){let e;return{c(){e=Xe("Pick neighbourhood")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function gy(o){let e,t,i;return t=new Ei({props:{$$slots:{default:[t5]},$$scope:{ctx:o}}}),t.$on("click",o[13]),{c(){e=oe("li"),Ie(t.$$.fragment)},m(l,u){le(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&16384&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(Q(t.$$.fragment,l),i=!0)},o(l){re(t.$$.fragment,l),i=!1},d(l){l&&ae(e),Me(t)}}}function t5(o){let e;return{c(){e=Xe("Editing")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function i5(o){let e,t,i,l,u,d,a,_,v,k,S,E;u=new Ei({props:{$$slots:{default:[QT]},$$scope:{ctx:o}}}),u.$on("click",o[11]),_=new Ei({props:{$$slots:{default:[e5]},$$scope:{ctx:o}}}),_.$on("click",o[12]);let A=o[0]=="neighbourhood"&&gy(o);return{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),Ie(_.$$.fragment),v=ze(),A&&A.c(),k=ze(),S=oe("li"),S.textContent="Routing",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(z,R){le(z,e,R),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),Ee(_,a,null),X(i,v),A&&A.m(i,null),X(i,k),X(i,S),E=!0},p(z,R){const D={};R&16384&&(D.$$scope={dirty:R,ctx:z}),u.$set(D);const B={};R&16384&&(B.$$scope={dirty:R,ctx:z}),_.$set(B),z[0]=="neighbourhood"?A?(A.p(z,R),R&1&&Q(A,1)):(A=gy(z),A.c(),Q(A,1),A.m(i,k)):A&&(gi(),re(A,1,1,()=>{A=null}),_i())},i(z){E||(Q(u.$$.fragment,z),Q(_.$$.fragment,z),Q(A),E=!0)},o(z){re(u.$$.fragment,z),re(_.$$.fragment,z),re(A),E=!1},d(z){z&&ae(e),Me(u),Me(_),A&&A.d()}}}function n5(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R,D,B;return t=new lc({}),t.$on("click",o[6]),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),l=oe("p"),l.textContent="Drag markers for a route",u=ze(),d=oe("p"),d.innerHTML=`<span style="color: red">Route before</span>
      ,
      <span style="color: blue">route after</span>`,a=ze(),_=oe("label"),v=Xe("Slow-down factor for main roads: "),k=Xe(o[1]),S=ze(),E=oe("input"),A=ze(),z=oe("i"),z.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,ke(E,"type","range"),ke(E,"min","1.0"),ke(E,"max","5.0"),ke(E,"step","0.1"),ke(e,"slot","sidebar")},m(O,j){le(O,e,j),Ee(t,e,null),X(e,i),X(e,l),X(e,u),X(e,d),X(e,a),X(e,_),X(_,v),X(_,k),X(_,S),X(_,E),Fn(E,o[1]),X(e,A),X(e,z),R=!0,D||(B=[xt(E,"change",o[10]),xt(E,"input",o[10])],D=!0)},p(O,j){(!R||j&2)&&xi(k,O[1]),j&2&&Fn(E,O[1])},i(O){R||(Q(t.$$.fragment,O),R=!0)},o(O){re(t.$$.fragment,O),R=!1},d(O){O&&ae(e),Me(t),D=!1,on(B)}}}function _y(o){let e,t;return e=new Hu({props:{$$slots:{default:[r5]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function r5(o){let e,t,i,l,u,d,a,_;return e=new Bd({}),i=new Rd({}),u=new Fd({}),a=new Wu({props:{interactive:!1}}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment),d=ze(),Ie(a.$$.fragment)},m(v,k){Ee(e,v,k),le(v,t,k),Ee(i,v,k),le(v,l,k),Ee(u,v,k),le(v,d,k),Ee(a,v,k),_=!0},p:Lt,i(v){_||(Q(e.$$.fragment,v),Q(i.$$.fragment,v),Q(u.$$.fragment,v),Q(a.$$.fragment,v),_=!0)},o(v){re(e.$$.fragment,v),re(i.$$.fragment,v),re(u.$$.fragment,v),re(a.$$.fragment,v),_=!1},d(v){v&&(ae(t),ae(l),ae(d)),Me(e,v),Me(i,v),Me(u,v),Me(a,v)}}}function o5(o){let e,t;const i=[rn("compare-route"),{paint:{"line-width":10,"line-color":Mu(["get","kind"],{before:"red",after:"blue"},"red")}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Wr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function s5(o){let e;return{c(){e=Xe("A")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function a5(o){let e;return{c(){e=Xe("B")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function l5(o){let e,t,i,l,u,d,a,_,v,k,S,E,A=o[0]=="neighbourhood"&&_y(o);i=new ja({}),u=new cr({props:{data:o[4],$$slots:{default:[o5]},$$scope:{ctx:o}}});function z(O){o[8](O)}let R={draggable:!0,$$slots:{default:[s5]},$$scope:{ctx:o}};o[3]!==void 0&&(R.lngLat=o[3]),a=new Na({props:R}),Ki.push(()=>Gr(a,"lngLat",z));function D(O){o[9](O)}let B={draggable:!0,$$slots:{default:[a5]},$$scope:{ctx:o}};return o[2]!==void 0&&(B.lngLat=o[2]),k=new Na({props:B}),Ki.push(()=>Gr(k,"lngLat",D)),{c(){e=oe("div"),A&&A.c(),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment),d=ze(),Ie(a.$$.fragment),v=ze(),Ie(k.$$.fragment),ke(e,"slot","map")},m(O,j){le(O,e,j),A&&A.m(e,null),X(e,t),Ee(i,e,null),X(e,l),Ee(u,e,null),X(e,d),Ee(a,e,null),X(e,v),Ee(k,e,null),E=!0},p(O,j){O[0]=="neighbourhood"?A?j&1&&Q(A,1):(A=_y(O),A.c(),Q(A,1),A.m(e,t)):A&&(gi(),re(A,1,1,()=>{A=null}),_i());const V={};j&16&&(V.data=O[4]),j&16384&&(V.$$scope={dirty:j,ctx:O}),u.$set(V);const se={};j&16384&&(se.$$scope={dirty:j,ctx:O}),!_&&j&8&&(_=!0,se.lngLat=O[3],Zr(()=>_=!1)),a.$set(se);const ce={};j&16384&&(ce.$$scope={dirty:j,ctx:O}),!S&&j&4&&(S=!0,ce.lngLat=O[2],Zr(()=>S=!1)),k.$set(ce)},i(O){E||(Q(A),Q(i.$$.fragment,O),Q(u.$$.fragment,O),Q(a.$$.fragment,O),Q(k.$$.fragment,O),E=!0)},o(O){re(A),re(i.$$.fragment,O),re(u.$$.fragment,O),re(a.$$.fragment,O),re(k.$$.fragment,O),E=!1},d(O){O&&ae(e),A&&A.d(),Me(i),Me(u),Me(a),Me(k)}}}function c5(o){let e,t;return e=new Lo({props:{$$slots:{map:[l5],sidebar:[n5],top:[i5]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&16447&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function u5(o,e,t){let i,l,u,d,a,_;lt(o,Ht,B=>t(5,l=B)),lt(o,Ag,B=>t(1,u=B)),lt(o,Du,B=>t(2,d=B)),lt(o,zu,B=>t(3,a=B)),lt(o,Cn,B=>t(7,_=B));let{prevMode:v}=e;function k(){Tt(Ht,l={mode:v},l)}function S(B){a=B,zu.set(a)}function E(B){d=B,Du.set(d)}function A(){u=Ep(this.value),Ag.set(u)}const z=()=>Tt(Ht,l={mode:"title",firstLoad:!1},l),R=()=>Tt(Ht,l={mode:"network"},l),D=()=>Tt(Ht,l={mode:"neighbourhood"},l);return o.$$set=B=>{"prevMode"in B&&t(0,v=B.prevMode)},o.$$.update=()=>{o.$$.dirty&142&&t(4,i=_.compareRoute(a,d,u))},[v,u,d,a,i,l,k,_,S,E,A,z,R,D]}class h5 extends qt{constructor(e){super(),$t(this,e,u5,c5,Bt,{prevMode:0})}}let rc=wi(null);const ko=wi([]);function X0(o){if(o.length<3)return JSON.parse(Ar(rc).inner.calculateRoute(o));let e=JSON.parse(JSON.stringify(o));e.push(e[0]);let t=JSON.parse(Ar(rc).inner.calculateRoute(e));return t.properties.waypoints.pop(),t.geometry.type="Polygon",t.geometry.coordinates=[t.geometry.coordinates],t}const{window:d5}=Cd,f5=o=>({}),yy=o=>({}),p5=o=>({}),vy=o=>({});function by(o,e,t){const i=o.slice();return i[44]=e[t],i[45]=e,i[46]=t,i}function wy(o,e,t){const i=o.slice();return i[47]=e[t],i[48]=e,i[49]=t,i}function m5(o){let e,t;const i=o[24]["extra-top"],l=Bi(i,o,o[38],yy);return{c(){e=oe("div"),l&&l.c(),ke(e,"slot","top")},m(u,d){le(u,e,d),l&&l.m(e,null),t=!0},p(u,d){l&&l.p&&(!t||d[1]&128)&&Oi(l,i,u,u[38],t?Fi(i,u[38],d,f5):Ni(u[38]),yy)},i(u){t||(Q(l,u),t=!0)},o(u){re(l,u),t=!1},d(u){u&&ae(e),l&&l.d(u)}}}function g5(o){let e,t,i,l,u;return{c(){e=oe("ul"),e.innerHTML=`<li><b>Click</b>
            the map to add new points, until there are at least 3 points</li> <li><b>Click and drag</b>
            any point to move it</li> <li><b>Click</b>
            a waypoint to toggle snapping</li> <li><b>Right click</b>
            a waypoint to delete it</li>`,t=ze(),i=oe("p"),i.textContent="Keyboard shortcuts:",l=ze(),u=oe("ul"),u.innerHTML=`<li><b>s</b>
            to switch between snapping to roads and drawing anywhere</li> <li><b>Control+Z</b>
            to undo your last change</li> <li><b>Enter</b>
            or
            <b>Escape</b>
            to finish</li> <li>From the main mode, <b>3</b>
            to draw a new area</li>`},m(d,a){le(d,e,a),le(d,t,a),le(d,i,a),le(d,l,a),le(d,u,a)},p:Lt,d(d){d&&(ae(e),ae(t),ae(i),ae(l),ae(u))}}}function _5(o){let e,t=o[8].length+"",i,l;return{c(){e=Xe("Undo ("),i=Xe(t),l=Xe(")")},m(u,d){le(u,e,d),le(u,i,d),le(u,l,d)},p(u,d){d[0]&256&&t!==(t=u[8].length+"")&&xi(i,t)},d(u){u&&(ae(e),ae(i),ae(l))}}}function y5(o){let e;return{c(){e=Xe("Undo")},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function v5(o){let e;return{c(){e=oe("p"),e.textContent="Drag to adjust. Click to toggle snapped. Right click to delete."},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function b5(o){let e,t,i,l,u,d,a,_,v,k,S,E,A;return S=Wy(o[36][0]),{c(){e=oe("fieldset"),t=oe("label"),i=oe("input"),l=Xe(`
          Snap to roads`),u=ze(),d=oe("label"),a=oe("input"),_=Xe(`
          Draw anywhere`),v=ze(),k=oe("p"),k.textContent="Click to add at least 3 points",ke(i,"type","radio"),i.__value="snap",Fn(i,i.__value),ke(a,"type","radio"),a.__value="free",Fn(a,a.__value),S.p(i,a)},m(z,R){le(z,e,R),X(e,t),X(t,i),i.checked=i.__value===o[7],X(t,l),X(e,u),X(e,d),X(d,a),a.checked=a.__value===o[7],X(d,_),le(z,v,R),le(z,k,R),E||(A=[xt(i,"change",o[35]),xt(a,"change",o[37])],E=!0)},p(z,R){R[0]&128&&(i.checked=i.__value===z[7]),R[0]&128&&(a.checked=a.__value===z[7])},d(z){z&&(ae(e),ae(v),ae(k)),S.r(),E=!1,on(A)}}}function w5(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R,D,B;const O=o[24]["extra-sidebar"],j=Bi(O,o,o[38],vy);k=new Zp({props:{$$slots:{default:[g5]},$$scope:{ctx:o}}});function V(Oe,ne){return Oe[8].length==0?y5:_5}let se=V(o),ce=se(o);function Z(Oe,ne){return Oe[5].length<3?b5:v5}let Y=Z(o),ye=Y(o);return{c(){e=oe("div"),j&&j.c(),t=ze(),i=oe("div"),l=oe("button"),u=Xe("Finish"),a=ze(),_=oe("button"),_.textContent="Cancel",v=ze(),Ie(k.$$.fragment),S=ze(),E=oe("button"),ce.c(),z=ze(),ye.c(),l.disabled=d=o[5].length<3,ke(_,"class","secondary"),nn(i,"display","flex"),ke(E,"class","secondary"),E.disabled=A=o[8].length==0,ke(e,"slot","sidebar")},m(Oe,ne){le(Oe,e,ne),j&&j.m(e,null),X(e,t),X(e,i),X(i,l),X(l,u),X(i,a),X(i,_),X(i,v),Ee(k,i,null),X(e,S),X(e,E),ce.m(E,null),X(e,z),ye.m(e,null),R=!0,D||(B=[xt(l,"click",function(){Yl(o[0])&&o[0].apply(this,arguments)}),xt(_,"click",function(){Yl(o[1])&&o[1].apply(this,arguments)}),xt(E,"click",o[11])],D=!0)},p(Oe,ne){o=Oe,j&&j.p&&(!R||ne[1]&128)&&Oi(j,O,o,o[38],R?Fi(O,o[38],ne,p5):Ni(o[38]),vy),(!R||ne[0]&32&&d!==(d=o[5].length<3))&&(l.disabled=d);const ve={};ne[1]&128&&(ve.$$scope={dirty:ne,ctx:o}),k.$set(ve),se===(se=V(o))&&ce?ce.p(o,ne):(ce.d(1),ce=se(o),ce&&(ce.c(),ce.m(E,null))),(!R||ne[0]&256&&A!==(A=o[8].length==0))&&(E.disabled=A),Y===(Y=Z(o))&&ye?ye.p(o,ne):(ye.d(1),ye=Y(o),ye&&(ye.c(),ye.m(e,null)))},i(Oe){R||(Q(j,Oe),Q(k.$$.fragment,Oe),R=!0)},o(Oe){re(j,Oe),re(k.$$.fragment,Oe),R=!1},d(Oe){Oe&&ae(e),j&&j.d(Oe),Me(k),ce.d(),ye.d(),D=!1,on(B)}}}function x5(o){let e;return{c(){e=oe("span"),ke(e,"class","dot svelte-1cj4rwq"),lr(e,"snapped-node",o[47].snapped),lr(e,"free-node",!o[47].snapped),lr(e,"hide",o[4])},m(t,i){le(t,e,i)},p(t,i){i[0]&512&&lr(e,"snapped-node",t[47].snapped),i[0]&512&&lr(e,"free-node",!t[47].snapped),i[0]&16&&lr(e,"hide",t[4])},d(t){t&&ae(e)}}}function xy(o){let e,t,i;function l(v){o[25](v,o[47])}function u(){return o[26](o[47])}function d(){return o[27](o[47])}function a(){return o[28](o[47])}let _={draggable:!0,zIndex:0,$$slots:{default:[x5]},$$scope:{ctx:o}};return o[47].point!==void 0&&(_.lngLat=o[47].point),e=new zd({props:_}),Ki.push(()=>Gr(e,"lngLat",l)),e.$on("dragstart",u),e.$on("drag",d),e.$on("dragend",o[19]),e.$on("click",a),{c(){Ie(e.$$.fragment)},m(v,k){Ee(e,v,k),i=!0},p(v,k){o=v;const S={};k[0]&528|k[1]&128&&(S.$$scope={dirty:k,ctx:o}),!t&&k[0]&512&&(t=!0,S.lngLat=o[47].point,Zr(()=>t=!1)),e.$set(S)},i(v){i||(Q(e.$$.fragment,v),i=!0)},o(v){re(e.$$.fragment,v),i=!1},d(v){Me(e,v)}}}function k5(o){let e;return{c(){e=oe("span"),e.textContent=`${o[46]+1}`,ke(e,"class","dot svelte-1cj4rwq"),lr(e,"snapped",o[44].snapped)},m(t,i){le(t,e,i)},p(t,i){i[0]&32&&lr(e,"snapped",t[44].snapped)},d(t){t&&ae(e)}}}function ky(o){let e,t,i;function l(_){o[29](_,o[44])}function u(){return o[30](o[46])}function d(){return o[31](o[46])}let a={draggable:!0,zIndex:1,$$slots:{default:[k5]},$$scope:{ctx:o}};return o[44].point!==void 0&&(a.lngLat=o[44].point),e=new zd({props:a}),Ki.push(()=>Gr(e,"lngLat",l)),e.$on("click",u),e.$on("contextmenu",d),e.$on("mouseenter",o[32]),e.$on("mouseleave",o[33]),e.$on("dragstart",o[21]),e.$on("dragend",o[34]),{c(){Ie(e.$$.fragment)},m(_,v){Ee(e,_,v),i=!0},p(_,v){o=_;const k={};v[0]&32|v[1]&128&&(k.$$scope={dirty:v,ctx:o}),!t&&v[0]&32&&(t=!0,k.lngLat=o[44].point,Zr(()=>t=!1)),e.$set(k)},i(_){i||(Q(e.$$.fragment,_),i=!0)},o(_){re(e.$$.fragment,_),i=!1},d(_){Me(e,_)}}}function S5(o){let e,t,i,l;const u=[rn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let d={};for(let v=0;v<u.length;v+=1)d=Xi(d,u[v]);e=new Wr({props:d});const a=[rn("draw-area-preview"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let _={};for(let v=0;v<a.length;v+=1)_=Xi(_,a[v]);return i=new Es({props:_}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment)},m(v,k){Ee(e,v,k),le(v,t,k),Ee(i,v,k),l=!0},p(v,k){const S={};e.$set(S);const E={};i.$set(E)},i(v){l||(Q(e.$$.fragment,v),Q(i.$$.fragment,v),l=!0)},o(v){re(e.$$.fragment,v),re(i.$$.fragment,v),l=!1},d(v){v&&ae(t),Me(e,v),Me(i,v)}}}function T5(o){let e,t;return e=new Wr({props:{paint:{"line-color":"black","line-width":3}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function C5(o){let e,t,i,l,u,d,a,_,v;t=new w0({}),t.$on("click",o[12]),t.$on("mousemove",o[13]);let k=Kn(o[9]),S=[];for(let D=0;D<k.length;D+=1)S[D]=xy(wy(o,k,D));const E=D=>re(S[D],1,1,()=>{S[D]=null});let A=Kn(o[5]),z=[];for(let D=0;D<A.length;D+=1)z[D]=ky(by(o,A,D));const R=D=>re(z[D],1,1,()=>{z[D]=null});return d=new cr({props:{data:o[16](o[6],o[5]),generateId:!0,$$slots:{default:[S5]},$$scope:{ctx:o}}}),_=new cr({props:{data:o[10],$$slots:{default:[T5]},$$scope:{ctx:o}}}),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze();for(let D=0;D<S.length;D+=1)S[D].c();l=ze();for(let D=0;D<z.length;D+=1)z[D].c();u=ze(),Ie(d.$$.fragment),a=ze(),Ie(_.$$.fragment),ke(e,"slot","map")},m(D,B){le(D,e,B),Ee(t,e,null),X(e,i);for(let O=0;O<S.length;O+=1)S[O]&&S[O].m(e,null);X(e,l);for(let O=0;O<z.length;O+=1)z[O]&&z[O].m(e,null);X(e,u),Ee(d,e,null),X(e,a),Ee(_,e,null),v=!0},p(D,B){if(B[0]&918032){k=Kn(D[9]);let V;for(V=0;V<k.length;V+=1){const se=wy(D,k,V);S[V]?(S[V].p(se,B),Q(S[V],1)):(S[V]=xy(se),S[V].c(),Q(S[V],1),S[V].m(e,l))}for(gi(),V=k.length;V<S.length;V+=1)E(V);_i()}if(B[0]&2146348){A=Kn(D[5]);let V;for(V=0;V<A.length;V+=1){const se=by(D,A,V);z[V]?(z[V].p(se,B),Q(z[V],1)):(z[V]=ky(se),z[V].c(),Q(z[V],1),z[V].m(e,u))}for(gi(),V=A.length;V<z.length;V+=1)R(V);_i()}const O={};B[0]&96&&(O.data=D[16](D[6],D[5])),B[1]&128&&(O.$$scope={dirty:B,ctx:D}),d.$set(O);const j={};B[0]&1024&&(j.data=D[10]),B[1]&128&&(j.$$scope={dirty:B,ctx:D}),_.$set(j)},i(D){if(!v){Q(t.$$.fragment,D);for(let B=0;B<k.length;B+=1)Q(S[B]);for(let B=0;B<A.length;B+=1)Q(z[B]);Q(d.$$.fragment,D),Q(_.$$.fragment,D),v=!0}},o(D){re(t.$$.fragment,D),S=S.filter(Boolean);for(let B=0;B<S.length;B+=1)re(S[B]);z=z.filter(Boolean);for(let B=0;B<z.length;B+=1)re(z[B]);re(d.$$.fragment,D),re(_.$$.fragment,D),v=!1},d(D){D&&ae(e),Me(t),Ss(S,D),Ss(z,D),Me(d),Me(_)}}}function E5(o){let e,t,i,l;return e=new Lo({props:{$$slots:{map:[C5],sidebar:[w5],top:[m5]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=xt(d5,"keydown",o[20]),i=!0)},p(u,d){const a={};d[0]&2047|d[1]&128&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function M5(o,e,t){let i,l,u;lt(o,ko,ut=>t(5,l=ut)),lt(o,rc,ut=>t(6,u=ut));let{$$slots:d={},$$scope:a}=e,{map:_}=e,{finish:v}=e,{cancel:k}=e;Jn(()=>{Tt(ko,l=[],l),u==null||u.stop(),_.getCanvas().style.cursor="inherit"});let S="snap",E=[],A=[],z=null,R=!1,D=!1,B=!1;function O(ut){let At=ut.length==0?"crosshair":"inherit";_.getCanvas().style.cursor=At}function j(){let ut=E.pop();t(8,E),ut&&Tt(ko,l=ut,l)}function V(){E.length==100&&E.shift(),t(8,E=[...E,JSON.parse(JSON.stringify(l))])}function se(){t(7,S=S=="snap"?"free":"snap"),z&&t(23,z.snapped=S=="snap",z)}function ce(ut){l.length>=3||(V(),ko.update(At=>(At.push({point:ut.detail.lngLat.toArray(),snapped:S=="snap"}),At)))}function Z(ut){t(23,z={point:ut.detail.lngLat.toArray(),snapped:S=="snap"})}function Y(ut){V(),ko.update(At=>(At[ut].snapped=!At[ut].snapped,At))}function ye(ut){V(),ko.update(At=>(At.splice(ut,1),At)),t(2,R=!1)}function Oe(ut,At){try{if(ut)return X0(At)}catch{}return Jl()}function ne(ut,At,Ne,je){if(je||At.length>=3)return Jl();try{if(ut&&At.length>0&&Ne)return JSON.parse(ut.inner.calculateRoute([At[At.length-1],Ne]))}catch{}return Jl()}function ve(ut,At,Ne){if(Ne)return;if(!ut||At.length<3){t(9,A=[]);return}let je=[],ot=1,kt=JSON.parse(JSON.stringify(At));kt.push(kt[0]);for(let we=0;we<kt.length-1;we++){let di=JSON.parse(ut.inner.getExtraNodes(kt[we],kt[we+1]));for(let[Ve,We,St]of di)je.push({point:[Ve,We],snapped:St,insertIdx:ot});ot++}t(9,A=je)}function Je(ut){V(),ko.update(At=>(At.splice(ut.insertIdx,0,{point:ut.point,snapped:ut.snapped}),At)),t(4,B=!0)}function Le(ut){ko.update(At=>(At[ut.insertIdx].point=ut.point,At))}function et(){t(4,B=!1)}function bt(ut){let At=ut.target.tagName,Ne=At=="INPUT"||At=="TEXTAREA";ut.key=="Enter"&&!Ne||ut.key=="Escape"?(ut.stopPropagation(),l.length>=3?v():window.alert("You can't save this area unless it has at least three points. Press 'Cancel' to discard these changes.")):ut.key=="s"&&!Ne?se():ut.key=="z"&&ut.ctrlKey&&(ut.stopPropagation(),j())}function pt(){V(),t(3,D=!0)}const at=[[]];function Xt(ut,At){o.$$.not_equal(At.point,ut)&&(At.point=ut,t(9,A))}const ni=ut=>Je(ut),Nt=ut=>Le(ut),zt=ut=>{Je(ut),t(4,B=!1)};function Yt(ut,At){o.$$.not_equal(At.point,ut)&&(At.point=ut,ko.set(l))}const It=ut=>Y(ut),ti=ut=>ye(ut),Zt=()=>t(2,R=!0),hi=()=>t(2,R=!1),ki=()=>t(3,D=!1);function yi(){S=this.__value,t(7,S)}function Pi(){S=this.__value,t(7,S)}return o.$$set=ut=>{"map"in ut&&t(22,_=ut.map),"finish"in ut&&t(0,v=ut.finish),"cancel"in ut&&t(1,k=ut.cancel),"$$scope"in ut&&t(38,a=ut.$$scope)},o.$$.update=()=>{o.$$.dirty[0]&112&&ve(u,l,B),o.$$.dirty[0]&8388716&&t(10,i=ne(u,l,z,R||D)),o.$$.dirty[0]&32&&O(l)},[v,k,R,D,B,l,u,S,E,A,i,j,ce,Z,Y,ye,Oe,Je,Le,et,bt,pt,_,z,d,Xt,ni,Nt,zt,Yt,It,ti,Zt,hi,ki,yi,at,Pi,a]}class I5 extends qt{constructor(e){super(),$t(this,e,M5,E5,Bt,{map:22,finish:0,cancel:1},null,[-1,-1])}}function L5(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function A5(o){let e;return{c(){e=Xe("Pick neighbourhood")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function P5(o){let e;return{c(){e=oe("li"),e.textContent="Creating new neighbourhood boundary"},m(t,i){le(t,e,i)},p:Lt,i:Lt,o:Lt,d(t){t&&ae(e)}}}function z5(o){let e,t,i,l,u;return t=new Ei({props:{$$slots:{default:[D5]},$$scope:{ctx:o}}}),t.$on("click",o[8]),{c(){e=oe("li"),Ie(t.$$.fragment),i=ze(),l=oe("li"),l.textContent="Changing neighbourhood boundary"},m(d,a){le(d,e,a),Ee(t,e,null),le(d,i,a),le(d,l,a),u=!0},p(d,a){const _={};a&4096&&(_.$$scope={dirty:a,ctx:d}),t.$set(_)},i(d){u||(Q(t.$$.fragment,d),u=!0)},o(d){re(t.$$.fragment,d),u=!1},d(d){d&&(ae(e),ae(i),ae(l)),Me(t)}}}function D5(o){let e;return{c(){e=Xe("Editing")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function R5(o){let e,t,i,l,u,d,a,_,v,k,S,E;u=new Ei({props:{$$slots:{default:[L5]},$$scope:{ctx:o}}}),u.$on("click",o[6]),_=new Ei({props:{$$slots:{default:[A5]},$$scope:{ctx:o}}}),_.$on("click",o[7]);const A=[z5,P5],z=[];function R(D,B){return D[1]?0:1}return k=R(o),S=z[k]=A[k](o),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),Ie(_.$$.fragment),v=ze(),S.c(),ke(t,"aria-label","breadcrumb"),ke(e,"slot","extra-top")},m(D,B){le(D,e,B),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),Ee(_,a,null),X(i,v),z[k].m(i,null),E=!0},p(D,B){const O={};B&4096&&(O.$$scope={dirty:B,ctx:D}),u.$set(O);const j={};B&4096&&(j.$$scope={dirty:B,ctx:D}),_.$set(j);let V=k;k=R(D),k===V?z[k].p(D,B):(gi(),re(z[V],1,1,()=>{z[V]=null}),_i(),S=z[k],S?S.p(D,B):(S=z[k]=A[k](D),S.c()),Q(S,1),S.m(i,null))},i(D){E||(Q(u.$$.fragment,D),Q(_.$$.fragment,D),Q(S),E=!0)},o(D){re(u.$$.fragment,D),re(_.$$.fragment,D),re(S),E=!1},d(D){D&&ae(e),Me(u),Me(_),z[k].d()}}}function B5(o){let e,t,i,l;return{c(){e=oe("div"),t=oe("h1"),i=Xe("Draw your neighbourhood boundary for "),l=Xe(o[0]),ke(e,"slot","extra-sidebar")},m(u,d){le(u,e,d),X(e,t),X(t,i),X(t,l)},p(u,d){d&1&&xi(l,u[0])},d(u){u&&ae(e)}}}function F5(o){let e,t;return e=new I5({props:{map:yr(o[3]),finish:o[4],cancel:o[5],$$slots:{"extra-sidebar":[B5],"extra-top":[R5]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&8&&(u.map=yr(i[3])),l&4103&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function O5(o,e,t){let i,l,u,d,a;lt(o,Ht,R=>t(2,i=R)),lt(o,Ru,R=>t(9,l=R)),lt(o,Cn,R=>t(10,u=R)),lt(o,ko,R=>t(11,d=R)),lt(o,Vo,R=>t(3,a=R));let{name:_}=e,{existing:v}=e;v&&(v.properties.waypoints?Tt(ko,d=v.properties.waypoints.map(R=>({point:[R.lon,R.lat],snapped:R.snapped})),d):Tt(ko,d=v.geometry.coordinates[0].slice(1).map(R=>({point:R,snapped:!1})),d));function k(){if(d.length>=3)try{let R=X0(d);u.setNeighbourhoodBoundary(_,R),nc(),u.setCurrentNeighbourhood(_,l),Tt(Ht,i={mode:"neighbourhood"},i)}catch{window.alert("Known georust bug hit, sorry. You may need to just refresh the page now."),S()}}function S(){v?Tt(Ht,i={mode:"neighbourhood"},i):Tt(Ht,i={mode:"network"},i)}const E=()=>Tt(Ht,i={mode:"title",firstLoad:!1},i),A=()=>Tt(Ht,i={mode:"network"},i),z=()=>Tt(Ht,i={mode:"neighbourhood"},i);return o.$$set=R=>{"name"in R&&t(0,_=R.name),"existing"in R&&t(1,v=R.existing)},[_,v,i,a,k,S,E,A,z]}class N5 extends qt{constructor(e){super(),$t(this,e,O5,F5,Bt,{name:0,existing:1})}}const j5="/ltn/assets/settings-342fb430.svg";function Sy(o){let e,t;return e=new Id({props:{$$slots:{default:[U5]},$$scope:{ctx:o}}}),e.$on("close",o[7]),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&263&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function U5(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z,R,D,B,O,j,V;return i=new O4({}),{c(){e=oe("h1"),e.textContent="Settings",t=ze(),Ie(i.$$.fragment),l=ze(),u=oe("label"),d=Xe(`Style for roads in a neighbourhood:
      `),a=oe("select"),_=oe("option"),_.textContent="Show worst shortcuts",v=oe("option"),v.textContent="Show the cell",k=oe("option"),k.textContent="Show edited roads (either filter or direction)",S=ze(),E=oe("label"),A=oe("input"),z=Xe(`
      Road thickness depends on shortcuts`),R=ze(),D=oe("center"),B=oe("button"),B.textContent="Confirm",_.__value="shortcuts",Fn(_,_.__value),v.__value="cells",Fn(v,v.__value),k.__value="edits",Fn(k,k.__value),o[1]===void 0&&ec(()=>o[4].call(a)),ke(A,"type","checkbox")},m(se,ce){le(se,e,ce),le(se,t,ce),Ee(i,se,ce),le(se,l,ce),le(se,u,ce),X(u,d),X(u,a),X(a,_),X(a,v),X(a,k),Ql(a,o[1],!0),le(se,S,ce),le(se,E,ce),X(E,A),A.checked=o[2],X(E,z),le(se,R,ce),le(se,D,ce),X(D,B),O=!0,j||(V=[xt(a,"change",o[4]),xt(A,"change",o[5]),xt(B,"click",o[6])],j=!0)},p(se,ce){ce&2&&Ql(a,se[1]),ce&4&&(A.checked=se[2])},i(se){O||(Q(i.$$.fragment,se),O=!0)},o(se){re(i.$$.fragment,se),O=!1},d(se){se&&(ae(e),ae(t),ae(l),ae(u),ae(S),ae(E),ae(R),ae(D)),Me(i,se),j=!1,on(V)}}}function V5(o){let e,t,i,l,u,d,a=o[0]&&Sy(o);return{c(){e=oe("button"),e.innerHTML=`<img src="${j5}" alt="Settings"/>`,t=ze(),a&&a.c(),i=En(),ke(e,"class","outline")},m(_,v){le(_,e,v),le(_,t,v),a&&a.m(_,v),le(_,i,v),l=!0,u||(d=xt(e,"click",o[3]),u=!0)},p(_,[v]){_[0]?a?(a.p(_,v),v&1&&Q(a,1)):(a=Sy(_),a.c(),Q(a,1),a.m(i.parentNode,i)):a&&(gi(),re(a,1,1,()=>{a=null}),_i())},i(_){l||(Q(a),l=!0)},o(_){re(a),l=!1},d(_){_&&(ae(e),ae(t),ae(i)),a&&a.d(_),u=!1,d()}}}function $5(o,e,t){let i,l;lt(o,xd,S=>t(1,i=S)),lt(o,up,S=>t(2,l=S));let u=!1;const d=()=>t(0,u=!0);function a(){i=Mp(this),xd.set(i)}function _(){l=this.checked,up.set(l)}return[u,i,l,d,a,_,()=>t(0,u=!1),()=>t(0,u=!1)]}class q5 extends qt{constructor(e){super(),$t(this,e,$5,V5,Bt,{})}}const Z5=["==",["geometry-type"],"Polygon"],G5=["==",["geometry-type"],"LineString"],W5=["==",["geometry-type"],"Point"];function K0(){return{type:"FeatureCollection",features:[]}}function ep(o){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:J0(o)}}}function J0(o){return[Math.round(o[0]*1e7)/1e7,Math.round(o[1]*1e7)/1e7]}const Y0=wi(K0()),Q0=wi(0),H5=100;class X5{constructor(e){Rn(this,"map");Rn(this,"active");Rn(this,"eventListenersSuccess");Rn(this,"eventListenersUpdated");Rn(this,"eventListenersFailure");Rn(this,"points");Rn(this,"cursor");Rn(this,"hover");Rn(this,"dragFrom");Rn(this,"previousStates");Rn(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,i=this.dragFrom[1]-e.lngLat.lat;for(let l of this.points)l[0]-=t,l[1]-=i}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});Rn(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(Ty(this.points).forEach((i,l)=>{t.push([l+1,uw(i,this.cursor).properties.dist])}),t.sort((i,l)=>i[1]-l[1]),t.length>0){let i=t[0][0];this.points.splice(i,0,this.cursor.geometry.coordinates),this.hover=i}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});Rn(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=ep(e.lngLat.toArray()),this.onClick(e),this.finish())});Rn(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});Rn(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});Rn(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});Rn(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=K0();this.points.forEach((l,u)=>{let d=ep(l);d.properties.hover=this.hover==u,d.properties.idx=u,e.features.push(d)}),e.features=e.features.concat(Ty(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Y0.set(e);let i="crosshair";this.hover!=null&&(i=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=i,Q0.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=ep(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(J0),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>H5&&this.previousStates.shift()}}function Ty(o){let e=[];for(let t=0;t<o.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[o[t],o[t+1]]},properties:{}});return o.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[o[o.length-1],o[0]]},properties:{}}),e}function K5(o){let e,t,i;return{c(){e=Xe("Undo ("),t=Xe(o[1]),i=Xe(")")},m(l,u){le(l,e,u),le(l,t,u),le(l,i,u)},p(l,u){u&2&&xi(t,l[1])},d(l){l&&(ae(e),ae(t),ae(i))}}}function J5(o){let e;return{c(){e=Xe("Undo")},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function Y5(o){let e,t,i,l,u,d,a,_,v,k,S;function E(R,D){return R[1]==0?J5:K5}let A=E(o),z=A(o);return{c(){e=oe("div"),t=oe("button"),t.textContent="Finish",i=ze(),l=oe("button"),l.textContent="Cancel",u=ze(),d=oe("button"),z.c(),_=ze(),v=oe("ul"),v.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,d.disabled=a=o[1]==0,nn(e,"display","flex"),nn(e,"justify-content","space-between")},m(R,D){le(R,e,D),X(e,t),X(e,i),X(e,l),X(e,u),X(e,d),z.m(d,null),le(R,_,D),le(R,v,D),k||(S=[xt(t,"click",o[2]),xt(l,"click",o[3]),xt(d,"click",o[4])],k=!0)},p(R,[D]){A===(A=E(R))&&z?z.p(R,D):(z.d(1),z=A(R),z&&(z.c(),z.m(d,null))),D&2&&a!==(a=R[1]==0)&&(d.disabled=a)},i:Lt,o:Lt,d(R){R&&(ae(e),ae(_),ae(v)),z.d(),k=!1,on(S)}}}function Q5(o,e,t){let i;lt(o,Q0,_=>t(1,i=_));let{polygonTool:l}=e;const u=()=>l.finish(),d=()=>l.cancel(),a=()=>l.undo();return o.$$set=_=>{"polygonTool"in _&&t(0,l=_.polygonTool)},[l,i,u,d,a]}class eC extends qt{constructor(e){super(),$t(this,e,Q5,Y5,Bt,{polygonTool:0})}}let tC=Date.now();function Xu(o){return`${o}-${tC++}`}const e1=Symbol.for("svelte-maplibre");function iC(){return Md(e1)}function Cy(o){return{subscribe:o.subscribe}}function t1({key:o,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:i=!1}){let l=iC(),u=wi(null),d=Cy(u),a={...l,[o]:Cy(u)};if(e&&(a.popupTarget=d),i){let _=wi(null);a.layerEvent=_,l.layerEvent=_}return t&&(a.cluster=wi()),Ed(e1,a),{...l,self:u}}function nC(){return t1({key:"source",setCluster:!0})}function rC(o=!0){return t1({key:"layer",setPopupTarget:o,setMouseEvent:o})}function Ey(o){let e;return t=>{if(t)for(let i in t){let l=e==null?void 0:e[i],u=t[i];l!==u&&o(i,u,l)}else if(e)for(let i in e)o(i,void 0,e[i]);e=t}}function oC(o,...e){let t=[o];for(let i of e)if(i)Array.isArray(i)&&i[0]===o?t.push(...i.slice(1)):t.push(i);else continue;if(t.length!==1)return t.length===2?t[1]:t}function sC(o){return o===!0?["has","point_count"]:o===!1?["!",["has","point_count"]]:void 0}function My(o){let e=o[0],t,i,l=Iy(o);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),le(u,t,d),i=!0},p(u,d){d[0]&1&&Bt(e,e=u[0])?(gi(),re(l,1,1,Lt),_i(),l=Iy(u),l.c(),Q(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(Q(l),i=!0)},o(u){re(l),i=!1},d(u){u&&ae(t),l.d(u)}}}function Iy(o){let e;const t=o[36].default,i=Bi(t,o,o[35],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u[1]&16)&&Oi(i,t,l,l[35],e?Fi(t,l[35],u,null):Ni(l[35]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function aC(o){let e,t,i=o[0]&&My(o);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),le(l,e,u),t=!0},p(l,u){l[0]?i?(i.p(l,u),u[0]&1&&Q(i,1)):(i=My(l),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(l)}}}function lC(o,e,t){let i,l,u,d,a,_,v,k,S,E,A,z,{$$slots:R={},$$scope:D}=e,{id:B=Xu("layer")}=e,{source:O=void 0}=e,{sourceLayer:j=void 0}=e,{beforeId:V=void 0}=e,{beforeLayerType:se=void 0}=e,{type:ce}=e,{paint:Z=void 0}=e,{layout:Y=void 0}=e,{filter:ye=void 0}=e,{applyToClusters:Oe=void 0}=e,{minzoom:ne=void 0}=e,{maxzoom:ve=void 0}=e,{manageHoverState:Je=!1}=e,{hovered:Le=null}=e,{interactive:et=!0}=e,{hoverCursor:bt=void 0}=e,{eventsIfTopMost:pt=!1}=e;const at=ns(),{map:Xt,source:ni,self:Nt,minzoom:zt,maxzoom:Yt,eventTopMost:It,layerInfo:ti}=rC();lt(o,Xt,Ne=>t(31,S=Ne)),lt(o,ni,Ne=>t(32,E=Ne)),lt(o,Nt,Ne=>t(0,k=Ne)),lt(o,zt,Ne=>t(34,z=Ne)),lt(o,Yt,Ne=>t(33,A=Ne)),Jn(()=>{k&&S&&(ti.delete(k),S==null||S.removeLayer(k))});let Zt;function hi(Ne){var we,di;if(!et||!k||!S||pt&&It(Ne)!==k)return;let je=Ne.features??[],ot=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,kt={event:Ne,map:S,clusterId:ot,layer:k,source:a,features:je};at(Ne.type,kt)}function ki(Ne){var we,di;if(!et||!k||!S||pt&&It(Ne)!==k)return;bt&&(S.getCanvas().style.cursor=bt);let je=Ne.features??[];t(6,Le=je[0]??null);let ot=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id;at("mouseenter",{event:Ne,map:S,clusterId:ot,layer:k,source:a,features:je})}function yi(Ne){var we,di,Ve;if(!et||!S)return;if(pt&&It(Ne)!==k){t(6,Le=null),Je&&Zt!==void 0&&(S==null||S.setFeatureState({source:a,sourceLayer:j,id:Zt},{hover:!1}),Zt=void 0);return}S.getCanvas().style.cursor=bt;let je=Ne.features??[],ot=(di=(we=je[0])==null?void 0:we.properties)==null?void 0:di.cluster_id,kt=(Ve=je[0])==null?void 0:Ve.id;kt!==Zt&&(Je&&(Zt!==void 0&&(S==null||S.setFeatureState({source:a,id:Zt,sourceLayer:j},{hover:!1})),S==null||S.setFeatureState({source:a,id:kt,sourceLayer:j},{hover:!0})),Zt=kt,t(6,Le=je[0]??null)),at("mousemove",{event:Ne,map:S,clusterId:ot,layer:k,source:a,features:je})}function Pi(Ne){if(!(!et||!k||!S)){if(bt&&(S.getCanvas().style.cursor=""),t(6,Le=null),Je&&Zt!==void 0){const je={source:a,id:Zt,sourceLayer:j};S==null||S.setFeatureState(je,{hover:!1}),Zt=void 0}at("mouseleave",{map:S,layer:k,source:a})}}let ut=!0;function At(Ne){S&&(S.off("click",Ne,hi),S.off("dblclick",Ne,hi),S.off("contextmenu",Ne,hi),S.off("mouseenter",Ne,ki),S.off("mousemove",Ne,yi),S.off("mouseleave",Ne,Pi))}return Jn(()=>{S&&k&&At(k)}),o.$$set=Ne=>{"id"in Ne&&t(7,B=Ne.id),"source"in Ne&&t(8,O=Ne.source),"sourceLayer"in Ne&&t(9,j=Ne.sourceLayer),"beforeId"in Ne&&t(10,V=Ne.beforeId),"beforeLayerType"in Ne&&t(11,se=Ne.beforeLayerType),"type"in Ne&&t(12,ce=Ne.type),"paint"in Ne&&t(13,Z=Ne.paint),"layout"in Ne&&t(14,Y=Ne.layout),"filter"in Ne&&t(15,ye=Ne.filter),"applyToClusters"in Ne&&t(16,Oe=Ne.applyToClusters),"minzoom"in Ne&&t(17,ne=Ne.minzoom),"maxzoom"in Ne&&t(18,ve=Ne.maxzoom),"manageHoverState"in Ne&&t(19,Je=Ne.manageHoverState),"hovered"in Ne&&t(6,Le=Ne.hovered),"interactive"in Ne&&t(20,et=Ne.interactive),"hoverCursor"in Ne&&t(21,bt=Ne.hoverCursor),"eventsIfTopMost"in Ne&&t(22,pt=Ne.eventsIfTopMost),"$$scope"in Ne&&t(35,D=Ne.$$scope)},o.$$.update=()=>{if(o.$$.dirty[0]&65536&&t(30,i=sC(Oe)),o.$$.dirty[0]&1073774592&&t(24,l=oC("all",i,ye)),o.$$.dirty[0]&131072|o.$$.dirty[1]&8&&t(26,u=ne??z),o.$$.dirty[0]&262144|o.$$.dirty[1]&4&&t(25,d=ve??A),o.$$.dirty[0]&256|o.$$.dirty[1]&2&&t(29,a=O||E),o.$$.dirty[0]&654343809|o.$$.dirty[1]&1&&S&&k!==B&&a){k&&(At(k),ti.delete(k));let Ne=V;if(!V&&se){let je=S.getStyle().layers,ot=typeof se=="function"?se:we=>we.type===se,kt=je==null?void 0:je.find(ot);kt&&(Ne=kt.id)}Tt(Nt,k=B,k),S.addLayer(Oa({id:k,type:ce,source:a,"source-layer":j,filter:l,paint:Z,layout:Y,minzoom:u,maxzoom:d}),Ne),t(23,ut=!0),S.on("click",k,hi),S.on("dblclick",k,hi),S.on("contextmenu",k,hi),S.on("mouseenter",k,ki),S.on("mousemove",k,yi),S.on("mouseleave",k,Pi)}o.$$.dirty[0]&1048577&&k&&ti.set(k,{interactive:et}),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(28,_=k?Ey((Ne,je)=>S==null?void 0:S.setPaintProperty(k,Ne,je)):void 0),o.$$.dirty[0]&1|o.$$.dirty[1]&1&&t(27,v=k?Ey((Ne,je)=>S==null?void 0:S.setLayoutProperty(k,Ne,je)):void 0),o.$$.dirty[0]&268443648&&(_==null||_(Z)),o.$$.dirty[0]&134234112&&(v==null||v(Y)),o.$$.dirty[0]&100663297|o.$$.dirty[1]&1&&k&&(S==null||S.setLayerZoomRange(k,u,d)),o.$$.dirty[0]&25165825|o.$$.dirty[1]&1&&k&&(ut?t(23,ut=!1):S==null||S.setFilter(k,l))},[k,Xt,ni,Nt,zt,Yt,Le,B,O,j,V,se,ce,Z,Y,ye,Oe,ne,ve,Je,et,bt,pt,ut,l,d,u,v,_,a,i,S,E,A,z,D,R]}class Gp extends qt{constructor(e){super(),$t(this,e,lC,aC,Bt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function cC(o){let e;const t=o[16].default,i=Bi(t,o,o[24],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16777216)&&Oi(i,t,l,l[24],e?Fi(t,l[24],u,null):Ni(l[24]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function uC(o){let e,t,i;function l(d){o[17](d)}let u={id:o[1],type:"circle",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[cC]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Gp({props:u}),Ki.push(()=>Gr(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.applyToClusters=d[9]),a&1024&&(_.minzoom=d[10]),a&2048&&(_.maxzoom=d[11]),a&4096&&(_.hoverCursor=d[12]),a&8192&&(_.manageHoverState=d[13]),a&16384&&(_.eventsIfTopMost=d[14]),a&32768&&(_.interactive=d[15]),a&16777216&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Zr(()=>t=!1)),e.$set(_)},i(d){i||(Q(e.$$.fragment,d),i=!0)},o(d){re(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function hC(o,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=Xu("circle")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{applyToClusters:A=void 0}=e,{minzoom:z=void 0}=e,{maxzoom:R=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:B=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:j=!1}=e,{interactive:V=!0}=e;function se(ve){O=ve,t(0,O)}function ce(ve){ui.call(this,o,ve)}function Z(ve){ui.call(this,o,ve)}function Y(ve){ui.call(this,o,ve)}function ye(ve){ui.call(this,o,ve)}function Oe(ve){ui.call(this,o,ve)}function ne(ve){ui.call(this,o,ve)}return o.$$set=ve=>{"id"in ve&&t(1,u=ve.id),"source"in ve&&t(2,d=ve.source),"sourceLayer"in ve&&t(3,a=ve.sourceLayer),"beforeId"in ve&&t(4,_=ve.beforeId),"beforeLayerType"in ve&&t(5,v=ve.beforeLayerType),"paint"in ve&&t(6,k=ve.paint),"layout"in ve&&t(7,S=ve.layout),"filter"in ve&&t(8,E=ve.filter),"applyToClusters"in ve&&t(9,A=ve.applyToClusters),"minzoom"in ve&&t(10,z=ve.minzoom),"maxzoom"in ve&&t(11,R=ve.maxzoom),"hoverCursor"in ve&&t(12,D=ve.hoverCursor),"manageHoverState"in ve&&t(13,B=ve.manageHoverState),"hovered"in ve&&t(0,O=ve.hovered),"eventsIfTopMost"in ve&&t(14,j=ve.eventsIfTopMost),"interactive"in ve&&t(15,V=ve.interactive),"$$scope"in ve&&t(24,l=ve.$$scope)},[O,u,d,a,_,v,k,S,E,A,z,R,D,B,j,V,i,se,ce,Z,Y,ye,Oe,ne,l]}class dC extends qt{constructor(e){super(),$t(this,e,hC,uC,Bt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function fC(o){let e;const t=o[15].default,i=Bi(t,o,o[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Oi(i,t,l,l[23],e?Fi(t,l[23],u,null):Ni(l[23]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function pC(o){let e,t,i;function l(d){o[16](d)}let u={id:o[1],type:"fill",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[fC]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Gp({props:u}),Ki.push(()=>Gr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Zr(()=>t=!1)),e.$set(_)},i(d){i||(Q(e.$$.fragment,d),i=!0)},o(d){re(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function mC(o,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=Xu("fill")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:j=!0}=e;function V(ne){B=ne,t(0,B)}function se(ne){ui.call(this,o,ne)}function ce(ne){ui.call(this,o,ne)}function Z(ne){ui.call(this,o,ne)}function Y(ne){ui.call(this,o,ne)}function ye(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,d=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,v=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,E=ne.filter),"minzoom"in ne&&t(9,A=ne.minzoom),"maxzoom"in ne&&t(10,z=ne.maxzoom),"hoverCursor"in ne&&t(11,R=ne.hoverCursor),"manageHoverState"in ne&&t(12,D=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,O=ne.eventsIfTopMost),"interactive"in ne&&t(14,j=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,d,a,_,v,k,S,E,A,z,R,D,O,j,i,V,se,ce,Z,Y,ye,Oe,l]}class gC extends qt{constructor(e){super(),$t(this,e,mC,pC,Bt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function _C(o,e,t,i,l){let u=!1;o.getSource(e)&&(u=!0,o.removeSource(e));const d=()=>{i(e)&&(o.addSource(e,t),l())};if(u){const a=()=>{e&&(o.getSource(e)?setTimeout(a,1):d())};a()}else d()}function yC(o,e,t){Ky().then(()=>{let i=Ar(o);if(!i)return;i.getSource(e)===t&&i.removeSource(e)})}function Ly(o){let e=o[0],t,i,l=Ay(o);return{c(){l.c(),t=En()},m(u,d){l.m(u,d),le(u,t,d),i=!0},p(u,d){d&1&&Bt(e,e=u[0])?(gi(),re(l,1,1,Lt),_i(),l=Ay(u),l.c(),Q(l,1),l.m(t.parentNode,t)):l.p(u,d)},i(u){i||(Q(l),i=!0)},o(u){re(l),i=!1},d(u){u&&ae(t),l.d(u)}}}function Ay(o){let e;const t=o[15].default,i=Bi(t,o,o[14],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&16384)&&Oi(i,t,l,l[14],e?Fi(t,l[14],u,null):Ni(l[14]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function vC(o){let e,t,i=o[0]&&Ly(o);return{c(){i&&i.c(),e=En()},m(l,u){i&&i.m(l,u),le(l,e,u),t=!0},p(l,[u]){l[0]?i?(i.p(l,u),u&1&&Q(i,1)):(i=Ly(l),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(gi(),re(i,1,1,()=>{i=null}),_i())},i(l){t||(Q(i),t=!0)},o(l){re(i),t=!1},d(l){l&&ae(e),i&&i.d(l)}}}function bC(o,e,t){let i,l,u,{$$slots:d={},$$scope:a}=e,{id:_=Xu("geojson")}=e,{data:v}=e,{generateId:k=!1}=e,{promoteId:S=void 0}=e,{filter:E=void 0}=e,{lineMetrics:A=void 0}=e,{cluster:z=void 0}=e;const{map:R,cluster:D,self:B}=nC();lt(o,R,V=>t(13,l=V)),lt(o,D,V=>t(16,u=V)),lt(o,B,V=>t(0,i=V));let O,j=!0;return Jn(()=>{i&&O&&l&&(yC(R,i,O),Tt(B,i=null,i),t(11,O=void 0))}),o.$$set=V=>{"id"in V&&t(4,_=V.id),"data"in V&&t(5,v=V.data),"generateId"in V&&t(6,k=V.generateId),"promoteId"in V&&t(7,S=V.promoteId),"filter"in V&&t(8,E=V.filter),"lineMetrics"in V&&t(9,A=V.lineMetrics),"cluster"in V&&t(10,z=V.cluster),"$$scope"in V&&t(14,a=V.$$scope)},o.$$.update=()=>{o.$$.dirty&1024&&Tt(D,u=z,u),o.$$.dirty&12273&&l&&i!==_&&(Tt(B,i=_,i),_C(l,i,Oa({type:"geojson",data:v,filter:E,lineMetrics:A,generateId:k,promoteId:S,cluster:!!z,clusterMinPoints:z==null?void 0:z.minPoints,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius,clusterProperties:z==null?void 0:z.properties}),V=>l&&V===i,()=>{i&&(t(11,O=l==null?void 0:l.getSource(i)),t(12,j=!0))})),o.$$.dirty&8208&&(l==null||l.on("style.load",()=>{t(11,O=l==null?void 0:l.getSource(_))})),o.$$.dirty&6176&&O&&(j?t(12,j=!1):O.setData(v)),o.$$.dirty&3072&&(O==null||O.setClusterOptions(Oa({cluster:!!z,clusterMaxZoom:z==null?void 0:z.maxZoom,clusterRadius:z==null?void 0:z.radius})))},[i,R,D,B,_,v,k,S,E,A,z,O,j,l,a,d]}class wC extends qt{constructor(e){super(),$t(this,e,bC,vC,Bt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function xC(o){let e;const t=o[15].default,i=Bi(t,o,o[23],null);return{c(){i&&i.c()},m(l,u){i&&i.m(l,u),e=!0},p(l,u){i&&i.p&&(!e||u&8388608)&&Oi(i,t,l,l[23],e?Fi(t,l[23],u,null):Ni(l[23]),null)},i(l){e||(Q(i,l),e=!0)},o(l){re(i,l),e=!1},d(l){i&&i.d(l)}}}function kC(o){let e,t,i;function l(d){o[16](d)}let u={id:o[1],type:"line",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],minzoom:o[9],maxzoom:o[10],hoverCursor:o[11],manageHoverState:o[12],eventsIfTopMost:o[13],interactive:o[14],$$slots:{default:[xC]},$$scope:{ctx:o}};return o[0]!==void 0&&(u.hovered=o[0]),e=new Gp({props:u}),Ki.push(()=>Gr(e,"hovered",l)),e.$on("click",o[17]),e.$on("dblclick",o[18]),e.$on("contextmenu",o[19]),e.$on("mouseenter",o[20]),e.$on("mousemove",o[21]),e.$on("mouseleave",o[22]),{c(){Ie(e.$$.fragment)},m(d,a){Ee(e,d,a),i=!0},p(d,[a]){const _={};a&2&&(_.id=d[1]),a&4&&(_.source=d[2]),a&8&&(_.sourceLayer=d[3]),a&16&&(_.beforeId=d[4]),a&32&&(_.beforeLayerType=d[5]),a&64&&(_.paint=d[6]),a&128&&(_.layout=d[7]),a&256&&(_.filter=d[8]),a&512&&(_.minzoom=d[9]),a&1024&&(_.maxzoom=d[10]),a&2048&&(_.hoverCursor=d[11]),a&4096&&(_.manageHoverState=d[12]),a&8192&&(_.eventsIfTopMost=d[13]),a&16384&&(_.interactive=d[14]),a&8388608&&(_.$$scope={dirty:a,ctx:d}),!t&&a&1&&(t=!0,_.hovered=d[0],Zr(()=>t=!1)),e.$set(_)},i(d){i||(Q(e.$$.fragment,d),i=!0)},o(d){re(e.$$.fragment,d),i=!1},d(d){Me(e,d)}}}function SC(o,e,t){let{$$slots:i={},$$scope:l}=e,{id:u=Xu("line")}=e,{source:d=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:_=void 0}=e,{beforeLayerType:v=void 0}=e,{paint:k}=e,{layout:S=void 0}=e,{filter:E=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:R=void 0}=e,{manageHoverState:D=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:j=!0}=e;function V(ne){B=ne,t(0,B)}function se(ne){ui.call(this,o,ne)}function ce(ne){ui.call(this,o,ne)}function Z(ne){ui.call(this,o,ne)}function Y(ne){ui.call(this,o,ne)}function ye(ne){ui.call(this,o,ne)}function Oe(ne){ui.call(this,o,ne)}return o.$$set=ne=>{"id"in ne&&t(1,u=ne.id),"source"in ne&&t(2,d=ne.source),"sourceLayer"in ne&&t(3,a=ne.sourceLayer),"beforeId"in ne&&t(4,_=ne.beforeId),"beforeLayerType"in ne&&t(5,v=ne.beforeLayerType),"paint"in ne&&t(6,k=ne.paint),"layout"in ne&&t(7,S=ne.layout),"filter"in ne&&t(8,E=ne.filter),"minzoom"in ne&&t(9,A=ne.minzoom),"maxzoom"in ne&&t(10,z=ne.maxzoom),"hoverCursor"in ne&&t(11,R=ne.hoverCursor),"manageHoverState"in ne&&t(12,D=ne.manageHoverState),"hovered"in ne&&t(0,B=ne.hovered),"eventsIfTopMost"in ne&&t(13,O=ne.eventsIfTopMost),"interactive"in ne&&t(14,j=ne.interactive),"$$scope"in ne&&t(23,l=ne.$$scope)},[B,u,d,a,_,v,k,S,E,A,z,R,D,O,j,i,V,se,ce,Z,Y,ye,Oe,l]}class TC extends qt{constructor(e){super(),$t(this,e,SC,kC,Bt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function CC(o){let e,t,i,l,u,d;return e=new gC({props:{id:"edit-polygon-fill",filter:Z5,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),i=new TC({props:{id:"edit-polygon-lines",filter:G5,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),u=new dC({props:{id:"edit-polygon-vertices",filter:W5,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment)},m(a,_){Ee(e,a,_),le(a,t,_),Ee(i,a,_),le(a,l,_),Ee(u,a,_),d=!0},p:Lt,i(a){d||(Q(e.$$.fragment,a),Q(i.$$.fragment,a),Q(u.$$.fragment,a),d=!0)},o(a){re(e.$$.fragment,a),re(i.$$.fragment,a),re(u.$$.fragment,a),d=!1},d(a){a&&(ae(t),ae(l)),Me(e,a),Me(i,a),Me(u,a)}}}function EC(o){let e,t;return e=new wC({props:{data:o[0],$$slots:{default:[CC]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&1&&(u.data=i[0]),l&2&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function MC(o,e,t){let i;return lt(o,Y0,l=>t(0,i=l)),[i]}class IC extends qt{constructor(e){super(),$t(this,e,MC,EC,Bt,{})}}function LC(o){let e,t,i,l,u,d,a;return{c(){e=oe("button"),e.textContent="Import current view",t=ze(),i=oe("i"),i.textContent="or...",l=ze(),u=oe("button"),u.textContent="Draw an area to import on the map",ke(e,"type","button"),ke(u,"type","button")},m(_,v){le(_,e,v),le(_,t,v),le(_,i,v),le(_,l,v),le(_,u,v),d||(a=[xt(e,"click",o[2]),xt(u,"click",o[3])],d=!0)},p:Lt,i:Lt,o:Lt,d(_){_&&(ae(e),ae(t),ae(i),ae(l),ae(u)),d=!1,on(a)}}}function AC(o){let e,t;return e=new eC({props:{polygonTool:o[0]}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&1&&(u.polygonTool=i[0]),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function PC(o){let e,t,i,l,u,d,a,_,v;const k=[AC,LC],S=[];function E(A,z){return A[0]?0:1}return e=E(o),t=S[e]=k[e](o),{c(){t.c(),i=ze(),l=oe("label"),u=oe("input"),d=Xe(`Save a copy of the osm.xml
  after importing`),ke(u,"type","checkbox")},m(A,z){S[e].m(A,z),le(A,i,z),le(A,l,z),X(l,u),u.checked=o[1],X(l,d),a=!0,_||(v=xt(u,"change",o[5]),_=!0)},p(A,[z]){let R=e;e=E(A),e===R?S[e].p(A,z):(gi(),re(S[R],1,1,()=>{S[R]=null}),_i(),t=S[e],t?t.p(A,z):(t=S[e]=k[e](A),t.c()),Q(t,1),t.m(i.parentNode,i)),z&2&&(u.checked=A[1])},i(A){a||(Q(t),a=!0)},o(A){re(t),a=!1},d(A){A&&(ae(i),ae(l)),S[e].d(A),_=!1,v()}}}function mu(o){return[o.lng,o.lat]}function zC(o,e,t){let{map:i}=e;const l=ns();let u=null,d=!1;async function a(E){try{l("loading","Loading from Overpass");let z=await(await fetch(i1(E))).text();d&&_d("osm.xml",z),l("gotXml",{xml:z,boundary:E})}catch(A){l("error",A.toString())}}function _(){let E=i.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[mu(E.getSouthWest()),mu(E.getNorthWest()),mu(E.getNorthEast()),mu(E.getSouthEast()),mu(E.getSouthWest())]],type:"Polygon"}}}async function v(){if(i){if(i.getZoom()<13){l("error","Zoom in more to import");return}await a(_())}}function k(){i&&(t(0,u=new X5(i)),u.startNew(),u.addEventListenerSuccess(async E=>{t(0,u=null),await a(E)}),u.addEventListenerFailure(()=>{t(0,u=null)}))}function S(){d=this.checked,t(1,d)}return o.$$set=E=>{"map"in E&&t(4,i=E.map)},[u,d,v,k,i,S]}class DC extends qt{constructor(e){super(),$t(this,e,zC,PC,Bt,{map:4})}}function i1(o){let e='poly:"';for(let[i,l]of o.geometry.coordinates[0])e+=`${l} ${i} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class n1{constructor(e,t,i){Rn(this,"inner");this.inner=new kw(e,t,i)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderNeighbourhood(){let e=RC(JSON.parse(this.inner.renderNeighbourhood()));return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderAutoBoundaries(){return JSON.parse(this.inner.renderAutoBoundaries())}setNeighbourhoodBoundary(e,t){this.inner.setNeighbourhoodBoundary(e,t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e,t){this.inner.setCurrentNeighbourhood(e,t)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}toggleDirection(e){this.inner.toggleDirection(e)}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,i){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,i))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(){return JSON.parse(this.inner.predictImpact())}getImpactsOnRoad(e){return JSON.parse(this.inner.getImpactsOnRoad(e))}}function RC(o){let e=["#8dd3c7","#ffffb3","#bebada","#80b1d3","#fdb462","#b3de69","#fccde5","#bc80bd","#ccebc5","#ffed6f"];for(let t of o.features)t.properties.kind!="cell"&&t.properties.kind!="border_arrow"&&t.properties.kind!="interior_road"||(t.properties.cell_color=="disconnected"?t.properties.color="red":t.properties.color=e[t.properties.cell_color%e.length]);return o}async function md(o){Cs.set(o);try{let e=JSON.parse(window.localStorage.getItem(o));console.time("get OSM input");let[t,i]=await BC(e);console.timeEnd("get OSM input"),console.time("load"),Cn.set(new n1(new Uint8Array(t),i,e.study_area_name||void 0)),Ar(Cn).loadSavefile(e),console.timeEnd("load"),r1()}catch(e){window.alert(`Couldn't open project: ${e}`),Cs.set("")}}async function BC(o){if(o.study_area_name){let e=Ar(Pu)?`/osm/${o.study_area_name}.pbf`:`https://assets.od2net.org/severance_pbfs/${o.study_area_name}.pbf`;console.log(`Grabbing ${e}`);let i=await(await fetch(e)).arrayBuffer(),l=Ar(Pu)?`/boundaries/${o.study_area_name}.geojson`:`https://assets.od2net.org/boundaries/${o.study_area_name}.geojson`,d=await(await fetch(l)).json();return[i,d]}else{console.log("Grabbing from Overpass");let e=o.features.find(l=>l.properties.kind=="study_area_boundary");return[await(await fetch(i1(e))).arrayBuffer(),e]}}function r1(){Ht.set({mode:"network"}),rc.set(new dw(Ar(Vo),Ar(Cn).toRouteSnapper(),wi(Jl()),wi(!0),wi(0))),Ar(Vo).fitBounds(Ar(Cn).getBounds(),{animate:!1}),zu.set(tp()),Du.set(tp()),ld.set(tp());let o=new URL(window.location.href);o.searchParams.set("project",Ar(Cs)),window.history.replaceState(null,"",o.toString())}function tp(){let o=Ar(Cn).getBounds(),e=o[0]+Math.random()*(o[2]-o[0]),t=o[1]+Math.random()*(o[3]-o[1]);return new Ts.LngLat(e,t)}function Py(o,e,t){const i=o.slice();return i[17]=e[t][0],i[18]=e[t][1],i}function zy(o,e,t){const i=o.slice();return i[21]=e[t][0],i[22]=e[t][1],i}function FC(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function OC(o){let e,t,i,l,u,d,a,_;return u=new Ei({props:{$$slots:{default:[FC]},$$scope:{ctx:o}}}),u.$on("click",o[13]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),a.textContent="New project",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(v,k){le(v,e,k),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),_=!0},p(v,k){const S={};k&33554432&&(S.$$scope={dirty:k,ctx:v}),u.$set(S)},i(v){_||(Q(u.$$.fragment,v),_=!0)},o(v){re(u.$$.fragment,v),_=!1},d(v){v&&ae(e),Me(u)}}}function Dy(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z;e=new Yy({props:{loading:o[4]}});let R=Kn(o[3]),D=[];for(let B=0;B<R.length;B+=1)D[B]=By(Py(o,R,B));return S=new DC({props:{map:o[5]}}),S.$on("gotXml",o[7]),S.$on("loading",o[11]),S.$on("error",o[12]),{c(){Ie(e.$$.fragment),t=ze(),i=oe("label"),l=Xe(`Load a built-in area:
        `),u=oe("select"),d=oe("option");for(let B=0;B<D.length;B+=1)D[B].c();a=ze(),_=oe("i"),_.textContent="or...",v=ze(),k=oe("div"),Ie(S.$$.fragment),d.__value="",Fn(d,d.__value),o[2]===void 0&&ec(()=>o[9].call(u))},m(B,O){Ee(e,B,O),le(B,t,O),le(B,i,O),X(i,l),X(i,u),X(u,d);for(let j=0;j<D.length;j+=1)D[j]&&D[j].m(u,null);Ql(u,o[2],!0),le(B,a,O),le(B,_,O),le(B,v,O),le(B,k,O),Ee(S,k,null),E=!0,A||(z=[xt(u,"change",o[9]),xt(u,"change",o[10])],A=!0)},p(B,O){const j={};if(O&16&&(j.loading=B[4]),e.$set(j),O&8){R=Kn(B[3]);let se;for(se=0;se<R.length;se+=1){const ce=Py(B,R,se);D[se]?D[se].p(ce,O):(D[se]=By(ce),D[se].c(),D[se].m(u,null))}for(;se<D.length;se+=1)D[se].d(1);D.length=R.length}O&12&&Ql(u,B[2]);const V={};O&32&&(V.map=B[5]),S.$set(V)},i(B){E||(Q(e.$$.fragment,B),Q(S.$$.fragment,B),E=!0)},o(B){re(e.$$.fragment,B),re(S.$$.fragment,B),E=!1},d(B){B&&(ae(t),ae(i),ae(a),ae(_),ae(v),ae(k)),Me(e,B),Ss(D,B),Me(S),A=!1,on(z)}}}function Ry(o){let e,t=o[22]+"",i,l;return{c(){e=oe("option"),i=Xe(t),e.__value=l=o[21],Fn(e,e.__value)},m(u,d){le(u,e,d),X(e,i)},p(u,d){d&8&&t!==(t=u[22]+"")&&xi(i,t),d&8&&l!==(l=u[21])&&(e.__value=l,Fn(e,e.__value))},d(u){u&&ae(e)}}}function By(o){let e,t,i=Kn(o[18]),l=[];for(let u=0;u<i.length;u+=1)l[u]=Ry(zy(o,i,u));return{c(){e=oe("optgroup");for(let u=0;u<l.length;u+=1)l[u].c();ke(e,"label",t=o[17])},m(u,d){le(u,e,d);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(u,d){if(d&8){i=Kn(u[18]);let a;for(a=0;a<i.length;a+=1){const _=zy(u,i,a);l[a]?l[a].p(_,d):(l[a]=Ry(_),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=i.length}d&8&&t!==(t=u[17])&&ke(e,"label",t)},d(u){u&&ae(e),Ss(l,u)}}}function NC(o){let e,t,i,l,u,d,a,_,v,k=o[1]&&Dy(o);return{c(){e=oe("div"),t=oe("div"),i=oe("label"),l=Xe(`Project name:
        `),u=oe("input"),d=ze(),k&&k.c(),ke(u,"type","text"),ke(e,"slot","sidebar")},m(S,E){le(S,e,E),X(e,t),X(t,i),X(i,l),X(i,u),Fn(u,o[1]),X(e,d),k&&k.m(e,null),a=!0,_||(v=xt(u,"input",o[8]),_=!0)},p(S,E){E&2&&u.value!==S[1]&&Fn(u,S[1]),S[1]?k?(k.p(S,E),E&2&&Q(k,1)):(k=Dy(S),k.c(),Q(k,1),k.m(e,null)):k&&(gi(),re(k,1,1,()=>{k=null}),_i())},i(S){a||(Q(k),a=!0)},o(S){re(k),a=!1},d(S){S&&ae(e),k&&k.d(),_=!1,v()}}}function jC(o){let e,t,i;return t=new IC({}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","map")},m(l,u){le(l,e,u),Ee(t,e,null),i=!0},p:Lt,i(l){i||(Q(t.$$.fragment,l),i=!0)},o(l){re(t.$$.fragment,l),i=!1},d(l){l&&ae(e),Me(t)}}}function UC(o){let e,t;return e=new Lo({props:{$$slots:{map:[jC],sidebar:[NC],top:[OC]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,[l]){const u={};l&33554558&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function VC(o,e,t){let i,l,u,d,a;lt(o,Cs,V=>t(14,i=V)),lt(o,Cn,V=>t(15,l=V)),lt(o,Pu,V=>t(16,u=V)),lt(o,Vo,V=>t(5,d=V)),lt(o,Ht,V=>t(6,a=V));let _="",v="",k=[],S="";$u(async()=>{let V=await fetch(u?"/osm/areas.json":"https://assets.od2net.org/severance_pbfs/areas.json");t(3,k=await V.json())});function E(V){t(4,S="Loading OSM");try{Tt(Cn,l=new n1(new TextEncoder().encode(V.detail.xml),V.detail.boundary,void 0),l),Tt(Cs,i=`ltn_${_}`,i),r1(),nc()}catch(se){window.alert(`Couldn't import from Overpass: ${se}`)}t(4,S="")}async function A(){if(v=="")return;let V=`ltn_${_}`;window.localStorage.setItem(V,JSON.stringify({type:"FeatureCollection",features:[],study_area_name:v})),t(4,S=`Loading pre-clipped OSM area ${v}`),await md(V),t(4,S="")}function z(){_=this.value,t(1,_)}function R(){v=Mp(this),t(2,v),t(3,k)}return[A,_,v,k,S,d,a,E,z,R,()=>A(),V=>t(4,S=V.detail),V=>window.alert(V.detail),()=>Tt(Ht,a={mode:"title",firstLoad:!1},a)]}class $C extends qt{constructor(e){super(),$t(this,e,VC,UC,Bt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}function Fy(o,e,t){const i=o.slice();return i[19]=e[t][0],i[20]=e[t][1],i}function Oy(o,e,t){const i=o.slice();return i[23]=e[t],i}function qC(o){let e;return{c(){e=oe("div"),e.innerHTML='<nav aria-label="breadcrumb"><ul><li>Choose project</li></ul></nav>',ke(e,"slot","top")},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function ZC(o){let e;return{c(){e=oe("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,i){le(t,e,i)},p:Lt,i:Lt,o:Lt,d(t){t&&ae(e)}}}function GC(o){let e,t,i,l,u,d,a,_,v,k,S,E,A;t=new Ei({props:{$$slots:{default:[WC]},$$scope:{ctx:o}}}),t.$on("click",o[11]);let z=Kn(o[2]),R=[];for(let B=0;B<z.length;B+=1)R[B]=jy(Fy(o,z,B));const D=B=>re(R[B],1,1,()=>{R[B]=null});return{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),l=oe("p"),l.textContent="Load a saved project:",u=ze(),d=oe("ul");for(let B=0;B<R.length;B+=1)R[B].c();a=ze(),_=oe("label"),v=Xe(`Load a project from a file
        `),k=oe("input"),ke(k,"type","file")},m(B,O){le(B,e,O),Ee(t,e,null),le(B,i,O),le(B,l,O),le(B,u,O),le(B,d,O);for(let j=0;j<R.length;j+=1)R[j]&&R[j].m(d,null);le(B,a,O),le(B,_,O),X(_,v),X(_,k),o[15](k),S=!0,E||(A=xt(k,"change",o[6]),E=!0)},p(B,O){const j={};if(O&67108864&&(j.$$scope={dirty:O,ctx:B}),t.$set(j),O&900){z=Kn(B[2]);let V;for(V=0;V<z.length;V+=1){const se=Fy(B,z,V);R[V]?(R[V].p(se,O),Q(R[V],1)):(R[V]=jy(se),R[V].c(),Q(R[V],1),R[V].m(d,null))}for(gi(),V=z.length;V<R.length;V+=1)D(V);_i()}},i(B){if(!S){Q(t.$$.fragment,B);for(let O=0;O<z.length;O+=1)Q(R[O]);S=!0}},o(B){re(t.$$.fragment,B),R=R.filter(Boolean);for(let O=0;O<R.length;O+=1)re(R[O]);S=!1},d(B){B&&(ae(e),ae(i),ae(l),ae(u),ae(d),ae(a),ae(_)),Me(t),Ss(R,B),o[15](null),E=!1,A()}}}function WC(o){let e;return{c(){e=Xe("New project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function HC(o){let e=o[23].slice(4)+"",t;return{c(){t=Xe(e)},m(i,l){le(i,t,l)},p(i,l){l&4&&e!==(e=i[23].slice(4)+"")&&xi(t,e)},d(i){i&&ae(t)}}}function Ny(o){let e,t,i,l,u,d,a,_,v,k,S;function E(){return o[12](o[23])}i=new Ei({props:{$$slots:{default:[HC]},$$scope:{ctx:o}}}),i.$on("click",E);function A(){return o[13](o[23])}function z(){return o[14](o[23])}return{c(){e=oe("li"),t=oe("span"),Ie(i.$$.fragment),l=ze(),u=oe("button"),u.innerHTML=`<img src="${H0}" alt="Rename project"/>`,d=ze(),a=oe("button"),a.innerHTML=`<img src="${W0}" alt="Delete project"/>`,_=ze(),ke(u,"class","secondary"),ke(a,"class","secondary"),nn(t,"display","flex"),nn(t,"justify-content","space-between")},m(R,D){le(R,e,D),X(e,t),Ee(i,t,null),X(t,l),X(t,u),X(t,d),X(t,a),X(e,_),v=!0,k||(S=[xt(u,"click",A),xt(a,"click",z)],k=!0)},p(R,D){o=R;const B={};D&67108868&&(B.$$scope={dirty:D,ctx:o}),i.$set(B)},i(R){v||(Q(i.$$.fragment,R),v=!0)},o(R){re(i.$$.fragment,R),v=!1},d(R){R&&ae(e),Me(i),k=!1,on(S)}}}function jy(o){let e,t=(o[19]??"custom area")+"",i,l,u,d,a=Kn(o[20]),_=[];for(let k=0;k<a.length;k+=1)_[k]=Ny(Oy(o,a,k));const v=k=>re(_[k],1,1,()=>{_[k]=null});return{c(){e=oe("u"),i=Xe(t),l=ze();for(let k=0;k<_.length;k+=1)_[k].c();u=En()},m(k,S){le(k,e,S),X(e,i),le(k,l,S);for(let E=0;E<_.length;E+=1)_[E]&&_[E].m(k,S);le(k,u,S),d=!0},p(k,S){if((!d||S&4)&&t!==(t=(k[19]??"custom area")+"")&&xi(i,t),S&900){a=Kn(k[20]);let E;for(E=0;E<a.length;E+=1){const A=Oy(k,a,E);_[E]?(_[E].p(A,S),Q(_[E],1)):(_[E]=Ny(A),_[E].c(),Q(_[E],1),_[E].m(u.parentNode,u))}for(gi(),E=a.length;E<_.length;E+=1)v(E);_i()}},i(k){if(!d){for(let S=0;S<a.length;S+=1)Q(_[S]);d=!0}},o(k){_=_.filter(Boolean);for(let S=0;S<_.length;S+=1)re(_[S]);d=!1},d(k){k&&(ae(e),ae(l),ae(u)),Ss(_,k)}}}function XC(o){let e,t,i,l;const u=[GC,ZC],d=[];function a(_,v){return _[4]&&_[0]?0:1}return t=a(o),i=d[t]=u[t](o),{c(){e=oe("div"),i.c(),ke(e,"slot","sidebar")},m(_,v){le(_,e,v),d[t].m(e,null),l=!0},p(_,v){let k=t;t=a(_),t===k?d[t].p(_,v):(gi(),re(d[k],1,1,()=>{d[k]=null}),_i(),i=d[t],i?i.p(_,v):(i=d[t]=u[t](_),i.c()),Q(i,1),i.m(e,null))},i(_){l||(Q(i),l=!0)},o(_){re(i),l=!1},d(_){_&&ae(e),d[t].d()}}}function KC(o){let e,t,i,l;return e=new Yy({props:{loading:o[1]}}),i=new Lo({props:{$$slots:{sidebar:[XC],top:[qC]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment)},m(u,d){Ee(e,u,d),le(u,t,d),Ee(i,u,d),l=!0},p(u,[d]){const a={};d&2&&(a.loading=u[1]),e.$set(a);const _={};d&67108925&&(_.$$scope={dirty:d,ctx:u}),i.$set(_)},i(u){l||(Q(e.$$.fragment,u),Q(i.$$.fragment,u),l=!0)},o(u){re(e.$$.fragment,u),re(i.$$.fragment,u),l=!1},d(u){u&&ae(t),Me(e,u),Me(i,u)}}}function od(){let o=new Map,e=[];for(let i=0;i<window.localStorage.length;i++){let l=window.localStorage.key(i);if(l.startsWith("ltn_")){let u="";try{u=JSON.parse(window.localStorage.getItem(l)).study_area_name}catch{}u&&u.length>0?(o.has(u)||o.set(u,[]),o.get(u).push(l)):e.push(l)}}let t=[...o.entries()];return t.sort((i,l)=>i[0].localeCompare(l[0])),t.push(["custom",e]),t}function JC(o,e,t){let i,l,u,d,a;lt(o,Cs,ce=>t(16,i=ce)),lt(o,rc,ce=>t(17,l=ce)),lt(o,Cn,ce=>t(18,u=ce)),lt(o,Vo,ce=>t(4,d=ce)),lt(o,Ht,ce=>t(5,a=ce));let{wasmReady:_}=e,{firstLoad:v}=e,k="";if(Tt(Cn,u=null,u),Tt(rc,l=null,l),Tt(Cs,i="",i),v){let Z=new URLSearchParams(window.location.search).get("project");Z&&md(Z)}else{let ce=new URL(window.location.href);ce.searchParams.delete("project"),window.history.replaceState(null,"",ce.toString())}let S=od(),E;async function A(ce){let Z="ltn_"+E.files[0].name;t(1,k=`Loading from file ${Z}`),window.localStorage.setItem(Z,await E.files[0].text()),t(2,S=od()),await md(Z),t(1,k="")}function z(ce){window.confirm(`Really delete project ${ce}? You can't undo this.`)&&(window.localStorage.removeItem(ce),t(2,S=od()))}function R(ce){let Z=window.prompt(`Rename project ${ce} to what?`,ce);if(Z){Z.startsWith("ltn_")||(Z=`ltn_${Z}`);let Y=window.localStorage.getItem(ce);window.localStorage.setItem(Z,Y),window.localStorage.removeItem(ce),t(2,S=od())}}async function D(ce){t(1,k=`Loading project ${ce}`),await md(ce),t(1,k="")}const B=()=>Tt(Ht,a={mode:"new-project"},a),O=ce=>D(ce),j=ce=>R(ce),V=ce=>z(ce);function se(ce){Ki[ce?"unshift":"push"](()=>{E=ce,t(3,E)})}return o.$$set=ce=>{"wasmReady"in ce&&t(0,_=ce.wasmReady),"firstLoad"in ce&&t(10,v=ce.firstLoad)},[_,k,S,E,d,a,A,z,R,D,v,B,O,j,V,se]}class YC extends qt{constructor(e){super(),$t(this,e,JC,KC,Bt,{wasmReady:0,firstLoad:10})}}const{window:QC}=Cd;function eE(o){let e;return{c(){e=Xe("Choose project")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function tE(o){let e;return{c(){e=Xe("Pick neighbourhood")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function iE(o){let e;return{c(){e=Xe("Editing")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function nE(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z;return u=new Ei({props:{$$slots:{default:[eE]},$$scope:{ctx:o}}}),u.$on("click",o[8]),_=new Ei({props:{$$slots:{default:[tE]},$$scope:{ctx:o}}}),_.$on("click",o[9]),S=new Ei({props:{$$slots:{default:[iE]},$$scope:{ctx:o}}}),S.$on("click",o[4]),{c(){e=oe("div"),t=oe("nav"),i=oe("ul"),l=oe("li"),Ie(u.$$.fragment),d=ze(),a=oe("li"),Ie(_.$$.fragment),v=ze(),k=oe("li"),Ie(S.$$.fragment),E=ze(),A=oe("li"),A.textContent="Viewing shortcuts",ke(t,"aria-label","breadcrumb"),ke(e,"slot","top")},m(R,D){le(R,e,D),X(e,t),X(t,i),X(i,l),Ee(u,l,null),X(i,d),X(i,a),Ee(_,a,null),X(i,v),X(i,k),Ee(S,k,null),X(i,E),X(i,A),z=!0},p(R,D){const B={};D&8192&&(B.$$scope={dirty:D,ctx:R}),u.$set(B);const O={};D&8192&&(O.$$scope={dirty:D,ctx:R}),_.$set(O);const j={};D&8192&&(j.$$scope={dirty:D,ctx:R}),S.$set(j)},i(R){z||(Q(u.$$.fragment,R),Q(_.$$.fragment,R),Q(S.$$.fragment,R),z=!0)},o(R){re(u.$$.fragment,R),re(_.$$.fragment,R),re(S.$$.fragment,R),z=!1},d(R){R&&ae(e),Me(u),Me(_),Me(S)}}}function rE(o){let e,t,i,l,u,d,a,_,v,k=o[0].shortcutIndex+1+"",S,E,A=o[0].gj.features.length+"",z,R,D,B,O,j,V,se,ce,Z=yr(o[0].gj.features[o[0].shortcutIndex].properties).directness.toFixed(1)+"",Y,ye,Oe,ne,ve;return{c(){e=oe("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending outside the
        neighbourhood, but cutting through it. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=ze(),i=oe("button"),i.textContent="Pick a different road",l=ze(),u=oe("div"),d=oe("button"),a=Xe("Previous"),v=ze(),S=Xe(k),E=Xe(" / "),z=Xe(A),R=ze(),D=oe("button"),B=Xe("Next"),j=ze(),V=oe("p"),se=Xe("This shortcut is "),ce=oe("b"),Y=Xe(Z),ye=Xe("x"),Oe=Xe(`
        the length of the shortest route using all roads, not just this neighbourhood`),d.disabled=_=o[0].shortcutIndex==0,ke(d,"data-tooltip","Left"),D.disabled=O=o[0].shortcutIndex==o[0].gj.features.length-1,ke(D,"data-tooltip","Right"),nn(u,"display","flex"),nn(u,"justify-content","space-between")},m(Je,Le){le(Je,e,Le),le(Je,t,Le),le(Je,i,Le),le(Je,l,Le),le(Je,u,Le),X(u,d),X(d,a),X(u,v),X(u,S),X(u,E),X(u,z),X(u,R),X(u,D),X(D,B),le(Je,j,Le),le(Je,V,Le),X(V,se),X(V,ce),X(ce,Y),X(ce,ye),X(V,Oe),ne||(ve=[xt(i,"click",o[7]),xt(d,"click",o[5]),xt(D,"click",o[6])],ne=!0)},p(Je,Le){Le&1&&_!==(_=Je[0].shortcutIndex==0)&&(d.disabled=_),Le&1&&k!==(k=Je[0].shortcutIndex+1+"")&&xi(S,k),Le&1&&A!==(A=Je[0].gj.features.length+"")&&xi(z,A),Le&1&&O!==(O=Je[0].shortcutIndex==Je[0].gj.features.length-1)&&(D.disabled=O),Le&1&&Z!==(Z=yr(Je[0].gj.features[Je[0].shortcutIndex].properties).directness.toFixed(1)+"")&&xi(Y,Z)},d(Je){Je&&(ae(e),ae(t),ae(i),ae(l),ae(u),ae(j),ae(V)),ne=!1,on(ve)}}}function oE(o){let e;return{c(){e=oe("p"),e.textContent="Click a road to see shortcuts"},m(t,i){le(t,e,i)},p:Lt,d(t){t&&ae(e)}}}function sE(o){let e,t,i,l;t=new lc({}),t.$on("click",o[4]);function u(_,v){if(_[0].state=="neutral")return oE;if(_[0].state=="chose-road")return rE}let d=u(o),a=d&&d(o);return{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),a&&a.c(),ke(e,"slot","sidebar")},m(_,v){le(_,e,v),Ee(t,e,null),X(e,i),a&&a.m(e,null),l=!0},p(_,v){d===(d=u(_))&&a?a.p(_,v):(a&&a.d(1),a=d&&d(_),a&&(a.c(),a.m(e,null)))},i(_){l||(Q(t.$$.fragment,_),l=!0)},o(_){re(t.$$.fragment,_),l=!1},d(_){_&&ae(e),Me(t),a&&a.d()}}}function aE(o){let e,t;return e=new Wu({props:{interactive:!1}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function lE(o){let e,t;return e=new Wu({props:{onClickLine:o[2],$$slots:{"line-popup":[uE]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&8192&&(u.$$scope={dirty:l,ctx:i}),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function cE(o){let e,t=o[12].shortcuts+"",i,l,u=(o[12].name??"unnamed road")+"",d;return{c(){e=oe("p"),i=Xe(t),l=Xe(" shortcuts through "),d=Xe(u)},m(a,_){le(a,e,_),X(e,i),X(e,l),X(e,d)},p(a,_){_&4096&&t!==(t=a[12].shortcuts+"")&&xi(i,t),_&4096&&u!==(u=(a[12].name??"unnamed road")+"")&&xi(d,u)},d(a){a&&ae(e)}}}function uE(o){let e,t,i;return t=new $o({props:{openOn:"hover",$$slots:{default:[cE,({props:l})=>({12:l}),({props:l})=>l?4096:0]},$$scope:{ctx:o}}}),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","line-popup")},m(l,u){le(l,e,u),Ee(t,e,null),i=!0},p(l,u){const d={};u&12288&&(d.$$scope={dirty:u,ctx:l}),t.$set(d)},i(l){i||(Q(t.$$.fragment,l),i=!0)},o(l){re(t.$$.fragment,l),i=!1},d(l){l&&ae(e),Me(t)}}}function hE(o){let e,t,i,l,u,d,a,_,v,k;e=new Bd({}),i=new Rd({}),u=new Fd({});const S=[lE,aE],E=[];function A(z,R){return z[0].state=="neutral"?0:z[0].state=="chose-road"?1:-1}return~(a=A(o))&&(_=E[a]=S[a](o)),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment),d=ze(),_&&_.c(),v=En()},m(z,R){Ee(e,z,R),le(z,t,R),Ee(i,z,R),le(z,l,R),Ee(u,z,R),le(z,d,R),~a&&E[a].m(z,R),le(z,v,R),k=!0},p(z,R){let D=a;a=A(z),a===D?~a&&E[a].p(z,R):(_&&(gi(),re(E[D],1,1,()=>{E[D]=null}),_i()),~a?(_=E[a],_?_.p(z,R):(_=E[a]=S[a](z),_.c()),Q(_,1),_.m(v.parentNode,v)):_=null)},i(z){k||(Q(e.$$.fragment,z),Q(i.$$.fragment,z),Q(u.$$.fragment,z),Q(_),k=!0)},o(z){re(e.$$.fragment,z),re(i.$$.fragment,z),re(u.$$.fragment,z),re(_),k=!1},d(z){z&&(ae(t),ae(l),ae(d),ae(v)),Me(e,z),Me(i,z),Me(u,z),~a&&E[a].d(z)}}}function Uy(o){let e,t,i,l,u,d,a,_;return e=new cr({props:{data:o[0].gj.features[o[0].shortcutIndex],$$slots:{default:[dE]},$$scope:{ctx:o}}}),i=new cr({props:{data:o[0].roadGj,$$slots:{default:[fE]},$$scope:{ctx:o}}}),u=new Na({props:{lngLat:o[0].gj.features[o[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[pE]},$$scope:{ctx:o}}}),a=new Na({props:{lngLat:o[0].gj.features[o[0].shortcutIndex].geometry.coordinates[o[0].gj.features[o[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[mE]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment),d=ze(),Ie(a.$$.fragment)},m(v,k){Ee(e,v,k),le(v,t,k),Ee(i,v,k),le(v,l,k),Ee(u,v,k),le(v,d,k),Ee(a,v,k),_=!0},p(v,k){const S={};k&1&&(S.data=v[0].gj.features[v[0].shortcutIndex]),k&8192&&(S.$$scope={dirty:k,ctx:v}),e.$set(S);const E={};k&1&&(E.data=v[0].roadGj),k&8192&&(E.$$scope={dirty:k,ctx:v}),i.$set(E);const A={};k&1&&(A.lngLat=v[0].gj.features[v[0].shortcutIndex].geometry.coordinates[0]),k&8192&&(A.$$scope={dirty:k,ctx:v}),u.$set(A);const z={};k&1&&(z.lngLat=v[0].gj.features[v[0].shortcutIndex].geometry.coordinates[v[0].gj.features[v[0].shortcutIndex].geometry.coordinates.length-1]),k&8192&&(z.$$scope={dirty:k,ctx:v}),a.$set(z)},i(v){_||(Q(e.$$.fragment,v),Q(i.$$.fragment,v),Q(u.$$.fragment,v),Q(a.$$.fragment,v),_=!0)},o(v){re(e.$$.fragment,v),re(i.$$.fragment,v),re(u.$$.fragment,v),re(a.$$.fragment,v),_=!1},d(v){v&&(ae(t),ae(l),ae(d)),Me(e,v),Me(i,v),Me(u,v),Me(a,v)}}}function dE(o){let e,t;const i=[rn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Wr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function fE(o){let e,t;const i=[rn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Wr({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function pE(o){let e;return{c(){e=Xe("A")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function mE(o){let e;return{c(){e=Xe("B")},m(t,i){le(t,e,i)},d(t){t&&ae(e)}}}function gE(o){let e,t,i,l,u,d;t=new Hu({props:{$$slots:{default:[hE]},$$scope:{ctx:o}}});let a=o[0].state=="chose-road"&&Uy(o);return u=new ja({}),{c(){e=oe("div"),Ie(t.$$.fragment),i=ze(),a&&a.c(),l=ze(),Ie(u.$$.fragment),ke(e,"slot","map")},m(_,v){le(_,e,v),Ee(t,e,null),X(e,i),a&&a.m(e,null),X(e,l),Ee(u,e,null),d=!0},p(_,v){const k={};v&8193&&(k.$$scope={dirty:v,ctx:_}),t.$set(k),_[0].state=="chose-road"?a?(a.p(_,v),v&1&&Q(a,1)):(a=Uy(_),a.c(),Q(a,1),a.m(e,l)):a&&(gi(),re(a,1,1,()=>{a=null}),_i())},i(_){d||(Q(t.$$.fragment,_),Q(a),Q(u.$$.fragment,_),d=!0)},o(_){re(t.$$.fragment,_),re(a),re(u.$$.fragment,_),d=!1},d(_){_&&ae(e),Me(t),a&&a.d(),Me(u)}}}function _E(o){let e,t,i,l;return e=new Lo({props:{$$slots:{map:[gE],sidebar:[sE],top:[nE]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0,i||(l=xt(QC,"keydown",o[3]),i=!0)},p(u,[d]){const a={};d&8195&&(a.$$scope={dirty:d,ctx:u}),e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u),i=!1,l()}}}function yE(o,e,t){let i,l,u;lt(o,Ht,R=>t(1,i=R)),lt(o,Vo,R=>t(10,l=R)),lt(o,Cn,R=>t(11,u=R));let d={state:"neutral"};function a(R,D){let B=u.getShortcutsCrossingRoad(R.properties.id);if(B.features.length==0){window.alert("No shortcuts here");return}t(0,d={state:"chose-road",roadGj:R,gj:B,shortcutIndex:0})}$u(()=>{l==null||l.keyboard.disable()}),Jn(()=>{l==null||l.keyboard.enable()});function _(R){d.state=="chose-road"&&(R.key=="ArrowLeft"&&(R.stopPropagation(),d.shortcutIndex>0&&t(0,d.shortcutIndex--,d)),R.key=="ArrowRight"&&(R.stopPropagation(),d.shortcutIndex!=d.gj.features.length-1&&t(0,d.shortcutIndex++,d)))}function v(){Tt(Ht,i={mode:"neighbourhood"},i)}function k(){d.state=="chose-road"&&t(0,d.shortcutIndex--,d)}function S(){d.state=="chose-road"&&t(0,d.shortcutIndex++,d)}return[d,i,a,_,v,k,S,()=>t(0,d={state:"neutral"}),()=>Tt(Ht,i={mode:"title",firstLoad:!1},i),()=>Tt(Ht,i={mode:"network"},i)]}class vE extends qt{constructor(e){super(),$t(this,e,yE,_E,Bt,{})}}function bE(o){let e,t,i,l,u,d,a,_,v;return l=new q5({}),{c(){e=oe("div"),t=oe("button"),t.innerHTML=`<img src="${cb}" style="height: 6vh;" alt="A/B Street logo"/>`,i=ze(),Ie(l.$$.fragment),u=ze(),d=oe("span"),ke(t,"class","outline"),nn(d,"width","100%"),ke(e,"slot","top"),nn(e,"display","flex")},m(k,S){le(k,e,S),X(e,t),X(e,i),Ee(l,e,null),X(e,u),X(e,d),o[19](d),a=!0,_||(v=xt(t,"click",o[18]),_=!0)},p:Lt,i(k){a||(Q(l.$$.fragment,k),a=!0)},o(k){re(l.$$.fragment,k),a=!1},d(k){k&&ae(e),Me(l),o[19](null),_=!1,v()}}}function Vy(o){let e,t,i,l,u,d;return i=new aS({props:{map:yr(o[6]),maptilerBasemap:o[7]}}),{c(){e=oe("button"),e.textContent="Zoom to fit study area",t=ze(),Ie(i.$$.fragment),ke(e,"class","secondary")},m(a,_){le(a,e,_),le(a,t,_),Ee(i,a,_),l=!0,u||(d=xt(e,"click",o[10]),u=!0)},p(a,_){const v={};_&64&&(v.map=yr(a[6])),_&128&&(v.maptilerBasemap=a[7]),i.$set(v)},i(a){l||(Q(i.$$.fragment,a),l=!0)},o(a){re(i.$$.fragment,a),l=!1},d(a){a&&(ae(e),ae(t)),Me(i,a),u=!1,d()}}}function wE(o){let e,t,i,l,u,d,a=o[5]&&Vy(o);return{c(){e=oe("div"),t=oe("div"),i=ze(),l=oe("hr"),u=ze(),a&&a.c(),ke(e,"slot","left")},m(_,v){le(_,e,v),X(e,t),o[17](t),X(e,i),X(e,l),X(e,u),a&&a.m(e,null),d=!0},p(_,v){_[5]?a?(a.p(_,v),v&32&&Q(a,1)):(a=Vy(_),a.c(),Q(a,1),a.m(e,null)):a&&(gi(),re(a,1,1,()=>{a=null}),_i())},i(_){d||(Q(a),d=!0)},o(_){re(a),d=!1},d(_){_&&ae(e),o[17](null),a&&a.d()}}}function xE(o){let e,t;return e=new $C({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function kE(o){let e,t;return e=new YC({props:{wasmReady:o[4],firstLoad:o[8].firstLoad}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&16&&(u.wasmReady=i[4]),l&256&&(u.firstLoad=i[8].firstLoad),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function $y(o){let e,t,i,l,u,d;e=new cr({props:{data:o[5].getInvertedBoundary(),$$slots:{default:[SE]},$$scope:{ctx:o}}});const a=[DE,zE,PE,AE,LE,IE,ME,EE,CE,TE],_=[];function v(k,S){return k[8].mode=="network"?0:k[8].mode=="set-boundary"?1:k[8].mode=="auto-boundaries"?2:k[8].mode=="neighbourhood"?3:k[8].mode=="view-shortcuts"?4:k[8].mode=="impact-one-destination"?5:k[8].mode=="route"?6:k[8].mode=="predict-impact"?7:k[8].mode=="impact-detail"?8:k[8].mode=="debug"?9:-1}return~(i=v(o))&&(l=_[i]=a[i](o)),{c(){Ie(e.$$.fragment),t=ze(),l&&l.c(),u=En()},m(k,S){Ee(e,k,S),le(k,t,S),~i&&_[i].m(k,S),le(k,u,S),d=!0},p(k,S){const E={};S&32&&(E.data=k[5].getInvertedBoundary()),S&2097152&&(E.$$scope={dirty:S,ctx:k}),e.$set(E);let A=i;i=v(k),i===A?~i&&_[i].p(k,S):(l&&(gi(),re(_[A],1,1,()=>{_[A]=null}),_i()),~i?(l=_[i],l?l.p(k,S):(l=_[i]=a[i](k),l.c()),Q(l,1),l.m(u.parentNode,u)):l=null)},i(k){d||(Q(e.$$.fragment,k),Q(l),d=!0)},o(k){re(e.$$.fragment,k),re(l),d=!1},d(k){k&&(ae(t),ae(u)),Me(e,k),~i&&_[i].d(k)}}}function SE(o){let e,t;const i=[rn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let l={};for(let u=0;u<i.length;u+=1)l=Xi(l,i[u]);return e=new Es({props:l}),{c(){Ie(e.$$.fragment)},m(u,d){Ee(e,u,d),t=!0},p(u,d){const a={};e.$set(a)},i(u){t||(Q(e.$$.fragment,u),t=!0)},o(u){re(e.$$.fragment,u),t=!1},d(u){Me(e,u)}}}function TE(o){let e,t;return e=new n3({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function CE(o){let e,t;return e=new uT({props:{road:o[8].road}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&256&&(u.road=i[8].road),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function EE(o){let e,t;return e=new YT({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function ME(o){let e,t;return e=new h5({props:{prevMode:o[8].prevMode}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&256&&(u.prevMode=i[8].prevMode),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function IE(o){let e,t;return e=new TT({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function LE(o){let e,t;return e=new vE({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function AE(o){let e,t;return e=new Y3({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function PE(o){let e,t;return e=new kS({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function zE(o){let e,t;return e=new N5({props:{name:o[8].name,existing:o[8].existing}}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p(i,l){const u={};l&256&&(u.name=i[8].name),l&256&&(u.existing=i[8].existing),e.$set(u)},i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function DE(o){let e,t;return e=new UT({}),{c(){Ie(e.$$.fragment)},m(i,l){Ee(e,i,l),t=!0},p:Lt,i(i){t||(Q(e.$$.fragment,i),t=!0)},o(i){re(e.$$.fragment,i),t=!1},d(i){Me(e,i)}}}function RE(o){let e,t,i,l,u,d,a,_,v,k,S,E,A,z;e=new x0({}),i=new k0({}),u=new u4({props:{map:o[0],apiKey:ap,country:void 0}});const R=[kE,xE],D=[];function B(j,V){return j[8].mode=="title"?0:j[8].mode=="new-project"?1:-1}~(v=B(o))&&(k=D[v]=R[v](o));let O=o[5]&&$y(o);return A=new V4({}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment),l=ze(),Ie(u.$$.fragment),d=ze(),a=oe("div"),_=ze(),k&&k.c(),S=ze(),O&&O.c(),E=ze(),Ie(A.$$.fragment)},m(j,V){Ee(e,j,V),le(j,t,V),Ee(i,j,V),le(j,l,V),Ee(u,j,V),le(j,d,V),le(j,a,V),o[14](a),le(j,_,V),~v&&D[v].m(j,V),le(j,S,V),O&&O.m(j,V),le(j,E,V),Ee(A,j,V),z=!0},p(j,V){const se={};V&1&&(se.map=j[0]),u.$set(se);let ce=v;v=B(j),v===ce?~v&&D[v].p(j,V):(k&&(gi(),re(D[ce],1,1,()=>{D[ce]=null}),_i()),~v?(k=D[v],k?k.p(j,V):(k=D[v]=R[v](j),k.c()),Q(k,1),k.m(S.parentNode,S)):k=null),j[5]?O?(O.p(j,V),V&32&&Q(O,1)):(O=$y(j),O.c(),Q(O,1),O.m(E.parentNode,E)):O&&(gi(),re(O,1,1,()=>{O=null}),_i())},i(j){z||(Q(e.$$.fragment,j),Q(i.$$.fragment,j),Q(u.$$.fragment,j),Q(k),Q(O),Q(A.$$.fragment,j),z=!0)},o(j){re(e.$$.fragment,j),re(i.$$.fragment,j),re(u.$$.fragment,j),re(k),re(O),re(A.$$.fragment,j),z=!1},d(j){j&&(ae(t),ae(l),ae(d),ae(a),ae(_),ae(S),ae(E)),Me(e,j),Me(i,j),Me(u,j),o[14](null),~v&&D[v].d(j),O&&O.d(j),Me(A,j)}}}function BE(o){let e,t,i,l;function u(a){o[15](a)}let d={style:`https://api.maptiler.com/maps/${o[7]}/style.json?key=${ap}`,hash:!0,images:[{id:"walk_cycle_only",url:"/ltn//filters/walk_cycle_only_icon.gif"},{id:"no_entry",url:"/ltn//filters/no_entry_icon.gif"},{id:"bus_gate",url:"/ltn//filters/bus_gate_icon.gif"},{id:"school_street",url:"/ltn//filters/school_street_icon.gif"},{id:"oneway-arrow",url:lb}],$$slots:{default:[RE]},$$scope:{ctx:o}};return o[0]!==void 0&&(d.map=o[0]),t=new fx({props:d}),Ki.push(()=>Gr(t,"map",u)),t.$on("error",o[16]),{c(){e=oe("div"),Ie(t.$$.fragment),ke(e,"slot","main"),nn(e,"position","relative"),nn(e,"width","100%"),nn(e,"height","100%")},m(a,_){le(a,e,_),Ee(t,e,null),l=!0},p(a,_){const v={};_&128&&(v.style=`https://api.maptiler.com/maps/${a[7]}/style.json?key=${ap}`),_&2097465&&(v.$$scope={dirty:_,ctx:a}),!i&&_&1&&(i=!0,v.map=a[0],Zr(()=>i=!1)),t.$set(v)},i(a){l||(Q(t.$$.fragment,a),l=!0)},o(a){re(t.$$.fragment,a),l=!1},d(a){a&&ae(e),Me(t)}}}function FE(o){let e,t,i,l;return e=new gw({}),i=new L4({props:{$$slots:{main:[BE],left:[wE],top:[bE]},$$scope:{ctx:o}}}),{c(){Ie(e.$$.fragment),t=ze(),Ie(i.$$.fragment)},m(u,d){Ee(e,u,d),le(u,t,d),Ee(i,u,d),l=!0},p(u,[d]){const a={};d&2098175&&(a.$$scope={dirty:d,ctx:u}),i.$set(a)},i(u){l||(Q(e.$$.fragment,u),Q(i.$$.fragment,u),l=!0)},o(u){re(e.$$.fragment,u),re(i.$$.fragment,u),l=!1},d(u){u&&ae(t),Me(e,u),Me(i,u)}}}function OE(o,e,t){let i,l,u,d,a,_,v,k,S;lt(o,xp,Y=>t(11,i=Y)),lt(o,wp,Y=>t(12,l=Y)),lt(o,bp,Y=>t(13,u=Y)),lt(o,Cn,Y=>t(5,d=Y)),lt(o,Vo,Y=>t(6,a=Y)),lt(o,Pu,Y=>t(20,_=Y)),lt(o,lp,Y=>t(7,v=Y)),lt(o,Ht,Y=>t(8,k=Y)),lt(o,wd,Y=>t(9,S=Y));let E=!1;$u(async()=>{await b0(),await r0(),t(4,E=!0);try{(await fetch("/osm/areas.json")).ok&&(Tt(Pu,_=!0,_),console.log("Using local cache, not od2net.org"))}catch{}});let A=null;function z(){a.fitBounds(d.getBounds(),{animate:!1})}let R,D,B;function O(Y){Ki[Y?"unshift":"push"](()=>{B=Y,t(3,B),t(11,i)})}function j(Y){A=Y,t(0,A)}const V=Y=>{console.log(Y.detail.error)};function se(Y){Ki[Y?"unshift":"push"](()=>{D=Y,t(2,D),t(12,l)})}const ce=()=>Tt(wd,S=!0,S);function Z(Y){Ki[Y?"unshift":"push"](()=>{R=Y,t(1,R),t(13,u)})}return o.$$.update=()=>{o.$$.dirty&1&&A&&Vo.set(A),o.$$.dirty&8194&&R&&u&&(t(1,R.innerHTML="",R),R.appendChild(u)),o.$$.dirty&4100&&D&&l&&(t(2,D.innerHTML="",D),D.appendChild(l)),o.$$.dirty&2056&&B&&i&&(t(3,B.innerHTML="",B),B.appendChild(i))},[A,R,D,B,E,d,a,v,k,S,z,i,l,u,O,j,V,se,ce,Z]}class NE extends qt{constructor(e){super(),$t(this,e,OE,FE,Bt,{})}}new NE({target:document.getElementById("app")});
