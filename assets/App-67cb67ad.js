var qk=Object.defineProperty;var Hk=(r,e,t)=>e in r?qk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var rr=(r,e,t)=>(Hk(r,typeof e!="symbol"?e+"":e,t),t);function Wk(r,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in r)){const o=Object.getOwnPropertyDescriptor(n,i);o&&Object.defineProperty(r,i,o.get?o:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function at(){}function zt(r,e){for(const t in e)r[t]=e[t];return r}function Gk(r){return!!r&&(typeof r=="object"||typeof r=="function")&&typeof r.then=="function"}function Hb(r){return r()}function N0(){return Object.create(null)}function cr(r){r.forEach(Hb)}function Wa(r){return typeof r=="function"}function Tt(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let yd;function Sr(r,e){return r===e?!0:(yd||(yd=document.createElement("a")),yd.href=e,r===yd.href)}function Zk(r){return Object.keys(r).length===0}function Lg(r,...e){if(r==null){for(const n of e)n(void 0);return at}const t=r.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function gi(r){let e;return Lg(r,t=>e=t)(),e}function ct(r,e,t){r.$$.on_destroy.push(Lg(e,t))}function vn(r,e,t,n){if(r){const i=Wb(r,e,t,n);return r[0](i)}}function Wb(r,e,t,n){return r[1]&&n?zt(t.ctx.slice(),r[1](n(e))):t.ctx}function bn(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function wn(r,e,t,n,i,o){if(i){const u=Wb(e,t,n,o);r.p(u,i)}}function xn(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function mr(r){const e={};for(const t in r)t[0]!=="$"&&(e[t]=r[t]);return e}function j0(r,e){const t={};e=new Set(e);for(const n in r)!e.has(n)&&n[0]!=="$"&&(t[n]=r[n]);return t}function Ig(r){const e={};for(const t in r)e[t]=!0;return e}function ec(r){return r??""}function ln(r,e,t){return r.set(t),e}function Vm(r){return r&&Wa(r.destroy)?r.destroy:at}const Gb=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function F(r,e){r.appendChild(e)}function W(r,e,t){r.insertBefore(e,t||null)}function H(r){r.parentNode&&r.parentNode.removeChild(r)}function _i(r,e){for(let t=0;t<r.length;t+=1)r[t]&&r[t].d(e)}function U(r){return document.createElement(r)}function ws(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Ee(r){return document.createTextNode(r)}function oe(){return Ee(" ")}function tr(){return Ee("")}function It(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function Ag(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Ef(r){return function(e){return e.stopPropagation(),r.call(this,e)}}function he(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function Vd(r,e){for(const t in e)he(r,t,e[t])}function Kk(r,e,t){const n=new Set;for(let i=0;i<r.length;i+=1)r[i].checked&&n.add(r[i].__value);return t||n.delete(e),Array.from(n)}function Pg(r){let e;return{p(...t){e=t,e.forEach(n=>r.push(n))},r(){e.forEach(t=>r.splice(r.indexOf(t),1))}}}function zl(r){return r===""?null:+r}function Xk(r){return Array.from(r.childNodes)}function St(r,e){e=""+e,r.data!==e&&(r.data=e)}function Zn(r,e){r.value=e??""}function Qe(r,e,t,n){t==null?r.style.removeProperty(e):r.style.setProperty(e,t,n?"important":"")}function Zi(r,e,t){for(let n=0;n<r.options.length;n+=1){const i=r.options[n];if(i.__value===e){i.selected=!0;return}}(!t||e!==void 0)&&(r.selectedIndex=-1)}function Ra(r){const e=r.querySelector(":checked");return e&&e.__value}function Gt(r,e,t){r.classList.toggle(e,!!t)}function Yk(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let jf;function sa(r){jf=r}function lc(){if(!jf)throw new Error("Function called outside component initialization");return jf}function Ss(r){lc().$$.on_mount.push(r)}function ri(r){lc().$$.on_destroy.push(r)}function Ns(){const r=lc();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=Yk(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function rp(r,e){return lc().$$.context.set(r,e),e}function Qf(r){return lc().$$.context.get(r)}function Pn(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const qu=[],dn=[];let Xu=[];const qm=[],Zb=Promise.resolve();let Hm=!1;function Kb(){Hm||(Hm=!0,Zb.then(zg))}function Xb(){return Kb(),Zb}function ys(r){Xu.push(r)}function zn(r){qm.push(r)}const Tm=new Set;let Ou=0;function zg(){if(Ou!==0)return;const r=jf;do{try{for(;Ou<qu.length;){const e=qu[Ou];Ou++,sa(e),Jk(e.$$)}}catch(e){throw qu.length=0,Ou=0,e}for(sa(null),qu.length=0,Ou=0;dn.length;)dn.pop()();for(let e=0;e<Xu.length;e+=1){const t=Xu[e];Tm.has(t)||(Tm.add(t),t())}Xu.length=0}while(qu.length);for(;qm.length;)qm.pop()();Hm=!1,Tm.clear(),sa(r)}function Jk(r){if(r.fragment!==null){r.update(),cr(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(ys)}}function Qk(r){const e=[],t=[];Xu.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Xu=e}const Id=new Set;let Ll;function Xt(){Ll={r:0,c:[],p:Ll}}function Yt(){Ll.r||cr(Ll.c),Ll=Ll.p}function N(r,e){r&&r.i&&(Id.delete(r),r.i(e))}function V(r,e,t,n){if(r&&r.o){if(Id.has(r))return;Id.add(r),Ll.c.push(()=>{Id.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function U0(r,e){const t=e.token={};function n(i,o,u,s){if(e.token!==t)return;e.resolved=s;let d=e.ctx;u!==void 0&&(d=d.slice(),d[u]=s);const p=i&&(e.current=i)(d);let g=!1;e.block&&(e.blocks?e.blocks.forEach((_,x)=>{x!==o&&_&&(Xt(),V(_,1,1,()=>{e.blocks[x]===_&&(e.blocks[x]=null)}),Yt())}):e.block.d(1),p.c(),N(p,1),p.m(e.mount(),e.anchor),g=!0),e.block=p,e.blocks&&(e.blocks[o]=p),g&&zg()}if(Gk(r)){const i=lc();if(r.then(o=>{sa(i),n(e.then,1,e.value,o),sa(null)},o=>{if(sa(i),n(e.catch,2,e.error,o),sa(null),!e.hasCatch)throw o}),e.current!==e.pending)return n(e.pending,0),!0}else{if(e.current!==e.then)return n(e.then,1,e.value,r),!0;e.resolved=r}}function e3(r,e,t){const n=e.slice(),{resolved:i}=r;r.current===r.then&&(n[r.value]=i),r.current===r.catch&&(n[r.error]=i),r.block.p(n,t)}function $n(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function t3(r,e){V(r,1,1,()=>{e.delete(r.key)})}function n3(r,e,t,n,i,o,u,s,d,p,g,_){let x=r.length,C=o.length,M=x;const P={};for(;M--;)P[r[M].key]=M;const A=[],L=new Map,I=new Map,$=[];for(M=C;M--;){const q=_(i,o,M),Y=t(q);let fe=u.get(Y);fe?n&&$.push(()=>fe.p(q,e)):(fe=p(Y,q),fe.c()),L.set(Y,A[M]=fe),Y in P&&I.set(Y,Math.abs(M-P[Y]))}const O=new Set,Z=new Set;function X(q){N(q,1),q.m(s,g),u.set(q.key,q),g=q.first,C--}for(;x&&C;){const q=A[C-1],Y=r[x-1],fe=q.key,Le=Y.key;q===Y?(g=q.first,x--,C--):L.has(Le)?!u.has(fe)||O.has(fe)?X(q):Z.has(Le)?x--:I.get(fe)>I.get(Le)?(Z.add(fe),X(q)):(O.add(Le),x--):(d(Y,u),x--)}for(;x--;){const q=r[x];L.has(q.key)||d(q,u)}for(;C;)X(A[C-1]);return cr($),A}function An(r,e){const t={},n={},i={$$scope:1};let o=r.length;for(;o--;){const u=r[o],s=e[o];if(s){for(const d in u)d in s||(n[d]=1);for(const d in s)i[d]||(t[d]=s[d],i[d]=1);r[o]=s}else for(const d in u)i[d]=1}for(const u in n)u in t||(t[u]=void 0);return t}function xo(r){return typeof r=="object"&&r!==null?r:{}}function Dn(r,e,t){const n=r.$$.props[e];n!==void 0&&(r.$$.bound[n]=t,t(r.$$.ctx[n]))}function ue(r){r&&r.c()}function ae(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),ys(()=>{const o=r.$$.on_mount.map(Hb).filter(Wa);r.$$.on_destroy?r.$$.on_destroy.push(...o):cr(o),r.$$.on_mount=[]}),i.forEach(ys)}function le(r,e){const t=r.$$;t.fragment!==null&&(Qk(t.after_update),cr(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function r3(r,e){r.$$.dirty[0]===-1&&(qu.push(r),Kb(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Et(r,e,t,n,i,o,u=null,s=[-1]){const d=jf;sa(r);const p=r.$$={fragment:null,ctx:[],props:o,update:at,not_equal:i,bound:N0(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:N0(),dirty:s,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(_,x,...C)=>{const M=C.length?C[0]:x;return p.ctx&&i(p.ctx[_],p.ctx[_]=M)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](M),g&&r3(r,_)),x}):[],p.update(),g=!0,cr(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=Xk(e.target);p.fragment&&p.fragment.l(_),_.forEach(H)}else p.fragment&&p.fragment.c();e.intro&&N(r.$$.fragment),ae(r,e.target,e.anchor),zg()}sa(d)}class Lt{constructor(){rr(this,"$$");rr(this,"$$set")}$destroy(){le(this,1),this.$destroy=at}$on(e,t){if(!Wa(t))return at;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!Zk(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const i3="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(i3);const o3="/ltn/assets/arrow-big-up-4ad5891e.png",s3="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",a3="/ltn/assets/logo-97f2d067.svg",Yb="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";function l3(r){let e,t,n,i,o;const u=r[5].default,s=vn(u,r,r[4],null);return{c(){e=U("dialog"),t=U("article"),s&&s.c()},m(d,p){W(d,e,p),F(e,t),s&&s.m(t,null),r[6](e),n=!0,i||(o=[It(e,"click",Ef(r[1])),It(e,"keydown",r[2])],i=!0)},p(d,[p]){s&&s.p&&(!n||p&16)&&wn(s,u,d,d[4],n?bn(u,d[4],p,null):xn(d[4]),null)},i(d){n||(N(s,d),n=!0)},o(d){V(s,d),n=!1},d(d){d&&H(e),s&&s.d(d),r[6](null),i=!1,cr(o)}}}function u3(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,u;function s(g){g.target==u&&t(3,o=!1)}function d(g){(g.key=="Escape"||g.key=="Enter")&&(g.stopPropagation(),t(3,o=!1))}function p(g){dn[g?"unshift":"push"](()=>{u=g,t(0,u)})}return r.$$set=g=>{"show"in g&&t(3,o=g.show),"$$scope"in g&&t(4,i=g.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&u&&(o?u.showModal():u.close())},[u,s,d,o,i,n,p]}class Dg extends Lt{constructor(e){super(),Et(this,e,u3,l3,Tt,{show:3})}}function V0(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function q0(r){let e,t,n=r[1]+"",i,o,u,s=r[2]+"",d,p;return{c(){e=U("tr"),t=U("td"),i=Ee(n),o=oe(),u=U("td"),d=Ee(s),p=oe()},m(g,_){W(g,e,_),F(e,t),F(t,i),F(e,o),F(e,u),F(u,d),F(e,p)},p(g,_){_&1&&n!==(n=g[1]+"")&&St(i,n),_&1&&s!==(s=g[2]+"")&&St(d,s)},d(g){g&&H(e)}}}function c3(r){let e,t,n=$n(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=q0(V0(r,n,o));return{c(){e=U("table"),t=U("tbody");for(let o=0;o<i.length;o+=1)i[o].c();he(e,"class","svelte-lh2o9l")},m(o,u){W(o,e,u),F(e,t);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(t,null)},p(o,[u]){if(u&1){n=$n(Object.entries(o[0]));let s;for(s=0;s<n.length;s+=1){const d=V0(o,n,s);i[s]?i[s].p(d,u):(i[s]=q0(d),i[s].c(),i[s].m(t,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}},i:at,o:at,d(o){o&&H(e),_i(i,o)}}}function f3(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class eh extends Lt{constructor(e){super(),Et(this,e,f3,c3,Tt,{properties:0})}}function ip(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function kr(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}var Jb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qb(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Rg(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var ew={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(Jb,function(){var t={},n={};function i(u,s,d){if(n[u]=d,u==="index"){var p="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",g={};return n.shared(g),n.index(t,g),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([p],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function s(c,a,f,m){return new(f||(f=Promise))(function(b,S){function T(j){try{R(m.next(j))}catch(K){S(K)}}function E(j){try{R(m.throw(j))}catch(K){S(K)}}function R(j){var K;j.done?b(j.value):(K=j.value,K instanceof f?K:new f(function(J){J(K)})).then(T,E)}R((m=m.apply(c,a||[])).next())})}function d(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var p=g;function g(c,a){this.x=c,this.y=a}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x,f=c.y-this.y;return a*a+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=a,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var a=Math.cos(c),f=Math.sin(c),m=f*this.x+a*this.y;return this.x=a*this.x-f*this.y,this.y=m,this},_rotateAround:function(c,a){var f=Math.cos(c),m=Math.sin(c),b=a.y+m*(this.x-a.x)+f*(this.y-a.y);return this.x=a.x+f*(this.x-a.x)-m*(this.y-a.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(c){return c instanceof g?c:Array.isArray(c)?new g(c[0],c[1]):c};var _=d(p),x=C;function C(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}C.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var S=this.sampleCurveDerivativeX(f);if(Math.abs(S)<1e-6)break;f-=b/S}var T=0,E=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?T=f:E=f,f=.5*(E-T)+T;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var M=d(x);let P,A;function L(){return P==null&&(P=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),P}function I(){if(A==null&&(A=!1,L())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let m=0;m<5*5;m++){const b=4*m;a.fillStyle=`rgb(${b},${b+1},${b+2})`,a.fillRect(m%5,Math.floor(m/5),1,1)}const f=a.getImageData(0,0,5,5).data;for(let m=0;m<5*5*4;m++)if(m%4!=3&&f[m]!==m){A=!0;break}}}return A||!1}function $(c,a,f,m){const b=new M(c,a,f,m);return function(S){return b.solve(S)}}const O=$(.25,.1,.25,1);function Z(c,a,f){return Math.min(f,Math.max(a,c))}function X(c,a,f){const m=f-a,b=((c-a)%m+m)%m+a;return b===a?f:b}function q(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}let Y=1;function fe(c,a,f){const m={};for(const b in c)m[b]=a.call(f||this,c[b],b,c);return m}function Le(c,a,f){const m={};for(const b in c)a.call(f||this,c[b],b,c)&&(m[b]=c[b]);return m}function ee(c){return Array.isArray(c)?c.map(ee):typeof c=="object"&&c?fe(c,ee):c}const ie={};function ve(c){ie[c]||(typeof console<"u"&&console.warn(c),ie[c]=!0)}function ye(c,a,f){return(f.y-c.y)*(a.x-c.x)>(a.y-c.y)*(f.x-c.x)}function it(c){let a=0;for(let f,m,b=0,S=c.length,T=S-1;b<S;T=b++)f=c[b],m=c[T],a+=(m.x-f.x)*(f.y+m.y);return a}function Fe(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let Ne=null;function Ae(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ye(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(c,{timestamp:0});try{const T=S==null?void 0:S.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const E=T.startsWith("BGR"),R=new Uint8ClampedArray(m*b*4);if(yield S.copyTo(R,function(j,K,J,se,de){const _e=4*Math.max(-K,0),we=(Math.max(0,J)-J)*se*4+_e,Ce=4*se,Pe=Math.max(0,K),Ge=Math.max(0,J);return{rect:{x:Pe,y:Ge,width:Math.min(j.width,K+se)-Pe,height:Math.min(j.height,J+de)-Ge},layout:[{offset:we,stride:Ce}]}}(c,a,f,m,b)),E)for(let j=0;j<R.length;j+=4){const K=R[j];R[j]=R[j+2],R[j+2]=K}return R}finally{S.close()}})}let ut,pt;const _t="AbortError";function He(){return new Error(_t)}const mt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Pt(c){return mt.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const jt="global-dispatcher";class un extends Error{constructor(a,f,m,b){super(`AJAXError: ${f} (${a}): ${m}`),this.status=a,this.statusText=f,this.url=m,this.body=b}}const nn=()=>Fe(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,rn=function(c,a){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const m=Pt(c.url);if(m)return m(c,a);if(Fe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:jt},a)}if(!(/^file:/.test(f=c.url)||/^file:/.test(nn())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(m,b){return s(this,void 0,void 0,function*(){const S=new Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,cache:m.cache,referrer:nn(),signal:b.signal});m.type==="json"&&S.headers.set("Accept","application/json");const T=yield fetch(S);if(!T.ok){const j=yield T.blob();throw new un(T.status,T.statusText,m.url,j)}let E;E=m.type==="arrayBuffer"||m.type==="image"?T.arrayBuffer():m.type==="json"?T.json():T.text();const R=yield E;if(b.signal.aborted)throw He();return{data:R,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(c,a);if(Fe(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:jt},a)}var f;return function(m,b){return new Promise((S,T)=>{const E=new XMLHttpRequest;E.open(m.method||"GET",m.url,!0),m.type!=="arrayBuffer"&&m.type!=="image"||(E.responseType="arraybuffer");for(const R in m.headers)E.setRequestHeader(R,m.headers[R]);m.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=m.credentials==="include",E.onerror=()=>{T(new Error(E.statusText))},E.onload=()=>{if(!b.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let R=E.response;if(m.type==="json")try{R=JSON.parse(E.response)}catch(j){return void T(j)}S({data:R,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const R=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});T(new un(E.status,E.statusText,m.url,R))}},b.signal.addEventListener("abort",()=>{E.abort(),T(He())}),E.send(m.body)})}(c,a)};function pn(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const a=new URL(c),f=window.location;return a.protocol===f.protocol&&a.host===f.host}function yn(c,a,f){f[c]&&f[c].indexOf(a)!==-1||(f[c]=f[c]||[],f[c].push(a))}function qe(c,a,f){if(f&&f[c]){const m=f[c].indexOf(a);m!==-1&&f[c].splice(m,1)}}class We{constructor(a,f={}){q(this,f),this.type=a}}class Ke extends We{constructor(a,f={}){super("error",q({error:a},f))}}class kt{on(a,f){return this._listeners=this._listeners||{},yn(a,f,this._listeners),this}off(a,f){return qe(a,f,this._listeners),qe(a,f,this._oneTimeListeners),this}once(a,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},yn(a,f,this._oneTimeListeners),this):new Promise(m=>this.once(a,m))}fire(a,f){typeof a=="string"&&(a=new We(a,f||{}));const m=a.type;if(this.listens(m)){a.target=this;const b=this._listeners&&this._listeners[m]?this._listeners[m].slice():[];for(const E of b)E.call(this,a);const S=this._oneTimeListeners&&this._oneTimeListeners[m]?this._oneTimeListeners[m].slice():[];for(const E of S)qe(m,E,this._oneTimeListeners),E.call(this,a);const T=this._eventedParent;T&&(q(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(a))}else a instanceof Ke&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,f){return this._eventedParent=a,this._eventedParentData=f,this}}var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const fn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Xe(c,a){const f={};for(const m in c)m!=="ref"&&(f[m]=c[m]);return fn.forEach(m=>{m in a&&(f[m]=a[m])}),f}function lt(c,a){if(Array.isArray(c)){if(!Array.isArray(a)||c.length!==a.length)return!1;for(let f=0;f<c.length;f++)if(!lt(c[f],a[f]))return!1;return!0}if(typeof c=="object"&&c!==null&&a!==null){if(typeof a!="object"||Object.keys(c).length!==Object.keys(a).length)return!1;for(const f in c)if(!lt(c[f],a[f]))return!1;return!0}return c===a}function Wt(c,a){c.push(a)}function Xn(c,a,f){Wt(f,{command:"addSource",args:[c,a[c]]})}function Wn(c,a,f){Wt(a,{command:"removeSource",args:[c]}),f[c]=!0}function fr(c,a,f,m){Wn(c,f,m),Xn(c,a,f)}function Tr(c,a,f){let m;for(m in c[f])if(Object.prototype.hasOwnProperty.call(c[f],m)&&m!=="data"&&!lt(c[f][m],a[f][m]))return!1;for(m in a[f])if(Object.prototype.hasOwnProperty.call(a[f],m)&&m!=="data"&&!lt(c[f][m],a[f][m]))return!1;return!0}function Cr(c,a,f,m,b,S){c=c||{},a=a||{};for(const T in c)Object.prototype.hasOwnProperty.call(c,T)&&(lt(c[T],a[T])||f.push({command:S,args:[m,T,a[T],b]}));for(const T in a)Object.prototype.hasOwnProperty.call(a,T)&&!Object.prototype.hasOwnProperty.call(c,T)&&(lt(c[T],a[T])||f.push({command:S,args:[m,T,a[T],b]}))}function xi(c){return c.id}function Un(c,a){return c[a.id]=a,c}class xt{constructor(a,f,m,b){this.message=(a?`${a}: `:"")+m,b&&(this.identifier=b),f!=null&&f.__line__&&(this.line=f.__line__)}}function Pr(c,...a){for(const f of a)for(const m in f)c[m]=f[m];return c}class vr extends Error{constructor(a,f){super(f),this.message=f,this.key=a}}class Ri{constructor(a,f=[]){this.parent=a,this.bindings={};for(const[m,b]of f)this.bindings[m]=b}concat(a){return new Ri(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Bn={kind:"null"},Oe={kind:"number"},yt={kind:"string"},bt={kind:"boolean"},Rt={kind:"color"},Qt={kind:"object"},Jt={kind:"value"},yr={kind:"collator"},or={kind:"formatted"},Te={kind:"padding"},ne={kind:"resolvedImage"},ce={kind:"variableAnchorOffsetCollection"};function ge(c,a){return{kind:"array",itemType:c,N:a}}function xe(c){if(c.kind==="array"){const a=xe(c.itemType);return typeof c.N=="number"?`array<${a}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${a}>`}return c.kind}const $e=[Bn,Oe,yt,bt,Rt,or,Qt,ge(Jt),Te,ne,ce];function Be(c,a){if(a.kind==="error")return null;if(c.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Be(c.itemType,a.itemType))&&(typeof c.N!="number"||c.N===a.N))return null}else{if(c.kind===a.kind)return null;if(c.kind==="value"){for(const f of $e)if(!Be(f,a))return null}}return`Expected ${xe(c)} but found ${xe(a)} instead.`}function Ue(c,a){return a.some(f=>f.kind===c.kind)}function ze(c,a){return a.some(f=>f==="null"?c===null:f==="array"?Array.isArray(c):f==="object"?c&&!Array.isArray(c)&&typeof c=="object":f===typeof c)}function re(c,a){return c.kind==="array"&&a.kind==="array"?c.itemType.kind===a.itemType.kind&&typeof c.N=="number":c.kind===a.kind}const Je=.96422,et=.82521,nt=4/29,ht=6/29,Dt=3*ht*ht,en=ht*ht*ht,mn=Math.PI/180,Cn=180/Math.PI;function Nn(c){return(c%=360)<0&&(c+=360),c}function Mr([c,a,f,m]){let b,S;const T=Mn((.2225045*(c=Kr(c))+.7168786*(a=Kr(a))+.0606169*(f=Kr(f)))/1);c===a&&a===f?b=S=T:(b=Mn((.4360747*c+.3850649*a+.1430804*f)/Je),S=Mn((.0139322*c+.0971045*a+.7141733*f)/et));const E=116*T-16;return[E<0?0:E,500*(b-T),200*(T-S),m]}function Kr(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Mn(c){return c>en?Math.pow(c,1/3):c/Dt+nt}function $r([c,a,f,m]){let b=(c+16)/116,S=isNaN(a)?b:b+a/500,T=isNaN(f)?b:b-f/200;return b=1*Ei(b),S=Je*Ei(S),T=et*Ei(T),[ii(3.1338561*S-1.6168667*b-.4906146*T),ii(-.9787684*S+1.9161415*b+.033454*T),ii(.0719453*S-.2289914*b+1.4052427*T),m]}function ii(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Ei(c){return c>ht?c*c*c:Dt*(c-nt)}function Fi(c){return parseInt(c.padEnd(2,c),16)/255}function mi(c,a){return qo(a?c/100:c,0,1)}function qo(c,a,f){return Math.min(Math.max(a,c),f)}function dh(c){return!c.some(Number.isNaN)}const bp={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class sr{constructor(a,f,m,b=1,S=!0){this.r=a,this.g=f,this.b=m,this.a=b,S||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[a,f,m,b]))}static parse(a){if(a instanceof sr)return a;if(typeof a!="string")return;const f=function(m){if((m=m.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=bp[m];if(b){const[T,E,R]=b;return[T/255,E/255,R/255,1]}if(m.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(m)){const T=m.length<6?1:2;let E=1;return[Fi(m.slice(E,E+=T)),Fi(m.slice(E,E+=T)),Fi(m.slice(E,E+=T)),Fi(m.slice(E,E+T)||"ff")]}if(m.startsWith("rgb")){const T=m.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[E,R,j,K,J,se,de,_e,we,Ce,Pe,Ge]=T,De=[K||" ",de||" ",Ce].join("");if(De==="  "||De==="  /"||De===",,"||De===",,,"){const je=[j,se,we].join(""),dt=je==="%%%"?100:je===""?255:0;if(dt){const vt=[qo(+R/dt,0,1),qo(+J/dt,0,1),qo(+_e/dt,0,1),Pe?mi(+Pe,Ge):1];if(dh(vt))return vt}}return}}const S=m.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[T,E,R,j,K,J,se,de,_e]=S,we=[R||" ",K||" ",se].join("");if(we==="  "||we==="  /"||we===",,"||we===",,,"){const Ce=[+E,qo(+j,0,100),qo(+J,0,100),de?mi(+de,_e):1];if(dh(Ce))return function([Pe,Ge,De,je]){function dt(vt){const Ht=(vt+Pe/30)%12,tn=Ge*Math.min(De,1-De);return De-tn*Math.max(-1,Math.min(Ht-3,9-Ht,1))}return Pe=Nn(Pe),Ge/=100,De/=100,[dt(0),dt(8),dt(4),je]}(Ce)}}}(a);return f?new sr(...f,!1):void 0}get rgb(){const{r:a,g:f,b:m,a:b}=this,S=b||1/0;return this.overwriteGetter("rgb",[a/S,f/S,m/S,b])}get hcl(){return this.overwriteGetter("hcl",function(a){const[f,m,b,S]=Mr(a),T=Math.sqrt(m*m+b*b);return[Math.round(1e4*T)?Nn(Math.atan2(b,m)*Cn):NaN,T,f,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Mr(this.rgb))}overwriteGetter(a,f){return Object.defineProperty(this,a,{value:f}),f}toString(){const[a,f,m,b]=this.rgb;return`rgba(${[a,f,m].map(S=>Math.round(255*S)).join(",")},${b})`}}sr.black=new sr(0,0,0,1),sr.white=new sr(1,1,1,1),sr.transparent=new sr(0,0,0,0),sr.red=new sr(1,0,0,1);class cc{constructor(a,f,m){this.sensitivity=a?f?"variant":"case":f?"accent":"base",this.locale=m,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,f){return this.collator.compare(a,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class fc{constructor(a,f,m,b,S){this.text=a,this.image=f,this.scale=m,this.fontStack=b,this.textColor=S}}class Qi{constructor(a){this.sections=a}static fromString(a){return new Qi([new fc(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof Qi?a:Qi.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class Oi{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Oi)return a;if(typeof a=="number")return new Oi([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const f of a)if(typeof f!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new Oi(a)}}toString(){return JSON.stringify(this.values)}}const tl=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ho{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof ho)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let f=0;f<a.length;f+=2){const m=a[f],b=a[f+1];if(typeof m!="string"||!tl.has(m)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new ho(a)}}toString(){return JSON.stringify(this.values)}}class po{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new po({name:a,available:!1}):null}}function da(c,a,f,m){return typeof c=="number"&&c>=0&&c<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof f=="number"&&f>=0&&f<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:`Invalid rgba value [${[c,a,f,m].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof m=="number"?[c,a,f,m]:[c,a,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Nl(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof sr||c instanceof cc||c instanceof Qi||c instanceof Oi||c instanceof ho||c instanceof po)return!0;if(Array.isArray(c)){for(const a of c)if(!Nl(a))return!1;return!0}if(typeof c=="object"){for(const a in c)if(!Nl(c[a]))return!1;return!0}return!1}function Xr(c){if(c===null)return Bn;if(typeof c=="string")return yt;if(typeof c=="boolean")return bt;if(typeof c=="number")return Oe;if(c instanceof sr)return Rt;if(c instanceof cc)return yr;if(c instanceof Qi)return or;if(c instanceof Oi)return Te;if(c instanceof ho)return ce;if(c instanceof po)return ne;if(Array.isArray(c)){const a=c.length;let f;for(const m of c){const b=Xr(m);if(f){if(f===b)continue;f=Jt;break}f=b}return ge(f||Jt,a)}return Qt}function nl(c){const a=typeof c;return c===null?"":a==="string"||a==="number"||a==="boolean"?String(c):c instanceof sr||c instanceof Qi||c instanceof Oi||c instanceof ho||c instanceof po?c.toString():JSON.stringify(c)}class Ts{constructor(a,f){this.type=a,this.value=f}static parse(a,f){if(a.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!Nl(a[1]))return f.error("invalid value");const m=a[1];let b=Xr(m);const S=f.expectedType;return b.kind!=="array"||b.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(b=S),new Ts(b,m)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class zr{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const jl={string:yt,number:Oe,boolean:bt,object:Qt};class eo{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");let m,b=1;const S=a[0];if(S==="array"){let E,R;if(a.length>2){const j=a[1];if(typeof j!="string"||!(j in jl)||j==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);E=jl[j],b++}else E=Jt;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return f.error('The length argument to "array" must be a positive integer literal',2);R=a[2],b++}m=ge(E,R)}else{if(!jl[S])throw new Error(`Types doesn't contain name = ${S}`);m=jl[S]}const T=[];for(;b<a.length;b++){const E=f.parse(a[b],b,Jt);if(!E)return null;T.push(E)}return new eo(m,T)}evaluate(a){for(let f=0;f<this.args.length;f++){const m=this.args[f].evaluate(a);if(!Be(this.type,Xr(m)))return m;if(f===this.args.length-1)throw new zr(`Expected value to be of type ${xe(this.type)}, but found ${xe(Xr(m))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const Ul={"to-boolean":bt,"to-color":Rt,"to-number":Oe,"to-string":yt};class Ho{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[0];if(!Ul[m])throw new Error(`Can't parse ${m} as it is not part of the known types`);if((m==="to-boolean"||m==="to-string")&&a.length!==2)return f.error("Expected one argument.");const b=Ul[m],S=[];for(let T=1;T<a.length;T++){const E=f.parse(a[T],T,Jt);if(!E)return null;S.push(E)}return new Ho(b,S)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let f,m;for(const b of this.args){if(f=b.evaluate(a),m=null,f instanceof sr)return f;if(typeof f=="string"){const S=a.parseColor(f);if(S)return S}else if(Array.isArray(f)&&(m=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:da(f[0],f[1],f[2],f[3]),!m))return new sr(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new zr(m||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const m of this.args){f=m.evaluate(a);const b=Oi.parse(f);if(b)return b}throw new zr(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const m of this.args){f=m.evaluate(a);const b=ho.parse(f);if(b)return b}throw new zr(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const m of this.args){if(f=m.evaluate(a),f===null)return 0;const b=Number(f);if(!isNaN(b))return b}throw new zr(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return Qi.fromString(nl(this.args[0].evaluate(a)));case"resolvedImage":return po.fromString(nl(this.args[0].evaluate(a)));default:return nl(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const rl=["Unknown","Point","LineString","Polygon"];class ar{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?rl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let f=this._parseColorCache[a];return f||(f=this._parseColorCache[a]=sr.parse(a)),f}}class Vl{constructor(a,f,m=[],b,S=new Ri,T=[]){this.registry=a,this.path=m,this.key=m.map(E=>`[${E}]`).join(""),this.scope=S,this.errors=T,this.expectedType=b,this._isConstant=f}parse(a,f,m,b,S={}){return f?this.concat(f,m,b)._parse(a,S):this._parse(a,S)}_parse(a,f){function m(b,S,T){return T==="assert"?new eo(S,[b]):T==="coerce"?new Ho(S,[b]):b}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=a[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[b];if(S){let T=S.parse(a,this);if(!T)return null;if(this.expectedType){const E=this.expectedType,R=T.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||R.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(E.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(E,R))return null}else T=m(T,E,f.typeAnnotation||"coerce");else T=m(T,E,f.typeAnnotation||"coerce");else T=m(T,E,f.typeAnnotation||"coerce");else T=m(T,E,f.typeAnnotation||"assert")}if(!(T instanceof Ts)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const E=new ar;try{T=new Ts(T.type,T.evaluate(E))}catch(R){return this.error(R.message),null}}return T}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,f,m){const b=typeof a=="number"?this.path.concat(a):this.path,S=m?this.scope.concat(m):this.scope;return new Vl(this.registry,this._isConstant,b,f||null,S,this.errors)}error(a,...f){const m=`${this.key}${f.map(b=>`[${b}]`).join("")}`;this.errors.push(new vr(m,a))}checkSubtype(a,f){const m=Be(a,f);return m&&this.error(m),m}}class pa{constructor(a,f,m){this.type=yr,this.locale=m,this.caseSensitive=a,this.diacriticSensitive=f}static parse(a,f){if(a.length!==2)return f.error("Expected one argument.");const m=a[1];if(typeof m!="object"||Array.isArray(m))return f.error("Collator options argument must be an object.");const b=f.parse(m["case-sensitive"]!==void 0&&m["case-sensitive"],1,bt);if(!b)return null;const S=f.parse(m["diacritic-sensitive"]!==void 0&&m["diacritic-sensitive"],1,bt);if(!S)return null;let T=null;return m.locale&&(T=f.parse(m.locale,1,yt),!T)?null:new pa(b,S,T)}evaluate(a){return new cc(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}const Cs=8192;function ql(c,a){c[0]=Math.min(c[0],a[0]),c[1]=Math.min(c[1],a[1]),c[2]=Math.max(c[2],a[0]),c[3]=Math.max(c[3],a[1])}function il(c,a){return!(c[0]<=a[0]||c[2]>=a[2]||c[1]<=a[1]||c[3]>=a[3])}function wp(c,a){const f=(180+c[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,b=Math.pow(2,a.z);return[Math.round(f*b*Cs),Math.round(m*b*Cs)]}function ph(c,a,f){const m=c[0]-a[0],b=c[1]-a[1],S=c[0]-f[0],T=c[1]-f[1];return m*T-S*b==0&&m*S<=0&&b*T<=0}function Hl(c,a){let f=!1;for(let T=0,E=a.length;T<E;T++){const R=a[T];for(let j=0,K=R.length;j<K-1;j++){if(ph(c,R[j],R[j+1]))return!1;(b=R[j])[1]>(m=c)[1]!=(S=R[j+1])[1]>m[1]&&m[0]<(S[0]-b[0])*(m[1]-b[1])/(S[1]-b[1])+b[0]&&(f=!f)}}var m,b,S;return f}function xp(c,a){for(let f=0;f<a.length;f++)if(Hl(c,a[f]))return!0;return!1}function mh(c,a,f,m){const b=m[0]-f[0],S=m[1]-f[1],T=(c[0]-f[0])*S-b*(c[1]-f[1]),E=(a[0]-f[0])*S-b*(a[1]-f[1]);return T>0&&E<0||T<0&&E>0}function kp(c,a,f){for(const j of f)for(let K=0;K<j.length-1;++K)if((E=[(T=j[K+1])[0]-(S=j[K])[0],T[1]-S[1]])[0]*(R=[(b=a)[0]-(m=c)[0],b[1]-m[1]])[1]-E[1]*R[0]!=0&&mh(m,b,S,T)&&mh(S,T,m,b))return!0;var m,b,S,T,E,R;return!1}function gh(c,a){for(let f=0;f<c.length;++f)if(!Hl(c[f],a))return!1;for(let f=0;f<c.length-1;++f)if(kp(c[f],c[f+1],a))return!1;return!0}function _h(c,a){for(let f=0;f<a.length;f++)if(gh(c,a[f]))return!0;return!1}function Wl(c,a,f){const m=[];for(let b=0;b<c.length;b++){const S=[];for(let T=0;T<c[b].length;T++){const E=wp(c[b][T],f);ql(a,E),S.push(E)}m.push(S)}return m}function yh(c,a,f){const m=[];for(let b=0;b<c.length;b++){const S=Wl(c[b],a,f);m.push(S)}return m}function vh(c,a,f,m){if(c[0]<f[0]||c[0]>f[2]){const b=.5*m;let S=c[0]-f[0]>b?-m:f[0]-c[0]>b?m:0;S===0&&(S=c[0]-f[2]>b?-m:f[2]-c[0]>b?m:0),c[0]+=S}ql(a,c)}function Gl(c,a,f,m){const b=Math.pow(2,m.z)*Cs,S=[m.x*Cs,m.y*Cs],T=[];for(const E of c)for(const R of E){const j=[R.x+S[0],R.y+S[1]];vh(j,a,f,b),T.push(j)}return T}function bh(c,a,f,m){const b=Math.pow(2,m.z)*Cs,S=[m.x*Cs,m.y*Cs],T=[];for(const R of c){const j=[];for(const K of R){const J=[K.x+S[0],K.y+S[1]];ql(a,J),j.push(J)}T.push(j)}if(a[2]-a[0]<=b/2){(E=a)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const R of T)for(const j of R)vh(j,a,f,b)}var E;return T}class Us{constructor(a,f){this.type=bt,this.geojson=a,this.geometries=f}static parse(a,f){if(a.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(Nl(a[1])){const m=a[1];if(m.type==="FeatureCollection"){const b=[];for(const S of m.features){const{type:T,coordinates:E}=S.geometry;T==="Polygon"&&b.push(E),T==="MultiPolygon"&&b.push(...E)}if(b.length)return new Us(m,{type:"MultiPolygon",coordinates:b})}else if(m.type==="Feature"){const b=m.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Us(m,m.geometry)}else if(m.type==="Polygon"||m.type==="MultiPolygon")return new Us(m,m)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=f.canonicalID();if(m.type==="Polygon"){const E=Wl(m.coordinates,S,T),R=Gl(f.geometry(),b,S,T);if(!il(b,S))return!1;for(const j of R)if(!Hl(j,E))return!1}if(m.type==="MultiPolygon"){const E=yh(m.coordinates,S,T),R=Gl(f.geometry(),b,S,T);if(!il(b,S))return!1;for(const j of R)if(!xp(j,E))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(f,m){const b=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=f.canonicalID();if(m.type==="Polygon"){const E=Wl(m.coordinates,S,T),R=bh(f.geometry(),b,S,T);if(!il(b,S))return!1;for(const j of R)if(!gh(j,E))return!1}if(m.type==="MultiPolygon"){const E=yh(m.coordinates,S,T),R=bh(f.geometry(),b,S,T);if(!il(b,S))return!1;for(const j of R)if(!_h(j,E))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Zl{constructor(a,f){this.type=f.type,this.name=a,this.boundExpression=f}static parse(a,f){if(a.length!==2||typeof a[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const m=a[1];return f.scope.has(m)?new Zl(m,f.scope.get(m)):f.error(`Unknown variable "${m}". Make sure "${m}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class to{constructor(a,f,m,b){this.name=a,this.type=f,this._evaluate=m,this.args=b}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,f){const m=a[0],b=to.definitions[m];if(!b)return f.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(b)?b[0]:b.type,T=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,E=T.filter(([j])=>!Array.isArray(j)||j.length===a.length-1);let R=null;for(const[j,K]of E){R=new Vl(f.registry,ol,f.path,null,f.scope);const J=[];let se=!1;for(let de=1;de<a.length;de++){const _e=a[de],we=Array.isArray(j)?j[de-1]:j.type,Ce=R.parse(_e,1+J.length,we);if(!Ce){se=!0;break}J.push(Ce)}if(!se)if(Array.isArray(j)&&j.length!==J.length)R.error(`Expected ${j.length} arguments, but found ${J.length} instead.`);else{for(let de=0;de<J.length;de++){const _e=Array.isArray(j)?j[de]:j.type,we=J[de];R.concat(de+1).checkSubtype(_e,we.type)}if(R.errors.length===0)return new to(m,S,K,J)}}if(E.length===1)f.errors.push(...R.errors);else{const j=(E.length?E:T).map(([J])=>{return se=J,Array.isArray(se)?`(${se.map(xe).join(", ")})`:`(${xe(se.type)}...)`;var se}).join(" | "),K=[];for(let J=1;J<a.length;J++){const se=f.parse(a[J],1+K.length);if(!se)return null;K.push(xe(se.type))}f.error(`Expected arguments of type ${j}, but found (${K.join(", ")}) instead.`)}return null}static register(a,f){to.definitions=f;for(const m in f)a[m]=to}}function ol(c){if(c instanceof Zl)return ol(c.boundExpression);if(c instanceof to&&c.name==="error"||c instanceof pa||c instanceof Us)return!1;const a=c instanceof Ho||c instanceof eo;let f=!0;return c.eachChild(m=>{f=a?f&&ol(m):f&&m instanceof Ts}),!!f&&Kl(c)&&al(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Kl(c){if(c instanceof to&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Us)return!1;let a=!0;return c.eachChild(f=>{a&&!Kl(f)&&(a=!1)}),a}function sl(c){if(c instanceof to&&c.name==="feature-state")return!1;let a=!0;return c.eachChild(f=>{a&&!sl(f)&&(a=!1)}),a}function al(c,a){if(c instanceof to&&a.indexOf(c.name)>=0)return!1;let f=!0;return c.eachChild(m=>{f&&!al(m,a)&&(f=!1)}),f}function ll(c,a){const f=c.length-1;let m,b,S=0,T=f,E=0;for(;S<=T;)if(E=Math.floor((S+T)/2),m=c[E],b=c[E+1],m<=a){if(E===f||a<b)return E;S=E+1}else{if(!(m>a))throw new zr("Input is not a number.");T=E-1}return 0}class ul{constructor(a,f,m){this.type=a,this.input=f,this.labels=[],this.outputs=[];for(const[b,S]of m)this.labels.push(b),this.outputs.push(S)}static parse(a,f){if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");const m=f.parse(a[1],1,Oe);if(!m)return null;const b=[];let S=null;f.expectedType&&f.expectedType.kind!=="value"&&(S=f.expectedType);for(let T=1;T<a.length;T+=2){const E=T===1?-1/0:a[T],R=a[T+1],j=T,K=T+1;if(typeof E!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(b.length&&b[b.length-1][0]>=E)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',j);const J=f.parse(R,K,S);if(!J)return null;S=S||J.type,b.push([E,J])}return new ul(S,m,b)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const S=f.length;return b>=f[S-1]?m[S-1].evaluate(a):m[ll(f,b)].evaluate(a)}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Sp(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Tp=wh;function wh(c,a,f,m){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(m-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=f,this.p2y=m}wh.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,m=0;m<8;m++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<a)return f;var S=this.sampleCurveDerivativeX(f);if(Math.abs(S)<1e-6)break;f-=b/S}var T=0,E=1;for(f=c,m=0;m<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<a));m++)c>b?T=f:E=f,f=.5*(E-T)+T;return f},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var Cp=Sp(Tp);function Vs(c,a,f){return c+f*(a-c)}function Xl(c,a,f){return c.map((m,b)=>Vs(m,a[b],f))}const Li={number:Vs,color:function(c,a,f,m="rgb"){switch(m){case"rgb":{const[b,S,T,E]=Xl(c.rgb,a.rgb,f);return new sr(b,S,T,E,!1)}case"hcl":{const[b,S,T,E]=c.hcl,[R,j,K,J]=a.hcl;let se,de;if(isNaN(b)||isNaN(R))isNaN(b)?isNaN(R)?se=NaN:(se=R,T!==1&&T!==0||(de=j)):(se=b,K!==1&&K!==0||(de=S));else{let Ge=R-b;R>b&&Ge>180?Ge-=360:R<b&&b-R>180&&(Ge+=360),se=b+f*Ge}const[_e,we,Ce,Pe]=function([Ge,De,je,dt]){return Ge=isNaN(Ge)?0:Ge*mn,$r([je,Math.cos(Ge)*De,Math.sin(Ge)*De,dt])}([se,de??Vs(S,j,f),Vs(T,K,f),Vs(E,J,f)]);return new sr(_e,we,Ce,Pe,!1)}case"lab":{const[b,S,T,E]=$r(Xl(c.lab,a.lab,f));return new sr(b,S,T,E,!1)}}},array:Xl,padding:function(c,a,f){return new Oi(Xl(c.values,a.values,f))},variableAnchorOffsetCollection:function(c,a,f){const m=c.values,b=a.values;if(m.length!==b.length)throw new zr(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${a.toString()}`);const S=[];for(let T=0;T<m.length;T+=2){if(m[T]!==b[T])throw new zr(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${m[T]}, to[${T}]: ${b[T]}`);S.push(m[T]);const[E,R]=m[T+1],[j,K]=b[T+1];S.push([Vs(E,j,f),Vs(R,K,f)])}return new ho(S)}};class ki{constructor(a,f,m,b,S){this.type=a,this.operator=f,this.interpolation=m,this.input=b,this.labels=[],this.outputs=[];for(const[T,E]of S)this.labels.push(T),this.outputs.push(E)}static interpolationFactor(a,f,m,b){let S=0;if(a.name==="exponential")S=Yn(f,a.base,m,b);else if(a.name==="linear")S=Yn(f,1,m,b);else if(a.name==="cubic-bezier"){const T=a.controlPoints;S=new Cp(T[0],T[1],T[2],T[3]).solve(Yn(f,1,m,b))}return S}static parse(a,f){let[m,b,S,...T]=a;if(!Array.isArray(b)||b.length===0)return f.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const j=b[1];if(typeof j!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:j}}else{if(b[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const j=b.slice(1);if(j.length!==4||j.some(K=>typeof K!="number"||K<0||K>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:j}}}if(a.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(S=f.parse(S,2,Oe),!S)return null;const E=[];let R=null;m==="interpolate-hcl"||m==="interpolate-lab"?R=Rt:f.expectedType&&f.expectedType.kind!=="value"&&(R=f.expectedType);for(let j=0;j<T.length;j+=2){const K=T[j],J=T[j+1],se=j+3,de=j+4;if(typeof K!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(E.length&&E[E.length-1][0]>=K)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);const _e=f.parse(J,de,R);if(!_e)return null;R=R||_e.type,E.push([K,_e])}return re(R,Oe)||re(R,Rt)||re(R,Te)||re(R,ce)||re(R,ge(Oe))?new ki(R,m,b,S,E):f.error(`Type ${xe(R)} is not interpolatable.`)}evaluate(a){const f=this.labels,m=this.outputs;if(f.length===1)return m[0].evaluate(a);const b=this.input.evaluate(a);if(b<=f[0])return m[0].evaluate(a);const S=f.length;if(b>=f[S-1])return m[S-1].evaluate(a);const T=ll(f,b),E=ki.interpolationFactor(this.interpolation,b,f[T],f[T+1]),R=m[T].evaluate(a),j=m[T+1].evaluate(a);switch(this.operator){case"interpolate":return Li[this.type.kind](R,j,E);case"interpolate-hcl":return Li.color(R,j,E,"hcl");case"interpolate-lab":return Li.color(R,j,E,"lab")}}eachChild(a){a(this.input);for(const f of this.outputs)a(f)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Yn(c,a,f,m){const b=m-f,S=c-f;return b===0?0:a===1?S/b:(Math.pow(a,S)-1)/(Math.pow(a,b)-1)}class Yl{constructor(a,f){this.type=a,this.args=f}static parse(a,f){if(a.length<2)return f.error("Expectected at least one argument.");let m=null;const b=f.expectedType;b&&b.kind!=="value"&&(m=b);const S=[];for(const E of a.slice(1)){const R=f.parse(E,1+S.length,m,void 0,{typeAnnotation:"omit"});if(!R)return null;m=m||R.type,S.push(R)}if(!m)throw new Error("No output type");const T=b&&S.some(E=>Be(b,E.type));return new Yl(T?Jt:m,S)}evaluate(a){let f,m=null,b=0;for(const S of this.args)if(b++,m=S.evaluate(a),m&&m instanceof po&&!m.available&&(f||(f=m.name),m=null,b===this.args.length&&(m=f)),m!==null)break;return m}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}class Jl{constructor(a,f){this.type=f.type,this.bindings=[].concat(a),this.result=f}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const f of this.bindings)a(f[1]);a(this.result)}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const m=[];for(let S=1;S<a.length-1;S+=2){const T=a[S];if(typeof T!="string")return f.error(`Expected string, but found ${typeof T} instead.`,S);if(/[^a-zA-Z0-9_]/.test(T))return f.error("Variable names must contain only alphanumeric characters or '_'.",S);const E=f.parse(a[S+1],S+1);if(!E)return null;m.push([T,E])}const b=f.parse(a[a.length-1],a.length-1,f.expectedType,m);return b?new Jl(m,b):null}outputDefined(){return this.result.outputDefined()}}class hc{constructor(a,f,m){this.type=a,this.index=f,this.input=m}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Oe),b=f.parse(a[2],2,ge(f.expectedType||Jt));return m&&b?new hc(b.type.itemType,m,b):null}evaluate(a){const f=this.index.evaluate(a),m=this.input.evaluate(a);if(f<0)throw new zr(`Array index out of bounds: ${f} < 0.`);if(f>=m.length)throw new zr(`Array index out of bounds: ${f} > ${m.length-1}.`);if(f!==Math.floor(f))throw new zr(`Array index must be an integer, but found ${f} instead.`);return m[f]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class dc{constructor(a,f){this.type=bt,this.needle=a,this.haystack=f}static parse(a,f){if(a.length!==3)return f.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Jt),b=f.parse(a[2],2,Jt);return m&&b?Ue(m.type,[bt,yt,Oe,Bn,Jt])?new dc(m,b):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(m.type)} instead`):null}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!m)return!1;if(!ze(f,["boolean","string","number","null"]))throw new zr(`Expected first argument to be of type boolean, string, number or null, but found ${xe(Xr(f))} instead.`);if(!ze(m,["string","array"]))throw new zr(`Expected second argument to be of type array or string, but found ${xe(Xr(m))} instead.`);return m.indexOf(f)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class Ql{constructor(a,f,m){this.type=Oe,this.needle=a,this.haystack=f,this.fromIndex=m}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Jt),b=f.parse(a[2],2,Jt);if(!m||!b)return null;if(!Ue(m.type,[bt,yt,Oe,Bn,Jt]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${xe(m.type)} instead`);if(a.length===4){const S=f.parse(a[3],3,Oe);return S?new Ql(m,b,S):null}return new Ql(m,b)}evaluate(a){const f=this.needle.evaluate(a),m=this.haystack.evaluate(a);if(!ze(f,["boolean","string","number","null"]))throw new zr(`Expected first argument to be of type boolean, string, number or null, but found ${xe(Xr(f))} instead.`);if(!ze(m,["string","array"]))throw new zr(`Expected second argument to be of type array or string, but found ${xe(Xr(m))} instead.`);if(this.fromIndex){const b=this.fromIndex.evaluate(a);return m.indexOf(f,b)}return m.indexOf(f)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class pc{constructor(a,f,m,b,S,T){this.inputType=a,this.type=f,this.input=m,this.cases=b,this.outputs=S,this.otherwise=T}static parse(a,f){if(a.length<5)return f.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return f.error("Expected an even number of arguments.");let m,b;f.expectedType&&f.expectedType.kind!=="value"&&(b=f.expectedType);const S={},T=[];for(let j=2;j<a.length-1;j+=2){let K=a[j];const J=a[j+1];Array.isArray(K)||(K=[K]);const se=f.concat(j);if(K.length===0)return se.error("Expected at least one branch label.");for(const _e of K){if(typeof _e!="number"&&typeof _e!="string")return se.error("Branch labels must be numbers or strings.");if(typeof _e=="number"&&Math.abs(_e)>Number.MAX_SAFE_INTEGER)return se.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof _e=="number"&&Math.floor(_e)!==_e)return se.error("Numeric branch labels must be integer values.");if(m){if(se.checkSubtype(m,Xr(_e)))return null}else m=Xr(_e);if(S[String(_e)]!==void 0)return se.error("Branch labels must be unique.");S[String(_e)]=T.length}const de=f.parse(J,j,b);if(!de)return null;b=b||de.type,T.push(de)}const E=f.parse(a[1],1,Jt);if(!E)return null;const R=f.parse(a[a.length-1],a.length-1,b);return R?E.type.kind!=="value"&&f.concat(1).checkSubtype(m,E.type)?null:new pc(m,b,E,S,T,R):null}evaluate(a){const f=this.input.evaluate(a);return(Xr(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class mc{constructor(a,f,m){this.type=a,this.branches=f,this.otherwise=m}static parse(a,f){if(a.length<4)return f.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return f.error("Expected an odd number of arguments.");let m;f.expectedType&&f.expectedType.kind!=="value"&&(m=f.expectedType);const b=[];for(let T=1;T<a.length-1;T+=2){const E=f.parse(a[T],T,bt);if(!E)return null;const R=f.parse(a[T+1],T+1,m);if(!R)return null;b.push([E,R]),m=m||R.type}const S=f.parse(a[a.length-1],a.length-1,m);if(!S)return null;if(!m)throw new Error("Can't infer output type");return new mc(m,b,S)}evaluate(a){for(const[f,m]of this.branches)if(f.evaluate(a))return m.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[f,m]of this.branches)a(f),a(m);a(this.otherwise)}outputDefined(){return this.branches.every(([a,f])=>f.outputDefined())&&this.otherwise.outputDefined()}}class eu{constructor(a,f,m,b){this.type=a,this.input=f,this.beginIndex=m,this.endIndex=b}static parse(a,f){if(a.length<=2||a.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const m=f.parse(a[1],1,Jt),b=f.parse(a[2],2,Oe);if(!m||!b)return null;if(!Ue(m.type,[ge(Jt),yt,Jt]))return f.error(`Expected first argument to be of type array or string, but found ${xe(m.type)} instead`);if(a.length===4){const S=f.parse(a[3],3,Oe);return S?new eu(m.type,m,b,S):null}return new eu(m.type,m,b)}evaluate(a){const f=this.input.evaluate(a),m=this.beginIndex.evaluate(a);if(!ze(f,["string","array"]))throw new zr(`Expected first argument to be of type array or string, but found ${xe(Xr(f))} instead.`);if(this.endIndex){const b=this.endIndex.evaluate(a);return f.slice(m,b)}return f.slice(m)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function xh(c,a){return c==="=="||c==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function kh(c,a,f,m){return m.compare(a,f)===0}function ma(c,a,f){const m=c!=="=="&&c!=="!=";return class tw{constructor(S,T,E){this.type=bt,this.lhs=S,this.rhs=T,this.collator=E,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}static parse(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");const E=S[0];let R=T.parse(S[1],1,Jt);if(!R)return null;if(!xh(E,R.type))return T.concat(1).error(`"${E}" comparisons are not supported for type '${xe(R.type)}'.`);let j=T.parse(S[2],2,Jt);if(!j)return null;if(!xh(E,j.type))return T.concat(2).error(`"${E}" comparisons are not supported for type '${xe(j.type)}'.`);if(R.type.kind!==j.type.kind&&R.type.kind!=="value"&&j.type.kind!=="value")return T.error(`Cannot compare types '${xe(R.type)}' and '${xe(j.type)}'.`);m&&(R.type.kind==="value"&&j.type.kind!=="value"?R=new eo(j.type,[R]):R.type.kind!=="value"&&j.type.kind==="value"&&(j=new eo(R.type,[j])));let K=null;if(S.length===4){if(R.type.kind!=="string"&&j.type.kind!=="string"&&R.type.kind!=="value"&&j.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(K=T.parse(S[3],3,yr),!K)return null}return new tw(R,j,K)}evaluate(S){const T=this.lhs.evaluate(S),E=this.rhs.evaluate(S);if(m&&this.hasUntypedArgument){const R=Xr(T),j=Xr(E);if(R.kind!==j.kind||R.kind!=="string"&&R.kind!=="number")throw new zr(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${R.kind}, ${j.kind}) instead.`)}if(this.collator&&!m&&this.hasUntypedArgument){const R=Xr(T),j=Xr(E);if(R.kind!=="string"||j.kind!=="string")return a(S,T,E)}return this.collator?f(S,T,E,this.collator.evaluate(S)):a(S,T,E)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const Mp=ma("==",function(c,a,f){return a===f},kh),Ep=ma("!=",function(c,a,f){return a!==f},function(c,a,f,m){return!kh(0,a,f,m)}),Lp=ma("<",function(c,a,f){return a<f},function(c,a,f,m){return m.compare(a,f)<0}),Ip=ma(">",function(c,a,f){return a>f},function(c,a,f,m){return m.compare(a,f)>0}),Ap=ma("<=",function(c,a,f){return a<=f},function(c,a,f,m){return m.compare(a,f)<=0}),Pp=ma(">=",function(c,a,f){return a>=f},function(c,a,f,m){return m.compare(a,f)>=0});class gc{constructor(a,f,m,b,S){this.type=yt,this.number=a,this.locale=f,this.currency=m,this.minFractionDigits=b,this.maxFractionDigits=S}static parse(a,f){if(a.length!==3)return f.error("Expected two arguments.");const m=f.parse(a[1],1,Oe);if(!m)return null;const b=a[2];if(typeof b!="object"||Array.isArray(b))return f.error("NumberFormat options argument must be an object.");let S=null;if(b.locale&&(S=f.parse(b.locale,1,yt),!S))return null;let T=null;if(b.currency&&(T=f.parse(b.currency,1,yt),!T))return null;let E=null;if(b["min-fraction-digits"]&&(E=f.parse(b["min-fraction-digits"],1,Oe),!E))return null;let R=null;return b["max-fraction-digits"]&&(R=f.parse(b["max-fraction-digits"],1,Oe),!R)?null:new gc(m,S,T,E,R)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class tu{constructor(a){this.type=or,this.sections=a}static parse(a,f){if(a.length<2)return f.error("Expected at least one argument.");const m=a[1];if(!Array.isArray(m)&&typeof m=="object")return f.error("First argument must be an image or text section.");const b=[];let S=!1;for(let T=1;T<=a.length-1;++T){const E=a[T];if(S&&typeof E=="object"&&!Array.isArray(E)){S=!1;let R=null;if(E["font-scale"]&&(R=f.parse(E["font-scale"],1,Oe),!R))return null;let j=null;if(E["text-font"]&&(j=f.parse(E["text-font"],1,ge(yt)),!j))return null;let K=null;if(E["text-color"]&&(K=f.parse(E["text-color"],1,Rt),!K))return null;const J=b[b.length-1];J.scale=R,J.font=j,J.textColor=K}else{const R=f.parse(a[T],1,Jt);if(!R)return null;const j=R.type.kind;if(j!=="string"&&j!=="value"&&j!=="null"&&j!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,b.push({content:R,scale:null,font:null,textColor:null})}}return new tu(b)}evaluate(a){return new Qi(this.sections.map(f=>{const m=f.content.evaluate(a);return Xr(m)===ne?new fc("",m,null,null,null):new fc(nl(m),null,f.scale?f.scale.evaluate(a):null,f.font?f.font.evaluate(a).join(","):null,f.textColor?f.textColor.evaluate(a):null)}))}eachChild(a){for(const f of this.sections)a(f.content),f.scale&&a(f.scale),f.font&&a(f.font),f.textColor&&a(f.textColor)}outputDefined(){return!1}}class _c{constructor(a){this.type=ne,this.input=a}static parse(a,f){if(a.length!==2)return f.error("Expected two arguments.");const m=f.parse(a[1],1,yt);return m?new _c(m):f.error("No image name provided.")}evaluate(a){const f=this.input.evaluate(a),m=po.fromString(f);return m&&a.availableImages&&(m.available=a.availableImages.indexOf(f)>-1),m}eachChild(a){a(this.input)}outputDefined(){return!1}}class yc{constructor(a){this.type=Oe,this.input=a}static parse(a,f){if(a.length!==2)return f.error(`Expected 1 argument, but found ${a.length-1} instead.`);const m=f.parse(a[1],1);return m?m.type.kind!=="array"&&m.type.kind!=="string"&&m.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${xe(m.type)} instead.`):new yc(m):null}evaluate(a){const f=this.input.evaluate(a);if(typeof f=="string"||Array.isArray(f))return f.length;throw new zr(`Expected value to be of type string or array, but found ${xe(Xr(f))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const ga={"==":Mp,"!=":Ep,">":Ip,"<":Lp,">=":Pp,"<=":Ap,array:eo,at:hc,boolean:eo,case:mc,coalesce:Yl,collator:pa,format:tu,image:_c,in:dc,"index-of":Ql,interpolate:ki,"interpolate-hcl":ki,"interpolate-lab":ki,length:yc,let:Jl,literal:Ts,match:pc,number:eo,"number-format":gc,object:eo,slice:eu,step:ul,string:eo,"to-boolean":Ho,"to-color":Ho,"to-number":Ho,"to-string":Ho,var:Zl,within:Us};function Sh(c,[a,f,m,b]){a=a.evaluate(c),f=f.evaluate(c),m=m.evaluate(c);const S=b?b.evaluate(c):1,T=da(a,f,m,S);if(T)throw new zr(T);return new sr(a/255,f/255,m/255,S,!1)}function Th(c,a){return c in a}function vc(c,a){const f=a[c];return f===void 0?null:f}function qs(c){return{type:c}}function Ch(c){return{result:"success",value:c}}function _a(c){return{result:"error",value:c}}function ya(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Mh(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function bc(c){return!!c.expression&&c.expression.interpolated}function Gn(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function nu(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function zp(c){return c}function Eh(c,a){const f=a.type==="color",m=c.stops&&typeof c.stops[0][0]=="object",b=m||!(m||c.property!==void 0),S=c.type||(bc(a)?"exponential":"interval");if(f||a.type==="padding"){const K=f?sr.parse:Oi.parse;(c=Pr({},c)).stops&&(c.stops=c.stops.map(J=>[J[0],K(J[1])])),c.default=K(c.default?c.default:a.default)}if(c.colorSpace&&(T=c.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var T;let E,R,j;if(S==="exponential")E=Vn;else if(S==="interval")E=Dp;else if(S==="categorical"){E=Wr,R=Object.create(null);for(const K of c.stops)R[K[0]]=K[1];j=typeof c.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);E=wc}if(m){const K={},J=[];for(let _e=0;_e<c.stops.length;_e++){const we=c.stops[_e],Ce=we[0].zoom;K[Ce]===void 0&&(K[Ce]={zoom:Ce,type:c.type,property:c.property,default:c.default,stops:[]},J.push(Ce)),K[Ce].stops.push([we[0].value,we[1]])}const se=[];for(const _e of J)se.push([K[_e].zoom,Eh(K[_e],a)]);const de={name:"linear"};return{kind:"composite",interpolationType:de,interpolationFactor:ki.interpolationFactor.bind(void 0,de),zoomStops:se.map(_e=>_e[0]),evaluate:({zoom:_e},we)=>Vn({stops:se,base:c.base},a,_e).evaluate(_e,we)}}if(b){const K=S==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:K,interpolationFactor:ki.interpolationFactor.bind(void 0,K),zoomStops:c.stops.map(J=>J[0]),evaluate:({zoom:J})=>E(c,a,J,R,j)}}return{kind:"source",evaluate(K,J){const se=J&&J.properties?J.properties[c.property]:void 0;return se===void 0?cl(c.default,a.default):E(c,a,se,R,j)}}}function cl(c,a,f){return c!==void 0?c:a!==void 0?a:f!==void 0?f:void 0}function Wr(c,a,f,m,b){return cl(typeof f===b?m[f]:void 0,c.default,a.default)}function Dp(c,a,f){if(Gn(f)!=="number")return cl(c.default,a.default);const m=c.stops.length;if(m===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[m-1][0])return c.stops[m-1][1];const b=ll(c.stops.map(S=>S[0]),f);return c.stops[b][1]}function Vn(c,a,f){const m=c.base!==void 0?c.base:1;if(Gn(f)!=="number")return cl(c.default,a.default);const b=c.stops.length;if(b===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[b-1][0])return c.stops[b-1][1];const S=ll(c.stops.map(K=>K[0]),f),T=function(K,J,se,de){const _e=de-se,we=K-se;return _e===0?0:J===1?we/_e:(Math.pow(J,we)-1)/(Math.pow(J,_e)-1)}(f,m,c.stops[S][0],c.stops[S+1][0]),E=c.stops[S][1],R=c.stops[S+1][1],j=Li[a.type]||zp;return typeof E.evaluate=="function"?{evaluate(...K){const J=E.evaluate.apply(void 0,K),se=R.evaluate.apply(void 0,K);if(J!==void 0&&se!==void 0)return j(J,se,T,c.colorSpace)}}:j(E,R,T,c.colorSpace)}function wc(c,a,f){switch(a.type){case"color":f=sr.parse(f);break;case"formatted":f=Qi.fromString(f.toString());break;case"resolvedImage":f=po.fromString(f.toString());break;case"padding":f=Oi.parse(f);break;default:Gn(f)===a.type||a.type==="enum"&&a.values[f]||(f=void 0)}return cl(f,c.default,a.default)}to.register(ga,{error:[{kind:"error"},[yt],(c,[a])=>{throw new zr(a.evaluate(c))}],typeof:[yt,[Jt],(c,[a])=>xe(Xr(a.evaluate(c)))],"to-rgba":[ge(Oe,4),[Rt],(c,[a])=>{const[f,m,b,S]=a.evaluate(c).rgb;return[255*f,255*m,255*b,S]}],rgb:[Rt,[Oe,Oe,Oe],Sh],rgba:[Rt,[Oe,Oe,Oe,Oe],Sh],has:{type:bt,overloads:[[[yt],(c,[a])=>Th(a.evaluate(c),c.properties())],[[yt,Qt],(c,[a,f])=>Th(a.evaluate(c),f.evaluate(c))]]},get:{type:Jt,overloads:[[[yt],(c,[a])=>vc(a.evaluate(c),c.properties())],[[yt,Qt],(c,[a,f])=>vc(a.evaluate(c),f.evaluate(c))]]},"feature-state":[Jt,[yt],(c,[a])=>vc(a.evaluate(c),c.featureState||{})],properties:[Qt,[],c=>c.properties()],"geometry-type":[yt,[],c=>c.geometryType()],id:[Jt,[],c=>c.id()],zoom:[Oe,[],c=>c.globals.zoom],"heatmap-density":[Oe,[],c=>c.globals.heatmapDensity||0],"line-progress":[Oe,[],c=>c.globals.lineProgress||0],accumulated:[Jt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Oe,qs(Oe),(c,a)=>{let f=0;for(const m of a)f+=m.evaluate(c);return f}],"*":[Oe,qs(Oe),(c,a)=>{let f=1;for(const m of a)f*=m.evaluate(c);return f}],"-":{type:Oe,overloads:[[[Oe,Oe],(c,[a,f])=>a.evaluate(c)-f.evaluate(c)],[[Oe],(c,[a])=>-a.evaluate(c)]]},"/":[Oe,[Oe,Oe],(c,[a,f])=>a.evaluate(c)/f.evaluate(c)],"%":[Oe,[Oe,Oe],(c,[a,f])=>a.evaluate(c)%f.evaluate(c)],ln2:[Oe,[],()=>Math.LN2],pi:[Oe,[],()=>Math.PI],e:[Oe,[],()=>Math.E],"^":[Oe,[Oe,Oe],(c,[a,f])=>Math.pow(a.evaluate(c),f.evaluate(c))],sqrt:[Oe,[Oe],(c,[a])=>Math.sqrt(a.evaluate(c))],log10:[Oe,[Oe],(c,[a])=>Math.log(a.evaluate(c))/Math.LN10],ln:[Oe,[Oe],(c,[a])=>Math.log(a.evaluate(c))],log2:[Oe,[Oe],(c,[a])=>Math.log(a.evaluate(c))/Math.LN2],sin:[Oe,[Oe],(c,[a])=>Math.sin(a.evaluate(c))],cos:[Oe,[Oe],(c,[a])=>Math.cos(a.evaluate(c))],tan:[Oe,[Oe],(c,[a])=>Math.tan(a.evaluate(c))],asin:[Oe,[Oe],(c,[a])=>Math.asin(a.evaluate(c))],acos:[Oe,[Oe],(c,[a])=>Math.acos(a.evaluate(c))],atan:[Oe,[Oe],(c,[a])=>Math.atan(a.evaluate(c))],min:[Oe,qs(Oe),(c,a)=>Math.min(...a.map(f=>f.evaluate(c)))],max:[Oe,qs(Oe),(c,a)=>Math.max(...a.map(f=>f.evaluate(c)))],abs:[Oe,[Oe],(c,[a])=>Math.abs(a.evaluate(c))],round:[Oe,[Oe],(c,[a])=>{const f=a.evaluate(c);return f<0?-Math.round(-f):Math.round(f)}],floor:[Oe,[Oe],(c,[a])=>Math.floor(a.evaluate(c))],ceil:[Oe,[Oe],(c,[a])=>Math.ceil(a.evaluate(c))],"filter-==":[bt,[yt,Jt],(c,[a,f])=>c.properties()[a.value]===f.value],"filter-id-==":[bt,[Jt],(c,[a])=>c.id()===a.value],"filter-type-==":[bt,[yt],(c,[a])=>c.geometryType()===a.value],"filter-<":[bt,[yt,Jt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<b}],"filter-id-<":[bt,[Jt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<m}],"filter->":[bt,[yt,Jt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>b}],"filter-id->":[bt,[Jt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>m}],"filter-<=":[bt,[yt,Jt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m<=b}],"filter-id-<=":[bt,[Jt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f<=m}],"filter->=":[bt,[yt,Jt],(c,[a,f])=>{const m=c.properties()[a.value],b=f.value;return typeof m==typeof b&&m>=b}],"filter-id->=":[bt,[Jt],(c,[a])=>{const f=c.id(),m=a.value;return typeof f==typeof m&&f>=m}],"filter-has":[bt,[Jt],(c,[a])=>a.value in c.properties()],"filter-has-id":[bt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[bt,[ge(yt)],(c,[a])=>a.value.indexOf(c.geometryType())>=0],"filter-id-in":[bt,[ge(Jt)],(c,[a])=>a.value.indexOf(c.id())>=0],"filter-in-small":[bt,[yt,ge(Jt)],(c,[a,f])=>f.value.indexOf(c.properties()[a.value])>=0],"filter-in-large":[bt,[yt,ge(Jt)],(c,[a,f])=>function(m,b,S,T){for(;S<=T;){const E=S+T>>1;if(b[E]===m)return!0;b[E]>m?T=E-1:S=E+1}return!1}(c.properties()[a.value],f.value,0,f.value.length-1)],all:{type:bt,overloads:[[[bt,bt],(c,[a,f])=>a.evaluate(c)&&f.evaluate(c)],[qs(bt),(c,a)=>{for(const f of a)if(!f.evaluate(c))return!1;return!0}]]},any:{type:bt,overloads:[[[bt,bt],(c,[a,f])=>a.evaluate(c)||f.evaluate(c)],[qs(bt),(c,a)=>{for(const f of a)if(f.evaluate(c))return!0;return!1}]]},"!":[bt,[bt],(c,[a])=>!a.evaluate(c)],"is-supported-script":[bt,[yt],(c,[a])=>{const f=c.globals&&c.globals.isSupportedScript;return!f||f(a.evaluate(c))}],upcase:[yt,[yt],(c,[a])=>a.evaluate(c).toUpperCase()],downcase:[yt,[yt],(c,[a])=>a.evaluate(c).toLowerCase()],concat:[yt,qs(Jt),(c,a)=>a.map(f=>nl(f.evaluate(c))).join("")],"resolved-locale":[yt,[yr],(c,[a])=>a.evaluate(c).resolvedLocale()]});class br{constructor(a,f){var m;this.expression=a,this._warningHistory={},this._evaluator=new ar,this._defaultValue=f?(m=f).type==="color"&&nu(m.default)?new sr(0,0,0,0):m.type==="color"?sr.parse(m.default)||null:m.type==="padding"?Oi.parse(m.default)||null:m.type==="variableAnchorOffsetCollection"?ho.parse(m.default)||null:m.default===void 0?null:m.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(a,f,m,b,S,T){return this._evaluator.globals=a,this._evaluator.feature=f,this._evaluator.featureState=m,this._evaluator.canonical=b,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(a,f,m,b,S,T){this._evaluator.globals=a,this._evaluator.feature=f||null,this._evaluator.featureState=m||null,this._evaluator.canonical=b,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new zr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function pr(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in ga}function Hs(c,a){const f=new Vl(ga,ol,[],a?function(b){const S={color:Rt,string:yt,number:Oe,enum:yt,boolean:bt,formatted:or,padding:Te,resolvedImage:ne,variableAnchorOffsetCollection:ce};return b.type==="array"?ge(S[b.value]||Jt,b.length):S[b.type]}(a):void 0),m=f.parse(c,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?Ch(new br(m,a)):_a(f.errors)}class ru{constructor(a,f){this.kind=a,this._styleExpression=f,this.isStateDependent=a!=="constant"&&!sl(f.expression)}evaluateWithoutErrorHandling(a,f,m,b,S,T){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,S,T)}evaluate(a,f,m,b,S,T){return this._styleExpression.evaluate(a,f,m,b,S,T)}}class xc{constructor(a,f,m,b){this.kind=a,this.zoomStops=m,this._styleExpression=f,this.isStateDependent=a!=="camera"&&!sl(f.expression),this.interpolationType=b}evaluateWithoutErrorHandling(a,f,m,b,S,T){return this._styleExpression.evaluateWithoutErrorHandling(a,f,m,b,S,T)}evaluate(a,f,m,b,S,T){return this._styleExpression.evaluate(a,f,m,b,S,T)}interpolationFactor(a,f,m){return this.interpolationType?ki.interpolationFactor(this.interpolationType,a,f,m):0}}function Lh(c,a){const f=Hs(c,a);if(f.result==="error")return f;const m=f.value.expression,b=Kl(m);if(!b&&!ya(a))return _a([new vr("","data expressions not supported")]);const S=al(m,["zoom"]);if(!S&&!Mh(a))return _a([new vr("","zoom expressions not supported")]);const T=ou(m);return T||S?T instanceof vr?_a([T]):T instanceof ki&&!bc(a)?_a([new vr("",'"interpolate" expressions cannot be used with this property')]):Ch(T?new xc(b?"camera":"composite",f.value,T.labels,T instanceof ki?T.interpolation:void 0):new ru(b?"constant":"source",f.value)):_a([new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class iu{constructor(a,f){this._parameters=a,this._specification=f,Pr(this,Eh(this._parameters,this._specification))}static deserialize(a){return new iu(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function ou(c){let a=null;if(c instanceof Jl)a=ou(c.result);else if(c instanceof Yl){for(const f of c.args)if(a=ou(f),a)break}else(c instanceof ul||c instanceof ki)&&c.input instanceof to&&c.input.name==="zoom"&&(a=c);return a instanceof vr||c.eachChild(f=>{const m=ou(f);m instanceof vr?a=m:!a&&m?a=new vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&m&&a!==m&&(a=new vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function su(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const a of c.slice(1))if(!su(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Ih={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function au(c){if(c==null)return{filter:()=>!0,needGeometry:!1};su(c)||(c=uu(c));const a=Hs(c,Ih);if(a.result==="error")throw new Error(a.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,m,b)=>a.value.evaluate(f,m,{},b),needGeometry:lu(c)}}function Ah(c,a){return c<a?-1:c>a?1:0}function lu(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let a=1;a<c.length;a++)if(lu(c[a]))return!0;return!1}function uu(c){if(!c)return!0;const a=c[0];return c.length<=1?a!=="any":a==="=="?kc(c[1],c[2],"=="):a==="!="?cu(kc(c[1],c[2],"==")):a==="<"||a===">"||a==="<="||a===">="?kc(c[1],c[2],a):a==="any"?(f=c.slice(1),["any"].concat(f.map(uu))):a==="all"?["all"].concat(c.slice(1).map(uu)):a==="none"?["all"].concat(c.slice(1).map(uu).map(cu)):a==="in"?Ph(c[1],c.slice(2)):a==="!in"?cu(Ph(c[1],c.slice(2))):a==="has"?zh(c[1]):a==="!has"?cu(zh(c[1])):a!=="within"||c;var f}function kc(c,a,f){switch(c){case"$type":return[`filter-type-${f}`,a];case"$id":return[`filter-id-${f}`,a];default:return[`filter-${f}`,c,a]}}function Ph(c,a){if(a.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(f=>typeof f!=typeof a[0])?["filter-in-large",c,["literal",a.sort(Ah)]]:["filter-in-small",c,["literal",a]]}}function zh(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function cu(c){return["!",c]}function Sc(c){const a=typeof c;if(a==="number"||a==="boolean"||a==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let b="[";for(const S of c)b+=`${Sc(S)},`;return`${b}]`}const f=Object.keys(c).sort();let m="{";for(let b=0;b<f.length;b++)m+=`${JSON.stringify(f[b])}:${Sc(c[f[b]])},`;return`${m}}`}function Rp(c){let a="";for(const f of fn)a+=`/${Sc(c[f])}`;return a}function Dh(c){const a=c.value;return a?[new xt(c.key,a,"constants have been deprecated as of v8")]:[]}function Br(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function Ms(c){if(Array.isArray(c))return c.map(Ms);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const a={};for(const f in c)a[f]=Ms(c[f]);return a}return Br(c)}function Ii(c){const a=c.key,f=c.value,m=c.valueSpec||{},b=c.objectElementValidators||{},S=c.style,T=c.styleSpec,E=c.validateSpec;let R=[];const j=Gn(f);if(j!=="object")return[new xt(a,f,`object expected, ${j} found`)];for(const K in f){const J=K.split(".")[0],se=m[J]||m["*"];let de;if(b[J])de=b[J];else if(m[J])de=E;else if(b["*"])de=b["*"];else{if(!m["*"]){R.push(new xt(a,f[K],`unknown property "${K}"`));continue}de=E}R=R.concat(de({key:(a&&`${a}.`)+K,value:f[K],valueSpec:se,style:S,styleSpec:T,object:f,objectKey:K,validateSpec:E},f))}for(const K in m)b[K]||m[K].required&&m[K].default===void 0&&f[K]===void 0&&R.push(new xt(a,f,`missing required property "${K}"`));return R}function Tc(c){const a=c.value,f=c.valueSpec,m=c.style,b=c.styleSpec,S=c.key,T=c.arrayElementValidator||c.validateSpec;if(Gn(a)!=="array")return[new xt(S,a,`array expected, ${Gn(a)} found`)];if(f.length&&a.length!==f.length)return[new xt(S,a,`array length ${f.length} expected, length ${a.length} found`)];if(f["min-length"]&&a.length<f["min-length"])return[new xt(S,a,`array length at least ${f["min-length"]} expected, length ${a.length} found`)];let E={type:f.value,values:f.values};b.$version<7&&(E.function=f.function),Gn(f.value)==="object"&&(E=f.value);let R=[];for(let j=0;j<a.length;j++)R=R.concat(T({array:a,arrayIndex:j,value:a[j],valueSpec:E,validateSpec:c.validateSpec,style:m,styleSpec:b,key:`${S}[${j}]`}));return R}function fu(c){const a=c.key,f=c.value,m=c.valueSpec;let b=Gn(f);return b==="number"&&f!=f&&(b="NaN"),b!=="number"?[new xt(a,f,`number expected, ${b} found`)]:"minimum"in m&&f<m.minimum?[new xt(a,f,`${f} is less than the minimum value ${m.minimum}`)]:"maximum"in m&&f>m.maximum?[new xt(a,f,`${f} is greater than the maximum value ${m.maximum}`)]:[]}function Rh(c){const a=c.valueSpec,f=Br(c.value.type);let m,b,S,T={};const E=f!=="categorical"&&c.value.property===void 0,R=!E,j=Gn(c.value.stops)==="array"&&Gn(c.value.stops[0])==="array"&&Gn(c.value.stops[0][0])==="object",K=Ii({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(de){if(f==="identity")return[new xt(de.key,de.value,'identity function may not have a "stops" property')];let _e=[];const we=de.value;return _e=_e.concat(Tc({key:de.key,value:we,valueSpec:de.valueSpec,validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:J})),Gn(we)==="array"&&we.length===0&&_e.push(new xt(de.key,we,"array must have at least one stop")),_e},default:function(de){return de.validateSpec({key:de.key,value:de.value,valueSpec:a,validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec})}}});return f==="identity"&&E&&K.push(new xt(c.key,c.value,'missing required property "property"')),f==="identity"||c.value.stops||K.push(new xt(c.key,c.value,'missing required property "stops"')),f==="exponential"&&c.valueSpec.expression&&!bc(c.valueSpec)&&K.push(new xt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(R&&!ya(c.valueSpec)?K.push(new xt(c.key,c.value,"property functions not supported")):E&&!Mh(c.valueSpec)&&K.push(new xt(c.key,c.value,"zoom functions not supported"))),f!=="categorical"&&!j||c.value.property!==void 0||K.push(new xt(c.key,c.value,'"property" property is required')),K;function J(de){let _e=[];const we=de.value,Ce=de.key;if(Gn(we)!=="array")return[new xt(Ce,we,`array expected, ${Gn(we)} found`)];if(we.length!==2)return[new xt(Ce,we,`array length 2 expected, length ${we.length} found`)];if(j){if(Gn(we[0])!=="object")return[new xt(Ce,we,`object expected, ${Gn(we[0])} found`)];if(we[0].zoom===void 0)return[new xt(Ce,we,"object stop key must have zoom")];if(we[0].value===void 0)return[new xt(Ce,we,"object stop key must have value")];if(S&&S>Br(we[0].zoom))return[new xt(Ce,we[0].zoom,"stop zoom values must appear in ascending order")];Br(we[0].zoom)!==S&&(S=Br(we[0].zoom),b=void 0,T={}),_e=_e.concat(Ii({key:`${Ce}[0]`,value:we[0],valueSpec:{zoom:{}},validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:fu,value:se}}))}else _e=_e.concat(se({key:`${Ce}[0]`,value:we[0],valueSpec:{},validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec},we));return pr(Ms(we[1]))?_e.concat([new xt(`${Ce}[1]`,we[1],"expressions are not allowed in function stops.")]):_e.concat(de.validateSpec({key:`${Ce}[1]`,value:we[1],valueSpec:a,validateSpec:de.validateSpec,style:de.style,styleSpec:de.styleSpec}))}function se(de,_e){const we=Gn(de.value),Ce=Br(de.value),Pe=de.value!==null?de.value:_e;if(m){if(we!==m)return[new xt(de.key,Pe,`${we} stop domain type must match previous stop domain type ${m}`)]}else m=we;if(we!=="number"&&we!=="string"&&we!=="boolean")return[new xt(de.key,Pe,"stop domain value must be a number, string, or boolean")];if(we!=="number"&&f!=="categorical"){let Ge=`number expected, ${we} found`;return ya(a)&&f===void 0&&(Ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new xt(de.key,Pe,Ge)]}return f!=="categorical"||we!=="number"||isFinite(Ce)&&Math.floor(Ce)===Ce?f!=="categorical"&&we==="number"&&b!==void 0&&Ce<b?[new xt(de.key,Pe,"stop domain values must appear in ascending order")]:(b=Ce,f==="categorical"&&Ce in T?[new xt(de.key,Pe,"stop domain values must be unique")]:(T[Ce]=!0,[])):[new xt(de.key,Pe,`integer expected, found ${Ce}`)]}}function Es(c){const a=(c.expressionContext==="property"?Lh:Hs)(Ms(c.value),c.valueSpec);if(a.result==="error")return a.value.map(m=>new xt(`${c.key}${m.key}`,c.value,m.message));const f=a.value.expression||a.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!f.outputDefined())return[new xt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!sl(f))return[new xt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!sl(f))return[new xt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!al(f,["zoom","feature-state"]))return[new xt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Kl(f))return[new xt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ls(c){const a=c.key,f=c.value,m=c.valueSpec,b=[];return Array.isArray(m.values)?m.values.indexOf(Br(f))===-1&&b.push(new xt(a,f,`expected one of [${m.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(m.values).indexOf(Br(f))===-1&&b.push(new xt(a,f,`expected one of [${Object.keys(m.values).join(", ")}], ${JSON.stringify(f)} found`)),b}function va(c){return su(Ms(c.value))?Es(Pr({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Cc(c)}function Cc(c){const a=c.value,f=c.key;if(Gn(a)!=="array")return[new xt(f,a,`array expected, ${Gn(a)} found`)];const m=c.styleSpec;let b,S=[];if(a.length<1)return[new xt(f,a,"filter array must have at least 1 element")];switch(S=S.concat(Ls({key:`${f}[0]`,value:a[0],valueSpec:m.filter_operator,style:c.style,styleSpec:c.styleSpec})),Br(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Br(a[1])==="$type"&&S.push(new xt(f,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&S.push(new xt(f,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(b=Gn(a[1]),b!=="string"&&S.push(new xt(`${f}[1]`,a[1],`string expected, ${b} found`)));for(let T=2;T<a.length;T++)b=Gn(a[T]),Br(a[1])==="$type"?S=S.concat(Ls({key:`${f}[${T}]`,value:a[T],valueSpec:m.geometry_type,style:c.style,styleSpec:c.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&S.push(new xt(`${f}[${T}]`,a[T],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let T=1;T<a.length;T++)S=S.concat(Cc({key:`${f}[${T}]`,value:a[T],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=Gn(a[1]),a.length!==2?S.push(new xt(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="string"&&S.push(new xt(`${f}[1]`,a[1],`string expected, ${b} found`));break;case"within":b=Gn(a[1]),a.length!==2?S.push(new xt(f,a,`filter array for "${a[0]}" operator must have 2 elements`)):b!=="object"&&S.push(new xt(`${f}[1]`,a[1],`object expected, ${b} found`))}return S}function hu(c,a){const f=c.key,m=c.validateSpec,b=c.style,S=c.styleSpec,T=c.value,E=c.objectKey,R=S[`${a}_${c.layerType}`];if(!R)return[];const j=E.match(/^(.*)-transition$/);if(a==="paint"&&j&&R[j[1]]&&R[j[1]].transition)return m({key:f,value:T,valueSpec:S.transition,style:b,styleSpec:S});const K=c.valueSpec||R[E];if(!K)return[new xt(f,T,`unknown property "${E}"`)];let J;if(Gn(T)==="string"&&ya(K)&&!K.tokens&&(J=/^{([^}]+)}$/.exec(T)))return[new xt(f,T,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(J[1])} }\`.`)];const se=[];return c.layerType==="symbol"&&(E==="text-field"&&b&&!b.glyphs&&se.push(new xt(f,T,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&nu(Ms(T))&&Br(T.type)==="identity"&&se.push(new xt(f,T,'"text-font" does not support identity functions'))),se.concat(m({key:c.key,value:T,valueSpec:K,style:b,styleSpec:S,expressionContext:"property",propertyType:a,propertyKey:E}))}function Mc(c){return hu(c,"paint")}function Ec(c){return hu(c,"layout")}function fl(c){let a=[];const f=c.value,m=c.key,b=c.style,S=c.styleSpec;f.type||f.ref||a.push(new xt(m,f,'either "type" or "ref" is required'));let T=Br(f.type);const E=Br(f.ref);if(f.id){const R=Br(f.id);for(let j=0;j<c.arrayIndex;j++){const K=b.layers[j];Br(K.id)===R&&a.push(new xt(m,f.id,`duplicate layer id "${f.id}", previously used at line ${K.id.__line__}`))}}if("ref"in f){let R;["type","source","source-layer","filter","layout"].forEach(j=>{j in f&&a.push(new xt(m,f[j],`"${j}" is prohibited for ref layers`))}),b.layers.forEach(j=>{Br(j.id)===E&&(R=j)}),R?R.ref?a.push(new xt(m,f.ref,"ref cannot reference another ref layer")):T=Br(R.type):a.push(new xt(m,f.ref,`ref layer "${E}" not found`))}else if(T!=="background")if(f.source){const R=b.sources&&b.sources[f.source],j=R&&Br(R.type);R?j==="vector"&&T==="raster"?a.push(new xt(m,f.source,`layer "${f.id}" requires a raster source`)):j!=="raster-dem"&&T==="hillshade"?a.push(new xt(m,f.source,`layer "${f.id}" requires a raster-dem source`)):j==="raster"&&T!=="raster"?a.push(new xt(m,f.source,`layer "${f.id}" requires a vector source`)):j!=="vector"||f["source-layer"]?j==="raster-dem"&&T!=="hillshade"?a.push(new xt(m,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!f.paint||!f.paint["line-gradient"]||j==="geojson"&&R.lineMetrics||a.push(new xt(m,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new xt(m,f,`layer "${f.id}" must specify a "source-layer"`)):a.push(new xt(m,f.source,`source "${f.source}" not found`))}else a.push(new xt(m,f,'missing required property "source"'));return a=a.concat(Ii({key:m,value:f,valueSpec:S.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${m}.type`,value:f.type,valueSpec:S.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:f,objectKey:"type"}),filter:va,layout:R=>Ii({layer:f,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":j=>Ec(Pr({layerType:T},j))}}),paint:R=>Ii({layer:f,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":j=>Mc(Pr({layerType:T},j))}})}})),a}function Ws(c){const a=c.value,f=c.key,m=Gn(a);return m!=="string"?[new xt(f,a,`string expected, ${m} found`)]:[]}const Fh={promoteId:function({key:c,value:a}){if(Gn(a)==="string")return Ws({key:c,value:a});{const f=[];for(const m in a)f.push(...Ws({key:`${c}.${m}`,value:a[m]}));return f}}};function Oh(c){const a=c.value,f=c.key,m=c.styleSpec,b=c.style,S=c.validateSpec;if(!a.type)return[new xt(f,a,'"type" is required')];const T=Br(a.type);let E;switch(T){case"vector":case"raster":return E=Ii({key:f,value:a,valueSpec:m[`source_${T.replace("-","_")}`],style:c.style,styleSpec:m,objectElementValidators:Fh,validateSpec:S}),E;case"raster-dem":return E=function(R){var j;const K=(j=R.sourceName)!==null&&j!==void 0?j:"",J=R.value,se=R.styleSpec,de=se.source_raster_dem,_e=R.style;let we=[];const Ce=Gn(J);if(J===void 0)return we;if(Ce!=="object")return we.push(new xt("source_raster_dem",J,`object expected, ${Ce} found`)),we;const Pe=Br(J.encoding)==="custom",Ge=["redFactor","greenFactor","blueFactor","baseShift"],De=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const je in J)!Pe&&Ge.includes(je)?we.push(new xt(je,J[je],`In "${K}": "${je}" is only valid when "encoding" is set to "custom". ${De} encoding found`)):de[je]?we=we.concat(R.validateSpec({key:je,value:J[je],valueSpec:de[je],validateSpec:R.validateSpec,style:_e,styleSpec:se})):we.push(new xt(je,J[je],`unknown property "${je}"`));return we}({sourceName:f,value:a,style:c.style,styleSpec:m,validateSpec:S}),E;case"geojson":if(E=Ii({key:f,value:a,valueSpec:m.source_geojson,style:b,styleSpec:m,validateSpec:S,objectElementValidators:Fh}),a.cluster)for(const R in a.clusterProperties){const[j,K]=a.clusterProperties[R],J=typeof j=="string"?[j,["accumulated"],["get",R]]:j;E.push(...Es({key:`${f}.${R}.map`,value:K,validateSpec:S,expressionContext:"cluster-map"})),E.push(...Es({key:`${f}.${R}.reduce`,value:J,validateSpec:S,expressionContext:"cluster-reduce"}))}return E;case"video":return Ii({key:f,value:a,valueSpec:m.source_video,style:b,validateSpec:S,styleSpec:m});case"image":return Ii({key:f,value:a,valueSpec:m.source_image,style:b,validateSpec:S,styleSpec:m});case"canvas":return[new xt(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ls({key:`${f}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:b,validateSpec:S,styleSpec:m})}}function $h(c){const a=c.value,f=c.styleSpec,m=f.light,b=c.style;let S=[];const T=Gn(a);if(a===void 0)return S;if(T!=="object")return S=S.concat([new xt("light",a,`object expected, ${T} found`)]),S;for(const E in a){const R=E.match(/^(.*)-transition$/);S=S.concat(R&&m[R[1]]&&m[R[1]].transition?c.validateSpec({key:E,value:a[E],valueSpec:f.transition,validateSpec:c.validateSpec,style:b,styleSpec:f}):m[E]?c.validateSpec({key:E,value:a[E],valueSpec:m[E],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new xt(E,a[E],`unknown property "${E}"`)])}return S}function Bh(c){const a=c.value,f=c.styleSpec,m=f.sky,b=c.style,S=Gn(a);if(a===void 0)return[];if(S!=="object")return[new xt("sky",a,`object expected, ${S} found`)];let T=[];for(const E in a)T=T.concat(m[E]?Wo({key:E,value:a[E],valueSpec:m[E],style:b,styleSpec:f}):[new xt(E,a[E],`unknown property "${E}"`)]);return T}function hl(c){const a=c.value,f=c.styleSpec,m=f.terrain,b=c.style;let S=[];const T=Gn(a);if(a===void 0)return S;if(T!=="object")return S=S.concat([new xt("terrain",a,`object expected, ${T} found`)]),S;for(const E in a)S=S.concat(m[E]?c.validateSpec({key:E,value:a[E],valueSpec:m[E],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new xt(E,a[E],`unknown property "${E}"`)]);return S}function dl(c){let a=[];const f=c.value,m=c.key;if(Array.isArray(f)){const b=[],S=[];for(const T in f)f[T].id&&b.includes(f[T].id)&&a.push(new xt(m,f,`all the sprites' ids must be unique, but ${f[T].id} is duplicated`)),b.push(f[T].id),f[T].url&&S.includes(f[T].url)&&a.push(new xt(m,f,`all the sprites' URLs must be unique, but ${f[T].url} is duplicated`)),S.push(f[T].url),a=a.concat(Ii({key:`${m}[${T}]`,value:f[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return a}return Ws({key:m,value:f})}const $i={"*":()=>[],array:Tc,boolean:function(c){const a=c.value,f=c.key,m=Gn(a);return m!=="boolean"?[new xt(f,a,`boolean expected, ${m} found`)]:[]},number:fu,color:function(c){const a=c.key,f=c.value,m=Gn(f);return m!=="string"?[new xt(a,f,`color expected, ${m} found`)]:sr.parse(String(f))?[]:[new xt(a,f,`color expected, "${f}" found`)]},constants:Dh,enum:Ls,filter:va,function:Rh,layer:fl,object:Ii,source:Oh,light:$h,sky:Bh,terrain:hl,string:Ws,formatted:function(c){return Ws(c).length===0?[]:Es(c)},resolvedImage:function(c){return Ws(c).length===0?[]:Es(c)},padding:function(c){const a=c.key,f=c.value;if(Gn(f)==="array"){if(f.length<1||f.length>4)return[new xt(a,f,`padding requires 1 to 4 values; ${f.length} values found`)];const m={type:"number"};let b=[];for(let S=0;S<f.length;S++)b=b.concat(c.validateSpec({key:`${a}[${S}]`,value:f[S],validateSpec:c.validateSpec,valueSpec:m}));return b}return fu({key:a,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const a=c.key,f=c.value,m=Gn(f),b=c.styleSpec;if(m!=="array"||f.length<1||f.length%2!=0)return[new xt(a,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let T=0;T<f.length;T+=2)S=S.concat(Ls({key:`${a}[${T}]`,value:f[T],valueSpec:b.layout_symbol["text-anchor"]})),S=S.concat(Tc({key:`${a}[${T+1}]`,value:f[T+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:b}));return S},sprite:dl};function Wo(c){const a=c.value,f=c.valueSpec,m=c.styleSpec;return c.validateSpec=Wo,f.expression&&nu(Br(a))?Rh(c):f.expression&&pr(Ms(a))?Es(c):f.type&&$i[f.type]?$i[f.type](c):Ii(Pr({},c,{valueSpec:f.type?m[f.type]:f}))}function Lc(c){const a=c.value,f=c.key,m=Ws(c);return m.length||(a.indexOf("{fontstack}")===-1&&m.push(new xt(f,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&m.push(new xt(f,a,'"glyphs" url must include a "{range}" token'))),m}function To(c,a=pe){let f=[];return f=f.concat(Wo({key:"",value:c,valueSpec:a.$root,styleSpec:a,style:c,validateSpec:Wo,objectElementValidators:{glyphs:Lc,"*":()=>[]}})),c.constants&&(f=f.concat(Dh({key:"constants",value:c.constants,style:c,styleSpec:a,validateSpec:Wo}))),ba(f)}function Go(c){return function(a){return c({...a,validateSpec:Wo})}}function ba(c){return[].concat(c).sort((a,f)=>a.line-f.line)}function Co(c){return function(...a){return ba(c.apply(this,a))}}To.source=Co(Go(Oh)),To.sprite=Co(Go(dl)),To.glyphs=Co(Go(Lc)),To.light=Co(Go($h)),To.sky=Co(Go(Bh)),To.terrain=Co(Go(hl)),To.layer=Co(Go(fl)),To.filter=Co(Go(va)),To.paintProperty=Co(Go(Mc)),To.layoutProperty=Co(Go(Ec));const Gs=To,Fp=Gs.light,Ic=Gs.paintProperty,Op=Gs.layoutProperty;function wa(c,a){let f=!1;if(a&&a.length)for(const m of a)c.fire(new Ke(new Error(m.message))),f=!0;return f}class pl{constructor(a,f,m){const b=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const T=new Int32Array(this.arrayBuffer);a=T[0],this.d=(f=T[1])+2*(m=T[2]);for(let R=0;R<this.d*this.d;R++){const j=T[3+R],K=T[3+R+1];b.push(j===K?null:T.subarray(j,K))}const E=T[3+b.length+1];this.keys=T.subarray(T[3+b.length],E),this.bboxes=T.subarray(E),this.insert=this._insertReadonly}else{this.d=f+2*m;for(let T=0;T<this.d*this.d;T++)b.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=a,this.padding=m,this.scale=f/a,this.uid=0;const S=m/f*a;this.min=-S,this.max=a+S}insert(a,f,m,b,S){this._forEachCell(f,m,b,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(b),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,f,m,b,S,T){this.cells[S].push(T)}query(a,f,m,b,S){const T=this.min,E=this.max;if(a<=T&&f<=T&&E<=m&&E<=b&&!S)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(a,f,m,b,this._queryCell,R,{},S),R}}_queryCell(a,f,m,b,S,T,E,R){const j=this.cells[S];if(j!==null){const K=this.keys,J=this.bboxes;for(let se=0;se<j.length;se++){const de=j[se];if(E[de]===void 0){const _e=4*de;(R?R(J[_e+0],J[_e+1],J[_e+2],J[_e+3]):a<=J[_e+2]&&f<=J[_e+3]&&m>=J[_e+0]&&b>=J[_e+1])?(E[de]=!0,T.push(K[de])):E[de]=!1}}}}_forEachCell(a,f,m,b,S,T,E,R){const j=this._convertToCellCoord(a),K=this._convertToCellCoord(f),J=this._convertToCellCoord(m),se=this._convertToCellCoord(b);for(let de=j;de<=J;de++)for(let _e=K;_e<=se;_e++){const we=this.d*_e+de;if((!R||R(this._convertFromCellCoord(de),this._convertFromCellCoord(_e),this._convertFromCellCoord(de+1),this._convertFromCellCoord(_e+1)))&&S.call(this,a,f,m,b,we,T,E,R))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,f=3+this.cells.length+1+1;let m=0;for(let T=0;T<this.cells.length;T++)m+=this.cells[T].length;const b=new Int32Array(f+m+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let S=f;for(let T=0;T<a.length;T++){const E=a[T];b[3+T]=S,b.set(E,S),S+=E.length}return b[3+a.length]=S,b.set(this.keys,S),S+=this.keys.length,b[3+a.length+1]=S,b.set(this.bboxes,S),S+=this.bboxes.length,b.buffer}static serialize(a,f){const m=a.toArrayBuffer();return f&&f.push(m),{buffer:m}}static deserialize(a){return new pl(a.buffer)}}const Zo={};function Zt(c,a,f={}){if(Zo[c])throw new Error(`${c} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:c,writeable:!1}),Zo[c]={klass:a,omit:f.omit||[],shallow:f.shallow||[]}}Zt("Object",Object),Zt("TransferableGridIndex",pl),Zt("Color",sr),Zt("Error",Error),Zt("AJAXError",un),Zt("ResolvedImage",po),Zt("StylePropertyFunction",iu),Zt("StyleExpression",br,{omit:["_evaluator"]}),Zt("ZoomDependentExpression",xc),Zt("ZoomConstantExpression",ru),Zt("CompoundExpression",to,{omit:["_evaluate"]});for(const c in ga)ga[c]._classRegistryKey||Zt(`Expression_${c}`,ga[c]);function du(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function xa(c,a){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(du(c)||Ae(c))return a&&a.push(c),c;if(ArrayBuffer.isView(c)){const f=c;return a&&a.push(f.buffer),f}if(c instanceof ImageData)return a&&a.push(c.data.buffer),c;if(Array.isArray(c)){const f=[];for(const m of c)f.push(xa(m,a));return f}if(typeof c=="object"){const f=c.constructor,m=f._classRegistryKey;if(!m)throw new Error(`can't serialize object of unregistered class ${f.name}`);if(!Zo[m])throw new Error(`${m} is not registered.`);const b=f.serialize?f.serialize(c,a):{};if(f.serialize){if(a&&b===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in c){if(!c.hasOwnProperty(S)||Zo[m].omit.indexOf(S)>=0)continue;const T=c[S];b[S]=Zo[m].shallow.indexOf(S)>=0?T:xa(T,a)}c instanceof Error&&(b.message=c.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(b.$name=m),b}throw new Error("can't serialize object of type "+typeof c)}function ka(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||du(c)||Ae(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(ka);if(typeof c=="object"){const a=c.$name||"Object";if(!Zo[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:f}=Zo[a];if(!f)throw new Error(`can't deserialize unregistered class ${a}`);if(f.deserialize)return f.deserialize(c);const m=Object.create(f.prototype);for(const b of Object.keys(c)){if(b==="$name")continue;const S=c[b];m[b]=Zo[a].shallow.indexOf(b)>=0?S:ka(S)}return m}throw new Error("can't deserialize object of type "+typeof c)}class Nh{constructor(){this.first=!0}update(a,f){const m=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=m,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=m,!0):(this.lastFloorZoom>m?(this.lastIntegerZoom=m+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<m&&(this.lastIntegerZoom=m,this.lastIntegerZoomTime=f),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=m,!0))}}const Vt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Sa(c){for(const a of c)if(pu(a.charCodeAt(0)))return!0;return!1}function jh(c){for(const a of c)if(!Uh(a.charCodeAt(0)))return!1;return!0}function Uh(c){return!(Vt.Arabic(c)||Vt["Arabic Supplement"](c)||Vt["Arabic Extended-A"](c)||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c))}function pu(c){return!(c!==746&&c!==747&&(c<4352||!(Vt["Bopomofo Extended"](c)||Vt.Bopomofo(c)||Vt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Vt["CJK Compatibility Ideographs"](c)||Vt["CJK Compatibility"](c)||Vt["CJK Radicals Supplement"](c)||Vt["CJK Strokes"](c)||!(!Vt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Vt["CJK Unified Ideographs Extension A"](c)||Vt["CJK Unified Ideographs"](c)||Vt["Enclosed CJK Letters and Months"](c)||Vt["Hangul Compatibility Jamo"](c)||Vt["Hangul Jamo Extended-A"](c)||Vt["Hangul Jamo Extended-B"](c)||Vt["Hangul Jamo"](c)||Vt["Hangul Syllables"](c)||Vt.Hiragana(c)||Vt["Ideographic Description Characters"](c)||Vt.Kanbun(c)||Vt["Kangxi Radicals"](c)||Vt["Katakana Phonetic Extensions"](c)||Vt.Katakana(c)&&c!==12540||!(!Vt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Vt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Vt["Unified Canadian Aboriginal Syllabics"](c)||Vt["Unified Canadian Aboriginal Syllabics Extended"](c)||Vt["Vertical Forms"](c)||Vt["Yijing Hexagram Symbols"](c)||Vt["Yi Syllables"](c)||Vt["Yi Radicals"](c))))}function Ac(c){return!(pu(c)||function(a){return!!(Vt["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||Vt["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||Vt["Letterlike Symbols"](a)||Vt["Number Forms"](a)||Vt["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||Vt["Control Pictures"](a)&&a!==9251||Vt["Optical Character Recognition"](a)||Vt["Enclosed Alphanumerics"](a)||Vt["Geometric Shapes"](a)||Vt["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||Vt["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||Vt["CJK Symbols and Punctuation"](a)||Vt.Katakana(a)||Vt["Private Use Area"](a)||Vt["CJK Compatibility Forms"](a)||Vt["Small Form Variants"](a)||Vt["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(c))}function mu(c){return c>=1424&&c<=2303||Vt["Arabic Presentation Forms-A"](c)||Vt["Arabic Presentation Forms-B"](c)}function Vh(c,a){return!(!a&&mu(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Vt.Khmer(c))}function $p(c){for(const a of c)if(mu(a.charCodeAt(0)))return!0;return!1}const Is=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Er{constructor(a,f){this.zoom=a,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Nh,this.transition={})}isSupportedScript(a){return function(f,m){for(const b of f)if(!Vh(b.charCodeAt(0),m))return!1;return!0}(a,Is.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,f=a-Math.floor(a),m=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*m}:{fromScale:.5,toScale:1,t:1-(1-m)*f}}}class ml{constructor(a,f){this.property=a,this.value=f,this.expression=function(m,b){if(nu(m))return new iu(m,b);if(pr(m)){const S=Lh(m,b);if(S.result==="error")throw new Error(S.value.map(T=>`${T.key}: ${T.message}`).join(", "));return S.value}{let S=m;return b.type==="color"&&typeof m=="string"?S=sr.parse(m):b.type!=="padding"||typeof m!="number"&&!Array.isArray(m)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(m)&&(S=ho.parse(m)):S=Oi.parse(m),{kind:"constant",evaluate:()=>S}}}(f===void 0?a.specification.default:f,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,f,m){return this.property.possiblyEvaluate(this,a,f,m)}}class gu{constructor(a){this.property=a,this.value=new ml(a,void 0)}transitioned(a,f){return new qh(this.property,this.value,f,q({},a.transition,this.transition),a.now)}untransitioned(){return new qh(this.property,this.value,null,{},0)}}class Pc{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return ee(this._values[a].value.value)}setValue(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new gu(this._values[a].property)),this._values[a].value=new ml(this._values[a].property,f===null?void 0:ee(f))}getTransition(a){return ee(this._values[a].transition)}setTransition(a,f){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new gu(this._values[a].property)),this._values[a].transition=ee(f)||void 0}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m);const b=this.getTransition(f);b!==void 0&&(a[`${f}-transition`]=b)}return a}transitioned(a,f){const m=new Hh(this._properties);for(const b of Object.keys(this._values))m._values[b]=this._values[b].transitioned(a,f._values[b]);return m}untransitioned(){const a=new Hh(this._properties);for(const f of Object.keys(this._values))a._values[f]=this._values[f].untransitioned();return a}}class qh{constructor(a,f,m,b,S){this.property=a,this.value=f,this.begin=S+b.delay||0,this.end=this.begin+b.duration||0,a.specification.transition&&(b.delay||b.duration)&&(this.prior=m)}possiblyEvaluate(a,f,m){const b=a.now||0,S=this.value.possiblyEvaluate(a,f,m),T=this.prior;if(T){if(b>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(b<this.begin)return T.possiblyEvaluate(a,f,m);{const E=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(a,f,m),S,function(R){if(R<=0)return 0;if(R>=1)return 1;const j=R*R,K=j*R;return 4*(R<.5?K:3*(R-j)+K-.75)}(E))}}return S}}class Hh{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,f,m){const b=new gl(this._properties);for(const S of Object.keys(this._values))b._values[S]=this._values[S].possiblyEvaluate(a,f,m);return b}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Wh{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return ee(this._values[a].value)}setValue(a,f){this._values[a]=new ml(this._values[a].property,f===null?void 0:ee(f))}serialize(){const a={};for(const f of Object.keys(this._values)){const m=this.getValue(f);m!==void 0&&(a[f]=m)}return a}possiblyEvaluate(a,f,m){const b=new gl(this._properties);for(const S of Object.keys(this._values))b._values[S]=this._values[S].possiblyEvaluate(a,f,m);return b}}class Mo{constructor(a,f,m){this.property=a,this.value=f,this.parameters=m}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,f,m,b){return this.property.evaluate(this.value,this.parameters,a,f,m,b)}}class gl{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class sn{constructor(a){this.specification=a}possiblyEvaluate(a,f){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(f)}interpolate(a,f,m){const b=Li[this.specification.type];return b?b(a,f,m):a}}class hn{constructor(a,f){this.specification=a,this.overrides=f}possiblyEvaluate(a,f,m,b){return new Mo(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(f,null,{},m,b)}:a.expression,f)}interpolate(a,f,m){if(a.value.kind!=="constant"||f.value.kind!=="constant")return a;if(a.value.value===void 0||f.value.value===void 0)return new Mo(this,{kind:"constant",value:void 0},a.parameters);const b=Li[this.specification.type];if(b){const S=b(a.value.value,f.value.value,m);return new Mo(this,{kind:"constant",value:S},a.parameters)}return a}evaluate(a,f,m,b,S,T){return a.kind==="constant"?a.value:a.evaluate(f,m,b,S,T)}}class _u extends hn{possiblyEvaluate(a,f,m,b){if(a.value===void 0)return new Mo(this,{kind:"constant",value:void 0},f);if(a.expression.kind==="constant"){const S=a.expression.evaluate(f,null,{},m,b),T=a.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,E=this._calculate(T,T,T,f);return new Mo(this,{kind:"constant",value:E},f)}if(a.expression.kind==="camera"){const S=this._calculate(a.expression.evaluate({zoom:f.zoom-1}),a.expression.evaluate({zoom:f.zoom}),a.expression.evaluate({zoom:f.zoom+1}),f);return new Mo(this,{kind:"constant",value:S},f)}return new Mo(this,a.expression,f)}evaluate(a,f,m,b,S,T){if(a.kind==="source"){const E=a.evaluate(f,m,b,S,T);return this._calculate(E,E,E,f)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(f.zoom)-1},m,b),a.evaluate({zoom:Math.floor(f.zoom)},m,b),a.evaluate({zoom:Math.floor(f.zoom)+1},m,b),f):a.value}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class _l{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){if(a.value!==void 0){if(a.expression.kind==="constant"){const S=a.expression.evaluate(f,null,{},m,b);return this._calculate(S,S,S,f)}return this._calculate(a.expression.evaluate(new Er(Math.floor(f.zoom-1),f)),a.expression.evaluate(new Er(Math.floor(f.zoom),f)),a.expression.evaluate(new Er(Math.floor(f.zoom+1),f)),f)}}_calculate(a,f,m,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:a,to:f}:{from:m,to:f}}interpolate(a){return a}}class zc{constructor(a){this.specification=a}possiblyEvaluate(a,f,m,b){return!!a.expression.evaluate(f,null,{},m,b)}interpolate(){return!1}}class Bi{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in a){const m=a[f];m.specification.overridable&&this.overridableProperties.push(f);const b=this.defaultPropertyValues[f]=new ml(m,void 0),S=this.defaultTransitionablePropertyValues[f]=new gu(m);this.defaultTransitioningPropertyValues[f]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=b.possiblyEvaluate({})}}}Zt("DataDrivenProperty",hn),Zt("DataConstantProperty",sn),Zt("CrossFadedDataDrivenProperty",_u),Zt("CrossFadedProperty",_l),Zt("ColorRampProperty",zc);const Dc="-transition";class Eo extends kt{constructor(a,f){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),f.layout&&(this._unevaluatedLayout=new Wh(f.layout)),f.paint)){this._transitionablePaint=new Pc(f.paint);for(const m in a.paint)this.setPaintProperty(m,a.paint[m],{validate:!1});for(const m in a.layout)this.setLayoutProperty(m,a.layout[m],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gl(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,f,m={}){f!=null&&this._validate(Op,`layers.${this.id}.layout.${a}`,a,f,m)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,f):this.visibility=f)}getPaintProperty(a){return a.endsWith(Dc)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,f,m={}){if(f!=null&&this._validate(Ic,`layers.${this.id}.paint.${a}`,a,f,m))return!1;if(a.endsWith(Dc))return this._transitionablePaint.setTransition(a.slice(0,-11),f||void 0),!1;{const b=this._transitionablePaint._values[a],S=b.property.specification["property-type"]==="cross-faded-data-driven",T=b.value.isDataDriven(),E=b.value;this._transitionablePaint.setValue(a,f),this._handleSpecialPaintPropertyUpdate(a);const R=this._transitionablePaint._values[a].value;return R.isDataDriven()||T||S||this._handleOverridablePaintPropertyUpdate(a,E,R)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,f,m){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,f){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,f)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Le(a,(f,m)=>!(f===void 0||m==="layout"&&!Object.keys(f).length||m==="paint"&&!Object.keys(f).length))}_validate(a,f,m,b,S={}){return(!S||S.validate!==!1)&&wa(this,a.call(Gs,{key:f,layerType:this.type,objectKey:m,value:b,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const f=this.paint.get(a);if(f instanceof Mo&&ya(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const Gh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class yl{constructor(a,f){this._structArray=a,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,f){return a._trim(),f&&(a.isTransferred=!0,f.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const f=Object.create(this.prototype);return f.arrayBuffer=a.arrayBuffer,f.length=a.length,f.capacity=a.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Gr(c,a=1){let f=0,m=0;return{members:c.map(b=>{const S=Gh[b.type].BYTES_PER_ELEMENT,T=f=Zh(f,Math.max(a,S)),E=b.components||1;return m=Math.max(m,S),f+=S*E,{name:b.name,type:b.type,components:E,offset:T}}),size:Zh(f,Math.max(m,a)),alignment:a}}function Zh(c,a){return Math.ceil(c/a)*a}class vl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.int16[b+0]=f,this.int16[b+1]=m,a}}vl.prototype.bytesPerElement=4,Zt("StructArrayLayout2i4",vl);class cs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const S=3*a;return this.int16[S+0]=f,this.int16[S+1]=m,this.int16[S+2]=b,a}}cs.prototype.bytesPerElement=6,Zt("StructArrayLayout3i6",cs);class Rc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const S=this.length;return this.resize(S+1),this.emplace(S,a,f,m,b)}emplace(a,f,m,b,S){const T=4*a;return this.int16[T+0]=f,this.int16[T+1]=m,this.int16[T+2]=b,this.int16[T+3]=S,a}}Rc.prototype.bytesPerElement=8,Zt("StructArrayLayout4i8",Rc);class Fc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,S,T){const E=this.length;return this.resize(E+1),this.emplace(E,a,f,m,b,S,T)}emplace(a,f,m,b,S,T,E){const R=6*a;return this.int16[R+0]=f,this.int16[R+1]=m,this.int16[R+2]=b,this.int16[R+3]=S,this.int16[R+4]=T,this.int16[R+5]=E,a}}Fc.prototype.bytesPerElement=12,Zt("StructArrayLayout2i4i12",Fc);class Oc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,S,T){const E=this.length;return this.resize(E+1),this.emplace(E,a,f,m,b,S,T)}emplace(a,f,m,b,S,T,E){const R=4*a,j=8*a;return this.int16[R+0]=f,this.int16[R+1]=m,this.uint8[j+4]=b,this.uint8[j+5]=S,this.uint8[j+6]=T,this.uint8[j+7]=E,a}}Oc.prototype.bytesPerElement=8,Zt("StructArrayLayout2i4ub8",Oc);class bl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.float32[b+0]=f,this.float32[b+1]=m,a}}bl.prototype.bytesPerElement=8,Zt("StructArrayLayout2f8",bl);class yu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,S,T,E,R,j,K){const J=this.length;return this.resize(J+1),this.emplace(J,a,f,m,b,S,T,E,R,j,K)}emplace(a,f,m,b,S,T,E,R,j,K,J){const se=10*a;return this.uint16[se+0]=f,this.uint16[se+1]=m,this.uint16[se+2]=b,this.uint16[se+3]=S,this.uint16[se+4]=T,this.uint16[se+5]=E,this.uint16[se+6]=R,this.uint16[se+7]=j,this.uint16[se+8]=K,this.uint16[se+9]=J,a}}yu.prototype.bytesPerElement=20,Zt("StructArrayLayout10ui20",yu);class $c extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,S,T,E,R,j,K,J,se){const de=this.length;return this.resize(de+1),this.emplace(de,a,f,m,b,S,T,E,R,j,K,J,se)}emplace(a,f,m,b,S,T,E,R,j,K,J,se,de){const _e=12*a;return this.int16[_e+0]=f,this.int16[_e+1]=m,this.int16[_e+2]=b,this.int16[_e+3]=S,this.uint16[_e+4]=T,this.uint16[_e+5]=E,this.uint16[_e+6]=R,this.uint16[_e+7]=j,this.int16[_e+8]=K,this.int16[_e+9]=J,this.int16[_e+10]=se,this.int16[_e+11]=de,a}}$c.prototype.bytesPerElement=24,Zt("StructArrayLayout4i4ui4i24",$c);class Bc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const S=3*a;return this.float32[S+0]=f,this.float32[S+1]=m,this.float32[S+2]=b,a}}Bc.prototype.bytesPerElement=12,Zt("StructArrayLayout3f12",Bc);class fs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint32[1*a+0]=f,a}}fs.prototype.bytesPerElement=4,Zt("StructArrayLayout1ul4",fs);class vu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,S,T,E,R,j){const K=this.length;return this.resize(K+1),this.emplace(K,a,f,m,b,S,T,E,R,j)}emplace(a,f,m,b,S,T,E,R,j,K){const J=10*a,se=5*a;return this.int16[J+0]=f,this.int16[J+1]=m,this.int16[J+2]=b,this.int16[J+3]=S,this.int16[J+4]=T,this.int16[J+5]=E,this.uint32[se+3]=R,this.uint16[J+8]=j,this.uint16[J+9]=K,a}}vu.prototype.bytesPerElement=20,Zt("StructArrayLayout6i1ul2ui20",vu);class wl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,S,T){const E=this.length;return this.resize(E+1),this.emplace(E,a,f,m,b,S,T)}emplace(a,f,m,b,S,T,E){const R=6*a;return this.int16[R+0]=f,this.int16[R+1]=m,this.int16[R+2]=b,this.int16[R+3]=S,this.int16[R+4]=T,this.int16[R+5]=E,a}}wl.prototype.bytesPerElement=12,Zt("StructArrayLayout2i2i2i12",wl);class bu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,f,m,b,S){const T=this.length;return this.resize(T+1),this.emplace(T,a,f,m,b,S)}emplace(a,f,m,b,S,T){const E=4*a,R=8*a;return this.float32[E+0]=f,this.float32[E+1]=m,this.float32[E+2]=b,this.int16[R+6]=S,this.int16[R+7]=T,a}}bu.prototype.bytesPerElement=16,Zt("StructArrayLayout2f1f2i16",bu);class xl extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const S=this.length;return this.resize(S+1),this.emplace(S,a,f,m,b)}emplace(a,f,m,b,S){const T=12*a,E=3*a;return this.uint8[T+0]=f,this.uint8[T+1]=m,this.float32[E+1]=b,this.float32[E+2]=S,a}}xl.prototype.bytesPerElement=12,Zt("StructArrayLayout2ub2f12",xl);class wu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const S=3*a;return this.uint16[S+0]=f,this.uint16[S+1]=m,this.uint16[S+2]=b,a}}wu.prototype.bytesPerElement=6,Zt("StructArrayLayout3ui6",wu);class Ta extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,S,T,E,R,j,K,J,se,de,_e,we,Ce,Pe){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,a,f,m,b,S,T,E,R,j,K,J,se,de,_e,we,Ce,Pe)}emplace(a,f,m,b,S,T,E,R,j,K,J,se,de,_e,we,Ce,Pe,Ge){const De=24*a,je=12*a,dt=48*a;return this.int16[De+0]=f,this.int16[De+1]=m,this.uint16[De+2]=b,this.uint16[De+3]=S,this.uint32[je+2]=T,this.uint32[je+3]=E,this.uint32[je+4]=R,this.uint16[De+10]=j,this.uint16[De+11]=K,this.uint16[De+12]=J,this.float32[je+7]=se,this.float32[je+8]=de,this.uint8[dt+36]=_e,this.uint8[dt+37]=we,this.uint8[dt+38]=Ce,this.uint32[je+10]=Pe,this.int16[De+22]=Ge,a}}Ta.prototype.bytesPerElement=48,Zt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ta);class Zs extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b,S,T,E,R,j,K,J,se,de,_e,we,Ce,Pe,Ge,De,je,dt,vt,Ht,tn,qt,Ut,Ot,Kt){const Nt=this.length;return this.resize(Nt+1),this.emplace(Nt,a,f,m,b,S,T,E,R,j,K,J,se,de,_e,we,Ce,Pe,Ge,De,je,dt,vt,Ht,tn,qt,Ut,Ot,Kt)}emplace(a,f,m,b,S,T,E,R,j,K,J,se,de,_e,we,Ce,Pe,Ge,De,je,dt,vt,Ht,tn,qt,Ut,Ot,Kt,Nt){const At=32*a,cn=16*a;return this.int16[At+0]=f,this.int16[At+1]=m,this.int16[At+2]=b,this.int16[At+3]=S,this.int16[At+4]=T,this.int16[At+5]=E,this.int16[At+6]=R,this.int16[At+7]=j,this.uint16[At+8]=K,this.uint16[At+9]=J,this.uint16[At+10]=se,this.uint16[At+11]=de,this.uint16[At+12]=_e,this.uint16[At+13]=we,this.uint16[At+14]=Ce,this.uint16[At+15]=Pe,this.uint16[At+16]=Ge,this.uint16[At+17]=De,this.uint16[At+18]=je,this.uint16[At+19]=dt,this.uint16[At+20]=vt,this.uint16[At+21]=Ht,this.uint16[At+22]=tn,this.uint32[cn+12]=qt,this.float32[cn+13]=Ut,this.float32[cn+14]=Ot,this.uint16[At+30]=Kt,this.uint16[At+31]=Nt,a}}Zs.prototype.bytesPerElement=64,Zt("StructArrayLayout8i15ui1ul2f2ui64",Zs);class xu extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.float32[1*a+0]=f,a}}xu.prototype.bytesPerElement=4,Zt("StructArrayLayout1f4",xu);class ku extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const S=3*a;return this.uint16[6*a+0]=f,this.float32[S+1]=m,this.float32[S+2]=b,a}}ku.prototype.bytesPerElement=12,Zt("StructArrayLayout1ui2f12",ku);class Ks extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f,m){const b=this.length;return this.resize(b+1),this.emplace(b,a,f,m)}emplace(a,f,m,b){const S=4*a;return this.uint32[2*a+0]=f,this.uint16[S+2]=m,this.uint16[S+3]=b,a}}Ks.prototype.bytesPerElement=8,Zt("StructArrayLayout1ul2ui8",Ks);class Nc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,f){const m=this.length;return this.resize(m+1),this.emplace(m,a,f)}emplace(a,f,m){const b=2*a;return this.uint16[b+0]=f,this.uint16[b+1]=m,a}}Nc.prototype.bytesPerElement=4,Zt("StructArrayLayout2ui4",Nc);class jc extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const f=this.length;return this.resize(f+1),this.emplace(f,a)}emplace(a,f){return this.uint16[1*a+0]=f,a}}jc.prototype.bytesPerElement=2,Zt("StructArrayLayout1ui2",jc);class Su extends Nr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,f,m,b){const S=this.length;return this.resize(S+1),this.emplace(S,a,f,m,b)}emplace(a,f,m,b,S){const T=4*a;return this.float32[T+0]=f,this.float32[T+1]=m,this.float32[T+2]=b,this.float32[T+3]=S,a}}Su.prototype.bytesPerElement=16,Zt("StructArrayLayout4f16",Su);class Kh extends yl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new _(this.anchorPointX,this.anchorPointY)}}Kh.prototype.size=20;class w extends vu{get(a){return new Kh(this,a)}}Zt("CollisionBoxArray",w);class l extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}l.prototype.size=48;class h extends Ta{get(a){return new l(this,a)}}Zt("PlacedSymbolArray",h);class y extends yl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}y.prototype.size=64;class v extends Zs{get(a){return new y(this,a)}}Zt("SymbolInstanceArray",v);class k extends xu{getoffsetX(a){return this.float32[1*a+0]}}Zt("GlyphOffsetArray",k);class z extends cs{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}Zt("SymbolLineVertexArray",z);class D extends yl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}D.prototype.size=12;class B extends ku{get(a){return new D(this,a)}}Zt("TextAnchorOffsetArray",B);class G extends yl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}G.prototype.size=8;class Q extends Ks{get(a){return new G(this,a)}}Zt("FeatureIndexArray",Q);class te extends vl{}class me extends vl{}class Se extends vl{}class ke extends Fc{}class Me extends Oc{}class be extends bl{}class Re extends yu{}class tt extends $c{}class Ie extends Bc{}class Ve extends fs{}class rt extends wl{}class st extends xl{}class ft extends wu{}class Ct extends Nc{}const wt=Gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ft}=wt;class $t{constructor(a=[]){this.segments=a}prepareSegment(a,f,m,b){let S=this.segments[this.segments.length-1];return a>$t.MAX_VERTEX_ARRAY_LENGTH&&ve(`Max vertices per segment is ${$t.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!S||S.vertexLength+a>$t.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==b)&&(S={vertexOffset:f.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0},b!==void 0&&(S.sortKey=b),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const a of this.segments)for(const f in a.vaos)a.vaos[f].destroy()}static simpleSegment(a,f,m,b){return new $t([{vertexOffset:a,primitiveOffset:f,vertexLength:m,primitiveLength:b,vaos:{},sortKey:0}])}}function Sn(c,a){return 256*(c=Z(Math.floor(c),0,255))+Z(Math.floor(a),0,255)}$t.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt("SegmentVector",$t);const Bt=Gr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var gn={exports:{}},Tn={exports:{}};Tn.exports=function(c,a){var f,m,b,S,T,E,R,j;for(m=c.length-(f=3&c.length),b=a,T=3432918353,E=461845907,j=0;j<m;)R=255&c.charCodeAt(j)|(255&c.charCodeAt(++j))<<8|(255&c.charCodeAt(++j))<<16|(255&c.charCodeAt(++j))<<24,++j,b=27492+(65535&(S=5*(65535&(b=(b^=R=(65535&(R=(R=(65535&R)*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*E+(((R>>>16)*E&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(R=0,f){case 3:R^=(255&c.charCodeAt(j+2))<<16;case 2:R^=(255&c.charCodeAt(j+1))<<8;case 1:b^=R=(65535&(R=(R=(65535&(R^=255&c.charCodeAt(j)))*T+(((R>>>16)*T&65535)<<16)&4294967295)<<15|R>>>17))*E+(((R>>>16)*E&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var qn=Tn.exports,kn={exports:{}};kn.exports=function(c,a){for(var f,m=c.length,b=a^m,S=0;m>=4;)f=1540483477*(65535&(f=255&c.charCodeAt(S)|(255&c.charCodeAt(++S))<<8|(255&c.charCodeAt(++S))<<16|(255&c.charCodeAt(++S))<<24))+((1540483477*(f>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),m-=4,++S;switch(m){case 3:b^=(255&c.charCodeAt(S+2))<<16;case 2:b^=(255&c.charCodeAt(S+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(S)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var En=qn,Rn=kn.exports;gn.exports=En,gn.exports.murmur3=En,gn.exports.murmur2=Rn;var jr=d(gn.exports);class lr{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,f,m,b){this.ids.push(no(a)),this.positions.push(f,m,b)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=no(a);let m=0,b=this.ids.length-1;for(;m<b;){const T=m+b>>1;this.ids[T]>=f?b=T:m=T+1}const S=[];for(;this.ids[m]===f;)S.push({index:this.positions[3*m],start:this.positions[3*m+1],end:this.positions[3*m+2]}),m++;return S}static serialize(a,f){const m=new Float64Array(a.ids),b=new Uint32Array(a.positions);return oi(m,b,0,m.length-1),f&&f.push(m.buffer,b.buffer),{ids:m,positions:b}}static deserialize(a){const f=new lr;return f.ids=a.ids,f.positions=a.positions,f.indexed=!0,f}}function no(c){const a=+c;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:jr(String(c))}function oi(c,a,f,m){for(;f<m;){const b=c[f+m>>1];let S=f-1,T=m+1;for(;;){do S++;while(c[S]<b);do T--;while(c[T]>b);if(S>=T)break;Dr(c,S,T),Dr(a,3*S,3*T),Dr(a,3*S+1,3*T+1),Dr(a,3*S+2,3*T+2)}T-f<m-T?(oi(c,a,f,T),f=T+1):(oi(c,a,T+1,m),m=T)}}function Dr(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}Zt("FeaturePositionMap",lr);class si{constructor(a,f){this.gl=a.gl,this.location=f}}class ro extends si{constructor(a,f){super(a,f),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ko extends si{constructor(a,f){super(a,f),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class As extends si{constructor(a,f){super(a,f),this.current=sr.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const kl=new Float32Array(16);function Ps(c){return[Sn(255*c.r,255*c.g),Sn(255*c.b,255*c.a)]}class Xo{constructor(a,f,m){this.value=a,this.uniformNames=f.map(b=>`u_${b}`),this.type=m}setUniform(a,f,m){a.set(m.constantOr(this.value))}getBinding(a,f,m){return this.type==="color"?new As(a,f):new ro(a,f)}}class Yr{constructor(a,f){this.uniformNames=f.map(m=>`u_${m}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=a.tlbr}setUniform(a,f,m,b){const S=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&a.set(S)}getBinding(a,f,m){return m.substr(0,9)==="u_pattern"?new Ko(a,f):new ro(a,f)}}class Rr{constructor(a,f,m,b){this.expression=a,this.type=m,this.maxValue=0,this.paintVertexAttributes=f.map(S=>({name:`a_${S}`,type:"Float32",components:m==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(a,f,m,b,S){const T=this.paintVertexArray.length,E=this.expression.evaluate(new Er(0),f,{},b,[],S);this.paintVertexArray.resize(a),this._setPaintValue(T,a,E)}updatePaintArray(a,f,m,b){const S=this.expression.evaluate({zoom:0},m,b);this._setPaintValue(a,f,S)}_setPaintValue(a,f,m){if(this.type==="color"){const b=Ps(m);for(let S=a;S<f;S++)this.paintVertexArray.emplace(S,b[0],b[1])}else{for(let b=a;b<f;b++)this.paintVertexArray.emplace(b,m);this.maxValue=Math.max(this.maxValue,Math.abs(m))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Lr{constructor(a,f,m,b,S,T){this.expression=a,this.uniformNames=f.map(E=>`u_${E}_t`),this.type=m,this.useIntegerZoom=b,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=f.map(E=>({name:`a_${E}`,type:"Float32",components:m==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(a,f,m,b,S){const T=this.expression.evaluate(new Er(this.zoom),f,{},b,[],S),E=this.expression.evaluate(new Er(this.zoom+1),f,{},b,[],S),R=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(R,a,T,E)}updatePaintArray(a,f,m,b){const S=this.expression.evaluate({zoom:this.zoom},m,b),T=this.expression.evaluate({zoom:this.zoom+1},m,b);this._setPaintValue(a,f,S,T)}_setPaintValue(a,f,m,b){if(this.type==="color"){const S=Ps(m),T=Ps(b);for(let E=a;E<f;E++)this.paintVertexArray.emplace(E,S[0],S[1],T[0],T[1])}else{for(let S=a;S<f;S++)this.paintVertexArray.emplace(S,m,b);this.maxValue=Math.max(this.maxValue,Math.abs(m),Math.abs(b))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,f){const m=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,b=Z(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);a.set(b)}getBinding(a,f,m){return new ro(a,f)}}class mo{constructor(a,f,m,b,S,T){this.expression=a,this.type=f,this.useIntegerZoom=m,this.zoom=b,this.layerId=T,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(a,f,m){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(b,a,f.patterns&&f.patterns[this.layerId],m)}updatePaintArray(a,f,m,b,S){this._setPaintValues(a,f,m.patterns&&m.patterns[this.layerId],S)}_setPaintValues(a,f,m,b){if(!b||!m)return;const{min:S,mid:T,max:E}=m,R=b[S],j=b[T],K=b[E];if(R&&j&&K)for(let J=a;J<f;J++)this.zoomInPaintVertexArray.emplace(J,j.tl[0],j.tl[1],j.br[0],j.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],j.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(J,j.tl[0],j.tl[1],j.br[0],j.br[1],K.tl[0],K.tl[1],K.br[0],K.br[1],j.pixelRatio,K.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,Bt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,Bt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Jr{constructor(a,f,m){this.binders={},this._buffers=[];const b=[];for(const S in a.paint._values){if(!m(S))continue;const T=a.paint.get(S);if(!(T instanceof Mo&&ya(T.property.specification)))continue;const E=go(S,a.type),R=T.value,j=T.property.specification.type,K=T.property.useIntegerZoom,J=T.property.specification["property-type"],se=J==="cross-faded"||J==="cross-faded-data-driven";if(R.kind==="constant")this.binders[S]=se?new Yr(R.value,E):new Xo(R.value,E,j),b.push(`/u_${S}`);else if(R.kind==="source"||se){const de=Qr(S,j,"source");this.binders[S]=se?new mo(R,j,K,f,de,a.id):new Rr(R,E,j,de),b.push(`/a_${S}`)}else{const de=Qr(S,j,"composite");this.binders[S]=new Lr(R,E,j,K,f,de),b.push(`/z_${S}`)}}this.cacheKey=b.sort().join("")}getMaxValue(a){const f=this.binders[a];return f instanceof Rr||f instanceof Lr?f.maxValue:0}populatePaintArrays(a,f,m,b,S){for(const T in this.binders){const E=this.binders[T];(E instanceof Rr||E instanceof Lr||E instanceof mo)&&E.populatePaintArray(a,f,m,b,S)}}setConstantPatternPositions(a,f){for(const m in this.binders){const b=this.binders[m];b instanceof Yr&&b.setConstantPatternPositions(a,f)}}updatePaintArrays(a,f,m,b,S){let T=!1;for(const E in a){const R=f.getPositions(E);for(const j of R){const K=m.feature(j.index);for(const J in this.binders){const se=this.binders[J];if((se instanceof Rr||se instanceof Lr||se instanceof mo)&&se.expression.isStateDependent===!0){const de=b.paint.get(J);se.expression=de.value,se.updatePaintArray(j.start,j.end,K,a[E],S),T=!0}}}}return T}defines(){const a=[];for(const f in this.binders){const m=this.binders[f];(m instanceof Xo||m instanceof Yr)&&a.push(...m.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return a}getBinderAttributes(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Rr||m instanceof Lr)for(let b=0;b<m.paintVertexAttributes.length;b++)a.push(m.paintVertexAttributes[b].name);else if(m instanceof mo)for(let b=0;b<Bt.members.length;b++)a.push(Bt.members[b].name)}return a}getBinderUniforms(){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Xo||m instanceof Yr||m instanceof Lr)for(const b of m.uniformNames)a.push(b)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,f){const m=[];for(const b in this.binders){const S=this.binders[b];if(S instanceof Xo||S instanceof Yr||S instanceof Lr){for(const T of S.uniformNames)if(f[T]){const E=S.getBinding(a,f[T],T);m.push({name:T,property:b,binding:E})}}}return m}setUniforms(a,f,m,b){for(const{name:S,property:T,binding:E}of f)this.binders[T].setUniform(E,b,m.get(T),S)}updatePaintBuffers(a){this._buffers=[];for(const f in this.binders){const m=this.binders[f];if(a&&m instanceof mo){const b=a.fromScale===2?m.zoomInPaintVertexBuffer:m.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(m instanceof Rr||m instanceof Lr)&&m.paintVertexBuffer&&this._buffers.push(m.paintVertexBuffer)}}upload(a){for(const f in this.binders){const m=this.binders[f];(m instanceof Rr||m instanceof Lr||m instanceof mo)&&m.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const f=this.binders[a];(f instanceof Rr||f instanceof Lr||f instanceof mo)&&f.destroy()}}}class Fr{constructor(a,f,m=()=>!0){this.programConfigurations={};for(const b of a)this.programConfigurations[b.id]=new Jr(b,f,m);this.needsUpload=!1,this._featureMap=new lr,this._bufferOffset=0}populatePaintArrays(a,f,m,b,S,T){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(a,f,b,S,T);f.id!==void 0&&this._featureMap.add(f.id,m,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,f,m,b){for(const S of m)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(a,this._featureMap,f,S,b)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function go(c,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${a}-`,"").replace(/-/g,"_")]}function Qr(c,a,f){const m={color:{source:bl,composite:Su},number:{source:xu,composite:bl}},b=function(S){return{"line-pattern":{source:Re,composite:Re},"fill-pattern":{source:Re,composite:Re},"fill-extrusion-pattern":{source:Re,composite:Re}}[S]}(c);return b&&b[f]||m[a][f]}Zt("ConstantBinder",Xo),Zt("CrossFadedConstantBinder",Yr),Zt("SourceExpressionBinder",Rr),Zt("CrossFadedCompositeBinder",mo),Zt("CompositeExpressionBinder",Lr),Zt("ProgramConfiguration",Jr,{omit:["_buffers"]}),Zt("ProgramConfigurationSet",Fr);const qr=8192,Uc=Math.pow(2,14)-1,Xh=-Uc-1;function Xs(c){const a=qr/c.extent,f=c.loadGeometry();for(let m=0;m<f.length;m++){const b=f[m];for(let S=0;S<b.length;S++){const T=b[S],E=Math.round(T.x*a),R=Math.round(T.y*a);T.x=Z(E,Xh,Uc),T.y=Z(R,Xh,Uc),(E<T.x||E>T.x+1||R<T.y||R>T.y+1)&&ve("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function Ys(c,a){return{type:c.type,id:c.id,properties:c.properties,geometry:a?Xs(c):[]}}function Tu(c,a,f,m,b){c.emplaceBack(2*a+(m+1)/2,2*f+(b+1)/2)}class zs{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new me,this.indexArray=new ft,this.segments=new $t,this.programConfigurations=new Fr(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){const b=this.layers[0],S=[];let T=null,E=!1;b.type==="circle"&&(T=b.layout.get("circle-sort-key"),E=!T.isConstant());for(const{feature:R,id:j,index:K,sourceLayerIndex:J}of a){const se=this.layers[0]._featureFilter.needGeometry,de=Ys(R,se);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),de,m))continue;const _e=E?T.evaluate(de,{},m):void 0,we={id:j,properties:R.properties,type:R.type,sourceLayerIndex:J,index:K,geometry:se?de.geometry:Xs(R),patterns:{},sortKey:_e};S.push(we)}E&&S.sort((R,j)=>R.sortKey-j.sortKey);for(const R of S){const{geometry:j,index:K,sourceLayerIndex:J}=R,se=a[K].feature;this.addFeature(R,j,K,m),f.featureIndex.insert(se,j,K,J,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Ft),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,f,m,b){for(const S of f)for(const T of S){const E=T.x,R=T.y;if(E<0||E>=qr||R<0||R>=qr)continue;const j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),K=j.vertexLength;Tu(this.layoutVertexArray,E,R,-1,-1),Tu(this.layoutVertexArray,E,R,1,-1),Tu(this.layoutVertexArray,E,R,1,1),Tu(this.layoutVertexArray,E,R,-1,1),this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+3,K+2),j.vertexLength+=4,j.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,{},b)}}function Vc(c,a){for(let f=0;f<c.length;f++)if(Mu(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(Mu(c,a[f]))return!0;return!!Cu(c,a)}function Yh(c,a,f){return!!Mu(c,a)||!!Bp(a,c,f)}function qc(c,a){if(c.length===1)return h_(a,c[0]);for(let f=0;f<a.length;f++){const m=a[f];for(let b=0;b<m.length;b++)if(Mu(c,m[b]))return!0}for(let f=0;f<c.length;f++)if(h_(a,c[f]))return!0;for(let f=0;f<a.length;f++)if(Cu(c,a[f]))return!0;return!1}function Hc(c,a,f){if(c.length>1){if(Cu(c,a))return!0;for(let m=0;m<a.length;m++)if(Bp(a[m],c,f))return!0}for(let m=0;m<c.length;m++)if(Bp(c[m],a,f))return!0;return!1}function Cu(c,a){if(c.length===0||a.length===0)return!1;for(let f=0;f<c.length-1;f++){const m=c[f],b=c[f+1];for(let S=0;S<a.length-1;S++)if(Wc(m,b,a[S],a[S+1]))return!0}return!1}function Wc(c,a,f,m){return ye(c,f,m)!==ye(a,f,m)&&ye(c,a,f)!==ye(c,a,m)}function Bp(c,a,f){const m=f*f;if(a.length===1)return c.distSqr(a[0])<m;for(let b=1;b<a.length;b++)if(f_(c,a[b-1],a[b])<m)return!0;return!1}function f_(c,a,f){const m=a.distSqr(f);if(m===0)return c.distSqr(a);const b=((c.x-a.x)*(f.x-a.x)+(c.y-a.y)*(f.y-a.y))/m;return c.distSqr(b<0?a:b>1?f:f.sub(a)._mult(b)._add(a))}function h_(c,a){let f,m,b,S=!1;for(let T=0;T<c.length;T++){f=c[T];for(let E=0,R=f.length-1;E<f.length;R=E++)m=f[E],b=f[R],m.y>a.y!=b.y>a.y&&a.x<(b.x-m.x)*(a.y-m.y)/(b.y-m.y)+m.x&&(S=!S)}return S}function Mu(c,a){let f=!1;for(let m=0,b=c.length-1;m<c.length;b=m++){const S=c[m],T=c[b];S.y>a.y!=T.y>a.y&&a.x<(T.x-S.x)*(a.y-S.y)/(T.y-S.y)+S.x&&(f=!f)}return f}function ex(c,a,f){const m=f[0],b=f[2];if(c.x<m.x&&a.x<m.x||c.x>b.x&&a.x>b.x||c.y<m.y&&a.y<m.y||c.y>b.y&&a.y>b.y)return!1;const S=ye(c,a,f[0]);return S!==ye(c,a,f[1])||S!==ye(c,a,f[2])||S!==ye(c,a,f[3])}function Gc(c,a,f){const m=a.paint.get(c).value;return m.kind==="constant"?m.value:f.programConfigurations.get(a.id).getMaxValue(c)}function Jh(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Qh(c,a,f,m,b){if(!a[0]&&!a[1])return c;const S=_.convert(a)._mult(b);f==="viewport"&&S._rotate(-m);const T=[];for(let E=0;E<c.length;E++)T.push(c[E].sub(S));return T}let d_,p_;Zt("CircleBucket",zs,{omit:["layers"]});var tx={get paint(){return p_=p_||new Bi({"circle-radius":new hn(pe.paint_circle["circle-radius"]),"circle-color":new hn(pe.paint_circle["circle-color"]),"circle-blur":new hn(pe.paint_circle["circle-blur"]),"circle-opacity":new hn(pe.paint_circle["circle-opacity"]),"circle-translate":new sn(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new sn(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new sn(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new sn(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new hn(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new hn(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new hn(pe.paint_circle["circle-stroke-opacity"])})},get layout(){return d_=d_||new Bi({"circle-sort-key":new hn(pe.layout_circle["circle-sort-key"])})}},Ni=1e-6,Eu=typeof Float32Array<"u"?Float32Array:Array;function Np(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function m_(c,a,f){var m=a[0],b=a[1],S=a[2],T=a[3],E=a[4],R=a[5],j=a[6],K=a[7],J=a[8],se=a[9],de=a[10],_e=a[11],we=a[12],Ce=a[13],Pe=a[14],Ge=a[15],De=f[0],je=f[1],dt=f[2],vt=f[3];return c[0]=De*m+je*E+dt*J+vt*we,c[1]=De*b+je*R+dt*se+vt*Ce,c[2]=De*S+je*j+dt*de+vt*Pe,c[3]=De*T+je*K+dt*_e+vt*Ge,c[4]=(De=f[4])*m+(je=f[5])*E+(dt=f[6])*J+(vt=f[7])*we,c[5]=De*b+je*R+dt*se+vt*Ce,c[6]=De*S+je*j+dt*de+vt*Pe,c[7]=De*T+je*K+dt*_e+vt*Ge,c[8]=(De=f[8])*m+(je=f[9])*E+(dt=f[10])*J+(vt=f[11])*we,c[9]=De*b+je*R+dt*se+vt*Ce,c[10]=De*S+je*j+dt*de+vt*Pe,c[11]=De*T+je*K+dt*_e+vt*Ge,c[12]=(De=f[12])*m+(je=f[13])*E+(dt=f[14])*J+(vt=f[15])*we,c[13]=De*b+je*R+dt*se+vt*Ce,c[14]=De*S+je*j+dt*de+vt*Pe,c[15]=De*T+je*K+dt*_e+vt*Ge,c}Math.hypot||(Math.hypot=function(){for(var c=0,a=arguments.length;a--;)c+=arguments[a]*arguments[a];return Math.sqrt(c)});var Zc,nx=m_;function ed(c,a,f){var m=a[0],b=a[1],S=a[2],T=a[3];return c[0]=f[0]*m+f[4]*b+f[8]*S+f[12]*T,c[1]=f[1]*m+f[5]*b+f[9]*S+f[13]*T,c[2]=f[2]*m+f[6]*b+f[10]*S+f[14]*T,c[3]=f[3]*m+f[7]*b+f[11]*S+f[15]*T,c}Zc=new Eu(4),Eu!=Float32Array&&(Zc[0]=0,Zc[1]=0,Zc[2]=0,Zc[3]=0);class rx extends Eo{constructor(a){super(a,tx)}createBucket(a){return new zs(a)}queryRadius(a){const f=a;return Gc("circle-radius",this,f)+Gc("circle-stroke-width",this,f)+Jh(this.paint.get("circle-translate"))}queryIntersectsFeature(a,f,m,b,S,T,E,R){const j=Qh(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,E),K=this.paint.get("circle-radius").evaluate(f,m)+this.paint.get("circle-stroke-width").evaluate(f,m),J=this.paint.get("circle-pitch-alignment")==="map",se=J?j:function(_e,we){return _e.map(Ce=>g_(Ce,we))}(j,R),de=J?K*E:K;for(const _e of b)for(const we of _e){const Ce=J?we:g_(we,R);let Pe=de;const Ge=ed([],[we.x,we.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=Ge[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=T.cameraToCenterDistance/Ge[3]),Yh(se,Ce,Pe))return!0}return!1}}function g_(c,a){const f=ed([],[c.x,c.y,0,1],a);return new _(f[0]/f[3],f[1]/f[3])}class __ extends zs{}let y_;Zt("HeatmapBucket",__,{omit:["layers"]});var ix={get paint(){return y_=y_||new Bi({"heatmap-radius":new hn(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new hn(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new sn(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new zc(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new sn(pe.paint_heatmap["heatmap-opacity"])})}};function jp(c,{width:a,height:f},m,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==a*f*m)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${a*f*m}`)}else b=new Uint8Array(a*f*m);return c.width=a,c.height=f,c.data=b,c}function v_(c,{width:a,height:f},m){if(a===c.width&&f===c.height)return;const b=jp({},{width:a,height:f},m);Up(c,b,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,a),height:Math.min(c.height,f)},m),c.width=a,c.height=f,c.data=b.data}function Up(c,a,f,m,b,S){if(b.width===0||b.height===0)return a;if(b.width>c.width||b.height>c.height||f.x>c.width-b.width||f.y>c.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>a.width||b.height>a.height||m.x>a.width-b.width||m.y>a.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const T=c.data,E=a.data;if(T===E)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<b.height;R++){const j=((f.y+R)*c.width+f.x)*S,K=((m.y+R)*a.width+m.x)*S;for(let J=0;J<b.width*S;J++)E[K+J]=T[j+J]}return a}class Kc{constructor(a,f){jp(this,a,1,f)}resize(a){v_(this,a,1)}clone(){return new Kc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,S){Up(a,f,m,b,S,1)}}class Lo{constructor(a,f){jp(this,a,4,f)}resize(a){v_(this,a,4)}replace(a,f){f?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Lo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,f,m,b,S){Up(a,f,m,b,S,4)}}function b_(c){const a={},f=c.resolution||256,m=c.clips?c.clips.length:1,b=c.image||new Lo({width:f,height:m});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const S=(T,E,R)=>{a[c.evaluationKey]=R;const j=c.expression.evaluate(a);b.data[T+E+0]=Math.floor(255*j.r/j.a),b.data[T+E+1]=Math.floor(255*j.g/j.a),b.data[T+E+2]=Math.floor(255*j.b/j.a),b.data[T+E+3]=Math.floor(255*j.a)};if(c.clips)for(let T=0,E=0;T<m;++T,E+=4*f)for(let R=0,j=0;R<f;R++,j+=4){const K=R/(f-1),{start:J,end:se}=c.clips[T];S(E,j,J*(1-K)+se*K)}else for(let T=0,E=0;T<f;T++,E+=4)S(0,E,T/(f-1));return b}Zt("AlphaImage",Kc),Zt("RGBAImage",Lo);class ox extends Eo{createBucket(a){return new __(a)}constructor(a){super(a,ix),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=b_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let w_;var sx={get paint(){return w_=w_||new Bi({"hillshade-illumination-direction":new sn(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new sn(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new sn(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new sn(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new sn(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new sn(pe.paint_hillshade["hillshade-accent-color"])})}};class ax extends Eo{constructor(a){super(a,sx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const lx=Gr([{name:"a_pos",components:2,type:"Int16"}],4),{members:ux}=lx;var Vp={exports:{}};function td(c,a,f){f=f||2;var m,b,S,T,E,R,j,K=a&&a.length,J=K?a[0]*f:c.length,se=x_(c,0,J,f,!0),de=[];if(!se||se.next===se.prev)return de;if(K&&(se=function(we,Ce,Pe,Ge){var De,je,dt,vt=[];for(De=0,je=Ce.length;De<je;De++)(dt=x_(we,Ce[De]*Ge,De<je-1?Ce[De+1]*Ge:we.length,Ge,!1))===dt.next&&(dt.steiner=!0),vt.push(_x(dt));for(vt.sort(px),De=0;De<vt.length;De++)Pe=mx(vt[De],Pe);return Pe}(c,a,se,f)),c.length>80*f){m=S=c[0],b=T=c[1];for(var _e=f;_e<J;_e+=f)(E=c[_e])<m&&(m=E),(R=c[_e+1])<b&&(b=R),E>S&&(S=E),R>T&&(T=R);j=(j=Math.max(S-m,T-b))!==0?32767/j:0}return Xc(se,de,f,m,b,j,0),de}function x_(c,a,f,m,b){var S,T;if(b===Wp(c,a,f,m)>0)for(S=a;S<f;S+=m)T=T_(S,c[S],c[S+1],T);else for(S=f-m;S>=a;S-=m)T=T_(S,c[S],c[S+1],T);return T&&nd(T,T.next)&&(Jc(T),T=T.next),T}function Sl(c,a){if(!c)return c;a||(a=c);var f,m=c;do if(f=!1,m.steiner||!nd(m,m.next)&&Zr(m.prev,m,m.next)!==0)m=m.next;else{if(Jc(m),(m=a=m.prev)===m.next)break;f=!0}while(f||m!==a);return a}function Xc(c,a,f,m,b,S,T){if(c){!T&&S&&function(K,J,se,de){var _e=K;do _e.z===0&&(_e.z=qp(_e.x,_e.y,J,se,de)),_e.prevZ=_e.prev,_e.nextZ=_e.next,_e=_e.next;while(_e!==K);_e.prevZ.nextZ=null,_e.prevZ=null,function(we){var Ce,Pe,Ge,De,je,dt,vt,Ht,tn=1;do{for(Pe=we,we=null,je=null,dt=0;Pe;){for(dt++,Ge=Pe,vt=0,Ce=0;Ce<tn&&(vt++,Ge=Ge.nextZ);Ce++);for(Ht=tn;vt>0||Ht>0&&Ge;)vt!==0&&(Ht===0||!Ge||Pe.z<=Ge.z)?(De=Pe,Pe=Pe.nextZ,vt--):(De=Ge,Ge=Ge.nextZ,Ht--),je?je.nextZ=De:we=De,De.prevZ=je,je=De;Pe=Ge}je.nextZ=null,tn*=2}while(dt>1)}(_e)}(c,m,b,S);for(var E,R,j=c;c.prev!==c.next;)if(E=c.prev,R=c.next,S?fx(c,m,b,S):cx(c))a.push(E.i/f|0),a.push(c.i/f|0),a.push(R.i/f|0),Jc(c),c=R.next,j=R.next;else if((c=R)===j){T?T===1?Xc(c=hx(Sl(c),a,f),a,f,m,b,S,2):T===2&&dx(c,a,f,m,b,S):Xc(Sl(c),a,f,m,b,S,1);break}}}function cx(c){var a=c.prev,f=c,m=c.next;if(Zr(a,f,m)>=0)return!1;for(var b=a.x,S=f.x,T=m.x,E=a.y,R=f.y,j=m.y,K=b<S?b<T?b:T:S<T?S:T,J=E<R?E<j?E:j:R<j?R:j,se=b>S?b>T?b:T:S>T?S:T,de=E>R?E>j?E:j:R>j?R:j,_e=m.next;_e!==a;){if(_e.x>=K&&_e.x<=se&&_e.y>=J&&_e.y<=de&&Lu(b,E,S,R,T,j,_e.x,_e.y)&&Zr(_e.prev,_e,_e.next)>=0)return!1;_e=_e.next}return!0}function fx(c,a,f,m){var b=c.prev,S=c,T=c.next;if(Zr(b,S,T)>=0)return!1;for(var E=b.x,R=S.x,j=T.x,K=b.y,J=S.y,se=T.y,de=E<R?E<j?E:j:R<j?R:j,_e=K<J?K<se?K:se:J<se?J:se,we=E>R?E>j?E:j:R>j?R:j,Ce=K>J?K>se?K:se:J>se?J:se,Pe=qp(de,_e,a,f,m),Ge=qp(we,Ce,a,f,m),De=c.prevZ,je=c.nextZ;De&&De.z>=Pe&&je&&je.z<=Ge;){if(De.x>=de&&De.x<=we&&De.y>=_e&&De.y<=Ce&&De!==b&&De!==T&&Lu(E,K,R,J,j,se,De.x,De.y)&&Zr(De.prev,De,De.next)>=0||(De=De.prevZ,je.x>=de&&je.x<=we&&je.y>=_e&&je.y<=Ce&&je!==b&&je!==T&&Lu(E,K,R,J,j,se,je.x,je.y)&&Zr(je.prev,je,je.next)>=0))return!1;je=je.nextZ}for(;De&&De.z>=Pe;){if(De.x>=de&&De.x<=we&&De.y>=_e&&De.y<=Ce&&De!==b&&De!==T&&Lu(E,K,R,J,j,se,De.x,De.y)&&Zr(De.prev,De,De.next)>=0)return!1;De=De.prevZ}for(;je&&je.z<=Ge;){if(je.x>=de&&je.x<=we&&je.y>=_e&&je.y<=Ce&&je!==b&&je!==T&&Lu(E,K,R,J,j,se,je.x,je.y)&&Zr(je.prev,je,je.next)>=0)return!1;je=je.nextZ}return!0}function hx(c,a,f){var m=c;do{var b=m.prev,S=m.next.next;!nd(b,S)&&k_(b,m,m.next,S)&&Yc(b,S)&&Yc(S,b)&&(a.push(b.i/f|0),a.push(m.i/f|0),a.push(S.i/f|0),Jc(m),Jc(m.next),m=c=S),m=m.next}while(m!==c);return Sl(m)}function dx(c,a,f,m,b,S){var T=c;do{for(var E=T.next.next;E!==T.prev;){if(T.i!==E.i&&yx(T,E)){var R=S_(T,E);return T=Sl(T,T.next),R=Sl(R,R.next),Xc(T,a,f,m,b,S,0),void Xc(R,a,f,m,b,S,0)}E=E.next}T=T.next}while(T!==c)}function px(c,a){return c.x-a.x}function mx(c,a){var f=function(b,S){var T,E=S,R=b.x,j=b.y,K=-1/0;do{if(j<=E.y&&j>=E.next.y&&E.next.y!==E.y){var J=E.x+(j-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(J<=R&&J>K&&(K=J,T=E.x<E.next.x?E:E.next,J===R))return T}E=E.next}while(E!==S);if(!T)return null;var se,de=T,_e=T.x,we=T.y,Ce=1/0;E=T;do R>=E.x&&E.x>=_e&&R!==E.x&&Lu(j<we?R:K,j,_e,we,j<we?K:R,j,E.x,E.y)&&(se=Math.abs(j-E.y)/(R-E.x),Yc(E,b)&&(se<Ce||se===Ce&&(E.x>T.x||E.x===T.x&&gx(T,E)))&&(T=E,Ce=se)),E=E.next;while(E!==de);return T}(c,a);if(!f)return a;var m=S_(f,c);return Sl(m,m.next),Sl(f,f.next)}function gx(c,a){return Zr(c.prev,c,a.prev)<0&&Zr(a.next,c,c.next)<0}function qp(c,a,f,m,b){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-f)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-m)*b|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function _x(c){var a=c,f=c;do(a.x<f.x||a.x===f.x&&a.y<f.y)&&(f=a),a=a.next;while(a!==c);return f}function Lu(c,a,f,m,b,S,T,E){return(b-T)*(a-E)>=(c-T)*(S-E)&&(c-T)*(m-E)>=(f-T)*(a-E)&&(f-T)*(S-E)>=(b-T)*(m-E)}function yx(c,a){return c.next.i!==a.i&&c.prev.i!==a.i&&!function(f,m){var b=f;do{if(b.i!==f.i&&b.next.i!==f.i&&b.i!==m.i&&b.next.i!==m.i&&k_(b,b.next,f,m))return!0;b=b.next}while(b!==f);return!1}(c,a)&&(Yc(c,a)&&Yc(a,c)&&function(f,m){var b=f,S=!1,T=(f.x+m.x)/2,E=(f.y+m.y)/2;do b.y>E!=b.next.y>E&&b.next.y!==b.y&&T<(b.next.x-b.x)*(E-b.y)/(b.next.y-b.y)+b.x&&(S=!S),b=b.next;while(b!==f);return S}(c,a)&&(Zr(c.prev,c,a.prev)||Zr(c,a.prev,a))||nd(c,a)&&Zr(c.prev,c,c.next)>0&&Zr(a.prev,a,a.next)>0)}function Zr(c,a,f){return(a.y-c.y)*(f.x-a.x)-(a.x-c.x)*(f.y-a.y)}function nd(c,a){return c.x===a.x&&c.y===a.y}function k_(c,a,f,m){var b=id(Zr(c,a,f)),S=id(Zr(c,a,m)),T=id(Zr(f,m,c)),E=id(Zr(f,m,a));return b!==S&&T!==E||!(b!==0||!rd(c,f,a))||!(S!==0||!rd(c,m,a))||!(T!==0||!rd(f,c,m))||!(E!==0||!rd(f,a,m))}function rd(c,a,f){return a.x<=Math.max(c.x,f.x)&&a.x>=Math.min(c.x,f.x)&&a.y<=Math.max(c.y,f.y)&&a.y>=Math.min(c.y,f.y)}function id(c){return c>0?1:c<0?-1:0}function Yc(c,a){return Zr(c.prev,c,c.next)<0?Zr(c,a,c.next)>=0&&Zr(c,c.prev,a)>=0:Zr(c,a,c.prev)<0||Zr(c,c.next,a)<0}function S_(c,a){var f=new Hp(c.i,c.x,c.y),m=new Hp(a.i,a.x,a.y),b=c.next,S=a.prev;return c.next=a,a.prev=c,f.next=b,b.prev=f,m.next=f,f.prev=m,S.next=m,m.prev=S,m}function T_(c,a,f,m){var b=new Hp(c,a,f);return m?(b.next=m.next,b.prev=m,m.next.prev=b,m.next=b):(b.prev=b,b.next=b),b}function Jc(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Hp(c,a,f){this.i=c,this.x=a,this.y=f,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wp(c,a,f,m){for(var b=0,S=a,T=f-m;S<f;S+=m)b+=(c[T]-c[S])*(c[S+1]+c[T+1]),T=S;return b}Vp.exports=td,Vp.exports.default=td,td.deviation=function(c,a,f,m){var b=a&&a.length,S=Math.abs(Wp(c,0,b?a[0]*f:c.length,f));if(b)for(var T=0,E=a.length;T<E;T++)S-=Math.abs(Wp(c,a[T]*f,T<E-1?a[T+1]*f:c.length,f));var R=0;for(T=0;T<m.length;T+=3){var j=m[T]*f,K=m[T+1]*f,J=m[T+2]*f;R+=Math.abs((c[j]-c[J])*(c[K+1]-c[j+1])-(c[j]-c[K])*(c[J+1]-c[j+1]))}return S===0&&R===0?0:Math.abs((R-S)/S)},td.flatten=function(c){for(var a=c[0][0].length,f={vertices:[],holes:[],dimensions:a},m=0,b=0;b<c.length;b++){for(var S=0;S<c[b].length;S++)for(var T=0;T<a;T++)f.vertices.push(c[b][S][T]);b>0&&f.holes.push(m+=c[b-1].length)}return f};var C_=d(Vp.exports);function vx(c,a,f,m,b){M_(c,a,f||0,m||c.length-1,b||bx)}function M_(c,a,f,m,b){for(;m>f;){if(m-f>600){var S=m-f+1,T=a-f+1,E=Math.log(S),R=.5*Math.exp(2*E/3),j=.5*Math.sqrt(E*R*(S-R)/S)*(T-S/2<0?-1:1);M_(c,a,Math.max(f,Math.floor(a-T*R/S+j)),Math.min(m,Math.floor(a+(S-T)*R/S+j)),b)}var K=c[a],J=f,se=m;for(Qc(c,f,a),b(c[m],K)>0&&Qc(c,f,m);J<se;){for(Qc(c,J,se),J++,se--;b(c[J],K)<0;)J++;for(;b(c[se],K)>0;)se--}b(c[f],K)===0?Qc(c,f,se):Qc(c,++se,m),se<=a&&(f=se+1),a<=se&&(m=se-1)}}function Qc(c,a,f){var m=c[a];c[a]=c[f],c[f]=m}function bx(c,a){return c<a?-1:c>a?1:0}function Gp(c,a){const f=c.length;if(f<=1)return[c];const m=[];let b,S;for(let T=0;T<f;T++){const E=it(c[T]);E!==0&&(c[T].area=Math.abs(E),S===void 0&&(S=E<0),S===E<0?(b&&m.push(b),b=[c[T]]):b.push(c[T]))}if(b&&m.push(b),a>1)for(let T=0;T<m.length;T++)m[T].length<=a||(vx(m[T],a,1,m[T].length-1,wx),m[T]=m[T].slice(0,a));return m}function wx(c,a){return a.area-c.area}function Zp(c,a,f){const m=f.patternDependencies;let b=!1;for(const S of a){const T=S.paint.get(`${c}-pattern`);T.isConstant()||(b=!0);const E=T.constantOr(null);E&&(b=!0,m[E.to]=!0,m[E.from]=!0)}return b}function Kp(c,a,f,m,b){const S=b.patternDependencies;for(const T of a){const E=T.paint.get(`${c}-pattern`).value;if(E.kind!=="constant"){let R=E.evaluate({zoom:m-1},f,{},b.availableImages),j=E.evaluate({zoom:m},f,{},b.availableImages),K=E.evaluate({zoom:m+1},f,{},b.availableImages);R=R&&R.name?R.name:R,j=j&&j.name?j.name:j,K=K&&K.name?K.name:K,S[R]=!0,S[j]=!0,S[K]=!0,f.patterns[T.id]={min:R,mid:j,max:K}}}return f}class Xp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Se,this.indexArray=new ft,this.indexArray2=new Ct,this.programConfigurations=new Fr(a.layers,a.zoom),this.segments=new $t,this.segments2=new $t,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=Zp("fill",this.layers,f);const b=this.layers[0].layout.get("fill-sort-key"),S=!b.isConstant(),T=[];for(const{feature:E,id:R,index:j,sourceLayerIndex:K}of a){const J=this.layers[0]._featureFilter.needGeometry,se=Ys(E,J);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),se,m))continue;const de=S?b.evaluate(se,{},m,f.availableImages):void 0,_e={id:R,properties:E.properties,type:E.type,sourceLayerIndex:K,index:j,geometry:J?se.geometry:Xs(E),patterns:{},sortKey:de};T.push(_e)}S&&T.sort((E,R)=>E.sortKey-R.sortKey);for(const E of T){const{geometry:R,index:j,sourceLayerIndex:K}=E;if(this.hasPattern){const J=Kp("fill",this.layers,E,this.zoom,f);this.patternFeatures.push(J)}else this.addFeature(E,R,j,m,{});f.featureIndex.insert(a[j].feature,R,j,K,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,ux),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,f,m,b,S){for(const T of Gp(f,500)){let E=0;for(const de of T)E+=de.length;const R=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),j=R.vertexLength,K=[],J=[];for(const de of T){if(de.length===0)continue;de!==T[0]&&J.push(K.length/2);const _e=this.segments2.prepareSegment(de.length,this.layoutVertexArray,this.indexArray2),we=_e.vertexLength;this.layoutVertexArray.emplaceBack(de[0].x,de[0].y),this.indexArray2.emplaceBack(we+de.length-1,we),K.push(de[0].x),K.push(de[0].y);for(let Ce=1;Ce<de.length;Ce++)this.layoutVertexArray.emplaceBack(de[Ce].x,de[Ce].y),this.indexArray2.emplaceBack(we+Ce-1,we+Ce),K.push(de[Ce].x),K.push(de[Ce].y);_e.vertexLength+=de.length,_e.primitiveLength+=de.length}const se=C_(K,J);for(let de=0;de<se.length;de+=3)this.indexArray.emplaceBack(j+se[de],j+se[de+1],j+se[de+2]);R.vertexLength+=E,R.primitiveLength+=se.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,S,b)}}let E_,L_;Zt("FillBucket",Xp,{omit:["layers","patternFeatures"]});var xx={get paint(){return L_=L_||new Bi({"fill-antialias":new sn(pe.paint_fill["fill-antialias"]),"fill-opacity":new hn(pe.paint_fill["fill-opacity"]),"fill-color":new hn(pe.paint_fill["fill-color"]),"fill-outline-color":new hn(pe.paint_fill["fill-outline-color"]),"fill-translate":new sn(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new sn(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new _u(pe.paint_fill["fill-pattern"])})},get layout(){return E_=E_||new Bi({"fill-sort-key":new hn(pe.layout_fill["fill-sort-key"])})}};class kx extends Eo{constructor(a){super(a,xx)}recalculate(a,f){super.recalculate(a,f);const m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Xp(a)}queryRadius(){return Jh(this.paint.get("fill-translate"))}queryIntersectsFeature(a,f,m,b,S,T,E){return qc(Qh(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,E),b)}isTileClipped(){return!0}}const Sx=Gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Tx=Gr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Cx}=Sx;var Ca={},Mx=p,I_=Iu;function Iu(c,a,f,m,b){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=m,this._values=b,c.readFields(Ex,this,a)}function Ex(c,a,f){c==1?a.id=f.readVarint():c==2?function(m,b){for(var S=m.readVarint()+m.pos;m.pos<S;){var T=b._keys[m.readVarint()],E=b._values[m.readVarint()];b.properties[T]=E}}(f,a):c==3?a.type=f.readVarint():c==4&&(a._geometry=f.pos)}function Lx(c){for(var a,f,m=0,b=0,S=c.length,T=S-1;b<S;T=b++)m+=((f=c[T]).x-(a=c[b]).x)*(a.y+f.y);return m}Iu.types=["Unknown","Point","LineString","Polygon"],Iu.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var a,f=c.readVarint()+c.pos,m=1,b=0,S=0,T=0,E=[];c.pos<f;){if(b<=0){var R=c.readVarint();m=7&R,b=R>>3}if(b--,m===1||m===2)S+=c.readSVarint(),T+=c.readSVarint(),m===1&&(a&&E.push(a),a=[]),a.push(new Mx(S,T));else{if(m!==7)throw new Error("unknown command "+m);a&&a.push(a[0].clone())}}return a&&E.push(a),E},Iu.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var a=c.readVarint()+c.pos,f=1,m=0,b=0,S=0,T=1/0,E=-1/0,R=1/0,j=-1/0;c.pos<a;){if(m<=0){var K=c.readVarint();f=7&K,m=K>>3}if(m--,f===1||f===2)(b+=c.readSVarint())<T&&(T=b),b>E&&(E=b),(S+=c.readSVarint())<R&&(R=S),S>j&&(j=S);else if(f!==7)throw new Error("unknown command "+f)}return[T,R,E,j]},Iu.prototype.toGeoJSON=function(c,a,f){var m,b,S=this.extent*Math.pow(2,f),T=this.extent*c,E=this.extent*a,R=this.loadGeometry(),j=Iu.types[this.type];function K(de){for(var _e=0;_e<de.length;_e++){var we=de[_e];de[_e]=[360*(we.x+T)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(we.y+E)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var J=[];for(m=0;m<R.length;m++)J[m]=R[m][0];K(R=J);break;case 2:for(m=0;m<R.length;m++)K(R[m]);break;case 3:for(R=function(de){var _e=de.length;if(_e<=1)return[de];for(var we,Ce,Pe=[],Ge=0;Ge<_e;Ge++){var De=Lx(de[Ge]);De!==0&&(Ce===void 0&&(Ce=De<0),Ce===De<0?(we&&Pe.push(we),we=[de[Ge]]):we.push(de[Ge]))}return we&&Pe.push(we),Pe}(R),m=0;m<R.length;m++)for(b=0;b<R[m].length;b++)K(R[m][b])}R.length===1?R=R[0]:j="Multi"+j;var se={type:"Feature",geometry:{type:j,coordinates:R},properties:this.properties};return"id"in this&&(se.id=this.id),se};var Ix=I_,A_=P_;function P_(c,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Ax,this,a),this.length=this._features.length}function Ax(c,a,f){c===15?a.version=f.readVarint():c===1?a.name=f.readString():c===5?a.extent=f.readVarint():c===2?a._features.push(f.pos):c===3?a._keys.push(f.readString()):c===4&&a._values.push(function(m){for(var b=null,S=m.readVarint()+m.pos;m.pos<S;){var T=m.readVarint()>>3;b=T===1?m.readString():T===2?m.readFloat():T===3?m.readDouble():T===4?m.readVarint64():T===5?m.readVarint():T===6?m.readSVarint():T===7?m.readBoolean():null}return b}(f))}P_.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var a=this._pbf.readVarint()+this._pbf.pos;return new Ix(this._pbf,a,this.extent,this._keys,this._values)};var Px=A_;function zx(c,a,f){if(c===3){var m=new Px(f,f.readVarint()+f.pos);m.length&&(a[m.name]=m)}}Ca.VectorTile=function(c,a){this.layers=c.readFields(zx,{},a)},Ca.VectorTileFeature=I_,Ca.VectorTileLayer=A_;const Dx=Ca.VectorTileFeature.types,Yp=Math.pow(2,13);function ef(c,a,f,m,b,S,T,E){c.emplaceBack(a,f,2*Math.floor(m*Yp)+T,b*Yp*2,S*Yp*2,Math.round(E))}class Jp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new ke,this.centroidVertexArray=new te,this.indexArray=new ft,this.programConfigurations=new Fr(a.layers,a.zoom),this.segments=new $t,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.features=[],this.hasPattern=Zp("fill-extrusion",this.layers,f);for(const{feature:b,id:S,index:T,sourceLayerIndex:E}of a){const R=this.layers[0]._featureFilter.needGeometry,j=Ys(b,R);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),j,m))continue;const K={id:S,sourceLayerIndex:E,index:T,geometry:R?j.geometry:Xs(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(Kp("fill-extrusion",this.layers,K,this.zoom,f)):this.addFeature(K,K.geometry,T,m,{}),f.featureIndex.insert(b,K.geometry,T,E,this.index,!0)}}addFeatures(a,f,m){for(const b of this.features){const{geometry:S}=b;this.addFeature(b,S,b.index,f,m)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Cx),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,Tx.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,f,m,b,S){const T={x:0,y:0,vertexCount:0};for(const E of Gp(f,500)){let R=0;for(const _e of E)R+=_e.length;let j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const _e of E){if(_e.length===0||Fx(_e))continue;let we=0;for(let Ce=0;Ce<_e.length;Ce++){const Pe=_e[Ce];if(Ce>=1){const Ge=_e[Ce-1];if(!Rx(Pe,Ge)){j.vertexLength+4>$t.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const De=Pe.sub(Ge)._perp()._unit(),je=Ge.dist(Pe);we+je>32768&&(we=0),ef(this.layoutVertexArray,Pe.x,Pe.y,De.x,De.y,0,0,we),ef(this.layoutVertexArray,Pe.x,Pe.y,De.x,De.y,0,1,we),T.x+=2*Pe.x,T.y+=2*Pe.y,T.vertexCount+=2,we+=je,ef(this.layoutVertexArray,Ge.x,Ge.y,De.x,De.y,0,0,we),ef(this.layoutVertexArray,Ge.x,Ge.y,De.x,De.y,0,1,we),T.x+=2*Ge.x,T.y+=2*Ge.y,T.vertexCount+=2;const dt=j.vertexLength;this.indexArray.emplaceBack(dt,dt+2,dt+1),this.indexArray.emplaceBack(dt+1,dt+2,dt+3),j.vertexLength+=4,j.primitiveLength+=2}}}}if(j.vertexLength+R>$t.MAX_VERTEX_ARRAY_LENGTH&&(j=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),Dx[a.type]!=="Polygon")continue;const K=[],J=[],se=j.vertexLength;for(const _e of E)if(_e.length!==0){_e!==E[0]&&J.push(K.length/2);for(let we=0;we<_e.length;we++){const Ce=_e[we];ef(this.layoutVertexArray,Ce.x,Ce.y,0,0,1,1,0),T.x+=Ce.x,T.y+=Ce.y,T.vertexCount+=1,K.push(Ce.x),K.push(Ce.y)}}const de=C_(K,J);for(let _e=0;_e<de.length;_e+=3)this.indexArray.emplaceBack(se+de[_e],se+de[_e+2],se+de[_e+1]);j.primitiveLength+=de.length/3,j.vertexLength+=R}for(let E=0;E<T.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(T.x/T.vertexCount),Math.floor(T.y/T.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,S,b)}}function Rx(c,a){return c.x===a.x&&(c.x<0||c.x>qr)||c.y===a.y&&(c.y<0||c.y>qr)}function Fx(c){return c.every(a=>a.x<0)||c.every(a=>a.x>qr)||c.every(a=>a.y<0)||c.every(a=>a.y>qr)}let z_;Zt("FillExtrusionBucket",Jp,{omit:["layers","features"]});var Ox={get paint(){return z_=z_||new Bi({"fill-extrusion-opacity":new sn(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new hn(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new sn(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new sn(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _u(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new hn(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new hn(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new sn(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class $x extends Eo{constructor(a){super(a,Ox)}createBucket(a){return new Jp(a)}queryRadius(){return Jh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,f,m,b,S,T,E,R){const j=Qh(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,E),K=this.paint.get("fill-extrusion-height").evaluate(f,m),J=this.paint.get("fill-extrusion-base").evaluate(f,m),se=function(_e,we,Ce,Pe){const Ge=[];for(const De of _e){const je=[De.x,De.y,0,1];ed(je,je,we),Ge.push(new _(je[0]/je[3],je[1]/je[3]))}return Ge}(j,R),de=function(_e,we,Ce,Pe){const Ge=[],De=[],je=Pe[8]*we,dt=Pe[9]*we,vt=Pe[10]*we,Ht=Pe[11]*we,tn=Pe[8]*Ce,qt=Pe[9]*Ce,Ut=Pe[10]*Ce,Ot=Pe[11]*Ce;for(const Kt of _e){const Nt=[],At=[];for(const cn of Kt){const on=cn.x,Fn=cn.y,wr=Pe[0]*on+Pe[4]*Fn+Pe[12],Ir=Pe[1]*on+Pe[5]*Fn+Pe[13],li=Pe[2]*on+Pe[6]*Fn+Pe[14],_o=Pe[3]*on+Pe[7]*Fn+Pe[15],ji=li+vt,ei=_o+Ht,yi=wr+tn,Ti=Ir+qt,Ui=li+Ut,Vi=_o+Ot,ui=new _((wr+je)/ei,(Ir+dt)/ei);ui.z=ji/ei,Nt.push(ui);const ci=new _(yi/Vi,Ti/Vi);ci.z=Ui/Vi,At.push(ci)}Ge.push(Nt),De.push(At)}return[Ge,De]}(b,J,K,R);return function(_e,we,Ce){let Pe=1/0;qc(Ce,we)&&(Pe=D_(Ce,we[0]));for(let Ge=0;Ge<we.length;Ge++){const De=we[Ge],je=_e[Ge];for(let dt=0;dt<De.length-1;dt++){const vt=De[dt],Ht=[vt,De[dt+1],je[dt+1],je[dt],vt];Vc(Ce,Ht)&&(Pe=Math.min(Pe,D_(Ce,Ht)))}}return Pe!==1/0&&Pe}(de[0],de[1],se)}}function tf(c,a){return c.x*a.x+c.y*a.y}function D_(c,a){if(c.length===1){let f=0;const m=a[f++];let b;for(;!b||m.equals(b);)if(b=a[f++],!b)return 1/0;for(;f<a.length;f++){const S=a[f],T=c[0],E=b.sub(m),R=S.sub(m),j=T.sub(m),K=tf(E,E),J=tf(E,R),se=tf(R,R),de=tf(j,E),_e=tf(j,R),we=K*se-J*J,Ce=(se*de-J*_e)/we,Pe=(K*_e-J*de)/we,Ge=m.z*(1-Ce-Pe)+b.z*Ce+S.z*Pe;if(isFinite(Ge))return Ge}return 1/0}{let f=1/0;for(const m of a)f=Math.min(f,m.z);return f}}const Bx=Gr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Nx}=Bx,jx=Gr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ux}=jx,Vx=Ca.VectorTileFeature.types,qx=Math.cos(Math.PI/180*37.5),R_=Math.pow(2,14)/.5;class Qp{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(f=>f.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new Me,this.layoutVertexArray2=new be,this.indexArray=new ft,this.programConfigurations=new Fr(a.layers,a.zoom),this.segments=new $t,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(a,f,m){this.hasPattern=Zp("line",this.layers,f);const b=this.layers[0].layout.get("line-sort-key"),S=!b.isConstant(),T=[];for(const{feature:E,id:R,index:j,sourceLayerIndex:K}of a){const J=this.layers[0]._featureFilter.needGeometry,se=Ys(E,J);if(!this.layers[0]._featureFilter.filter(new Er(this.zoom),se,m))continue;const de=S?b.evaluate(se,{},m):void 0,_e={id:R,properties:E.properties,type:E.type,sourceLayerIndex:K,index:j,geometry:J?se.geometry:Xs(E),patterns:{},sortKey:de};T.push(_e)}S&&T.sort((E,R)=>E.sortKey-R.sortKey);for(const E of T){const{geometry:R,index:j,sourceLayerIndex:K}=E;if(this.hasPattern){const J=Kp("line",this.layers,E,this.zoom,f);this.patternFeatures.push(J)}else this.addFeature(E,R,j,m,{});f.featureIndex.insert(a[j].feature,R,j,K,this.index)}}update(a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,f,this.stateDependentLayers,m)}addFeatures(a,f,m){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,Ux)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Nx),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,f,m,b,S){const T=this.layers[0].layout,E=T.get("line-join").evaluate(a,{}),R=T.get("line-cap"),j=T.get("line-miter-limit"),K=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const J of f)this.addLine(J,a,E,R,j,K);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,m,S,b)}addLine(a,f,m,b,S,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<a.length-1;Pe++)this.totalDistance+=a[Pe].dist(a[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=Vx[f.type]==="Polygon";let R=a.length;for(;R>=2&&a[R-1].equals(a[R-2]);)R--;let j=0;for(;j<R-1&&a[j].equals(a[j+1]);)j++;if(R<(E?3:2))return;m==="bevel"&&(S=1.05);const K=this.overscaling<=16?15*qr/(512*this.overscaling):0,J=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let se,de,_e,we,Ce;this.e1=this.e2=-1,E&&(se=a[R-2],Ce=a[j].sub(se)._unit()._perp());for(let Pe=j;Pe<R;Pe++){if(_e=Pe===R-1?E?a[j+1]:void 0:a[Pe+1],_e&&a[Pe].equals(_e))continue;Ce&&(we=Ce),se&&(de=se),se=a[Pe],Ce=_e?_e.sub(se)._unit()._perp():we,we=we||Ce;let Ge=we.add(Ce);Ge.x===0&&Ge.y===0||Ge._unit();const De=we.x*Ce.x+we.y*Ce.y,je=Ge.x*Ce.x+Ge.y*Ce.y,dt=je!==0?1/je:1/0,vt=2*Math.sqrt(2-2*je),Ht=je<qx&&de&&_e,tn=we.x*Ce.y-we.y*Ce.x>0;if(Ht&&Pe>j){const Ot=se.dist(de);if(Ot>2*K){const Kt=se.sub(se.sub(de)._mult(K/Ot)._round());this.updateDistance(de,Kt),this.addCurrentVertex(Kt,we,0,0,J),de=Kt}}const qt=de&&_e;let Ut=qt?m:E?"butt":b;if(qt&&Ut==="round"&&(dt<T?Ut="miter":dt<=2&&(Ut="fakeround")),Ut==="miter"&&dt>S&&(Ut="bevel"),Ut==="bevel"&&(dt>2&&(Ut="flipbevel"),dt<S&&(Ut="miter")),de&&this.updateDistance(de,se),Ut==="miter")Ge._mult(dt),this.addCurrentVertex(se,Ge,0,0,J);else if(Ut==="flipbevel"){if(dt>100)Ge=Ce.mult(-1);else{const Ot=dt*we.add(Ce).mag()/we.sub(Ce).mag();Ge._perp()._mult(Ot*(tn?-1:1))}this.addCurrentVertex(se,Ge,0,0,J),this.addCurrentVertex(se,Ge.mult(-1),0,0,J)}else if(Ut==="bevel"||Ut==="fakeround"){const Ot=-Math.sqrt(dt*dt-1),Kt=tn?Ot:0,Nt=tn?0:Ot;if(de&&this.addCurrentVertex(se,we,Kt,Nt,J),Ut==="fakeround"){const At=Math.round(180*vt/Math.PI/20);for(let cn=1;cn<At;cn++){let on=cn/At;if(on!==.5){const wr=on-.5;on+=on*wr*(on-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*wr*wr+(.848013+De*(.215638*De-1.06021)))}const Fn=Ce.sub(we)._mult(on)._add(we)._unit()._mult(tn?-1:1);this.addHalfVertex(se,Fn.x,Fn.y,!1,tn,0,J)}}_e&&this.addCurrentVertex(se,Ce,-Kt,-Nt,J)}else if(Ut==="butt")this.addCurrentVertex(se,Ge,0,0,J);else if(Ut==="square"){const Ot=de?1:-1;this.addCurrentVertex(se,Ge,Ot,Ot,J)}else Ut==="round"&&(de&&(this.addCurrentVertex(se,we,0,0,J),this.addCurrentVertex(se,we,1,1,J,!0)),_e&&(this.addCurrentVertex(se,Ce,-1,-1,J,!0),this.addCurrentVertex(se,Ce,0,0,J)));if(Ht&&Pe<R-1){const Ot=se.dist(_e);if(Ot>2*K){const Kt=se.add(_e.sub(se)._mult(K/Ot)._round());this.updateDistance(se,Kt),this.addCurrentVertex(Kt,Ce,0,0,J),se=Kt}}}}addCurrentVertex(a,f,m,b,S,T=!1){const E=f.y*b-f.x,R=-f.y-f.x*b;this.addHalfVertex(a,f.x+f.y*m,f.y-f.x*m,T,!1,m,S),this.addHalfVertex(a,E,R,T,!0,-b,S),this.distance>R_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,f,m,b,S,T))}addHalfVertex({x:a,y:f},m,b,S,T,E,R){const j=.5*(this.lineClips?this.scaledDistance*(R_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(S?1:0),(f<<1)+(T?1:0),Math.round(63*m)+128,Math.round(63*b)+128,1+(E===0?0:E<0?-1:1)|(63&j)<<2,j>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const K=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,K),R.primitiveLength++),T?this.e2=K:this.e1=K}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,f){this.distance+=a.dist(f),this.updateScaledDistance()}}let F_,O_;Zt("LineBucket",Qp,{omit:["layers","patternFeatures"]});var $_={get paint(){return O_=O_||new Bi({"line-opacity":new hn(pe.paint_line["line-opacity"]),"line-color":new hn(pe.paint_line["line-color"]),"line-translate":new sn(pe.paint_line["line-translate"]),"line-translate-anchor":new sn(pe.paint_line["line-translate-anchor"]),"line-width":new hn(pe.paint_line["line-width"]),"line-gap-width":new hn(pe.paint_line["line-gap-width"]),"line-offset":new hn(pe.paint_line["line-offset"]),"line-blur":new hn(pe.paint_line["line-blur"]),"line-dasharray":new _l(pe.paint_line["line-dasharray"]),"line-pattern":new _u(pe.paint_line["line-pattern"]),"line-gradient":new zc(pe.paint_line["line-gradient"])})},get layout(){return F_=F_||new Bi({"line-cap":new sn(pe.layout_line["line-cap"]),"line-join":new hn(pe.layout_line["line-join"]),"line-miter-limit":new sn(pe.layout_line["line-miter-limit"]),"line-round-limit":new sn(pe.layout_line["line-round-limit"]),"line-sort-key":new hn(pe.layout_line["line-sort-key"])})}};class Hx extends hn{possiblyEvaluate(a,f){return f=new Er(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(a,f)}evaluate(a,f,m,b){return f=q({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(a,f,m,b)}}let od;class Wx extends Eo{constructor(a){super(a,$_),this.gradientVersion=0,od||(od=new Hx($_.paint.properties["line-width"].specification),od.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(m){return m._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof ul,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,f){super.recalculate(a,f),this.paint._values["line-floorwidth"]=od.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Qp(a)}queryRadius(a){const f=a,m=B_(Gc("line-width",this,f),Gc("line-gap-width",this,f)),b=Gc("line-offset",this,f);return m/2+Math.abs(b)+Jh(this.paint.get("line-translate"))}queryIntersectsFeature(a,f,m,b,S,T,E){const R=Qh(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,E),j=E/2*B_(this.paint.get("line-width").evaluate(f,m),this.paint.get("line-gap-width").evaluate(f,m)),K=this.paint.get("line-offset").evaluate(f,m);return K&&(b=function(J,se){const de=[];for(let _e=0;_e<J.length;_e++){const we=J[_e],Ce=[];for(let Pe=0;Pe<we.length;Pe++){const Ge=we[Pe-1],De=we[Pe],je=we[Pe+1],dt=Pe===0?new _(0,0):De.sub(Ge)._unit()._perp(),vt=Pe===we.length-1?new _(0,0):je.sub(De)._unit()._perp(),Ht=dt._add(vt)._unit(),tn=Ht.x*vt.x+Ht.y*vt.y;tn!==0&&Ht._mult(1/tn),Ce.push(Ht._mult(se)._add(De))}de.push(Ce)}return de}(b,K*E)),function(J,se,de){for(let _e=0;_e<se.length;_e++){const we=se[_e];if(J.length>=3){for(let Ce=0;Ce<we.length;Ce++)if(Mu(J,we[Ce]))return!0}if(Hc(J,we,de))return!0}return!1}(R,b,j)}isTileClipped(){return!0}}function B_(c,a){return a>0?a+2*c:c}const Gx=Gr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Zx=Gr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Gr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Kx=Gr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Gr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const N_=Gr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xx=Gr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Yx(c,a,f){return c.sections.forEach(m=>{m.text=function(b,S,T){const E=S.layout.get("text-transform").evaluate(T,{});return E==="uppercase"?b=b.toLocaleUpperCase():E==="lowercase"&&(b=b.toLocaleLowerCase()),Is.applyArabicShaping&&(b=Is.applyArabicShaping(b)),b}(m.text,a,f)}),c}Gr([{name:"triangle",components:3,type:"Uint16"}]),Gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Gr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Gr([{type:"Float32",name:"offsetX"}]),Gr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Gr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const nf={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ai=24,j_=hr,U_=function(c,a,f,m,b){var S,T,E=8*b-m-1,R=(1<<E)-1,j=R>>1,K=-7,J=f?b-1:0,se=f?-1:1,de=c[a+J];for(J+=se,S=de&(1<<-K)-1,de>>=-K,K+=E;K>0;S=256*S+c[a+J],J+=se,K-=8);for(T=S&(1<<-K)-1,S>>=-K,K+=m;K>0;T=256*T+c[a+J],J+=se,K-=8);if(S===0)S=1-j;else{if(S===R)return T?NaN:1/0*(de?-1:1);T+=Math.pow(2,m),S-=j}return(de?-1:1)*T*Math.pow(2,S-m)},V_=function(c,a,f,m,b,S){var T,E,R,j=8*S-b-1,K=(1<<j)-1,J=K>>1,se=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=m?0:S-1,_e=m?1:-1,we=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(E=isNaN(a)?1:0,T=K):(T=Math.floor(Math.log(a)/Math.LN2),a*(R=Math.pow(2,-T))<1&&(T--,R*=2),(a+=T+J>=1?se/R:se*Math.pow(2,1-J))*R>=2&&(T++,R/=2),T+J>=K?(E=0,T=K):T+J>=1?(E=(a*R-1)*Math.pow(2,b),T+=J):(E=a*Math.pow(2,J-1)*Math.pow(2,b),T=0));b>=8;c[f+de]=255&E,de+=_e,E/=256,b-=8);for(T=T<<b|E,j+=b;j>0;c[f+de]=255&T,de+=_e,T/=256,j-=8);c[f+de-_e]|=128*we};function hr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}hr.Varint=0,hr.Fixed64=1,hr.Bytes=2,hr.Fixed32=5;var em=4294967296,q_=1/em,H_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Js(c){return c.type===hr.Bytes?c.readVarint()+c.pos:c.pos+1}function Au(c,a,f){return f?4294967296*a+(c>>>0):4294967296*(a>>>0)+(c>>>0)}function W_(c,a,f){var m=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));f.realloc(m);for(var b=f.pos-1;b>=c;b--)f.buf[b+m]=f.buf[b]}function Jx(c,a){for(var f=0;f<c.length;f++)a.writeVarint(c[f])}function Qx(c,a){for(var f=0;f<c.length;f++)a.writeSVarint(c[f])}function ek(c,a){for(var f=0;f<c.length;f++)a.writeFloat(c[f])}function tk(c,a){for(var f=0;f<c.length;f++)a.writeDouble(c[f])}function nk(c,a){for(var f=0;f<c.length;f++)a.writeBoolean(c[f])}function rk(c,a){for(var f=0;f<c.length;f++)a.writeFixed32(c[f])}function ik(c,a){for(var f=0;f<c.length;f++)a.writeSFixed32(c[f])}function ok(c,a){for(var f=0;f<c.length;f++)a.writeFixed64(c[f])}function sk(c,a){for(var f=0;f<c.length;f++)a.writeSFixed64(c[f])}function sd(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+16777216*c[a+3]}function Pu(c,a,f){c[f]=a,c[f+1]=a>>>8,c[f+2]=a>>>16,c[f+3]=a>>>24}function G_(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+(c[a+3]<<24)}hr.prototype={destroy:function(){this.buf=null},readFields:function(c,a,f){for(f=f||this.length;this.pos<f;){var m=this.readVarint(),b=m>>3,S=this.pos;this.type=7&m,c(b,a,this),this.pos===S&&this.skip(m)}return a},readMessage:function(c,a){return this.readFields(c,a,this.readVarint()+this.pos)},readFixed32:function(){var c=sd(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=G_(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=sd(this.buf,this.pos)+sd(this.buf,this.pos+4)*em;return this.pos+=8,c},readSFixed64:function(){var c=sd(this.buf,this.pos)+G_(this.buf,this.pos+4)*em;return this.pos+=8,c},readFloat:function(){var c=U_(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=U_(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var a,f,m=this.buf;return a=127&(f=m[this.pos++]),f<128?a:(a|=(127&(f=m[this.pos++]))<<7,f<128?a:(a|=(127&(f=m[this.pos++]))<<14,f<128?a:(a|=(127&(f=m[this.pos++]))<<21,f<128?a:function(b,S,T){var E,R,j=T.buf;if(E=(112&(R=j[T.pos++]))>>4,R<128||(E|=(127&(R=j[T.pos++]))<<3,R<128)||(E|=(127&(R=j[T.pos++]))<<10,R<128)||(E|=(127&(R=j[T.pos++]))<<17,R<128)||(E|=(127&(R=j[T.pos++]))<<24,R<128)||(E|=(1&(R=j[T.pos++]))<<31,R<128))return Au(b,E,S);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(f=m[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,a=this.pos;return this.pos=c,c-a>=12&&H_?function(f,m,b){return H_.decode(f.subarray(m,b))}(this.buf,a,c):function(f,m,b){for(var S="",T=m;T<b;){var E,R,j,K=f[T],J=null,se=K>239?4:K>223?3:K>191?2:1;if(T+se>b)break;se===1?K<128&&(J=K):se===2?(192&(E=f[T+1]))==128&&(J=(31&K)<<6|63&E)<=127&&(J=null):se===3?(R=f[T+2],(192&(E=f[T+1]))==128&&(192&R)==128&&((J=(15&K)<<12|(63&E)<<6|63&R)<=2047||J>=55296&&J<=57343)&&(J=null)):se===4&&(R=f[T+2],j=f[T+3],(192&(E=f[T+1]))==128&&(192&R)==128&&(192&j)==128&&((J=(15&K)<<18|(63&E)<<12|(63&R)<<6|63&j)<=65535||J>=1114112)&&(J=null)),J===null?(J=65533,se=1):J>65535&&(J-=65536,S+=String.fromCharCode(J>>>10&1023|55296),J=56320|1023&J),S+=String.fromCharCode(J),T+=se}return S}(this.buf,a,c)},readBytes:function(){var c=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,c);return this.pos=c,a},readPackedVarint:function(c,a){if(this.type!==hr.Bytes)return c.push(this.readVarint(a));var f=Js(this);for(c=c||[];this.pos<f;)c.push(this.readVarint(a));return c},readPackedSVarint:function(c){if(this.type!==hr.Bytes)return c.push(this.readSVarint());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==hr.Bytes)return c.push(this.readBoolean());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==hr.Bytes)return c.push(this.readFloat());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==hr.Bytes)return c.push(this.readDouble());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==hr.Bytes)return c.push(this.readFixed32());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==hr.Bytes)return c.push(this.readSFixed32());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==hr.Bytes)return c.push(this.readFixed64());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==hr.Bytes)return c.push(this.readSFixed64());var a=Js(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed64());return c},skip:function(c){var a=7&c;if(a===hr.Varint)for(;this.buf[this.pos++]>127;);else if(a===hr.Bytes)this.pos=this.readVarint()+this.pos;else if(a===hr.Fixed32)this.pos+=4;else{if(a!==hr.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(c,a){this.writeVarint(c<<3|a)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var f=new Uint8Array(a);f.set(this.buf),this.buf=f,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Pu(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Pu(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Pu(this.buf,-1&c,this.pos),Pu(this.buf,Math.floor(c*q_),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Pu(this.buf,-1&c,this.pos),Pu(this.buf,Math.floor(c*q_),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(a,f){var m,b;if(a>=0?(m=a%4294967296|0,b=a/4294967296|0):(b=~(-a/4294967296),4294967295^(m=~(-a%4294967296))?m=m+1|0:(m=0,b=b+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(S,T,E){E.buf[E.pos++]=127&S|128,S>>>=7,E.buf[E.pos++]=127&S|128,S>>>=7,E.buf[E.pos++]=127&S|128,S>>>=7,E.buf[E.pos++]=127&S|128,E.buf[E.pos]=127&(S>>>=7)}(m,0,f),function(S,T){var E=(7&S)<<4;T.buf[T.pos++]|=E|((S>>>=3)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S)))))}(b,f)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var a=this.pos;this.pos=function(m,b,S){for(var T,E,R=0;R<b.length;R++){if((T=b.charCodeAt(R))>55295&&T<57344){if(!E){T>56319||R+1===b.length?(m[S++]=239,m[S++]=191,m[S++]=189):E=T;continue}if(T<56320){m[S++]=239,m[S++]=191,m[S++]=189,E=T;continue}T=E-55296<<10|T-56320|65536,E=null}else E&&(m[S++]=239,m[S++]=191,m[S++]=189,E=null);T<128?m[S++]=T:(T<2048?m[S++]=T>>6|192:(T<65536?m[S++]=T>>12|224:(m[S++]=T>>18|240,m[S++]=T>>12&63|128),m[S++]=T>>6&63|128),m[S++]=63&T|128)}return S}(this.buf,c,this.pos);var f=this.pos-a;f>=128&&W_(a,f,this),this.pos=a-1,this.writeVarint(f),this.pos+=f},writeFloat:function(c){this.realloc(4),V_(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),V_(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var f=0;f<a;f++)this.buf[this.pos++]=c[f]},writeRawMessage:function(c,a){this.pos++;var f=this.pos;c(a,this);var m=this.pos-f;m>=128&&W_(f,m,this),this.pos=f-1,this.writeVarint(m),this.pos+=m},writeMessage:function(c,a,f){this.writeTag(c,hr.Bytes),this.writeRawMessage(a,f)},writePackedVarint:function(c,a){a.length&&this.writeMessage(c,Jx,a)},writePackedSVarint:function(c,a){a.length&&this.writeMessage(c,Qx,a)},writePackedBoolean:function(c,a){a.length&&this.writeMessage(c,nk,a)},writePackedFloat:function(c,a){a.length&&this.writeMessage(c,ek,a)},writePackedDouble:function(c,a){a.length&&this.writeMessage(c,tk,a)},writePackedFixed32:function(c,a){a.length&&this.writeMessage(c,rk,a)},writePackedSFixed32:function(c,a){a.length&&this.writeMessage(c,ik,a)},writePackedFixed64:function(c,a){a.length&&this.writeMessage(c,ok,a)},writePackedSFixed64:function(c,a){a.length&&this.writeMessage(c,sk,a)},writeBytesField:function(c,a){this.writeTag(c,hr.Bytes),this.writeBytes(a)},writeFixed32Field:function(c,a){this.writeTag(c,hr.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(c,a){this.writeTag(c,hr.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(c,a){this.writeTag(c,hr.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(c,a){this.writeTag(c,hr.Fixed64),this.writeSFixed64(a)},writeVarintField:function(c,a){this.writeTag(c,hr.Varint),this.writeVarint(a)},writeSVarintField:function(c,a){this.writeTag(c,hr.Varint),this.writeSVarint(a)},writeStringField:function(c,a){this.writeTag(c,hr.Bytes),this.writeString(a)},writeFloatField:function(c,a){this.writeTag(c,hr.Fixed32),this.writeFloat(a)},writeDoubleField:function(c,a){this.writeTag(c,hr.Fixed64),this.writeDouble(a)},writeBooleanField:function(c,a){this.writeVarintField(c,!!a)}};var tm=d(j_);const nm=3;function ak(c,a,f){c===1&&f.readMessage(lk,a)}function lk(c,a,f){if(c===3){const{id:m,bitmap:b,width:S,height:T,left:E,top:R,advance:j}=f.readMessage(uk,{});a.push({id:m,bitmap:new Kc({width:S+2*nm,height:T+2*nm},b),metrics:{width:S,height:T,left:E,top:R,advance:j}})}}function uk(c,a,f){c===1?a.id=f.readVarint():c===2?a.bitmap=f.readBytes():c===3?a.width=f.readVarint():c===4?a.height=f.readVarint():c===5?a.left=f.readSVarint():c===6?a.top=f.readSVarint():c===7&&(a.advance=f.readVarint())}const Z_=nm;function K_(c){let a=0,f=0;for(const T of c)a+=T.w*T.h,f=Math.max(f,T.w);c.sort((T,E)=>E.h-T.h);const m=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),f),h:1/0}];let b=0,S=0;for(const T of c)for(let E=m.length-1;E>=0;E--){const R=m[E];if(!(T.w>R.w||T.h>R.h)){if(T.x=R.x,T.y=R.y,S=Math.max(S,T.y+T.h),b=Math.max(b,T.x+T.w),T.w===R.w&&T.h===R.h){const j=m.pop();E<m.length&&(m[E]=j)}else T.h===R.h?(R.x+=T.w,R.w-=T.w):T.w===R.w?(R.y+=T.h,R.h-=T.h):(m.push({x:R.x+T.w,y:R.y,w:R.w-T.w,h:T.h}),R.y+=T.h,R.h-=T.h);break}}return{w:b,h:S,fill:a/(b*S)||0}}const io=1;class rm{constructor(a,{pixelRatio:f,version:m,stretchX:b,stretchY:S,content:T}){this.paddedRect=a,this.pixelRatio=f,this.stretchX=b,this.stretchY=S,this.content=T,this.version=m}get tl(){return[this.paddedRect.x+io,this.paddedRect.y+io]}get br(){return[this.paddedRect.x+this.paddedRect.w-io,this.paddedRect.y+this.paddedRect.h-io]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*io)/this.pixelRatio,(this.paddedRect.h-2*io)/this.pixelRatio]}}class X_{constructor(a,f){const m={},b={};this.haveRenderCallbacks=[];const S=[];this.addImages(a,m,S),this.addImages(f,b,S);const{w:T,h:E}=K_(S),R=new Lo({width:T||1,height:E||1});for(const j in a){const K=a[j],J=m[j].paddedRect;Lo.copy(K.data,R,{x:0,y:0},{x:J.x+io,y:J.y+io},K.data)}for(const j in f){const K=f[j],J=b[j].paddedRect,se=J.x+io,de=J.y+io,_e=K.data.width,we=K.data.height;Lo.copy(K.data,R,{x:0,y:0},{x:se,y:de},K.data),Lo.copy(K.data,R,{x:0,y:we-1},{x:se,y:de-1},{width:_e,height:1}),Lo.copy(K.data,R,{x:0,y:0},{x:se,y:de+we},{width:_e,height:1}),Lo.copy(K.data,R,{x:_e-1,y:0},{x:se-1,y:de},{width:1,height:we}),Lo.copy(K.data,R,{x:0,y:0},{x:se+_e,y:de},{width:1,height:we})}this.image=R,this.iconPositions=m,this.patternPositions=b}addImages(a,f,m){for(const b in a){const S=a[b],T={x:0,y:0,w:S.data.width+2*io,h:S.data.height+2*io};m.push(T),f[b]=new rm(T,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(a,f){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const m in a.updatedImages)this.patchUpdatedImage(this.iconPositions[m],a.getImage(m),f),this.patchUpdatedImage(this.patternPositions[m],a.getImage(m),f)}patchUpdatedImage(a,f,m){if(!a||!f||a.version===f.version)return;a.version=f.version;const[b,S]=a.tl;m.update(f.data,void 0,{x:b,y:S})}}var Ma;Zt("ImagePosition",rm),Zt("ImageAtlas",X_),u.ah=void 0,(Ma=u.ah||(u.ah={}))[Ma.none=0]="none",Ma[Ma.horizontal=1]="horizontal",Ma[Ma.vertical=2]="vertical",Ma[Ma.horizontalOnly=3]="horizontalOnly";const rf=-17;class of{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,f){const m=new of;return m.scale=a||1,m.fontStack=f,m}static forImage(a){const f=new of;return f.imageName=a,f}}class zu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,f){const m=new zu;for(let b=0;b<a.sections.length;b++){const S=a.sections[b];S.image?m.addImageSection(S):m.addTextSection(S,f)}return m}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let f="";for(let m=0;m<a.length;m++){const b=a.charCodeAt(m+1)||null,S=a.charCodeAt(m-1)||null;f+=b&&Ac(b)&&!nf[a[m+1]]||S&&Ac(S)&&!nf[a[m-1]]||!nf[a[m]]?a[m]:nf[a[m]]}return f}(this.text)}trim(){let a=0;for(let m=0;m<this.text.length&&ld[this.text.charCodeAt(m)];m++)a++;let f=this.text.length;for(let m=this.text.length-1;m>=0&&m>=a&&ld[this.text.charCodeAt(m)];m--)f--;this.text=this.text.substring(a,f),this.sectionIndex=this.sectionIndex.slice(a,f)}substring(a,f){const m=new zu;return m.text=this.text.substring(a,f),m.sectionIndex=this.sectionIndex.slice(a,f),m.sections=this.sections,m}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,f)=>Math.max(a,this.sections[f].scale),0)}addTextSection(a,f){this.text+=a.text,this.sections.push(of.forText(a.scale,a.fontStack||f));const m=this.sections.length-1;for(let b=0;b<a.text.length;++b)this.sectionIndex.push(m)}addImageSection(a){const f=a.image?a.image.name:"";if(f.length===0)return void ve("Can't add FormattedSection with an empty image.");const m=this.getNextImageSectionCharCode();m?(this.text+=String.fromCharCode(m),this.sections.push(of.forImage(f)),this.sectionIndex.push(this.sections.length-1)):ve("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ad(c,a,f,m,b,S,T,E,R,j,K,J,se,de,_e,we){const Ce=zu.fromFeature(c,b);let Pe;J===u.ah.vertical&&Ce.verticalizePunctuation();const{processBidirectionalText:Ge,processStyledBidirectionalText:De}=Is;if(Ge&&Ce.sections.length===1){Pe=[];const vt=Ge(Ce.toString(),im(Ce,j,S,a,m,de,_e));for(const Ht of vt){const tn=new zu;tn.text=Ht,tn.sections=Ce.sections;for(let qt=0;qt<Ht.length;qt++)tn.sectionIndex.push(0);Pe.push(tn)}}else if(De){Pe=[];const vt=De(Ce.text,Ce.sectionIndex,im(Ce,j,S,a,m,de,_e));for(const Ht of vt){const tn=new zu;tn.text=Ht[0],tn.sectionIndex=Ht[1],tn.sections=Ce.sections,Pe.push(tn)}}else Pe=function(vt,Ht){const tn=[],qt=vt.text;let Ut=0;for(const Ot of Ht)tn.push(vt.substring(Ut,Ot)),Ut=Ot;return Ut<qt.length&&tn.push(vt.substring(Ut,qt.length)),tn}(Ce,im(Ce,j,S,a,m,de,_e));const je=[],dt={positionedLines:je,text:Ce.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:J,iconsInText:!1,verticalizable:!1};return function(vt,Ht,tn,qt,Ut,Ot,Kt,Nt,At,cn,on,Fn){let wr=0,Ir=rf,li=0,_o=0;const ji=Nt==="right"?1:Nt==="left"?0:.5;let ei=0;for(const ui of Ut){ui.trim();const ci=ui.getMaxScale(),Ai=(ci-1)*ai,qi={positionedGlyphs:[],lineOffset:0};vt.positionedLines[ei]=qi;const Pi=qi.positionedGlyphs;let oo=0;if(!ui.length()){Ir+=Ot,++ei;continue}for(let fi=0;fi<ui.length();fi++){const jn=ui.getSection(fi),zi=ui.getSectionIndex(fi),Ci=ui.getCharCode(fi);let hi=0,Yo=null,hs=null,ds=null,Qs=ai;const Jo=!(At===u.ah.horizontal||!on&&!pu(Ci)||on&&(ld[Ci]||(yi=Ci,Vt.Arabic(yi)||Vt["Arabic Supplement"](yi)||Vt["Arabic Extended-A"](yi)||Vt["Arabic Presentation Forms-A"](yi)||Vt["Arabic Presentation Forms-B"](yi))));if(jn.imageName){const Ao=qt[jn.imageName];if(!Ao)continue;ds=jn.imageName,vt.iconsInText=vt.iconsInText||!0,hs=Ao.paddedRect;const ao=Ao.displaySize;jn.scale=jn.scale*ai/Fn,Yo={width:ao[0],height:ao[1],left:io,top:-Z_,advance:Jo?ao[1]:ao[0]},hi=Ai+(ai-ao[1]*jn.scale),Qs=Yo.advance;const ea=Jo?ao[0]*jn.scale-ai*ci:ao[1]*jn.scale-ai*ci;ea>0&&ea>oo&&(oo=ea)}else{const Ao=tn[jn.fontStack],ao=Ao&&Ao[Ci];if(ao&&ao.rect)hs=ao.rect,Yo=ao.metrics;else{const ea=Ht[jn.fontStack],cf=ea&&ea[Ci];if(!cf)continue;Yo=cf.metrics}hi=(ci-jn.scale)*ai}Jo?(vt.verticalizable=!0,Pi.push({glyph:Ci,imageName:ds,x:wr,y:Ir+hi,vertical:Jo,scale:jn.scale,fontStack:jn.fontStack,sectionIndex:zi,metrics:Yo,rect:hs}),wr+=Qs*jn.scale+cn):(Pi.push({glyph:Ci,imageName:ds,x:wr,y:Ir+hi,vertical:Jo,scale:jn.scale,fontStack:jn.fontStack,sectionIndex:zi,metrics:Yo,rect:hs}),wr+=Yo.advance*jn.scale+cn)}Pi.length!==0&&(li=Math.max(wr-cn,li),hk(Pi,0,Pi.length-1,ji,oo)),wr=0;const so=Ot*ci+oo;qi.lineOffset=Math.max(oo,Ai),Ir+=so,_o=Math.max(so,_o),++ei}var yi;const Ti=Ir-rf,{horizontalAlign:Ui,verticalAlign:Vi}=om(Kt);(function(ui,ci,Ai,qi,Pi,oo,so,fi,jn){const zi=(ci-Ai)*Pi;let Ci=0;Ci=oo!==so?-fi*qi-rf:(-qi*jn+.5)*so;for(const hi of ui)for(const Yo of hi.positionedGlyphs)Yo.x+=zi,Yo.y+=Ci})(vt.positionedLines,ji,Ui,Vi,li,_o,Ot,Ti,Ut.length),vt.top+=-Vi*Ti,vt.bottom=vt.top+Ti,vt.left+=-Ui*li,vt.right=vt.left+li}(dt,a,f,m,Pe,T,E,R,J,j,se,we),!function(vt){for(const Ht of vt)if(Ht.positionedGlyphs.length!==0)return!1;return!0}(je)&&dt}const ld={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ck={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Y_(c,a,f,m,b,S){if(a.imageName){const T=m[a.imageName];return T?T.displaySize[0]*a.scale*ai/S+b:0}{const T=f[a.fontStack],E=T&&T[c];return E?E.metrics.advance*a.scale+b:0}}function J_(c,a,f,m){const b=Math.pow(c-a,2);return m?c<a?b/2:2*b:b+Math.abs(f)*f}function fk(c,a,f){let m=0;return c===10&&(m-=1e4),f&&(m+=150),c!==40&&c!==65288||(m+=50),a!==41&&a!==65289||(m+=50),m}function Q_(c,a,f,m,b,S){let T=null,E=J_(a,f,b,S);for(const R of m){const j=J_(a-R.x,f,b,S)+R.badness;j<=E&&(T=R,E=j)}return{index:c,x:a,priorBreak:T,badness:E}}function e0(c){return c?e0(c.priorBreak).concat(c.index):[]}function im(c,a,f,m,b,S,T){if(S!=="point")return[];if(!c)return[];const E=[],R=function(se,de,_e,we,Ce,Pe){let Ge=0;for(let De=0;De<se.length();De++){const je=se.getSection(De);Ge+=Y_(se.getCharCode(De),je,we,Ce,de,Pe)}return Ge/Math.max(1,Math.ceil(Ge/_e))}(c,a,f,m,b,T),j=c.text.indexOf("")>=0;let K=0;for(let se=0;se<c.length();se++){const de=c.getSection(se),_e=c.getCharCode(se);if(ld[_e]||(K+=Y_(_e,de,m,b,a,T)),se<c.length()-1){const we=!((J=_e)<11904||!(Vt["Bopomofo Extended"](J)||Vt.Bopomofo(J)||Vt["CJK Compatibility Forms"](J)||Vt["CJK Compatibility Ideographs"](J)||Vt["CJK Compatibility"](J)||Vt["CJK Radicals Supplement"](J)||Vt["CJK Strokes"](J)||Vt["CJK Symbols and Punctuation"](J)||Vt["CJK Unified Ideographs Extension A"](J)||Vt["CJK Unified Ideographs"](J)||Vt["Enclosed CJK Letters and Months"](J)||Vt["Halfwidth and Fullwidth Forms"](J)||Vt.Hiragana(J)||Vt["Ideographic Description Characters"](J)||Vt["Kangxi Radicals"](J)||Vt["Katakana Phonetic Extensions"](J)||Vt.Katakana(J)||Vt["Vertical Forms"](J)||Vt["Yi Radicals"](J)||Vt["Yi Syllables"](J)));(ck[_e]||we||de.imageName)&&E.push(Q_(se+1,K,R,E,fk(_e,c.getCharCode(se+1),we&&j),!1))}}var J;return e0(Q_(c.length(),K,R,E,0,!0))}function om(c){let a=.5,f=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:a,verticalAlign:f}}function hk(c,a,f,m,b){if(!m&&!b)return;const S=c[f],T=(c[f].x+S.metrics.advance*S.scale)*m;for(let E=a;E<=f;E++)c[E].x-=T,c[E].y+=b}function dk(c,a,f){const{horizontalAlign:m,verticalAlign:b}=om(f),S=a[0]-c.displaySize[0]*m,T=a[1]-c.displaySize[1]*b;return{image:c,top:T,bottom:T+c.displaySize[1],left:S,right:S+c.displaySize[0]}}function t0(c,a,f,m,b,S){const T=c.image;let E;if(T.content){const Ce=T.content,Pe=T.pixelRatio||1;E=[Ce[0]/Pe,Ce[1]/Pe,T.displaySize[0]-Ce[2]/Pe,T.displaySize[1]-Ce[3]/Pe]}const R=a.left*S,j=a.right*S;let K,J,se,de;f==="width"||f==="both"?(de=b[0]+R-m[3],J=b[0]+j+m[1]):(de=b[0]+(R+j-T.displaySize[0])/2,J=de+T.displaySize[0]);const _e=a.top*S,we=a.bottom*S;return f==="height"||f==="both"?(K=b[1]+_e-m[0],se=b[1]+we+m[2]):(K=b[1]+(_e+we-T.displaySize[1])/2,se=K+T.displaySize[1]),{image:T,top:K,right:J,bottom:se,left:de,collisionPadding:E}}const sf=255,Ds=128,Ea=sf*Ds;function n0(c,a){const{expression:f}=a;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new Er(c+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:m,interpolationType:b}=f;let S=0;for(;S<m.length&&m[S]<=c;)S++;S=Math.max(0,S-1);let T=S;for(;T<m.length&&m[T]<c+1;)T++;T=Math.min(m.length-1,T);const E=m[S],R=m[T];return f.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:R,interpolationType:b}:{kind:"camera",minZoom:E,maxZoom:R,minSize:f.evaluate(new Er(E)),maxSize:f.evaluate(new Er(R)),interpolationType:b}}}function sm(c,a,f){let m="never";const b=c.get(a);return b?m=b:c.get(f)&&(m="always"),m}const pk=Ca.VectorTileFeature.types,mk=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ud(c,a,f,m,b,S,T,E,R,j,K,J,se){const de=E?Math.min(Ea,Math.round(E[0])):0,_e=E?Math.min(Ea,Math.round(E[1])):0;c.emplaceBack(a,f,Math.round(32*m),Math.round(32*b),S,T,(de<<1)+(R?1:0),_e,16*j,16*K,256*J,256*se)}function am(c,a,f){c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f),c.emplaceBack(a.x,a.y,f)}function gk(c){for(const a of c.sections)if($p(a.text))return!0;return!1}class lm{constructor(a){this.layoutVertexArray=new tt,this.indexArray=new ft,this.programConfigurations=a,this.segments=new $t,this.dynamicLayoutVertexArray=new Ie,this.opacityVertexArray=new Ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,f,m,b){this.isEmpty()||(m&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,Gx.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,Zx.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,mk,!0),this.opacityVertexBuffer.itemSize=1),(m||b)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Zt("SymbolBuffers",lm);class um{constructor(a,f,m){this.layoutVertexArray=new a,this.layoutAttributes=f,this.indexArray=new m,this.segments=new $t,this.collisionVertexArray=new st}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,Kx.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Zt("CollisionBuffers",um);class Du{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(T=>T.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Np([]),this.placementViewportMatrix=Np([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=n0(this.zoom,f["text-size"]),this.iconSizeData=n0(this.zoom,f["icon-size"]);const m=this.layers[0].layout,b=m.get("symbol-sort-key"),S=m.get("symbol-z-order");this.canOverlap=sm(m,"text-overlap","text-allow-overlap")!=="never"||sm(m,"icon-overlap","icon-allow-overlap")!=="never"||m.get("text-ignore-placement")||m.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,m.get("symbol-placement")==="point"&&(this.writingModes=m.get("text-writing-mode").map(T=>u.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=a.sourceID}createArrays(){this.text=new lm(new Fr(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new lm(new Fr(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new k,this.lineVertexArray=new z,this.symbolInstances=new v,this.textAnchorOffsets=new B}calculateGlyphDependencies(a,f,m,b,S){for(let T=0;T<a.length;T++)if(f[a.charCodeAt(T)]=!0,(m||b)&&S){const E=nf[a.charAt(T)];E&&(f[E.charCodeAt(0)]=!0)}}populate(a,f,m){const b=this.layers[0],S=b.layout,T=S.get("text-font"),E=S.get("text-field"),R=S.get("icon-image"),j=(E.value.kind!=="constant"||E.value.value instanceof Qi&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),K=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,J=S.get("symbol-sort-key");if(this.features=[],!j&&!K)return;const se=f.iconDependencies,de=f.glyphDependencies,_e=f.availableImages,we=new Er(this.zoom);for(const{feature:Ce,id:Pe,index:Ge,sourceLayerIndex:De}of a){const je=b._featureFilter.needGeometry,dt=Ys(Ce,je);if(!b._featureFilter.filter(we,dt,m))continue;let vt,Ht;if(je||(dt.geometry=Xs(Ce)),j){const qt=b.getValueAndResolveTokens("text-field",dt,m,_e),Ut=Qi.factory(qt),Ot=this.hasRTLText=this.hasRTLText||gk(Ut);(!Ot||Is.getRTLTextPluginStatus()==="unavailable"||Ot&&Is.isParsed())&&(vt=Yx(Ut,b,dt))}if(K){const qt=b.getValueAndResolveTokens("icon-image",dt,m,_e);Ht=qt instanceof po?qt:po.fromString(qt)}if(!vt&&!Ht)continue;const tn=this.sortFeaturesByKey?J.evaluate(dt,{},m):void 0;if(this.features.push({id:Pe,text:vt,icon:Ht,index:Ge,sourceLayerIndex:De,geometry:dt.geometry,properties:Ce.properties,type:pk[Ce.type],sortKey:tn}),Ht&&(se[Ht.name]=!0),vt){const qt=T.evaluate(dt,{},m).join(","),Ut=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const Ot of vt.sections)if(Ot.image)se[Ot.image.name]=!0;else{const Kt=Sa(vt.toString()),Nt=Ot.fontStack||qt,At=de[Nt]=de[Nt]||{};this.calculateGlyphDependencies(Ot.text,At,Ut,this.allowVerticalPlacement,Kt)}}}S.get("symbol-placement")==="line"&&(this.features=function(Ce){const Pe={},Ge={},De=[];let je=0;function dt(qt){De.push(Ce[qt]),je++}function vt(qt,Ut,Ot){const Kt=Ge[qt];return delete Ge[qt],Ge[Ut]=Kt,De[Kt].geometry[0].pop(),De[Kt].geometry[0]=De[Kt].geometry[0].concat(Ot[0]),Kt}function Ht(qt,Ut,Ot){const Kt=Pe[Ut];return delete Pe[Ut],Pe[qt]=Kt,De[Kt].geometry[0].shift(),De[Kt].geometry[0]=Ot[0].concat(De[Kt].geometry[0]),Kt}function tn(qt,Ut,Ot){const Kt=Ot?Ut[0][Ut[0].length-1]:Ut[0][0];return`${qt}:${Kt.x}:${Kt.y}`}for(let qt=0;qt<Ce.length;qt++){const Ut=Ce[qt],Ot=Ut.geometry,Kt=Ut.text?Ut.text.toString():null;if(!Kt){dt(qt);continue}const Nt=tn(Kt,Ot),At=tn(Kt,Ot,!0);if(Nt in Ge&&At in Pe&&Ge[Nt]!==Pe[At]){const cn=Ht(Nt,At,Ot),on=vt(Nt,At,De[cn].geometry);delete Pe[Nt],delete Ge[At],Ge[tn(Kt,De[on].geometry,!0)]=on,De[cn].geometry=null}else Nt in Ge?vt(Nt,At,Ot):At in Pe?Ht(Nt,At,Ot):(dt(qt),Pe[Nt]=je-1,Ge[At]=je-1)}return De.filter(qt=>qt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ce,Pe)=>Ce.sortKey-Pe.sortKey)}update(a,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,f,this.layers,m),this.icon.programConfigurations.updatePaintArrays(a,f,this.layers,m))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,f){const m=this.lineVertexArray.length;if(a.segment!==void 0){let b=a.dist(f[a.segment+1]),S=a.dist(f[a.segment]);const T={};for(let E=a.segment+1;E<f.length;E++)T[E]={x:f[E].x,y:f[E].y,tileUnitDistanceFromAnchor:b},E<f.length-1&&(b+=f[E+1].dist(f[E]));for(let E=a.segment||0;E>=0;E--)T[E]={x:f[E].x,y:f[E].y,tileUnitDistanceFromAnchor:S},E>0&&(S+=f[E-1].dist(f[E]));for(let E=0;E<f.length;E++){const R=T[E];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:m,lineLength:this.lineVertexArray.length-m}}addSymbols(a,f,m,b,S,T,E,R,j,K,J,se){const de=a.indexArray,_e=a.layoutVertexArray,we=a.segments.prepareSegment(4*f.length,_e,de,this.canOverlap?T.sortKey:void 0),Ce=this.glyphOffsetArray.length,Pe=we.vertexLength,Ge=this.allowVerticalPlacement&&E===u.ah.vertical?Math.PI/2:0,De=T.text&&T.text.sections;for(let je=0;je<f.length;je++){const{tl:dt,tr:vt,bl:Ht,br:tn,tex:qt,pixelOffsetTL:Ut,pixelOffsetBR:Ot,minFontScaleX:Kt,minFontScaleY:Nt,glyphOffset:At,isSDF:cn,sectionIndex:on}=f[je],Fn=we.vertexLength,wr=At[1];ud(_e,R.x,R.y,dt.x,wr+dt.y,qt.x,qt.y,m,cn,Ut.x,Ut.y,Kt,Nt),ud(_e,R.x,R.y,vt.x,wr+vt.y,qt.x+qt.w,qt.y,m,cn,Ot.x,Ut.y,Kt,Nt),ud(_e,R.x,R.y,Ht.x,wr+Ht.y,qt.x,qt.y+qt.h,m,cn,Ut.x,Ot.y,Kt,Nt),ud(_e,R.x,R.y,tn.x,wr+tn.y,qt.x+qt.w,qt.y+qt.h,m,cn,Ot.x,Ot.y,Kt,Nt),am(a.dynamicLayoutVertexArray,R,Ge),de.emplaceBack(Fn,Fn+1,Fn+2),de.emplaceBack(Fn+1,Fn+2,Fn+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(At[0]),je!==f.length-1&&on===f[je+1].sectionIndex||a.programConfigurations.populatePaintArrays(_e.length,T,T.index,{},se,De&&De[on])}a.placedSymbolArray.emplaceBack(R.x,R.y,Ce,this.glyphOffsetArray.length-Ce,Pe,j,K,R.segment,m?m[0]:0,m?m[1]:0,b[0],b[1],E,0,!1,0,J)}_addCollisionDebugVertex(a,f,m,b,S,T){return f.emplaceBack(0,0),a.emplaceBack(m.x,m.y,b,S,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(a,f,m,b,S,T,E){const R=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),j=R.vertexLength,K=S.layoutVertexArray,J=S.collisionVertexArray,se=E.anchorX,de=E.anchorY;this._addCollisionDebugVertex(K,J,T,se,de,new _(a,f)),this._addCollisionDebugVertex(K,J,T,se,de,new _(m,f)),this._addCollisionDebugVertex(K,J,T,se,de,new _(m,b)),this._addCollisionDebugVertex(K,J,T,se,de,new _(a,b)),R.vertexLength+=4;const _e=S.indexArray;_e.emplaceBack(j,j+1),_e.emplaceBack(j+1,j+2),_e.emplaceBack(j+2,j+3),_e.emplaceBack(j+3,j),R.primitiveLength+=4}addDebugCollisionBoxes(a,f,m,b){for(let S=a;S<f;S++){const T=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,b?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,m)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new um(rt,N_.members,Ct),this.iconCollisionBox=new um(rt,N_.members,Ct);for(let a=0;a<this.symbolInstances.length;a++){const f=this.symbolInstances.get(a);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(a,f,m,b,S,T,E,R,j){const K={};for(let J=f;J<m;J++){const se=a.get(J);K.textBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},K.textFeatureIndex=se.featureIndex;break}for(let J=b;J<S;J++){const se=a.get(J);K.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},K.verticalTextFeatureIndex=se.featureIndex;break}for(let J=T;J<E;J++){const se=a.get(J);K.iconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},K.iconFeatureIndex=se.featureIndex;break}for(let J=R;J<j;J++){const se=a.get(J);K.verticalIconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},K.verticalIconFeatureIndex=se.featureIndex;break}return K}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,m.textBoxStartIndex,m.textBoxEndIndex,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m.iconBoxStartIndex,m.iconBoxEndIndex,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,f){const m=a.placedSymbolArray.get(f),b=m.vertexStartIndex+4*m.numGlyphs;for(let S=m.vertexStartIndex;S<b;S+=4)a.indexArray.emplaceBack(S,S+1,S+2),a.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(a),m=Math.cos(a),b=[],S=[],T=[];for(let E=0;E<this.symbolInstances.length;++E){T.push(E);const R=this.symbolInstances.get(E);b.push(0|Math.round(f*R.anchorX+m*R.anchorY)),S.push(R.featureIndex)}return T.sort((E,R)=>b[E]-b[R]||S[R]-S[E]),T}addToSortKeyRanges(a,f){const m=this.sortKeyRanges[this.sortKeyRanges.length-1];m&&m.sortKey===f?m.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const m=this.symbolInstances.get(f);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach((b,S,T)=>{b>=0&&T.indexOf(b)===S&&this.addIndicesForPlacedSymbol(this.text,b)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let r0,i0;Zt("SymbolBucket",Du,{omit:["layers","collisionBoxArray","features","compareText"]}),Du.MAX_GLYPHS=65535,Du.addDynamicAttributes=am;var cm={get paint(){return i0=i0||new Bi({"icon-opacity":new hn(pe.paint_symbol["icon-opacity"]),"icon-color":new hn(pe.paint_symbol["icon-color"]),"icon-halo-color":new hn(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new hn(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new hn(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new sn(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new sn(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new hn(pe.paint_symbol["text-opacity"]),"text-color":new hn(pe.paint_symbol["text-color"],{runtimeType:Rt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new hn(pe.paint_symbol["text-halo-color"]),"text-halo-width":new hn(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new hn(pe.paint_symbol["text-halo-blur"]),"text-translate":new sn(pe.paint_symbol["text-translate"]),"text-translate-anchor":new sn(pe.paint_symbol["text-translate-anchor"])})},get layout(){return r0=r0||new Bi({"symbol-placement":new sn(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new sn(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new sn(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new hn(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new sn(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new sn(pe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new sn(pe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new sn(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new sn(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new sn(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new hn(pe.layout_symbol["icon-size"]),"icon-text-fit":new sn(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new sn(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new hn(pe.layout_symbol["icon-image"]),"icon-rotate":new hn(pe.layout_symbol["icon-rotate"]),"icon-padding":new hn(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new sn(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new hn(pe.layout_symbol["icon-offset"]),"icon-anchor":new hn(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new sn(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new sn(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new sn(pe.layout_symbol["text-rotation-alignment"]),"text-field":new hn(pe.layout_symbol["text-field"]),"text-font":new hn(pe.layout_symbol["text-font"]),"text-size":new hn(pe.layout_symbol["text-size"]),"text-max-width":new hn(pe.layout_symbol["text-max-width"]),"text-line-height":new sn(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new hn(pe.layout_symbol["text-letter-spacing"]),"text-justify":new hn(pe.layout_symbol["text-justify"]),"text-radial-offset":new hn(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new sn(pe.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new hn(pe.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new hn(pe.layout_symbol["text-anchor"]),"text-max-angle":new sn(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new sn(pe.layout_symbol["text-writing-mode"]),"text-rotate":new hn(pe.layout_symbol["text-rotate"]),"text-padding":new sn(pe.layout_symbol["text-padding"]),"text-keep-upright":new sn(pe.layout_symbol["text-keep-upright"]),"text-transform":new hn(pe.layout_symbol["text-transform"]),"text-offset":new hn(pe.layout_symbol["text-offset"]),"text-allow-overlap":new sn(pe.layout_symbol["text-allow-overlap"]),"text-overlap":new sn(pe.layout_symbol["text-overlap"]),"text-ignore-placement":new sn(pe.layout_symbol["text-ignore-placement"]),"text-optional":new sn(pe.layout_symbol["text-optional"])})}};class o0{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:Bn,this.defaultValue=a}evaluate(a){if(a.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(a.formattedSection))return f.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt("FormatSectionOverride",o0,{omit:["defaultValue"]});class cd extends Eo{constructor(a){super(a,cm)}recalculate(a,f){if(super.recalculate(a,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const m=this.layout.get("text-writing-mode");if(m){const b=[];for(const S of m)b.indexOf(S)<0&&b.push(S);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,f,m,b){const S=this.layout.get(a).evaluate(f,{},m,b),T=this._unevaluatedLayout._values[a];return T.isDataDriven()||pr(T.value)||!S?S:function(E,R){return R.replace(/{([^{}]+)}/g,(j,K)=>E&&K in E?String(E[K]):"")}(f.properties,S)}createBucket(a){return new Du(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of cm.paint.overridableProperties){if(!cd.hasPaintOverride(this.layout,a))continue;const f=this.paint.get(a),m=new o0(f),b=new br(m,f.property.specification);let S=null;S=f.value.kind==="constant"||f.value.kind==="source"?new ru("source",b):new xc("composite",b,f.value.zoomStops),this.paint._values[a]=new Mo(f.property,S,f.parameters)}}_handleOverridablePaintPropertyUpdate(a,f,m){return!(!this.layout||f.isDataDriven()||m.isDataDriven())&&cd.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,f){const m=a.get("text-field"),b=cm.paint.properties[f];let S=!1;const T=E=>{for(const R of E)if(b.overrides&&b.overrides.hasOverride(R))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Qi)T(m.value.value.sections);else if(m.value.kind==="source"){const E=j=>{S||(j instanceof Ts&&Xr(j.value)===or?T(j.value.sections):j instanceof tu?T(j.sections):j.eachChild(E))},R=m.value;R._styleExpression&&E(R._styleExpression.expression)}return S}}let s0;var _k={get paint(){return s0=s0||new Bi({"background-color":new sn(pe.paint_background["background-color"]),"background-pattern":new _l(pe.paint_background["background-pattern"]),"background-opacity":new sn(pe.paint_background["background-opacity"])})}};class yk extends Eo{constructor(a){super(a,_k)}}let a0;var vk={get paint(){return a0=a0||new Bi({"raster-opacity":new sn(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new sn(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new sn(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new sn(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new sn(pe.paint_raster["raster-saturation"]),"raster-contrast":new sn(pe.paint_raster["raster-contrast"]),"raster-resampling":new sn(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new sn(pe.paint_raster["raster-fade-duration"])})}};class bk extends Eo{constructor(a){super(a,vk)}}class wk extends Eo{constructor(a){super(a,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class xk{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const fm=63710088e-1;class La{constructor(a,f){if(isNaN(a)||isNaN(f))throw new Error(`Invalid LngLat object: (${a}, ${f})`);if(this.lng=+a,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new La(X(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const f=Math.PI/180,m=this.lat*f,b=a.lat*f,S=Math.sin(m)*Math.sin(b)+Math.cos(m)*Math.cos(b)*Math.cos((a.lng-this.lng)*f);return fm*Math.acos(Math.min(S,1))}static convert(a){if(a instanceof La)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new La(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new La(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const l0=2*Math.PI*fm;function u0(c){return l0*Math.cos(c*Math.PI/180)}function c0(c){return(180+c)/360}function f0(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function h0(c,a){return c/u0(a)}function hm(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class fd{constructor(a,f,m=0){this.x=+a,this.y=+f,this.z=+m}static fromLngLat(a,f=0){const m=La.convert(a);return new fd(c0(m.lng),f0(m.lat),h0(f,m.lat))}toLngLat(){return new La(360*this.x-180,hm(this.y))}toAltitude(){return this.z*u0(hm(this.y))}meterInMercatorCoordinateUnits(){return 1/l0*(a=hm(this.y),1/Math.cos(a*Math.PI/180));var a}}function d0(c,a,f){var m=2*Math.PI*6378137/256/Math.pow(2,f);return[c*m-2*Math.PI*6378137/2,a*m-2*Math.PI*6378137/2]}class dm{constructor(a,f,m){if(a<0||a>25||m<0||m>=Math.pow(2,a)||f<0||f>=Math.pow(2,a))throw new Error(`x=${f}, y=${m}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=f,this.y=m,this.key=af(0,a,a,f,m)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,f,m){const b=(T=this.y,E=this.z,R=d0(256*(S=this.x),256*(T=Math.pow(2,E)-T-1),E),j=d0(256*(S+1),256*(T+1),E),R[0]+","+R[1]+","+j[0]+","+j[1]);var S,T,E,R,j;const K=function(J,se,de){let _e,we="";for(let Ce=J;Ce>0;Ce--)_e=1<<Ce-1,we+=(se&_e?1:0)+(de&_e?2:0);return we}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(m==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,K).replace(/{bbox-epsg-3857}/g,b)}isChildOf(a){const f=this.z-a.z;return f>0&&a.x===this.x>>f&&a.y===this.y>>f}getTilePoint(a){const f=Math.pow(2,this.z);return new _((a.x*f-this.x)*qr,(a.y*f-this.y)*qr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class p0{constructor(a,f){this.wrap=a,this.canonical=f,this.key=af(a,f.z,f.z,f.x,f.y)}}class Io{constructor(a,f,m,b,S){if(a<m)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${m}`);this.overscaledZ=a,this.wrap=f,this.canonical=new dm(m,+b,+S),this.key=af(f,a,m,b,S)}clone(){return new Io(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-a;return a>this.canonical.z?new Io(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Io(a,this.wrap,a,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(a,f){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-a;return a>this.canonical.z?af(this.wrap*+f,a,this.canonical.z,this.canonical.x,this.canonical.y):af(this.wrap*+f,a,a,this.canonical.x>>m,this.canonical.y>>m)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const f=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>f&&a.canonical.y===this.canonical.y>>f}children(a){if(this.overscaledZ>=a)return[new Io(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,m=2*this.canonical.x,b=2*this.canonical.y;return[new Io(f,this.wrap,f,m,b),new Io(f,this.wrap,f,m+1,b),new Io(f,this.wrap,f,m,b+1),new Io(f,this.wrap,f,m+1,b+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Io(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Io(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new p0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new fd(a.x-this.wrap,a.y))}}function af(c,a,f,m,b){(c*=2)<0&&(c=-1*c-1);const S=1<<f;return(S*S*c+S*b+m).toString(36)+f.toString(36)+a.toString(36)}Zt("CanonicalTileID",dm),Zt("OverscaledTileID",Io,{omit:["posMatrix"]});class m0{constructor(a,f,m,b=1,S=1,T=1,E=0){if(this.uid=a,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(m&&!["mapbox","terrarium","custom"].includes(m))return void ve(`"${m}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const R=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),m){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=S,this.blueFactor=T,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let j=0;j<R;j++)this.data[this._idx(-1,j)]=this.data[this._idx(0,j)],this.data[this._idx(R,j)]=this.data[this._idx(R-1,j)],this.data[this._idx(j,-1)]=this.data[this._idx(j,0)],this.data[this._idx(j,R)]=this.data[this._idx(j,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let j=0;j<R;j++)for(let K=0;K<R;K++){const J=this.get(j,K);J>this.max&&(this.max=J),J<this.min&&(this.min=J)}}get(a,f){const m=new Uint8Array(this.data.buffer),b=4*this._idx(a,f);return this.unpack(m[b],m[b+1],m[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,f){if(a<-1||a>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(a+1)}unpack(a,f,m){return a*this.redFactor+f*this.greenFactor+m*this.blueFactor-this.baseShift}getPixels(){return new Lo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,f,m){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let b=f*this.dim,S=f*this.dim+this.dim,T=m*this.dim,E=m*this.dim+this.dim;switch(f){case-1:b=S-1;break;case 1:S=b+1}switch(m){case-1:T=E-1;break;case 1:E=T+1}const R=-f*this.dim,j=-m*this.dim;for(let K=T;K<E;K++)for(let J=b;J<S;J++)this.data[this._idx(J,K)]=a.data[this._idx(J+R,K+j)]}}Zt("DEMData",m0);class g0{constructor(a){this._stringToNumber={},this._numberToString=[];for(let f=0;f<a.length;f++){const m=a[f];this._stringToNumber[m]=f,this._numberToString[f]=m}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class _0{constructor(a,f,m,b,S){this.type="Feature",this._vectorTileFeature=a,a._z=f,a._x=m,a._y=b,this.properties=a.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(a[f]=this[f]);return a}}class y0{constructor(a,f){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new pl(qr,16,0),this.grid3D=new pl(qr,16,0),this.featureIndexArray=new Q,this.promoteId=f}insert(a,f,m,b,S,T){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(m,b,S);const R=T?this.grid3D:this.grid;for(let j=0;j<f.length;j++){const K=f[j],J=[1/0,1/0,-1/0,-1/0];for(let se=0;se<K.length;se++){const de=K[se];J[0]=Math.min(J[0],de.x),J[1]=Math.min(J[1],de.y),J[2]=Math.max(J[2],de.x),J[3]=Math.max(J[3],de.y)}J[0]<qr&&J[1]<qr&&J[2]>=0&&J[3]>=0&&R.insert(E,J[0],J[1],J[2],J[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ca.VectorTile(new tm(this.rawTileData)).layers,this.sourceLayerCoder=new g0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,f,m,b){this.loadVTLayers();const S=a.params||{},T=qr/a.tileSize/a.scale,E=au(S.filter),R=a.queryGeometry,j=a.queryPadding*T,K=b0(R),J=this.grid.query(K.minX-j,K.minY-j,K.maxX+j,K.maxY+j),se=b0(a.cameraQueryGeometry),de=this.grid3D.query(se.minX-j,se.minY-j,se.maxX+j,se.maxY+j,(Ce,Pe,Ge,De)=>function(je,dt,vt,Ht,tn){for(const Ut of je)if(dt<=Ut.x&&vt<=Ut.y&&Ht>=Ut.x&&tn>=Ut.y)return!0;const qt=[new _(dt,vt),new _(dt,tn),new _(Ht,tn),new _(Ht,vt)];if(je.length>2){for(const Ut of qt)if(Mu(je,Ut))return!0}for(let Ut=0;Ut<je.length-1;Ut++)if(ex(je[Ut],je[Ut+1],qt))return!0;return!1}(a.cameraQueryGeometry,Ce-j,Pe-j,Ge+j,De+j));for(const Ce of de)J.push(Ce);J.sort(kk);const _e={};let we;for(let Ce=0;Ce<J.length;Ce++){const Pe=J[Ce];if(Pe===we)continue;we=Pe;const Ge=this.featureIndexArray.get(Pe);let De=null;this.loadMatchingFeature(_e,Ge.bucketIndex,Ge.sourceLayerIndex,Ge.featureIndex,E,S.layers,S.availableImages,f,m,b,(je,dt,vt)=>(De||(De=Xs(je)),dt.queryIntersectsFeature(R,je,vt,De,this.z,a.transform,T,a.pixelPosMatrix)))}return _e}loadMatchingFeature(a,f,m,b,S,T,E,R,j,K,J){const se=this.bucketLayerIDs[f];if(T&&!function(Ce,Pe){for(let Ge=0;Ge<Ce.length;Ge++)if(Pe.indexOf(Ce[Ge])>=0)return!0;return!1}(T,se))return;const de=this.sourceLayerCoder.decode(m),_e=this.vtLayers[de].feature(b);if(S.needGeometry){const Ce=Ys(_e,!0);if(!S.filter(new Er(this.tileID.overscaledZ),Ce,this.tileID.canonical))return}else if(!S.filter(new Er(this.tileID.overscaledZ),_e))return;const we=this.getId(_e,de);for(let Ce=0;Ce<se.length;Ce++){const Pe=se[Ce];if(T&&T.indexOf(Pe)<0)continue;const Ge=R[Pe];if(!Ge)continue;let De={};we&&K&&(De=K.getState(Ge.sourceLayer||"_geojsonTileLayer",we));const je=q({},j[Pe]);je.paint=v0(je.paint,Ge.paint,_e,De,E),je.layout=v0(je.layout,Ge.layout,_e,De,E);const dt=!J||J(_e,Ge,De);if(!dt)continue;const vt=new _0(_e,this.z,this.x,this.y,we);vt.layer=je;let Ht=a[Pe];Ht===void 0&&(Ht=a[Pe]=[]),Ht.push({featureIndex:b,feature:vt,intersectionZ:dt})}}lookupSymbolFeatures(a,f,m,b,S,T,E,R){const j={};this.loadVTLayers();const K=au(S);for(const J of a)this.loadMatchingFeature(j,m,b,J,K,T,E,R,f);return j}hasLayer(a){for(const f of this.bucketLayerIDs)for(const m of f)if(a===m)return!0;return!1}getId(a,f){let m=a.id;return this.promoteId&&(m=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof m=="boolean"&&(m=Number(m))),m}}function v0(c,a,f,m,b){return fe(c,(S,T)=>{const E=a instanceof gl?a.get(T):null;return E&&E.evaluate?E.evaluate(f,m,b):E})}function b0(c){let a=1/0,f=1/0,m=-1/0,b=-1/0;for(const S of c)a=Math.min(a,S.x),f=Math.min(f,S.y),m=Math.max(m,S.x),b=Math.max(b,S.y);return{minX:a,minY:f,maxX:m,maxY:b}}function kk(c,a){return a-c}function w0(c,a,f,m,b){const S=[];for(let T=0;T<c.length;T++){const E=c[T];let R;for(let j=0;j<E.length-1;j++){let K=E[j],J=E[j+1];K.x<a&&J.x<a||(K.x<a?K=new _(a,K.y+(a-K.x)/(J.x-K.x)*(J.y-K.y))._round():J.x<a&&(J=new _(a,K.y+(a-K.x)/(J.x-K.x)*(J.y-K.y))._round()),K.y<f&&J.y<f||(K.y<f?K=new _(K.x+(f-K.y)/(J.y-K.y)*(J.x-K.x),f)._round():J.y<f&&(J=new _(K.x+(f-K.y)/(J.y-K.y)*(J.x-K.x),f)._round()),K.x>=m&&J.x>=m||(K.x>=m?K=new _(m,K.y+(m-K.x)/(J.x-K.x)*(J.y-K.y))._round():J.x>=m&&(J=new _(m,K.y+(m-K.x)/(J.x-K.x)*(J.y-K.y))._round()),K.y>=b&&J.y>=b||(K.y>=b?K=new _(K.x+(b-K.y)/(J.y-K.y)*(J.x-K.x),b)._round():J.y>=b&&(J=new _(K.x+(b-K.y)/(J.y-K.y)*(J.x-K.x),b)._round()),R&&K.equals(R[R.length-1])||(R=[K],S.push(R)),R.push(J)))))}}return S}Zt("FeatureIndex",y0,{omit:["rawTileData","sourceLayerCoder"]});class Ia extends _{constructor(a,f,m,b){super(a,f),this.angle=m,b!==void 0&&(this.segment=b)}clone(){return new Ia(this.x,this.y,this.angle,this.segment)}}function x0(c,a,f,m,b){if(a.segment===void 0||f===0)return!0;let S=a,T=a.segment+1,E=0;for(;E>-f/2;){if(T--,T<0)return!1;E-=c[T].dist(S),S=c[T]}E+=c[T].dist(c[T+1]),T++;const R=[];let j=0;for(;E<f/2;){const K=c[T],J=c[T+1];if(!J)return!1;let se=c[T-1].angleTo(K)-K.angleTo(J);for(se=Math.abs((se+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:E,angleDelta:se}),j+=se;E-R[0].distance>m;)j-=R.shift().angleDelta;if(j>b)return!1;T++,E+=K.dist(J)}return!0}function k0(c){let a=0;for(let f=0;f<c.length-1;f++)a+=c[f].dist(c[f+1]);return a}function S0(c,a,f){return c?.6*a*f:0}function T0(c,a){return Math.max(c?c.right-c.left:0,a?a.right-a.left:0)}function Sk(c,a,f,m,b,S){const T=S0(f,b,S),E=T0(f,m)*S;let R=0;const j=k0(c)/2;for(let K=0;K<c.length-1;K++){const J=c[K],se=c[K+1],de=J.dist(se);if(R+de>j){const _e=(j-R)/de,we=Li.number(J.x,se.x,_e),Ce=Li.number(J.y,se.y,_e),Pe=new Ia(we,Ce,se.angleTo(J),K);return Pe._round(),!T||x0(c,Pe,E,T,a)?Pe:void 0}R+=de}}function Tk(c,a,f,m,b,S,T,E,R){const j=S0(m,S,T),K=T0(m,b),J=K*T,se=c[0].x===0||c[0].x===R||c[0].y===0||c[0].y===R;return a-J<a/4&&(a=J+a/4),C0(c,se?a/2*E%a:(K/2+2*S)*T*E%a,a,j,f,J,se,!1,R)}function C0(c,a,f,m,b,S,T,E,R){const j=S/2,K=k0(c);let J=0,se=a-f,de=[];for(let _e=0;_e<c.length-1;_e++){const we=c[_e],Ce=c[_e+1],Pe=we.dist(Ce),Ge=Ce.angleTo(we);for(;se+f<J+Pe;){se+=f;const De=(se-J)/Pe,je=Li.number(we.x,Ce.x,De),dt=Li.number(we.y,Ce.y,De);if(je>=0&&je<R&&dt>=0&&dt<R&&se-j>=0&&se+j<=K){const vt=new Ia(je,dt,Ge,_e);vt._round(),m&&!x0(c,vt,S,m,b)||de.push(vt)}}J+=Pe}return E||de.length||T||(de=C0(c,J/2,f,m,b,S,T,!0,R)),de}Zt("Anchor",Ia);const Ru=io;function M0(c,a,f,m){const b=[],S=c.image,T=S.pixelRatio,E=S.paddedRect.w-2*Ru,R=S.paddedRect.h-2*Ru,j=c.right-c.left,K=c.bottom-c.top,J=S.stretchX||[[0,E]],se=S.stretchY||[[0,R]],de=(Ot,Kt)=>Ot+Kt[1]-Kt[0],_e=J.reduce(de,0),we=se.reduce(de,0),Ce=E-_e,Pe=R-we;let Ge=0,De=_e,je=0,dt=we,vt=0,Ht=Ce,tn=0,qt=Pe;if(S.content&&m){const Ot=S.content;Ge=hd(J,0,Ot[0]),je=hd(se,0,Ot[1]),De=hd(J,Ot[0],Ot[2]),dt=hd(se,Ot[1],Ot[3]),vt=Ot[0]-Ge,tn=Ot[1]-je,Ht=Ot[2]-Ot[0]-De,qt=Ot[3]-Ot[1]-dt}const Ut=(Ot,Kt,Nt,At)=>{const cn=dd(Ot.stretch-Ge,De,j,c.left),on=pd(Ot.fixed-vt,Ht,Ot.stretch,_e),Fn=dd(Kt.stretch-je,dt,K,c.top),wr=pd(Kt.fixed-tn,qt,Kt.stretch,we),Ir=dd(Nt.stretch-Ge,De,j,c.left),li=pd(Nt.fixed-vt,Ht,Nt.stretch,_e),_o=dd(At.stretch-je,dt,K,c.top),ji=pd(At.fixed-tn,qt,At.stretch,we),ei=new _(cn,Fn),yi=new _(Ir,Fn),Ti=new _(Ir,_o),Ui=new _(cn,_o),Vi=new _(on/T,wr/T),ui=new _(li/T,ji/T),ci=a*Math.PI/180;if(ci){const Pi=Math.sin(ci),oo=Math.cos(ci),so=[oo,-Pi,Pi,oo];ei._matMult(so),yi._matMult(so),Ui._matMult(so),Ti._matMult(so)}const Ai=Ot.stretch+Ot.fixed,qi=Kt.stretch+Kt.fixed;return{tl:ei,tr:yi,bl:Ui,br:Ti,tex:{x:S.paddedRect.x+Ru+Ai,y:S.paddedRect.y+Ru+qi,w:Nt.stretch+Nt.fixed-Ai,h:At.stretch+At.fixed-qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vi,pixelOffsetBR:ui,minFontScaleX:Ht/T/j,minFontScaleY:qt/T/K,isSDF:f}};if(m&&(S.stretchX||S.stretchY)){const Ot=E0(J,Ce,_e),Kt=E0(se,Pe,we);for(let Nt=0;Nt<Ot.length-1;Nt++){const At=Ot[Nt],cn=Ot[Nt+1];for(let on=0;on<Kt.length-1;on++)b.push(Ut(At,Kt[on],cn,Kt[on+1]))}}else b.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:R+1}));return b}function hd(c,a,f){let m=0;for(const b of c)m+=Math.max(a,Math.min(f,b[1]))-Math.max(a,Math.min(f,b[0]));return m}function E0(c,a,f){const m=[{fixed:-Ru,stretch:0}];for(const[b,S]of c){const T=m[m.length-1];m.push({fixed:b-T.stretch,stretch:T.stretch}),m.push({fixed:b-T.stretch,stretch:T.stretch+(S-b)})}return m.push({fixed:a+Ru,stretch:f}),m}function dd(c,a,f,m){return c/a*f+m}function pd(c,a,f,m){return c-a*f/m}class md{constructor(a,f,m,b,S,T,E,R,j,K){if(this.boxStartIndex=a.length,j){let J=T.top,se=T.bottom;const de=T.collisionPadding;de&&(J-=de[1],se+=de[3]);let _e=se-J;_e>0&&(_e=Math.max(10,_e),this.circleDiameter=_e)}else{let J=T.top*E-R[0],se=T.bottom*E+R[2],de=T.left*E-R[3],_e=T.right*E+R[1];const we=T.collisionPadding;if(we&&(de-=we[0]*E,J-=we[1]*E,_e+=we[2]*E,se+=we[3]*E),K){const Ce=new _(de,J),Pe=new _(_e,J),Ge=new _(de,se),De=new _(_e,se),je=K*Math.PI/180;Ce._rotate(je),Pe._rotate(je),Ge._rotate(je),De._rotate(je),de=Math.min(Ce.x,Pe.x,Ge.x,De.x),_e=Math.max(Ce.x,Pe.x,Ge.x,De.x),J=Math.min(Ce.y,Pe.y,Ge.y,De.y),se=Math.max(Ce.y,Pe.y,Ge.y,De.y)}a.emplaceBack(f.x,f.y,de,J,_e,se,m,b,S)}this.boxEndIndex=a.length}}class Ck{constructor(a=[],f=Mk){if(this.data=a,this.length=this.data.length,this.compare=f,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const a=this.data[0],f=this.data.pop();return this.length--,this.length>0&&(this.data[0]=f,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:f,compare:m}=this,b=f[a];for(;a>0;){const S=a-1>>1,T=f[S];if(m(b,T)>=0)break;f[a]=T,a=S}f[a]=b}_down(a){const{data:f,compare:m}=this,b=this.length>>1,S=f[a];for(;a<b;){let T=1+(a<<1),E=f[T];const R=T+1;if(R<this.length&&m(f[R],E)<0&&(T=R,E=f[R]),m(E,S)>=0)break;f[a]=E,a=T}f[a]=S}}function Mk(c,a){return c<a?-1:c>a?1:0}function Ek(c,a=1,f=!1){let m=1/0,b=1/0,S=-1/0,T=-1/0;const E=c[0];for(let de=0;de<E.length;de++){const _e=E[de];(!de||_e.x<m)&&(m=_e.x),(!de||_e.y<b)&&(b=_e.y),(!de||_e.x>S)&&(S=_e.x),(!de||_e.y>T)&&(T=_e.y)}const R=Math.min(S-m,T-b);let j=R/2;const K=new Ck([],Lk);if(R===0)return new _(m,b);for(let de=m;de<S;de+=R)for(let _e=b;_e<T;_e+=R)K.push(new Fu(de+j,_e+j,j,c));let J=function(de){let _e=0,we=0,Ce=0;const Pe=de[0];for(let Ge=0,De=Pe.length,je=De-1;Ge<De;je=Ge++){const dt=Pe[Ge],vt=Pe[je],Ht=dt.x*vt.y-vt.x*dt.y;we+=(dt.x+vt.x)*Ht,Ce+=(dt.y+vt.y)*Ht,_e+=3*Ht}return new Fu(we/_e,Ce/_e,0,de)}(c),se=K.length;for(;K.length;){const de=K.pop();(de.d>J.d||!J.d)&&(J=de,f&&console.log("found best %d after %d probes",Math.round(1e4*de.d)/1e4,se)),de.max-J.d<=a||(j=de.h/2,K.push(new Fu(de.p.x-j,de.p.y-j,j,c)),K.push(new Fu(de.p.x+j,de.p.y-j,j,c)),K.push(new Fu(de.p.x-j,de.p.y+j,j,c)),K.push(new Fu(de.p.x+j,de.p.y+j,j,c)),se+=4)}return f&&(console.log(`num probes: ${se}`),console.log(`best distance: ${J.d}`)),J.p}function Lk(c,a){return a.max-c.max}function Fu(c,a,f,m){this.p=new _(c,a),this.h=f,this.d=function(b,S){let T=!1,E=1/0;for(let R=0;R<S.length;R++){const j=S[R];for(let K=0,J=j.length,se=J-1;K<J;se=K++){const de=j[K],_e=j[se];de.y>b.y!=_e.y>b.y&&b.x<(_e.x-de.x)*(b.y-de.y)/(_e.y-de.y)+de.x&&(T=!T),E=Math.min(E,f_(b,de,_e))}}return(T?1:-1)*Math.sqrt(E)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}var Si;u.ap=void 0,(Si=u.ap||(u.ap={}))[Si.center=1]="center",Si[Si.left=2]="left",Si[Si.right=3]="right",Si[Si.top=4]="top",Si[Si.bottom=5]="bottom",Si[Si["top-left"]=6]="top-left",Si[Si["top-right"]=7]="top-right",Si[Si["bottom-left"]=8]="bottom-left",Si[Si["bottom-right"]=9]="bottom-right";const Aa=7,pm=Number.POSITIVE_INFINITY;function L0(c,a){return a[1]!==pm?function(f,m,b){let S=0,T=0;switch(m=Math.abs(m),b=Math.abs(b),f){case"top-right":case"top-left":case"top":T=b-Aa;break;case"bottom-right":case"bottom-left":case"bottom":T=-b+Aa}switch(f){case"top-right":case"bottom-right":case"right":S=-m;break;case"top-left":case"bottom-left":case"left":S=m}return[S,T]}(c,a[0],a[1]):function(f,m){let b=0,S=0;m<0&&(m=0);const T=m/Math.SQRT2;switch(f){case"top-right":case"top-left":S=T-Aa;break;case"bottom-right":case"bottom-left":S=-T+Aa;break;case"bottom":S=-m+Aa;break;case"top":S=m-Aa}switch(f){case"top-right":case"bottom-right":b=-T;break;case"top-left":case"bottom-left":b=T;break;case"left":b=m;break;case"right":b=-m}return[b,S]}(c,a[0])}function I0(c,a,f){var m;const b=c.layout,S=(m=b.get("text-variable-anchor-offset"))===null||m===void 0?void 0:m.evaluate(a,{},f);if(S){const E=S.values,R=[];for(let j=0;j<E.length;j+=2){const K=R[j]=E[j],J=E[j+1].map(se=>se*ai);K.startsWith("top")?J[1]-=Aa:K.startsWith("bottom")&&(J[1]+=Aa),R[j+1]=J}return new ho(R)}const T=b.get("text-variable-anchor");if(T){let E;E=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(a,{},f)*ai,pm]:b.get("text-offset").evaluate(a,{},f).map(j=>j*ai);const R=[];for(const j of T)R.push(j,L0(j,E));return new ho(R)}return null}function mm(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ik(c,a,f,m,b,S,T,E,R,j,K){let J=S.textMaxSize.evaluate(a,{});J===void 0&&(J=T);const se=c.layers[0].layout,de=se.get("icon-offset").evaluate(a,{},K),_e=P0(f.horizontal),we=T/24,Ce=c.tilePixelRatio*we,Pe=c.tilePixelRatio*J/24,Ge=c.tilePixelRatio*E,De=c.tilePixelRatio*se.get("symbol-spacing"),je=se.get("text-padding")*c.tilePixelRatio,dt=function(At,cn,on,Fn=1){const wr=At.get("icon-padding").evaluate(cn,{},on),Ir=wr&&wr.values;return[Ir[0]*Fn,Ir[1]*Fn,Ir[2]*Fn,Ir[3]*Fn]}(se,a,K,c.tilePixelRatio),vt=se.get("text-max-angle")/180*Math.PI,Ht=se.get("text-rotation-alignment")!=="viewport"&&se.get("symbol-placement")!=="point",tn=se.get("icon-rotation-alignment")==="map"&&se.get("symbol-placement")!=="point",qt=se.get("symbol-placement"),Ut=De/2,Ot=se.get("icon-text-fit");let Kt;m&&Ot!=="none"&&(c.allowVerticalPlacement&&f.vertical&&(Kt=t0(m,f.vertical,Ot,se.get("icon-text-fit-padding"),de,we)),_e&&(m=t0(m,_e,Ot,se.get("icon-text-fit-padding"),de,we)));const Nt=(At,cn)=>{cn.x<0||cn.x>=qr||cn.y<0||cn.y>=qr||function(on,Fn,wr,Ir,li,_o,ji,ei,yi,Ti,Ui,Vi,ui,ci,Ai,qi,Pi,oo,so,fi,jn,zi,Ci,hi,Yo){const hs=on.addToLineVertexArray(Fn,wr);let ds,Qs,Jo,Ao,ao=0,ea=0,cf=0,F0=0,km=-1,Sm=-1;const ta={};let O0=jr("");if(on.allowVerticalPlacement&&Ir.vertical){const Di=ei.layout.get("text-rotate").evaluate(jn,{},hi)+90;Jo=new md(yi,Fn,Ti,Ui,Vi,Ir.vertical,ui,ci,Ai,Di),ji&&(Ao=new md(yi,Fn,Ti,Ui,Vi,ji,Pi,oo,Ai,Di))}if(li){const Di=ei.layout.get("icon-rotate").evaluate(jn,{}),Po=ei.layout.get("icon-text-fit")!=="none",Tl=M0(li,Di,Ci,Po),ms=ji?M0(ji,Di,Ci,Po):void 0;Qs=new md(yi,Fn,Ti,Ui,Vi,li,Pi,oo,!1,Di),ao=4*Tl.length;const Cl=on.iconSizeData;let Rs=null;Cl.kind==="source"?(Rs=[Ds*ei.layout.get("icon-size").evaluate(jn,{})],Rs[0]>Ea&&ve(`${on.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)):Cl.kind==="composite"&&(Rs=[Ds*zi.compositeIconSizes[0].evaluate(jn,{},hi),Ds*zi.compositeIconSizes[1].evaluate(jn,{},hi)],(Rs[0]>Ea||Rs[1]>Ea)&&ve(`${on.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)),on.addSymbols(on.icon,Tl,Rs,fi,so,jn,u.ah.none,Fn,hs.lineStartIndex,hs.lineLength,-1,hi),km=on.icon.placedSymbolArray.length-1,ms&&(ea=4*ms.length,on.addSymbols(on.icon,ms,Rs,fi,so,jn,u.ah.vertical,Fn,hs.lineStartIndex,hs.lineLength,-1,hi),Sm=on.icon.placedSymbolArray.length-1)}const $0=Object.keys(Ir.horizontal);for(const Di of $0){const Po=Ir.horizontal[Di];if(!ds){O0=jr(Po.text);const ms=ei.layout.get("text-rotate").evaluate(jn,{},hi);ds=new md(yi,Fn,Ti,Ui,Vi,Po,ui,ci,Ai,ms)}const Tl=Po.positionedLines.length===1;if(cf+=A0(on,Fn,Po,_o,ei,Ai,jn,qi,hs,Ir.vertical?u.ah.horizontal:u.ah.horizontalOnly,Tl?$0:[Di],ta,km,zi,hi),Tl)break}Ir.vertical&&(F0+=A0(on,Fn,Ir.vertical,_o,ei,Ai,jn,qi,hs,u.ah.vertical,["vertical"],ta,Sm,zi,hi));const zk=ds?ds.boxStartIndex:on.collisionBoxArray.length,Dk=ds?ds.boxEndIndex:on.collisionBoxArray.length,Rk=Jo?Jo.boxStartIndex:on.collisionBoxArray.length,Fk=Jo?Jo.boxEndIndex:on.collisionBoxArray.length,Ok=Qs?Qs.boxStartIndex:on.collisionBoxArray.length,$k=Qs?Qs.boxEndIndex:on.collisionBoxArray.length,Bk=Ao?Ao.boxStartIndex:on.collisionBoxArray.length,Nk=Ao?Ao.boxEndIndex:on.collisionBoxArray.length;let ps=-1;const _d=(Di,Po)=>Di&&Di.circleDiameter?Math.max(Di.circleDiameter,Po):Po;ps=_d(ds,ps),ps=_d(Jo,ps),ps=_d(Qs,ps),ps=_d(Ao,ps);const B0=ps>-1?1:0;B0&&(ps*=Yo/ai),on.glyphOffsetArray.length>=Du.MAX_GLYPHS&&ve("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),jn.sortKey!==void 0&&on.addToSortKeyRanges(on.symbolInstances.length,jn.sortKey);const jk=I0(ei,jn,hi),[Uk,Vk]=function(Di,Po){const Tl=Di.length,ms=Po==null?void 0:Po.values;if((ms==null?void 0:ms.length)>0)for(let Cl=0;Cl<ms.length;Cl+=2){const Rs=ms[Cl+1];Di.emplaceBack(u.ap[ms[Cl]],Rs[0],Rs[1])}return[Tl,Di.length]}(on.textAnchorOffsets,jk);on.symbolInstances.emplaceBack(Fn.x,Fn.y,ta.right>=0?ta.right:-1,ta.center>=0?ta.center:-1,ta.left>=0?ta.left:-1,ta.vertical||-1,km,Sm,O0,zk,Dk,Rk,Fk,Ok,$k,Bk,Nk,Ti,cf,F0,ao,ea,B0,0,ui,ps,Uk,Vk)}(c,cn,At,f,m,b,Kt,c.layers[0],c.collisionBoxArray,a.index,a.sourceLayerIndex,c.index,Ce,[je,je,je,je],Ht,R,Ge,dt,tn,de,a,S,j,K,T)};if(qt==="line")for(const At of w0(a.geometry,0,0,qr,qr)){const cn=Tk(At,De,vt,f.vertical||_e,m,24,Pe,c.overscaling,qr);for(const on of cn)_e&&Ak(c,_e.text,Ut,on)||Nt(At,on)}else if(qt==="line-center"){for(const At of a.geometry)if(At.length>1){const cn=Sk(At,vt,f.vertical||_e,m,24,Pe);cn&&Nt(At,cn)}}else if(a.type==="Polygon")for(const At of Gp(a.geometry,0)){const cn=Ek(At,16);Nt(At[0],new Ia(cn.x,cn.y,0))}else if(a.type==="LineString")for(const At of a.geometry)Nt(At,new Ia(At[0].x,At[0].y,0));else if(a.type==="Point")for(const At of a.geometry)for(const cn of At)Nt([cn],new Ia(cn.x,cn.y,0))}function A0(c,a,f,m,b,S,T,E,R,j,K,J,se,de,_e){const we=function(Ge,De,je,dt,vt,Ht,tn,qt){const Ut=dt.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,Ot=[];for(const Kt of De.positionedLines)for(const Nt of Kt.positionedGlyphs){if(!Nt.rect)continue;const At=Nt.rect||{};let cn=Z_+1,on=!0,Fn=1,wr=0;const Ir=(vt||qt)&&Nt.vertical,li=Nt.metrics.advance*Nt.scale/2;if(qt&&De.verticalizable&&(wr=Kt.lineOffset/2-(Nt.imageName?-(ai-Nt.metrics.width*Nt.scale)/2:(Nt.scale-1)*ai)),Nt.imageName){const fi=tn[Nt.imageName];on=fi.sdf,Fn=fi.pixelRatio,cn=io/Fn}const _o=vt?[Nt.x+li,Nt.y]:[0,0];let ji=vt?[0,0]:[Nt.x+li+je[0],Nt.y+je[1]-wr],ei=[0,0];Ir&&(ei=ji,ji=[0,0]);const yi=Nt.metrics.isDoubleResolution?2:1,Ti=(Nt.metrics.left-cn)*Nt.scale-li+ji[0],Ui=(-Nt.metrics.top-cn)*Nt.scale+ji[1],Vi=Ti+At.w/yi*Nt.scale/Fn,ui=Ui+At.h/yi*Nt.scale/Fn,ci=new _(Ti,Ui),Ai=new _(Vi,Ui),qi=new _(Ti,ui),Pi=new _(Vi,ui);if(Ir){const fi=new _(-li,li-rf),jn=-Math.PI/2,zi=ai/2-li,Ci=new _(5-rf-zi,-(Nt.imageName?zi:0)),hi=new _(...ei);ci._rotateAround(jn,fi)._add(Ci)._add(hi),Ai._rotateAround(jn,fi)._add(Ci)._add(hi),qi._rotateAround(jn,fi)._add(Ci)._add(hi),Pi._rotateAround(jn,fi)._add(Ci)._add(hi)}if(Ut){const fi=Math.sin(Ut),jn=Math.cos(Ut),zi=[jn,-fi,fi,jn];ci._matMult(zi),Ai._matMult(zi),qi._matMult(zi),Pi._matMult(zi)}const oo=new _(0,0),so=new _(0,0);Ot.push({tl:ci,tr:Ai,bl:qi,br:Pi,tex:At,writingMode:De.writingMode,glyphOffset:_o,sectionIndex:Nt.sectionIndex,isSDF:on,pixelOffsetTL:oo,pixelOffsetBR:so,minFontScaleX:0,minFontScaleY:0})}return Ot}(0,f,E,b,S,T,m,c.allowVerticalPlacement),Ce=c.textSizeData;let Pe=null;Ce.kind==="source"?(Pe=[Ds*b.layout.get("text-size").evaluate(T,{})],Pe[0]>Ea&&ve(`${c.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)):Ce.kind==="composite"&&(Pe=[Ds*de.compositeTextSizes[0].evaluate(T,{},_e),Ds*de.compositeTextSizes[1].evaluate(T,{},_e)],(Pe[0]>Ea||Pe[1]>Ea)&&ve(`${c.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)),c.addSymbols(c.text,we,Pe,E,S,T,j,a,R.lineStartIndex,R.lineLength,se,_e);for(const Ge of K)J[Ge]=c.text.placedSymbolArray.length-1;return 4*we.length}function P0(c){for(const a in c)return c[a];return null}function Ak(c,a,f,m){const b=c.compareText;if(a in b){const S=b[a];for(let T=S.length-1;T>=0;T--)if(m.dist(S[T])<f)return!0}else b[a]=[];return b[a].push(m),!1}const z0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gm{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,m]=new Uint8Array(a,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=m>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const S=z0[15&m];if(!S)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(a,2,1),[E]=new Uint32Array(a,4,1);return new gm(E,T,S,a)}constructor(a,f=64,m=Float64Array,b){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=m,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const S=z0.indexOf(this.ArrayType),T=2*a*this.ArrayType.BYTES_PER_ELEMENT,E=a*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-E%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${m}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+E+R,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+T+E+R),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+E+R,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=a)}add(a,f){const m=this._pos>>1;return this.ids[m]=m,this.coords[this._pos++]=a,this.coords[this._pos++]=f,m}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return _m(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,f,m,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:T,nodeSize:E}=this,R=[0,S.length-1,0],j=[];for(;R.length;){const K=R.pop()||0,J=R.pop()||0,se=R.pop()||0;if(J-se<=E){for(let Ce=se;Ce<=J;Ce++){const Pe=T[2*Ce],Ge=T[2*Ce+1];Pe>=a&&Pe<=m&&Ge>=f&&Ge<=b&&j.push(S[Ce])}continue}const de=se+J>>1,_e=T[2*de],we=T[2*de+1];_e>=a&&_e<=m&&we>=f&&we<=b&&j.push(S[de]),(K===0?a<=_e:f<=we)&&(R.push(se),R.push(de-1),R.push(1-K)),(K===0?m>=_e:b>=we)&&(R.push(de+1),R.push(J),R.push(1-K))}return j}within(a,f,m){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:S,nodeSize:T}=this,E=[0,b.length-1,0],R=[],j=m*m;for(;E.length;){const K=E.pop()||0,J=E.pop()||0,se=E.pop()||0;if(J-se<=T){for(let Ce=se;Ce<=J;Ce++)R0(S[2*Ce],S[2*Ce+1],a,f)<=j&&R.push(b[Ce]);continue}const de=se+J>>1,_e=S[2*de],we=S[2*de+1];R0(_e,we,a,f)<=j&&R.push(b[de]),(K===0?a-m<=_e:f-m<=we)&&(E.push(se),E.push(de-1),E.push(1-K)),(K===0?a+m>=_e:f+m>=we)&&(E.push(de+1),E.push(J),E.push(1-K))}return R}}function _m(c,a,f,m,b,S){if(b-m<=f)return;const T=m+b>>1;D0(c,a,T,m,b,S),_m(c,a,f,m,T-1,1-S),_m(c,a,f,T+1,b,1-S)}function D0(c,a,f,m,b,S){for(;b>m;){if(b-m>600){const j=b-m+1,K=f-m+1,J=Math.log(j),se=.5*Math.exp(2*J/3),de=.5*Math.sqrt(J*se*(j-se)/j)*(K-j/2<0?-1:1);D0(c,a,f,Math.max(m,Math.floor(f-K*se/j+de)),Math.min(b,Math.floor(f+(j-K)*se/j+de)),S)}const T=a[2*f+S];let E=m,R=b;for(lf(c,a,m,f),a[2*b+S]>T&&lf(c,a,m,b);E<R;){for(lf(c,a,E,R),E++,R--;a[2*E+S]<T;)E++;for(;a[2*R+S]>T;)R--}a[2*m+S]===T?lf(c,a,m,R):(R++,lf(c,a,R,b)),R<=f&&(m=R+1),f<=R&&(b=R-1)}}function lf(c,a,f,m){ym(c,f,m),ym(a,2*f,2*m),ym(a,2*f+1,2*m+1)}function ym(c,a,f){const m=c[a];c[a]=c[f],c[f]=m}function R0(c,a,f,m){const b=c-f,S=a-m;return b*b+S*S}var vm;u.bd=void 0,(vm=u.bd||(u.bd={})).create="create",vm.load="load",vm.fullLoad="fullLoad";let gd=null,uf=[];const bm=1e3/60,wm="loadTime",xm="fullLoadTime",Pk={mark(c){performance.mark(c)},frame(c){const a=c;gd!=null&&uf.push(a-gd),gd=a},clearMetrics(){gd=null,uf=[],performance.clearMeasures(wm),performance.clearMeasures(xm);for(const c in u.bd)performance.clearMarks(u.bd[c])},getPerformanceMetrics(){performance.measure(wm,u.bd.create,u.bd.load),performance.measure(xm,u.bd.create,u.bd.fullLoad);const c=performance.getEntriesByName(wm)[0].duration,a=performance.getEntriesByName(xm)[0].duration,f=uf.length,m=1/(uf.reduce((S,T)=>S+T,0)/f/1e3),b=uf.filter(S=>S>bm).reduce((S,T)=>S+(T-bm)/bm,0);return{loadTime:c,fullLoadTime:a,fps:m,percentDroppedFrames:b/(f+b)*100,totalFrames:f}}};u.$=$t,u.A=Eu,u.B=function(c){if(Ne==null){const a=c.navigator?c.navigator.userAgent:null;Ne=!!c.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ne},u.C=class{constructor(c,a){this.target=c,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new xk(()=>this.process()),this.subscription=function(f,m,b,S){return f.addEventListener(m,b,!1),{unsubscribe:()=>{f.removeEventListener(m,b,!1)}}}(this.target,"message",f=>this.receive(f)),this.globalScope=Fe(self)?c:window}registerMessageHandler(c,a){this.messageHandlers[c]=a}sendAsync(c,a){return new Promise((f,m)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:f,reject:m},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const E={id:b,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},{once:!0});const S=[],T=Object.assign(Object.assign({},c),{id:b,sourceMapId:this.mapId,origin:location.origin,data:xa(c.data,S)});this.target.postMessage(T,{transfer:S})})}receive(c){const a=c.data,f=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[f];const m=this.abortControllers[f];return delete this.abortControllers[f],void(m&&m.abort())}if(Fe(self)||a.mustQueue)return this.tasks[f]=a,this.taskQueue.push(f),void this.invoker.trigger();this.processTask(f,a)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),a=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(c,a)}processTask(c,a){return s(this,void 0,void 0,function*(){if(a.type==="<response>"){const b=this.resolveRejects[c];return delete this.resolveRejects[c],b?void(a.error?b.reject(ka(a.error)):b.resolve(ka(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const f=ka(a.data),m=new AbortController;this.abortControllers[c]=m;try{const b=yield this.messageHandlers[a.type](a.sourceMapId,f,m);this.completeTask(c,null,b)}catch(b){this.completeTask(c,b)}})}completeTask(c,a,f){const m=[];delete this.abortControllers[c];const b={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?xa(a):null,data:xa(f,m)};this.target.postMessage(b,{transfer:m})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=sn,u.E=kt,u.F=function(){var c=new Eu(16);return Eu!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.G=jt,u.H=function(c,a,f){var m,b,S,T,E,R,j,K,J,se,de,_e,we=f[0],Ce=f[1],Pe=f[2];return a===c?(c[12]=a[0]*we+a[4]*Ce+a[8]*Pe+a[12],c[13]=a[1]*we+a[5]*Ce+a[9]*Pe+a[13],c[14]=a[2]*we+a[6]*Ce+a[10]*Pe+a[14],c[15]=a[3]*we+a[7]*Ce+a[11]*Pe+a[15]):(b=a[1],S=a[2],T=a[3],E=a[4],R=a[5],j=a[6],K=a[7],J=a[8],se=a[9],de=a[10],_e=a[11],c[0]=m=a[0],c[1]=b,c[2]=S,c[3]=T,c[4]=E,c[5]=R,c[6]=j,c[7]=K,c[8]=J,c[9]=se,c[10]=de,c[11]=_e,c[12]=m*we+E*Ce+J*Pe+a[12],c[13]=b*we+R*Ce+se*Pe+a[13],c[14]=S*we+j*Ce+de*Pe+a[14],c[15]=T*we+K*Ce+_e*Pe+a[15]),c},u.I=rm,u.J=function(c,a,f){var m=f[0],b=f[1],S=f[2];return c[0]=a[0]*m,c[1]=a[1]*m,c[2]=a[2]*m,c[3]=a[3]*m,c[4]=a[4]*b,c[5]=a[5]*b,c[6]=a[6]*b,c[7]=a[7]*b,c[8]=a[8]*S,c[9]=a[9]*S,c[10]=a[10]*S,c[11]=a[11]*S,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.K=m_,u.L=function(c,a){const f={};for(let m=0;m<a.length;m++){const b=a[m];b in c&&(f[b]=c[b])}return f},u.M=La,u.N=c0,u.O=f0,u.P=_,u.Q=Io,u.R=Lo,u.S=L,u.T=Pc,u.U=I,u.V=Ye,u.W=qr,u.X=Gr,u.Y=fd,u.Z=class extends Rc{},u._=s,u.a=mt,u.a$=function(c,a,f){return c[0]=a[0]*f[0],c[1]=a[1]*f[1],c[2]=a[2]*f[2],c[3]=a[3]*f[3],c},u.a0=dm,u.a1=xt,u.a2=c=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(f=>{a.onloadstart=()=>{f(a)};for(const m of c){const b=window.document.createElement("source");pn(m)||(a.crossOrigin="Anonymous"),b.src=m,a.appendChild(b)}})},u.a3=function(){return Y++},u.a4=w,u.a5=Du,u.a6=au,u.a7=Ys,u.a8=Er,u.a9=_0,u.aA=ee,u.aB=function(c,a){if(!c)return[{command:"setStyle",args:[a]}];let f=[];try{if(!lt(c.version,a.version))return[{command:"setStyle",args:[a]}];lt(c.center,a.center)||f.push({command:"setCenter",args:[a.center]}),lt(c.zoom,a.zoom)||f.push({command:"setZoom",args:[a.zoom]}),lt(c.bearing,a.bearing)||f.push({command:"setBearing",args:[a.bearing]}),lt(c.pitch,a.pitch)||f.push({command:"setPitch",args:[a.pitch]}),lt(c.sprite,a.sprite)||f.push({command:"setSprite",args:[a.sprite]}),lt(c.glyphs,a.glyphs)||f.push({command:"setGlyphs",args:[a.glyphs]}),lt(c.transition,a.transition)||f.push({command:"setTransition",args:[a.transition]}),lt(c.light,a.light)||f.push({command:"setLight",args:[a.light]}),lt(c.terrain,a.terrain)||f.push({command:"setTerrain",args:[a.terrain]}),lt(c.sky,a.sky)||f.push({command:"setSky",args:[a.sky]});const m={},b=[];(function(T,E,R,j){let K;for(K in E=E||{},T=T||{})Object.prototype.hasOwnProperty.call(T,K)&&(Object.prototype.hasOwnProperty.call(E,K)||Wn(K,R,j));for(K in E)Object.prototype.hasOwnProperty.call(E,K)&&(Object.prototype.hasOwnProperty.call(T,K)?lt(T[K],E[K])||(T[K].type==="geojson"&&E[K].type==="geojson"&&Tr(T,E,K)?Wt(R,{command:"setGeoJSONSourceData",args:[K,E[K].data]}):fr(K,E,R,j)):Xn(K,E,R))})(c.sources,a.sources,b,m);const S=[];c.layers&&c.layers.forEach(T=>{"source"in T&&m[T.source]?f.push({command:"removeLayer",args:[T.id]}):S.push(T)}),f=f.concat(b),function(T,E,R){E=E||[];const j=(T=T||[]).map(xi),K=E.map(xi),J=T.reduce(Un,{}),se=E.reduce(Un,{}),de=j.slice(),_e=Object.create(null);let we,Ce,Pe,Ge,De;for(let je=0,dt=0;je<j.length;je++)we=j[je],Object.prototype.hasOwnProperty.call(se,we)?dt++:(Wt(R,{command:"removeLayer",args:[we]}),de.splice(de.indexOf(we,dt),1));for(let je=0,dt=0;je<K.length;je++)we=K[K.length-1-je],de[de.length-1-je]!==we&&(Object.prototype.hasOwnProperty.call(J,we)?(Wt(R,{command:"removeLayer",args:[we]}),de.splice(de.lastIndexOf(we,de.length-dt),1)):dt++,Ge=de[de.length-je],Wt(R,{command:"addLayer",args:[se[we],Ge]}),de.splice(de.length-je,0,we),_e[we]=!0);for(let je=0;je<K.length;je++)if(we=K[je],Ce=J[we],Pe=se[we],!_e[we]&&!lt(Ce,Pe))if(lt(Ce.source,Pe.source)&&lt(Ce["source-layer"],Pe["source-layer"])&&lt(Ce.type,Pe.type)){for(De in Cr(Ce.layout,Pe.layout,R,we,null,"setLayoutProperty"),Cr(Ce.paint,Pe.paint,R,we,null,"setPaintProperty"),lt(Ce.filter,Pe.filter)||Wt(R,{command:"setFilter",args:[we,Pe.filter]}),lt(Ce.minzoom,Pe.minzoom)&&lt(Ce.maxzoom,Pe.maxzoom)||Wt(R,{command:"setLayerZoomRange",args:[we,Pe.minzoom,Pe.maxzoom]}),Ce)Object.prototype.hasOwnProperty.call(Ce,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Cr(Ce[De],Pe[De],R,we,De.slice(6),"setPaintProperty"):lt(Ce[De],Pe[De])||Wt(R,{command:"setLayerProperty",args:[we,De,Pe[De]]}));for(De in Pe)Object.prototype.hasOwnProperty.call(Pe,De)&&!Object.prototype.hasOwnProperty.call(Ce,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Cr(Ce[De],Pe[De],R,we,De.slice(6),"setPaintProperty"):lt(Ce[De],Pe[De])||Wt(R,{command:"setLayerProperty",args:[we,De,Pe[De]]}))}else Wt(R,{command:"removeLayer",args:[we]}),Ge=de[de.lastIndexOf(we)+1],Wt(R,{command:"addLayer",args:[Pe,Ge]})}(S,a.layers,f)}catch(m){console.warn("Unable to compute style diff:",m),f=[{command:"setStyle",args:[a]}]}return f},u.aC=function(c){const a=[],f=c.id;return f===void 0&&a.push({message:`layers.${f}: missing required property "id"`}),c.render===void 0&&a.push({message:`layers.${f}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&a.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),a},u.aD=function c(a,f){if(Array.isArray(a)){if(!Array.isArray(f)||a.length!==f.length)return!1;for(let m=0;m<a.length;m++)if(!c(a[m],f[m]))return!1;return!0}if(typeof a=="object"&&a!==null&&f!==null){if(typeof f!="object"||Object.keys(a).length!==Object.keys(f).length)return!1;for(const m in a)if(!c(a[m],f[m]))return!1;return!0}return a===f},u.aE=fe,u.aF=Le,u.aG=class extends si{constructor(c,a){super(c,a),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aH=ro,u.aI=class extends si{constructor(c,a){super(c,a),this.current=kl}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let a=1;a<16;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aJ=Ko,u.aK=class extends si{constructor(c,a){super(c,a),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aL=class extends si{constructor(c,a){super(c,a),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aM=As,u.aN=function(c,a,f,m,b,S,T){var E=1/(a-f),R=1/(m-b),j=1/(S-T);return c[0]=-2*E,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*R,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*j,c[11]=0,c[12]=(a+f)*E,c[13]=(b+m)*R,c[14]=(T+S)*j,c[15]=1,c},u.aO=sr,u.aP=nx,u.aQ=class extends bu{},u.aR=Xx,u.aS=class extends wu{},u.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aU=b_,u.aV=te,u.aW=class extends jc{},u.aX=ft,u.aY=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]},u.aZ=function(c,a){var f=c[0],m=c[1],b=c[2],S=c[3],T=c[4],E=c[5],R=c[6],j=c[7],K=c[8],J=c[9],se=c[10],de=c[11],_e=c[12],we=c[13],Ce=c[14],Pe=c[15],Ge=a[0],De=a[1],je=a[2],dt=a[3],vt=a[4],Ht=a[5],tn=a[6],qt=a[7],Ut=a[8],Ot=a[9],Kt=a[10],Nt=a[11],At=a[12],cn=a[13],on=a[14],Fn=a[15];return Math.abs(f-Ge)<=Ni*Math.max(1,Math.abs(f),Math.abs(Ge))&&Math.abs(m-De)<=Ni*Math.max(1,Math.abs(m),Math.abs(De))&&Math.abs(b-je)<=Ni*Math.max(1,Math.abs(b),Math.abs(je))&&Math.abs(S-dt)<=Ni*Math.max(1,Math.abs(S),Math.abs(dt))&&Math.abs(T-vt)<=Ni*Math.max(1,Math.abs(T),Math.abs(vt))&&Math.abs(E-Ht)<=Ni*Math.max(1,Math.abs(E),Math.abs(Ht))&&Math.abs(R-tn)<=Ni*Math.max(1,Math.abs(R),Math.abs(tn))&&Math.abs(j-qt)<=Ni*Math.max(1,Math.abs(j),Math.abs(qt))&&Math.abs(K-Ut)<=Ni*Math.max(1,Math.abs(K),Math.abs(Ut))&&Math.abs(J-Ot)<=Ni*Math.max(1,Math.abs(J),Math.abs(Ot))&&Math.abs(se-Kt)<=Ni*Math.max(1,Math.abs(se),Math.abs(Kt))&&Math.abs(de-Nt)<=Ni*Math.max(1,Math.abs(de),Math.abs(Nt))&&Math.abs(_e-At)<=Ni*Math.max(1,Math.abs(_e),Math.abs(At))&&Math.abs(we-cn)<=Ni*Math.max(1,Math.abs(we),Math.abs(cn))&&Math.abs(Ce-on)<=Ni*Math.max(1,Math.abs(Ce),Math.abs(on))&&Math.abs(Pe-Fn)<=Ni*Math.max(1,Math.abs(Pe),Math.abs(Fn))},u.a_=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.aa=function(c){const a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,m,b,S)=>{const T=b||S;return a[m]=!T||T.toLowerCase(),""}),a["max-age"]){const f=parseInt(a["max-age"],10);isNaN(f)?delete a["max-age"]:a["max-age"]=f}return a},u.ab=function(c,a){const f=[];for(const m in c)m in a||f.push(m);return f},u.ac=Z,u.ad=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),S=a[0],T=a[1],E=a[2],R=a[3],j=a[4],K=a[5],J=a[6],se=a[7];return a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=S*b+j*m,c[1]=T*b+K*m,c[2]=E*b+J*m,c[3]=R*b+se*m,c[4]=j*b-S*m,c[5]=K*b-T*m,c[6]=J*b-E*m,c[7]=se*b-R*m,c},u.ae=function(c){var a=new Eu(16);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},u.af=ed,u.ag=function(c,a){let f=0,m=0;if(c.kind==="constant")m=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:b,minZoom:S,maxZoom:T}=c,E=b?Z(ki.interpolationFactor(b,a,S,T),0,1):0;c.kind==="camera"?m=Li.number(c.minSize,c.maxSize,E):f=E}return{uSizeT:f,uSize:m}},u.ai=function(c,{uSize:a,uSizeT:f},{lowerSize:m,upperSize:b}){return c.kind==="source"?m/Ds:c.kind==="composite"?Li.number(m/Ds,b/Ds,f):a},u.aj=am,u.ak=function(c,a,f,m){const b=a.y-c.y,S=a.x-c.x,T=m.y-f.y,E=m.x-f.x,R=T*S-E*b;if(R===0)return null;const j=(E*(c.y-f.y)-T*(c.x-f.x))/R;return new _(c.x+j*S,c.y+j*b)},u.al=w0,u.am=Vc,u.an=Np,u.ao=ai,u.aq=sm,u.ar=function(c,a){var f=a[0],m=a[1],b=a[2],S=a[3],T=a[4],E=a[5],R=a[6],j=a[7],K=a[8],J=a[9],se=a[10],de=a[11],_e=a[12],we=a[13],Ce=a[14],Pe=a[15],Ge=f*E-m*T,De=f*R-b*T,je=f*j-S*T,dt=m*R-b*E,vt=m*j-S*E,Ht=b*j-S*R,tn=K*we-J*_e,qt=K*Ce-se*_e,Ut=K*Pe-de*_e,Ot=J*Ce-se*we,Kt=J*Pe-de*we,Nt=se*Pe-de*Ce,At=Ge*Nt-De*Kt+je*Ot+dt*Ut-vt*qt+Ht*tn;return At?(c[0]=(E*Nt-R*Kt+j*Ot)*(At=1/At),c[1]=(b*Kt-m*Nt-S*Ot)*At,c[2]=(we*Ht-Ce*vt+Pe*dt)*At,c[3]=(se*vt-J*Ht-de*dt)*At,c[4]=(R*Ut-T*Nt-j*qt)*At,c[5]=(f*Nt-b*Ut+S*qt)*At,c[6]=(Ce*je-_e*Ht-Pe*De)*At,c[7]=(K*Ht-se*je+de*De)*At,c[8]=(T*Kt-E*Ut+j*tn)*At,c[9]=(m*Ut-f*Kt-S*tn)*At,c[10]=(_e*vt-we*je+Pe*Ge)*At,c[11]=(J*je-K*vt-de*Ge)*At,c[12]=(E*qt-T*Ot-R*tn)*At,c[13]=(f*Ot-m*qt+b*tn)*At,c[14]=(we*De-_e*dt-Ce*Ge)*At,c[15]=(K*dt-J*De+se*Ge)*At,c):null},u.as=mm,u.at=om,u.au=gm,u.av=function(){const c={},a=pe.$version;for(const f in pe.$root){const m=pe.$root[f];if(m.required){let b=null;b=f==="version"?a:m.type==="array"?[]:{},b!=null&&(c[f]=b)}}return c},u.aw=Nh,u.ax=nn,u.ay=function(c){c=c.slice();const a=Object.create(null);for(let f=0;f<c.length;f++)a[c[f].id]=c[f];for(let f=0;f<c.length;f++)"ref"in c[f]&&(c[f]=Xe(c[f],a[c[f].ref]));return c},u.az=function(c){if(c.type==="custom")return new wk(c);switch(c.type){case"background":return new yk(c);case"circle":return new rx(c);case"fill":return new kx(c);case"fill-extrusion":return new $x(c);case"heatmap":return new ox(c);case"hillshade":return new ax(c);case"line":return new Wx(c);case"raster":return new bk(c);case"symbol":return new cd(c)}},u.b=Ae,u.b0=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},u.b1=X,u.b2=p0,u.b3=h0,u.b4=function(c,a,f,m,b){var S,T=1/Math.tan(a/2);return c[0]=T/f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=T,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,b!=null&&b!==1/0?(c[10]=(b+m)*(S=1/(m-b)),c[14]=2*b*m*S):(c[10]=-1,c[14]=-2*m),c},u.b5=function(c,a,f){var m=Math.sin(f),b=Math.cos(f),S=a[4],T=a[5],E=a[6],R=a[7],j=a[8],K=a[9],J=a[10],se=a[11];return a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[4]=S*b+j*m,c[5]=T*b+K*m,c[6]=E*b+J*m,c[7]=R*b+se*m,c[8]=j*b-S*m,c[9]=K*b-T*m,c[10]=J*b-E*m,c[11]=se*b-R*m,c},u.b6=$,u.b7=O,u.b8=function(c){return c*Math.PI/180},u.b9=function(c,a){return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bA=Is,u.ba=class extends cs{},u.bb=fm,u.bc=Pk,u.be=un,u.bf=function(c,a){mt.REGISTERED_PROTOCOLS[c]=a},u.bg=function(c){delete mt.REGISTERED_PROTOCOLS[c]},u.bh=function(c,a){const f={};for(let b=0;b<c.length;b++){const S=a&&a[c[b].id]||Rp(c[b]);a&&(a[c[b].id]=S);let T=f[S];T||(T=f[S]=[]),T.push(c[b])}const m=[];for(const b in f)m.push(f[b]);return m},u.bi=Zt,u.bj=g0,u.bk=y0,u.bl=X_,u.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=qr/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const a=c.bucket.layers[0],f=a.layout,m=a._unevaluatedLayout._values,b={layoutIconSize:m["icon-size"].possiblyEvaluate(new Er(c.bucket.zoom+1),c.canonical),layoutTextSize:m["text-size"].possiblyEvaluate(new Er(c.bucket.zoom+1),c.canonical),textMaxSize:m["text-size"].possiblyEvaluate(new Er(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:j,maxZoom:K}=c.bucket.textSizeData;b.compositeTextSizes=[m["text-size"].possiblyEvaluate(new Er(j),c.canonical),m["text-size"].possiblyEvaluate(new Er(K),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:j,maxZoom:K}=c.bucket.iconSizeData;b.compositeIconSizes=[m["icon-size"].possiblyEvaluate(new Er(j),c.canonical),m["icon-size"].possiblyEvaluate(new Er(K),c.canonical)]}const S=f.get("text-line-height")*ai,T=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",E=f.get("text-keep-upright"),R=f.get("text-size");for(const j of c.bucket.features){const K=f.get("text-font").evaluate(j,{},c.canonical).join(","),J=R.evaluate(j,{},c.canonical),se=b.layoutTextSize.evaluate(j,{},c.canonical),de=b.layoutIconSize.evaluate(j,{},c.canonical),_e={horizontal:{},vertical:void 0},we=j.text;let Ce,Pe=[0,0];if(we){const je=we.toString(),dt=f.get("text-letter-spacing").evaluate(j,{},c.canonical)*ai,vt=jh(je)?dt:0,Ht=f.get("text-anchor").evaluate(j,{},c.canonical),tn=I0(a,j,c.canonical);if(!tn){const Nt=f.get("text-radial-offset").evaluate(j,{},c.canonical);Pe=Nt?L0(Ht,[Nt*ai,pm]):f.get("text-offset").evaluate(j,{},c.canonical).map(At=>At*ai)}let qt=T?"center":f.get("text-justify").evaluate(j,{},c.canonical);const Ut=f.get("symbol-placement"),Ot=Ut==="point"?f.get("text-max-width").evaluate(j,{},c.canonical)*ai:0,Kt=()=>{c.bucket.allowVerticalPlacement&&Sa(je)&&(_e.vertical=ad(we,c.glyphMap,c.glyphPositions,c.imagePositions,K,Ot,S,Ht,"left",vt,Pe,u.ah.vertical,!0,Ut,se,J))};if(!T&&tn){const Nt=new Set;if(qt==="auto")for(let cn=0;cn<tn.values.length;cn+=2)Nt.add(mm(tn.values[cn]));else Nt.add(qt);let At=!1;for(const cn of Nt)if(!_e.horizontal[cn])if(At)_e.horizontal[cn]=_e.horizontal[0];else{const on=ad(we,c.glyphMap,c.glyphPositions,c.imagePositions,K,Ot,S,"center",cn,vt,Pe,u.ah.horizontal,!1,Ut,se,J);on&&(_e.horizontal[cn]=on,At=on.positionedLines.length===1)}Kt()}else{qt==="auto"&&(qt=mm(Ht));const Nt=ad(we,c.glyphMap,c.glyphPositions,c.imagePositions,K,Ot,S,Ht,qt,vt,Pe,u.ah.horizontal,!1,Ut,se,J);Nt&&(_e.horizontal[qt]=Nt),Kt(),Sa(je)&&T&&E&&(_e.vertical=ad(we,c.glyphMap,c.glyphPositions,c.imagePositions,K,Ot,S,Ht,qt,vt,Pe,u.ah.vertical,!1,Ut,se,J))}}let Ge=!1;if(j.icon&&j.icon.name){const je=c.imageMap[j.icon.name];je&&(Ce=dk(c.imagePositions[j.icon.name],f.get("icon-offset").evaluate(j,{},c.canonical),f.get("icon-anchor").evaluate(j,{},c.canonical)),Ge=!!je.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Ge:c.bucket.sdfIcons!==Ge&&ve("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(je.pixelRatio!==c.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const De=P0(_e.horizontal)||_e.vertical;c.bucket.iconsInText=!!De&&De.iconsInText,(De||Ce)&&Ik(c.bucket,j,_e,Ce,c.imageMap,b,se,de,Pe,Ge,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bn=Qp,u.bo=Xp,u.bp=Jp,u.bq=Ca,u.br=tm,u.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bt=function(c,a,f,m,b){return s(this,void 0,void 0,function*(){if(I())try{return yield Ye(c,a,f,m,b)}catch{}return function(S,T,E,R,j){const K=S.width,J=S.height;ut&&pt||(ut=new OffscreenCanvas(K,J),pt=ut.getContext("2d",{willReadFrequently:!0})),ut.width=K,ut.height=J,pt.drawImage(S,0,0,K,J);const se=pt.getImageData(T,E,R,j);return pt.clearRect(0,0,K,J),se.data}(c,a,f,m,b)})},u.bu=m0,u.bv=d,u.bw=p,u.bx=j_,u.by=Hs,u.bz=function(c){return c.message===_t},u.c=He,u.d=c=>s(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(a)}catch(f){throw new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=q,u.f=c=>new Promise((a,f)=>{const m=new Image;m.onload=()=>{a(m),URL.revokeObjectURL(m.src),m.onload=null,window.requestAnimationFrame(()=>{m.src=ot})},m.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(c)],{type:"image/png"});m.src=c.byteLength?URL.createObjectURL(b):ot}),u.g=Pt,u.h=(c,a)=>rn(q(c,{type:"json"}),a),u.i=Fe,u.j=Ke,u.k=We,u.l=(c,a)=>rn(q(c,{type:"arrayBuffer"}),a),u.m=rn,u.n=function(c){return new tm(c).readFields(ak,[])},u.o=Kc,u.p=K_,u.q=Bi,u.r=Fp,u.s=pn,u.t=wa,u.u=Vt,u.v=pe,u.w=ve,u.x=Gs,u.y=function([c,a,f]){return a+=90,a*=Math.PI/180,f*=Math.PI/180,{x:c*Math.cos(a)*Math.sin(f),y:c*Math.sin(a)*Math.sin(f),z:c*Math.cos(f)}},u.z=Li}),i("worker",["./shared"],function(u){class s{constructor(ne){this.keyCache={},ne&&this.replace(ne)}replace(ne){this._layerConfigs={},this._layers={},this.update(ne,[])}update(ne,ce){for(const xe of ne){this._layerConfigs[xe.id]=xe;const $e=this._layers[xe.id]=u.az(xe);$e._featureFilter=u.a6($e.filter),this.keyCache[xe.id]&&delete this.keyCache[xe.id]}for(const xe of ce)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const ge=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const xe of ge){const $e=xe.map(et=>this._layers[et.id]),Be=$e[0];if(Be.visibility==="none")continue;const Ue=Be.source||"";let ze=this.familiesBySource[Ue];ze||(ze=this.familiesBySource[Ue]={});const re=Be.sourceLayer||"_geojsonTileLayer";let Je=ze[re];Je||(Je=ze[re]=[]),Je.push($e)}}}class d{constructor(ne){const ce={},ge=[];for(const Ue in ne){const ze=ne[Ue],re=ce[Ue]={};for(const Je in ze){const et=ze[+Je];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const nt={x:0,y:0,w:et.bitmap.width+2,h:et.bitmap.height+2};ge.push(nt),re[Je]={rect:nt,metrics:et.metrics}}}const{w:xe,h:$e}=u.p(ge),Be=new u.o({width:xe||1,height:$e||1});for(const Ue in ne){const ze=ne[Ue];for(const re in ze){const Je=ze[+re];if(!Je||Je.bitmap.width===0||Je.bitmap.height===0)continue;const et=ce[Ue][re].rect;u.o.copy(Je.bitmap,Be,{x:0,y:0},{x:et.x+1,y:et.y+1},Je.bitmap)}}this.image=Be,this.positions=ce}}u.bi("GlyphAtlas",d);class p{constructor(ne){this.tileID=new u.Q(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.uid=ne.uid,this.zoom=ne.zoom,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.collectResourceTiming,this.returnDependencies=!!ne.returnDependencies,this.promoteId=ne.promoteId,this.inFlightDependencies=[]}parse(ne,ce,ge,xe){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=ne,this.collisionBoxArray=new u.a4;const $e=new u.bj(Object.keys(ne.layers).sort()),Be=new u.bk(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const Ue={},ze={featureIndex:Be,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:ge},re=ce.familiesBySource[this.source];for(const Mn in re){const $r=ne.layers[Mn];if(!$r)continue;$r.version===1&&u.w(`Vector tile source "${this.source}" layer "${Mn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ii=$e.encode(Mn),Ei=[];for(let Fi=0;Fi<$r.length;Fi++){const mi=$r.feature(Fi),qo=Be.getId(mi,Mn);Ei.push({feature:mi,id:qo,index:Fi,sourceLayerIndex:ii})}for(const Fi of re[Mn]){const mi=Fi[0];mi.source!==this.source&&u.w(`layer.source = ${mi.source} does not equal this.source = ${this.source}`),mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility!=="none"&&(g(Fi,this.zoom,ge),(Ue[mi.id]=mi.createBucket({index:Be.bucketLayerIDs.length,layers:Fi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ii,sourceID:this.source})).populate(Ei,ze,this.tileID.canonical),Be.bucketLayerIDs.push(Fi.map(qo=>qo.id)))}}const Je=u.aE(ze.glyphDependencies,Mn=>Object.keys(Mn).map(Number));this.inFlightDependencies.forEach(Mn=>Mn==null?void 0:Mn.abort()),this.inFlightDependencies=[];let et=Promise.resolve({});if(Object.keys(Je).length){const Mn=new AbortController;this.inFlightDependencies.push(Mn),et=xe.sendAsync({type:"GG",data:{stacks:Je,source:this.source,tileID:this.tileID,type:"glyphs"}},Mn)}const nt=Object.keys(ze.iconDependencies);let ht=Promise.resolve({});if(nt.length){const Mn=new AbortController;this.inFlightDependencies.push(Mn),ht=xe.sendAsync({type:"GI",data:{icons:nt,source:this.source,tileID:this.tileID,type:"icons"}},Mn)}const Dt=Object.keys(ze.patternDependencies);let en=Promise.resolve({});if(Dt.length){const Mn=new AbortController;this.inFlightDependencies.push(Mn),en=xe.sendAsync({type:"GI",data:{icons:Dt,source:this.source,tileID:this.tileID,type:"patterns"}},Mn)}const[mn,Cn,Nn]=yield Promise.all([et,ht,en]),Mr=new d(mn),Kr=new u.bl(Cn,Nn);for(const Mn in Ue){const $r=Ue[Mn];$r instanceof u.a5?(g($r.layers,this.zoom,ge),u.bm({bucket:$r,glyphMap:mn,glyphPositions:Mr.positions,imageMap:Cn,imagePositions:Kr.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):$r.hasPattern&&($r instanceof u.bn||$r instanceof u.bo||$r instanceof u.bp)&&(g($r.layers,this.zoom,ge),$r.addFeatures(ze,this.tileID.canonical,Kr.patternPositions))}return this.status="done",{buckets:Object.values(Ue).filter(Mn=>!Mn.isEmpty()),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Mr.image,imageAtlas:Kr,glyphMap:this.returnDependencies?mn:null,iconMap:this.returnDependencies?Cn:null,glyphPositions:this.returnDependencies?Mr.positions:null}})}}function g(Te,ne,ce){const ge=new u.a8(ne);for(const xe of Te)xe.recalculate(ge,ce)}class _{constructor(ne,ce,ge){this.actor=ne,this.layerIndex=ce,this.availableImages=ge,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ne,ce){return u._(this,void 0,void 0,function*(){const ge=yield u.l(ne.request,ce);try{return{vectorTile:new u.bq.VectorTile(new u.br(ge.data)),rawData:ge.data,cacheControl:ge.cacheControl,expires:ge.expires}}catch(xe){const $e=new Uint8Array(ge.data);let Be=`Unable to parse the tile at ${ne.request.url}, `;throw Be+=$e[0]===31&&$e[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${xe.messge}`,new Error(Be)}})}loadTile(ne){return u._(this,void 0,void 0,function*(){const ce=ne.uid,ge=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bs(ne.request),xe=new p(ne);this.loading[ce]=xe;const $e=new AbortController;xe.abort=$e;try{const Be=yield this.loadVectorTile(ne,$e);if(delete this.loading[ce],!Be)return null;const Ue=Be.rawData,ze={};Be.expires&&(ze.expires=Be.expires),Be.cacheControl&&(ze.cacheControl=Be.cacheControl);const re={};if(ge){const et=ge.finish();et&&(re.resourceTiming=JSON.parse(JSON.stringify(et)))}xe.vectorTile=Be.vectorTile;const Je=xe.parse(Be.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[ce]=xe,this.fetching[ce]={rawTileData:Ue,cacheControl:ze,resourceTiming:re};try{const et=yield Je;return u.e({rawTileData:Ue.slice(0)},et,ze,re)}finally{delete this.fetching[ce]}}catch(Be){throw delete this.loading[ce],xe.status="done",this.loaded[ce]=xe,Be}})}reloadTile(ne){return u._(this,void 0,void 0,function*(){const ce=ne.uid;if(!this.loaded||!this.loaded[ce])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const ge=this.loaded[ce];if(ge.showCollisionBoxes=ne.showCollisionBoxes,ge.status==="parsing"){const xe=yield ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor);let $e;if(this.fetching[ce]){const{rawTileData:Be,cacheControl:Ue,resourceTiming:ze}=this.fetching[ce];delete this.fetching[ce],$e=u.e({rawTileData:Be.slice(0)},xe,Ue,ze)}else $e=xe;return $e}if(ge.status==="done"&&ge.vectorTile)return ge.parse(ge.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(ne){return u._(this,void 0,void 0,function*(){const ce=this.loading,ge=ne.uid;ce&&ce[ge]&&ce[ge].abort&&(ce[ge].abort.abort(),delete ce[ge])})}removeTile(ne){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[ne.uid]&&delete this.loaded[ne.uid]})}}class x{constructor(){this.loaded={}}loadTile(ne){return u._(this,void 0,void 0,function*(){const{uid:ce,encoding:ge,rawImageData:xe,redFactor:$e,greenFactor:Be,blueFactor:Ue,baseShift:ze}=ne,re=xe.width+2,Je=xe.height+2,et=u.b(xe)?new u.R({width:re,height:Je},yield u.bt(xe,-1,-1,re,Je)):xe,nt=new u.bu(ce,et,ge,$e,Be,Ue,ze);return this.loaded=this.loaded||{},this.loaded[ce]=nt,nt})}removeTile(ne){const ce=this.loaded,ge=ne.uid;ce&&ce[ge]&&delete ce[ge]}}function C(Te,ne){if(Te.length!==0){M(Te[0],ne);for(var ce=1;ce<Te.length;ce++)M(Te[ce],!ne)}}function M(Te,ne){for(var ce=0,ge=0,xe=0,$e=Te.length,Be=$e-1;xe<$e;Be=xe++){var Ue=(Te[xe][0]-Te[Be][0])*(Te[Be][1]+Te[xe][1]),ze=ce+Ue;ge+=Math.abs(ce)>=Math.abs(Ue)?ce-ze+Ue:Ue-ze+ce,ce=ze}ce+ge>=0!=!!ne&&Te.reverse()}var P=u.bv(function Te(ne,ce){var ge,xe=ne&&ne.type;if(xe==="FeatureCollection")for(ge=0;ge<ne.features.length;ge++)Te(ne.features[ge],ce);else if(xe==="GeometryCollection")for(ge=0;ge<ne.geometries.length;ge++)Te(ne.geometries[ge],ce);else if(xe==="Feature")Te(ne.geometry,ce);else if(xe==="Polygon")C(ne.coordinates,ce);else if(xe==="MultiPolygon")for(ge=0;ge<ne.coordinates.length;ge++)C(ne.coordinates[ge],ce);return ne});const A=u.bq.VectorTileFeature.prototype.toGeoJSON;var L={exports:{}},I=u.bw,$=u.bq.VectorTileFeature,O=Z;function Z(Te,ne){this.options=ne||{},this.features=Te,this.length=Te.length}function X(Te,ne){this.id=typeof Te.id=="number"?Te.id:void 0,this.type=Te.type,this.rawGeometry=Te.type===1?[Te.geometry]:Te.geometry,this.properties=Te.tags,this.extent=ne||4096}Z.prototype.feature=function(Te){return new X(this.features[Te],this.options.extent)},X.prototype.loadGeometry=function(){var Te=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Te.length;ne++){for(var ce=Te[ne],ge=[],xe=0;xe<ce.length;xe++)ge.push(new I(ce[xe][0],ce[xe][1]));this.geometry.push(ge)}return this.geometry},X.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Te=this.geometry,ne=1/0,ce=-1/0,ge=1/0,xe=-1/0,$e=0;$e<Te.length;$e++)for(var Be=Te[$e],Ue=0;Ue<Be.length;Ue++){var ze=Be[Ue];ne=Math.min(ne,ze.x),ce=Math.max(ce,ze.x),ge=Math.min(ge,ze.y),xe=Math.max(xe,ze.y)}return[ne,ge,ce,xe]},X.prototype.toGeoJSON=$.prototype.toGeoJSON;var q=u.bx,Y=O;function fe(Te){var ne=new q;return function(ce,ge){for(var xe in ce.layers)ge.writeMessage(3,Le,ce.layers[xe])}(Te,ne),ne.finish()}function Le(Te,ne){var ce;ne.writeVarintField(15,Te.version||1),ne.writeStringField(1,Te.name||""),ne.writeVarintField(5,Te.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(ce=0;ce<Te.length;ce++)ge.feature=Te.feature(ce),ne.writeMessage(2,ee,ge);var xe=ge.keys;for(ce=0;ce<xe.length;ce++)ne.writeStringField(3,xe[ce]);var $e=ge.values;for(ce=0;ce<$e.length;ce++)ne.writeMessage(4,Fe,$e[ce])}function ee(Te,ne){var ce=Te.feature;ce.id!==void 0&&ne.writeVarintField(1,ce.id),ne.writeMessage(2,ie,Te),ne.writeVarintField(3,ce.type),ne.writeMessage(4,it,ce)}function ie(Te,ne){var ce=Te.feature,ge=Te.keys,xe=Te.values,$e=Te.keycache,Be=Te.valuecache;for(var Ue in ce.properties){var ze=ce.properties[Ue],re=$e[Ue];if(ze!==null){re===void 0&&(ge.push(Ue),$e[Ue]=re=ge.length-1),ne.writeVarint(re);var Je=typeof ze;Je!=="string"&&Je!=="boolean"&&Je!=="number"&&(ze=JSON.stringify(ze));var et=Je+":"+ze,nt=Be[et];nt===void 0&&(xe.push(ze),Be[et]=nt=xe.length-1),ne.writeVarint(nt)}}}function ve(Te,ne){return(ne<<3)+(7&Te)}function ye(Te){return Te<<1^Te>>31}function it(Te,ne){for(var ce=Te.loadGeometry(),ge=Te.type,xe=0,$e=0,Be=ce.length,Ue=0;Ue<Be;Ue++){var ze=ce[Ue],re=1;ge===1&&(re=ze.length),ne.writeVarint(ve(1,re));for(var Je=ge===3?ze.length-1:ze.length,et=0;et<Je;et++){et===1&&ge!==1&&ne.writeVarint(ve(2,Je-1));var nt=ze[et].x-xe,ht=ze[et].y-$e;ne.writeVarint(ye(nt)),ne.writeVarint(ye(ht)),xe+=nt,$e+=ht}ge===3&&ne.writeVarint(ve(7,1))}}function Fe(Te,ne){var ce=typeof Te;ce==="string"?ne.writeStringField(1,Te):ce==="boolean"?ne.writeBooleanField(7,Te):ce==="number"&&(Te%1!=0?ne.writeDoubleField(3,Te):Te<0?ne.writeSVarintField(6,Te):ne.writeVarintField(5,Te))}L.exports=fe,L.exports.fromVectorTileJs=fe,L.exports.fromGeojsonVt=function(Te,ne){ne=ne||{};var ce={};for(var ge in Te)ce[ge]=new Y(Te[ge].features,ne),ce[ge].name=ge,ce[ge].version=ne.version,ce[ge].extent=ne.extent;return fe({layers:ce})},L.exports.GeoJSONWrapper=Y;var Ne=u.bv(L.exports);const Ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Te=>Te},ot=Math.fround||(Ye=new Float32Array(1),Te=>(Ye[0]=+Te,Ye[0]));var Ye;const ut=3,pt=5,_t=6;class He{constructor(ne){this.options=Object.assign(Object.create(Ae),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ce,minZoom:ge,maxZoom:xe}=this.options;ce&&console.time("total time");const $e=`prepare ${ne.length} points`;ce&&console.time($e),this.points=ne;const Be=[];for(let ze=0;ze<ne.length;ze++){const re=ne[ze];if(!re.geometry)continue;const[Je,et]=re.geometry.coordinates,nt=ot(jt(Je)),ht=ot(un(et));Be.push(nt,ht,1/0,ze,-1,1),this.options.reduce&&Be.push(0)}let Ue=this.trees[xe+1]=this._createTree(Be);ce&&console.timeEnd($e);for(let ze=xe;ze>=ge;ze--){const re=+Date.now();Ue=this.trees[ze]=this._createTree(this._cluster(Ue,ze)),ce&&console.log("z%d: %d clusters in %dms",ze,Ue.numItems,+Date.now()-re)}return ce&&console.timeEnd("total time"),this}getClusters(ne,ce){let ge=((ne[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,ne[1]));let $e=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Be=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)ge=-180,$e=180;else if(ge>$e){const et=this.getClusters([ge,xe,180,Be],ce),nt=this.getClusters([-180,xe,$e,Be],ce);return et.concat(nt)}const Ue=this.trees[this._limitZoom(ce)],ze=Ue.range(jt(ge),un(Be),jt($e),un(xe)),re=Ue.data,Je=[];for(const et of ze){const nt=this.stride*et;Je.push(re[nt+pt]>1?mt(re,nt,this.clusterProps):this.points[re[nt+ut]])}return Je}getChildren(ne){const ce=this._getOriginId(ne),ge=this._getOriginZoom(ne),xe="No cluster with the specified id.",$e=this.trees[ge];if(!$e)throw new Error(xe);const Be=$e.data;if(ce*this.stride>=Be.length)throw new Error(xe);const Ue=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),ze=$e.within(Be[ce*this.stride],Be[ce*this.stride+1],Ue),re=[];for(const Je of ze){const et=Je*this.stride;Be[et+4]===ne&&re.push(Be[et+pt]>1?mt(Be,et,this.clusterProps):this.points[Be[et+ut]])}if(re.length===0)throw new Error(xe);return re}getLeaves(ne,ce,ge){const xe=[];return this._appendLeaves(xe,ne,ce=ce||10,ge=ge||0,0),xe}getTile(ne,ce,ge){const xe=this.trees[this._limitZoom(ne)],$e=Math.pow(2,ne),{extent:Be,radius:Ue}=this.options,ze=Ue/Be,re=(ge-ze)/$e,Je=(ge+1+ze)/$e,et={features:[]};return this._addTileFeatures(xe.range((ce-ze)/$e,re,(ce+1+ze)/$e,Je),xe.data,ce,ge,$e,et),ce===0&&this._addTileFeatures(xe.range(1-ze/$e,re,1,Je),xe.data,$e,ge,$e,et),ce===$e-1&&this._addTileFeatures(xe.range(0,re,ze/$e,Je),xe.data,-1,ge,$e,et),et.features.length?et:null}getClusterExpansionZoom(ne){let ce=this._getOriginZoom(ne)-1;for(;ce<=this.options.maxZoom;){const ge=this.getChildren(ne);if(ce++,ge.length!==1)break;ne=ge[0].properties.cluster_id}return ce}_appendLeaves(ne,ce,ge,xe,$e){const Be=this.getChildren(ce);for(const Ue of Be){const ze=Ue.properties;if(ze&&ze.cluster?$e+ze.point_count<=xe?$e+=ze.point_count:$e=this._appendLeaves(ne,ze.cluster_id,ge,xe,$e):$e<xe?$e++:ne.push(Ue),ne.length===ge)break}return $e}_createTree(ne){const ce=new u.au(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ge=0;ge<ne.length;ge+=this.stride)ce.add(ne[ge],ne[ge+1]);return ce.finish(),ce.data=ne,ce}_addTileFeatures(ne,ce,ge,xe,$e,Be){for(const Ue of ne){const ze=Ue*this.stride,re=ce[ze+pt]>1;let Je,et,nt;if(re)Je=Pt(ce,ze,this.clusterProps),et=ce[ze],nt=ce[ze+1];else{const en=this.points[ce[ze+ut]];Je=en.properties;const[mn,Cn]=en.geometry.coordinates;et=jt(mn),nt=un(Cn)}const ht={type:1,geometry:[[Math.round(this.options.extent*(et*$e-ge)),Math.round(this.options.extent*(nt*$e-xe))]],tags:Je};let Dt;Dt=re||this.options.generateId?ce[ze+ut]:this.points[ce[ze+ut]].id,Dt!==void 0&&(ht.id=Dt),Be.features.push(ht)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ce){const{radius:ge,extent:xe,reduce:$e,minPoints:Be}=this.options,Ue=ge/(xe*Math.pow(2,ce)),ze=ne.data,re=[],Je=this.stride;for(let et=0;et<ze.length;et+=Je){if(ze[et+2]<=ce)continue;ze[et+2]=ce;const nt=ze[et],ht=ze[et+1],Dt=ne.within(ze[et],ze[et+1],Ue),en=ze[et+pt];let mn=en;for(const Cn of Dt){const Nn=Cn*Je;ze[Nn+2]>ce&&(mn+=ze[Nn+pt])}if(mn>en&&mn>=Be){let Cn,Nn=nt*en,Mr=ht*en,Kr=-1;const Mn=((et/Je|0)<<5)+(ce+1)+this.points.length;for(const $r of Dt){const ii=$r*Je;if(ze[ii+2]<=ce)continue;ze[ii+2]=ce;const Ei=ze[ii+pt];Nn+=ze[ii]*Ei,Mr+=ze[ii+1]*Ei,ze[ii+4]=Mn,$e&&(Cn||(Cn=this._map(ze,et,!0),Kr=this.clusterProps.length,this.clusterProps.push(Cn)),$e(Cn,this._map(ze,ii)))}ze[et+4]=Mn,re.push(Nn/mn,Mr/mn,1/0,Mn,-1,mn),$e&&re.push(Kr)}else{for(let Cn=0;Cn<Je;Cn++)re.push(ze[et+Cn]);if(mn>1)for(const Cn of Dt){const Nn=Cn*Je;if(!(ze[Nn+2]<=ce)){ze[Nn+2]=ce;for(let Mr=0;Mr<Je;Mr++)re.push(ze[Nn+Mr])}}}}return re}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ce,ge){if(ne[ce+pt]>1){const Be=this.clusterProps[ne[ce+_t]];return ge?Object.assign({},Be):Be}const xe=this.points[ne[ce+ut]].properties,$e=this.options.map(xe);return ge&&$e===xe?Object.assign({},$e):$e}}function mt(Te,ne,ce){return{type:"Feature",id:Te[ne+ut],properties:Pt(Te,ne,ce),geometry:{type:"Point",coordinates:[(ge=Te[ne],360*(ge-.5)),nn(Te[ne+1])]}};var ge}function Pt(Te,ne,ce){const ge=Te[ne+pt],xe=ge>=1e4?`${Math.round(ge/1e3)}k`:ge>=1e3?Math.round(ge/100)/10+"k":ge,$e=Te[ne+_t],Be=$e===-1?{}:Object.assign({},ce[$e]);return Object.assign(Be,{cluster:!0,cluster_id:Te[ne+ut],point_count:ge,point_count_abbreviated:xe})}function jt(Te){return Te/360+.5}function un(Te){const ne=Math.sin(Te*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function nn(Te){const ne=(180-360*Te)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function rn(Te,ne,ce,ge){for(var xe,$e=ge,Be=ce-ne>>1,Ue=ce-ne,ze=Te[ne],re=Te[ne+1],Je=Te[ce],et=Te[ce+1],nt=ne+3;nt<ce;nt+=3){var ht=pn(Te[nt],Te[nt+1],ze,re,Je,et);if(ht>$e)xe=nt,$e=ht;else if(ht===$e){var Dt=Math.abs(nt-Be);Dt<Ue&&(xe=nt,Ue=Dt)}}$e>ge&&(xe-ne>3&&rn(Te,ne,xe,ge),Te[xe+2]=$e,ce-xe>3&&rn(Te,xe,ce,ge))}function pn(Te,ne,ce,ge,xe,$e){var Be=xe-ce,Ue=$e-ge;if(Be!==0||Ue!==0){var ze=((Te-ce)*Be+(ne-ge)*Ue)/(Be*Be+Ue*Ue);ze>1?(ce=xe,ge=$e):ze>0&&(ce+=Be*ze,ge+=Ue*ze)}return(Be=Te-ce)*Be+(Ue=ne-ge)*Ue}function yn(Te,ne,ce,ge){var xe={id:Te===void 0?null:Te,type:ne,geometry:ce,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function($e){var Be=$e.geometry,Ue=$e.type;if(Ue==="Point"||Ue==="MultiPoint"||Ue==="LineString")qe($e,Be);else if(Ue==="Polygon"||Ue==="MultiLineString")for(var ze=0;ze<Be.length;ze++)qe($e,Be[ze]);else if(Ue==="MultiPolygon")for(ze=0;ze<Be.length;ze++)for(var re=0;re<Be[ze].length;re++)qe($e,Be[ze][re])}(xe),xe}function qe(Te,ne){for(var ce=0;ce<ne.length;ce+=3)Te.minX=Math.min(Te.minX,ne[ce]),Te.minY=Math.min(Te.minY,ne[ce+1]),Te.maxX=Math.max(Te.maxX,ne[ce]),Te.maxY=Math.max(Te.maxY,ne[ce+1])}function We(Te,ne,ce,ge){if(ne.geometry){var xe=ne.geometry.coordinates,$e=ne.geometry.type,Be=Math.pow(ce.tolerance/((1<<ce.maxZoom)*ce.extent),2),Ue=[],ze=ne.id;if(ce.promoteId?ze=ne.properties[ce.promoteId]:ce.generateId&&(ze=ge||0),$e==="Point")Ke(xe,Ue);else if($e==="MultiPoint")for(var re=0;re<xe.length;re++)Ke(xe[re],Ue);else if($e==="LineString")kt(xe,Ue,Be,!1);else if($e==="MultiLineString"){if(ce.lineMetrics){for(re=0;re<xe.length;re++)kt(xe[re],Ue=[],Be,!1),Te.push(yn(ze,"LineString",Ue,ne.properties));return}pe(xe,Ue,Be,!1)}else if($e==="Polygon")pe(xe,Ue,Be,!0);else{if($e!=="MultiPolygon"){if($e==="GeometryCollection"){for(re=0;re<ne.geometry.geometries.length;re++)We(Te,{id:ze,geometry:ne.geometry.geometries[re],properties:ne.properties},ce,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(re=0;re<xe.length;re++){var Je=[];pe(xe[re],Je,Be,!0),Ue.push(Je)}}Te.push(yn(ze,$e,Ue,ne.properties))}}function Ke(Te,ne){ne.push(fn(Te[0])),ne.push(Xe(Te[1])),ne.push(0)}function kt(Te,ne,ce,ge){for(var xe,$e,Be=0,Ue=0;Ue<Te.length;Ue++){var ze=fn(Te[Ue][0]),re=Xe(Te[Ue][1]);ne.push(ze),ne.push(re),ne.push(0),Ue>0&&(Be+=ge?(xe*re-ze*$e)/2:Math.sqrt(Math.pow(ze-xe,2)+Math.pow(re-$e,2))),xe=ze,$e=re}var Je=ne.length-3;ne[2]=1,rn(ne,0,Je,ce),ne[Je+2]=1,ne.size=Math.abs(Be),ne.start=0,ne.end=ne.size}function pe(Te,ne,ce,ge){for(var xe=0;xe<Te.length;xe++){var $e=[];kt(Te[xe],$e,ce,ge),ne.push($e)}}function fn(Te){return Te/360+.5}function Xe(Te){var ne=Math.sin(Te*Math.PI/180),ce=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ce<0?0:ce>1?1:ce}function lt(Te,ne,ce,ge,xe,$e,Be,Ue){if(ge/=ne,$e>=(ce/=ne)&&Be<ge)return Te;if(Be<ce||$e>=ge)return null;for(var ze=[],re=0;re<Te.length;re++){var Je=Te[re],et=Je.geometry,nt=Je.type,ht=xe===0?Je.minX:Je.minY,Dt=xe===0?Je.maxX:Je.maxY;if(ht>=ce&&Dt<ge)ze.push(Je);else if(!(Dt<ce||ht>=ge)){var en=[];if(nt==="Point"||nt==="MultiPoint")Wt(et,en,ce,ge,xe);else if(nt==="LineString")Xn(et,en,ce,ge,xe,!1,Ue.lineMetrics);else if(nt==="MultiLineString")fr(et,en,ce,ge,xe,!1);else if(nt==="Polygon")fr(et,en,ce,ge,xe,!0);else if(nt==="MultiPolygon")for(var mn=0;mn<et.length;mn++){var Cn=[];fr(et[mn],Cn,ce,ge,xe,!0),Cn.length&&en.push(Cn)}if(en.length){if(Ue.lineMetrics&&nt==="LineString"){for(mn=0;mn<en.length;mn++)ze.push(yn(Je.id,nt,en[mn],Je.tags));continue}nt!=="LineString"&&nt!=="MultiLineString"||(en.length===1?(nt="LineString",en=en[0]):nt="MultiLineString"),nt!=="Point"&&nt!=="MultiPoint"||(nt=en.length===3?"Point":"MultiPoint"),ze.push(yn(Je.id,nt,en,Je.tags))}}}return ze.length?ze:null}function Wt(Te,ne,ce,ge,xe){for(var $e=0;$e<Te.length;$e+=3){var Be=Te[$e+xe];Be>=ce&&Be<=ge&&(ne.push(Te[$e]),ne.push(Te[$e+1]),ne.push(Te[$e+2]))}}function Xn(Te,ne,ce,ge,xe,$e,Be){for(var Ue,ze,re=Wn(Te),Je=xe===0?Cr:xi,et=Te.start,nt=0;nt<Te.length-3;nt+=3){var ht=Te[nt],Dt=Te[nt+1],en=Te[nt+2],mn=Te[nt+3],Cn=Te[nt+4],Nn=xe===0?ht:Dt,Mr=xe===0?mn:Cn,Kr=!1;Be&&(Ue=Math.sqrt(Math.pow(ht-mn,2)+Math.pow(Dt-Cn,2))),Nn<ce?Mr>ce&&(ze=Je(re,ht,Dt,mn,Cn,ce),Be&&(re.start=et+Ue*ze)):Nn>ge?Mr<ge&&(ze=Je(re,ht,Dt,mn,Cn,ge),Be&&(re.start=et+Ue*ze)):Tr(re,ht,Dt,en),Mr<ce&&Nn>=ce&&(ze=Je(re,ht,Dt,mn,Cn,ce),Kr=!0),Mr>ge&&Nn<=ge&&(ze=Je(re,ht,Dt,mn,Cn,ge),Kr=!0),!$e&&Kr&&(Be&&(re.end=et+Ue*ze),ne.push(re),re=Wn(Te)),Be&&(et+=Ue)}var Mn=Te.length-3;ht=Te[Mn],Dt=Te[Mn+1],en=Te[Mn+2],(Nn=xe===0?ht:Dt)>=ce&&Nn<=ge&&Tr(re,ht,Dt,en),Mn=re.length-3,$e&&Mn>=3&&(re[Mn]!==re[0]||re[Mn+1]!==re[1])&&Tr(re,re[0],re[1],re[2]),re.length&&ne.push(re)}function Wn(Te){var ne=[];return ne.size=Te.size,ne.start=Te.start,ne.end=Te.end,ne}function fr(Te,ne,ce,ge,xe,$e){for(var Be=0;Be<Te.length;Be++)Xn(Te[Be],ne,ce,ge,xe,$e,!1)}function Tr(Te,ne,ce,ge){Te.push(ne),Te.push(ce),Te.push(ge)}function Cr(Te,ne,ce,ge,xe,$e){var Be=($e-ne)/(ge-ne);return Te.push($e),Te.push(ce+(xe-ce)*Be),Te.push(1),Be}function xi(Te,ne,ce,ge,xe,$e){var Be=($e-ce)/(xe-ce);return Te.push(ne+(ge-ne)*Be),Te.push($e),Te.push(1),Be}function Un(Te,ne){for(var ce=[],ge=0;ge<Te.length;ge++){var xe,$e=Te[ge],Be=$e.type;if(Be==="Point"||Be==="MultiPoint"||Be==="LineString")xe=xt($e.geometry,ne);else if(Be==="MultiLineString"||Be==="Polygon"){xe=[];for(var Ue=0;Ue<$e.geometry.length;Ue++)xe.push(xt($e.geometry[Ue],ne))}else if(Be==="MultiPolygon")for(xe=[],Ue=0;Ue<$e.geometry.length;Ue++){for(var ze=[],re=0;re<$e.geometry[Ue].length;re++)ze.push(xt($e.geometry[Ue][re],ne));xe.push(ze)}ce.push(yn($e.id,Be,xe,$e.tags))}return ce}function xt(Te,ne){var ce=[];ce.size=Te.size,Te.start!==void 0&&(ce.start=Te.start,ce.end=Te.end);for(var ge=0;ge<Te.length;ge+=3)ce.push(Te[ge]+ne,Te[ge+1],Te[ge+2]);return ce}function Pr(Te,ne){if(Te.transformed)return Te;var ce,ge,xe,$e=1<<Te.z,Be=Te.x,Ue=Te.y;for(ce=0;ce<Te.features.length;ce++){var ze=Te.features[ce],re=ze.geometry,Je=ze.type;if(ze.geometry=[],Je===1)for(ge=0;ge<re.length;ge+=2)ze.geometry.push(vr(re[ge],re[ge+1],ne,$e,Be,Ue));else for(ge=0;ge<re.length;ge++){var et=[];for(xe=0;xe<re[ge].length;xe+=2)et.push(vr(re[ge][xe],re[ge][xe+1],ne,$e,Be,Ue));ze.geometry.push(et)}}return Te.transformed=!0,Te}function vr(Te,ne,ce,ge,xe,$e){return[Math.round(ce*(Te*ge-xe)),Math.round(ce*(ne*ge-$e))]}function Ri(Te,ne,ce,ge,xe){for(var $e=ne===xe.maxZoom?0:xe.tolerance/((1<<ne)*xe.extent),Be={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ce,y:ge,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ue=0;Ue<Te.length;Ue++){Be.numFeatures++,Bn(Be,Te[Ue],$e,xe);var ze=Te[Ue].minX,re=Te[Ue].minY,Je=Te[Ue].maxX,et=Te[Ue].maxY;ze<Be.minX&&(Be.minX=ze),re<Be.minY&&(Be.minY=re),Je>Be.maxX&&(Be.maxX=Je),et>Be.maxY&&(Be.maxY=et)}return Be}function Bn(Te,ne,ce,ge){var xe=ne.geometry,$e=ne.type,Be=[];if($e==="Point"||$e==="MultiPoint")for(var Ue=0;Ue<xe.length;Ue+=3)Be.push(xe[Ue]),Be.push(xe[Ue+1]),Te.numPoints++,Te.numSimplified++;else if($e==="LineString")Oe(Be,xe,Te,ce,!1,!1);else if($e==="MultiLineString"||$e==="Polygon")for(Ue=0;Ue<xe.length;Ue++)Oe(Be,xe[Ue],Te,ce,$e==="Polygon",Ue===0);else if($e==="MultiPolygon")for(var ze=0;ze<xe.length;ze++){var re=xe[ze];for(Ue=0;Ue<re.length;Ue++)Oe(Be,re[Ue],Te,ce,!0,Ue===0)}if(Be.length){var Je=ne.tags||null;if($e==="LineString"&&ge.lineMetrics){for(var et in Je={},ne.tags)Je[et]=ne.tags[et];Je.mapbox_clip_start=xe.start/xe.size,Je.mapbox_clip_end=xe.end/xe.size}var nt={geometry:Be,type:$e==="Polygon"||$e==="MultiPolygon"?3:$e==="LineString"||$e==="MultiLineString"?2:1,tags:Je};ne.id!==null&&(nt.id=ne.id),Te.features.push(nt)}}function Oe(Te,ne,ce,ge,xe,$e){var Be=ge*ge;if(ge>0&&ne.size<(xe?Be:ge))ce.numPoints+=ne.length/3;else{for(var Ue=[],ze=0;ze<ne.length;ze+=3)(ge===0||ne[ze+2]>Be)&&(ce.numSimplified++,Ue.push(ne[ze]),Ue.push(ne[ze+1])),ce.numPoints++;xe&&function(re,Je){for(var et=0,nt=0,ht=re.length,Dt=ht-2;nt<ht;Dt=nt,nt+=2)et+=(re[nt]-re[Dt])*(re[nt+1]+re[Dt+1]);if(et>0===Je)for(nt=0,ht=re.length;nt<ht/2;nt+=2){var en=re[nt],mn=re[nt+1];re[nt]=re[ht-2-nt],re[nt+1]=re[ht-1-nt],re[ht-2-nt]=en,re[ht-1-nt]=mn}}(Ue,$e),Te.push(Ue)}}function yt(Te,ne){var ce=(ne=this.options=function(xe,$e){for(var Be in $e)xe[Be]=$e[Be];return xe}(Object.create(this.options),ne)).debug;if(ce&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(xe,$e){var Be=[];if(xe.type==="FeatureCollection")for(var Ue=0;Ue<xe.features.length;Ue++)We(Be,xe.features[Ue],$e,Ue);else We(Be,xe.type==="Feature"?xe:{geometry:xe},$e);return Be}(Te,ne);this.tiles={},this.tileCoords=[],ce&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ge=function(xe,$e){var Be=$e.buffer/$e.extent,Ue=xe,ze=lt(xe,1,-1-Be,Be,0,-1,2,$e),re=lt(xe,1,1-Be,2+Be,0,-1,2,$e);return(ze||re)&&(Ue=lt(xe,1,-Be,1+Be,0,-1,2,$e)||[],ze&&(Ue=Un(ze,1).concat(Ue)),re&&(Ue=Ue.concat(Un(re,-1)))),Ue}(ge,ne),ge.length&&this.splitTile(ge,0,0,0),ce&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function bt(Te,ne,ce){return 32*((1<<Te)*ce+ne)+Te}function Rt(Te,ne){return ne?Te.properties[ne]:Te.id}function Qt(Te,ne){if(Te==null)return!0;if(Te.type==="Feature")return Rt(Te,ne)!=null;if(Te.type==="FeatureCollection"){const ce=new Set;for(const ge of Te.features){const xe=Rt(ge,ne);if(xe==null||ce.has(xe))return!1;ce.add(xe)}return!0}return!1}function Jt(Te,ne){const ce=new Map;if(Te!=null)if(Te.type==="Feature")ce.set(Rt(Te,ne),Te);else for(const ge of Te.features)ce.set(Rt(ge,ne),ge);return ce}yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(Te,ne,ce,ge,xe,$e,Be){for(var Ue=[Te,ne,ce,ge],ze=this.options,re=ze.debug;Ue.length;){ge=Ue.pop(),ce=Ue.pop(),ne=Ue.pop(),Te=Ue.pop();var Je=1<<ne,et=bt(ne,ce,ge),nt=this.tiles[et];if(!nt&&(re>1&&console.time("creation"),nt=this.tiles[et]=Ri(Te,ne,ce,ge,ze),this.tileCoords.push({z:ne,x:ce,y:ge}),re)){re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,ce,ge,nt.numFeatures,nt.numPoints,nt.numSimplified),console.timeEnd("creation"));var ht="z"+ne;this.stats[ht]=(this.stats[ht]||0)+1,this.total++}if(nt.source=Te,xe){if(ne===ze.maxZoom||ne===xe)continue;var Dt=1<<xe-ne;if(ce!==Math.floor($e/Dt)||ge!==Math.floor(Be/Dt))continue}else if(ne===ze.indexMaxZoom||nt.numPoints<=ze.indexMaxPoints)continue;if(nt.source=null,Te.length!==0){re>1&&console.time("clipping");var en,mn,Cn,Nn,Mr,Kr,Mn=.5*ze.buffer/ze.extent,$r=.5-Mn,ii=.5+Mn,Ei=1+Mn;en=mn=Cn=Nn=null,Mr=lt(Te,Je,ce-Mn,ce+ii,0,nt.minX,nt.maxX,ze),Kr=lt(Te,Je,ce+$r,ce+Ei,0,nt.minX,nt.maxX,ze),Te=null,Mr&&(en=lt(Mr,Je,ge-Mn,ge+ii,1,nt.minY,nt.maxY,ze),mn=lt(Mr,Je,ge+$r,ge+Ei,1,nt.minY,nt.maxY,ze),Mr=null),Kr&&(Cn=lt(Kr,Je,ge-Mn,ge+ii,1,nt.minY,nt.maxY,ze),Nn=lt(Kr,Je,ge+$r,ge+Ei,1,nt.minY,nt.maxY,ze),Kr=null),re>1&&console.timeEnd("clipping"),Ue.push(en||[],ne+1,2*ce,2*ge),Ue.push(mn||[],ne+1,2*ce,2*ge+1),Ue.push(Cn||[],ne+1,2*ce+1,2*ge),Ue.push(Nn||[],ne+1,2*ce+1,2*ge+1)}}},yt.prototype.getTile=function(Te,ne,ce){var ge=this.options,xe=ge.extent,$e=ge.debug;if(Te<0||Te>24)return null;var Be=1<<Te,Ue=bt(Te,ne=(ne%Be+Be)%Be,ce);if(this.tiles[Ue])return Pr(this.tiles[Ue],xe);$e>1&&console.log("drilling down to z%d-%d-%d",Te,ne,ce);for(var ze,re=Te,Je=ne,et=ce;!ze&&re>0;)re--,Je=Math.floor(Je/2),et=Math.floor(et/2),ze=this.tiles[bt(re,Je,et)];return ze&&ze.source?($e>1&&console.log("found parent tile z%d-%d-%d",re,Je,et),$e>1&&console.time("drilling down"),this.splitTile(ze.source,re,Je,et,Te,ne,ce),$e>1&&console.timeEnd("drilling down"),this.tiles[Ue]?Pr(this.tiles[Ue],xe):null):null};class yr extends _{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ne,ce){return u._(this,void 0,void 0,function*(){const ge=ne.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const xe=this._geoJSONIndex.getTile(ge.z,ge.x,ge.y);if(!xe)return null;const $e=new class{constructor(Ue){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=Ue.length,this._features=Ue}feature(Ue){return new class{constructor(ze){this._feature=ze,this.extent=u.W,this.type=ze.type,this.properties=ze.tags,"id"in ze&&!isNaN(ze.id)&&(this.id=parseInt(ze.id,10))}loadGeometry(){if(this._feature.type===1){const ze=[];for(const re of this._feature.geometry)ze.push([new u.P(re[0],re[1])]);return ze}{const ze=[];for(const re of this._feature.geometry){const Je=[];for(const et of re)Je.push(new u.P(et[0],et[1]));ze.push(Je)}return ze}}toGeoJSON(ze,re,Je){return A.call(this,ze,re,Je)}}(this._features[Ue])}}(xe.features);let Be=Ne($e);return Be.byteOffset===0&&Be.byteLength===Be.buffer.byteLength||(Be=new Uint8Array(Be)),{vectorTile:$e,rawData:Be.buffer}})}loadData(ne){return u._(this,void 0,void 0,function*(){var ce;(ce=this._pendingRequest)===null||ce===void 0||ce.abort();const ge=!!(ne&&ne.request&&ne.request.collectResourceTiming)&&new u.bs(ne.request);this._pendingRequest=new AbortController;try{let xe=yield this.loadGeoJSON(ne,this._pendingRequest);if(delete this._pendingRequest,typeof xe!="object")throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(P(xe,!0),ne.filter){const Be=u.by(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(ze=>`${ze.key}: ${ze.message}`).join(", "));xe={type:"FeatureCollection",features:xe.features.filter(ze=>Be.value.evaluate({zoom:0},ze))}}this._geoJSONIndex=ne.cluster?new He(function({superclusterOptions:Be,clusterProperties:Ue}){if(!Ue||!Be)return Be;const ze={},re={},Je={accumulated:null,zoom:0},et={properties:null},nt=Object.keys(Ue);for(const ht of nt){const[Dt,en]=Ue[ht],mn=u.by(en),Cn=u.by(typeof Dt=="string"?[Dt,["accumulated"],["get",ht]]:Dt);ze[ht]=mn.value,re[ht]=Cn.value}return Be.map=ht=>{et.properties=ht;const Dt={};for(const en of nt)Dt[en]=ze[en].evaluate(Je,et);return Dt},Be.reduce=(ht,Dt)=>{et.properties=Dt;for(const en of nt)Je.accumulated=ht[en],ht[en]=re[en].evaluate(Je,et)},Be}(ne)).load(xe.features):function(Be,Ue){return new yt(Be,Ue)}(xe,ne.geojsonVtOptions),this.loaded={};const $e={};if(ge){const Be=ge.finish();Be&&($e.resourceTiming={},$e.resourceTiming[ne.source]=JSON.parse(JSON.stringify(Be)))}return $e}catch(xe){if(delete this._pendingRequest,u.bz(xe))return{abandoned:!0};throw xe}})}reloadTile(ne){const ce=this.loaded;return ce&&ce[ne.uid]?super.reloadTile(ne):this.loadTile(ne)}loadGeoJSON(ne,ce){return u._(this,void 0,void 0,function*(){const{promoteId:ge}=ne;if(ne.request){const xe=yield u.h(ne.request,ce);return this._dataUpdateable=Qt(xe.data,ge)?Jt(xe.data,ge):void 0,xe.data}if(typeof ne.data=="string")try{const xe=JSON.parse(ne.data);return this._dataUpdateable=Qt(xe,ge)?Jt(xe,ge):void 0,xe}catch{throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`)}if(!ne.dataDiff)throw new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ne.source}`);return function(xe,$e,Be){var Ue,ze,re,Je;if($e.removeAll&&xe.clear(),$e.remove)for(const et of $e.remove)xe.delete(et);if($e.add)for(const et of $e.add){const nt=Rt(et,Be);nt!=null&&xe.set(nt,et)}if($e.update)for(const et of $e.update){let nt=xe.get(et.id);if(nt==null)continue;const ht=!et.removeAllProperties&&(((Ue=et.removeProperties)===null||Ue===void 0?void 0:Ue.length)>0||((ze=et.addOrUpdateProperties)===null||ze===void 0?void 0:ze.length)>0);if((et.newGeometry||et.removeAllProperties||ht)&&(nt=Object.assign({},nt),xe.set(et.id,nt),ht&&(nt.properties=Object.assign({},nt.properties))),et.newGeometry&&(nt.geometry=et.newGeometry),et.removeAllProperties)nt.properties={};else if(((re=et.removeProperties)===null||re===void 0?void 0:re.length)>0)for(const Dt of et.removeProperties)Object.prototype.hasOwnProperty.call(nt.properties,Dt)&&delete nt.properties[Dt];if(((Je=et.addOrUpdateProperties)===null||Je===void 0?void 0:Je.length)>0)for(const{key:Dt,value:en}of et.addOrUpdateProperties)nt.properties[Dt]=en}}(this._dataUpdateable,ne.dataDiff,ge),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(ne){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(ne){return this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId)}getClusterChildren(ne){return this._geoJSONIndex.getChildren(ne.clusterId)}getClusterLeaves(ne){return this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset)}}class or{constructor(ne){this.self=ne,this.actor=new u.C(ne),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(ce,ge)=>{if(this.externalWorkerSourceTypes[ce])throw new Error(`Worker source with name "${ce}" already registered.`);this.externalWorkerSourceTypes[ce]=ge},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=ce=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(ce)},this.actor.registerMessageHandler("LDT",(ce,ge)=>this._getDEMWorkerSource(ce,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RDT",(ce,ge)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(ce,ge.source).removeTile(ge)})),this.actor.registerMessageHandler("GCEZ",(ce,ge)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterExpansionZoom(ge)})),this.actor.registerMessageHandler("GCC",(ce,ge)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterChildren(ge)})),this.actor.registerMessageHandler("GCL",(ce,ge)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(ce,ge.type,ge.source).getClusterLeaves(ge)})),this.actor.registerMessageHandler("LD",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).loadData(ge)),this.actor.registerMessageHandler("LT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).loadTile(ge)),this.actor.registerMessageHandler("RT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).reloadTile(ge)),this.actor.registerMessageHandler("AT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).abortTile(ge)),this.actor.registerMessageHandler("RMT",(ce,ge)=>this._getWorkerSource(ce,ge.type,ge.source).removeTile(ge)),this.actor.registerMessageHandler("RS",(ce,ge)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[ce]||!this.workerSources[ce][ge.type]||!this.workerSources[ce][ge.type][ge.source])return;const xe=this.workerSources[ce][ge.type][ge.source];delete this.workerSources[ce][ge.type][ge.source],xe.removeSource!==void 0&&xe.removeSource(ge)})),this.actor.registerMessageHandler("RM",ce=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[ce],delete this.availableImages[ce],delete this.workerSources[ce],delete this.demWorkerSources[ce]})),this.actor.registerMessageHandler("SR",(ce,ge)=>u._(this,void 0,void 0,function*(){this.referrer=ge})),this.actor.registerMessageHandler("SRPS",(ce,ge)=>this._syncRTLPluginState(ce,ge)),this.actor.registerMessageHandler("IS",(ce,ge)=>u._(this,void 0,void 0,function*(){this.self.importScripts(ge)})),this.actor.registerMessageHandler("SI",(ce,ge)=>this._setImages(ce,ge)),this.actor.registerMessageHandler("UL",(ce,ge)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).update(ge.layers,ge.removedIds)})),this.actor.registerMessageHandler("SL",(ce,ge)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(ce).replace(ge)}))}_setImages(ne,ce){return u._(this,void 0,void 0,function*(){this.availableImages[ne]=ce;for(const ge in this.workerSources[ne]){const xe=this.workerSources[ne][ge];for(const $e in xe)xe[$e].availableImages=ce}})}_syncRTLPluginState(ne,ce){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(ce.pluginStatus!=="loading")return u.bA.setState(ce),ce;const ge=ce.pluginURL;if(this.self.importScripts(ge),u.bA.isParsed()){const xe={pluginStatus:"loaded",pluginURL:ge};return u.bA.setState(xe),xe}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${ge}`)})}_getAvailableImages(ne){let ce=this.availableImages[ne];return ce||(ce=[]),ce}_getLayerIndex(ne){let ce=this.layerIndexes[ne];return ce||(ce=this.layerIndexes[ne]=new s),ce}_getWorkerSource(ne,ce,ge){if(this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][ce]||(this.workerSources[ne][ce]={}),!this.workerSources[ne][ce][ge]){const xe={sendAsync:($e,Be)=>($e.targetMapId=ne,this.actor.sendAsync($e,Be))};switch(ce){case"vector":this.workerSources[ne][ce][ge]=new _(xe,this._getLayerIndex(ne),this._getAvailableImages(ne));break;case"geojson":this.workerSources[ne][ce][ge]=new yr(xe,this._getLayerIndex(ne),this._getAvailableImages(ne));break;default:this.workerSources[ne][ce][ge]=new this.externalWorkerSourceTypes[ce](xe,this._getLayerIndex(ne),this._getAvailableImages(ne))}}return this.workerSources[ne][ce][ge]}_getDEMWorkerSource(ne,ce){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][ce]||(this.demWorkerSources[ne][ce]=new x),this.demWorkerSources[ne][ce]}}return u.i(self)&&(self.worker=new or(self)),or}),i("index",["exports","./shared"],function(u,s){var d="4.1.3";let p,g;const _={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:w=>new Promise((l,h)=>{const y=requestAnimationFrame(l);w.signal.addEventListener("abort",()=>{cancelAnimationFrame(y),h(s.c())})}),getImageData(w,l=0){return this.getImageCanvasContext(w).getImageData(-l,-l,w.width+2*l,w.height+2*l)},getImageCanvasContext(w){const l=window.document.createElement("canvas"),h=l.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return l.width=w.width,l.height=w.height,h.drawImage(w,0,0,w.width,w.height),h},resolveURL:w=>(p||(p=document.createElement("a")),p.href=w,p.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(g==null&&(g=matchMedia("(prefers-reduced-motion: reduce)")),g.matches)}};class x{static testProp(l){if(!x.docStyle)return l[0];for(let h=0;h<l.length;h++)if(l[h]in x.docStyle)return l[h];return l[0]}static create(l,h,y){const v=window.document.createElement(l);return h!==void 0&&(v.className=h),y&&y.appendChild(v),v}static createNS(l,h){return window.document.createElementNS(l,h)}static disableDrag(){x.docStyle&&x.selectProp&&(x.userSelect=x.docStyle[x.selectProp],x.docStyle[x.selectProp]="none")}static enableDrag(){x.docStyle&&x.selectProp&&(x.docStyle[x.selectProp]=x.userSelect)}static setTransform(l,h){l.style[x.transformProp]=h}static addEventListener(l,h,y,v={}){l.addEventListener(h,y,"passive"in v?v:v.capture)}static removeEventListener(l,h,y,v={}){l.removeEventListener(h,y,"passive"in v?v:v.capture)}static suppressClickInternal(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",x.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",x.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",x.suppressClickInternal,!0)},0)}static getScale(l){const h=l.getBoundingClientRect();return{x:h.width/l.offsetWidth||1,y:h.height/l.offsetHeight||1,boundingClientRect:h}}static getPoint(l,h,y){const v=h.boundingClientRect;return new s.P((y.clientX-v.left)/h.x-l.clientLeft,(y.clientY-v.top)/h.y-l.clientTop)}static mousePos(l,h){const y=x.getScale(l);return x.getPoint(l,y,h)}static touchPos(l,h){const y=[],v=x.getScale(l);for(let k=0;k<h.length;k++)y.push(x.getPoint(l,v,h[k]));return y}static mouseButton(l){return l.button}static remove(l){l.parentNode&&l.parentNode.removeChild(l)}}x.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,x.selectProp=x.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),x.transformProp=x.testProp(["transform","WebkitTransform"]);const C={supported:!1,testSupport:function(w){!A&&P&&(L?I(w):M=w)}};let M,P,A=!1,L=!1;function I(w){const l=w.createTexture();w.bindTexture(w.TEXTURE_2D,l);try{if(w.texImage2D(w.TEXTURE_2D,0,w.RGBA,w.RGBA,w.UNSIGNED_BYTE,P),w.isContextLost())return;C.supported=!0}catch{}w.deleteTexture(l),A=!0}var $;typeof document<"u"&&(P=document.createElement("img"),P.onload=function(){M&&I(M),M=null,L=!0},P.onerror=function(){A=!0,M=null},P.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(w){let l,h,y,v;w.resetRequestQueue=()=>{l=[],h=0,y=0,v={}},w.addThrottleControl=B=>{const G=y++;return v[G]=B,G},w.removeThrottleControl=B=>{delete v[B],z()},w.getImage=(B,G,Q=!0)=>new Promise((te,me)=>{C.supported&&(B.headers||(B.headers={}),B.headers.accept="image/webp,*/*"),s.e(B,{type:"image"}),l.push({abortController:G,requestParameters:B,supportImageRefresh:Q,state:"queued",onError:Se=>{me(Se)},onSuccess:Se=>{te(Se)}}),z()});const k=B=>s._(this,void 0,void 0,function*(){B.state="running";const{requestParameters:G,supportImageRefresh:Q,onError:te,onSuccess:me,abortController:Se}=B,ke=Q===!1&&!s.i(self)&&!s.g(G.url)&&(!G.headers||Object.keys(G.headers).reduce((Re,tt)=>Re&&tt==="accept",!0));h++;const Me=ke?D(G,Se):s.m(G,Se);try{const Re=yield Me;delete B.abortController,B.state="completed",Re.data instanceof HTMLImageElement||s.b(Re.data)?me(Re):Re.data&&me({data:yield(be=Re.data,typeof createImageBitmap=="function"?s.d(be):s.f(be)),cacheControl:Re.cacheControl,expires:Re.expires})}catch(Re){delete B.abortController,te(Re)}finally{h--,z()}var be}),z=()=>{const B=(()=>{for(const G of Object.keys(v))if(v[G]())return!0;return!1})()?s.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:s.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let G=h;G<B&&l.length>0;G++){const Q=l.shift();Q.abortController.signal.aborted?G--:k(Q)}},D=(B,G)=>new Promise((Q,te)=>{const me=new Image,Se=B.url,ke=B.credentials;ke&&ke==="include"?me.crossOrigin="use-credentials":(ke&&ke==="same-origin"||!s.s(Se))&&(me.crossOrigin="anonymous"),G.signal.addEventListener("abort",()=>{me.src="",te(s.c())}),me.fetchPriority="high",me.onload=()=>{me.onerror=me.onload=null,Q({data:me})},me.onerror=()=>{me.onerror=me.onload=null,G.signal.aborted||te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},me.src=Se})}($||($={})),$.resetRequestQueue();class O{constructor(l){this._transformRequestFn=l}transformRequest(l,h){return this._transformRequestFn&&this._transformRequestFn(l,h)||{url:l}}normalizeSpriteURL(l,h,y){const v=function(k){const z=k.match(Z);if(!z)throw new Error(`Unable to parse URL "${k}"`);return{protocol:z[1],authority:z[2],path:z[3]||"/",params:z[4]?z[4].split("&"):[]}}(l);return v.path+=`${h}${y}`,function(k){const z=k.params.length?`?${k.params.join("&")}`:"";return`${k.protocol}://${k.authority}${k.path}${z}`}(v)}setTransformRequest(l){this._transformRequestFn=l}}const Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function X(w){var l=new s.A(3);return l[0]=w[0],l[1]=w[1],l[2]=w[2],l}var q,Y=function(w,l,h){return w[0]=l[0]-h[0],w[1]=l[1]-h[1],w[2]=l[2]-h[2],w};q=new s.A(3),s.A!=Float32Array&&(q[0]=0,q[1]=0,q[2]=0);var fe=function(w){var l=w[0],h=w[1];return l*l+h*h};function Le(w){const l=[];if(typeof w=="string")l.push({id:"default",url:w});else if(w&&w.length>0){const h=[];for(const{id:y,url:v}of w){const k=`${y}${v}`;h.indexOf(k)===-1&&(h.push(k),l.push({id:y,url:v}))}}return l}(function(){var w=new s.A(2);s.A!=Float32Array&&(w[0]=0,w[1]=0)})();class ee{constructor(l,h,y,v){this.context=l,this.format=y,this.texture=l.gl.createTexture(),this.update(h,v)}update(l,h,y){const{width:v,height:k}=l,z=!(this.size&&this.size[0]===v&&this.size[1]===k||y),{context:D}=this,{gl:B}=D;if(this.useMipmap=!!(h&&h.useMipmap),B.bindTexture(B.TEXTURE_2D,this.texture),D.pixelStoreUnpackFlipY.set(!1),D.pixelStoreUnpack.set(1),D.pixelStoreUnpackPremultiplyAlpha.set(this.format===B.RGBA&&(!h||h.premultiply!==!1)),z)this.size=[v,k],l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?B.texImage2D(B.TEXTURE_2D,0,this.format,this.format,B.UNSIGNED_BYTE,l):B.texImage2D(B.TEXTURE_2D,0,this.format,v,k,0,this.format,B.UNSIGNED_BYTE,l.data);else{const{x:G,y:Q}=y||{x:0,y:0};l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement||l instanceof ImageData||s.b(l)?B.texSubImage2D(B.TEXTURE_2D,0,G,Q,B.RGBA,B.UNSIGNED_BYTE,l):B.texSubImage2D(B.TEXTURE_2D,0,G,Q,v,k,B.RGBA,B.UNSIGNED_BYTE,l.data)}this.useMipmap&&this.isSizePowerOfTwo()&&B.generateMipmap(B.TEXTURE_2D)}bind(l,h,y){const{context:v}=this,{gl:k}=v;k.bindTexture(k.TEXTURE_2D,this.texture),y!==k.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(y=k.LINEAR),l!==this.filter&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MAG_FILTER,l),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_MIN_FILTER,y||l),this.filter=l),h!==this.wrap&&(k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_S,h),k.texParameteri(k.TEXTURE_2D,k.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:l}=this.context;l.deleteTexture(this.texture),this.texture=null}}function ie(w){const{userImage:l}=w;return!!(l&&l.render&&l.render())&&(w.data.replace(new Uint8Array(l.data.buffer)),!0)}class ve extends s.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new s.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:h,promiseResolve:y}of this.requestors)y(this._getImagesForIds(h));this.requestors=[]}}getImage(l){const h=this.images[l];if(h&&!h.data&&h.spriteData){const y=h.spriteData;h.data=new s.R({width:y.width,height:y.height},y.context.getImageData(y.x,y.y,y.width,y.height).data),h.spriteData=null}return h}addImage(l,h){if(this.images[l])throw new Error(`Image id ${l} already exist, use updateImage instead`);this._validate(l,h)&&(this.images[l]=h)}_validate(l,h){let y=!0;const v=h.data||h.spriteData;return this._validateStretch(h.stretchX,v&&v.width)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchX" value`))),y=!1),this._validateStretch(h.stretchY,v&&v.height)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "stretchY" value`))),y=!1),this._validateContent(h.content,h)||(this.fire(new s.j(new Error(`Image "${l}" has invalid "content" value`))),y=!1),y}_validateStretch(l,h){if(!l)return!0;let y=0;for(const v of l){if(v[0]<y||v[1]<v[0]||h<v[1])return!1;y=v[1]}return!0}_validateContent(l,h){if(!l)return!0;if(l.length!==4)return!1;const y=h.spriteData,v=y&&y.width||h.data.width,k=y&&y.height||h.data.height;return!(l[0]<0||v<l[0]||l[1]<0||k<l[1]||l[2]<0||v<l[2]||l[3]<0||k<l[3]||l[2]<l[0]||l[3]<l[1])}updateImage(l,h,y=!0){const v=this.getImage(l);if(y&&(v.data.width!==h.data.width||v.data.height!==h.data.height))throw new Error(`size mismatch between old image (${v.data.width}x${v.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=v.version+1,this.images[l]=h,this.updatedImages[l]=!0}removeImage(l){const h=this.images[l];delete this.images[l],delete this.patterns[l],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l){return new Promise((h,y)=>{let v=!0;if(!this.isLoaded())for(const k of l)this.images[k]||(v=!1);this.isLoaded()||v?h(this._getImagesForIds(l)):this.requestors.push({ids:l,promiseResolve:h})})}_getImagesForIds(l){const h={};for(const y of l){let v=this.getImage(y);v||(this.fire(new s.k("styleimagemissing",{id:y})),v=this.getImage(y)),v?h[y]={data:v.data.clone(),pixelRatio:v.pixelRatio,sdf:v.sdf,version:v.version,stretchX:v.stretchX,stretchY:v.stretchY,content:v.content,hasRenderCallback:!!(v.userImage&&v.userImage.render)}:s.w(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:l,height:h}=this.atlasImage;return{width:l,height:h}}getPattern(l){const h=this.patterns[l],y=this.getImage(l);if(!y)return null;if(h&&h.position.version===y.version)return h.position;if(h)h.position.version=y.version;else{const v={w:y.data.width+2,h:y.data.height+2,x:0,y:0},k=new s.I(v,y);this.patterns[l]={bin:v,position:k}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const h=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ee(l,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const k in this.patterns)l.push(this.patterns[k].bin);const{w:h,h:y}=s.p(l),v=this.atlasImage;v.resize({width:h||1,height:y||1});for(const k in this.patterns){const{bin:z}=this.patterns[k],D=z.x+1,B=z.y+1,G=this.getImage(k).data,Q=G.width,te=G.height;s.R.copy(G,v,{x:0,y:0},{x:D,y:B},{width:Q,height:te}),s.R.copy(G,v,{x:0,y:te-1},{x:D,y:B-1},{width:Q,height:1}),s.R.copy(G,v,{x:0,y:0},{x:D,y:B+te},{width:Q,height:1}),s.R.copy(G,v,{x:Q-1,y:0},{x:D-1,y:B},{width:1,height:te}),s.R.copy(G,v,{x:0,y:0},{x:D+Q,y:B},{width:1,height:te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const h of l){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const y=this.getImage(h);y||s.w(`Image with ID: "${h}" was not found`),ie(y)&&this.updateImage(h,y)}}}const ye=1e20;function it(w,l,h,y,v,k,z,D,B){for(let G=l;G<l+y;G++)Fe(w,h*k+G,k,v,z,D,B);for(let G=h;G<h+v;G++)Fe(w,G*k+l,1,y,z,D,B)}function Fe(w,l,h,y,v,k,z){k[0]=0,z[0]=-ye,z[1]=ye,v[0]=w[l];for(let D=1,B=0,G=0;D<y;D++){v[D]=w[l+D*h];const Q=D*D;do{const te=k[B];G=(v[D]-v[te]+Q-te*te)/(D-te)/2}while(G<=z[B]&&--B>-1);B++,k[B]=D,z[B]=G,z[B+1]=ye}for(let D=0,B=0;D<y;D++){for(;z[B+1]<D;)B++;const G=k[B],Q=D-G;w[l+D*h]=v[G]+Q*Q}}class Ne{constructor(l,h){this.requestManager=l,this.localIdeographFontFamily=h,this.entries={}}setURL(l){this.url=l}getGlyphs(l){return s._(this,void 0,void 0,function*(){const h=[];for(const k in l)for(const z of l[k])h.push(this._getAndCacheGlyphsPromise(k,z));const y=yield Promise.all(h),v={};for(const{stack:k,id:z,glyph:D}of y)v[k]||(v[k]={}),v[k][z]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics};return v})}_getAndCacheGlyphsPromise(l,h){return s._(this,void 0,void 0,function*(){let y=this.entries[l];y||(y=this.entries[l]={glyphs:{},requests:{},ranges:{}});let v=y.glyphs[h];if(v!==void 0)return{stack:l,id:h,glyph:v};if(v=this._tinySDF(y,l,h),v)return y.glyphs[h]=v,{stack:l,id:h,glyph:v};const k=Math.floor(h/256);if(256*k>65535)throw new Error("glyphs > 65535 not supported");if(y.ranges[k])return{stack:l,id:h,glyph:v};if(!this.url)throw new Error("glyphsUrl is not set");if(!y.requests[k]){const D=Ne.loadGlyphRange(l,k,this.url,this.requestManager);y.requests[k]=D}const z=yield y.requests[k];for(const D in z)this._doesCharSupportLocalGlyph(+D)||(y.glyphs[+D]=z[+D]);return y.ranges[k]=!0,{stack:l,id:h,glyph:z[h]||null}})}_doesCharSupportLocalGlyph(l){return!!this.localIdeographFontFamily&&(s.u["CJK Unified Ideographs"](l)||s.u["Hangul Syllables"](l)||s.u.Hiragana(l)||s.u.Katakana(l))}_tinySDF(l,h,y){const v=this.localIdeographFontFamily;if(!v||!this._doesCharSupportLocalGlyph(y))return;let k=l.tinySDF;if(!k){let D="400";/bold/i.test(h)?D="900":/medium/i.test(h)?D="500":/light/i.test(h)&&(D="200"),k=l.tinySDF=new Ne.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:v,fontWeight:D})}const z=k.draw(String.fromCharCode(y));return{id:y,bitmap:new s.o({width:z.width||60,height:z.height||60},z.data),metrics:{width:z.glyphWidth/2||24,height:z.glyphHeight/2||24,left:z.glyphLeft/2+.5||0,top:z.glyphTop/2-27.5||-8,advance:z.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ne.loadGlyphRange=function(w,l,h,y){return s._(this,void 0,void 0,function*(){const v=256*l,k=v+255,z=y.transformRequest(h.replace("{fontstack}",w).replace("{range}",`${v}-${k}`),"Glyphs"),D=yield s.l(z,new AbortController);if(!D||!D.data)throw new Error(`Could not load glyph range. range: ${l}, ${v}-${k}`);const B={};for(const G of s.n(D.data))B[G.id]=G;return B})},Ne.TinySDF=class{constructor({fontSize:w=24,buffer:l=3,radius:h=8,cutoff:y=.25,fontFamily:v="sans-serif",fontWeight:k="normal",fontStyle:z="normal"}={}){this.buffer=l,this.cutoff=y,this.radius=h;const D=this.size=w+4*l,B=this._createCanvas(D),G=this.ctx=B.getContext("2d",{willReadFrequently:!0});G.font=`${z} ${k} ${w}px ${v}`,G.textBaseline="alphabetic",G.textAlign="left",G.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(w){const l=document.createElement("canvas");return l.width=l.height=w,l}draw(w){const{width:l,actualBoundingBoxAscent:h,actualBoundingBoxDescent:y,actualBoundingBoxLeft:v,actualBoundingBoxRight:k}=this.ctx.measureText(w),z=Math.ceil(h),D=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(k-v))),B=Math.min(this.size-this.buffer,z+Math.ceil(y)),G=D+2*this.buffer,Q=B+2*this.buffer,te=Math.max(G*Q,0),me=new Uint8ClampedArray(te),Se={data:me,width:G,height:Q,glyphWidth:D,glyphHeight:B,glyphTop:z,glyphLeft:0,glyphAdvance:l};if(D===0||B===0)return Se;const{ctx:ke,buffer:Me,gridInner:be,gridOuter:Re}=this;ke.clearRect(Me,Me,D,B),ke.fillText(w,Me,Me+z);const tt=ke.getImageData(Me,Me,D,B);Re.fill(ye,0,te),be.fill(0,0,te);for(let Ie=0;Ie<B;Ie++)for(let Ve=0;Ve<D;Ve++){const rt=tt.data[4*(Ie*D+Ve)+3]/255;if(rt===0)continue;const st=(Ie+Me)*G+Ve+Me;if(rt===1)Re[st]=0,be[st]=ye;else{const ft=.5-rt;Re[st]=ft>0?ft*ft:0,be[st]=ft<0?ft*ft:0}}it(Re,0,0,G,Q,G,this.f,this.v,this.z),it(be,Me,Me,D,B,G,this.f,this.v,this.z);for(let Ie=0;Ie<te;Ie++){const Ve=Math.sqrt(Re[Ie])-Math.sqrt(be[Ie]);me[Ie]=Math.round(255-255*(Ve/this.radius+this.cutoff))}return Se}};class Ae{constructor(){this.specification=s.v.light.position}possiblyEvaluate(l,h){return s.y(l.expression.evaluate(h))}interpolate(l,h,y){return{x:s.z.number(l.x,h.x,y),y:s.z.number(l.y,h.y,y),z:s.z.number(l.z,h.z,y)}}}let ot;class Ye extends s.E{constructor(l){super(),ot=ot||new s.q({anchor:new s.D(s.v.light.anchor),position:new Ae,color:new s.D(s.v.light.color),intensity:new s.D(s.v.light.intensity)}),this._transitionable=new s.T(ot),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,h={}){if(!this._validate(s.r,l,h))for(const y in l){const v=l[y];y.endsWith("-transition")?this._transitionable.setTransition(y.slice(0,-11),v):this._transitionable.setValue(y,v)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,h,y){return(!y||y.validate!==!1)&&s.t(this,l.call(s.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:s.v}))}}class ut{constructor(l,h){this.width=l,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(l,h){const y=l.join(",")+String(h);return this.dashEntry[y]||(this.dashEntry[y]=this.addDash(l,h)),this.dashEntry[y]}getDashRanges(l,h,y){const v=[];let k=l.length%2==1?-l[l.length-1]*y:0,z=l[0]*y,D=!0;v.push({left:k,right:z,isDash:D,zeroLength:l[0]===0});let B=l[0];for(let G=1;G<l.length;G++){D=!D;const Q=l[G];k=B*y,B+=Q,z=B*y,v.push({left:k,right:z,isDash:D,zeroLength:Q===0})}return v}addRoundDash(l,h,y){const v=h/2;for(let k=-y;k<=y;k++){const z=this.width*(this.nextRow+y+k);let D=0,B=l[D];for(let G=0;G<this.width;G++){G/B.right>1&&(B=l[++D]);const Q=Math.abs(G-B.left),te=Math.abs(G-B.right),me=Math.min(Q,te);let Se;const ke=k/y*(v+1);if(B.isDash){const Me=v-Math.abs(ke);Se=Math.sqrt(me*me+Me*Me)}else Se=v-Math.sqrt(me*me+ke*ke);this.data[z+G]=Math.max(0,Math.min(255,Se+128))}}}addRegularDash(l){for(let D=l.length-1;D>=0;--D){const B=l[D],G=l[D+1];B.zeroLength?l.splice(D,1):G&&G.isDash===B.isDash&&(G.left=B.left,l.splice(D,1))}const h=l[0],y=l[l.length-1];h.isDash===y.isDash&&(h.left=y.left-this.width,y.right=h.right+this.width);const v=this.width*this.nextRow;let k=0,z=l[k];for(let D=0;D<this.width;D++){D/z.right>1&&(z=l[++k]);const B=Math.abs(D-z.left),G=Math.abs(D-z.right),Q=Math.min(B,G);this.data[v+D]=Math.max(0,Math.min(255,(z.isDash?Q:-Q)+128))}}addDash(l,h){const y=h?7:0,v=2*y+1;if(this.nextRow+v>this.height)return s.w("LineAtlas out of space"),null;let k=0;for(let D=0;D<l.length;D++)k+=l[D];if(k!==0){const D=this.width/k,B=this.getDashRanges(l,this.width,D);h?this.addRoundDash(B,D,y):this.addRegularDash(B)}const z={y:(this.nextRow+y+.5)/this.height,height:2*y/this.height,width:k};return this.nextRow+=v,this.dirty=!0,z}bind(l){const h=l.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const pt="maplibre_preloaded_worker_pool";class _t{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<_t.workerCount;)this.workers.push(new Worker(s.a.WORKER_URL));return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pt]}numActive(){return Object.keys(this.active).length}}const He=Math.floor(_.hardwareConcurrency/2);let mt,Pt;function jt(){return mt||(mt=new _t),mt}_t.workerCount=s.B(globalThis)?Math.max(Math.min(He,3),1):1;class un{constructor(l,h){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=h;const y=this.workerPool.acquire(h);for(let v=0;v<y.length;v++){const k=new s.C(y[v],h);k.name=`Worker ${v}`,this.actors.push(k)}if(!this.actors.length)throw new Error("No actors found")}broadcast(l,h){const y=[];for(const v of this.actors)y.push(v.sendAsync({type:l,data:h}));return Promise.all(y)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(l=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],l&&this.workerPool.release(this.id)}registerMessageHandler(l,h){for(const y of this.actors)y.registerMessageHandler(l,h)}}function nn(){return Pt||(Pt=new un(jt(),s.G),Pt.registerMessageHandler("GR",(w,l,h)=>s.m(l,h))),Pt}function rn(w,l){const h=s.F();return s.H(h,h,[1,1,0]),s.J(h,h,[.5*w.width,.5*w.height,1]),s.K(h,h,w.calculatePosMatrix(l.toUnwrapped()))}function pn(w,l,h,y,v,k){const z=function(te,me,Se){if(te)for(const ke of te){const Me=me[ke];if(Me&&Me.source===Se&&Me.type==="fill-extrusion")return!0}else for(const ke in me){const Me=me[ke];if(Me.source===Se&&Me.type==="fill-extrusion")return!0}return!1}(v&&v.layers,l,w.id),D=k.maxPitchScaleFactor(),B=w.tilesIn(y,D,z);B.sort(yn);const G=[];for(const te of B)G.push({wrappedTileID:te.tileID.wrapped().key,queryResults:te.tile.queryRenderedFeatures(l,h,w._state,te.queryGeometry,te.cameraQueryGeometry,te.scale,v,k,D,rn(w.transform,te.tileID))});const Q=function(te){const me={},Se={};for(const ke of te){const Me=ke.queryResults,be=ke.wrappedTileID,Re=Se[be]=Se[be]||{};for(const tt in Me){const Ie=Me[tt],Ve=Re[tt]=Re[tt]||{},rt=me[tt]=me[tt]||[];for(const st of Ie)Ve[st.featureIndex]||(Ve[st.featureIndex]=!0,rt.push(st))}}return me}(G);for(const te in Q)Q[te].forEach(me=>{const Se=me.feature,ke=w.getFeatureState(Se.layer["source-layer"],Se.id);Se.source=Se.layer.source,Se.layer["source-layer"]&&(Se.sourceLayer=Se.layer["source-layer"]),Se.state=ke});return Q}function yn(w,l){const h=w.tileID,y=l.tileID;return h.overscaledZ-y.overscaledZ||h.canonical.y-y.canonical.y||h.wrap-y.wrap||h.canonical.x-y.canonical.x}function qe(w,l,h){return s._(this,void 0,void 0,function*(){let y=w;if(w.url?y=(yield s.h(l.transformRequest(w.url,"Source"),h)).data:yield _.frameAsync(h),!y)return null;const v=s.L(s.e(y,w),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in y&&y.vector_layers&&(v.vectorLayerIds=y.vector_layers.map(k=>k.id)),v})}class We{constructor(l,h){l&&(h?this.setSouthWest(l).setNorthEast(h):Array.isArray(l)&&(l.length===4?this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]]):this.setSouthWest(l[0]).setNorthEast(l[1])))}setNorthEast(l){return this._ne=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}setSouthWest(l){return this._sw=l instanceof s.M?new s.M(l.lng,l.lat):s.M.convert(l),this}extend(l){const h=this._sw,y=this._ne;let v,k;if(l instanceof s.M)v=l,k=l;else{if(!(l instanceof We))return Array.isArray(l)?l.length===4||l.every(Array.isArray)?this.extend(We.convert(l)):this.extend(s.M.convert(l)):l&&("lng"in l||"lon"in l)&&"lat"in l?this.extend(s.M.convert(l)):this;if(v=l._sw,k=l._ne,!v||!k)return this}return h||y?(h.lng=Math.min(v.lng,h.lng),h.lat=Math.min(v.lat,h.lat),y.lng=Math.max(k.lng,y.lng),y.lat=Math.max(k.lat,y.lat)):(this._sw=new s.M(v.lng,v.lat),this._ne=new s.M(k.lng,k.lat)),this}getCenter(){return new s.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new s.M(this.getWest(),this.getNorth())}getSouthEast(){return new s.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(l){const{lng:h,lat:y}=s.M.convert(l);let v=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=y&&y<=this._ne.lat&&v}static convert(l){return l instanceof We?l:l&&new We(l)}static fromLngLat(l,h=0){const y=360*h/40075017,v=y/Math.cos(Math.PI/180*l.lat);return new We(new s.M(l.lng-v,l.lat-y),new s.M(l.lng+v,l.lat+y))}}class Ke{constructor(l,h,y){this.bounds=We.convert(this.validateBounds(l)),this.minzoom=h||0,this.maxzoom=y||24}validateBounds(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const h=Math.pow(2,l.z),y=Math.floor(s.N(this.bounds.getWest())*h),v=Math.floor(s.O(this.bounds.getNorth())*h),k=Math.ceil(s.N(this.bounds.getEast())*h),z=Math.ceil(s.O(this.bounds.getSouth())*h);return l.x>=y&&l.x<k&&l.y>=v&&l.y<z}}class kt extends s.E{constructor(l,h,y,v){if(super(),this.id=l,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.e(this,s.L(h,["url","scheme","tileSize","promoteId"])),this._options=s.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v)}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),l&&(s.e(this,l),l.bounds&&(this.tileBounds=new Ke(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}onAdd(l){this.map=l,this.load()}setSourceProperty(l){this._tileJSONRequest&&this._tileJSONRequest.abort(),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return s.e({},this._options)}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y={request:this.map._requestManager.transformRequest(h,"Tile"),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};y.request.collectResourceTiming=this._collectResourceTiming;let v="RT";if(l.actor&&l.state!=="expired"){if(l.state==="loading")return new Promise((k,z)=>{l.reloadPromise={resolve:k,reject:z}})}else l.actor=this.dispatcher.getActor(),v="LT";l.abortController=new AbortController;try{const k=yield l.actor.sendAsync({type:v,data:y},l.abortController);if(delete l.abortController,l.aborted)return;this._afterTileLoadWorkerResponse(l,k)}catch(k){if(delete l.abortController,l.aborted)return;if(k&&k.status!==404)throw k;this._afterTileLoadWorkerResponse(l,null)}})}_afterTileLoadWorkerResponse(l,h){if(h&&h.resourceTiming&&(l.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&l.setExpiryData(h),l.loadVectorData(h,this.map.painter),l.reloadPromise){const y=l.reloadPromise;l.reloadPromise=null,this.loadTile(l).then(y.resolve).catch(y.reject)}}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.actor&&(yield l.actor.sendAsync({type:"AT",data:{uid:l.uid,type:this.type,source:this.id}}))})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),l.actor&&(yield l.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class pe extends s.E{constructor(l,h,y,v){super(),this.id=l,this.dispatcher=y,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.e({type:"raster"},h),s.e(this,s.L(h,["url","scheme","tileSize"]))}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const l=yield qe(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,l&&(s.e(this,l),l.bounds&&(this.tileBounds=new Ke(l.bounds,this.minzoom,this.maxzoom)),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})))}catch(l){this._tileJSONRequest=null,this.fire(new s.j(l))}})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(l){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),l(),this.load()}setTiles(l){return this.setSourceProperty(()=>{this._options.tiles=l}),this}setUrl(l){return this.setSourceProperty(()=>{this.url=l,this._options.url=l}),this}serialize(){return s.e({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);l.abortController=new AbortController;try{const y=yield $.getImage(this.map._requestManager.transformRequest(h,"Tile"),l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(y&&y.data){this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&l.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const v=this.map.painter.context,k=v.gl,z=y.data;l.texture=this.map.painter.getTileTexture(z.width),l.texture?l.texture.update(z,{useMipmap:!0}):(l.texture=new ee(v,z,k.RGBA,{useMipmap:!0}),l.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),v.extTextureFilterAnisotropic&&k.texParameterf(k.TEXTURE_2D,v.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,v.extTextureFilterAnisotropicMax)),l.state="loaded"}}catch(y){if(delete l.abortController,l.aborted)l.state="unloaded";else if(y)throw l.state="errored",y}})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController)})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.texture&&this.map.painter.saveTileTexture(l.texture)})}hasTransition(){return!1}}class fn extends pe{constructor(l,h,y,v){super(l,h,y,v),this.type="raster-dem",this.maxzoom=22,this._options=s.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),y=this.map._requestManager.transformRequest(h,"Tile");l.neighboringTiles=this._getNeighboringTiles(l.tileID),l.abortController=new AbortController;try{const v=yield $.getImage(y,l.abortController,this.map._refreshExpiredTiles);if(delete l.abortController,l.aborted)return void(l.state="unloaded");if(v&&v.data){const k=v.data;this.map._refreshExpiredTiles&&v.cacheControl&&v.expires&&l.setExpiryData({cacheControl:v.cacheControl,expires:v.expires});const z=s.b(k)&&s.S()?k:yield this.readImageNow(k),D={type:this.type,uid:l.uid,source:this.id,rawImageData:z,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!l.actor||l.state==="expired"){l.actor=this.dispatcher.getActor();const B=yield l.actor.sendAsync({type:"LDT",data:D});l.dem=B,l.needsHillshadePrepare=!0,l.needsTerrainPrepare=!0,l.state="loaded"}}}catch(v){if(delete l.abortController,l.aborted)l.state="unloaded";else if(v)throw l.state="errored",v}})}readImageNow(l){return s._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&s.U()){const h=l.width+2,y=l.height+2;try{return new s.R({width:h,height:y},yield s.V(l,-1,-1,h,y))}catch{}}return _.getImageData(l,1)})}_getNeighboringTiles(l){const h=l.canonical,y=Math.pow(2,h.z),v=(h.x-1+y)%y,k=h.x===0?l.wrap-1:l.wrap,z=(h.x+1+y)%y,D=h.x+1===y?l.wrap+1:l.wrap,B={};return B[new s.Q(l.overscaledZ,k,h.z,v,h.y).key]={backfilled:!1},B[new s.Q(l.overscaledZ,D,h.z,z,h.y).key]={backfilled:!1},h.y>0&&(B[new s.Q(l.overscaledZ,k,h.z,v,h.y-1).key]={backfilled:!1},B[new s.Q(l.overscaledZ,l.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},B[new s.Q(l.overscaledZ,D,h.z,z,h.y-1).key]={backfilled:!1}),h.y+1<y&&(B[new s.Q(l.overscaledZ,k,h.z,v,h.y+1).key]={backfilled:!1},B[new s.Q(l.overscaledZ,l.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},B[new s.Q(l.overscaledZ,D,h.z,z,h.y+1).key]={backfilled:!1}),B}unloadTile(l){return s._(this,void 0,void 0,function*(){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&(yield l.actor.sendAsync({type:"RDT",data:{type:this.type,uid:l.uid,source:this.id}}))})}}class Xe extends s.E{constructor(l,h,y,v){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=y.getActor(),this.setEventedParent(v),this._data=h.data,this._options=s.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const k=s.W/this.tileSize;this.workerOptions=s.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*k,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*k,extent:s.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:s.W,radius:(h.clusterRadius||50)*k,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return s._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(l){this.map=l,this.load()}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){return this._updateWorkerData(l),this}setClusterOptions(l){return this.workerOptions.cluster=l.cluster,l&&(l.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=l.clusterRadius),l.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=l.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(l){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:l,source:this.id}})}getClusterChildren(l){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:l,source:this.id}})}getClusterLeaves(l,h,y){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:l,limit:h,offset:y}})}_updateWorkerData(l){return s._(this,void 0,void 0,function*(){const h=s.e({type:this.type},this.workerOptions);l?h.dataDiff=l:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(_.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new s.k("dataloading",{dataType:"source"}));try{const y=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||y.abandoned)return void this.fire(new s.k("dataabort",{dataType:"source"}));let v=null;y.resourceTiming&&y.resourceTiming[this.id]&&(v=y.resourceTiming[this.id].slice(0));const k={dataType:"source"};this._collectResourceTiming&&v&&v.length>0&&s.e(k,{resourceTiming:v}),this.fire(new s.k("data",Object.assign(Object.assign({},k),{sourceDataType:"metadata"}))),this.fire(new s.k("data",Object.assign(Object.assign({},k),{sourceDataType:"content"})))}catch(y){if(this._pendingLoads--,this._removed)return void this.fire(new s.k("dataabort",{dataType:"source"}));this.fire(new s.j(y))}})}loaded(){return this._pendingLoads===0}loadTile(l){return s._(this,void 0,void 0,function*(){const h=l.actor?"RT":"LT";l.actor=this.actor;const y={type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.abortController=new AbortController;const v=yield this.actor.sendAsync({type:h,data:y},l.abortController);delete l.abortController,l.unloadVectorData(),l.aborted||l.loadVectorData(v,this.map.painter,h==="RT")})}abortTile(l){return s._(this,void 0,void 0,function*(){l.abortController&&(l.abortController.abort(),delete l.abortController),l.aborted=!0})}unloadTile(l){return s._(this,void 0,void 0,function*(){l.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:l.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return s.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var lt=s.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Wt extends s.E{constructor(l,h,y,v){super(),this.id=l,this.dispatcher=y,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=h}load(l){return s._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new s.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield $.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,l&&(this.coordinates=l),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new s.j(h))}})}loaded(){return this._loaded}updateImage(l){return l.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=l.url,this.load(l.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new s.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(l){this.coordinates=l;const h=l.map(s.Y.fromLngLat);this.tileID=function(v){let k=1/0,z=1/0,D=-1/0,B=-1/0;for(const me of v)k=Math.min(k,me.x),z=Math.min(z,me.y),D=Math.max(D,me.x),B=Math.max(B,me.y);const G=Math.max(D-k,B-z),Q=Math.max(0,Math.floor(-Math.log(G)/Math.LN2)),te=Math.pow(2,Q);return new s.a0(Q,Math.floor((k+D)/2*te),Math.floor((z+B)/2*te))}(h),this.minzoom=this.maxzoom=this.tileID.z;const y=h.map(v=>this.tileID.getTilePoint(v)._round());return this._boundsArray=new s.Z,this._boundsArray.emplaceBack(y[0].x,y[0].y,0,0),this._boundsArray.emplaceBack(y[1].x,y[1].y,s.W,0),this._boundsArray.emplaceBack(y[3].x,y[3].y,0,s.W),this._boundsArray.emplaceBack(y[2].x,y[2].y,s.W,s.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new s.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const l=this.map.painter.context,h=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,lt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ee(l,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const k=this.tiles[v];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(l){return s._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={}):l.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Xn extends Wt{constructor(l,h,y,v){super(l,h,y,v),this.roundZoom=!0,this.type="video",this.options=h}load(){return s._(this,void 0,void 0,function*(){this._loaded=!1;const l=this.options;this.urls=[];for(const h of l.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield s.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new s.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const h=this.video.seekable;l<h.start(0)||l>h.end(0)?this.fire(new s.j(new s.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,h=l.gl;this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,lt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new ee(l,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let y=!1;for(const v in this.tiles){const k=this.tiles[v];k.state!=="loaded"&&(k.state="loaded",k.texture=this.texture,y=!0)}y&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Wn extends Wt{constructor(l,h,y,v){super(l,h,y,v),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(k=>!Array.isArray(k)||k.length!==2||k.some(z=>typeof z!="number"))||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new s.j(new s.a1(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new s.j(new s.a1(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.j(new s.a1(`sources.${l}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return s._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,y=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,lt.members)),this.boundsSegments||(this.boundsSegments=s.$.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ee(h,this.canvas,y.RGBA,{premultiply:!0});let v=!1;for(const k in this.tiles){const z=this.tiles[k];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture,v=!0)}v&&this.fire(new s.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}}const fr={},Tr=w=>{switch(w){case"geojson":return Xe;case"image":return Wt;case"raster":return pe;case"raster-dem":return fn;case"vector":return kt;case"video":return Xn;case"canvas":return Wn}return fr[w]},Cr="RTLPluginLoaded";class xi extends s.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=nn()}_syncState(l){return this.status=l,this.dispatcher.broadcast("SRPS",{pluginStatus:l,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(l){return s._(this,arguments,void 0,function*(h,y=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=_.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!y)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return s._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new s.k(Cr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Un=null;function xt(){return Un||(Un=new xi),Un}class Pr{constructor(l,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=l,this.uid=s.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(l){const h=l+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(l){this.demTexture&&l.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(l,h,y){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",l){l.featureIndex&&(this.latestFeatureIndex=l.featureIndex,l.rawTileData?(this.latestRawTileData=l.rawTileData,this.latestFeatureIndex.rawTileData=l.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=l.collisionBoxArray,this.buckets=function(v,k){const z={};if(!k)return z;for(const D of v){const B=D.layerIds.map(G=>k.getLayer(G)).filter(Boolean);if(B.length!==0){D.layers=B,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(G=>B.filter(Q=>Q.id===G)[0]));for(const G of B)z[G.id]=D}}return z}(l.buckets,h.style),this.hasSymbolBuckets=!1;for(const v in this.buckets){const k=this.buckets[v];if(k instanceof s.a5){if(this.hasSymbolBuckets=!0,!y)break;k.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const v in this.buckets){const k=this.buckets[v];if(k instanceof s.a5&&k.hasRTLText){this.hasRTLText=!0,xt().lazyLoad();break}}this.queryPadding=0;for(const v in this.buckets){const k=this.buckets[v];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(v).queryRadius(k))}l.imageAtlas&&(this.imageAtlas=l.imageAtlas),l.glyphAtlasImage&&(this.glyphAtlasImage=l.glyphAtlasImage)}else this.collisionBoxArray=new s.a4}unloadVectorData(){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(l){return this.buckets[l.id]}upload(l){for(const y in this.buckets){const v=this.buckets[y];v.uploadPending()&&v.upload(l)}const h=l.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ee(l,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ee(l,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(l){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(l,this.imageAtlasTexture)}queryRenderedFeatures(l,h,y,v,k,z,D,B,G,Q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:v,cameraQueryGeometry:k,scale:z,tileSize:this.tileSize,pixelPosMatrix:Q,transform:B,params:D,queryPadding:this.queryPadding*G},l,h,y):{}}querySourceFeatures(l,h){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const v=y.loadVTLayers(),k=h&&h.sourceLayer?h.sourceLayer:"",z=v._geojsonTileLayer||v[k];if(!z)return;const D=s.a6(h&&h.filter),{z:B,x:G,y:Q}=this.tileID.canonical,te={z:B,x:G,y:Q};for(let me=0;me<z.length;me++){const Se=z.feature(me);if(D.needGeometry){const be=s.a7(Se,!0);if(!D.filter(new s.a8(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!D.filter(new s.a8(this.tileID.overscaledZ),Se))continue;const ke=y.getId(Se,k),Me=new s.a9(Se,B,G,Q,ke);Me.tile=te,l.push(Me)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(l){const h=this.expirationTime;if(l.cacheControl){const y=s.aa(l.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else l.expires&&(this.expirationTime=new Date(l.expires).getTime());if(this.expirationTime){const y=Date.now();let v=!1;if(this.expirationTime>y)v=!1;else if(h)if(this.expirationTime<h)v=!0;else{const k=this.expirationTime-h;k?this.expirationTime=y+Math.max(k,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(l,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(l).length===0)return;const y=this.latestFeatureIndex.loadVTLayers();for(const v in this.buckets){if(!h.style.hasLayer(v))continue;const k=this.buckets[v],z=k.layers[0].sourceLayer||"_geojsonTileLayer",D=y[z],B=l[z];if(!D||!B||Object.keys(B).length===0)continue;k.update(B,D,this.imageAtlas&&this.imageAtlas.patternPositions||{});const G=h&&h.style&&h.style.getLayer(v);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(k)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<_.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(l){this.symbolFadeHoldUntil=_.now()+l}setDependencies(l,h){const y={};for(const v of h)y[v]=!0;this.dependencies[l]=y}hasDependency(l,h){for(const y of l){const v=this.dependencies[y];if(v){for(const k of h)if(v[k])return!0}}return!1}}class vr{constructor(l,h){this.max=l,this.onRemove=h,this.reset()}reset(){for(const l in this.data)for(const h of this.data[l])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(l,h,y){const v=l.wrapped().key;this.data[v]===void 0&&(this.data[v]=[]);const k={value:h,timeout:void 0};if(y!==void 0&&(k.timeout=setTimeout(()=>{this.remove(l,k)},y)),this.data[v].push(k),this.order.push(v),this.order.length>this.max){const z=this._getAndRemoveByKey(this.order[0]);z&&this.onRemove(z)}return this}has(l){return l.wrapped().key in this.data}getAndRemove(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null}_getAndRemoveByKey(l){const h=this.data[l].shift();return h.timeout&&clearTimeout(h.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),h.value}getByKey(l){const h=this.data[l];return h?h[0].value:null}get(l){return this.has(l)?this.data[l.wrapped().key][0].value:null}remove(l,h){if(!this.has(l))return this;const y=l.wrapped().key,v=h===void 0?0:this.data[y].indexOf(h),k=this.data[y][v];return this.data[y].splice(v,1),k.timeout&&clearTimeout(k.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(k.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(l){for(this.max=l;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(l){const h=[];for(const y in this.data)for(const v of this.data[y])l(v.value)||h.push(v);for(const y of h)this.remove(y.value.tileID,y)}}class Ri{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(l,h,y){const v=String(h);if(this.stateChanges[l]=this.stateChanges[l]||{},this.stateChanges[l][v]=this.stateChanges[l][v]||{},s.e(this.stateChanges[l][v],y),this.deletedStates[l]===null){this.deletedStates[l]={};for(const k in this.state[l])k!==v&&(this.deletedStates[l][k]=null)}else if(this.deletedStates[l]&&this.deletedStates[l][v]===null){this.deletedStates[l][v]={};for(const k in this.state[l][v])y[k]||(this.deletedStates[l][v][k]=null)}else for(const k in y)this.deletedStates[l]&&this.deletedStates[l][v]&&this.deletedStates[l][v][k]===null&&delete this.deletedStates[l][v][k]}removeFeatureState(l,h,y){if(this.deletedStates[l]===null)return;const v=String(h);if(this.deletedStates[l]=this.deletedStates[l]||{},y&&h!==void 0)this.deletedStates[l][v]!==null&&(this.deletedStates[l][v]=this.deletedStates[l][v]||{},this.deletedStates[l][v][y]=null);else if(h!==void 0)if(this.stateChanges[l]&&this.stateChanges[l][v])for(y in this.deletedStates[l][v]={},this.stateChanges[l][v])this.deletedStates[l][v][y]=null;else this.deletedStates[l][v]=null;else this.deletedStates[l]=null}getState(l,h){const y=String(h),v=s.e({},(this.state[l]||{})[y],(this.stateChanges[l]||{})[y]);if(this.deletedStates[l]===null)return{};if(this.deletedStates[l]){const k=this.deletedStates[l][h];if(k===null)return{};for(const z in k)delete v[z]}return v}initializeTileState(l,h){l.setFeatureState(this.state,h)}coalesceChanges(l,h){const y={};for(const v in this.stateChanges){this.state[v]=this.state[v]||{};const k={};for(const z in this.stateChanges[v])this.state[v][z]||(this.state[v][z]={}),s.e(this.state[v][z],this.stateChanges[v][z]),k[z]=this.state[v][z];y[v]=k}for(const v in this.deletedStates){this.state[v]=this.state[v]||{};const k={};if(this.deletedStates[v]===null)for(const z in this.state[v])k[z]={},this.state[v][z]={};else for(const z in this.deletedStates[v]){if(this.deletedStates[v][z]===null)this.state[v][z]={};else for(const D of Object.keys(this.deletedStates[v][z]))delete this.state[v][z][D];k[z]=this.state[v][z]}y[v]=y[v]||{},s.e(y[v],k)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const v in l)l[v].setFeatureState(y,h)}}class Bn extends s.E{constructor(l,h,y){super(),this.id=l,this.dispatcher=y,this.on("data",v=>this._dataHandler(v)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((v,k,z,D)=>{const B=new(Tr(k.type))(v,k,z,D);if(B.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${B.id}`);return B})(l,h,y,this),this._tiles={},this._cache=new vr(0,v=>this._unloadTile(v)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ri,this._didEmitContent=!1,this._updated=!1}onAdd(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._maxTileCacheZoomLevels=l?l._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(l)}onRemove(l){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(l)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const l in this._tiles){const h=this._tiles[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(l,h,y){return s._(this,void 0,void 0,function*(){try{yield this._source.loadTile(l),this._tileLoaded(l,h,y)}catch(v){l.state="errored",v.status!==404?this._source.fire(new s.j(v,{tile:l})):this.update(this.transform,this.terrain)}})}_unloadTile(l){this._source.unloadTile&&this._source.unloadTile(l)}_abortTile(l){this._source.abortTile&&this._source.abortTile(l),this._source.fire(new s.k("dataabort",{tile:l,coord:l.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(l){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const y=this._tiles[h];y.upload(l),y.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(l=>l.tileID).sort(Oe).map(l=>l.key)}getRenderableIds(l){const h=[];for(const y in this._tiles)this._isIdRenderable(y,l)&&h.push(this._tiles[y]);return l?h.sort((y,v)=>{const k=y.tileID,z=v.tileID,D=new s.P(k.canonical.x,k.canonical.y)._rotate(this.transform.angle),B=new s.P(z.canonical.x,z.canonical.y)._rotate(this.transform.angle);return k.overscaledZ-z.overscaledZ||B.y-D.y||B.x-D.x}).map(y=>y.tileID.key):h.map(y=>y.tileID).sort(Oe).map(y=>y.key)}hasRenderableParent(l){const h=this.findLoadedParent(l,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(l,h){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(h||!this._tiles[l].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const l in this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")}}_reloadTile(l,h){return s._(this,void 0,void 0,function*(){const y=this._tiles[l];y&&(y.state!=="loading"&&(y.state=h),yield this._loadTile(y,l,h))})}_tileLoaded(l,h,y){l.timeAdded=_.now(),y==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(h,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),l.aborted||this._source.fire(new s.k("data",{dataType:"source",tile:l,coord:l.tileID}))}_backfillDEM(l){const h=this.getRenderableIds();for(let v=0;v<h.length;v++){const k=h[v];if(l.neighboringTiles&&l.neighboringTiles[k]){const z=this.getTileByID(k);y(l,z),y(z,l)}}function y(v,k){v.needsHillshadePrepare=!0,v.needsTerrainPrepare=!0;let z=k.tileID.canonical.x-v.tileID.canonical.x;const D=k.tileID.canonical.y-v.tileID.canonical.y,B=Math.pow(2,v.tileID.canonical.z),G=k.tileID.key;z===0&&D===0||Math.abs(D)>1||(Math.abs(z)>1&&(Math.abs(z+B)===1?z+=B:Math.abs(z-B)===1&&(z-=B)),k.dem&&v.dem&&(v.dem.backfillBorder(k.dem,z,D),v.neighboringTiles&&v.neighboringTiles[G]&&(v.neighboringTiles[G].backfilled=!0)))}}getTile(l){return this.getTileByID(l.key)}getTileByID(l){return this._tiles[l]}_retainLoadedChildren(l,h,y,v){for(const k in this._tiles){let z=this._tiles[k];if(v[k]||!z.hasData()||z.tileID.overscaledZ<=h||z.tileID.overscaledZ>y)continue;let D=z.tileID;for(;z&&z.tileID.overscaledZ>h+1;){const G=z.tileID.scaledTo(z.tileID.overscaledZ-1);z=this._tiles[G.key],z&&z.hasData()&&(D=G)}let B=D;for(;B.overscaledZ>h;)if(B=B.scaledTo(B.overscaledZ-1),l[B.key]){v[D.key]=D;break}}}findLoadedParent(l,h){if(l.key in this._loadedParentTiles){const y=this._loadedParentTiles[l.key];return y&&y.tileID.overscaledZ>=h?y:null}for(let y=l.overscaledZ-1;y>=h;y--){const v=l.scaledTo(y),k=this._getLoadedTile(v);if(k)return k}}_getLoadedTile(l){const h=this._tiles[l.key];return h&&h.hasData()?h:this._cache.getByKey(l.wrapped().key)}updateCacheSize(l){const h=Math.ceil(l.width/this._source.tileSize)+1,y=Math.ceil(l.height/this._source.tileSize)+1,v=Math.floor(h*y*(this._maxTileCacheZoomLevels===null?s.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),k=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(k)}handleWrapJump(l){const h=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,h){const y={};for(const v in this._tiles){const k=this._tiles[v];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+h),y[k.tileID.key]=k}this._tiles=y;for(const v in this._timers)clearTimeout(this._timers[v]),delete this._timers[v];for(const v in this._tiles)this._setTileReloadTimer(v,this._tiles[v])}}update(l,h){if(!this._sourceLoaded||this._paused)return;let y;this.transform=l,this.terrain=h,this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?y=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(Q=>new s.Q(Q.canonical.z,Q.wrap,Q.canonical.z,Q.canonical.x,Q.canonical.y)):(y=l.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(y=y.filter(Q=>this._source.hasTile(Q)))):y=[];const v=l.coveringZoomLevel(this._source),k=Math.max(v-Bn.maxOverzooming,this._source.minzoom),z=Math.max(v+Bn.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Q={};for(const te of y)if(te.canonical.z>this._source.minzoom){const me=te.scaledTo(te.canonical.z-1);Q[me.key]=me;const Se=te.scaledTo(Math.max(this._source.minzoom,Math.min(te.canonical.z,5)));Q[Se.key]=Se}y=y.concat(Object.values(Q))}const D=y.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,D&&this.fire(new s.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const B=this._updateRetainedTiles(y,v);if(yt(this._source.type)){const Q={},te={},me=Object.keys(B),Se=_.now();for(const ke of me){const Me=B[ke],be=this._tiles[ke];if(!be||be.fadeEndTime!==0&&be.fadeEndTime<=Se)continue;const Re=this.findLoadedParent(Me,k);Re&&(this._addTile(Re.tileID),Q[Re.tileID.key]=Re.tileID),te[ke]=Me}this._retainLoadedChildren(te,v,z,B);for(const ke in Q)B[ke]||(this._coveredTiles[ke]=!0,B[ke]=Q[ke]);if(h){const ke={},Me={};for(const be of y)this._tiles[be.key].hasData()?ke[be.key]=be:Me[be.key]=be;for(const be in Me){const Re=Me[be].children(this._source.maxzoom);this._tiles[Re[0].key]&&this._tiles[Re[1].key]&&this._tiles[Re[2].key]&&this._tiles[Re[3].key]&&(ke[Re[0].key]=B[Re[0].key]=Re[0],ke[Re[1].key]=B[Re[1].key]=Re[1],ke[Re[2].key]=B[Re[2].key]=Re[2],ke[Re[3].key]=B[Re[3].key]=Re[3],delete Me[be])}for(const be in Me){const Re=this.findLoadedParent(Me[be],this._source.minzoom);if(Re){ke[Re.tileID.key]=B[Re.tileID.key]=Re.tileID;for(const tt in ke)ke[tt].isChildOf(Re.tileID)&&delete ke[tt]}}for(const be in this._tiles)ke[be]||(this._coveredTiles[be]=!0)}}for(const Q in B)this._tiles[Q].clearFadeHold();const G=s.ab(this._tiles,B);for(const Q of G){const te=this._tiles[Q];te.hasSymbolBuckets&&!te.holdingForFade()?te.setHoldDuration(this.map._fadeDuration):te.hasSymbolBuckets&&!te.symbolFadeFinished()||this._removeTile(Q)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)}_updateRetainedTiles(l,h){const y={},v={},k=Math.max(h-Bn.maxOverzooming,this._source.minzoom),z=Math.max(h+Bn.maxUnderzooming,this._source.minzoom),D={};for(const B of l){const G=this._addTile(B);y[B.key]=B,G.hasData()||h<this._source.maxzoom&&(D[B.key]=B)}this._retainLoadedChildren(D,h,z,y);for(const B of l){let G=this._tiles[B.key];if(G.hasData())continue;if(h+1>this._source.maxzoom){const te=B.children(this._source.maxzoom)[0],me=this.getTile(te);if(me&&me.hasData()){y[te.key]=te;continue}}else{const te=B.children(this._source.maxzoom);if(y[te[0].key]&&y[te[1].key]&&y[te[2].key]&&y[te[3].key])continue}let Q=G.wasRequested();for(let te=B.overscaledZ-1;te>=k;--te){const me=B.scaledTo(te);if(v[me.key])break;if(v[me.key]=!0,G=this.getTile(me),!G&&Q&&(G=this._addTile(me)),G){const Se=G.hasData();if((Q||Se)&&(y[me.key]=me),Q=G.wasRequested(),Se)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const l in this._tiles){const h=[];let y,v=this._tiles[l].tileID;for(;v.overscaledZ>0;){if(v.key in this._loadedParentTiles){y=this._loadedParentTiles[v.key];break}h.push(v.key);const k=v.scaledTo(v.overscaledZ-1);if(y=this._getLoadedTile(k),y)break;v=k}for(const k of h)this._loadedParentTiles[k]=y}}_addTile(l){let h=this._tiles[l.key];if(h)return h;h=this._cache.getAndRemove(l),h&&(this._setTileReloadTimer(l.key,h),h.tileID=l,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,h)));const y=h;return h||(h=new Pr(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(h,l.key,h.state)),h.uses++,this._tiles[l.key]=h,y||this._source.fire(new s.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(l,h){l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);const y=h.getExpiryTimeout();y&&(this._timers[l]=setTimeout(()=>{this._reloadTile(l,"expired"),delete this._timers[l]},y))}_removeTile(l){const h=this._tiles[l];h&&(h.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(l){const h=l.sourceDataType;l.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const l in this._tiles)this._removeTile(l);this._cache.reset()}tilesIn(l,h,y){const v=[],k=this.transform;if(!k)return v;const z=y?k.getCameraQueryGeometry(l):l,D=l.map(ke=>k.pointCoordinate(ke,this.terrain)),B=z.map(ke=>k.pointCoordinate(ke,this.terrain)),G=this.getIds();let Q=1/0,te=1/0,me=-1/0,Se=-1/0;for(const ke of B)Q=Math.min(Q,ke.x),te=Math.min(te,ke.y),me=Math.max(me,ke.x),Se=Math.max(Se,ke.y);for(let ke=0;ke<G.length;ke++){const Me=this._tiles[G[ke]];if(Me.holdingForFade())continue;const be=Me.tileID,Re=Math.pow(2,k.zoom-Me.tileID.overscaledZ),tt=h*Me.queryPadding*s.W/Me.tileSize/Re,Ie=[be.getTilePoint(new s.Y(Q,te)),be.getTilePoint(new s.Y(me,Se))];if(Ie[0].x-tt<s.W&&Ie[0].y-tt<s.W&&Ie[1].x+tt>=0&&Ie[1].y+tt>=0){const Ve=D.map(st=>be.getTilePoint(st)),rt=B.map(st=>be.getTilePoint(st));v.push({tile:Me,tileID:be,queryGeometry:Ve,cameraQueryGeometry:rt,scale:Re})}}return v}getVisibleCoordinates(l){const h=this.getRenderableIds(l).map(y=>this._tiles[y].tileID);for(const y of h)y.posMatrix=this.transform.calculatePosMatrix(y.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(yt(this._source.type)){const l=_.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=l)return!0}return!1}setFeatureState(l,h,y){this._state.updateState(l=l||"_geojsonTileLayer",h,y)}removeFeatureState(l,h,y){this._state.removeFeatureState(l=l||"_geojsonTileLayer",h,y)}getFeatureState(l,h){return this._state.getState(l=l||"_geojsonTileLayer",h)}setDependencies(l,h,y){const v=this._tiles[l];v&&v.setDependencies(h,y)}reloadTilesForDependencies(l,h){for(const y in this._tiles)this._tiles[y].hasDependency(l,h)&&this._reloadTile(y,"reloading");this._cache.filter(y=>!y.hasDependency(l,h))}}function Oe(w,l){const h=Math.abs(2*w.wrap)-+(w.wrap<0),y=Math.abs(2*l.wrap)-+(l.wrap<0);return w.overscaledZ-l.overscaledZ||y-h||l.canonical.y-w.canonical.y||l.canonical.x-w.canonical.x}function yt(w){return w==="raster"||w==="image"||w==="video"}Bn.maxOverzooming=10,Bn.maxUnderzooming=3;class bt{constructor(l,h){this.reset(l,h)}reset(l,h){this.points=l||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(this.points.length===1)return this.points[0];l=s.ac(l,0,1);let h=1,y=this._distances[h];const v=l*this.paddedLength+this.padding;for(;y<v&&h<this._distances.length;)y=this._distances[++h];const k=h-1,z=this._distances[k],D=y-z,B=D>0?(v-z)/D:0;return this.points[k].mult(1-B).add(this.points[h].mult(B))}}function Rt(w,l){let h=!0;return w==="always"||w!=="never"&&l!=="never"||(h=!1),h}class Qt{constructor(l,h,y){const v=this.boxCells=[],k=this.circleCells=[];this.xCellCount=Math.ceil(l/y),this.yCellCount=Math.ceil(h/y);for(let z=0;z<this.xCellCount*this.yCellCount;z++)v.push([]),k.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=h,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,h,y,v,k){this._forEachCell(h,y,v,k,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(h),this.bboxes.push(y),this.bboxes.push(v),this.bboxes.push(k)}insertCircle(l,h,y,v){this._forEachCell(h-v,y-v,h+v,y+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(h),this.circles.push(y),this.circles.push(v)}_insertBoxCell(l,h,y,v,k,z){this.boxCells[k].push(z)}_insertCircleCell(l,h,y,v,k,z){this.circleCells[k].push(z)}_query(l,h,y,v,k,z,D){if(y<0||l>this.width||v<0||h>this.height)return[];const B=[];if(l<=0&&h<=0&&this.width<=y&&this.height<=v){if(k)return[{key:null,x1:l,y1:h,x2:y,y2:v}];for(let G=0;G<this.boxKeys.length;G++)B.push({key:this.boxKeys[G],x1:this.bboxes[4*G],y1:this.bboxes[4*G+1],x2:this.bboxes[4*G+2],y2:this.bboxes[4*G+3]});for(let G=0;G<this.circleKeys.length;G++){const Q=this.circles[3*G],te=this.circles[3*G+1],me=this.circles[3*G+2];B.push({key:this.circleKeys[G],x1:Q-me,y1:te-me,x2:Q+me,y2:te+me})}}else this._forEachCell(l,h,y,v,this._queryCell,B,{hitTest:k,overlapMode:z,seenUids:{box:{},circle:{}}},D);return B}query(l,h,y,v){return this._query(l,h,y,v,!1,null)}hitTest(l,h,y,v,k,z){return this._query(l,h,y,v,!0,k,z).length>0}hitTestCircle(l,h,y,v,k){const z=l-y,D=l+y,B=h-y,G=h+y;if(D<0||z>this.width||G<0||B>this.height)return!1;const Q=[];return this._forEachCell(z,B,D,G,this._queryCellCircle,Q,{hitTest:!0,overlapMode:v,circle:{x:l,y:h,radius:y},seenUids:{box:{},circle:{}}},k),Q.length>0}_queryCell(l,h,y,v,k,z,D,B){const{seenUids:G,hitTest:Q,overlapMode:te}=D,me=this.boxCells[k];if(me!==null){const ke=this.bboxes;for(const Me of me)if(!G.box[Me]){G.box[Me]=!0;const be=4*Me,Re=this.boxKeys[Me];if(l<=ke[be+2]&&h<=ke[be+3]&&y>=ke[be+0]&&v>=ke[be+1]&&(!B||B(Re))&&(!Q||!Rt(te,Re.overlapMode))&&(z.push({key:Re,x1:ke[be],y1:ke[be+1],x2:ke[be+2],y2:ke[be+3]}),Q))return!0}}const Se=this.circleCells[k];if(Se!==null){const ke=this.circles;for(const Me of Se)if(!G.circle[Me]){G.circle[Me]=!0;const be=3*Me,Re=this.circleKeys[Me];if(this._circleAndRectCollide(ke[be],ke[be+1],ke[be+2],l,h,y,v)&&(!B||B(Re))&&(!Q||!Rt(te,Re.overlapMode))){const tt=ke[be],Ie=ke[be+1],Ve=ke[be+2];if(z.push({key:Re,x1:tt-Ve,y1:Ie-Ve,x2:tt+Ve,y2:Ie+Ve}),Q)return!0}}}return!1}_queryCellCircle(l,h,y,v,k,z,D,B){const{circle:G,seenUids:Q,overlapMode:te}=D,me=this.boxCells[k];if(me!==null){const ke=this.bboxes;for(const Me of me)if(!Q.box[Me]){Q.box[Me]=!0;const be=4*Me,Re=this.boxKeys[Me];if(this._circleAndRectCollide(G.x,G.y,G.radius,ke[be+0],ke[be+1],ke[be+2],ke[be+3])&&(!B||B(Re))&&!Rt(te,Re.overlapMode))return z.push(!0),!0}}const Se=this.circleCells[k];if(Se!==null){const ke=this.circles;for(const Me of Se)if(!Q.circle[Me]){Q.circle[Me]=!0;const be=3*Me,Re=this.circleKeys[Me];if(this._circlesCollide(ke[be],ke[be+1],ke[be+2],G.x,G.y,G.radius)&&(!B||B(Re))&&!Rt(te,Re.overlapMode))return z.push(!0),!0}}}_forEachCell(l,h,y,v,k,z,D,B){const G=this._convertToXCellCoord(l),Q=this._convertToYCellCoord(h),te=this._convertToXCellCoord(y),me=this._convertToYCellCoord(v);for(let Se=G;Se<=te;Se++)for(let ke=Q;ke<=me;ke++)if(k.call(this,l,h,y,v,this.xCellCount*ke+Se,z,D,B))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,h,y,v,k,z){const D=v-l,B=k-h,G=y+z;return G*G>D*D+B*B}_circleAndRectCollide(l,h,y,v,k,z,D){const B=(z-v)/2,G=Math.abs(l-(v+B));if(G>B+y)return!1;const Q=(D-k)/2,te=Math.abs(h-(k+Q));if(te>Q+y)return!1;if(G<=B||te<=Q)return!0;const me=G-B,Se=te-Q;return me*me+Se*Se<=y*y}}function Jt(w,l,h,y,v){const k=s.F();return l?(s.J(k,k,[1/v,1/v,1]),h||s.ad(k,k,y.angle)):s.K(k,y.labelPlaneMatrix,w),k}function yr(w,l,h,y,v){if(l){const k=s.ae(w);return s.J(k,k,[v,v,1]),h||s.ad(k,k,-y.angle),k}return y.glCoordMatrix}function or(w,l,h){let y;h?(y=[w.x,w.y,h(w.x,w.y),1],s.af(y,y,l)):(y=[w.x,w.y,0,1],ht(y,y,l));const v=y[3];return{point:new s.P(y[0]/v,y[1]/v),signedDistanceFromCamera:v}}function Te(w,l){return .5+w/l*.5}function ne(w,l){const h=w[0]/w[3],y=w[1]/w[3];return h>=-l[0]&&h<=l[0]&&y>=-l[1]&&y<=l[1]}function ce(w,l,h,y,v,k,z,D,B,G){const Q=y?w.textSizeData:w.iconSizeData,te=s.ag(Q,h.transform.zoom),me=[256/h.width*2+1,256/h.height*2+1],Se=y?w.text.dynamicLayoutVertexArray:w.icon.dynamicLayoutVertexArray;Se.clear();const ke=w.lineVertexArray,Me=y?w.text.placedSymbolArray:w.icon.placedSymbolArray,be=h.transform.width/h.transform.height;let Re=!1;for(let tt=0;tt<Me.length;tt++){const Ie=Me.get(tt);if(Ie.hidden||Ie.writingMode===s.ah.vertical&&!Re){nt(Ie.numGlyphs,Se);continue}let Ve;if(Re=!1,G?(Ve=[Ie.anchorX,Ie.anchorY,G(Ie.anchorX,Ie.anchorY),1],s.af(Ve,Ve,l)):(Ve=[Ie.anchorX,Ie.anchorY,0,1],ht(Ve,Ve,l)),!ne(Ve,me)){nt(Ie.numGlyphs,Se);continue}const rt=Te(h.transform.cameraToCenterDistance,Ve[3]),st=s.ai(Q,te,Ie),ft=z?st/rt:st*rt,Ct=new s.P(Ie.anchorX,Ie.anchorY),wt=or(Ct,v,G).point,Ft={projections:{},offsets:{}},$t=$e(Ie,ft,!1,D,l,v,k,w.glyphOffsetArray,ke,Se,wt,Ct,Ft,be,B,G);Re=$t.useVertical,($t.notEnoughRoom||Re||$t.needsFlipping&&$e(Ie,ft,!0,D,l,v,k,w.glyphOffsetArray,ke,Se,wt,Ct,Ft,be,B,G).notEnoughRoom)&&nt(Ie.numGlyphs,Se)}y?w.text.dynamicLayoutVertexBuffer.updateData(Se):w.icon.dynamicLayoutVertexBuffer.updateData(Se)}function ge(w,l,h,y,v,k,z,D,B,G,Q,te,me){const Se=D.glyphStartIndex+D.numGlyphs,ke=D.lineStartIndex,Me=D.lineStartIndex+D.lineLength,be=l.getoffsetX(D.glyphStartIndex),Re=l.getoffsetX(Se-1),tt=Je(w*be,h,y,v,k,z,D.segment,ke,Me,B,G,Q,te,me);if(!tt)return null;const Ie=Je(w*Re,h,y,v,k,z,D.segment,ke,Me,B,G,Q,te,me);return Ie?{first:tt,last:Ie}:null}function xe(w,l,h,y){return w===s.ah.horizontal&&Math.abs(h.y-l.y)>Math.abs(h.x-l.x)*y?{useVertical:!0}:(w===s.ah.vertical?l.y<h.y:l.x>h.x)?{needsFlipping:!0}:null}function $e(w,l,h,y,v,k,z,D,B,G,Q,te,me,Se,ke,Me){const be=l/24,Re=w.lineOffsetX*be,tt=w.lineOffsetY*be;let Ie;if(w.numGlyphs>1){const Ve=w.glyphStartIndex+w.numGlyphs,rt=w.lineStartIndex,st=w.lineStartIndex+w.lineLength,ft=ge(be,D,Re,tt,h,Q,te,w,B,k,me,ke,Me);if(!ft)return{notEnoughRoom:!0};const Ct=or(ft.first.point,z,Me).point,wt=or(ft.last.point,z,Me).point;if(y&&!h){const Ft=xe(w.writingMode,Ct,wt,Se);if(Ft)return Ft}Ie=[ft.first];for(let Ft=w.glyphStartIndex+1;Ft<Ve-1;Ft++)Ie.push(Je(be*D.getoffsetX(Ft),Re,tt,h,Q,te,w.segment,rt,st,B,k,me,ke,Me));Ie.push(ft.last)}else{if(y&&!h){const rt=or(te,v,Me).point,st=w.lineStartIndex+w.segment+1,ft=new s.P(B.getx(st),B.gety(st)),Ct=or(ft,v,Me),wt=Ct.signedDistanceFromCamera>0?Ct.point:Be(te,ft,rt,1,v,Me),Ft=xe(w.writingMode,rt,wt,Se);if(Ft)return Ft}const Ve=Je(be*D.getoffsetX(w.glyphStartIndex),Re,tt,h,Q,te,w.segment,w.lineStartIndex,w.lineStartIndex+w.lineLength,B,k,me,ke,Me);if(!Ve)return{notEnoughRoom:!0};Ie=[Ve]}for(const Ve of Ie)s.aj(G,Ve.point,Ve.angle);return{}}function Be(w,l,h,y,v,k){const z=or(w.add(w.sub(l)._unit()),v,k).point,D=h.sub(z);return h.add(D._mult(y/D.mag()))}function Ue(w,l){const{projectionCache:h,lineVertexArray:y,labelPlaneMatrix:v,tileAnchorPoint:k,distanceFromAnchor:z,getElevation:D,previousVertex:B,direction:G,absOffsetX:Q}=l;if(h.projections[w])return h.projections[w];const te=new s.P(y.getx(w),y.gety(w)),me=or(te,v,D);if(me.signedDistanceFromCamera>0)return h.projections[w]=me.point,me.point;const Se=w-G;return Be(z===0?k:new s.P(y.getx(Se),y.gety(Se)),te,B,Q-z+1,v,D)}function ze(w,l,h){return w._unit()._perp()._mult(l*h)}function re(w,l,h,y,v,k,z,D){const{projectionCache:B,direction:G}=D;if(B.offsets[w])return B.offsets[w];const Q=h.add(l);if(w+G<y||w+G>=v)return B.offsets[w]=Q,Q;const te=Ue(w+G,D),me=ze(te.sub(h),z,G),Se=h.add(me),ke=te.add(me);return B.offsets[w]=s.ak(k,Q,Se,ke)||Q,B.offsets[w]}function Je(w,l,h,y,v,k,z,D,B,G,Q,te,me,Se){const ke=y?w-l:w+l;let Me=ke>0?1:-1,be=0;y&&(Me*=-1,be=Math.PI),Me<0&&(be+=Math.PI);let Re,tt,Ie=Me>0?D+z:D+z+1,Ve=v,rt=v,st=0,ft=0;const Ct=Math.abs(ke),wt=[];let Ft;for(;st+ft<=Ct;){if(Ie+=Me,Ie<D||Ie>=B)return null;st+=ft,rt=Ve,tt=Re;const Bt={projectionCache:te,lineVertexArray:G,labelPlaneMatrix:Q,tileAnchorPoint:k,distanceFromAnchor:st,getElevation:Se,previousVertex:rt,direction:Me,absOffsetX:Ct};if(Ve=Ue(Ie,Bt),h===0)wt.push(rt),Ft=Ve.sub(rt);else{let gn;const Tn=Ve.sub(rt);gn=Tn.mag()===0?ze(Ue(Ie+Me,Bt).sub(Ve),h,Me):ze(Tn,h,Me),tt||(tt=rt.add(gn)),Re=re(Ie,gn,Ve,D,B,tt,h,Bt),wt.push(tt),Ft=Re.sub(tt)}ft=Ft.mag()}const $t=Ft._mult((Ct-st)/ft)._add(tt||rt),Sn=be+Math.atan2(Ve.y-rt.y,Ve.x-rt.x);return wt.push($t),{point:$t,angle:me?Sn:0,path:wt}}const et=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function nt(w,l){for(let h=0;h<w;h++){const y=l.length;l.resize(y+4),l.float32.set(et,3*y)}}function ht(w,l,h){const y=l[0],v=l[1];return w[0]=h[0]*y+h[4]*v+h[12],w[1]=h[1]*y+h[5]*v+h[13],w[3]=h[3]*y+h[7]*v+h[15],w}const Dt=100;class en{constructor(l,h=new Qt(l.width+200,l.height+200,25),y=new Qt(l.width+200,l.height+200,25)){this.transform=l,this.grid=h,this.ignoredGrid=y,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+Dt,this.screenBottomBoundary=l.height+Dt,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(l,h,y,v,k,z){const D=this.projectAndGetPerspectiveRatio(v,l.anchorPointX,l.anchorPointY,z),B=y*D.perspectiveRatio,G=l.x1*B+D.point.x,Q=l.y1*B+D.point.y,te=l.x2*B+D.point.x,me=l.y2*B+D.point.y;return!this.isInsideGrid(G,Q,te,me)||h!=="always"&&this.grid.hitTest(G,Q,te,me,h,k)||D.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[G,Q,te,me],offscreen:this.isOffscreen(G,Q,te,me)}}placeCollisionCircles(l,h,y,v,k,z,D,B,G,Q,te,me,Se,ke){const Me=[],be=new s.P(h.anchorX,h.anchorY),Re=or(be,z,ke),tt=Te(this.transform.cameraToCenterDistance,Re.signedDistanceFromCamera),Ie=(Q?k/tt:k*tt)/s.ao,Ve=or(be,D,ke).point,rt=ge(Ie,v,h.lineOffsetX*Ie,h.lineOffsetY*Ie,!1,Ve,be,h,y,D,{projections:{},offsets:{}},!1,ke);let st=!1,ft=!1,Ct=!0;if(rt){const wt=.5*me*tt+Se,Ft=new s.P(-100,-100),$t=new s.P(this.screenRightBoundary,this.screenBottomBoundary),Sn=new bt,Bt=rt.first,gn=rt.last;let Tn=[];for(let En=Bt.path.length-1;En>=1;En--)Tn.push(Bt.path[En]);for(let En=1;En<gn.path.length;En++)Tn.push(gn.path[En]);const qn=2.5*wt;if(B){const En=Tn.map(Rn=>or(Rn,B,ke));Tn=En.some(Rn=>Rn.signedDistanceFromCamera<=0)?[]:En.map(Rn=>Rn.point)}let kn=[];if(Tn.length>0){const En=Tn[0].clone(),Rn=Tn[0].clone();for(let jr=1;jr<Tn.length;jr++)En.x=Math.min(En.x,Tn[jr].x),En.y=Math.min(En.y,Tn[jr].y),Rn.x=Math.max(Rn.x,Tn[jr].x),Rn.y=Math.max(Rn.y,Tn[jr].y);kn=En.x>=Ft.x&&Rn.x<=$t.x&&En.y>=Ft.y&&Rn.y<=$t.y?[Tn]:Rn.x<Ft.x||En.x>$t.x||Rn.y<Ft.y||En.y>$t.y?[]:s.al([Tn],Ft.x,Ft.y,$t.x,$t.y)}for(const En of kn){Sn.reset(En,.25*wt);let Rn=0;Rn=Sn.length<=.5*wt?1:Math.ceil(Sn.paddedLength/qn)+1;for(let jr=0;jr<Rn;jr++){const lr=jr/Math.max(Rn-1,1),no=Sn.lerp(lr),oi=no.x+Dt,Dr=no.y+Dt;Me.push(oi,Dr,wt,0);const si=oi-wt,ro=Dr-wt,Ko=oi+wt,As=Dr+wt;if(Ct=Ct&&this.isOffscreen(si,ro,Ko,As),ft=ft||this.isInsideGrid(si,ro,Ko,As),l!=="always"&&this.grid.hitTestCircle(oi,Dr,wt,l,te)&&(st=!0,!G))return{circles:[],offscreen:!1,collisionDetected:st}}}}return{circles:!G&&st||!ft||tt<this.perspectiveRatioCutoff?[]:Me,offscreen:Ct,collisionDetected:st}}queryRenderedSymbols(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let y=1/0,v=1/0,k=-1/0,z=-1/0;for(const Q of l){const te=new s.P(Q.x+Dt,Q.y+Dt);y=Math.min(y,te.x),v=Math.min(v,te.y),k=Math.max(k,te.x),z=Math.max(z,te.y),h.push(te)}const D=this.grid.query(y,v,k,z).concat(this.ignoredGrid.query(y,v,k,z)),B={},G={};for(const Q of D){const te=Q.key;if(B[te.bucketInstanceId]===void 0&&(B[te.bucketInstanceId]={}),B[te.bucketInstanceId][te.featureIndex])continue;const me=[new s.P(Q.x1,Q.y1),new s.P(Q.x2,Q.y1),new s.P(Q.x2,Q.y2),new s.P(Q.x1,Q.y2)];s.am(h,me)&&(B[te.bucketInstanceId][te.featureIndex]=!0,G[te.bucketInstanceId]===void 0&&(G[te.bucketInstanceId]=[]),G[te.bucketInstanceId].push(te.featureIndex))}return G}insertCollisionBox(l,h,y,v,k,z){(y?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:k,collisionGroupID:z,overlapMode:h},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,h,y,v,k,z){const D=y?this.ignoredGrid:this.grid,B={bucketInstanceId:v,featureIndex:k,collisionGroupID:z,overlapMode:h};for(let G=0;G<l.length;G+=4)D.insertCircle(B,l[G],l[G+1],l[G+2])}projectAndGetPerspectiveRatio(l,h,y,v){let k;return v?(k=[h,y,v(h,y),1],s.af(k,k,l)):(k=[h,y,0,1],ht(k,k,l)),{point:new s.P((k[0]/k[3]+1)/2*this.transform.width+Dt,(-k[1]/k[3]+1)/2*this.transform.height+Dt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/k[3]*.5}}isOffscreen(l,h,y,v){return y<Dt||l>=this.screenRightBoundary||v<Dt||h>this.screenBottomBoundary}isInsideGrid(l,h,y,v){return y>=0&&l<this.gridRightBoundary&&v>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const l=s.an([]);return s.H(l,l,[-100,-100,0]),l}}function mn(w,l,h){return l*(s.W/(w.tileSize*Math.pow(2,h-w.tileID.overscaledZ)))}class Cn{constructor(l,h,y,v){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?h:-h))):v&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class Nn{constructor(l,h,y,v,k){this.text=new Cn(l?l.text:null,h,y,k),this.icon=new Cn(l?l.icon:null,h,v,k)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Mr{constructor(l,h,y){this.text=l,this.icon=h,this.skipFade=y}}class Kr{constructor(){this.invProjMatrix=s.F(),this.viewportMatrix=s.F(),this.circles=[]}}class Mn{constructor(l,h,y,v,k){this.bucketInstanceId=l,this.featureIndex=h,this.sourceLayerIndex=y,this.bucketIndex=v,this.tileID=k}}class $r{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const h=++this.maxGroupID;this.collisionGroups[l]={ID:h,predicate:y=>y.collisionGroupID===h}}return this.collisionGroups[l]}}function ii(w,l,h,y,v){const{horizontalAlign:k,verticalAlign:z}=s.at(w);return new s.P(-(k-.5)*l+y[0]*v,-(z-.5)*h+y[1]*v)}function Ei(w,l,h,y,v,k){const{x1:z,x2:D,y1:B,y2:G,anchorPointX:Q,anchorPointY:te}=w,me=new s.P(l,h);return y&&me._rotate(v?k:-k),{x1:z+me.x,y1:B+me.y,x2:D+me.x,y2:G+me.y,anchorPointX:Q,anchorPointY:te}}class Fi{constructor(l,h,y,v,k){this.transform=l.clone(),this.terrain=h,this.collisionIndex=new en(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new $r(v),this.collisionCircleArrays={},this.prevPlacement=k,k&&(k.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,h,y,v){const k=y.getBucket(h),z=y.latestFeatureIndex;if(!k||!z||h.id!==k.layerIds[0])return;const D=y.collisionBoxArray,B=k.layers[0].layout,G=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),Q=y.tileSize/s.W,te=this.transform.calculatePosMatrix(y.tileID.toUnwrapped()),me=B.get("text-pitch-alignment")==="map",Se=B.get("text-rotation-alignment")==="map",ke=mn(y,1,this.transform.zoom),Me=Jt(te,me,Se,this.transform,ke);let be=null;if(me){const tt=yr(te,me,Se,this.transform,ke);be=s.K([],this.transform.labelPlaneMatrix,tt)}this.retainedQueryData[k.bucketInstanceId]=new Mn(k.bucketInstanceId,z,k.sourceLayerIndex,k.index,y.tileID);const Re={bucket:k,layout:B,posMatrix:te,textLabelPlaneMatrix:Me,labelToScreenMatrix:be,scale:G,textPixelRatio:Q,holdingForFade:y.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:s.ag(k.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(k.sourceID)};if(v)for(const tt of k.sortKeyRanges){const{sortKey:Ie,symbolInstanceStart:Ve,symbolInstanceEnd:rt}=tt;l.push({sortKey:Ie,symbolInstanceStart:Ve,symbolInstanceEnd:rt,parameters:Re})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:k.symbolInstances.length,parameters:Re})}attemptAnchorPlacement(l,h,y,v,k,z,D,B,G,Q,te,me,Se,ke,Me,be){const Re=s.ap[l.textAnchor],tt=[l.textOffset0,l.textOffset1],Ie=ii(Re,y,v,tt,k),Ve=this.collisionIndex.placeCollisionBox(Ei(h,Ie.x,Ie.y,z,D,this.transform.angle),te,B,G,Q.predicate,be);if((!Me||this.collisionIndex.placeCollisionBox(Ei(Me,Ie.x,Ie.y,z,D,this.transform.angle),te,B,G,Q.predicate,be).box.length!==0)&&Ve.box.length>0){let rt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID]&&this.prevPlacement.placements[me.crossTileID].text&&(rt=this.prevPlacement.variableOffsets[me.crossTileID].anchor),me.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[me.crossTileID]={textOffset:tt,width:y,height:v,anchor:Re,textBoxScale:k,prevAnchor:rt},this.markUsedJustification(Se,Re,me,ke),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,ke,me),this.placedOrientations[me.crossTileID]=ke),{shift:Ie,placedGlyphBoxes:Ve}}}placeLayerBucketPart(l,h,y){const{bucket:v,layout:k,posMatrix:z,textLabelPlaneMatrix:D,labelToScreenMatrix:B,textPixelRatio:G,holdingForFade:Q,collisionBoxArray:te,partiallyEvaluatedTextSize:me,collisionGroup:Se}=l.parameters,ke=k.get("text-optional"),Me=k.get("icon-optional"),be=s.aq(k,"text-overlap","text-allow-overlap"),Re=be==="always",tt=s.aq(k,"icon-overlap","icon-allow-overlap"),Ie=tt==="always",Ve=k.get("text-rotation-alignment")==="map",rt=k.get("text-pitch-alignment")==="map",st=k.get("icon-text-fit")!=="none",ft=k.get("symbol-z-order")==="viewport-y",Ct=Re&&(Ie||!v.hasIconData()||Me),wt=Ie&&(Re||!v.hasTextData()||ke);!v.collisionArrays&&te&&v.deserializeCollisionBoxes(te);const Ft=this.retainedQueryData[v.bucketInstanceId].tileID,$t=this.terrain?(Bt,gn)=>this.terrain.getElevation(Ft,Bt,gn):null,Sn=(Bt,gn)=>{var Tn,qn;if(h[Bt.crossTileID])return;if(Q)return void(this.placements[Bt.crossTileID]=new Mr(!1,!1,!1));let kn=!1,En=!1,Rn=!0,jr=null,lr={box:null,offscreen:null},no={box:null,offscreen:null},oi=null,Dr=null,si=null,ro=0,Ko=0,As=0;gn.textFeatureIndex?ro=gn.textFeatureIndex:Bt.useRuntimeCollisionCircles&&(ro=Bt.featureIndex),gn.verticalTextFeatureIndex&&(Ko=gn.verticalTextFeatureIndex);const kl=gn.textBox;if(kl){const Yr=Jr=>{let Fr=s.ah.horizontal;if(v.allowVerticalPlacement&&!Jr&&this.prevPlacement){const go=this.prevPlacement.placedOrientations[Bt.crossTileID];go&&(this.placedOrientations[Bt.crossTileID]=go,Fr=go,this.markUsedOrientation(v,Fr,Bt))}return Fr},Rr=(Jr,Fr)=>{if(v.allowVerticalPlacement&&Bt.numVerticalGlyphVertices>0&&gn.verticalTextBox){for(const go of v.writingModes)if(go===s.ah.vertical?(lr=Fr(),no=lr):lr=Jr(),lr&&lr.box&&lr.box.length)break}else lr=Jr()},Lr=Bt.textAnchorOffsetStartIndex,mo=Bt.textAnchorOffsetEndIndex;if(mo===Lr){const Jr=(Fr,go)=>{const Qr=this.collisionIndex.placeCollisionBox(Fr,be,G,z,Se.predicate,$t);return Qr&&Qr.box&&Qr.box.length&&(this.markUsedOrientation(v,go,Bt),this.placedOrientations[Bt.crossTileID]=go),Qr};Rr(()=>Jr(kl,s.ah.horizontal),()=>{const Fr=gn.verticalTextBox;return v.allowVerticalPlacement&&Bt.numVerticalGlyphVertices>0&&Fr?Jr(Fr,s.ah.vertical):{box:null,offscreen:null}}),Yr(lr&&lr.box&&lr.box.length)}else{let Jr=s.ap[(qn=(Tn=this.prevPlacement)===null||Tn===void 0?void 0:Tn.variableOffsets[Bt.crossTileID])===null||qn===void 0?void 0:qn.anchor];const Fr=(Qr,qr,Uc)=>{const Xh=Qr.x2-Qr.x1,Xs=Qr.y2-Qr.y1,Ys=Bt.textBoxScale,Tu=st&&tt==="never"?qr:null;let zs={box:[],offscreen:!1},Vc=be==="never"?1:2,Yh="never";Jr&&Vc++;for(let qc=0;qc<Vc;qc++){for(let Hc=Lr;Hc<mo;Hc++){const Cu=v.textAnchorOffsets.get(Hc);if(Jr&&Cu.textAnchor!==Jr)continue;const Wc=this.attemptAnchorPlacement(Cu,Qr,Xh,Xs,Ys,Ve,rt,G,z,Se,Yh,Bt,v,Uc,Tu,$t);if(Wc&&(zs=Wc.placedGlyphBoxes,zs&&zs.box&&zs.box.length))return kn=!0,jr=Wc.shift,zs}Jr?Jr=null:Yh=be}return zs};Rr(()=>Fr(kl,gn.iconBox,s.ah.horizontal),()=>{const Qr=gn.verticalTextBox;return v.allowVerticalPlacement&&!(lr&&lr.box&&lr.box.length)&&Bt.numVerticalGlyphVertices>0&&Qr?Fr(Qr,gn.verticalIconBox,s.ah.vertical):{box:null,offscreen:null}}),lr&&(kn=lr.box,Rn=lr.offscreen);const go=Yr(lr&&lr.box);if(!kn&&this.prevPlacement){const Qr=this.prevPlacement.variableOffsets[Bt.crossTileID];Qr&&(this.variableOffsets[Bt.crossTileID]=Qr,this.markUsedJustification(v,Qr.anchor,Bt,go))}}}if(oi=lr,kn=oi&&oi.box&&oi.box.length>0,Rn=oi&&oi.offscreen,Bt.useRuntimeCollisionCircles){const Yr=v.text.placedSymbolArray.get(Bt.centerJustifiedTextSymbolIndex),Rr=s.ai(v.textSizeData,me,Yr),Lr=k.get("text-padding");Dr=this.collisionIndex.placeCollisionCircles(be,Yr,v.lineVertexArray,v.glyphOffsetArray,Rr,z,D,B,y,rt,Se.predicate,Bt.collisionCircleDiameter,Lr,$t),Dr.circles.length&&Dr.collisionDetected&&!y&&s.w("Collisions detected, but collision boxes are not shown"),kn=Re||Dr.circles.length>0&&!Dr.collisionDetected,Rn=Rn&&Dr.offscreen}if(gn.iconFeatureIndex&&(As=gn.iconFeatureIndex),gn.iconBox){const Yr=Rr=>{const Lr=st&&jr?Ei(Rr,jr.x,jr.y,Ve,rt,this.transform.angle):Rr;return this.collisionIndex.placeCollisionBox(Lr,tt,G,z,Se.predicate,$t)};no&&no.box&&no.box.length&&gn.verticalIconBox?(si=Yr(gn.verticalIconBox),En=si.box.length>0):(si=Yr(gn.iconBox),En=si.box.length>0),Rn=Rn&&si.offscreen}const Ps=ke||Bt.numHorizontalGlyphVertices===0&&Bt.numVerticalGlyphVertices===0,Xo=Me||Bt.numIconVertices===0;if(Ps||Xo?Xo?Ps||(En=En&&kn):kn=En&&kn:En=kn=En&&kn,kn&&oi&&oi.box&&this.collisionIndex.insertCollisionBox(oi.box,be,k.get("text-ignore-placement"),v.bucketInstanceId,no&&no.box&&Ko?Ko:ro,Se.ID),En&&si&&this.collisionIndex.insertCollisionBox(si.box,tt,k.get("icon-ignore-placement"),v.bucketInstanceId,As,Se.ID),Dr&&(kn&&this.collisionIndex.insertCollisionCircles(Dr.circles,be,k.get("text-ignore-placement"),v.bucketInstanceId,ro,Se.ID),y)){const Yr=v.bucketInstanceId;let Rr=this.collisionCircleArrays[Yr];Rr===void 0&&(Rr=this.collisionCircleArrays[Yr]=new Kr);for(let Lr=0;Lr<Dr.circles.length;Lr+=4)Rr.circles.push(Dr.circles[Lr+0]),Rr.circles.push(Dr.circles[Lr+1]),Rr.circles.push(Dr.circles[Lr+2]),Rr.circles.push(Dr.collisionDetected?1:0)}if(Bt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(v.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Bt.crossTileID]=new Mr(kn||Ct,En||wt,Rn||v.justReloaded),h[Bt.crossTileID]=!0};if(ft){if(l.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Bt=v.getSortedSymbolIndexes(this.transform.angle);for(let gn=Bt.length-1;gn>=0;--gn){const Tn=Bt[gn];Sn(v.symbolInstances.get(Tn),v.collisionArrays[Tn])}}else for(let Bt=l.symbolInstanceStart;Bt<l.symbolInstanceEnd;Bt++)Sn(v.symbolInstances.get(Bt),v.collisionArrays[Bt]);if(y&&v.bucketInstanceId in this.collisionCircleArrays){const Bt=this.collisionCircleArrays[v.bucketInstanceId];s.ar(Bt.invProjMatrix,z),Bt.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(l,h,y,v){let k;k=v===s.ah.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[s.as(h)];const z=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const D of z)D>=0&&(l.text.placedSymbolArray.get(D).crossTileID=k>=0&&D!==k?0:y.crossTileID)}markUsedOrientation(l,h,y){const v=h===s.ah.horizontal||h===s.ah.horizontalOnly?h:0,k=h===s.ah.vertical?h:0,z=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const D of z)l.text.placedSymbolArray.get(D).placedOrientation=v;y.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=k)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let y=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const v=h?h.symbolFadeChange(l):1,k=h?h.opacities:{},z=h?h.variableOffsets:{},D=h?h.placedOrientations:{};for(const B in this.placements){const G=this.placements[B],Q=k[B];Q?(this.opacities[B]=new Nn(Q,v,G.text,G.icon),y=y||G.text!==Q.text.placed||G.icon!==Q.icon.placed):(this.opacities[B]=new Nn(null,v,G.text,G.icon,G.skipFade),y=y||G.text||G.icon)}for(const B in k){const G=k[B];if(!this.opacities[B]){const Q=new Nn(G,v,!1,!1);Q.isHidden()||(this.opacities[B]=Q,y=y||G.text.placed||G.icon.placed)}}for(const B in z)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=z[B]);for(const B in D)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=D[B]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");y?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:l)}updateLayerOpacities(l,h){const y={};for(const v of h){const k=v.getBucket(l);k&&v.latestFeatureIndex&&l.id===k.layerIds[0]&&this.updateBucketOpacities(k,y,v.collisionBoxArray)}}updateBucketOpacities(l,h,y){l.hasTextData()&&(l.text.opacityVertexArray.clear(),l.text.hasVisibleVertices=!1),l.hasIconData()&&(l.icon.opacityVertexArray.clear(),l.icon.hasVisibleVertices=!1),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const v=l.layers[0],k=v.layout,z=new Nn(null,0,!1,!1,!0),D=k.get("text-allow-overlap"),B=k.get("icon-allow-overlap"),G=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Q=k.get("text-rotation-alignment")==="map",te=k.get("text-pitch-alignment")==="map",me=k.get("icon-text-fit")!=="none",Se=new Nn(null,0,D&&(B||!l.hasIconData()||k.get("icon-optional")),B&&(D||!l.hasTextData()||k.get("text-optional")),!0);!l.collisionArrays&&y&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(y);const ke=(Me,be,Re)=>{for(let tt=0;tt<be/4;tt++)Me.opacityVertexArray.emplaceBack(Re);Me.hasVisibleVertices=Me.hasVisibleVertices||Re!==tl};for(let Me=0;Me<l.symbolInstances.length;Me++){const be=l.symbolInstances.get(Me),{numHorizontalGlyphVertices:Re,numVerticalGlyphVertices:tt,crossTileID:Ie}=be;let Ve=this.opacities[Ie];h[Ie]?Ve=z:Ve||(Ve=Se,this.opacities[Ie]=Ve),h[Ie]=!0;const rt=be.numIconVertices>0,st=this.placedOrientations[be.crossTileID],ft=st===s.ah.vertical,Ct=st===s.ah.horizontal||st===s.ah.horizontalOnly;if(Re>0||tt>0){const wt=Oi(Ve.text);ke(l.text,Re,ft?tl:wt),ke(l.text,tt,Ct?tl:wt);const Ft=Ve.text.isHidden();[be.rightJustifiedTextSymbolIndex,be.centerJustifiedTextSymbolIndex,be.leftJustifiedTextSymbolIndex].forEach(Bt=>{Bt>=0&&(l.text.placedSymbolArray.get(Bt).hidden=Ft||ft?1:0)}),be.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(be.verticalPlacedTextSymbolIndex).hidden=Ft||Ct?1:0);const $t=this.variableOffsets[be.crossTileID];$t&&this.markUsedJustification(l,$t.anchor,be,st);const Sn=this.placedOrientations[be.crossTileID];Sn&&(this.markUsedJustification(l,"left",be,Sn),this.markUsedOrientation(l,Sn,be))}if(rt){const wt=Oi(Ve.icon),Ft=!(me&&be.verticalPlacedIconSymbolIndex&&ft);be.placedIconSymbolIndex>=0&&(ke(l.icon,be.numIconVertices,Ft?wt:tl),l.icon.placedSymbolArray.get(be.placedIconSymbolIndex).hidden=Ve.icon.isHidden()),be.verticalPlacedIconSymbolIndex>=0&&(ke(l.icon,be.numVerticalIconVertices,Ft?tl:wt),l.icon.placedSymbolArray.get(be.verticalPlacedIconSymbolIndex).hidden=Ve.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const wt=l.collisionArrays[Me];if(wt){let Ft=new s.P(0,0);if(wt.textBox||wt.verticalTextBox){let Sn=!0;if(G){const Bt=this.variableOffsets[Ie];Bt?(Ft=ii(Bt.anchor,Bt.width,Bt.height,Bt.textOffset,Bt.textBoxScale),Q&&Ft._rotate(te?this.transform.angle:-this.transform.angle)):Sn=!1}wt.textBox&&mi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!Sn||ft,Ft.x,Ft.y),wt.verticalTextBox&&mi(l.textCollisionBox.collisionVertexArray,Ve.text.placed,!Sn||Ct,Ft.x,Ft.y)}const $t=!!(!Ct&&wt.verticalIconBox);wt.iconBox&&mi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,$t,me?Ft.x:0,me?Ft.y:0),wt.verticalIconBox&&mi(l.iconCollisionBox.collisionVertexArray,Ve.icon.placed,!$t,me?Ft.x:0,me?Ft.y:0)}}}if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.text.opacityVertexArray.length!==l.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${l.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${l.text.layoutVertexArray.length}) / 4`);if(l.icon.opacityVertexArray.length!==l.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${l.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${l.icon.layoutVertexArray.length}) / 4`);if(l.bucketInstanceId in this.collisionCircleArrays){const Me=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Me.invProjMatrix,l.placementViewportMatrix=Me.viewportMatrix,l.collisionCircleArray=Me.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,h){const y=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*y>l}setStale(){this.stale=!0}}function mi(w,l,h,y,v){w.emplaceBack(l?1:0,h?1:0,y||0,v||0),w.emplaceBack(l?1:0,h?1:0,y||0,v||0),w.emplaceBack(l?1:0,h?1:0,y||0,v||0),w.emplaceBack(l?1:0,h?1:0,y||0,v||0)}const qo=Math.pow(2,25),dh=Math.pow(2,24),bp=Math.pow(2,17),sr=Math.pow(2,16),cc=Math.pow(2,9),fc=Math.pow(2,8),Qi=Math.pow(2,1);function Oi(w){if(w.opacity===0&&!w.placed)return 0;if(w.opacity===1&&w.placed)return 4294967295;const l=w.placed?1:0,h=Math.floor(127*w.opacity);return h*qo+l*dh+h*bp+l*sr+h*cc+l*fc+h*Qi+l}const tl=0;class ho{constructor(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&!l.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,h,y,v,k){const z=this._bucketParts;for(;this._currentTileIndex<l.length;)if(h.getBucketParts(z,v,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,k())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,z.sort((D,B)=>D.sortKey-B.sortKey));this._currentPartIndex<z.length;)if(h.placeLayerBucketPart(z[this._currentPartIndex],this._seenCrossTileIDs,y),this._currentPartIndex++,k())return!0;return!1}}class po{constructor(l,h,y,v,k,z,D,B){this.placement=new Fi(l,h,z,D,B),this._currentPlacementIndex=y.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=k,this._done=!1}isDone(){return this._done}continuePlacement(l,h,y){const v=_.now(),k=()=>!this._forceFullPlacement&&_.now()-v>2;for(;this._currentPlacementIndex>=0;){const z=h[l[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if(z.type==="symbol"&&(!z.minzoom||z.minzoom<=D)&&(!z.maxzoom||z.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new ho(z)),this._inProgressLayer.continuePlacement(y[z.source],this.placement,this._showCollisionBoxes,z,k))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const da=512/s.W/2;class Nl{constructor(l,h,y){this.tileID=l,this.bucketInstanceId=y,this._symbolsByKey={};const v=new Map;for(let k=0;k<h.length;k++){const z=h.get(k),D=z.key,B=v.get(D);B?B.push(z):v.set(D,[z])}for(const[k,z]of v){const D={positions:z.map(B=>({x:Math.floor(B.anchorX*da),y:Math.floor(B.anchorY*da)})),crossTileIDs:z.map(B=>B.crossTileID)};if(D.positions.length>128){const B=new s.au(D.positions.length,16,Uint16Array);for(const{x:G,y:Q}of D.positions)B.add(G,Q);B.finish(),delete D.positions,D.index=B}this._symbolsByKey[k]=D}}getScaledCoordinates(l,h){const{x:y,y:v,z:k}=this.tileID.canonical,{x:z,y:D,z:B}=h.canonical,G=da/Math.pow(2,B-k),Q=(D*s.W+l.anchorY)*G,te=v*s.W*da;return{x:Math.floor((z*s.W+l.anchorX)*G-y*s.W*da),y:Math.floor(Q-te)}}findMatches(l,h,y){const v=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let k=0;k<l.length;k++){const z=l.get(k);if(z.crossTileID)continue;const D=this._symbolsByKey[z.key];if(!D)continue;const B=this.getScaledCoordinates(z,h);if(D.index){const G=D.index.range(B.x-v,B.y-v,B.x+v,B.y+v).sort();for(const Q of G){const te=D.crossTileIDs[Q];if(!y[te]){y[te]=!0,z.crossTileID=te;break}}}else if(D.positions)for(let G=0;G<D.positions.length;G++){const Q=D.positions[G],te=D.crossTileIDs[G];if(Math.abs(Q.x-B.x)<=v&&Math.abs(Q.y-B.y)<=v&&!y[te]){y[te]=!0,z.crossTileID=te;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:l})=>l)}}class Xr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class nl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const h=Math.round((l-this.lng)/360);if(h!==0)for(const y in this.indexes){const v=this.indexes[y],k={};for(const z in v){const D=v[z];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+h),k[D.tileID.key]=D}this.indexes[y]=k}this.lng=l}addBucket(l,h,y){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let k=0;k<h.symbolInstances.length;k++)h.symbolInstances.get(k).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const v=this.usedCrossTileIDs[l.overscaledZ];for(const k in this.indexes){const z=this.indexes[k];if(Number(k)>l.overscaledZ)for(const D in z){const B=z[D];B.tileID.isChildOf(l)&&B.findMatches(h.symbolInstances,l,v)}else{const D=z[l.scaledTo(Number(k)).key];D&&D.findMatches(h.symbolInstances,l,v)}}for(let k=0;k<h.symbolInstances.length;k++){const z=h.symbolInstances.get(k);z.crossTileID||(z.crossTileID=y.generate(),v[z.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Nl(l,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(l,h){for(const y of h.getCrossTileIDsLists())for(const v of y)delete this.usedCrossTileIDs[l][v]}removeStaleBuckets(l){let h=!1;for(const y in this.indexes){const v=this.indexes[y];for(const k in v)l[v[k].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,v[k]),delete v[k],h=!0)}return h}}class Ts{constructor(){this.layerIndexes={},this.crossTileIDs=new Xr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,h,y){let v=this.layerIndexes[l.id];v===void 0&&(v=this.layerIndexes[l.id]=new nl);let k=!1;const z={};v.handleWrapJump(y);for(const D of h){const B=D.getBucket(l);B&&l.id===B.layerIds[0]&&(B.bucketInstanceId||(B.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(D.tileID,B,this.crossTileIDs)&&(k=!0),z[B.bucketInstanceId]=!0)}return v.removeStaleBuckets(z)&&(k=!0),k}pruneUnusedLayers(l){const h={};l.forEach(y=>{h[y]=!0});for(const y in this.layerIndexes)h[y]||delete this.layerIndexes[y]}}const zr=(w,l)=>s.t(w,l&&l.filter(h=>h.identifier!=="source.canvas")),jl=s.av();class eo extends s.E{constructor(l,h={}){super(),this._rtlPluginLoaded=()=>{for(const y in this.sourceCaches){const v=this.sourceCaches[y].getSource().type;v!=="vector"&&v!=="geojson"||this.sourceCaches[y].reload()}},this.map=l,this.dispatcher=new un(jt(),l._getMapId()),this.dispatcher.registerMessageHandler("GG",(y,v)=>this.getGlyphs(y,v)),this.dispatcher.registerMessageHandler("GI",(y,v)=>this.getImages(y,v)),this.imageManager=new ve,this.imageManager.setEventedParent(this),this.glyphManager=new Ne(l._requestManager,h.localIdeographFontFamily),this.lineAtlas=new ut(256,512),this.crossTileSymbolIndex=new Ts,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new s.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",s.ax()),xt().on(Cr,this._rtlPluginLoaded),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.sourceCaches[y.sourceId];if(!v)return;const k=v.getSource();if(k&&k.vectorLayerIds)for(const z in this._layers){const D=this._layers[z];D.source===k.id&&this._validateLayer(D)}})}loadURL(l,h={},y){this.fire(new s.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const v=this.map._requestManager.transformRequest(l,"Style");this._loadStyleRequest=new AbortController,s.h(v,this._loadStyleRequest).then(k=>{this._loadStyleRequest=null,this._load(k.data,h,y)}).catch(k=>{this._loadStyleRequest=null,k&&this.fire(new s.j(k))})}loadJSON(l,h={},y){this.fire(new s.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(l,h,y)}).catch(()=>{})}loadEmpty(){this.fire(new s.k("dataloading",{dataType:"style"})),this._load(jl,{validate:!1})}_load(l,h,y){var v;const k=h.transformStyle?h.transformStyle(y,l):l;if(!h.validate||!zr(this,s.x(k))){this._loaded=!0,this.stylesheet=k;for(const z in k.sources)this.addSource(z,k.sources[z],{validate:!1});k.sprite?this._loadSprite(k.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(k.glyphs),this._createLayers(),this.light=new Ye(this.stylesheet.light),this.map.setTerrain((v=this.stylesheet.terrain)!==null&&v!==void 0?v:null),this.fire(new s.k("data",{dataType:"style"})),this.fire(new s.k("style.load"))}}_createLayers(){const l=s.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",l),this._order=l.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of l){const y=s.az(h);y.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=y}}_loadSprite(l,h=!1,y=void 0){let v;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(k,z,D,B){return s._(this,void 0,void 0,function*(){const G=Le(k),Q=D>1?"@2x":"",te={},me={};for(const{id:Se,url:ke}of G){const Me=z.transformRequest(z.normalizeSpriteURL(ke,Q,".json"),"SpriteJSON");te[Se]=s.h(Me,B);const be=z.transformRequest(z.normalizeSpriteURL(ke,Q,".png"),"SpriteImage");me[Se]=$.getImage(be,B)}return yield Promise.all([...Object.values(te),...Object.values(me)]),function(Se,ke){return s._(this,void 0,void 0,function*(){const Me={};for(const be in Se){Me[be]={};const Re=_.getImageCanvasContext((yield ke[be]).data),tt=(yield Se[be]).data;for(const Ie in tt){const{width:Ve,height:rt,x:st,y:ft,sdf:Ct,pixelRatio:wt,stretchX:Ft,stretchY:$t,content:Sn}=tt[Ie];Me[be][Ie]={data:null,pixelRatio:wt,sdf:Ct,stretchX:Ft,stretchY:$t,content:Sn,spriteData:{width:Ve,height:rt,x:st,y:ft,context:Re}}}}return Me})}(te,me)})}(l,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(k=>{if(this._spriteRequest=null,k)for(const z in k){this._spritesImagesIds[z]=[];const D=this._spritesImagesIds[z]?this._spritesImagesIds[z].filter(B=>!(B in k)):[];for(const B of D)this.imageManager.removeImage(B),this._changedImages[B]=!0;for(const B in k[z]){const G=z==="default"?B:`${z}:${B}`;this._spritesImagesIds[z].push(G),G in this.imageManager.images?this.imageManager.updateImage(G,k[z][B],!1):this.imageManager.addImage(G,k[z][B]),h&&(this._changedImages[G]=!0)}}}).catch(k=>{this._spriteRequest=null,v=k,this.fire(new s.j(v))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"})),y&&y(v)})}_unloadSprite(){for(const l of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(l),this._changedImages[l]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}_validateLayer(l){const h=this.sourceCaches[l.source];if(!h)return;const y=l.sourceLayer;if(!y)return;const v=h.getSource();(v.type==="geojson"||v.vectorLayerIds&&v.vectorLayerIds.indexOf(y)===-1)&&this.fire(new s.j(new Error(`Source layer "${y}" does not exist on source "${v.id}" as specified by style layer "${l.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(l){const h=this._serializedAllLayers();if(!l||l.length===0)return Object.values(h);const y=[];for(const v of l)h[v]&&y.push(h[v]);return y}_serializedAllLayers(){let l=this._serializedLayers;if(l)return l;l=this._serializedLayers={};const h=Object.keys(this._layers);for(const y of h){const v=this._layers[y];v.type!=="custom"&&(l[y]=v.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(l){if(!this._loaded)return;const h=this._changed;if(h){const v=Object.keys(this._updatedLayers),k=Object.keys(this._removedLayers);(v.length||k.length)&&this._updateWorkerLayers(v,k);for(const z in this._updatedSources){const D=this._updatedSources[z];if(D==="reload")this._reloadSource(z);else{if(D!=="clear")throw new Error(`Invalid action ${D}`);this._clearSource(z)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const z in this._updatedPaintProps)this._layers[z].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}const y={};for(const v in this.sourceCaches){const k=this.sourceCaches[v];y[v]=k.used,k.used=!1}for(const v of this._order){const k=this._layers[v];k.recalculate(l,this._availableImages),!k.isHidden(l.zoom)&&k.source&&(this.sourceCaches[k.source].used=!0)}for(const v in y){const k=this.sourceCaches[v];!!y[v]!=!!k.used&&k.fire(new s.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:v}))}this.light.recalculate(l),this.z=l.zoom,h&&this.fire(new s.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const l in this.sourceCaches)this.sourceCaches[l].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(l,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(l),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(l,h={}){var y;this._checkLoaded();const v=this.serialize();if(l=h.transformStyle?h.transformStyle(v,l):l,((y=h.validate)===null||y===void 0||y)&&zr(this,s.x(l)))return!1;(l=s.aA(l)).layers=s.ay(l.layers);const k=s.aB(v,l),z=this._getOperationsToPerform(k);if(z.unimplemented.length>0)throw new Error(`Unimplemented: ${z.unimplemented.join(", ")}.`);if(z.operations.length===0)return!1;for(const D of z.operations)D();return this.stylesheet=l,this._serializedLayers=null,!0}_getOperationsToPerform(l){const h=[],y=[];for(const v of l)switch(v.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,v.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,v.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,v.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,v.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,v.args));break;case"addSource":h.push(()=>this.addSource.apply(this,v.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,v.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,v.args));break;case"setLight":h.push(()=>this.setLight.apply(this,v.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,v.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,v.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,v.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,v.args));break;case"setTransition":h.push(()=>{});break;default:y.push(v.command)}return{operations:h,unimplemented:y}}addImage(l,h){if(this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" already exists.`)));this.imageManager.addImage(l,h),this._afterImageUpdated(l)}updateImage(l,h){this.imageManager.updateImage(l,h)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){if(!this.getImage(l))return this.fire(new s.j(new Error(`An image named "${l}" does not exist.`)));this.imageManager.removeImage(l),this._afterImageUpdated(l)}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(l,h,y={}){if(this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error(`Source "${l}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(s.x.source,`sources.${l}`,h,null,y))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const v=this.sourceCaches[l]=new Bn(l,h,this.dispatcher);v.style=this,v.setEventedParent(this,()=>({isSourceLoaded:v.loaded(),source:v.serialize(),sourceId:l})),v.onAdd(this.map),this._changed=!0}removeSource(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===l)return this.fire(new s.j(new Error(`Source "${l}" cannot be removed while layer "${y}" is using it.`)));const h=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],h.fire(new s.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(l,h){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error(`There is no source with this ID=${l}`);const y=this.sourceCaches[l].getSource();if(y.type!=="geojson")throw new Error(`geojsonSource.type is ${y.type}, which is !== 'geojson`);y.setData(h),this._changed=!0}getSource(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()}addLayer(l,h,y={}){this._checkLoaded();const v=l.id;if(this.getLayer(v))return void this.fire(new s.j(new Error(`Layer "${v}" already exists on this map.`)));let k;if(l.type==="custom"){if(zr(this,s.aC(l)))return;k=s.az(l)}else{if("source"in l&&typeof l.source=="object"&&(this.addSource(v,l.source),l=s.aA(l),l=s.e(l,{source:v})),this._validate(s.x.layer,`layers.${v}`,l,{arrayIndex:-1},y))return;k=s.az(l),this._validateLayer(k),k.setEventedParent(this,{layer:{id:v}})}const z=h?this._order.indexOf(h):this._order.length;if(h&&z===-1)this.fire(new s.j(new Error(`Cannot add layer "${v}" before non-existing layer "${h}".`)));else{if(this._order.splice(z,0,v),this._layerOrderChanged=!0,this._layers[v]=k,this._removedLayers[v]&&k.source&&k.type!=="custom"){const D=this._removedLayers[v];delete this._removedLayers[v],D.type!==k.type?this._updatedSources[k.source]="clear":(this._updatedSources[k.source]="reload",this.sourceCaches[k.source].pause())}this._updateLayer(k),k.onAdd&&k.onAdd(this.map)}}moveLayer(l,h){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new s.j(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===h)return;const y=this._order.indexOf(l);this._order.splice(y,1);const v=h?this._order.indexOf(h):this._order.length;h&&v===-1?this.fire(new s.j(new Error(`Cannot move layer "${l}" before non-existing layer "${h}".`))):(this._order.splice(v,0,l),this._layerOrderChanged=!0)}removeLayer(l){this._checkLoaded();const h=this._layers[l];if(!h)return void this.fire(new s.j(new Error(`Cannot remove non-existing layer "${l}".`)));h.setEventedParent(null);const y=this._order.indexOf(l);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=h,delete this._layers[l],this._serializedLayers&&delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],h.onRemove&&h.onRemove(this.map)}getLayer(l){return this._layers[l]}getLayersOrder(){return[...this._order]}hasLayer(l){return l in this._layers}setLayerZoomRange(l,h,y){this._checkLoaded();const v=this.getLayer(l);v?v.minzoom===h&&v.maxzoom===y||(h!=null&&(v.minzoom=h),y!=null&&(v.maxzoom=y),this._updateLayer(v)):this.fire(new s.j(new Error(`Cannot set the zoom range of non-existing layer "${l}".`)))}setFilter(l,h,y={}){this._checkLoaded();const v=this.getLayer(l);if(v){if(!s.aD(v.filter,h))return h==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(s.x.filter,`layers.${v.id}.filter`,h,null,y)||(v.filter=s.aA(h),this._updateLayer(v)))}else this.fire(new s.j(new Error(`Cannot filter non-existing layer "${l}".`)))}getFilter(l){return s.aA(this.getLayer(l).filter)}setLayoutProperty(l,h,y,v={}){this._checkLoaded();const k=this.getLayer(l);k?s.aD(k.getLayoutProperty(h),y)||(k.setLayoutProperty(h,y,v),this._updateLayer(k)):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getLayoutProperty(l,h){const y=this.getLayer(l);if(y)return y.getLayoutProperty(h);this.fire(new s.j(new Error(`Cannot get style of non-existing layer "${l}".`)))}setPaintProperty(l,h,y,v={}){this._checkLoaded();const k=this.getLayer(l);k?s.aD(k.getPaintProperty(h),y)||(k.setPaintProperty(h,y,v)&&this._updateLayer(k),this._changed=!0,this._updatedPaintProps[l]=!0,this._serializedLayers=null):this.fire(new s.j(new Error(`Cannot style non-existing layer "${l}".`)))}getPaintProperty(l,h){return this.getLayer(l).getPaintProperty(h)}setFeatureState(l,h){this._checkLoaded();const y=l.source,v=l.sourceLayer,k=this.sourceCaches[y];if(k===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const z=k.getSource().type;z==="geojson"&&v?this.fire(new s.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):z!=="vector"||v?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),k.setFeatureState(v,l.id,h)):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(l,h){this._checkLoaded();const y=l.source,v=this.sourceCaches[y];if(v===void 0)return void this.fire(new s.j(new Error(`The source '${y}' does not exist in the map's style.`)));const k=v.getSource().type,z=k==="vector"?l.sourceLayer:void 0;k!=="vector"||z?h&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new s.j(new Error("A feature id is required to remove its specific state property."))):v.removeFeatureState(z,l.id,h):this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(l){this._checkLoaded();const h=l.source,y=l.sourceLayer,v=this.sourceCaches[h];if(v!==void 0)return v.getSource().type!=="vector"||y?(l.id===void 0&&this.fire(new s.j(new Error("The feature id parameter must be provided."))),v.getFeatureState(y,l.id)):void this.fire(new s.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new s.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return s.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const l=s.aE(this.sourceCaches,k=>k.serialize()),h=this._serializeByIds(this._order),y=this.map.getTerrain()||void 0,v=this.stylesheet;return s.aF({version:v.version,name:v.name,metadata:v.metadata,light:v.light,center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch,sprite:v.sprite,glyphs:v.glyphs,transition:v.transition,sources:l,layers:h,terrain:y},k=>k!==void 0)}_updateLayer(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(l){const h=z=>this._layers[z].type==="fill-extrusion",y={},v=[];for(let z=this._order.length-1;z>=0;z--){const D=this._order[z];if(h(D)){y[D]=z;for(const B of l){const G=B[D];if(G)for(const Q of G)v.push(Q)}}}v.sort((z,D)=>D.intersectionZ-z.intersectionZ);const k=[];for(let z=this._order.length-1;z>=0;z--){const D=this._order[z];if(h(D))for(let B=v.length-1;B>=0;B--){const G=v[B].feature;if(y[G.layer.id]<z)break;k.push(G),v.pop()}else for(const B of l){const G=B[D];if(G)for(const Q of G)k.push(Q.feature)}}return k}queryRenderedFeatures(l,h,y){h&&h.filter&&this._validate(s.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const v={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new s.j(new Error("parameters.layers must be an Array."))),[];for(const D of h.layers){const B=this._layers[D];if(!B)return this.fire(new s.j(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];v[B.source]=!0}}const k=[];h.availableImages=this._availableImages;const z=this._serializedAllLayers();for(const D in this.sourceCaches)h.layers&&!v[D]||k.push(pn(this.sourceCaches[D],this._layers,z,l,h,y));return this.placement&&k.push(function(D,B,G,Q,te,me,Se){const ke={},Me=me.queryRenderedSymbols(Q),be=[];for(const Re of Object.keys(Me).map(Number))be.push(Se[Re]);be.sort(yn);for(const Re of be){const tt=Re.featureIndex.lookupSymbolFeatures(Me[Re.bucketInstanceId],B,Re.bucketIndex,Re.sourceLayerIndex,te.filter,te.layers,te.availableImages,D);for(const Ie in tt){const Ve=ke[Ie]=ke[Ie]||[],rt=tt[Ie];rt.sort((st,ft)=>{const Ct=Re.featureSortOrder;if(Ct){const wt=Ct.indexOf(st.featureIndex);return Ct.indexOf(ft.featureIndex)-wt}return ft.featureIndex-st.featureIndex});for(const st of rt)Ve.push(st)}}for(const Re in ke)ke[Re].forEach(tt=>{const Ie=tt.feature,Ve=G[D[Re].source].getFeatureState(Ie.layer["source-layer"],Ie.id);Ie.source=Ie.layer.source,Ie.layer["source-layer"]&&(Ie.sourceLayer=Ie.layer["source-layer"]),Ie.state=Ve});return ke}(this._layers,z,this.sourceCaches,l,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(k)}querySourceFeatures(l,h){h&&h.filter&&this._validate(s.x.filter,"querySourceFeatures.filter",h.filter,null,h);const y=this.sourceCaches[l];return y?function(v,k){const z=v.getRenderableIds().map(G=>v.getTileByID(G)),D=[],B={};for(let G=0;G<z.length;G++){const Q=z[G],te=Q.tileID.canonical.key;B[te]||(B[te]=!0,Q.querySourceFeatures(D,k))}return D}(y,h):[]}getLight(){return this.light.getLight()}setLight(l,h={}){this._checkLoaded();const y=this.light.getLight();let v=!1;for(const z in l)if(!s.aD(l[z],y[z])){v=!0;break}if(!v)return;const k={now:_.now(),transition:s.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,h),this.light.updateTransitions(k)}_validate(l,h,y,v,k={}){return(!k||k.validate!==!1)&&zr(this,l.call(s.x,s.e({key:h,style:this.serialize(),value:y,styleSpec:s.v},v)))}_remove(l=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),xt().off(Cr,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const y=this.sourceCaches[h];y.setEventedParent(null),y.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),l&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(l)}_clearSource(l){this.sourceCaches[l].clearTiles()}_reloadSource(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()}_updateSources(l){for(const h in this.sourceCaches)this.sourceCaches[h].update(l,this.map.terrain)}_generateCollisionBoxes(){for(const l in this.sourceCaches)this._reloadSource(l)}_updatePlacement(l,h,y,v,k=!1){let z=!1,D=!1;const B={};for(const G of this._order){const Q=this._layers[G];if(Q.type!=="symbol")continue;if(!B[Q.source]){const me=this.sourceCaches[Q.source];B[Q.source]=me.getRenderableIds(!0).map(Se=>me.getTileByID(Se)).sort((Se,ke)=>ke.tileID.overscaledZ-Se.tileID.overscaledZ||(Se.tileID.isLessThan(ke.tileID)?-1:1))}const te=this.crossTileSymbolIndex.addLayer(Q,B[Q.source],l.center.lng);z=z||te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((k=k||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.now(),l.zoom))&&(this.pauseablePlacement=new po(l,this.map.terrain,this._order,k,h,y,v,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.now()),D=!0),z&&this.pauseablePlacement.placement.setStale()),D||z)for(const G of this._order){const Q=this._layers[G];Q.type==="symbol"&&this.placement.updateLayerOpacities(Q,B[Q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.now())}_releaseSymbolFadeTiles(){for(const l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,h){return s._(this,void 0,void 0,function*(){const y=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const v=this.sourceCaches[h.source];return v&&v.setDependencies(h.tileID.key,h.type,h.icons),y})}getGlyphs(l,h){return s._(this,void 0,void 0,function*(){const y=yield this.glyphManager.getGlyphs(h.stacks),v=this.sourceCaches[h.source];return v&&v.setDependencies(h.tileID.key,h.type,[""]),y})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(l,h={}){this._checkLoaded(),l&&this._validate(s.x.glyphs,"glyphs",l,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=l,this.glyphManager.entries={},this.glyphManager.setURL(l))}addSprite(l,h,y={},v){this._checkLoaded();const k=[{id:l,url:h}],z=[...Le(this.stylesheet.sprite),...k];this._validate(s.x.sprite,"sprite",z,null,y)||(this.stylesheet.sprite=z,this._loadSprite(k,!0,v))}removeSprite(l){this._checkLoaded();const h=Le(this.stylesheet.sprite);if(h.find(y=>y.id===l)){if(this._spritesImagesIds[l])for(const y of this._spritesImagesIds[l])this.imageManager.removeImage(y),this._changedImages[y]=!0;h.splice(h.findIndex(y=>y.id===l),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[l],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new s.k("data",{dataType:"style"}))}else this.fire(new s.j(new Error(`Sprite "${l}" doesn't exists on this map.`)))}getSprite(){return Le(this.stylesheet.sprite)}setSprite(l,h={},y){this._checkLoaded(),l&&this._validate(s.x.sprite,"sprite",l,null,h)||(this.stylesheet.sprite=l,l?this._loadSprite(l,!0,y):(this._unloadSprite(),y&&y(null)))}}var Ul=s.X([{name:"a_pos",type:"Int16",components:2}]),Ho="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const rl={prelude:ar(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ar(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ar(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ar(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ar("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ar(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ar(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ar("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ar("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ar("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ar(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ar(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ar(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ar(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ar(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ar(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ar(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ar(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ar(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ar(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ar(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ar(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ar(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ar(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ar("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ho),terrainDepth:ar("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ho),terrainCoords:ar("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ho)};function ar(w,l){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,y=l.match(/attribute ([\w]+) ([\w]+)/g),v=w.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),k=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),z=k?k.concat(v):v,D={};return{fragmentSource:w=w.replace(h,(B,G,Q,te,me)=>(D[me]=!0,G==="define"?`
#ifndef HAS_UNIFORM_u_${me}
varying ${Q} ${te} ${me};
#else
uniform ${Q} ${te} u_${me};
#endif
`:`
#ifdef HAS_UNIFORM_u_${me}
    ${Q} ${te} ${me} = u_${me};
#endif
`)),vertexSource:l=l.replace(h,(B,G,Q,te,me)=>{const Se=te==="float"?"vec2":"vec4",ke=me.match(/color/)?"color":Se;return D[me]?G==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
attribute ${Q} ${Se} a_${me};
varying ${Q} ${te} ${me};
#else
uniform ${Q} ${te} u_${me};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = a_${me};
#else
    ${Q} ${te} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = unpack_mix_${ke}(a_${me}, u_${me}_t);
#else
    ${Q} ${te} ${me} = u_${me};
#endif
`:G==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
attribute ${Q} ${Se} a_${me};
#else
uniform ${Q} ${te} u_${me};
#endif
`:ke==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${Q} ${te} ${me} = a_${me};
#else
    ${Q} ${te} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${Q} ${te} ${me} = unpack_mix_${ke}(a_${me}, u_${me}_t);
#else
    ${Q} ${te} ${me} = u_${me};
#endif
`}),staticAttributes:y,staticUniforms:z}}class Vl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(l,h,y,v,k,z,D,B,G){this.context=l;let Q=this.boundPaintVertexBuffers.length!==v.length;for(let te=0;!Q&&te<v.length;te++)this.boundPaintVertexBuffers[te]!==v[te]&&(Q=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==y||Q||this.boundIndexBuffer!==k||this.boundVertexOffset!==z||this.boundDynamicVertexBuffer!==D||this.boundDynamicVertexBuffer2!==B||this.boundDynamicVertexBuffer3!==G?this.freshBind(h,y,v,k,z,D,B,G):(l.bindVertexArray.set(this.vao),D&&D.bind(),k&&k.dynamicDraw&&k.bind(),B&&B.bind(),G&&G.bind())}freshBind(l,h,y,v,k,z,D,B){const G=l.numAttributes,Q=this.context,te=Q.gl;this.vao&&this.destroy(),this.vao=Q.createVertexArray(),Q.bindVertexArray.set(this.vao),this.boundProgram=l,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=v,this.boundVertexOffset=k,this.boundDynamicVertexBuffer=z,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=B,h.enableAttributes(te,l);for(const me of y)me.enableAttributes(te,l);z&&z.enableAttributes(te,l),D&&D.enableAttributes(te,l),B&&B.enableAttributes(te,l),h.bind(),h.setVertexAttribPointers(te,l,k);for(const me of y)me.bind(),me.setVertexAttribPointers(te,l,k);z&&(z.bind(),z.setVertexAttribPointers(te,l,k)),v&&v.bind(),D&&(D.bind(),D.setVertexAttribPointers(te,l,k)),B&&(B.bind(),B.setVertexAttribPointers(te,l,k)),Q.currentNumAttributes=G}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function pa(w){const l=[];for(let h=0;h<w.length;h++){if(w[h]===null)continue;const y=w[h].split(" ");l.push(y.pop())}return l}class Cs{constructor(l,h,y,v,k,z){const D=l.gl;this.program=D.createProgram();const B=pa(h.staticAttributes),G=y?y.getBinderAttributes():[],Q=B.concat(G),te=rl.prelude.staticUniforms?pa(rl.prelude.staticUniforms):[],me=h.staticUniforms?pa(h.staticUniforms):[],Se=y?y.getBinderUniforms():[],ke=te.concat(me).concat(Se),Me=[];for(const st of ke)Me.indexOf(st)<0&&Me.push(st);const be=y?y.defines():[];k&&be.push("#define OVERDRAW_INSPECTOR;"),z&&be.push("#define TERRAIN3D;");const Re=be.concat(rl.prelude.fragmentSource,h.fragmentSource).join(`
`),tt=be.concat(rl.prelude.vertexSource,h.vertexSource).join(`
`),Ie=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ie,Re),D.compileShader(Ie),!D.getShaderParameter(Ie,D.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${D.getShaderInfoLog(Ie)}`);D.attachShader(this.program,Ie);const Ve=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);if(D.shaderSource(Ve,tt),D.compileShader(Ve),!D.getShaderParameter(Ve,D.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${D.getShaderInfoLog(Ve)}`);D.attachShader(this.program,Ve),this.attributes={};const rt={};this.numAttributes=Q.length;for(let st=0;st<this.numAttributes;st++)Q[st]&&(D.bindAttribLocation(this.program,st,Q[st]),this.attributes[Q[st]]=st);if(D.linkProgram(this.program),!D.getProgramParameter(this.program,D.LINK_STATUS))throw new Error(`Program failed to link: ${D.getProgramInfoLog(this.program)}`);D.deleteShader(Ve),D.deleteShader(Ie);for(let st=0;st<Me.length;st++){const ft=Me[st];if(ft&&!rt[ft]){const Ct=D.getUniformLocation(this.program,ft);Ct&&(rt[ft]=Ct)}}this.fixedUniforms=v(l,rt),this.terrainUniforms=((st,ft)=>({u_depth:new s.aG(st,ft.u_depth),u_terrain:new s.aG(st,ft.u_terrain),u_terrain_dim:new s.aH(st,ft.u_terrain_dim),u_terrain_matrix:new s.aI(st,ft.u_terrain_matrix),u_terrain_unpack:new s.aJ(st,ft.u_terrain_unpack),u_terrain_exaggeration:new s.aH(st,ft.u_terrain_exaggeration)}))(l,rt),this.binderUniforms=y?y.getUniforms(l,rt):[]}draw(l,h,y,v,k,z,D,B,G,Q,te,me,Se,ke,Me,be,Re,tt){const Ie=l.gl;if(this.failedToCreate)return;if(l.program.set(this.program),l.setDepthMode(y),l.setStencilMode(v),l.setColorMode(k),l.setCullFace(z),B){l.activeTexture.set(Ie.TEXTURE2),Ie.bindTexture(Ie.TEXTURE_2D,B.depthTexture),l.activeTexture.set(Ie.TEXTURE3),Ie.bindTexture(Ie.TEXTURE_2D,B.texture);for(const rt in this.terrainUniforms)this.terrainUniforms[rt].set(B[rt])}for(const rt in this.fixedUniforms)this.fixedUniforms[rt].set(D[rt]);Me&&Me.setUniforms(l,this.binderUniforms,Se,{zoom:ke});let Ve=0;switch(h){case Ie.LINES:Ve=2;break;case Ie.TRIANGLES:Ve=3;break;case Ie.LINE_STRIP:Ve=1}for(const rt of me.get()){const st=rt.vaos||(rt.vaos={});(st[G]||(st[G]=new Vl)).bind(l,this,Q,Me?Me.getPaintVertexBuffers():[],te,rt.vertexOffset,be,Re,tt),Ie.drawElements(h,rt.primitiveLength*Ve,Ie.UNSIGNED_SHORT,rt.primitiveOffset*Ve*2)}}}function ql(w,l,h){const y=1/mn(h,1,l.transform.tileZoom),v=Math.pow(2,h.tileID.overscaledZ),k=h.tileSize*Math.pow(2,l.transform.tileZoom)/v,z=k*(h.tileID.canonical.x+h.tileID.wrap*v),D=k*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[y,w.fromScale,w.toScale],u_fade:w.t,u_pixel_coord_upper:[z>>16,D>>16],u_pixel_coord_lower:[65535&z,65535&D]}}const il=(w,l,h,y)=>{const v=l.style.light,k=v.properties.get("position"),z=[k.x,k.y,k.z],D=function(){var G=new s.A(9);return s.A!=Float32Array&&(G[1]=0,G[2]=0,G[3]=0,G[5]=0,G[6]=0,G[7]=0),G[0]=1,G[4]=1,G[8]=1,G}();v.properties.get("anchor")==="viewport"&&function(G,Q){var te=Math.sin(Q),me=Math.cos(Q);G[0]=me,G[1]=te,G[2]=0,G[3]=-te,G[4]=me,G[5]=0,G[6]=0,G[7]=0,G[8]=1}(D,-l.transform.angle),function(G,Q,te){var me=Q[0],Se=Q[1],ke=Q[2];G[0]=me*te[0]+Se*te[3]+ke*te[6],G[1]=me*te[1]+Se*te[4]+ke*te[7],G[2]=me*te[2]+Se*te[5]+ke*te[8]}(z,z,D);const B=v.properties.get("color");return{u_matrix:w,u_lightpos:z,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[B.r,B.g,B.b],u_vertical_gradient:+h,u_opacity:y}},wp=(w,l,h,y,v,k,z)=>s.e(il(w,l,h,y),ql(k,l,z),{u_height_factor:-Math.pow(2,v.overscaledZ)/z.tileSize/8}),ph=w=>({u_matrix:w}),Hl=(w,l,h,y)=>s.e(ph(w),ql(h,l,y)),xp=(w,l)=>({u_matrix:w,u_world:l}),mh=(w,l,h,y,v)=>s.e(Hl(w,l,h,y),{u_world:v}),kp=(w,l,h,y)=>{const v=w.transform;let k,z;if(y.paint.get("circle-pitch-alignment")==="map"){const D=mn(h,1,v.zoom);k=!0,z=[D,D]}else k=!1,z=v.pixelsToGLUnits;return{u_camera_to_center_distance:v.cameraToCenterDistance,u_scale_with_map:+(y.paint.get("circle-pitch-scale")==="map"),u_matrix:w.translatePosMatrix(l.posMatrix,h,y.paint.get("circle-translate"),y.paint.get("circle-translate-anchor")),u_pitch_with_map:+k,u_device_pixel_ratio:w.pixelRatio,u_extrude_scale:z}},gh=(w,l,h)=>{const y=mn(h,1,l.zoom),v=Math.pow(2,l.zoom-h.tileID.overscaledZ),k=h.tileID.overscaleFactor();return{u_matrix:w,u_camera_to_center_distance:l.cameraToCenterDistance,u_pixels_to_tile_units:y,u_extrude_scale:[l.pixelsToGLUnits[0]/(y*v),l.pixelsToGLUnits[1]/(y*v)],u_overscale_factor:k}},_h=(w,l,h=1)=>({u_matrix:w,u_color:l,u_overlay:0,u_overlay_scale:h}),Wl=w=>({u_matrix:w}),yh=(w,l,h,y)=>({u_matrix:w,u_extrude_scale:mn(l,1,h),u_intensity:y});function vh(w,l){const h=Math.pow(2,l.canonical.z),y=l.canonical.y;return[new s.Y(0,y/h).toLngLat().lat,new s.Y(0,(y+1)/h).toLngLat().lat]}const Gl=(w,l,h,y)=>{const v=w.transform;return{u_matrix:ol(w,l,h,y),u_ratio:1/mn(l,1,v.zoom),u_device_pixel_ratio:w.pixelRatio,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]]}},bh=(w,l,h,y,v)=>s.e(Gl(w,l,h,v),{u_image:0,u_image_height:y}),Us=(w,l,h,y,v)=>{const k=w.transform,z=to(l,k);return{u_matrix:ol(w,l,h,v),u_texsize:l.imageAtlasTexture.size,u_ratio:1/mn(l,1,k.zoom),u_device_pixel_ratio:w.pixelRatio,u_image:0,u_scale:[z,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},Zl=(w,l,h,y,v,k)=>{const z=w.lineAtlas,D=to(l,w.transform),B=h.layout.get("line-cap")==="round",G=z.getDash(y.from,B),Q=z.getDash(y.to,B),te=G.width*v.fromScale,me=Q.width*v.toScale;return s.e(Gl(w,l,h,k),{u_patternscale_a:[D/te,-G.height/2],u_patternscale_b:[D/me,-Q.height/2],u_sdfgamma:z.width/(256*Math.min(te,me)*w.pixelRatio)/2,u_image:0,u_tex_y_a:G.y,u_tex_y_b:Q.y,u_mix:v.t})};function to(w,l){return 1/mn(w,1,l.tileZoom)}function ol(w,l,h,y){return w.translatePosMatrix(y?y.posMatrix:l.tileID.posMatrix,l,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Kl=(w,l,h,y,v)=>{return{u_matrix:w,u_tl_parent:l,u_scale_parent:h,u_buffer_scale:1,u_fade_t:y.mix,u_opacity:y.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(z=v.paint.get("raster-saturation"),z>0?1-1/(1.001-z):-z),u_contrast_factor:(k=v.paint.get("raster-contrast"),k>0?1/(1-k):1+k),u_spin_weights:sl(v.paint.get("raster-hue-rotate"))};var k,z};function sl(w){w*=Math.PI/180;const l=Math.sin(w),h=Math.cos(w);return[(2*h+1)/3,(-Math.sqrt(3)*l-h+1)/3,(Math.sqrt(3)*l-h+1)/3]}const al=(w,l,h,y,v,k,z,D,B,G)=>{const Q=v.transform;return{u_is_size_zoom_constant:+(w==="constant"||w==="source"),u_is_size_feature_constant:+(w==="constant"||w==="camera"),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_pitch:Q.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Q.width/Q.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:k,u_label_plane_matrix:z,u_coord_matrix:D,u_is_text:+B,u_pitch_with_map:+y,u_texsize:G,u_texture:0}},ll=(w,l,h,y,v,k,z,D,B,G,Q)=>{const te=v.transform;return s.e(al(w,l,h,y,v,k,z,D,B,G),{u_gamma_scale:y?Math.cos(te._pitch)*te.cameraToCenterDistance:1,u_device_pixel_ratio:v.pixelRatio,u_is_halo:+Q})},ul=(w,l,h,y,v,k,z,D,B,G)=>s.e(ll(w,l,h,y,v,k,z,D,!0,B,!0),{u_texsize_icon:G,u_texture_icon:1}),Sp=(w,l,h)=>({u_matrix:w,u_opacity:l,u_color:h}),Tp=(w,l,h,y,v,k)=>s.e(function(z,D,B,G){const Q=B.imageManager.getPattern(z.from.toString()),te=B.imageManager.getPattern(z.to.toString()),{width:me,height:Se}=B.imageManager.getPixelSize(),ke=Math.pow(2,G.tileID.overscaledZ),Me=G.tileSize*Math.pow(2,B.transform.tileZoom)/ke,be=Me*(G.tileID.canonical.x+G.tileID.wrap*ke),Re=Me*G.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:Q.tl,u_pattern_br_a:Q.br,u_pattern_tl_b:te.tl,u_pattern_br_b:te.br,u_texsize:[me,Se],u_mix:D.t,u_pattern_size_a:Q.displaySize,u_pattern_size_b:te.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/mn(G,1,B.transform.tileZoom),u_pixel_coord_upper:[be>>16,Re>>16],u_pixel_coord_lower:[65535&be,65535&Re]}}(y,k,h,v),{u_matrix:w,u_opacity:l}),wh={fillExtrusion:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_opacity:new s.aH(w,l.u_opacity)}),fillExtrusionPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_lightpos:new s.aK(w,l.u_lightpos),u_lightintensity:new s.aH(w,l.u_lightintensity),u_lightcolor:new s.aK(w,l.u_lightcolor),u_vertical_gradient:new s.aH(w,l.u_vertical_gradient),u_height_factor:new s.aH(w,l.u_height_factor),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade),u_opacity:new s.aH(w,l.u_opacity)}),fill:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),fillPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),fillOutline:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world)}),fillOutlinePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_texsize:new s.aL(w,l.u_texsize),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),circle:(w,l)=>({u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_scale_with_map:new s.aG(w,l.u_scale_with_map),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_matrix:new s.aI(w,l.u_matrix)}),collisionBox:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pixels_to_tile_units:new s.aH(w,l.u_pixels_to_tile_units),u_extrude_scale:new s.aL(w,l.u_extrude_scale),u_overscale_factor:new s.aH(w,l.u_overscale_factor)}),collisionCircle:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_inv_matrix:new s.aI(w,l.u_inv_matrix),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_viewport_size:new s.aL(w,l.u_viewport_size)}),debug:(w,l)=>({u_color:new s.aM(w,l.u_color),u_matrix:new s.aI(w,l.u_matrix),u_overlay:new s.aG(w,l.u_overlay),u_overlay_scale:new s.aH(w,l.u_overlay_scale)}),clippingMask:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix)}),heatmap:(w,l)=>({u_extrude_scale:new s.aH(w,l.u_extrude_scale),u_intensity:new s.aH(w,l.u_intensity),u_matrix:new s.aI(w,l.u_matrix)}),heatmapTexture:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_world:new s.aL(w,l.u_world),u_image:new s.aG(w,l.u_image),u_color_ramp:new s.aG(w,l.u_color_ramp),u_opacity:new s.aH(w,l.u_opacity)}),hillshade:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_latrange:new s.aL(w,l.u_latrange),u_light:new s.aL(w,l.u_light),u_shadow:new s.aM(w,l.u_shadow),u_highlight:new s.aM(w,l.u_highlight),u_accent:new s.aM(w,l.u_accent)}),hillshadePrepare:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_image:new s.aG(w,l.u_image),u_dimension:new s.aL(w,l.u_dimension),u_zoom:new s.aH(w,l.u_zoom),u_unpack:new s.aJ(w,l.u_unpack)}),line:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels)}),lineGradient:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_image:new s.aG(w,l.u_image),u_image_height:new s.aH(w,l.u_image_height)}),linePattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texsize:new s.aL(w,l.u_texsize),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_image:new s.aG(w,l.u_image),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_scale:new s.aK(w,l.u_scale),u_fade:new s.aH(w,l.u_fade)}),lineSDF:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ratio:new s.aH(w,l.u_ratio),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_units_to_pixels:new s.aL(w,l.u_units_to_pixels),u_patternscale_a:new s.aL(w,l.u_patternscale_a),u_patternscale_b:new s.aL(w,l.u_patternscale_b),u_sdfgamma:new s.aH(w,l.u_sdfgamma),u_image:new s.aG(w,l.u_image),u_tex_y_a:new s.aH(w,l.u_tex_y_a),u_tex_y_b:new s.aH(w,l.u_tex_y_b),u_mix:new s.aH(w,l.u_mix)}),raster:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_tl_parent:new s.aL(w,l.u_tl_parent),u_scale_parent:new s.aH(w,l.u_scale_parent),u_buffer_scale:new s.aH(w,l.u_buffer_scale),u_fade_t:new s.aH(w,l.u_fade_t),u_opacity:new s.aH(w,l.u_opacity),u_image0:new s.aG(w,l.u_image0),u_image1:new s.aG(w,l.u_image1),u_brightness_low:new s.aH(w,l.u_brightness_low),u_brightness_high:new s.aH(w,l.u_brightness_high),u_saturation_factor:new s.aH(w,l.u_saturation_factor),u_contrast_factor:new s.aH(w,l.u_contrast_factor),u_spin_weights:new s.aK(w,l.u_spin_weights)}),symbolIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture)}),symbolSDF:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texture:new s.aG(w,l.u_texture),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),symbolTextAndIcon:(w,l)=>({u_is_size_zoom_constant:new s.aG(w,l.u_is_size_zoom_constant),u_is_size_feature_constant:new s.aG(w,l.u_is_size_feature_constant),u_size_t:new s.aH(w,l.u_size_t),u_size:new s.aH(w,l.u_size),u_camera_to_center_distance:new s.aH(w,l.u_camera_to_center_distance),u_pitch:new s.aH(w,l.u_pitch),u_rotate_symbol:new s.aG(w,l.u_rotate_symbol),u_aspect_ratio:new s.aH(w,l.u_aspect_ratio),u_fade_change:new s.aH(w,l.u_fade_change),u_matrix:new s.aI(w,l.u_matrix),u_label_plane_matrix:new s.aI(w,l.u_label_plane_matrix),u_coord_matrix:new s.aI(w,l.u_coord_matrix),u_is_text:new s.aG(w,l.u_is_text),u_pitch_with_map:new s.aG(w,l.u_pitch_with_map),u_texsize:new s.aL(w,l.u_texsize),u_texsize_icon:new s.aL(w,l.u_texsize_icon),u_texture:new s.aG(w,l.u_texture),u_texture_icon:new s.aG(w,l.u_texture_icon),u_gamma_scale:new s.aH(w,l.u_gamma_scale),u_device_pixel_ratio:new s.aH(w,l.u_device_pixel_ratio),u_is_halo:new s.aG(w,l.u_is_halo)}),background:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_color:new s.aM(w,l.u_color)}),backgroundPattern:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_opacity:new s.aH(w,l.u_opacity),u_image:new s.aG(w,l.u_image),u_pattern_tl_a:new s.aL(w,l.u_pattern_tl_a),u_pattern_br_a:new s.aL(w,l.u_pattern_br_a),u_pattern_tl_b:new s.aL(w,l.u_pattern_tl_b),u_pattern_br_b:new s.aL(w,l.u_pattern_br_b),u_texsize:new s.aL(w,l.u_texsize),u_mix:new s.aH(w,l.u_mix),u_pattern_size_a:new s.aL(w,l.u_pattern_size_a),u_pattern_size_b:new s.aL(w,l.u_pattern_size_b),u_scale_a:new s.aH(w,l.u_scale_a),u_scale_b:new s.aH(w,l.u_scale_b),u_pixel_coord_upper:new s.aL(w,l.u_pixel_coord_upper),u_pixel_coord_lower:new s.aL(w,l.u_pixel_coord_lower),u_tile_units_to_pixels:new s.aH(w,l.u_tile_units_to_pixels)}),terrain:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainDepth:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_ele_delta:new s.aH(w,l.u_ele_delta)}),terrainCoords:(w,l)=>({u_matrix:new s.aI(w,l.u_matrix),u_texture:new s.aG(w,l.u_texture),u_terrain_coords_id:new s.aH(w,l.u_terrain_coords_id),u_ele_delta:new s.aH(w,l.u_ele_delta)})};class Cp{constructor(l,h,y){this.context=l;const v=l.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Vs={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Xl{constructor(l,h,y,v){this.length=h.length,this.attributes=y,this.itemSize=h.bytesPerElement,this.dynamicDraw=v,this.context=l;const k=l.gl;this.buffer=k.createBuffer(),l.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){if(l.length!==this.length)throw new Error(`Length of new data is ${l.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,h){for(let y=0;y<this.attributes.length;y++){const v=h.attributes[this.attributes[y].name];v!==void 0&&l.enableVertexAttribArray(v)}}setVertexAttribPointers(l,h,y){for(let v=0;v<this.attributes.length;v++){const k=this.attributes[v],z=h.attributes[k.name];z!==void 0&&l.vertexAttribPointer(z,k.components,l[Vs[k.type]],!1,this.itemSize,k.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Li=new WeakMap;function ki(w){var l;if(Li.has(w))return Li.get(w);{const h=(l=w.getParameter(w.VERSION))===null||l===void 0?void 0:l.startsWith("WebGL 2.0");return Li.set(w,h),h}}class Yn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Yl extends Yn{getDefault(){return s.aO.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Jl extends Yn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class hc extends Yn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class dc extends Yn{getDefault(){return[!0,!0,!0,!0]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Ql extends Yn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class pc extends Yn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class mc extends Yn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class eu extends Yn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class xh extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}}class kh extends Yn{getDefault(){return[0,1]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class ma extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}}class Mp extends Yn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class Ep extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}}class Lp extends Yn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Ip extends Yn{getDefault(){return s.aO.transparent}set(l){const h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class Ap extends Yn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class Pp extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}}class gc extends Yn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class tu extends Yn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class _c extends Yn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class yc extends Yn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class ga extends Yn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Sh extends Yn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class Th extends Yn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class vc extends Yn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class qs extends Yn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ch extends Yn{getDefault(){return null}set(l){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class _a extends Yn{getDefault(){return null}set(l){var h;if(l===this.current&&!this.dirty)return;const y=this.gl;ki(y)?y.bindVertexArray(l):(h=y.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(l),this.current=l,this.dirty=!1}}class ya extends Yn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class Mh extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class bc extends Yn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class Gn extends Yn{constructor(l,h){super(l),this.context=l,this.parent=h}getDefault(){return null}}class nu extends Gn{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class zp extends Gn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Eh extends Gn{set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class cl{constructor(l,h,y,v,k){this.context=l,this.width=h,this.height=y;const z=l.gl,D=this.framebuffer=z.createFramebuffer();if(this.colorAttachment=new nu(l,D),v)this.depthAttachment=k?new Eh(l,D):new zp(l,D);else if(k)throw new Error("Stencil cannot be set without depth");if(z.checkFramebufferStatus(z.FRAMEBUFFER)!==z.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const l=this.context.gl,h=this.colorAttachment.get();if(h&&l.deleteTexture(h),this.depthAttachment){const y=this.depthAttachment.get();y&&l.deleteRenderbuffer(y)}l.deleteFramebuffer(this.framebuffer)}}class Wr{constructor(l,h,y){this.blendFunction=l,this.blendColor=h,this.mask=y}}Wr.Replace=[1,0],Wr.disabled=new Wr(Wr.Replace,s.aO.transparent,[!1,!1,!1,!1]),Wr.unblended=new Wr(Wr.Replace,s.aO.transparent,[!0,!0,!0,!0]),Wr.alphaBlended=new Wr([1,771],s.aO.transparent,[!0,!0,!0,!0]);class Dp{constructor(l){var h,y;if(this.gl=l,this.clearColor=new Yl(this),this.clearDepth=new Jl(this),this.clearStencil=new hc(this),this.colorMask=new dc(this),this.depthMask=new Ql(this),this.stencilMask=new pc(this),this.stencilFunc=new mc(this),this.stencilOp=new eu(this),this.stencilTest=new xh(this),this.depthRange=new kh(this),this.depthTest=new ma(this),this.depthFunc=new Mp(this),this.blend=new Ep(this),this.blendFunc=new Lp(this),this.blendColor=new Ip(this),this.blendEquation=new Ap(this),this.cullFace=new Pp(this),this.cullFaceSide=new gc(this),this.frontFace=new tu(this),this.program=new _c(this),this.activeTexture=new yc(this),this.viewport=new ga(this),this.bindFramebuffer=new Sh(this),this.bindRenderbuffer=new Th(this),this.bindTexture=new vc(this),this.bindVertexBuffer=new qs(this),this.bindElementBuffer=new Ch(this),this.bindVertexArray=new _a(this),this.pixelStoreUnpack=new ya(this),this.pixelStoreUnpackPremultiplyAlpha=new Mh(this),this.pixelStoreUnpackFlipY=new bc(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE),ki(l)){this.HALF_FLOAT=l.HALF_FLOAT;const v=l.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=l.RGBA16F)!==null&&h!==void 0?h:v==null?void 0:v.RGBA16F_EXT,this.RGB16F=(y=l.RGB16F)!==null&&y!==void 0?y:v==null?void 0:v.RGB16F_EXT,l.getExtension("EXT_color_buffer_float")}else{l.getExtension("EXT_color_buffer_half_float"),l.getExtension("OES_texture_half_float_linear");const v=l.getExtension("OES_texture_half_float");this.HALF_FLOAT=v==null?void 0:v.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,h){return new Cp(this,l,h)}createVertexBuffer(l,h,y){return new Xl(this,l,h,y)}createRenderbuffer(l,h,y){const v=this.gl,k=v.createRenderbuffer();return this.bindRenderbuffer.set(k),v.renderbufferStorage(v.RENDERBUFFER,l,h,y),this.bindRenderbuffer.set(null),k}createFramebuffer(l,h,y,v){return new cl(this,l,h,y,v)}clear({color:l,depth:h,stencil:y}){const v=this.gl;let k=0;l&&(k|=v.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(k|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),y!==void 0&&(k|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),v.clear(k)}setCullFace(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){s.aD(l.blendFunction,Wr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}createVertexArray(){var l;return ki(this.gl)?this.gl.createVertexArray():(l=this.gl.getExtension("OES_vertex_array_object"))===null||l===void 0?void 0:l.createVertexArrayOES()}deleteVertexArray(l){var h;return ki(this.gl)?this.gl.deleteVertexArray(l):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(l)}unbindVAO(){this.bindVertexArray.set(null)}}class Vn{constructor(l,h,y){this.func=l,this.mask=h,this.range=y}}Vn.ReadOnly=!1,Vn.ReadWrite=!0,Vn.disabled=new Vn(519,Vn.ReadOnly,[0,1]);const wc=7680;class br{constructor(l,h,y,v,k,z){this.test=l,this.ref=h,this.mask=y,this.fail=v,this.depthFail=k,this.pass=z}}br.disabled=new br({func:519,mask:0},0,0,wc,wc,wc);class pr{constructor(l,h,y){this.enable=l,this.mode=h,this.frontFace=y}}let Hs;function ru(w,l,h,y,v,k,z){const D=w.context,B=D.gl,G=w.useProgram("collisionBox"),Q=[];let te=0,me=0;for(let Ie=0;Ie<y.length;Ie++){const Ve=y[Ie],rt=l.getTile(Ve),st=rt.getBucket(h);if(!st)continue;let ft=Ve.posMatrix;v[0]===0&&v[1]===0||(ft=w.translatePosMatrix(Ve.posMatrix,rt,v,k));const Ct=z?st.textCollisionBox:st.iconCollisionBox,wt=st.collisionCircleArray;if(wt.length>0){const Ft=s.F(),$t=ft;s.aP(Ft,st.placementInvProjMatrix,w.transform.glCoordMatrix),s.aP(Ft,Ft,st.placementViewportMatrix),Q.push({circleArray:wt,circleOffset:me,transform:$t,invTransform:Ft,coord:Ve}),te+=wt.length/4,me=te}Ct&&G.draw(D,B.LINES,Vn.disabled,br.disabled,w.colorModeForRenderPass(),pr.disabled,gh(ft,w.transform,rt),w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ve),h.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,null,w.transform.zoom,null,null,Ct.collisionVertexBuffer)}if(!z||!Q.length)return;const Se=w.useProgram("collisionCircle"),ke=new s.aQ;ke.resize(4*te),ke._trim();let Me=0;for(const Ie of Q)for(let Ve=0;Ve<Ie.circleArray.length/4;Ve++){const rt=4*Ve,st=Ie.circleArray[rt+0],ft=Ie.circleArray[rt+1],Ct=Ie.circleArray[rt+2],wt=Ie.circleArray[rt+3];ke.emplace(Me++,st,ft,Ct,wt,0),ke.emplace(Me++,st,ft,Ct,wt,1),ke.emplace(Me++,st,ft,Ct,wt,2),ke.emplace(Me++,st,ft,Ct,wt,3)}(!Hs||Hs.length<2*te)&&(Hs=function(Ie){const Ve=2*Ie,rt=new s.aS;rt.resize(Ve),rt._trim();for(let st=0;st<Ve;st++){const ft=6*st;rt.uint16[ft+0]=4*st+0,rt.uint16[ft+1]=4*st+1,rt.uint16[ft+2]=4*st+2,rt.uint16[ft+3]=4*st+2,rt.uint16[ft+4]=4*st+3,rt.uint16[ft+5]=4*st+0}return rt}(te));const be=D.createIndexBuffer(Hs,!0),Re=D.createVertexBuffer(ke,s.aR.members,!0);for(const Ie of Q){const Ve={u_matrix:Ie.transform,u_inv_matrix:Ie.invTransform,u_camera_to_center_distance:(tt=w.transform).cameraToCenterDistance,u_viewport_size:[tt.width,tt.height]};Se.draw(D,B.TRIANGLES,Vn.disabled,br.disabled,w.colorModeForRenderPass(),pr.disabled,Ve,w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ie.coord),h.id,Re,be,s.$.simpleSegment(0,2*Ie.circleOffset,Ie.circleArray.length,Ie.circleArray.length/2),null,w.transform.zoom,null,null,null)}var tt;Re.destroy(),be.destroy()}pr.disabled=new pr(!1,1029,2305),pr.backCCW=new pr(!0,1029,2305);const xc=s.an(new Float32Array(16));function Lh(w,l,h,y,v,k){const{horizontalAlign:z,verticalAlign:D}=s.at(w);return new s.P((-(z-.5)*l/v+y[0])*k,(-(D-.5)*h/v+y[1])*k)}function iu(w,l,h,y,v,k,z,D,B,G,Q){const te=w.text.placedSymbolArray,me=w.text.dynamicLayoutVertexArray,Se=w.icon.dynamicLayoutVertexArray,ke={};me.clear();for(let Me=0;Me<te.length;Me++){const be=te.get(Me),Re=be.hidden||!be.crossTileID||w.allowVerticalPlacement&&!be.placedOrientation?null:y[be.crossTileID];if(Re){const tt=new s.P(be.anchorX,be.anchorY),Ie=or(tt,h?z:k,Q),Ve=Te(v.cameraToCenterDistance,Ie.signedDistanceFromCamera);let rt=s.ai(w.textSizeData,B,be)*Ve/s.ao;h&&(rt*=w.tilePixelRatio/D);const{width:st,height:ft,anchor:Ct,textOffset:wt,textBoxScale:Ft}=Re,$t=Lh(Ct,st,ft,wt,Ft,rt),Sn=h?or(tt.add($t),k,Q).point:Ie.point.add(l?$t.rotate(-v.angle):$t),Bt=w.allowVerticalPlacement&&be.placedOrientation===s.ah.vertical?Math.PI/2:0;for(let gn=0;gn<be.numGlyphs;gn++)s.aj(me,Sn,Bt);G&&be.associatedIconIndex>=0&&(ke[be.associatedIconIndex]={shiftedAnchor:Sn,angle:Bt})}else nt(be.numGlyphs,me)}if(G){Se.clear();const Me=w.icon.placedSymbolArray;for(let be=0;be<Me.length;be++){const Re=Me.get(be);if(Re.hidden)nt(Re.numGlyphs,Se);else{const tt=ke[be];if(tt)for(let Ie=0;Ie<Re.numGlyphs;Ie++)s.aj(Se,tt.shiftedAnchor,tt.angle);else nt(Re.numGlyphs,Se)}}w.icon.dynamicLayoutVertexBuffer.updateData(Se)}w.text.dynamicLayoutVertexBuffer.updateData(me)}function ou(w,l,h){return h.iconsInText&&l?"symbolTextAndIcon":w?"symbolSDF":"symbolIcon"}function su(w,l,h,y,v,k,z,D,B,G,Q,te){const me=w.context,Se=me.gl,ke=w.transform,Me=D==="map",be=B==="map",Re=D!=="viewport"&&h.layout.get("symbol-placement")!=="point",tt=Me&&!be&&!Re,Ie=!h.layout.get("symbol-sort-key").isConstant();let Ve=!1;const rt=w.depthModeForSublayer(0,Vn.ReadOnly),st=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ft=[];for(const Ct of y){const wt=l.getTile(Ct),Ft=wt.getBucket(h);if(!Ft)continue;const $t=v?Ft.text:Ft.icon;if(!$t||!$t.segments.get().length||!$t.hasVisibleVertices)continue;const Sn=$t.programConfigurations.get(h.id),Bt=v||Ft.sdfIcons,gn=v?Ft.textSizeData:Ft.iconSizeData,Tn=be||ke.pitch!==0,qn=w.useProgram(ou(Bt,v,Ft),Sn),kn=s.ag(gn,ke.zoom),En=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Ct);let Rn,jr,lr,no,oi=[0,0],Dr=null;if(v)jr=wt.glyphAtlasTexture,lr=Se.LINEAR,Rn=wt.glyphAtlasTexture.size,Ft.iconsInText&&(oi=wt.imageAtlasTexture.size,Dr=wt.imageAtlasTexture,no=Tn||w.options.rotating||w.options.zooming||gn.kind==="composite"||gn.kind==="camera"?Se.LINEAR:Se.NEAREST);else{const Jr=h.layout.get("icon-size").constantOr(0)!==1||Ft.iconsNeedLinear;jr=wt.imageAtlasTexture,lr=Bt||w.options.rotating||w.options.zooming||Jr||Tn?Se.LINEAR:Se.NEAREST,Rn=wt.imageAtlasTexture.size}const si=mn(wt,1,w.transform.zoom),ro=Jt(Ct.posMatrix,be,Me,w.transform,si),Ko=yr(Ct.posMatrix,be,Me,w.transform,si),As=st&&Ft.hasTextData(),kl=h.layout.get("icon-text-fit")!=="none"&&As&&Ft.hasIconData();if(Re){const Jr=w.style.map.terrain?(go,Qr)=>w.style.map.terrain.getElevation(Ct,go,Qr):null,Fr=h.layout.get("text-rotation-alignment")==="map";ce(Ft,Ct.posMatrix,w,v,ro,Ko,be,G,Fr,Jr)}const Ps=w.translatePosMatrix(Ct.posMatrix,wt,k,z),Xo=Re||v&&st||kl?xc:ro,Yr=w.translatePosMatrix(Ko,wt,k,z,!0),Rr=Bt&&h.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Lr;Lr=Bt?Ft.iconsInText?ul(gn.kind,kn,tt,be,w,Ps,Xo,Yr,Rn,oi):ll(gn.kind,kn,tt,be,w,Ps,Xo,Yr,v,Rn,!0):al(gn.kind,kn,tt,be,w,Ps,Xo,Yr,v,Rn);const mo={program:qn,buffers:$t,uniformValues:Lr,atlasTexture:jr,atlasTextureIcon:Dr,atlasInterpolation:lr,atlasInterpolationIcon:no,isSDF:Bt,hasHalo:Rr};if(Ie&&Ft.canOverlap){Ve=!0;const Jr=$t.segments.get();for(const Fr of Jr)ft.push({segments:new s.$([Fr]),sortKey:Fr.sortKey,state:mo,terrainData:En})}else ft.push({segments:$t.segments,sortKey:0,state:mo,terrainData:En})}Ve&&ft.sort((Ct,wt)=>Ct.sortKey-wt.sortKey);for(const Ct of ft){const wt=Ct.state;if(me.activeTexture.set(Se.TEXTURE0),wt.atlasTexture.bind(wt.atlasInterpolation,Se.CLAMP_TO_EDGE),wt.atlasTextureIcon&&(me.activeTexture.set(Se.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,Se.CLAMP_TO_EDGE)),wt.isSDF){const Ft=wt.uniformValues;wt.hasHalo&&(Ft.u_is_halo=1,Ih(wt.buffers,Ct.segments,h,w,wt.program,rt,Q,te,Ft,Ct.terrainData)),Ft.u_is_halo=0}Ih(wt.buffers,Ct.segments,h,w,wt.program,rt,Q,te,wt.uniformValues,Ct.terrainData)}}function Ih(w,l,h,y,v,k,z,D,B,G){const Q=y.context;v.draw(Q,Q.gl.TRIANGLES,k,z,D,pr.disabled,B,G,h.id,w.layoutVertexBuffer,w.indexBuffer,l,h.paint,y.transform.zoom,w.programConfigurations.get(h.id),w.dynamicLayoutVertexBuffer,w.opacityVertexBuffer)}function au(w,l,h,y,v){if(!h||!y||!y.imageAtlas)return;const k=y.imageAtlas.patternPositions;let z=k[h.to.toString()],D=k[h.from.toString()];if(!z&&D&&(z=D),!D&&z&&(D=z),!z||!D){const B=v.getPaintProperty(l);z=k[B],D=k[B]}z&&D&&w.setConstantPatternPositions(z,D)}function Ah(w,l,h,y,v,k,z){const D=w.context.gl,B="fill-pattern",G=h.paint.get(B),Q=G&&G.constantOr(1),te=h.getCrossfadeParameters();let me,Se,ke,Me,be;z?(Se=Q&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",me=D.LINES):(Se=Q?"fillPattern":"fill",me=D.TRIANGLES);const Re=G.constantOr(null);for(const tt of y){const Ie=l.getTile(tt);if(Q&&!Ie.patternsLoaded())continue;const Ve=Ie.getBucket(h);if(!Ve)continue;const rt=Ve.programConfigurations.get(h.id),st=w.useProgram(Se,rt),ft=w.style.map.terrain&&w.style.map.terrain.getTerrainData(tt);Q&&(w.context.activeTexture.set(D.TEXTURE0),Ie.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),rt.updatePaintBuffers(te)),au(rt,B,Re,Ie,h);const Ct=ft?tt:null,wt=w.translatePosMatrix(Ct?Ct.posMatrix:tt.posMatrix,Ie,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(z){Me=Ve.indexBuffer2,be=Ve.segments2;const Ft=[D.drawingBufferWidth,D.drawingBufferHeight];ke=Se==="fillOutlinePattern"&&Q?mh(wt,w,te,Ie,Ft):xp(wt,Ft)}else Me=Ve.indexBuffer,be=Ve.segments,ke=Q?Hl(wt,w,te,Ie):ph(wt);st.draw(w.context,me,v,w.stencilModeForClipping(tt),k,pr.disabled,ke,ft,h.id,Ve.layoutVertexBuffer,Me,be,h.paint,w.transform.zoom,rt)}}function lu(w,l,h,y,v,k,z){const D=w.context,B=D.gl,G="fill-extrusion-pattern",Q=h.paint.get(G),te=Q.constantOr(1),me=h.getCrossfadeParameters(),Se=h.paint.get("fill-extrusion-opacity"),ke=Q.constantOr(null);for(const Me of y){const be=l.getTile(Me),Re=be.getBucket(h);if(!Re)continue;const tt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(Me),Ie=Re.programConfigurations.get(h.id),Ve=w.useProgram(te?"fillExtrusionPattern":"fillExtrusion",Ie);te&&(w.context.activeTexture.set(B.TEXTURE0),be.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Ie.updatePaintBuffers(me)),au(Ie,G,ke,be,h);const rt=w.translatePosMatrix(Me.posMatrix,be,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),st=h.paint.get("fill-extrusion-vertical-gradient"),ft=te?wp(rt,w,st,Se,Me,me,be):il(rt,w,st,Se);Ve.draw(D,D.gl.TRIANGLES,v,k,z,pr.backCCW,ft,tt,h.id,Re.layoutVertexBuffer,Re.indexBuffer,Re.segments,h.paint,w.transform.zoom,Ie,w.style.map.terrain&&Re.centroidVertexBuffer)}}function uu(w,l,h,y,v,k,z){const D=w.context,B=D.gl,G=h.fbo;if(!G)return;const Q=w.useProgram("hillshade"),te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(l);D.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,G.colorAttachment.get()),Q.draw(D,B.TRIANGLES,v,k,z,pr.disabled,((me,Se,ke,Me)=>{const be=ke.paint.get("hillshade-shadow-color"),Re=ke.paint.get("hillshade-highlight-color"),tt=ke.paint.get("hillshade-accent-color");let Ie=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ie-=me.transform.angle);const Ve=!me.options.moving;return{u_matrix:Me?Me.posMatrix:me.transform.calculatePosMatrix(Se.tileID.toUnwrapped(),Ve),u_image:0,u_latrange:vh(0,Se.tileID),u_light:[ke.paint.get("hillshade-exaggeration"),Ie],u_shadow:be,u_highlight:Re,u_accent:tt}})(w,h,y,te?l:null),te,y.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}function kc(w,l,h,y,v,k){const z=w.context,D=z.gl,B=l.dem;if(B&&B.data){const G=B.dim,Q=B.stride,te=B.getPixels();if(z.activeTexture.set(D.TEXTURE1),z.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||w.getTileTexture(Q),l.demTexture){const Se=l.demTexture;Se.update(te,{premultiply:!1}),Se.bind(D.NEAREST,D.CLAMP_TO_EDGE)}else l.demTexture=new ee(z,te,D.RGBA,{premultiply:!1}),l.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);z.activeTexture.set(D.TEXTURE0);let me=l.fbo;if(!me){const Se=new ee(z,{width:G,height:G,data:null},D.RGBA);Se.bind(D.LINEAR,D.CLAMP_TO_EDGE),me=l.fbo=z.createFramebuffer(G,G,!0,!1),me.colorAttachment.set(Se.texture)}z.bindFramebuffer.set(me.framebuffer),z.viewport.set([0,0,G,G]),w.useProgram("hillshadePrepare").draw(z,D.TRIANGLES,y,v,k,pr.disabled,((Se,ke)=>{const Me=ke.stride,be=s.F();return s.aN(be,0,s.W,-s.W,0,0,1),s.H(be,be,[0,-s.W,0]),{u_matrix:be,u_image:1,u_dimension:[Me,Me],u_zoom:Se.overscaledZ,u_unpack:ke.getUnpackVector()}})(l.tileID,B),null,h.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments),l.needsHillshadePrepare=!1}}function Ph(w,l,h,y,v,k){const z=y.paint.get("raster-fade-duration");if(!k&&z>0){const D=_.now(),B=(D-w.timeAdded)/z,G=l?(D-l.timeAdded)/z:-1,Q=h.getSource(),te=v.coveringZoomLevel({tileSize:Q.tileSize,roundZoom:Q.roundZoom}),me=!l||Math.abs(l.tileID.overscaledZ-te)>Math.abs(w.tileID.overscaledZ-te),Se=me&&w.refreshedUponExpiration?1:s.ac(me?B:1-G,0,1);return w.refreshedUponExpiration&&B>=1&&(w.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Se}:{opacity:Se,mix:0}}return{opacity:1,mix:0}}const zh=new s.aO(1,0,0,1),cu=new s.aO(0,1,0,1),Sc=new s.aO(0,0,1,1),Rp=new s.aO(1,0,1,1),Dh=new s.aO(0,1,1,1);function Br(w,l,h,y){Ii(w,0,l+h/2,w.transform.width,h,y)}function Ms(w,l,h,y){Ii(w,l-h/2,0,h,w.transform.height,y)}function Ii(w,l,h,y,v,k){const z=w.context,D=z.gl;D.enable(D.SCISSOR_TEST),D.scissor(l*w.pixelRatio,h*w.pixelRatio,y*w.pixelRatio,v*w.pixelRatio),z.clear({color:k}),D.disable(D.SCISSOR_TEST)}function Tc(w,l,h){const y=w.context,v=y.gl,k=h.posMatrix,z=w.useProgram("debug"),D=Vn.disabled,B=br.disabled,G=w.colorModeForRenderPass(),Q="$debug",te=w.style.map.terrain&&w.style.map.terrain.getTerrainData(h);y.activeTexture.set(v.TEXTURE0);const me=l.getTileByID(h.key).latestRawTileData,Se=Math.floor((me&&me.byteLength||0)/1024),ke=l.getTile(h).tileSize,Me=512/Math.min(ke,512)*(h.overscaledZ/w.transform.zoom)*.5;let be=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(be+=` => ${h.overscaledZ}`),function(Re,tt){Re.initDebugOverlayCanvas();const Ie=Re.debugOverlayCanvas,Ve=Re.context.gl,rt=Re.debugOverlayCanvas.getContext("2d");rt.clearRect(0,0,Ie.width,Ie.height),rt.shadowColor="white",rt.shadowBlur=2,rt.lineWidth=1.5,rt.strokeStyle="white",rt.textBaseline="top",rt.font="bold 36px Open Sans, sans-serif",rt.fillText(tt,5,5),rt.strokeText(tt,5,5),Re.debugOverlayTexture.update(Ie),Re.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(w,`${be} ${Se}kB`),z.draw(y,v.TRIANGLES,D,B,Wr.alphaBlended,pr.disabled,_h(k,s.aO.transparent,Me),null,Q,w.debugBuffer,w.quadTriangleIndexBuffer,w.debugSegments),z.draw(y,v.LINE_STRIP,D,B,G,pr.disabled,_h(k,s.aO.red),te,Q,w.debugBuffer,w.tileBorderIndexBuffer,w.debugSegments)}function fu(w,l,h){const y=w.context,v=y.gl,k=w.colorModeForRenderPass(),z=new Vn(v.LEQUAL,Vn.ReadWrite,w.depthRangeFor3D),D=w.useProgram("terrain"),B=l.getTerrainMesh();y.bindFramebuffer.set(null),y.viewport.set([0,0,w.width,w.height]);for(const G of h){const Q=w.renderToTexture.getTexture(G),te=l.getTerrainData(G.tileID);y.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,Q.texture);const me={u_matrix:w.transform.calculatePosMatrix(G.tileID.toUnwrapped()),u_texture:0,u_ele_delta:l.getMeshFrameDelta(w.transform.zoom)};D.draw(y,v.TRIANGLES,z,br.disabled,k,pr.backCCW,me,te,"terrain",B.vertexBuffer,B.indexBuffer,B.segments)}}class Rh{constructor(l,h){this.context=new Dp(l),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:s.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Bn.maxUnderzooming+Bn.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ts}resize(l,h,y){if(this.width=Math.floor(l*y),this.height=Math.floor(h*y),this.pixelRatio=y,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style._order)this.style._layers[v].resize()}setup(){const l=this.context,h=new s.aV;h.emplaceBack(0,0),h.emplaceBack(s.W,0),h.emplaceBack(0,s.W),h.emplaceBack(s.W,s.W),this.tileExtentBuffer=l.createVertexBuffer(h,Ul.members),this.tileExtentSegments=s.$.simpleSegment(0,0,4,2);const y=new s.aV;y.emplaceBack(0,0),y.emplaceBack(s.W,0),y.emplaceBack(0,s.W),y.emplaceBack(s.W,s.W),this.debugBuffer=l.createVertexBuffer(y,Ul.members),this.debugSegments=s.$.simpleSegment(0,0,4,5);const v=new s.Z;v.emplaceBack(0,0,0,0),v.emplaceBack(s.W,0,s.W,0),v.emplaceBack(0,s.W,0,s.W),v.emplaceBack(s.W,s.W,s.W,s.W),this.rasterBoundsBuffer=l.createVertexBuffer(v,lt.members),this.rasterBoundsSegments=s.$.simpleSegment(0,0,4,2);const k=new s.aV;k.emplaceBack(0,0),k.emplaceBack(1,0),k.emplaceBack(0,1),k.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(k,Ul.members),this.viewportSegments=s.$.simpleSegment(0,0,4,2);const z=new s.aW;z.emplaceBack(0),z.emplaceBack(1),z.emplaceBack(3),z.emplaceBack(2),z.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(z);const D=new s.aX;D.emplaceBack(0,1,2),D.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(D);const B=this.context.gl;this.stencilClearMode=new br({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO)}clearStencil(){const l=this.context,h=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const y=s.F();s.aN(y,0,this.width,this.height,0,0,1),s.J(y,y,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,h.TRIANGLES,Vn.disabled,this.stencilClearMode,Wr.disabled,pr.disabled,Wl(y),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(l,h){if(this.currentStencilSource===l.source||!l.isTileClipped()||!h||!h.length)return;this.currentStencilSource=l.source;const y=this.context,v=y.gl;this.nextStencilID+h.length>256&&this.clearStencil(),y.setColorMode(Wr.disabled),y.setDepthMode(Vn.disabled);const k=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const z of h){const D=this._tileClippingMaskIDs[z.key]=this.nextStencilID++,B=this.style.map.terrain&&this.style.map.terrain.getTerrainData(z);k.draw(y,v.TRIANGLES,Vn.disabled,new br({func:v.ALWAYS,mask:0},D,255,v.KEEP,v.KEEP,v.REPLACE),Wr.disabled,pr.disabled,Wl(z.posMatrix),B,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,h=this.context.gl;return new br({func:h.NOTEQUAL,mask:255},l,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(l){const h=this.context.gl;return new br({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(l){const h=this.context.gl,y=l.sort((z,D)=>D.overscaledZ-z.overscaledZ),v=y[y.length-1].overscaledZ,k=y[0].overscaledZ-v+1;if(k>1){this.currentStencilSource=void 0,this.nextStencilID+k>256&&this.clearStencil();const z={};for(let D=0;D<k;D++)z[D+v]=new br({func:h.GEQUAL,mask:255},D+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=k,[z,y]}return[{[v]:br.disabled},y]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new Wr([l.CONSTANT_COLOR,l.ONE],new s.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Wr.unblended:Wr.alphaBlended}depthModeForSublayer(l,h,y){if(!this.opaquePassEnabledForLayer())return Vn.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new Vn(y||this.context.gl.LEQUAL,h,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,h){this.style=l,this.options=h,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(_.now()),this.imageManager.beginFrame();const y=this.style._order,v=this.style.sourceCaches,k={},z={},D={};for(const B in v){const G=v[B];G.used&&G.prepare(this.context),k[B]=G.getVisibleCoordinates(),z[B]=k[B].slice().reverse(),D[B]=G.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<y.length;B++)if(this.style._layers[y[B]].is3D()){this.opaquePassCutoff=B;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const B of y){const G=this.style._layers[B];if(!G.hasOffscreenPass()||G.isHidden(this.transform.zoom))continue;const Q=z[G.source];(G.type==="custom"||Q.length)&&this.renderLayer(this,v[G.source],G,Q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?s.aO.black:s.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[y[this.currentLayer]],G=v[B.source],Q=k[B.source];this._renderTileClippingMasks(B,Q),this.renderLayer(this,G,B,Q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const B=this.style._layers[y[this.currentLayer]],G=v[B.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(B))continue;const Q=(B.type==="symbol"?D:z)[B.source];this._renderTileClippingMasks(B,k[B.source]),this.renderLayer(this,G,B,Q)}if(this.options.showTileBoundaries){const B=function(G,Q){let te=null;const me=Object.values(G._layers).flatMap(be=>be.source&&!be.isHidden(Q)?[G.sourceCaches[be.source]]:[]),Se=me.filter(be=>be.getSource().type==="vector"),ke=me.filter(be=>be.getSource().type!=="vector"),Me=be=>{(!te||te.getSource().maxzoom<be.getSource().maxzoom)&&(te=be)};return Se.forEach(be=>Me(be)),te||ke.forEach(be=>Me(be)),te}(this.style,this.transform.zoom);B&&function(G,Q,te){for(let me=0;me<te.length;me++)Tc(G,Q,te[me])}(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const G=B.transform.padding;Br(B,B.transform.height-(G.top||0),3,zh),Br(B,G.bottom||0,3,cu),Ms(B,G.left||0,3,Sc),Ms(B,B.transform.width-(G.right||0),3,Rp);const Q=B.transform.centerPoint;(function(te,me,Se,ke){Ii(te,me-1,Se-10,2,20,ke),Ii(te,me-10,Se-1,20,2,ke)})(B,Q.x,B.transform.height-Q.y,Dh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(l){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,y=this.transform.projMatrix;let v=this.terrainFacilitator.dirty;v||(v=l?!s.aY(h,y):!s.aZ(h,y)),v||(v=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),v&&(s.a_(h,y),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(k,z){const D=k.context,B=D.gl,G=Wr.unblended,Q=new Vn(B.LEQUAL,Vn.ReadWrite,[0,1]),te=z.getTerrainMesh(),me=z.sourceCache.getRenderableTiles(),Se=k.useProgram("terrainDepth");D.bindFramebuffer.set(z.getFramebuffer("depth").framebuffer),D.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),D.clear({color:s.aO.transparent,depth:1});for(const ke of me){const Me=z.getTerrainData(ke.tileID),be={u_matrix:k.transform.calculatePosMatrix(ke.tileID.toUnwrapped()),u_ele_delta:z.getMeshFrameDelta(k.transform.zoom)};Se.draw(D,B.TRIANGLES,Q,br.disabled,G,pr.backCCW,be,Me,"terrain",te.vertexBuffer,te.indexBuffer,te.segments)}D.bindFramebuffer.set(null),D.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain),function(k,z){const D=k.context,B=D.gl,G=Wr.unblended,Q=new Vn(B.LEQUAL,Vn.ReadWrite,[0,1]),te=z.getTerrainMesh(),me=z.getCoordsTexture(),Se=z.sourceCache.getRenderableTiles(),ke=k.useProgram("terrainCoords");D.bindFramebuffer.set(z.getFramebuffer("coords").framebuffer),D.viewport.set([0,0,k.width/devicePixelRatio,k.height/devicePixelRatio]),D.clear({color:s.aO.transparent,depth:1}),z.coordsIndex=[];for(const Me of Se){const be=z.getTerrainData(Me.tileID);D.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,me.texture);const Re={u_matrix:k.transform.calculatePosMatrix(Me.tileID.toUnwrapped()),u_terrain_coords_id:(255-z.coordsIndex.length)/255,u_texture:0,u_ele_delta:z.getMeshFrameDelta(k.transform.zoom)};ke.draw(D,B.TRIANGLES,Q,br.disabled,G,pr.backCCW,Re,be,"terrain",te.vertexBuffer,te.indexBuffer,te.segments),z.coordsIndex.push(Me.tileID.key)}D.bindFramebuffer.set(null),D.viewport.set([0,0,k.width,k.height])}(this,this.style.map.terrain))}renderLayer(l,h,y,v){if(!y.isHidden(this.transform.zoom)&&(y.type==="background"||y.type==="custom"||(v||[]).length))switch(this.id=y.id,y.type){case"symbol":(function(k,z,D,B,G){if(k.renderPass!=="translucent")return;const Q=br.disabled,te=k.colorModeForRenderPass();(D._unevaluatedLayout.hasValue("text-variable-anchor")||D._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(me,Se,ke,Me,be,Re,tt){const Ie=Se.transform,Ve=be==="map",rt=Re==="map";for(const st of me){const ft=Me.getTile(st),Ct=ft.getBucket(ke);if(!Ct||!Ct.text||!Ct.text.segments.get().length)continue;const wt=s.ag(Ct.textSizeData,Ie.zoom),Ft=mn(ft,1,Se.transform.zoom),$t=Jt(st.posMatrix,rt,Ve,Se.transform,Ft),Sn=ke.layout.get("icon-text-fit")!=="none"&&Ct.hasIconData();if(wt){const Bt=Math.pow(2,Ie.zoom-ft.tileID.overscaledZ);iu(Ct,Ve,rt,tt,Ie,$t,st.posMatrix,Bt,wt,Sn,Se.style.map.terrain?(gn,Tn)=>Se.style.map.terrain.getElevation(st,gn,Tn):null)}}}(B,k,D,z,D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),G),D.paint.get("icon-opacity").constantOr(1)!==0&&su(k,z,D,B,!1,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),D.layout.get("icon-rotation-alignment"),D.layout.get("icon-pitch-alignment"),D.layout.get("icon-keep-upright"),Q,te),D.paint.get("text-opacity").constantOr(1)!==0&&su(k,z,D,B,!0,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),D.layout.get("text-rotation-alignment"),D.layout.get("text-pitch-alignment"),D.layout.get("text-keep-upright"),Q,te),z.map.showCollisionBoxes&&(ru(k,z,D,B,D.paint.get("text-translate"),D.paint.get("text-translate-anchor"),!0),ru(k,z,D,B,D.paint.get("icon-translate"),D.paint.get("icon-translate-anchor"),!1))})(l,h,y,v,this.style.placement.variableOffsets);break;case"circle":(function(k,z,D,B){if(k.renderPass!=="translucent")return;const G=D.paint.get("circle-opacity"),Q=D.paint.get("circle-stroke-width"),te=D.paint.get("circle-stroke-opacity"),me=!D.layout.get("circle-sort-key").isConstant();if(G.constantOr(1)===0&&(Q.constantOr(1)===0||te.constantOr(1)===0))return;const Se=k.context,ke=Se.gl,Me=k.depthModeForSublayer(0,Vn.ReadOnly),be=br.disabled,Re=k.colorModeForRenderPass(),tt=[];for(let Ie=0;Ie<B.length;Ie++){const Ve=B[Ie],rt=z.getTile(Ve),st=rt.getBucket(D);if(!st)continue;const ft=st.programConfigurations.get(D.id),Ct=k.useProgram("circle",ft),wt=st.layoutVertexBuffer,Ft=st.indexBuffer,$t=k.style.map.terrain&&k.style.map.terrain.getTerrainData(Ve),Sn={programConfiguration:ft,program:Ct,layoutVertexBuffer:wt,indexBuffer:Ft,uniformValues:kp(k,Ve,rt,D),terrainData:$t};if(me){const Bt=st.segments.get();for(const gn of Bt)tt.push({segments:new s.$([gn]),sortKey:gn.sortKey,state:Sn})}else tt.push({segments:st.segments,sortKey:0,state:Sn})}me&&tt.sort((Ie,Ve)=>Ie.sortKey-Ve.sortKey);for(const Ie of tt){const{programConfiguration:Ve,program:rt,layoutVertexBuffer:st,indexBuffer:ft,uniformValues:Ct,terrainData:wt}=Ie.state;rt.draw(Se,ke.TRIANGLES,Me,be,Re,pr.disabled,Ct,wt,D.id,st,ft,Ie.segments,D.paint,k.transform.zoom,Ve)}})(l,h,y,v);break;case"heatmap":(function(k,z,D,B){if(D.paint.get("heatmap-opacity")!==0)if(k.renderPass==="offscreen"){const G=k.context,Q=G.gl,te=br.disabled,me=new Wr([Q.ONE,Q.ONE],s.aO.transparent,[!0,!0,!0,!0]);(function(Se,ke,Me){const be=Se.gl;Se.activeTexture.set(be.TEXTURE1),Se.viewport.set([0,0,ke.width/4,ke.height/4]);let Re=Me.heatmapFbo;if(Re)be.bindTexture(be.TEXTURE_2D,Re.colorAttachment.get()),Se.bindFramebuffer.set(Re.framebuffer);else{const tt=be.createTexture();be.bindTexture(be.TEXTURE_2D,tt),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_S,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_WRAP_T,be.CLAMP_TO_EDGE),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MIN_FILTER,be.LINEAR),be.texParameteri(be.TEXTURE_2D,be.TEXTURE_MAG_FILTER,be.LINEAR),Re=Me.heatmapFbo=Se.createFramebuffer(ke.width/4,ke.height/4,!1,!1),function(Ie,Ve,rt,st){var ft,Ct;const wt=Ie.gl,Ft=(ft=Ie.HALF_FLOAT)!==null&&ft!==void 0?ft:wt.UNSIGNED_BYTE,$t=(Ct=Ie.RGBA16F)!==null&&Ct!==void 0?Ct:wt.RGBA;wt.texImage2D(wt.TEXTURE_2D,0,$t,Ve.width/4,Ve.height/4,0,wt.RGBA,Ft,null),st.colorAttachment.set(rt)}(Se,ke,tt,Re)}})(G,k,D),G.clear({color:s.aO.transparent});for(let Se=0;Se<B.length;Se++){const ke=B[Se];if(z.hasRenderableParent(ke))continue;const Me=z.getTile(ke),be=Me.getBucket(D);if(!be)continue;const Re=be.programConfigurations.get(D.id),tt=k.useProgram("heatmap",Re),{zoom:Ie}=k.transform;tt.draw(G,Q.TRIANGLES,Vn.disabled,te,me,pr.disabled,yh(ke.posMatrix,Me,Ie,D.paint.get("heatmap-intensity")),null,D.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,D.paint,k.transform.zoom,Re)}G.viewport.set([0,0,k.width,k.height])}else k.renderPass==="translucent"&&(k.context.setColorMode(k.colorModeForRenderPass()),function(G,Q){const te=G.context,me=te.gl,Se=Q.heatmapFbo;if(!Se)return;te.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_2D,Se.colorAttachment.get()),te.activeTexture.set(me.TEXTURE1);let ke=Q.colorRampTexture;ke||(ke=Q.colorRampTexture=new ee(te,Q.colorRamp,me.RGBA)),ke.bind(me.LINEAR,me.CLAMP_TO_EDGE),G.useProgram("heatmapTexture").draw(te,me.TRIANGLES,Vn.disabled,br.disabled,G.colorModeForRenderPass(),pr.disabled,((Me,be,Re,tt)=>{const Ie=s.F();s.aN(Ie,0,Me.width,Me.height,0,0,1);const Ve=Me.context.gl;return{u_matrix:Ie,u_world:[Ve.drawingBufferWidth,Ve.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:be.paint.get("heatmap-opacity")}})(G,Q),null,Q.id,G.viewportBuffer,G.quadTriangleIndexBuffer,G.viewportSegments,Q.paint,G.transform.zoom)}(k,D))})(l,h,y,v);break;case"line":(function(k,z,D,B){if(k.renderPass!=="translucent")return;const G=D.paint.get("line-opacity"),Q=D.paint.get("line-width");if(G.constantOr(1)===0||Q.constantOr(1)===0)return;const te=k.depthModeForSublayer(0,Vn.ReadOnly),me=k.colorModeForRenderPass(),Se=D.paint.get("line-dasharray"),ke=D.paint.get("line-pattern"),Me=ke.constantOr(1),be=D.paint.get("line-gradient"),Re=D.getCrossfadeParameters(),tt=Me?"linePattern":Se?"lineSDF":be?"lineGradient":"line",Ie=k.context,Ve=Ie.gl;let rt=!0;for(const st of B){const ft=z.getTile(st);if(Me&&!ft.patternsLoaded())continue;const Ct=ft.getBucket(D);if(!Ct)continue;const wt=Ct.programConfigurations.get(D.id),Ft=k.context.program.get(),$t=k.useProgram(tt,wt),Sn=rt||$t.program!==Ft,Bt=k.style.map.terrain&&k.style.map.terrain.getTerrainData(st),gn=ke.constantOr(null);if(gn&&ft.imageAtlas){const kn=ft.imageAtlas,En=kn.patternPositions[gn.to.toString()],Rn=kn.patternPositions[gn.from.toString()];En&&Rn&&wt.setConstantPatternPositions(En,Rn)}const Tn=Bt?st:null,qn=Me?Us(k,ft,D,Re,Tn):Se?Zl(k,ft,D,Se,Re,Tn):be?bh(k,ft,D,Ct.lineClipsArray.length,Tn):Gl(k,ft,D,Tn);if(Me)Ie.activeTexture.set(Ve.TEXTURE0),ft.imageAtlasTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE),wt.updatePaintBuffers(Re);else if(Se&&(Sn||k.lineAtlas.dirty))Ie.activeTexture.set(Ve.TEXTURE0),k.lineAtlas.bind(Ie);else if(be){const kn=Ct.gradients[D.id];let En=kn.texture;if(D.gradientVersion!==kn.version){let Rn=256;if(D.stepInterpolant){const jr=z.getSource().maxzoom,lr=st.canonical.z===jr?Math.ceil(1<<k.transform.maxZoom-st.canonical.z):1;Rn=s.ac(s.aT(Ct.maxLineLength/s.W*1024*lr),256,Ie.maxTextureSize)}kn.gradient=s.aU({expression:D.gradientExpression(),evaluationKey:"lineProgress",resolution:Rn,image:kn.gradient||void 0,clips:Ct.lineClipsArray}),kn.texture?kn.texture.update(kn.gradient):kn.texture=new ee(Ie,kn.gradient,Ve.RGBA),kn.version=D.gradientVersion,En=kn.texture}Ie.activeTexture.set(Ve.TEXTURE0),En.bind(D.stepInterpolant?Ve.NEAREST:Ve.LINEAR,Ve.CLAMP_TO_EDGE)}$t.draw(Ie,Ve.TRIANGLES,te,k.stencilModeForClipping(st),me,pr.disabled,qn,Bt,D.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,D.paint,k.transform.zoom,wt,Ct.layoutVertexBuffer2),rt=!1}})(l,h,y,v);break;case"fill":(function(k,z,D,B){const G=D.paint.get("fill-color"),Q=D.paint.get("fill-opacity");if(Q.constantOr(1)===0)return;const te=k.colorModeForRenderPass(),me=D.paint.get("fill-pattern"),Se=k.opaquePassEnabledForLayer()&&!me.constantOr(1)&&G.constantOr(s.aO.transparent).a===1&&Q.constantOr(0)===1?"opaque":"translucent";if(k.renderPass===Se){const ke=k.depthModeForSublayer(1,k.renderPass==="opaque"?Vn.ReadWrite:Vn.ReadOnly);Ah(k,z,D,B,ke,te,!1)}if(k.renderPass==="translucent"&&D.paint.get("fill-antialias")){const ke=k.depthModeForSublayer(D.getPaintProperty("fill-outline-color")?2:0,Vn.ReadOnly);Ah(k,z,D,B,ke,te,!0)}})(l,h,y,v);break;case"fill-extrusion":(function(k,z,D,B){const G=D.paint.get("fill-extrusion-opacity");if(G!==0&&k.renderPass==="translucent"){const Q=new Vn(k.context.gl.LEQUAL,Vn.ReadWrite,k.depthRangeFor3D);if(G!==1||D.paint.get("fill-extrusion-pattern").constantOr(1))lu(k,z,D,B,Q,br.disabled,Wr.disabled),lu(k,z,D,B,Q,k.stencilModeFor3D(),k.colorModeForRenderPass());else{const te=k.colorModeForRenderPass();lu(k,z,D,B,Q,br.disabled,te)}}})(l,h,y,v);break;case"hillshade":(function(k,z,D,B){if(k.renderPass!=="offscreen"&&k.renderPass!=="translucent")return;const G=k.context,Q=k.depthModeForSublayer(0,Vn.ReadOnly),te=k.colorModeForRenderPass(),[me,Se]=k.renderPass==="translucent"?k.stencilConfigForOverlap(B):[{},B];for(const ke of Se){const Me=z.getTile(ke);Me.needsHillshadePrepare!==void 0&&Me.needsHillshadePrepare&&k.renderPass==="offscreen"?kc(k,Me,D,Q,br.disabled,te):k.renderPass==="translucent"&&uu(k,ke,Me,D,Q,me[ke.overscaledZ],te)}G.viewport.set([0,0,k.width,k.height])})(l,h,y,v);break;case"raster":(function(k,z,D,B){if(k.renderPass!=="translucent"||D.paint.get("raster-opacity")===0||!B.length)return;const G=k.context,Q=G.gl,te=z.getSource(),me=k.useProgram("raster"),Se=k.colorModeForRenderPass(),[ke,Me]=te instanceof Wt?[{},B]:k.stencilConfigForOverlap(B),be=Me[Me.length-1].overscaledZ,Re=!k.options.moving;for(const tt of Me){const Ie=k.depthModeForSublayer(tt.overscaledZ-be,D.paint.get("raster-opacity")===1?Vn.ReadWrite:Vn.ReadOnly,Q.LESS),Ve=z.getTile(tt);Ve.registerFadeDuration(D.paint.get("raster-fade-duration"));const rt=z.findLoadedParent(tt,0),st=Ph(Ve,rt,z,D,k.transform,k.style.map.terrain);let ft,Ct;const wt=D.paint.get("raster-resampling")==="nearest"?Q.NEAREST:Q.LINEAR;G.activeTexture.set(Q.TEXTURE0),Ve.texture.bind(wt,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),G.activeTexture.set(Q.TEXTURE1),rt?(rt.texture.bind(wt,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST),ft=Math.pow(2,rt.tileID.overscaledZ-Ve.tileID.overscaledZ),Ct=[Ve.tileID.canonical.x*ft%1,Ve.tileID.canonical.y*ft%1]):Ve.texture.bind(wt,Q.CLAMP_TO_EDGE,Q.LINEAR_MIPMAP_NEAREST);const Ft=k.style.map.terrain&&k.style.map.terrain.getTerrainData(tt),$t=Ft?tt:null,Sn=$t?$t.posMatrix:k.transform.calculatePosMatrix(tt.toUnwrapped(),Re),Bt=Kl(Sn,Ct||[0,0],ft||1,st,D);te instanceof Wt?me.draw(G,Q.TRIANGLES,Ie,br.disabled,Se,pr.disabled,Bt,Ft,D.id,te.boundsBuffer,k.quadTriangleIndexBuffer,te.boundsSegments):me.draw(G,Q.TRIANGLES,Ie,ke[tt.overscaledZ],Se,pr.disabled,Bt,Ft,D.id,k.rasterBoundsBuffer,k.quadTriangleIndexBuffer,k.rasterBoundsSegments)}})(l,h,y,v);break;case"background":(function(k,z,D,B){const G=D.paint.get("background-color"),Q=D.paint.get("background-opacity");if(Q===0)return;const te=k.context,me=te.gl,Se=k.transform,ke=Se.tileSize,Me=D.paint.get("background-pattern");if(k.isPatternMissing(Me))return;const be=!Me&&G.a===1&&Q===1&&k.opaquePassEnabledForLayer()?"opaque":"translucent";if(k.renderPass!==be)return;const Re=br.disabled,tt=k.depthModeForSublayer(0,be==="opaque"?Vn.ReadWrite:Vn.ReadOnly),Ie=k.colorModeForRenderPass(),Ve=k.useProgram(Me?"backgroundPattern":"background"),rt=B||Se.coveringTiles({tileSize:ke,terrain:k.style.map.terrain});Me&&(te.activeTexture.set(me.TEXTURE0),k.imageManager.bind(k.context));const st=D.getCrossfadeParameters();for(const ft of rt){const Ct=B?ft.posMatrix:k.transform.calculatePosMatrix(ft.toUnwrapped()),wt=Me?Tp(Ct,Q,k,Me,{tileID:ft,tileSize:ke},st):Sp(Ct,Q,G),Ft=k.style.map.terrain&&k.style.map.terrain.getTerrainData(ft);Ve.draw(te,me.TRIANGLES,tt,Re,Ie,pr.disabled,wt,Ft,D.id,k.tileExtentBuffer,k.quadTriangleIndexBuffer,k.tileExtentSegments)}})(l,0,y,v);break;case"custom":(function(k,z,D){const B=k.context,G=D.implementation;if(k.renderPass==="offscreen"){const Q=G.prerender;Q&&(k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),Q.call(G,B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState())}else if(k.renderPass==="translucent"){k.setCustomLayerDefaults(),B.setColorMode(k.colorModeForRenderPass()),B.setStencilMode(br.disabled);const Q=G.renderingMode==="3d"?new Vn(k.context.gl.LEQUAL,Vn.ReadWrite,k.depthRangeFor3D):k.depthModeForSublayer(0,Vn.ReadOnly);B.setDepthMode(Q),G.render(B.gl,k.transform.customLayerMatrix()),B.setDirty(),k.setBaseState(),B.bindFramebuffer.set(null)}})(l,0,y)}}translatePosMatrix(l,h,y,v,k){if(!y[0]&&!y[1])return l;const z=k?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(z){const G=Math.sin(z),Q=Math.cos(z);y=[y[0]*Q-y[1]*G,y[0]*G+y[1]*Q]}const D=[k?y[0]:mn(h,y[0],this.transform.zoom),k?y[1]:mn(h,y[1],this.transform.zoom),0],B=new Float32Array(16);return s.H(B,l,D),B}saveTileTexture(l){const h=this._tileTextures[l.size[0]];h?h.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const h=this._tileTextures[l];return h&&h.length>0?h.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const h=this.imageManager.getPattern(l.from.toString()),y=this.imageManager.getPattern(l.to.toString());return!h||!y}useProgram(l,h){this.cache=this.cache||{};const y=l+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[y]||(this.cache[y]=new Cs(this.context,rl[l],h,wh[l],this._showOverdrawInspector,this.style.map.terrain)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ee(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:l,drawingBufferHeight:h}=this.context.gl;return this.width!==l||this.height!==h}}class Es{constructor(l,h){this.points=l,this.planes=h}static fromInvProjectionMatrix(l,h,y){const v=Math.pow(2,y),k=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(D=>{const B=1/(D=s.af([],D,l))[3]/h*v;return s.a$(D,D,[B,B,1/D[3],B])}),z=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(D=>{const B=function(me,Se){var ke=Se[0],Me=Se[1],be=Se[2],Re=ke*ke+Me*Me+be*be;return Re>0&&(Re=1/Math.sqrt(Re)),me[0]=Se[0]*Re,me[1]=Se[1]*Re,me[2]=Se[2]*Re,me}([],function(me,Se,ke){var Me=Se[0],be=Se[1],Re=Se[2],tt=ke[0],Ie=ke[1],Ve=ke[2];return me[0]=be*Ve-Re*Ie,me[1]=Re*tt-Me*Ve,me[2]=Me*Ie-be*tt,me}([],Y([],k[D[0]],k[D[1]]),Y([],k[D[2]],k[D[1]]))),G=-((Q=B)[0]*(te=k[D[1]])[0]+Q[1]*te[1]+Q[2]*te[2]);var Q,te;return B.concat(G)});return new Es(k,z)}}class Ls{constructor(l,h){this.min=l,this.max=h,this.center=function(y,v,k){return y[0]=.5*v[0],y[1]=.5*v[1],y[2]=.5*v[2],y}([],function(y,v,k){return y[0]=v[0]+k[0],y[1]=v[1]+k[1],y[2]=v[2]+k[2],y}([],this.min,this.max))}quadrant(l){const h=[l%2==0,l<2],y=X(this.min),v=X(this.max);for(let k=0;k<h.length;k++)y[k]=h[k]?this.min[k]:this.center[k],v[k]=h[k]?this.center[k]:this.max[k];return v[2]=this.max[2],new Ls(y,v)}distanceX(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]}distanceY(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]}intersects(l){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let y=!0;for(let v=0;v<l.planes.length;v++){const k=l.planes[v];let z=0;for(let D=0;D<h.length;D++)s.b0(k,h[D])>=0&&z++;if(z===0)return 0;z!==h.length&&(y=!1)}if(y)return 2;for(let v=0;v<3;v++){let k=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(let D=0;D<l.points.length;D++){const B=l.points[D][v]-this.min[v];k=Math.min(k,B),z=Math.max(z,B)}if(z<0||k>this.max[v]-this.min[v])return 0}return 1}}class va{constructor(l=0,h=0,y=0,v=0){if(isNaN(l)||l<0||isNaN(h)||h<0||isNaN(y)||y<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=h,this.left=y,this.right=v}interpolate(l,h,y){return h.top!=null&&l.top!=null&&(this.top=s.z.number(l.top,h.top,y)),h.bottom!=null&&l.bottom!=null&&(this.bottom=s.z.number(l.bottom,h.bottom,y)),h.left!=null&&l.left!=null&&(this.left=s.z.number(l.left,h.left,y)),h.right!=null&&l.right!=null&&(this.right=s.z.number(l.right,h.right,y)),this}getCenter(l,h){const y=s.ac((this.left+l-this.right)/2,0,l),v=s.ac((this.top+h-this.bottom)/2,0,h);return new s.P(y,v)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new va(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Cc=85.051129;class hu{constructor(l,h,y,v,k){this.tileSize=512,this._renderWorldCopies=k===void 0||!!k,this._minZoom=l||0,this._maxZoom=h||22,this._minPitch=y??0,this._maxPitch=v??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new s.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new va,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const l=new hu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.apply(this),l}apply(l){this.tileSize=l.tileSize,this.latRange=l.latRange,this.width=l.width,this.height=l.height,this._center=l._center,this._elevation=l._elevation,this.minElevationForCurrentTile=l.minElevationForCurrentTile,this.zoom=l.zoom,this.angle=l.angle,this._fov=l._fov,this._pitch=l._pitch,this._unmodified=l._unmodified,this._edgeInsets=l._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(l){const h=-s.b1(l,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var y=new s.A(4);return s.A!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y}(),function(y,v,k){var z=v[0],D=v[1],B=v[2],G=v[3],Q=Math.sin(k),te=Math.cos(k);y[0]=z*te+B*Q,y[1]=D*te+G*Q,y[2]=z*-Q+B*te,y[3]=D*-Q+G*te}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const h=s.ac(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(l){const h=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(l){l!==this._elevation&&(this._elevation=l,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,h,y){this._unmodified=!1,this._edgeInsets.interpolate(l,h,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const h=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(l){const h=[new s.b2(0,l)];if(this._renderWorldCopies){const y=this.pointCoordinate(new s.P(0,0)),v=this.pointCoordinate(new s.P(this.width,0)),k=this.pointCoordinate(new s.P(this.width,this.height)),z=this.pointCoordinate(new s.P(0,this.height)),D=Math.floor(Math.min(y.x,v.x,k.x,z.x)),B=Math.floor(Math.max(y.x,v.x,k.x,z.x)),G=1;for(let Q=D-G;Q<=B+G;Q++)Q!==0&&h.push(new s.b2(Q,l))}return h}coveringTiles(l){var h,y;let v=this.coveringZoomLevel(l);const k=v;if(l.minzoom!==void 0&&v<l.minzoom)return[];l.maxzoom!==void 0&&v>l.maxzoom&&(v=l.maxzoom);const z=this.pointCoordinate(this.getCameraPoint()),D=s.Y.fromLngLat(this.center),B=Math.pow(2,v),G=[B*z.x,B*z.y,0],Q=[B*D.x,B*D.y,0],te=Es.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v);let me=l.minzoom||0;!l.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(me=v);const Se=l.terrain?2/Math.min(this.tileSize,l.tileSize)*this.tileSize:3,ke=Ie=>({aabb:new Ls([Ie*B,0,0],[(Ie+1)*B,B,0]),zoom:0,x:0,y:0,wrap:Ie,fullyVisible:!1}),Me=[],be=[],Re=v,tt=l.reparseOverscaled?k:v;if(this._renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)Me.push(ke(-Ie)),Me.push(ke(Ie));for(Me.push(ke(0));Me.length>0;){const Ie=Me.pop(),Ve=Ie.x,rt=Ie.y;let st=Ie.fullyVisible;if(!st){const $t=Ie.aabb.intersects(te);if($t===0)continue;st=$t===2}const ft=l.terrain?G:Q,Ct=Ie.aabb.distanceX(ft),wt=Ie.aabb.distanceY(ft),Ft=Math.max(Math.abs(Ct),Math.abs(wt));if(Ie.zoom===Re||Ft>Se+(1<<Re-Ie.zoom)-2&&Ie.zoom>=me){const $t=Re-Ie.zoom,Sn=G[0]-.5-(Ve<<$t),Bt=G[1]-.5-(rt<<$t);be.push({tileID:new s.Q(Ie.zoom===Re?tt:Ie.zoom,Ie.wrap,Ie.zoom,Ve,rt),distanceSq:fe([Q[0]-.5-Ve,Q[1]-.5-rt]),tileDistanceToCamera:Math.sqrt(Sn*Sn+Bt*Bt)})}else for(let $t=0;$t<4;$t++){const Sn=(Ve<<1)+$t%2,Bt=(rt<<1)+($t>>1),gn=Ie.zoom+1;let Tn=Ie.aabb.quadrant($t);if(l.terrain){const qn=new s.Q(gn,Ie.wrap,gn,Sn,Bt),kn=l.terrain.getMinMaxElevation(qn),En=(h=kn.minElevation)!==null&&h!==void 0?h:this.elevation,Rn=(y=kn.maxElevation)!==null&&y!==void 0?y:this.elevation;Tn=new Ls([Tn.min[0],Tn.min[1],En],[Tn.max[0],Tn.max[1],Rn])}Me.push({aabb:Tn,zoom:gn,x:Sn,y:Bt,wrap:Ie.wrap,fullyVisible:st})}}return be.sort((Ie,Ve)=>Ie.distanceSq-Ve.distanceSq).map(Ie=>Ie.tileID)}resize(l,h){this.width=l,this.height=h,this.pixelsToGLUnits=[2/l,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const h=s.ac(l.lat,-85.051129,Cc);return new s.P(s.N(l.lng)*this.worldSize,s.O(h)*this.worldSize)}unproject(l){return new s.Y(l.x/this.worldSize,l.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(l){const h=this.elevation,y=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,v=this.pointLocation(this.centerPoint,l),k=l.getElevationForLngLatZoom(v,this.tileZoom);if(!(this.elevation-k))return;const z=y+h-k,D=Math.cos(this._pitch)*this.cameraToCenterDistance/z/s.b3(1,v.lat),B=this.scaleZoom(D/this.tileSize);this._elevation=k,this._center=v,this.zoom=B}setLocationAtPoint(l,h){const y=this.pointCoordinate(h),v=this.pointCoordinate(this.centerPoint),k=this.locationCoordinate(l),z=new s.Y(k.x-(y.x-v.x),k.y-(y.y-v.y));this.center=this.coordinateLocation(z),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(l,h){return h?this.coordinatePoint(this.locationCoordinate(l),h.getElevationForLngLatZoom(l,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(l))}pointLocation(l,h){return this.coordinateLocation(this.pointCoordinate(l,h))}locationCoordinate(l){return s.Y.fromLngLat(l)}coordinateLocation(l){return l&&l.toLngLat()}pointCoordinate(l,h){if(h){const me=h.pointCoordinate(l);if(me!=null)return me}const y=[l.x,l.y,0,1],v=[l.x,l.y,1,1];s.af(y,y,this.pixelMatrixInverse),s.af(v,v,this.pixelMatrixInverse);const k=y[3],z=v[3],D=y[1]/k,B=v[1]/z,G=y[2]/k,Q=v[2]/z,te=G===Q?0:(0-G)/(Q-G);return new s.Y(s.z.number(y[0]/k,v[0]/z,te)/this.worldSize,s.z.number(D,B,te)/this.worldSize)}coordinatePoint(l,h=0,y=this.pixelMatrix){const v=[l.x*this.worldSize,l.y*this.worldSize,h,1];return s.af(v,v,y),new s.P(v[0]/v[3],v[1]/v[3])}getBounds(){const l=Math.max(0,this.height/2-this.getHorizon());return new We().extend(this.pointLocation(new s.P(0,l))).extend(this.pointLocation(new s.P(this.width,l))).extend(this.pointLocation(new s.P(this.width,this.height))).extend(this.pointLocation(new s.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new We([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Cc])}calculatePosMatrix(l,h=!1){const y=l.key,v=h?this._alignedPosMatrixCache:this._posMatrixCache;if(v[y])return v[y];const k=l.canonical,z=this.worldSize/this.zoomScale(k.z),D=k.x+Math.pow(2,k.z)*l.wrap,B=s.an(new Float64Array(16));return s.H(B,B,[D*z,k.y*z,0]),s.J(B,B,[z/s.W,z/s.W,1]),s.K(B,h?this.alignedProjMatrix:this.projMatrix,B),v[y]=new Float32Array(B),v[y]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(l,h){h=s.ac(+h,this.minZoom,this.maxZoom);const y={center:new s.M(l.lng,l.lat),zoom:h};let v=this.lngRange;if(!this._renderWorldCopies&&v===null){const Ie=179.9999999999;v=[-Ie,Ie]}const k=this.tileSize*this.zoomScale(y.zoom);let z=0,D=k,B=0,G=k,Q=0,te=0;const{x:me,y:Se}=this.size;if(this.latRange){const Ie=this.latRange;z=s.O(Ie[1])*k,D=s.O(Ie[0])*k,D-z<Se&&(Q=Se/(D-z))}v&&(B=s.b1(s.N(v[0])*k,0,k),G=s.b1(s.N(v[1])*k,0,k),G<B&&(G+=k),G-B<me&&(te=me/(G-B)));const{x:ke,y:Me}=this.project.call({worldSize:k},l);let be,Re;const tt=Math.max(te||0,Q||0);if(tt){const Ie=new s.P(te?(G+B)/2:ke,Q?(D+z)/2:Me);return y.center=this.unproject.call({worldSize:k},Ie).wrap(),y.zoom+=this.scaleZoom(tt),y}if(this.latRange){const Ie=Se/2;Me-Ie<z&&(Re=z+Ie),Me+Ie>D&&(Re=D-Ie)}if(v){const Ie=(B+G)/2;let Ve=ke;this._renderWorldCopies&&(Ve=s.b1(ke,Ie-k/2,Ie+k/2));const rt=me/2;Ve-rt<B&&(be=B+rt),Ve+rt>G&&(be=G-rt)}if(be!==void 0||Re!==void 0){const Ie=new s.P(be??ke,Re??Me);y.center=this.unproject.call({worldSize:k},Ie).wrap()}return y}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l=this._unmodified,{center:h,zoom:y}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=y,this._unmodified=l,this._constraining=!1}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,h=this.point.x,y=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=s.b3(1,this.center.lat)*this.worldSize;let v=s.an(new Float64Array(16));s.J(v,v,[this.width/2,-this.height/2,1]),s.H(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=s.an(new Float64Array(16)),s.J(v,v,[1,-1,1]),s.H(v,v,[-1,-1,0]),s.J(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v;const k=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),z=Math.min(this.elevation,this.minElevationForCurrentTile),D=k-z*this._pixelPerMeter/Math.cos(this._pitch),B=z<0?D:k,G=Math.PI/2+this._pitch,Q=this._fov*(.5+l.y/this.height),te=Math.sin(Q)*B/Math.sin(s.ac(Math.PI-G-Q,.01,Math.PI-.01)),me=this.getHorizon(),Se=2*Math.atan(me/this.cameraToCenterDistance)*(.5+l.y/(2*me)),ke=Math.sin(Se)*B/Math.sin(s.ac(Math.PI-G-Se,.01,Math.PI-.01)),Me=Math.min(te,ke),be=1.01*(Math.cos(Math.PI/2-this._pitch)*Me+B),Re=this.height/50;v=new Float64Array(16),s.b4(v,this._fov,this.width/this.height,Re,be),v[8]=2*-l.x/this.width,v[9]=2*l.y/this.height,s.J(v,v,[1,-1,1]),s.H(v,v,[0,0,-this.cameraToCenterDistance]),s.b5(v,v,this._pitch),s.ad(v,v,this.angle),s.H(v,v,[-h,-y,0]),this.mercatorMatrix=s.J([],v,[this.worldSize,this.worldSize,this.worldSize]),s.J(v,v,[1,1,this._pixelPerMeter]),this.pixelMatrix=s.K(new Float64Array(16),this.labelPlaneMatrix,v),s.H(v,v,[0,0,-this.elevation]),this.projMatrix=v,this.invProjMatrix=s.ar([],v),this.pixelMatrix3D=s.K(new Float64Array(16),this.labelPlaneMatrix,v);const tt=this.width%2/2,Ie=this.height%2/2,Ve=Math.cos(this.angle),rt=Math.sin(this.angle),st=h-Math.round(h)+Ve*tt+rt*Ie,ft=y-Math.round(y)+Ve*Ie+rt*tt,Ct=new Float64Array(v);if(s.H(Ct,Ct,[st>.5?st-1:st,ft>.5?ft-1:ft,0]),this.alignedProjMatrix=Ct,v=s.ar(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");this.pixelMatrixInverse=v,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const l=this.pointCoordinate(new s.P(0,0)),h=[l.x*this.worldSize,l.y*this.worldSize,0,1];return s.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,l))}getCameraQueryGeometry(l){const h=this.getCameraPoint();if(l.length===1)return[l[0],h];{let y=h.x,v=h.y,k=h.x,z=h.y;for(const D of l)y=Math.min(y,D.x),v=Math.min(v,D.y),k=Math.max(k,D.x),z=Math.max(z,D.y);return[new s.P(y,v),new s.P(k,v),new s.P(k,z),new s.P(y,z),new s.P(y,v)]}}lngLatToCameraDepth(l,h){const y=this.locationCoordinate(l),v=[y.x*this.worldSize,y.y*this.worldSize,h,1];return s.af(v,v,this.projMatrix),v[2]/v[3]}}function Mc(w,l){let h,y=!1,v=null,k=null;const z=()=>{v=null,y&&(w.apply(k,h),v=setTimeout(z,l),y=!1)};return(...D)=>(y=!0,k=this,h=D,v||z(),v)}class Ec{constructor(l){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let y;return h.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(y=v)}),(y&&y[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(y=>isNaN(y))){const y=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:y,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Mc(this._updateHashUnthrottled,300),this._hashName=l&&encodeURIComponent(l)}addTo(l){return this._map=l,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(l){const h=this._map.getCenter(),y=Math.round(100*this._map.getZoom())/100,v=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),k=Math.pow(10,v),z=Math.round(h.lng*k)/k,D=Math.round(h.lat*k)/k,B=this._map.getBearing(),G=this._map.getPitch();let Q="";if(Q+=l?`/${z}/${D}/${y}`:`${y}/${D}/${z}`,(B||G)&&(Q+="/"+Math.round(10*B)/10),G&&(Q+=`/${Math.round(G)}`),this._hashName){const te=this._hashName;let me=!1;const Se=window.location.hash.slice(1).split("&").map(ke=>{const Me=ke.split("=")[0];return Me===te?(me=!0,`${Me}=${Q}`):ke}).filter(ke=>ke);return me||Se.push(`${te}=${Q}`),`#${Se.join("&")}`}return`#${Q}`}}const fl={linearity:.3,easing:s.b6(0,0,.3,1)},Ws=s.e({deceleration:2500,maxSpeed:1400},fl),Fh=s.e({deceleration:20,maxSpeed:1400},fl),Oh=s.e({deceleration:1e3,maxSpeed:360},fl),$h=s.e({deceleration:1e3,maxSpeed:90},fl);class Bh{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,h=_.now();for(;l.length>0&&h-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:k}of this._inertiaBuffer)h.zoom+=k.zoomDelta||0,h.bearing+=k.bearingDelta||0,h.pitch+=k.pitchDelta||0,k.panDelta&&h.pan._add(k.panDelta),k.around&&(h.around=k.around),k.pinchAround&&(h.pinchAround=k.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(h.pan.mag()){const k=dl(h.pan.mag(),y,s.e({},Ws,l||{}));v.offset=h.pan.mult(k.amount/h.pan.mag()),v.center=this._map.transform.center,hl(v,k)}if(h.zoom){const k=dl(h.zoom,y,Fh);v.zoom=this._map.transform.zoom+k.amount,hl(v,k)}if(h.bearing){const k=dl(h.bearing,y,Oh);v.bearing=this._map.transform.bearing+s.ac(k.amount,-179,179),hl(v,k)}if(h.pitch){const k=dl(h.pitch,y,$h);v.pitch=this._map.transform.pitch+k.amount,hl(v,k)}if(v.zoom||v.bearing){const k=h.pinchAround===void 0?h.around:h.pinchAround;v.around=k?this._map.unproject(k):this._map.getCenter()}return this.clear(),s.e(v,{noMoveStart:!0})}}function hl(w,l){(!w.duration||w.duration<l.duration)&&(w.duration=l.duration,w.easing=l.easing)}function dl(w,l,h){const{maxSpeed:y,linearity:v,deceleration:k}=h,z=s.ac(w*v/(l/1e3),-y,y),D=Math.abs(z)/(k*v);return{easing:h.easing,duration:1e3*D,amount:z*(D/2)}}class $i extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y,v={}){const k=x.mousePos(h.getCanvas(),y),z=h.unproject(k);super(l,s.e({point:k,lngLat:z,originalEvent:y},v)),this._defaultPrevented=!1,this.target=h}}class Wo extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){const v=l==="touchend"?y.changedTouches:y.touches,k=x.touchPos(h.getCanvasContainer(),v),z=k.map(B=>h.unproject(B)),D=k.reduce((B,G,Q,te)=>B.add(G.div(te.length)),new s.P(0,0));super(l,{points:k,point:D,lngLats:z,lngLat:h.unproject(D),originalEvent:y}),this._defaultPrevented=!1}}class Lc extends s.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,h,y){super(l,{originalEvent:y}),this._defaultPrevented=!1}}class To{constructor(l,h){this._map=l,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(l){return this._firePreventable(new Lc(l.type,this._map,l))}mousedown(l,h){return this._mousedownPos=h,this._firePreventable(new $i(l.type,this._map,l))}mouseup(l){this._map.fire(new $i(l.type,this._map,l))}click(l,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new $i(l.type,this._map,l))}dblclick(l){return this._firePreventable(new $i(l.type,this._map,l))}mouseover(l){this._map.fire(new $i(l.type,this._map,l))}mouseout(l){this._map.fire(new $i(l.type,this._map,l))}touchstart(l){return this._firePreventable(new Wo(l.type,this._map,l))}touchmove(l){this._map.fire(new Wo(l.type,this._map,l))}touchend(l){this._map.fire(new Wo(l.type,this._map,l))}touchcancel(l){this._map.fire(new Wo(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Go{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(l){this._map.fire(new $i(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $i("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._ignoreContextMenu||this._map.fire(new $i(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ba{constructor(l){this._map=l}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(l){return this.transform.pointLocation(s.P.convert(l),this._map.terrain)}}class Co{constructor(l,h){this._map=l,this._tr=new ba(l),this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,h){this.isEnabled()&&l.shiftKey&&l.button===0&&(x.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(l,h){if(!this._active)return;const y=h;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=y,this._box||(this._box=x.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",l));const k=Math.min(v.x,y.x),z=Math.max(v.x,y.x),D=Math.min(v.y,y.y),B=Math.max(v.y,y.y);x.setTransform(this._box,`translate(${k}px,${D}px)`),this._box.style.width=z-k+"px",this._box.style.height=B-D+"px"}mouseupWindow(l,h){if(!this._active||l.button!==0)return;const y=this._startPos,v=h;if(this.reset(),x.suppressClick(),y.x!==v.x||y.y!==v.y)return this._map.fire(new s.k("boxzoomend",{originalEvent:l})),{cameraAnimation:k=>k.fitScreenCoordinates(y,v,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",l)}keydown(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(x.remove(this._box),this._box=null),x.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(l,h){return this._map.fire(new s.k(l,{originalEvent:h}))}}function Gs(w,l){if(w.length!==l.length)throw new Error(`The number of touches and points are not equal - touches ${w.length}, points ${l.length}`);const h={};for(let y=0;y<w.length;y++)h[w[y].identifier]=l[y];return h}class Fp{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(l,h,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),y.length===this.numTouches&&(this.centroid=function(v){const k=new s.P(0,0);for(const z of v)k._add(z);return k.div(v.length)}(h),this.touches=Gs(y,h)))}touchmove(l,h,y){if(this.aborted||!this.centroid)return;const v=Gs(y,h);for(const k in this.touches){const z=v[k];(!z||z.dist(this.touches[k])>30)&&(this.aborted=!0)}}touchend(l,h,y){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Ic{constructor(l){this.singleTap=new Fp(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(l,h,y){this.singleTap.touchstart(l,h,y)}touchmove(l,h,y){this.singleTap.touchmove(l,h,y)}touchend(l,h,y){const v=this.singleTap.touchend(l,h,y);if(v){const k=l.timeStamp-this.lastTime<500,z=!this.lastTap||this.lastTap.dist(v)<30;if(k&&z||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class Op{constructor(l){this._tr=new ba(l),this._zoomIn=new Ic({numTouches:1,numTaps:2}),this._zoomOut=new Ic({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,h,y){this._zoomIn.touchstart(l,h,y),this._zoomOut.touchstart(l,h,y)}touchmove(l,h,y){this._zoomIn.touchmove(l,h,y),this._zoomOut.touchmove(l,h,y)}touchend(l,h,y){const v=this._zoomIn.touchend(l,h,y),k=this._zoomOut.touchend(l,h,y),z=this._tr;return v?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:z.zoom+1,around:z.unproject(v)},{originalEvent:l})}):k?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:D=>D.easeTo({duration:300,zoom:z.zoom-1,around:z.unproject(k)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wa{constructor(l){this._enabled=!!l.enable,this._moveStateManager=l.moveStateManager,this._clickTolerance=l.clickTolerance||1,this._moveFunction=l.move,this._activateOnStart=!!l.activateOnStart,l.assignEvents(this),this.reset()}reset(l){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(l)}_move(...l){const h=this._moveFunction(...l);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(l,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(l)&&(this._moveStateManager.startMove(l),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(l,h){if(!this.isEnabled())return;const y=this._lastPoint;if(!y)return;if(l.preventDefault(),!this._moveStateManager.isValidMoveEvent(l))return void this.reset(l);const v=h.length?h[0]:h;return!this._moved&&v.dist(y)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=v,this._move(y,v))}dragEnd(l){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(l)&&(this._moved&&x.suppressClick(),this.reset(l))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const pl={0:1,2:2};class Zo{constructor(l){this._correctEvent=l.checkCorrectEvent}startMove(l){const h=x.mouseButton(l);this._eventButton=h}endMove(l){delete this._eventButton}isValidStartEvent(l){return this._correctEvent(l)}isValidMoveEvent(l){return!function(h,y){const v=pl[y];return h.buttons===void 0||(h.buttons&v)!==v}(l,this._eventButton)}isValidEndEvent(l){return x.mouseButton(l)===this._eventButton}}class Zt{constructor(){this._firstTouch=void 0}_isOneFingerTouch(l){return l.targetTouches.length===1}_isSameTouchEvent(l){return l.targetTouches[0].identifier===this._firstTouch}startMove(l){this._firstTouch=l.targetTouches[0].identifier}endMove(l){delete this._firstTouch}isValidStartEvent(l){return this._isOneFingerTouch(l)}isValidMoveEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}isValidEndEvent(l){return this._isOneFingerTouch(l)&&this._isSameTouchEvent(l)}}const du=w=>{w.mousedown=w.dragStart,w.mousemoveWindow=w.dragMove,w.mouseup=w.dragEnd,w.contextmenu=function(l){l.preventDefault()}},xa=({enable:w,clickTolerance:l,bearingDegreesPerPixelMoved:h=.8})=>{const y=new Zo({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new wa({clickTolerance:l,move:(v,k)=>({bearingDelta:(k.x-v.x)*h}),moveStateManager:y,enable:w,assignEvents:du})},ka=({enable:w,clickTolerance:l,pitchDegreesPerPixelMoved:h=-.5})=>{const y=new Zo({checkCorrectEvent:v=>x.mouseButton(v)===0&&v.ctrlKey||x.mouseButton(v)===2});return new wa({clickTolerance:l,move:(v,k)=>({pitchDelta:(k.y-v.y)*h}),moveStateManager:y,enable:w,assignEvents:du})};class Nh{constructor(l,h){this._clickTolerance=l.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(l,h,y){return this._calculateTransform(l,h,y)}touchmove(l,h,y){if(this._active&&!(y.length<this.minTouchs()))return l.preventDefault(),this._calculateTransform(l,h,y)}touchend(l,h,y){this._calculateTransform(l,h,y),this._active&&y.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,h,y){y.length>0&&(this._active=!0);const v=Gs(y,h),k=new s.P(0,0),z=new s.P(0,0);let D=0;for(const G in v){const Q=v[G],te=this._touches[G];te&&(k._add(Q),z._add(Q.sub(te)),D++,v[G]=Q)}if(this._touches=v,D<this.minTouchs()||!z.mag())return;const B=z.div(D);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:k.div(D),panDelta:B}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(l,h,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([h[0],h[1]]))}touchmove(l,h,y){if(!this._firstTwoTouches)return;l.preventDefault();const[v,k]=this._firstTwoTouches,z=Sa(y,h,v),D=Sa(y,h,k);if(!z||!D)return;const B=this._aroundCenter?null:z.add(D).div(2);return this._move([z,D],B,l)}touchend(l,h,y){if(!this._firstTwoTouches)return;const[v,k]=this._firstTwoTouches,z=Sa(y,h,v),D=Sa(y,h,k);z&&D||(this._active&&x.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Sa(w,l,h){for(let y=0;y<w.length;y++)if(w[y].identifier===h)return l[y]}function jh(w,l){return Math.log(w/l)/Math.LN2}class Uh extends Vt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,h){const y=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(jh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jh(this._distance,y),pinchAround:h}}}function pu(w,l){return 180*w.angleWith(l)/Math.PI}class Ac extends Vt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,h,y){const v=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pu(this._vector,v),pinchAround:h}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const h=25/(Math.PI*this._minDiameter)*360,y=pu(l,this._startVector);return Math.abs(y)<h}}function mu(w){return Math.abs(w.y)>Math.abs(w.x)}class Vh extends Vt{constructor(l){super(),this._currentTouchCount=0,this._map=l}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(l,h,y){super.touchstart(l,h,y),this._currentTouchCount=y.length}_start(l){this._lastPoints=l,mu(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,h,y){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const v=l[0].sub(this._lastPoints[0]),k=l[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(v,k,y.timeStamp),this._valid?(this._lastPoints=l,this._active=!0,{pitchDelta:(v.y+k.y)/2*-.5}):void 0}gestureBeginsVertically(l,h,y){if(this._valid!==void 0)return this._valid;const v=l.mag()>=2,k=h.mag()>=2;if(!v&&!k)return;if(!v||!k)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;const z=l.y>0==h.y>0;return mu(l)&&mu(h)&&z}}const $p={panStep:100,bearingStep:15,pitchStep:10};class Is{constructor(l){this._tr=new ba(l);const h=$p;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let h=0,y=0,v=0,k=0,z=0;switch(l.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:l.shiftKey?y=-1:(l.preventDefault(),k=-1);break;case 39:l.shiftKey?y=1:(l.preventDefault(),k=1);break;case 38:l.shiftKey?v=1:(l.preventDefault(),z=-1);break;case 40:l.shiftKey?v=-1:(l.preventDefault(),z=1);break;default:return}return this._rotationDisabled&&(y=0,v=0),{cameraAnimation:D=>{const B=this._tr;D.easeTo({duration:300,easeId:"keyboardHandler",easing:Er,zoom:h?Math.round(B.zoom)+h*(l.shiftKey?2:1):B.zoom,bearing:B.bearing+y*this._bearingStep,pitch:B.pitch+v*this._pitchStep,offset:[-k*this._panStep,-z*this._panStep],center:B.center},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Er(w){return w*(2-w)}const ml=4.000244140625;class gu{constructor(l,h){this._onTimeout=y=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(y)},this._map=l,this._tr=new ba(l),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&l.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(l){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!l[this._map.cooperativeGestures._bypassKey])return;let h=l.deltaMode===WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const y=_.now(),v=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,h!==0&&h%ml==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(v*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),l.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=l,this._delta-=h,this._active||this._start(l)),l.preventDefault()}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=x.mousePos(this._map.getCanvas(),l),y=this._tr;this._around=h.y>y.transform.height/2-y.transform.getHorizon()?s.M.convert(this._aroundCenter?y.center:y.unproject(h)):s.M.convert(y.center),this._aroundPoint=y.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._tr.transform;if(this._delta!==0){const D=this._type==="wheel"&&Math.abs(this._delta)>ml?this._wheelZoomRate:this._defaultZoomRate;let B=2/(1+Math.exp(-Math.abs(this._delta*D)));this._delta<0&&B!==0&&(B=1/B);const G=typeof this._targetZoom=="number"?l.zoomScale(this._targetZoom):l.scale;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(G*B))),this._type==="wheel"&&(this._startZoom=l.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:l.zoom,y=this._startZoom,v=this._easing;let k,z=!1;if(this._type==="wheel"&&y&&v){const D=Math.min((_.now()-this._lastWheelEventTime)/200,1),B=v(D);k=s.z.number(y,h,B),D<1?this._frameId||(this._frameId=!0):z=!0}else k=h,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:k-l.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let h=s.b7;if(this._prevEase){const y=this._prevEase,v=(_.now()-y.start)/y.duration,k=y.easing(v+.01)-y.easing(v),z=.27/Math.sqrt(k*k+1e-4)*.01,D=Math.sqrt(.0729-z*z);h=s.b6(z,D,.25,1)}return this._prevEase={start:_.now(),duration:l,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Pc{constructor(l,h){this._clickZoom=l,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qh{constructor(l){this._tr=new ba(l),this.reset()}reset(){this._active=!1}dblclick(l,h){return l.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:this._tr.zoom+(l.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hh{constructor(){this._tap=new Ic({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(l,h,y){if(!this._swipePoint)if(this._tapTime){const v=h[0],k=l.timeStamp-this._tapTime<500,z=this._tapPoint.dist(v)<30;k&&z?y.length>0&&(this._swipePoint=v,this._swipeTouch=y[0].identifier):this.reset()}else this._tap.touchstart(l,h,y)}touchmove(l,h,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const v=h[0],k=v.y-this._swipePoint.y;return this._swipePoint=v,l.preventDefault(),this._active=!0,{zoomDelta:k/128}}}else this._tap.touchmove(l,h,y)}touchend(l,h,y){if(this._tapTime)this._swipePoint&&y.length===0&&this.reset();else{const v=this._tap.touchend(l,h,y);v&&(this._tapTime=l.timeStamp,this._tapPoint=v)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wh{constructor(l,h,y){this._el=l,this._mousePan=h,this._touchPan=y}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mo{constructor(l,h,y){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=h,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gl{constructor(l,h,y,v){this._el=l,this._touchZoom=h,this._touchRotate=y,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class sn{constructor(l,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=l,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const l=this._map.getCanvasContainer();l.classList.add("maplibregl-cooperative-gestures"),this._container=x.create("div","maplibregl-cooperative-gesture-screen",l);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const y=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),v=document.createElement("div");v.className="maplibregl-desktop-message",v.textContent=h,this._container.appendChild(v);const k=document.createElement("div");k.className="maplibregl-mobile-message",k.textContent=y,this._container.appendChild(k),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(x.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(l){this._onCooperativeGesture(l.touches.length===1)}wheel(l){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!l[this._bypassKey])}_onCooperativeGesture(l){this._enabled&&l&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const hn=w=>w.zoom||w.drag||w.pitch||w.rotate;class _u extends s.k{}function _l(w){return w.panDelta&&w.panDelta.mag()||w.zoomDelta||w.bearingDelta||w.pitchDelta}class zc{constructor(l,h){this.handleWindowEvent=v=>{this.handleEvent(v,`${v.type}Window`)},this.handleEvent=(v,k)=>{if(v.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const z=v.type==="renderFrame"?void 0:v,D={needsRenderFrame:!1},B={},G={},Q=v.touches,te=Q?this._getMapTouches(Q):void 0,me=te?x.touchPos(this._map.getCanvas(),te):x.mousePos(this._map.getCanvas(),v);for(const{handlerName:Me,handler:be,allowed:Re}of this._handlers){if(!be.isEnabled())continue;let tt;this._blockedByActive(G,Re,Me)?be.reset():be[k||v.type]&&(tt=be[k||v.type](v,me,te),this.mergeHandlerResult(D,B,tt,Me,z),tt&&tt.needsRenderFrame&&this._triggerRenderFrame()),(tt||be.isActive())&&(G[Me]=be)}const Se={};for(const Me in this._previousActiveHandlers)G[Me]||(Se[Me]=z);this._previousActiveHandlers=G,(Object.keys(Se).length||_l(D))&&(this._changes.push([D,B,Se]),this._triggerRenderFrame()),(Object.keys(G).length||_l(D))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ke}=D;ke&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ke(this._map))},this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Bh(l),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[v,k,z]of this._listeners)x.addEventListener(v,k,v===document?this.handleWindowEvent:this.handleEvent,z)}destroy(){for(const[l,h,y]of this._listeners)x.removeEventListener(l,h,l===document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(l){const h=this._map,y=h.getCanvasContainer();this._add("mapEvent",new To(h,l));const v=h.boxZoom=new Co(h,l);this._add("boxZoom",v),l.interactive&&l.boxZoom&&v.enable();const k=h.cooperativeGestures=new sn(h,l.cooperativeGestures);this._add("cooperativeGestures",k),l.cooperativeGestures&&k.enable();const z=new Op(h),D=new qh(h);h.doubleClickZoom=new Pc(D,z),this._add("tapZoom",z),this._add("clickZoom",D),l.interactive&&l.doubleClickZoom&&h.doubleClickZoom.enable();const B=new Hh;this._add("tapDragZoom",B);const G=h.touchPitch=new Vh(h);this._add("touchPitch",G),l.interactive&&l.touchPitch&&h.touchPitch.enable(l.touchPitch);const Q=xa(l),te=ka(l);h.dragRotate=new Mo(l,Q,te),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",te,["mouseRotate"]),l.interactive&&l.dragRotate&&h.dragRotate.enable();const me=(({enable:tt,clickTolerance:Ie})=>{const Ve=new Zo({checkCorrectEvent:rt=>x.mouseButton(rt)===0&&!rt.ctrlKey});return new wa({clickTolerance:Ie,move:(rt,st)=>({around:st,panDelta:st.sub(rt)}),activateOnStart:!0,moveStateManager:Ve,enable:tt,assignEvents:du})})(l),Se=new Nh(l,h);h.dragPan=new Wh(y,me,Se),this._add("mousePan",me),this._add("touchPan",Se,["touchZoom","touchRotate"]),l.interactive&&l.dragPan&&h.dragPan.enable(l.dragPan);const ke=new Ac,Me=new Uh;h.touchZoomRotate=new gl(y,Me,ke,B),this._add("touchRotate",ke,["touchPan","touchZoom"]),this._add("touchZoom",Me,["touchPan","touchRotate"]),l.interactive&&l.touchZoomRotate&&h.touchZoomRotate.enable(l.touchZoomRotate);const be=h.scrollZoom=new gu(h,()=>this._triggerRenderFrame());this._add("scrollZoom",be,["mousePan"]),l.interactive&&l.scrollZoom&&h.scrollZoom.enable(l.scrollZoom);const Re=h.keyboard=new Is(h);this._add("keyboard",Re),l.interactive&&l.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Go(h))}_add(l,h,y){this._handlers.push({handlerName:l,handler:h,allowed:y}),this._handlersById[l]=h}stop(l){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!hn(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,h,y){for(const v in l)if(v!==y&&(!h||h.indexOf(v)<0))return!0;return!1}_getMapTouches(l){const h=[];for(const y of l)this._el.contains(y.target)&&h.push(y);return h}mergeHandlerResult(l,h,y,v,k){if(!y)return;s.e(l,y);const z={handlerName:v,originalEvent:y.originalEvent||k};y.zoomDelta!==void 0&&(h.zoom=z),y.panDelta!==void 0&&(h.drag=z),y.pitchDelta!==void 0&&(h.pitch=z),y.bearingDelta!==void 0&&(h.rotate=z)}_applyChanges(){const l={},h={},y={};for(const[v,k,z]of this._changes)v.panDelta&&(l.panDelta=(l.panDelta||new s.P(0,0))._add(v.panDelta)),v.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(l.around=v.around),v.pinchAround!==void 0&&(l.pinchAround=v.pinchAround),v.noInertia&&(l.noInertia=v.noInertia),s.e(h,k),s.e(y,z);this._updateMapTransform(l,h,y),this._changes=[]}_updateMapTransform(l,h,y){const v=this._map,k=v._getTransformForUpdate(),z=v.terrain;if(!(_l(l)||z&&this._terrainMovement))return this._fireEvents(h,y,!0);let{panDelta:D,zoomDelta:B,bearingDelta:G,pitchDelta:Q,around:te,pinchAround:me}=l;me!==void 0&&(te=me),v._stop(!0),te=te||v.transform.centerPoint;const Se=k.pointLocation(D?te.sub(D):te);G&&(k.bearing+=G),Q&&(k.pitch+=Q),B&&(k.zoom+=B),z?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?k.center=k.pointLocation(k.centerPoint.sub(D)):k.setLocationAtPoint(Se,te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,k.setLocationAtPoint(Se,te),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,k.recalculateZoom(v.terrain)})):k.setLocationAtPoint(Se,te),v._applyUpdatedTransform(k),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(h,y,!0)}_fireEvents(l,h,y){const v=hn(this._eventsInProgress),k=hn(l),z={};for(const Q in l){const{originalEvent:te}=l[Q];this._eventsInProgress[Q]||(z[`${Q}start`]=te),this._eventsInProgress[Q]=l[Q]}!v&&k&&this._fireEvent("movestart",k.originalEvent);for(const Q in z)this._fireEvent(Q,z[Q]);k&&this._fireEvent("move",k.originalEvent);for(const Q in l){const{originalEvent:te}=l[Q];this._fireEvent(Q,te)}const D={};let B;for(const Q in this._eventsInProgress){const{handlerName:te,originalEvent:me}=this._eventsInProgress[Q];this._handlersById[te].isActive()||(delete this._eventsInProgress[Q],B=h[te]||me,D[`${Q}end`]=B)}for(const Q in D)this._fireEvent(Q,D[Q]);const G=hn(this._eventsInProgress);if(y&&(v||k)&&!G){this._updatingCamera=!0;const Q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),te=me=>me!==0&&-this._bearingSnap<me&&me<this._bearingSnap;!Q||!Q.essential&&_.prefersReducedMotion?(this._map.fire(new s.k("moveend",{originalEvent:B})),te(this._map.getBearing())&&this._map.resetNorth()):(te(Q.bearing||this._map.getBearing())&&(Q.bearing=0),Q.freezeElevation=!0,this._map.easeTo(Q,{originalEvent:B})),this._updatingCamera=!1}}_fireEvent(l,h){this._map.fire(new s.k(l,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{delete this._frameId,this.handleEvent(new _u("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Bi extends s.E{constructor(l,h){super(),this._renderFrameCallback=()=>{const y=Math.min((_.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(y)),y<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new s.M(this.transform.center.lng,this.transform.center.lat)}setCenter(l,h){return this.jumpTo({center:l},h)}panBy(l,h,y){return l=s.P.convert(l).mult(-1),this.panTo(this.transform.center,s.e({offset:l},h),y)}panTo(l,h,y){return this.easeTo(s.e({center:l},h),y)}getZoom(){return this.transform.zoom}setZoom(l,h){return this.jumpTo({zoom:l},h),this}zoomTo(l,h,y){return this.easeTo(s.e({zoom:l},h),y)}zoomIn(l,h){return this.zoomTo(this.getZoom()+1,l,h),this}zoomOut(l,h){return this.zoomTo(this.getZoom()-1,l,h),this}getBearing(){return this.transform.bearing}setBearing(l,h){return this.jumpTo({bearing:l},h),this}getPadding(){return this.transform.padding}setPadding(l,h){return this.jumpTo({padding:l},h),this}rotateTo(l,h,y){return this.easeTo(s.e({bearing:l},h),y)}resetNorth(l,h){return this.rotateTo(0,s.e({duration:1e3},l),h),this}resetNorthPitch(l,h){return this.easeTo(s.e({bearing:0,pitch:0,duration:1e3},l),h),this}snapToNorth(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this}getPitch(){return this.transform.pitch}setPitch(l,h){return this.jumpTo({pitch:l},h),this}cameraForBounds(l,h){l=We.convert(l);const y=h&&h.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),y,h)}_cameraForBoxAndBearing(l,h,y,v){const k={top:0,bottom:0,right:0,left:0};if(typeof(v=s.e({padding:k,offset:[0,0],maxZoom:this.transform.maxZoom},v)).padding=="number"){const $t=v.padding;v.padding={top:$t,bottom:$t,right:$t,left:$t}}v.padding=s.e(k,v.padding);const z=this.transform,D=z.padding,B=new We(l,h),G=z.project(B.getNorthWest()),Q=z.project(B.getNorthEast()),te=z.project(B.getSouthEast()),me=z.project(B.getSouthWest()),Se=s.b8(-y),ke=G.rotate(Se),Me=Q.rotate(Se),be=te.rotate(Se),Re=me.rotate(Se),tt=new s.P(Math.max(ke.x,Me.x,Re.x,be.x),Math.max(ke.y,Me.y,Re.y,be.y)),Ie=new s.P(Math.min(ke.x,Me.x,Re.x,be.x),Math.min(ke.y,Me.y,Re.y,be.y)),Ve=tt.sub(Ie),rt=(z.width-(D.left+D.right+v.padding.left+v.padding.right))/Ve.x,st=(z.height-(D.top+D.bottom+v.padding.top+v.padding.bottom))/Ve.y;if(st<0||rt<0)return void s.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ft=Math.min(z.scaleZoom(z.scale*Math.min(rt,st)),v.maxZoom),Ct=s.P.convert(v.offset),wt=new s.P((v.padding.left-v.padding.right)/2,(v.padding.top-v.padding.bottom)/2).rotate(s.b8(y)),Ft=Ct.add(wt).mult(z.scale/z.zoomScale(ft));return{center:z.unproject(G.add(te).div(2).sub(Ft)),zoom:ft,bearing:y}}fitBounds(l,h,y){return this._fitInternal(this.cameraForBounds(l,h),h,y)}fitScreenCoordinates(l,h,y,v,k){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(s.P.convert(l)),this.transform.pointLocation(s.P.convert(h)),y,v),v,k)}_fitInternal(l,h,y){return l?(delete(h=s.e(l,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this}jumpTo(l,h){this.stop();const y=this._getTransformForUpdate();let v=!1,k=!1,z=!1;return"zoom"in l&&y.zoom!==+l.zoom&&(v=!0,y.zoom=+l.zoom),l.center!==void 0&&(y.center=s.M.convert(l.center)),"bearing"in l&&y.bearing!==+l.bearing&&(k=!0,y.bearing=+l.bearing),"pitch"in l&&y.pitch!==+l.pitch&&(z=!0,y.pitch=+l.pitch),l.padding==null||y.isPaddingEqual(l.padding)||(y.padding=l.padding),this._applyUpdatedTransform(y),this.fire(new s.k("movestart",h)).fire(new s.k("move",h)),v&&this.fire(new s.k("zoomstart",h)).fire(new s.k("zoom",h)).fire(new s.k("zoomend",h)),k&&this.fire(new s.k("rotatestart",h)).fire(new s.k("rotate",h)).fire(new s.k("rotateend",h)),z&&this.fire(new s.k("pitchstart",h)).fire(new s.k("pitch",h)).fire(new s.k("pitchend",h)),this.fire(new s.k("moveend",h))}calculateCameraOptionsFromTo(l,h,y,v=0){const k=s.Y.fromLngLat(l,h),z=s.Y.fromLngLat(y,v),D=z.x-k.x,B=z.y-k.y,G=z.z-k.z,Q=Math.hypot(D,B,G);if(Q===0)throw new Error("Can't calculate camera options with same From and To");const te=Math.hypot(D,B),me=this.transform.scaleZoom(this.transform.cameraToCenterDistance/Q/this.transform.tileSize),Se=180*Math.atan2(D,-B)/Math.PI;let ke=180*Math.acos(te/Q)/Math.PI;return ke=G<0?90-ke:90+ke,{center:z.toLngLat(),zoom:me,pitch:ke,bearing:Se}}easeTo(l,h){var y;this._stop(!1,l.easeId),((l=s.e({offset:[0,0],duration:500,easing:s.b7},l)).animate===!1||!l.essential&&_.prefersReducedMotion)&&(l.duration=0);const v=this._getTransformForUpdate(),k=this.getZoom(),z=this.getBearing(),D=this.getPitch(),B=this.getPadding(),G="bearing"in l?this._normalizeBearing(l.bearing,z):z,Q="pitch"in l?+l.pitch:D,te="padding"in l?l.padding:v.padding,me=s.P.convert(l.offset);let Se=v.centerPoint.add(me);const ke=v.pointLocation(Se),{center:Me,zoom:be}=v.getConstrained(s.M.convert(l.center||ke),(y=l.zoom)!==null&&y!==void 0?y:k);this._normalizeCenter(Me);const Re=v.project(ke),tt=v.project(Me).sub(Re),Ie=v.zoomScale(be-k);let Ve,rt;l.around&&(Ve=s.M.convert(l.around),rt=v.locationPoint(Ve));const st={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==k,this._rotating=this._rotating||z!==G,this._pitching=this._pitching||Q!==D,this._padding=!v.isPaddingEqual(te),this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,st),this.terrain&&this._prepareElevation(Me),this._ease(ft=>{if(this._zooming&&(v.zoom=s.z.number(k,be,ft)),this._rotating&&(v.bearing=s.z.number(z,G,ft)),this._pitching&&(v.pitch=s.z.number(D,Q,ft)),this._padding&&(v.interpolatePadding(B,te,ft),Se=v.centerPoint.add(me)),this.terrain&&!l.freezeElevation&&this._updateElevation(ft),Ve)v.setLocationAtPoint(Ve,rt);else{const Ct=v.zoomScale(v.zoom-k),wt=be>k?Math.min(2,Ie):Math.max(.5,Ie),Ft=Math.pow(wt,1-ft),$t=v.unproject(Re.add(tt.mult(ft*Ft)).mult(Ct));v.setLocationAtPoint(v.renderWorldCopies?$t.wrap():$t,Se)}this._applyUpdatedTransform(v),this._fireMoveEvents(h)},ft=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,ft)},l),this}_prepareEase(l,h,y={}){this._moving=!0,h||y.moving||this.fire(new s.k("movestart",l)),this._zooming&&!y.zooming&&this.fire(new s.k("zoomstart",l)),this._rotating&&!y.rotating&&this.fire(new s.k("rotatestart",l)),this._pitching&&!y.pitching&&this.fire(new s.k("pitchstart",l))}_prepareElevation(l){this._elevationCenter=l,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(l,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(l){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(l<1&&h!==this._elevationTarget){const y=this._elevationTarget-this._elevationStart;this._elevationStart+=l*(y-(h-(y*l+this._elevationStart))/(1-l)),this._elevationTarget=h}this.transform.elevation=s.z.number(this._elevationStart,this._elevationTarget,l)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(l){if(!this.transformCameraUpdate)return;const h=l.clone(),{center:y,zoom:v,pitch:k,bearing:z,elevation:D}=this.transformCameraUpdate(h);y&&(h.center=y),v!==void 0&&(h.zoom=v),k!==void 0&&(h.pitch=k),z!==void 0&&(h.bearing=z),D!==void 0&&(h.elevation=D),this.transform.apply(h)}_fireMoveEvents(l){this.fire(new s.k("move",l)),this._zooming&&this.fire(new s.k("zoom",l)),this._rotating&&this.fire(new s.k("rotate",l)),this._pitching&&this.fire(new s.k("pitch",l))}_afterEase(l,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const y=this._zooming,v=this._rotating,k=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new s.k("zoomend",l)),v&&this.fire(new s.k("rotateend",l)),k&&this.fire(new s.k("pitchend",l)),this.fire(new s.k("moveend",l))}flyTo(l,h){var y;if(!l.essential&&_.prefersReducedMotion){const qn=s.L(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qn,h)}this.stop(),l=s.e({offset:[0,0],speed:1.2,curve:1.42,easing:s.b7},l);const v=this._getTransformForUpdate(),k=this.getZoom(),z=this.getBearing(),D=this.getPitch(),B=this.getPadding(),G="bearing"in l?this._normalizeBearing(l.bearing,z):z,Q="pitch"in l?+l.pitch:D,te="padding"in l?l.padding:v.padding,me=s.P.convert(l.offset);let Se=v.centerPoint.add(me);const ke=v.pointLocation(Se),{center:Me,zoom:be}=v.getConstrained(s.M.convert(l.center||ke),(y=l.zoom)!==null&&y!==void 0?y:k);this._normalizeCenter(Me);const Re=v.zoomScale(be-k),tt=v.project(ke),Ie=v.project(Me).sub(tt);let Ve=l.curve;const rt=Math.max(v.width,v.height),st=rt/Re,ft=Ie.mag();if("minZoom"in l){const qn=s.ac(Math.min(l.minZoom,k,be),v.minZoom,v.maxZoom),kn=rt/v.zoomScale(qn-k);Ve=Math.sqrt(kn/ft*2)}const Ct=Ve*Ve;function wt(qn){const kn=(st*st-rt*rt+(qn?-1:1)*Ct*Ct*ft*ft)/(2*(qn?st:rt)*Ct*ft);return Math.log(Math.sqrt(kn*kn+1)-kn)}function Ft(qn){return(Math.exp(qn)-Math.exp(-qn))/2}function $t(qn){return(Math.exp(qn)+Math.exp(-qn))/2}const Sn=wt(!1);let Bt=function(qn){return $t(Sn)/$t(Sn+Ve*qn)},gn=function(qn){return rt*(($t(Sn)*(Ft(kn=Sn+Ve*qn)/$t(kn))-Ft(Sn))/Ct)/ft;var kn},Tn=(wt(!0)-Sn)/Ve;if(Math.abs(ft)<1e-6||!isFinite(Tn)){if(Math.abs(rt-st)<1e-6)return this.easeTo(l,h);const qn=st<rt?-1:1;Tn=Math.abs(Math.log(st/rt))/Ve,gn=function(){return 0},Bt=function(kn){return Math.exp(qn*Ve*kn)}}return l.duration="duration"in l?+l.duration:1e3*Tn/("screenSpeed"in l?+l.screenSpeed/Ve:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=z!==G,this._pitching=Q!==D,this._padding=!v.isPaddingEqual(te),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(Me),this._ease(qn=>{const kn=qn*Tn,En=1/Bt(kn);v.zoom=qn===1?be:k+v.scaleZoom(En),this._rotating&&(v.bearing=s.z.number(z,G,qn)),this._pitching&&(v.pitch=s.z.number(D,Q,qn)),this._padding&&(v.interpolatePadding(B,te,qn),Se=v.centerPoint.add(me)),this.terrain&&!l.freezeElevation&&this._updateElevation(qn);const Rn=qn===1?Me:v.unproject(tt.add(Ie.mult(gn(kn))).mult(En));v.setLocationAtPoint(v.renderWorldCopies?Rn.wrap():Rn,Se),this._applyUpdatedTransform(v),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}if(!l){const y=this.handlers;y&&y.stop(!1)}return this}_ease(l,h,y){y.animate===!1||y.duration===0?(l(1),h()):(this._easeStart=_.now(),this._easeOptions=y,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(l,h){l=s.b1(l,-180,180);const y=Math.abs(l-h);return Math.abs(l-360-h)<y&&(l-=360),Math.abs(l+360-h)<y&&(l+=360),l}_normalizeCenter(l){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const y=l.lng-h.center.lng;l.lng+=y>180?-360:y<-180?360:0}queryTerrainElevation(l){return this.terrain?this.terrain.getElevationForLngLatZoom(s.M.convert(l),this.transform.tileZoom)-this.transform.elevation:null}}const Dc={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Eo{constructor(l=Dc){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=l}getDefaultPosition(){return"bottom-right"}onAdd(l){return this._map=l,this._compact=this.options.compact,this._container=x.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=x.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=x.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){x.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(l,h){const y=this._map._getUIString(`AttributionControl.${h}`);l.title=y,l.setAttribute("aria-label",y)}_updateAttributions(){if(!this._map.style)return;let l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(v=>typeof v!="string"?"":v)):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const h=this._map.style.sourceCaches;for(const v in h){const k=h[v];if(k.used||k.usedForTerrain){const z=k.getSource();z.attribution&&l.indexOf(z.attribution)<0&&l.push(z.attribution)}}l=l.filter(v=>String(v).trim()),l.sort((v,k)=>v.length-k.length),l=l.filter((v,k)=>{for(let z=k+1;z<l.length;z++)if(l[z].indexOf(v)>=0)return!1;return!0});const y=l.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,l.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Gh{constructor(l={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const y=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&y.classList.add("maplibregl-compact"):y.classList.remove("maplibregl-compact")}},this.options=l}getDefaultPosition(){return"bottom-left"}onAdd(l){this._map=l,this._compact=this.options&&this.options.compact,this._container=x.create("div","maplibregl-ctrl");const h=x.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){x.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class yl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const h=++this._id;return this._queue.push({callback:l,id:h,cancelled:!1}),h}remove(l){const h=this._currentlyRunning,y=h?this._queue.concat(h):this._queue;for(const v of y)if(v.id===l)return void(v.cancelled=!0)}run(l=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const y of h)if(!y.cancelled&&(y.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Nr=s.X([{name:"a_pos3d",type:"Int16",components:3}]);class Gr extends s.E{constructor(l){super(),this.sourceCache=l,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,l.usedForTerrain=!0,l.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(l,h){this.sourceCache.update(l,h),this._renderableTilesKeys=[];const y={};for(const v of l.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))y[v.key]=!0,this._renderableTilesKeys.push(v.key),this._tiles[v.key]||(v.posMatrix=new Float64Array(16),s.aN(v.posMatrix,0,s.W,0,s.W,0,1),this._tiles[v.key]=new Pr(v,this.tileSize));for(const v in this._tiles)y[v]||delete this._tiles[v]}freeRtt(l){for(const h in this._tiles){const y=this._tiles[h];(!l||y.tileID.equals(l)||y.tileID.isChildOf(l)||l.isChildOf(y.tileID))&&(y.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(l=>this.getTileByID(l))}getTileByID(l){return this._tiles[l]}getTerrainCoords(l){const h={};for(const y of this._renderableTilesKeys){const v=this._tiles[y].tileID;if(v.canonical.equals(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16),s.aN(k.posMatrix,0,s.W,0,s.W,0,1),h[y]=k}else if(v.canonical.isChildOf(l.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const z=v.canonical.z-l.canonical.z,D=v.canonical.x-(v.canonical.x>>z<<z),B=v.canonical.y-(v.canonical.y>>z<<z),G=s.W>>z;s.aN(k.posMatrix,0,G,0,G,0,1),s.H(k.posMatrix,k.posMatrix,[-D*G,-B*G,0]),h[y]=k}else if(l.canonical.isChildOf(v.canonical)){const k=l.clone();k.posMatrix=new Float64Array(16);const z=l.canonical.z-v.canonical.z,D=l.canonical.x-(l.canonical.x>>z<<z),B=l.canonical.y-(l.canonical.y>>z<<z),G=s.W>>z;s.aN(k.posMatrix,0,s.W,0,s.W,0,1),s.H(k.posMatrix,k.posMatrix,[D*G,B*G,0]),s.J(k.posMatrix,k.posMatrix,[1/2**z,1/2**z,0]),h[y]=k}}return h}getSourceTile(l,h){const y=this.sourceCache._source;let v=l.overscaledZ-this.deltaZoom;if(v>y.maxzoom&&(v=y.maxzoom),v<y.minzoom)return null;this._sourceTileCache[l.key]||(this._sourceTileCache[l.key]=l.scaledTo(v).key);let k=this.sourceCache.getTileByID(this._sourceTileCache[l.key]);if((!k||!k.dem)&&h)for(;v>=y.minzoom&&(!k||!k.dem);)k=this.sourceCache.getTileByID(l.scaledTo(v--).key);return k}tilesAfterTime(l=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=l)}}class Zh{constructor(l,h,y){this.painter=l,this.sourceCache=new Gr(h),this.options=y,this.exaggeration=typeof y.exaggeration=="number"?y.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(l,h,y,v=s.W){var k;if(!(h>=0&&h<v&&y>=0&&y<v))return 0;const z=this.getTerrainData(l),D=(k=z.tile)===null||k===void 0?void 0:k.dem;if(!D)return 0;const B=function(ke,Me,be){var Re=Me[0],tt=Me[1];return ke[0]=be[0]*Re+be[4]*tt+be[12],ke[1]=be[1]*Re+be[5]*tt+be[13],ke}([],[h/v*s.W,y/v*s.W],z.u_terrain_matrix),G=[B[0]*D.dim,B[1]*D.dim],Q=Math.floor(G[0]),te=Math.floor(G[1]),me=G[0]-Q,Se=G[1]-te;return D.get(Q,te)*(1-me)*(1-Se)+D.get(Q+1,te)*me*(1-Se)+D.get(Q,te+1)*(1-me)*Se+D.get(Q+1,te+1)*me*Se}getElevationForLngLatZoom(l,h){const{tileID:y,mercatorX:v,mercatorY:k}=this._getOverscaledTileIDFromLngLatZoom(l,h);return this.getElevation(y,v%s.W,k%s.W,s.W)}getElevation(l,h,y,v=s.W){return this.getDEMElevation(l,h,y,v)*this.exaggeration}getTerrainData(l){if(!this._emptyDemTexture){const v=this.painter.context,k=new s.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ee(v,k,v.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ee(v,new s.R({width:1,height:1}),v.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=s.an([])}const h=this.sourceCache.getSourceTile(l,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const v=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new ee(v,h.dem.getPixels(),v.gl.RGBA,{premultiply:!1}),h.demTexture.bind(v.gl.NEAREST,v.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const y=h&&h+h.tileID.key+l.key;if(y&&!this._demMatrixCache[y]){const v=this.sourceCache.sourceCache._source.maxzoom;let k=l.canonical.z-h.tileID.canonical.z;l.overscaledZ>l.canonical.z&&(l.canonical.z>=v?k=l.canonical.z-v:s.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const z=l.canonical.x-(l.canonical.x>>k<<k),D=l.canonical.y-(l.canonical.y>>k<<k),B=s.b9(new Float64Array(16),[1/(s.W<<k),1/(s.W<<k),0]);s.H(B,B,[z*s.W,D*s.W,0]),this._demMatrixCache[l.key]={matrix:B,coord:l}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:y?this._demMatrixCache[l.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(l){const h=this.painter,y=h.width/devicePixelRatio,v=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===y&&this._fbo.height===v||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ee(h.context,{width:y,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ee(h.context,{width:y,height:v,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(y,v,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,y,v))),this._fbo.colorAttachment.set(l==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const l=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let k=0,z=0;k<this._coordsTextureSize;k++)for(let D=0;D<this._coordsTextureSize;D++,z+=4)h[z+0]=255&D,h[z+1]=255&k,h[z+2]=D>>8<<4|k>>8,h[z+3]=0;const y=new s.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),v=new ee(l,y,l.gl.RGBA,{premultiply:!1});return v.bind(l.gl.NEAREST,l.gl.CLAMP_TO_EDGE),this._coordsTexture=v,v}pointCoordinate(l){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),y=this.painter.context,v=y.gl,k=Math.round(l.x*this.painter.pixelRatio/devicePixelRatio),z=Math.round(l.y*this.painter.pixelRatio/devicePixelRatio),D=Math.round(this.painter.height/devicePixelRatio);y.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),v.readPixels(k,D-z-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),y.bindFramebuffer.set(null);const B=h[0]+(h[2]>>4<<8),G=h[1]+((15&h[2])<<8),Q=this.coordsIndex[255-h[3]],te=Q&&this.sourceCache.getTileByID(Q);if(!te)return null;const me=this._coordsTextureSize,Se=(1<<te.tileID.canonical.z)*me;return new s.Y((te.tileID.canonical.x*me+B)/Se+te.tileID.wrap,(te.tileID.canonical.y*me+G)/Se,this.getElevation(te.tileID,B,G,me))}depthAtPoint(l){const h=new Uint8Array(4),y=this.painter.context,v=y.gl;return y.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),v.readPixels(l.x,this.painter.height/devicePixelRatio-l.y-1,1,1,v.RGBA,v.UNSIGNED_BYTE,h),y.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const l=this.painter.context,h=new s.ba,y=new s.aX,v=this.meshSize,k=s.W/v,z=v*v;for(let te=0;te<=v;te++)for(let me=0;me<=v;me++)h.emplaceBack(me*k,te*k,0);for(let te=0;te<z;te+=v+1)for(let me=0;me<v;me++)y.emplaceBack(me+te,v+me+te+1,v+me+te+2),y.emplaceBack(me+te,v+me+te+2,me+te+1);const D=h.length,B=D+2*(v+1);for(const te of[0,1])for(let me=0;me<=v;me++)for(const Se of[0,1])h.emplaceBack(me*k,te*s.W,Se);for(let te=0;te<2*v;te+=2)y.emplaceBack(B+te,B+te+1,B+te+3),y.emplaceBack(B+te,B+te+3,B+te+2),y.emplaceBack(D+te,D+te+3,D+te+1),y.emplaceBack(D+te,D+te+2,D+te+3);const G=h.length,Q=G+2*(v+1);for(const te of[0,1])for(let me=0;me<=v;me++)for(const Se of[0,1])h.emplaceBack(te*s.W,me*k,Se);for(let te=0;te<2*v;te+=2)y.emplaceBack(G+te,G+te+1,G+te+3),y.emplaceBack(G+te,G+te+3,G+te+2),y.emplaceBack(Q+te,Q+te+3,Q+te+1),y.emplaceBack(Q+te,Q+te+2,Q+te+3);return this._mesh={indexBuffer:l.createIndexBuffer(y),vertexBuffer:l.createVertexBuffer(h,Nr.members),segments:s.$.simpleSegment(0,0,h.length,y.length)},this._mesh}getMeshFrameDelta(l){return 2*Math.PI*s.bb/Math.pow(2,l)/5}getMinTileElevationForLngLatZoom(l,h){var y;const{tileID:v}=this._getOverscaledTileIDFromLngLatZoom(l,h);return(y=this.getMinMaxElevation(v).minElevation)!==null&&y!==void 0?y:0}getMinMaxElevation(l){const h=this.getTerrainData(l).tile,y={minElevation:null,maxElevation:null};return h&&h.dem&&(y.minElevation=h.dem.min*this.exaggeration,y.maxElevation=h.dem.max*this.exaggeration),y}_getOverscaledTileIDFromLngLatZoom(l,h){const y=s.Y.fromLngLat(l.wrap()),v=(1<<h)*s.W,k=y.x*v,z=y.y*v,D=Math.floor(k/s.W),B=Math.floor(z/s.W);return{tileID:new s.Q(h,0,h,D,B),mercatorX:k,mercatorY:z}}}class vl{constructor(l,h,y){this._context=l,this._size=h,this._tileSize=y,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const l of this._objects)l.texture.destroy(),l.fbo.destroy()}_createObject(l){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),y=new ee(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return y.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(y.texture),{id:l,fbo:h,texture:y,stamp:-1,inUse:!1}}getObjectForId(l){return this._objects[l]}useObject(l){l.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>l.id!==h),this._recentlyUsed.push(l.id)}stampObject(l){l.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const l=this._createObject(this._objects.length);return this._objects.push(l),l}freeObject(l){l.inUse=!1}freeAllObjects(){for(const l of this._objects)this.freeObject(l)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(l=>!l.inUse)===!1}}const cs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Rc{constructor(l,h){this.painter=l,this.terrain=h,this.pool=new vl(l.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(l){return this.pool.getObjectForId(l.rtt[this._stacks.length-1].id).texture}prepareForRender(l,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=l._order.filter(y=>!l._layers[y].isHidden(h)),this._coordsDescendingInv={};for(const y in l.sourceCaches){this._coordsDescendingInv[y]={};const v=l.sourceCaches[y].getVisibleCoordinates();for(const k of v){const z=this.terrain.sourceCache.getTerrainCoords(k);for(const D in z)this._coordsDescendingInv[y][D]||(this._coordsDescendingInv[y][D]=[]),this._coordsDescendingInv[y][D].push(z[D])}}this._coordsDescendingInvStr={};for(const y of l._order){const v=l._layers[y],k=v.source;if(cs[v.type]&&!this._coordsDescendingInvStr[k]){this._coordsDescendingInvStr[k]={};for(const z in this._coordsDescendingInv[k])this._coordsDescendingInvStr[k][z]=this._coordsDescendingInv[k][z].map(D=>D.key).sort().join()}}for(const y of this._renderableTiles)for(const v in this._coordsDescendingInvStr){const k=this._coordsDescendingInvStr[v][y.tileID.key];k&&k!==y.rttCoords[v]&&(y.rtt=[])}}renderLayer(l){if(l.isHidden(this.painter.transform.zoom))return!1;const h=l.type,y=this.painter,v=this._renderableLayerIds[this._renderableLayerIds.length-1]===l.id;if(cs[h]&&(this._prevType&&cs[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(l.id),!v))return!0;if(cs[this._prevType]||cs[h]&&v){this._prevType=h;const k=this._stacks.length-1,z=this._stacks[k]||[];for(const D of this._renderableTiles){if(this.pool.isFull()&&(fu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(D),D.rtt[k]){const G=this.pool.getObjectForId(D.rtt[k].id);if(G.stamp===D.rtt[k].stamp){this.pool.useObject(G);continue}}const B=this.pool.getOrCreateFreeObject();this.pool.useObject(B),this.pool.stampObject(B),D.rtt[k]={id:B.id,stamp:B.stamp},y.context.bindFramebuffer.set(B.fbo.framebuffer),y.context.clear({color:s.aO.transparent,stencil:0}),y.currentStencilSource=void 0;for(let G=0;G<z.length;G++){const Q=y.style._layers[z[G]],te=Q.source?this._coordsDescendingInv[Q.source][D.tileID.key]:[D.tileID];y.context.viewport.set([0,0,B.fbo.width,B.fbo.height]),y._renderTileClippingMasks(Q,te),y.renderLayer(y,y.style.sourceCaches[Q.source],Q,te),Q.source&&(D.rttCoords[Q.source]=this._coordsDescendingInvStr[Q.source][D.tileID.key])}}return fu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),cs[h]}return!1}}const Fc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Oc=d,bl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Dc,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:s.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},yu=w=>{w.touchstart=w.dragStart,w.touchmoveWindow=w.dragMove,w.touchend=w.dragEnd},$c={showCompass:!0,showZoom:!0,visualizePitch:!1};class Bc{constructor(l,h,y=!1){this.mousedown=z=>{this.startMouse(s.e({},z,{ctrlKey:!0,preventDefault:()=>z.preventDefault()}),x.mousePos(this.element,z)),x.addEventListener(window,"mousemove",this.mousemove),x.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=z=>{this.moveMouse(z,x.mousePos(this.element,z))},this.mouseup=z=>{this.mouseRotate.dragEnd(z),this.mousePitch&&this.mousePitch.dragEnd(z),this.offTemp()},this.touchstart=z=>{z.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=x.touchPos(this.element,z.targetTouches)[0],this.startTouch(z,this._startPos),x.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.addEventListener(window,"touchend",this.touchend))},this.touchmove=z=>{z.targetTouches.length!==1?this.reset():(this._lastPos=x.touchPos(this.element,z.targetTouches)[0],this.moveTouch(z,this._lastPos))},this.touchend=z=>{z.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const v=l.dragRotate._mouseRotate.getClickTolerance(),k=l.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=xa({clickTolerance:v,enable:!0}),this.touchRotate=(({enable:z,clickTolerance:D,bearingDegreesPerPixelMoved:B=.8})=>{const G=new Zt;return new wa({clickTolerance:D,move:(Q,te)=>({bearingDelta:(te.x-Q.x)*B}),moveStateManager:G,enable:z,assignEvents:yu})})({clickTolerance:v,enable:!0}),this.map=l,y&&(this.mousePitch=ka({clickTolerance:k,enable:!0}),this.touchPitch=(({enable:z,clickTolerance:D,pitchDegreesPerPixelMoved:B=-.5})=>{const G=new Zt;return new wa({clickTolerance:D,move:(Q,te)=>({pitchDelta:(te.y-Q.y)*B}),moveStateManager:G,enable:z,assignEvents:yu})})({clickTolerance:k,enable:!0})),x.addEventListener(h,"mousedown",this.mousedown),x.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),x.addEventListener(h,"touchcancel",this.reset)}startMouse(l,h){this.mouseRotate.dragStart(l,h),this.mousePitch&&this.mousePitch.dragStart(l,h),x.disableDrag()}startTouch(l,h){this.touchRotate.dragStart(l,h),this.touchPitch&&this.touchPitch.dragStart(l,h),x.disableDrag()}moveMouse(l,h){const y=this.map,{bearingDelta:v}=this.mouseRotate.dragMove(l,h)||{};if(v&&y.setBearing(y.getBearing()+v),this.mousePitch){const{pitchDelta:k}=this.mousePitch.dragMove(l,h)||{};k&&y.setPitch(y.getPitch()+k)}}moveTouch(l,h){const y=this.map,{bearingDelta:v}=this.touchRotate.dragMove(l,h)||{};if(v&&y.setBearing(y.getBearing()+v),this.touchPitch){const{pitchDelta:k}=this.touchPitch.dragMove(l,h)||{};k&&y.setPitch(y.getPitch()+k)}}off(){const l=this.element;x.removeEventListener(l,"mousedown",this.mousedown),x.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend),x.removeEventListener(l,"touchcancel",this.reset),this.offTemp()}offTemp(){x.enableDrag(),x.removeEventListener(window,"mousemove",this.mousemove),x.removeEventListener(window,"mouseup",this.mouseup),x.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),x.removeEventListener(window,"touchend",this.touchend)}}let fs;function vu(w,l,h){const y=new s.M(w.lng,w.lat);if(w=new s.M(w.lng,w.lat),l){const v=new s.M(w.lng-360,w.lat),k=new s.M(w.lng+360,w.lat),z=h.locationPoint(w).distSqr(l);h.locationPoint(v).distSqr(l)<z?w=v:h.locationPoint(k).distSqr(l)<z&&(w=k)}for(;Math.abs(w.lng-h.center.lng)>180;){const v=h.locationPoint(w);if(v.x>=0&&v.y>=0&&v.x<=h.width&&v.y<=h.height)break;w.lng>h.center.lng?w.lng-=360:w.lng+=360}return w.lng!==y.lng&&h.locationPoint(w).y>h.height/2-h.getHorizon()?w:y}const wl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function bu(w,l,h){const y=w.classList;for(const v in wl)y.remove(`maplibregl-${h}-anchor-${v}`);y.add(`maplibregl-${h}-anchor-${l}`)}class xl extends s.E{constructor(l){if(super(),this._onKeyPress=h=>{const y=h.code,v=h.charCode||h.keyCode;y!=="Space"&&y!=="Enter"&&v!==32&&v!==13||this.togglePopup()},this._onMapClick=h=>{const y=h.originalEvent.target,v=this._element;this._popup&&(y===v||v.contains(y))&&this.togglePopup()},this._update=h=>{var y;if(!this._map)return;const v=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!v)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?vu(this._lngLat,this._flatPos,this._map.transform):(y=this._lngLat)===null||y===void 0?void 0:y.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let k="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?k=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(k=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let z="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?z="rotateX(0deg)":this._pitchAlignment==="map"&&(z=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),x.setTransform(this._element,`${wl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${z} ${k}`),_.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const y=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.k("dragstart"))),this.fire(new s.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new s.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(l==null?void 0:l.opacity,l==null?void 0:l.opacityWhenCovered),l&&l.element)this._element=l.element,this._offset=s.P.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=x.create("div"),this._element.setAttribute("aria-label","Map marker");const h=x.createNS("http://www.w3.org/2000/svg","svg"),y=41,v=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${y}px`),h.setAttributeNS(null,"width",`${v}px`),h.setAttributeNS(null,"viewBox",`0 0 ${v} ${y}`);const k=x.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"stroke","none"),k.setAttributeNS(null,"stroke-width","1"),k.setAttributeNS(null,"fill","none"),k.setAttributeNS(null,"fill-rule","evenodd");const z=x.createNS("http://www.w3.org/2000/svg","g");z.setAttributeNS(null,"fill-rule","nonzero");const D=x.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(3.0, 29.0)"),D.setAttributeNS(null,"fill","#000000");const B=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Re of B){const tt=x.createNS("http://www.w3.org/2000/svg","ellipse");tt.setAttributeNS(null,"opacity","0.04"),tt.setAttributeNS(null,"cx","10.5"),tt.setAttributeNS(null,"cy","5.80029008"),tt.setAttributeNS(null,"rx",Re.rx),tt.setAttributeNS(null,"ry",Re.ry),D.appendChild(tt)}const G=x.createNS("http://www.w3.org/2000/svg","g");G.setAttributeNS(null,"fill",this._color);const Q=x.createNS("http://www.w3.org/2000/svg","path");Q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),G.appendChild(Q);const te=x.createNS("http://www.w3.org/2000/svg","g");te.setAttributeNS(null,"opacity","0.25"),te.setAttributeNS(null,"fill","#000000");const me=x.createNS("http://www.w3.org/2000/svg","path");me.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),te.appendChild(me);const Se=x.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Se.setAttributeNS(null,"fill","#FFFFFF");const ke=x.createNS("http://www.w3.org/2000/svg","g");ke.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Me=x.createNS("http://www.w3.org/2000/svg","circle");Me.setAttributeNS(null,"fill","#000000"),Me.setAttributeNS(null,"opacity","0.25"),Me.setAttributeNS(null,"cx","5.5"),Me.setAttributeNS(null,"cy","5.5"),Me.setAttributeNS(null,"r","5.4999962");const be=x.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#FFFFFF"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962"),ke.appendChild(Me),ke.appendChild(be),z.appendChild(D),z.appendChild(G),z.appendChild(te),z.appendChild(Se),z.appendChild(ke),h.appendChild(z),h.setAttributeNS(null,"height",y*this._scale+"px"),h.setAttributeNS(null,"width",v*this._scale+"px"),this._element.appendChild(h),this._offset=s.P.convert(l&&l.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),bu(this._element,this._anchor,"marker"),l&&l.className)for(const h of l.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),l.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),x.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=s.M.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const v=Math.abs(13.5)/Math.SQRT2;l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=l,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const l=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:l?(l.isOpen()?l.remove():(l.setLngLat(this._lngLat),l.addTo(this._map)),this):this}_updateOpacity(l=!1){var h,y;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(l)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const v=this._map,k=v.terrain.depthAtPoint(this._pos),z=v.terrain.getElevationForLngLatZoom(this._lngLat,v.transform.tileZoom);if(v.transform.lngLatToCameraDepth(this._lngLat,z)-k<.006)return void(this._element.style.opacity=this._opacity);const D=-this._offset.y/v.transform._pixelPerMeter,B=Math.sin(v.getPitch()*Math.PI/180)*D,G=v.terrain.depthAtPoint(new s.P(this._pos.x,this._pos.y-this._offset.y)),Q=v.transform.lngLatToCameraDepth(this._lngLat,z+B)-G>.006;!((y=this._popup)===null||y===void 0)&&y.isOpen()&&Q&&this._popup.remove(),this._element.style.opacity=Q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(l){return this._offset=s.P.convert(l),this._update(),this}addClassName(l){this._element.classList.add(l)}removeClassName(l){this._element.classList.remove(l)}toggleClassName(l){return this._element.classList.toggle(l)}setDraggable(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(l,h){return l===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),l!==void 0&&(this._opacity=l),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const wu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ta=0,Zs=!1;const xu={maxWidth:100,unit:"metric"};function ku(w,l,h){const y=h&&h.maxWidth||100,v=w._container.clientHeight/2,k=w.unproject([0,v]),z=w.unproject([y,v]),D=k.distanceTo(z);if(h&&h.unit==="imperial"){const B=3.2808*D;B>5280?Ks(l,y,B/5280,w._getUIString("ScaleControl.Miles")):Ks(l,y,B,w._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?Ks(l,y,D/1852,w._getUIString("ScaleControl.NauticalMiles")):D>=1e3?Ks(l,y,D/1e3,w._getUIString("ScaleControl.Kilometers")):Ks(l,y,D,w._getUIString("ScaleControl.Meters"))}function Ks(w,l,h,y){const v=function(k){const z=Math.pow(10,`${Math.floor(k)}`.length-1);let D=k/z;return D=D>=10?10:D>=5?5:D>=3?3:D>=2?2:D>=1?1:function(B){const G=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*G)/G}(D),z*D}(h);w.style.width=l*(v/h)+"px",w.innerHTML=`${v}&nbsp;${y}`}const Nc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},jc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Su(w){if(w){if(typeof w=="number"){const l=Math.round(Math.abs(w)/Math.SQRT2);return{center:new s.P(0,0),top:new s.P(0,w),"top-left":new s.P(l,l),"top-right":new s.P(-l,l),bottom:new s.P(0,-w),"bottom-left":new s.P(l,-l),"bottom-right":new s.P(-l,-l),left:new s.P(w,0),right:new s.P(-w,0)}}if(w instanceof s.P||Array.isArray(w)){const l=s.P.convert(w);return{center:l,top:l,"top-left":l,"top-right":l,bottom:l,"bottom-left":l,"bottom-right":l,left:l,right:l}}return{center:s.P.convert(w.center||[0,0]),top:s.P.convert(w.top||[0,0]),"top-left":s.P.convert(w["top-left"]||[0,0]),"top-right":s.P.convert(w["top-right"]||[0,0]),bottom:s.P.convert(w.bottom||[0,0]),"bottom-left":s.P.convert(w["bottom-left"]||[0,0]),"bottom-right":s.P.convert(w["bottom-right"]||[0,0]),left:s.P.convert(w.left||[0,0]),right:s.P.convert(w.right||[0,0])}}return Su(new s.P(0,0))}const Kh=d;u.AJAXError=s.be,u.Evented=s.E,u.LngLat=s.M,u.MercatorCoordinate=s.Y,u.Point=s.P,u.addProtocol=s.bf,u.config=s.a,u.removeProtocol=s.bg,u.AttributionControl=Eo,u.BoxZoomHandler=Co,u.CanvasSource=Wn,u.CooperativeGesturesHandler=sn,u.DoubleClickZoomHandler=Pc,u.DragPanHandler=Wh,u.DragRotateHandler=Mo,u.EdgeInsets=va,u.FullscreenControl=class extends s.E{constructor(w={}){super(),this._onFullscreenChange=()=>{var l;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((l=h==null?void 0:h.shadowRoot)===null||l===void 0)&&l.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,w&&w.container&&(w.container instanceof HTMLElement?this._container=w.container:s.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(w){return this._map=w,this._container||(this._container=this._map.getContainer()),this._controlContainer=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){x.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const w=this._fullscreenButton=x.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);x.create("span","maplibregl-ctrl-icon",w).setAttribute("aria-hidden","true"),w.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const w=this._getTitle();this._fullscreenButton.setAttribute("aria-label",w),this._fullscreenButton.title=w}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new s.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new s.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Xe,u.GeolocateControl=class extends s.E{constructor(w){super(),this._onSuccess=l=>{if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new s.k("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new s.k("geolocate",l)),this._finish()}},this._updateCamera=l=>{const h=new s.M(l.coords.longitude,l.coords.latitude),y=l.coords.accuracy,v=this._map.getBearing(),k=s.e({bearing:v},this.options.fitBoundsOptions),z=We.fromLngLat(h,y);this._map.fitBounds(z,k,{geolocateSource:!0})},this._updateMarker=l=>{if(l){const h=new s.M(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=l=>{if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Zs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new s.k("error",l)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=l=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=x.create("button","maplibregl-ctrl-geolocate",this._container),x.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){s.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=x.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new xl({element:this._dotElement}),this._circleElement=x.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new s.k("trackuserlocationend")))})}},this.options=s.e({},wu,w)}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return s._(this,arguments,void 0,function*(l=!1){if(fs!==void 0&&!l)return fs;if(window.navigator.permissions===void 0)return fs=!!window.navigator.geolocation,fs;try{fs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{fs=!!window.navigator.geolocation}return fs})}().then(l=>this._setupUI(l)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),x.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ta=0,Zs=!1}_isOutOfMapMaxBounds(w){const l=this._map.getMaxBounds(),h=w.coords;return l&&(h.longitude<l.getWest()||h.longitude>l.getEast()||h.latitude<l.getSouth()||h.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const w=this._map.getBounds(),l=w.getSouthEast(),h=w.getNorthEast(),y=l.distanceTo(h),v=Math.ceil(this._accuracy/(y/this._map._container.clientHeight)*2);this._circleElement.style.width=`${v}px`,this._circleElement.style.height=`${v}px`}trigger(){if(!this._setup)return s.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ta--,Zs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new s.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let w;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ta++,Ta>1?(w={maximumAge:6e5,timeout:0},Zs=!0):(w=this.options.positionOptions,Zs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,w)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Ec,u.ImageSource=Wt,u.KeyboardHandler=Is,u.LngLatBounds=We,u.LogoControl=Gh,u.Map=class extends Bi{constructor(w){if(s.bc.mark(s.bd.create),(w=s.e({},bl,w)).minZoom!=null&&w.maxZoom!=null&&w.minZoom>w.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(w.minPitch!=null&&w.maxPitch!=null&&w.minPitch>w.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(w.minPitch!=null&&w.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(w.maxPitch!=null&&w.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new hu(w.minZoom,w.maxZoom,w.minPitch,w.maxPitch,w.renderWorldCopies),{bearingSnap:w.bearingSnap}),this._contextLost=l=>{l.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new s.k("webglcontextlost",{originalEvent:l}))},this._contextRestored=l=>{this._setupPainter(),this.resize(),this._update(),this.fire(new s.k("webglcontextrestored",{originalEvent:l}))},this._onMapScroll=l=>{if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=w.interactive,this._maxTileCacheSize=w.maxTileCacheSize,this._maxTileCacheZoomLevels=w.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=w.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=w.preserveDrawingBuffer,this._antialias=w.antialias,this._trackResize=w.trackResize,this._bearingSnap=w.bearingSnap,this._refreshExpiredTiles=w.refreshExpiredTiles,this._fadeDuration=w.fadeDuration,this._crossSourceCollisions=w.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=w.collectResourceTiming,this._renderTaskQueue=new yl,this._controls=[],this._mapId=s.a3(),this._locale=s.e({},Fc,w.locale),this._clickTolerance=w.clickTolerance,this._overridePixelRatio=w.pixelRatio,this._maxCanvasSize=w.maxCanvasSize,this.transformCameraUpdate=w.transformCameraUpdate,this._imageQueueHandle=$.addThrottleControl(()=>this.isMoving()),this._requestManager=new O(w.transformRequest),typeof w.container=="string"){if(this._container=document.getElementById(w.container),!this._container)throw new Error(`Container '${w.container}' not found.`)}else{if(!(w.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=w.container}if(w.maxBounds&&this.setMaxBounds(w.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let l=!1;const h=Mc(y=>{this._trackResize&&!this._removed&&this.resize(y)._update()},50);this._resizeObserver=new ResizeObserver(y=>{l?h(y):l=!0}),this._resizeObserver.observe(this._container)}this.handlers=new zc(this,w),this._hash=w.hash&&new Ec(typeof w.hash=="string"&&w.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:w.center,zoom:w.zoom,bearing:w.bearing,pitch:w.pitch}),w.bounds&&(this.resize(),this.fitBounds(w.bounds,s.e({},w.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=w.localIdeographFontFamily,this._validateStyle=w.validateStyle,w.style&&this.setStyle(w.style,{localIdeographFontFamily:w.localIdeographFontFamily}),w.attributionControl&&this.addControl(new Eo(typeof w.attributionControl=="boolean"?void 0:w.attributionControl)),w.maplibreLogo&&this.addControl(new Gh,w.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new s.k(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new s.k(`${l.dataType}dataloading`,l))}),this.on("dataabort",l=>{this.fire(new s.k("sourcedataabort",l))})}_getMapId(){return this._mapId}addControl(w,l){if(l===void 0&&(l=w.getDefaultPosition?w.getDefaultPosition():"top-right"),!w||!w.onAdd)return this.fire(new s.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=w.onAdd(this);this._controls.push(w);const y=this._controlPositions[l];return l.indexOf("bottom")!==-1?y.insertBefore(h,y.firstChild):y.appendChild(h),this}removeControl(w){if(!w||!w.onRemove)return this.fire(new s.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(w);return l>-1&&this._controls.splice(l,1),w.onRemove(this),this}hasControl(w){return this._controls.indexOf(w)>-1}calculateCameraOptionsFromTo(w,l,h,y){return y==null&&this.terrain&&(y=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(w,l,h,y)}resize(w){var l;const h=this._containerDimensions(),y=h[0],v=h[1],k=this._getClampedPixelRatio(y,v);if(this._resizeCanvas(y,v,k),this.painter.resize(y,v,k),this.painter.overLimit()){const D=this.painter.context.gl;this._maxCanvasSize=[D.drawingBufferWidth,D.drawingBufferHeight];const B=this._getClampedPixelRatio(y,v);this._resizeCanvas(y,v,B),this.painter.resize(y,v,B)}this.transform.resize(y,v),(l=this._requestedCameraState)===null||l===void 0||l.resize(y,v);const z=!this._moving;return z&&(this.stop(),this.fire(new s.k("movestart",w)).fire(new s.k("move",w))),this.fire(new s.k("resize",w)),z&&this.fire(new s.k("moveend",w)),this}_getClampedPixelRatio(w,l){const{0:h,1:y}=this._maxCanvasSize,v=this.getPixelRatio(),k=w*v,z=l*v;return Math.min(k>h?h/k:1,z>y?y/z:1)*v}getPixelRatio(){var w;return(w=this._overridePixelRatio)!==null&&w!==void 0?w:devicePixelRatio}setPixelRatio(w){this._overridePixelRatio=w,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(w){return this.transform.setMaxBounds(We.convert(w)),this._update()}setMinZoom(w){if((w=w??-2)>=-2&&w<=this.transform.maxZoom)return this.transform.minZoom=w,this._update(),this.getZoom()<w&&this.setZoom(w),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(w){if((w=w??22)>=this.transform.minZoom)return this.transform.maxZoom=w,this._update(),this.getZoom()>w&&this.setZoom(w),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(w){if((w=w??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(w>=0&&w<=this.transform.maxPitch)return this.transform.minPitch=w,this._update(),this.getPitch()<w&&this.setPitch(w),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(w){if((w=w??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(w>=this.transform.minPitch)return this.transform.maxPitch=w,this._update(),this.getPitch()>w&&this.setPitch(w),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(w){return this.transform.renderWorldCopies=w,this._update()}project(w){return this.transform.locationPoint(s.M.convert(w),this.style&&this.terrain)}unproject(w){return this.transform.pointLocation(s.P.convert(w),this.terrain)}isMoving(){var w;return this._moving||((w=this.handlers)===null||w===void 0?void 0:w.isMoving())}isZooming(){var w;return this._zooming||((w=this.handlers)===null||w===void 0?void 0:w.isZooming())}isRotating(){var w;return this._rotating||((w=this.handlers)===null||w===void 0?void 0:w.isRotating())}_createDelegatedListener(w,l,h){if(w==="mouseenter"||w==="mouseover"){let y=!1;return{layer:l,listener:h,delegates:{mousemove:k=>{const z=this.getLayer(l)?this.queryRenderedFeatures(k.point,{layers:[l]}):[];z.length?y||(y=!0,h.call(this,new $i(w,this,k.originalEvent,{features:z}))):y=!1},mouseout:()=>{y=!1}}}}if(w==="mouseleave"||w==="mouseout"){let y=!1;return{layer:l,listener:h,delegates:{mousemove:z=>{(this.getLayer(l)?this.queryRenderedFeatures(z.point,{layers:[l]}):[]).length?y=!0:y&&(y=!1,h.call(this,new $i(w,this,z.originalEvent)))},mouseout:z=>{y&&(y=!1,h.call(this,new $i(w,this,z.originalEvent)))}}}}{const y=v=>{const k=this.getLayer(l)?this.queryRenderedFeatures(v.point,{layers:[l]}):[];k.length&&(v.features=k,h.call(this,v),delete v.features)};return{layer:l,listener:h,delegates:{[w]:y}}}}on(w,l,h){if(h===void 0)return super.on(w,l);const y=this._createDelegatedListener(w,l,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[w]=this._delegatedListeners[w]||[],this._delegatedListeners[w].push(y);for(const v in y.delegates)this.on(v,y.delegates[v]);return this}once(w,l,h){if(h===void 0)return super.once(w,l);const y=this._createDelegatedListener(w,l,h);for(const v in y.delegates)this.once(v,y.delegates[v]);return this}off(w,l,h){return h===void 0?super.off(w,l):(this._delegatedListeners&&this._delegatedListeners[w]&&(y=>{const v=this._delegatedListeners[w];for(let k=0;k<v.length;k++){const z=v[k];if(z.layer===l&&z.listener===h){for(const D in z.delegates)this.off(D,z.delegates[D]);return v.splice(k,1),this}}})(),this)}queryRenderedFeatures(w,l){if(!this.style)return[];let h;const y=w instanceof s.P||Array.isArray(w),v=y?w:[[0,0],[this.transform.width,this.transform.height]];if(l=l||(y?{}:w)||{},v instanceof s.P||typeof v[0]=="number")h=[s.P.convert(v)];else{const k=s.P.convert(v[0]),z=s.P.convert(v[1]);h=[k,new s.P(z.x,k.y),z,new s.P(k.x,z.y),k]}return this.style.queryRenderedFeatures(h,l,this.transform)}querySourceFeatures(w,l){return this.style.querySourceFeatures(w,l)}setStyle(w,l){return(l=s.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},l)).diff!==!1&&l.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&w?(this._diffStyle(w,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._updateStyle(w,l))}setTransformRequest(w){return this._requestManager.setTransformRequest(w),this}_getUIString(w){const l=this._locale[w];if(l==null)throw new Error(`Missing UI string '${w}'`);return l}_updateStyle(w,l){if(l.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(w,l));const h=this.style&&l.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!w)),w?(this.style=new eo(this,l||{}),this.style.setEventedParent(this,{style:this.style}),typeof w=="string"?this.style.loadURL(w,l,h):this.style.loadJSON(w,l,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new eo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(w,l){if(typeof w=="string"){const h=this._requestManager.transformRequest(w,"Style");s.h(h,new AbortController).then(y=>{this._updateDiff(y.data,l)}).catch(y=>{y&&this.fire(new s.j(y))})}else typeof w=="object"&&this._updateDiff(w,l)}_updateDiff(w,l){try{this.style.setState(w,l)&&this._update(!0)}catch(h){s.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(w,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():s.w("There is no style added to the map.")}addSource(w,l){return this._lazyInitEmptyStyle(),this.style.addSource(w,l),this._update(!0)}isSourceLoaded(w){const l=this.style&&this.style.sourceCaches[w];if(l!==void 0)return l.loaded();this.fire(new s.j(new Error(`There is no source with ID '${w}'`)))}setTerrain(w){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),w){const l=this.style.sourceCaches[w.source];if(!l)throw new Error(`cannot load terrain, because there exists no source with ID: ${w.source}`);this.terrain===null&&l.reload();for(const h in this.style._layers){const y=this.style._layers[h];y.type==="hillshade"&&y.source===w.source&&s.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Zh(this.painter,l,w),this.painter.renderToTexture=new Rc(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==w.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new s.k("terrain",{terrain:w})),this}getTerrain(){var w,l;return(l=(w=this.terrain)===null||w===void 0?void 0:w.options)!==null&&l!==void 0?l:null}areTilesLoaded(){const w=this.style&&this.style.sourceCaches;for(const l in w){const h=w[l]._tiles;for(const y in h){const v=h[y];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}removeSource(w){return this.style.removeSource(w),this._update(!0)}getSource(w){return this.style.getSource(w)}addImage(w,l,h={}){const{pixelRatio:y=1,sdf:v=!1,stretchX:k,stretchY:z,content:D}=h;if(this._lazyInitEmptyStyle(),!(l instanceof HTMLImageElement||s.b(l))){if(l.width===void 0||l.height===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:B,height:G,data:Q}=l,te=l;return this.style.addImage(w,{data:new s.R({width:B,height:G},new Uint8Array(Q)),pixelRatio:y,stretchX:k,stretchY:z,content:D,sdf:v,version:0,userImage:te}),te.onAdd&&te.onAdd(this,w),this}}{const{width:B,height:G,data:Q}=_.getImageData(l);this.style.addImage(w,{data:new s.R({width:B,height:G},Q),pixelRatio:y,stretchX:k,stretchY:z,content:D,sdf:v,version:0})}}updateImage(w,l){const h=this.style.getImage(w);if(!h)return this.fire(new s.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=l instanceof HTMLImageElement||s.b(l)?_.getImageData(l):l,{width:v,height:k,data:z}=y;if(v===void 0||k===void 0)return this.fire(new s.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==h.data.width||k!==h.data.height)return this.fire(new s.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const D=!(l instanceof HTMLImageElement||s.b(l));return h.data.replace(z,D),this.style.updateImage(w,h),this}getImage(w){return this.style.getImage(w)}hasImage(w){return w?!!this.style.getImage(w):(this.fire(new s.j(new Error("Missing required image id"))),!1)}removeImage(w){this.style.removeImage(w)}loadImage(w){return $.getImage(this._requestManager.transformRequest(w,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(w,l){return this._lazyInitEmptyStyle(),this.style.addLayer(w,l),this._update(!0)}moveLayer(w,l){return this.style.moveLayer(w,l),this._update(!0)}removeLayer(w){return this.style.removeLayer(w),this._update(!0)}getLayer(w){return this.style.getLayer(w)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(w,l,h){return this.style.setLayerZoomRange(w,l,h),this._update(!0)}setFilter(w,l,h={}){return this.style.setFilter(w,l,h),this._update(!0)}getFilter(w){return this.style.getFilter(w)}setPaintProperty(w,l,h,y={}){return this.style.setPaintProperty(w,l,h,y),this._update(!0)}getPaintProperty(w,l){return this.style.getPaintProperty(w,l)}setLayoutProperty(w,l,h,y={}){return this.style.setLayoutProperty(w,l,h,y),this._update(!0)}getLayoutProperty(w,l){return this.style.getLayoutProperty(w,l)}setGlyphs(w,l={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(w,l),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(w,l,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(w,l,h,y=>{y||this._update(!0)}),this}removeSprite(w){return this._lazyInitEmptyStyle(),this.style.removeSprite(w),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(w,l={}){return this._lazyInitEmptyStyle(),this.style.setSprite(w,l,h=>{h||this._update(!0)}),this}setLight(w,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(w,l),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(w,l){return this.style.setFeatureState(w,l),this._update()}removeFeatureState(w,l){return this.style.removeFeatureState(w,l),this._update()}getFeatureState(w){return this.style.getFeatureState(w)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let w=0,l=0;return this._container&&(w=this._container.clientWidth||400,l=this._container.clientHeight||300),[w,l]}_setupContainer(){const w=this._container;w.classList.add("maplibregl-map");const l=this._canvasContainer=x.create("div","maplibregl-canvas-container",w);this._interactive&&l.classList.add("maplibregl-interactive"),this._canvas=x.create("canvas","maplibregl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),y=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],y);const v=this._controlContainer=x.create("div","maplibregl-control-container",w),k=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(z=>{k[z]=x.create("div",`maplibregl-ctrl-${z} `,v)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(w,l,h){this._canvas.width=Math.floor(h*w),this._canvas.height=Math.floor(h*l),this._canvas.style.width=`${w}px`,this._canvas.style.height=`${l}px`}_setupPainter(){const w={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let l=null;this._canvas.addEventListener("webglcontextcreationerror",y=>{l={requestedAttributes:w},y&&(l.statusMessage=y.statusMessage,l.type=y.type)},{once:!0});const h=this._canvas.getContext("webgl2",w)||this._canvas.getContext("webgl",w);if(!h){const y="Failed to initialize WebGL";throw l?(l.message=y,new Error(JSON.stringify(l))):new Error(y)}this.painter=new Rh(h,this.transform),C.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(w){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||w,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(w){return this._update(),this._renderTaskQueue.add(w)}_cancelRenderFrame(w){this._renderTaskQueue.remove(w)}_render(w){const l=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(w),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,k=_.now();this.style.zoomHistory.update(v,k);const z=new s.a8(v,{now:k,fadeDuration:l,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=z.crossFadingFactor();D===1&&D===this._crossFadingFactor||(h=!0,this._crossFadingFactor=D),this.style.update(z)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,showPadding:this.showPadding}),this.fire(new s.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,s.bc.mark(s.bd.load),this.fire(new s.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const y=this._sourcesDirty||this._styleDirty||this._placementDirty;return y||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new s.k("idle")),!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,s.bc.mark(s.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var w;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),$.removeThrottleControl(this._imageQueueHandle),(w=this._resizeObserver)===null||w===void 0||w.disconnect();const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),x.remove(this._canvasContainer),x.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),s.bc.clearMetrics(),this._removed=!0,this.fire(new s.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,_.frameAsync(this._frameRequest).then(w=>{s.bc.frame(w),this._frameRequest=null,this._render(w)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(w){this._showTileBoundaries!==w&&(this._showTileBoundaries=w,this._update())}get showPadding(){return!!this._showPadding}set showPadding(w){this._showPadding!==w&&(this._showPadding=w,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(w){this._showCollisionBoxes!==w&&(this._showCollisionBoxes=w,w?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(w){this._showOverdrawInspector!==w&&(this._showOverdrawInspector=w,this._update())}get repaint(){return!!this._repaint}set repaint(w){this._repaint!==w&&(this._repaint=w,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(w){this._vertices=w,this._update()}get version(){return Oc}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=$i,u.MapTouchEvent=Wo,u.MapWheelEvent=Lc,u.Marker=xl,u.NavigationControl=class{constructor(w){this._updateZoomButtons=()=>{const l=this._map.getZoom(),h=l===this._map.getMaxZoom(),y=l===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())},this._rotateCompassArrow=()=>{const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=l},this._setButtonTitle=(l,h)=>{const y=this._map._getUIString(`NavigationControl.${h}`);l.title=y,l.setAttribute("aria-label",y)},this.options=s.e({},$c,w),this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",l=>this._map.zoomIn({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",l=>this._map.zoomOut({},{originalEvent:l})),x.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",l=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:l}):this._map.resetNorth({},{originalEvent:l})}),this._compassIcon=x.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(w){return this._map=w,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Bc(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){x.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(w,l){const h=x.create("button",w,this._container);return h.type="button",h.addEventListener("click",l),h}},u.Popup=class extends s.E{constructor(w){super(),this.remove=()=>(this._content&&x.remove(this._content),this._container&&(x.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new s.k("close"))),this),this._onMouseUp=l=>{this._update(l.point)},this._onMouseMove=l=>{this._update(l.point)},this._onDrag=l=>{this._update(l.point)},this._update=l=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=x.create("div","maplibregl-popup",this._map.getContainer()),this._tip=x.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const D of this.options.className.split(" "))this._container.classList.add(D);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?vu(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!l)return;const y=this._flatPos=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&l?l:this._map.transform.locationPoint(this._lngLat));let v=this.options.anchor;const k=Su(this.options.offset);if(!v){const D=this._container.offsetWidth,B=this._container.offsetHeight;let G;G=y.y+k.bottom.y<B?["top"]:y.y>this._map.transform.height-B?["bottom"]:[],y.x<D/2?G.push("left"):y.x>this._map.transform.width-D/2&&G.push("right"),v=G.length===0?"bottom":G.join("-")}let z=y.add(k[v]);this.options.subpixelPositioning||(z=z.round()),x.setTransform(this._container,`${wl[v]} translate(${z.x}px,${z.y}px)`),bu(this._container,v,"popup")},this._onClose=()=>{this.remove()},this.options=s.e(Object.create(Nc),w)}addTo(w){return this._map&&this.remove(),this._map=w,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new s.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(w){return this._lngLat=s.M.convert(w),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(w){return this.setDOMContent(document.createTextNode(w))}setHTML(w){const l=document.createDocumentFragment(),h=document.createElement("body");let y;for(h.innerHTML=w;y=h.firstChild,y;)l.appendChild(y);return this.setDOMContent(l)}getMaxWidth(){var w;return(w=this._container)===null||w===void 0?void 0:w.style.maxWidth}setMaxWidth(w){return this.options.maxWidth=w,this._update(),this}setDOMContent(w){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=x.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(w),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(w){this._container&&this._container.classList.add(w)}removeClassName(w){this._container&&this._container.classList.remove(w)}setOffset(w){return this.options.offset=w,this._update(),this}toggleClassName(w){if(this._container)return this._container.classList.toggle(w)}setSubpixelPositioning(w){this.options.subpixelPositioning=w}_createCloseButton(){this.options.closeButton&&(this._closeButton=x.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const w=this._container.querySelector(jc);w&&w.focus()}},u.RasterDEMTileSource=fn,u.RasterTileSource=pe,u.ScaleControl=class{constructor(w){this._onMove=()=>{ku(this._map,this._container,this.options)},this.setUnit=l=>{this.options.unit=l,ku(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},xu),w)}getDefaultPosition(){return"bottom-left"}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-scale",w.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){x.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=gu,u.Style=eo,u.TerrainControl=class{constructor(w){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=w}onAdd(w){return this._map=w,this._container=x.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=x.create("button","maplibregl-ctrl-terrain",this._container),x.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){x.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=Vh,u.TwoFingersTouchRotateHandler=Ac,u.TwoFingersTouchZoomHandler=Uh,u.TwoFingersTouchZoomRotateHandler=gl,u.VectorTileSource=kt,u.VideoSource=Xn,u.addSourceType=(w,l)=>s._(void 0,void 0,void 0,function*(){if(Tr(w))throw new Error(`A source type called "${w}" already exists.`);((h,y)=>{fr[h]=y})(w,l)}),u.clearPrewarmedResources=function(){const w=mt;w&&(w.isPreloaded()&&w.numActive()===1?(w.release(pt),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return s.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return xt().getRTLTextPluginStatus()},u.getVersion=function(){return Kh},u.getWorkerCount=function(){return _t.workerCount},u.getWorkerUrl=function(){return s.a.WORKER_URL},u.importScriptInWorkers=function(w){return nn().broadcast("IS",w)},u.prewarm=function(){jt().acquire(pt)},u.setMaxParallelImageRequests=function(w){s.a.MAX_PARALLEL_IMAGE_REQUESTS=w},u.setRTLTextPlugin=function(w,l){return xt().setRTLTextPlugin(w,l)},u.setWorkerCount=function(w){_t.workerCount=w},u.setWorkerUrl=function(w){s.a.WORKER_URL=w}});var o=t;return o})})(ew);var la=ew.exports;const ni=Qb(la),h3=Wk({__proto__:null,default:ni},[la]);let an;const nw=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&nw.decode();let wf=null;function Lf(){return(wf===null||wf.byteLength===0)&&(wf=new Uint8Array(an.memory.buffer)),wf}function Qo(r,e){return r=r>>>0,nw.decode(Lf().subarray(r,r+e))}const ia=new Array(128).fill(void 0);ia.push(void 0,null,!0,!1);let If=ia.length;function ti(r){If===ia.length&&ia.push(ia.length+1);const e=If;return If=ia[e],ia[e]=r,e}function Hn(r){return ia[r]}function d3(r){r<132||(ia[r]=If,If=r)}function Hu(r){const e=Hn(r);return d3(r),e}function Cm(r){return r==null}let xf=null;function p3(){return(xf===null||xf.byteLength===0)&&(xf=new Float64Array(an.memory.buffer)),xf}let kf=null;function Jn(){return(kf===null||kf.byteLength===0)&&(kf=new Int32Array(an.memory.buffer)),kf}let Fa=0;const Ad=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},m3=typeof Ad.encodeInto=="function"?function(r,e){return Ad.encodeInto(r,e)}:function(r,e){const t=Ad.encode(r);return e.set(t),{read:r.length,written:t.length}};function vd(r,e,t){if(t===void 0){const s=Ad.encode(r),d=e(s.length,1)>>>0;return Lf().subarray(d,d+s.length).set(s),Fa=s.length,d}let n=r.length,i=e(n,1)>>>0;const o=Lf();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Lf().subarray(i+u,i+n),d=m3(r,s);u+=d.written}return Fa=u,i}function Wm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Wm(r[0]));for(let u=1;u<i;u++)o+=", "+Wm(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function g3(r,e){const t=e(r.length*1,1)>>>0;return Lf().set(r,t/1),Fa=r.length,t}function Mm(r,e){try{return r.apply(this,e)}catch(t){an.__wbindgen_exn_store(ti(t))}}class qd{static __wrap(e){e=e>>>0;const t=Object.create(qd.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();an.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=an.__wbindgen_add_to_stack_pointer(-16),u=g3(e,an.__wbindgen_malloc),s=Fa;an.jsroutesnapper_new(o,u,s);var t=Jn()[o/4+0],n=Jn()[o/4+1],i=Jn()[o/4+2];if(i)throw Hu(n);return qd.__wrap(t)}finally{an.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){an.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ti(e))}setAreaMode(){an.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=Jn()[o/4+0],i=Jn()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=Jn()[n/4+0],t=Jn()[n/4+1];let i;return e!==0&&(i=Qo(e,t).slice(),an.__wbindgen_free(e,t*1)),i}finally{an.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=Jn()[o/4+0],i=Jn()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}toggleSnapMode(){an.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return an.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){an.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return an.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return an.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){an.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_editExisting(i,this.__wbg_ptr,ti(e));var t=Jn()[i/4+0],n=Jn()[i/4+1];if(n)throw Hu(t)}finally{an.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=Jn()[o/4+0],i=Jn()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=Jn()[o/4+0],i=Jn()[o/4+1];return e=n,t=i,Qo(n,i)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const g=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_routeNameForWaypoints(g,this.__wbg_ptr,ti(e));var i=Jn()[g/4+0],o=Jn()[g/4+1],u=Jn()[g/4+2],s=Jn()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Hu(u);return t=d,n=p,Qo(d,p)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){an.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){an.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const g=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_calculateRoute(g,this.__wbg_ptr,ti(e));var i=Jn()[g/4+0],o=Jn()[g/4+1],u=Jn()[g/4+2],s=Jn()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Hu(u);return t=d,n=p,Qo(d,p)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const _=an.__wbindgen_add_to_stack_pointer(-16);an.jsroutesnapper_getExtraNodes(_,this.__wbg_ptr,ti(e),ti(t));var o=Jn()[_/4+0],u=Jn()[_/4+1],s=Jn()[_/4+2],d=Jn()[_/4+3],p=o,g=u;if(d)throw p=0,g=0,Hu(s);return n=p,i=g,Qo(p,g)}finally{an.__wbindgen_add_to_stack_pointer(16),an.__wbindgen_free(n,i,1)}}}async function _3(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function y3(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Qo(e,t);return ti(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Hu(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Qo(e,t));return ti(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Hn(t),i=typeof n=="number"?n:void 0;p3()[e/8+1]=Cm(i)?0:i,Jn()[e/4+0]=!Cm(i)},r.wbg.__wbindgen_is_object=function(e){const t=Hn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Hn(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Hn(e)in Hn(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Hn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Hn(e)==Hn(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Hn(t),i=typeof n=="string"?n:void 0;var o=Cm(i)?0:vd(i,an.__wbindgen_malloc,an.__wbindgen_realloc),u=Fa;Jn()[e/4+1]=u,Jn()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Hn(t)),i=vd(n,an.__wbindgen_malloc,an.__wbindgen_realloc),o=Fa;Jn()[e/4+1]=o,Jn()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Hn(e);return ti(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Hn(e)[Hn(t)];return ti(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ti(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Hn(t).stack,i=vd(n,an.__wbindgen_malloc,an.__wbindgen_realloc),o=Fa;Jn()[e/4+1]=o,Jn()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Qo(e,t))}finally{an.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Hn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Hn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Hn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Hn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Hn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Hn(e)[t>>>0];return ti(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Hn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Hn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Hn(e).next;return ti(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Mm(function(e){const t=Hn(e).next();return ti(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Hn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Hn(e).value;return ti(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ti(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Mm(function(e,t){const n=Reflect.get(Hn(e),Hn(t));return ti(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Mm(function(e,t){const n=Hn(e).call(Hn(t));return ti(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Hn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Hn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Hn(e).buffer;return ti(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Hn(e));return ti(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Hn(e).set(Hn(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Hn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Hn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=Wm(Hn(t)),i=vd(n,an.__wbindgen_malloc,an.__wbindgen_realloc),o=Fa;Jn()[e/4+1]=o,Jn()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Qo(e,t))},r.wbg.__wbindgen_memory=function(){const e=an.memory;return ti(e)},r}function v3(r,e){return an=r.exports,rw.__wbindgen_wasm_module=e,xf=null,kf=null,wf=null,an}async function rw(r){if(an!==void 0)return an;typeof r>"u"&&(r="/ltn/assets/route_snapper_bg.wasm");const e=y3();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await _3(await r,e);return v3(t,n)}var Wi=63710088e-1,Fg={centimeters:Wi*100,centimetres:Wi*100,degrees:Wi/111325,feet:Wi*3.28084,inches:Wi*39.37,kilometers:Wi/1e3,kilometres:Wi/1e3,meters:Wi,metres:Wi,miles:Wi/1609.344,millimeters:Wi*1e3,millimetres:Wi*1e3,nauticalmiles:Wi/1852,radians:1,yards:Wi*1.0936},b3={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Wi,yards:1.0936133},Gm={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ss(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function w3(r,e,t){switch(r){case"Point":return yo(e).geometry;case"LineString":return ts(e).geometry;case"Polygon":return Og(e).geometry;case"MultiPoint":return ow(e).geometry;case"MultiLineString":return iw(e).geometry;case"MultiPolygon":return sw(e).geometry;default:throw new Error(r+" is invalid")}}function yo(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Hd(r[0])||!Hd(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return ss(n,e,t)}function x3(r,e,t){return t===void 0&&(t={}),Dl(r.map(function(n){return yo(n,e)}),t)}function Og(r,e,t){t===void 0&&(t={});for(var n=0,i=r;n<i.length;n++){var o=i[n];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<o[o.length-1].length;u++)if(o[o.length-1][u]!==o[0][u])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:r};return ss(s,e,t)}function k3(r,e,t){return t===void 0&&(t={}),Dl(r.map(function(n){return Og(n,e)}),t)}function ts(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return ss(n,e,t)}function S3(r,e,t){return t===void 0&&(t={}),Dl(r.map(function(n){return ts(n,e)}),t)}function Dl(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function iw(r,e,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:r};return ss(n,e,t)}function ow(r,e,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:r};return ss(n,e,t)}function sw(r,e,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:r};return ss(n,e,t)}function T3(r,e,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:r};return ss(n,e,t)}function C3(r,e){if(e===void 0&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,e||0);return Math.round(r*t)/t}function $g(r,e){e===void 0&&(e="kilometers");var t=Fg[e];if(!t)throw new Error(e+" units is invalid");return r*t}function op(r,e){e===void 0&&(e="kilometers");var t=Fg[e];if(!t)throw new Error(e+" units is invalid");return r/t}function M3(r,e){return Uf(op(r,e))}function E3(r){var e=r%360;return e<0&&(e+=360),e}function Uf(r){var e=r%(2*Math.PI);return e*180/Math.PI}function ns(r){var e=r%360;return e*Math.PI/180}function L3(r,e,t){if(e===void 0&&(e="kilometers"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("length must be a positive number");return $g(op(r,e),t)}function I3(r,e,t){if(e===void 0&&(e="meters"),t===void 0&&(t="kilometers"),!(r>=0))throw new Error("area must be a positive number");var n=Gm[e];if(!n)throw new Error("invalid original units");var i=Gm[t];if(!i)throw new Error("invalid final units");return r/n*i}function Hd(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Bg(r){return!!r&&r.constructor===Object}function A3(r){if(!r)throw new Error("bbox is required");if(!Array.isArray(r))throw new Error("bbox must be an Array");if(r.length!==4&&r.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");r.forEach(function(e){if(!Hd(e))throw new Error("bbox must only contain numbers")})}function P3(r){if(!r)throw new Error("id is required");if(["string","number"].indexOf(typeof r)===-1)throw new Error("id must be a number or a string")}const z3=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:Gm,bearingToAzimuth:E3,convertArea:I3,convertLength:L3,degreesToRadians:ns,earthRadius:Wi,factors:Fg,feature:ss,featureCollection:Dl,geometry:w3,geometryCollection:T3,isNumber:Hd,isObject:Bg,lengthToDegrees:M3,lengthToRadians:op,lineString:ts,lineStrings:S3,multiLineString:iw,multiPoint:ow,multiPolygon:sw,point:yo,points:x3,polygon:Og,polygons:k3,radiansToDegrees:Uf,radiansToLength:$g,round:C3,unitsFactors:b3,validateBBox:A3,validateId:P3},Symbol.toStringTag,{value:"Module"}));function Vf(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function tc(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function th(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,_=0,x,C=r.type,M=C==="FeatureCollection",P=C==="Feature",A=M?r.features.length:1,L=0;L<A;L++){p=M?r.features[L].geometry:P?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var $=0,O=0;if(u=x?p.geometries[I]:p,u!==null){d=u.coordinates;var Z=u.type;switch(g=t&&(Z==="Polygon"||Z==="MultiPolygon")?1:0,Z){case null:break;case"Point":if(e(d,_,L,$,O)===!1)return!1;_++,$++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,L,$,O)===!1)return!1;_++,Z==="MultiPoint"&&$++}Z==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],_,L,$,O)===!1)return!1;_++}Z==="MultiLineString"&&$++,Z==="Polygon"&&O++}Z==="Polygon"&&$++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(O=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],_,L,$,O)===!1)return!1;_++}O++}$++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(th(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function D3(r,e,t,n){var i=t;return th(r,function(o,u,s,d,p){u===0&&t===void 0?i=o:i=e(i,o,u,s,d,p)},n),i}function aw(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function R3(r,e,t){var n=t;return aw(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function Wd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function F3(r,e,t){var n=t;return Wd(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function O3(r){var e=[];return th(r,function(t){e.push(t)}),e}function Ng(r,e){var t,n,i,o,u,s,d,p,g,_,x=0,C=r.type==="FeatureCollection",M=r.type==="Feature",P=C?r.features.length:1;for(t=0;t<P;t++){for(s=C?r.features[t].geometry:M?r.geometry:r,p=C?r.features[t].properties:M?r.properties:{},g=C?r.features[t].bbox:M?r.bbox:void 0,_=C?r.features[t].id:M?r.id:void 0,d=s?s.type==="GeometryCollection":!1,u=d?s.geometries.length:1,i=0;i<u;i++){if(o=d?s.geometries[i]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function $3(r,e,t){var n=t;return Ng(r,function(i,o,u,s,d){o===0&&t===void 0?n=i:n=e(n,i,o,u,s,d)}),n}function uc(r,e){Ng(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(ss(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:d,coordinates:g};if(e(ss(_,i),n,p)===!1)return!1}})}function B3(r,e,t){var n=t;return uc(r,function(i,o,u){o===0&&u===0&&t===void 0?n=i:n=e(n,i,o,u)}),n}function lw(r,e){uc(r,function(t,n,i){var o=0;if(t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var s,d=0,p=0,g=0;if(th(t,function(_,x,C,M,P){if(s===void 0||n>d||M>p||P>g){s=_,d=n,p=M,g=P,o=0;return}var A=ts([s,_],t.properties);if(e(A,n,i,P,o)===!1)return!1;o++,s=_})===!1)return!1}}})}function N3(r,e,t){var n=t,i=!1;return lw(r,function(o,u,s,d,p){i===!1&&t===void 0?n=o:n=e(n,o,u,s,d,p),i=!0}),n}function uw(r,e){if(!r)throw new Error("geojson is required");uc(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var s=0;s<u.length;s++)if(e(ts(u[s],t.properties),n,i,s)===!1)return!1;break}}})}function j3(r,e,t){var n=t;return uw(r,function(i,o,u,s){o===0&&t===void 0?n=i:n=e(n,i,o,u,s)}),n}function U3(r,e){if(e=e||{},!Bg(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var d=s.coordinates;switch(s.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),ts([d[o],d[o+1]],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),ts([d[i][o],d[i][o+1]],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),ts([d[n][o],d[n][o+1]],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o-1),ts([d[n][i][o],d[n][i][o+1]],u,e)}throw new Error("geojson is invalid")}function V3(r,e){if(e=e||{},!Bg(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,u=e.properties,s;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,s=r.features[t].geometry;break;case"Feature":u=u||r.properties,s=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":s=r;break;default:throw new Error("geojson is invalid")}if(s===null)return null;var d=s.coordinates;switch(s.type){case"Point":return yo(d,u,e);case"MultiPoint":return n<0&&(n=d.length+n),yo(d[n],u,e);case"LineString":return o<0&&(o=d.length+o),yo(d[o],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),yo(d[i][o],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),yo(d[n][o],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o),yo(d[n][i][o],u,e)}throw new Error("geojson is invalid")}const q3=Object.freeze(Object.defineProperty({__proto__:null,coordAll:O3,coordEach:th,coordReduce:D3,featureEach:Wd,featureReduce:F3,findPoint:V3,findSegment:U3,flattenEach:uc,flattenReduce:B3,geomEach:Ng,geomReduce:$3,lineEach:uw,lineReduce:j3,propEach:aw,propReduce:R3,segmentEach:lw,segmentReduce:N3},Symbol.toStringTag,{value:"Module"}));function cw(r,e,t){if(t===void 0&&(t={}),t.final===!0)return H3(r,e);var n=Vf(r),i=Vf(e),o=ns(n[0]),u=ns(i[0]),s=ns(n[1]),d=ns(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(s)*Math.sin(d)-Math.sin(s)*Math.cos(d)*Math.cos(u-o);return Uf(Math.atan2(p,g))}function H3(r,e){var t=cw(e,r);return t=(t+180)%360,t}function ff(r,e,t){t===void 0&&(t={});var n=Vf(r),i=Vf(e),o=ns(i[1]-n[1]),u=ns(i[0]-n[0]),s=ns(n[1]),d=ns(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(d);return $g(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}function H0(r,e,t,n){n===void 0&&(n={});var i=Vf(r),o=ns(i[0]),u=ns(i[1]),s=ns(t),d=op(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),_=Uf(g),x=Uf(p);return yo([_,x],n.properties)}function W0(r){if(!r)throw new Error("geojson is required");var e=[];return uc(r,function(t){W3(t,e)}),Dl(e)}function W3(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=tc(n);break;case"LineString":t=[tc(n)]}t.forEach(function(i){var o=G3(i,r.properties);o.forEach(function(u){u.id=e.length,e.push(u)})})}}function G3(r,e){var t=[];return r.reduce(function(n,i){var o=ts([n,i],e);return o.bbox=Z3(n,i),t.push(o),i}),t}function Z3(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],u=t<i?t:i,s=n<o?n:o,d=t>i?t:i,p=n>o?n:o;return[u,s,d,p]}var jg={exports:{}},fw={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(Jb,function(){function t(I,$,O,Z,X){(function q(Y,fe,Le,ee,ie){for(;ee>Le;){if(ee-Le>600){var ve=ee-Le+1,ye=fe-Le+1,it=Math.log(ve),Fe=.5*Math.exp(2*it/3),Ne=.5*Math.sqrt(it*Fe*(ve-Fe)/ve)*(ye-ve/2<0?-1:1),Ae=Math.max(Le,Math.floor(fe-ye*Fe/ve+Ne)),ot=Math.min(ee,Math.floor(fe+(ve-ye)*Fe/ve+Ne));q(Y,fe,Ae,ot,ie)}var Ye=Y[fe],ut=Le,pt=ee;for(n(Y,Le,fe),ie(Y[ee],Ye)>0&&n(Y,Le,ee);ut<pt;){for(n(Y,ut,pt),ut++,pt--;ie(Y[ut],Ye)<0;)ut++;for(;ie(Y[pt],Ye)>0;)pt--}ie(Y[Le],Ye)===0?n(Y,Le,pt):n(Y,++pt,ee),pt<=fe&&(Le=pt+1),fe<=pt&&(ee=pt-1)}})(I,$,O||0,Z||I.length-1,X||i)}function n(I,$,O){var Z=I[$];I[$]=I[O],I[O]=Z}function i(I,$){return I<$?-1:I>$?1:0}var o=function(I){I===void 0&&(I=9),this._maxEntries=Math.max(4,I),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function u(I,$,O){if(!O)return $.indexOf(I);for(var Z=0;Z<$.length;Z++)if(O(I,$[Z]))return Z;return-1}function s(I,$){d(I,0,I.children.length,$,I)}function d(I,$,O,Z,X){X||(X=A(null)),X.minX=1/0,X.minY=1/0,X.maxX=-1/0,X.maxY=-1/0;for(var q=$;q<O;q++){var Y=I.children[q];p(X,I.leaf?Z(Y):Y)}return X}function p(I,$){return I.minX=Math.min(I.minX,$.minX),I.minY=Math.min(I.minY,$.minY),I.maxX=Math.max(I.maxX,$.maxX),I.maxY=Math.max(I.maxY,$.maxY),I}function g(I,$){return I.minX-$.minX}function _(I,$){return I.minY-$.minY}function x(I){return(I.maxX-I.minX)*(I.maxY-I.minY)}function C(I){return I.maxX-I.minX+(I.maxY-I.minY)}function M(I,$){return I.minX<=$.minX&&I.minY<=$.minY&&$.maxX<=I.maxX&&$.maxY<=I.maxY}function P(I,$){return $.minX<=I.maxX&&$.minY<=I.maxY&&$.maxX>=I.minX&&$.maxY>=I.minY}function A(I){return{children:I,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function L(I,$,O,Z,X){for(var q=[$,O];q.length;)if(!((O=q.pop())-($=q.pop())<=Z)){var Y=$+Math.ceil((O-$)/Z/2)*Z;t(I,Y,$,O,X),q.push($,Y,Y,O)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(I){var $=this.data,O=[];if(!P(I,$))return O;for(var Z=this.toBBox,X=[];$;){for(var q=0;q<$.children.length;q++){var Y=$.children[q],fe=$.leaf?Z(Y):Y;P(I,fe)&&($.leaf?O.push(Y):M(I,fe)?this._all(Y,O):X.push(Y))}$=X.pop()}return O},o.prototype.collides=function(I){var $=this.data;if(!P(I,$))return!1;for(var O=[];$;){for(var Z=0;Z<$.children.length;Z++){var X=$.children[Z],q=$.leaf?this.toBBox(X):X;if(P(I,q)){if($.leaf||M(I,q))return!0;O.push(X)}}$=O.pop()}return!1},o.prototype.load=function(I){if(!I||!I.length)return this;if(I.length<this._minEntries){for(var $=0;$<I.length;$++)this.insert(I[$]);return this}var O=this._build(I.slice(),0,I.length-1,0);if(this.data.children.length)if(this.data.height===O.height)this._splitRoot(this.data,O);else{if(this.data.height<O.height){var Z=this.data;this.data=O,O=Z}this._insert(O,this.data.height-O.height-1,!0)}else this.data=O;return this},o.prototype.insert=function(I){return I&&this._insert(I,this.data.height-1),this},o.prototype.clear=function(){return this.data=A([]),this},o.prototype.remove=function(I,$){if(!I)return this;for(var O,Z,X,q=this.data,Y=this.toBBox(I),fe=[],Le=[];q||fe.length;){if(q||(q=fe.pop(),Z=fe[fe.length-1],O=Le.pop(),X=!0),q.leaf){var ee=u(I,q.children,$);if(ee!==-1)return q.children.splice(ee,1),fe.push(q),this._condense(fe),this}X||q.leaf||!M(q,Y)?Z?(O++,q=Z.children[O],X=!1):q=null:(fe.push(q),Le.push(O),O=0,Z=q,q=q.children[0])}return this},o.prototype.toBBox=function(I){return I},o.prototype.compareMinX=function(I,$){return I.minX-$.minX},o.prototype.compareMinY=function(I,$){return I.minY-$.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(I){return this.data=I,this},o.prototype._all=function(I,$){for(var O=[];I;)I.leaf?$.push.apply($,I.children):O.push.apply(O,I.children),I=O.pop();return $},o.prototype._build=function(I,$,O,Z){var X,q=O-$+1,Y=this._maxEntries;if(q<=Y)return s(X=A(I.slice($,O+1)),this.toBBox),X;Z||(Z=Math.ceil(Math.log(q)/Math.log(Y)),Y=Math.ceil(q/Math.pow(Y,Z-1))),(X=A([])).leaf=!1,X.height=Z;var fe=Math.ceil(q/Y),Le=fe*Math.ceil(Math.sqrt(Y));L(I,$,O,Le,this.compareMinX);for(var ee=$;ee<=O;ee+=Le){var ie=Math.min(ee+Le-1,O);L(I,ee,ie,fe,this.compareMinY);for(var ve=ee;ve<=ie;ve+=fe){var ye=Math.min(ve+fe-1,ie);X.children.push(this._build(I,ve,ye,Z-1))}}return s(X,this.toBBox),X},o.prototype._chooseSubtree=function(I,$,O,Z){for(;Z.push($),!$.leaf&&Z.length-1!==O;){for(var X=1/0,q=1/0,Y=void 0,fe=0;fe<$.children.length;fe++){var Le=$.children[fe],ee=x(Le),ie=(ve=I,ye=Le,(Math.max(ye.maxX,ve.maxX)-Math.min(ye.minX,ve.minX))*(Math.max(ye.maxY,ve.maxY)-Math.min(ye.minY,ve.minY))-ee);ie<q?(q=ie,X=ee<X?ee:X,Y=Le):ie===q&&ee<X&&(X=ee,Y=Le)}$=Y||$.children[0]}var ve,ye;return $},o.prototype._insert=function(I,$,O){var Z=O?I:this.toBBox(I),X=[],q=this._chooseSubtree(Z,this.data,$,X);for(q.children.push(I),p(q,Z);$>=0&&X[$].children.length>this._maxEntries;)this._split(X,$),$--;this._adjustParentBBoxes(Z,X,$)},o.prototype._split=function(I,$){var O=I[$],Z=O.children.length,X=this._minEntries;this._chooseSplitAxis(O,X,Z);var q=this._chooseSplitIndex(O,X,Z),Y=A(O.children.splice(q,O.children.length-q));Y.height=O.height,Y.leaf=O.leaf,s(O,this.toBBox),s(Y,this.toBBox),$?I[$-1].children.push(Y):this._splitRoot(O,Y)},o.prototype._splitRoot=function(I,$){this.data=A([I,$]),this.data.height=I.height+1,this.data.leaf=!1,s(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(I,$,O){for(var Z,X,q,Y,fe,Le,ee,ie=1/0,ve=1/0,ye=$;ye<=O-$;ye++){var it=d(I,0,ye,this.toBBox),Fe=d(I,ye,O,this.toBBox),Ne=(X=it,q=Fe,Y=void 0,fe=void 0,Le=void 0,ee=void 0,Y=Math.max(X.minX,q.minX),fe=Math.max(X.minY,q.minY),Le=Math.min(X.maxX,q.maxX),ee=Math.min(X.maxY,q.maxY),Math.max(0,Le-Y)*Math.max(0,ee-fe)),Ae=x(it)+x(Fe);Ne<ie?(ie=Ne,Z=ye,ve=Ae<ve?Ae:ve):Ne===ie&&Ae<ve&&(ve=Ae,Z=ye)}return Z||O-$},o.prototype._chooseSplitAxis=function(I,$,O){var Z=I.leaf?this.compareMinX:g,X=I.leaf?this.compareMinY:_;this._allDistMargin(I,$,O,Z)<this._allDistMargin(I,$,O,X)&&I.children.sort(Z)},o.prototype._allDistMargin=function(I,$,O,Z){I.children.sort(Z);for(var X=this.toBBox,q=d(I,0,$,X),Y=d(I,O-$,O,X),fe=C(q)+C(Y),Le=$;Le<O-$;Le++){var ee=I.children[Le];p(q,I.leaf?X(ee):ee),fe+=C(q)}for(var ie=O-$-1;ie>=$;ie--){var ve=I.children[ie];p(Y,I.leaf?X(ve):ve),fe+=C(Y)}return fe},o.prototype._adjustParentBBoxes=function(I,$,O){for(var Z=O;Z>=0;Z--)p($[Z],I)},o.prototype._condense=function(I){for(var $=I.length-1,O=void 0;$>=0;$--)I[$].children.length===0?$>0?(O=I[$-1].children).splice(O.indexOf(I[$]),1):this.clear():s(I[$],this.toBBox)},o})})(fw);var K3=fw.exports;const X3=Rg(z3),Y3=Rg(q3);function hw(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,_=0,x,C=r.type,M=C==="FeatureCollection",P=C==="Feature",A=M?r.features.length:1,L=0;L<A;L++){p=M?r.features[L].geometry:P?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var $=0,O=0;if(u=x?p.geometries[I]:p,u!==null){d=u.coordinates;var Z=u.type;switch(g=t&&(Z==="Polygon"||Z==="MultiPolygon")?1:0,Z){case null:break;case"Point":if(e(d,_,L,$,O)===!1)return!1;_++,$++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,L,$,O)===!1)return!1;_++,Z==="MultiPoint"&&$++}Z==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],_,L,$,O)===!1)return!1;_++}Z==="MultiLineString"&&$++,Z==="Polygon"&&O++}Z==="Polygon"&&$++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(O=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],_,L,$,O)===!1)return!1;_++}O++}$++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(hw(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function dw(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return hw(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var J3=dw;const Q3=Object.freeze(Object.defineProperty({__proto__:null,bbox:dw,default:J3},Symbol.toStringTag,{value:"Module"})),e4=Rg(Q3);var Fs=K3,pw=X3,mw=Y3,$u=e4.default,t4=mw.featureEach;mw.coordEach;pw.polygon;var G0=pw.featureCollection;function gw(r){var e=new Fs(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:$u(t),Fs.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:$u(i),n.push(i)}):t4(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:$u(i),n.push(i)}),Fs.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:$u(t),Fs.prototype.remove.call(this,t,n)},e.clear=function(){return Fs.prototype.clear.call(this)},e.search=function(t){var n=Fs.prototype.search.call(this,this.toBBox(t));return G0(n)},e.collides=function(t){return Fs.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=Fs.prototype.all.call(this);return G0(t)},e.toJSON=function(){return Fs.prototype.toJSON.call(this)},e.fromJSON=function(t){return Fs.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=$u(t);else if(t.type==="FeatureCollection")n=$u(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}jg.exports=gw;jg.exports.default=gw;var n4=jg.exports;const r4=Qb(n4);function i4(r,e){var t={},n=[];if(r.type==="LineString"&&(r=ss(r)),e.type==="LineString"&&(e=ss(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Z0(r,e);return i&&n.push(i),Dl(n)}var o=r4();return o.load(W0(e)),Wd(W0(r),function(u){Wd(o.search(u),function(s){var d=Z0(u,s);if(d){var p=tc(d).join(",");t[p]||(t[p]=!0,n.push(d))}})}),Dl(n)}function Z0(r,e){var t=tc(r),n=tc(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],u=t[1][0],s=t[1][1],d=n[0][0],p=n[0][1],g=n[1][0],_=n[1][1],x=(_-p)*(u-i)-(g-d)*(s-o),C=(g-d)*(o-p)-(_-p)*(i-d),M=(u-i)*(o-p)-(s-o)*(i-d);if(x===0)return null;var P=C/x,A=M/x;if(P>=0&&P<=1&&A>=0&&A<=1){var L=i+P*(u-i),I=o+P*(s-o);return yo([L,I])}return null}function o4(r,e,t){t===void 0&&(t={});var n=yo([1/0,1/0],{dist:1/0}),i=0;return uc(r,function(o){for(var u=tc(o),s=0;s<u.length-1;s++){var d=yo(u[s]);d.properties.dist=ff(e,d,t);var p=yo(u[s+1]);p.properties.dist=ff(e,p,t);var g=ff(d,p,t),_=Math.max(d.properties.dist,p.properties.dist),x=cw(d,p),C=H0(e,_,x+90,t),M=H0(e,_,x-90,t),P=i4(ts([C.geometry.coordinates,M.geometry.coordinates]),ts([d.geometry.coordinates,p.geometry.coordinates])),A=null;P.features.length>0&&(A=P.features[0],A.properties.dist=ff(e,A,t),A.properties.location=i+ff(d,A,t)),d.properties.dist<n.properties.dist&&(n=d,n.properties.index=s,n.properties.location=i),p.properties.dist<n.properties.dist&&(n=p,n.properties.index=s+1,n.properties.location=i+g),A&&A.properties.dist<n.properties.dist&&(n=A,n.properties.index=s),i+=g}}),n}const s4=30;class a4{constructor(e,t,n,i,o){this.onMouseMove=u=>{if(!this.active)return;const s=[u.point.x-s4,u.point.y],d=this.map.unproject(u.point).distanceTo(this.map.unproject(s));this.inner.onMouseMove(u.lngLat.lng,u.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=u=>{this.active&&(u.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||u.key=="Escape"&&(u.stopPropagation(),this.cancel())},this.onKeyPress=u=>{if(!this.active)return;let s=u.target.tagName;s=="INPUT"||s=="TEXTAREA"||(u.key=="Enter"?(u.stopPropagation(),this.finish()):u.key=="s"||u.key=="S"?(u.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):u.key=="z"&&u.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new qd(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}const Bu=[];function Pd(r,e){return{subscribe:In(r,e).subscribe}}function In(r,e=at){let t;const n=new Set;function i(s){if(Tt(r,s)&&(r=s,t)){const d=!Bu.length;for(const p of n)p[1](),Bu.push(p,r);if(d){for(let p=0;p<Bu.length;p+=2)Bu[p][0](Bu[p+1]);Bu.length=0}}}function o(s){i(s(r))}function u(s,d=at){const p=[s,d];return n.add(p),n.size===1&&(t=e(i,o)||at),s(r),()=>{n.delete(p),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:u}}function _w(r,e,t){const n=!Array.isArray(r),i=n?[r]:r;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return Pd(t,(u,s)=>{let d=!1;const p=[];let g=0,_=at;const x=()=>{if(g)return;_();const M=e(n?p[0]:p,u,s);o?u(M):_=Wa(M)?M:at},C=i.map((M,P)=>Lg(M,A=>{p[P]=A,g&=~(1<<P),d&&x()},()=>{g|=1<<P}));return d=!0,x(),function(){cr(C),_(),d=!1}})}class l4{constructor(){rr(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty  nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,2 .toString());return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new Em(n,1,zd);for(const[o,u]of u4(n))for(const{projectKey:s,projectName:d}of u){let p=window.localStorage.getItem(s);if(!p){console.warn(`Project features not found for ${s}, skipping migration`);continue}let g=JSON.parse(p);g.app_focus=n,g.study_area_name=o,g.project_name=d,console.log(`migrating project ${s}`);let _=i.createProject(g);console.log(`Successfully migrated v0->v1 project ${s} -> ${i.projectKey(_)}`),window.localStorage.removeItem(s)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new Em(n,2,zd);for(const[o,u]of i.projects()){if(u.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}u.db_schema_version=2,i.saveProject(o,u),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,2 .toString()),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new Em(e,this.storedSchemaVersion,zd)}}const zd=Symbol("internal_method_token");class Em{constructor(e,t,n){rr(this,"appFocus");rr(this,"dbSchemaVersion");if(n!==zd)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t="My neighbourhood",i=this.project(e).features.filter(s=>{var d;return((d=s.properties)==null?void 0:d.kind)=="boundary"}),o=t,u=1;for(;i.some(s=>{var d;return((d=s.properties)==null?void 0:d.name)==o});)u++,o=`${t} #${u}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.globalAndCntProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}globalAndCntProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function u4(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[u,s,d]=o.split("/");e.has(s)||e.set(s,[]),e.get(s).push({projectKey:o,projectName:d})}catch(u){console.log(`error loading cnt project: ${o}`,u)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let u=o.split("ltn_"),s=u[u.length-1],d="";try{d=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(p){console.log(`error loading global project: ${o}`,p)}d&&d.length>0?(e.has(d)||e.set(d,[]),e.get(d).push({projectKey:o,projectName:s})):t.push({projectKey:o,projectName:s})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const yw="MZEJTanw3WpxRvt7qDfo";let as=In(null),ks=In("global"),Ba=In(void 0),c4=_w(Ba,r=>{if(r)return gi(Ga).project(r)}),za=In(void 0),vw=new l4,Ga=_w(ks,r=>vw.projectStorage(r)),K0=In(!0),Gd=In(!1),Ar=In(null),Af=In(new la.LngLat(0,0)),Pf=In(new la.LngLat(0,0)),bd=In(new la.LngLat(0,0)),X0=In(1),Gi=In(1),er=In({mode:"title",firstLoad:!0}),zf=In(!1),Zm=In("streets-v2"),Km=In("walk_cycle_only"),Y0=In(!1),Xm=In(!0),Zd=In(!0),Kd=In("shortcuts"),Ym=In(!1),Jm=In(!0),J0=In(500);function qf(){const r=gi(Ba);try{gi(Ga).saveProject(r,gi(Ar).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let Qm=In(!1);function Bo(r){return gi(Qm)?`/${r}`:`https://assets.od2net.org/${r}`}function eg(r){var n;function e(i){const o=i.getEast()-i.getWest();let u=i.getWest()+Math.random()*o;const s=i.getNorth()-i.getSouth();let d=i.getSouth()+Math.random()*s;return new la.LngLat(u,d)}const t=(n=gi(as))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(gi(r))||r.set(e(t))}function f4(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P;return{c(){e=U("h1"),e.textContent="The low-traffic neighbourhood (LTN) tool, v2",t=oe(),n=U("p"),n.innerHTML=`This is the second version of the A/B Street LTN tool, <a href="https://github.com/a-b-street/ltn" target="_blank">an open source project</a>. This version, called the Connected Neighbourhoods Tool, has been funded
    by
    <a href="https://www.transport.gov.scot/" target="_blank">Transport Scotland</a>
    and designed by
    <a href="https://www.sustrans.org.uk" target="_blank">Sustrans Scotland</a>.
    The team includes:`,i=oe(),o=U("ul"),o.innerHTML=`<li>Dustin Carlino, lead developer and director of <a href="https://find-and-update.company-information.service.gov.uk/company/16217327" target="_blank">A/B Street Ltd</a></li> <li><a href="https://github.com/michaelkirk/" target="_blank">Michael Kirk</a>, software developer</li> <li>Sustrans Scotland
      <ul><li><a href="https://www.linkedin.com/in/congying-hu/" target="_blank">Congying (Cici) Hu</a>, mobility planner</li> <li><a href="https://www.linkedin.com/in/angus-calder-a69543206" target="_blank">Angus Calder</a>, senior mobility planner</li> <li>Michael Naysmith, senior mobility planner (project manager)</li> <li><a href="https://www.linkedin.com/in/matthew-davis-6b3a8124/" target="_blank">Matthew Davis</a>, principal mobility planner</li></ul></li>`,u=oe(),s=U("p"),s.innerHTML=`This second version of the tool is an evolution from the original A/B Street
    tool, with <a href="https://a-b-street.github.io/docs/software/ltn/index.html#credits" target="_blank">many people</a> to thank there. Of the dozens of users giving excellent feedback and shaping
    the tools development, particular thanks to:`,d=oe(),p=U("ul"),p.innerHTML='<li><a href="https://github.com/XioNoX" target="_blank">Arzhel Younsi</a></li> <li><a href="https://github.com/rouelibre1" target="_blank">Rouelibre1</a></li>',g=oe(),_=U("p"),_.textContent="This tool would not be possible without:",x=oe(),C=U("ul"),C.innerHTML='<li><a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap contributors</a></li> <li><a href="https://www.maptiler.com/" target="_blank">Maptiler</a></li> <li><a href="https://georust.org/" target="_blank">GeoRust</a></li> <li><a href="https://lucide.dev/" target="_blank">Lucide icons</a></li> <li>And countless other open source libraries</li>',M=oe(),P=U("p"),P.textContent="Some road signs images  Crown copyright."},m(A,L){W(A,e,L),W(A,t,L),W(A,n,L),W(A,i,L),W(A,o,L),W(A,u,L),W(A,s,L),W(A,d,L),W(A,p,L),W(A,g,L),W(A,_,L),W(A,x,L),W(A,C,L),W(A,M,L),W(A,P,L)},p:at,d(A){A&&(H(e),H(t),H(n),H(i),H(o),H(u),H(s),H(d),H(p),H(g),H(_),H(x),H(C),H(M),H(P))}}}function h4(r){let e,t,n;function i(u){r[1](u)}let o={$$slots:{default:[f4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Dg({props:o}),dn.push(()=>Dn(e,"show",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&4&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.show=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function d4(r,e,t){let n;ct(r,Gd,o=>t(0,n=o));function i(o){n=o,Gd.set(n)}return[n,i]}class p4 extends Lt{constructor(e){super(),Et(this,e,d4,h4,Tt,{})}}/**
 * @license lucide-svelte v0.475.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const m4={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"},Q0=m4;function ey(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function Lm(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=zt(n,t[i]);return{c(){e=ws(r[11]),Vd(e,n)},m(i,o){W(i,e,o)},p(i,o){Vd(e,n=An(t,[o&32&&i[12]]))},d(i){i&&H(e)}}}function ty(r){let e=r[11],t,n=r[11]&&Lm(r);return{c(){n&&n.c(),t=tr()},m(i,o){n&&n.m(i,o),W(i,t,o)},p(i,o){i[11]?e?Tt(e,i[11])?(n.d(1),n=Lm(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=Lm(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&H(t),n&&n.d(i)}}}function g4(r){let e,t,n,i,o,u=$n(r[5]),s=[];for(let x=0;x<u.length;x+=1)s[x]=ty(ey(r,u,x));const d=r[10].default,p=vn(d,r,r[9],null);let g=[Q0,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],_={};for(let x=0;x<g.length;x+=1)_=zt(_,g[x]);return{c(){e=ws("svg");for(let x=0;x<s.length;x+=1)s[x].c();t=tr(),p&&p.c(),Vd(e,_)},m(x,C){W(x,e,C);for(let M=0;M<s.length;M+=1)s[M]&&s[M].m(e,null);F(e,t),p&&p.m(e,null),o=!0},p(x,[C]){if(C&32){u=$n(x[5]);let M;for(M=0;M<u.length;M+=1){const P=ey(x,u,M);s[M]?s[M].p(P,C):(s[M]=ty(P),s[M].c(),s[M].m(e,t))}for(;M<s.length;M+=1)s[M].d(1);s.length=u.length}p&&p.p&&(!o||C&512)&&wn(p,d,x,x[9],o?bn(d,x[9],C,null):xn(x[9]),null),Vd(e,_=An(g,[Q0,C&128&&x[7],(!o||C&4)&&{width:x[2]},(!o||C&4)&&{height:x[2]},(!o||C&2)&&{stroke:x[1]},(!o||C&28&&n!==(n=x[4]?Number(x[3])*24/Number(x[2]):x[3]))&&{"stroke-width":n},(!o||C&257&&i!==(i=x[6]("lucide-icon","lucide",x[0]?`lucide-${x[0]}`:"",x[8].class)))&&{class:i}]))},i(x){o||(N(p,x),o=!0)},o(x){V(p,x),o=!1},d(x){x&&H(e),_i(s,x),p&&p.d(x)}}}function _4(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=j0(e,n),{$$slots:o={},$$scope:u}=e,{name:s=void 0}=e,{color:d="currentColor"}=e,{size:p=24}=e,{strokeWidth:g=2}=e,{absoluteStrokeWidth:_=!1}=e,{iconNode:x=[]}=e;const C=(...M)=>M.filter((P,A,L)=>!!P&&L.indexOf(P)===A).join(" ");return r.$$set=M=>{t(8,e=zt(zt({},e),mr(M))),t(7,i=j0(e,n)),"name"in M&&t(0,s=M.name),"color"in M&&t(1,d=M.color),"size"in M&&t(2,p=M.size),"strokeWidth"in M&&t(3,g=M.strokeWidth),"absoluteStrokeWidth"in M&&t(4,_=M.absoluteStrokeWidth),"iconNode"in M&&t(5,x=M.iconNode),"$$scope"in M&&t(9,u=M.$$scope)},e=mr(e),[s,d,p,g,_,x,C,i,e,u,o]}class y4 extends Lt{constructor(e){super(),Et(this,e,_4,g4,Tt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}const ko=y4;function v4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function b4(r){let e,t;const n=[{name:"circle-help"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[v4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function w4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class x4 extends Lt{constructor(e){super(),Et(this,e,w4,b4,Tt,{})}}const k4=x4;function S4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function T4(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[S4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function C4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class M4 extends Lt{constructor(e){super(),Et(this,e,C4,T4,Tt,{})}}const E4=M4;function L4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function I4(r){let e,t;const n=[{name:"eraser"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[L4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function A4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"}],["path",{d:"M22 21H7"}],["path",{d:"m5 11 9 9"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class P4 extends Lt{constructor(e){super(),Et(this,e,A4,I4,Tt,{})}}const z4=P4;function D4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function R4(r){let e,t;const n=[{name:"eye-closed"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[D4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function F4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m15 18-.722-3.25"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0"}],["path",{d:"m20 15-1.726-2.05"}],["path",{d:"m4 15 1.726-2.05"}],["path",{d:"m9 18 .722-3.25"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class O4 extends Lt{constructor(e){super(),Et(this,e,F4,R4,Tt,{})}}const $4=O4;function B4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function N4(r){let e,t;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[B4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function j4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class U4 extends Lt{constructor(e){super(),Et(this,e,j4,N4,Tt,{})}}const V4=U4;function q4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function H4(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[q4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function W4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class G4 extends Lt{constructor(e){super(),Et(this,e,W4,H4,Tt,{})}}const bw=G4;function Z4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function K4(r){let e,t;const n=[{name:"house"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Z4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function X4(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class Y4 extends Lt{constructor(e){super(),Et(this,e,X4,K4,Tt,{})}}const J4=Y4;function Q4(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function eS(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Q4]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function tS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class nS extends Lt{constructor(e){super(),Et(this,e,tS,eS,Tt,{})}}const rS=nS;function iS(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function oS(r){let e,t;const n=[{name:"paintbrush"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[iS]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function sS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m14.622 17.897-10.68-2.913"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class aS extends Lt{constructor(e){super(),Et(this,e,sS,oS,Tt,{})}}const ww=aS;function lS(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function uS(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[lS]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function cS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class fS extends Lt{constructor(e){super(),Et(this,e,cS,uS,Tt,{})}}const Ug=fS;function hS(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function dS(r){let e,t;const n=[{name:"pointer"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[hS]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function pS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M22 14a8 8 0 0 1-8 8"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class mS extends Lt{constructor(e){super(),Et(this,e,pS,dS,Tt,{})}}const xw=mS;function gS(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function _S(r){let e,t;const n=[{name:"redo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[gS]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function yS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 7v6h-6"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class vS extends Lt{constructor(e){super(),Et(this,e,yS,_S,Tt,{})}}const bS=vS;function wS(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function xS(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[wS]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function kS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class SS extends Lt{constructor(e){super(),Et(this,e,kS,xS,Tt,{})}}const Vg=SS;function TS(r){let e;const t=r[2].default,n=vn(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&wn(n,t,i,i[3],e?bn(t,i[3],o,null):xn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function CS(r){let e,t;const n=[{name:"undo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[TS]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ko({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&3?An(n,[n[0],u&2&&xo(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function MS(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 7v6h6"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}]];return r.$$set=u=>{t(1,e=zt(zt({},e),mr(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=mr(e),[o,e,n,i]}class ES extends Lt{constructor(e){super(),Et(this,e,MS,CS,Tt,{})}}const LS=ES;let IS=Date.now();function Ol(r){return`${r}-${IS++}`}const qg=Symbol.for("svelte-maplibre");function Za(){return Qf(qg)}function AS(r){let e=new WeakMap;return t=>{var u;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(u=t.target.queryRenderedFeatures(t.point).find(s=>{var d;return(d=r.get(s.layer.id))==null?void 0:d.interactive}))==null?void 0:u.layer.id;return e.set(t.originalEvent,o),o}}function PS(){let r=new Map;return rp(qg,{map:In(null),source:Pd(null),layer:Pd(null),popupTarget:Pd(null),cluster:In(),loadedImages:In(new Set),minzoom:In(0),maxzoom:In(24),layerEvent:In(null),layerInfo:r,eventTopMost:AS(r),markerClickManager:new RS})}function ny(r){return{subscribe:r.subscribe}}function Hg({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=Za(),o=In(null),u=ny(o),s={...i,[r]:ny(o)};if(e&&(s.popupTarget=u),n){let d=In(null);s.layerEvent=d,i.layerEvent=d}return t&&(s.cluster=In()),rp(qg,s),{...i,self:o}}function kw(){return Hg({key:"source",setCluster:!0})}function Sw(r=!0){return Hg({key:"layer",setPopupTarget:r,setMouseEvent:r})}function zS(){return Hg({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function DS(r){return"layerType"in r&&r.layerType==="deckgl"}class RS{constructor(){rr(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}function ry(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function FS(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function OS(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Qn(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var Na=$S;function $S(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var u=o[n],s=r[u];s!=null&&(e[u]=s)}return e}}}function iy(r){let e=r[0],t,n,i=oy(r);return{c(){i.c(),t=tr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&Tt(e,e=o[0])?(Xt(),V(i,1,1,at),Yt(),i=oy(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function oy(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function BS(r){let e,t,n=r[0]&&iy(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=iy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function NS(r,e,t){let n,i,o,u,s,d,p,g,_,x,C,M,{$$slots:P={},$$scope:A}=e,{id:L=Ol("layer")}=e,{source:I=void 0}=e,{sourceLayer:$=void 0}=e,{beforeId:O=void 0}=e,{beforeLayerType:Z=void 0}=e,{type:X}=e,{paint:q=void 0}=e,{layout:Y=void 0}=e,{filter:fe=void 0}=e,{applyToClusters:Le=void 0}=e,{minzoom:ee=void 0}=e,{maxzoom:ie=void 0}=e,{manageHoverState:ve=!1}=e,{hovered:ye=null}=e,{interactive:it=!0}=e,{hoverCursor:Fe=void 0}=e,{eventsIfTopMost:Ne=!1}=e;const Ae=Ns(),{map:ot,source:Ye,self:ut,minzoom:pt,maxzoom:_t,eventTopMost:He,layerInfo:mt}=Sw();ct(r,ot,qe=>t(31,_=qe)),ct(r,Ye,qe=>t(32,x=qe)),ct(r,ut,qe=>t(0,g=qe)),ct(r,pt,qe=>t(34,M=qe)),ct(r,_t,qe=>t(33,C=qe)),ri(()=>{g&&_&&(mt.delete(g),_==null||_.removeLayer(g))});let Pt;function jt(qe){var pe,fn;if(!it||!g||!_||Ne&&He(qe)!==g)return;let We=qe.features??[],Ke=(fn=(pe=We[0])==null?void 0:pe.properties)==null?void 0:fn.cluster_id,kt={event:qe,map:_,clusterId:Ke,layer:g,source:s,features:We};Ae(qe.type,kt)}function un(qe){var pe,fn;if(!it||!g||!_||Ne&&He(qe)!==g)return;Fe&&(_.getCanvas().style.cursor=Fe);let We=qe.features??[];t(6,ye=We[0]??null);let Ke=(fn=(pe=We[0])==null?void 0:pe.properties)==null?void 0:fn.cluster_id;Ae("mouseenter",{event:qe,map:_,clusterId:Ke,layer:g,source:s,features:We})}function nn(qe){var pe,fn,Xe;if(!it||!_)return;if(Ne&&He(qe)!==g){t(6,ye=null),ve&&Pt!==void 0&&(_==null||_.setFeatureState({source:s,sourceLayer:$,id:Pt},{hover:!1}),Pt=void 0);return}_.getCanvas().style.cursor=Fe;let We=qe.features??[],Ke=(fn=(pe=We[0])==null?void 0:pe.properties)==null?void 0:fn.cluster_id,kt=(Xe=We[0])==null?void 0:Xe.id;kt!==Pt&&(ve&&(Pt!==void 0&&(_==null||_.setFeatureState({source:s,id:Pt,sourceLayer:$},{hover:!1})),_==null||_.setFeatureState({source:s,id:kt,sourceLayer:$},{hover:!0})),Pt=kt,t(6,ye=We[0]??null)),Ae("mousemove",{event:qe,map:_,clusterId:Ke,layer:g,source:s,features:We})}function rn(qe){if(!(!it||!g||!_)){if(Fe&&(_.getCanvas().style.cursor=""),t(6,ye=null),ve&&Pt!==void 0){const We={source:s,id:Pt,sourceLayer:$};_==null||_.setFeatureState(We,{hover:!1}),Pt=void 0}Ae("mouseleave",{map:_,layer:g,source:s})}}let pn=!0;function yn(qe){_&&(_.off("click",qe,jt),_.off("dblclick",qe,jt),_.off("contextmenu",qe,jt),_.off("mouseenter",qe,un),_.off("mousemove",qe,nn),_.off("mouseleave",qe,rn))}return ri(()=>{_&&g&&yn(g)}),r.$$set=qe=>{"id"in qe&&t(7,L=qe.id),"source"in qe&&t(8,I=qe.source),"sourceLayer"in qe&&t(9,$=qe.sourceLayer),"beforeId"in qe&&t(10,O=qe.beforeId),"beforeLayerType"in qe&&t(11,Z=qe.beforeLayerType),"type"in qe&&t(12,X=qe.type),"paint"in qe&&t(13,q=qe.paint),"layout"in qe&&t(14,Y=qe.layout),"filter"in qe&&t(15,fe=qe.filter),"applyToClusters"in qe&&t(16,Le=qe.applyToClusters),"minzoom"in qe&&t(17,ee=qe.minzoom),"maxzoom"in qe&&t(18,ie=qe.maxzoom),"manageHoverState"in qe&&t(19,ve=qe.manageHoverState),"hovered"in qe&&t(6,ye=qe.hovered),"interactive"in qe&&t(20,it=qe.interactive),"hoverCursor"in qe&&t(21,Fe=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,Ne=qe.eventsIfTopMost),"$$scope"in qe&&t(35,A=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=OS(Le)),r.$$.dirty[0]&1073774592&&t(24,i=FS("all",n,fe)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ee??M),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=ie??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=I||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&g!==L&&s){g&&(yn(g),mt.delete(g));let qe=O;if(!O&&Z){let We=_.getStyle().layers,Ke=typeof Z=="function"?Z:pe=>pe.type===Z,kt=We==null?void 0:We.find(Ke);kt&&(qe=kt.id)}ln(ut,g=L,g),_.addLayer(Na({id:g,type:X,source:s,"source-layer":$,filter:i,paint:q,layout:Y,minzoom:o,maxzoom:u}),qe),t(23,pn=!0),_.on("click",g,jt),_.on("dblclick",g,jt),_.on("contextmenu",g,jt),_.on("mouseenter",g,un),_.on("mousemove",g,nn),_.on("mouseleave",g,rn)}r.$$.dirty[0]&1048577&&g&&mt.set(g,{interactive:it}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?ry((qe,We)=>{_!=null&&_.style._loaded?_.setPaintProperty(g,qe,We):_==null||_.once("styledata",()=>_==null?void 0:_.setPaintProperty(g,qe,We))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?ry((qe,We)=>{_!=null&&_.style._loaded?_.setLayoutProperty(g,qe,We):_==null||_.once("styledata",()=>_==null?void 0:_.setLayoutProperty(g,qe,We))}):void 0),r.$$.dirty[0]&268443648&&(d==null||d(q)),r.$$.dirty[0]&134234112&&(p==null||p(Y)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(_==null||_.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(pn?t(23,pn=!1):_==null||_.setFilter(g,i))},[g,ot,Ye,ut,pt,_t,ye,L,I,$,O,Z,X,q,Y,fe,Le,ee,ie,ve,it,Fe,Ne,pn,i,u,o,p,d,s,n,_,x,C,M,A,P]}let sp=class extends Lt{constructor(e){super(),Et(this,e,NS,BS,Tt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function jS(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function US(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[jS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new sp({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function VS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ol("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:A=void 0}=e,{manageHoverState:L=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:O=!0}=e;function Z(ie){I=ie,t(0,I)}function X(ie){Pn.call(this,r,ie)}function q(ie){Pn.call(this,r,ie)}function Y(ie){Pn.call(this,r,ie)}function fe(ie){Pn.call(this,r,ie)}function Le(ie){Pn.call(this,r,ie)}function ee(ie){Pn.call(this,r,ie)}return r.$$set=ie=>{"id"in ie&&t(1,o=ie.id),"source"in ie&&t(2,u=ie.source),"sourceLayer"in ie&&t(3,s=ie.sourceLayer),"beforeId"in ie&&t(4,d=ie.beforeId),"beforeLayerType"in ie&&t(5,p=ie.beforeLayerType),"paint"in ie&&t(6,g=ie.paint),"layout"in ie&&t(7,_=ie.layout),"filter"in ie&&t(8,x=ie.filter),"applyToClusters"in ie&&t(9,C=ie.applyToClusters),"minzoom"in ie&&t(10,M=ie.minzoom),"maxzoom"in ie&&t(11,P=ie.maxzoom),"hoverCursor"in ie&&t(12,A=ie.hoverCursor),"manageHoverState"in ie&&t(13,L=ie.manageHoverState),"hovered"in ie&&t(0,I=ie.hovered),"eventsIfTopMost"in ie&&t(14,$=ie.eventsIfTopMost),"interactive"in ie&&t(15,O=ie.interactive),"$$scope"in ie&&t(24,i=ie.$$scope)},[I,o,u,s,d,p,g,_,x,C,M,P,A,L,$,O,n,Z,X,q,Y,fe,Le,ee,i]}let $l=class extends Lt{constructor(e){super(),Et(this,e,VS,US,Tt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function qS(r){let e,t;const n=r[7].default,i=vn(n,r,r[6],null);return{c(){e=U("div"),i&&i.c(),he(e,"class",r[1]),Gt(e,"maplibregl-ctrl",r[0])},m(o,u){W(o,e,u),i&&i.m(e,null),r[8](e),t=!0},p(o,[u]){i&&i.p&&(!t||u&64)&&wn(i,n,o,o[6],t?bn(n,o[6],u,null):xn(o[6]),null),(!t||u&2)&&he(e,"class",o[1]),(!t||u&3)&&Gt(e,"maplibregl-ctrl",o[0])},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o),r[8](null)}}}function HS(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:u=!0}=e,{position:s="top-right"}=e,{class:d=void 0}=e;const{map:p}=Za();ct(r,p,C=>t(5,n=C));let g,_={onAdd(){return g},onRemove(){var C;(C=g==null?void 0:g.parentNode)==null||C.removeChild(g)}};ri(()=>{n==null||n.removeControl(_)});function x(C){dn[C?"unshift":"push"](()=>{g=C,t(2,g)})}return r.$$set=C=>{"defaultStyling"in C&&t(0,u=C.defaultStyling),"position"in C&&t(4,s=C.position),"class"in C&&t(1,d=C.class),"$$scope"in C&&t(6,o=C.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&g&&n.addControl(_,s)},[u,d,g,p,s,n,o,i,x]}class tg extends Lt{constructor(e){super(),Et(this,e,HS,qS,Tt,{defaultStyling:0,position:4,class:1})}}function WS(r){let e,t,n,i,o,u;const s=r[5].default,d=vn(s,r,r[4],null);return{c(){e=U("button"),t=U("div"),d&&d.c(),he(t,"class",n=ec(r[3])+" svelte-1s83zbq"),Gt(t,"maplibregl-ctrl-icon",r[0]),Gt(t,"ctrl-btn-center",r[1]),he(e,"type","button"),he(e,"title",r[2])},m(p,g){W(p,e,g),F(e,t),d&&d.m(t,null),i=!0,o||(u=It(e,"click",r[6]),o=!0)},p(p,[g]){d&&d.p&&(!i||g&16)&&wn(d,s,p,p[4],i?bn(s,p[4],g,null):xn(p[4]),null),(!i||g&8&&n!==(n=ec(p[3])+" svelte-1s83zbq"))&&he(t,"class",n),(!i||g&9)&&Gt(t,"maplibregl-ctrl-icon",p[0]),(!i||g&10)&&Gt(t,"ctrl-btn-center",p[1]),(!i||g&4)&&he(e,"title",p[2])},i(p){i||(N(d,p),i=!0)},o(p){V(d,p),i=!1},d(p){p&&H(e),d&&d.d(p),o=!1,u()}}}function GS(r,e,t){let{$$slots:n={},$$scope:i}=e,{icon:o=!0}=e,{center:u=!0}=e,{title:s=void 0}=e,{class:d=void 0}=e;function p(g){Pn.call(this,r,g)}return r.$$set=g=>{"icon"in g&&t(0,o=g.icon),"center"in g&&t(1,u=g.center),"title"in g&&t(2,s=g.title),"class"in g&&t(3,d=g.class),"$$scope"in g&&t(4,i=g.$$scope)},[o,u,s,d,i,n,p]}class Tw extends Lt{constructor(e){super(),Et(this,e,GS,WS,Tt,{icon:0,center:1,title:2,class:3})}}function ZS(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[1],null);return{c(){e=U("div"),o&&o.c(),he(e,"class",t="maplibregl-ctrl-group "+r[0])},m(u,s){W(u,e,s),o&&o.m(e,null),n=!0},p(u,[s]){o&&o.p&&(!n||s&2)&&wn(o,i,u,u[1],n?bn(i,u[1],s,null):xn(u[1]),null),(!n||s&1&&t!==(t="maplibregl-ctrl-group "+u[0]))&&he(e,"class",t)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&H(e),o&&o.d(u)}}}function KS(r,e,t){let{$$slots:n={},$$scope:i}=e,{class:o=""}=e;return r.$$set=u=>{"class"in u&&t(0,o=u.class),"$$scope"in u&&t(1,i=u.$$scope)},[o,i,n]}class Cw extends Lt{constructor(e){super(),Et(this,e,KS,ZS,Tt,{class:0})}}function XS(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function YS(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[XS]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new sp({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function JS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ol("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:A=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:$=!0}=e;function O(ee){L=ee,t(0,L)}function Z(ee){Pn.call(this,r,ee)}function X(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function Y(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Le(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,M=ee.maxzoom),"hoverCursor"in ee&&t(11,P=ee.hoverCursor),"manageHoverState"in ee&&t(12,A=ee.manageHoverState),"hovered"in ee&&t(0,L=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,$=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[L,o,u,s,d,p,g,_,x,C,M,P,A,I,$,n,O,Z,X,q,Y,fe,Le,i]}let Xi=class extends Lt{constructor(e){super(),Et(this,e,JS,YS,Tt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function QS(r,e,t){let n;const{map:i}=Za();ct(r,i,d=>t(4,n=d));let{position:o="top-left"}=e,{container:u=void 0}=e,s=null;return ri(()=>{n!=null&&n.loaded()&&s&&n.removeControl(s)}),r.$$set=d=>{"position"in d&&t(1,o=d.position),"container"in d&&t(2,u=d.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!s){let d;typeof u=="string"?d=document.querySelector(u)??void 0:d=u,t(3,s=new ni.FullscreenControl({container:d})),n.addControl(s,o)}},[i,o,u,s,n]}class e5 extends Lt{constructor(e){super(),Et(this,e,QS,null,Tt,{position:1,container:2})}}function Mw(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function Ew(r,e,t){Xb().then(()=>{let n=gi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function sy(r){let e=r[0],t,n,i=ay(r);return{c(){i.c(),t=tr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&Tt(e,e=o[0])?(Xt(),V(i,1,1,at),Yt(),i=ay(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function ay(r){let e;const t=r[19].default,n=vn(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&wn(n,t,i,i[18],e?bn(t,i[18],o,null):xn(i[18]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function t5(r){let e,t,n=r[0]&&sy(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=sy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function n5(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:d=Ol("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:_=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:M=void 0}=e,{maxzoom:P=void 0}=e,{attribution:A=void 0}=e,{buffer:L=void 0}=e,{tolerance:I=void 0}=e;const{map:$,cluster:O,self:Z}=kw();ct(r,$,Y=>t(17,i=Y)),ct(r,O,Y=>t(20,o=Y)),ct(r,Z,Y=>t(0,n=Y));let X,q=!0;return ri(()=>{n&&X&&i&&(Ew($,n,X),ln(Z,n=null,n),t(15,X=void 0))}),r.$$set=Y=>{"id"in Y&&t(4,d=Y.id),"data"in Y&&t(5,p=Y.data),"generateId"in Y&&t(6,g=Y.generateId),"promoteId"in Y&&t(7,_=Y.promoteId),"filter"in Y&&t(8,x=Y.filter),"lineMetrics"in Y&&t(9,C=Y.lineMetrics),"cluster"in Y&&t(10,M=Y.cluster),"maxzoom"in Y&&t(11,P=Y.maxzoom),"attribution"in Y&&t(12,A=Y.attribution),"buffer"in Y&&t(13,L=Y.buffer),"tolerance"in Y&&t(14,I=Y.tolerance),"$$scope"in Y&&t(18,s=Y.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&ln(O,o=M,o),r.$$.dirty&196593&&i&&n!==d&&(ln(Z,n=d,n),Mw(i,n,Na({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:_,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties,maxzoom:P,attribution:A,buffer:L,tolerance:I}),Y=>i&&Y===n,()=>{n&&(t(15,X=i==null?void 0:i.getSource(n)),t(16,q=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,X=i==null?void 0:i.getSource(d))})),r.$$.dirty&98336&&X&&(q?t(16,q=!1):X.setData(p)),r.$$.dirty&33792&&(X==null||X.setClusterOptions(Na({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[n,$,O,Z,d,p,g,_,x,C,M,P,A,L,I,X,q,i,s,u]}let gr=class extends Lt{constructor(e){super(),Et(this,e,n5,t5,Tt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function r5(r,e,t){let n;const{map:i}=Za();ct(r,i,x=>t(8,n=x));let{position:o="top-left"}=e,{positionOptions:u=void 0}=e,{fitBoundsOptions:s=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:p=!0}=e,{showUserLocation:g=!0}=e,{control:_=null}=e;return ri(()=>{n!=null&&n.loaded()&&_&&n.removeControl(_)}),r.$$set=x=>{"position"in x&&t(2,o=x.position),"positionOptions"in x&&t(3,u=x.positionOptions),"fitBoundsOptions"in x&&t(4,s=x.fitBoundsOptions),"trackUserLocation"in x&&t(5,d=x.trackUserLocation),"showAccuracyCircle"in x&&t(6,p=x.showAccuracyCircle),"showUserLocation"in x&&t(7,g=x.showUserLocation),"control"in x&&t(1,_=x.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!_&&(t(1,_=new ni.GeolocateControl({positionOptions:u,fitBoundsOptions:s,trackUserLocation:d,showAccuracyCircle:p,showUserLocation:g})),n.addControl(_,o))},[i,_,o,u,s,d,p,g,n]}class i5 extends Lt{constructor(e){super(),Et(this,e,r5,null,Tt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function o5(r,e,t){let n,i,{data:o}=e,{idCol:u}=e,{sourceLayer:s=void 0}=e,d=new Set;const{map:p,source:g}=Sw();return ct(r,p,_=>t(6,n=_)),ct(r,g,_=>t(7,i=_)),r.$$set=_=>{"data"in _&&t(2,o=_.data),"idCol"in _&&t(3,u=_.idCol),"sourceLayer"in _&&t(4,s=_.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let _=new Set;for(const x of o){const C=x[u];if(!C)continue;d.delete(C),_.add(C);const M={id:C,source:i,sourceLayer:s},P=n.getFeatureState(M);let A=!1;for(const L of Object.keys(x))if(P[L]!==x[L]){A=!0;break}A&&n.setFeatureState(M,x)}for(const x of d){const C={id:x,source:i,sourceLayer:s},M=n.getFeatureState(C);for(const P of Object.keys(M))n.removeFeatureState(C,P)}t(5,d=_)}},[p,g,o,u,s,d,n,i]}class s5 extends Lt{constructor(e){super(),Et(this,e,o5,null,Tt,{data:2,idCol:3,sourceLayer:4})}}function a5(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function l5(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[a5]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new sp({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function u5(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ol("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:A=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:$=!0}=e;function O(ee){L=ee,t(0,L)}function Z(ee){Pn.call(this,r,ee)}function X(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function Y(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Le(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,M=ee.maxzoom),"hoverCursor"in ee&&t(11,P=ee.hoverCursor),"manageHoverState"in ee&&t(12,A=ee.manageHoverState),"hovered"in ee&&t(0,L=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,$=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[L,o,u,s,d,p,g,_,x,C,M,P,A,I,$,n,O,Z,X,q,Y,fe,Le,i]}let ur=class extends Lt{constructor(e){super(),Et(this,e,u5,l5,Tt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function c5(r,e,t){let n;const i=Ns();let{layer:o=void 0}=e;const{map:u}=Za();ct(r,u,g=>t(2,n=g));function s(g){i(g.type,{...g,map:u})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],p=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ri(()=>{if(n)if(o)for(const g of d)n.off(g,o,s);else for(const g of p)n.off(g,s)}),r.$$set=g=>{"layer"in g&&t(1,o=g.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const g of d)n.on(g,o,s);else for(const g of p)n.on(g,s)},[u,o,n]}class Wg extends Lt{constructor(e){super(),Et(this,e,c5,null,Tt,{layer:1})}}function f5(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,u=Math.round(e.lng*i)/i,s=`${t}/${o}/${u}`,d=r.getBearing(),p=r.getPitch();return(d||p)&&(s+=`/${Math.round(d*10)/10}`),p&&(s+=`/${Math.round(p)}`),`#${s}`}function h5(r){return r.replace("#","").split("/").map(parseFloat)}var Nu=Gg;function Gg(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?ly(r,e):{}.toString.call(r)=="[object Set]"?ly(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?p5(r,e):d5(r,e)}function d5(r,e){return r.toString()===e.toString()}function ly(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Gg(r[n],e[n]))return!1;return!0}function p5(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&Gg(r[o],e[o])))return!1}return!0}function m5(r,e,t){let n;const{map:i}=Za();ct(r,i,g=>t(6,n=g));let{position:o="top-left"}=e,{showCompass:u=!0}=e,{showZoom:s=!0}=e,{visualizePitch:d=!1}=e,p=null;return ri(()=>{n!=null&&n.loaded()&&p&&n.removeControl(p)}),r.$$set=g=>{"position"in g&&t(1,o=g.position),"showCompass"in g&&t(2,u=g.showCompass),"showZoom"in g&&t(3,s=g.showZoom),"visualizePitch"in g&&t(4,d=g.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!p&&(t(5,p=new ni.NavigationControl({showCompass:u,showZoom:s,visualizePitch:d})),n.addControl(p,o))},[i,o,u,s,d,p,n]}class Lw extends Lt{constructor(e){super(),Et(this,e,m5,null,Tt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function g5(r,e,t){let n;const{map:i}=Za();ct(r,i,p=>t(5,n=p));let{position:o="bottom-left"}=e,{maxWidth:u=void 0}=e,{unit:s="metric"}=e,d=null;return ri(()=>{n!=null&&n.loaded()&&d&&n.removeControl(d)}),r.$$set=p=>{"position"in p&&t(1,o=p.position),"maxWidth"in p&&t(2,u=p.maxWidth),"unit"in p&&t(3,s=p.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!d&&(t(4,d=new ni.ScaleControl({maxWidth:u,unit:s})),n.addControl(d,o))},[i,o,u,s,d,n]}class Iw extends Lt{constructor(e){super(),Et(this,e,g5,null,Tt,{position:1,maxWidth:2,unit:3})}}const{window:_5}=Gb,y5=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),uy=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function cy(r){let e,t,n=r[3]&&fy(r);const i=r[46].default,o=vn(i,r,r[45],uy);return{c(){n&&n.c(),e=oe(),o&&o.c()},m(u,s){n&&n.m(u,s),W(u,e,s),o&&o.m(u,s),t=!0},p(u,s){u[3]?n?(n.p(u,s),s[0]&8&&N(n,1)):(n=fy(u),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt()),o&&o.p&&(!t||s[0]&112|s[1]&16384)&&wn(o,i,u,u[45],t?bn(i,u[45],s,y5):xn(u[45]),uy)},i(u){t||(N(n),N(o,u),t=!0)},o(u){V(n),V(o,u),t=!1},d(u){u&&H(e),n&&n.d(u),o&&o.d(u)}}}function fy(r){let e,t,n,i,o,u,s,d;return e=new Lw({props:{position:r[7]}}),n=new i5({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new e5({props:{position:r[7]}}),s=new Iw({props:{position:r[7]}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),W(p,i,g),ae(o,p,g),W(p,u,g),ae(s,p,g),d=!0},p(p,g){const _={};g[0]&128&&(_.position=p[7]),e.$set(_);const x={};g[0]&128&&(x.position=p[7]),n.$set(x);const C={};g[0]&128&&(C.position=p[7]),o.$set(C);const M={};g[0]&128&&(M.position=p[7]),s.$set(M)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(H(t),H(i),H(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function v5(r){let e,t,n,i,o,u=r[4]&&r[0]&&cy(r);return{c(){e=U("div"),u&&u.c(),he(e,"class",t=ec(r[2])+" svelte-p00lfq"),he(e,"data-testid","map-container"),Gt(e,"expand-map",!r[2])},m(s,d){W(s,e,d),u&&u.m(e,null),r[47](e),n=!0,i||(o=[It(_5,"hashchange",r[11]),Vm(r[10].call(null,e))],i=!0)},p(s,d){s[4]&&s[0]?u?(u.p(s,d),d[0]&17&&N(u,1)):(u=cy(s),u.c(),N(u,1),u.m(e,null)):u&&(Xt(),V(u,1,1,()=>{u=null}),Yt()),(!n||d[0]&4&&t!==(t=ec(s[2])+" svelte-p00lfq"))&&he(e,"class",t),(!n||d[0]&4)&&Gt(e,"expand-map",!s[2])},i(s){n||(N(u),n=!0)},o(s){V(u),n=!1},d(s){s&&H(e),u&&u.d(),r[47](null),i=!1,cr(o)}}}function b5(r,e,t){let n,i,o,u,{$$slots:s={},$$scope:d}=e,{map:p=null}=e,{mapContainer:g=void 0}=e,{class:_=void 0}=e,{style:x}=e,{diffStyleUpdates:C=!1}=e,{center:M=void 0}=e,{zoom:P=void 0}=e,{pitch:A=0}=e,{bearing:L=0}=e,{bounds:I=void 0}=e,{hash:$=!1}=e,{updateHash:O=Xe=>{window.history.replaceState(window.history.state,"",Xe)}}=e,{loaded:Z=!1}=e,{minZoom:X=0}=e,{maxZoom:q=22}=e,{minPitch:Y=0}=e,{maxPitch:fe=60}=e,{renderWorldCopies:Le=void 0}=e,{dragPan:ee=void 0}=e,{dragRotate:ie=void 0}=e,{pitchWithRotate:ve=void 0}=e,{antialias:ye=void 0}=e,{zoomOnDoubleClick:it=!0}=e,{locale:Fe=void 0}=e,{interactive:Ne=!0}=e,{attributionControl:Ae=!0}=e,{cooperativeGestures:ot=!1}=e,{preserveDrawingBuffer:Ye=!1}=e,{maxBounds:ut=void 0}=e,{images:pt=[]}=e,{standardControls:_t=!1}=e,{filterLayers:He=void 0}=e,{transformRequest:mt=void 0}=e;const Pt=Ns(),{map:jt,loadedImages:un}=PS();ct(r,jt,Xe=>t(4,o=Xe)),ct(r,un,Xe=>t(5,u=Xe));let nn=new Set;async function rn(Xe,lt=!1){if(o&&!(!o.loaded()&&!lt))if("url"in Xe){nn.add(Xe.id);try{let Wt=await o.loadImage(Xe.url);o==null||o.addImage(Xe.id,Wt.data,Xe.options),u.add(Xe.id),un.set(u)}catch(Wt){Pt("error",Wt)}finally{nn.delete(Xe.id)}}else o.addImage(Xe.id,Xe.data,Xe.options),u.add(Xe.id),un.set(u)}let pn,yn,qe,We;function Ke(Xe){return pe(),ln(jt,o=new ni.Map(Na({container:Xe,style:x,locale:Fe,center:M,zoom:P,pitch:A,bearing:L,minZoom:X,maxZoom:q,minPitch:Y,maxPitch:fe,renderWorldCopies:Le,dragPan:ee,dragRotate:ie,pitchWithRotate:ve,antialias:ye,interactive:Ne,preserveDrawingBuffer:Ye,maxBounds:ut,bounds:I,attributionControl:Ae,transformRequest:mt,cooperativeGestures:ot})),o),o.on("load",lt=>{lt.target.getContainer().setAttribute("data-testid","map"),lt.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,Z=!0),Pt("load",o)}),o.on("error",lt=>Pt("error",{...lt,map:o})),o.on("movestart",lt=>Pt("movestart",{...lt,map:o})),o.on("moveend",lt=>{if(t(12,M=lt.target.getCenter()),t(13,P=lt.target.getZoom()),t(14,A=lt.target.getPitch()),t(15,L=lt.target.getBearing()),t(16,I=lt.target.getBounds()),Pt("moveend",{...lt,map:o}),$){let Wt=new URL(window.location.href.replace(/(#.+)?$/,f5(o)));O(Wt)}}),o.on("click",lt=>Pt("click",{...lt,map:o})),o.on("dblclick",lt=>Pt("dblclick",{...lt,map:o})),o.on("contextmenu",lt=>Pt("contextmenu",{...lt,map:o})),o.on("zoomstart",lt=>Pt("zoomstart",{...lt,map:o})),o.on("zoom",lt=>{Pt("zoom",{...lt,map:o})}),o.on("zoomend",lt=>{Pt("zoomend",{...lt,map:o})}),o.on("style.load",()=>{if(o){const lt=o.getStyle();if(t(42,pn=lt.layers.map(Wt=>Wt.id)),t(43,yn=Object.keys(lt.sources)),We)for(const[Wt,Xn]of Object.entries(We))o.addSource(Wt,Xn);if(qe)for(const Wt of qe)o.addLayer(Wt);for(const Wt of pt)rn(Wt,!0)}}),o.on("styledata",lt=>{if(o&&He){const Wt=o.getStyle().layers;if(Wt)for(let Xn of Wt)He(Xn)||o.setLayoutProperty(Xn.id,"visibility","none")}Pt("styledata",{...lt,map:o})}),{destroy(){t(0,Z=!1),o==null||o.remove(),ln(jt,o=null,o)}}}let kt=x;function pe(){if($){let Xe=h5(window.location.hash);Xe.length>=3&&(t(13,P=Xe[0]),t(12,M=[Xe[2],Xe[1]])),Xe.length==5&&(t(15,L=Xe[3]),t(14,A=Xe[4]))}}function fn(Xe){dn[Xe?"unshift":"push"](()=>{g=Xe,t(1,g)})}return r.$$set=Xe=>{"map"in Xe&&t(17,p=Xe.map),"mapContainer"in Xe&&t(1,g=Xe.mapContainer),"class"in Xe&&t(2,_=Xe.class),"style"in Xe&&t(18,x=Xe.style),"diffStyleUpdates"in Xe&&t(19,C=Xe.diffStyleUpdates),"center"in Xe&&t(12,M=Xe.center),"zoom"in Xe&&t(13,P=Xe.zoom),"pitch"in Xe&&t(14,A=Xe.pitch),"bearing"in Xe&&t(15,L=Xe.bearing),"bounds"in Xe&&t(16,I=Xe.bounds),"hash"in Xe&&t(20,$=Xe.hash),"updateHash"in Xe&&t(21,O=Xe.updateHash),"loaded"in Xe&&t(0,Z=Xe.loaded),"minZoom"in Xe&&t(22,X=Xe.minZoom),"maxZoom"in Xe&&t(23,q=Xe.maxZoom),"minPitch"in Xe&&t(24,Y=Xe.minPitch),"maxPitch"in Xe&&t(25,fe=Xe.maxPitch),"renderWorldCopies"in Xe&&t(26,Le=Xe.renderWorldCopies),"dragPan"in Xe&&t(27,ee=Xe.dragPan),"dragRotate"in Xe&&t(28,ie=Xe.dragRotate),"pitchWithRotate"in Xe&&t(29,ve=Xe.pitchWithRotate),"antialias"in Xe&&t(30,ye=Xe.antialias),"zoomOnDoubleClick"in Xe&&t(31,it=Xe.zoomOnDoubleClick),"locale"in Xe&&t(32,Fe=Xe.locale),"interactive"in Xe&&t(33,Ne=Xe.interactive),"attributionControl"in Xe&&t(34,Ae=Xe.attributionControl),"cooperativeGestures"in Xe&&t(35,ot=Xe.cooperativeGestures),"preserveDrawingBuffer"in Xe&&t(36,Ye=Xe.preserveDrawingBuffer),"maxBounds"in Xe&&t(37,ut=Xe.maxBounds),"images"in Xe&&t(38,pt=Xe.images),"standardControls"in Xe&&t(3,_t=Xe.standardControls),"filterLayers"in Xe&&t(39,He=Xe.filterLayers),"transformRequest"in Xe&&t(40,mt=Xe.transformRequest),"$$scope"in Xe&&t(45,d=Xe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof _t=="boolean"?void 0:_t),r.$$.dirty[0]&16&&t(17,p=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!Nu(x,kt)){const Xe=o.getStyle();if(pn&&(qe=Xe.layers.filter(lt=>!pn.includes(lt.id))),yn){const lt=Object.keys(Xe.sources).filter(Wt=>!yn.includes(Wt));We={};for(const Wt of lt)We[Wt]=Xe.sources[Wt]}t(44,kt=x),o.setStyle(x,{diff:C}),ln(un,u=new Set,u),t(41,nn=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&Z&&o!=null&&o.loaded())for(let Xe of pt)!u.has(Xe.id)&&!nn.has(Xe.id)&&!o.hasImage(Xe.id)&&rn(Xe);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=pt.every(Xe=>u.has(Xe.id))),r.$$.dirty[0]&61456&&o){let Xe={};M!=null&&!Nu(M,o==null?void 0:o.getCenter())&&(Xe.center=M),P!=null&&!Nu(P,o==null?void 0:o.getZoom())&&(Xe.zoom=P),L!=null&&!Nu(L,o==null?void 0:o.getBearing())&&(Xe.bearing=L),A!=null&&!Nu(A,o==null?void 0:o.getPitch())&&(Xe.pitch=A),Object.keys(Xe).length&&o.easeTo(Xe)}r.$$.dirty[0]&65552&&I&&!Nu(I,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(I)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(it?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[Z,g,_,_t,o,u,i,n,jt,un,Ke,pe,M,P,A,L,I,p,x,C,$,O,X,q,Y,fe,Le,ee,ie,ve,ye,it,Fe,Ne,Ae,ot,Ye,ut,pt,He,mt,nn,pn,yn,kt,d,s,fn]}class w5 extends Lt{constructor(e){super(),Et(this,e,b5,v5,Tt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const x5=r=>({marker:r&8}),hy=r=>({marker:r[3]});function k5(r){let e,t,n,i,o,u,s;const d=r[19].default,p=vn(d,r,r[18],hy);return{c(){e=U("div"),p&&p.c(),he(e,"tabindex",t=r[1]?0:void 0),he(e,"role",n=r[1]?"button":void 0),Qe(e,"z-index",r[2])},m(g,_){W(g,e,_),p&&p.m(e,null),o=!0,u||(s=[Vm(r[7].call(null,e)),Vm(i=S5.call(null,e,r[0])),It(e,"click",Ef(r[20])),It(e,"dblclick",Ef(r[21])),It(e,"contextmenu",Ef(Ag(r[22]))),It(e,"mouseenter",r[23]),It(e,"mouseleave",r[24]),It(e,"mousemove",r[25]),It(e,"keydown",r[8])],u=!0)},p(g,[_]){p&&p.p&&(!o||_&262152)&&wn(p,d,g,g[18],o?bn(d,g[18],_,x5):xn(g[18]),hy),(!o||_&2&&t!==(t=g[1]?0:void 0))&&he(e,"tabindex",t),(!o||_&2&&n!==(n=g[1]?"button":void 0))&&he(e,"role",n),i&&Wa(i.update)&&_&1&&i.update.call(null,g[0]),_&4&&Qe(e,"z-index",g[2])},i(g){o||(N(p,g),o=!0)},o(g){V(p,g),o=!1},d(g){g&&H(e),p&&p.d(g),u=!1,cr(s)}}}function S5(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function T5(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{marker:d=void 0}=e,{lngLat:p}=e,{class:g=void 0}=e,{interactive:_=!0}=e,{asButton:x=!1}=e,{draggable:C=!1}=e,{feature:M=null}=e,{offset:P=void 0}=e,{zIndex:A=void 0}=e,{rotation:L=0}=e,{opacity:I=1}=e;const $=Ns(),{map:O,layerEvent:Z,self:X,markerClickManager:q}=zS();ct(r,O,Ae=>t(27,o=Ae)),ct(r,Z,Ae=>t(26,n=Ae)),ct(r,X,Ae=>t(3,i=Ae));function Y(Ae){ln(X,i=new ni.Marker({element:Ae,rotation:L,draggable:C,offset:P,opacity:I.toString()}).setLngLat(p).addTo(o),i),t(11,d=i);const ot=()=>ee("dragstart"),Ye=()=>{fe(),ee("drag")},ut=()=>{fe(),ee("dragend")};return C&&(i.on("dragstart",ot),i.on("drag",Ye),i.on("dragend",ut)),{destroy(){C&&(i==null||i.off("dragstart",ot),i==null||i.off("drag",Ye),i==null||i.off("dragend",ut)),t(11,d=void 0),i==null||i.remove()}}}function fe(){let Ae=i==null?void 0:i.getLngLat();Ae&&(Array.isArray(p)?t(10,p=[Ae.lng,Ae.lat]):p&&"lon"in p?t(10,p={lon:Ae.lng,lat:Ae.lat}):t(10,p=Ae))}function Le(Ae){Ae.key===" "&&(Ae.preventDefault(),Ae.stopPropagation(),ee("click"))}function ee(Ae){if(!_)return;let ot=i==null?void 0:i.getLngLat();if(!ot)return;const Ye=[ot.lng,ot.lat];let ut={map:o,marker:i,lngLat:Ye,features:[{type:"Feature",properties:(M==null?void 0:M.properties)??{},geometry:{type:"Point",coordinates:Ye}}]};(Ae==="click"||Ae==="contextmenu")&&q.handleClick(ut),ln(Z,n={...ut,layerType:"marker",type:Ae},n),$(Ae,ut)}const ie=()=>ee("click"),ve=()=>ee("dblclick"),ye=()=>{ee("contextmenu")},it=()=>{ee("mouseenter")},Fe=()=>{ee("mouseleave")},Ne=()=>ee("mousemove");return r.$$set=Ae=>{"marker"in Ae&&t(11,d=Ae.marker),"lngLat"in Ae&&t(10,p=Ae.lngLat),"class"in Ae&&t(0,g=Ae.class),"interactive"in Ae&&t(12,_=Ae.interactive),"asButton"in Ae&&t(1,x=Ae.asButton),"draggable"in Ae&&t(13,C=Ae.draggable),"feature"in Ae&&t(14,M=Ae.feature),"offset"in Ae&&t(15,P=Ae.offset),"zIndex"in Ae&&t(2,A=Ae.zIndex),"rotation"in Ae&&t(16,L=Ae.rotation),"opacity"in Ae&&t(17,I=Ae.opacity),"$$scope"in Ae&&t(18,s=Ae.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(p)),r.$$.dirty&32776&&(i==null||i.setOffset(P??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(L)),r.$$.dirty&131080&&(i==null||i.setOpacity(I.toString()))},[g,x,A,i,O,Z,X,Y,Le,ee,p,d,_,C,M,P,L,I,s,u,ie,ve,ye,it,Fe,Ne]}class ap extends Lt{constructor(e){super(),Et(this,e,T5,k5,Tt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const C5=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),dy=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function py(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof ni.Marker)&&my(r);return{c(){e=U("div"),n&&n.c()},m(o,u){W(o,e,u),n&&n.m(e,null),r[32](e),t=!0},p(o,u){var s;(s=o[4])!=null&&s.length||o[3]instanceof ni.Marker?n?(n.p(o,u),u[0]&24&&N(n,1)):(n=my(o),n.c(),N(n,1),n.m(e,null)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(o){t||(N(n),t=!0)},o(o){V(n),t=!1},d(o){o&&H(e),n&&n.d(),r[32](null)}}}function my(r){let e;const t=r[30].default,n=vn(t,r,r[29],dy);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,C5):xn(i[29]),dy)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function M5(r){let e,t,n=r[9].default&&py(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=py(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function E5(r,e,t){let n,i,o,u,s,d,{$$slots:p={},$$scope:g}=e;const _=Ig(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:P=!1}=e,{openOn:A="click"}=e,{openIfTopMost:L=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:$=void 0}=e,{offset:O=void 0}=e,{popupClass:Z=void 0}=e,{maxWidth:X=void 0}=e,{lngLat:q=void 0}=e,{html:Y=void 0}=e,{open:fe=!1}=e;const Le=Ns(),{map:ee,popupTarget:ie,layerEvent:ve,layer:ye,eventTopMost:it,markerClickManager:Fe}=Za();ct(r,ee,pe=>t(2,o=pe)),ct(r,ie,pe=>t(3,s=pe)),ct(r,ve,pe=>t(28,u=pe)),ct(r,ye,pe=>t(35,d=pe));const Ne=["click","dblclick","contextmenu"];let Ae,ot=!1,Ye;function ut(){if(!Ae)return;let pe=Ae.getElement();!pe||pe===Ye||(Ye=pe,A==="hover"&&(Ye.style.pointerEvents="none"),Ye.addEventListener("mouseenter",()=>{t(24,ot=!0)},{passive:!0}),Ye.addEventListener("mouseleave",()=>{t(24,ot=!1)},{passive:!0}),Ye.addEventListener("click",()=>{M&&t(0,fe=!1)},{passive:!0}))}Ss(()=>{if(o)return o.on("click",yn),o.on("contextmenu",yn),Fe.add(qe),typeof s=="string"&&(o.on("click",s,Pt),o.on("dblclick",s,Pt),o.on("contextmenu",s,Pt),o.on("mousemove",s,pn),o.on("mouseleave",s,rn),o.on("touchstart",s,un),o.on("touchend",s,nn)),()=>{o!=null&&o.loaded()&&(Ae==null||Ae.remove(),o.off("click",yn),o.off("contextmenu",yn),Fe.remove(qe),s instanceof ni.Marker?s.getPopup()===Ae&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,Pt),o.off("dblclick",s,Pt),o.off("contextmenu",s,Pt),o.off("mousemove",s,pn),o.off("mouseleave",s,rn),o.off("touchstart",s,un),o.off("touchend",s,nn)))}});function pt(pe){return L?!("marker"in pe)&&!DS(pe)&&it(pe)!==d:!1}let _t=null,He="normal";function mt(pe){"layerType"in pe&&pe.layerType==="deckgl"?(t(10,q=pe.coordinate),t(4,_t=pe.object?[pe.object]:null)):(t(10,q=pe.lngLat),t(4,_t=pe.features??[]))}function Pt(pe){pe.type!==A||pt(pe)||(mt(pe),setTimeout(()=>t(0,fe=!0)))}let jt=null;function un(pe){jt=pe.point}function nn(pe){if(!jt||A!=="hover")return;let fn=jt.dist(pe.point);jt=null,fn<3&&(t(10,q=pe.lngLat),t(4,_t=pe.features??[]),Ae.isOpen()?t(25,He="justOpened"):(t(25,He="opening"),t(0,fe=!0)))}function rn(pe){A!=="hover"||jt||He!=="normal"||(t(0,fe=!1),t(4,_t=null))}function pn(pe){if(!(A!=="hover"||jt||He!=="normal")){if(pt(pe)){t(0,fe=!1),t(4,_t=null);return}t(0,fe=!0),t(4,_t=pe.features??[]),t(10,q=pe.lngLat)}}function yn(pe){if(He==="justOpened"){t(25,He="normal");return}if(!C)return;let fn=[Ye,s instanceof ni.Marker?s==null?void 0:s.getElement():null];fe&&Ae.isOpen()&&!fn.some(Xe=>Xe==null?void 0:Xe.contains(pe.originalEvent.target))&&(pe.type==="contextmenu"&&A==="contextmenu"||pe.type!=="contextmenu")&&t(0,fe=!1)}function qe(pe){C&&fe&&Ae.isOpen()&&pe.marker!==s&&t(0,fe=!1)}ri(()=>{o&&(Ae!=null&&Ae.isOpen())&&Ae.remove()});let We;const Ke=()=>t(0,fe=!1);function kt(pe){dn[pe?"unshift":"push"](()=>{We=pe,t(1,We)})}return r.$$set=pe=>{"closeButton"in pe&&t(11,x=pe.closeButton),"closeOnClickOutside"in pe&&t(12,C=pe.closeOnClickOutside),"closeOnClickInside"in pe&&t(13,M=pe.closeOnClickInside),"closeOnMove"in pe&&t(14,P=pe.closeOnMove),"openOn"in pe&&t(15,A=pe.openOn),"openIfTopMost"in pe&&t(16,L=pe.openIfTopMost),"focusAfterOpen"in pe&&t(17,I=pe.focusAfterOpen),"anchor"in pe&&t(18,$=pe.anchor),"offset"in pe&&t(19,O=pe.offset),"popupClass"in pe&&t(20,Z=pe.popupClass),"maxWidth"in pe&&t(21,X=pe.maxWidth),"lngLat"in pe&&t(10,q=pe.lngLat),"html"in pe&&t(22,Y=pe.html),"open"in pe&&t(0,fe=pe.open),"$$scope"in pe&&t(29,g=pe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!M)),r.$$.dirty[0]&146685952&&(Ae||(t(23,Ae=new ni.Popup({closeButton:n,closeOnClick:!1,closeOnMove:P,focusAfterOpen:I,maxWidth:X,className:Z,anchor:$,offset:O})),Ye=Ae.getElement(),Ae.on("open",()=>{t(0,fe=!0),ut(),Le("open",Ae)}),Ae.on("close",()=>{t(0,fe=!1),Le("close",Ae)}),Ae.on("hover",()=>{Le("hover",Ae)}))),r.$$.dirty[0]&8421384&&Ae&&s instanceof ni.Marker&&(A==="click"?s.setPopup(Ae):s.getPopup()===Ae&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&Ne.includes(A)&&(u==null?void 0:u.type)===A&&(Pt(u),ln(ve,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=A==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&A==="hover"&&ve&&(i&&u&&mt(u),t(0,fe=(i||ot)??!1)),r.$$.dirty[0]&12582914&&(We?Ae.setDOMContent(We):Y&&Ae.setHTML(Y)),r.$$.dirty[0]&8389632&&q&&Ae.setLngLat(q),r.$$.dirty[0]&41943045&&o){let pe=Ae.isOpen();fe&&!pe?(Ae.addTo(o),He==="opening"&&t(25,He="justOpened")):!fe&&pe&&Ae.remove()}},[fe,We,o,s,_t,ee,ie,ve,ye,_,q,x,C,M,P,A,L,I,$,O,Z,X,Y,Ae,ot,He,i,n,u,g,p,Ke,kt]}let Aw=class extends Lt{constructor(e){super(),Et(this,e,E5,M5,Tt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var Yu=Math.pow,Ki=(r,e,t)=>new Promise((n,i)=>{var o=d=>{try{s(t.next(d))}catch(p){i(p)}},u=d=>{try{s(t.throw(d))}catch(p){i(p)}},s=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,u);s((t=t.apply(r,e)).next())}),jo=Uint8Array,Ku=Uint16Array,L5=Int32Array,Pw=new jo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),zw=new jo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),I5=new jo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Dw=function(r,e){for(var t=new Ku(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new L5(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},Rw=Dw(Pw,2),Fw=Rw.b,A5=Rw.r;Fw[28]=258,A5[258]=28;var P5=Dw(zw,0),z5=P5.b,ng=new Ku(32768);for(dr=0;dr<32768;++dr)na=(dr&43690)>>1|(dr&21845)<<1,na=(na&52428)>>2|(na&13107)<<2,na=(na&61680)>>4|(na&3855)<<4,ng[dr]=((na&65280)>>8|(na&255)<<8)>>1;var na,dr,Df=function(r,e,t){for(var n=r.length,i=0,o=new Ku(e);i<n;++i)r[i]&&++o[r[i]-1];var u=new Ku(e);for(i=1;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;var s;if(t){s=new Ku(1<<e);var d=15-e;for(i=0;i<n;++i)if(r[i])for(var p=i<<4|r[i],g=e-r[i],_=u[r[i]-1]++<<g,x=_|(1<<g)-1;_<=x;++_)s[ng[_]>>d]=p}else for(s=new Ku(n),i=0;i<n;++i)r[i]&&(s[i]=ng[u[r[i]-1]++]>>15-r[i]);return s},nh=new jo(288);for(dr=0;dr<144;++dr)nh[dr]=8;var dr;for(dr=144;dr<256;++dr)nh[dr]=9;var dr;for(dr=256;dr<280;++dr)nh[dr]=7;var dr;for(dr=280;dr<288;++dr)nh[dr]=8;var dr,Ow=new jo(32);for(dr=0;dr<32;++dr)Ow[dr]=5;var dr,D5=Df(nh,9,1),R5=Df(Ow,5,1),Im=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},gs=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Am=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},F5=function(r){return(r+7)/8|0},O5=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new jo(t-e);return n.set(r.subarray(e,t)),n},$5=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Oo=function(r,e,t){var n=new Error(e||$5[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Oo),!t)throw n;return n},Zg=function(r,e,t,n){var i=r.length,o=n?n.length:0;if(!i||e.f&&!e.l)return t||new jo(0);var u=!t||e.i!=2,s=e.i;t||(t=new jo(i*3));var d=function(rn){var pn=t.length;if(rn>pn){var yn=new jo(Math.max(pn*2,rn));yn.set(t),t=yn}},p=e.f||0,g=e.p||0,_=e.b||0,x=e.l,C=e.d,M=e.m,P=e.n,A=i*8;do{if(!x){p=gs(r,g,1);var L=gs(r,g+1,3);if(g+=3,L)if(L==1)x=D5,C=R5,M=9,P=5;else if(L==2){var Z=gs(r,g,31)+257,X=gs(r,g+10,15)+4,q=Z+gs(r,g+5,31)+1;g+=14;for(var Y=new jo(q),fe=new jo(19),Le=0;Le<X;++Le)fe[I5[Le]]=gs(r,g+Le*3,7);g+=X*3;for(var ee=Im(fe),ie=(1<<ee)-1,ve=Df(fe,ee,1),Le=0;Le<q;){var ye=ve[gs(r,g,ie)];g+=ye&15;var I=ye>>4;if(I<16)Y[Le++]=I;else{var it=0,Fe=0;for(I==16?(Fe=3+gs(r,g,3),g+=2,it=Y[Le-1]):I==17?(Fe=3+gs(r,g,7),g+=3):I==18&&(Fe=11+gs(r,g,127),g+=7);Fe--;)Y[Le++]=it}}var Ne=Y.subarray(0,Z),Ae=Y.subarray(Z);M=Im(Ne),P=Im(Ae),x=Df(Ne,M,1),C=Df(Ae,P,1)}else Oo(1);else{var I=F5(g)+4,$=r[I-4]|r[I-3]<<8,O=I+$;if(O>i){s&&Oo(0);break}u&&d(_+$),t.set(r.subarray(I,O),_),e.b=_+=$,e.p=g=O*8,e.f=p;continue}if(g>A){s&&Oo(0);break}}u&&d(_+131072);for(var ot=(1<<M)-1,Ye=(1<<P)-1,ut=g;;ut=g){var it=x[Am(r,g)&ot],pt=it>>4;if(g+=it&15,g>A){s&&Oo(0);break}if(it||Oo(2),pt<256)t[_++]=pt;else if(pt==256){ut=g,x=null;break}else{var _t=pt-254;if(pt>264){var Le=pt-257,He=Pw[Le];_t=gs(r,g,(1<<He)-1)+Fw[Le],g+=He}var mt=C[Am(r,g)&Ye],Pt=mt>>4;mt||Oo(3),g+=mt&15;var Ae=z5[Pt];if(Pt>3){var He=zw[Pt];Ae+=Am(r,g)&(1<<He)-1,g+=He}if(g>A){s&&Oo(0);break}u&&d(_+131072);var jt=_+_t;if(_<Ae){var un=o-Ae,nn=Math.min(Ae,jt);for(un+_<0&&Oo(3);_<nn;++_)t[_]=n[un+_]}for(;_<jt;_+=4)t[_]=t[_-Ae],t[_+1]=t[_+1-Ae],t[_+2]=t[_+2-Ae],t[_+3]=t[_+3-Ae];_=jt}}e.l=x,e.p=ut,e.b=_,e.f=p,x&&(p=1,e.m=M,e.d=C,e.n=P)}while(!p);return _==t.length?t:O5(t,0,_)},B5=new jo(0),N5=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Oo(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},j5=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},U5=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Oo(6,"invalid zlib data"),(r[1]>>5&1)==+!e&&Oo(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function V5(r,e){return Zg(r,{i:2},e&&e.out,e&&e.dictionary)}function q5(r,e){var t=N5(r);return t+8>r.length&&Oo(6,"invalid gzip data"),Zg(r.subarray(t,-8),{i:2},e&&e.out||new jo(j5(r)),e&&e.dictionary)}function H5(r,e){return Zg(r.subarray(U5(r,e&&e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}function rg(r,e){return r[0]==31&&r[1]==139&&r[2]==8?q5(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?V5(r,e):H5(r,e)}var W5=typeof TextDecoder<"u"&&new TextDecoder,G5=0;try{W5.decode(B5,{stream:!0}),G5=1}catch{}var $w=(r,e)=>r*Yu(2,e),hf=(r,e)=>Math.floor(r/Yu(2,e)),Xd=(r,e)=>$w(r.getUint16(e+1,!0),8)+r.getUint8(e),Bw=(r,e)=>$w(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),Z5=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=Xd(n,i+1);if(e!==o)return e-o;const u=Xd(n,i+4);return t!==u?t-u:0},K5=(r,e,t,n)=>{const i=Nw(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},gy=(r,e,t,n)=>{const i=Nw(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},Nw=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const u=o+i>>1,s=Z5(e,t,n,r,u*17);if(s>0)i=u+1;else if(s<0)o=u-1;else return[Bw(r,u*17+7),r.getUint32(u*17+13,!0)]}return null},X5=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,jw=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:Xd(r,e*17+1),y:Xd(r,e*17+4),offset:Bw(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},_y=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(jw(t,n));return Y5(e)},Y5=r=>{r.sort(X5);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=hf(i.offset,8)&255,t[n*17+9]=hf(i.offset,16)&255,t[n*17+10]=hf(i.offset,24)&255,t[n*17+11]=hf(i.offset,32)&255,t[n*17+12]=hf(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},J5=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=jw(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,u=Math.trunc(e.x/(1<<o)),s=Math.trunc(e.y/(1<<o));return{z:i,x:u,y:s}}return null};function Q5(r){return Ki(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),u=JSON.parse(o.decode(new DataView(e.data,10,n)));let s=0;u.compression==="gzip"&&(s=2);let d=0;"minzoom"in u&&(d=+u.minzoom);let p=0;"maxzoom"in u&&(p=+u.maxzoom);let g=0,_=0,x=0,C=-180,M=-85,P=180,A=85;if(u.bounds){const I=u.bounds.split(",");C=+I[0],M=+I[1],P=+I[2],A=+I[3]}if(u.center){const I=u.center.split(",");g=+I[0],_=+I[1],x=+I[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:s,tileType:1,minZoom:d,maxZoom:p,minLon:C,minLat:M,maxLon:P,maxLat:A,centerZoom:x,centerLon:g,centerLat:_,etag:e.etag}})}function eT(r,e,t,n,i,o,u){return Ki(this,null,function*(){let s=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(s=_y(s));const d=gy(new DataView(s),n,i,o);if(d){let _=(yield e.getBytes(d.offset,d.length,u)).data;const x=new DataView(_);return x.getUint8(0)===31&&x.getUint8(1)===139&&(_=rg(new Uint8Array(_))),{data:_}}const p=J5(new DataView(s),{z:n,x:i,y:o});if(p){const g=K5(new DataView(s),p.z,p.x,p.y);if(g){let _=yield t.getArrayBuffer(e,g.offset,g.length,r);r.specVersion===1&&(_=_y(_));const x=gy(new DataView(_),n,i,o);if(x){let M=(yield e.getBytes(x.offset,x.length,u)).data;const P=new DataView(M);return P.getUint8(0)===31&&P.getUint8(1)===139&&(M=rg(new Uint8Array(M))),{data:M}}}}})}var Uw={getHeader:Q5,getZxy:eT},tT=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},nT=class{constructor(){this.tilev4=(r,e)=>Ki(this,null,function*(){if(r.type==="json"){const _=r.url.substr(10);let x=this.tiles.get(_);x||(x=new yy(_),this.tiles.set(_,x));const C=yield x.getHeader();return{data:{tiles:[`${r.url}/{z}/{x}/{y}`],minzoom:C.minZoom,maxzoom:C.maxZoom,bounds:[C.minLon,C.minLat,C.maxLon,C.maxLat]}}}const t=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),n=r.url.match(t);if(!n)throw new Error("Invalid PMTiles protocol URL");const i=n[1];let o=this.tiles.get(i);o||(o=new yy(i),this.tiles.set(i,o));const u=n[2],s=n[3],d=n[4],p=yield o.getHeader(),g=yield o==null?void 0:o.getZxy(+u,+s,+d,e.signal);return g?{data:new Uint8Array(g.data),cacheControl:g.cacheControl,expires:g.expires}:p.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=tT(this.tilev4),this.tiles=new Map}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function ju(r,e){return(e>>>0)*4294967296+(r>>>0)}function rT(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return ju(r,i);throw new Error("Expected varint not more than 10 bytes")}function df(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,rT(n,r))}function iT(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var oT=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function sT(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Yu(2,r)-1||t>Yu(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=oT[r],i=Yu(2,r);let o=0,u=0,s=0;const d=[e,t];let p=i/2;for(;p>0;)o=(d[0]&p)>0?1:0,u=(d[1]&p)>0?1:0,s+=p*p*(3*o^u),iT(p,d,o,u),p=p/2;return n+s}function Vw(r,e){return Ki(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return rg(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}var aT=127;function lT(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var uT=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Ki(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const u=new Headers(this.customHeaders);u.set("range",`bytes=${r}-${r+e-1}`);let s;this.mustReload&&(s="reload");let d=yield fetch(this.url,{signal:o,cache:s,headers:u});if(r===0&&d.status===416){const x=d.headers.get("Content-Range");if(!x||!x.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const C=+x.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${C-1}`}})}let p=d.headers.get("Etag");if(p!=null&&p.startsWith("W/")&&(p=null),d.status===416||n&&p&&p!==n)throw this.mustReload=!0,new ig(n);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const g=d.headers.get("Content-Length");if(d.status===200&&(!g||+g>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:p||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function _s(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Yu(2,32)+n}function cT(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:_s(t,8),rootDirectoryLength:_s(t,16),jsonMetadataOffset:_s(t,24),jsonMetadataLength:_s(t,32),leafDirectoryOffset:_s(t,40),leafDirectoryLength:_s(t,48),tileDataOffset:_s(t,56),tileDataLength:_s(t,64),numAddressedTiles:_s(t,72),numTileEntries:_s(t,80),numTileContents:_s(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function qw(r){const e={buf:new Uint8Array(r),pos:0},t=df(e),n=[];let i=0;for(let o=0;o<t;o++){const u=df(e);n.push({tileId:i+u,offset:0,length:0,runLength:1}),i+=u}for(let o=0;o<t;o++)n[o].runLength=df(e);for(let o=0;o<t;o++)n[o].length=df(e);for(let o=0;o<t;o++){const u=df(e);u===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=u-1}return n}function fT(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var ig=class extends Error{};function hT(r,e){return Ki(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(fT(t.data)<3)return[yield Uw.getHeader(r)];const i=t.data.slice(0,aT),o=cT(i,t.etag),u=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),s=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=qw(yield e(u,o.internalCompression));return[o,[s,d.length,d]]})}function dT(r,e,t,n,i){return Ki(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),u=yield e(o.data,i.internalCompression),s=qw(u);if(s.length===0)throw new Error("Empty directory is invalid");return s})}var pT=class{constructor(r=100,e=!0,t=Vw){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Ki(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{hT(r,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),i(u[0]),this.prune()}).catch(u=>{o(u)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Ki(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,d)=>{dT(r,this.decompress,e,t,n).then(p=>{s(p),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}getArrayBuffer(r,e,t,n){return Ki(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((s,d)=>{r.getBytes(e,t,void 0,n.etag).then(p=>{s(p.data),this.cache.has(i),this.prune()}).catch(p=>{d(p)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Ki(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},yy=class{constructor(r,e,t){typeof r=="string"?this.source=new uT(r):this.source=r,t?this.decompress=t:this.decompress=Vw,e?this.cache=e:this.cache=new pT}getHeader(){return Ki(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Ki(this,null,function*(){const i=sT(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Uw.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let u=o.rootDirectoryOffset,s=o.rootDirectoryLength;for(let d=0;d<=3;d++){const p=yield this.cache.getDirectory(this.source,u,s,o),g=lT(p,i);if(g){if(g.runLength>0){const _=yield this.source.getBytes(o.tileDataOffset+g.offset,g.length,n,o.etag);return{data:yield this.decompress(_.data,o.tileCompression),cacheControl:_.cacheControl,expires:_.expires}}u=o.leafDirectoryOffset+g.offset,s=g.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Ki(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof ig)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Ki(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Ki(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof ig)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}};function mT(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function gT(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[mT]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new sp({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function _T(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ol("symbol")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g=void 0}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:A=void 0}=e,{manageHoverState:L=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:O=!0}=e;function Z(ie){I=ie,t(0,I)}function X(ie){Pn.call(this,r,ie)}function q(ie){Pn.call(this,r,ie)}function Y(ie){Pn.call(this,r,ie)}function fe(ie){Pn.call(this,r,ie)}function Le(ie){Pn.call(this,r,ie)}function ee(ie){Pn.call(this,r,ie)}return r.$$set=ie=>{"id"in ie&&t(1,o=ie.id),"source"in ie&&t(2,u=ie.source),"sourceLayer"in ie&&t(3,s=ie.sourceLayer),"beforeId"in ie&&t(4,d=ie.beforeId),"beforeLayerType"in ie&&t(5,p=ie.beforeLayerType),"paint"in ie&&t(6,g=ie.paint),"layout"in ie&&t(7,_=ie.layout),"filter"in ie&&t(8,x=ie.filter),"applyToClusters"in ie&&t(9,C=ie.applyToClusters),"minzoom"in ie&&t(10,M=ie.minzoom),"maxzoom"in ie&&t(11,P=ie.maxzoom),"hoverCursor"in ie&&t(12,A=ie.hoverCursor),"manageHoverState"in ie&&t(13,L=ie.manageHoverState),"hovered"in ie&&t(0,I=ie.hovered),"eventsIfTopMost"in ie&&t(14,$=ie.eventsIfTopMost),"interactive"in ie&&t(15,O=ie.interactive),"$$scope"in ie&&t(24,i=ie.$$scope)},[I,o,u,s,d,p,g,_,x,C,M,P,A,L,$,O,n,Z,X,q,Y,fe,Le,ee,i]}class nc extends Lt{constructor(e){super(),Et(this,e,_T,gT,Tt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function vy(r){let e=r[0],t,n,i=by(r);return{c(){i.c(),t=tr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&Tt(e,e=o[0])?(Xt(),V(i,1,1,at),Yt(),i=by(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function by(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function yT(r){let e,t,n=r[0]&&vy(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=vy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function vT(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e,{id:s=Ol("vector")}=e,{url:d=null}=e,{tiles:p=null}=e,{promoteId:g=null}=e,{bounds:_=null}=e,{scheme:x=null}=e,{attribution:C=null}=e,{minzoom:M=null}=e,{maxzoom:P=null}=e,{volatile:A=null}=e;if(d&&d.includes("pmtiles://")&&!ni.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let O=new nT;ni.addProtocol("pmtiles",O.tile)}const{map:L,self:I}=kw();ct(r,L,O=>t(13,i=O)),ct(r,I,O=>t(0,n=O));let $;return ri(()=>{n&&i&&(Ew(L,n,$),ln(I,n=null,n),$=void 0)}),r.$$set=O=>{"id"in O&&t(3,s=O.id),"url"in O&&t(4,d=O.url),"tiles"in O&&t(5,p=O.tiles),"promoteId"in O&&t(6,g=O.promoteId),"bounds"in O&&t(7,_=O.bounds),"scheme"in O&&t(8,x=O.scheme),"attribution"in O&&t(9,C=O.attribution),"minzoom"in O&&t(10,M=O.minzoom),"maxzoom"in O&&t(11,P=O.maxzoom),"volatile"in O&&t(12,A=O.volatile),"$$scope"in O&&t(14,u=O.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==s&&(ln(I,n=s,n),Mw(i,n,Na({type:"vector",url:d,tiles:p,promoteId:g,bounds:_,scheme:x,attribution:C,minzoom:M,maxzoom:P,volatile:A}),O=>i&&O===n,()=>{n&&($=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{$=i==null?void 0:i.getSource(s)}))},[n,L,I,s,d,p,g,_,x,C,M,P,A,i,u,o]}class rh extends Lt{constructor(e){super(),Et(this,e,vT,yT,Tt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}var bo="top",ls="bottom",us="right",wo="left",Kg="auto",ih=[bo,ls,us,wo],rc="start",Hf="end",bT="clippingParents",Hw="viewport",pf="popper",wT="reference",wy=ih.reduce(function(r,e){return r.concat([e+"-"+rc,e+"-"+Hf])},[]),Ww=[].concat(ih,[Kg]).reduce(function(r,e){return r.concat([e,e+"-"+rc,e+"-"+Hf])},[]),xT="beforeRead",kT="read",ST="afterRead",TT="beforeMain",CT="main",MT="afterMain",ET="beforeWrite",LT="write",IT="afterWrite",AT=[xT,kT,ST,TT,CT,MT,ET,LT,IT];function Bs(r){return r?(r.nodeName||"").toLowerCase():null}function Uo(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function Rl(r){var e=Uo(r).Element;return r instanceof e||r instanceof Element}function is(r){var e=Uo(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function Xg(r){if(typeof ShadowRoot>"u")return!1;var e=Uo(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function PT(r){var e=r.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},o=e.elements[t];!is(o)||!Bs(o)||(Object.assign(o.style,n),Object.keys(i).forEach(function(u){var s=i[u];s===!1?o.removeAttribute(u):o.setAttribute(u,s===!0?"":s)}))})}function zT(r){var e=r.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],o=e.attributes[n]||{},u=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]),s=u.reduce(function(d,p){return d[p]="",d},{});!is(i)||!Bs(i)||(Object.assign(i.style,s),Object.keys(o).forEach(function(d){i.removeAttribute(d)}))})}}const Gw={name:"applyStyles",enabled:!0,phase:"write",fn:PT,effect:zT,requires:["computeStyles"]};function $s(r){return r.split("-")[0]}var Pl=Math.max,Yd=Math.min,ic=Math.round;function og(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Zw(){return!/^((?!chrome|android).)*safari/i.test(og())}function oc(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=r.getBoundingClientRect(),i=1,o=1;e&&is(r)&&(i=r.offsetWidth>0&&ic(n.width)/r.offsetWidth||1,o=r.offsetHeight>0&&ic(n.height)/r.offsetHeight||1);var u=Rl(r)?Uo(r):window,s=u.visualViewport,d=!Zw()&&t,p=(n.left+(d&&s?s.offsetLeft:0))/i,g=(n.top+(d&&s?s.offsetTop:0))/o,_=n.width/i,x=n.height/o;return{width:_,height:x,top:g,right:p+_,bottom:g+x,left:p,x:p,y:g}}function Yg(r){var e=oc(r),t=r.offsetWidth,n=r.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:r.offsetLeft,y:r.offsetTop,width:t,height:n}}function Kw(r,e){var t=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(t&&Xg(t)){var n=e;do{if(n&&r.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function ua(r){return Uo(r).getComputedStyle(r)}function DT(r){return["table","td","th"].indexOf(Bs(r))>=0}function Ka(r){return((Rl(r)?r.ownerDocument:r.document)||window.document).documentElement}function lp(r){return Bs(r)==="html"?r:r.assignedSlot||r.parentNode||(Xg(r)?r.host:null)||Ka(r)}function xy(r){return!is(r)||ua(r).position==="fixed"?null:r.offsetParent}function RT(r){var e=/firefox/i.test(og()),t=/Trident/i.test(og());if(t&&is(r)){var n=ua(r);if(n.position==="fixed")return null}var i=lp(r);for(Xg(i)&&(i=i.host);is(i)&&["html","body"].indexOf(Bs(i))<0;){var o=ua(i);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return i;i=i.parentNode}return null}function oh(r){for(var e=Uo(r),t=xy(r);t&&DT(t)&&ua(t).position==="static";)t=xy(t);return t&&(Bs(t)==="html"||Bs(t)==="body"&&ua(t).position==="static")?e:t||RT(r)||e}function Jg(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function Rf(r,e,t){return Pl(r,Yd(e,t))}function FT(r,e,t){var n=Rf(r,e,t);return n>t?t:n}function Xw(){return{top:0,right:0,bottom:0,left:0}}function Yw(r){return Object.assign({},Xw(),r)}function Jw(r,e){return e.reduce(function(t,n){return t[n]=r,t},{})}var OT=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,Yw(typeof e!="number"?e:Jw(e,ih))};function $T(r){var e,t=r.state,n=r.name,i=r.options,o=t.elements.arrow,u=t.modifiersData.popperOffsets,s=$s(t.placement),d=Jg(s),p=[wo,us].indexOf(s)>=0,g=p?"height":"width";if(!(!o||!u)){var _=OT(i.padding,t),x=Yg(o),C=d==="y"?bo:wo,M=d==="y"?ls:us,P=t.rects.reference[g]+t.rects.reference[d]-u[d]-t.rects.popper[g],A=u[d]-t.rects.reference[d],L=oh(o),I=L?d==="y"?L.clientHeight||0:L.clientWidth||0:0,$=P/2-A/2,O=_[C],Z=I-x[g]-_[M],X=I/2-x[g]/2+$,q=Rf(O,X,Z),Y=d;t.modifiersData[n]=(e={},e[Y]=q,e.centerOffset=q-X,e)}}function BT(r){var e=r.state,t=r.options,n=t.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||Kw(e.elements.popper,i)&&(e.elements.arrow=i))}const NT={name:"arrow",enabled:!0,phase:"main",fn:$T,effect:BT,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function sc(r){return r.split("-")[1]}var jT={top:"auto",right:"auto",bottom:"auto",left:"auto"};function UT(r,e){var t=r.x,n=r.y,i=e.devicePixelRatio||1;return{x:ic(t*i)/i||0,y:ic(n*i)/i||0}}function ky(r){var e,t=r.popper,n=r.popperRect,i=r.placement,o=r.variation,u=r.offsets,s=r.position,d=r.gpuAcceleration,p=r.adaptive,g=r.roundOffsets,_=r.isFixed,x=u.x,C=x===void 0?0:x,M=u.y,P=M===void 0?0:M,A=typeof g=="function"?g({x:C,y:P}):{x:C,y:P};C=A.x,P=A.y;var L=u.hasOwnProperty("x"),I=u.hasOwnProperty("y"),$=wo,O=bo,Z=window;if(p){var X=oh(t),q="clientHeight",Y="clientWidth";if(X===Uo(t)&&(X=Ka(t),ua(X).position!=="static"&&s==="absolute"&&(q="scrollHeight",Y="scrollWidth")),X=X,i===bo||(i===wo||i===us)&&o===Hf){O=ls;var fe=_&&X===Z&&Z.visualViewport?Z.visualViewport.height:X[q];P-=fe-n.height,P*=d?1:-1}if(i===wo||(i===bo||i===ls)&&o===Hf){$=us;var Le=_&&X===Z&&Z.visualViewport?Z.visualViewport.width:X[Y];C-=Le-n.width,C*=d?1:-1}}var ee=Object.assign({position:s},p&&jT),ie=g===!0?UT({x:C,y:P},Uo(t)):{x:C,y:P};if(C=ie.x,P=ie.y,d){var ve;return Object.assign({},ee,(ve={},ve[O]=I?"0":"",ve[$]=L?"0":"",ve.transform=(Z.devicePixelRatio||1)<=1?"translate("+C+"px, "+P+"px)":"translate3d("+C+"px, "+P+"px, 0)",ve))}return Object.assign({},ee,(e={},e[O]=I?P+"px":"",e[$]=L?C+"px":"",e.transform="",e))}function VT(r){var e=r.state,t=r.options,n=t.gpuAcceleration,i=n===void 0?!0:n,o=t.adaptive,u=o===void 0?!0:o,s=t.roundOffsets,d=s===void 0?!0:s,p={placement:$s(e.placement),variation:sc(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,ky(Object.assign({},p,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:u,roundOffsets:d})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,ky(Object.assign({},p,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:d})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const qT={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:VT,data:{}};var wd={passive:!0};function HT(r){var e=r.state,t=r.instance,n=r.options,i=n.scroll,o=i===void 0?!0:i,u=n.resize,s=u===void 0?!0:u,d=Uo(e.elements.popper),p=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&p.forEach(function(g){g.addEventListener("scroll",t.update,wd)}),s&&d.addEventListener("resize",t.update,wd),function(){o&&p.forEach(function(g){g.removeEventListener("scroll",t.update,wd)}),s&&d.removeEventListener("resize",t.update,wd)}}const WT={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:HT,data:{}};var GT={left:"right",right:"left",bottom:"top",top:"bottom"};function Dd(r){return r.replace(/left|right|bottom|top/g,function(e){return GT[e]})}var ZT={start:"end",end:"start"};function Sy(r){return r.replace(/start|end/g,function(e){return ZT[e]})}function Qg(r){var e=Uo(r),t=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:t,scrollTop:n}}function e_(r){return oc(Ka(r)).left+Qg(r).scrollLeft}function KT(r,e){var t=Uo(r),n=Ka(r),i=t.visualViewport,o=n.clientWidth,u=n.clientHeight,s=0,d=0;if(i){o=i.width,u=i.height;var p=Zw();(p||!p&&e==="fixed")&&(s=i.offsetLeft,d=i.offsetTop)}return{width:o,height:u,x:s+e_(r),y:d}}function XT(r){var e,t=Ka(r),n=Qg(r),i=(e=r.ownerDocument)==null?void 0:e.body,o=Pl(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),u=Pl(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-n.scrollLeft+e_(r),d=-n.scrollTop;return ua(i||t).direction==="rtl"&&(s+=Pl(t.clientWidth,i?i.clientWidth:0)-o),{width:o,height:u,x:s,y:d}}function t_(r){var e=ua(r),t=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+n)}function Qw(r){return["html","body","#document"].indexOf(Bs(r))>=0?r.ownerDocument.body:is(r)&&t_(r)?r:Qw(lp(r))}function Ff(r,e){var t;e===void 0&&(e=[]);var n=Qw(r),i=n===((t=r.ownerDocument)==null?void 0:t.body),o=Uo(n),u=i?[o].concat(o.visualViewport||[],t_(n)?n:[]):n,s=e.concat(u);return i?s:s.concat(Ff(lp(u)))}function sg(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function YT(r,e){var t=oc(r,!1,e==="fixed");return t.top=t.top+r.clientTop,t.left=t.left+r.clientLeft,t.bottom=t.top+r.clientHeight,t.right=t.left+r.clientWidth,t.width=r.clientWidth,t.height=r.clientHeight,t.x=t.left,t.y=t.top,t}function Ty(r,e,t){return e===Hw?sg(KT(r,t)):Rl(e)?YT(e,t):sg(XT(Ka(r)))}function JT(r){var e=Ff(lp(r)),t=["absolute","fixed"].indexOf(ua(r).position)>=0,n=t&&is(r)?oh(r):r;return Rl(n)?e.filter(function(i){return Rl(i)&&Kw(i,n)&&Bs(i)!=="body"}):[]}function QT(r,e,t,n){var i=e==="clippingParents"?JT(r):[].concat(e),o=[].concat(i,[t]),u=o[0],s=o.reduce(function(d,p){var g=Ty(r,p,n);return d.top=Pl(g.top,d.top),d.right=Yd(g.right,d.right),d.bottom=Yd(g.bottom,d.bottom),d.left=Pl(g.left,d.left),d},Ty(r,u,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function e2(r){var e=r.reference,t=r.element,n=r.placement,i=n?$s(n):null,o=n?sc(n):null,u=e.x+e.width/2-t.width/2,s=e.y+e.height/2-t.height/2,d;switch(i){case bo:d={x:u,y:e.y-t.height};break;case ls:d={x:u,y:e.y+e.height};break;case us:d={x:e.x+e.width,y:s};break;case wo:d={x:e.x-t.width,y:s};break;default:d={x:e.x,y:e.y}}var p=i?Jg(i):null;if(p!=null){var g=p==="y"?"height":"width";switch(o){case rc:d[p]=d[p]-(e[g]/2-t[g]/2);break;case Hf:d[p]=d[p]+(e[g]/2-t[g]/2);break}}return d}function Wf(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=n===void 0?r.placement:n,o=t.strategy,u=o===void 0?r.strategy:o,s=t.boundary,d=s===void 0?bT:s,p=t.rootBoundary,g=p===void 0?Hw:p,_=t.elementContext,x=_===void 0?pf:_,C=t.altBoundary,M=C===void 0?!1:C,P=t.padding,A=P===void 0?0:P,L=Yw(typeof A!="number"?A:Jw(A,ih)),I=x===pf?wT:pf,$=r.rects.popper,O=r.elements[M?I:x],Z=QT(Rl(O)?O:O.contextElement||Ka(r.elements.popper),d,g,u),X=oc(r.elements.reference),q=e2({reference:X,element:$,strategy:"absolute",placement:i}),Y=sg(Object.assign({},$,q)),fe=x===pf?Y:X,Le={top:Z.top-fe.top+L.top,bottom:fe.bottom-Z.bottom+L.bottom,left:Z.left-fe.left+L.left,right:fe.right-Z.right+L.right},ee=r.modifiersData.offset;if(x===pf&&ee){var ie=ee[i];Object.keys(Le).forEach(function(ve){var ye=[us,ls].indexOf(ve)>=0?1:-1,it=[bo,ls].indexOf(ve)>=0?"y":"x";Le[ve]+=ie[it]*ye})}return Le}function eC(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=t.boundary,o=t.rootBoundary,u=t.padding,s=t.flipVariations,d=t.allowedAutoPlacements,p=d===void 0?Ww:d,g=sc(n),_=g?s?wy:wy.filter(function(M){return sc(M)===g}):ih,x=_.filter(function(M){return p.indexOf(M)>=0});x.length===0&&(x=_);var C=x.reduce(function(M,P){return M[P]=Wf(r,{placement:P,boundary:i,rootBoundary:o,padding:u})[$s(P)],M},{});return Object.keys(C).sort(function(M,P){return C[M]-C[P]})}function tC(r){if($s(r)===Kg)return[];var e=Dd(r);return[Sy(r),e,Sy(e)]}function nC(r){var e=r.state,t=r.options,n=r.name;if(!e.modifiersData[n]._skip){for(var i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!0:u,d=t.fallbackPlacements,p=t.padding,g=t.boundary,_=t.rootBoundary,x=t.altBoundary,C=t.flipVariations,M=C===void 0?!0:C,P=t.allowedAutoPlacements,A=e.options.placement,L=$s(A),I=L===A,$=d||(I||!M?[Dd(A)]:tC(A)),O=[A].concat($).reduce(function(He,mt){return He.concat($s(mt)===Kg?eC(e,{placement:mt,boundary:g,rootBoundary:_,padding:p,flipVariations:M,allowedAutoPlacements:P}):mt)},[]),Z=e.rects.reference,X=e.rects.popper,q=new Map,Y=!0,fe=O[0],Le=0;Le<O.length;Le++){var ee=O[Le],ie=$s(ee),ve=sc(ee)===rc,ye=[bo,ls].indexOf(ie)>=0,it=ye?"width":"height",Fe=Wf(e,{placement:ee,boundary:g,rootBoundary:_,altBoundary:x,padding:p}),Ne=ye?ve?us:wo:ve?ls:bo;Z[it]>X[it]&&(Ne=Dd(Ne));var Ae=Dd(Ne),ot=[];if(o&&ot.push(Fe[ie]<=0),s&&ot.push(Fe[Ne]<=0,Fe[Ae]<=0),ot.every(function(He){return He})){fe=ee,Y=!1;break}q.set(ee,ot)}if(Y)for(var Ye=M?3:1,ut=function(mt){var Pt=O.find(function(jt){var un=q.get(jt);if(un)return un.slice(0,mt).every(function(nn){return nn})});if(Pt)return fe=Pt,"break"},pt=Ye;pt>0;pt--){var _t=ut(pt);if(_t==="break")break}e.placement!==fe&&(e.modifiersData[n]._skip=!0,e.placement=fe,e.reset=!0)}}const rC={name:"flip",enabled:!0,phase:"main",fn:nC,requiresIfExists:["offset"],data:{_skip:!1}};function Cy(r,e,t){return t===void 0&&(t={x:0,y:0}),{top:r.top-e.height-t.y,right:r.right-e.width+t.x,bottom:r.bottom-e.height+t.y,left:r.left-e.width-t.x}}function My(r){return[bo,us,ls,wo].some(function(e){return r[e]>=0})}function iC(r){var e=r.state,t=r.name,n=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,u=Wf(e,{elementContext:"reference"}),s=Wf(e,{altBoundary:!0}),d=Cy(u,n),p=Cy(s,i,o),g=My(d),_=My(p);e.modifiersData[t]={referenceClippingOffsets:d,popperEscapeOffsets:p,isReferenceHidden:g,hasPopperEscaped:_},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":g,"data-popper-escaped":_})}const oC={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:iC};function sC(r,e,t){var n=$s(r),i=[wo,bo].indexOf(n)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:r})):t,u=o[0],s=o[1];return u=u||0,s=(s||0)*i,[wo,us].indexOf(n)>=0?{x:s,y:u}:{x:u,y:s}}function aC(r){var e=r.state,t=r.options,n=r.name,i=t.offset,o=i===void 0?[0,0]:i,u=Ww.reduce(function(g,_){return g[_]=sC(_,e.rects,o),g},{}),s=u[e.placement],d=s.x,p=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=d,e.modifiersData.popperOffsets.y+=p),e.modifiersData[n]=u}const lC={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:aC};function uC(r){var e=r.state,t=r.name;e.modifiersData[t]=e2({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const cC={name:"popperOffsets",enabled:!0,phase:"read",fn:uC,data:{}};function fC(r){return r==="x"?"y":"x"}function hC(r){var e=r.state,t=r.options,n=r.name,i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,s=u===void 0?!1:u,d=t.boundary,p=t.rootBoundary,g=t.altBoundary,_=t.padding,x=t.tether,C=x===void 0?!0:x,M=t.tetherOffset,P=M===void 0?0:M,A=Wf(e,{boundary:d,rootBoundary:p,padding:_,altBoundary:g}),L=$s(e.placement),I=sc(e.placement),$=!I,O=Jg(L),Z=fC(O),X=e.modifiersData.popperOffsets,q=e.rects.reference,Y=e.rects.popper,fe=typeof P=="function"?P(Object.assign({},e.rects,{placement:e.placement})):P,Le=typeof fe=="number"?{mainAxis:fe,altAxis:fe}:Object.assign({mainAxis:0,altAxis:0},fe),ee=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,ie={x:0,y:0};if(X){if(o){var ve,ye=O==="y"?bo:wo,it=O==="y"?ls:us,Fe=O==="y"?"height":"width",Ne=X[O],Ae=Ne+A[ye],ot=Ne-A[it],Ye=C?-Y[Fe]/2:0,ut=I===rc?q[Fe]:Y[Fe],pt=I===rc?-Y[Fe]:-q[Fe],_t=e.elements.arrow,He=C&&_t?Yg(_t):{width:0,height:0},mt=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Xw(),Pt=mt[ye],jt=mt[it],un=Rf(0,q[Fe],He[Fe]),nn=$?q[Fe]/2-Ye-un-Pt-Le.mainAxis:ut-un-Pt-Le.mainAxis,rn=$?-q[Fe]/2+Ye+un+jt+Le.mainAxis:pt+un+jt+Le.mainAxis,pn=e.elements.arrow&&oh(e.elements.arrow),yn=pn?O==="y"?pn.clientTop||0:pn.clientLeft||0:0,qe=(ve=ee==null?void 0:ee[O])!=null?ve:0,We=Ne+nn-qe-yn,Ke=Ne+rn-qe,kt=Rf(C?Yd(Ae,We):Ae,Ne,C?Pl(ot,Ke):ot);X[O]=kt,ie[O]=kt-Ne}if(s){var pe,fn=O==="x"?bo:wo,Xe=O==="x"?ls:us,lt=X[Z],Wt=Z==="y"?"height":"width",Xn=lt+A[fn],Wn=lt-A[Xe],fr=[bo,wo].indexOf(L)!==-1,Tr=(pe=ee==null?void 0:ee[Z])!=null?pe:0,Cr=fr?Xn:lt-q[Wt]-Y[Wt]-Tr+Le.altAxis,xi=fr?lt+q[Wt]+Y[Wt]-Tr-Le.altAxis:Wn,Un=C&&fr?FT(Cr,lt,xi):Rf(C?Cr:Xn,lt,C?xi:Wn);X[Z]=Un,ie[Z]=Un-lt}e.modifiersData[n]=ie}}const dC={name:"preventOverflow",enabled:!0,phase:"main",fn:hC,requiresIfExists:["offset"]};function pC(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function mC(r){return r===Uo(r)||!is(r)?Qg(r):pC(r)}function gC(r){var e=r.getBoundingClientRect(),t=ic(e.width)/r.offsetWidth||1,n=ic(e.height)/r.offsetHeight||1;return t!==1||n!==1}function _C(r,e,t){t===void 0&&(t=!1);var n=is(e),i=is(e)&&gC(e),o=Ka(e),u=oc(r,i,t),s={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(n||!n&&!t)&&((Bs(e)!=="body"||t_(o))&&(s=mC(e)),is(e)?(d=oc(e,!0),d.x+=e.clientLeft,d.y+=e.clientTop):o&&(d.x=e_(o))),{x:u.left+s.scrollLeft-d.x,y:u.top+s.scrollTop-d.y,width:u.width,height:u.height}}function yC(r){var e=new Map,t=new Set,n=[];r.forEach(function(o){e.set(o.name,o)});function i(o){t.add(o.name);var u=[].concat(o.requires||[],o.requiresIfExists||[]);u.forEach(function(s){if(!t.has(s)){var d=e.get(s);d&&i(d)}}),n.push(o)}return r.forEach(function(o){t.has(o.name)||i(o)}),n}function vC(r){var e=yC(r);return AT.reduce(function(t,n){return t.concat(e.filter(function(i){return i.phase===n}))},[])}function bC(r){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(r())})})),e}}function wC(r){var e=r.reduce(function(t,n){var i=t[n.name];return t[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,t},{});return Object.keys(e).map(function(t){return e[t]})}var Ey={placement:"bottom",modifiers:[],strategy:"absolute"};function Ly(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function xC(r){r===void 0&&(r={});var e=r,t=e.defaultModifiers,n=t===void 0?[]:t,i=e.defaultOptions,o=i===void 0?Ey:i;return function(s,d,p){p===void 0&&(p=o);var g={placement:"bottom",orderedModifiers:[],options:Object.assign({},Ey,o),modifiersData:{},elements:{reference:s,popper:d},attributes:{},styles:{}},_=[],x=!1,C={state:g,setOptions:function(L){var I=typeof L=="function"?L(g.options):L;P(),g.options=Object.assign({},o,g.options,I),g.scrollParents={reference:Rl(s)?Ff(s):s.contextElement?Ff(s.contextElement):[],popper:Ff(d)};var $=vC(wC([].concat(n,g.options.modifiers)));return g.orderedModifiers=$.filter(function(O){return O.enabled}),M(),C.update()},forceUpdate:function(){if(!x){var L=g.elements,I=L.reference,$=L.popper;if(Ly(I,$)){g.rects={reference:_C(I,oh($),g.options.strategy==="fixed"),popper:Yg($)},g.reset=!1,g.placement=g.options.placement,g.orderedModifiers.forEach(function(Le){return g.modifiersData[Le.name]=Object.assign({},Le.data)});for(var O=0;O<g.orderedModifiers.length;O++){if(g.reset===!0){g.reset=!1,O=-1;continue}var Z=g.orderedModifiers[O],X=Z.fn,q=Z.options,Y=q===void 0?{}:q,fe=Z.name;typeof X=="function"&&(g=X({state:g,options:Y,name:fe,instance:C})||g)}}}},update:bC(function(){return new Promise(function(A){C.forceUpdate(),A(g)})}),destroy:function(){P(),x=!0}};if(!Ly(s,d))return C;C.setOptions(p).then(function(A){!x&&p.onFirstUpdate&&p.onFirstUpdate(A)});function M(){g.orderedModifiers.forEach(function(A){var L=A.name,I=A.options,$=I===void 0?{}:I,O=A.effect;if(typeof O=="function"){var Z=O({state:g,name:L,instance:C,options:$}),X=function(){};_.push(Z||X)}})}function P(){_.forEach(function(A){return A()}),_=[]}return C}}var kC=[WT,cC,qT,Gw,lC,rC,dC,NT,oC],SC=xC({defaultModifiers:kC}),TC="tippy-box",t2="tippy-content",CC="tippy-backdrop",n2="tippy-arrow",r2="tippy-svg-arrow",El={passive:!0,capture:!0},i2=function(){return document.body};function Pm(r,e,t){if(Array.isArray(r)){var n=r[e];return n??(Array.isArray(t)?t[e]:t)}return r}function n_(r,e){var t={}.toString.call(r);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function o2(r,e){return typeof r=="function"?r.apply(void 0,e):r}function Iy(r,e){if(e===0)return r;var t;return function(n){clearTimeout(t),t=setTimeout(function(){r(n)},e)}}function MC(r){return r.split(/\s+/).filter(Boolean)}function Wu(r){return[].concat(r)}function Ay(r,e){r.indexOf(e)===-1&&r.push(e)}function EC(r){return r.filter(function(e,t){return r.indexOf(e)===t})}function LC(r){return r.split("-")[0]}function Jd(r){return[].slice.call(r)}function Py(r){return Object.keys(r).reduce(function(e,t){return r[t]!==void 0&&(e[t]=r[t]),e},{})}function Of(){return document.createElement("div")}function up(r){return["Element","Fragment"].some(function(e){return n_(r,e)})}function IC(r){return n_(r,"NodeList")}function AC(r){return n_(r,"MouseEvent")}function PC(r){return!!(r&&r._tippy&&r._tippy.reference===r)}function zC(r){return up(r)?[r]:IC(r)?Jd(r):Array.isArray(r)?r:Jd(document.querySelectorAll(r))}function zm(r,e){r.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function zy(r,e){r.forEach(function(t){t&&t.setAttribute("data-state",e)})}function DC(r){var e,t=Wu(r),n=t[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function RC(r,e){var t=e.clientX,n=e.clientY;return r.every(function(i){var o=i.popperRect,u=i.popperState,s=i.props,d=s.interactiveBorder,p=LC(u.placement),g=u.modifiersData.offset;if(!g)return!0;var _=p==="bottom"?g.top.y:0,x=p==="top"?g.bottom.y:0,C=p==="right"?g.left.x:0,M=p==="left"?g.right.x:0,P=o.top-n+_>d,A=n-o.bottom-x>d,L=o.left-t+C>d,I=t-o.right-M>d;return P||A||L||I})}function Dm(r,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){r[n](i,t)})}function Dy(r,e){for(var t=e;t;){var n;if(r.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var Os={isTouch:!1},Ry=0;function FC(){Os.isTouch||(Os.isTouch=!0,window.performance&&document.addEventListener("mousemove",s2))}function s2(){var r=performance.now();r-Ry<20&&(Os.isTouch=!1,document.removeEventListener("mousemove",s2)),Ry=r}function OC(){var r=document.activeElement;if(PC(r)){var e=r._tippy;r.blur&&!e.state.isVisible&&r.blur()}}function $C(){document.addEventListener("touchstart",FC,El),window.addEventListener("blur",OC)}var BC=typeof window<"u"&&typeof document<"u",NC=BC?!!window.msCrypto:!1,jC={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},UC={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},vs=Object.assign({appendTo:i2,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},jC,UC),VC=Object.keys(vs),qC=function(e){var t=Object.keys(e);t.forEach(function(n){vs[n]=e[n]})};function a2(r){var e=r.plugins||[],t=e.reduce(function(n,i){var o=i.name,u=i.defaultValue;if(o){var s;n[o]=r[o]!==void 0?r[o]:(s=vs[o])!=null?s:u}return n},{});return Object.assign({},r,t)}function HC(r,e){var t=e?Object.keys(a2(Object.assign({},vs,{plugins:e}))):VC,n=t.reduce(function(i,o){var u=(r.getAttribute("data-tippy-"+o)||"").trim();if(!u)return i;if(o==="content")i[o]=u;else try{i[o]=JSON.parse(u)}catch{i[o]=u}return i},{});return n}function Fy(r,e){var t=Object.assign({},e,{content:o2(e.content,[r])},e.ignoreAttributes?{}:HC(r,e.plugins));return t.aria=Object.assign({},vs.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var WC=function(){return"innerHTML"};function ag(r,e){r[WC()]=e}function Oy(r){var e=Of();return r===!0?e.className=n2:(e.className=r2,up(r)?e.appendChild(r):ag(e,r)),e}function $y(r,e){up(e.content)?(ag(r,""),r.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?ag(r,e.content):r.textContent=e.content)}function lg(r){var e=r.firstElementChild,t=Jd(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(t2)}),arrow:t.find(function(n){return n.classList.contains(n2)||n.classList.contains(r2)}),backdrop:t.find(function(n){return n.classList.contains(CC)})}}function l2(r){var e=Of(),t=Of();t.className=TC,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Of();n.className=t2,n.setAttribute("data-state","hidden"),$y(n,r.props),e.appendChild(t),t.appendChild(n),i(r.props,r.props);function i(o,u){var s=lg(e),d=s.box,p=s.content,g=s.arrow;u.theme?d.setAttribute("data-theme",u.theme):d.removeAttribute("data-theme"),typeof u.animation=="string"?d.setAttribute("data-animation",u.animation):d.removeAttribute("data-animation"),u.inertia?d.setAttribute("data-inertia",""):d.removeAttribute("data-inertia"),d.style.maxWidth=typeof u.maxWidth=="number"?u.maxWidth+"px":u.maxWidth,u.role?d.setAttribute("role",u.role):d.removeAttribute("role"),(o.content!==u.content||o.allowHTML!==u.allowHTML)&&$y(p,r.props),u.arrow?g?o.arrow!==u.arrow&&(d.removeChild(g),d.appendChild(Oy(u.arrow))):d.appendChild(Oy(u.arrow)):g&&d.removeChild(g)}return{popper:e,onUpdate:i}}l2.$$tippy=!0;var GC=1,xd=[],Rm=[];function ZC(r,e){var t=Fy(r,Object.assign({},vs,a2(Py(e)))),n,i,o,u=!1,s=!1,d=!1,p=!1,g,_,x,C=[],M=Iy(We,t.interactiveDebounce),P,A=GC++,L=null,I=EC(t.plugins),$={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},O={id:A,reference:r,popper:Of(),popperInstance:L,props:t,state:$,plugins:I,clearDelayTimeouts:Cr,setProps:xi,setContent:Un,show:xt,hide:Pr,hideWithInteractivity:vr,enable:fr,disable:Tr,unmount:Ri,destroy:Bn};if(!t.render)return O;var Z=t.render(O),X=Z.popper,q=Z.onUpdate;X.setAttribute("data-tippy-root",""),X.id="tippy-"+O.id,O.popper=X,r._tippy=O,X._tippy=O;var Y=I.map(function(Oe){return Oe.fn(O)}),fe=r.hasAttribute("aria-expanded");return pn(),Ye(),Ne(),Ae("onCreate",[O]),t.showOnCreate&&Xn(),X.addEventListener("mouseenter",function(){O.props.interactive&&O.state.isVisible&&O.clearDelayTimeouts()}),X.addEventListener("mouseleave",function(){O.props.interactive&&O.props.trigger.indexOf("mouseenter")>=0&&ye().addEventListener("mousemove",M)}),O;function Le(){var Oe=O.props.touch;return Array.isArray(Oe)?Oe:[Oe,0]}function ee(){return Le()[0]==="hold"}function ie(){var Oe;return!!((Oe=O.props.render)!=null&&Oe.$$tippy)}function ve(){return P||r}function ye(){var Oe=ve().parentNode;return Oe?DC(Oe):document}function it(){return lg(X)}function Fe(Oe){return O.state.isMounted&&!O.state.isVisible||Os.isTouch||g&&g.type==="focus"?0:Pm(O.props.delay,Oe?0:1,vs.delay)}function Ne(Oe){Oe===void 0&&(Oe=!1),X.style.pointerEvents=O.props.interactive&&!Oe?"":"none",X.style.zIndex=""+O.props.zIndex}function Ae(Oe,yt,bt){if(bt===void 0&&(bt=!0),Y.forEach(function(Qt){Qt[Oe]&&Qt[Oe].apply(Qt,yt)}),bt){var Rt;(Rt=O.props)[Oe].apply(Rt,yt)}}function ot(){var Oe=O.props.aria;if(Oe.content){var yt="aria-"+Oe.content,bt=X.id,Rt=Wu(O.props.triggerTarget||r);Rt.forEach(function(Qt){var Jt=Qt.getAttribute(yt);if(O.state.isVisible)Qt.setAttribute(yt,Jt?Jt+" "+bt:bt);else{var yr=Jt&&Jt.replace(bt,"").trim();yr?Qt.setAttribute(yt,yr):Qt.removeAttribute(yt)}})}}function Ye(){if(!(fe||!O.props.aria.expanded)){var Oe=Wu(O.props.triggerTarget||r);Oe.forEach(function(yt){O.props.interactive?yt.setAttribute("aria-expanded",O.state.isVisible&&yt===ve()?"true":"false"):yt.removeAttribute("aria-expanded")})}}function ut(){ye().removeEventListener("mousemove",M),xd=xd.filter(function(Oe){return Oe!==M})}function pt(Oe){if(!(Os.isTouch&&(d||Oe.type==="mousedown"))){var yt=Oe.composedPath&&Oe.composedPath()[0]||Oe.target;if(!(O.props.interactive&&Dy(X,yt))){if(Wu(O.props.triggerTarget||r).some(function(bt){return Dy(bt,yt)})){if(Os.isTouch||O.state.isVisible&&O.props.trigger.indexOf("click")>=0)return}else Ae("onClickOutside",[O,Oe]);O.props.hideOnClick===!0&&(O.clearDelayTimeouts(),O.hide(),s=!0,setTimeout(function(){s=!1}),O.state.isMounted||Pt())}}}function _t(){d=!0}function He(){d=!1}function mt(){var Oe=ye();Oe.addEventListener("mousedown",pt,!0),Oe.addEventListener("touchend",pt,El),Oe.addEventListener("touchstart",He,El),Oe.addEventListener("touchmove",_t,El)}function Pt(){var Oe=ye();Oe.removeEventListener("mousedown",pt,!0),Oe.removeEventListener("touchend",pt,El),Oe.removeEventListener("touchstart",He,El),Oe.removeEventListener("touchmove",_t,El)}function jt(Oe,yt){nn(Oe,function(){!O.state.isVisible&&X.parentNode&&X.parentNode.contains(X)&&yt()})}function un(Oe,yt){nn(Oe,yt)}function nn(Oe,yt){var bt=it().box;function Rt(Qt){Qt.target===bt&&(Dm(bt,"remove",Rt),yt())}if(Oe===0)return yt();Dm(bt,"remove",_),Dm(bt,"add",Rt),_=Rt}function rn(Oe,yt,bt){bt===void 0&&(bt=!1);var Rt=Wu(O.props.triggerTarget||r);Rt.forEach(function(Qt){Qt.addEventListener(Oe,yt,bt),C.push({node:Qt,eventType:Oe,handler:yt,options:bt})})}function pn(){ee()&&(rn("touchstart",qe,{passive:!0}),rn("touchend",Ke,{passive:!0})),MC(O.props.trigger).forEach(function(Oe){if(Oe!=="manual")switch(rn(Oe,qe),Oe){case"mouseenter":rn("mouseleave",Ke);break;case"focus":rn(NC?"focusout":"blur",kt);break;case"focusin":rn("focusout",kt);break}})}function yn(){C.forEach(function(Oe){var yt=Oe.node,bt=Oe.eventType,Rt=Oe.handler,Qt=Oe.options;yt.removeEventListener(bt,Rt,Qt)}),C=[]}function qe(Oe){var yt,bt=!1;if(!(!O.state.isEnabled||pe(Oe)||s)){var Rt=((yt=g)==null?void 0:yt.type)==="focus";g=Oe,P=Oe.currentTarget,Ye(),!O.state.isVisible&&AC(Oe)&&xd.forEach(function(Qt){return Qt(Oe)}),Oe.type==="click"&&(O.props.trigger.indexOf("mouseenter")<0||u)&&O.props.hideOnClick!==!1&&O.state.isVisible?bt=!0:Xn(Oe),Oe.type==="click"&&(u=!bt),bt&&!Rt&&Wn(Oe)}}function We(Oe){var yt=Oe.target,bt=ve().contains(yt)||X.contains(yt);if(!(Oe.type==="mousemove"&&bt)){var Rt=Wt().concat(X).map(function(Qt){var Jt,yr=Qt._tippy,or=(Jt=yr.popperInstance)==null?void 0:Jt.state;return or?{popperRect:Qt.getBoundingClientRect(),popperState:or,props:t}:null}).filter(Boolean);RC(Rt,Oe)&&(ut(),Wn(Oe))}}function Ke(Oe){var yt=pe(Oe)||O.props.trigger.indexOf("click")>=0&&u;if(!yt){if(O.props.interactive){O.hideWithInteractivity(Oe);return}Wn(Oe)}}function kt(Oe){O.props.trigger.indexOf("focusin")<0&&Oe.target!==ve()||O.props.interactive&&Oe.relatedTarget&&X.contains(Oe.relatedTarget)||Wn(Oe)}function pe(Oe){return Os.isTouch?ee()!==Oe.type.indexOf("touch")>=0:!1}function fn(){Xe();var Oe=O.props,yt=Oe.popperOptions,bt=Oe.placement,Rt=Oe.offset,Qt=Oe.getReferenceClientRect,Jt=Oe.moveTransition,yr=ie()?lg(X).arrow:null,or=Qt?{getBoundingClientRect:Qt,contextElement:Qt.contextElement||ve()}:r,Te={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ge){var xe=ge.state;if(ie()){var $e=it(),Be=$e.box;["placement","reference-hidden","escaped"].forEach(function(Ue){Ue==="placement"?Be.setAttribute("data-placement",xe.placement):xe.attributes.popper["data-popper-"+Ue]?Be.setAttribute("data-"+Ue,""):Be.removeAttribute("data-"+Ue)}),xe.attributes.popper={}}}},ne=[{name:"offset",options:{offset:Rt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!Jt}},Te];ie()&&yr&&ne.push({name:"arrow",options:{element:yr,padding:3}}),ne.push.apply(ne,(yt==null?void 0:yt.modifiers)||[]),O.popperInstance=SC(or,X,Object.assign({},yt,{placement:bt,onFirstUpdate:x,modifiers:ne}))}function Xe(){O.popperInstance&&(O.popperInstance.destroy(),O.popperInstance=null)}function lt(){var Oe=O.props.appendTo,yt,bt=ve();O.props.interactive&&Oe===i2||Oe==="parent"?yt=bt.parentNode:yt=o2(Oe,[bt]),yt.contains(X)||yt.appendChild(X),O.state.isMounted=!0,fn()}function Wt(){return Jd(X.querySelectorAll("[data-tippy-root]"))}function Xn(Oe){O.clearDelayTimeouts(),Oe&&Ae("onTrigger",[O,Oe]),mt();var yt=Fe(!0),bt=Le(),Rt=bt[0],Qt=bt[1];Os.isTouch&&Rt==="hold"&&Qt&&(yt=Qt),yt?n=setTimeout(function(){O.show()},yt):O.show()}function Wn(Oe){if(O.clearDelayTimeouts(),Ae("onUntrigger",[O,Oe]),!O.state.isVisible){Pt();return}if(!(O.props.trigger.indexOf("mouseenter")>=0&&O.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Oe.type)>=0&&u)){var yt=Fe(!1);yt?i=setTimeout(function(){O.state.isVisible&&O.hide()},yt):o=requestAnimationFrame(function(){O.hide()})}}function fr(){O.state.isEnabled=!0}function Tr(){O.hide(),O.state.isEnabled=!1}function Cr(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(o)}function xi(Oe){if(!O.state.isDestroyed){Ae("onBeforeUpdate",[O,Oe]),yn();var yt=O.props,bt=Fy(r,Object.assign({},yt,Py(Oe),{ignoreAttributes:!0}));O.props=bt,pn(),yt.interactiveDebounce!==bt.interactiveDebounce&&(ut(),M=Iy(We,bt.interactiveDebounce)),yt.triggerTarget&&!bt.triggerTarget?Wu(yt.triggerTarget).forEach(function(Rt){Rt.removeAttribute("aria-expanded")}):bt.triggerTarget&&r.removeAttribute("aria-expanded"),Ye(),Ne(),q&&q(yt,bt),O.popperInstance&&(fn(),Wt().forEach(function(Rt){requestAnimationFrame(Rt._tippy.popperInstance.forceUpdate)})),Ae("onAfterUpdate",[O,Oe])}}function Un(Oe){O.setProps({content:Oe})}function xt(){var Oe=O.state.isVisible,yt=O.state.isDestroyed,bt=!O.state.isEnabled,Rt=Os.isTouch&&!O.props.touch,Qt=Pm(O.props.duration,0,vs.duration);if(!(Oe||yt||bt||Rt)&&!ve().hasAttribute("disabled")&&(Ae("onShow",[O],!1),O.props.onShow(O)!==!1)){if(O.state.isVisible=!0,ie()&&(X.style.visibility="visible"),Ne(),mt(),O.state.isMounted||(X.style.transition="none"),ie()){var Jt=it(),yr=Jt.box,or=Jt.content;zm([yr,or],0)}x=function(){var ne;if(!(!O.state.isVisible||p)){if(p=!0,X.offsetHeight,X.style.transition=O.props.moveTransition,ie()&&O.props.animation){var ce=it(),ge=ce.box,xe=ce.content;zm([ge,xe],Qt),zy([ge,xe],"visible")}ot(),Ye(),Ay(Rm,O),(ne=O.popperInstance)==null||ne.forceUpdate(),Ae("onMount",[O]),O.props.animation&&ie()&&un(Qt,function(){O.state.isShown=!0,Ae("onShown",[O])})}},lt()}}function Pr(){var Oe=!O.state.isVisible,yt=O.state.isDestroyed,bt=!O.state.isEnabled,Rt=Pm(O.props.duration,1,vs.duration);if(!(Oe||yt||bt)&&(Ae("onHide",[O],!1),O.props.onHide(O)!==!1)){if(O.state.isVisible=!1,O.state.isShown=!1,p=!1,u=!1,ie()&&(X.style.visibility="hidden"),ut(),Pt(),Ne(!0),ie()){var Qt=it(),Jt=Qt.box,yr=Qt.content;O.props.animation&&(zm([Jt,yr],Rt),zy([Jt,yr],"hidden"))}ot(),Ye(),O.props.animation?ie()&&jt(Rt,O.unmount):O.unmount()}}function vr(Oe){ye().addEventListener("mousemove",M),Ay(xd,M),M(Oe)}function Ri(){O.state.isVisible&&O.hide(),O.state.isMounted&&(Xe(),Wt().forEach(function(Oe){Oe._tippy.unmount()}),X.parentNode&&X.parentNode.removeChild(X),Rm=Rm.filter(function(Oe){return Oe!==O}),O.state.isMounted=!1,Ae("onHidden",[O]))}function Bn(){O.state.isDestroyed||(O.clearDelayTimeouts(),O.unmount(),yn(),delete r._tippy,O.state.isDestroyed=!0,Ae("onDestroy",[O]))}}function sh(r,e){e===void 0&&(e={});var t=vs.plugins.concat(e.plugins||[]);$C();var n=Object.assign({},e,{plugins:t}),i=zC(r),o=i.reduce(function(u,s){var d=s&&ZC(s,n);return d&&u.push(d),u},[]);return up(r)?o[0]:o}sh.defaultProps=vs;sh.setDefaultProps=qC;sh.currentInput=Os;Object.assign({},Gw,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});sh.setDefaultProps({render:l2});const KC=r=>({}),By=r=>({}),XC=r=>({}),Ny=r=>({});function jy(r){let e,t;return e=new r_({props:{$$slots:{default:[YC]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function YC(r){let e,t;const n=r[3].help,i=vn(n,r,r[6],Ny);return{c(){e=U("div"),i&&i.c(),he(e,"class","context-layer-help-content")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&64)&&wn(i,n,o,o[6],t?bn(n,o[6],u,XC):xn(o[6]),Ny)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function Uy(r){let e,t;const n=r[3].legend,i=vn(n,r,r[6],By);return{c(){e=U("div"),i&&i.c(),he(e,"class","legend svelte-1cu2wie")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&64)&&wn(i,n,o,o[6],t?bn(n,o[6],u,KC):xn(o[6]),By)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function JC(r){let e,t,n,i,o,u,s,d,p,g,_=r[2].help&&jy(r),x=r[0]&&r[2].legend&&Uy(r);return{c(){e=U("button"),t=U("input"),n=oe(),i=Ee(r[1]),o=oe(),_&&_.c(),u=oe(),x&&x.c(),s=tr(),Qe(t,"aspect-ratio","1.0"),he(t,"type","checkbox"),he(e,"class","context-control"),Qe(e,"display","flex"),Qe(e,"align-items","center"),Qe(e,"justify-content","leading"),Qe(e,"gap","8px"),Qe(e,"text-align","left")},m(C,M){W(C,e,M),F(e,t),t.checked=r[0],F(e,n),F(e,i),F(e,o),_&&_.m(e,null),W(C,u,M),x&&x.m(C,M),W(C,s,M),d=!0,p||(g=[It(t,"change",r[4]),It(e,"click",r[5])],p=!0)},p(C,[M]){M&1&&(t.checked=C[0]),(!d||M&2)&&St(i,C[1]),C[2].help?_?(_.p(C,M),M&4&&N(_,1)):(_=jy(C),_.c(),N(_,1),_.m(e,null)):_&&(Xt(),V(_,1,1,()=>{_=null}),Yt()),C[0]&&C[2].legend?x?(x.p(C,M),M&5&&N(x,1)):(x=Uy(C),x.c(),N(x,1),x.m(s.parentNode,s)):x&&(Xt(),V(x,1,1,()=>{x=null}),Yt())},i(C){d||(N(_),N(x),d=!0)},o(C){V(_),V(x),d=!1},d(C){C&&(H(e),H(u),H(s)),_&&_.d(),x&&x.d(C),p=!1,cr(g)}}}function QC(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=Ig(n);let{label:u}=e,{show:s=!1}=e;function d(){s=this.checked,t(0,s)}const p=()=>t(0,s=!s);return r.$$set=g=>{"label"in g&&t(1,u=g.label),"show"in g&&t(0,s=g.show),"$$scope"in g&&t(6,i=g.$$scope)},[s,u,o,n,d,p,i]}class os extends Lt{constructor(e){super(),Et(this,e,QC,JC,Tt,{label:1,show:0})}}let Rd=In(!0);function eM(r){let e,t;return e=new Xi({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function tM(r){let e,t;return e=new gr({props:{data:r[1],$$slots:{default:[eM]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function nM(r,e,t){let n;return ct(r,Rd,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class rM extends Lt{constructor(e){super(),Et(this,e,nM,tM,Tt,{})}}function iM(r){let e,t;return e=new ap({props:{lngLat:r[0],$$slots:{default:[sM]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function oM(r){let e,t,n;function i(u){r[3](u)}let o={draggable:!0,$$slots:{default:[aM]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new ap({props:o}),dn.push(()=>Dn(e,"lngLat",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const d={};s&16&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.lngLat=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function sM(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),he(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function aM(r){let e,t;const n=r[2].default,i=vn(n,r,r[4],null);return{c(){e=U("span"),i&&i.c(),he(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&wn(i,n,o,o[4],t?bn(n,o[4],u,null):xn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){V(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function lM(r){let e,t,n,i;const o=[oM,iM],u=[];function s(d,p){return d[1]?0:1}return e=s(r),t=u[e]=o[e](r),{c(){t.c(),n=tr()},m(d,p){u[e].m(d,p),W(d,n,p),i=!0},p(d,[p]){let g=e;e=s(d),e===g?u[e].p(d,p):(Xt(),V(u[g],1,1,()=>{u[g]=null}),Yt(),t=u[e],t?t.p(d,p):(t=u[e]=o[e](d),t.c()),N(t,1),t.m(n.parentNode,n))},i(d){i||(N(t),i=!0)},o(d){V(t),i=!1},d(d){d&&H(n),u[e].d(d)}}}function uM(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:u=!1}=e;function s(d){o=d,t(0,o)}return r.$$set=d=>{"lngLat"in d&&t(0,o=d.lngLat),"draggable"in d&&t(1,u=d.draggable),"$$scope"in d&&t(4,i=d.$$scope)},[o,u,n,s,i]}class Fl extends Lt{constructor(e){super(),Et(this,e,uM,lM,Tt,{lngLat:0,draggable:1})}}function cM(r){let e,t,n;const i=r[2].default,o=vn(i,r,r[5],null);return{c(){e=U("h2"),e.textContent="Help",t=oe(),o&&o.c()},m(u,s){W(u,e,s),W(u,t,s),o&&o.m(u,s),n=!0},p(u,s){o&&o.p&&(!n||s&32)&&wn(o,i,u,u[5],n?bn(i,u[5],s,null):xn(u[5]),null)},i(u){n||(N(o,u),n=!0)},o(u){V(o,u),n=!1},d(u){u&&(H(e),H(t)),o&&o.d(u)}}}function fM(r){let e,t,n,i,o,u,s,d;t=new k4({props:{color:r[0]}});function p(_){r[4](_)}let g={$$slots:{default:[cM]},$$scope:{ctx:r}};return r[1]!==void 0&&(g.show=r[1]),i=new Dg({props:g}),dn.push(()=>Dn(i,"show",p)),{c(){e=U("button"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),he(e,"class","icon-btn help svelte-my65h"),he(e,"title","Help")},m(_,x){W(_,e,x),ae(t,e,null),W(_,n,x),ae(i,_,x),u=!0,s||(d=It(e,"click",Ef(r[3])),s=!0)},p(_,[x]){const C={};x&1&&(C.color=_[0]),t.$set(C);const M={};x&32&&(M.$$scope={dirty:x,ctx:_}),!o&&x&2&&(o=!0,M.show=_[1],zn(()=>o=!1)),i.$set(M)},i(_){u||(N(t.$$.fragment,_),N(i.$$.fragment,_),u=!0)},o(_){V(t.$$.fragment,_),V(i.$$.fragment,_),u=!1},d(_){_&&(H(e),H(n)),le(t),le(i,_),s=!1,d()}}}function hM(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:u="black"}=e;const s=()=>t(1,o=!0);function d(p){o=p,t(1,o)}return r.$$set=p=>{"color"in p&&t(0,u=p.color),"$$scope"in p&&t(5,i=p.$$scope)},[u,o,n,s,d,i]}class r_ extends Lt{constructor(e){super(),Et(this,e,hM,fM,Tt,{color:0})}}function dM(r){let e,t,n,i;const o=r[1].default,u=vn(o,r,r[0],null);return{c(){e=U("a"),u&&u.c(),he(e,"href","#")},m(s,d){W(s,e,d),u&&u.m(e,null),t=!0,n||(i=It(e,"click",Ag(r[2])),n=!0)},p(s,[d]){u&&u.p&&(!t||d&1)&&wn(u,o,s,s[0],t?bn(o,s[0],d,null):xn(s[0]),null)},i(s){t||(N(u,s),t=!0)},o(s){V(u,s),t=!1},d(s){s&&H(e),u&&u.d(s),n=!1,i()}}}function pM(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(u){Pn.call(this,r,u)}return r.$$set=u=>{"$$scope"in u&&t(0,i=u.$$scope)},[i,n,o]}class ah extends Lt{constructor(e){super(),Et(this,e,pM,dM,Tt,{})}}function Vy(r){let e,t,n,i=r[1]!=null&&qy(r);return{c(){e=U("div"),t=Ee(r[0]),n=oe(),i&&i.c(),he(e,"class","cover svelte-1w7hi45")},m(o,u){W(o,e,u),F(e,t),F(e,n),i&&i.m(e,null)},p(o,u){u&1&&St(t,o[0]),o[1]!=null?i?i.p(o,u):(i=qy(o),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(o){o&&H(e),i&&i.d()}}}function qy(r){let e,t;return{c(){e=U("div"),t=U("progress"),t.value=r[1],Qe(t,"width","100%")},m(n,i){W(n,e,i),F(e,t)},p(n,i){i&2&&(t.value=n[1])},d(n){n&&H(e)}}}function mM(r){let e,t=r[0]&&Vy(r);return{c(){t&&t.c(),e=tr()},m(n,i){t&&t.m(n,i),W(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=Vy(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:at,o:at,d(n){n&&H(e),t&&t.d(n)}}}function gM(r,e,t){let{loading:n}=e,{progress:i=null}=e,o,u;return r.$$set=s=>{"loading"in s&&t(0,n=s.loading),"progress"in s&&t(1,i=s.progress)},r.$$.update=()=>{if(r.$$.dirty&13){if(n&&!o)t(2,o=Date.now()),t(3,u=n);else if(!n&&o){const s=Date.now()-o;console.log(`Loading "${u}" took ${s}ms`),t(2,o=void 0)}}},[n,i,o,u]}class lh extends Lt{constructor(e){super(),Et(this,e,gM,mM,Tt,{loading:0,progress:1})}}function _r(r){var e;switch(r){case"title":return"Choose project";case"new-project":return"New project";case"pick-neighbourhood":return((e=gi(c4))==null?void 0:e.project_name)||"Pick neighbourhood";case"set-boundary":return"Adjust boundary";case"add-neighbourhood":return"Add a neighbourhood";case"neighbourhood":return gi(za)||"Editing";case"view-shortcuts":return"Shortcuts";case"impact-one-destination":return"Impact on one destination";case"route":return"Route";case"predict-impact":return"Predict impact";case"impact-detail":return"Impact detail";case"debug-intersections":return"Debug intersections";case"debug-neighbourhood":return"Debug neighbourhood";case"debug-demand":return"Explore origin/destination demand data"}}function _M(r){let e,t=_r(r[0].mode)+"",n;return{c(){e=U("span"),n=Ee(t),he(e,"class","page-title svelte-1o8s136")},m(i,o){W(i,e,o),F(e,n)},p(i,o){o&1&&t!==(t=_r(i[0].mode)+"")&&St(n,t)},d(i){i&&H(e)}}}function yM(r){let e;const t=r[3].default,n=vn(t,r,r[5],null),i=n||_M(r);return{c(){i&&i.c()},m(o,u){i&&i.m(o,u),e=!0},p(o,u){n?n.p&&(!e||u&32)&&wn(n,t,o,o[5],e?bn(t,o[5],u,null):xn(o[5]),null):i&&i.p&&(!e||u&1)&&i.p(o,e?u:-1)},i(o){e||(N(i,o),e=!0)},o(o){V(i,o),e=!1},d(o){i&&i.d(o)}}}function vM(r){let e,t;return e=new ah({props:{$$slots:{default:[yM]},$$scope:{ctx:r}}}),e.$on("click",r[4]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function bM(r,e,t){let n;ct(r,er,p=>t(2,n=p));let{$$slots:i={},$$scope:o}=e,{mode:u}=e,{afterLink:s=void 0}=e;const d=()=>{ln(er,n=u,n),s&&s()};return r.$$set=p=>{"mode"in p&&t(0,u=p.mode),"afterLink"in p&&t(1,s=p.afterLink),"$$scope"in p&&t(5,o=p.$$scope)},[u,s,n,i,d,o]}class On extends Lt{constructor(e){super(),Et(this,e,bM,vM,Tt,{mode:0,afterLink:1})}}function wM(r){let e,t,n,i,o,u=r[0]+1+"",s,d,p=r[1].length+"",g,_,x,C,M,P,A;return{c(){e=U("div"),t=U("button"),n=Ee("Previous"),o=oe(),s=Ee(u),d=Ee(" / "),g=Ee(p),_=oe(),x=U("button"),C=Ee("Next"),t.disabled=i=r[0]==0,he(t,"data-tippy-content","Left"),x.disabled=M=r[0]==r[1].length-1,he(x,"data-tippy-content","Right"),Qe(e,"display","flex"),Qe(e,"justify-content","space-between"),Qe(e,"align-items","center")},m(L,I){W(L,e,I),F(e,t),F(t,n),F(e,o),F(e,s),F(e,d),F(e,g),F(e,_),F(e,x),F(x,C),P||(A=[It(window,"keydown",r[2]),It(t,"click",r[3]),It(x,"click",r[4])],P=!0)},p(L,[I]){I&1&&i!==(i=L[0]==0)&&(t.disabled=i),I&1&&u!==(u=L[0]+1+"")&&St(s,u),I&2&&p!==(p=L[1].length+"")&&St(g,p),I&3&&M!==(M=L[0]==L[1].length-1)&&(x.disabled=M)},i:at,o:at,d(L){L&&H(e),P=!1,cr(A)}}}function xM(r,e,t){let n;ct(r,as,p=>t(5,n=p));let{list:i}=e,{idx:o=0}=e;Ss(()=>{n==null||n.keyboard.disable(),g2()}),ri(()=>{n==null||n.keyboard.enable()});function u(p){p.key=="ArrowLeft"&&(p.stopPropagation(),s()),p.key=="ArrowRight"&&(p.stopPropagation(),d())}function s(){o!=0&&t(0,o--,o)}function d(){o!=i.length-1&&t(0,o++,o)}return r.$$set=p=>{"list"in p&&t(1,i=p.list),"idx"in p&&t(0,o=p.idx)},[o,i,u,s,d]}class cp extends Lt{constructor(e){super(),Et(this,e,xM,wM,Tt,{list:1,idx:0})}}function Hy(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function Wy(r){let e,t,n,i,o=r[4]+"",u,s;return{c(){e=U("div"),t=U("span"),i=oe(),u=Ee(o),s=oe(),he(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),Qe(t,"background",r[5]),Qe(e,"display","flex"),Qe(e,"align-items","center"),Qe(e,"gap","6px")},m(d,p){W(d,e,p),F(e,t),F(e,i),F(e,u),F(e,s)},p(d,p){p&2&&n!==(n="color-swatch "+d[1]+" svelte-1enycr6")&&he(t,"class",n),p&1&&Qe(t,"background",d[5]),p&1&&o!==(o=d[4]+"")&&St(u,o)},d(d){d&&H(e)}}}function kM(r){let e,t=$n(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=Wy(Hy(r,t,i));return{c(){e=U("div");for(let i=0;i<n.length;i+=1)n[i].c();Qe(e,"display","grid"),Qe(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),Qe(e,"gap","10px")},m(i,o){W(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){if(o&3){t=$n(Object.entries(i[0]));let u;for(u=0;u<t.length;u+=1){const s=Hy(i,t,u);n[u]?n[u].p(s,o):(n[u]=Wy(s),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}},i:at,o:at,d(i){i&&H(e),_i(n,i)}}}function SM(r,e,t){let{labelColors:n}=e,{swatchClass:i="rectangle"}=e,{itemsPerRow:o=2}=e,u=`${100/o}%`;return r.$$set=s=>{"labelColors"in s&&t(0,n=s.labelColors),"swatchClass"in s&&t(1,i=s.swatchClass),"itemsPerRow"in s&&t(3,o=s.itemsPerRow)},[n,i,u,o]}class i_ extends Lt{constructor(e){super(),Et(this,e,SM,kM,Tt,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function Gy(r,e,t){const n=r.slice();return n[6]=e[t],n}function Zy(r,e,t){const n=r.slice();return n[9]=e[t],n}function Ky(r){let e,t;return{c(){e=U("span"),t=Ee(""),he(e,"class","bucket svelte-3plrz9"),Qe(e,"background",r[9])},m(n,i){W(n,e,i),F(e,t)},p(n,i){i&1&&Qe(e,"background",n[9])},d(n){n&&H(e)}}}function Xy(r){let e;return{c(){e=U("span"),e.textContent=`${r[6]}`,he(e,"class","svelte-3plrz9")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function TM(r){let e,t,n,i,o=$n(r[0]),u=[];for(let p=0;p<o.length;p+=1)u[p]=Ky(Zy(r,o,p));let s=$n(r[3]),d=[];for(let p=0;p<s.length;p+=1)d[p]=Xy(Gy(r,s,p));return{c(){e=U("div"),t=U("div");for(let p=0;p<u.length;p+=1)u[p].c();n=oe(),i=U("div");for(let p=0;p<d.length;p+=1)d[p].c();he(t,"class","colors svelte-3plrz9"),he(i,"class","labels svelte-3plrz9"),he(e,"class","svelte-3plrz9"),Gt(e,"full-width-bucket-legend",r[2]),Gt(e,"bucketed",r[1].hasOwnProperty("buckets")),Gt(e,"limits",r[1].hasOwnProperty("limits"))},m(p,g){W(p,e,g),F(e,t);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(t,null);F(e,n),F(e,i);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(i,null)},p(p,[g]){if(g&1){o=$n(p[0]);let _;for(_=0;_<o.length;_+=1){const x=Zy(p,o,_);u[_]?u[_].p(x,g):(u[_]=Ky(x),u[_].c(),u[_].m(t,null))}for(;_<u.length;_+=1)u[_].d(1);u.length=o.length}if(g&8){s=$n(p[3]);let _;for(_=0;_<s.length;_+=1){const x=Gy(p,s,_);d[_]?d[_].p(x,g):(d[_]=Xy(x),d[_].c(),d[_].m(i,null))}for(;_<d.length;_+=1)d[_].d(1);d.length=s.length}g&4&&Gt(e,"full-width-bucket-legend",p[2]),g&2&&Gt(e,"bucketed",p[1].hasOwnProperty("buckets")),g&2&&Gt(e,"limits",p[1].hasOwnProperty("limits"))},i:at,o:at,d(p){p&&H(e),_i(u,p),_i(d,p)}}}function CM(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:u=!1}=e,s=[];"limits"in i?s=i.limits:s=i.buckets;let d=s.map(p=>typeof p=="number"?o>0?p.toFixed(o):p.toLocaleString():p);return r.$$set=p=>{"colorScale"in p&&t(0,n=p.colorScale),"labels"in p&&t(1,i=p.labels),"decimalPlaces"in p&&t(4,o=p.decimalPlaces),"fullWidthBucketLegend"in p&&t(2,u=p.fullWidthBucketLegend)},[n,i,u,d,o]}class Vo extends Lt{constructor(e){super(),Et(this,e,CM,TM,Tt,{colorScale:0,labels:1,decimalPlaces:4,fullWidthBucketLegend:2})}}function MM(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:EM}=Gb;function LM(r){let e,t;return e=new V4({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function IM(r){let e,t;return e=new $4({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Yy(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I;return A=Pg(r[9][0]),{c(){e=U("div"),t=Ee(`Click the map to see street view
      `),n=U("br"),i=oe(),o=U("br"),u=oe(),s=U("b"),s.textContent="Street view source",d=oe(),p=U("label"),g=U("input"),_=Ee(`
        Google Street View`),x=oe(),C=U("label"),M=U("input"),P=Ee(`
        Bing Streetside`),he(g,"type","radio"),g.__value="google",Zn(g,g.__value),he(g,"class","svelte-1kgc7zz"),he(p,"class","svelte-1kgc7zz"),he(M,"type","radio"),M.__value="bing",Zn(M,M.__value),he(M,"class","svelte-1kgc7zz"),he(C,"class","svelte-1kgc7zz"),he(e,"class","street-view-control-source svelte-1kgc7zz"),Gt(e,"expanded",r[0]),A.p(g,M)},m($,O){W($,e,O),F(e,t),F(e,n),F(e,i),F(e,o),F(e,u),F(e,s),F(e,d),F(e,p),F(p,g),g.checked=g.__value===r[1],F(p,_),F(e,x),F(e,C),F(C,M),M.checked=M.__value===r[1],F(C,P),L||(I=[It(g,"change",r[8]),It(M,"change",r[10])],L=!0)},p($,O){O&2&&(g.checked=g.__value===$[1]),O&2&&(M.checked=M.__value===$[1]),O&1&&Gt(e,"expanded",$[0])},d($){$&&H(e),A.r(),L=!1,cr(I)}}}function AM(r){let e,t,n,i,o,u,s,d,p;const g=[IM,LM],_=[];function x(M,P){return M[0]?0:1}n=x(r),i=_[n]=g[n](r);let C=r[0]&&Yy(r);return{c(){e=U("button"),t=U("div"),i.c(),o=oe(),C&&C.c(),u=tr(),he(t,"class","ltn-map-btn"),he(e,"title","Street view")},m(M,P){W(M,e,P),F(e,t),_[n].m(t,null),W(M,o,P),C&&C.m(M,P),W(M,u,P),s=!0,d||(p=It(e,"click",r[7]),d=!0)},p(M,P){let A=n;n=x(M),n!==A&&(Xt(),V(_[A],1,1,()=>{_[A]=null}),Yt(),i=_[n],i||(i=_[n]=g[n](M),i.c()),N(i,1),i.m(t,null)),M[0]?C?C.p(M,P):(C=Yy(M),C.c(),C.m(u.parentNode,u)):C&&(C.d(1),C=null)},i(M){s||(N(i),s=!0)},o(M){V(i),s=!1},d(M){M&&(H(e),H(o),H(u)),_[n].d(),C&&C.d(M),d=!1,p()}}}function PM(r){let e,t,n,i;return e=new Tw({props:{$$slots:{default:[AM]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=It(EM,"keydown",r[4]),n=!0)},p(o,[u]){const s={};u&16387&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}function zM(r,e,t){let n;ct(r,Rd,L=>t(12,n=L));let{map:i}=e,{maptilerBasemap:o}=e,u=!1,s="google",d=[];function p(){ln(Rd,n=!1,n),i.on("click",_),i.getCanvas().style.cursor="crosshair";for(let L of MM(i,o))d.push([L,i.getPaintProperty(L,"line-color")]),i.setPaintProperty(L,"line-color","cyan")}function g(){ln(Rd,n=!0,n),i.off("click",_),i.getCanvas().style.cursor="inherit";for(let[L,I]of d)i.setPaintProperty(L,"line-color",I);d=[]}ri(g);function _(L){let I=L.lngLat.lng,$=L.lngLat.lat;s=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${$},${I}&cbp=11,0,0,0,0`,"_blank"):s=="bing"&&window.open(`https://www.bing.com/maps?cp=${$}~${I}&style=x`,"_blank")}function x(L){!n&&L.key=="Escape"&&(L.stopPropagation(),g())}const C=[[]],M=()=>{t(0,u=!u),u?p():g()};function P(){s=this.__value,t(1,s)}function A(){s=this.__value,t(1,s)}return r.$$set=L=>{"map"in L&&t(5,i=L.map),"maptilerBasemap"in L&&t(6,o=L.maptilerBasemap)},[u,s,p,g,x,i,o,M,P,C,A]}class DM extends Lt{constructor(e){super(),Et(this,e,zM,PM,Tt,{map:5,maptilerBasemap:6})}}function _n(r,e=!0){return{id:r,beforeId:RM(r),eventsIfTopMost:e}}function RM(r){let e=gi(as);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=Jy.length-1;i>=0;i--){let o=Jy[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Fm=r=>r,Om=r=>r;const Jy=[Fm(Om("Background")),"neighbourhood-boundaries",Fm("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","main-roads-outlines","main-roads","interior-roads-outlines","interior-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","border-entries","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",Om("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","debug-demand-fill","debug-demand-outline","one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19",Om("Road labels"),Fm("road_label"),"animate-shortcuts","modal-filters","turn-restrictions","turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let u2=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],c2=[20,30,40,50,60,70],Bl=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],fp=Bl,hp=[0,20,40,60,80,100],dp=Bl.toReversed(),pp=[0,1300,3e3,4200,5900,52e3],Fd=Bl.toReversed(),FM=[0,.3,.6,1,1.5,2],OM=Bl.toReversed(),f2=[0,1,10,50,100,1e3],h2=Bl.toReversed(),d2=[0,1,10,50,100,1e3],p2=Bl.toReversed(),mp=[0,20,40,60,80,100],gp=Bl;function m2(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const $M="#0C793A",vo={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function g2(){sh("[data-tippy-content]")}function ra(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,1.5+r,14,4+r,16,7+r,20,24+r]}function ja(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function Ua(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function ac(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function $f(r){return r?gi(ks)=="cnt"?cg(r,"LAD_"):r:"custom area"}function _2(r){let e=gi(Ga).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;ip(n,JSON.stringify(e))}function ug(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function Pa(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function Qy(r){return r.reduce((e,t)=>e+t,0)}function cg(r,e){return r.startsWith(e)?r.slice(e.length):r}function e1(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}function BM(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function NM(r){let e,t;const n=[_n("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":ra(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&1?An(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function jM(r){let e,t,n,i,o;function u(d){r[1](d)}let s={label:"Bus routes",$$slots:{help:[BM]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new rh({props:{url:`pmtiles://${Bo("cnt_layers/bus_routes.pmtiles")}`,$$slots:{default:[NM]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),W(d,n,p),ae(i,d,p),o=!0},p(d,[p]){const g={};p&4&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],zn(()=>t=!1)),e.$set(g);const _={};p&5&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&H(n),le(e,d),le(i,d)}}}function UM(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class VM extends Lt{constructor(e){super(),Et(this,e,UM,jM,Tt,{})}}var qM=Object.defineProperty,y2=r=>{throw TypeError(r)},HM=(r,e,t)=>e in r?qM(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ro=(r,e,t)=>HM(r,typeof e!="symbol"?e+"":e,t),v2=(r,e,t)=>e.has(r)||y2("Cannot "+t),vi=(r,e,t)=>(v2(r,e,"read from private field"),t?t.call(r):e.get(r)),t1=(r,e,t)=>e.has(r)?y2("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),n1=(r,e,t,n)=>(v2(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t);function Ur(){}function WM(r,e){for(const t in e)r[t]=e[t];return r}function b2(r){return r()}function r1(){return Object.create(null)}function ha(r){r.forEach(b2)}function w2(r){return typeof r=="function"}function Xa(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}let kd;function Yi(r,e){return r===e?!0:(kd||(kd=document.createElement("a")),kd.href=e,r===kd.href)}function GM(r){return Object.keys(r).length===0}function ZM(r,e,t,n){if(r){const i=x2(r,e,t,n);return r[0](i)}}function x2(r,e,t,n){return r[1]&&n?WM(t.ctx.slice(),r[1](n(e))):t.ctx}function KM(r,e,t,n){if(r[2]&&n){const i=r[2](n(t));if(e.dirty===void 0)return i;if(typeof i=="object"){const o=[],u=Math.max(e.dirty.length,i.length);for(let s=0;s<u;s+=1)o[s]=e.dirty[s]|i[s];return o}return e.dirty|i}return e.dirty}function XM(r,e,t,n,i,o){if(i){const u=x2(e,t,n,o);r.p(u,i)}}function YM(r){if(r.ctx.length>32){const e=[],t=r.ctx.length/32;for(let n=0;n<t;n++)e[n]=-1;return e}return-1}function i1(r){return r??""}function nr(r,e){r.appendChild(e)}function Hr(r,e,t){r.insertBefore(e,t||null)}function Vr(r){r.parentNode&&r.parentNode.removeChild(r)}function xr(r){return document.createElement(r)}function xs(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Va(r){return document.createTextNode(r)}function $o(){return Va(" ")}function JM(){return Va("")}function uo(r,e,t,n){return r.addEventListener(e,t,n),()=>r.removeEventListener(e,t,n)}function QM(r){return function(e){return e.preventDefault(),r.call(this,e)}}function Mt(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function e6(r){return Array.from(r.childNodes)}function Gf(r,e){e=""+e,r.data!==e&&(r.data=e)}function o1(r,e){r.value=e??""}function rs(r,e,t){r.classList.toggle(e,!!t)}function t6(r,e,{bubbles:t=!1,cancelable:n=!1}={}){return new CustomEvent(r,{detail:e,bubbles:t,cancelable:n})}let Zf;function Bf(r){Zf=r}function k2(){if(!Zf)throw new Error("Function called outside component initialization");return Zf}function n6(r){k2().$$.on_destroy.push(r)}function r6(){const r=k2();return(e,t,{cancelable:n=!1}={})=>{const i=r.$$.callbacks[e];if(i){const o=t6(e,t,{cancelable:n});return i.slice().forEach(u=>{u.call(r,o)}),!o.defaultPrevented}return!0}}function s1(r,e){const t=r.$$.callbacks[e.type];t&&t.slice().forEach(n=>n.call(this,e))}const Gu=[],fg=[];let Ju=[];const a1=[],i6=Promise.resolve();let hg=!1;function o6(){hg||(hg=!0,i6.then(S2))}function dg(r){Ju.push(r)}const $m=new Set;let Uu=0;function S2(){if(Uu!==0)return;const r=Zf;do{try{for(;Uu<Gu.length;){const e=Gu[Uu];Uu++,Bf(e),s6(e.$$)}}catch(e){throw Gu.length=0,Uu=0,e}for(Bf(null),Gu.length=0,Uu=0;fg.length;)fg.pop()();for(let e=0;e<Ju.length;e+=1){const t=Ju[e];$m.has(t)||($m.add(t),t())}Ju.length=0}while(Gu.length);for(;a1.length;)a1.pop()();hg=!1,$m.clear(),Bf(r)}function s6(r){if(r.fragment!==null){r.update(),ha(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(dg)}}function a6(r){const e=[],t=[];Ju.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Ju=e}const Od=new Set;let Il;function $d(){Il={r:0,c:[],p:Il}}function Bd(){Il.r||ha(Il.c),Il=Il.p}function di(r,e){r&&r.i&&(Od.delete(r),r.i(e))}function Mi(r,e,t,n){if(r&&r.o){if(Od.has(r))return;Od.add(r),Il.c.push(()=>{Od.delete(r),n&&(t&&r.d(1),n())}),r.o(e)}else n&&n()}function l1(r){return(r==null?void 0:r.length)!==void 0?r:Array.from(r)}function l6(r,e){Mi(r,1,1,()=>{e.delete(r.key)})}function u6(r,e,t,n,i,o,u,s,d,p,g,_){let x=r.length,C=o.length,M=x;const P={};for(;M--;)P[r[M].key]=M;const A=[],L=new Map,I=new Map,$=[];for(M=C;M--;){const q=_(i,o,M),Y=t(q);let fe=u.get(Y);fe?$.push(()=>fe.p(q,e)):(fe=p(Y,q),fe.c()),L.set(Y,A[M]=fe),Y in P&&I.set(Y,Math.abs(M-P[Y]))}const O=new Set,Z=new Set;function X(q){di(q,1),q.m(s,g),u.set(q.key,q),g=q.first,C--}for(;x&&C;){const q=A[C-1],Y=r[x-1],fe=q.key,Le=Y.key;q===Y?(g=q.first,x--,C--):L.has(Le)?!u.has(fe)||O.has(fe)?X(q):Z.has(Le)?x--:I.get(fe)>I.get(Le)?(Z.add(fe),X(q)):(O.add(Le),x--):(d(Y,u),x--)}for(;x--;){const q=r[x];L.has(q.key)||d(q,u)}for(;C;)X(A[C-1]);return ha($),A}function qa(r){r&&r.c()}function ca(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),dg(()=>{const o=r.$$.on_mount.map(b2).filter(w2);r.$$.on_destroy?r.$$.on_destroy.push(...o):ha(o),r.$$.on_mount=[]}),i.forEach(dg)}function fa(r,e){const t=r.$$;t.fragment!==null&&(a6(t.after_update),ha(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function c6(r,e){r.$$.dirty[0]===-1&&(Gu.push(r),o6(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function Ya(r,e,t,n,i,o,u=null,s=[-1]){const d=Zf;Bf(r);const p=r.$$={fragment:null,ctx:[],props:o,update:Ur,not_equal:i,bound:r1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:r1(),dirty:s,skip_bound:!1,root:e.target||d.$$.root};u&&u(p.root);let g=!1;if(p.ctx=t?t(r,e.props||{},(_,x,...C)=>{const M=C.length?C[0]:x;return p.ctx&&i(p.ctx[_],p.ctx[_]=M)&&(!p.skip_bound&&p.bound[_]&&p.bound[_](M),g&&c6(r,_)),x}):[],p.update(),g=!0,ha(p.before_update),p.fragment=n?n(p.ctx):!1,e.target){if(e.hydrate){const _=e6(e.target);p.fragment&&p.fragment.l(_),_.forEach(Vr)}else p.fragment&&p.fragment.c();e.intro&&di(r.$$.fragment),ca(r,e.target,e.anchor),S2()}Bf(d)}class Ja{constructor(){Ro(this,"$$"),Ro(this,"$$set")}$destroy(){fa(this,1),this.$destroy=Ur}$on(e,t){if(!w2(t))return Ur;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!GM(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const f6="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(f6);function h6(r){let e,t;return{c(){e=xs("svg"),t=xs("path"),Mt(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Mt(e,"viewBox","0 0 14 14"),Mt(e,"width","13"),Mt(e,"height","13"),Mt(e,"class","svelte-en2qvf")},m(n,i){Hr(n,e,i),nr(e,t)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(e)}}}class T2 extends Ja{constructor(e){super(),Ya(this,e,null,h6,Xa,{})}}function d6(r){let e,t;return{c(){e=xs("svg"),t=xs("path"),Mt(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Mt(e,"viewBox","0 0 30 30"),Mt(e,"fill","none"),Mt(e,"xmlns","http://www.w3.org/2000/svg"),Mt(e,"class","svelte-d2loi5")},m(n,i){Hr(n,e,i),nr(e,t)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(e)}}}class C2 extends Ja{constructor(e){super(),Ya(this,e,null,d6,Xa,{})}}function p6(r){let e,t;return{c(){e=xr("img"),Yi(e.src,t=r[3]+"area.svg")||Mt(e,"src",t),Mt(e,"alt",r[6]),Mt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"area.svg")&&Mt(e,"src",t),i&64&&Mt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function m6(r){let e,t;return{c(){e=xr("img"),Yi(e.src,t=r[3]+"reverse.svg")||Mt(e,"src",t),Mt(e,"alt",r[6]),Mt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"reverse.svg")&&Mt(e,"src",t),i&64&&Mt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function g6(r){let e,t;return{c(){e=xr("img"),Yi(e.src,t=r[3]+"poi.svg")||Mt(e,"src",t),Mt(e,"alt",r[6]),Mt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"poi.svg")&&Mt(e,"src",t),i&64&&Mt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function _6(r){let e,t;return{c(){e=xr("img"),Yi(e.src,t=r[3]+"postal_code.svg")||Mt(e,"src",t),Mt(e,"alt",r[6]),Mt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"postal_code.svg")&&Mt(e,"src",t),i&64&&Mt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function y6(r){let e,t;return{c(){e=xr("img"),Yi(e.src,t=r[3]+"street.svg")||Mt(e,"src",t),Mt(e,"alt",r[6]),Mt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"street.svg")&&Mt(e,"src",t),i&64&&Mt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function v6(r){let e,t;return{c(){e=xr("img"),Yi(e.src,t=r[3]+"road.svg")||Mt(e,"src",t),Mt(e,"alt",r[6]),Mt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"road.svg")&&Mt(e,"src",t),i&64&&Mt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function b6(r){let e,t;return{c(){e=xr("img"),Yi(e.src,t=r[3]+"housenumber.svg")||Mt(e,"src",t),Mt(e,"alt",r[6]),Mt(e,"class","svelte-ltkwvy")},m(n,i){Hr(n,e,i)},p(n,i){i&8&&!Yi(e.src,t=n[3]+"housenumber.svg")&&Mt(e,"src",t),i&64&&Mt(e,"alt",n[6])},d(n){n&&Vr(e)}}}function w6(r){let e,t,n,i;return{c(){e=xr("img"),Yi(e.src,t=r[5])||Mt(e,"src",t),Mt(e,"alt",r[4]),Mt(e,"class","svelte-ltkwvy")},m(o,u){Hr(o,e,u),n||(i=uo(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Yi(e.src,t=o[5])&&Mt(e,"src",t),u&16&&Mt(e,"alt",o[4])},d(o){o&&Vr(e),n=!1,i()}}}function u1(r){let e,t;return{c(){e=xr("span"),t=Va(r[6]),Mt(e,"class","secondary svelte-ltkwvy")},m(n,i){Hr(n,e,i),nr(e,t)},p(n,i){i&64&&Gf(t,n[6])},d(n){n&&Vr(e)}}}function x6(r){let e,t,n,i,o,u,s,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],M,P,A=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",L,I,$;function O(Y,fe){return fe&1&&(t=null),fe&1&&(n=null),fe&1&&(i=null),fe&1&&(o=null),Y[5]?w6:Y[0].address?b6:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?v6:(n==null&&(n=!!Y[0].id.startsWith("address.")),n?y6:(i==null&&(i=!!Y[0].id.startsWith("postal_code.")),i?_6:(o==null&&(o=!!Y[0].id.startsWith("poi.")),o?g6:Y[7]?m6:p6))))}let Z=O(r,-1),X=Z(r),q=C&&u1(r);return{c(){e=xr("li"),X.c(),u=$o(),s=xr("span"),d=xr("span"),p=xr("span"),_=Va(g),x=$o(),q&&q.c(),M=$o(),P=xr("span"),L=Va(A),Mt(p,"class","primary svelte-ltkwvy"),Mt(d,"class","svelte-ltkwvy"),Mt(P,"class","line2 svelte-ltkwvy"),Mt(s,"class","texts svelte-ltkwvy"),Mt(e,"tabindex","0"),Mt(e,"data-selected",r[1]),Mt(e,"class","svelte-ltkwvy"),rs(e,"selected",r[1])},m(Y,fe){Hr(Y,e,fe),X.m(e,null),nr(e,u),nr(e,s),nr(s,d),nr(d,p),nr(p,_),nr(d,x),q&&q.m(d,null),nr(s,M),nr(s,P),nr(P,L),I||($=[uo(e,"mouseenter",r[12]),uo(e,"focus",r[13])],I=!0)},p(Y,[fe]){Z===(Z=O(Y,fe))&&X?X.p(Y,fe):(X.d(1),X=Z(Y),X&&(X.c(),X.m(e,u))),fe&1&&g!==(g=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&Gf(_,g),fe&37&&(C=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),C?q?q.p(Y,fe):(q=u1(Y),q.c(),q.m(d,null)):q&&(q.d(1),q=null),fe&1&&A!==(A=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&Gf(L,A),fe&2&&Mt(e,"data-selected",Y[1]),fe&2&&rs(e,"selected",Y[1])},i:Ur,o:Ur,d(Y){Y&&Vr(e),X.d(),q&&q.d(),I=!1,ha($)}}}function k6(r,e,t){var n;let i,o,{feature:u}=e,{selected:s=!1}=e,{showPlaceType:d}=e,{missingIconsCache:p}=e,{iconsBaseUrl:g}=e;const _=(n=u.properties)==null?void 0:n.categories;let x,C,M=0,P=u.place_type[0]==="reverse";function A(){C&&p.add(C),t(10,M++,M)}function L(O){s1.call(this,r,O)}function I(O){s1.call(this,r,O)}const $=()=>A();return r.$$set=O=>{"feature"in O&&t(0,u=O.feature),"selected"in O&&t(1,s=O.selected),"showPlaceType"in O&&t(2,d=O.showPlaceType),"missingIconsCache"in O&&t(9,p=O.missingIconsCache),"iconsBaseUrl"in O&&t(3,g=O.iconsBaseUrl)},r.$$.update=()=>{var O,Z,X,q;if(r.$$.dirty&3640)do t(11,i--,i),t(4,x=_==null?void 0:_[i]),t(5,C=x?g+x.replace(/ /g,"_")+".svg":void 0);while(i>-1&&(!C||p.has(C)));r.$$.dirty&1&&t(6,o=((Z=(O=u.properties)==null?void 0:O.categories)==null?void 0:Z.join(", "))??((q=(X=u.properties)==null?void 0:X.place_type_name)==null?void 0:q[0])??u.place_type[0])},t(11,i=(_==null?void 0:_.length)??0),[u,s,d,g,x,C,o,P,A,p,M,i,L,I,$]}class S6 extends Ja{constructor(e){super(),Ya(this,e,k6,x6,Xa,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function T6(r){let e;return{c(){e=xr("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Mt(e,"class","svelte-7cmwmc")},m(t,n){Hr(t,e,n)},p:Ur,i:Ur,o:Ur,d(t){t&&Vr(e)}}}class C6 extends Ja{constructor(e){super(),Ya(this,e,null,T6,Xa,{})}}function M6(r){let e,t,n;return{c(){e=xs("svg"),t=xs("path"),Mt(t,"stroke-width","4"),Mt(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Mt(t,"class","svelte-gzo3ar"),Mt(e,"width",n=r[0]==="list"?20:void 0),Mt(e,"viewBox","0 0 70 85"),Mt(e,"fill","none"),Mt(e,"class","svelte-gzo3ar"),rs(e,"in-map",r[0]!=="list"),rs(e,"list-icon",r[0]==="list")},m(i,o){Hr(i,e,o),nr(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&Mt(e,"width",n),o&1&&rs(e,"in-map",i[0]!=="list"),o&1&&rs(e,"list-icon",i[0]==="list")},i:Ur,o:Ur,d(i){i&&Vr(e)}}}function E6(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class L6 extends Ja{constructor(e){super(),Ya(this,e,E6,M6,Xa,{displayIn:0})}}function I6(r){let e,t;return{c(){e=xs("svg"),t=xs("path"),Mt(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Mt(e,"viewBox","0 0 60.006 21.412"),Mt(e,"width","14"),Mt(e,"height","20"),Mt(e,"class","svelte-en2qvf")},m(n,i){Hr(n,e,i),nr(e,t)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(e)}}}class A6 extends Ja{constructor(e){super(),Ya(this,e,null,I6,Xa,{})}}function P6(r){let e,t,n;return{c(){e=xs("svg"),t=xs("circle"),n=xs("path"),Mt(t,"cx","4.789"),Mt(t,"cy","4.787"),Mt(t,"r","3.85"),Mt(t,"class","svelte-1aq105l"),Mt(n,"d","M12.063 12.063 7.635 7.635"),Mt(n,"class","svelte-1aq105l"),Mt(e,"xmlns","http://www.w3.org/2000/svg"),Mt(e,"width","13"),Mt(e,"height","13"),Mt(e,"viewBox","0 0 13 13"),Mt(e,"class","svelte-1aq105l")},m(i,o){Hr(i,e,o),nr(e,t),nr(e,n)},p:Ur,i:Ur,o:Ur,d(i){i&&Vr(e)}}}class z6 extends Ja{constructor(e){super(),Ya(this,e,null,P6,Xa,{})}}function D6(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function Qd(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let mf;async function R6(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(mf&&i.cachedLocationExpiry&&mf.time+i.cachedLocationExpiry>Date.now()){if(!mf.coords)break e;return mf.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{s(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(mf={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const F6=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,c1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,f1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,h1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,d1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,p1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function O6(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${u}, ${o} ${s}`);const p=Math.floor(i),g=Math.floor(o),_=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=m1(_,3).toFixed(3).padStart(6,"0"),M=m1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&M.endsWith(".000")&&(C=C.replace(/\.000$/,""),M=M.replace(/\.000$/,"")),d=`${p} ${C}' ${u}, ${g} ${M}' ${s}`}if(r=="DMS"){const C=Math.floor(_),M=Math.floor(x);let P=((_-C)*60).toFixed(1).padStart(4,"0"),A=((x-M)*60).toFixed(1).padStart(4,"0");const L=C.toString().padStart(2,"0"),I=M.toString().padStart(2,"0");P.endsWith(".0")&&A.endsWith(".0")&&(P=P.replace(/\.0$/,""),A=A.replace(/\.0$/,"")),d=`${p} ${L}' ${P}" ${u}, ${g} ${I}' ${A}" ${s}`}return d}else throw new Error("no decimal coordinates to convert")}function m1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function o_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],d=!1;if(F6.test(r))throw new Error("invalid coordinate value");if(c1.test(r))if(s=c1.exec(r),d=gf(s),d)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(f1.test(r))if(s=f1.exec(r),d=gf(s),d){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(h1.test(r))if(s=h1.exec(r),d=gf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(d1.test(r))if(s=d1.exec(r),d=gf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(p1.test(r)){if(s=p1.exec(r),d=gf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let _,x;const C=/[,/;\u0020]/g,M=g.match(C);if(M==null){const L=Math.floor(r.length/2);_=g.substring(0,L).trim(),x=g.substring(L).trim()}else{let L;M.length%2==1?L=Math.floor(M.length/2):L=M.length/2-1;let I=0;if(L==0)I=g.indexOf(M[0]),_=g.substring(0,I).trim(),x=g.substring(I+1).trim();else{let $=0,O=0;for(;$<=L;)I=g.indexOf(M[$],O),O=I+1,$++;_=g.substring(0,I).trim(),x=g.substring(I+1).trim()}}const P=_.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");const A=x.split(".");if(A.length==2&&A[1]==0&&A[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:$6,toCoordinateFormat:O6})}else throw new Error("coordinates pattern match failed")}function gf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],d=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(d||p||g)continue;return!1}}return!0}function g1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function $6(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return g1(this.decimalLatitude,Number(e[0]))&&g1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const B6=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});o_.to=B6;const N6=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],j6={decimalLatitude:40.123,decimalLongitude:-74.123},U6=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],V6=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function q6(){const r=[];return N6.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...j6})}),[...r,...U6,...V6]}const H6=q6();o_.formats=H6.map(r=>r.verbatimCoordinates);const W6=o_;function _1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function y1(r){let e,t;return e=new C6({}),{c(){qa(e.$$.fragment)},m(n,i){ca(e,n,i),t=!0},i(n){t||(di(e.$$.fragment,n),t=!0)},o(n){Mi(e.$$.fragment,n),t=!1},d(n){fa(e,n)}}}function v1(r){let e,t,n,i,o;return t=new A6({}),{c(){e=xr("button"),qa(t.$$.fragment),Mt(e,"type","button"),Mt(e,"title",r[9]),Mt(e,"class","svelte-bz0zu3"),rs(e,"active",r[0])},m(u,s){Hr(u,e,s),ca(t,e,null),n=!0,i||(o=uo(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&Mt(e,"title",u[9]),(!n||s[0]&1)&&rs(e,"active",u[0])},i(u){n||(di(t.$$.fragment,u),n=!0)},o(u){Mi(t.$$.fragment,u),n=!1},d(u){u&&Vr(e),fa(t),i=!1,o()}}}function G6(r){let e,t=[],n=new Map,i,o,u,s=l1(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=_1(r,s,p),_=d(g);n.set(_,t[p]=b1(_,g))}return{c(){e=xr("ul");for(let p=0;p<t.length;p+=1)t[p].c();Mt(e,"class","options svelte-bz0zu3")},m(p,g){Hr(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(u=[uo(e,"mouseleave",r[73]),uo(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=l1(p[14]),$d(),t=u6(t,g,d,1,p,s,n,e,l6,b1,null,_1),Bd())},i(p){if(!i){for(let g=0;g<s.length;g+=1)di(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)Mi(t[g]);i=!1},d(p){p&&Vr(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,ha(u)}}}function Z6(r){let e,t,n,i,o,u;return t=new C2({}),{c(){e=xr("div"),qa(t.$$.fragment),n=$o(),i=xr("div"),o=Va(r[7]),Mt(i,"class","svelte-bz0zu3"),Mt(e,"class","no-results svelte-bz0zu3")},m(s,d){Hr(s,e,d),ca(t,e,null),nr(e,n),nr(e,i),nr(i,o),u=!0},p(s,d){(!u||d[0]&128)&&Gf(o,s[7])},i(s){u||(di(t.$$.fragment,s),u=!0)},o(s){Mi(t.$$.fragment,s),u=!1},d(s){s&&Vr(e),fa(t)}}}function K6(r){let e="",t;return{c(){t=Va(e)},m(n,i){Hr(n,t,i)},p:Ur,i:Ur,o:Ur,d(n){n&&Vr(t)}}}function X6(r){let e,t,n,i,o,u,s,d,p,g,_;return t=new C2({}),d=new T2({}),{c(){e=xr("div"),qa(t.$$.fragment),n=$o(),i=xr("div"),o=Va(r[6]),u=$o(),s=xr("button"),qa(d.$$.fragment),Mt(i,"class","svelte-bz0zu3"),Mt(s,"class","svelte-bz0zu3"),Mt(e,"class","error svelte-bz0zu3")},m(x,C){Hr(x,e,C),ca(t,e,null),nr(e,n),nr(e,i),nr(i,o),nr(e,u),nr(e,s),ca(d,s,null),p=!0,g||(_=uo(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&Gf(o,x[6])},i(x){p||(di(t.$$.fragment,x),di(d.$$.fragment,x),p=!0)},o(x){Mi(t.$$.fragment,x),Mi(d.$$.fragment,x),p=!1},d(x){x&&Vr(e),fa(t),fa(d),g=!1,_()}}}function b1(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new S6({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=JM(),qa(n.$$.fragment),this.first=t},m(s,d){Hr(s,t,d),ca(n,s,d),i=!0},p(s,d){e=s;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(di(n.$$.fragment,s),i=!0)},o(s){Mi(n.$$.fragment,s),i=!1},d(s){s&&Vr(t),fa(n,s)}}}function Y6(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z,X=!1;o=new z6({}),_=new T2({});let q=r[19]&&y1(),Y=r[5]==="button"&&v1(r);const fe=r[61].default,Le=ZM(fe,r,r[60],null),ee=[X6,K6,Z6,G6],ie=[];function ve(ye,it){var Fe,Ne;return ye[18]?0:ye[16]?((Fe=ye[14])==null?void 0:Fe.length)===0?2:ye[16]&&(Ne=ye[14])!=null&&Ne.length?3:-1:1}return~(A=ve(r))&&(L=ie[A]=ee[A](r)),{c(){e=$o(),t=xr("form"),n=xr("div"),i=xr("button"),qa(o.$$.fragment),u=$o(),s=xr("input"),d=$o(),p=xr("div"),g=xr("button"),qa(_.$$.fragment),x=$o(),q&&q.c(),C=$o(),Y&&Y.c(),M=$o(),Le&&Le.c(),P=$o(),L&&L.c(),Mt(i,"class","search-button svelte-bz0zu3"),Mt(i,"type","button"),Mt(s,"placeholder",r[8]),Mt(s,"aria-label",r[8]),Mt(s,"class","svelte-bz0zu3"),Mt(g,"type","button"),Mt(g,"title",r[3]),Mt(g,"class","svelte-bz0zu3"),Mt(p,"class","clear-button-container svelte-bz0zu3"),rs(p,"displayable",r[1]!==""),Mt(n,"class","input-group svelte-bz0zu3"),Mt(t,"tabindex","0"),Mt(t,"class",I=i1(r[2])+" svelte-bz0zu3"),rs(t,"can-collapse",r[4]&&r[1]==="")},m(ye,it){Hr(ye,e,it),Hr(ye,t,it),nr(t,n),nr(n,i),ca(o,i,null),nr(n,u),nr(n,s),r[63](s),o1(s,r[1]),nr(n,d),nr(n,p),nr(p,g),ca(_,g,null),nr(p,x),q&&q.m(p,null),nr(n,C),Y&&Y.m(n,null),nr(n,M),Le&&Le.m(n,null),nr(t,P),~A&&ie[A].m(t,null),$=!0,O||(Z=[uo(i,"click",r[62]),uo(s,"input",r[64]),uo(s,"focus",r[65]),uo(s,"blur",r[66]),uo(s,"keydown",r[22]),uo(s,"input",r[67]),uo(g,"click",r[68]),uo(t,"submit",QM(r[21]))],O=!0)},p(ye,it){(!$||it[0]&256)&&Mt(s,"placeholder",ye[8]),(!$||it[0]&256)&&Mt(s,"aria-label",ye[8]),it[0]&2&&s.value!==ye[1]&&o1(s,ye[1]),(!$||it[0]&8)&&Mt(g,"title",ye[3]),ye[19]?q?it[0]&524288&&di(q,1):(q=y1(),q.c(),di(q,1),q.m(p,null)):q&&($d(),Mi(q,1,1,()=>{q=null}),Bd()),(!$||it[0]&2)&&rs(p,"displayable",ye[1]!==""),ye[5]==="button"?Y?(Y.p(ye,it),it[0]&32&&di(Y,1)):(Y=v1(ye),Y.c(),di(Y,1),Y.m(n,M)):Y&&($d(),Mi(Y,1,1,()=>{Y=null}),Bd()),Le&&Le.p&&(!$||it[1]&536870912)&&XM(Le,fe,ye,ye[60],$?KM(fe,ye[60],it,null):YM(ye[60]),null);let Fe=A;A=ve(ye),A===Fe?~A&&ie[A].p(ye,it):(L&&($d(),Mi(ie[Fe],1,1,()=>{ie[Fe]=null}),Bd()),~A?(L=ie[A],L?L.p(ye,it):(L=ie[A]=ee[A](ye),L.c()),di(L,1),L.m(t,null)):L=null),(!$||it[0]&4&&I!==(I=i1(ye[2])+" svelte-bz0zu3"))&&Mt(t,"class",I),(!$||it[0]&22)&&rs(t,"can-collapse",ye[4]&&ye[1]==="")},i(ye){$||(di(X),di(o.$$.fragment,ye),di(_.$$.fragment,ye),di(q),di(Y),di(Le,ye),di(L),$=!0)},o(ye){Mi(X),Mi(o.$$.fragment,ye),Mi(_.$$.fragment,ye),Mi(q),Mi(Y),Mi(Le,ye),Mi(L),$=!1},d(ye){ye&&(Vr(e),Vr(t)),fa(o),r[63](null),fa(_),q&&q.d(),Y&&Y.d(),Le&&Le.d(ye),~A&&ie[A].d(),O=!1,ha(Z)}}}function J6(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:M=void 0}=e,{debounceSearch:P=200}=e,{enableReverse:A="never"}=e,{errorMessage:L="Something went wrong"}=e,{filter:I=()=>!0}=e,{flyTo:$=!0}=e,{fuzzyMatch:O=!0}=e,{language:Z=void 0}=e,{limit:X=void 0}=e,{mapController:q=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:fe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Le="Search"}=e,{proximity:ee=[{type:"server-geolocation"}]}=e,{reverseActive:ie=A==="always"}=e,{reverseButtonTitle:ve="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{pickedResultStyle:it="full-geometry"}=e,{showPlaceType:Fe="if-needed"}=e,{showResultsWhileTyping:Ne=!0}=e,{selectFirst:Ae=!0}=e,{flyToSelected:ot=!1}=e,{markerOnSelected:Ye=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:pt=!1}=e,{excludeTypes:_t=!1}=e,{zoom:He=s}=e,{apiUrl:mt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Pt={}}=e,{iconsBaseUrl:jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:un=()=>{}}=e;function nn(){Xe.focus()}function rn(){Xe.blur()}function pn(re,Je=!0,et=!1){t(1,ye=re),Je?(t(15,lt=-1),xt()):(bt(!et,et),setTimeout(()=>{Xe.focus(),Xe.select()}))}function yn(){t(14,Ke=void 0),t(56,pe=void 0),t(15,lt=-1)}function qe(){t(55,kt=[]),t(56,pe=void 0)}let We=!1,Ke,kt,pe,fn="",Xe,lt=-1,Wt,Xn=[],Wn,fr,Tr,Cr;const xi=new Set,Un=r6();n6(()=>{q&&(q.setEventHandler(void 0),q.indicateReverse(!1),q.setSelectedMarker(-1),q.setFeatures(void 0,void 0,!1))});function xt(re){if(fr&&(clearTimeout(fr),fr=void 0),lt>-1&&Ke)t(56,pe=Ke[lt]),t(1,ye=pe.place_type[0]==="reverse"?pe.place_name:pe.place_name.replace(/,.*/,"")),t(18,Wt=void 0),t(55,kt=void 0),t(15,lt=-1);else if(ye){const Je=re||!Pr(ye);vr(ye,{exact:!0}).then(()=>{t(55,kt=Ke),t(56,pe=void 0),Je&&Ri()}).catch(et=>t(18,Wt=et))}}function Pr(re){try{return W6(re,6)}catch{return!1}}async function vr(re,{byId:Je=!1,exact:et=!1}={}){t(18,Wt=void 0),Wn==null||Wn.abort();const nt=new AbortController;t(19,Wn=nt);try{const ht=Pr(re),Dt=new URLSearchParams;if(Z!==void 0&&Dt.set("language",Array.isArray(Z)?Z.join(","):Z??""),ut&&Dt.set("types",ut.join(",")),_t&&Dt.set("excludeTypes",String(_t)),g&&Dt.set("bbox",g.map(Nn=>Nn.toFixed(6)).join(",")),M&&Dt.set("country",Array.isArray(M)?M.join(","):M),!Je&&!ht){const Nn=await R6(q,ee,nt);Nn&&Dt.set("proximity",Nn),(et||!Ne)&&Dt.set("autocomplete","false"),Dt.set("fuzzyMatch",String(O))}X!==void 0&&(pt||!ht||(ut==null?void 0:ut.length)===1)&&Dt.set("limit",String(X)),Dt.set("key",p),un(Dt);const en=mt+"/"+encodeURIComponent(ht?ht.decimalLongitude+","+ht.decimalLatitude:re)+".json?"+Dt.toString();if(en===fn){Je?(t(14,Ke=void 0),t(56,pe=Xn[0])):t(14,Ke=Xn);return}fn=en;const mn=await fetch(en,{signal:nt.signal,...Pt});if(!mn.ok)throw new Error(await mn.text());const Cn=await mn.json();Un("response",{url:en,featureCollection:Cn}),Je?(t(14,Ke=void 0),t(56,pe=Cn.features[0]),Xn=[pe]):(t(14,Ke=Cn.features.filter(I)),ht&&Ke.unshift({type:"Feature",properties:{},id:"reverse_"+ht.decimalLongitude+"_"+ht.decimalLatitude,text:ht.decimalLatitude+", "+ht.decimalLongitude,place_name:ht.decimalLatitude+", "+ht.decimalLongitude,place_type:["reverse"],center:[ht.decimalLongitude,ht.decimalLatitude],bbox:[ht.decimalLongitude,ht.decimalLatitude,ht.decimalLongitude,ht.decimalLatitude],geometry:{type:"Point",coordinates:[ht.decimalLongitude,ht.decimalLatitude]}}),Xn=Ke,ht&&Xe.focus())}catch(ht){if(ht&&typeof ht=="object"&&"name"in ht&&ht.name==="AbortError")return;throw ht}finally{nt===Wn&&t(19,Wn=void 0)}}function Ri(){var re;if(!(kt!=null&&kt.length)||!$)return;const Je=[180,90,-180,-90],et=!kt.some(ht=>!ht.matching_text);let nt;for(const ht of kt){const Dt=Bn(ht);if(nt=nt===void 0?Dt:Dt===void 0?nt:Math.max(nt,Dt),et||!ht.matching_text)for(const en of[0,1,2,3])Je[en]=Math[en<2?"min":"max"](Je[en],((re=ht.bbox)==null?void 0:re[en])??ht.center[en%2])}q&&kt.length>0&&(pe&&Je[0]===Je[2]&&Je[1]===Je[3]?q.flyTo(pe.center,Bn(pe)):q.fitBounds(Qd(Je),50,nt))}function Bn(re){var Je;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const et=re.id.replace(/\..*/,"");return(Array.isArray((Je=re.properties)==null?void 0:Je.categories)?re.properties.categories.reduce((nt,ht)=>{const Dt=He[et+"."+ht];return nt===void 0?Dt:Dt===void 0?nt:Math.max(nt,Dt)},void 0):void 0)??He[et]}function Oe(re){t(0,ie=A==="always"),t(14,Ke=void 0),t(56,pe=void 0),t(15,lt=-1),pn(re[1].toFixed(6)+", "+D6(re[0],[-180,180],!0).toFixed(6),!1,!0)}function yt(re){if(!Ke)return;let Je=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;Je&&(lt===(Ae?0:-1)&&Je===-1&&t(15,lt=Ke.length),t(15,lt+=Je),lt>=Ke.length&&t(15,lt=-1),lt<0&&Ae&&t(15,lt=0),re.preventDefault())}function bt(re=!0,Je=!1){if(t(18,Wt=void 0),Ne||Je){if(fr&&clearTimeout(fr),ye.length<Y)return;const et=ye;fr=window.setTimeout(()=>{vr(et).catch(nt=>t(18,Wt=nt))},re?P:0)}else t(14,Ke=void 0),t(18,Wt=void 0)}function Rt(re){t(56,pe=re),t(1,ye=re.place_name),t(15,lt=-1)}const Qt=()=>Xe.focus();function Jt(re){fg[re?"unshift":"push"](()=>{Xe=re,t(17,Xe)})}function yr(){ye=this.value,t(1,ye),t(13,We),t(28,x)}const or=()=>t(13,We=!0),Te=()=>t(13,We=!1),ne=()=>bt(),ce=()=>{t(1,ye=""),Xe.focus()},ge=()=>t(0,ie=!ie),xe=()=>t(18,Wt=void 0),$e=re=>t(15,lt=re),Be=re=>Rt(re),Ue=()=>{Ae||t(15,lt=-1)},ze=()=>{};return r.$$set=re=>{"class"in re&&t(2,d=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,g=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,x=re.clearOnBlur),"collapsed"in re&&t(4,C=re.collapsed),"country"in re&&t(29,M=re.country),"debounceSearch"in re&&t(30,P=re.debounceSearch),"enableReverse"in re&&t(5,A=re.enableReverse),"errorMessage"in re&&t(6,L=re.errorMessage),"filter"in re&&t(31,I=re.filter),"flyTo"in re&&t(32,$=re.flyTo),"fuzzyMatch"in re&&t(33,O=re.fuzzyMatch),"language"in re&&t(34,Z=re.language),"limit"in re&&t(35,X=re.limit),"mapController"in re&&t(36,q=re.mapController),"minLength"in re&&t(37,Y=re.minLength),"noResultsMessage"in re&&t(7,fe=re.noResultsMessage),"placeholder"in re&&t(8,Le=re.placeholder),"proximity"in re&&t(38,ee=re.proximity),"reverseActive"in re&&t(0,ie=re.reverseActive),"reverseButtonTitle"in re&&t(9,ve=re.reverseButtonTitle),"searchValue"in re&&t(1,ye=re.searchValue),"pickedResultStyle"in re&&t(39,it=re.pickedResultStyle),"showPlaceType"in re&&t(10,Fe=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,Ne=re.showResultsWhileTyping),"selectFirst"in re&&t(11,Ae=re.selectFirst),"flyToSelected"in re&&t(41,ot=re.flyToSelected),"markerOnSelected"in re&&t(42,Ye=re.markerOnSelected),"types"in re&&t(43,ut=re.types),"exhaustiveReverseGeocoding"in re&&t(44,pt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,_t=re.excludeTypes),"zoom"in re&&t(46,He=re.zoom),"apiUrl"in re&&t(47,mt=re.apiUrl),"fetchParameters"in re&&t(48,Pt=re.fetchParameters),"iconsBaseUrl"in re&&t(12,jt=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,un=re.adjustUrlQuery),"$$scope"in re&&t(60,u=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ie=A==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Tr=We),x&&!We&&t(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ye.length<Y&&(t(56,pe=void 0),t(14,Ke=void 0),t(18,Wt=void 0),t(55,kt=Ke)),r.$$.dirty[1]&33554688&&it!=="marker-only"&&pe&&!pe.address&&pe.geometry.type==="Point"&&pe.place_type[0]!=="reverse"&&vr(pe.id,{byId:!0}).catch(re=>t(18,Wt=re)),r.$$.dirty[1]&100663330&&(q&&pe&&pe.id!==Cr&&$&&(!pe.bbox||pe.bbox[0]===pe.bbox[2]&&pe.bbox[1]===pe.bbox[3]?q.flyTo(pe.center,Bn(pe)):q.fitBounds(Qd(pe.bbox),50,Bn(pe)),t(14,Ke=void 0),t(55,kt=void 0),t(15,lt=-1)),t(57,Cr=pe==null?void 0:pe.id)),r.$$.dirty[0]&18432&&Ae&&Ke!=null&&Ke.length&&t(15,lt=0),r.$$.dirty[0]&2&&t(15,lt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&kt!==Ke&&t(55,kt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&q&&q.setEventHandler(re=>{switch(re.type){case"mapClick":ie&&Oe(re.coordinates);break;case"markerClick":{const Je=Ke==null?void 0:Ke.find(et=>et.id===re.id);Je&&Rt(Je)}break;case"markerMouseEnter":kt&&t(15,lt=Tr?(Ke==null?void 0:Ke.findIndex(Je=>Je.id===re.id))??-1:-1);break;case"markerMouseLeave":kt&&t(15,lt=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=Ke==null?void 0:Ke[lt]),r.$$.dirty[1]&134218786&&q&&i&&$&&ot&&q.flyTo(i.center,Bn(i)),r.$$.dirty[1]&256&&t(59,n=it==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Ye||q==null||q.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&q&&Ye&&!kt&&(q.setFeatures(i?[i]:void 0,void 0,n),q.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&q&&q.setFeatures(kt,pe,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&kt&&q&&q.setSelectedMarker(lt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&q){const re=Pr(ye);q.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Un("select",{feature:i}),r.$$.dirty[1]&33554432&&Un("pick",{feature:pe}),r.$$.dirty[0]&81920&&Un("optionsvisibilitychange",{optionsVisible:Tr&&!!Ke}),r.$$.dirty[0]&16384&&Un("featureslisted",{features:Ke}),r.$$.dirty[1]&16777216&&Un("featuresmarked",{features:kt}),r.$$.dirty[0]&1&&Un("reversetoggle",{reverse:ie}),r.$$.dirty[0]&2&&Un("querychange",{query:ye}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&q&&q.indicateReverse(ie)},[ie,ye,d,_,C,A,L,fe,Le,ve,Fe,Ae,jt,We,Ke,lt,Tr,Xe,Wt,Wn,xi,xt,yt,bt,Rt,s,p,g,x,M,P,I,$,O,Z,X,q,Y,ee,it,Ne,ot,Ye,ut,pt,_t,He,mt,Pt,un,nn,rn,pn,yn,qe,kt,pe,Cr,i,n,u,o,Qt,Jt,yr,or,Te,ne,ce,ge,xe,$e,Be,Ue,ze]}let Q6=class extends Ja{constructor(r){super(),Ya(this,r,J6,Y6,Xa,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}};function Kf(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function s_(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return Kf({type:"Polygon",coordinates:r},e,t)}function Xf(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function M2(r,e,t={}){return Kf({type:"MultiPolygon",coordinates:r},e,t)}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function eE(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,u;return u={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(u[Symbol.iterator]=function(){return this}),u;function s(p){return function(g){return d([p,g])}}function d(p){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=p[0]&2?i.return:p[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,p[1])).done)return o;switch(i=0,o&&(p=[p[0]&2,o.value]),p[0]){case 0:case 1:o=p;break;case 4:return t.label++,{value:p[1],done:!1};case 5:t.label++,i=p[1],p=[0];continue;case 7:p=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(p[0]===6||p[0]===2)){t=0;continue}if(p[0]===3&&(!o||p[1]>o[0]&&p[1]<o[3])){t.label=p[1];break}if(p[0]===6&&t.label<o[1]){t.label=o[1],o=p;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(p);break}o[2]&&t.ops.pop(),t.trys.pop();continue}p=e.call(r,t)}catch(g){p=[6,g],i=0}finally{n=o=0}if(p[0]&5)throw p[1];return{value:p[0]?p[1]:void 0,done:!0}}}var Ha=function(){function r(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null}return r}();function tE(r,e){return r>e?1:r<e?-1:0}function Da(r,e,t){for(var n=new Ha(null,null),i=n,o=n;;){var u=t(r,e.key);if(u<0){if(e.left===null)break;if(t(r,e.left.key)<0){var s=e.left;if(e.left=s.right,s.right=e,e=s,e.left===null)break}o.left=e,o=e,e=e.left}else if(u>0){if(e.right===null)break;if(t(r,e.right.key)>0){var s=e.right;if(e.right=s.left,s.left=e,e=s,e.right===null)break}i.right=e,i=e,e=e.right}else break}return i.right=e.left,o.left=e.right,e.left=n.right,e.right=n.left,e}function Bm(r,e,t,n){var i=new Ha(r,e);if(t===null)return i.left=i.right=null,i;t=Da(r,t,n);var o=n(r,t.key);return o<0?(i.left=t.left,i.right=t,t.left=null):o>=0&&(i.right=t.right,i.left=t,t.right=null),i}function w1(r,e,t){var n=null,i=null;if(e){e=Da(r,e,t);var o=t(e.key,r);o===0?(n=e.left,i=e.right):o<0?(i=e.right,e.right=null,n=e):(n=e.left,e.left=null,i=e)}return{left:n,right:i}}function nE(r,e,t){return e===null?r:(r===null||(e=Da(r.key,e,t),e.left=r),e)}function pg(r,e,t,n,i){if(r){n(""+e+(t?" ":" ")+i(r)+`
`);var o=e+(t?"    ":"   ");r.left&&pg(r.left,o,!1,n,i),r.right&&pg(r.right,o,!0,n,i)}}var a_=function(){function r(e){e===void 0&&(e=tE),this._root=null,this._size=0,this._comparator=e}return r.prototype.insert=function(e,t){return this._size++,this._root=Bm(e,t,this._root,this._comparator)},r.prototype.add=function(e,t){var n=new Ha(e,t);this._root===null&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,o=Da(e,this._root,i),u=i(e,o.key);return u===0?this._root=o:(u<0?(n.left=o.left,n.right=o,o.left=null):u>0&&(n.right=o.right,n.left=o,o.right=null),this._size++,this._root=n),this._root},r.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},r.prototype._remove=function(e,t,n){var i;if(t===null)return null;t=Da(e,t,n);var o=n(e,t.key);return o===0?(t.left===null?i=t.right:(i=Da(e,t.left,n),i.right=t.right),this._size--,i):t},r.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=Da(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},r.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return t;i<0?t=t.left:t=t.right}return null},r.prototype.find=function(e){return this._root&&(this._root=Da(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},r.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var i=n(e,t.key);if(i===0)return!0;i<0?t=t.left:t=t.right}return!1},r.prototype.forEach=function(e,t){for(var n=this._root,i=[],o=!1;!o;)n!==null?(i.push(n),n=n.left):i.length!==0?(n=i.pop(),e.call(t,n),n=n.right):o=!0;return this},r.prototype.range=function(e,t,n,i){for(var o=[],u=this._comparator,s=this._root,d;o.length!==0||s;)if(s)o.push(s),s=s.left;else{if(s=o.pop(),d=u(s.key,t),d>0)break;if(u(s.key,e)>=0&&n.call(i,s))return this;s=s.right}return this},r.prototype.keys=function(){var e=[];return this.forEach(function(t){var n=t.key;return e.push(n)}),e},r.prototype.values=function(){var e=[];return this.forEach(function(t){var n=t.data;return e.push(n)}),e},r.prototype.min=function(){return this._root?this.minNode(this._root).key:null},r.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},r.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.at=function(e){for(var t=this._root,n=!1,i=0,o=[];!n;)if(t)o.push(t),t=t.left;else if(o.length>0){if(t=o.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?(n=t,t=t.left):t=t.right}return n},r.prototype.prev=function(e){var t=this._root,n=null;if(e.left!==null){for(n=e.left;n.right;)n=n.right;return n}for(var i=this._comparator;t;){var o=i(e.key,t.key);if(o===0)break;o<0?t=t.left:(n=t,t=t.right)}return n},r.prototype.clear=function(){return this._root=null,this._size=0,this},r.prototype.toList=function(){return iE(this._root)},r.prototype.load=function(e,t,n){t===void 0&&(t=[]),n===void 0&&(n=!1);var i=e.length,o=this._comparator;if(n&&_g(e,t,0,i-1,o),this._root===null)this._root=mg(e,t,0,i),this._size=i;else{var u=oE(this.toList(),rE(e,t),o);i=this._size+i,this._root=gg({head:u},0,i)}return this},r.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(r.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){e===void 0&&(e=function(n){return String(n.key)});var t=[];return pg(this._root,"",!0,function(n){return t.push(n)},e),t.join("")},r.prototype.update=function(e,t,n){var i=this._comparator,o=w1(e,this._root,i),u=o.left,s=o.right;i(e,t)<0?s=Bm(t,n,s,i):u=Bm(t,n,u,i),this._root=nE(u,s,i)},r.prototype.split=function(e){return w1(e,this._root,this._comparator)},r.prototype[Symbol.iterator]=function(){var e,t,n;return eE(this,function(i){switch(i.label){case 0:e=this._root,t=[],n=!1,i.label=1;case 1:return n?[3,6]:e===null?[3,2]:(t.push(e),e=e.left,[3,5]);case 2:return t.length===0?[3,4]:(e=t.pop(),[4,e]);case 3:return i.sent(),e=e.right,[3,5];case 4:n=!0,i.label=5;case 5:return[3,1];case 6:return[2]}})},r}();function mg(r,e,t,n){var i=n-t;if(i>0){var o=t+Math.floor(i/2),u=r[o],s=e[o],d=new Ha(u,s);return d.left=mg(r,e,t,o),d.right=mg(r,e,o+1,n),d}return null}function rE(r,e){for(var t=new Ha(null,null),n=t,i=0;i<r.length;i++)n=n.next=new Ha(r[i],e[i]);return n.next=null,t.next}function iE(r){for(var e=r,t=[],n=!1,i=new Ha(null,null),o=i;!n;)e?(t.push(e),e=e.left):t.length>0?(e=o=o.next=t.pop(),e=e.right):n=!0;return o.next=null,i.next}function gg(r,e,t){var n=t-e;if(n>0){var i=e+Math.floor(n/2),o=gg(r,e,i),u=r.head;return u.left=o,r.head=r.head.next,u.right=gg(r,i+1,t),u}return null}function oE(r,e,t){for(var n=new Ha(null,null),i=n,o=r,u=e;o!==null&&u!==null;)t(o.key,u.key)<0?(i.next=o,o=o.next):(i.next=u,u=u.next),i=i.next;return o!==null?i.next=o:u!==null&&(i.next=u),n.next}function _g(r,e,t,n,i){if(!(t>=n)){for(var o=r[t+n>>1],u=t-1,s=n+1;;){do u++;while(i(r[u],o)<0);do s--;while(i(r[s],o)>0);if(u>=s)break;var d=r[u];r[u]=r[s],r[s]=d,d=e[u],e[u]=e[s],e[s]=d}_g(r,e,t,s,i),_g(r,e,s+1,n,i)}}const aa=11102230246251565e-32,Hi=134217729,sE=(3+8*aa)*aa;function Nm(r,e,t,n,i){let o,u,s,d,p=e[0],g=n[0],_=0,x=0;g>p==g>-p?(o=p,p=e[++_]):(o=g,g=n[++x]);let C=0;if(_<r&&x<t)for(g>p==g>-p?(u=p+o,s=o-(u-p),p=e[++_]):(u=g+o,s=o-(u-g),g=n[++x]),o=u,s!==0&&(i[C++]=s);_<r&&x<t;)g>p==g>-p?(u=o+p,d=u-o,s=o-(u-d)+(p-d),p=e[++_]):(u=o+g,d=u-o,s=o-(u-d)+(g-d),g=n[++x]),o=u,s!==0&&(i[C++]=s);for(;_<r;)u=o+p,d=u-o,s=o-(u-d)+(p-d),p=e[++_],o=u,s!==0&&(i[C++]=s);for(;x<t;)u=o+g,d=u-o,s=o-(u-d)+(g-d),g=n[++x],o=u,s!==0&&(i[C++]=s);return(o!==0||C===0)&&(i[C++]=o),C}function aE(r,e){let t=e[0];for(let n=1;n<r;n++)t+=e[n];return t}function uh(r){return new Float64Array(r)}const lE=(3+16*aa)*aa,uE=(2+12*aa)*aa,cE=(9+64*aa)*aa*aa,Vu=uh(4),x1=uh(8),k1=uh(12),S1=uh(16),lo=uh(4);function fE(r,e,t,n,i,o,u){let s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z,X,q,Y;const fe=r-i,Le=t-i,ee=e-o,ie=n-o;O=fe*ie,x=Hi*fe,C=x-(x-fe),M=fe-C,x=Hi*ie,P=x-(x-ie),A=ie-P,Z=M*A-(O-C*P-M*P-C*A),X=ee*Le,x=Hi*ee,C=x-(x-ee),M=ee-C,x=Hi*Le,P=x-(x-Le),A=Le-P,q=M*A-(X-C*P-M*P-C*A),L=Z-q,_=Z-L,Vu[0]=Z-(L+_)+(_-q),I=O+L,_=I-O,$=O-(I-_)+(L-_),L=$-X,_=$-L,Vu[1]=$-(L+_)+(_-X),Y=I+L,_=Y-I,Vu[2]=I-(Y-_)+(L-_),Vu[3]=Y;let ve=aE(4,Vu),ye=uE*u;if(ve>=ye||-ve>=ye||(_=r-fe,s=r-(fe+_)+(_-i),_=t-Le,p=t-(Le+_)+(_-i),_=e-ee,d=e-(ee+_)+(_-o),_=n-ie,g=n-(ie+_)+(_-o),s===0&&d===0&&p===0&&g===0)||(ye=cE*u+sE*Math.abs(ve),ve+=fe*g+ie*s-(ee*p+Le*d),ve>=ye||-ve>=ye))return ve;O=s*ie,x=Hi*s,C=x-(x-s),M=s-C,x=Hi*ie,P=x-(x-ie),A=ie-P,Z=M*A-(O-C*P-M*P-C*A),X=d*Le,x=Hi*d,C=x-(x-d),M=d-C,x=Hi*Le,P=x-(x-Le),A=Le-P,q=M*A-(X-C*P-M*P-C*A),L=Z-q,_=Z-L,lo[0]=Z-(L+_)+(_-q),I=O+L,_=I-O,$=O-(I-_)+(L-_),L=$-X,_=$-L,lo[1]=$-(L+_)+(_-X),Y=I+L,_=Y-I,lo[2]=I-(Y-_)+(L-_),lo[3]=Y;const it=Nm(4,Vu,4,lo,x1);O=fe*g,x=Hi*fe,C=x-(x-fe),M=fe-C,x=Hi*g,P=x-(x-g),A=g-P,Z=M*A-(O-C*P-M*P-C*A),X=ee*p,x=Hi*ee,C=x-(x-ee),M=ee-C,x=Hi*p,P=x-(x-p),A=p-P,q=M*A-(X-C*P-M*P-C*A),L=Z-q,_=Z-L,lo[0]=Z-(L+_)+(_-q),I=O+L,_=I-O,$=O-(I-_)+(L-_),L=$-X,_=$-L,lo[1]=$-(L+_)+(_-X),Y=I+L,_=Y-I,lo[2]=I-(Y-_)+(L-_),lo[3]=Y;const Fe=Nm(it,x1,4,lo,k1);O=s*g,x=Hi*s,C=x-(x-s),M=s-C,x=Hi*g,P=x-(x-g),A=g-P,Z=M*A-(O-C*P-M*P-C*A),X=d*p,x=Hi*d,C=x-(x-d),M=d-C,x=Hi*p,P=x-(x-p),A=p-P,q=M*A-(X-C*P-M*P-C*A),L=Z-q,_=Z-L,lo[0]=Z-(L+_)+(_-q),I=O+L,_=I-O,$=O-(I-_)+(L-_),L=$-X,_=$-L,lo[1]=$-(L+_)+(_-X),Y=I+L,_=Y-I,lo[2]=I-(Y-_)+(L-_),lo[3]=Y;const Ne=Nm(Fe,k1,4,lo,S1);return S1[Ne-1]}function hE(r,e,t,n,i,o){const u=(e-o)*(t-i),s=(r-i)*(n-o),d=u-s,p=Math.abs(u+s);return Math.abs(d)>=lE*p?d:-fE(r,e,t,n,i,o,p)}const _f=(r,e)=>r.ll.x<=e.x&&e.x<=r.ur.x&&r.ll.y<=e.y&&e.y<=r.ur.y,yg=(r,e)=>{if(e.ur.x<r.ll.x||r.ur.x<e.ll.x||e.ur.y<r.ll.y||r.ur.y<e.ll.y)return null;const t=r.ll.x<e.ll.x?e.ll.x:r.ll.x,n=r.ur.x<e.ur.x?r.ur.x:e.ur.x,i=r.ll.y<e.ll.y?e.ll.y:r.ll.y,o=r.ur.y<e.ur.y?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}};let Oa=Number.EPSILON;Oa===void 0&&(Oa=Math.pow(2,-52));const dE=Oa*Oa,T1=(r,e)=>{if(-Oa<r&&r<Oa&&-Oa<e&&e<Oa)return 0;const t=r-e;return t*t<dE*r*e?0:r<e?-1:1};class pE{constructor(){this.reset()}reset(){this.xRounder=new C1,this.yRounder=new C1}round(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}class C1{constructor(){this.tree=new a_,this.round(0)}round(e){const t=this.tree.add(e),n=this.tree.prev(t);if(n!==null&&T1(t.key,n.key)===0)return this.tree.remove(e),n.key;const i=this.tree.next(t);return i!==null&&T1(t.key,i.key)===0?(this.tree.remove(e),i.key):e}}const Yf=new pE,Nd=(r,e)=>r.x*e.y-r.y*e.x,E2=(r,e)=>r.x*e.x+r.y*e.y,M1=(r,e,t)=>{const n=hE(r.x,r.y,e.x,e.y,t.x,t.y);return n>0?-1:n<0?1:0},ep=r=>Math.sqrt(E2(r,r)),mE=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return Nd(i,n)/ep(i)/ep(n)},gE=(r,e,t)=>{const n={x:e.x-r.x,y:e.y-r.y},i={x:t.x-r.x,y:t.y-r.y};return E2(i,n)/ep(i)/ep(n)},E1=(r,e,t)=>e.y===0?null:{x:r.x+e.x/e.y*(t-r.y),y:t},L1=(r,e,t)=>e.x===0?null:{x:t,y:r.y+e.y/e.x*(t-r.x)},_E=(r,e,t,n)=>{if(e.x===0)return L1(t,n,r.x);if(n.x===0)return L1(r,e,t.x);if(e.y===0)return E1(t,n,r.y);if(n.y===0)return E1(r,e,t.y);const i=Nd(e,n);if(i==0)return null;const o={x:t.x-r.x,y:t.y-r.y},u=Nd(o,e)/i,s=Nd(o,n)/i,d=r.x+s*e.x,p=t.x+u*n.x,g=r.y+s*e.y,_=t.y+u*n.y,x=(d+p)/2,C=(g+_)/2;return{x,y:C}};class es{static compare(e,t){const n=es.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:$a.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}constructor(e,t){e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:mE(this.point,e.point,o.point),cosine:gE(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:u,cosine:s}=t.get(i),{sine:d,cosine:p}=t.get(o);return u>=0&&d>=0?s<p?1:s>p?-1:0:u<0&&d<0?s<p?-1:s>p?1:0:d<u?-1:d>u?1:0}}}let yE=0;class $a{static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,u=t.rightSE.point.x;if(u<n)return 1;if(o<i)return-1;const s=e.leftSE.point.y,d=t.leftSE.point.y,p=e.rightSE.point.y,g=t.rightSE.point.y;if(n<i){if(d<s&&d<p)return 1;if(d>s&&d>p)return-1;const _=e.comparePoint(t.leftSE.point);if(_<0)return 1;if(_>0)return-1;const x=t.comparePoint(e.rightSE.point);return x!==0?x:-1}if(n>i){if(s<d&&s<g)return-1;if(s>d&&s>g)return 1;const _=t.comparePoint(e.leftSE.point);if(_!==0)return _;const x=e.comparePoint(t.rightSE.point);return x<0?1:x>0?-1:1}if(s<d)return-1;if(s>d)return 1;if(o<u){const _=t.comparePoint(e.rightSE.point);if(_!==0)return _}if(o>u){const _=e.comparePoint(t.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(o!==u){const _=p-s,x=o-n,C=g-d,M=u-i;if(_>x&&C<M)return 1;if(_<x&&C>M)return-1}return o>u?1:o<u||p<g?-1:p>g?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,i){this.id=++yE,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static fromRing(e,t,n){let i,o,u;const s=es.comparePoints(e,t);if(s<0)i=e,o=t,u=1;else if(s>0)i=t,o=e,u=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new es(i,!0),p=new es(o,!1);return new $a(d,p,[n],[u])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}comparePoint(e){if(this.isAnEndpoint(e))return 0;const t=this.leftSE.point,n=this.rightSE.point,i=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;const o=(e.y-t.y)/i.y,u=t.x+o*i.x;if(e.x===u)return 0;const s=(e.x-t.x)/i.x,d=t.y+s*i.y;return e.y===d?0:e.y<d?-1:1}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=yg(t,n);if(i===null)return null;const o=this.leftSE.point,u=this.rightSE.point,s=e.leftSE.point,d=e.rightSE.point,p=_f(t,s)&&this.comparePoint(s)===0,g=_f(n,o)&&e.comparePoint(o)===0,_=_f(t,d)&&this.comparePoint(d)===0,x=_f(n,u)&&e.comparePoint(u)===0;if(g&&p)return x&&!_?u:!x&&_?d:null;if(g)return _&&o.x===d.x&&o.y===d.y?null:o;if(p)return x&&u.x===s.x&&u.y===s.y?null:s;if(x&&_)return null;if(x)return u;if(_)return d;const C=_E(o,this.vector(),s,e.vector());return C===null||!_f(i,C)?null:Yf.round(C.x,C.y)}split(e){const t=[],n=e.events!==void 0,i=new es(e,!0),o=new es(e,!1),u=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const s=new $a(i,u,this.rings.slice(),this.windings.slice());return es.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),es.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=$a.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,u=n.rings.length;o<u;o++){const s=n.rings[o],d=n.windings[o],p=t.rings.indexOf(s);p===-1?(t.rings.push(s),t.windings.push(d)):t.windings[p]+=d}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let s=0,d=this.rings.length;s<d;s++){const p=this.rings[s],g=this.windings[s],_=t.indexOf(p);_===-1?(t.push(p),n.push(g)):n[_]+=g}const o=[],u=[];for(let s=0,d=t.length;s<d;s++){if(n[s]===0)continue;const p=t[s],g=p.poly;if(u.indexOf(g)===-1)if(p.isExterior)o.push(g);else{u.indexOf(g)===-1&&u.push(g);const _=o.indexOf(p.poly);_!==-1&&o.splice(_,1)}}for(let s=0,d=o.length;s<d;s++){const p=o[s].multiPoly;i.indexOf(p)===-1&&i.push(p)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(bs.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===bs.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}default:throw new Error(`Unrecognized operation type found ${bs.type}`)}return this._isInResult}}class I1{constructor(e,t,n){if(!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const i=Yf.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};let o=i;for(let u=1,s=e.length;u<s;u++){if(typeof e[u][0]!="number"||typeof e[u][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let d=Yf.round(e[u][0],e[u][1]);d.x===o.x&&d.y===o.y||(this.segments.push($a.fromRing(o,d,this)),d.x<this.bbox.ll.x&&(this.bbox.ll.x=d.x),d.y<this.bbox.ll.y&&(this.bbox.ll.y=d.y),d.x>this.bbox.ur.x&&(this.bbox.ur.x=d.x),d.y>this.bbox.ur.y&&(this.bbox.ur.y=d.y),o=d)}(i.x!==o.x||i.y!==o.y)&&this.segments.push($a.fromRing(o,i,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const i=this.segments[t];e.push(i.leftSE),e.push(i.rightSE)}return e}}class vE{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new I1(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,i=e.length;n<i;n++){const o=new I1(e[n],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class A1{constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let n=0,i=e.length;n<i;n++){const o=new vE(e[n],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getSweepEvents();for(let o=0,u=i.length;o<u;o++)e.push(i[o])}return e}}class tp{static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let u=null,s=o.leftSE,d=o.rightSE;const p=[s],g=s.point,_=[];for(;u=s,s=d,p.push(s),s.point!==g;)for(;;){const x=s.getAvailableLinkedEvents();if(x.length===0){const P=p[0].point,A=p[p.length-1].point;throw new Error(`Unable to complete output ring starting at [${P.x}, ${P.y}]. Last matching segment found ends at [${A.x}, ${A.y}].`)}if(x.length===1){d=x[0].otherSE;break}let C=null;for(let P=0,A=_.length;P<A;P++)if(_[P].point===s.point){C=P;break}if(C!==null){const P=_.splice(C)[0],A=p.splice(P.index);A.unshift(A[0].otherSE),t.push(new tp(A.reverse()));continue}_.push({index:p.length,point:s.point});const M=s.getLeftmostComparator(u);d=x.sort(M)[0].otherSE;break}t.push(new tp(p))}return t}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let p=1,g=this.events.length-1;p<g;p++){const _=this.events[p].point,x=this.events[p+1].point;M1(_,e,x)!==0&&(t.push(_),e=_)}if(t.length===1)return null;const n=t[0],i=t[1];M1(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,d=[];for(let p=u;p!=s;p+=o)d.push([t[p].x,t[p].y]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let i=1,o=this.events.length;i<o;i++){const u=this.events[i];es.compare(e,u)>0&&(e=u)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}}class P1{constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}}class bE{constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const i=this.polys[t].getGeom();i!==null&&e.push(i)}return e}_composePolys(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.poly)if(o.isExteriorRing())t.push(new P1(o));else{const u=o.enclosingRing();u.poly||t.push(new P1(u)),u.poly.addInterior(o)}}return t}}class wE{constructor(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$a.compare;this.queue=e,this.tree=new a_(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;const i=e.isLeft?this.tree.add(t):this.tree.find(t);if(!i)throw new Error(`Unable to find segment #${t.id} [${t.leftSE.point.x}, ${t.leftSE.point.y}] -> [${t.rightSE.point.x}, ${t.rightSE.point.y}] in SweepLine tree.`);let o=i,u=i,s,d;for(;s===void 0;)o=this.tree.prev(o),o===null?s=null:o.key.consumedBy===void 0&&(s=o.key);for(;d===void 0;)u=this.tree.next(u),u===null?d=null:u.key.consumedBy===void 0&&(d=u.key);if(e.isLeft){let p=null;if(s){const _=s.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(p=_),!s.isAnEndpoint(_))){const x=this._splitSafely(s,_);for(let C=0,M=x.length;C<M;C++)n.push(x[C])}}let g=null;if(d){const _=d.getIntersection(t);if(_!==null&&(t.isAnEndpoint(_)||(g=_),!d.isAnEndpoint(_))){const x=this._splitSafely(d,_);for(let C=0,M=x.length;C<M;C++)n.push(x[C])}}if(p!==null||g!==null){let _=null;p===null?_=g:g===null?_=p:_=es.comparePoints(p,g)<=0?p:g,this.queue.remove(t.rightSE),n.push(t.rightSE);const x=t.split(_);for(let C=0,M=x.length;C<M;C++)n.push(x[C])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=s)}else{if(s&&d){const p=s.getIntersection(d);if(p!==null){if(!s.isAnEndpoint(p)){const g=this._splitSafely(s,p);for(let _=0,x=g.length;_<x;_++)n.push(g[_])}if(!d.isAnEndpoint(p)){const g=this._splitSafely(d,p);for(let _=0,x=g.length;_<x;_++)n.push(g[_])}}}this.tree.remove(t)}return n}_splitSafely(e,t){this.tree.remove(e);const n=e.rightSE;this.queue.remove(n);const i=e.split(t);return i.push(n),e.consumedBy===void 0&&this.tree.add(e),i}}const z1=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,xE=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class kE{run(e,t,n){bs.type=e,Yf.reset();const i=[new A1(t,!0)];for(let g=0,_=n.length;g<_;g++)i.push(new A1(n[g],!1));if(bs.numMultiPolys=i.length,bs.type==="difference"){const g=i[0];let _=1;for(;_<i.length;)yg(i[_].bbox,g.bbox)!==null?_++:i.splice(_,1)}if(bs.type==="intersection")for(let g=0,_=i.length;g<_;g++){const x=i[g];for(let C=g+1,M=i.length;C<M;C++)if(yg(x.bbox,i[C].bbox)===null)return[]}const o=new a_(es.compare);for(let g=0,_=i.length;g<_;g++){const x=i[g].getSweepEvents();for(let C=0,M=x.length;C<M;C++)if(o.insert(x[C]),o.size>z1)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const u=new wE(o);let s=o.size,d=o.pop();for(;d;){const g=d.key;if(o.size===s){const x=g.segment;throw new Error(`Unable to pop() ${g.isLeft?"left":"right"} SweepEvent [${g.point.x}, ${g.point.y}] from segment #${x.id} [${x.leftSE.point.x}, ${x.leftSE.point.y}] -> [${x.rightSE.point.x}, ${x.rightSE.point.y}] from queue.`)}if(o.size>z1)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(u.segments.length>xE)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const _=u.process(g);for(let x=0,C=_.length;x<C;x++){const M=_[x];M.consumedBy===void 0&&o.insert(M)}s=o.size,d=o.pop()}Yf.reset();const p=tp.factory(u.segments);return new bE(p).getGeom()}}const bs=new kE,SE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("union",r,t)},TE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("intersection",r,t)},CE=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("xor",r,t)},ME=function(r){for(var e=arguments.length,t=new Array(e>1?e-1:0),n=1;n<e;n++)t[n-1]=arguments[n];return bs.run("difference",r,t)};var L2={union:SE,intersection:TE,xor:CE,difference:ME};function I2(r,e,t){if(r!==null)for(var n,i,o,u,s,d,p,g=0,_=0,x,C=r.type,M=C==="FeatureCollection",P=C==="Feature",A=M?r.features.length:1,L=0;L<A;L++){p=M?r.features[L].geometry:P?r.geometry:r,x=p?p.type==="GeometryCollection":!1,s=x?p.geometries.length:1;for(var I=0;I<s;I++){var $=0,O=0;if(u=x?p.geometries[I]:p,u!==null){d=u.coordinates;var Z=u.type;switch(g=0,Z){case null:break;case"Point":if(e(d,_,L,$,O)===!1)return!1;_++,$++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],_,L,$,O)===!1)return!1;_++,Z==="MultiPoint"&&$++}Z==="LineString"&&$++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-g;i++){if(e(d[n][i],_,L,$,O)===!1)return!1;_++}Z==="MultiLineString"&&$++,Z==="Polygon"&&O++}Z==="Polygon"&&$++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(O=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-g;o++){if(e(d[n][i][o],_,L,$,O)===!1)return!1;_++}O++}$++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(I2(u.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function l_(r,e){var t,n,i,o,u,s,d,p,g,_,x=0,C=r.type==="FeatureCollection",M=r.type==="Feature",P=C?r.features.length:1;for(t=0;t<P;t++){for(s=C?r.features[t].geometry:M?r.geometry:r,p=C?r.features[t].properties:M?r.properties:{},g=C?r.features[t].bbox:M?r.bbox:void 0,_=C?r.features[t].id:M?r.id:void 0,d=s?s.type==="GeometryCollection":!1,u=d?s.geometries.length:1,i=0;i<u;i++){if(o=d?s.geometries[i]:s,o===null){if(e(null,x,p,g,_)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,x,p,g,_)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],x,p,g,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}x++}}function EE(r,e){l_(r,function(t,n,i,o,u){var s=t===null?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return e(Kf(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(s){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var p=0;p<t.coordinates.length;p++){var g=t.coordinates[p],_={type:d,coordinates:g};if(e(Kf(_,i),n,p)===!1)return!1}})}function LE(r,e={}){const t=[];if(l_(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=L2.union(t[0],...t.slice(1));return n.length===0?null:n.length===1?s_(n[0],e.properties):M2(n,e.properties)}var A2=LE;function IE(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return I2(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var D1=IE;function AE(r){const e=[];if(l_(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=L2.difference(e[0],...e.slice(1));return n.length===0?null:n.length===1?s_(n[0],t):M2(n,t)}var PE=AE;function zE(r){if(!r)throw new Error("geojson is required");var e=[];return EE(r,function(t){e.push(t)}),Xf(e)}var DE=zE;function R1(r,e){const t=PE(Xf([s_([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=Qd(D1(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,u=n[2]>180,s=DE(r);if(s.features.length>1&&(o||u))for(const d of s.features){const p=Qd(D1(d));if(u&&p[0]<-180+i)for(const g of d.geometry.coordinates)for(const _ of g)_[0]+=360-i;if(o&&p[2]>180-i)for(const g of d.geometry.coordinates)for(const _ of g)_[0]-=360-i}e(Xf([s.features.length<2?r:A2(s)??r,t]))}const F1={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},Sd="mtlr-gc-full-geom",O1="mtlr-gc-full-geom-fill",$1="mtlr-gc-full-geom-line";function P2(r,e,t=!0,n=!0,i={},o={},u=F1){let s;const d=[];let p,g,_;function x(){if(!r.loaded){r.once("load",x);return}const A=u?u===!0?F1:u:void 0;if(!(A!=null&&A.fill)&&!(A!=null&&A.line))return;const L=r.getSource(Sd);if(L)L.setData(_??Xf([]));else if(_)r.addSource(Sd,{type:"geojson",data:_});else return;!r.getLayer(O1)&&A!=null&&A.fill&&r.addLayer({...A==null?void 0:A.fill,id:O1,type:"fill",source:Sd}),!r.getLayer($1)&&A!=null&&A.line&&r.addLayer({...A==null?void 0:A.line,id:$1,type:"line",source:Sd})}function C(A){_=A,x()}r.on("styledata",()=>{setTimeout(()=>{_&&x()})});const M=A=>{s==null||s({type:"mapClick",coordinates:[A.lngLat.lng,A.lngLat.lat]})};function P(A=!1){if(!e)throw new Error;const L=document.createElement("div");return A&&L.classList.add("marker-interactive"),new L6({props:{displayIn:"maplibre"},target:L}),new e.Marker({element:L,offset:[1,-13]})}return{setEventHandler(A){A?(s=A,r.on("click",M)):(s=void 0,r.off("click",M))},flyTo(A,L){r.flyTo({center:A,...L?{zoom:L}:{},...i})},fitBounds(A,L,I){r.fitBounds([[A[0],A[1]],[A[2],A[3]]],{padding:L,...I?{maxZoom:I}:{},...o})},indicateReverse(A){r.getCanvasContainer().style.cursor=A?"crosshair":""},setReverseMarker(A){!e||!t||(g?A?g.setLngLat(A):(g.remove(),g=void 0):A&&(t instanceof Function?g=t(r)??void 0:(g=(typeof t=="object"?new e.Marker(t):P()).setLngLat(A).addTo(r),g.getElement().classList.add("marker-reverse"))))},setFeatures(A,L,I){for(const $ of d)$.remove();if(d.length=0,C(void 0),!!e){if(L){let $=!1;if(L.geometry.type==="GeometryCollection"){const O=L.geometry.geometries.filter(Z=>Z.type==="Polygon"||Z.type==="MultiPolygon");e:if(O.length>0){const Z=A2(Xf(O.map(X=>Kf(X))));if(!Z)break e;R1({...L,geometry:Z.geometry},C),$=!0}else{const Z=L.geometry.geometries.filter(X=>X.type==="LineString"||X.type==="MultiLineString");Z.length>0&&(C({...L,geometry:{type:"GeometryCollection",geometries:Z}}),$=!0)}}if(!$){if(L.geometry.type==="Polygon"||L.geometry.type==="MultiPolygon")R1(L,C);else if(L.geometry.type==="LineString"||L.geometry.type==="MultiLineString"){C(L);return}}if(!I&&L.geometry.type!=="Point")return;if(t instanceof Function){const O=t(r,L);O&&d.push(O)}else t&&d.push(typeof t=="object"?new e.Marker(t):P().setLngLat(L.center).addTo(r))}if(n)for(const $ of A??[]){if($===L)continue;let O;if(n instanceof Function){if(O=n(r,$),!O)continue}else O=(typeof n=="object"?new e.Marker(n):P(!0)).setLngLat($.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText($.place_type[0]==="reverse"?$.place_name:$.place_name.replace(/,.*/,""))).addTo(r);const Z=O.getElement();Z.addEventListener("click",X=>{X.stopPropagation(),s==null||s({type:"markerClick",id:$.id})}),Z.addEventListener("mouseenter",()=>{s==null||s({type:"markerMouseEnter",id:$.id}),O.togglePopup()}),Z.addEventListener("mouseleave",()=>{s==null||s({type:"markerMouseLeave",id:$.id}),O.togglePopup()}),d.push(O)}}},setSelectedMarker(A){p&&p.getElement().classList.toggle("marker-selected",!1),p=A>-1?d[A]:void 0,p==null||p.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const A=r.getCenter();return[r.getZoom(),A.lng,A.lat]}}}function RE(r,e,t){var n,i;class o{constructor(A,L){Ro(this,"type"),Ro(this,"target"),this.type=L,this.target=A}}class u extends o{constructor(A,L){super(A,"select"),Ro(this,"feature"),Object.assign(this,L)}}class s extends o{constructor(A,L){super(A,"featureslisted"),Ro(this,"features"),this.features=L}}class d extends o{constructor(A,L){super(A,"featuresmarked"),Ro(this,"features"),this.features=L}}class p extends o{constructor(A,L){super(A,"optionsvisibilitychange"),Ro(this,"optionsVisible"),this.optionsVisible=L}}class g extends o{constructor(A,L){super(A,"pick"),Ro(this,"feature"),this.feature=L}}class _ extends o{constructor(A,L){super(A,"querychange"),Ro(this,"query"),this.query=L}}class x extends o{constructor(A,L,I){super(A,"response"),Ro(this,"url"),Ro(this,"featureCollection"),this.url=L,this.featureCollection=I}}class C extends o{constructor(A,L){super(A,"reversetoggle"),Ro(this,"reverse"),this.reverse=L}}class M extends r{constructor(A={}){super(),t1(this,n),t1(this,i),n1(this,i,A)}onAddInt(A){const L=document.createElement("div");L.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl maplibregl-ctrl-geocoder maplibregl-ctrl mapboxgl-ctrl-group";const{marker:I,showResultMarkers:$,flyTo:O,fullGeometryStyle:Z,...X}=vi(this,i),q=typeof O=="boolean"?{}:O,Y={mapController:P2(A,e,I,$,q,q,Z),flyTo:O===void 0?!0:!!O,apiKey:"",...t==null?void 0:t(A,L),...X};if(!Y.apiKey)throw new Error("no apiKey provided");return n1(this,n,new Q6({target:L,props:Y})),vi(this,n).$on("select",fe=>{this.fire(new u(this,fe.detail))}),vi(this,n).$on("pick",fe=>{this.fire(new g(this,fe.detail.feature))}),vi(this,n).$on("featureslisted",fe=>{this.fire(new s(this,fe.detail.features))}),vi(this,n).$on("featuresmarked",fe=>{this.fire(new d(this,fe.detail.features))}),vi(this,n).$on("response",fe=>{this.fire(new x(this,fe.detail.url,fe.detail.featureCollection))}),vi(this,n).$on("optionsvisibilitychange",fe=>{this.fire(new p(this,fe.detail.optionsVisible))}),vi(this,n).$on("reversetoggle",fe=>{this.fire(new C(this,fe.detail.reverse))}),vi(this,n).$on("querychange",fe=>{this.fire(new _(this,fe.detail.query))}),L}on(A,L){return super.on(A,L)}once(A,L){return super.once(A,L)}off(A,L){return super.off(A,L)}listens(A){return super.listens(A)}setOptions(A){var L;Object.assign(vi(this,i),A);const{marker:I,showResultMarkers:$,flyTo:O,fullGeometryStyle:Z,...X}=vi(this,i);(L=vi(this,n))==null||L.$set(X)}setQuery(A,L=!0){var I;(I=vi(this,n))==null||I.setQuery(A,L)}clearMap(){var A;(A=vi(this,n))==null||A.clearMap()}clearList(){var A;(A=vi(this,n))==null||A.clearList()}setReverseMode(A){var L;(L=vi(this,n))==null||L.$set({reverseActive:A})}focus(){var A;(A=vi(this,n))==null||A.focus()}blur(){var A;(A=vi(this,n))==null||A.blur()}onRemove(){var A;(A=vi(this,n))==null||A.$destroy()}}return n=new WeakMap,i=new WeakMap,{MapLibreBasedGeocodingControl:M,events:{SelectEvent:u,FeaturesListedEvent:s,FeaturesMarkedEvent:d,OptionsVisibilityChangeEvent:p,PickEvent:g,QueryChangeEvent:_,ResponseEvent:x,ReverseToggleEvent:C}}}const{MapLibreBasedGeocodingControl:_F,events:Qa}=RE(la.Evented,h3);Qa.SelectEvent;Qa.FeaturesListedEvent;Qa.FeaturesMarkedEvent;Qa.OptionsVisibilityChangeEvent;Qa.PickEvent;Qa.QueryChangeEvent;Qa.ResponseEvent;Qa.ReverseToggleEvent;function FE(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),he(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),he(e,"viewBox","0 0 14 14"),he(e,"width","13"),he(e,"height","13"),he(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),F(e,t)},p:at,i:at,o:at,d(n){n&&H(e)}}}class z2 extends Lt{constructor(e){super(),Et(this,e,null,FE,Tt,{})}}function OE(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),he(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),he(e,"viewBox","0 0 30 30"),he(e,"fill","none"),he(e,"xmlns","http://www.w3.org/2000/svg"),he(e,"class","svelte-d2loi5")},m(n,i){W(n,e,i),F(e,t)},p:at,i:at,o:at,d(n){n&&H(e)}}}class D2 extends Lt{constructor(e){super(),Et(this,e,null,OE,Tt,{})}}function $E(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"area.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"area.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&H(e)}}}function BE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"reverse.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"reverse.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&H(e)}}}function NE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"poi.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"poi.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&H(e)}}}function jE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"postal_code.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"postal_code.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&H(e)}}}function UE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"street.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"street.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&H(e)}}}function VE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"road.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"road.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&H(e)}}}function qE(r){let e,t;return{c(){e=U("img"),Sr(e.src,t=r[3]+"housenumber.svg")||he(e,"src",t),he(e,"alt",r[6]),he(e,"class","svelte-ltkwvy")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Sr(e.src,t=n[3]+"housenumber.svg")&&he(e,"src",t),i&64&&he(e,"alt",n[6])},d(n){n&&H(e)}}}function HE(r){let e,t,n,i;return{c(){e=U("img"),Sr(e.src,t=r[5])||he(e,"src",t),he(e,"alt",r[4]),he(e,"class","svelte-ltkwvy")},m(o,u){W(o,e,u),n||(i=It(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Sr(e.src,t=o[5])&&he(e,"src",t),u&16&&he(e,"alt",o[4])},d(o){o&&H(e),n=!1,i()}}}function B1(r){let e,t;return{c(){e=U("span"),t=Ee(r[6]),he(e,"class","secondary svelte-ltkwvy")},m(n,i){W(n,e,i),F(e,t)},p(n,i){i&64&&St(t,n[6])},d(n){n&&H(e)}}}function WE(r){let e,t,n,i,o,u,s,d,p,g=(r[7]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",_,x,C=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[7],M,P,A=(r[7]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",L,I,$;function O(Y,fe){return fe&1&&(t=null),fe&1&&(n=null),fe&1&&(i=null),fe&1&&(o=null),Y[5]?HE:Y[0].address?qE:(t==null&&(t=!!Y[0].id.startsWith("road.")),t?VE:(n==null&&(n=!!Y[0].id.startsWith("address.")),n?UE:(i==null&&(i=!!Y[0].id.startsWith("postal_code.")),i?jE:(o==null&&(o=!!Y[0].id.startsWith("poi.")),o?NE:Y[7]?BE:$E))))}let Z=O(r,-1),X=Z(r),q=C&&B1(r);return{c(){e=U("li"),X.c(),u=oe(),s=U("span"),d=U("span"),p=U("span"),_=Ee(g),x=oe(),q&&q.c(),M=oe(),P=U("span"),L=Ee(A),he(p,"class","primary svelte-ltkwvy"),he(d,"class","svelte-ltkwvy"),he(P,"class","line2 svelte-ltkwvy"),he(s,"class","texts svelte-ltkwvy"),he(e,"tabindex","0"),he(e,"data-selected",r[1]),he(e,"class","svelte-ltkwvy"),Gt(e,"selected",r[1])},m(Y,fe){W(Y,e,fe),X.m(e,null),F(e,u),F(e,s),F(s,d),F(d,p),F(p,_),F(d,x),q&&q.m(d,null),F(s,M),F(s,P),F(P,L),I||($=[It(e,"mouseenter",r[12]),It(e,"focus",r[13])],I=!0)},p(Y,[fe]){Z===(Z=O(Y,fe))&&X?X.p(Y,fe):(X.d(1),X=Z(Y),X&&(X.c(),X.m(e,u))),fe&1&&g!==(g=(Y[7]?Y[0].place_name:Y[0].place_name.replace(/,.*/,""))+"")&&St(_,g),fe&37&&(C=Y[2]==="always"||Y[2]!=="never"&&!Y[0].address&&!Y[0].id.startsWith("road.")&&!Y[0].id.startsWith("address.")&&!Y[0].id.startsWith("postal_code.")&&(!Y[0].id.startsWith("poi.")||!Y[5])&&!Y[7]),C?q?q.p(Y,fe):(q=B1(Y),q.c(),q.m(d,null)):q&&(q.d(1),q=null),fe&1&&A!==(A=(Y[7]?"":Y[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&St(L,A),fe&2&&he(e,"data-selected",Y[1]),fe&2&&Gt(e,"selected",Y[1])},i:at,o:at,d(Y){Y&&H(e),X.d(),q&&q.d(),I=!1,cr($)}}}function GE(r,e,t){var $;let n,i,{feature:o}=e,{selected:u=!1}=e,{showPlaceType:s}=e,{missingIconsCache:d}=e,{iconsBaseUrl:p}=e;const g=($=o.properties)==null?void 0:$.categories;let _,x,C=0,M=o.place_type[0]==="reverse";function P(){x&&d.add(x),t(10,C++,C)}function A(O){Pn.call(this,r,O)}function L(O){Pn.call(this,r,O)}const I=()=>P();return r.$$set=O=>{"feature"in O&&t(0,o=O.feature),"selected"in O&&t(1,u=O.selected),"showPlaceType"in O&&t(2,s=O.showPlaceType),"missingIconsCache"in O&&t(9,d=O.missingIconsCache),"iconsBaseUrl"in O&&t(3,p=O.iconsBaseUrl)},r.$$.update=()=>{var O,Z,X,q;if(r.$$.dirty&3640)do t(11,n--,n),t(4,_=g==null?void 0:g[n]),t(5,x=_?p+_.replace(/ /g,"_")+".svg":void 0);while(n>-1&&(!x||d.has(x)));r.$$.dirty&1&&t(6,i=((Z=(O=o.properties)==null?void 0:O.categories)==null?void 0:Z.join(", "))??((q=(X=o.properties)==null?void 0:X.place_type_name)==null?void 0:q[0])??o.place_type[0])},t(11,n=(g==null?void 0:g.length)??0),[o,u,s,p,_,x,i,M,P,d,C,n,A,L,I]}class ZE extends Lt{constructor(e){super(),Et(this,e,GE,WE,Tt,{feature:0,selected:1,showPlaceType:2,missingIconsCache:9,iconsBaseUrl:3})}}function KE(r){let e;return{c(){e=U("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',he(e,"class","svelte-7cmwmc")},m(t,n){W(t,e,n)},p:at,i:at,o:at,d(t){t&&H(e)}}}class XE extends Lt{constructor(e){super(),Et(this,e,null,KE,Tt,{})}}function YE(r){let e,t;return{c(){e=ws("svg"),t=ws("path"),he(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),he(e,"viewBox","0 0 60.006 21.412"),he(e,"width","14"),he(e,"height","20"),he(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),F(e,t)},p:at,i:at,o:at,d(n){n&&H(e)}}}class JE extends Lt{constructor(e){super(),Et(this,e,null,YE,Tt,{})}}function QE(r){let e,t,n;return{c(){e=ws("svg"),t=ws("circle"),n=ws("path"),he(t,"cx","4.789"),he(t,"cy","4.787"),he(t,"r","3.85"),he(t,"class","svelte-1aq105l"),he(n,"d","M12.063 12.063 7.635 7.635"),he(n,"class","svelte-1aq105l"),he(e,"xmlns","http://www.w3.org/2000/svg"),he(e,"width","13"),he(e,"height","13"),he(e,"viewBox","0 0 13 13"),he(e,"class","svelte-1aq105l")},m(i,o){W(i,e,o),F(e,t),F(e,n)},p:at,i:at,o:at,d(i){i&&H(e)}}}class eL extends Lt{constructor(e){super(),Et(this,e,null,QE,Tt,{})}}function tL(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function N1(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let yf;async function nL(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(yf&&i.cachedLocationExpiry&&yf.time+i.cachedLocationExpiry>Date.now()){if(!yf.coords)break e;return yf.coords}let o;try{return o=await new Promise((u,s)=>{t.signal.addEventListener("abort",()=>{s(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(p=>p.toFixed(6)).join(","))},d=>{s(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(yf={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const rL=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,j1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,U1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,V1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,q1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,H1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function iL(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(C=>Number(C.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",s=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${u}, ${o} ${s}`);const p=Math.floor(i),g=Math.floor(o),_=(i-p)*60,x=(o-g)*60;if(r=="DM"){let C=W1(_,3).toFixed(3).padStart(6,"0"),M=W1(x,3).toFixed(3).padStart(6,"0");C.endsWith(".000")&&M.endsWith(".000")&&(C=C.replace(/\.000$/,""),M=M.replace(/\.000$/,"")),d=`${p} ${C}' ${u}, ${g} ${M}' ${s}`}if(r=="DMS"){const C=Math.floor(_),M=Math.floor(x);let P=((_-C)*60).toFixed(1).padStart(4,"0"),A=((x-M)*60).toFixed(1).padStart(4,"0");const L=C.toString().padStart(2,"0"),I=M.toString().padStart(2,"0");P.endsWith(".0")&&A.endsWith(".0")&&(P=P.replace(/\.0$/,""),A=A.replace(/\.0$/,"")),d=`${p} ${L}' ${P}" ${u}, ${g} ${I}' ${A}" ${s}`}return d}else throw new Error("no decimal coordinates to convert")}function W1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function u_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,s=[],d=!1;if(rL.test(r))throw new Error("invalid coordinate value");if(j1.test(r))if(s=j1.exec(r),d=vf(s),d)t=Math.abs(s[1])+s[2]/60,Number(s[1])<0&&(t*=-1),n=Math.abs(s[3])+s[4]/60,Number(s[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(U1.test(r))if(s=U1.exec(r),d=vf(s),d){if(t=s[2],n=s[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");s[1]?(i=s[1],o=s[5]):s[4]&&(i=s[4],o=s[8])}else throw new Error("invalid decimal coordinate format");else if(V1.test(r))if(s=V1.exec(r),d=vf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[9])),s[11]&&(n+=s[11]/60),s[13]&&(n+=s[13].replace(",",".")/3600),parseInt(s[9])<0&&(n=-1*n),s[1]?(i=s[1],o=s[8]):s[7]&&(i=s[7],o=s[14]);else throw new Error("invalid DMS coordinates format");else if(q1.test(r))if(s=q1.exec(r),d=vf(s),d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4]/60,u="DM"),s[6]&&(t+=s[6]/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12]/60),s[14]&&(n+=s[14]/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid DMS coordinates format");else if(H1.test(r)){if(s=H1.exec(r),d=vf(s),s.filter(p=>p).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(s[2])),s[4]&&(t+=s[4].replace(",",".")/60,u="DM"),s[6]&&(t+=s[6].replace(",",".")/3600,u="DMS"),parseInt(s[2])<0&&(t=-1*t),n=Math.abs(parseInt(s[10])),s[12]&&(n+=s[12].replace(",",".")/60),s[14]&&(n+=s[14].replace(",",".")/3600),parseInt(s[10])<0&&(n=-1*n),s[1]?(i=s[1],o=s[9]):s[8]&&(i=s[8],o=s[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let p=/S|SOUTH/i;p.test(i)&&t>0&&(t=-1*t),p=/W|WEST/i,p.test(o)&&n>0&&(n=-1*n);const g=s[0].trim();let _,x;const C=/[,/;\u0020]/g,M=g.match(C);if(M==null){const L=Math.floor(r.length/2);_=g.substring(0,L).trim(),x=g.substring(L).trim()}else{let L;M.length%2==1?L=Math.floor(M.length/2):L=M.length/2-1;let I=0;if(L==0)I=g.indexOf(M[0]),_=g.substring(0,I).trim(),x=g.substring(I+1).trim();else{let $=0,O=0;for(;$<=L;)I=g.indexOf(M[$],O),O=I+1,$++;_=g.substring(0,I).trim(),x=g.substring(I+1).trim()}}const P=_.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");const A=x.split(".");if(A.length==2&&A[1]==0&&A[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(_)||/^\d+$/.test(x))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:g,verbatimLatitude:_,verbatimLongitude:x,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:oL,toCoordinateFormat:iL})}else throw new Error("coordinates pattern match failed")}function vf(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],s=e[o+i],d=t.test(u)&&t.test(s),p=n.test(u)&&n.test(s),g=u==s;if(!(u==null&&s==null)){if(u==null||s==null)return!1;if(d||p||g)continue;return!1}}return!0}function G1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function oL(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return G1(this.decimalLatitude,Number(e[0]))&&G1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const sL=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});u_.to=sL;const aL=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],lL={decimalLatitude:40.123,decimalLongitude:-74.123},uL=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],cL=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function fL(){const r=[];return aL.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...lL})}),[...r,...uL,...cL]}const hL=fL();u_.formats=hL.map(r=>r.verbatimCoordinates);const dL=u_;function Z1(r,e,t){const n=r.slice();return n[84]=e[t],n[86]=t,n}function K1(r){let e,t;return e=new XE({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function X1(r){let e,t,n,i,o;return t=new JE({}),{c(){e=U("button"),ue(t.$$.fragment),he(e,"type","button"),he(e,"title",r[9]),he(e,"class","svelte-bz0zu3"),Gt(e,"active",r[0])},m(u,s){W(u,e,s),ae(t,e,null),n=!0,i||(o=It(e,"click",r[69]),i=!0)},p(u,s){(!n||s[0]&512)&&he(e,"title",u[9]),(!n||s[0]&1)&&Gt(e,"active",u[0])},i(u){n||(N(t.$$.fragment,u),n=!0)},o(u){V(t.$$.fragment,u),n=!1},d(u){u&&H(e),le(t),i=!1,o()}}}function pL(r){let e,t=[],n=new Map,i,o,u,s=$n(r[14]);const d=p=>p[84].id+(p[84].address?","+p[84].address:"");for(let p=0;p<s.length;p+=1){let g=Z1(r,s,p),_=d(g);n.set(_,t[p]=Y1(_,g))}return{c(){e=U("ul");for(let p=0;p<t.length;p+=1)t[p].c();he(e,"class","options svelte-bz0zu3")},m(p,g){W(p,e,g);for(let _=0;_<t.length;_+=1)t[_]&&t[_].m(e,null);i=!0,o||(u=[It(e,"mouseleave",r[73]),It(e,"blur",r[74])],o=!0)},p(p,g){g[0]&17880064&&(s=$n(p[14]),Xt(),t=n3(t,g,d,1,p,s,n,e,t3,Y1,null,Z1),Yt())},i(p){if(!i){for(let g=0;g<s.length;g+=1)N(t[g]);i=!0}},o(p){for(let g=0;g<t.length;g+=1)V(t[g]);i=!1},d(p){p&&H(e);for(let g=0;g<t.length;g+=1)t[g].d();o=!1,cr(u)}}}function mL(r){let e,t,n,i,o,u;return t=new D2({}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),o=Ee(r[7]),he(i,"class","svelte-bz0zu3"),he(e,"class","no-results svelte-bz0zu3")},m(s,d){W(s,e,d),ae(t,e,null),F(e,n),F(e,i),F(i,o),u=!0},p(s,d){(!u||d[0]&128)&&St(o,s[7])},i(s){u||(N(t.$$.fragment,s),u=!0)},o(s){V(t.$$.fragment,s),u=!1},d(s){s&&H(e),le(t)}}}function gL(r){let e="",t;return{c(){t=Ee(e)},m(n,i){W(n,t,i)},p:at,i:at,o:at,d(n){n&&H(t)}}}function _L(r){let e,t,n,i,o,u,s,d,p,g,_;return t=new D2({}),d=new z2({}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),o=Ee(r[6]),u=oe(),s=U("button"),ue(d.$$.fragment),he(i,"class","svelte-bz0zu3"),he(s,"class","svelte-bz0zu3"),he(e,"class","error svelte-bz0zu3")},m(x,C){W(x,e,C),ae(t,e,null),F(e,n),F(e,i),F(i,o),F(e,u),F(e,s),ae(d,s,null),p=!0,g||(_=It(s,"click",r[70]),g=!0)},p(x,C){(!p||C[0]&64)&&St(o,x[6])},i(x){p||(N(t.$$.fragment,x),N(d.$$.fragment,x),p=!0)},o(x){V(t.$$.fragment,x),V(d.$$.fragment,x),p=!1},d(x){x&&H(e),le(t),le(d),g=!1,_()}}}function Y1(r,e){let t,n,i;function o(){return e[71](e[86])}function u(){return e[72](e[84])}return n=new ZE({props:{feature:e[84],showPlaceType:e[10],selected:e[15]===e[86],missingIconsCache:e[20],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("focus",u),{key:r,first:null,c(){t=tr(),ue(n.$$.fragment),this.first=t},m(s,d){W(s,t,d),ae(n,s,d),i=!0},p(s,d){e=s;const p={};d[0]&16384&&(p.feature=e[84]),d[0]&1024&&(p.showPlaceType=e[10]),d[0]&49152&&(p.selected=e[15]===e[86]),d[0]&4096&&(p.iconsBaseUrl=e[12]),n.$set(p)},i(s){i||(N(n.$$.fragment,s),i=!0)},o(s){V(n.$$.fragment,s),i=!1},d(s){s&&H(t),le(n,s)}}}function yL(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z,X=!1;o=new eL({}),_=new z2({});let q=r[19]&&K1(),Y=r[5]==="button"&&X1(r);const fe=r[61].default,Le=vn(fe,r,r[60],null),ee=[_L,gL,mL,pL],ie=[];function ve(ye,it){var Fe,Ne;return ye[18]?0:ye[16]?((Fe=ye[14])==null?void 0:Fe.length)===0?2:ye[16]&&((Ne=ye[14])!=null&&Ne.length)?3:-1:1}return~(A=ve(r))&&(L=ie[A]=ee[A](r)),{c(){e=oe(),t=U("form"),n=U("div"),i=U("button"),ue(o.$$.fragment),u=oe(),s=U("input"),d=oe(),p=U("div"),g=U("button"),ue(_.$$.fragment),x=oe(),q&&q.c(),C=oe(),Y&&Y.c(),M=oe(),Le&&Le.c(),P=oe(),L&&L.c(),he(i,"class","search-button svelte-bz0zu3"),he(i,"type","button"),he(s,"placeholder",r[8]),he(s,"aria-label",r[8]),he(s,"class","svelte-bz0zu3"),he(g,"type","button"),he(g,"title",r[3]),he(g,"class","svelte-bz0zu3"),he(p,"class","clear-button-container svelte-bz0zu3"),Gt(p,"displayable",r[1]!==""),he(n,"class","input-group svelte-bz0zu3"),he(t,"tabindex","0"),he(t,"class",I=ec(r[2])+" svelte-bz0zu3"),Gt(t,"can-collapse",r[4]&&r[1]==="")},m(ye,it){W(ye,e,it),W(ye,t,it),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),r[63](s),Zn(s,r[1]),F(n,d),F(n,p),F(p,g),ae(_,g,null),F(p,x),q&&q.m(p,null),F(n,C),Y&&Y.m(n,null),F(n,M),Le&&Le.m(n,null),F(t,P),~A&&ie[A].m(t,null),$=!0,O||(Z=[It(i,"click",r[62]),It(s,"input",r[64]),It(s,"focus",r[65]),It(s,"blur",r[66]),It(s,"keydown",r[22]),It(s,"input",r[67]),It(g,"click",r[68]),It(t,"submit",Ag(r[21]))],O=!0)},p(ye,it){(!$||it[0]&256)&&he(s,"placeholder",ye[8]),(!$||it[0]&256)&&he(s,"aria-label",ye[8]),it[0]&2&&s.value!==ye[1]&&Zn(s,ye[1]),(!$||it[0]&8)&&he(g,"title",ye[3]),ye[19]?q?it[0]&524288&&N(q,1):(q=K1(),q.c(),N(q,1),q.m(p,null)):q&&(Xt(),V(q,1,1,()=>{q=null}),Yt()),(!$||it[0]&2)&&Gt(p,"displayable",ye[1]!==""),ye[5]==="button"?Y?(Y.p(ye,it),it[0]&32&&N(Y,1)):(Y=X1(ye),Y.c(),N(Y,1),Y.m(n,M)):Y&&(Xt(),V(Y,1,1,()=>{Y=null}),Yt()),Le&&Le.p&&(!$||it[1]&536870912)&&wn(Le,fe,ye,ye[60],$?bn(fe,ye[60],it,null):xn(ye[60]),null);let Fe=A;A=ve(ye),A===Fe?~A&&ie[A].p(ye,it):(L&&(Xt(),V(ie[Fe],1,1,()=>{ie[Fe]=null}),Yt()),~A?(L=ie[A],L?L.p(ye,it):(L=ie[A]=ee[A](ye),L.c()),N(L,1),L.m(t,null)):L=null),(!$||it[0]&4&&I!==(I=ec(ye[2])+" svelte-bz0zu3"))&&he(t,"class",I),(!$||it[0]&22)&&Gt(t,"can-collapse",ye[4]&&ye[1]==="")},i(ye){$||(N(X),N(o.$$.fragment,ye),N(_.$$.fragment,ye),N(q),N(Y),N(Le,ye),N(L),$=!0)},o(ye){V(X),V(o.$$.fragment,ye),V(_.$$.fragment,ye),V(q),V(Y),V(Le,ye),V(L),$=!1},d(ye){ye&&(H(e),H(t)),le(o),r[63](null),le(_),q&&q.d(),Y&&Y.d(),Le&&Le.d(ye),~A&&ie[A].d(),O=!1,cr(Z)}}}function vL(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e;const s={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:d=void 0}=e,{apiKey:p}=e,{bbox:g=void 0}=e,{clearButtonTitle:_="clear"}=e,{clearOnBlur:x=!1}=e,{collapsed:C=!1}=e,{country:M=void 0}=e,{debounceSearch:P=200}=e,{enableReverse:A="never"}=e,{errorMessage:L="Something went wrong"}=e,{filter:I=()=>!0}=e,{flyTo:$=!0}=e,{fuzzyMatch:O=!0}=e,{language:Z=void 0}=e,{limit:X=void 0}=e,{mapController:q=void 0}=e,{minLength:Y=2}=e,{noResultsMessage:fe="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Le="Search"}=e,{proximity:ee=[{type:"server-geolocation"}]}=e,{reverseActive:ie=A==="always"}=e,{reverseButtonTitle:ve="toggle reverse geocoding"}=e,{searchValue:ye=""}=e,{pickedResultStyle:it="full-geometry"}=e,{showPlaceType:Fe="if-needed"}=e,{showResultsWhileTyping:Ne=!0}=e,{selectFirst:Ae=!0}=e,{flyToSelected:ot=!1}=e,{markerOnSelected:Ye=!0}=e,{types:ut=void 0}=e,{exhaustiveReverseGeocoding:pt=!1}=e,{excludeTypes:_t=!1}=e,{zoom:He=s}=e,{apiUrl:mt="https://api.maptiler.com/geocoding"}=e,{fetchParameters:Pt={}}=e,{iconsBaseUrl:jt="https://cdn.maptiler.com/maptiler-geocoding-control/v2.0.1/icons/"}=e,{adjustUrlQuery:un=()=>{}}=e;function nn(){Xe.focus()}function rn(){Xe.blur()}function pn(re,Je=!0,et=!1){t(1,ye=re),Je?(t(15,lt=-1),xt()):(bt(!et,et),setTimeout(()=>{Xe.focus(),Xe.select()}))}function yn(){t(14,Ke=void 0),t(56,pe=void 0),t(15,lt=-1)}function qe(){t(55,kt=[]),t(56,pe=void 0)}let We=!1,Ke,kt,pe,fn="",Xe,lt=-1,Wt,Xn=[],Wn,fr,Tr,Cr;const xi=new Set,Un=Ns();ri(()=>{q&&(q.setEventHandler(void 0),q.indicateReverse(!1),q.setSelectedMarker(-1),q.setFeatures(void 0,void 0,!1))});function xt(re){if(fr&&(clearTimeout(fr),fr=void 0),lt>-1&&Ke)t(56,pe=Ke[lt]),t(1,ye=pe.place_type[0]==="reverse"?pe.place_name:pe.place_name.replace(/,.*/,"")),t(18,Wt=void 0),t(55,kt=void 0),t(15,lt=-1);else if(ye){const Je=re||!Pr(ye);vr(ye,{exact:!0}).then(()=>{t(55,kt=Ke),t(56,pe=void 0),Je&&Ri()}).catch(et=>t(18,Wt=et))}}function Pr(re){try{return dL(re,6)}catch{return!1}}async function vr(re,{byId:Je=!1,exact:et=!1}={}){t(18,Wt=void 0),Wn==null||Wn.abort();const nt=new AbortController;t(19,Wn=nt);try{const ht=Pr(re),Dt=new URLSearchParams;if(Z!==void 0&&Dt.set("language",Array.isArray(Z)?Z.join(","):Z??""),ut&&Dt.set("types",ut.join(",")),_t&&Dt.set("excludeTypes",String(_t)),g&&Dt.set("bbox",g.map(Nn=>Nn.toFixed(6)).join(",")),M&&Dt.set("country",Array.isArray(M)?M.join(","):M),!Je&&!ht){const Nn=await nL(q,ee,nt);Nn&&Dt.set("proximity",Nn),(et||!Ne)&&Dt.set("autocomplete","false"),Dt.set("fuzzyMatch",String(O))}X!==void 0&&(pt||!ht||(ut==null?void 0:ut.length)===1)&&Dt.set("limit",String(X)),Dt.set("key",p),un(Dt);const en=mt+"/"+encodeURIComponent(ht?ht.decimalLongitude+","+ht.decimalLatitude:re)+".json?"+Dt.toString();if(en===fn){Je?(t(14,Ke=void 0),t(56,pe=Xn[0])):t(14,Ke=Xn);return}fn=en;const mn=await fetch(en,{signal:nt.signal,...Pt});if(!mn.ok)throw new Error(await mn.text());const Cn=await mn.json();Un("response",{url:en,featureCollection:Cn}),Je?(t(14,Ke=void 0),t(56,pe=Cn.features[0]),Xn=[pe]):(t(14,Ke=Cn.features.filter(I)),ht&&Ke.unshift({type:"Feature",properties:{},id:"reverse_"+ht.decimalLongitude+"_"+ht.decimalLatitude,text:ht.decimalLatitude+", "+ht.decimalLongitude,place_name:ht.decimalLatitude+", "+ht.decimalLongitude,place_type:["reverse"],center:[ht.decimalLongitude,ht.decimalLatitude],bbox:[ht.decimalLongitude,ht.decimalLatitude,ht.decimalLongitude,ht.decimalLatitude],geometry:{type:"Point",coordinates:[ht.decimalLongitude,ht.decimalLatitude]}}),Xn=Ke,ht&&Xe.focus())}catch(ht){if(ht&&typeof ht=="object"&&"name"in ht&&ht.name==="AbortError")return;throw ht}finally{nt===Wn&&t(19,Wn=void 0)}}function Ri(){var nt;if(!(kt!=null&&kt.length)||!$)return;const re=[180,90,-180,-90],Je=!kt.some(ht=>!ht.matching_text);let et;for(const ht of kt){const Dt=Bn(ht);if(et=et===void 0?Dt:Dt===void 0?et:Math.max(et,Dt),Je||!ht.matching_text)for(const en of[0,1,2,3])re[en]=Math[en<2?"min":"max"](re[en],((nt=ht.bbox)==null?void 0:nt[en])??ht.center[en%2])}q&&kt.length>0&&(pe&&re[0]===re[2]&&re[1]===re[3]?q.flyTo(pe.center,Bn(pe)):q.fitBounds(N1(re),50,et))}function Bn(re){var et;if(!re.bbox||re.bbox[0]!==re.bbox[2]&&re.bbox[1]!==re.bbox[3])return;const Je=re.id.replace(/\..*/,"");return(Array.isArray((et=re.properties)==null?void 0:et.categories)?re.properties.categories.reduce((nt,ht)=>{const Dt=He[Je+"."+ht];return nt===void 0?Dt:Dt===void 0?nt:Math.max(nt,Dt)},void 0):void 0)??He[Je]}function Oe(re){t(0,ie=A==="always"),t(14,Ke=void 0),t(56,pe=void 0),t(15,lt=-1),pn(re[1].toFixed(6)+", "+tL(re[0],[-180,180],!0).toFixed(6),!1,!0)}function yt(re){if(!Ke)return;let Je=re.key==="ArrowDown"?1:re.key==="ArrowUp"?-1:0;Je&&(lt===(Ae?0:-1)&&Je===-1&&t(15,lt=Ke.length),t(15,lt+=Je),lt>=Ke.length&&t(15,lt=-1),lt<0&&Ae&&t(15,lt=0),re.preventDefault())}function bt(re=!0,Je=!1){if(t(18,Wt=void 0),Ne||Je){if(fr&&clearTimeout(fr),ye.length<Y)return;const et=ye;fr=window.setTimeout(()=>{vr(et).catch(nt=>t(18,Wt=nt))},re?P:0)}else t(14,Ke=void 0),t(18,Wt=void 0)}function Rt(re){t(56,pe=re),t(1,ye=re.place_name),t(15,lt=-1)}const Qt=()=>Xe.focus();function Jt(re){dn[re?"unshift":"push"](()=>{Xe=re,t(17,Xe)})}function yr(){ye=this.value,t(1,ye),t(13,We),t(28,x)}const or=()=>t(13,We=!0),Te=()=>t(13,We=!1),ne=()=>bt(),ce=()=>{t(1,ye=""),Xe.focus()},ge=()=>t(0,ie=!ie),xe=()=>t(18,Wt=void 0),$e=re=>t(15,lt=re),Be=re=>Rt(re),Ue=()=>{Ae||t(15,lt=-1)},ze=()=>{};return r.$$set=re=>{"class"in re&&t(2,d=re.class),"apiKey"in re&&t(26,p=re.apiKey),"bbox"in re&&t(27,g=re.bbox),"clearButtonTitle"in re&&t(3,_=re.clearButtonTitle),"clearOnBlur"in re&&t(28,x=re.clearOnBlur),"collapsed"in re&&t(4,C=re.collapsed),"country"in re&&t(29,M=re.country),"debounceSearch"in re&&t(30,P=re.debounceSearch),"enableReverse"in re&&t(5,A=re.enableReverse),"errorMessage"in re&&t(6,L=re.errorMessage),"filter"in re&&t(31,I=re.filter),"flyTo"in re&&t(32,$=re.flyTo),"fuzzyMatch"in re&&t(33,O=re.fuzzyMatch),"language"in re&&t(34,Z=re.language),"limit"in re&&t(35,X=re.limit),"mapController"in re&&t(36,q=re.mapController),"minLength"in re&&t(37,Y=re.minLength),"noResultsMessage"in re&&t(7,fe=re.noResultsMessage),"placeholder"in re&&t(8,Le=re.placeholder),"proximity"in re&&t(38,ee=re.proximity),"reverseActive"in re&&t(0,ie=re.reverseActive),"reverseButtonTitle"in re&&t(9,ve=re.reverseButtonTitle),"searchValue"in re&&t(1,ye=re.searchValue),"pickedResultStyle"in re&&t(39,it=re.pickedResultStyle),"showPlaceType"in re&&t(10,Fe=re.showPlaceType),"showResultsWhileTyping"in re&&t(40,Ne=re.showResultsWhileTyping),"selectFirst"in re&&t(11,Ae=re.selectFirst),"flyToSelected"in re&&t(41,ot=re.flyToSelected),"markerOnSelected"in re&&t(42,Ye=re.markerOnSelected),"types"in re&&t(43,ut=re.types),"exhaustiveReverseGeocoding"in re&&t(44,pt=re.exhaustiveReverseGeocoding),"excludeTypes"in re&&t(45,_t=re.excludeTypes),"zoom"in re&&t(46,He=re.zoom),"apiUrl"in re&&t(47,mt=re.apiUrl),"fetchParameters"in re&&t(48,Pt=re.fetchParameters),"iconsBaseUrl"in re&&t(12,jt=re.iconsBaseUrl),"adjustUrlQuery"in re&&t(49,un=re.adjustUrlQuery),"$$scope"in re&&t(60,u=re.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&32&&t(0,ie=A==="always"),r.$$.dirty[0]&268443648&&setTimeout(()=>{t(16,Tr=We),x&&!We&&t(1,ye="")}),r.$$.dirty[0]&16386|r.$$.dirty[1]&64&&ye.length<Y&&(t(56,pe=void 0),t(14,Ke=void 0),t(18,Wt=void 0),t(55,kt=Ke)),r.$$.dirty[1]&33554688&&it!=="marker-only"&&pe&&!pe.address&&pe.geometry.type==="Point"&&pe.place_type[0]!=="reverse"&&vr(pe.id,{byId:!0}).catch(re=>t(18,Wt=re)),r.$$.dirty[1]&100663330&&(q&&pe&&pe.id!==Cr&&$&&(!pe.bbox||pe.bbox[0]===pe.bbox[2]&&pe.bbox[1]===pe.bbox[3]?q.flyTo(pe.center,Bn(pe)):q.fitBounds(N1(pe.bbox),50,Bn(pe)),t(14,Ke=void 0),t(55,kt=void 0),t(15,lt=-1)),t(57,Cr=pe==null?void 0:pe.id)),r.$$.dirty[0]&18432&&Ae&&Ke!=null&&Ke.length&&t(15,lt=0),r.$$.dirty[0]&2&&t(15,lt=-1),r.$$.dirty[0]&16384|r.$$.dirty[1]&16777216&&kt!==Ke&&t(55,kt=void 0),r.$$.dirty[0]&81921|r.$$.dirty[1]&16777248&&q&&q.setEventHandler(re=>{switch(re.type){case"mapClick":ie&&Oe(re.coordinates);break;case"markerClick":{const Je=Ke==null?void 0:Ke.find(et=>et.id===re.id);Je&&Rt(Je)}break;case"markerMouseEnter":kt&&t(15,lt=Tr?(Ke==null?void 0:Ke.findIndex(Je=>Je.id===re.id))??-1:-1);break;case"markerMouseLeave":kt&&t(15,lt=-1);break}}),r.$$.dirty[0]&49152&&t(58,i=Ke==null?void 0:Ke[lt]),r.$$.dirty[1]&134218786&&q&&i&&$&&ot&&q.flyTo(i.center,Bn(i)),r.$$.dirty[1]&256&&t(59,n=it==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&268437536&&(Ye||q==null||q.setFeatures(void 0,void 0,n)),r.$$.dirty[1]&419432480&&q&&Ye&&!kt&&(q.setFeatures(i?[i]:void 0,void 0,n),q.setSelectedMarker(i?0:-1)),r.$$.dirty[1]&318767136&&q&&q.setFeatures(kt,pe,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&16777248&&kt&&q&&q.setSelectedMarker(lt),r.$$.dirty[0]&2|r.$$.dirty[1]&32&&q){const re=Pr(ye);q.setReverseMarker(re?[re.decimalLongitude,re.decimalLatitude]:void 0)}r.$$.dirty[1]&134217728&&Un("select",{feature:i}),r.$$.dirty[1]&33554432&&Un("pick",{feature:pe}),r.$$.dirty[0]&81920&&Un("optionsvisibilitychange",{optionsVisible:Tr&&!!Ke}),r.$$.dirty[0]&16384&&Un("featureslisted",{features:Ke}),r.$$.dirty[1]&16777216&&Un("featuresmarked",{features:kt}),r.$$.dirty[0]&1&&Un("reversetoggle",{reverse:ie}),r.$$.dirty[0]&2&&Un("querychange",{query:ye}),r.$$.dirty[0]&1|r.$$.dirty[1]&32&&q&&q.indicateReverse(ie)},[ie,ye,d,_,C,A,L,fe,Le,ve,Fe,Ae,jt,We,Ke,lt,Tr,Xe,Wt,Wn,xi,xt,yt,bt,Rt,s,p,g,x,M,P,I,$,O,Z,X,q,Y,ee,it,Ne,ot,Ye,ut,pt,_t,He,mt,Pt,un,nn,rn,pn,yn,qe,kt,pe,Cr,i,n,u,o,Qt,Jt,yr,or,Te,ne,ce,ge,xe,$e,Be,Ue,ze]}class bL extends Lt{constructor(e){super(),Et(this,e,vL,yL,Tt,{ZOOM_DEFAULTS:25,class:2,apiKey:26,bbox:27,clearButtonTitle:3,clearOnBlur:28,collapsed:4,country:29,debounceSearch:30,enableReverse:5,errorMessage:6,filter:31,flyTo:32,fuzzyMatch:33,language:34,limit:35,mapController:36,minLength:37,noResultsMessage:7,placeholder:8,proximity:38,reverseActive:0,reverseButtonTitle:9,searchValue:1,pickedResultStyle:39,showPlaceType:10,showResultsWhileTyping:40,selectFirst:11,flyToSelected:41,markerOnSelected:42,types:43,exhaustiveReverseGeocoding:44,excludeTypes:45,zoom:46,apiUrl:47,fetchParameters:48,iconsBaseUrl:12,adjustUrlQuery:49,focus:50,blur:51,setQuery:52,clearList:53,clearMap:54},null,[-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[25]}get focus(){return this.$$.ctx[50]}get blur(){return this.$$.ctx[51]}get setQuery(){return this.$$.ctx[52]}get clearList(){return this.$$.ctx[53]}get clearMap(){return this.$$.ctx[54]}}function J1(r){let e,t,n;return t=new bL({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"class","svelte-ixhnie")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&4&&(u.mapController=i[2]),o&1&&(u.apiKey=i[0]),o&2&&(u.country=i[1]),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function wL(r){let e,t,n=r[2]&&J1(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&N(n,1)):(n=J1(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function xL(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:u}=e,s=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function d(p){return p?P2(p,ni,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=p=>{"apiKey"in p&&t(0,i=p.apiKey),"map"in p&&t(4,o=p.map),"country"in p&&t(1,u=p.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=d(o))},[i,u,n,s,o]}class kL extends Lt{constructor(e){super(),Et(this,e,xL,wL,Tt,{apiKey:0,map:4,country:1})}}const SL=Symbol.for("svelte-maplibre");function TL(){return Qf(SL)}function CL(r){return"layerType"in r&&r.layerType==="deckgl"}const ML=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),Q1=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function ev(r){let e,t,n=(r[4]||r[3]instanceof ni.Marker)&&tv(r);return{c(){e=U("div"),n&&n.c()},m(i,o){W(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof ni.Marker?n?(n.p(i,o),o[0]&24&&N(n,1)):(n=tv(i),n.c(),N(n,1),n.m(e,null)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(),r[32](null)}}}function tv(r){let e;const t=r[30].default,n=vn(t,r,r[29],Q1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&wn(n,t,i,i[29],e?bn(t,i[29],o,ML):xn(i[29]),Q1)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function EL(r){let e,t,n=r[9].default&&ev(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=ev(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function LL(r,e,t){let n,i,o,u,s,d,{$$slots:p={},$$scope:g}=e;const _=Ig(p);let{closeButton:x=void 0}=e,{closeOnClickOutside:C=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:P=!1}=e,{openOn:A="click"}=e,{openIfTopMost:L=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:$=void 0}=e,{offset:O=void 0}=e,{popupClass:Z=void 0}=e,{maxWidth:X=void 0}=e,{lngLat:q=void 0}=e,{html:Y=void 0}=e,{open:fe=!1}=e;const Le=Ns(),{map:ee,popupTarget:ie,layerEvent:ve,layer:ye,eventTopMost:it}=TL();ct(r,ee,We=>t(2,o=We)),ct(r,ie,We=>t(3,s=We)),ct(r,ve,We=>t(28,u=We)),ct(r,ye,We=>t(35,d=We));const Fe=["click","dblclick","contextmenu"];let Ne,Ae=!1,ot;function Ye(){if(!Ne)return;let We=Ne.getElement();!We||We===ot||(ot=We,A==="hover"&&(ot.style.pointerEvents="none"),ot.addEventListener("mouseenter",()=>{t(24,Ae=!0)},{passive:!0}),ot.addEventListener("mouseleave",()=>{t(24,Ae=!1)},{passive:!0}),ot.addEventListener("click",()=>{M&&t(0,fe=!1)},{passive:!0}))}Ss(()=>{if(o)return o.on("click",rn),o.on("contextmenu",rn),typeof s=="string"&&(o.on("click",s,He),o.on("dblclick",s,He),o.on("contextmenu",s,He),o.on("mousemove",s,nn),o.on("mouseleave",s,un),o.on("touchstart",s,Pt),o.on("touchend",s,jt)),()=>{o!=null&&o.loaded()&&(Ne==null||Ne.remove(),o.off("click",rn),o.off("contextmenu",rn),s instanceof ni.Marker?s.getPopup()===Ne&&s.setPopup(void 0):typeof s=="string"&&(o.off("click",s,He),o.off("dblclick",s,He),o.off("contextmenu",s,He),o.off("mousemove",s,nn),o.off("mouseleave",s,un),o.off("touchstart",s,Pt),o.off("touchend",s,jt)))}});function ut(We){return L?!("marker"in We)&&!CL(We)&&it(We)!==d:!1}let pt=null,_t="normal";function He(We){We.type===A&&(ut(We)||("layerType"in We?We.layerType==="deckgl"?(t(10,q=We.coordinate),t(4,pt=We.object?[We.object]:null)):(t(10,q=We.lngLat),t(4,pt=We.features??[])):(t(10,q=We.lngLat),t(4,pt=We.features??[])),setTimeout(()=>t(0,fe=!0))))}let mt=null;function Pt(We){mt=We.point}function jt(We){if(!mt||A!=="hover")return;let Ke=mt.dist(We.point);mt=null,Ke<3&&(t(10,q=We.lngLat),t(4,pt=We.features??[]),Ne.isOpen()?t(25,_t="justOpened"):(t(25,_t="opening"),t(0,fe=!0)))}function un(We){A!=="hover"||mt||_t!=="normal"||(t(0,fe=!1),t(4,pt=null))}function nn(We){if(!(A!=="hover"||mt||_t!=="normal")){if(ut(We)){t(0,fe=!1),t(4,pt=null);return}t(0,fe=!0),t(4,pt=We.features??[]),t(10,q=We.lngLat)}}function rn(We){if(_t==="justOpened"){t(25,_t="normal");return}if(!C)return;let Ke=[ot,s instanceof ni.Marker?s==null?void 0:s.getElement():null];fe&&Ne.isOpen()&&!Ke.some(kt=>kt==null?void 0:kt.contains(We.originalEvent.target))&&(We.type==="contextmenu"&&A==="contextmenu"||We.type!=="contextmenu")&&t(0,fe=!1)}ri(()=>{o&&(Ne!=null&&Ne.isOpen())&&Ne.remove()});let pn;const yn=()=>t(0,fe=!1);function qe(We){dn[We?"unshift":"push"](()=>{pn=We,t(1,pn)})}return r.$$set=We=>{"closeButton"in We&&t(11,x=We.closeButton),"closeOnClickOutside"in We&&t(12,C=We.closeOnClickOutside),"closeOnClickInside"in We&&t(13,M=We.closeOnClickInside),"closeOnMove"in We&&t(14,P=We.closeOnMove),"openOn"in We&&t(15,A=We.openOn),"openIfTopMost"in We&&t(16,L=We.openIfTopMost),"focusAfterOpen"in We&&t(17,I=We.focusAfterOpen),"anchor"in We&&t(18,$=We.anchor),"offset"in We&&t(19,O=We.offset),"popupClass"in We&&t(20,Z=We.popupClass),"maxWidth"in We&&t(21,X=We.maxWidth),"lngLat"in We&&t(10,q=We.lngLat),"html"in We&&t(22,Y=We.html),"open"in We&&t(0,fe=We.open),"$$scope"in We&&t(29,g=We.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=x??(!C&&!M)),r.$$.dirty[0]&146685952&&(Ne||(t(23,Ne=new ni.Popup({closeButton:n,closeOnClick:!1,closeOnMove:P,focusAfterOpen:I,maxWidth:X,className:Z,anchor:$,offset:O})),ot=Ne.getElement(),Ne.on("open",()=>{t(0,fe=!0),Ye(),Le("open",Ne)}),Ne.on("close",()=>{t(0,fe=!1),Le("close",Ne)}),Ne.on("hover",()=>{Le("hover",Ne)}))),r.$$.dirty[0]&8421384&&Ne&&s instanceof ni.Marker&&(A==="click"?s.setPopup(Ne):s.getPopup()===Ne&&s.setPopup(void 0)),r.$$.dirty[0]&268468224&&Fe.includes(A)&&(u==null?void 0:u.type)===A&&(He(u),ln(ve,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=A==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&A==="hover"&&ve&&(i&&u&&(u.layerType==="deckgl"?(t(10,q=u.coordinate),t(4,pt=u.object?[u.object]:null)):(t(10,q=u.lngLat),t(4,pt=u.features??[]))),t(0,fe=(i||Ae)??!1)),r.$$.dirty[0]&12582914&&(pn?Ne.setDOMContent(pn):Y&&Ne.setHTML(Y)),r.$$.dirty[0]&8389632&&q&&Ne.setLngLat(q),r.$$.dirty[0]&41943045&&o){let We=Ne.isOpen();fe&&!We?(Ne.addTo(o),_t==="opening"&&t(25,_t="justOpened")):!fe&&We&&Ne.remove()}},[fe,pn,o,s,pt,ee,ie,ve,ye,_,q,x,C,M,P,A,L,I,$,O,Z,X,Y,Ne,Ae,_t,i,n,u,g,p,yn,qe]}class IL extends Lt{constructor(e){super(),Et(this,e,LL,EL,Tt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const AL=r=>({props:r&8}),nv=r=>({props:DL(r[3])});function PL(r){let e;const t=r[1].default,n=vn(t,r,r[2],nv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&wn(n,t,i,i[2],e?bn(t,i[2],o,AL):xn(i[2]),nv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function zL(r){let e,t;return e=new IL({props:{openOn:r[0],$$slots:{default:[PL,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function DL(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function RL(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=u=>{"openOn"in u&&t(0,o=u.openOn),"$$scope"in u&&t(2,i=u.$$scope)},[o,n,i]}class pi extends Lt{constructor(e){super(),Et(this,e,RL,zL,Tt,{openOn:0})}}function No(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function fo(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function Ji(){return{type:"FeatureCollection",features:[]}}function FL(r){let e,t,n;return t=new Vo({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function OL(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function $L(r){let e,t,n;return t=new Vo({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function BL(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function NL(r){let e,t,n;return t=new i_({props:{labelColors:r[5]}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function jL(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function UL(r){let e,t,n,i,o,u;const s=[_n("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":No(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":ra(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let d={};for(let C=0;C<s.length;C+=1)d=zt(d,s[C]);e=new ur({props:d});const p=[_n("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":No(["get","Level of Service"],r[4],"cyan"),"line-width":ra(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let g={};for(let C=0;C<p.length;C+=1)g=zt(g,p[C]);n=new ur({props:g});const _=[_n("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":No(["get","Infrastructure type"],r[5],"cyan"),"line-width":ra(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={};for(let C=0;C<_.length;C+=1)x=zt(x,_[C]);return o=new ur({props:x}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment)},m(C,M){ae(e,C,M),W(C,t,M),ae(n,C,M),W(C,i,M),ae(o,C,M),u=!0},p(C,M){const P=M&9?An(s,[s[0],s[1],s[2],M&8&&{paint:{"line-color":No(["get","Traffic volume category"],{"0 to 1999":C[3].colorScale[0],"2000 to 3999":C[3].colorScale[1],"4000+":C[3].colorScale[2]},"cyan"),"line-width":ra(0)}},M&1&&{layout:{visibility:C[0]?"visible":"none"}}]):{};e.$set(P);const A=M&18?An(p,[p[0],p[1],M&16&&{paint:{"line-color":No(["get","Level of Service"],C[4],"cyan"),"line-width":ra(1)}},M&2&&{layout:{visibility:C[1]?"visible":"none"}}]):{};n.$set(A);const L=M&36?An(_,[_[0],_[1],_[2],M&32&&{paint:{"line-color":No(["get","Infrastructure type"],C[5],"cyan"),"line-width":ra(1)}},M&4&&{layout:{visibility:C[2]?"visible":"none"}}]):{};o.$set(L)},i(C){u||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),u=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),u=!1},d(C){C&&(H(t),H(i)),le(e,C),le(n,C),le(o,C)}}}function VL(r){let e,t,n,i,o,u,s,d,p,g,_;function x(I){r[6](I)}let C={label:"Traffic",$$slots:{help:[OL],legend:[FL]},$$scope:{ctx:r}};r[0]!==void 0&&(C.show=r[0]),e=new os({props:C}),dn.push(()=>Dn(e,"show",x));function M(I){r[7](I)}let P={label:"Level of Service",$$slots:{help:[BL],legend:[$L]},$$scope:{ctx:r}};r[1]!==void 0&&(P.show=r[1]),i=new os({props:P}),dn.push(()=>Dn(i,"show",M));function A(I){r[8](I)}let L={label:"Cycle infrastructure",$$slots:{help:[jL],legend:[NL]},$$scope:{ctx:r}};return r[2]!==void 0&&(L.show=r[2]),s=new os({props:L}),dn.push(()=>Dn(s,"show",A)),g=new rh({props:{url:`pmtiles://${Bo("cnt_layers/cbd.pmtiles")}`,$$slots:{default:[UL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment),u=oe(),ue(s.$$.fragment),p=oe(),ue(g.$$.fragment)},m(I,$){ae(e,I,$),W(I,n,$),ae(i,I,$),W(I,u,$),ae(s,I,$),W(I,p,$),ae(g,I,$),_=!0},p(I,[$]){const O={};$&512&&(O.$$scope={dirty:$,ctx:I}),!t&&$&1&&(t=!0,O.show=I[0],zn(()=>t=!1)),e.$set(O);const Z={};$&512&&(Z.$$scope={dirty:$,ctx:I}),!o&&$&2&&(o=!0,Z.show=I[1],zn(()=>o=!1)),i.$set(Z);const X={};$&512&&(X.$$scope={dirty:$,ctx:I}),!d&&$&4&&(d=!0,X.show=I[2],zn(()=>d=!1)),s.$set(X);const q={};$&519&&(q.$$scope={dirty:$,ctx:I}),g.$set(q)},i(I){_||(N(e.$$.fragment,I),N(i.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),_=!0)},o(I){V(e.$$.fragment,I),V(i.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),_=!1},d(I){I&&(H(n),H(u),H(p)),le(e,I),le(i,I),le(s,I),le(g,I)}}}function qL(r,e,t){let n=!1,i=!1,o=!1,u={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},s={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},d={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function p(x){n=x,t(0,n)}function g(x){i=x,t(1,i)}function _(x){o=x,t(2,o)}return[n,i,o,u,s,d,p,g,_]}class HL extends Lt{constructor(e){super(),Et(this,e,qL,VL,Tt,{})}}function WL(r){let e,t,n;return t=new i_({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","legend")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function GL(r){let e;return{c(){e=U("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function rv(r){let e,t;return e=new gr({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[XL]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function ZL(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=Ee(e)},m(n,i){W(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&St(t,e)},d(n){n&&H(t)}}}function KL(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[ZL,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function XL(r){let e,t;const n=[_n("context-pois"),{paint:{"circle-color":No(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[KL]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&5?An(n,[n[0],u&4&&{paint:{"circle-color":No(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},u&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};u&32&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function YL(r){let e,t,n,i,o;function u(p){r[3](p)}let s={label:"POIs",$$slots:{help:[GL],legend:[WL]},$$scope:{ctx:r}};r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u));let d=r[1]&&rv(r);return{c(){ue(e.$$.fragment),n=oe(),d&&d.c(),i=tr()},m(p,g){ae(e,p,g),W(p,n,g),d&&d.m(p,g),W(p,i,g),o=!0},p(p,[g]){const _={};g&32&&(_.$$scope={dirty:g,ctx:p}),!t&&g&1&&(t=!0,_.show=p[0],zn(()=>t=!1)),e.$set(_),p[1]?d?(d.p(p,g),g&2&&N(d,1)):(d=rv(p),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Xt(),V(d,1,1,()=>{d=null}),Yt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(H(n),H(i)),le(e,p),d&&d.d(p)}}}function JL(r,e,t){let n;ct(r,Ar,s=>t(1,n=s));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99",Recreation:"#f0027f"};function u(s){i=s,t(0,i)}return[i,n,o,u]}class QL extends Lt{constructor(e){super(),Et(this,e,JL,YL,Tt,{})}}function eI(r){let e,t,n,i,o;return t=new Vo({props:{colorScale:fp,labels:{buckets:m2(hp)}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML="<span>More deprived</span> <span>Less deprived</span>",Qe(i,"display","flex"),Qe(i,"justify-content","space-between"),he(e,"slot","legend")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),F(e,i),o=!0},p:at,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&H(e),le(t)}}}function tI(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function nI(r){let e,t,n,i,o;return t=new Vo({props:{colorScale:dp,labels:{limits:pp}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",Qe(i,"display","flex"),Qe(i,"justify-content","space-between"),he(e,"slot","legend")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),F(e,i),o=!0},p:at,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&H(e),le(t)}}}function rI(r){let e;return{c(){e=U("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function iI(r){let e,t,n,i,o;return t=new Vo({props:{colorScale:gp,labels:{limits:mp.map(pI)}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Qe(i,"display","flex"),Qe(i,"justify-content","space-between"),he(e,"slot","legend")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),F(e,i),o=!0},p:at,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),o=!1},d(u){u&&H(e),le(t)}}}function oI(r){let e;return{c(){e=U("p"),e.textContent="Show households from the Scottish census with at least one car.",he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function sI(r){let e,t,n=r[6].id+"",i,o,u=r[6].population.toLocaleString()+"",s,d,p=r[6].imd_rank+"",g,_,x=r[6].imd_percentile+"",C,M;return{c(){e=U("p"),t=Ee("Data zone "),i=Ee(n),o=Ee(`
        has `),s=Ee(u),d=Ee(`
        people, and a SIMD rank of `),g=Ee(p),_=Ee(`, making it less deprived
        than `),C=Ee(x),M=Ee("% of data zones.")},m(P,A){W(P,e,A),F(e,t),F(e,i),F(e,o),F(e,s),F(e,d),F(e,g),F(e,_),F(e,C),F(e,M)},p(P,A){A&64&&n!==(n=P[6].id+"")&&St(i,n),A&64&&u!==(u=P[6].population.toLocaleString()+"")&&St(s,u),A&64&&p!==(p=P[6].imd_rank+"")&&St(g,p),A&64&&x!==(x=P[6].imd_percentile+"")&&St(C,x)},d(P){P&&H(e)}}}function aI(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[sI,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function lI(r){let e,t,n=r[6].id+"",i,o,u=ac(r[6].households_with_cars_or_vans,r[6].total_households)+"",s,d,p=r[6].total_households.toLocaleString()+"",g,_;return{c(){e=U("p"),t=Ee("In data zone "),i=Ee(n),o=oe(),s=Ee(u),d=Ee(" of approximately "),g=Ee(p),_=Ee(`
        households have at least one car or van.`)},m(x,C){W(x,e,C),F(e,t),F(e,i),F(e,o),F(e,s),F(e,d),F(e,g),F(e,_)},p(x,C){C&64&&n!==(n=x[6].id+"")&&St(i,n),C&64&&u!==(u=ac(x[6].households_with_cars_or_vans,x[6].total_households)+"")&&St(s,u),C&64&&p!==(p=x[6].total_households.toLocaleString()+"")&&St(g,p)},d(x){x&&H(e)}}}function uI(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[lI,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function cI(r){let e,t,n=r[6].id+"",i,o,u=r[6].population.toLocaleString()+"",s,d,p=Math.round(r[6].population/(r[6].area/1e6)).toLocaleString()+"",g,_;return{c(){e=U("p"),t=Ee("Data zone "),i=Ee(n),o=Ee(`
        has `),s=Ee(u),d=Ee(`
        people, with a density of `),g=Ee(p),_=Ee(" people per square kilometer")},m(x,C){W(x,e,C),F(e,t),F(e,i),F(e,o),F(e,s),F(e,d),F(e,g),F(e,_)},p(x,C){C&64&&n!==(n=x[6].id+"")&&St(i,n),C&64&&u!==(u=x[6].population.toLocaleString()+"")&&St(s,u),C&64&&p!==(p=Math.round(x[6].population/(x[6].area/1e6)).toLocaleString()+"")&&St(g,p)},d(x){x&&H(e)}}}function fI(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[cI,({props:n})=>({6:n}),({props:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function hI(r){let e,t,n,i,o,u,s,d;const p=[_n("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":fo(["get","imd_percentile"],hp,fp),"fill-opacity":Qn(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let g={$$slots:{default:[aI]},$$scope:{ctx:r}};for(let L=0;L<p.length;L+=1)g=zt(g,p[L]);e=new Xi({props:g});const _=[_n("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":fo(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],mp,gp),"fill-opacity":Qn(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let x={$$slots:{default:[uI]},$$scope:{ctx:r}};for(let L=0;L<_.length;L+=1)x=zt(x,_[L]);n=new Xi({props:x});const C=[_n("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":fo(["/",["get","population"],["/",["get","area"],1e6]],pp,dp),"fill-opacity":Qn(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let M={$$slots:{default:[fI]},$$scope:{ctx:r}};for(let L=0;L<C.length;L+=1)M=zt(M,C[L]);o=new Xi({props:M});const P=[_n("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let A={};for(let L=0;L<P.length;L+=1)A=zt(A,P[L]);return s=new ur({props:A}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(L,I){ae(e,L,I),W(L,t,I),ae(n,L,I),W(L,i,I),ae(o,L,I),W(L,u,I),ae(s,L,I),d=!0},p(L,I){const $=I&1?An(p,[p[0],p[1],p[2],p[3],{layout:{visibility:L[0]?"visible":"none"}}]):{};I&128&&($.$$scope={dirty:I,ctx:L}),e.$set($);const O=I&4?An(_,[_[0],_[1],_[2],_[3],{layout:{visibility:L[2]?"visible":"none"}}]):{};I&128&&(O.$$scope={dirty:I,ctx:L}),n.$set(O);const Z=I&2?An(C,[C[0],C[1],C[2],C[3],{layout:{visibility:L[1]?"visible":"none"}}]):{};I&128&&(Z.$$scope={dirty:I,ctx:L}),o.$set(Z);const X=I&7?An(P,[P[0],P[1],P[2],{layout:{visibility:L[0]||L[1]||L[2]?"visible":"none"}}]):{};s.$set(X)},i(L){d||(N(e.$$.fragment,L),N(n.$$.fragment,L),N(o.$$.fragment,L),N(s.$$.fragment,L),d=!0)},o(L){V(e.$$.fragment,L),V(n.$$.fragment,L),V(o.$$.fragment,L),V(s.$$.fragment,L),d=!1},d(L){L&&(H(t),H(i),H(u)),le(e,L),le(n,L),le(o,L),le(s,L)}}}function dI(r){let e,t,n,i,o,u,s,d,p,g,_;function x(I){r[3](I)}let C={label:"SIMD",$$slots:{help:[tI],legend:[eI]},$$scope:{ctx:r}};r[0]!==void 0&&(C.show=r[0]),e=new os({props:C}),dn.push(()=>Dn(e,"show",x));function M(I){r[4](I)}let P={label:"Population density",$$slots:{help:[rI],legend:[nI]},$$scope:{ctx:r}};r[1]!==void 0&&(P.show=r[1]),i=new os({props:P}),dn.push(()=>Dn(i,"show",M));function A(I){r[5](I)}let L={label:"Car ownership",$$slots:{help:[oI],legend:[iI]},$$scope:{ctx:r}};return r[2]!==void 0&&(L.show=r[2]),s=new os({props:L}),dn.push(()=>Dn(s,"show",A)),g=new rh({props:{url:`pmtiles://${Bo("cnt_layers/population.pmtiles")}`,$$slots:{default:[hI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment),u=oe(),ue(s.$$.fragment),p=oe(),ue(g.$$.fragment)},m(I,$){ae(e,I,$),W(I,n,$),ae(i,I,$),W(I,u,$),ae(s,I,$),W(I,p,$),ae(g,I,$),_=!0},p(I,[$]){const O={};$&128&&(O.$$scope={dirty:$,ctx:I}),!t&&$&1&&(t=!0,O.show=I[0],zn(()=>t=!1)),e.$set(O);const Z={};$&128&&(Z.$$scope={dirty:$,ctx:I}),!o&&$&2&&(o=!0,Z.show=I[1],zn(()=>o=!1)),i.$set(Z);const X={};$&128&&(X.$$scope={dirty:$,ctx:I}),!d&&$&4&&(d=!0,X.show=I[2],zn(()=>d=!1)),s.$set(X);const q={};$&135&&(q.$$scope={dirty:$,ctx:I}),g.$set(q)},i(I){_||(N(e.$$.fragment,I),N(i.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),_=!0)},o(I){V(e.$$.fragment,I),V(i.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),_=!1},d(I){I&&(H(n),H(u),H(p)),le(e,I),le(i,I),le(s,I),le(g,I)}}}const pI=r=>`${r}%`;function mI(r,e,t){let n=!1,i=!1,o=!1;function u(p){n=p,t(0,n)}function s(p){i=p,t(1,i)}function d(p){o=p,t(2,o)}return[n,i,o,u,s,d]}class gI extends Lt{constructor(e){super(),Et(this,e,mI,dI,Tt,{})}}function _I(r){let e;return{c(){e=U("div"),e.innerHTML=`<img src="${Yb}" alt="National Rail logo"/>
    Station`,he(e,"slot","legend"),Qe(e,"display","flex"),Qe(e,"gap","8px"),Qe(e,"align-items","center")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function yI(r){let e;return{c(){e=U("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function vI(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=U("p"),n=Ee(t)},m(i,o){W(i,e,o),F(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&St(n,t)},d(i){i&&H(e)}}}function bI(r){let e,t;return e=new pi({props:{$$slots:{default:[vI,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function wI(r){let e,t;const n=[_n("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[bI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new nc({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&1?An(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};u&8&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function xI(r){let e,t,n,i,o;function u(d){r[1](d)}let s={label:"Railway stations",$$slots:{help:[yI],legend:[_I]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new gr({props:{data:Bo("cnt_layers/railways.geojson"),generateId:!0,$$slots:{default:[wI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),W(d,n,p),ae(i,d,p),o=!0},p(d,[p]){const g={};p&8&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],zn(()=>t=!1)),e.$set(g);const _={};p&9&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&H(n),le(e,d),le(i,d)}}}function kI(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class SI extends Lt{constructor(e){super(),Et(this,e,kI,xI,Tt,{})}}function iv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function ov(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function sv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function av(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function lv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function uv(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function TI(r){let e;return{c(){e=U("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function cv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Ee(t),e.__value=r[18],Zn(e,e.__value)},m(i,o){W(i,e,o),F(e,n)},p:at,d(i){i&&H(e)}}}function fv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Ee(t),e.__value=r[18],Zn(e,e.__value)},m(i,o){W(i,e,o),F(e,n)},p:at,d(i){i&&H(e)}}}function hv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Ee(t),e.__value=r[18],Zn(e,e.__value)},m(i,o){W(i,e,o),F(e,n)},p:at,d(i){i&&H(e)}}}function dv(r){let e,t=r[19]+"",n;return{c(){e=U("option"),n=Ee(t),e.__value=r[18],Zn(e,e.__value)},m(i,o){W(i,e,o),F(e,n)},p:at,d(i){i&&H(e)}}}function CI(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$=$n(r[7]),O=[];for(let ee=0;ee<$.length;ee+=1)O[ee]=cv(uv(r,$,ee));let Z=$n(r[8]),X=[];for(let ee=0;ee<Z.length;ee+=1)X[ee]=fv(lv(r,Z,ee));let q=$n(r[9]),Y=[];for(let ee=0;ee<q.length;ee+=1)Y[ee]=hv(av(r,q,ee));let fe=$n(r[10]),Le=[];for(let ee=0;ee<fe.length;ee+=1)Le[ee]=dv(sv(r,fe,ee));return{c(){e=U("div"),t=U("label"),n=Ee(`Trip purpose:
      `),i=U("select");for(let ee=0;ee<O.length;ee+=1)O[ee].c();o=oe(),u=U("label"),s=Ee(`Scenario:
      `),d=U("select");for(let ee=0;ee<X.length;ee+=1)X[ee].c();p=oe(),g=U("label"),_=Ee(`Network type:
      `),x=U("select");for(let ee=0;ee<Y.length;ee+=1)Y[ee].c();C=oe(),M=U("label"),P=Ee(`Color by:
      `),A=U("select");for(let ee=0;ee<Le.length;ee+=1)Le[ee].c();r[0]===void 0&&ys(()=>r[11].call(i)),r[1]===void 0&&ys(()=>r[12].call(d)),r[2]===void 0&&ys(()=>r[13].call(x)),r[3]===void 0&&ys(()=>r[14].call(A)),he(e,"slot","legend")},m(ee,ie){W(ee,e,ie),F(e,t),F(t,n),F(t,i);for(let ve=0;ve<O.length;ve+=1)O[ve]&&O[ve].m(i,null);Zi(i,r[0],!0),F(e,o),F(e,u),F(u,s),F(u,d);for(let ve=0;ve<X.length;ve+=1)X[ve]&&X[ve].m(d,null);Zi(d,r[1],!0),F(e,p),F(e,g),F(g,_),F(g,x);for(let ve=0;ve<Y.length;ve+=1)Y[ve]&&Y[ve].m(x,null);Zi(x,r[2],!0),F(e,C),F(e,M),F(M,P),F(M,A);for(let ve=0;ve<Le.length;ve+=1)Le[ve]&&Le[ve].m(A,null);Zi(A,r[3],!0),L||(I=[It(i,"change",r[11]),It(d,"change",r[12]),It(x,"change",r[13]),It(A,"change",r[14])],L=!0)},p(ee,ie){if(ie[0]&128){$=$n(ee[7]);let ve;for(ve=0;ve<$.length;ve+=1){const ye=uv(ee,$,ve);O[ve]?O[ve].p(ye,ie):(O[ve]=cv(ye),O[ve].c(),O[ve].m(i,null))}for(;ve<O.length;ve+=1)O[ve].d(1);O.length=$.length}if(ie[0]&129&&Zi(i,ee[0]),ie[0]&256){Z=$n(ee[8]);let ve;for(ve=0;ve<Z.length;ve+=1){const ye=lv(ee,Z,ve);X[ve]?X[ve].p(ye,ie):(X[ve]=fv(ye),X[ve].c(),X[ve].m(d,null))}for(;ve<X.length;ve+=1)X[ve].d(1);X.length=Z.length}if(ie[0]&258&&Zi(d,ee[1]),ie[0]&512){q=$n(ee[9]);let ve;for(ve=0;ve<q.length;ve+=1){const ye=av(ee,q,ve);Y[ve]?Y[ve].p(ye,ie):(Y[ve]=hv(ye),Y[ve].c(),Y[ve].m(x,null))}for(;ve<Y.length;ve+=1)Y[ve].d(1);Y.length=q.length}if(ie[0]&516&&Zi(x,ee[2]),ie[0]&1024){fe=$n(ee[10]);let ve;for(ve=0;ve<fe.length;ve+=1){const ye=sv(ee,fe,ve);Le[ve]?Le[ve].p(ye,ie):(Le[ve]=dv(ye),Le[ve].c(),Le[ve].m(A,null))}for(;ve<Le.length;ve+=1)Le[ve].d(1);Le.length=fe.length}ie[0]&1032&&Zi(A,ee[3])},d(ee){ee&&H(e),_i(O,ee),_i(X,ee),_i(Y,ee),_i(Le,ee),L=!1,cr(I)}}}function pv(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",u,s,d,p=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",g,_,x,C=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",M,P;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=oe(),i=U("td"),u=Ee(o),s=oe(),d=U("td"),g=Ee(p),_=oe(),x=U("td"),M=Ee(C),P=oe()},m(A,L){W(A,e,L),F(e,t),F(e,n),F(e,i),F(i,u),F(e,s),F(e,d),F(d,g),F(e,_),F(e,x),F(x,M),F(e,P)},p(A,L){L[0]&131072&&o!==(o=A[17][`${A[18]}_fastest_bicycle`].toLocaleString()+"")&&St(u,o),L[0]&131072&&p!==(p=A[17][`${A[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&St(g,p),L[0]&131072&&C!==(C=A[17][`${A[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&St(M,C)},d(A){A&&H(e)}}}function mv(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",u,s,d,p=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",g,_,x,C=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",M,P;return{c(){e=U("tr"),t=U("th"),t.textContent=`${r[19]}`,n=oe(),i=U("td"),u=Ee(o),s=oe(),d=U("td"),g=Ee(p),_=oe(),x=U("td"),M=Ee(C),P=oe()},m(A,L){W(A,e,L),F(e,t),F(e,n),F(e,i),F(i,u),F(e,s),F(e,d),F(d,g),F(e,_),F(e,x),F(x,M),F(e,P)},p(A,L){L[0]&131072&&o!==(o=A[17][`${A[18]}_quietest_bicycle`].toLocaleString()+"")&&St(u,o),L[0]&131072&&p!==(p=A[17][`${A[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&St(g,p),L[0]&131072&&C!==(C=A[17][`${A[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&St(M,C)},d(A){A&&H(e)}}}function MI(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,u,s,d,p=r[17].gradient+"",g,_,x,C,M,P=r[17].quietness+"",A,L,I,$,O,Z,X,q,Y,fe,Le,ee,ie,ve,ye,it,Fe,Ne=$n(r[7]),Ae=[];for(let ut=0;ut<Ne.length;ut+=1)Ae[ut]=pv(ov(r,Ne,ut));let ot=$n(r[7]),Ye=[];for(let ut=0;ut<ot.length;ut+=1)Ye[ut]=mv(iv(r,ot,ut));return{c(){e=U("div"),t=U("p"),n=Ee("Cyclists: "),o=Ee(i),u=oe(),s=U("p"),d=Ee("Gradient: "),g=Ee(p),_=Ee("%"),x=oe(),C=U("p"),M=Ee("Cycle-friendliness: "),A=Ee(P),L=Ee("%"),I=oe(),$=U("details"),O=U("summary"),O.textContent="All network details",Z=oe(),X=U("p"),X.textContent="Fast/Direct network",q=oe(),Y=U("table"),fe=U("tr"),fe.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Le=oe();for(let ut=0;ut<Ae.length;ut+=1)Ae[ut].c();ee=oe(),ie=U("p"),ie.textContent="Quiet/Indirect network",ve=oe(),ye=U("table"),it=U("tr"),it.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",Fe=oe();for(let ut=0;ut<Ye.length;ut+=1)Ye[ut].c();Qe(e,"max-width","30vw"),Qe(e,"max-height","60vh"),Qe(e,"overflow","auto")},m(ut,pt){W(ut,e,pt),F(e,t),F(t,n),F(t,o),F(e,u),F(e,s),F(s,d),F(s,g),F(s,_),F(e,x),F(e,C),F(C,M),F(C,A),F(C,L),F(e,I),F(e,$),F($,O),F($,Z),F($,X),F($,q),F($,Y),F(Y,fe),F(Y,Le);for(let _t=0;_t<Ae.length;_t+=1)Ae[_t]&&Ae[_t].m(Y,null);F($,ee),F($,ie),F($,ve),F($,ye),F(ye,it),F(ye,Fe);for(let _t=0;_t<Ye.length;_t+=1)Ye[_t]&&Ye[_t].m(ye,null)},p(ut,pt){if(pt[0]&131088&&i!==(i=ut[17][ut[4]].toLocaleString()+"")&&St(o,i),pt[0]&131072&&p!==(p=ut[17].gradient+"")&&St(g,p),pt[0]&131072&&P!==(P=ut[17].quietness+"")&&St(A,P),pt[0]&131200){Ne=$n(ut[7]);let _t;for(_t=0;_t<Ne.length;_t+=1){const He=ov(ut,Ne,_t);Ae[_t]?Ae[_t].p(He,pt):(Ae[_t]=pv(He),Ae[_t].c(),Ae[_t].m(Y,null))}for(;_t<Ae.length;_t+=1)Ae[_t].d(1);Ae.length=Ne.length}if(pt[0]&131200){ot=$n(ut[7]);let _t;for(_t=0;_t<ot.length;_t+=1){const He=iv(ut,ot,_t);Ye[_t]?Ye[_t].p(He,pt):(Ye[_t]=mv(He),Ye[_t].c(),Ye[_t].m(ye,null))}for(;_t<Ye.length;_t+=1)Ye[_t].d(1);Ye.length=ot.length}},d(ut){ut&&H(e),_i(Ae,ut),_i(Ye,ut)}}}function EI(r){let e,t;return e=new pi({props:{openOn:"click",$$slots:{default:[MI,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function LI(r){let e,t;const n=[_n("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":gv(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[EI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u[0]&112?An(n,[n[0],n[1],u[0]&80&&{paint:{"line-color":o[6],"line-width":gv(["get",o[4]])}},u[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};u[0]&16|u[1]&2&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function II(r){let e,t,n,i,o;function u(d){r[15](d)}let s={label:"Route network",$$slots:{legend:[CI],help:[TI]},$$scope:{ctx:r}};return r[5]!==void 0&&(s.show=r[5]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new rh({props:{url:`pmtiles://${Bo("cnt_layers/route_network.pmtiles")}`,$$slots:{default:[LI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),W(d,n,p),ae(i,d,p),o=!0},p(d,p){const g={};p[0]&15|p[1]&2&&(g.$$scope={dirty:p,ctx:d}),!t&&p[0]&32&&(t=!0,g.show=d[5],zn(()=>t=!1)),e.$set(g);const _={};p[0]&112|p[1]&2&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&H(n),le(e,d),le(i,d)}}}function gv(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function AI(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function PI(r,e,t){let n,i,o=!1,u="all",s="bicycle_go_dutch",d="fastest",p="flow",g=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],_=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],x=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],C=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],M={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function P(){u=Ra(this),t(0,u),t(7,g)}function A(){s=Ra(this),t(1,s),t(8,_)}function L(){d=Ra(this),t(2,d),t(9,x)}function I(){p=Ra(this),t(3,p),t(10,C)}function $(O){o=O,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${u}_${d}_${s}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:AI(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:fo(["abs",["get","gradient"]],M.limits,M.colorScale)}[p])},[u,s,d,p,n,o,i,g,_,x,C,P,A,L,I,$]}class zI extends Lt{constructor(e){super(),Et(this,e,PI,II,Tt,{},null,[-1,-1])}}function DI(r){let e;return{c(){e=U("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data  Crown copyright and database right 2025.</p>`,he(e,"slot","help")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function RI(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z,X,q;return O=new i_({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=U("div"),t=U("fieldset"),n=U("label"),i=U("input"),o=Ee(`
        Pedestrians`),u=oe(),s=U("label"),d=U("input"),p=Ee(`
        Cyclists`),g=oe(),_=U("fieldset"),x=U("label"),C=Ee(`From
        `),M=U("input"),P=oe(),A=U("label"),L=Ee(`To
        `),I=U("input"),$=oe(),ue(O.$$.fragment),he(i,"type","checkbox"),he(i,"class","svelte-rvrx5w"),he(d,"type","checkbox"),he(d,"class","svelte-rvrx5w"),Qe(t,"display","flex"),Qe(t,"gap","3em"),he(t,"class","svelte-rvrx5w"),he(M,"type","number"),he(M,"min",2017),he(M,"max",2023),he(M,"class","svelte-rvrx5w"),he(I,"type","number"),he(I,"min",2017),he(I,"max",2023),he(I,"class","svelte-rvrx5w"),he(_,"class","year-filter svelte-rvrx5w"),he(e,"slot","legend")},m(Y,fe){W(Y,e,fe),F(e,t),F(t,n),F(n,i),i.checked=r[1].pedestrians,F(n,o),F(t,u),F(t,s),F(s,d),d.checked=r[1].cyclists,F(s,p),F(e,g),F(e,_),F(_,x),F(x,C),F(x,M),Zn(M,r[1].minYear),F(_,P),F(_,A),F(A,L),F(A,I),Zn(I,r[1].maxYear),F(e,$),ae(O,e,null),Z=!0,X||(q=[It(i,"change",r[7]),It(d,"change",r[8]),It(M,"input",r[9]),It(I,"input",r[10])],X=!0)},p(Y,fe){fe&2&&(i.checked=Y[1].pedestrians),fe&2&&(d.checked=Y[1].cyclists),fe&2&&zl(M.value)!==Y[1].minYear&&Zn(M,Y[1].minYear),fe&2&&zl(I.value)!==Y[1].maxYear&&Zn(I,Y[1].maxYear)},i(Y){Z||(N(O.$$.fragment,Y),Z=!0)},o(Y){V(O.$$.fragment,Y),Z=!1},d(Y){Y&&H(e),le(O),X=!1,cr(q)}}}function _v(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=U("p"),t=Ee("Pedestrian location: "),n=U("b"),o=Ee(i)},m(u,s){W(u,e,s),F(e,t),F(e,n),F(n,o)},p(u,s){s&4096&&i!==(i=u[3][u[12].pedestrian_location]+"")&&St(o,i)},d(u){u&&H(e)}}}function yv(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=U("p"),t=Ee("Pedestrian movement: "),n=U("b"),o=Ee(i)},m(u,s){W(u,e,s),F(e,t),F(e,n),F(n,o)},p(u,s){s&4096&&i!==(i=u[4][u[12].pedestrian_movement]+"")&&St(o,i)},d(u){u&&H(e)}}}function FI(r){let e,t,n,i=r[12].year+"",o,u,s,d,p,g=r[5][r[12].severity]+"",_,x,C,M,P,A=vv(r[12])+"",L,I,$,O,Z,X=r[12].pedestrian_location&&_v(r),q=r[12].pedestrian_movement&&yv(r);return{c(){e=U("p"),t=Ee("Year: "),n=U("b"),o=Ee(i),u=oe(),s=U("p"),d=Ee("Severity: "),p=U("b"),_=Ee(g),x=oe(),C=U("p"),M=Ee("Casualties: "),P=U("b"),L=Ee(A),I=oe(),X&&X.c(),$=oe(),q&&q.c(),O=oe(),Z=U("p"),Z.textContent="Click to open full report in CycleStreets"},m(Y,fe){W(Y,e,fe),F(e,t),F(e,n),F(n,o),W(Y,u,fe),W(Y,s,fe),F(s,d),F(s,p),F(p,_),W(Y,x,fe),W(Y,C,fe),F(C,M),F(C,P),F(P,L),W(Y,I,fe),X&&X.m(Y,fe),W(Y,$,fe),q&&q.m(Y,fe),W(Y,O,fe),W(Y,Z,fe)},p(Y,fe){fe&4096&&i!==(i=Y[12].year+"")&&St(o,i),fe&4096&&g!==(g=Y[5][Y[12].severity]+"")&&St(_,g),fe&4096&&A!==(A=vv(Y[12])+"")&&St(L,A),Y[12].pedestrian_location?X?X.p(Y,fe):(X=_v(Y),X.c(),X.m($.parentNode,$)):X&&(X.d(1),X=null),Y[12].pedestrian_movement?q?q.p(Y,fe):(q=yv(Y),q.c(),q.m(O.parentNode,O)):q&&(q.d(1),q=null)},d(Y){Y&&(H(e),H(u),H(s),H(x),H(C),H(I),H($),H(O),H(Z)),X&&X.d(Y),q&&q.d(Y)}}}function OI(r){let e,t;return e=new pi({props:{$$slots:{default:[FI,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function $I(r){let e,t;const n=[_n("context-stats19"),{sourceLayer:"stats19"},{paint:{"circle-color":fo(["get","severity"],[1,2,3],[vg,bg,wg]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[OI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),e.$on("click",NI),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s=u&7?An(n,[n[0],n[1],u&0&&{paint:{"circle-color":fo(["get","severity"],[1,2,3],[vg,bg,wg]),"circle-opacity":.9,"circle-radius":["interpolate",["linear"],["zoom"],1,2,8,3,13,15],"circle-stroke-color":"black","circle-stroke-width":.1}},u&6&&{filter:o[2](o[1])},u&1&&{layout:{visibility:o[0]?"visible":"none"}},n[5]]):{};u&8192&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function BI(r){let e,t,n,i,o;function u(d){r[11](d)}let s={label:"Collisions",$$slots:{legend:[RI],help:[DI]},$$scope:{ctx:r}};return r[0]!==void 0&&(s.show=r[0]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u)),i=new rh({props:{url:`pmtiles://${Bo("cnt_layers/stats19.pmtiles")}`,$$slots:{default:[$I]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(d,p){ae(e,d,p),W(d,n,p),ae(i,d,p),o=!0},p(d,[p]){const g={};p&8194&&(g.$$scope={dirty:p,ctx:d}),!t&&p&1&&(t=!0,g.show=d[0],zn(()=>t=!1)),e.$set(g);const _={};p&8195&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){V(e.$$.fragment,d),V(i.$$.fragment,d),o=!1},d(d){d&&H(n),le(e,d),le(i,d)}}}let vg="#080C54",bg="#1F9EB7",wg="#CDE594";function vv(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function NI(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function jI(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(P){let A=["any"];return i.pedestrians&&A.push(["get","pedestrian"]),i.cyclists&&A.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],A]}let u={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},s={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},d={1:"Fatal",2:"Serious",3:"Slight"},p={Slight:wg,Serious:bg,Fatal:vg};function g(){i.pedestrians=this.checked,t(1,i)}function _(){i.cyclists=this.checked,t(1,i)}function x(){i.minYear=zl(this.value),t(1,i)}function C(){i.maxYear=zl(this.value),t(1,i)}function M(P){n=P,t(0,n)}return[n,i,o,u,s,d,p,g,_,x,C,M]}class UI extends Lt{constructor(e){super(),Et(this,e,jI,BI,Tt,{})}}function bv(r){let e;return{c(){e=Ee("Layers")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function wv(r){let e,t,n,i,o;function u(p){r[6](p)}let s={label:"Existing modal filters and turn restrictions"};r[2]!==void 0&&(s.show=r[2]),e=new os({props:s}),dn.push(()=>Dn(e,"show",u));let d=r[3]=="cnt"&&xv();return{c(){ue(e.$$.fragment),n=oe(),d&&d.c(),i=tr()},m(p,g){ae(e,p,g),W(p,n,g),d&&d.m(p,g),W(p,i,g),o=!0},p(p,g){const _={};!t&&g&4&&(t=!0,_.show=p[2],zn(()=>t=!1)),e.$set(_),p[3]=="cnt"?d?g&8&&N(d,1):(d=xv(),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Xt(),V(d,1,1,()=>{d=null}),Yt())},i(p){o||(N(e.$$.fragment,p),N(d),o=!0)},o(p){V(e.$$.fragment,p),V(d),o=!1},d(p){p&&(H(n),H(i)),le(e,p),d&&d.d(p)}}}function xv(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M;return e=new QL({}),n=new gI({}),o=new SI({}),s=new VM({}),p=new HL({}),_=new zI({}),C=new UI({}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment),d=oe(),ue(p.$$.fragment),g=oe(),ue(_.$$.fragment),x=oe(),ue(C.$$.fragment)},m(P,A){ae(e,P,A),W(P,t,A),ae(n,P,A),W(P,i,A),ae(o,P,A),W(P,u,A),ae(s,P,A),W(P,d,A),ae(p,P,A),W(P,g,A),ae(_,P,A),W(P,x,A),ae(C,P,A),M=!0},i(P){M||(N(e.$$.fragment,P),N(n.$$.fragment,P),N(o.$$.fragment,P),N(s.$$.fragment,P),N(p.$$.fragment,P),N(_.$$.fragment,P),N(C.$$.fragment,P),M=!0)},o(P){V(e.$$.fragment,P),V(n.$$.fragment,P),V(o.$$.fragment,P),V(s.$$.fragment,P),V(p.$$.fragment,P),V(_.$$.fragment,P),V(C.$$.fragment,P),M=!1},d(P){P&&(H(t),H(i),H(u),H(d),H(g),H(x)),le(e,P),le(n,P),le(o,P),le(s,P),le(p,P),le(_,P),le(C,P)}}}function VI(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O;i=new rS({props:{color:"#333"}});let Z=r[0]&&bv(),X=r[1]&&wv(r);return{c(){e=U("div"),t=U("button"),n=U("div"),ue(i.$$.fragment),o=oe(),Z&&Z.c(),s=oe(),d=U("div"),X&&X.c(),p=oe(),g=U("div"),_=U("span"),_.textContent="Basemap",x=oe(),C=U("select"),M=U("option"),M.textContent="MapTiler Dataviz",P=U("option"),P.textContent="MapTiler Streets",A=U("option"),A.textContent="MapTiler Satellite",L=U("option"),L.textContent="OS Open Zoomstack",Qe(n,"display","flex"),Qe(n,"gap","12px"),Qe(n,"color","#333"),Qe(n,"align-items","center"),Qe(n,"justify-content","center"),he(t,"class",u="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-1nl5dst"),he(t,"aria-label","Layers"),Qe(_,"font-size","20px"),Qe(_,"margin-left","8px"),Qe(_,"margin-top","4px"),M.__value="dataviz",Zn(M,M.__value),P.__value="streets-v2",Zn(P,P.__value),A.__value="hybrid",Zn(A,A.__value),L.__value="uk-openzoomstack-light",Zn(L,L.__value),Qe(C,"width","auto"),Qe(C,"font-size","20px"),Qe(C,"margin","8px"),Qe(C,"padding","8px"),Qe(C,"text-overflow","ellipsis"),r[4]===void 0&&ys(()=>r[7].call(C)),he(g,"class","context-control"),he(d,"class","contextual-layer-controls svelte-1nl5dst"),Qe(d,"flex-direction","column"),Qe(d,"display",r[0]?"flex":"none"),he(e,"class","pico contextual-layers svelte-1nl5dst"),Qe(e,"display","flex"),Qe(e,"flex-direction","column"),Qe(e,"border-radius","5px"),Qe(e,"width",r[0]?"300px":"auto")},m(q,Y){W(q,e,Y),F(e,t),F(t,n),ae(i,n,null),F(n,o),Z&&Z.m(n,null),F(e,s),F(e,d),X&&X.m(d,null),F(d,p),F(d,g),F(g,_),F(g,x),F(g,C),F(C,M),F(C,P),F(C,A),F(C,L),Zi(C,r[4],!0),I=!0,$||(O=[It(t,"click",r[5]),It(C,"change",r[7])],$=!0)},p(q,Y){q[0]?Z||(Z=bv(),Z.c(),Z.m(n,null)):Z&&(Z.d(1),Z=null),(!I||Y&1&&u!==(u="show-layers-button icon-btn "+(q[0]?"expanded":"")+" svelte-1nl5dst"))&&he(t,"class",u),q[1]?X?(X.p(q,Y),Y&2&&N(X,1)):(X=wv(q),X.c(),N(X,1),X.m(d,p)):X&&(Xt(),V(X,1,1,()=>{X=null}),Yt()),Y&16&&Zi(C,q[4]),Y&1&&Qe(d,"display",q[0]?"flex":"none"),Y&1&&Qe(e,"width",q[0]?"300px":"auto")},i(q){I||(N(i.$$.fragment,q),N(X),I=!0)},o(q){V(i.$$.fragment,q),V(X),I=!1},d(q){q&&H(e),le(i),Z&&Z.d(),X&&X.d(),$=!1,cr(O)}}}function qI(r){let e,t;return e=new tg({props:{defaultStyling:!0,$$slots:{default:[VI]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function HI(r,e,t){let n,i,o,u;ct(r,Ar,_=>t(1,n=_)),ct(r,Zd,_=>t(2,i=_)),ct(r,ks,_=>t(3,o=_)),ct(r,Zm,_=>t(4,u=_));let s=!1;const d=()=>t(0,s=!s);function p(_){i=_,Zd.set(i)}function g(){u=Ra(this),Zm.set(u)}return[s,n,i,o,u,d,p,g]}class WI extends Lt{constructor(e){super(),Et(this,e,HI,qI,Tt,{})}}let Ze;const R2=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&R2.decode();let Sf=null;function Qu(){return(Sf===null||Sf.byteLength===0)&&(Sf=new Uint8Array(Ze.memory.buffer)),Sf}function Or(r,e){return r=r>>>0,R2.decode(Qu().subarray(r,r+e))}const oa=new Array(128).fill(void 0);oa.push(void 0,null,!0,!1);let Nf=oa.length;function ir(r){Nf===oa.length&&oa.push(oa.length+1);const e=Nf;return Nf=oa[e],oa[e]=r,e}function Ln(r){return oa[r]}function GI(r){r<132||(oa[r]=Nf,Nf=r)}function Kn(r){const e=Ln(r);return GI(r),e}function Zu(r){return r==null}let Tf=null;function F2(){return(Tf===null||Tf.byteLength===0)&&(Tf=new Float64Array(Ze.memory.buffer)),Tf}let Cf=null;function gt(){return(Cf===null||Cf.byteLength===0)&&(Cf=new Int32Array(Ze.memory.buffer)),Cf}let wi=0;const jd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ZI=typeof jd.encodeInto=="function"?function(r,e){return jd.encodeInto(r,e)}:function(r,e){const t=jd.encode(r);return e.set(t),{read:r.length,written:t.length}};function Fo(r,e,t){if(t===void 0){const s=jd.encode(r),d=e(s.length,1)>>>0;return Qu().subarray(d,d+s.length).set(s),wi=s.length,d}let n=r.length,i=e(n,1)>>>0;const o=Qu();let u=0;for(;u<n;u++){const s=r.charCodeAt(u);if(s>127)break;o[i+u]=s}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const s=Qu().subarray(i+u,i+n),d=ZI(r,s);u+=d.written}return wi=u,i}let Mf=null;function KI(){return(Mf===null||Mf.byteLength===0)&&(Mf=new BigInt64Array(Ze.memory.buffer)),Mf}function xg(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=xg(r[0]));for(let u=1;u<i;u++)o+=", "+xg(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function jm(r,e){const t=e(r.length*1,1)>>>0;return Qu().set(r,t/1),wi=r.length,t}function XI(r,e){return r=r>>>0,F2().subarray(r/8,r/8+e)}function YI(r,e){return r=r>>>0,Qu().subarray(r/1,r/1+e)}function Ml(r,e){try{return r.apply(this,e)}catch(t){Ze.__wbindgen_exn_store(ir(t))}}class JI{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();Ze.__wbg_ltn_free(e)}constructor(e,t,n,i,o,u,s,d){try{const M=Ze.__wbindgen_add_to_stack_pointer(-16),P=jm(e,Ze.__wbindgen_malloc),A=wi,L=jm(t,Ze.__wbindgen_malloc),I=wi,$=jm(n,Ze.__wbindgen_malloc),O=wi,Z=Fo(o,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),X=wi;var p=Zu(u)?0:Fo(u,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),g=wi;const q=Fo(s,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),Y=wi;Ze.ltn_new(M,P,A,L,I,$,O,ir(i),Z,X,p,g,q,Y,d);var _=gt()[M/4+0],x=gt()[M/4+1],C=gt()[M/4+2];if(C)throw Kn(x);return this.__wbg_ptr=_>>>0,this}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}getInvertedBoundary(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getInvertedBoundary(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}getBounds(){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getBounds(i,this.__wbg_ptr);var e=gt()[i/4+0],t=gt()[i/4+1],n=XI(e,t).slice();return Ze.__wbindgen_free(e,t*8,8),n}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapper(){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_toRouteSnapper(i,this.__wbg_ptr);var e=gt()[i/4+0],t=gt()[i/4+1],n=YI(e,t).slice();return Ze.__wbindgen_free(e,t*1,1),n}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}toRouteSnapperGj(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_toRouteSnapperGj(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_renderModalFilters(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_renderTurnRestrictions(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_renderNeighbourhood(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_generatedBoundaries(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_generateMergedBoundary(g,this.__wbg_ptr,ir(e));var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Kn(u);return t=d,n=p,Or(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}extractWaypointsFromRing(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_extractWaypointsFromRing(g,this.__wbg_ptr,ir(e));var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Kn(u);return t=d,n=p,Or(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}setCurrentNeighbourhoodBoundary(e,t){try{const o=Ze.__wbindgen_add_to_stack_pointer(-16),u=Fo(e,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),s=wi;Ze.ltn_setCurrentNeighbourhoodBoundary(o,this.__wbg_ptr,u,s,ir(t));var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw Kn(n)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}deleteNeighbourhoodBoundary(e){const t=Fo(e,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),n=wi;Ze.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=Fo(e,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),i=wi,o=Fo(t,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),u=wi;Ze.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,u)}setCurrentNeighbourhood(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16),o=Fo(e,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),u=wi;Ze.ltn_setCurrentNeighbourhood(i,this.__wbg_ptr,o,u);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Kn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}addModalFilter(e,t){try{const o=Ze.__wbindgen_add_to_stack_pointer(-16),u=Fo(t,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),s=wi;Ze.ltn_addModalFilter(o,this.__wbg_ptr,ir(e),u,s);var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw Kn(n)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}addManyModalFilters(e,t){try{const o=Ze.__wbindgen_add_to_stack_pointer(-16),u=Fo(t,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),s=wi;Ze.ltn_addManyModalFilters(o,this.__wbg_ptr,ir(e),u,s);var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw Kn(n)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}deleteModalFilter(e){Ze.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_addDiagonalFilter(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Kn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}rotateDiagonalFilter(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_rotateDiagonalFilter(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Kn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}deleteDiagonalFilter(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_deleteDiagonalFilter(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Kn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}addTurnRestriction(e,t){try{const o=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_addTurnRestriction(o,this.__wbg_ptr,e,t);var n=gt()[o/4+0],i=gt()[o/4+1];if(i)throw Kn(n)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}deleteTurnRestriction(e,t,n){try{const u=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_deleteTurnRestriction(u,this.__wbg_ptr,e,t,n);var i=gt()[u/4+0],o=gt()[u/4+1];if(o)throw Kn(i)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}getTurnRestrictionTargets(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getTurnRestrictionTargets(g,this.__wbg_ptr,e);var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Kn(u);return t=d,n=p,Or(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){Ze.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_toggleMainRoad(i,this.__wbg_ptr,e);var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Kn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}reclassifyRoadsAlongLine(e,t,n){try{const u=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_reclassifyRoadsAlongLine(u,this.__wbg_ptr,ir(e),t,n);var i=gt()[u/4+0],o=gt()[u/4+1];if(o)throw Kn(i)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}undo(){try{const n=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_undo(n,this.__wbg_ptr);var e=gt()[n/4+0],t=gt()[n/4+1];if(t)throw Kn(e)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}redo(){try{const n=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_redo(n,this.__wbg_ptr);var e=gt()[n/4+0],t=gt()[n/4+1];if(t)throw Kn(e)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}getShortcutsCrossingRoad(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getShortcutsCrossingRoad(g,this.__wbg_ptr,e);var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Kn(u);return t=d,n=p,Or(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getAllShortcuts(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_toSavefile(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}loadSavefile(e){try{const i=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_loadSavefile(i,this.__wbg_ptr,ir(e));var t=gt()[i/4+0],n=gt()[i/4+1];if(n)throw Kn(t)}finally{Ze.__wbindgen_add_to_stack_pointer(16)}}compareRoute(e,t,n,i,o){let u,s;try{const M=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_compareRoute(M,this.__wbg_ptr,e,t,n,i,o);var d=gt()[M/4+0],p=gt()[M/4+1],g=gt()[M/4+2],_=gt()[M/4+3],x=d,C=p;if(_)throw x=0,C=0,Kn(g);return u=x,s=C,Or(x,C)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(u,s,1)}}impactToOneDestination(e,t){let n,i;try{const _=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_impactToOneDestination(_,this.__wbg_ptr,e,t);var o=gt()[_/4+0],u=gt()[_/4+1],s=gt()[_/4+2],d=gt()[_/4+3],p=o,g=u;if(d)throw p=0,g=0,Kn(s);return n=p,i=g,Or(p,g)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_predictImpact(g,this.__wbg_ptr,e);var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Kn(u);return t=d,n=p,Or(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const _=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getImpactsOnRoad(_,this.__wbg_ptr,e,t);var o=gt()[_/4+0],u=gt()[_/4+1],s=gt()[_/4+2],d=gt()[_/4+3],p=o,g=u;if(d)throw p=0,g=0,Kn(s);return n=p,i=g,Or(p,g)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(n,i,1)}}getAllNeighbourhoods(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getAllNeighbourhoods(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}getAllIntersections(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getAllIntersections(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const g=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getMovements(g,this.__wbg_ptr,e);var i=gt()[g/4+0],o=gt()[g/4+1],u=gt()[g/4+2],s=gt()[g/4+3],d=i,p=o;if(s)throw d=0,p=0,Kn(u);return t=d,n=p,Or(d,p)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getDemandModel(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const p=Ze.__wbindgen_add_to_stack_pointer(-16);Ze.ltn_getPOIs(p,this.__wbg_ptr);var n=gt()[p/4+0],i=gt()[p/4+1],o=gt()[p/4+2],u=gt()[p/4+3],s=n,d=i;if(u)throw s=0,d=0,Kn(o);return e=s,t=d,Or(s,d)}finally{Ze.__wbindgen_add_to_stack_pointer(16),Ze.__wbindgen_free(e,t,1)}}}async function QI(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function eA(){const r={};return r.wbg={},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Or(e,t));return ir(n)},r.wbg.__wbindgen_string_new=function(e,t){const n=Or(e,t);return ir(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Kn(e)},r.wbg.__wbindgen_boolean_get=function(e){const t=Ln(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_is_bigint=function(e){return typeof Ln(e)=="bigint"},r.wbg.__wbindgen_number_get=function(e,t){const n=Ln(t),i=typeof n=="number"?n:void 0;F2()[e/8+1]=Zu(i)?0:i,gt()[e/4+0]=!Zu(i)},r.wbg.__wbindgen_string_get=function(e,t){const n=Ln(t),i=typeof n=="string"?n:void 0;var o=Zu(i)?0:Fo(i,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),u=wi;gt()[e/4+1]=u,gt()[e/4+0]=o},r.wbg.__wbindgen_is_object=function(e){const t=Ln(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_in=function(e,t){return Ln(e)in Ln(t)},r.wbg.__wbindgen_bigint_from_i64=function(e){return ir(e)},r.wbg.__wbindgen_jsval_eq=function(e,t){return Ln(e)===Ln(t)},r.wbg.__wbindgen_bigint_from_u64=function(e){const t=BigInt.asUintN(64,e);return ir(t)},r.wbg.__wbindgen_is_undefined=function(e){return Ln(e)===void 0},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Ln(e)==Ln(t)},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Ln(e);return ir(t)},r.wbg.__wbg_getwithrefkey_3b3c46ba20582127=function(e,t){const n=Ln(e)[Ln(t)];return ir(n)},r.wbg.__wbg_debug_34c9290896ec9856=function(e){console.debug(Ln(e))},r.wbg.__wbg_error_e60eff06f24ab7a4=function(e){console.error(Ln(e))},r.wbg.__wbg_info_d7d58472d0bab115=function(e){console.info(Ln(e))},r.wbg.__wbg_log_a4530b4fe289336f=function(e){console.log(Ln(e))},r.wbg.__wbg_warn_f260f49434e45e62=function(e){console.warn(Ln(e))},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ir(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Ln(t).stack,i=Fo(n,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),o=wi;gt()[e/4+1]=o,gt()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Or(e,t))}finally{Ze.__wbindgen_free(n,i,1)}},r.wbg.__wbg_performance_3f3012faa4463882=function(e){const t=Ln(e).performance;return ir(t)},r.wbg.__wbg_now_2fd65358804c9485=function(e){return Ln(e).now()},r.wbg.__wbg_get_f01601b5a68d10e3=function(e,t){const n=Ln(e)[t>>>0];return ir(n)},r.wbg.__wbg_length_1009b1af0c481d7b=function(e){return Ln(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Ln(e)=="function"},r.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,t){const n=new Function(Or(e,t));return ir(n)},r.wbg.__wbg_next_9b877f231f476d01=function(e){const t=Ln(e).next;return ir(t)},r.wbg.__wbg_next_6529ee0cca8d57ed=function(){return Ml(function(e){const t=Ln(e).next();return ir(t)},arguments)},r.wbg.__wbg_done_5fe336b092d60cf2=function(e){return Ln(e).done},r.wbg.__wbg_value_0c248a78fdc8e19f=function(e){const t=Ln(e).value;return ir(t)},r.wbg.__wbg_iterator_db7ca081358d4fb2=function(){return ir(Symbol.iterator)},r.wbg.__wbg_get_7b48513de5dc5ea4=function(){return Ml(function(e,t){const n=Reflect.get(Ln(e),Ln(t));return ir(n)},arguments)},r.wbg.__wbg_call_90c26b09837aba1c=function(){return Ml(function(e,t){const n=Ln(e).call(Ln(t));return ir(n)},arguments)},r.wbg.__wbg_self_f0e34d89f33b99fd=function(){return Ml(function(){const e=self.self;return ir(e)},arguments)},r.wbg.__wbg_window_d3b084224f4774d7=function(){return Ml(function(){const e=window.window;return ir(e)},arguments)},r.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return Ml(function(){const e=globalThis.globalThis;return ir(e)},arguments)},r.wbg.__wbg_global_35dfdd59a4da3e74=function(){return Ml(function(){const e=global.global;return ir(e)},arguments)},r.wbg.__wbg_isArray_74fb723e24f76012=function(e){return Array.isArray(Ln(e))},r.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let t;try{t=Ln(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_isSafeInteger_f93fde0dca9820f8=function(e){return Number.isSafeInteger(Ln(e))},r.wbg.__wbg_entries_9e2e2aa45aa5094a=function(e){const t=Object.entries(Ln(e));return ir(t)},r.wbg.__wbg_buffer_a448f833075b71ba=function(e){const t=Ln(e).buffer;return ir(t)},r.wbg.__wbg_new_8f67e318f15d7254=function(e){const t=new Uint8Array(Ln(e));return ir(t)},r.wbg.__wbg_set_2357bf09366ee480=function(e,t,n){Ln(e).set(Ln(t),n>>>0)},r.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return Ln(e).length},r.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let t;try{t=Ln(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=Ln(t),i=typeof n=="bigint"?n:void 0;KI()[e/8+1]=Zu(i)?BigInt(0):i,gt()[e/4+0]=!Zu(i)},r.wbg.__wbindgen_debug_string=function(e,t){const n=xg(Ln(t)),i=Fo(n,Ze.__wbindgen_malloc,Ze.__wbindgen_realloc),o=wi;gt()[e/4+1]=o,gt()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Or(e,t))},r.wbg.__wbindgen_memory=function(){const e=Ze.memory;return ir(e)},r}function tA(r,e){return Ze=r.exports,O2.__wbindgen_wasm_module=e,Mf=null,Tf=null,Cf=null,Sf=null,Ze}async function O2(r){if(Ze!==void 0)return Ze;typeof r>"u"&&(r="/ltn/assets/backend_bg.wasm");const e=eA();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await QI(await r,e);return tA(t,n)}const nA=r=>({}),kv=r=>({}),rA=r=>({}),Sv=r=>({}),iA=r=>({}),Tv=r=>({});function oA(r){let e,t,n,i,o,u,s,d;const p=r[1].top,g=vn(p,r,r[0],Tv),_=r[1].left,x=vn(_,r,r[0],Sv),C=r[1].main,M=vn(C,r,r[0],kv);return{c(){e=U("div"),t=U("div"),g&&g.c(),n=oe(),i=U("div"),o=U("div"),x&&x.c(),u=oe(),s=U("div"),M&&M.c(),he(t,"class","top svelte-29q570"),he(o,"class","left svelte-29q570"),he(s,"class","main svelte-29q570"),he(i,"class","content svelte-29q570"),he(e,"class","flex-container svelte-29q570")},m(P,A){W(P,e,A),F(e,t),g&&g.m(t,null),F(e,n),F(e,i),F(i,o),x&&x.m(o,null),F(i,u),F(i,s),M&&M.m(s,null),d=!0},p(P,[A]){g&&g.p&&(!d||A&1)&&wn(g,p,P,P[0],d?bn(p,P[0],A,iA):xn(P[0]),Tv),x&&x.p&&(!d||A&1)&&wn(x,_,P,P[0],d?bn(_,P[0],A,rA):xn(P[0]),Sv),M&&M.p&&(!d||A&1)&&wn(M,C,P,P[0],d?bn(C,P[0],A,nA):xn(P[0]),kv)},i(P){d||(N(g,P),N(x,P),N(M,P),d=!0)},o(P){V(g,P),V(x,P),V(M,P),d=!1},d(P){P&&H(e),g&&g.d(P),x&&x.d(P),M&&M.d(P)}}}function sA(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class aA extends Lt{constructor(e){super(),Et(this,e,sA,oA,Tt,{})}}const lA=r=>({}),Cv=r=>({}),uA=r=>({}),Mv=r=>({}),cA=r=>({}),Ev=r=>({});function fA(r){let e,t,n,i,o,u;const s=r[4].top,d=vn(s,r,r[3],Ev),p=r[4].sidebar,g=vn(p,r,r[3],Mv),_=r[4].map,x=vn(_,r,r[3],Cv);return{c(){e=U("div"),d&&d.c(),t=oe(),n=U("div"),g&&g.c(),i=oe(),o=U("div"),x&&x.c()},m(C,M){W(C,e,M),d&&d.m(e,null),r[5](e),W(C,t,M),W(C,n,M),g&&g.m(n,null),r[6](n),W(C,i,M),W(C,o,M),x&&x.m(o,null),r[7](o),u=!0},p(C,[M]){d&&d.p&&(!u||M&8)&&wn(d,s,C,C[3],u?bn(s,C[3],M,cA):xn(C[3]),Ev),g&&g.p&&(!u||M&8)&&wn(g,p,C,C[3],u?bn(p,C[3],M,uA):xn(C[3]),Mv),x&&x.p&&(!u||M&8)&&wn(x,_,C,C[3],u?bn(_,C[3],M,lA):xn(C[3]),Cv)},i(C){u||(N(d,C),N(g,C),N(x,C),u=!0)},o(C){V(d,C),V(g,C),V(x,C),u=!1},d(C){C&&(H(e),H(t),H(n),H(i),H(o)),d&&d.d(C),r[5](null),g&&g.d(C),r[6](null),x&&x.d(C),r[7](null)}}}function hA(r,e,t){let n,i,o;ct(r,kg,_=>t(0,n=_)),ct(r,Sg,_=>t(1,i=_)),ct(r,Tg,_=>t(2,o=_));let{$$slots:u={},$$scope:s}=e;function d(_){dn[_?"unshift":"push"](()=>{n=_,kg.set(n)})}function p(_){dn[_?"unshift":"push"](()=>{i=_,Sg.set(i)})}function g(_){dn[_?"unshift":"push"](()=>{o=_,Tg.set(o)})}return r.$$set=_=>{"$$scope"in _&&t(3,s=_.$$scope)},[n,i,o,s,u,d,p,g]}class So extends Lt{constructor(e){super(),Et(this,e,hA,fA,Tt,{})}}let kg=In(null),Sg=In(null),Tg=In(null);const dA="/ltn/assets/streets-v2-style-b76f3b8b.json";function pA(r){let e;return{c(){e=Ee("Back")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function mA(r){let e,t,n,i;return e=new ah({props:{$$slots:{default:[pA]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=It(window,"keydown",r[2]),n=!0)},p(o,[u]){const s={};u&16&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}function gA(r,e,t){let n;ct(r,er,s=>t(1,n=s));let{mode:i}=e;function o(s){s.key=="Escape"&&(s.stopPropagation(),ln(er,n=i,n))}const u=()=>ln(er,n=i,n);return r.$$set=s=>{"mode"in s&&t(0,i=s.mode)},[i,n,o,u]}class js extends Lt{constructor(e){super(),Et(this,e,gA,mA,Tt,{mode:0})}}let np=In(null);function Lv(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function Iv(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function _A(r){let e,t=r[6].length+"",n,i;return{c(){e=Ee("Undo ("),n=Ee(t),i=Ee(")")},m(o,u){W(o,e,u),W(o,n,u),W(o,i,u)},p(o,u){u[0]&64&&t!==(t=o[6].length+"")&&St(n,t)},d(o){o&&(H(e),H(n),H(i))}}}function yA(r){let e;return{c(){e=Ee("Undo")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function vA(r){let e;return{c(){e=U("span"),he(e,"class","dot svelte-11yzwwb"),Gt(e,"snapped-node",r[40].snapped),Gt(e,"free-node",!r[40].snapped),Gt(e,"hide",r[4])},m(t,n){W(t,e,n)},p(t,n){n[0]&128&&Gt(e,"snapped-node",t[40].snapped),n[0]&128&&Gt(e,"free-node",!t[40].snapped),n[0]&16&&Gt(e,"hide",t[4])},d(t){t&&H(e)}}}function Av(r){let e,t,n;function i(p){r[23](p,r[40])}function o(){return r[24](r[40])}function u(){return r[25](r[40])}function s(){return r[26](r[40])}let d={draggable:!0,zIndex:0,$$slots:{default:[vA]},$$scope:{ctx:r}};return r[40].point!==void 0&&(d.lngLat=r[40].point),e=new ap({props:d}),dn.push(()=>Dn(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",u),e.$on("dragend",r[16]),e.$on("click",s),{c(){ue(e.$$.fragment)},m(p,g){ae(e,p,g),n=!0},p(p,g){r=p;const _={};g[0]&144|g[1]&4096&&(_.$$scope={dirty:g,ctx:r}),!t&&g[0]&128&&(t=!0,_.lngLat=r[40].point,zn(()=>t=!1)),e.$set(_)},i(p){n||(N(e.$$.fragment,p),n=!0)},o(p){V(e.$$.fragment,p),n=!1},d(p){le(e,p)}}}function bA(r){let e;return{c(){e=U("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,Qe(e,"padding-right","0"),Qe(e,"padding-left","20px"),Qe(e,"margin","0")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function wA(r){let e,t,n,i;return n=new Aw({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[bA]},$$scope:{ctx:r}}}),{c(){e=U("span"),e.textContent=`${r[39]+1}`,t=oe(),ue(n.$$.fragment),he(e,"class","dot svelte-11yzwwb"),Gt(e,"snapped",r[37].snapped)},m(o,u){W(o,e,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){(!i||u[0]&1)&&Gt(e,"snapped",o[37].snapped);const s={};u[1]&4096&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){V(n.$$.fragment,o),i=!1},d(o){o&&(H(e),H(t)),le(n,o)}}}function Pv(r){let e,t,n;function i(d){r[27](d,r[37])}function o(){return r[28](r[39])}function u(){return r[29](r[39])}let s={draggable:!0,zIndex:1,$$slots:{default:[wA]},$$scope:{ctx:r}};return r[37].point!==void 0&&(s.lngLat=r[37].point),e=new ap({props:s}),dn.push(()=>Dn(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",u),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){ue(e.$$.fragment)},m(d,p){ae(e,d,p),n=!0},p(d,p){r=d;const g={};p[0]&1|p[1]&4096&&(g.$$scope={dirty:p,ctx:r}),!t&&p[0]&1&&(t=!0,g.lngLat=r[37].point,zn(()=>t=!1)),e.$set(g)},i(d){n||(N(e.$$.fragment,d),n=!0)},o(d){V(e.$$.fragment,d),n=!1},d(d){le(e,d)}}}function xA(r){let e,t,n,i;const o=[_n("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new Xi({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function kA(r){let e,t;const n=[_n("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function SA(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z,X;function q(Fe,Ne){return Fe[6].length==0?yA:_A}let Y=q(r),fe=Y(r);x=new Wg({}),x.$on("click",r[10]),x.$on("mousemove",r[11]);let Le=$n(r[7]),ee=[];for(let Fe=0;Fe<Le.length;Fe+=1)ee[Fe]=Av(Iv(r,Le,Fe));const ie=Fe=>V(ee[Fe],1,1,()=>{ee[Fe]=null});let ve=$n(r[0]),ye=[];for(let Fe=0;Fe<ve.length;Fe+=1)ye[Fe]=Pv(Lv(r,ve,Fe));const it=Fe=>V(ye[Fe],1,1,()=>{ye[Fe]=null});return A=new gr({props:{data:r[1]||Ji(),generateId:!0,$$slots:{default:[xA]},$$scope:{ctx:r}}}),I=new gr({props:{data:r[8],$$slots:{default:[kA]},$$scope:{ctx:r}}}),O=Pg(r[22][0]),{c(){e=U("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=oe(),n=U("div"),i=U("label"),o=U("input"),s=Ee(`
    Snap boundary to roads`),d=oe(),p=U("button"),fe.c(),_=oe(),ue(x.$$.fragment),C=oe();for(let Fe=0;Fe<ee.length;Fe+=1)ee[Fe].c();M=oe();for(let Fe=0;Fe<ye.length;Fe+=1)ye[Fe].c();P=oe(),ue(A.$$.fragment),L=oe(),ue(I.$$.fragment),o.disabled=u=r[0].length>=3,he(o,"type","checkbox"),o.__value="snap",Zn(o,o.__value),he(p,"class","secondary"),p.disabled=g=r[6].length==0,Qe(n,"display","flex"),Qe(n,"gap","16px"),O.p(o)},m(Fe,Ne){W(Fe,e,Ne),W(Fe,t,Ne),W(Fe,n,Ne),F(n,i),F(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),F(i,s),F(n,d),F(n,p),fe.m(p,null),W(Fe,_,Ne),ae(x,Fe,Ne),W(Fe,C,Ne);for(let Ae=0;Ae<ee.length;Ae+=1)ee[Ae]&&ee[Ae].m(Fe,Ne);W(Fe,M,Ne);for(let Ae=0;Ae<ye.length;Ae+=1)ye[Ae]&&ye[Ae].m(Fe,Ne);W(Fe,P,Ne),ae(A,Fe,Ne),W(Fe,L,Ne),ae(I,Fe,Ne),$=!0,Z||(X=[It(o,"change",r[21]),It(p,"click",r[9])],Z=!0)},p(Fe,Ne){if((!$||Ne[0]&1&&u!==(u=Fe[0].length>=3))&&(o.disabled=u),Ne[0]&32&&(o.checked=~(Fe[5]||[]).indexOf(o.__value)),Y===(Y=q(Fe))&&fe?fe.p(Fe,Ne):(fe.d(1),fe=Y(Fe),fe&&(fe.c(),fe.m(p,null))),(!$||Ne[0]&64&&g!==(g=Fe[6].length==0))&&(p.disabled=g),Ne[0]&114832){Le=$n(Fe[7]);let Ye;for(Ye=0;Ye<Le.length;Ye+=1){const ut=Iv(Fe,Le,Ye);ee[Ye]?(ee[Ye].p(ut,Ne),N(ee[Ye],1)):(ee[Ye]=Av(ut),ee[Ye].c(),N(ee[Ye],1),ee[Ye].m(M.parentNode,M))}for(Xt(),Ye=Le.length;Ye<ee.length;Ye+=1)ie(Ye);Yt()}if(Ne[0]&143373){ve=$n(Fe[0]);let Ye;for(Ye=0;Ye<ve.length;Ye+=1){const ut=Lv(Fe,ve,Ye);ye[Ye]?(ye[Ye].p(ut,Ne),N(ye[Ye],1)):(ye[Ye]=Pv(ut),ye[Ye].c(),N(ye[Ye],1),ye[Ye].m(P.parentNode,P))}for(Xt(),Ye=ve.length;Ye<ye.length;Ye+=1)it(Ye);Yt()}const Ae={};Ne[0]&2&&(Ae.data=Fe[1]||Ji()),Ne[1]&4096&&(Ae.$$scope={dirty:Ne,ctx:Fe}),A.$set(Ae);const ot={};Ne[0]&256&&(ot.data=Fe[8]),Ne[1]&4096&&(ot.$$scope={dirty:Ne,ctx:Fe}),I.$set(ot)},i(Fe){if(!$){N(x.$$.fragment,Fe);for(let Ne=0;Ne<Le.length;Ne+=1)N(ee[Ne]);for(let Ne=0;Ne<ve.length;Ne+=1)N(ye[Ne]);N(A.$$.fragment,Fe),N(I.$$.fragment,Fe),$=!0}},o(Fe){V(x.$$.fragment,Fe),ee=ee.filter(Boolean);for(let Ne=0;Ne<ee.length;Ne+=1)V(ee[Ne]);ye=ye.filter(Boolean);for(let Ne=0;Ne<ye.length;Ne+=1)V(ye[Ne]);V(A.$$.fragment,Fe),V(I.$$.fragment,Fe),$=!1},d(Fe){Fe&&(H(e),H(t),H(n),H(_),H(C),H(M),H(P),H(L)),fe.d(),le(x,Fe),_i(ee,Fe),_i(ye,Fe),le(A,Fe),le(I,Fe),O.r(),Z=!1,cr(X)}}}function TA(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function CA(r,e,t){let n,i;ct(r,np,He=>t(20,i=He));let{map:o}=e,{waypoints:u}=e,{drawnShapeOut:s=void 0}=e;ri(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let d="snap",p=[],g=[],_=null,x=!1,C=!1,M=!1;function P(He){let mt=He.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=mt}function A(){let He=p.pop();t(6,p),He&&t(0,u=He)}function L(){p.length==100&&p.shift(),t(6,p=[...p,JSON.parse(JSON.stringify(u))])}function I(He){u.length>=3||(L(),u.push({point:He.detail.lngLat.toArray(),snapped:d=="snap"}),t(0,u))}function $(He){t(19,_={point:He.detail.lngLat.toArray(),snapped:d=="snap"})}function O(He){L(),t(0,u[He].snapped=!u[He].snapped,u),t(0,u)}function Z(He){L(),u.splice(He,1),t(0,u),t(2,x=!1)}function X(He,mt,Pt,jt){if(jt||mt.length>=3)return Ji();try{if(He&&mt.length>0&&Pt)return JSON.parse(He.inner.calculateRoute([mt[mt.length-1],Pt]))}catch{}return Ji()}function q(He,mt,Pt){if(Pt)return;if(!He||mt.length<3){t(7,g=[]);return}let jt=[],un=1,nn=JSON.parse(JSON.stringify(mt));nn.push(nn[0]);for(let rn=0;rn<nn.length-1;rn++){let pn=JSON.parse(He.inner.getExtraNodes(nn[rn],nn[rn+1]));for(let[yn,qe,We]of pn)jt.push({point:[yn,qe],snapped:We,insertIdx:un});un++}t(7,g=jt)}function Y(He){L(),u.splice(He.insertIdx,0,{point:He.point,snapped:He.snapped}),t(0,u),t(4,M=!0)}function fe(He){t(0,u[He.insertIdx].point=He.point,u),t(0,u)}function Le(){t(4,M=!1)}function ee(){L(),t(3,C=!0)}const ie=[[]];function ve(){d=Kk(ie[0],this.__value,this.checked),t(5,d)}function ye(He,mt){r.$$.not_equal(mt.point,He)&&(mt.point=He,t(7,g))}const it=He=>Y(He),Fe=He=>fe(He),Ne=He=>{Y(He),t(4,M=!1)};function Ae(He,mt){r.$$.not_equal(mt.point,He)&&(mt.point=He,t(0,u))}const ot=He=>O(He),Ye=He=>Z(He),ut=()=>t(2,x=!0),pt=()=>t(2,x=!1),_t=()=>t(3,C=!1);return r.$$set=He=>{"map"in He&&t(18,o=He.map),"waypoints"in He&&t(0,u=He.waypoints),"drawnShapeOut"in He&&t(1,s=He.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,s=TA(i,u))}catch(He){console.log("error drawing shape",He),t(1,s=void 0)}r.$$.dirty[0]&1048593&&q(i,u,M),r.$$.dirty[0]&1572877&&t(8,n=X(i,u,_,x||C)),r.$$.dirty[0]&1&&P(u)},[u,s,x,C,M,d,p,g,n,A,I,$,O,Z,Y,fe,Le,ee,o,_,i,ve,ie,ye,it,Fe,Ne,Ae,ot,Ye,ut,pt,_t]}class $2 extends Lt{constructor(e){super(),Et(this,e,CA,SA,Tt,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function zv(r){let e,t,n,i,o=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",u,s,d,p,g,_,x,C=r[0].properties.simd.toFixed(1)+"",M,P,A,L,I,$,O,Z=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",X,q,Y,fe,Le,ee,ie,ve=ac(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",ye,it,Fe,Ne,Ae,ot,Ye,ut=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",pt,_t;return{c(){e=U("tr"),t=U("th"),t.textContent="Population density",n=oe(),i=U("td"),u=Ee(o),s=Ee(" people / km"),d=oe(),p=U("tr"),g=U("th"),g.textContent="SIMD",_=oe(),x=U("td"),M=Ee(C),P=Ee("%"),A=oe(),L=U("tr"),I=U("th"),I.textContent="Collision density",$=oe(),O=U("td"),X=Ee(Z),q=Ee(" / km"),Y=oe(),fe=U("tr"),Le=U("th"),Le.textContent="Car ownership",ee=oe(),ie=U("td"),ye=Ee(ve),it=Ee(" of households"),Fe=oe(),Ne=U("tr"),Ae=U("th"),Ae.textContent="POI density",ot=oe(),Ye=U("td"),pt=Ee(ut),_t=Ee(" / km")},m(He,mt){W(He,e,mt),F(e,t),F(e,n),F(e,i),F(i,u),F(i,s),W(He,d,mt),W(He,p,mt),F(p,g),F(p,_),F(p,x),F(x,M),F(x,P),W(He,A,mt),W(He,L,mt),F(L,I),F(L,$),F(L,O),F(O,X),F(O,q),W(He,Y,mt),W(He,fe,mt),F(fe,Le),F(fe,ee),F(fe,ie),F(ie,ye),F(ie,it),W(He,Fe,mt),W(He,Ne,mt),F(Ne,Ae),F(Ne,ot),F(Ne,Ye),F(Ye,pt),F(Ye,_t)},p(He,mt){mt&1&&o!==(o=Math.round(He[0].properties.population/He[0].properties.area_km2).toLocaleString()+"")&&St(u,o),mt&1&&C!==(C=He[0].properties.simd.toFixed(1)+"")&&St(M,C),mt&1&&Z!==(Z=(He[0].properties.number_stats19_collisions/He[0].properties.area_km2).toFixed(1)+"")&&St(X,Z),mt&1&&ve!==(ve=ac(He[0].properties.households_with_cars_or_vans,He[0].properties.total_households)+"")&&St(ye,ve),mt&1&&ut!==(ut=(He[0].properties.number_pois/He[0].properties.area_km2).toFixed(1)+"")&&St(pt,ut)},d(He){He&&(H(e),H(d),H(p),H(A),H(L),H(Y),H(fe),H(Fe),H(Ne))}}}function MA(r){let e,t,n,i,o,u=r[0].properties.area_km2.toFixed(1)+"",s,d,p,g=r[1]=="cnt"&&zv(r);return{c(){e=U("table"),t=U("tr"),n=U("th"),n.textContent="Area",i=oe(),o=U("td"),s=Ee(u),d=Ee(" km"),p=oe(),g&&g.c(),he(e,"class","svelte-1kpsyee")},m(_,x){W(_,e,x),F(e,t),F(t,n),F(t,i),F(t,o),F(o,s),F(o,d),F(e,p),g&&g.m(e,null)},p(_,[x]){x&1&&u!==(u=_[0].properties.area_km2.toFixed(1)+"")&&St(s,u),_[1]=="cnt"?g?g.p(_,x):(g=zv(_),g.c(),g.m(e,null)):g&&(g.d(1),g=null)},i:at,o:at,d(_){_&&H(e),g&&g.d()}}}function EA(r,e,t){let n;ct(r,ks,o=>t(1,n=o));let{neighbourhoodBoundary:i}=e;return r.$$set=o=>{"neighbourhoodBoundary"in o&&t(0,i=o.neighbourhoodBoundary)},[i,n]}class B2 extends Lt{constructor(e){super(),Et(this,e,EA,MA,Tt,{neighbourhoodBoundary:0})}}function N2(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function LA(r){let e,t,n,i;return e=new Vo({props:{colorScale:p2,labels:{limits:d2}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.textContent="POIs / km",Qe(n,"text-align","center")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function IA(r){let e,t,n,i;return e=new Vo({props:{colorScale:h2,labels:{limits:f2}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.textContent="collisions / km",Qe(n,"text-align","center")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function AA(r){let e,t,n,i;return e=new Vo({props:{colorScale:fp,labels:{buckets:m2(hp)}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML="<span>More deprived</span> <span>Less deprived</span>",he(n,"class","sub-labels svelte-3xhwrh")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function PA(r){let e,t,n,i;return e=new Vo({props:{colorScale:gp,labels:{limits:mp.map(RA)}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Qe(n,"display","flex"),Qe(n,"justify-content","space-between")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function zA(r){let e,t,n,i;return e=new Vo({props:{colorScale:dp,labels:{limits:pp}}}),{c(){ue(e.$$.fragment),t=oe(),n=U("div"),n.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",he(n,"class","sub-labels svelte-3xhwrh")},m(o,u){ae(e,o,u),W(o,t,u),W(o,n,u),i=!0},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),le(e,o)}}}function DA(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L;const I=[zA,PA,AA,IA,LA],$=[];function O(Z,X){return Z[0]=="density"?0:Z[0]=="car_ownership"?1:Z[0]=="simd"?2:Z[0]=="stats19"?3:Z[0]=="pois"?4:-1}return~(x=O(r))&&(C=$[x]=I[x](r)),{c(){e=U("div"),t=U("label"),t.textContent="Metric",n=oe(),i=U("select"),o=U("option"),o.textContent="None",u=U("option"),u.textContent="Density",s=U("option"),s.textContent="Collisions",d=U("option"),d.textContent="SIMD",p=U("option"),p.textContent="Points of interest",g=U("option"),g.textContent="Car ownership",_=oe(),C&&C.c(),M=tr(),Qe(t,"margin","0"),Qe(t,"padding","0"),he(t,"for","prioritization-selection"),o.__value="none",Zn(o,o.__value),u.__value="density",Zn(u,u.__value),s.__value="stats19",Zn(s,s.__value),d.__value="simd",Zn(d,d.__value),p.__value="pois",Zn(p,p.__value),g.__value="car_ownership",Zn(g,g.__value),he(i,"id","prioritization-selection"),r[0]===void 0&&ys(()=>r[1].call(i)),Qe(e,"display","flex"),Qe(e,"gap","16px"),Qe(e,"align-items","center"),Qe(e,"width","fit-content")},m(Z,X){W(Z,e,X),F(e,t),F(e,n),F(e,i),F(i,o),F(i,u),F(i,s),F(i,d),F(i,p),F(i,g),Zi(i,r[0],!0),W(Z,_,X),~x&&$[x].m(Z,X),W(Z,M,X),P=!0,A||(L=It(i,"change",r[1]),A=!0)},p(Z,[X]){X&1&&Zi(i,Z[0]);let q=x;x=O(Z),x!==q&&(C&&(Xt(),V($[q],1,1,()=>{$[q]=null}),Yt()),~x?(C=$[x],C||(C=$[x]=I[x](Z),C.c()),N(C,1),C.m(M.parentNode,M)):C=null)},i(Z){P||(N(C),P=!0)},o(Z){V(C),P=!1},d(Z){Z&&(H(e),H(_),H(M)),~x&&$[x].d(Z),A=!1,L()}}}const RA=r=>`${r}%`;function FA(r,e,t){let n;ct(r,ks,s=>t(2,n=s));let{selectedPrioritization:i}=e;function o(){let s=new URL(window.location.href).searchParams.get("prioritizationMetric");s=="density"?t(0,i="density"):s=="simd"?t(0,i="simd"):s=="stats19"?t(0,i="stats19"):s=="pois"?t(0,i="pois"):s=="car_ownership"&&t(0,i="car_ownership")}n=="cnt"?o():i="none";function u(){i=Ra(this),t(0,i)}return r.$$set=s=>{"selectedPrioritization"in s&&t(0,i=s.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const s=new URL(window.location.href);i=="none"?s.searchParams.delete("prioritizationMetric"):s.searchParams.set("prioritizationMetric",i),history.replaceState({},"",s)}},[i,u]}class j2 extends Lt{constructor(e){super(),Et(this,e,FA,DA,Tt,{selectedPrioritization:0})}}function U2(r,e){return{none:r.none,area:fo(["get","area_km2"],FM,OM),car_ownership:fo(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],mp,gp),density:fo(["/",["get","population"],["get","area_km2"]],pp,dp),pois:fo(["/",["get","number_pois"],["get","area_km2"]],d2,p2),simd:fo(["get","simd"],hp,fp),stats19:fo(["/",["get","number_stats19_collisions"],["get","area_km2"]],f2,h2)}[e]}function OA(r){let e,t,n,i,o,u,s,d,p,g,_=_r(r[8].mode)+"",x,C;return o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),x=Ee(_),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(M,P){W(M,e,P),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),F(n,g),F(g,x),C=!0},p(M,P){(!C||P&256)&&_!==(_=_r(M[8].mode)+"")&&St(x,_)},i(M){C||(N(o.$$.fragment,M),N(d.$$.fragment,M),C=!0)},o(M){V(o.$$.fragment,M),V(d.$$.fragment,M),C=!1},d(M){M&&H(e),le(o),le(d)}}}function Dv(r){let e,t,n,i,o,u,s;function d(g){r[20](g)}let p={};return r[4]!==void 0&&(p.selectedPrioritization=r[4]),o=new j2({props:p}),dn.push(()=>Dn(o,"selectedPrioritization",d)),{c(){e=U("h3"),e.textContent="Prioritization",t=oe(),n=U("p"),n.textContent="Compare metrics across candidate neighbourhoods.",i=oe(),ue(o.$$.fragment)},m(g,_){W(g,e,_),W(g,t,_),W(g,n,_),W(g,i,_),ae(o,g,_),s=!0},p(g,_){const x={};!u&&_&16&&(u=!0,x.selectedPrioritization=g[4],zn(()=>u=!1)),o.$set(x)},i(g){s||(N(o.$$.fragment,g),s=!0)},o(g){V(o.$$.fragment,g),s=!1},d(g){g&&(H(e),H(t),H(n),H(i)),le(o,g)}}}function Rv(r){let e;return{c(){e=U("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function $A(r){let e,t,n,i,o,u,s,d;function p(x){r[23](x)}function g(x){r[24](x)}let _={map:kr(r[10])};return r[6]!==void 0&&(_.waypoints=r[6]),r[1]!==void 0&&(_.drawnShapeOut=r[1]),n=new $2({props:_}),dn.push(()=>Dn(n,"waypoints",p)),dn.push(()=>Dn(n,"drawnShapeOut",g)),{c(){e=U("div"),e.innerHTML='<h3 class="svelte-iaefgo">1. Draw your neighbourhood</h3>',t=oe(),ue(n.$$.fragment),u=oe(),s=U("div"),s.innerHTML=`<h3 class="svelte-iaefgo">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,he(e,"class","step svelte-iaefgo"),Gt(e,"active",!r[7]),Gt(e,"complete",r[7]),he(s,"class","step svelte-iaefgo"),Qe(s,"margin-top","16px"),Gt(s,"active",r[7]),Gt(s,"complete",r[5].size>1)},m(x,C){W(x,e,C),W(x,t,C),ae(n,x,C),W(x,u,C),W(x,s,C),d=!0},p(x,C){(!d||C&128)&&Gt(e,"active",!x[7]),(!d||C&128)&&Gt(e,"complete",x[7]);const M={};C&1024&&(M.map=kr(x[10])),!i&&C&64&&(i=!0,M.waypoints=x[6],zn(()=>i=!1)),!o&&C&2&&(o=!0,M.drawnShapeOut=x[1],zn(()=>o=!1)),n.$set(M),(!d||C&128)&&Gt(s,"active",x[7]),(!d||C&32)&&Gt(s,"complete",x[5].size>1)},i(x){d||(N(n.$$.fragment,x),d=!0)},o(x){V(n.$$.fragment,x),d=!1},d(x){x&&(H(e),H(t),H(u),H(s)),le(n,x)}}}function BA(r){let e,t,n;return{c(){e=U("div"),e.innerHTML=`<h3 class="svelte-iaefgo">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=oe(),n=U("div"),n.innerHTML='<h3 class="svelte-iaefgo">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',he(e,"class","step svelte-iaefgo"),Gt(e,"active",!r[7]),Gt(e,"complete",r[7]),he(n,"class","step svelte-iaefgo"),Gt(n,"active",r[7]),Gt(n,"complete",r[5].size>1)},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o&128&&Gt(e,"active",!i[7]),o&128&&Gt(e,"complete",i[7]),o&128&&Gt(n,"active",i[7]),o&32&&Gt(n,"complete",i[5].size>1)},i:at,o:at,d(i){i&&(H(e),H(t),H(n))}}}function NA(r){let e;function t(o,u){if(o[0]=="choose-area")return VA;if(o[0]=="draw-area")return UA}let n=t(r),i=n&&n(r);return{c(){e=U("span"),i&&i.c(),Qe(e,"text-align","center")},m(o,u){W(o,e,u),i&&i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:at,o:at,d(o){o&&H(e),i&&i.d()}}}function jA(r){let e,t;return e=new B2({props:{neighbourhoodBoundary:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function UA(r){let e;function t(o,u){return o[6].length<3?HA:qA}let n=t(r),i=n(r);return{c(){i.c(),e=tr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i.d(o)}}}function VA(r){let e;return{c(){e=Ee("Empty so far. Click a colored area to get started.")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function qA(r){let e;return{c(){e=Ee(`Not a valid shape yet  try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function HA(r){let e;return{c(){e=Ee(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function WA(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z,X,q,Y,fe,Le,ee,ie,ve,ye,it,Fe,Ne,Ae,ot,Ye,ut,pt,_t,He,mt,Pt,jt,un;t=new js({props:{mode:{mode:"pick-neighbourhood"}}});let nn=r[9]=="cnt"&&Dv(r),rn=r[4]=="none"&&Rv();_=new xw({}),P=new Ug({});const pn=[BA,$A],yn=[];function qe(pe,fn){return pe[0]=="choose-area"?0:pe[0]=="draw-area"?1:-1}~(I=qe(r))&&($=yn[I]=pn[I](r)),ve=new Vg({});const We=[jA,NA],Ke=[];function kt(pe,fn){return pe[7]?0:1}return Ye=kt(r),ut=Ke[Ye]=We[Ye](r),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),nn&&nn.c(),i=oe(),rn&&rn.c(),o=oe(),u=U("hr"),s=oe(),d=U("div"),p=U("div"),g=U("button"),ue(_.$$.fragment),x=Ee(`
          Choose area`),C=Ee(`
        or
        `),M=U("button"),ue(P.$$.fragment),A=Ee(`
          Draw area`),L=oe(),$&&$.c(),O=oe(),Z=U("div"),Z.innerHTML='<h3 class="svelte-iaefgo">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',X=oe(),q=U("div"),Y=U("button"),fe=Ee("Create neighborhood"),ee=oe(),ie=U("button"),ue(ve.$$.fragment),ye=Ee(" Start over"),Fe=oe(),Ne=U("h3"),Ne.textContent="Your neighbourhood overall",Ae=oe(),ot=U("div"),ut.c(),pt=oe(),_t=U("hr"),He=oe(),mt=U("button"),mt.textContent="Export to GeoJSON",Gt(g,"active",r[0]=="choose-area"),Gt(M,"active",r[0]=="draw-area"),he(p,"class","tool-palette svelte-iaefgo"),Qe(p,"display","flex"),Qe(p,"align-items","center"),Qe(p,"gap","16px"),he(Z,"class","step svelte-iaefgo"),Gt(Z,"active",r[7]),Y.disabled=Le=!r[7],he(ie,"class","destructive"),Qe(ie,"display","flex"),Qe(ie,"gap","8px"),Qe(ie,"align-items","center"),ie.disabled=it=!(r[7]||r[0]=="draw-area"&&r[6].length>0),Qe(q,"display","flex"),Qe(q,"gap","16px"),Qe(q,"justify-content","space-between"),Qe(q,"margin-bottom","16px"),he(ot,"class","neighbourhood-boundary-summary svelte-iaefgo"),he(mt,"class","secondary"),he(e,"slot","sidebar")},m(pe,fn){W(pe,e,fn),ae(t,e,null),F(e,n),nn&&nn.m(e,null),F(e,i),rn&&rn.m(e,null),F(e,o),F(e,u),F(e,s),F(e,d),F(d,p),F(p,g),ae(_,g,null),F(g,x),F(p,C),F(p,M),ae(P,M,null),F(M,A),F(d,L),~I&&yn[I].m(d,null),F(d,O),F(d,Z),F(d,X),F(d,q),F(q,Y),F(Y,fe),F(q,ee),F(q,ie),ae(ve,ie,null),F(ie,ye),F(d,Fe),F(d,Ne),F(d,Ae),F(d,ot),Ke[Ye].m(ot,null),F(e,pt),F(e,_t),F(e,He),F(e,mt),Pt=!0,jt||(un=[It(g,"click",r[21]),It(M,"click",r[22]),It(Y,"click",r[25]),It(ie,"click",r[16]),It(mt,"click",r[13])],jt=!0)},p(pe,fn){pe[9]=="cnt"?nn?(nn.p(pe,fn),fn&512&&N(nn,1)):(nn=Dv(pe),nn.c(),N(nn,1),nn.m(e,i)):nn&&(Xt(),V(nn,1,1,()=>{nn=null}),Yt()),pe[4]=="none"?rn||(rn=Rv(),rn.c(),rn.m(e,o)):rn&&(rn.d(1),rn=null),(!Pt||fn&1)&&Gt(g,"active",pe[0]=="choose-area"),(!Pt||fn&1)&&Gt(M,"active",pe[0]=="draw-area");let Xe=I;I=qe(pe),I===Xe?~I&&yn[I].p(pe,fn):($&&(Xt(),V(yn[Xe],1,1,()=>{yn[Xe]=null}),Yt()),~I?($=yn[I],$?$.p(pe,fn):($=yn[I]=pn[I](pe),$.c()),N($,1),$.m(d,O)):$=null),(!Pt||fn&128)&&Gt(Z,"active",pe[7]),(!Pt||fn&128&&Le!==(Le=!pe[7]))&&(Y.disabled=Le),(!Pt||fn&193&&it!==(it=!(pe[7]||pe[0]=="draw-area"&&pe[6].length>0)))&&(ie.disabled=it);let lt=Ye;Ye=kt(pe),Ye===lt?Ke[Ye].p(pe,fn):(Xt(),V(Ke[lt],1,1,()=>{Ke[lt]=null}),Yt(),ut=Ke[Ye],ut?ut.p(pe,fn):(ut=Ke[Ye]=We[Ye](pe),ut.c()),N(ut,1),ut.m(ot,null))},i(pe){Pt||(N(t.$$.fragment,pe),N(nn),N(_.$$.fragment,pe),N(P.$$.fragment,pe),N($),N(ve.$$.fragment,pe),N(ut),Pt=!0)},o(pe){V(t.$$.fragment,pe),V(nn),V(_.$$.fragment,pe),V(P.$$.fragment,pe),V($),V(ve.$$.fragment,pe),V(ut),Pt=!1},d(pe){pe&&H(e),le(t),nn&&nn.d(),rn&&rn.d(),le(_),le(P),~I&&yn[I].d(),le(ve),Ke[Ye].d(),jt=!1,cr(un)}}}function Fv(r){let e,t;return e=new gr({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[GA]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i&1073741824&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function GA(r){let e,t,n,i;const o=[_n("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new ur({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function Ov(r){let e,t;return e=new gr({props:{data:r[3],generateId:!0,$$slots:{default:[t8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&8&&(o.data=n[3]),i&1073741840&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function $v(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[QA,({props:n})=>({29:n}),({props:n})=>n?536870912:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1610612752&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function ZA(r){let e,t,n,i,o=(r[29].number_pois/r[29].area_km2).toFixed(1)+"",u,s;return{c(){e=U("b"),e.textContent="Points of interest",t=oe(),n=U("br"),i=oe(),u=Ee(o),s=Ee(" / km")},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,u,p),W(d,s,p)},p(d,p){p&536870912&&o!==(o=(d[29].number_pois/d[29].area_km2).toFixed(1)+"")&&St(u,o)},d(d){d&&(H(e),H(t),H(n),H(i),H(u),H(s))}}}function KA(r){let e,t,n,i,o=(r[29].number_stats19_collisions/r[29].area_km2).toFixed(1)+"",u,s;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions",t=oe(),n=U("br"),i=oe(),u=Ee(o),s=Ee(` /
                km`)},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,u,p),W(d,s,p)},p(d,p){p&536870912&&o!==(o=(d[29].number_stats19_collisions/d[29].area_km2).toFixed(1)+"")&&St(u,o)},d(d){d&&(H(e),H(t),H(n),H(i),H(u),H(s))}}}function XA(r){let e,t,n,i,o=Math.round(r[29].population/r[29].area_km2).toLocaleString()+"",u,s;return{c(){e=U("b"),e.textContent="Population density",t=oe(),n=U("br"),i=oe(),u=Ee(o),s=Ee(`
                people / km`)},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,u,p),W(d,s,p)},p(d,p){p&536870912&&o!==(o=Math.round(d[29].population/d[29].area_km2).toLocaleString()+"")&&St(u,o)},d(d){d&&(H(e),H(t),H(n),H(i),H(u),H(s))}}}function YA(r){let e,t,n,i,o=ac(r[29].households_with_cars_or_vans,r[29].total_households)+"",u,s,d=r[29].total_households.toLocaleString()+"",p,g;return{c(){e=U("b"),e.textContent="Car or van ownership",t=oe(),n=U("br"),i=oe(),u=Ee(o),s=Ee(" of approximately "),p=Ee(d),g=Ee(`
                households have at least one car or van.`)},m(_,x){W(_,e,x),W(_,t,x),W(_,n,x),W(_,i,x),W(_,u,x),W(_,s,x),W(_,p,x),W(_,g,x)},p(_,x){x&536870912&&o!==(o=ac(_[29].households_with_cars_or_vans,_[29].total_households)+"")&&St(u,o),x&536870912&&d!==(d=_[29].total_households.toLocaleString()+"")&&St(p,d)},d(_){_&&(H(e),H(t),H(n),H(i),H(u),H(s),H(p),H(g))}}}function JA(r){let e,t,n=r[29].area_km2.toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Area:",t=oe(),i=Ee(n),o=Ee(" km")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s&536870912&&n!==(n=u[29].area_km2.toFixed(1)+"")&&St(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function QA(r){let e;function t(o,u){if(o[4]=="none")return JA;if(o[4]=="car_ownership")return YA;if(o[4]=="density")return XA;if(o[4]=="stats19")return KA;if(o[4]=="pois")return ZA}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=tr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i&&i.d(o)}}}function e8(r){let e,t,n=r[4]!="simd"&&$v(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o&16&&N(n,1)):(n=$v(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function t8(r){let e,t,n,i;const o=[_n("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[e8]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new Xi({props:u}),e.$on("click",r[11]);const s=[_n("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new ur({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _=g&49168?An(o,[o[0],{paint:{"fill-color":p[14](p[4]),"fill-opacity":p[15](p[4])}},o[2],o[3]]):{};g&1073741840&&(_.$$scope={dirty:g,ctx:p}),e.$set(_);const x={};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function n8(r){let e,t,n,i=r[7]&&Fv(r),o=r[0]=="choose-area"&&Ov(r);return{c(){e=U("div"),i&&i.c(),t=oe(),o&&o.c(),he(e,"slot","map")},m(u,s){W(u,e,s),i&&i.m(e,null),F(e,t),o&&o.m(e,null),n=!0},p(u,s){u[7]?i?(i.p(u,s),s&128&&N(i,1)):(i=Fv(u),i.c(),N(i,1),i.m(e,t)):i&&(Xt(),V(i,1,1,()=>{i=null}),Yt()),u[0]=="choose-area"?o?(o.p(u,s),s&1&&N(o,1)):(o=Ov(u),o.c(),N(o,1),o.m(e,null)):o&&(Xt(),V(o,1,1,()=>{o=null}),Yt())},i(u){n||(N(i),N(o),n=!0)},o(u){V(i),V(o),n=!1},d(u){u&&H(e),i&&i.d(),o&&o.d()}}}function r8(r){let e,t,n,i;return e=new lh({props:{loading:r[2]}}),n=new So({props:{$$slots:{map:[n8],sidebar:[WA],top:[OA]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&4&&(s.loading=o[2]),e.$set(s);const d={};u&1073743867&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function i8(r,e,t){let n,i,o,u,s,d,p;ct(r,er,Fe=>t(8,n=Fe)),ct(r,za,Fe=>t(26,i=Fe)),ct(r,Ar,Fe=>t(19,o=Fe)),ct(r,Ba,Fe=>t(27,u=Fe)),ct(r,Ga,Fe=>t(28,s=Fe)),ct(r,ks,Fe=>t(9,d=Fe)),ct(r,as,Fe=>t(10,p=Fe));let g="Generating severance boundaries...",_=Ji(),x="choose-area",C="none",M=null,P=new Map,A=[],L,I=null,$=null;Ss(async()=>{await new Promise(Fe=>{requestAnimationFrame(()=>{requestAnimationFrame(Fe)})}),t(3,_=o.generatedBoundaries()),t(2,g="")});function O(Fe){let Ne=Fe.detail.features[0].id,Ae=_.features[Ne],ot=new Map(P);if(ot.has(Ne)?ot.delete(Ne):ot.set(Ne,Ae),ot.size===0)t(17,M=null),t(5,P=ot);else if(ot.size===1)t(17,M=ot.values().next().value),t(5,P=ot);else{let Ye={type:"FeatureCollection",features:Array.from(ot.values())};try{t(17,M=o.generateMergedBoundary(Ye)),t(5,P=ot)}catch(ut){console.log(`error merging boundaries: ${ut}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${ut}`)}}}function Z(Fe){var ot;let Ne=s.nextAvailableNeighbourhoodName(u),Ae=N2(o,"What do you want to name the neighbourhood?",Ne);if(Ae)try{const Ye={};x=="draw-area"&&((ot=L==null?void 0:L.properties)!=null&&ot.waypoints)&&(Ye.waypoints=L.properties.waypoints);let ut={type:"Feature",properties:Ye,geometry:Fe.geometry};o.setCurrentNeighbourhoodBoundary(Ae,ut),ln(za,i=Ae,i),qf(),ln(er,n={mode:"neighbourhood"},n)}catch(Ye){window.alert(`Sorry, this boundary is invalid: ${Ye}`)}}function X(){ip("auto_boundaries.geojson",JSON.stringify(_,null,"  "))}function q(Fe){return U2({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},Fe)}function Y(Fe){return{none:Qn(.3,.5),area:Qn(.7,.9),car_ownership:Qn(.7,.9),density:Qn(.7,.9),pois:Qn(.7,.9),simd:Qn(.7,.9),stats19:Qn(.7,.9)}[Fe]}function fe(){t(17,M=null),P.clear(),t(5,P),t(6,A=[]),t(18,I=null),t(7,$=null)}function Le(Fe){C=Fe,t(4,C)}const ee=()=>t(0,x="choose-area"),ie=()=>t(0,x="draw-area");function ve(Fe){A=Fe,t(6,A)}function ye(Fe){L=Fe,t(1,L)}const it=()=>Z(kr($));return r.$$.update=()=>{if(r.$$.dirty&524290){let Fe=null;if(L&&L.geometry.coordinates[0].length>3){let Ne={type:"FeatureCollection",features:[L]};try{Fe=o.generateMergedBoundary(Ne)}catch(Ae){console.log(`error merging boundaries: ${Ae}`)}}t(18,I=Fe)}r.$$.dirty&393217&&(x=="draw-area"?t(7,$=I):t(7,$=M))},[x,L,g,_,C,P,A,$,n,d,p,O,Z,X,q,Y,fe,M,I,o,Le,ee,ie,ve,ye,it]}class o8 extends Lt{constructor(e){super(),Et(this,e,i8,r8,Tt,{})}}const bi=class bi{constructor(e,t,n){rr(this,"filterType");rr(this,"label");rr(this,"description");this.filterType=e,this.label=t,this.description=n}get iconURL(){return`/ltn//filters/${this.filterType}_icon.gif`}get largeImageURL(){return`/ltn//filters/${this.filterType}.gif`}static getFilter(e){switch(e){case"walk_cycle_only":return bi.walkCycleOnly;case"no_entry":return bi.noEntry;case"bus_gate":return bi.busGate;case"school_street":return bi.schoolStreet;default:console.assert(`unknown filter type: "${e}"`);return}}};rr(bi,"walkCycleOnly",new bi("walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter.")),rr(bi,"noEntry",new bi("no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through.")),rr(bi,"busGate",new bi("bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier.")),rr(bi,"schoolStreet",new bi("school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school.")),rr(bi,"allTypes",[bi.walkCycleOnly,bi.noEntry,bi.busGate,bi.schoolStreet]);let co=bi;function s8(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M=_r(r[7].mode)+"",P,A;return o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}}),_=new On({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Ee(M),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(L,I){W(L,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,P),A=!0},p(L,I){(!A||I&128)&&M!==(M=_r(L[7].mode)+"")&&St(P,M)},i(L){A||(N(o.$$.fragment,L),N(d.$$.fragment,L),N(_.$$.fragment,L),A=!0)},o(L){V(o.$$.fragment,L),V(d.$$.fragment,L),V(_.$$.fragment,L),A=!1},d(L){L&&H(e),le(o),le(d),le(_)}}}function a8(r){let e;return{c(){e=U("p"),e.textContent="Hover on a zone"},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function l8(r){let e,t=r[6].properties.name+"",n,i,o,u,s=r[6].properties.sum_from.toLocaleString()+"",d,p,g,_,x=r[6].properties.sum_to.toLocaleString()+"",C,M,P,A,L=r[6].properties.counts_from[r[3]]+"",I;return{c(){e=U("u"),n=Ee(t),i=oe(),o=U("p"),u=Ee("Total trips from here: "),d=Ee(s),p=oe(),g=U("p"),_=Ee("Total trips to here: "),C=Ee(x),M=oe(),P=U("p"),A=Ee("Total intra-zonal trips starting and ending here: "),I=Ee(L)},m($,O){W($,e,O),F(e,n),W($,i,O),W($,o,O),F(o,u),F(o,d),W($,p,O),W($,g,O),F(g,_),F(g,C),W($,M,O),W($,P,O),F(P,A),F(P,I)},p($,O){O&64&&t!==(t=$[6].properties.name+"")&&St(n,t),O&64&&s!==(s=$[6].properties.sum_from.toLocaleString()+"")&&St(d,s),O&64&&x!==(x=$[6].properties.sum_to.toLocaleString()+"")&&St(C,x),O&72&&L!==(L=$[6].properties.counts_from[$[3]]+"")&&St(I,L)},d($){$&&(H(e),H(i),H(o),H(p),H(g),H(M),H(P))}}}function u8(r){let e,t,n,i,o,u=r[0].features.length.toLocaleString()+"",s,d,p,g,_,x,C,M,P,A,L=r[1]?"from":"to",I,$,O=r[3]==null?"each zone":"this zone",Z,X,q,Y,fe,Le,ee,ie,ve,ye;t=new js({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),Y=new Vo({props:{colorScale:Fd,labels:{limits:r[5]}}});function it(Ae,ot){return Ae[6]&&Ae[3]!=null?l8:a8}let Fe=it(r),Ne=Fe(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),o=Ee("Trips begin and end in "),s=Ee(u),d=Ee(" zones"),p=oe(),g=U("label"),_=Ee(`Trips from
      `),x=U("input"),C=Ee(`
      Trips to`),M=oe(),P=U("p"),A=Ee("Trips "),I=Ee(L),$=oe(),Z=Ee(O),X=Ee(":"),q=oe(),ue(Y.$$.fragment),fe=oe(),Le=U("hr"),ee=oe(),Ne.c(),he(x,"type","checkbox"),he(x,"role","switch"),he(e,"slot","sidebar")},m(Ae,ot){W(Ae,e,ot),ae(t,e,null),F(e,n),F(e,i),F(i,o),F(i,s),F(i,d),F(e,p),F(e,g),F(g,_),F(g,x),x.checked=r[1],F(g,C),F(e,M),F(e,P),F(P,A),F(P,I),F(P,$),F(P,Z),F(P,X),F(e,q),ae(Y,e,null),F(e,fe),F(e,Le),F(e,ee),Ne.m(e,null),ie=!0,ve||(ye=It(x,"change",r[9]),ve=!0)},p(Ae,ot){(!ie||ot&1)&&u!==(u=Ae[0].features.length.toLocaleString()+"")&&St(s,u),ot&2&&(x.checked=Ae[1]),(!ie||ot&2)&&L!==(L=Ae[1]?"from":"to")&&St(I,L),(!ie||ot&8)&&O!==(O=Ae[3]==null?"each zone":"this zone")&&St(Z,O);const Ye={};ot&32&&(Ye.labels={limits:Ae[5]}),Y.$set(Ye),Fe===(Fe=it(Ae))&&Ne?Ne.p(Ae,ot):(Ne.d(1),Ne=Fe(Ae),Ne&&(Ne.c(),Ne.m(e,null)))},i(Ae){ie||(N(t.$$.fragment,Ae),N(Y.$$.fragment,Ae),ie=!0)},o(Ae){V(t.$$.fragment,Ae),V(Y.$$.fragment,Ae),ie=!1},d(Ae){Ae&&H(e),le(t),le(Y),Ne.d(),ve=!1,ye()}}}function c8(r){let e,t,n,i,o;const u=[_n("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":Qn(.5,.1)}},{manageHoverState:!0}];function s(_){r[8](_)}let d={};for(let _=0;_<u.length;_+=1)d=zt(d,u[_]);r[2]!==void 0&&(d.hovered=r[2]),e=new Xi({props:d}),dn.push(()=>Dn(e,"hovered",s));const p=[_n("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let g={};for(let _=0;_<p.length;_+=1)g=zt(g,p[_]);return i=new ur({props:g}),{c(){ue(e.$$.fragment),n=oe(),ue(i.$$.fragment)},m(_,x){ae(e,_,x),W(_,n,x),ae(i,_,x),o=!0},p(_,x){const C=x&16?An(u,[u[0],{paint:{"fill-color":_[4],"fill-opacity":Qn(.5,.1)}},u[2]]):{};!t&&x&4&&(t=!0,C.hovered=_[2],zn(()=>t=!1)),e.$set(C);const M={};i.$set(M)},i(_){o||(N(e.$$.fragment,_),N(i.$$.fragment,_),o=!0)},o(_){V(e.$$.fragment,_),V(i.$$.fragment,_),o=!1},d(_){_&&H(n),le(e,_),le(i,_)}}}function f8(r){let e,t,n;return t=new gr({props:{data:r[0],generateId:!0,$$slots:{default:[c8]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","map")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&1&&(u.data=i[0]),o&8212&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function h8(r){let e,t;return e=new So({props:{$$slots:{map:[f8],sidebar:[u8],top:[s8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&8447&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function d8(r,e,t){let n,i,o,u,s,d;ct(r,er,A=>t(7,s=A)),ct(r,Ar,A=>t(10,d=A));let p=Ji();try{p=d.getDemandModel()}catch{window.alert("No demand model for this area"),ln(er,s={mode:"pick-neighbourhood"},s)}let g=!1,_=null;function x(A,L){if(A==null){let I=L?"sum_to":"sum_from",$=Math.max(...p.features.map(Z=>Z.properties[I])),O=C($);return[O,fo(["get",I],O,Fd)]}else{let I=L?"counts_to":"counts_from",$=[...p.features.map(X=>X.properties[I][A])],O=Math.max(...$),Z=C(O);return[Z,fo(["at",["id"],["literal",$]],Z,Fd)]}}function C(A){let L=Fd.length+1;return Array.from(Array(L).keys()).map(I=>Math.round(A/(L-1)*I))}function M(A){_=A,t(2,_)}function P(){g=this.checked,t(1,g)}return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=_==null?null:_.id),r.$$.dirty&9&&t(6,i=n!=null?p.features[n]:null),r.$$.dirty&10&&t(5,[o,u]=x(n,g),o,(t(4,u),t(3,n),t(1,g),t(2,_)))},[p,g,_,n,u,o,i,s,M,P]}class p8 extends Lt{constructor(e){super(),Et(this,e,d8,h8,Tt,{})}}function m8(r){let e,t,n,i,o,u,s,d,p,g,_=_r(r[4].mode)+"",x,C;return o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),x=Ee(_),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(M,P){W(M,e,P),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),F(n,g),F(g,x),C=!0},p(M,P){(!C||P&16)&&_!==(_=_r(M[4].mode)+"")&&St(x,_)},i(M){C||(N(o.$$.fragment,M),N(d.$$.fragment,M),C=!0)},o(M){V(o.$$.fragment,M),V(d.$$.fragment,M),C=!1},d(M){M&&H(e),le(o),le(d)}}}function Bv(r){let e,t,n,i,o,u,s;function d(g){r[7](g)}let p={list:r[1].features};return r[2]!==void 0&&(p.idx=r[2]),n=new cp({props:p}),dn.push(()=>Dn(n,"idx",d)),{c(){e=U("button"),e.textContent="Pick another intersection",t=oe(),ue(n.$$.fragment),he(e,"class","secondary")},m(g,_){W(g,e,_),W(g,t,_),ae(n,g,_),o=!0,u||(s=It(e,"click",r[6]),u=!0)},p(g,_){const x={};_&2&&(x.list=g[1].features),!i&&_&4&&(i=!0,x.idx=g[2],zn(()=>i=!1)),n.$set(x)},i(g){o||(N(n.$$.fragment,g),o=!0)},o(g){V(n.$$.fragment,g),o=!1},d(g){g&&(H(e),H(t)),le(n,g),u=!1,s()}}}function Nv(r){let e,t;return{c(){e=U("a"),t=Ee("Open OSM"),he(e,"href",r[0]),he(e,"target","_blank")},m(n,i){W(n,e,i),F(e,t)},p(n,i){i&1&&he(e,"href",n[0])},d(n){n&&H(e)}}}function g8(r){let e,t,n,i,o,u,s;t=new js({props:{mode:{mode:"pick-neighbourhood"}}});let d=r[1].features.length>0&&Bv(r),p=r[0]&&Nv(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=oe(),d&&d.c(),u=oe(),p&&p.c(),he(e,"slot","sidebar")},m(g,_){W(g,e,_),ae(t,e,null),F(e,n),F(e,i),F(e,o),d&&d.m(e,null),F(e,u),p&&p.m(e,null),s=!0},p(g,_){g[1].features.length>0?d?(d.p(g,_),_&2&&N(d,1)):(d=Bv(g),d.c(),N(d,1),d.m(e,u)):d&&(Xt(),V(d,1,1,()=>{d=null}),Yt()),g[0]?p?p.p(g,_):(p=Nv(g),p.c(),p.m(e,null)):p&&(p.d(1),p=null)},i(g){s||(N(t.$$.fragment,g),N(d),s=!0)},o(g){V(t.$$.fragment,g),V(d),s=!1},d(g){g&&H(e),le(t),d&&d.d(),p&&p.d()}}}function _8(r){let e,t;const n=[_n("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),e.$on("click",r[5]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function y8(r){let e,t,n,i;const o=[_n("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new Xi({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x=g&4?An(s,[s[0],{filter:["==",["id"],p[2]]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function v8(r){let e,t,n,i,o;return t=new gr({props:{data:kr(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[_8]},$$scope:{ctx:r}}}),i=new gr({props:{data:r[1],generateId:!0,$$slots:{default:[y8]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),he(e,"slot","map")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),ae(i,e,null),o=!0},p(u,s){const d={};s&8&&(d.data=kr(u[3]).getAllIntersections()),s&256&&(d.$$scope={dirty:s,ctx:u}),t.$set(d);const p={};s&2&&(p.data=u[1]),s&260&&(p.$$scope={dirty:s,ctx:u}),i.$set(p)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&H(e),le(t),le(i)}}}function b8(r){let e,t;return e=new So({props:{$$slots:{map:[v8],sidebar:[g8],top:[m8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function w8(r,e,t){let n,i;ct(r,Ar,_=>t(3,n=_)),ct(r,er,_=>t(4,i=_));let o=null,u=Ji(),s=0;function d(_){t(0,o=_.detail.features[0].properties.osm),t(1,u=n.getMovements(_.detail.features[0].id)),t(2,s=0)}const p=()=>t(1,u=Ji());function g(_){s=_,t(2,s)}return[o,u,s,n,i,d,p,g]}class x8 extends Lt{constructor(e){super(),Et(this,e,w8,b8,Tt,{})}}function k8(r){let e,t,n,i;const o=[_n("cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:r[0]=="cells"?"none":"visible"}},{paint:{"fill-color":Ud(),"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new Xi({props:u});const s=[_n("border-entries"),{filter:["==",["get","kind"],"border_entry"]},{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Td(1),"icon-offset":jv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:r[1]?"visible":"none"}},{paint:{"icon-color":Ud(),"icon-halo-color":"black","icon-opacity":Uv(),"icon-halo-width":Td(1.5),"icon-halo-blur":0}},{minzoom:13},{interactive:!1}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new nc({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,[g]){const _=g&1?An(o,[o[0],o[1],{layout:{visibility:p[0]=="cells"?"none":"visible"}},o[3]]):{};e.$set(_);const x=g&2?An(s,[s[0],s[1],g&2&&{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":Td(1),"icon-offset":jv(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:p[1]?"visible":"none"}},g&0&&{paint:{"icon-color":Ud(),"icon-halo-color":"black","icon-opacity":Uv(),"icon-halo-width":Td(1.5),"icon-halo-blur":0}},s[4],s[5]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function Td(r){return["interpolate",["linear"],["zoom"],14,.08*r,22,.7*r]}function jv(r){return[0,-50*r]}function Uv(){return["interpolate",["linear"],["zoom"],14,1,22,.7]}function S8(r,e,t){let n,i;return ct(r,Kd,o=>t(0,n=o)),ct(r,Xm,o=>t(1,i=o)),[n,i]}class _p extends Lt{constructor(e){super(),Et(this,e,S8,k8,Tt,{})}}function T8(r){let e,t;const n=[_n("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Xi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}class yp extends Lt{constructor(e){super(),Et(this,e,null,T8,Tt,{})}}const C8=r=>({}),Vv=r=>({}),M8=r=>({}),qv=r=>({});function Hv(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],qv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,M8):xn(i[10]),qv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function E8(r){let e,t,n=r[0]&&Hv(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Hv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function Wv(r){let e;const t=r[7]["line-popup"],n=vn(t,r,r[10],Vv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&1024)&&wn(n,t,i,i[10],e?bn(t,i[10],o,C8):xn(i[10]),Vv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function L8(r){let e,t,n=r[0]&&Wv(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Wv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function I8(r){let e,t,n,i,o,u,s,d;const p=[_n("interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,1),"line-color":"black"}},{minzoom:13}];let g={};for(let L=0;L<p.length;L+=1)g=zt(g,p[L]);e=new ur({props:g});const _=[_n("interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,0),"line-color":r[5](r[3],r[4].maxShortcuts),"line-opacity":Qn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let x={$$slots:{default:[E8]},$$scope:{ctx:r}};for(let L=0;L<_.length;L+=1)x=zt(x,_[L]);n=new ur({props:x}),n.$on("click",r[8]);const C=[_n("main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,6),"line-color":"black"}},{minzoom:13}];let M={};for(let L=0;L<C.length;L+=1)M=zt(M,C[L]);o=new ur({props:M});const P=[_n("main-roads"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[6](r[2],r[4].maxShortcuts,4),"line-color":Qn("gray",vo.mapFeature.hover.backgroundColor),"line-opacity":Qn(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"]}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let A={$$slots:{default:[L8]},$$scope:{ctx:r}};for(let L=0;L<P.length;L+=1)A=zt(A,P[L]);return s=new ur({props:A}),s.$on("click",r[9]),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(L,I){ae(e,L,I),W(L,t,I),ae(n,L,I),W(L,i,I),ae(o,L,I),W(L,u,I),ae(s,L,I),d=!0},p(L,[I]){const $=I&84?An(p,[p[0],p[1],{paint:{"line-width":L[6](L[2],L[4].maxShortcuts,1),"line-color":"black"}},p[3]]):{};e.$set($);const O=I&125?An(_,[_[0],_[1],I&124&&{paint:{"line-width":L[6](L[2],L[4].maxShortcuts,0),"line-color":L[5](L[3],L[4].maxShortcuts),"line-opacity":Qn(1,.5)}},_[3],_[4],I&1&&{manageHoverState:L[0]},I&1&&{hoverCursor:L[0]?"pointer":void 0}]):{};I&1025&&(O.$$scope={dirty:I,ctx:L}),n.$set(O);const Z=I&84?An(C,[C[0],C[1],{paint:{"line-width":L[6](L[2],L[4].maxShortcuts,6),"line-color":"black"}},C[3]]):{};o.$set(Z);const X=I&85?An(P,[P[0],P[1],I&84&&{paint:{"line-width":L[6](L[2],L[4].maxShortcuts,4),"line-color":Qn("gray",vo.mapFeature.hover.backgroundColor),"line-opacity":Qn(1,.5)}},P[3],P[4],I&1&&{manageHoverState:L[0]},I&1&&{hoverCursor:L[0]?"pointer":void 0}]):{};I&1025&&(X.$$scope={dirty:I,ctx:L}),s.$set(X)},i(L){d||(N(e.$$.fragment,L),N(n.$$.fragment,L),N(o.$$.fragment,L),N(s.$$.fragment,L),d=!0)},o(L){V(e.$$.fragment,L),V(n.$$.fragment,L),V(o.$$.fragment,L),V(s.$$.fragment,L),d=!1},d(L){L&&(H(t),H(i),H(u)),le(e,L),le(n,L),le(o,L),le(s,L)}}}function A8(r,e,t){let n,i;ct(r,Ym,M=>t(2,n=M)),ct(r,Kd,M=>t(3,i=M));let{$$slots:o={},$$scope:u}=e,s=Qf("neighbourhoodGj"),{interactive:d=!0}=e,{onClickLine:p=(M,P)=>{}}=e;function g(M,P){return M=="cells"?Ud():M=="edits"?Qn(["case",["get","edited"],$M,"white"],vo.mapFeature.hover.backgroundColor):M=="speeds"?fo(["get","speed_mph"],c2,u2):P<=2?Qn("white","blue"):(console.assert(M=="shortcuts"),Qn(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",P,"#A32015"],vo.mapFeature.hover.backgroundColor))}function _(M,P,A){return!M||P<=2?ra(A):["interpolate",["linear"],["get","shortcuts"],0,5+A,P,25+A]}const x=M=>d&&p(M.detail.features[0],M.detail.event.lngLat),C=M=>d&&p(M.detail.features[0],M.detail.event.lngLat);return r.$$set=M=>{"interactive"in M&&t(0,d=M.interactive),"onClickLine"in M&&t(1,p=M.onClickLine),"$$scope"in M&&t(10,u=M.$$scope)},[d,p,n,i,s,g,_,o,x,C,u]}class ch extends Lt{constructor(e){super(),Et(this,e,A8,I8,Tt,{interactive:0,onClickLine:1})}}function P8(r){let e;const t=r[7].default,n=vn(t,r,r[9],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&512)&&wn(n,t,i,i[9],e?bn(t,i[9],o,null):xn(i[9]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function z8(r){let e,t,n;const i=[_n("turn-restrictions"),{minzoom:13},{filter:r[4]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(s){r[8](s)}let u={$$slots:{default:[P8]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=zt(u,i[s]);return r[1]!==void 0&&(u.hovered=r[1]),e=new nc({props:u}),dn.push(()=>Dn(e,"hovered",o)),e.$on("click",function(){Wa(r[0])&&r[0].apply(this,arguments)}),{c(){ue(e.$$.fragment)},m(s,d){ae(e,s,d),n=!0},p(s,d){r=s;const p=d&16?An(i,[i[0],i[1],{filter:r[4]?void 0:["get","edited"]},i[3],i[4]]):{};d&512&&(p.$$scope={dirty:d,ctx:r}),!t&&d&2&&(t=!0,p.hovered=r[1],zn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function D8(r){let e,t;const n=[_n("turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function R8(r){let e,t,n,i;return e=new gr({props:{data:r[2],generateId:!0,$$slots:{default:[z8]},$$scope:{ctx:r}}}),n=new gr({props:{data:r[3],$$slots:{default:[D8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&4&&(s.data=o[2]),u&531&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&8&&(d.data=o[3]),u&512&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function F8(r,e,t){let n,i,o,u,s;ct(r,Ar,C=>t(5,o=C)),ct(r,Gi,C=>t(6,u=C)),ct(r,Zd,C=>t(4,s=C));let{$$slots:d={},$$scope:p}=e,{onClickTurnRestriction:g=()=>{}}=e,_=null;function x(C){_=C,t(1,_)}return r.$$set=C=>{"onClickTurnRestriction"in C&&t(0,g=C.onClickTurnRestriction),"$$scope"in C&&t(9,p=C.$$scope)},r.$$.update=()=>{r.$$.dirty&2&&t(3,n=_==null?Ji():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(_.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(_.properties.to_geometry),properties:{}}]}),r.$$.dirty&96&&t(2,i=u>0?o.renderTurnRestrictions():Ji())},[g,_,i,n,s,o,u,d,x,p]}class O8 extends Lt{constructor(e){super(),Et(this,e,F8,R8,Tt,{onClickTurnRestriction:0})}}const $8=r=>({}),Gv=r=>({}),B8=r=>({}),Zv=r=>({});function N8(r){let e;const t=r[7]["modal-filter"],n=vn(t,r,r[8],Zv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,B8):xn(i[8]),Zv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function j8(r){let e,t,n,i;const o=[_n("modal-filters"),{interactive:r[2]},{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},{minzoom:Cd},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let u={$$slots:{default:[N8]},$$scope:{ctx:r}};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new nc({props:u}),e.$on("click",function(){Wa(r[0])&&r[0].apply(this,arguments)});const s=[_n("intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Cd},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07}},{interactive:!1}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new nc({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){r=p;const _=g&20?An(o,[o[0],g&4&&{interactive:r[2]},g&16&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[4]?["literal",!0]:["get","edited"]]},g&0&&{minzoom:Cd},o[4],o[5]]):{};g&256&&(_.$$scope={dirty:g,ctx:r}),e.$set(_);const x=g&0?An(s,[s[0],s[1],{minzoom:Cd},s[3],s[4]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function U8(r){let e;const t=r[7]["turn-restriction"],n=vn(t,r,r[8],Gv);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&256)&&wn(n,t,i,i[8],e?bn(t,i[8],o,$8):xn(i[8]),Gv)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function V8(r){let e,t,n,i;return e=new gr({props:{data:r[3],generateId:!0,$$slots:{default:[j8]},$$scope:{ctx:r}}}),n=new O8({props:{onClickTurnRestriction:r[1],$$slots:{default:[U8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&8&&(s.data=o[3]),u&277&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&2&&(d.onClickTurnRestriction=o[1]),u&256&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}let Cd=13;function q8(r,e,t){let n,i,o,u;ct(r,Ar,x=>t(5,i=x)),ct(r,Gi,x=>t(6,o=x)),ct(r,Zd,x=>t(4,u=x));let{$$slots:s={},$$scope:d}=e,{onClickModalFilter:p=()=>{}}=e,{onClickTurnRestriction:g=()=>{}}=e,{interactive:_}=e;return r.$$set=x=>{"onClickModalFilter"in x&&t(0,p=x.onClickModalFilter),"onClickTurnRestriction"in x&&t(1,g=x.onClickTurnRestriction),"interactive"in x&&t(2,_=x.interactive),"$$scope"in x&&t(8,d=x.$$scope)},r.$$.update=()=>{r.$$.dirty&96&&t(3,n=o>0?i.renderModalFilters():Ji())},[p,g,_,n,u,i,o,s,d]}class el extends Lt{constructor(e){super(),Et(this,e,q8,V8,Tt,{onClickModalFilter:0,onClickTurnRestriction:1,interactive:2})}}function H8(r){let e,t;const n=[_n("one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180]}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new nc({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}class vp extends Lt{constructor(e){super(),Et(this,e,null,H8,Tt,{})}}function W8(r){let e;const t=r[3].default,n=vn(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&wn(n,t,i,i[4],e?bn(t,i[4],o,null):xn(i[4]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function G8(r){let e,t;return e=new gr({props:{data:r[0],generateId:!0,$$slots:{default:[W8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Z8(r,e,t){let n,i;ct(r,Ar,d=>t(2,i=d));let{$$slots:o={},$$scope:u}=e,{input:s=null}=e;return r.$$set=d=>{"input"in d&&t(1,s=d.input),"$$scope"in d&&t(4,u=d.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=s||i.renderNeighbourhood()),r.$$.dirty&1&&rp("neighbourhoodGj",n)},[n,s,i,o,u]}class fh extends Lt{constructor(e){super(),Et(this,e,Z8,G8,Tt,{input:1})}}function Ud(){return["match",["get","cell_color"],"disconnected","red",["let","index",["%",["to-number",["get","cell_color"]],10],["match",["var","index"],0,"#8dd3c7",1,"#ffffb3",2,"#bebada",3,"#80b1d3",4,"#fdb462",5,"#b3de69",6,"#fccde5",7,"#bc80bd",8,"#ccebc5",9,"#ffed6f","blue"]]]}function K8(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M=_r(r[2].mode)+"",P,A;return o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}}),_=new On({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Ee(M),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(L,I){W(L,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,P),A=!0},p(L,I){(!A||I&4)&&M!==(M=_r(L[2].mode)+"")&&St(P,M)},i(L){A||(N(o.$$.fragment,L),N(d.$$.fragment,L),N(_.$$.fragment,L),A=!0)},o(L){V(o.$$.fragment,L),V(d.$$.fragment,L),V(_.$$.fragment,L),A=!1},d(L){L&&H(e),le(o),le(d),le(_)}}}function Kv(r){let e,t,n;return{c(){e=U("button"),e.textContent="",he(e,"class","close-btn svelte-khnvno")},m(i,o){W(i,e,o),t||(n=It(e,"click",r[5]),t=!0)},p:at,d(i){i&&H(e),t=!1,n()}}}function X8(r){let e;return{c(){e=U("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){W(t,e,n)},p:at,i:at,o:at,d(t){t&&H(e)}}}function Y8(r){let e,t,n,i,o,u,s;e=new eh({props:{properties:r[0].feature.properties}});function d(g){r[6](g)}let p={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(p.idx=r[0].movementIdx),o=new cp({props:p}),dn.push(()=>Dn(o,"idx",d)),{c(){ue(e.$$.fragment),t=oe(),n=U("h5"),n.textContent="Turn restrictions:",i=oe(),ue(o.$$.fragment)},m(g,_){ae(e,g,_),W(g,t,_),W(g,n,_),W(g,i,_),ae(o,g,_),s=!0},p(g,_){const x={};_&1&&(x.properties=g[0].feature.properties),e.$set(x);const C={};_&1&&(C.list=g[0].movements.features),!u&&_&1&&(u=!0,C.idx=g[0].movementIdx,zn(()=>u=!1)),o.$set(C)},i(g){s||(N(e.$$.fragment,g),N(o.$$.fragment,g),s=!0)},o(g){V(e.$$.fragment,g),V(o.$$.fragment,g),s=!1},d(g){g&&(H(t),H(n),H(i)),le(e,g),le(o,g)}}}function J8(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M;t=new js({props:{mode:{mode:"neighbourhood"}}});let P=r[0]&&Kv(r);const A=[Y8,X8],L=[];function I($,O){return $[0]?0:1}return x=I(r),C=L[x]=A[x](r),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("h4"),i.textContent="Roads",o=oe(),u=U("p"),u.textContent="Click a road to visit its OSM object.",s=oe(),d=U("div"),p=U("h4"),p.textContent="Intersections",g=oe(),P&&P.c(),_=oe(),C.c(),Qe(d,"display","flex"),Qe(d,"align-items","start"),Qe(d,"justify-content","space-between"),he(e,"slot","sidebar")},m($,O){W($,e,O),ae(t,e,null),F(e,n),F(e,i),F(e,o),F(e,u),F(e,s),F(e,d),F(d,p),F(d,g),P&&P.m(d,null),F(e,_),L[x].m(e,null),M=!0},p($,O){$[0]?P?P.p($,O):(P=Kv($),P.c(),P.m(d,null)):P&&(P.d(1),P=null);let Z=x;x=I($),x===Z?L[x].p($,O):(Xt(),V(L[Z],1,1,()=>{L[Z]=null}),Yt(),C=L[x],C?C.p($,O):(C=L[x]=A[x]($),C.c()),N(C,1),C.m(e,null))},i($){M||(N(t.$$.fragment,$),N(C),M=!0)},o($){V(t.$$.fragment,$),V(C),M=!1},d($){$&&H(e),le(t),P&&P.d(),L[x].d()}}}function Q8(r){let e,t;return e=new eh({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function eP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[Q8,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function tP(r){let e,t;return e=new eh({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function nP(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[tP,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","line-popup")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&384&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function rP(r){let e,t,n,i,o,u,s,d,p,g;e=new yp({}),n=new _p({}),o=new vp({});const _=[_n("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let x={$$slots:{default:[eP]},$$scope:{ctx:r}};for(let C=0;C<_.length;C+=1)x=zt(x,_[C]);return s=new $l({props:x}),p=new ch({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[nP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment),d=oe(),ue(p.$$.fragment)},m(C,M){ae(e,C,M),W(C,t,M),ae(n,C,M),W(C,i,M),ae(o,C,M),W(C,u,M),ae(s,C,M),W(C,d,M),ae(p,C,M),g=!0},p(C,M){const P={};M&256&&(P.$$scope={dirty:M,ctx:C}),s.$set(P);const A={};M&256&&(A.$$scope={dirty:M,ctx:C}),p.$set(A)},i(C){g||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),N(s.$$.fragment,C),N(p.$$.fragment,C),g=!0)},o(C){V(e.$$.fragment,C),V(n.$$.fragment,C),V(o.$$.fragment,C),V(s.$$.fragment,C),V(p.$$.fragment,C),g=!1},d(C){C&&(H(t),H(i),H(u),H(d)),le(e,C),le(n,C),le(o,C),le(s,C),le(p,C)}}}function iP(r){let e,t;return e=new eh({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function oP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[iP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function sP(r){let e,t;return e=new eh({props:{properties:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function aP(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[sP,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function lP(r){var o,u,s;let e,t;const n=[_n("debug-intersections"),{paint:{"circle-radius":ug(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Qn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((s=(u=(o=r[0])==null?void 0:o.feature)==null?void 0:u.properties)==null?void 0:s.intersection_id)??-1],.3,Qn(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[aP]},$$scope:{ctx:r}};for(let d=0;d<n.length;d+=1)i=zt(i,n[d]);return e=new $l({props:i}),e.$on("click",r[3]),{c(){ue(e.$$.fragment)},m(d,p){ae(e,d,p),t=!0},p(d,p){var _,x,C;const g=p&1?An(n,[n[0],{paint:{"circle-radius":ug(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Qn(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((C=(x=(_=d[0])==null?void 0:_.feature)==null?void 0:x.properties)==null?void 0:C.intersection_id)??-1],.3,Qn(0,.5)]}},n[2],n[3]]):{};p&256&&(g.$$scope={dirty:p,ctx:d}),e.$set(g)},i(d){t||(N(e.$$.fragment,d),t=!0)},o(d){V(e.$$.fragment,d),t=!1},d(d){le(e,d)}}}function Xv(r){let e,t;return e=new gr({props:{data:r[0].movements,generateId:!0,$$slots:{default:[uP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&257&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function uP(r){let e,t,n,i;const o=[_n("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let d={};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new Xi({props:d}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _={};e.$set(_);const x=g&1?An(s,[s[0],{filter:["==",["id"],p[0].movementIdx]},s[2]]):{};n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function cP(r){let e,t,n,i,o,u,s,d;t=new fh({props:{$$slots:{default:[rP]},$$scope:{ctx:r}}}),i=new el({props:{interactive:!0,$$slots:{default:[oP]},$$scope:{ctx:r}}}),u=new gr({props:{data:kr(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[lP]},$$scope:{ctx:r}}});let p=r[0]&&Xv(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),o=oe(),ue(u.$$.fragment),s=oe(),p&&p.c(),he(e,"slot","map")},m(g,_){W(g,e,_),ae(t,e,null),F(e,n),ae(i,e,null),F(e,o),ae(u,e,null),F(e,s),p&&p.m(e,null),d=!0},p(g,_){const x={};_&256&&(x.$$scope={dirty:_,ctx:g}),t.$set(x);const C={};_&256&&(C.$$scope={dirty:_,ctx:g}),i.$set(C);const M={};_&2&&(M.data=kr(g[1]).getAllIntersections()),_&257&&(M.$$scope={dirty:_,ctx:g}),u.$set(M),g[0]?p?(p.p(g,_),_&1&&N(p,1)):(p=Xv(g),p.c(),N(p,1),p.m(e,null)):p&&(Xt(),V(p,1,1,()=>{p=null}),Yt())},i(g){d||(N(t.$$.fragment,g),N(i.$$.fragment,g),N(u.$$.fragment,g),N(p),d=!0)},o(g){V(t.$$.fragment,g),V(i.$$.fragment,g),V(u.$$.fragment,g),V(p),d=!1},d(g){g&&H(e),le(t),le(i),le(u),p&&p.d()}}}function fP(r){let e,t;return e=new So({props:{$$slots:{map:[cP],sidebar:[J8],top:[K8]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&263&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function hP(r,e,t){let n,i;ct(r,Ar,g=>t(1,n=g)),ct(r,er,g=>t(2,i=g));let o=null;function u(g){let _=g.detail.features[0],x=n.getMovements(_.properties.intersection_id);t(0,o={feature:_,movements:x,movementIdx:0})}const s=(g,_)=>window.open(kr(g.properties).way,"_blank"),d=()=>t(0,o=null);function p(g){r.$$.not_equal(o.movementIdx,g)&&(o.movementIdx=g,t(0,o))}return[o,n,i,u,s,d,p]}class dP extends Lt{constructor(e){super(),Et(this,e,hP,fP,Tt,{})}}const pP="/ltn/assets/eraser-894c4bbc.svg",mP="/ltn/assets/paintbrush-511a1297.svg",Yv="/ltn/assets/one_way_left-9368d5dd.svg",gP="/ltn/assets/traffic_1-a90740ec.svg";var zo=63710088e-1,_P={centimeters:zo*100,centimetres:zo*100,degrees:360/(2*Math.PI),feet:zo*3.28084,inches:zo*39.37,kilometers:zo/1e3,kilometres:zo/1e3,meters:zo,metres:zo,miles:zo/1609.344,millimeters:zo*1e3,millimetres:zo*1e3,nauticalmiles:zo/1852,radians:1,yards:zo*1.0936};function yP(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Cg(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Jv(r[0])||!Jv(r[1]))throw new Error("coordinates must contain numbers");return yP({type:"Point",coordinates:r},e,t)}function vP(r,e="kilometers"){const t=_P[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Mg(r){return r%(2*Math.PI)*180/Math.PI}function Al(r){return r%360*Math.PI/180}function Jv(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Eg(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function bP(r){return r.type==="Feature"?r.geometry:r}function V2(r,e,t={}){if(t.final===!0)return wP(r,e);const n=Eg(r),i=Eg(e),o=Al(n[0]),u=Al(i[0]),s=Al(n[1]),d=Al(i[1]),p=Math.sin(u-o)*Math.cos(d),g=Math.cos(s)*Math.sin(d)-Math.sin(s)*Math.cos(d)*Math.cos(u-o);return Mg(Math.atan2(p,g))}function wP(r,e){let t=V2(e,r);return t=(t+180)%360,t}function xP(r,e,t,n={}){const i=Eg(r),o=Al(i[0]),u=Al(i[1]),s=Al(t),d=vP(e,n.units),p=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(s)),g=o+Math.atan2(Math.sin(s)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(p)),_=Mg(g),x=Mg(p);return Cg([_,x],n.properties)}var Do=63710088e-1,kP={centimeters:Do*100,centimetres:Do*100,degrees:360/(2*Math.PI),feet:Do*3.28084,inches:Do*39.37,kilometers:Do/1e3,kilometres:Do/1e3,meters:Do,metres:Do,miles:Do/1609.344,millimeters:Do*1e3,millimetres:Do*1e3,nauticalmiles:Do/1852,radians:1,yards:Do*1.0936};function SP(r,e="kilometers"){const t=kP[e];if(!t)throw new Error(e+" units is invalid");return r*t}function Md(r){return r%360*Math.PI/180}function Qv(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function q2(r,e,t={}){var n=Qv(r),i=Qv(e),o=Md(i[1]-n[1]),u=Md(i[0]-n[0]),s=Md(n[1]),d=Md(i[1]),p=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(s)*Math.cos(d);return SP(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),t.units)}var TP=q2;function CP(r,e,t={}){const i=bP(r).coordinates;let o=0;for(let u=0;u<i.length&&!(e>=o&&u===i.length-1);u++)if(o>=e){const s=e-o;if(s){const d=V2(i[u],i[u-1])-180;return xP(i[u],s,d,t)}else return Cg(i[u])}else o+=q2(i[u],i[u+1],t);return Cg(i[i.length-1])}var MP=CP;function EP(r){let e,t;const n=[_n("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function LP(r){let e,t;return e=new gr({props:{data:r[0],$$slots:{default:[EP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}let IP=50,AP=100,PP=.01;function zP(r,e,t){let{paths:n}=e,i=d(),o=p(),u=_(),s=setInterval(x,AP);ri(()=>clearInterval(s));function d(){return n.features.map(C=>1/C.properties.directness).reduce((C,M)=>C+M,0)}function p(){return n.features.length==0?[]:Array.from({length:IP},g)}function g(){let C=Math.random()*i,M=0;for(let[P,A]of n.features.entries())if(M+=1/A.properties.directness,C<M)return{idx:P,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function _(){return{type:"FeatureCollection",features:o.map(({idx:C,distance:M})=>MP(n.features[C],M,{units:"kilometers"}))}}function x(){for(let[C,M]of o.entries())M.distance+=PP,M.distance>=n.features[M.idx].properties.length_meters/1e3&&(o[C]=g());t(0,u=_())}return r.$$set=C=>{"paths"in C&&t(1,n=C.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=d(),o=p())},[u,n]}class DP extends Lt{constructor(e){super(),Et(this,e,zP,LP,Tt,{paths:1})}}class RP{constructor(e){rr(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}function FP(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="+",t=oe(),n=U("img"),o=Ee(`
    Add diagonal filter`),Qe(e,"font-size","200%"),Qe(e,"margin-top","-12px"),he(e,"class","icon"),Sr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||he(n,"src",i),he(n,"alt","Add diagonal filter"),Qe(n,"transform","rotate(135deg)"),he(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},p:at,d(u){u&&(H(e),H(t),H(n),H(o))}}}function OP(r){let e;function t(o,u){return o[0].hasRotatedFilter?BP:$P}let n=t(r),i=n(r);return{c(){i.c(),e=tr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i.d(o)}}}function $P(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="",t=oe(),n=U("img"),o=Ee(`
      Rotate diagonal filter`),Qe(e,"font-size","200%"),Qe(e,"padding-bottom","4px"),he(e,"class","icon"),Sr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||he(n,"src",i),he(n,"alt","Rotate diagonal filter"),Qe(n,"transform","rotate(45deg)"),he(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},d(u){u&&(H(e),H(t),H(n),H(o))}}}function BP(r){let e,t,n,i,o;return{c(){e=U("div"),e.textContent="",t=oe(),n=U("img"),o=Ee(`
      Delete diagonal filter`),he(e,"class","icon"),Sr(n.src,i="/ltn//filters/diagonal_filter_icon.png")||he(n,"src",i),he(n,"alt","Remove diagonal filter"),Qe(n,"transform","rotate(45deg)"),he(n,"class","svelte-j2s60j")},m(u,s){W(u,e,s),W(u,t,s),W(u,n,s),W(u,o,s)},d(u){u&&(H(e),H(t),H(n),H(o))}}}function NP(r){let e;function t(o,u){return o[0].filter?OP:FP}let n=t(r),i=n(r);return{c(){e=U("div"),i.c(),Qe(e,"display","flex"),Qe(e,"align-items","center")},m(o,u){W(o,e,u),i.m(e,null)},p(o,[u]){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:at,o:at,d(o){o&&H(e),i.d()}}}function jP(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class UP extends Lt{constructor(e){super(),Et(this,e,jP,NP,Tt,{intersection:0})}}function VP(r){let e,t;return e=new UP({props:{intersection:r[2](r[6])}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.intersection=n[2](n[6])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function qP(r){let e,t;return e=new Aw({props:{openOn:"hover",$$slots:{default:[VP,({features:n})=>({6:n}),({features:n})=>n?64:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&192&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function HP(r){let e,t;const n=[_n("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":ug(30),"circle-color":vo.mapFeature.hover.backgroundColor,"circle-opacity":Qn(0,.5),"circle-stroke-color":vo.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":Qn(0,3)}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[qP]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new $l({props:i}),e.$on("click",r[4]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,[u]){const s=u&2?An(n,[n[0],n[1],n[2],n[3],{interactive:o[1]},n[5],n[6]]):{};u&128&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function WP(r,e,t){let{neighbourhood:n=Qf("neighbourhoodGj")}=e,{onClickIntersection:i=p=>{}}=e,{interactive:o=!1}=e;function u(p){let g=n.features[p];return new RP(g)}function s(p){return u(p[0].id)}const d=p=>i(s(p.detail.features));return r.$$set=p=>{"neighbourhood"in p&&t(3,n=p.neighbourhood),"onClickIntersection"in p&&t(0,i=p.onClickIntersection),"interactive"in p&&t(1,o=p.interactive)},[i,o,s,n,d]}class GP extends Lt{constructor(e){super(),Et(this,e,WP,HP,Tt,{neighbourhood:3,onClickIntersection:0,interactive:1})}}function eb(r,e,t){const n=r.slice();return n[6]=e[t],n}function tb(r){let e,t,n,i,o,u,s=r[6].label+"",d,p,g,_,x;function C(){return r[3](r[6])}return{c(){e=U("button"),t=U("img"),i=oe(),o=U("br"),u=oe(),d=Ee(s),p=oe(),Sr(t.src,n=r[6].iconURL)||he(t,"src",n),he(t,"width","80"),he(t,"alt",r[6].label),he(e,"class","outline"),Qe(e,"width","100%"),e.disabled=g=r[1]==r[6].filterType},m(M,P){W(M,e,P),F(e,t),F(e,i),F(e,o),F(e,u),F(e,d),F(e,p),_||(x=It(e,"click",C),_=!0)},p(M,P){r=M,P&2&&g!==(g=r[1]==r[6].filterType)&&(e.disabled=g)},d(M){M&&H(e),_=!1,x()}}}function ZP(r){let e,t,n,i,o,u,s,d,p,g,_,x,C=r[2].description+"",M,P,A,L,I,$,O=$n(co.allTypes),Z=[];for(let X=0;X<O.length;X+=1)Z[X]=tb(eb(r,O,X));return{c(){e=U("h3"),e.textContent="Choose a modal filter to place on streets",t=oe(),n=U("table"),i=U("tr"),o=U("td");for(let X=0;X<Z.length;X+=1)Z[X].c();u=oe(),s=U("td"),d=U("img"),_=oe(),x=U("p"),M=Ee(C),P=oe(),A=U("center"),L=U("button"),L.textContent="Confirm",Sr(d.src,p=r[2].largeImageURL)||he(d,"src",p),he(d,"height","300"),he(d,"alt",g=r[2].label)},m(X,q){W(X,e,q),W(X,t,q),W(X,n,q),F(n,i),F(i,o);for(let Y=0;Y<Z.length;Y+=1)Z[Y]&&Z[Y].m(o,null);F(i,u),F(i,s),F(s,d),F(s,_),F(s,x),F(x,M),W(X,P,q),W(X,A,q),F(A,L),I||($=It(L,"click",r[4]),I=!0)},p(X,q){if(q&2){O=$n(co.allTypes);let Y;for(Y=0;Y<O.length;Y+=1){const fe=eb(X,O,Y);Z[Y]?Z[Y].p(fe,q):(Z[Y]=tb(fe),Z[Y].c(),Z[Y].m(o,null))}for(;Y<Z.length;Y+=1)Z[Y].d(1);Z.length=O.length}q&4&&!Sr(d.src,p=X[2].largeImageURL)&&he(d,"src",p),q&4&&g!==(g=X[2].label)&&he(d,"alt",g),q&4&&C!==(C=X[2].description+"")&&St(M,C)},d(X){X&&(H(e),H(t),H(n),H(P),H(A)),_i(Z,X),I=!1,$()}}}function KP(r){let e,t,n;function i(u){r[5](u)}let o={$$slots:{default:[ZP]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Dg({props:o}),dn.push(()=>Dn(e,"show",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&519&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.show=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function XP(r,e,t){let n,i;ct(r,Km,p=>t(1,i=p));let{show:o}=e;const u=p=>ln(Km,i=p.filterType,i),s=()=>t(0,o=!1);function d(p){o=p,t(0,o)}return r.$$set=p=>{"show"in p&&t(0,o=p.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=co.allTypes.find(p=>p.filterType==i))},[o,i,n,u,s,d]}class YP extends Lt{constructor(e){super(),Et(this,e,XP,KP,Tt,{show:0})}}function nb(r){let e,t;return e=new gr({props:{data:r[0],$$slots:{default:[JP]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function JP(r){let e,t;const n=[_n("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function QP(r){let e,t,n=r[0]&&nb(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=nb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function ez(r,e,t){let{map:n}=e,i=null;const o=Ns();n.on("dragstart",u),n.on("mousemove",s),n.on("mouseup",d),ri(()=>{n.dragPan.enable(),n.off("dragstart",u),n.off("mousemove",s),n.off("mouseup",d)});function u(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function s(p){if(i){let g=p.lngLat.toArray(),_=i.geometry.coordinates.at(-1);if(_&&TP(_,g)*1e3<.5)return;i.geometry.coordinates.push(g),t(0,i),i.geometry.coordinates.length%10==0&&o("progress",i)}}function d(){!i||i.geometry.coordinates.length==0?o("done",null):o("done",i),t(0,i=null),n.dragPan.enable()}return r.$$set=p=>{"map"in p&&t(1,n=p.map)},[i,n]}class H2 extends Lt{constructor(e){super(),Et(this,e,ez,QP,Tt,{map:1})}}function tz(r){let e;return{c(){e=U("p"),e.textContent=`Now that you've defined a neighbourhood boundary, you can see the
              possible shortcuts that vehicles are currently able to take
              through it. You can add a new modal filter to try and solve this.
              The colored "cell" areas show what's reachable for drivers without
              leaving the boundary you've drawn.`},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function rb(r){let e,t,n;return t=new On({props:{mode:{mode:"debug-neighbourhood"},$$slots:{default:[nz]},$$scope:{ctx:r}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function nz(r){let e;return{c(){e=Ee("Debug")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function rz(r){let e,t,n,i,o,u,s,d,p,g,_=_r(r[14].mode)+"",x,C,M,P,A,L,I,$,O,Z,X,q,Y,fe,Le,ee,ie,ve,ye,it,Fe,Ne;o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}}),M=new r_({props:{$$slots:{default:[tz]},$$scope:{ctx:r}}}),$=new On({props:{mode:{mode:"view-shortcuts"}}}),X=new On({props:{mode:{mode:"route",prevMode:"neighbourhood"}}}),fe=new On({props:{mode:{mode:"predict-impact",prevMode:"neighbourhood"}}}),ie=new On({props:{mode:{mode:"impact-one-destination"}}}),it=new On({props:{mode:{mode:"set-boundary",name:kr(r[6]).properties.name,existing:kr(r[6])}}});let Ae=r[15]&&rb(r);return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),x=Ee(_),C=oe(),ue(M.$$.fragment),P=oe(),A=U("nav"),L=U("ul"),I=U("li"),ue($.$$.fragment),O=oe(),Z=U("li"),ue(X.$$.fragment),q=oe(),Y=U("li"),ue(fe.$$.fragment),Le=oe(),ee=U("li"),ue(ie.$$.fragment),ve=oe(),ye=U("li"),ue(it.$$.fragment),Fe=oe(),Ae&&Ae.c(),he(t,"aria-label","breadcrumb"),he(e,"slot","top"),Qe(e,"display","flex"),Qe(e,"justify-content","space-between")},m(ot,Ye){W(ot,e,Ye),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),F(n,g),F(g,x),F(g,C),ae(M,g,null),F(e,P),F(e,A),F(A,L),F(L,I),ae($,I,null),F(L,O),F(L,Z),ae(X,Z,null),F(L,q),F(L,Y),ae(fe,Y,null),F(L,Le),F(L,ee),ae(ie,ee,null),F(L,ve),F(L,ye),ae(it,ye,null),F(L,Fe),Ae&&Ae.m(L,null),Ne=!0},p(ot,Ye){(!Ne||Ye[0]&16384)&&_!==(_=_r(ot[14].mode)+"")&&St(x,_);const ut={};Ye[1]&262144&&(ut.$$scope={dirty:Ye,ctx:ot}),M.$set(ut);const pt={};Ye[0]&64&&(pt.mode={mode:"set-boundary",name:kr(ot[6]).properties.name,existing:kr(ot[6])}),it.$set(pt),ot[15]?Ae?Ye[0]&32768&&N(Ae,1):(Ae=rb(ot),Ae.c(),N(Ae,1),Ae.m(L,null)):Ae&&(Xt(),V(Ae,1,1,()=>{Ae=null}),Yt())},i(ot){Ne||(N(o.$$.fragment,ot),N(d.$$.fragment,ot),N(M.$$.fragment,ot),N($.$$.fragment,ot),N(X.$$.fragment,ot),N(fe.$$.fragment,ot),N(ie.$$.fragment,ot),N(it.$$.fragment,ot),N(Ae),Ne=!0)},o(ot){V(o.$$.fragment,ot),V(d.$$.fragment,ot),V(M.$$.fragment,ot),V($.$$.fragment,ot),V(X.$$.fragment,ot),V(fe.$$.fragment,ot),V(ie.$$.fragment,ot),V(it.$$.fragment,ot),V(Ae),Ne=!1},d(ot){ot&&H(e),le(o),le(d),le(M),le($),le(X),le(fe),le(ie),le(it),Ae&&Ae.d()}}}function iz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z,X,q,Y,fe,Le,ee;return g=new xw({}),A=new ww({}),X=new z4({}),{c(){e=U("h3"),e.textContent="Reclassify main roads",t=oe(),n=U("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically using
          data from
          <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=oe(),o=U("p"),o.textContent=`Main roads are typically better suited to support higher levels of
          traffic than neighbourhood roads.`,u=oe(),s=U("div"),d=U("button"),p=U("div"),ue(g.$$.fragment),_=oe(),x=U("span"),x.textContent="Toggle segment or pan map",C=oe(),M=U("button"),P=U("div"),ue(A.$$.fragment),L=oe(),I=U("span"),I.textContent="Mark as main along a line",$=oe(),O=U("button"),Z=U("div"),ue(X.$$.fragment),q=oe(),Y=U("span"),Y.textContent="Erase main classification",Qe(p,"display","flex"),Qe(p,"align-items","center"),Qe(p,"gap","8px"),he(d,"data-tippy-content","Click a road to reclassify it"),Gt(d,"active",!r[0].freehand),Gt(d,"outline",r[0].freehand),Qe(P,"display","flex"),Qe(P,"align-items","center"),Qe(P,"gap","8px"),he(M,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Gt(M,"active",r[0].freehand&&r[0].isMain),Gt(M,"outline",!(r[0].freehand&&r[0].isMain)),Qe(Z,"display","flex"),Qe(Z,"align-items","center"),Qe(Z,"gap","8px"),he(O,"data-tippy-content","Reclassify multiple roads by drawing a line along them"),Gt(O,"active",r[0].freehand&&!r[0].isMain),Gt(O,"outline",!(r[0].freehand&&!r[0].isMain)),he(s,"class","classification-buttons svelte-b4nchc"),Qe(s,"display","flex"),Qe(s,"flex-direction","column"),Qe(s,"gap","8px"),Qe(s,"justify-content","left")},m(ie,ve){W(ie,e,ve),W(ie,t,ve),W(ie,n,ve),W(ie,i,ve),W(ie,o,ve),W(ie,u,ve),W(ie,s,ve),F(s,d),F(d,p),ae(g,p,null),F(p,_),F(p,x),F(s,C),F(s,M),F(M,P),ae(A,P,null),F(P,L),F(P,I),F(s,$),F(s,O),F(O,Z),ae(X,Z,null),F(Z,q),F(Z,Y),fe=!0,Le||(ee=[It(d,"click",r[39]),It(M,"click",r[40]),It(O,"click",r[41])],Le=!0)},p(ie,ve){(!fe||ve[0]&1)&&Gt(d,"active",!ie[0].freehand),(!fe||ve[0]&1)&&Gt(d,"outline",ie[0].freehand),(!fe||ve[0]&1)&&Gt(M,"active",ie[0].freehand&&ie[0].isMain),(!fe||ve[0]&1)&&Gt(M,"outline",!(ie[0].freehand&&ie[0].isMain)),(!fe||ve[0]&1)&&Gt(O,"active",ie[0].freehand&&!ie[0].isMain),(!fe||ve[0]&1)&&Gt(O,"outline",!(ie[0].freehand&&!ie[0].isMain))},i(ie){fe||(N(g.$$.fragment,ie),N(A.$$.fragment,ie),N(X.$$.fragment,ie),fe=!0)},o(ie){V(g.$$.fragment,ie),V(A.$$.fragment,ie),V(X.$$.fragment,ie),fe=!1},d(ie){ie&&(H(e),H(t),H(n),H(i),H(o),H(u),H(s)),le(g),le(A),le(X),Le=!1,cr(ee)}}}function oz(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Restrict turns",t=oe(),n=U("p"),n.textContent=`To restrict certain turns, first click on the source road, then the
          destination road. Traffic will no longer be able to turn from the
          source road to the destination road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:at,i:at,o:at,d(i){i&&(H(e),H(t),H(n))}}}function sz(r){let e,t,n;return{c(){e=U("h3"),e.textContent="Toggle one-way",t=oe(),n=U("p"),n.textContent=`Click on a road segment to toggle its direction. This will change the
          direction of traffic flow on that road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:at,i:at,o:at,d(i){i&&(H(e),H(t),H(n))}}}function az(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I;function $(Z){r[35](Z)}let O={};return r[3]!==void 0&&(O.show=r[3]),o=new YP({props:O}),dn.push(()=>Dn(o,"show",$)),C=new ww({}),{c(){e=U("h3"),e.textContent="Add modal filter",t=oe(),n=U("p"),n.textContent=`Modal filters restrict what kind of traffic can pass through a road
          segment. Place them strategically to deter shortcuts through your
          neighbourhood.`,i=oe(),ue(o.$$.fragment),s=oe(),d=U("div"),p=U("button"),p.textContent="Change modal filter type",g=oe(),_=U("button"),x=U("div"),ue(C.$$.fragment),M=oe(),P=U("span"),P.textContent="Add along a line",he(p,"class","outline"),Qe(x,"display","flex"),Qe(x,"align-items","center"),Qe(x,"gap","8px"),he(_,"data-tippy-content","Add many modal filters along a line"),Gt(_,"active",r[0].freehand),Gt(_,"outline",!r[0].freehand),Qe(d,"display","flex"),Qe(d,"gap","8px"),Qe(d,"align-items","leading"),Qe(d,"flex-direction","column"),Qe(d,"width","fit-content")},m(Z,X){W(Z,e,X),W(Z,t,X),W(Z,n,X),W(Z,i,X),ae(o,Z,X),W(Z,s,X),W(Z,d,X),F(d,p),F(d,g),F(d,_),F(_,x),ae(C,x,null),F(x,M),F(x,P),A=!0,L||(I=[It(p,"click",r[36]),It(_,"click",function(){Wa(r[0].freehand?r[37]:r[38])&&(r[0].freehand?r[37]:r[38]).apply(this,arguments)})],L=!0)},p(Z,X){r=Z;const q={};!u&&X[0]&8&&(u=!0,q.show=r[3],zn(()=>u=!1)),o.$set(q),(!A||X[0]&1)&&Gt(_,"active",r[0].freehand),(!A||X[0]&1)&&Gt(_,"outline",!r[0].freehand)},i(Z){A||(N(o.$$.fragment,Z),N(C.$$.fragment,Z),A=!0)},o(Z){V(o.$$.fragment,Z),V(C.$$.fragment,Z),A=!1},d(Z){Z&&(H(e),H(t),H(n),H(i),H(s),H(d)),le(o,Z),le(C),L=!1,cr(I)}}}function ib(r){let e;return{c(){e=U("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
        red`},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function ob(r){let e,t;return e=new Vo({props:{colorScale:u2,labels:{limits:c2}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function lz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z,X,q,Y,fe,Le,ee,ie,ve,ye,it,Fe,Ne,Ae,ot,Ye,ut,pt,_t,He,mt,Pt,jt,un,nn,rn,pn,yn,qe,We,Ke,kt,pe,fn,Xe,lt,Wt,Xn,Wn,fr,Tr,Cr,xi,Un,xt,Pr,vr;I=new LS({}),q=new bS({});const Ri=[az,sz,oz,iz],Bn=[];function Oe(Rt,Qt){return Rt[0].kind=="filter"?0:Rt[0].kind=="oneway"?1:Rt[0].kind=="turn_restriction"?2:Rt[0].kind=="main-roads"?3:-1}~(ie=Oe(r))&&(ve=Bn[ie]=Ri[ie](r));let yt=r[8]>0&&ib(),bt=r[13]=="speeds"&&ob();return Un=new B2({props:{neighbourhoodBoundary:kr(r[6])}}),{c(){e=U("div"),t=U("h2"),t.textContent="Editing tools",n=oe(),i=U("div"),o=U("div"),u=U("button"),s=U("img"),p=oe(),g=U("button"),g.innerHTML=`<div style="height: 100%; width: 100%; position: relative;"><img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${Yv}" alt="Reverse directions"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${Yv}" alt="Reverse directions"/></div>`,_=oe(),x=U("button"),x.innerHTML='<img src="/ltn//filters/no_right_turn.svg" alt="Restrict turns"/>',C=oe(),M=U("button"),M.innerHTML=`<img src="${gP}" alt="Change main/minor roads"/>`,P=oe(),A=U("div"),L=U("button"),ue(I.$$.fragment),Z=oe(),X=U("button"),ue(q.$$.fragment),Le=oe(),ee=U("div"),ve&&ve.c(),ye=oe(),yt&&yt.c(),it=oe(),Fe=U("h2"),Fe.textContent="Map style",Ne=oe(),Ae=U("label"),ot=U("input"),Ye=Ee(`
      Animate shortcuts`),ut=U("span"),pt=Ee("1"),_t=oe(),He=U("label"),mt=U("input"),Pt=Ee(`
      Show entries into cells`),jt=U("span"),un=Ee("2"),nn=oe(),rn=U("label"),pn=U("input"),yn=Ee(`
      Road thickness depends on shortcuts`),qe=U("span"),We=Ee("1"),Ke=oe(),kt=U("label"),pe=U("span"),pe.textContent="Draw roads:",fn=oe(),Xe=U("select"),lt=U("option"),lt.textContent="Worst shortcuts",Wt=U("option"),Wt.textContent="Cell",Xn=U("option"),Xn.textContent="Edits (either filter or direction)",Wn=U("option"),Wn.textContent="Speed limit",fr=oe(),bt&&bt.c(),Tr=oe(),Cr=U("h2"),Cr.textContent="Neighbourhood stats",xi=oe(),ue(Un.$$.fragment),Sr(s.src,d=kr(co.getFilter(r[9])).iconURL)||he(s,"src",d),he(s,"alt","Add a modal filter"),he(u,"class","icon-btn"),he(u,"data-tippy-content","Add a modal filter (hotkey 1)"),Gt(u,"active",r[0].kind=="filter"),he(g,"class","icon-btn"),he(g,"data-tippy-content","Toggle one-way (hotkey 2)"),Gt(g,"active",r[0].kind=="oneway"),he(x,"class","icon-btn"),he(x,"data-tippy-content","Restrict turns (hotkey 3)"),Gt(x,"active",r[0].kind=="turn_restriction"),he(M,"class","icon-btn"),he(M,"data-tippy-content","Reclassify main roads (hotkey 4)"),Gt(M,"active",r[0].kind=="main-roads"),Qe(o,"height","50px"),Qe(o,"display","flex"),Qe(o,"justify-content","left"),Qe(o,"gap","6px"),he(L,"class","outline icon-btn"),L.disabled=$=r[4]==0,he(L,"data-tippy-content",O=r[4]==0?"Undo Ctrl+Z":`Undo (${r[4]}) Ctrl+Z`),he(X,"class","outline icon-btn"),X.disabled=Y=r[5]==0,he(X,"data-tippy-content",fe=r[5]==0?"Redo Ctrl+Y":`Redo (${r[5]}) Ctrl+Y`),Qe(A,"height","50px"),Qe(A,"display","flex"),Qe(A,"justify-content","right"),Qe(A,"gap","6px"),he(i,"class","tool-palette"),Qe(i,"display","flex"),Qe(i,"justify-content","space-between"),Qe(i,"flex-wrap","wrap"),Qe(i,"gap","6px"),Qe(ee,"min-height","200px"),Qe(ee,"padding-bottom","16px"),Qe(ee,"border-bottom","solid var(--pico-muted-border-color) 1px"),he(ot,"type","checkbox"),he(ut,"class","footnote-ref svelte-b4nchc"),he(ut,"data-tippy-content",lb),he(mt,"type","checkbox"),he(jt,"class","footnote-ref svelte-b4nchc"),he(jt,"data-tippy-content",Lz),he(pn,"type","checkbox"),he(qe,"class","footnote-ref svelte-b4nchc"),he(qe,"data-tippy-content",lb),Qe(pe,"text-wrap","nowrap"),lt.__value="shortcuts",Zn(lt,lt.__value),Wt.__value="cells",Zn(Wt,Wt.__value),Xn.__value="edits",Zn(Xn,Xn.__value),Wn.__value="speeds",Zn(Wn,Wn.__value),Qe(Xe,"margin","0"),Qe(Xe,"padding","8px"),Qe(Xe,"width","auto"),r[13]===void 0&&ys(()=>r[45].call(Xe)),Qe(kt,"display","flex"),Qe(kt,"align-items","center"),Qe(kt,"gap","8px"),Qe(kt,"flex-wrap","wrap"),he(e,"slot","sidebar")},m(Rt,Qt){W(Rt,e,Qt),F(e,t),F(e,n),F(e,i),F(i,o),F(o,u),F(u,s),F(o,p),F(o,g),F(o,_),F(o,x),F(o,C),F(o,M),F(i,P),F(i,A),F(A,L),ae(I,L,null),F(A,Z),F(A,X),ae(q,X,null),F(e,Le),F(e,ee),~ie&&Bn[ie].m(ee,null),F(e,ye),yt&&yt.m(e,null),F(e,it),F(e,Fe),F(e,Ne),F(e,Ae),F(Ae,ot),ot.checked=r[10],F(Ae,Ye),F(Ae,ut),F(ut,pt),F(e,_t),F(e,He),F(He,mt),mt.checked=r[11],F(He,Pt),F(He,jt),F(jt,un),F(e,nn),F(e,rn),F(rn,pn),pn.checked=r[12],F(rn,yn),F(rn,qe),F(qe,We),F(e,Ke),F(e,kt),F(kt,pe),F(kt,fn),F(kt,Xe),F(Xe,lt),F(Xe,Wt),F(Xe,Xn),F(Xe,Wn),Zi(Xe,r[13],!0),F(e,fr),bt&&bt.m(e,null),F(e,Tr),F(e,Cr),F(e,xi),ae(Un,e,null),xt=!0,Pr||(vr=[It(u,"click",r[31]),It(g,"click",r[32]),It(x,"click",r[33]),It(M,"click",r[34]),It(L,"click",r[24]),It(X,"click",r[25]),It(ot,"change",r[42]),It(mt,"change",r[43]),It(pn,"change",r[44]),It(Xe,"change",r[45])],Pr=!0)},p(Rt,Qt){(!xt||Qt[0]&512&&!Sr(s.src,d=kr(co.getFilter(Rt[9])).iconURL))&&he(s,"src",d),(!xt||Qt[0]&1)&&Gt(u,"active",Rt[0].kind=="filter"),(!xt||Qt[0]&1)&&Gt(g,"active",Rt[0].kind=="oneway"),(!xt||Qt[0]&1)&&Gt(x,"active",Rt[0].kind=="turn_restriction"),(!xt||Qt[0]&1)&&Gt(M,"active",Rt[0].kind=="main-roads"),(!xt||Qt[0]&16&&$!==($=Rt[4]==0))&&(L.disabled=$),(!xt||Qt[0]&16&&O!==(O=Rt[4]==0?"Undo Ctrl+Z":`Undo (${Rt[4]}) Ctrl+Z`))&&he(L,"data-tippy-content",O),(!xt||Qt[0]&32&&Y!==(Y=Rt[5]==0))&&(X.disabled=Y),(!xt||Qt[0]&32&&fe!==(fe=Rt[5]==0?"Redo Ctrl+Y":`Redo (${Rt[5]}) Ctrl+Y`))&&he(X,"data-tippy-content",fe);let Jt=ie;ie=Oe(Rt),ie===Jt?~ie&&Bn[ie].p(Rt,Qt):(ve&&(Xt(),V(Bn[Jt],1,1,()=>{Bn[Jt]=null}),Yt()),~ie?(ve=Bn[ie],ve?ve.p(Rt,Qt):(ve=Bn[ie]=Ri[ie](Rt),ve.c()),N(ve,1),ve.m(ee,null)):ve=null),Rt[8]>0?yt||(yt=ib(),yt.c(),yt.m(e,it)):yt&&(yt.d(1),yt=null),Qt[0]&1024&&(ot.checked=Rt[10]),Qt[0]&2048&&(mt.checked=Rt[11]),Qt[0]&4096&&(pn.checked=Rt[12]),Qt[0]&8192&&Zi(Xe,Rt[13]),Rt[13]=="speeds"?bt?Qt[0]&8192&&N(bt,1):(bt=ob(),bt.c(),N(bt,1),bt.m(e,Tr)):bt&&(Xt(),V(bt,1,1,()=>{bt=null}),Yt());const yr={};Qt[0]&64&&(yr.neighbourhoodBoundary=kr(Rt[6])),Un.$set(yr)},i(Rt){xt||(N(I.$$.fragment,Rt),N(q.$$.fragment,Rt),N(ve),N(bt),N(Un.$$.fragment,Rt),xt=!0)},o(Rt){V(I.$$.fragment,Rt),V(q.$$.fragment,Rt),V(ve),V(bt),V(Un.$$.fragment,Rt),xt=!1},d(Rt){Rt&&H(e),le(I),le(q),~ie&&Bn[ie].d(),yt&&yt.d(),bt&&bt.d(),le(Un),Pr=!1,cr(vr)}}}function uz(r){let e,t,n=(r[48].name??"unnamed road")+"",i,o,u=Math.round(r[48].speed_mph)+"",s,d;return{c(){e=U("p"),t=Ee("Main road: "),i=Ee(n),o=Ee(`
                (`),s=Ee(u),d=Ee(" mph)")},m(p,g){W(p,e,g),F(e,t),F(e,i),F(e,o),F(e,s),F(e,d)},p(p,g){g[1]&131072&&n!==(n=(p[48].name??"unnamed road")+"")&&St(i,n),g[1]&131072&&u!==(u=Math.round(p[48].speed_mph)+"")&&St(s,u)},d(p){p&&H(e)}}}function cz(r){let e,t=r[48].shortcuts+"",n,i,o=(r[48].name??"unnamed road")+"",u,s,d=Math.round(r[48].speed_mph)+"",p,g;return{c(){e=U("p"),n=Ee(t),i=Ee(" shortcuts through "),u=Ee(o),s=Ee(`
                (`),p=Ee(d),g=Ee(" mph)")},m(_,x){W(_,e,x),F(e,n),F(e,i),F(e,u),F(e,s),F(e,p),F(e,g)},p(_,x){x[1]&131072&&t!==(t=_[48].shortcuts+"")&&St(n,t),x[1]&131072&&o!==(o=(_[48].name??"unnamed road")+"")&&St(u,o),x[1]&131072&&d!==(d=Math.round(_[48].speed_mph)+"")&&St(p,d)},d(_){_&&H(e)}}}function fz(r){let e;return{c(){e=U("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function hz(r){let e;return{c(){e=U("p"),e.textContent="Click to designate a main road or not"},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function dz(r){let e;return{c(){e=U("p"),e.textContent="Click to change direction"},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function pz(r){let e,t,n,i;return{c(){e=U("div"),t=U("img"),i=Ee(`
                Click to add modal filter`),Sr(t.src,n=`/ltn//filters/${r[9]}_icon.gif`)||he(t,"src",n),he(t,"width","20"),he(t,"alt","Add modal filter")},m(o,u){W(o,e,u),F(e,t),F(e,i)},p(o,u){u[0]&512&&!Sr(t.src,n=`/ltn//filters/${o[9]}_icon.gif`)&&he(t,"src",n)},d(o){o&&H(e)}}}function mz(r){let e,t;function n(p,g){if(p[48].kind=="interior_road")return cz;if(p[48].kind=="main_road")return uz}let i=n(r),o=i&&i(r);function u(p,g){if(p[0].kind=="filter")return pz;if(p[0].kind=="oneway")return dz;if(p[0].kind=="main-roads"&&!p[0].freehand)return hz;if(p[0].kind=="turn_restriction")return fz}let s=u(r),d=s&&s(r);return{c(){o&&o.c(),e=oe(),d&&d.c(),t=tr()},m(p,g){o&&o.m(p,g),W(p,e,g),d&&d.m(p,g),W(p,t,g)},p(p,g){i===(i=n(p))&&o?o.p(p,g):(o&&o.d(1),o=i&&i(p),o&&(o.c(),o.m(e.parentNode,e))),s===(s=u(p))&&d?d.p(p,g):(d&&d.d(1),d=s&&s(p),d&&(d.c(),d.m(t.parentNode,t)))},d(p){p&&(H(e),H(t)),o&&o.d(p),d&&d.d(p)}}}function gz(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[mz,({props:i})=>({48:i}),({props:i})=>[0,i?131072:0]]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","line-popup")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[0]&513|o[1]&393216&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function _z(r){let e,t,n,i,o,u,s,d,p,g;return e=new yp({}),n=new _p({}),o=new vp({}),s=new ch({props:{interactive:r[0].kind=="filter"&&!r[0].freehand||r[0].kind=="oneway"||r[0].kind=="main-roads"&&!r[0].freehand||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[17],$$slots:{"line-popup":[gz]},$$scope:{ctx:r}}}),p=new GP({props:{interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[22]}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment),d=oe(),ue(p.$$.fragment)},m(_,x){ae(e,_,x),W(_,t,x),ae(n,_,x),W(_,i,x),ae(o,_,x),W(_,u,x),ae(s,_,x),W(_,d,x),ae(p,_,x),g=!0},p(_,x){const C={};x[0]&1&&(C.interactive=_[0].kind=="filter"&&!_[0].freehand||_[0].kind=="oneway"||_[0].kind=="main-roads"&&!_[0].freehand||_[0].kind=="turn_restriction"&&_[0].from_road_id==null),x[0]&513|x[1]&262144&&(C.$$scope={dirty:x,ctx:_}),s.$set(C);const M={};x[0]&1&&(M.interactive=_[0].kind=="filter"),x[0]&2&&(M.neighbourhood=_[1]),p.$set(M)},i(_){g||(N(e.$$.fragment,_),N(n.$$.fragment,_),N(o.$$.fragment,_),N(s.$$.fragment,_),N(p.$$.fragment,_),g=!0)},o(_){V(e.$$.fragment,_),V(n.$$.fragment,_),V(o.$$.fragment,_),V(s.$$.fragment,_),V(p.$$.fragment,_),g=!1},d(_){_&&(H(t),H(i),H(u),H(d)),le(e,_),le(n,_),le(o,_),le(s,_),le(p,_)}}}function sb(r){let e,t;return e=new DP({props:{paths:r[7]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.paths=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function yz(r){let e;return{c(){e=Ee("Click to delete filter")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function vz(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[yz]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","modal-filter")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[1]&262144&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function bz(r){let e;return{c(){e=Ee("Click to delete turn restriction")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function wz(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[bz]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","turn-restriction")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o[1]&262144&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function xz(r){let e,t;return e=new H2({props:{map:kr(r[2])}}),e.$on("done",r[29]),e.$on("progress",r[30]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=kr(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function kz(r){let e,t;return e=new H2({props:{map:kr(r[2])}}),e.$on("done",r[26]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=kr(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function ab(r){let e,t;return e=new gr({props:{data:r[0].possible_targets||Ji(),generateId:!0,$$slots:{default:[Cz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||Ji()),i[0]&1|i[1]&262144&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Sz(r){let e,t,n,i,o=r[0].from_road_name+"",u,s,d=(r[48].name||"unnamed road")+"",p;return{c(){e=U("div"),t=U("img"),i=Ee(`

              Create a turn restriction from `),u=Ee(o),s=Ee(" to "),p=Ee(d),Sr(t.src,n=`/ltn//filters/no_${r[48].kind}_turn.png`)||he(t,"src",n),he(t,"width","20"),he(t,"alt","Add turn restriction")},m(g,_){W(g,e,_),F(e,t),F(e,i),F(e,u),F(e,s),F(e,p)},p(g,_){_[1]&131072&&!Sr(t.src,n=`/ltn//filters/no_${g[48].kind}_turn.png`)&&he(t,"src",n),_[0]&1&&o!==(o=g[0].from_road_name+"")&&St(u,o),_[1]&131072&&d!==(d=(g[48].name||"unnamed road")+"")&&St(p,d)},d(g){g&&H(e)}}}function Tz(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[Sz,({props:n})=>({48:n}),({props:n})=>[0,n?131072:0]]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&393216&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Cz(r){let e,t;const n=[_n("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":Qn(.5,1),"line-width":ra(1)}}];let i={$$slots:{default:[Tz]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),e.$on("click",r[19]),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};u[0]&1|u[1]&262144&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Mz(r){let e,t,n,i,o,u,s,d,p,g,_,x;t=new Wg({}),t.$on("click",r[18]),i=new fh({props:{input:r[1],$$slots:{default:[_z]},$$scope:{ctx:r}}});let C=r[10]&&sb(r);s=new el({props:{onClickModalFilter:r[20],onClickTurnRestriction:r[21],interactive:r[0].kind=="filter",$$slots:{"turn-restriction":[wz],"modal-filter":[vz]},$$scope:{ctx:r}}});const M=[kz,xz],P=[];function A(I,$){return I[0].kind=="filter"&&I[0].freehand?0:I[0].kind=="main-roads"&&I[0].freehand?1:-1}~(p=A(r))&&(g=P[p]=M[p](r));let L=r[0].kind=="turn_restriction"&&ab(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),o=oe(),C&&C.c(),u=oe(),ue(s.$$.fragment),d=oe(),g&&g.c(),_=oe(),L&&L.c(),he(e,"slot","map")},m(I,$){W(I,e,$),ae(t,e,null),F(e,n),ae(i,e,null),F(e,o),C&&C.m(e,null),F(e,u),ae(s,e,null),F(e,d),~p&&P[p].m(e,null),F(e,_),L&&L.m(e,null),x=!0},p(I,$){const O={};$[0]&2&&(O.input=I[1]),$[0]&515|$[1]&262144&&(O.$$scope={dirty:$,ctx:I}),i.$set(O),I[10]?C?(C.p(I,$),$[0]&1024&&N(C,1)):(C=sb(I),C.c(),N(C,1),C.m(e,u)):C&&(Xt(),V(C,1,1,()=>{C=null}),Yt());const Z={};$[0]&1&&(Z.interactive=I[0].kind=="filter"),$[1]&262144&&(Z.$$scope={dirty:$,ctx:I}),s.$set(Z);let X=p;p=A(I),p===X?~p&&P[p].p(I,$):(g&&(Xt(),V(P[X],1,1,()=>{P[X]=null}),Yt()),~p?(g=P[p],g?g.p(I,$):(g=P[p]=M[p](I),g.c()),N(g,1),g.m(e,_)):g=null),I[0].kind=="turn_restriction"?L?(L.p(I,$),$[0]&1&&N(L,1)):(L=ab(I),L.c(),N(L,1),L.m(e,null)):L&&(Xt(),V(L,1,1,()=>{L=null}),Yt())},i(I){x||(N(t.$$.fragment,I),N(i.$$.fragment,I),N(C),N(s.$$.fragment,I),N(g),N(L),x=!0)},o(I){V(t.$$.fragment,I),V(i.$$.fragment,I),V(C),V(s.$$.fragment,I),V(g),V(L),x=!1},d(I){I&&H(e),le(t),le(i),C&&C.d(),le(s),~p&&P[p].d(),L&&L.d()}}}function Ez(r){let e,t,n,i;return e=new So({props:{$$slots:{map:[Mz],sidebar:[lz],top:[rz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0,n||(i=It(window,"keydown",r[23]),n=!0)},p(o,u){const s={};u[0]&65535|u[1]&262144&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o),n=!1,i()}}}let lb="Shortcuts are routes from one main road to another, which cut through the neighborhood's interior.",Lz="Cells are the colored area reachable without travelling along a main road.";function Iz(r,e,t){let n,i,o,u,s,d,p,g,_,x,C;ct(r,Gi,Ke=>t(28,i=Ke)),ct(r,Ar,Ke=>t(46,o=Ke)),ct(r,Km,Ke=>t(9,u=Ke)),ct(r,as,Ke=>t(2,s=Ke)),ct(r,Y0,Ke=>t(10,d=Ke)),ct(r,Xm,Ke=>t(11,p=Ke)),ct(r,Ym,Ke=>t(12,g=Ke)),ct(r,Kd,Ke=>t(13,_=Ke)),ct(r,er,Ke=>t(14,x=Ke)),ct(r,zf,Ke=>t(15,C=Ke));function M(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:Ji()}}let P={kind:"filter",freehand:!1},A=!1,L=0,I=0,$,O,Z=o.getAllShortcuts();Ss(()=>{g2()}),ri(()=>{s.doubleClickZoom.enable()});function X(Ke){t(1,O=o.renderNeighbourhood()),t(6,$=O.features.find(kt=>kt.properties.kind=="boundary")),t(4,L=O.undo_length),t(5,I=O.redo_length),t(7,Z=o.getAllShortcuts()),qf()}function q(Ke,kt){P.kind=="filter"?(o.addModalFilter(kt,u),ln(Gi,i++,i)):P.kind=="oneway"?(o.toggleTravelFlow(Ke.properties.road),ln(Gi,i++,i)):P.kind=="main-roads"&&!P.freehand?(o.toggleMainRoad(Ke.properties.road),ln(Gi,i++,i)):P.kind=="turn_restriction"&&(t(0,P.from_road_id=Ke.properties.road,P),t(0,P.from_road_name=Ke.properties.name||"unnamed road",P),t(0,P.possible_targets=o.getTurnRestrictionTargets(Ke.properties.road),P))}function Y(Ke){P.kind=="turn_restriction"&&(s.queryRenderedFeatures(Ke.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,P=M()))}function fe(Ke){if(P.kind=="turn_restriction"&&P.from_road_id!=null){let kt=Ke.detail.features[0].properties.road;o.addTurnRestriction(P.from_road_id,kt),ln(Gi,i++,i)}t(0,P=M())}function Le(Ke){let kt=Ke.detail.features[0];o.deleteModalFilter(kt.properties.road),ln(Gi,i++,i)}function ee(Ke){let kt=Ke.detail.features[0];o.deleteTurnRestriction(kt.properties.intersection,kt.properties.from_road,kt.properties.to_road),ln(Gi,i++,i)}function ie(Ke){if(P.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${P.kind}`);return}Ke.hasRotatedFilter?(o.deleteDiagonalFilter(Ke),ln(Gi,i++,i)):Ke.filter?(o.rotateDiagonalFilter(Ke),ln(Gi,i++,i)):(o.addDiagonalFilter(Ke),ln(Gi,i++,i))}function ve(Ke){Ke.target.tagName!="INPUT"&&(Ke.ctrlKey&&Ke.key=="z"&&ye(),Ke.ctrlKey&&Ke.key=="y"&&it(),Ke.key=="1"&&t(0,P={kind:"filter",freehand:!1}),Ke.key=="2"&&t(0,P={kind:"oneway"}),Ke.key=="3"&&t(0,P=M()),Ke.key=="4"&&t(0,P={kind:"main-roads",freehand:!1,isMain:!1}))}function ye(){o.undo(),ln(Gi,i++,i)}function it(){o.redo(),ln(Gi,i++,i)}function Fe(Ke){let kt=Ke.detail;kt&&(o.addManyModalFilters(kt,u),ln(Gi,i++,i)),t(0,P={kind:"filter",freehand:!1})}function Ne(Ke,kt){if(P.kind!="main-roads"){console.assert(!1,"cant paint line unless in main-roads mode");return}let pe=Ke.detail;pe&&(o.reclassifyRoadsAlongLine(pe,P.isMain,kt),ln(Gi,i++,i))}const Ae=Ke=>Ne(Ke,!0),ot=Ke=>Ne(Ke,!1),Ye=()=>t(0,P={kind:"filter",freehand:!1}),ut=()=>t(0,P={kind:"oneway"}),pt=()=>t(0,P=M()),_t=()=>t(0,P={kind:"main-roads",freehand:!1,isMain:!1});function He(Ke){A=Ke,t(3,A)}const mt=()=>t(3,A=!0),Pt=()=>t(0,P={kind:"filter",freehand:!1}),jt=()=>t(0,P={kind:"filter",freehand:!0}),un=()=>{t(0,P={kind:"main-roads",freehand:!1,isMain:!0})},nn=()=>{t(0,P={kind:"main-roads",freehand:!0,isMain:!0})},rn=()=>{t(0,P={kind:"main-roads",freehand:!0,isMain:!1})};function pn(){d=this.checked,Y0.set(d)}function yn(){p=this.checked,Xm.set(p)}function qe(){g=this.checked,Ym.set(g)}function We(){_=Ra(this),Kd.set(_)}return r.$$.update=()=>{r.$$.dirty[0]&5&&(P.kind=="oneway"||P.kind=="main-roads"?s.doubleClickZoom.disable():s.doubleClickZoom.enable()),r.$$.dirty[0]&5&&(P.kind=="filter"&&P.freehand||P.kind=="main-roads"&&P.freehand&&P.isMain?s.getCanvas().style.cursor=`url(${mP}) 8 22, cell`:P.kind=="main-roads"&&P.freehand&&!P.isMain?s.getCanvas().style.cursor=`url(${pP}) 8 22, cell`:s.getCanvas().style.cursor=""),r.$$.dirty[0]&268435456&&X(),r.$$.dirty[0]&2&&t(8,n=O.features.filter(Ke=>Ke.properties.kind=="cell"&&Ke.properties.cell_color=="disconnected").length)},[P,O,s,A,L,I,$,Z,n,u,d,p,g,_,x,C,M,q,Y,fe,Le,ee,ie,ve,ye,it,Fe,Ne,i,Ae,ot,Ye,ut,pt,_t,He,mt,Pt,jt,un,nn,rn,pn,yn,qe,We]}class Az extends Lt{constructor(e){super(),Et(this,e,Iz,Ez,Tt,{},null,[-1,-1])}}function ub(r){let e,t,n;return t=new On({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function Pz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P=_r(r[5].mode)+"",A,L;o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}});let I=r[0]=="neighbourhood"&&ub();return x=new On({props:{mode:{mode:"predict-impact",prevMode:r[0]}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),I&&I.c(),g=oe(),_=U("li"),ue(x.$$.fragment),C=oe(),M=U("li"),A=Ee(P),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m($,O){W($,e,O),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),I&&I.m(n,null),F(n,g),F(n,_),ae(x,_,null),F(n,C),F(n,M),F(M,A),L=!0},p($,O){$[0]=="neighbourhood"?I?O&1&&N(I,1):(I=ub(),I.c(),N(I,1),I.m(n,g)):I&&(Xt(),V(I,1,1,()=>{I=null}),Yt());const Z={};O&1&&(Z.mode={mode:"predict-impact",prevMode:$[0]}),x.$set(Z),(!L||O&32)&&P!==(P=_r($[5].mode)+"")&&St(A,P)},i($){L||(N(o.$$.fragment,$),N(d.$$.fragment,$),N(I),N(x.$$.fragment,$),L=!0)},o($){V(o.$$.fragment,$),V(d.$$.fragment,$),V(I),V(x.$$.fragment,$),L=!1},d($){$&&H(e),le(o),le(d),I&&I.d(),le(x)}}}function cb(r){let e,t,n,i,o,u,s;function d(C){r[10](C)}let p={list:r[2]};r[3]!==void 0&&(p.idx=r[3]),e=new cp({props:p}),dn.push(()=>Dn(e,"idx",d));let g=r[2][r[3]].count>1&&fb(r),_=r[2][r[3]].before==null&&hb(),x=r[2][r[3]].after==null&&db();return{c(){ue(e.$$.fragment),n=oe(),g&&g.c(),i=oe(),_&&_.c(),o=oe(),x&&x.c(),u=tr()},m(C,M){ae(e,C,M),W(C,n,M),g&&g.m(C,M),W(C,i,M),_&&_.m(C,M),W(C,o,M),x&&x.m(C,M),W(C,u,M),s=!0},p(C,M){const P={};M&4&&(P.list=C[2]),!t&&M&8&&(t=!0,P.idx=C[3],zn(()=>t=!1)),e.$set(P),C[2][C[3]].count>1?g?g.p(C,M):(g=fb(C),g.c(),g.m(i.parentNode,i)):g&&(g.d(1),g=null),C[2][C[3]].before==null?_||(_=hb(),_.c(),_.m(o.parentNode,o)):_&&(_.d(1),_=null),C[2][C[3]].after==null?x||(x=db(),x.c(),x.m(u.parentNode,u)):x&&(x.d(1),x=null)},i(C){s||(N(e.$$.fragment,C),s=!0)},o(C){V(e.$$.fragment,C),s=!1},d(C){C&&(H(n),H(i),H(o),H(u)),le(e,C),g&&g.d(C),_&&_.d(C),x&&x.d(C)}}}function fb(r){let e,t,n=r[2][r[3]].count.toLocaleString()+"",i,o,u,s;return{c(){e=U("p"),t=Ee(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=Ee(n),o=Ee(` trips between the
          same points.`),u=oe(),s=U("i"),s.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(d,p){W(d,e,p),F(e,t),F(e,i),F(e,o),W(d,u,p),W(d,s,p)},p(d,p){p&12&&n!==(n=d[2][d[3]].count.toLocaleString()+"")&&St(i,n)},d(d){d&&(H(e),H(u),H(s))}}}function hb(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,Qe(e,"color","red")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function db(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,Qe(e,"color","blue")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function zz(r){let e,t,n,i,o=r[1].before.toLocaleString()+"",u,s,d,p,g=r[1].after.toLocaleString()+"",_,x,C,M,P=Math.round(100*r[1].after/r[1].before)+"",A,L,I,$;t=new js({props:{mode:{mode:"predict-impact",prevMode:r[0]}}});let O=r[2].length>0&&cb(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),u=Ee(o),s=Ee(` routes cross here
      `),d=U("span"),d.textContent="before your changes",p=Ee(`
      , and `),_=Ee(g),x=oe(),C=U("span"),C.textContent="after your changes",M=Ee(`
      . That's
      `),A=Ee(P),L=Ee("% of the original traffic."),I=oe(),O&&O.c(),Qe(d,"color","red"),Qe(C,"color","blue"),he(e,"slot","sidebar")},m(Z,X){W(Z,e,X),ae(t,e,null),F(e,n),F(e,i),F(i,u),F(i,s),F(i,d),F(i,p),F(i,_),F(i,x),F(i,C),F(i,M),F(i,A),F(i,L),F(e,I),O&&O.m(e,null),$=!0},p(Z,X){const q={};X&1&&(q.mode={mode:"predict-impact",prevMode:Z[0]}),t.$set(q),(!$||X&2)&&o!==(o=Z[1].before.toLocaleString()+"")&&St(u,o),(!$||X&2)&&g!==(g=Z[1].after.toLocaleString()+"")&&St(_,g),(!$||X&2)&&P!==(P=Math.round(100*Z[1].after/Z[1].before)+"")&&St(A,P),Z[2].length>0?O?(O.p(Z,X),X&4&&N(O,1)):(O=cb(Z),O.c(),N(O,1),O.m(e,null)):O&&(Xt(),V(O,1,1,()=>{O=null}),Yt())},i(Z){$||(N(t.$$.fragment,Z),N(O),$=!0)},o(Z){V(t.$$.fragment,Z),V(O),$=!1},d(Z){Z&&H(e),le(t),O&&O.d()}}}function pb(r){let e,t,n,i,o,u;return e=new gr({props:{data:r[6](r[3]),$$slots:{default:[Dz]},$$scope:{ctx:r}}}),n=new Fl({props:{lngLat:r[7](r[3]),$$slots:{default:[Rz]},$$scope:{ctx:r}}}),o=new Fl({props:{lngLat:r[8](r[3]),$$slots:{default:[Fz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment)},m(s,d){ae(e,s,d),W(s,t,d),ae(n,s,d),W(s,i,d),ae(o,s,d),u=!0},p(s,d){const p={};d&8&&(p.data=s[6](s[3])),d&8192&&(p.$$scope={dirty:d,ctx:s}),e.$set(p);const g={};d&8&&(g.lngLat=s[7](s[3])),d&8192&&(g.$$scope={dirty:d,ctx:s}),n.$set(g);const _={};d&8&&(_.lngLat=s[8](s[3])),d&8192&&(_.$$scope={dirty:d,ctx:s}),o.$set(_)},i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(H(t),H(i)),le(e,s),le(n,s),le(o,s)}}}function Dz(r){let e,t;const n=[_n("predict-impact"),{paint:{"line-width":No(["get","kind"],{focus:8},5),"line-color":No(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":No(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Rz(r){let e;return{c(){e=Ee("A")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function Fz(r){let e;return{c(){e=Ee("B")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function Oz(r){let e,t,n,i,o=r[2].length>0&&pb(r);return n=new el({props:{interactive:!1}}),{c(){e=U("div"),o&&o.c(),t=oe(),ue(n.$$.fragment),he(e,"slot","map")},m(u,s){W(u,e,s),o&&o.m(e,null),F(e,t),ae(n,e,null),i=!0},p(u,s){u[2].length>0?o?(o.p(u,s),s&4&&N(o,1)):(o=pb(u),o.c(),N(o,1),o.m(e,t)):o&&(Xt(),V(o,1,1,()=>{o=null}),Yt())},i(u){i||(N(o),N(n.$$.fragment,u),i=!0)},o(u){V(o),V(n.$$.fragment,u),i=!1},d(u){u&&H(e),o&&o.d(),le(n)}}}function $z(r){let e,t,n,i;return e=new lh({props:{loading:r[4]}}),n=new So({props:{$$slots:{map:[Oz],sidebar:[zz],top:[Pz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&16&&(s.loading=o[4]),e.$set(s);const d={};u&8239&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function Bz(r,e,t){let n,i,o;ct(r,er,A=>t(5,n=A)),ct(r,Jm,A=>t(11,i=A)),ct(r,Ar,A=>t(12,o=A));let{road:u}=e,{prevPrevMode:s}=e,d=u.properties;d.kind="focus";let p=[],g=0,_="Finding changes to this road";Ss(async()=>{await new Promise(A=>{requestAnimationFrame(()=>{requestAnimationFrame(A)})}),t(2,p=o.getImpactsOnRoad(d.id,i)),t(4,_=""),p.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),ln(er,n={mode:"predict-impact",prevMode:s},n))});function x(A){return{type:"FeatureCollection",features:[p[A].before,p[A].after,u].filter(L=>L!=null)}}function C(A){return p[A].before!=null?p[A].before.geometry.coordinates[0]:p[A].after.geometry.coordinates[0]}function M(A){let L=p[A].before!=null?p[A].before.geometry.coordinates:p[A].after.geometry.coordinates;return L[L.length-1]}function P(A){g=A,t(3,g)}return r.$$set=A=>{"road"in A&&t(9,u=A.road),"prevPrevMode"in A&&t(0,s=A.prevPrevMode)},[s,d,p,g,_,n,x,C,M,u,P]}class Nz extends Lt{constructor(e){super(),Et(this,e,Bz,$z,Tt,{road:9,prevPrevMode:0})}}function jz(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M=_r(r[6].mode)+"",P,A;return o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}}),_=new On({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Ee(M),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(L,I){W(L,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,P),A=!0},p(L,I){(!A||I&64)&&M!==(M=_r(L[6].mode)+"")&&St(P,M)},i(L){A||(N(o.$$.fragment,L),N(d.$$.fragment,L),N(_.$$.fragment,L),A=!0)},o(L){V(o.$$.fragment,L),V(d.$$.fragment,L),V(_.$$.fragment,L),A=!1},d(L){L&&H(e),le(o),le(d),le(_)}}}function Uz(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function Vz(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function qz(r){let e,t=ja(r[4].properties.distance)+"",n,i,o=Ua(r[4].properties.time)+"",u;return{c(){e=U("p"),n=Ee(t),i=Ee(", "),u=Ee(o)},m(s,d){W(s,e,d),F(e,n),F(e,i),F(e,u)},p(s,d){d&16&&t!==(t=ja(s[4].properties.distance)+"")&&St(n,t),d&16&&o!==(o=Ua(s[4].properties.time)+"")&&St(u,o)},d(s){s&&H(e)}}}function Hz(r){let e;return{c(){e=U("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function Wz(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function Gz(r){let e,t=ja(r[3].properties.distance)+"",n,i,o=Ua(r[3].properties.time)+"",u;return{c(){e=U("p"),n=Ee(t),i=Ee(", "),u=Ee(o)},m(s,d){W(s,e,d),F(e,n),F(e,i),F(e,u)},p(s,d){d&8&&t!==(t=ja(s[3].properties.distance)+"")&&St(n,t),d&8&&o!==(o=Ua(s[3].properties.time)+"")&&St(u,o)},d(s){s&&H(e)}}}function Zz(r){let e,t,n,i,o,u,s,d,p,g,_;t=new js({props:{mode:{mode:"neighbourhood"}}});function x(I,$){return I[4]?qz:I[3]?Vz:Uz}let C=x(r),M=C(r);function P(I,$){return I[3]?Gz:I[4]?Wz:Hz}let A=P(r),L=A(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=oe(),u=U("u"),u.textContent="Route before changes",s=oe(),M.c(),d=oe(),p=U("u"),p.textContent="Route after changes",g=oe(),L.c(),Qe(u,"color","red"),Qe(p,"color","blue"),he(e,"slot","sidebar")},m(I,$){W(I,e,$),ae(t,e,null),F(e,n),F(e,i),F(e,o),F(e,u),F(e,s),M.m(e,null),F(e,d),F(e,p),F(e,g),L.m(e,null),_=!0},p(I,$){C===(C=x(I))&&M?M.p(I,$):(M.d(1),M=C(I),M&&(M.c(),M.m(e,d))),A===(A=P(I))&&L?L.p(I,$):(L.d(1),L=A(I),L&&(L.c(),L.m(e,null)))},i(I){_||(N(t.$$.fragment,I),_=!0)},o(I){V(t.$$.fragment,I),_=!1},d(I){I&&H(e),le(t),M.d(),L.d()}}}function Kz(r){let e,t;const n=[_n("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Xi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function Xz(r){let e,t,n=(r[16].time_after/r[16].time_before).toFixed(1)+"",i;return{c(){e=U("p"),t=Ee("Time ratio: "),i=Ee(n)},m(o,u){W(o,e,u),F(e,t),F(e,i)},p(o,u){u&65536&&n!==(n=(o[16].time_after/o[16].time_before).toFixed(1)+"")&&St(i,n)},d(o){o&&H(e)}}}function Yz(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[Xz,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function Jz(r){let e,t,n;const i=[_n("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(s){r[10](s)}let u={$$slots:{default:[Yz]},$$scope:{ctx:r}};for(let s=0;s<i.length;s+=1)u=zt(u,i[s]);return r[0]!==void 0&&(u.hovered=r[0]),e=new ur({props:u}),dn.push(()=>Dn(e,"hovered",o)),e.$on("click",r[11]),{c(){ue(e.$$.fragment)},m(s,d){ae(e,s,d),n=!0},p(s,d){const p=d&32?An(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(s[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};d&131072&&(p.$$scope={dirty:d,ctx:s}),!t&&d&1&&(t=!0,p.hovered=s[0],zn(()=>t=!1)),e.$set(p)},i(s){n||(N(e.$$.fragment,s),n=!0)},o(s){V(e.$$.fragment,s),n=!1},d(s){le(e,s)}}}function Qz(r){let e,t;const n=[_n("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":No(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function e7(r){let e;return{c(){e=Ee("X")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function t7(r){let e,t,n,i,o,u,s,d,p,g,_,x;t=new fh({props:{$$slots:{default:[Kz]},$$scope:{ctx:r}}}),i=new gr({props:{data:r[5],generateId:!0,$$slots:{default:[Jz]},$$scope:{ctx:r}}}),u=new gr({props:{data:r[1],$$slots:{default:[Qz]},$$scope:{ctx:r}}}),d=new el({props:{interactive:!1}});function C(P){r[12](P)}let M={draggable:!0,$$slots:{default:[e7]},$$scope:{ctx:r}};return r[2]!==void 0&&(M.lngLat=r[2]),g=new Fl({props:M}),dn.push(()=>Dn(g,"lngLat",C)),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),o=oe(),ue(u.$$.fragment),s=oe(),ue(d.$$.fragment),p=oe(),ue(g.$$.fragment),he(e,"slot","map")},m(P,A){W(P,e,A),ae(t,e,null),F(e,n),ae(i,e,null),F(e,o),ae(u,e,null),F(e,s),ae(d,e,null),F(e,p),ae(g,e,null),x=!0},p(P,A){const L={};A&131072&&(L.$$scope={dirty:A,ctx:P}),t.$set(L);const I={};A&32&&(I.data=P[5]),A&131105&&(I.$$scope={dirty:A,ctx:P}),i.$set(I);const $={};A&2&&($.data=P[1]),A&131072&&($.$$scope={dirty:A,ctx:P}),u.$set($);const O={};A&131072&&(O.$$scope={dirty:A,ctx:P}),!_&&A&4&&(_=!0,O.lngLat=P[2],zn(()=>_=!1)),g.$set(O)},i(P){x||(N(t.$$.fragment,P),N(i.$$.fragment,P),N(u.$$.fragment,P),N(d.$$.fragment,P),N(g.$$.fragment,P),x=!0)},o(P){V(t.$$.fragment,P),V(i.$$.fragment,P),V(u.$$.fragment,P),V(d.$$.fragment,P),V(g.$$.fragment,P),x=!1},d(P){P&&H(e),le(t),le(i),le(u),le(d),le(g)}}}function n7(r){let e,t,n,i;return e=new Wg({}),e.$on("contextmenu",r[8]),n=new So({props:{$$slots:{map:[t7],sidebar:[Zz],top:[jz]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&131199&&(s.$$scope={dirty:u,ctx:o}),n.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function r7(r,e,t){let n,i,o,u,s,d,p,g,_;ct(r,bd,$=>t(2,s=$)),ct(r,er,$=>t(6,d=$)),ct(r,Pf,$=>t(13,p=$)),ct(r,Af,$=>t(14,g=$)),ct(r,Ar,$=>t(9,_=$));let x=null;Ss(()=>{setTimeout(()=>{s&&eg(bd)},10)});function C($){return $?_.compareRoute(new la.LngLat($.properties.pt1_x,$.properties.pt1_y),s,1):Ji()}function M($){ln(Af,g=new la.LngLat($.properties.pt1_x,$.properties.pt1_y),g),ln(Pf,p=s,p),ln(er,d={mode:"route",prevMode:"impact-one-destination"},d)}function P($){ln(bd,s=$.detail.lngLat,s)}function A($){x=$,t(0,x)}const L=$=>M($.detail.features[0]);function I($){s=$,bd.set(s)}return r.$$.update=()=>{r.$$.dirty&516&&t(5,n=_.impactToOneDestination(s)),r.$$.dirty&1&&t(1,i=C(x)),r.$$.dirty&2&&t(4,o=i.features.find($=>$.properties.kind=="before")),r.$$.dirty&2&&t(3,u=i.features.find($=>$.properties.kind=="after"))},[x,i,s,u,o,n,d,M,P,_,A,L,I]}class i7 extends Lt{constructor(e){super(),Et(this,e,r7,n7,Tt,{})}}function mb(r,e,t){const n=r.slice();return n[27]=e[t].properties.name,n}function o7(r){let e;return{c(){e=U("p"),e.textContent=`Inside the neighbourhood you define, the goal is to eliminate (or
              deliberately permit) through-traffic. An appropriate neighbourhood
              boundary depends on many factors. The simplest approach is to find
              the area bounded on all sides by "main" roads, which are designed
              for higher traffic volumes. There are many other considerations,
              though -- maybe severances like rivers or rail should be part of a
              boundary. Bridges and tunnels near a boundary may be confusing as
              well. And note that your boundary may not match the conventional
              definition of "neighbourhood."`},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function gb(r){let e,t,n;return t=new On({props:{mode:{mode:"debug-intersections"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function s7(r){let e,t,n,i,o,u,s,d=_r(r[5].mode)+"",p,g,_,x,C,M,P,A,L,I,$,O,Z;o=new On({props:{mode:{mode:"title"}}}),_=new r_({props:{$$slots:{default:[o7]},$$scope:{ctx:r}}}),A=new On({props:{mode:{mode:"route",prevMode:"pick-neighbourhood"}}}),$=new On({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}});let X=r[8]&&gb();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),p=Ee(d),g=oe(),ue(_.$$.fragment),x=oe(),C=U("nav"),M=U("ul"),P=U("li"),ue(A.$$.fragment),L=oe(),I=U("li"),ue($.$$.fragment),O=oe(),X&&X.c(),he(t,"aria-label","breadcrumb"),he(e,"slot","top"),Qe(e,"display","flex"),Qe(e,"justify-content","space-between")},m(q,Y){W(q,e,Y),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),F(s,p),F(s,g),ae(_,s,null),F(e,x),F(e,C),F(C,M),F(M,P),ae(A,P,null),F(M,L),F(M,I),ae($,I,null),F(M,O),X&&X.m(M,null),Z=!0},p(q,Y){(!Z||Y&32)&&d!==(d=_r(q[5].mode)+"")&&St(p,d);const fe={};Y&1073741824&&(fe.$$scope={dirty:Y,ctx:q}),_.$set(fe),q[8]?X?Y&256&&N(X,1):(X=gb(),X.c(),N(X,1),X.m(M,null)):X&&(Xt(),V(X,1,1,()=>{X=null}),Yt())},i(q){Z||(N(o.$$.fragment,q),N(_.$$.fragment,q),N(A.$$.fragment,q),N($.$$.fragment,q),N(X),Z=!0)},o(q){V(o.$$.fragment,q),V(_.$$.fragment,q),V(A.$$.fragment,q),V($.$$.fragment,q),V(X),Z=!1},d(q){q&&H(e),le(o),le(_),le(A),le($),X&&X.d()}}}function a7(r){let e=r[27]+"",t;return{c(){t=Ee(e)},m(n,i){W(n,t,i)},p(n,i){i&1&&e!==(e=n[27]+"")&&St(t,e)},d(n){n&&H(t)}}}function _b(r){let e,t,n,i,o,u,s,d,p,g,_,x,C;function M(){return r[19](r[27])}n=new ah({props:{$$slots:{default:[a7]},$$scope:{ctx:r}}}),n.$on("click",M),s=new Ug({props:{color:"black"}});function P(){return r[20](r[27])}g=new Vg({props:{color:"white"}});function A(){return r[21](r[27])}function L(){return r[22](r[27])}return{c(){var I;e=U("li"),t=U("h3"),ue(n.$$.fragment),i=oe(),o=U("span"),u=U("button"),ue(s.$$.fragment),d=oe(),p=U("button"),ue(g.$$.fragment),he(u,"class","outline icon-btn"),he(u,"title","Rename neighbourhood"),he(p,"class","icon-btn destructive"),he(p,"title","Delete neighbourhood"),he(o,"class","actions"),he(e,"class","actionable-cell svelte-qhjp0j"),Gt(e,"highlighted",((I=r[3])==null?void 0:I.properties.name)==r[27]||r[2]==r[27])},m(I,$){W(I,e,$),F(e,t),ae(n,t,null),F(e,i),F(e,o),F(o,u),ae(s,u,null),F(o,d),F(o,p),ae(g,p,null),_=!0,x||(C=[It(u,"click",P),It(p,"click",A),It(e,"mouseenter",L),It(e,"mouseleave",r[23])],x=!0)},p(I,$){var Z;r=I;const O={};$&1073741825&&(O.$$scope={dirty:$,ctx:r}),n.$set(O),(!_||$&13)&&Gt(e,"highlighted",((Z=r[3])==null?void 0:Z.properties.name)==r[27]||r[2]==r[27])},i(I){_||(N(n.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),_=!0)},o(I){V(n.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),_=!1},d(I){I&&H(e),le(n),le(s),le(g),x=!1,cr(C)}}}function l7(r){let e,t,n;return e=new E4({}),{c(){ue(e.$$.fragment),t=Ee(`
          Add a new neighbourhood`)},m(i,o){ae(e,i,o),W(i,t,o),n=!0},i(i){n||(N(e.$$.fragment,i),n=!0)},o(i){V(e.$$.fragment,i),n=!1},d(i){i&&H(t),le(e,i)}}}function yb(r){let e,t,n,i,o,u,s,d,p;function g(x){r[24](x)}let _={};return r[1]!==void 0&&(_.selectedPrioritization=r[1]),o=new j2({props:_}),dn.push(()=>Dn(o,"selectedPrioritization",g)),{c(){e=U("h3"),e.textContent="Prioritization",t=oe(),n=U("p"),n.textContent="Compare metrics across your neighbourhoods.",i=oe(),ue(o.$$.fragment),s=oe(),d=U("hr")},m(x,C){W(x,e,C),W(x,t,C),W(x,n,C),W(x,i,C),ae(o,x,C),W(x,s,C),W(x,d,C),p=!0},p(x,C){const M={};!u&&C&2&&(u=!0,M.selectedPrioritization=x[1],zn(()=>u=!1)),o.$set(M)},i(x){p||(N(o.$$.fragment,x),p=!0)},o(x){V(o.$$.fragment,x),p=!1},d(x){x&&(H(e),H(t),H(n),H(i),H(s),H(d)),le(o,x)}}}function vb(r){let e,t,n;return{c(){e=U("button"),e.textContent="Debug route-snapper",he(e,"class","secondary")},m(i,o){W(i,e,o),t||(n=It(e,"click",r[12]),t=!0)},p:at,d(i){i&&H(e),t=!1,n()}}}function u7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I=r[4].modalFilters+"",$,O,Z,X,q=r[4].deletedModalFilters+"",Y,fe,Le,ee,ie=r[4].travelFlows+"",ve,ye,it,Fe,Ne,Ae;s=new bw({});let ot=$n(r[0].features),Ye=[];for(let He=0;He<ot.length;He+=1)Ye[He]=_b(mb(r,ot,He));const ut=He=>V(Ye[He],1,1,()=>{Ye[He]=null});M=new On({props:{mode:{mode:"add-neighbourhood"},$$slots:{default:[l7]},$$scope:{ctx:r}}});let pt=r[7]=="cnt"&&yb(r),_t=r[8]&&vb(r);return{c(){e=U("div"),t=U("div"),n=U("h2"),n.textContent="Neighbourhoods",i=oe(),o=U("button"),u=U("div"),ue(s.$$.fragment),d=oe(),p=U("span"),p.textContent="Export",g=oe(),_=U("ul");for(let He=0;He<Ye.length;He+=1)Ye[He].c();x=oe(),C=U("li"),ue(M.$$.fragment),P=oe(),pt&&pt.c(),A=oe(),L=U("p"),$=Ee(I),O=Ee(" new modal filter(s) added"),Z=oe(),X=U("p"),Y=Ee(q),fe=Ee(`
      existing modal filter(s) removed`),Le=oe(),ee=U("p"),ve=Ee(ie),ye=Ee(" road segment direction(s) changed"),it=oe(),_t&&_t.c(),Qe(p,"margin-right","2px"),Qe(u,"display","flex"),Qe(u,"align-items","center"),Qe(u,"gap","8px"),Qe(u,"color","black"),he(o,"class","outline"),Qe(o,"margin-right","8px"),he(o,"title","Download project as GeoJSON"),Qe(t,"display","flex"),Qe(t,"justify-content","space-between"),Qe(t,"align-items","center"),Qe(t,"gap","16px"),he(_,"class","navigable-list"),he(e,"slot","sidebar")},m(He,mt){W(He,e,mt),F(e,t),F(t,n),F(t,i),F(t,o),F(o,u),ae(s,u,null),F(u,d),F(u,p),F(e,g),F(e,_);for(let Pt=0;Pt<Ye.length;Pt+=1)Ye[Pt]&&Ye[Pt].m(_,null);F(_,x),F(_,C),ae(M,C,null),F(e,P),pt&&pt.m(e,null),F(e,A),F(e,L),F(L,$),F(L,O),F(e,Z),F(e,X),F(X,Y),F(X,fe),F(e,Le),F(e,ee),F(ee,ve),F(ee,ye),F(e,it),_t&&_t.m(e,null),Fe=!0,Ne||(Ae=It(o,"click",r[18]),Ne=!0)},p(He,mt){if(mt&3597){ot=$n(He[0].features);let jt;for(jt=0;jt<ot.length;jt+=1){const un=mb(He,ot,jt);Ye[jt]?(Ye[jt].p(un,mt),N(Ye[jt],1)):(Ye[jt]=_b(un),Ye[jt].c(),N(Ye[jt],1),Ye[jt].m(_,x))}for(Xt(),jt=ot.length;jt<Ye.length;jt+=1)ut(jt);Yt()}const Pt={};mt&1073741824&&(Pt.$$scope={dirty:mt,ctx:He}),M.$set(Pt),He[7]=="cnt"?pt?(pt.p(He,mt),mt&128&&N(pt,1)):(pt=yb(He),pt.c(),N(pt,1),pt.m(e,A)):pt&&(Xt(),V(pt,1,1,()=>{pt=null}),Yt()),(!Fe||mt&16)&&I!==(I=He[4].modalFilters+"")&&St($,I),(!Fe||mt&16)&&q!==(q=He[4].deletedModalFilters+"")&&St(Y,q),(!Fe||mt&16)&&ie!==(ie=He[4].travelFlows+"")&&St(ve,ie),He[8]?_t?_t.p(He,mt):(_t=vb(He),_t.c(),_t.m(e,null)):_t&&(_t.d(1),_t=null)},i(He){if(!Fe){N(s.$$.fragment,He);for(let mt=0;mt<ot.length;mt+=1)N(Ye[mt]);N(M.$$.fragment,He),N(pt),Fe=!0}},o(He){V(s.$$.fragment,He),Ye=Ye.filter(Boolean);for(let mt=0;mt<Ye.length;mt+=1)V(Ye[mt]);V(M.$$.fragment,He),V(pt),Fe=!1},d(He){He&&H(e),le(s),_i(Ye,He),le(M),pt&&pt.d(),_t&&_t.d(),Ne=!1,Ae()}}}function c7(r){let e,t,n=(r[26].number_pois/r[26].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Points of interest:",t=oe(),i=Ee(n),o=Ee(" / km")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s&67108864&&n!==(n=(u[26].number_pois/u[26].area_km2).toFixed(1)+"")&&St(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function f7(r){let e,t,n=(r[26].number_stats19_collisions/r[26].area_km2).toFixed(1)+"",i,o;return{c(){e=U("b"),e.textContent="Pedestrian and cyclist collisions:",t=oe(),i=Ee(n),o=Ee(" / km")},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s&67108864&&n!==(n=(u[26].number_stats19_collisions/u[26].area_km2).toFixed(1)+"")&&St(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function h7(r){let e,t,n=Math.round(r[26].population/r[26].area_km2).toLocaleString()+"",i,o;return{c(){e=U("b"),e.textContent="Population density:",t=oe(),i=Ee(n),o=Ee(` people
            / km`)},m(u,s){W(u,e,s),W(u,t,s),W(u,i,s),W(u,o,s)},p(u,s){s&67108864&&n!==(n=Math.round(u[26].population/u[26].area_km2).toLocaleString()+"")&&St(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function d7(r){let e,t=r[26].name+"",n,i,o;function u(p,g){if(p[1]=="density")return h7;if(p[1]=="stats19")return f7;if(p[1]=="pois")return c7}let s=u(r),d=s&&s(r);return{c(){e=U("h2"),n=Ee(t),i=oe(),d&&d.c(),o=tr()},m(p,g){W(p,e,g),F(e,n),W(p,i,g),d&&d.m(p,g),W(p,o,g)},p(p,g){g&67108864&&t!==(t=p[26].name+"")&&St(n,t),s===(s=u(p))&&d?d.p(p,g):(d&&d.d(1),d=s&&s(p),d&&(d.c(),d.m(o.parentNode,o)))},d(p){p&&(H(e),H(i),H(o)),d&&d.d(p)}}}function p7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[d7,({props:n})=>({26:n}),({props:n})=>n?67108864:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1140850690&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function m7(r){let e,t,n,i,o,u,s,d,p;e=new s5({props:{data:r[2]?[{name:r[2],highlight:"yes"}]:[],idCol:"name"}});const g=[{filter:["==",["get","kind"],"boundary"]},_n("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let _={};for(let L=0;L<g.length;L+=1)_=zt(_,g[L]);n=new ur({props:_});const x=[{filter:["==",["get","kind"],"boundary"]},_n("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let C={};for(let L=0;L<x.length;L+=1)C=zt(C,x[L]);o=new ur({props:C});const M=[_n("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[13](r[1]),"fill-opacity":r[14](r[1])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function P(L){r[16](L)}let A={$$slots:{default:[p7]},$$scope:{ctx:r}};for(let L=0;L<M.length;L+=1)A=zt(A,M[L]);return r[3]!==void 0&&(A.hovered=r[3]),s=new Xi({props:A}),dn.push(()=>Dn(s,"hovered",P)),s.$on("click",r[17]),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(L,I){ae(e,L,I),W(L,t,I),ae(n,L,I),W(L,i,I),ae(o,L,I),W(L,u,I),ae(s,L,I),p=!0},p(L,I){const $={};I&4&&($.data=L[2]?[{name:L[2],highlight:"yes"}]:[]),e.$set($);const O={};n.$set(O);const Z={};o.$set(Z);const X=I&24578?An(M,[M[0],M[1],{paint:{"fill-color":L[13](L[1]),"fill-opacity":L[14](L[1])}},M[3],M[4]]):{};I&1073741826&&(X.$$scope={dirty:I,ctx:L}),!d&&I&8&&(d=!0,X.hovered=L[3],zn(()=>d=!1)),s.$set(X)},i(L){p||(N(e.$$.fragment,L),N(n.$$.fragment,L),N(o.$$.fragment,L),N(s.$$.fragment,L),p=!0)},o(L){V(e.$$.fragment,L),V(n.$$.fragment,L),V(o.$$.fragment,L),V(s.$$.fragment,L),p=!1},d(L){L&&(H(t),H(i),H(u)),le(e,L),le(n,L),le(o,L),le(s,L)}}}function g7(r){let e,t,n,i,o;return t=new gr({props:{data:r[0],promoteId:"name",$$slots:{default:[m7]},$$scope:{ctx:r}}}),i=new el({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),he(e,"slot","map")},m(u,s){W(u,e,s),ae(t,e,null),F(e,n),ae(i,e,null),o=!0},p(u,s){const d={};s&1&&(d.data=u[0]),s&1073741838&&(d.$$scope={dirty:s,ctx:u}),t.$set(d)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){V(t.$$.fragment,u),V(i.$$.fragment,u),o=!1},d(u){u&&H(e),le(t),le(i)}}}function _7(r){let e,t;return e=new So({props:{$$slots:{map:[g7],sidebar:[u7],top:[s7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1073742335&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function y7(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function v7(r,e,t){let n,i,o,u,s,d,p,g;ct(r,Ar,ve=>t(15,o=ve)),ct(r,za,ve=>t(25,u=ve)),ct(r,er,ve=>t(5,s=ve)),ct(r,Ba,ve=>t(6,d=ve)),ct(r,ks,ve=>t(7,p=ve)),ct(r,zf,ve=>t(8,g=ve));let _="none",x=null,C=null;ln(za,u=void 0,u);function M(ve){o.setCurrentNeighbourhood(ve),ln(za,u=ve,u),ln(er,s={mode:"neighbourhood"},s)}function P(ve){window.confirm(`Really delete neighbourhood ${ve}? You can't undo this.`)&&(o.deleteNeighbourhoodBoundary(ve),console.assert(!za),qf(),t(0,n=o.getAllNeighbourhoods()))}function A(ve){let ye=N2(o,`Rename neighbourhood ${ve} to what?`,ve);ye&&(o.renameNeighbourhoodBoundary(ve,ye),ln(za,u=ye,u),qf(),t(0,n=o.getAllNeighbourhoods()))}function L(){ip("debug_route_snapper.geojson",o.toRouteSnapperGj())}function I(ve){let ye=vo.mapFeature.hover.backgroundColor,it=U2({none:ye},ve);return["case",["==",["feature-state","highlight"],"yes"],ye,it]}function $(ve){let ye=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],ye,Qn(.3,ye)],area:Qn(.7,.9),density:Qn(.7,.9),simd:Qn(.7,.9),stats19:Qn(.7,.9),pois:Qn(.7,.9),car_ownership:Qn(.7,.9)}[ve]}function O(ve){C=ve,t(3,C)}const Z=ve=>M(kr(ve.detail.features[0].properties).name),X=()=>_2(kr(d)),q=ve=>M(ve),Y=ve=>A(ve),fe=ve=>P(ve),Le=ve=>t(2,x=ve),ee=()=>t(2,x=null);function ie(ve){_=ve,t(1,_)}return r.$$.update=()=>{r.$$.dirty&32768&&t(0,n=o.getAllNeighbourhoods()),r.$$.dirty&1&&t(4,i=y7(n))},[n,_,x,C,i,s,d,p,g,M,P,A,L,I,$,o,O,Z,X,q,Y,fe,Le,ee,ie]}class b7 extends Lt{constructor(e){super(),Et(this,e,v7,_7,Tt,{})}}function bb(r){let e,t,n;return t=new On({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function w7(r){let e,t,n,i,o,u,s,d,p,g,_,x=_r(r[4].mode)+"",C,M;o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}});let P=r[0]=="neighbourhood"&&bb();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),P&&P.c(),g=oe(),_=U("li"),C=Ee(x),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(A,L){W(A,e,L),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),P&&P.m(n,null),F(n,g),F(n,_),F(_,C),M=!0},p(A,L){A[0]=="neighbourhood"?P?L&1&&N(P,1):(P=bb(),P.c(),N(P,1),P.m(n,g)):P&&(Xt(),V(P,1,1,()=>{P=null}),Yt()),(!M||L&16)&&x!==(x=_r(A[4].mode)+"")&&St(C,x)},i(A){M||(N(o.$$.fragment,A),N(d.$$.fragment,A),N(P),M=!0)},o(A){V(o.$$.fragment,A),V(d.$$.fragment,A),V(P),M=!1},d(A){A&&H(e),le(o),le(d),P&&P.d()}}}function x7(r){let e;return{c(){e=Ee("Explore the origin/destination demand data used")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function k7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z,X,q,Y,fe,Le,ee;return t=new js({props:{mode:{mode:r[0]}}}),u=new On({props:{mode:{mode:"debug-demand"},$$slots:{default:[x7]},$$scope:{ctx:r}}}),q=new Vo({props:{colorScale:r[6],labels:{limits:["0%","50%","same","150%","200%"]}}}),fe=Pg(r[13][0]),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),o=Ee(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),ue(u.$$.fragment),s=oe(),d=U("fieldset"),p=U("label"),g=U("input"),_=Ee(`
        Calculate quickly`),x=oe(),C=U("label"),M=U("input"),P=Ee(`
        Calculate more accurately`),A=oe(),L=U("p"),L.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,I=oe(),$=U("label"),O=Ee(`Only show roads with at least this many daily trips before or after
      `),Z=U("input"),X=oe(),ue(q.$$.fragment),he(g,"type","radio"),g.__value="fast",Zn(g,g.__value),he(M,"type","radio"),M.__value="accurate",Zn(M,M.__value),he(Z,"type","number"),he(Z,"min",0),he(e,"slot","sidebar"),fe.p(g,M)},m(ie,ve){W(ie,e,ve),ae(t,e,null),F(e,n),F(e,i),F(i,o),ae(u,i,null),F(e,s),F(e,d),F(d,p),F(p,g),g.checked=g.__value===r[3],F(p,_),F(d,x),F(d,C),F(C,M),M.checked=M.__value===r[3],F(C,P),F(e,A),F(e,L),F(e,I),F(e,$),F($,O),F($,Z),Zn(Z,r[5]),F(e,X),ae(q,e,null),Y=!0,Le||(ee=[It(g,"change",r[12]),It(g,"change",r[9]),It(M,"change",r[14]),It(M,"change",r[9]),It(Z,"input",r[15])],Le=!0)},p(ie,ve){const ye={};ve&1&&(ye.mode={mode:ie[0]}),t.$set(ye);const it={};ve&524288&&(it.$$scope={dirty:ve,ctx:ie}),u.$set(it),ve&8&&(g.checked=g.__value===ie[3]),ve&8&&(M.checked=M.__value===ie[3]),ve&32&&zl(Z.value)!==ie[5]&&Zn(Z,ie[5])},i(ie){Y||(N(t.$$.fragment,ie),N(u.$$.fragment,ie),N(q.$$.fragment,ie),Y=!0)},o(ie){V(t.$$.fragment,ie),V(u.$$.fragment,ie),V(q.$$.fragment,ie),Y=!1},d(ie){ie&&H(e),le(t),le(u),le(q),fe.r(),Le=!1,cr(ee)}}}function S7(r){let e,t;const n=[_n("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Xi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function T7(r){let e,t=r[18].before.toLocaleString()+"",n,i,o=r[18].after.toLocaleString()+"",u,s,d,p,g=Math.round(100*r[18].after/r[18].before)+"",_,x;return{c(){e=U("p"),n=Ee(t),i=Ee(" before, "),u=Ee(o),s=Ee(`
            after`),d=oe(),p=U("p"),_=Ee(g),x=Ee("%")},m(C,M){W(C,e,M),F(e,n),F(e,i),F(e,u),F(e,s),W(C,d,M),W(C,p,M),F(p,_),F(p,x)},p(C,M){M&262144&&t!==(t=C[18].before.toLocaleString()+"")&&St(n,t),M&262144&&o!==(o=C[18].after.toLocaleString()+"")&&St(u,o),M&262144&&g!==(g=Math.round(100*C[18].after/C[18].before)+"")&&St(_,g)},d(C){C&&(H(e),H(d),H(p))}}}function C7(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[T7,({props:n})=>({18:n}),({props:n})=>n?262144:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&786432&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function M7(r){let e,t,n,i;const o=[_n("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Ed,r[2].max_count,1.5*Ld],"line-color":"black"}}];let u={};for(let p=0;p<o.length;p+=1)u=zt(u,o[p]);e=new ur({props:u});const s=[_n("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ed,r[2].max_count,Ld],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[6][0],50,r[6][1],100,r[6][2],150,r[6][3],200,r[6][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let d={$$slots:{default:[C7]},$$scope:{ctx:r}};for(let p=0;p<s.length;p+=1)d=zt(d,s[p]);return n=new ur({props:d}),n.$on("click",r[11]),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),i=!0},p(p,g){const _=g&36?An(o,[o[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&4&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*Ed,p[2].max_count,1.5*Ld],"line-color":"black"}}]):{};e.$set(_);const x=g&100?An(s,[s[0],g&32&&{filter:[">=",["max",["get","before"],["get","after"]],p[5]]},g&68&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,Ed,p[2].max_count,Ld],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,p[6][0],50,p[6][1],100,p[6][2],150,p[6][3],200,p[6][4]]]}},s[3],s[4]]):{};g&524288&&(x.$$scope={dirty:g,ctx:p}),n.$set(x)},i(p){i||(N(e.$$.fragment,p),N(n.$$.fragment,p),i=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),i=!1},d(p){p&&H(t),le(e,p),le(n,p)}}}function E7(r){let e,t,n,i,o,u,s;return t=new gr({props:{data:r[7],$$slots:{default:[S7]},$$scope:{ctx:r}}}),i=new gr({props:{data:r[2],generateId:!0,$$slots:{default:[M7]},$$scope:{ctx:r}}}),u=new el({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),ue(i.$$.fragment),o=oe(),ue(u.$$.fragment),he(e,"slot","map")},m(d,p){W(d,e,p),ae(t,e,null),F(e,n),ae(i,e,null),F(e,o),ae(u,e,null),s=!0},p(d,p){const g={};p&524288&&(g.$$scope={dirty:p,ctx:d}),t.$set(g);const _={};p&4&&(_.data=d[2]),p&524324&&(_.$$scope={dirty:p,ctx:d}),i.$set(_)},i(d){s||(N(t.$$.fragment,d),N(i.$$.fragment,d),N(u.$$.fragment,d),s=!0)},o(d){V(t.$$.fragment,d),V(i.$$.fragment,d),V(u.$$.fragment,d),s=!1},d(d){d&&H(e),le(t),le(i),le(u)}}}function L7(r){let e,t,n,i;return e=new lh({props:{loading:r[1]}}),n=new So({props:{$$slots:{map:[E7],sidebar:[k7],top:[w7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&2&&(s.loading=o[1]),e.$set(s);const d={};u&524349&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}let Ed=3,Ld=10;function I7(r,e,t){let n,i,o,u;ct(r,Jm,Z=>t(10,n=Z)),ct(r,Ar,Z=>t(16,i=Z)),ct(r,er,Z=>t(4,o=Z)),ct(r,J0,Z=>t(5,u=Z));let{prevMode:s}=e,d=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],p="",g={type:"FeatureCollection",features:[],max_count:1},_=i.getAllNeighbourhoods();function x(Z){ln(er,o={mode:"impact-detail",road:Z,prevPrevMode:s},o)}async function C(Z){t(1,p="Calculating impact"),await new Promise(X=>{requestAnimationFrame(()=>{requestAnimationFrame(X)})}),t(2,g=i.predictImpact(Z)),t(1,p="")}let M=n?"fast":"accurate";function P(){ln(Jm,n=M=="fast",n)}const A=[[]],L=Z=>x(Z.detail.features[0]);function I(){M=this.__value,t(3,M)}function $(){M=this.__value,t(3,M)}function O(){u=zl(this.value),J0.set(u)}return r.$$set=Z=>{"prevMode"in Z&&t(0,s=Z.prevMode)},r.$$.update=()=>{r.$$.dirty&1024&&C(n)},[s,p,g,M,o,u,d,_,x,P,n,L,I,A,$,O]}class A7 extends Lt{constructor(e){super(),Et(this,e,I7,L7,Tt,{prevMode:0})}}function wb(r){let e,t,n;return t=new On({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("li"),ue(t.$$.fragment)},m(i,o){W(i,e,o),ae(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function P7(r){let e,t,n,i,o,u,s,d,p,g,_,x=_r(r[7].mode)+"",C,M;o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}});let P=r[0]=="neighbourhood"&&wb();return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),P&&P.c(),g=oe(),_=U("li"),C=Ee(x),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(A,L){W(A,e,L),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),P&&P.m(n,null),F(n,g),F(n,_),F(_,C),M=!0},p(A,L){A[0]=="neighbourhood"?P?L&1&&N(P,1):(P=wb(),P.c(),N(P,1),P.m(n,g)):P&&(Xt(),V(P,1,1,()=>{P=null}),Yt()),(!M||L&128)&&x!==(x=_r(A[7].mode)+"")&&St(C,x)},i(A){M||(N(o.$$.fragment,A),N(d.$$.fragment,A),N(P),M=!0)},o(A){V(o.$$.fragment,A),V(d.$$.fragment,A),V(P),M=!1},d(A){A&&H(e),le(o),le(d),P&&P.d()}}}function z7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function D7(r){let e,t=ja(r[6].properties.distance)+"",n,i,o=Ua(r[6].properties.time)+"",u;return{c(){e=U("p"),n=Ee(t),i=Ee(", "),u=Ee(o)},m(s,d){W(s,e,d),F(e,n),F(e,i),F(e,u)},p(s,d){d&64&&t!==(t=ja(s[6].properties.distance)+"")&&St(n,t),d&64&&o!==(o=Ua(s[6].properties.time)+"")&&St(u,o)},d(s){s&&H(e)}}}function R7(r){let e;return{c(){e=U("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function F7(r){let e,t=ja(r[5].properties.distance)+"",n,i,o=Ua(r[5].properties.time)+"",u;return{c(){e=U("p"),n=Ee(t),i=Ee(", "),u=Ee(o)},m(s,d){W(s,e,d),F(e,n),F(e,i),F(e,u)},p(s,d){d&32&&t!==(t=ja(s[5].properties.distance)+"")&&St(n,t),d&32&&o!==(o=Ua(s[5].properties.time)+"")&&St(u,o)},d(s){s&&H(e)}}}function O7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I,$,O,Z;t=new js({props:{mode:{mode:r[0]}}});function X(ie,ve){return ie[6]?D7:z7}let q=X(r),Y=q(r);function fe(ie,ve){return ie[5]?F7:R7}let Le=fe(r),ee=Le(r);return{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("p"),i.textContent="Drag markers for a route",o=oe(),u=U("u"),u.textContent="Route before changes",s=oe(),Y.c(),d=oe(),p=U("u"),p.textContent="Route after changes",g=oe(),ee.c(),_=oe(),x=U("label"),C=Ee("Slow-down factor for main roads: "),M=Ee(r[2]),P=oe(),A=U("input"),L=oe(),I=U("i"),I.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Qe(u,"color","red"),Qe(p,"color","blue"),he(A,"type","range"),he(A,"min","1.0"),he(A,"max","5.0"),he(A,"step","0.1"),he(e,"slot","sidebar")},m(ie,ve){W(ie,e,ve),ae(t,e,null),F(e,n),F(e,i),F(e,o),F(e,u),F(e,s),Y.m(e,null),F(e,d),F(e,p),F(e,g),ee.m(e,null),F(e,_),F(e,x),F(x,C),F(x,M),F(x,P),F(x,A),Zn(A,r[2]),F(e,L),F(e,I),$=!0,O||(Z=[It(A,"change",r[11]),It(A,"input",r[11])],O=!0)},p(ie,ve){const ye={};ve&1&&(ye.mode={mode:ie[0]}),t.$set(ye),q===(q=X(ie))&&Y?Y.p(ie,ve):(Y.d(1),Y=q(ie),Y&&(Y.c(),Y.m(e,d))),Le===(Le=fe(ie))&&ee?ee.p(ie,ve):(ee.d(1),ee=Le(ie),ee&&(ee.c(),ee.m(e,_))),(!$||ve&4)&&St(M,ie[2]),ve&4&&Zn(A,ie[2])},i(ie){$||(N(t.$$.fragment,ie),$=!0)},o(ie){V(t.$$.fragment,ie),$=!1},d(ie){ie&&H(e),le(t),Y.d(),ee.d(),O=!1,cr(Z)}}}function xb(r){let e,t;return e=new fh({props:{$$slots:{default:[$7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function $7(r){let e,t,n,i,o,u,s,d;return e=new yp({}),n=new _p({}),o=new vp({}),s=new ch({props:{interactive:!1}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),W(p,i,g),ae(o,p,g),W(p,u,g),ae(s,p,g),d=!0},p:at,i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(H(t),H(i),H(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function B7(r){let e,t;const n=[_n("compare-route"),{paint:{"line-width":10,"line-color":No(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function N7(r){let e;return{c(){e=Ee("A")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function j7(r){let e;return{c(){e=Ee("B")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function U7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C=r[0]=="neighbourhood"&&xb(r);n=new el({props:{interactive:!1}}),o=new gr({props:{data:r[1],$$slots:{default:[B7]},$$scope:{ctx:r}}});function M(I){r[9](I)}let P={draggable:!0,$$slots:{default:[N7]},$$scope:{ctx:r}};r[4]!==void 0&&(P.lngLat=r[4]),s=new Fl({props:P}),dn.push(()=>Dn(s,"lngLat",M));function A(I){r[10](I)}let L={draggable:!0,$$slots:{default:[j7]},$$scope:{ctx:r}};return r[3]!==void 0&&(L.lngLat=r[3]),g=new Fl({props:L}),dn.push(()=>Dn(g,"lngLat",A)),{c(){e=U("div"),C&&C.c(),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment),p=oe(),ue(g.$$.fragment),he(e,"slot","map")},m(I,$){W(I,e,$),C&&C.m(e,null),F(e,t),ae(n,e,null),F(e,i),ae(o,e,null),F(e,u),ae(s,e,null),F(e,p),ae(g,e,null),x=!0},p(I,$){I[0]=="neighbourhood"?C?$&1&&N(C,1):(C=xb(I),C.c(),N(C,1),C.m(e,t)):C&&(Xt(),V(C,1,1,()=>{C=null}),Yt());const O={};$&2&&(O.data=I[1]),$&4096&&(O.$$scope={dirty:$,ctx:I}),o.$set(O);const Z={};$&4096&&(Z.$$scope={dirty:$,ctx:I}),!d&&$&16&&(d=!0,Z.lngLat=I[4],zn(()=>d=!1)),s.$set(Z);const X={};$&4096&&(X.$$scope={dirty:$,ctx:I}),!_&&$&8&&(_=!0,X.lngLat=I[3],zn(()=>_=!1)),g.$set(X)},i(I){x||(N(C),N(n.$$.fragment,I),N(o.$$.fragment,I),N(s.$$.fragment,I),N(g.$$.fragment,I),x=!0)},o(I){V(C),V(n.$$.fragment,I),V(o.$$.fragment,I),V(s.$$.fragment,I),V(g.$$.fragment,I),x=!1},d(I){I&&H(e),C&&C.d(),le(n),le(o),le(s),le(g)}}}function V7(r){let e,t;return e=new So({props:{$$slots:{map:[U7],sidebar:[O7],top:[P7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&4351&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function q7(r,e,t){let n,i,o,u,s,d,p,g;ct(r,X0,P=>t(2,u=P)),ct(r,Pf,P=>t(3,s=P)),ct(r,Af,P=>t(4,d=P)),ct(r,Ar,P=>t(8,p=P)),ct(r,er,P=>t(7,g=P));let{prevMode:_}=e;Ss(()=>{setTimeout(()=>{eg(Af),eg(Pf)},10)});function x(P){d=P,Af.set(d)}function C(P){s=P,Pf.set(s)}function M(){u=zl(this.value),X0.set(u)}return r.$$set=P=>{"prevMode"in P&&t(0,_=P.prevMode)},r.$$.update=()=>{r.$$.dirty&284&&t(1,n=p.compareRoute(d,s,u)),r.$$.dirty&2&&t(6,i=n.features.find(P=>P.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(P=>P.properties.kind=="after"))},[_,n,u,s,d,o,i,g,p,x,C,M]}class H7 extends Lt{constructor(e){super(),Et(this,e,q7,V7,Tt,{prevMode:0})}}function W7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M=_r(r[2].mode)+"",P,A;return o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}}),_=new On({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Ee(M),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(L,I){W(L,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,P),A=!0},p(L,I){(!A||I&4)&&M!==(M=_r(L[2].mode)+"")&&St(P,M)},i(L){A||(N(o.$$.fragment,L),N(d.$$.fragment,L),N(_.$$.fragment,L),A=!0)},o(L){V(o.$$.fragment,L),V(d.$$.fragment,L),V(_.$$.fragment,L),A=!1},d(L){L&&H(e),le(o),le(d),le(_)}}}function G7(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L,I;t=new js({props:{mode:{mode:"neighbourhood"}}});function $(X){r[8](X)}function O(X){r[9](X)}let Z={map:kr(r[3])};return r[0]!==void 0&&(Z.waypoints=r[0]),r[1]!==void 0&&(Z.drawnShapeOut=r[1]),u=new $2({props:Z}),dn.push(()=>Dn(u,"waypoints",$)),dn.push(()=>Dn(u,"drawnShapeOut",O)),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("h1"),i.textContent="Adjust boundary",o=oe(),ue(u.$$.fragment),p=oe(),g=U("div"),_=U("button"),x=Ee("Finish"),M=oe(),P=U("button"),P.textContent="Cancel",_.disabled=C=r[0].length<3,he(P,"class","secondary"),Qe(g,"display","flex"),Qe(g,"gap","16px"),he(e,"slot","sidebar")},m(X,q){W(X,e,q),ae(t,e,null),F(e,n),F(e,i),F(e,o),ae(u,e,null),F(e,p),F(e,g),F(g,_),F(_,x),F(g,M),F(g,P),A=!0,L||(I=[It(_,"click",r[4]),It(P,"click",r[5])],L=!0)},p(X,q){const Y={};q&8&&(Y.map=kr(X[3])),!s&&q&1&&(s=!0,Y.waypoints=X[0],zn(()=>s=!1)),!d&&q&2&&(d=!0,Y.drawnShapeOut=X[1],zn(()=>d=!1)),u.$set(Y),(!A||q&1&&C!==(C=X[0].length<3))&&(_.disabled=C)},i(X){A||(N(t.$$.fragment,X),N(u.$$.fragment,X),A=!0)},o(X){V(t.$$.fragment,X),V(u.$$.fragment,X),A=!1},d(X){X&&H(e),le(t),le(u),L=!1,cr(I)}}}function Z7(r){let e,t;return e=new So({props:{$$slots:{sidebar:[G7],top:[W7]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&4111&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function K7(r,e,t){let n,i,o;ct(r,er,P=>t(2,n=P)),ct(r,Ar,P=>t(11,i=P)),ct(r,as,P=>t(3,o=P));let{name:u}=e,{existing:s}=e,d=[],p,g=s.properties.waypoints;if(!g){let P={type:"LineString",coordinates:s.geometry.coordinates[1]};g=i.extractWaypointsFromRing(P)}d=g.map(P=>({point:[P.lon,P.lat],snapped:P.snapped}));function _(){if(p)try{i.setCurrentNeighbourhoodBoundary(u,p),qf(),ln(er,n={mode:"neighbourhood"},n)}catch(P){window.alert(`Sorry, this boundary is invalid: ${P}`),x()}}function x(){ln(er,n={mode:"neighbourhood"},n)}function C(P){d=P,t(0,d)}function M(P){p=P,t(1,p)}return r.$$set=P=>{"name"in P&&t(6,u=P.name),"existing"in P&&t(7,s=P.existing)},[d,p,n,o,_,x,u,s,C,M]}class X7 extends Lt{constructor(e){super(),Et(this,e,K7,Z7,Tt,{name:6,existing:7})}}const Y7=["==",["geometry-type"],"Polygon"],J7=["==",["geometry-type"],"LineString"],Q7=["==",["geometry-type"],"Point"];function W2(){return{type:"FeatureCollection",features:[]}}function Um(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:G2(r)}}}function G2(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const Z2=In(W2()),K2=In(0),eD=100;class tD{constructor(e){rr(this,"map");rr(this,"active");rr(this,"eventListenersSuccess");rr(this,"eventListenersUpdated");rr(this,"eventListenersFailure");rr(this,"points");rr(this,"cursor");rr(this,"hover");rr(this,"dragFrom");rr(this,"previousStates");rr(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});rr(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(kb(this.points).forEach((n,i)=>{t.push([i+1,o4(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});rr(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Um(e.lngLat.toArray()),this.onClick(e),this.finish())});rr(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});rr(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});rr(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});rr(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=W2();this.points.forEach((i,o)=>{let u=Um(i);u.properties.hover=this.hover==o,u.properties.idx=o,e.features.push(u)}),e.features=e.features.concat(kb(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),Z2.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,K2.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Um(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(G2),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>eD&&this.previousStates.shift()}}function kb(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function nD(r){let e,t,n;return{c(){e=Ee("Undo ("),t=Ee(r[1]),n=Ee(")")},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o&2&&St(t,i[1])},d(i){i&&(H(e),H(t),H(n))}}}function rD(r){let e;return{c(){e=Ee("Undo")},m(t,n){W(t,e,n)},p:at,d(t){t&&H(e)}}}function iD(r){let e,t,n,i,o,u,s,d,p,g,_;function x(P,A){return P[1]==0?rD:nD}let C=x(r),M=C(r);return{c(){e=U("div"),t=U("button"),t.textContent="Finish",n=oe(),i=U("button"),i.textContent="Cancel",o=oe(),u=U("button"),M.c(),d=oe(),p=U("ul"),p.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,u.disabled=s=r[1]==0,Qe(e,"display","flex"),Qe(e,"justify-content","space-between")},m(P,A){W(P,e,A),F(e,t),F(e,n),F(e,i),F(e,o),F(e,u),M.m(u,null),W(P,d,A),W(P,p,A),g||(_=[It(t,"click",r[2]),It(i,"click",r[3]),It(u,"click",r[4])],g=!0)},p(P,[A]){C===(C=x(P))&&M?M.p(P,A):(M.d(1),M=C(P),M&&(M.c(),M.m(u,null))),A&2&&s!==(s=P[1]==0)&&(u.disabled=s)},i:at,o:at,d(P){P&&(H(e),H(d),H(p)),M.d(),g=!1,cr(_)}}}function oD(r,e,t){let n;ct(r,K2,d=>t(1,n=d));let{polygonTool:i}=e;const o=()=>i.finish(),u=()=>i.cancel(),s=()=>i.undo();return r.$$set=d=>{"polygonTool"in d&&t(0,i=d.polygonTool)},[i,n,o,u,s]}class sD extends Lt{constructor(e){super(),Et(this,e,oD,iD,Tt,{polygonTool:0})}}let aD=Date.now();function hh(r){return`${r}-${aD++}`}const X2=Symbol.for("svelte-maplibre");function lD(){return Qf(X2)}function Sb(r){return{subscribe:r.subscribe}}function Y2({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=lD(),o=In(null),u=Sb(o),s={...i,[r]:Sb(o)};if(e&&(s.popupTarget=u),n){let d=In(null);s.layerEvent=d,i.layerEvent=d}return t&&(s.cluster=In()),rp(X2,s),{...i,self:o}}function uD(){return Y2({key:"source",setCluster:!0})}function cD(r=!0){return Y2({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Tb(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function fD(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function hD(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Cb(r){let e=r[0],t,n,i=Mb(r);return{c(){i.c(),t=tr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&Tt(e,e=o[0])?(Xt(),V(i,1,1,at),Yt(),i=Mb(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function Mb(r){let e;const t=r[36].default,n=vn(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&wn(n,t,i,i[35],e?bn(t,i[35],o,null):xn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function dD(r){let e,t,n=r[0]&&Cb(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=Cb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function pD(r,e,t){let n,i,o,u,s,d,p,g,_,x,C,M,{$$slots:P={},$$scope:A}=e,{id:L=hh("layer")}=e,{source:I=void 0}=e,{sourceLayer:$=void 0}=e,{beforeId:O=void 0}=e,{beforeLayerType:Z=void 0}=e,{type:X}=e,{paint:q=void 0}=e,{layout:Y=void 0}=e,{filter:fe=void 0}=e,{applyToClusters:Le=void 0}=e,{minzoom:ee=void 0}=e,{maxzoom:ie=void 0}=e,{manageHoverState:ve=!1}=e,{hovered:ye=null}=e,{interactive:it=!0}=e,{hoverCursor:Fe=void 0}=e,{eventsIfTopMost:Ne=!1}=e;const Ae=Ns(),{map:ot,source:Ye,self:ut,minzoom:pt,maxzoom:_t,eventTopMost:He,layerInfo:mt}=cD();ct(r,ot,qe=>t(31,_=qe)),ct(r,Ye,qe=>t(32,x=qe)),ct(r,ut,qe=>t(0,g=qe)),ct(r,pt,qe=>t(34,M=qe)),ct(r,_t,qe=>t(33,C=qe)),ri(()=>{g&&_&&(mt.delete(g),_==null||_.removeLayer(g))});let Pt;function jt(qe){var pe,fn;if(!it||!g||!_||Ne&&He(qe)!==g)return;let We=qe.features??[],Ke=(fn=(pe=We[0])==null?void 0:pe.properties)==null?void 0:fn.cluster_id,kt={event:qe,map:_,clusterId:Ke,layer:g,source:s,features:We};Ae(qe.type,kt)}function un(qe){var pe,fn;if(!it||!g||!_||Ne&&He(qe)!==g)return;Fe&&(_.getCanvas().style.cursor=Fe);let We=qe.features??[];t(6,ye=We[0]??null);let Ke=(fn=(pe=We[0])==null?void 0:pe.properties)==null?void 0:fn.cluster_id;Ae("mouseenter",{event:qe,map:_,clusterId:Ke,layer:g,source:s,features:We})}function nn(qe){var pe,fn,Xe;if(!it||!_)return;if(Ne&&He(qe)!==g){t(6,ye=null),ve&&Pt!==void 0&&(_==null||_.setFeatureState({source:s,sourceLayer:$,id:Pt},{hover:!1}),Pt=void 0);return}_.getCanvas().style.cursor=Fe;let We=qe.features??[],Ke=(fn=(pe=We[0])==null?void 0:pe.properties)==null?void 0:fn.cluster_id,kt=(Xe=We[0])==null?void 0:Xe.id;kt!==Pt&&(ve&&(Pt!==void 0&&(_==null||_.setFeatureState({source:s,id:Pt,sourceLayer:$},{hover:!1})),_==null||_.setFeatureState({source:s,id:kt,sourceLayer:$},{hover:!0})),Pt=kt,t(6,ye=We[0]??null)),Ae("mousemove",{event:qe,map:_,clusterId:Ke,layer:g,source:s,features:We})}function rn(qe){if(!(!it||!g||!_)){if(Fe&&(_.getCanvas().style.cursor=""),t(6,ye=null),ve&&Pt!==void 0){const We={source:s,id:Pt,sourceLayer:$};_==null||_.setFeatureState(We,{hover:!1}),Pt=void 0}Ae("mouseleave",{map:_,layer:g,source:s})}}let pn=!0;function yn(qe){_&&(_.off("click",qe,jt),_.off("dblclick",qe,jt),_.off("contextmenu",qe,jt),_.off("mouseenter",qe,un),_.off("mousemove",qe,nn),_.off("mouseleave",qe,rn))}return ri(()=>{_&&g&&yn(g)}),r.$$set=qe=>{"id"in qe&&t(7,L=qe.id),"source"in qe&&t(8,I=qe.source),"sourceLayer"in qe&&t(9,$=qe.sourceLayer),"beforeId"in qe&&t(10,O=qe.beforeId),"beforeLayerType"in qe&&t(11,Z=qe.beforeLayerType),"type"in qe&&t(12,X=qe.type),"paint"in qe&&t(13,q=qe.paint),"layout"in qe&&t(14,Y=qe.layout),"filter"in qe&&t(15,fe=qe.filter),"applyToClusters"in qe&&t(16,Le=qe.applyToClusters),"minzoom"in qe&&t(17,ee=qe.minzoom),"maxzoom"in qe&&t(18,ie=qe.maxzoom),"manageHoverState"in qe&&t(19,ve=qe.manageHoverState),"hovered"in qe&&t(6,ye=qe.hovered),"interactive"in qe&&t(20,it=qe.interactive),"hoverCursor"in qe&&t(21,Fe=qe.hoverCursor),"eventsIfTopMost"in qe&&t(22,Ne=qe.eventsIfTopMost),"$$scope"in qe&&t(35,A=qe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=hD(Le)),r.$$.dirty[0]&1073774592&&t(24,i=fD("all",n,fe)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=ee??M),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=ie??C),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,s=I||x),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&_&&g!==L&&s){g&&(yn(g),mt.delete(g));let qe=O;if(!O&&Z){let We=_.getStyle().layers,Ke=typeof Z=="function"?Z:pe=>pe.type===Z,kt=We==null?void 0:We.find(Ke);kt&&(qe=kt.id)}ln(ut,g=L,g),_.addLayer(Na({id:g,type:X,source:s,"source-layer":$,filter:i,paint:q,layout:Y,minzoom:o,maxzoom:u}),qe),t(23,pn=!0),_.on("click",g,jt),_.on("dblclick",g,jt),_.on("contextmenu",g,jt),_.on("mouseenter",g,un),_.on("mousemove",g,nn),_.on("mouseleave",g,rn)}r.$$.dirty[0]&1048577&&g&&mt.set(g,{interactive:it}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=g?Tb((qe,We)=>_==null?void 0:_.setPaintProperty(g,qe,We)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,p=g?Tb((qe,We)=>_==null?void 0:_.setLayoutProperty(g,qe,We)):void 0),r.$$.dirty[0]&268443648&&(d==null||d(q)),r.$$.dirty[0]&134234112&&(p==null||p(Y)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&g&&(_==null||_.setLayerZoomRange(g,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&g&&(pn?t(23,pn=!1):_==null||_.setFilter(g,i))},[g,ot,Ye,ut,pt,_t,ye,L,I,$,O,Z,X,q,Y,fe,Le,ee,ie,ve,it,Fe,Ne,pn,i,u,o,p,d,s,n,_,x,C,M,A,P]}class c_ extends Lt{constructor(e){super(),Et(this,e,pD,dD,Tt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function mD(r){let e;const t=r[16].default,n=vn(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&wn(n,t,i,i[24],e?bn(t,i[24],o,null):xn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function gD(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[mD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new c_({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.applyToClusters=u[9]),s&1024&&(d.minzoom=u[10]),s&2048&&(d.maxzoom=u[11]),s&4096&&(d.hoverCursor=u[12]),s&8192&&(d.manageHoverState=u[13]),s&16384&&(d.eventsIfTopMost=u[14]),s&32768&&(d.interactive=u[15]),s&16777216&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function _D(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=hh("circle")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:P=void 0}=e,{hoverCursor:A=void 0}=e,{manageHoverState:L=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:$=!1}=e,{interactive:O=!0}=e;function Z(ie){I=ie,t(0,I)}function X(ie){Pn.call(this,r,ie)}function q(ie){Pn.call(this,r,ie)}function Y(ie){Pn.call(this,r,ie)}function fe(ie){Pn.call(this,r,ie)}function Le(ie){Pn.call(this,r,ie)}function ee(ie){Pn.call(this,r,ie)}return r.$$set=ie=>{"id"in ie&&t(1,o=ie.id),"source"in ie&&t(2,u=ie.source),"sourceLayer"in ie&&t(3,s=ie.sourceLayer),"beforeId"in ie&&t(4,d=ie.beforeId),"beforeLayerType"in ie&&t(5,p=ie.beforeLayerType),"paint"in ie&&t(6,g=ie.paint),"layout"in ie&&t(7,_=ie.layout),"filter"in ie&&t(8,x=ie.filter),"applyToClusters"in ie&&t(9,C=ie.applyToClusters),"minzoom"in ie&&t(10,M=ie.minzoom),"maxzoom"in ie&&t(11,P=ie.maxzoom),"hoverCursor"in ie&&t(12,A=ie.hoverCursor),"manageHoverState"in ie&&t(13,L=ie.manageHoverState),"hovered"in ie&&t(0,I=ie.hovered),"eventsIfTopMost"in ie&&t(14,$=ie.eventsIfTopMost),"interactive"in ie&&t(15,O=ie.interactive),"$$scope"in ie&&t(24,i=ie.$$scope)},[I,o,u,s,d,p,g,_,x,C,M,P,A,L,$,O,n,Z,X,q,Y,fe,Le,ee,i]}class yD extends Lt{constructor(e){super(),Et(this,e,_D,gD,Tt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function vD(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function bD(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[vD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new c_({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function wD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=hh("fill")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:A=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:$=!0}=e;function O(ee){L=ee,t(0,L)}function Z(ee){Pn.call(this,r,ee)}function X(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function Y(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Le(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,M=ee.maxzoom),"hoverCursor"in ee&&t(11,P=ee.hoverCursor),"manageHoverState"in ee&&t(12,A=ee.manageHoverState),"hovered"in ee&&t(0,L=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,$=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[L,o,u,s,d,p,g,_,x,C,M,P,A,I,$,n,O,Z,X,q,Y,fe,Le,i]}class xD extends Lt{constructor(e){super(),Et(this,e,wD,bD,Tt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function kD(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const s=()=>{e&&(r.getSource(e)?setTimeout(s,1):u())};s()}else u()}function SD(r,e,t){Xb().then(()=>{let n=gi(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Eb(r){let e=r[0],t,n,i=Lb(r);return{c(){i.c(),t=tr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&Tt(e,e=o[0])?(Xt(),V(i,1,1,at),Yt(),i=Lb(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){V(i),n=!1},d(o){o&&H(t),i.d(o)}}}function Lb(r){let e;const t=r[15].default,n=vn(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&wn(n,t,i,i[14],e?bn(t,i[14],o,null):xn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function TD(r){let e,t,n=r[0]&&Eb(r);return{c(){n&&n.c(),e=tr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Eb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Xt(),V(n,1,1,()=>{n=null}),Yt())},i(i){t||(N(n),t=!0)},o(i){V(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function CD(r,e,t){let n,i,o,{$$slots:u={},$$scope:s}=e,{id:d=hh("geojson")}=e,{data:p}=e,{generateId:g=!1}=e,{promoteId:_=void 0}=e,{filter:x=void 0}=e,{lineMetrics:C=void 0}=e,{cluster:M=void 0}=e;const{map:P,cluster:A,self:L}=uD();ct(r,P,O=>t(13,i=O)),ct(r,A,O=>t(16,o=O)),ct(r,L,O=>t(0,n=O));let I,$=!0;return ri(()=>{n&&I&&i&&(SD(P,n,I),ln(L,n=null,n),t(11,I=void 0))}),r.$$set=O=>{"id"in O&&t(4,d=O.id),"data"in O&&t(5,p=O.data),"generateId"in O&&t(6,g=O.generateId),"promoteId"in O&&t(7,_=O.promoteId),"filter"in O&&t(8,x=O.filter),"lineMetrics"in O&&t(9,C=O.lineMetrics),"cluster"in O&&t(10,M=O.cluster),"$$scope"in O&&t(14,s=O.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&ln(A,o=M,o),r.$$.dirty&12273&&i&&n!==d&&(ln(L,n=d,n),kD(i,n,Na({type:"geojson",data:p,filter:x,lineMetrics:C,generateId:g,promoteId:_,cluster:!!M,clusterMinPoints:M==null?void 0:M.minPoints,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius,clusterProperties:M==null?void 0:M.properties}),O=>i&&O===n,()=>{n&&(t(11,I=i==null?void 0:i.getSource(n)),t(12,$=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,I=i==null?void 0:i.getSource(d))})),r.$$.dirty&6176&&I&&($?t(12,$=!1):I.setData(p)),r.$$.dirty&3072&&(I==null||I.setClusterOptions(Na({cluster:!!M,clusterMaxZoom:M==null?void 0:M.maxZoom,clusterRadius:M==null?void 0:M.radius})))},[n,P,A,L,d,p,g,_,x,C,M,I,$,i,s,u]}class MD extends Lt{constructor(e){super(),Et(this,e,CD,TD,Tt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function ED(r){let e;const t=r[15].default,n=vn(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&wn(n,t,i,i[23],e?bn(t,i[23],o,null):xn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){V(n,i),e=!1},d(i){n&&n.d(i)}}}function LD(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[ED]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new c_({props:o}),dn.push(()=>Dn(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,[s]){const d={};s&2&&(d.id=u[1]),s&4&&(d.source=u[2]),s&8&&(d.sourceLayer=u[3]),s&16&&(d.beforeId=u[4]),s&32&&(d.beforeLayerType=u[5]),s&64&&(d.paint=u[6]),s&128&&(d.layout=u[7]),s&256&&(d.filter=u[8]),s&512&&(d.minzoom=u[9]),s&1024&&(d.maxzoom=u[10]),s&2048&&(d.hoverCursor=u[11]),s&4096&&(d.manageHoverState=u[12]),s&8192&&(d.eventsIfTopMost=u[13]),s&16384&&(d.interactive=u[14]),s&8388608&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.hovered=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function ID(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=hh("line")}=e,{source:u=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:g}=e,{layout:_=void 0}=e,{filter:x=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:A=!1}=e,{hovered:L=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:$=!0}=e;function O(ee){L=ee,t(0,L)}function Z(ee){Pn.call(this,r,ee)}function X(ee){Pn.call(this,r,ee)}function q(ee){Pn.call(this,r,ee)}function Y(ee){Pn.call(this,r,ee)}function fe(ee){Pn.call(this,r,ee)}function Le(ee){Pn.call(this,r,ee)}return r.$$set=ee=>{"id"in ee&&t(1,o=ee.id),"source"in ee&&t(2,u=ee.source),"sourceLayer"in ee&&t(3,s=ee.sourceLayer),"beforeId"in ee&&t(4,d=ee.beforeId),"beforeLayerType"in ee&&t(5,p=ee.beforeLayerType),"paint"in ee&&t(6,g=ee.paint),"layout"in ee&&t(7,_=ee.layout),"filter"in ee&&t(8,x=ee.filter),"minzoom"in ee&&t(9,C=ee.minzoom),"maxzoom"in ee&&t(10,M=ee.maxzoom),"hoverCursor"in ee&&t(11,P=ee.hoverCursor),"manageHoverState"in ee&&t(12,A=ee.manageHoverState),"hovered"in ee&&t(0,L=ee.hovered),"eventsIfTopMost"in ee&&t(13,I=ee.eventsIfTopMost),"interactive"in ee&&t(14,$=ee.interactive),"$$scope"in ee&&t(23,i=ee.$$scope)},[L,o,u,s,d,p,g,_,x,C,M,P,A,I,$,n,O,Z,X,q,Y,fe,Le,i]}class AD extends Lt{constructor(e){super(),Et(this,e,ID,LD,Tt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function PD(r){let e,t,n,i,o,u;return e=new xD({props:{id:"edit-polygon-fill",filter:Y7,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new AD({props:{id:"edit-polygon-lines",filter:J7,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new yD({props:{id:"edit-polygon-vertices",filter:Q7,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment)},m(s,d){ae(e,s,d),W(s,t,d),ae(n,s,d),W(s,i,d),ae(o,s,d),u=!0},p:at,i(s){u||(N(e.$$.fragment,s),N(n.$$.fragment,s),N(o.$$.fragment,s),u=!0)},o(s){V(e.$$.fragment,s),V(n.$$.fragment,s),V(o.$$.fragment,s),u=!1},d(s){s&&(H(t),H(i)),le(e,s),le(n,s),le(o,s)}}}function zD(r){let e,t;return e=new MD({props:{data:r[0],$$slots:{default:[PD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function DD(r,e,t){let n;return ct(r,Z2,i=>t(0,n=i)),[n]}class RD extends Lt{constructor(e){super(),Et(this,e,DD,zD,Tt,{})}}function FD(r){let e,t,n,i,o,u,s;return{c(){e=U("button"),e.textContent="Import current view",t=oe(),n=U("i"),n.textContent="or...",i=oe(),o=U("button"),o.textContent="Draw an area to import on the map",he(e,"type","button"),he(o,"type","button")},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p),W(d,i,p),W(d,o,p),u||(s=[It(e,"click",r[2]),It(o,"click",r[3])],u=!0)},p:at,i:at,o:at,d(d){d&&(H(e),H(t),H(n),H(i),H(o)),u=!1,cr(s)}}}function OD(r){let e,t;return e=new sD({props:{polygonTool:r[0]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function $D(r){let e,t,n,i,o,u,s,d,p;const g=[OD,FD],_=[];function x(C,M){return C[0]?0:1}return e=x(r),t=_[e]=g[e](r),{c(){t.c(),n=oe(),i=U("label"),o=U("input"),u=Ee(`Save a copy of the osm.xml
  after importing`),he(o,"type","checkbox")},m(C,M){_[e].m(C,M),W(C,n,M),W(C,i,M),F(i,o),o.checked=r[1],F(i,u),s=!0,d||(p=It(o,"change",r[5]),d=!0)},p(C,[M]){let P=e;e=x(C),e===P?_[e].p(C,M):(Xt(),V(_[P],1,1,()=>{_[P]=null}),Yt(),t=_[e],t?t.p(C,M):(t=_[e]=g[e](C),t.c()),N(t,1),t.m(n.parentNode,n)),M&2&&(o.checked=C[1])},i(C){s||(N(t),s=!0)},o(C){V(t),s=!1},d(C){C&&(H(n),H(i)),_[e].d(C),d=!1,p()}}}function bf(r){return[r.lng,r.lat]}function BD(r,e,t){let{map:n}=e;const i=Ns();let o=null,u=!1;async function s(x){try{i("loading","Loading from Overpass");let M=await(await fetch(J2(x))).text();u&&ip("osm.xml",M),i("gotXml",{xml:M,boundary:x})}catch(C){i("error",C.toString())}}function d(){let x=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[bf(x.getSouthWest()),bf(x.getNorthWest()),bf(x.getNorthEast()),bf(x.getSouthEast()),bf(x.getSouthWest())]],type:"Polygon"}}}async function p(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await s(d())}}function g(){n&&(t(0,o=new tD(n)),o.startNew(),o.addEventListenerSuccess(async x=>{t(0,o=null),await s(x)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function _(){u=this.checked,t(1,u)}return r.$$set=x=>{"map"in x&&t(4,n=x.map)},[o,u,p,g,n,_]}class ND extends Lt{constructor(e){super(),Et(this,e,BD,$D,Tt,{map:4})}}function J2(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class Q2{constructor(e,t,n,i,o,u,s,d){rr(this,"inner");this.inner=new JI(e,t||new Uint8Array,n||new Uint8Array,i,o,u,s,d)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderNeighbourhood(){let e=JSON.parse(this.inner.renderNeighbourhood());return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setCurrentNeighbourhoodBoundary(e,t){this.inner.setCurrentNeighbourhoodBoundary(e,t)}extractWaypointsFromRing(e){let t=this.inner.extractWaypointsFromRing(e);return JSON.parse(t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}reclassifyRoadsAlongLine(e,t,n){this.inner.reclassifyRoadsAlongLine(e,t,n)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,u]=n;return{count:i,before:o,after:u}})}getAllNeighbourhoods(){return JSON.parse(this.inner.getAllNeighbourhoods())}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=Qy(t.properties.counts_from),t.properties.sum_to=Qy(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}}async function Jf(r){let e=gi(Ga).project(r);try{console.time("get input files");let{osmBuffer:t,demandBuffer:n,contextDataBuffer:i,boundary:o}=await jD(e);console.timeEnd("get input files"),console.time("load"),Ar.set(new Q2(new Uint8Array(t),n?new Uint8Array(n):void 0,i?new Uint8Array(i):void 0,o,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),gi(Ar).loadSavefile(e),Ba.set(r),console.timeEnd("load"),UD(r)}catch(t){window.alert(`Couldn't open project: ${t}`),Ba.set(void 0)}}async function jD(r){if(r.app_focus=="cnt"){console.assert(r.study_area_name,"CNT projects must have a study area name");let e=Bo(`cnt_osm/${r.study_area_name}.osm.pbf`);console.log(`Grabbing ${e}`);let n=await(await Pa(e)).arrayBuffer(),i=Bo(`cnt_boundaries/${r.study_area_name}.geojson`),u=await(await Pa(i)).json(),s=Bo(`cnt_demand/demand_${r.study_area_name}.bin`);console.log(`Grabbing ${s}`);let d;try{d=await(await Pa(s)).arrayBuffer()}catch(_){console.log(`No demand model: ${_}`)}let p=Bo(`cnt_prioritization/context_${r.study_area_name}.bin`);console.log(`Grabbing ${p}`);let g;try{g=await(await Pa(p)).arrayBuffer()}catch(_){console.log(`No context data for prioritization: ${_}`)}return{osmBuffer:n,boundary:u,demandBuffer:d,contextDataBuffer:g}}else if(r.study_area_name){let e=Bo(`severance_pbfs/${r.study_area_name}.pbf`);console.log(`Grabbing ${e}`);let n=await(await Pa(e)).arrayBuffer(),i=Bo(`boundaries/${r.study_area_name}.geojson`),u=await(await Pa(i)).json();return{osmBuffer:n,boundary:u}}else{console.log("Grabbing from Overpass");let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await Pa(J2(e))).arrayBuffer(),boundary:e}}}function UD(r){np.set(new a4(gi(as),gi(Ar).toRouteSnapper(),In(Ji()),In(!0),In(0))),gi(as).fitBounds(gi(Ar).getBounds(),{duration:500});let e=new URL(window.location.href);e.searchParams.set("project",r),window.history.replaceState(null,"",e.toString())}function Ib(r,e,t){const n=r.slice();return n[16]=e[t][0],n[17]=e[t][1],n}function Ab(r,e,t){const n=r.slice();return n[20]=e[t][0],n[21]=e[t][1],n}function VD(r){let e,t,n,i,o,u,s,d=_r(r[5].mode)+"",p,g;return o=new On({props:{mode:{mode:"title"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),p=Ee(d),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(_,x){W(_,e,x),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),F(s,p),g=!0},p(_,x){(!g||x&32)&&d!==(d=_r(_[5].mode)+"")&&St(p,d)},i(_){g||(N(o.$$.fragment,_),g=!0)},o(_){V(o.$$.fragment,_),g=!1},d(_){_&&H(e),le(o)}}}function Pb(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M;e=new lh({props:{loading:r[4]}});let P=$n(r[3]),A=[];for(let L=0;L<P.length;L+=1)A[L]=Db(Ib(r,P,L));return _=new ND({props:{map:r[6]}}),_.$on("gotXml",r[7]),_.$on("loading",r[11]),_.$on("error",r[12]),{c(){ue(e.$$.fragment),t=oe(),n=U("label"),i=Ee(`Load a built-in area:
        `),o=U("select"),u=U("option");for(let L=0;L<A.length;L+=1)A[L].c();s=oe(),d=U("i"),d.textContent="or...",p=oe(),g=U("div"),ue(_.$$.fragment),u.__value="",Zn(u,u.__value),r[2]===void 0&&ys(()=>r[9].call(o))},m(L,I){ae(e,L,I),W(L,t,I),W(L,n,I),F(n,i),F(n,o),F(o,u);for(let $=0;$<A.length;$+=1)A[$]&&A[$].m(o,null);Zi(o,r[2],!0),W(L,s,I),W(L,d,I),W(L,p,I),W(L,g,I),ae(_,g,null),x=!0,C||(M=[It(o,"change",r[9]),It(o,"change",r[10])],C=!0)},p(L,I){const $={};if(I&16&&($.loading=L[4]),e.$set($),I&8){P=$n(L[3]);let Z;for(Z=0;Z<P.length;Z+=1){const X=Ib(L,P,Z);A[Z]?A[Z].p(X,I):(A[Z]=Db(X),A[Z].c(),A[Z].m(o,null))}for(;Z<A.length;Z+=1)A[Z].d(1);A.length=P.length}I&12&&Zi(o,L[2]);const O={};I&64&&(O.map=L[6]),_.$set(O)},i(L){x||(N(e.$$.fragment,L),N(_.$$.fragment,L),x=!0)},o(L){V(e.$$.fragment,L),V(_.$$.fragment,L),x=!1},d(L){L&&(H(t),H(n),H(s),H(d),H(p),H(g)),le(e,L),_i(A,L),le(_),C=!1,cr(M)}}}function zb(r){let e,t=r[21]+"",n,i;return{c(){e=U("option"),n=Ee(t),e.__value=i=r[20],Zn(e,e.__value)},m(o,u){W(o,e,u),F(e,n)},p(o,u){u&8&&t!==(t=o[21]+"")&&St(n,t),u&8&&i!==(i=o[20])&&(e.__value=i,Zn(e,e.__value))},d(o){o&&H(e)}}}function Db(r){let e,t,n=$n(r[17]),i=[];for(let o=0;o<n.length;o+=1)i[o]=zb(Ab(r,n,o));return{c(){e=U("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();he(e,"label",t=r[16])},m(o,u){W(o,e,u);for(let s=0;s<i.length;s+=1)i[s]&&i[s].m(e,null)},p(o,u){if(u&8){n=$n(o[17]);let s;for(s=0;s<n.length;s+=1){const d=Ab(o,n,s);i[s]?i[s].p(d,u):(i[s]=zb(d),i[s].c(),i[s].m(e,null))}for(;s<i.length;s+=1)i[s].d(1);i.length=n.length}u&8&&t!==(t=o[16])&&he(e,"label",t)},d(o){o&&H(e),_i(i,o)}}}function qD(r){let e,t,n,i,o,u,s,d,p,g=r[1]&&Pb(r);return{c(){e=U("div"),t=U("div"),n=U("label"),i=Ee(`Project name:
        `),o=U("input"),u=oe(),g&&g.c(),he(o,"type","text"),he(e,"slot","sidebar")},m(_,x){W(_,e,x),F(e,t),F(t,n),F(n,i),F(n,o),Zn(o,r[1]),F(e,u),g&&g.m(e,null),s=!0,d||(p=It(o,"input",r[8]),d=!0)},p(_,x){x&2&&o.value!==_[1]&&Zn(o,_[1]),_[1]?g?(g.p(_,x),x&2&&N(g,1)):(g=Pb(_),g.c(),N(g,1),g.m(e,null)):g&&(Xt(),V(g,1,1,()=>{g=null}),Yt())},i(_){s||(N(g),s=!0)},o(_){V(g),s=!1},d(_){_&&H(e),g&&g.d(),d=!1,p()}}}function HD(r){let e,t,n;return t=new RD({}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","map")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function WD(r){let e,t;return e=new So({props:{$$slots:{map:[HD],sidebar:[qD],top:[VD]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&16777342&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function GD(r,e,t){let n,i,o,u,s;ct(r,er,$=>t(5,n=$)),ct(r,Ga,$=>t(13,i=$)),ct(r,Ar,$=>t(14,o=$)),ct(r,ks,$=>t(15,u=$)),ct(r,as,$=>t(6,s=$));let d="",p=null,g=[],_="";Ss(async()=>{let $=await Pa(Bo("severance_pbfs/areas.json"));t(3,g=await $.json())});async function x($){t(4,_="Loading OSM");try{let O;ln(Ar,o=new Q2(new TextEncoder().encode($.detail.xml),void 0,void 0,$.detail.boundary,u,O,d,i.dbSchemaVersion),o);const Z=i.createProject(o.toSavefile());await Jf(Z),ln(er,n={mode:"add-neighbourhood"},n)}catch(O){window.alert(`Couldn't import from Overpass: ${O}`)}t(4,_="")}async function C(){if(!p)return;let $;try{$=i.createEmptyProject(d,p)}catch(O){t(2,p=null),window.alert(`Couldn't create project: ${O}`);return}t(4,_=`Loading pre-clipped OSM area ${p}`),await Jf($),ln(er,n={mode:"add-neighbourhood"},n),t(4,_="")}function M(){d=this.value,t(1,d)}function P(){p=Ra(this),t(2,p),t(3,g)}return[C,d,p,g,_,n,s,x,M,P,()=>C(),$=>t(4,_=$.detail),$=>window.alert($.detail)]}class ZD extends Lt{constructor(e){super(),Et(this,e,GD,WD,Tt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const KD="/ltn/assets/boundaries-2701bb3b.geojson";function Rb(r,e,t){const n=r.slice();return n[9]=e[t],n}function XD(r){let e=r[9]+"",t;return{c(){t=Ee(e)},m(n,i){W(n,t,i)},p(n,i){i&2&&e!==(e=n[9]+"")&&St(t,e)},d(n){n&&H(t)}}}function Fb(r){let e,t,n;function i(){return r[5](r[9])}return t=new ah({props:{$$slots:{default:[XD]},$$scope:{ctx:r}}}),t.$on("click",i),{c(){e=U("li"),ue(t.$$.fragment)},m(o,u){W(o,e,u),ae(t,e,null),n=!0},p(o,u){r=o;const s={};u&4098&&(s.$$scope={dirty:u,ctx:r}),t.$set(s)},i(o){n||(N(t.$$.fragment,o),n=!0)},o(o){V(t.$$.fragment,o),n=!1},d(o){o&&H(e),le(t)}}}function YD(r){let e,t,n=r[8].name+"",i;return{c(){e=U("p"),t=Ee("Click to start a new project in "),i=Ee(n)},m(o,u){W(o,e,u),F(e,t),F(e,i)},p(o,u){u&256&&n!==(n=o[8].name+"")&&St(i,n)},d(o){o&&H(e)}}}function JD(r){let e,t;return e=new pi({props:{openOn:"hover",$$slots:{default:[YD,({props:n})=>({8:n}),({props:n})=>n?256:0]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&4352&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function QD(r){let e,t,n,i;return e=new Xi({props:{paint:{"fill-color":vo.mapFeature.hover.backgroundColor,"fill-outline-color":vo.mapFeature.hover.backgroundColor,"fill-opacity":Qn(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[JD]},$$scope:{ctx:r}}}),e.$on("click",r[2]),n=new ur({props:{paint:{"line-color":vo.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u&4096&&(s.$$scope={dirty:u,ctx:o}),e.$set(s)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function eR(r){let e,t,n,i,o,u,s=$n(r[1]),d=[];for(let g=0;g<s.length;g+=1)d[g]=Fb(Rb(r,s,g));const p=g=>V(d[g],1,1,()=>{d[g]=null});return o=new gr({props:{data:r[0],generateId:!0,$$slots:{default:[QD]},$$scope:{ctx:r}}}),{c(){e=U("p"),e.textContent="Choose a boundary below or on the map to begin sketching:",t=oe(),n=U("ul");for(let g=0;g<d.length;g+=1)d[g].c();i=oe(),ue(o.$$.fragment),Qe(n,"columns","3")},m(g,_){W(g,e,_),W(g,t,_),W(g,n,_);for(let x=0;x<d.length;x+=1)d[x]&&d[x].m(n,null);W(g,i,_),ae(o,g,_),u=!0},p(g,[_]){if(_&10){s=$n(g[1]);let C;for(C=0;C<s.length;C+=1){const M=Rb(g,s,C);d[C]?(d[C].p(M,_),N(d[C],1)):(d[C]=Fb(M),d[C].c(),N(d[C],1),d[C].m(n,null))}for(Xt(),C=s.length;C<d.length;C+=1)p(C);Yt()}const x={};_&1&&(x.data=g[0]),_&4096&&(x.$$scope={dirty:_,ctx:g}),o.$set(x)},i(g){if(!u){for(let _=0;_<s.length;_+=1)N(d[_]);N(o.$$.fragment,g),u=!0}},o(g){d=d.filter(Boolean);for(let _=0;_<d.length;_+=1)V(d[_]);V(o.$$.fragment,g),u=!1},d(g){g&&(H(e),H(t),H(n),H(i)),_i(d,g),le(o,g)}}}function tR(r,e,t){let n,i;ct(r,er,_=>t(6,n=_)),ct(r,Ga,_=>t(7,i=_));let{activityIndicatorText:o}=e,u={type:"FeatureCollection",features:[]},s=[];Ss(async()=>{let _=await fetch(KD);t(0,u=await _.json());for(let x of u.features)s.push(x.properties.name);s.sort(),t(1,s)});function d(_){let x=_.detail.features[0].properties;p(`${x.kind}_${x.name}`)}async function p(_){let x,C=!1;for(;!C;){let M=x||i.nextAvailableProjectName($f(_));if(x=window.prompt(`Please pick a project name to create in ${$f(_)}`,M),x===null)return;if(x=x.trim(),x===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}t(4,o=`Loading pre-clipped OSM area ${$f(_)}`);try{let P=i.createEmptyProject(x,_);await Jf(P),ln(er,n={mode:"add-neighbourhood"},n),C=!0}catch(P){window.alert(P)}t(4,o="")}}const g=_=>p(`LAD_${_}`);return r.$$set=_=>{"activityIndicatorText"in _&&t(4,o=_.activityIndicatorText)},[u,s,d,p,o,g]}class nR extends Lt{constructor(e){super(),Et(this,e,tR,eR,Tt,{activityIndicatorText:4})}}function rR(r){let e,t,n,i,o,u;return{c(){e=U("label"),t=U("strong"),t.textContent="Load a project from a file",n=oe(),i=U("input"),he(i,"type","file"),Qe(e,"margin-top","16px")},m(s,d){W(s,e,d),F(e,t),F(e,n),F(e,i),r[3](i),o||(u=It(i,"change",r[1]),o=!0)},p:at,i:at,o:at,d(s){s&&H(e),r[3](null),o=!1,u()}}}function iR(r,e,t){let n;ct(r,er,d=>t(4,n=d));let{loading:i}=e,o;async function u(d){let p=o.files[0].name;t(2,i=`Loading from file ${p}`);let g=await o.files[0].text(),_=JSON.parse(g),x,C,M;_.app_focus&&(console.assert(_.app_focus=="global"||_.app_focus=="cnt"),x=_.app_focus),_.study_area_name&&(C=_.study_area_name),_.project_name&&(M=_.project_name),(!_.app_focus||!_.project_name)&&(_.study_area_name&&_.study_area_name.startsWith("LAD_")?(x="cnt",M=e1(cg(p,`ltn_cnt_${_.study_area_name}_`),".geojson")):(x="global",M=e1(cg(p,"ltn_"),".geojson"))),M=M,x=x;let P=vw.projectStorage(x);M=P.nextAvailableProjectName(M),_.project_name=M,_.app_focus=x,_.study_area_name=C;let A=P.createProject(_);await Jf(A),ln(er,n={mode:"pick-neighbourhood"},n),t(2,i="")}function s(d){dn[d?"unshift":"push"](()=>{o=d,t(0,o)})}return r.$$set=d=>{"loading"in d&&t(2,i=d.loading)},[o,u,i,s]}class oR extends Lt{constructor(e){super(),Et(this,e,iR,rR,Tt,{loading:2})}}function Ob(r,e,t){const n=r.slice();return n[22]=e[t][0],n[23]=e[t][1],n}function $b(r,e,t){const n=r.slice();return n[26]=e[t].projectID,n[27]=e[t].projectName,n}function sR(r){let e,t,n,i,o=_r(r[3].mode)+"",u;return{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),u=Ee(o),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(s,d){W(s,e,d),F(e,t),F(t,n),F(n,i),F(i,u)},p(s,d){d&8&&o!==(o=_r(s[3].mode)+"")&&St(u,o)},d(s){s&&H(e)}}}function aR(r){let e;return{c(){e=U("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){W(t,e,n)},p:at,i:at,o:at,d(t){t&&H(e)}}}function lR(r){let e,t,n,i,o,u,s,d,p,g=r[2].length>0&&Bb(r);const _=[fR,cR],x=[];function C(A,L){return A[5]=="global"?0:A[5]=="cnt"?1:-1}~(i=C(r))&&(o=x[i]=_[i](r));function M(A){r[15](A)}let P={};return r[1]!==void 0&&(P.loading=r[1]),s=new oR({props:P}),dn.push(()=>Dn(s,"loading",M)),{c(){g&&g.c(),e=oe(),t=U("h1"),t.textContent="Start a new project",n=oe(),o&&o.c(),u=oe(),ue(s.$$.fragment)},m(A,L){g&&g.m(A,L),W(A,e,L),W(A,t,L),W(A,n,L),~i&&x[i].m(A,L),W(A,u,L),ae(s,A,L),p=!0},p(A,L){A[2].length>0?g?(g.p(A,L),L&4&&N(g,1)):(g=Bb(A),g.c(),N(g,1),g.m(e.parentNode,e)):g&&(Xt(),V(g,1,1,()=>{g=null}),Yt());let I=i;i=C(A),i===I?~i&&x[i].p(A,L):(o&&(Xt(),V(x[I],1,1,()=>{x[I]=null}),Yt()),~i?(o=x[i],o?o.p(A,L):(o=x[i]=_[i](A),o.c()),N(o,1),o.m(u.parentNode,u)):o=null);const $={};!d&&L&2&&(d=!0,$.loading=A[1],zn(()=>d=!1)),s.$set($)},i(A){p||(N(g),N(o),N(s.$$.fragment,A),p=!0)},o(A){V(g),V(o),V(s.$$.fragment,A),p=!1},d(A){A&&(H(e),H(t),H(n),H(u)),g&&g.d(A),~i&&x[i].d(A),le(s,A)}}}function Bb(r){let e,t,n,i,o=$n(r[2]),u=[];for(let d=0;d<o.length;d+=1)u[d]=jb(Ob(r,o,d));const s=d=>V(u[d],1,1,()=>{u[d]=null});return{c(){e=U("h1"),e.textContent="Your projects",t=oe(),n=U("div");for(let d=0;d<u.length;d+=1)u[d].c();he(n,"class","project-list svelte-s5f8l2")},m(d,p){W(d,e,p),W(d,t,p),W(d,n,p);for(let g=0;g<u.length;g+=1)u[g]&&u[g].m(n,null);i=!0},p(d,p){if(p&452){o=$n(d[2]);let g;for(g=0;g<o.length;g+=1){const _=Ob(d,o,g);u[g]?(u[g].p(_,p),N(u[g],1)):(u[g]=jb(_),u[g].c(),N(u[g],1),u[g].m(n,null))}for(Xt(),g=o.length;g<u.length;g+=1)s(g);Yt()}},i(d){if(!i){for(let p=0;p<o.length;p+=1)N(u[p]);i=!0}},o(d){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)V(u[p]);i=!1},d(d){d&&(H(e),H(t),H(n)),_i(u,d)}}}function uR(r){let e=r[27]+"",t;return{c(){t=Ee(e)},m(n,i){W(n,t,i)},p(n,i){i&4&&e!==(e=n[27]+"")&&St(t,e)},d(n){n&&H(t)}}}function Nb(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A;function L(){return r[9](r[26],r[27])}n=new ah({props:{$$slots:{default:[uR]},$$scope:{ctx:r}}}),n.$on("click",L),s=new bw({props:{color:"black"}});function I(){return r[10](r[26])}g=new Ug({props:{color:"black"}});function $(){return r[11](r[26],r[27])}C=new Vg({props:{color:"white"}});function O(){return r[12](r[26],r[27])}return{c(){e=U("li"),t=U("h3"),ue(n.$$.fragment),i=oe(),o=U("span"),u=U("button"),ue(s.$$.fragment),d=oe(),p=U("button"),ue(g.$$.fragment),_=oe(),x=U("button"),ue(C.$$.fragment),he(u,"class","outline icon-btn"),he(u,"title","Download project as GeoJSON"),he(p,"class","outline icon-btn"),he(p,"title","Rename project"),he(x,"class","icon-btn destructive"),he(x,"title","Delete project"),he(o,"class","actions"),he(e,"class","actionable-cell svelte-s5f8l2")},m(Z,X){W(Z,e,X),F(e,t),ae(n,t,null),F(e,i),F(e,o),F(o,u),ae(s,u,null),F(o,d),F(o,p),ae(g,p,null),F(o,_),F(o,x),ae(C,x,null),M=!0,P||(A=[It(u,"click",I),It(p,"click",$),It(x,"click",O)],P=!0)},p(Z,X){r=Z;const q={};X&1073741828&&(q.$$scope={dirty:X,ctx:r}),n.$set(q)},i(Z){M||(N(n.$$.fragment,Z),N(s.$$.fragment,Z),N(g.$$.fragment,Z),N(C.$$.fragment,Z),M=!0)},o(Z){V(n.$$.fragment,Z),V(s.$$.fragment,Z),V(g.$$.fragment,Z),V(C.$$.fragment,Z),M=!1},d(Z){Z&&H(e),le(n),le(s),le(g),le(C),P=!1,cr(A)}}}function jb(r){let e,t=$f(r[22])+"",n,i,o,u,s,d=$n(r[23]),p=[];for(let _=0;_<d.length;_+=1)p[_]=Nb($b(r,d,_));const g=_=>V(p[_],1,1,()=>{p[_]=null});return{c(){e=U("h2"),n=Ee(t),i=oe(),o=U("ul");for(let _=0;_<p.length;_+=1)p[_].c();u=oe(),he(e,"class","study-area-name svelte-s5f8l2"),he(o,"class","navigable-list")},m(_,x){W(_,e,x),F(e,n),W(_,i,x),W(_,o,x);for(let C=0;C<p.length;C+=1)p[C]&&p[C].m(o,null);F(o,u),s=!0},p(_,x){if((!s||x&4)&&t!==(t=$f(_[22])+"")&&St(n,t),x&452){d=$n(_[23]);let C;for(C=0;C<d.length;C+=1){const M=$b(_,d,C);p[C]?(p[C].p(M,x),N(p[C],1)):(p[C]=Nb(M),p[C].c(),N(p[C],1),p[C].m(o,u))}for(Xt(),C=d.length;C<p.length;C+=1)g(C);Yt()}},i(_){if(!s){for(let x=0;x<d.length;x+=1)N(p[x]);s=!0}},o(_){p=p.filter(Boolean);for(let x=0;x<p.length;x+=1)V(p[x]);s=!1},d(_){_&&(H(e),H(i),H(o)),_i(p,_)}}}function cR(r){let e,t,n;function i(u){r[14](u)}let o={};return r[1]!==void 0&&(o.activityIndicatorText=r[1]),e=new nR({props:o}),dn.push(()=>Dn(e,"activityIndicatorText",i)),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const d={};!t&&s&2&&(t=!0,d.activityIndicatorText=u[1],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function fR(r){let e,t,n;return{c(){e=U("button"),e.textContent="New project"},m(i,o){W(i,e,o),t||(n=It(e,"click",r[13]),t=!0)},p:at,i:at,o:at,d(i){i&&H(e),t=!1,n()}}}function hR(r){let e,t,n,i;const o=[lR,aR],u=[];function s(d,p){return d[4]&&d[0]?0:1}return t=s(r),n=u[t]=o[t](r),{c(){e=U("div"),n.c(),he(e,"slot","sidebar")},m(d,p){W(d,e,p),u[t].m(e,null),i=!0},p(d,p){let g=t;t=s(d),t===g?u[t].p(d,p):(Xt(),V(u[g],1,1,()=>{u[g]=null}),Yt(),n=u[t],n?n.p(d,p):(n=u[t]=o[t](d),n.c()),N(n,1),n.m(e,null))},i(d){i||(N(n),i=!0)},o(d){V(n),i=!1},d(d){d&&H(e),u[t].d()}}}function dR(r){let e,t,n,i;return e=new lh({props:{loading:r[1]}}),n=new So({props:{$$slots:{sidebar:[hR],top:[sR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,[u]){const s={};u&2&&(s.loading=o[1]),e.$set(s);const d={};u&1073741887&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function pR(r,e,t){let n,i,o,u,s,d,p,g;ct(r,er,fe=>t(3,n=fe)),ct(r,Ga,fe=>t(16,i=fe)),ct(r,as,fe=>t(4,o=fe)),ct(r,ks,fe=>t(5,u=fe)),ct(r,K0,fe=>t(17,s=fe)),ct(r,Ba,fe=>t(18,d=fe)),ct(r,np,fe=>t(19,p=fe)),ct(r,Ar,fe=>t(20,g=fe));let{wasmReady:_}=e,x="";if(ln(Ar,g=null,g),ln(np,p=null,p),ln(Ba,d=void 0,d),s){let Le=new URLSearchParams(window.location.search).get("project");Le&&M(Le),ln(K0,s=!1,s)}else{let fe=new URL(window.location.href);fe.searchParams.delete("project"),window.history.replaceState(null,"",fe.toString())}if(o&&!s){let fe=[-180,-90,180,90];u=="cnt"&&(fe=[-8.943,54.631,-.901,59.489]),o.fitBounds(fe,{duration:500})}let C=i.studyAreaProjects();function M(fe){let Le=fe;try{let ee=i.projectName(Le);if(!ee){console.error(`Project ${Le} from URL not found`);return}L(Le,ee)}catch{console.error(`Error trying to fetch project from URL: ${Le}`)}}function P(fe,Le){window.confirm(`Really delete project ${Le}? You can't undo this.`)&&(i.removeProject(fe),t(2,C=i.studyAreaProjects()))}function A(fe,Le){let ee=window.prompt(`Rename project ${Le} to what?`,Le);if(ee){try{i.renameProject(fe,ee)}catch(ie){window.alert(`Couldn't rename project: ${ie}`)}t(2,C=i.studyAreaProjects())}}async function L(fe,Le){t(1,x=`Loading project ${Le}`),await Jf(fe),ln(er,n={mode:"pick-neighbourhood"},n),t(1,x="")}const I=(fe,Le)=>L(fe,Le),$=fe=>_2(fe),O=(fe,Le)=>A(fe,Le),Z=(fe,Le)=>P(fe,Le),X=()=>ln(er,n={mode:"new-project"},n);function q(fe){x=fe,t(1,x)}function Y(fe){x=fe,t(1,x)}return r.$$set=fe=>{"wasmReady"in fe&&t(0,_=fe.wasmReady)},[_,x,C,n,o,u,P,A,L,I,$,O,Z,X,q,Y]}class mR extends Lt{constructor(e){super(),Et(this,e,pR,dR,Tt,{wasmReady:0})}}function gR(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M=_r(r[1].mode)+"",P,A;return o=new On({props:{mode:{mode:"title"}}}),d=new On({props:{mode:{mode:"pick-neighbourhood"}}}),_=new On({props:{mode:{mode:"neighbourhood"}}}),{c(){e=U("div"),t=U("nav"),n=U("ul"),i=U("li"),ue(o.$$.fragment),u=oe(),s=U("li"),ue(d.$$.fragment),p=oe(),g=U("li"),ue(_.$$.fragment),x=oe(),C=U("li"),P=Ee(M),he(t,"aria-label","breadcrumb"),he(e,"slot","top")},m(L,I){W(L,e,I),F(e,t),F(t,n),F(n,i),ae(o,i,null),F(n,u),F(n,s),ae(d,s,null),F(n,p),F(n,g),ae(_,g,null),F(n,x),F(n,C),F(C,P),A=!0},p(L,I){(!A||I&2)&&M!==(M=_r(L[1].mode)+"")&&St(P,M)},i(L){A||(N(o.$$.fragment,L),N(d.$$.fragment,L),N(_.$$.fragment,L),A=!0)},o(L){V(o.$$.fragment,L),V(d.$$.fragment,L),V(_.$$.fragment,L),A=!1},d(L){L&&H(e),le(o),le(d),le(_)}}}function _R(r){let e,t,n,i,o,u,s,d,p,g,_=kr(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",x,C,M,P,A,L;function I(O){r[4](O)}let $={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&($.idx=r[0].shortcutIndex),o=new cp({props:$}),dn.push(()=>Dn(o,"idx",I)),{c(){e=U("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=oe(),n=U("button"),n.textContent="Pick a different road",i=oe(),ue(o.$$.fragment),s=oe(),d=U("p"),p=Ee("This shortcut is "),g=U("b"),x=Ee(_),C=Ee("x"),M=Ee(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(O,Z){W(O,e,Z),W(O,t,Z),W(O,n,Z),W(O,i,Z),ae(o,O,Z),W(O,s,Z),W(O,d,Z),F(d,p),F(d,g),F(g,x),F(g,C),F(d,M),P=!0,A||(L=It(n,"click",r[3]),A=!0)},p(O,Z){const X={};Z&1&&(X.list=O[0].gj.features),!u&&Z&1&&(u=!0,X.idx=O[0].shortcutIndex,zn(()=>u=!1)),o.$set(X),(!P||Z&1)&&_!==(_=kr(O[0].gj.features[O[0].shortcutIndex].properties).directness.toFixed(1)+"")&&St(x,_)},i(O){P||(N(o.$$.fragment,O),P=!0)},o(O){V(o.$$.fragment,O),P=!1},d(O){O&&(H(e),H(t),H(n),H(i),H(s),H(d)),le(o,O),A=!1,L()}}}function yR(r){let e;return{c(){e=U("p"),e.textContent="Click a road to see shortcuts"},m(t,n){W(t,e,n)},p:at,i:at,o:at,d(t){t&&H(e)}}}function vR(r){let e,t,n,i,o,u;t=new js({props:{mode:{mode:"neighbourhood"}}});const s=[yR,_R],d=[];function p(g,_){return g[0].state=="neutral"?0:g[0].state=="chose-road"?1:-1}return~(i=p(r))&&(o=d[i]=s[i](r)),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),o&&o.c(),he(e,"slot","sidebar")},m(g,_){W(g,e,_),ae(t,e,null),F(e,n),~i&&d[i].m(e,null),u=!0},p(g,_){let x=i;i=p(g),i===x?~i&&d[i].p(g,_):(o&&(Xt(),V(d[x],1,1,()=>{d[x]=null}),Yt()),~i?(o=d[i],o?o.p(g,_):(o=d[i]=s[i](g),o.c()),N(o,1),o.m(e,null)):o=null)},i(g){u||(N(t.$$.fragment,g),N(o),u=!0)},o(g){V(t.$$.fragment,g),V(o),u=!1},d(g){g&&H(e),le(t),~i&&d[i].d()}}}function bR(r){let e,t;return e=new ch({props:{interactive:!1}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function wR(r){let e,t;return e=new ch({props:{onClickLine:r[2],$$slots:{"line-popup":[TR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function xR(r){let e,t,n=(r[6].name??"unnamed road")+"",i;return{c(){e=U("p"),t=Ee("Main road: "),i=Ee(n)},m(o,u){W(o,e,u),F(e,t),F(e,i)},p(o,u){u&64&&n!==(n=(o[6].name??"unnamed road")+"")&&St(i,n)},d(o){o&&H(e)}}}function kR(r){let e,t=r[6].shortcuts+"",n,i,o=(r[6].name??"unnamed road")+"",u;return{c(){e=U("p"),n=Ee(t),i=Ee(" shortcuts through "),u=Ee(o)},m(s,d){W(s,e,d),F(e,n),F(e,i),F(e,u)},p(s,d){d&64&&t!==(t=s[6].shortcuts+"")&&St(n,t),d&64&&o!==(o=(s[6].name??"unnamed road")+"")&&St(u,o)},d(s){s&&H(e)}}}function SR(r){let e;function t(o,u){if(o[6].kind=="interior_road")return kR;if(o[6].kind=="main_road")return xR}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=tr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i&&i.d(o)}}}function TR(r){let e,t,n;return t=new pi({props:{openOn:"hover",$$slots:{default:[SR,({props:i})=>({6:i}),({props:i})=>i?64:0]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"slot","line-popup")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p(i,o){const u={};o&192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function CR(r){let e,t,n,i,o,u,s,d,p,g;e=new yp({}),n=new _p({}),o=new vp({});const _=[wR,bR],x=[];function C(M,P){return M[0].state=="neutral"?0:M[0].state=="chose-road"?1:-1}return~(s=C(r))&&(d=x[s]=_[s](r)),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),d&&d.c(),p=tr()},m(M,P){ae(e,M,P),W(M,t,P),ae(n,M,P),W(M,i,P),ae(o,M,P),W(M,u,P),~s&&x[s].m(M,P),W(M,p,P),g=!0},p(M,P){let A=s;s=C(M),s===A?~s&&x[s].p(M,P):(d&&(Xt(),V(x[A],1,1,()=>{x[A]=null}),Yt()),~s?(d=x[s],d?d.p(M,P):(d=x[s]=_[s](M),d.c()),N(d,1),d.m(p.parentNode,p)):d=null)},i(M){g||(N(e.$$.fragment,M),N(n.$$.fragment,M),N(o.$$.fragment,M),N(d),g=!0)},o(M){V(e.$$.fragment,M),V(n.$$.fragment,M),V(o.$$.fragment,M),V(d),g=!1},d(M){M&&(H(t),H(i),H(u),H(p)),le(e,M),le(n,M),le(o,M),~s&&x[s].d(M)}}}function Ub(r){let e,t,n,i,o,u,s,d;return e=new gr({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[MR]},$$scope:{ctx:r}}}),n=new gr({props:{data:r[0].roadGj,$$slots:{default:[ER]},$$scope:{ctx:r}}}),o=new Fl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[LR]},$$scope:{ctx:r}}}),s=new Fl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[IR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment),i=oe(),ue(o.$$.fragment),u=oe(),ue(s.$$.fragment)},m(p,g){ae(e,p,g),W(p,t,g),ae(n,p,g),W(p,i,g),ae(o,p,g),W(p,u,g),ae(s,p,g),d=!0},p(p,g){const _={};g&1&&(_.data=p[0].gj.features[p[0].shortcutIndex]),g&128&&(_.$$scope={dirty:g,ctx:p}),e.$set(_);const x={};g&1&&(x.data=p[0].roadGj),g&128&&(x.$$scope={dirty:g,ctx:p}),n.$set(x);const C={};g&1&&(C.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[0]),g&128&&(C.$$scope={dirty:g,ctx:p}),o.$set(C);const M={};g&1&&(M.lngLat=p[0].gj.features[p[0].shortcutIndex].geometry.coordinates[p[0].gj.features[p[0].shortcutIndex].geometry.coordinates.length-1]),g&128&&(M.$$scope={dirty:g,ctx:p}),s.$set(M)},i(p){d||(N(e.$$.fragment,p),N(n.$$.fragment,p),N(o.$$.fragment,p),N(s.$$.fragment,p),d=!0)},o(p){V(e.$$.fragment,p),V(n.$$.fragment,p),V(o.$$.fragment,p),V(s.$$.fragment,p),d=!1},d(p){p&&(H(t),H(i),H(u)),le(e,p),le(n,p),le(o,p),le(s,p)}}}function MR(r){let e,t;const n=[_n("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function ER(r){let e,t;const n=[_n("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new ur({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function LR(r){let e;return{c(){e=Ee("A")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function IR(r){let e;return{c(){e=Ee("B")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function AR(r){let e,t,n,i,o,u;t=new fh({props:{$$slots:{default:[CR]},$$scope:{ctx:r}}});let s=r[0].state=="chose-road"&&Ub(r);return o=new el({props:{interactive:!1}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),s&&s.c(),i=oe(),ue(o.$$.fragment),he(e,"slot","map")},m(d,p){W(d,e,p),ae(t,e,null),F(e,n),s&&s.m(e,null),F(e,i),ae(o,e,null),u=!0},p(d,p){const g={};p&129&&(g.$$scope={dirty:p,ctx:d}),t.$set(g),d[0].state=="chose-road"?s?(s.p(d,p),p&1&&N(s,1)):(s=Ub(d),s.c(),N(s,1),s.m(e,i)):s&&(Xt(),V(s,1,1,()=>{s=null}),Yt())},i(d){u||(N(t.$$.fragment,d),N(s),N(o.$$.fragment,d),u=!0)},o(d){V(t.$$.fragment,d),V(s),V(o.$$.fragment,d),u=!1},d(d){d&&H(e),le(t),s&&s.d(),le(o)}}}function PR(r){let e,t;return e=new So({props:{$$slots:{map:[AR],sidebar:[vR],top:[gR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,[i]){const o={};i&131&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function zR(r,e,t){let n,i;ct(r,Ar,p=>t(5,n=p)),ct(r,er,p=>t(1,i=p));let o={state:"neutral"};function u(p,g){let _=n.getShortcutsCrossingRoad(p.properties.id);if(_.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:p,gj:_,shortcutIndex:0})}const s=()=>t(0,o={state:"neutral"});function d(p){r.$$.not_equal(o.shortcutIndex,p)&&(o.shortcutIndex=p,t(0,o))}return[o,i,u,s,d]}class DR extends Lt{constructor(e){super(),Et(this,e,zR,PR,Tt,{})}}function RR(r){let e,t,n,i,o,u;return{c(){e=U("div"),t=U("button"),t.innerHTML=`<img src="${a3}" style="height: 32px;" alt="A/B Street logo"/>`,n=oe(),i=U("span"),he(t,"class","outline"),Qe(i,"width","100%"),he(e,"slot","top"),he(e,"class","pico"),Qe(e,"display","flex"),Qe(e,"align-items","center"),Qe(e,"gap","8px")},m(s,d){W(s,e,d),F(e,t),F(e,n),F(e,i),r[24](i),o||(u=It(t,"click",r[23]),o=!0)},p:at,d(s){s&&H(e),r[24](null),o=!1,u()}}}function FR(r){let e,t;return{c(){e=U("div"),t=U("div"),he(e,"class","pico"),he(e,"slot","left")},m(n,i){W(n,e,i),F(e,t),r[22](t)},p:at,d(n){n&&H(e),r[22](null)}}}function OR(r){return{c:at,m:at,p:at,i:at,o:at,d:at}}function $R(r){let e,t,n;function i(u){r[20](u)}let o={style:r[27],hash:!0,bounds:r[5],maxZoom:19,images:[{id:co.walkCycleOnly.filterType,url:co.walkCycleOnly.iconURL},{id:co.noEntry.filterType,url:co.noEntry.iconURL},{id:co.busGate.filterType,url:co.busGate.iconURL},{id:co.schoolStreet.filterType,url:co.schoolStreet.iconURL},{id:"diagonal_filter",url:"/ltn//filters/diagonal_filter_icon.png"},{id:"no_straight_turn",url:"/ltn//filters/no_straight_turn.png"},{id:"no_left_turn",url:"/ltn//filters/no_left_turn.png"},{id:"no_right_turn",url:"/ltn//filters/no_right_turn.png"},{id:"no_u_left_to_right_turn",url:"/ltn//filters/no_u_left_to_right_turn.png"},{id:"no_u_right_to_left_turn",url:"/ltn//filters/no_u_right_to_left_turn.png"},{id:"oneway_arrow",url:s3},{id:"border_entry_arrow",url:o3,options:{sdf:!0}},{id:"national_rail",url:Yb}],$$slots:{default:[oF]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.map=r[0]),e=new w5({props:o}),dn.push(()=>Dn(e,"map",i)),e.$on("error",r[21]),{c(){ue(e.$$.fragment)},m(u,s){ae(e,u,s),n=!0},p(u,s){const d={};s&512&&(d.style=u[27]),s&32&&(d.bounds=u[5]),s&268437209&&(d.$$scope={dirty:s,ctx:u}),!t&&s&1&&(t=!0,d.map=u[0],zn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){V(e.$$.fragment,u),n=!1},d(u){le(e,u)}}}function Vb(r){let e,t,n,i;return e=new tg({props:{position:"top-left",$$slots:{default:[jR]},$$scope:{ctx:r}}}),n=new tg({props:{position:"top-left",$$slots:{default:[VR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment),t=oe(),ue(n.$$.fragment)},m(o,u){ae(e,o,u),W(o,t,u),ae(n,o,u),i=!0},p(o,u){const s={};u&268435456&&(s.$$scope={dirty:u,ctx:o}),e.$set(s);const d={};u&268436096&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){V(e.$$.fragment,o),V(n.$$.fragment,o),i=!1},d(o){o&&H(t),le(e,o),le(n,o)}}}function BR(r){let e,t,n;return t=new J4({}),{c(){e=U("div"),ue(t.$$.fragment),he(e,"class","ltn-map-btn zoom-to-fit-btn")},m(i,o){W(i,e,o),ae(t,e,null),n=!0},p:at,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){V(t.$$.fragment,i),n=!1},d(i){i&&H(e),le(t)}}}function NR(r){let e,t;return e=new Tw({props:{title:"Zoom to fit study area",$$slots:{default:[BR]},$$scope:{ctx:r}}}),e.$on("click",r[18]),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function jR(r){let e,t;return e=new Cw({props:{$$slots:{default:[NR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268435456&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function UR(r){let e,t;return e=new DM({props:{map:kr(r[7]),maptilerBasemap:r[9]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.map=kr(n[7])),i&512&&(o.maptilerBasemap=n[9]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function VR(r){let e,t;return e=new Cw({props:{$$slots:{default:[UR]},$$scope:{ctx:r}}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&268436096&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function qR(r){let e,t;return e=new ZD({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function HR(r){let e,t;return e=new mR({props:{wasmReady:r[4]}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&16&&(o.wasmReady=n[4]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function qb(r){let e,t,n,i,o,u;e=new gr({props:{data:r[6].getInvertedBoundary(),$$slots:{default:[WR]},$$scope:{ctx:r}}});const s=[iF,rF,nF,tF,eF,QR,JR,YR,XR,KR,ZR,GR],d=[];function p(g,_){return g[10].mode=="pick-neighbourhood"?0:g[10].mode=="set-boundary"?1:g[10].mode=="add-neighbourhood"?2:g[10].mode=="neighbourhood"?3:g[10].mode=="view-shortcuts"?4:g[10].mode=="impact-one-destination"?5:g[10].mode=="route"?6:g[10].mode=="predict-impact"?7:g[10].mode=="impact-detail"?8:g[10].mode=="debug-neighbourhood"?9:g[10].mode=="debug-intersections"?10:g[10].mode=="debug-demand"?11:-1}return~(n=p(r))&&(i=d[n]=s[n](r)),{c(){ue(e.$$.fragment),t=oe(),i&&i.c(),o=tr()},m(g,_){ae(e,g,_),W(g,t,_),~n&&d[n].m(g,_),W(g,o,_),u=!0},p(g,_){const x={};_&64&&(x.data=g[6].getInvertedBoundary()),_&268435456&&(x.$$scope={dirty:_,ctx:g}),e.$set(x);let C=n;n=p(g),n===C?~n&&d[n].p(g,_):(i&&(Xt(),V(d[C],1,1,()=>{d[C]=null}),Yt()),~n?(i=d[n],i?i.p(g,_):(i=d[n]=s[n](g),i.c()),N(i,1),i.m(o.parentNode,o)):i=null)},i(g){u||(N(e.$$.fragment,g),N(i),u=!0)},o(g){V(e.$$.fragment,g),V(i),u=!1},d(g){g&&(H(t),H(o)),le(e,g),~n&&d[n].d(g)}}}function WR(r){let e,t;const n=[_n("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=zt(i,n[o]);return e=new Xi({props:i}),{c(){ue(e.$$.fragment)},m(o,u){ae(e,o,u),t=!0},p(o,u){const s={};e.$set(s)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){V(e.$$.fragment,o),t=!1},d(o){le(e,o)}}}function GR(r){let e,t;return e=new p8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function ZR(r){let e,t;return e=new x8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function KR(r){let e,t;return e=new dP({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function XR(r){let e,t;return e=new Nz({props:{road:r[10].road,prevPrevMode:r[10].prevPrevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.road=n[10].road),i&1024&&(o.prevPrevMode=n[10].prevPrevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function YR(r){let e,t;return e=new A7({props:{prevMode:r[10].prevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function JR(r){let e,t;return e=new H7({props:{prevMode:r[10].prevMode}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.prevMode=n[10].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function QR(r){let e,t;return e=new i7({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function eF(r){let e,t;return e=new DR({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function tF(r){let e,t;return e=new Az({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function nF(r){let e,t;return e=new o8({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function rF(r){let e,t;return e=new X7({props:{name:r[10].name,existing:r[10].existing}}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p(n,i){const o={};i&1024&&(o.name=n[10].name),i&1024&&(o.existing=n[10].existing),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function iF(r){let e,t;return e=new b7({}),{c(){ue(e.$$.fragment)},m(n,i){ae(e,n,i),t=!0},p:at,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){V(e.$$.fragment,n),t=!1},d(n){le(e,n)}}}function oF(r){let e,t,n,i,o,u,s,d,p,g,_,x,C,M,P,A,L;e=new Lw({});let I=r[6]&&Vb(r);i=new kL({props:{map:r[0],apiKey:yw,country:void 0}}),u=new Iw({});const $=[HR,qR],O=[];function Z(q,Y){return q[10].mode=="title"?0:q[10].mode=="new-project"?1:-1}~(g=Z(r))&&(_=O[g]=$[g](r)),C=new WI({});let X=r[6]&&qb(r);return A=new rM({}),{c(){ue(e.$$.fragment),t=oe(),I&&I.c(),n=oe(),ue(i.$$.fragment),o=oe(),ue(u.$$.fragment),s=oe(),d=U("div"),p=oe(),_&&_.c(),x=oe(),ue(C.$$.fragment),M=oe(),X&&X.c(),P=oe(),ue(A.$$.fragment)},m(q,Y){ae(e,q,Y),W(q,t,Y),I&&I.m(q,Y),W(q,n,Y),ae(i,q,Y),W(q,o,Y),ae(u,q,Y),W(q,s,Y),W(q,d,Y),r[19](d),W(q,p,Y),~g&&O[g].m(q,Y),W(q,x,Y),ae(C,q,Y),W(q,M,Y),X&&X.m(q,Y),W(q,P,Y),ae(A,q,Y),L=!0},p(q,Y){q[6]?I?(I.p(q,Y),Y&64&&N(I,1)):(I=Vb(q),I.c(),N(I,1),I.m(n.parentNode,n)):I&&(Xt(),V(I,1,1,()=>{I=null}),Yt());const fe={};Y&1&&(fe.map=q[0]),i.$set(fe);let Le=g;g=Z(q),g===Le?~g&&O[g].p(q,Y):(_&&(Xt(),V(O[Le],1,1,()=>{O[Le]=null}),Yt()),~g?(_=O[g],_?_.p(q,Y):(_=O[g]=$[g](q),_.c()),N(_,1),_.m(x.parentNode,x)):_=null),q[6]?X?(X.p(q,Y),Y&64&&N(X,1)):(X=qb(q),X.c(),N(X,1),X.m(P.parentNode,P)):X&&(Xt(),V(X,1,1,()=>{X=null}),Yt())},i(q){L||(N(e.$$.fragment,q),N(I),N(i.$$.fragment,q),N(u.$$.fragment,q),N(_),N(C.$$.fragment,q),N(X),N(A.$$.fragment,q),L=!0)},o(q){V(e.$$.fragment,q),V(I),V(i.$$.fragment,q),V(u.$$.fragment,q),V(_),V(C.$$.fragment,q),V(X),V(A.$$.fragment,q),L=!1},d(q){q&&(H(t),H(n),H(o),H(s),H(d),H(p),H(x),H(M),H(P)),le(e,q),I&&I.d(q),le(i,q),le(u,q),r[19](null),~g&&O[g].d(q),le(C,q),X&&X.d(q),le(A,q)}}}function sF(r){return{c:at,m:at,p:at,i:at,o:at,d:at}}function aF(r){let e,t,n,i={ctx:r,current:null,token:null,hasCatch:!1,pending:sF,then:$R,catch:OR,value:27,blocks:[,,,]};return U0(t=r[13](r[9]),i),{c(){e=U("div"),i.block.c(),he(e,"slot","main"),Qe(e,"position","relative"),Qe(e,"width","100%"),Qe(e,"height","100%")},m(o,u){W(o,e,u),i.block.m(e,i.anchor=null),i.mount=()=>e,i.anchor=null,n=!0},p(o,u){r=o,i.ctx=r,u&512&&t!==(t=r[13](r[9]))&&U0(t,i)||e3(i,r,u)},i(o){n||(N(i.block),n=!0)},o(o){for(let u=0;u<3;u+=1){const s=i.blocks[u];V(s)}n=!1},d(o){o&&H(e),i.block.d(),i.token=null,i=null}}}function lF(r){let e,t,n,i,o,u,s;return t=new p4({}),o=new aA({props:{$$slots:{main:[aF],left:[FR],top:[RR]},$$scope:{ctx:r}}}),{c(){e=U("div"),ue(t.$$.fragment),n=oe(),i=U("div"),ue(o.$$.fragment),he(e,"class","pico"),he(i,"class",u="app-focus-"+r[8])},m(d,p){W(d,e,p),ae(t,e,null),W(d,n,p),W(d,i,p),ae(o,i,null),s=!0},p(d,[p]){const g={};p&268439295&&(g.$$scope={dirty:p,ctx:d}),o.$set(g),(!s||p&256&&u!==(u="app-focus-"+d[8]))&&he(i,"class",u)},i(d){s||(N(t.$$.fragment,d),N(o.$$.fragment,d),s=!0)},o(d){V(t.$$.fragment,d),V(o.$$.fragment,d),s=!1},d(d){d&&(H(e),H(n),H(i)),le(t),le(o)}}}function uF(r,e,t){let n,i,o,u,s,d,p,g,_,x,C;ct(r,Tg,ye=>t(15,n=ye)),ct(r,Sg,ye=>t(16,i=ye)),ct(r,kg,ye=>t(17,o=ye)),ct(r,Ar,ye=>t(6,u=ye)),ct(r,as,ye=>t(7,s=ye)),ct(r,zf,ye=>t(25,d=ye)),ct(r,Qm,ye=>t(26,p=ye)),ct(r,ks,ye=>t(8,g=ye)),ct(r,Zm,ye=>t(9,_=ye)),ct(r,er,ye=>t(10,x=ye)),ct(r,Gd,ye=>t(11,C=ye));let{appFocus:M="global"}=e;ks.set(M);let P=!1;Ss(async()=>{await O2(),await rw(),t(4,P=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(ln(Qm,p=!0,p),console.log("Using local cache, not od2net.org"))}catch{}let ye=new URLSearchParams(window.location.search).get("dev");ye==="true"||ye===""?ln(zf,d=!0,d):(console.assert(ye===null||ye=="false",`unknown dev mode value: ${ye}, should be "true", "false", or empty`),ln(zf,d=!1,d))});let A=null;function L(ye){s.fitBounds(u.getBounds(),{animate:ye})}let I,$,O,Z;M=="cnt"&&(Z=[-8.943,54.631,-.901,59.489]);async function X(ye){return ye=="streets-v2"?dA:`https://api.maptiler.com/maps/${ye}/style.json?key=${yw}`}const q=()=>L(!0);function Y(ye){dn[ye?"unshift":"push"](()=>{O=ye,t(3,O),t(15,n)})}function fe(ye){A=ye,t(0,A)}const Le=ye=>{console.log(ye.detail.error)};function ee(ye){dn[ye?"unshift":"push"](()=>{$=ye,t(2,$),t(16,i)})}const ie=()=>ln(Gd,C=!0,C);function ve(ye){dn[ye?"unshift":"push"](()=>{I=ye,t(1,I),t(17,o)})}return r.$$set=ye=>{"appFocus"in ye&&t(14,M=ye.appFocus)},r.$$.update=()=>{r.$$.dirty&1&&A&&as.set(A),r.$$.dirty&131074&&I&&o&&(t(1,I.innerHTML="",I),I.appendChild(o)),r.$$.dirty&65540&&$&&i&&(t(2,$.innerHTML="",$),$.appendChild(i)),r.$$.dirty&32776&&O&&n&&(t(3,O.innerHTML="",O),O.appendChild(n))},[A,I,$,O,P,Z,u,s,g,_,x,C,L,X,M,n,i,o,q,Y,fe,Le,ee,ie,ve]}class yF extends Lt{constructor(e){super(),Et(this,e,uF,lF,Tt,{appFocus:14})}}export{yF as A};
