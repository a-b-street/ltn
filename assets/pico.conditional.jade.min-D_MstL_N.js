function P0(u,d){for(var g=0;g<d.length;g++){const w=d[g];if(typeof w!="string"&&!Array.isArray(w)){for(const C in w)if(C!=="default"&&!(C in u)){const z=Object.getOwnPropertyDescriptor(w,C);z&&Object.defineProperty(u,C,z.get?z:{enumerable:!0,get:()=>w[C]})}}}return Object.freeze(Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}))}(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))w(C);new MutationObserver(C=>{for(const z of C)if(z.type==="childList")for(const T of z.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&w(T)}).observe(document,{childList:!0,subtree:!0});function g(C){const z={};return C.integrity&&(z.integrity=C.integrity),C.referrerPolicy&&(z.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?z.credentials="include":C.crossOrigin==="anonymous"?z.credentials="omit":z.credentials="same-origin",z}function w(C){if(C.ep)return;C.ep=!0;const z=g(C);fetch(C.href,z)}})();const j_=!1;var Rd=Array.isArray,M0=Array.prototype.indexOf,jf=Array.from,wd=Object.defineProperty,Va=Object.getOwnPropertyDescriptor,N_=Object.getOwnPropertyDescriptors,C0=Object.prototype,I0=Array.prototype,Nf=Object.getPrototypeOf,Wg=Object.isExtensible;function Pu(u){return typeof u=="function"}const fr=()=>{};function E0(u){return typeof u?.then=="function"}function A0(u){return u()}function Nu(u){for(var d=0;d<u.length;d++)u[d]()}function k0(){var u,d,g=new Promise((w,C)=>{u=w,d=C});return{promise:g,resolve:u,reject:d}}function z0(u,d){if(Array.isArray(u))return u;if(!(Symbol.iterator in u))return Array.from(u);const g=[];for(const w of u)if(g.push(w),g.length===d)break;return g}const Mn=2,Vf=4,Ld=8,oc=16,aa=32,Oo=64,Uf=128,Ln=256,Td=512,Ni=1024,Fn=2048,qa=4096,rs=8192,jo=16384,$f=32768,lc=65536,Hg=1<<17,D0=1<<18,cc=1<<19,V_=1<<20,Mf=1<<21,Zf=1<<22,Do=1<<23,Ss=Symbol("$state"),U_=Symbol("legacy props"),R0=Symbol(""),Gf=new class extends Error{name="StaleReactionError";message="The reaction that called `getAbortSignal()` was re-run or destroyed"};function qf(u){throw new Error("https://svelte.dev/e/lifecycle_outside_component")}function L0(){throw new Error("https://svelte.dev/e/async_derived_orphan")}function B0(u){throw new Error("https://svelte.dev/e/effect_in_teardown")}function F0(){throw new Error("https://svelte.dev/e/effect_in_unowned_derived")}function O0(u){throw new Error("https://svelte.dev/e/effect_orphan")}function j0(){throw new Error("https://svelte.dev/e/effect_update_depth_exceeded")}function N0(u){throw new Error("https://svelte.dev/e/props_invalid_value")}function V0(){throw new Error("https://svelte.dev/e/state_descriptors_fixed")}function U0(){throw new Error("https://svelte.dev/e/state_prototype_fixed")}function $0(){throw new Error("https://svelte.dev/e/state_unsafe_mutation")}function Z0(){throw new Error("https://svelte.dev/e/svelte_boundary_reset_onerror")}const Bd=1,Fd=2,$_=4,G0=8,q0=16,W0=1,H0=2,Z_=4,X0=8,K0=16,yS=4,Y0=1,J0=2,fi=Symbol(),Q0="http://www.w3.org/1999/xhtml",eb="http://www.w3.org/2000/svg",tb="@attach";function rb(){console.warn("https://svelte.dev/e/select_multiple_invalid_value")}function ib(){console.warn("https://svelte.dev/e/svelte_boundary_reset_noop")}let nb=!1;function G_(u){return u===this.v}function Wf(u,d){return u!=u?d==d:u!==d||u!==null&&typeof u=="object"||typeof u=="function"}function vS(u,d){return u!==d}function q_(u){return!Wf(u,this.v)}let uc=!1,sb=!1;function ab(){uc=!0}let Er=null;function Za(u){Er=u}function hc(u){return W_().get(u)}function No(u,d){return W_().set(u,d),d}function ss(u,d=!1,g){Er={p:Er,c:null,e:null,s:u,x:null,l:uc&&!d?{s:null,u:null,$:[]}:null}}function as(u){var d=Er,g=d.e;if(g!==null){d.e=null;for(var w of g)uy(w)}return u!==void 0&&(d.x=u),Er=d.p,u??{}}function dc(){return!uc||Er!==null&&Er.l===null}function W_(u){return Er===null&&qf(),Er.c??=new Map(ob(Er)||void 0)}function ob(u){let d=u.p;for(;d!==null;){const g=d.c;if(g!==null)return g;d=d.p}return null}let Ba=[],Sd=[];function H_(){var u=Ba;Ba=[],Nu(u)}function lb(){var u=Sd;Sd=[],Nu(u)}function cb(){return Ba.length>0||Sd.length>0}function Cs(u){if(Ba.length===0&&!Du){var d=Ba;queueMicrotask(()=>{d===Ba&&H_()})}Ba.push(u)}function ub(){Ba.length>0&&H_(),Sd.length>0&&lb()}const hb=new WeakMap;function X_(u){var d=Zt;if(d===null)return Ht.f|=Do,u;if((d.f&$f)===0){if((d.f&Uf)===0)throw!d.parent&&u instanceof Error&&K_(u),u;d.b.error(u)}else Jl(u,d)}function Jl(u,d){for(;d!==null;){if((d.f&Uf)!==0)try{d.b.error(u);return}catch(g){u=g}d=d.parent}throw u instanceof Error&&K_(u),u}function K_(u){const d=hb.get(u);d&&(wd(u,"message",{value:d.message}),wd(u,"stack",{value:d.stack}))}const of=new Set;let Vr=null,_d=null,Cf=new Set,Lo=[],Od=null,If=!1,Du=!1;class ea{current=new Map;#t=new Map;#e=new Set;#i=0;#n=null;#l=!1;#s=[];#a=[];#r=[];#o=[];#c=[];#d=[];#h=[];skipped_effects=new Set;process(d){Lo=[],_d=null;for(const C of d)this.#p(C);if(this.#s.length===0&&this.#i===0){this.#f();var g=this.#r,w=this.#o;this.#r=[],this.#o=[],this.#c=[],_d=Vr,Vr=null,Xg(g),Xg(w),Vr===null?Vr=this:of.delete(this),this.#n?.resolve()}else this.#u(this.#r),this.#u(this.#o),this.#u(this.#c);for(const C of this.#s)Kl(C);for(const C of this.#a)Kl(C);this.#s=[],this.#a=[]}#p(d){d.f^=Ni;for(var g=d.first;g!==null;){var w=g.f,C=(w&(aa|Oo))!==0,z=C&&(w&Ni)!==0,T=z||(w&rs)!==0||this.skipped_effects.has(g);if(!T&&g.fn!==null){if(C)g.f^=Ni;else if((w&Vf)!==0)this.#o.push(g);else if((w&Ni)===0)if((w&Zf)!==0){var o=g.b?.is_pending()?this.#a:this.#s;o.push(g)}else Vd(g)&&((g.f&oc)!==0&&this.#c.push(g),Kl(g));var B=g.first;if(B!==null){g=B;continue}}var K=g.parent;for(g=g.next;g===null&&K!==null;)g=K.next,K=K.parent}}#u(d){for(const g of d)((g.f&Fn)!==0?this.#d:this.#h).push(g),tn(g,Ni);d.length=0}capture(d,g){this.#t.has(d)||this.#t.set(d,g),this.current.set(d,d.v)}activate(){Vr=this}deactivate(){Vr=null,_d=null;for(const d of Cf)if(Cf.delete(d),d(),Vr!==null)break}neuter(){this.#l=!0}flush(){Lo.length>0?J_():this.#f(),Vr===this&&(this.#i===0&&of.delete(this),this.deactivate())}#f(){if(!this.#l)for(const d of this.#e)d();this.#e.clear()}increment(){this.#i+=1}decrement(){if(this.#i-=1,this.#i===0){for(const d of this.#d)tn(d,Fn),Ql(d);for(const d of this.#h)tn(d,qa),Ql(d);this.#r=[],this.#o=[],this.flush()}else this.deactivate()}add_callback(d){this.#e.add(d)}settled(){return(this.#n??=k0()).promise}static ensure(){if(Vr===null){const d=Vr=new ea;of.add(Vr),Du||ea.enqueue(()=>{Vr===d&&d.flush()})}return Vr}static enqueue(d){Cs(d)}}function Y_(u){var d=Du;Du=!0;try{for(var g;;){if(ub(),Lo.length===0&&!cb()&&(Vr?.flush(),Lo.length===0))return Od=null,g;J_()}}finally{Du=d}}function J_(){var u=Xl;If=!0;try{var d=0;for(Qg(!0);Lo.length>0;){var g=ea.ensure();if(d++>1e3){var w,C;db()}g.process(Lo),Ua.clear()}}finally{If=!1,Qg(u),Od=null}}function db(){try{j0()}catch(u){Jl(u,Od)}}let ko=null;function Xg(u){var d=u.length;if(d!==0){for(var g=0;g<d;){var w=u[g++];if((w.f&(jo|rs))===0&&Vd(w)&&(ko=[],Kl(w),w.deps===null&&w.first===null&&w.nodes_start===null&&(w.teardown===null&&w.ac===null?py(w):w.fn=null),ko?.length>0)){Ua.clear();for(const C of ko)Kl(C);ko=[]}}ko=null}}function Ql(u){for(var d=Od=u;d.parent!==null;){d=d.parent;var g=d.f;if(If&&d===Zt&&(g&oc)!==0)return;if((g&(Oo|aa))!==0){if((g&Ni)===0)return;d.f^=Ni}}Lo.push(d)}function pb(u){let d=0,g=ns(0),w;return()=>{Mb()&&(De(g),pc(()=>(d===0&&(w=On(()=>u(()=>$a(g)))),d+=1,()=>{Cs(()=>{d-=1,d===0&&(w?.(),w=void 0,$a(g))})})))}}var fb=lc|cc|Uf;function mb(u,d,g){new gb(u,d,g)}class gb{parent;#t=!1;#e;#i=null;#n;#l;#s;#a=null;#r=null;#o=null;#c=null;#d=0;#h=0;#p=!1;#u=null;#f=()=>{this.#u&&ta(this.#u,this.#d)};#y=pb(()=>(this.#u=ns(this.#d),()=>{this.#u=null}));constructor(d,g,w){this.#e=d,this.#n=g,this.#l=w,this.parent=Zt.b,this.#t=!!this.#n.pending,this.#s=Wa(()=>{Zt.b=this;{try{this.#a=ji(()=>w(this.#e))}catch(C){this.error(C)}this.#h>0?this.#g():this.#t=!1}},fb)}#v(){try{this.#a=ji(()=>this.#l(this.#e))}catch(d){this.error(d)}this.#t=!1}#x(){const d=this.#n.pending;d&&(this.#r=ji(()=>d(this.#e)),ea.enqueue(()=>{this.#a=this.#m(()=>(ea.ensure(),ji(()=>this.#l(this.#e)))),this.#h>0?this.#g():(Ps(this.#r,()=>{this.#r=null}),this.#t=!1)}))}is_pending(){return this.#t||!!this.parent&&this.parent.is_pending()}has_pending_snippet(){return!!this.#n.pending}#m(d){var g=Zt,w=Ht,C=Er;sn(this.#s),Vi(this.#s),Za(this.#s.ctx);try{return d()}catch(z){return X_(z),null}finally{sn(g),Vi(w),Za(C)}}#g(){const d=this.#n.pending;this.#a!==null&&(this.#c=document.createDocumentFragment(),_b(this.#a,this.#c)),this.#r===null&&(this.#r=ji(()=>d(this.#e)))}#_(d){if(!this.has_pending_snippet()){this.parent&&this.parent.#_(d);return}this.#h+=d,this.#h===0&&(this.#t=!1,this.#r&&Ps(this.#r,()=>{this.#r=null}),this.#c&&(this.#e.before(this.#c),this.#c=null))}update_pending_count(d){this.#_(d),this.#d+=d,Cf.add(this.#f)}get_effect_pending(){return this.#y(),De(this.#u)}error(d){var g=this.#n.onerror;let w=this.#n.failed;if(this.#p||!g&&!w)throw d;this.#a&&(Di(this.#a),this.#a=null),this.#r&&(Di(this.#r),this.#r=null),this.#o&&(Di(this.#o),this.#o=null);var C=!1,z=!1;const T=()=>{if(C){ib();return}C=!0,z&&Z0(),ea.ensure(),this.#d=0,this.#o!==null&&Ps(this.#o,()=>{this.#o=null}),this.#t=this.has_pending_snippet(),this.#a=this.#m(()=>(this.#p=!1,ji(()=>this.#l(this.#e)))),this.#h>0?this.#g():this.#t=!1};var o=Ht;try{Vi(null),z=!0,g?.(d,T),z=!1}catch(B){Jl(B,this.#s&&this.#s.parent)}finally{Vi(o)}w&&Cs(()=>{this.#o=this.#m(()=>{this.#p=!0;try{return ji(()=>{w(this.#e,()=>d,()=>T)})}catch(B){return Jl(B,this.#s.parent),null}finally{this.#p=!1}})})}}function _b(u,d){for(var g=u.nodes_start,w=u.nodes_end;g!==null;){var C=g===w?null:Gu(g);d.append(g),g=C}}function Q_(u,d,g){const w=dc()?Zu:Hf;if(d.length===0){g(u.map(w));return}var C=Vr,z=Zt,T=yb();Promise.all(d.map(o=>vb(o))).then(o=>{C?.activate(),T();try{g([...u.map(w),...o])}catch(B){(z.f&jo)===0&&Jl(B,z)}C?.deactivate(),ey()}).catch(o=>{Jl(o,z)})}function yb(){var u=Zt,d=Ht,g=Er,w=Vr;return function(){sn(u),Vi(d),Za(g),w?.activate()}}function ey(){sn(null),Vi(null),Za(null)}function Zu(u){var d=Mn|Fn,g=Ht!==null&&(Ht.f&Mn)!==0?Ht:null;return Zt===null||g!==null&&(g.f&Ln)!==0?d|=Ln:Zt.f|=cc,{ctx:Er,deps:null,effects:null,equals:G_,f:d,fn:u,reactions:null,rv:0,v:fi,wv:0,parent:g??Zt,ac:null}}function vb(u,d){let g=Zt;g===null&&L0();var w=g.b,C=void 0,z=ns(fi),T=null,o=!Ht;return Eb(()=>{try{var B=u();T&&Promise.resolve(B).catch(()=>{})}catch(q){B=Promise.reject(q)}var K=()=>B;C=T?.then(K,K)??Promise.resolve(B),T=C;var X=Vr,ce=w.is_pending();o&&(w.update_pending_count(1),ce||X.increment());const he=(q,de=void 0)=>{T=null,ce||X.activate(),de?de!==Gf&&(z.f|=Do,ta(z,de)):((z.f&Do)!==0&&(z.f^=Do),ta(z,q)),o&&(w.update_pending_count(-1),ce||X.decrement()),ey()};if(C.then(he,q=>he(null,q||"unknown")),X)return()=>{queueMicrotask(()=>X.neuter())}}),new Promise(B=>{function K(X){function ce(){X===C?B(z):K(C)}X.then(ce,ce)}K(C)})}function ar(u){const d=Zu(u);return gy(d),d}function Hf(u){const d=Zu(u);return d.equals=q_,d}function ty(u){var d=u.effects;if(d!==null){u.effects=null;for(var g=0;g<d.length;g+=1)Di(d[g])}}function xb(u){for(var d=u.parent;d!==null;){if((d.f&Mn)===0)return d;d=d.parent}return null}function Xf(u){var d,g=Zt;sn(xb(u));try{ty(u),d=xy(u)}finally{sn(g)}return d}function ry(u){var d=Xf(u);if(u.equals(d)||(u.v=d,u.wv=yy()),!Uo){var g=(ja||(u.f&Ln)!==0)&&u.deps!==null?qa:Ni;tn(u,g)}}const Ua=new Map;function ns(u,d){var g={f:0,v:u,reactions:null,equals:G_,rv:0,wv:0};return g}function si(u,d){const g=ns(u);return gy(g),g}function Pd(u,d=!1,g=!0){const w=ns(u);return d||(w.equals=q_),uc&&g&&Er!==null&&Er.l!==null&&(Er.l.s??=[]).push(w),w}function Tr(u,d,g=!1){Ht!==null&&(!es||(Ht.f&Hg)!==0)&&dc()&&(Ht.f&(Mn|oc|Zf|Hg))!==0&&!ra?.includes(u)&&$0();let w=g?Fa(d):d;return ta(u,w)}function ta(u,d){if(!u.equals(d)){var g=u.v;Uo?Ua.set(u,d):Ua.set(u,g),u.v=d;var w=ea.ensure();w.capture(u,g),(u.f&Mn)!==0&&((u.f&Fn)!==0&&Xf(u),tn(u,(u.f&Ln)===0?Ni:qa)),u.wv=yy(),iy(u,Fn),dc()&&Zt!==null&&(Zt.f&Ni)!==0&&(Zt.f&(aa|Oo))===0&&(Rn===null?zb([u]):Rn.push(u))}return d}function Kg(u,d=1){var g=De(u),w=d===1?g++:g--;return Tr(u,g),w}function $a(u){Tr(u,u.v+1)}function iy(u,d){var g=u.reactions;if(g!==null)for(var w=dc(),C=g.length,z=0;z<C;z++){var T=g[z],o=T.f;if(!(!w&&T===Zt)){var B=(o&Fn)===0;B&&tn(T,d),(o&Mn)!==0?iy(T,qa):B&&((o&oc)!==0&&ko!==null&&ko.push(T),Ql(T))}}}function Fa(u){if(typeof u!="object"||u===null||Ss in u)return u;const d=Nf(u);if(d!==C0&&d!==I0)return u;var g=new Map,w=Rd(u),C=si(0),z=ia,T=o=>{if(ia===z)return o();var B=Ht,K=ia;Vi(null),t_(z);var X=o();return Vi(B),t_(K),X};return w&&g.set("length",si(u.length)),new Proxy(u,{defineProperty(o,B,K){(!("value"in K)||K.configurable===!1||K.enumerable===!1||K.writable===!1)&&V0();var X=g.get(B);return X===void 0?X=T(()=>{var ce=si(K.value);return g.set(B,ce),ce}):Tr(X,K.value,!0),!0},deleteProperty(o,B){var K=g.get(B);if(K===void 0){if(B in o){const X=T(()=>si(fi));g.set(B,X),$a(C)}}else Tr(K,fi),$a(C);return!0},get(o,B,K){if(B===Ss)return u;var X=g.get(B),ce=B in o;if(X===void 0&&(!ce||Va(o,B)?.writable)&&(X=T(()=>{var q=Fa(ce?o[B]:fi),de=si(q);return de}),g.set(B,X)),X!==void 0){var he=De(X);return he===fi?void 0:he}return Reflect.get(o,B,K)},getOwnPropertyDescriptor(o,B){var K=Reflect.getOwnPropertyDescriptor(o,B);if(K&&"value"in K){var X=g.get(B);X&&(K.value=De(X))}else if(K===void 0){var ce=g.get(B),he=ce?.v;if(ce!==void 0&&he!==fi)return{enumerable:!0,configurable:!0,value:he,writable:!0}}return K},has(o,B){if(B===Ss)return!0;var K=g.get(B),X=K!==void 0&&K.v!==fi||Reflect.has(o,B);if(K!==void 0||Zt!==null&&(!X||Va(o,B)?.writable)){K===void 0&&(K=T(()=>{var he=X?Fa(o[B]):fi,q=si(he);return q}),g.set(B,K));var ce=De(K);if(ce===fi)return!1}return X},set(o,B,K,X){var ce=g.get(B),he=B in o;if(w&&B==="length")for(var q=K;q<ce.v;q+=1){var de=g.get(q+"");de!==void 0?Tr(de,fi):q in o&&(de=T(()=>si(fi)),g.set(q+"",de))}if(ce===void 0)(!he||Va(o,B)?.writable)&&(ce=T(()=>si(void 0)),Tr(ce,Fa(K)),g.set(B,ce));else{he=ce.v!==fi;var Se=T(()=>Fa(K));Tr(ce,Se)}var Me=Reflect.getOwnPropertyDescriptor(o,B);if(Me?.set&&Me.set.call(X,K),!he){if(w&&typeof B=="string"){var ke=g.get("length"),Ce=Number(B);Number.isInteger(Ce)&&Ce>=ke.v&&Tr(ke,Ce+1)}$a(C)}return!0},ownKeys(o){De(C);var B=Reflect.ownKeys(o).filter(ce=>{var he=g.get(ce);return he===void 0||he.v!==fi});for(var[K,X]of g)X.v!==fi&&!(K in o)&&B.push(K);return B},setPrototypeOf(){U0()}})}function Yg(u){try{if(u!==null&&typeof u=="object"&&Ss in u)return u[Ss]}catch{}return u}function ny(u,d){return Object.is(Yg(u),Yg(d))}var Md,sy,ay,oy;function bb(){if(Md===void 0){Md=window,sy=/Firefox/.test(navigator.userAgent);var u=Element.prototype,d=Node.prototype,g=Text.prototype;ay=Va(d,"firstChild").get,oy=Va(d,"nextSibling").get,Wg(u)&&(u.__click=void 0,u.__className=void 0,u.__attributes=null,u.__style=void 0,u.__e=void 0),Wg(g)&&(g.__t=void 0)}}function Vo(u=""){return document.createTextNode(u)}function ec(u){return ay.call(u)}function Gu(u){return oy.call(u)}function tt(u,d){return ec(u)}function Ki(u,d=!1){{var g=ec(u);return g instanceof Comment&&g.data===""?Gu(g):g}}function Ir(u,d=1,g=!1){let w=u;for(;d--;)w=Gu(w);return w}function wb(u){u.textContent=""}function ly(){return!1}function Tb(u,d){if(d){const g=document.body;u.autofocus=!0,Cs(()=>{document.activeElement===g&&u.focus()})}}let Jg=!1;function Sb(){Jg||(Jg=!0,document.addEventListener("reset",u=>{Promise.resolve().then(()=>{if(!u.defaultPrevented)for(const d of u.target.elements)d.__on_r?.()})},{capture:!0}))}function xS(u,d,g,w=!0){w&&g();for(var C of d)u.addEventListener(C,g);qu(()=>{for(var z of d)u.removeEventListener(z,g)})}function jd(u){var d=Ht,g=Zt;Vi(null),sn(null);try{return u()}finally{Vi(d),sn(g)}}function Nd(u,d,g,w=g){u.addEventListener(d,()=>jd(g));const C=u.__on_r;C?u.__on_r=()=>{C(),w(!0)}:u.__on_r=()=>w(!0),Sb()}function cy(u){Zt===null&&Ht===null&&O0(),Ht!==null&&(Ht.f&Ln)!==0&&Zt===null&&F0(),Uo&&B0()}function Pb(u,d){var g=d.last;g===null?d.last=d.first=u:(g.next=u,u.prev=g,d.last=u)}function Es(u,d,g,w=!0){var C=Zt;C!==null&&(C.f&rs)!==0&&(u|=rs);var z={ctx:Er,deps:null,nodes_start:null,nodes_end:null,f:u|Fn,first:null,fn:d,last:null,next:null,parent:C,b:C&&C.b,prev:null,teardown:null,transitions:null,wv:0,ac:null};if(g)try{Kl(z),z.f|=$f}catch(B){throw Di(z),B}else d!==null&&Ql(z);if(w){var T=z;if(g&&T.deps===null&&T.teardown===null&&T.nodes_start===null&&T.first===T.last&&(T.f&cc)===0&&(T=T.first),T!==null&&(T.parent=C,C!==null&&Pb(T,C),Ht!==null&&(Ht.f&Mn)!==0&&(u&Oo)===0)){var o=Ht;(o.effects??=[]).push(T)}}return z}function Mb(){return Ht!==null&&!es}function qu(u){const d=Es(Ld,null,!1);return tn(d,Ni),d.teardown=u,d}function Oa(u){cy();var d=Zt.f,g=!Ht&&(d&aa)!==0&&(d&$f)===0;if(g){var w=Er;(w.e??=[]).push(u)}else return uy(u)}function uy(u){return Es(Vf|V_,u,!1)}function Cb(u){return cy(),Es(Ld|V_,u,!0)}function Ib(u){ea.ensure();const d=Es(Oo|cc,u,!0);return(g={})=>new Promise(w=>{g.outro?Ps(d,()=>{Di(d),w(void 0)}):(Di(d),w(void 0))})}function Wu(u){return Es(Vf,u,!1)}function Eb(u){return Es(Zf|cc,u,!0)}function pc(u,d=0){return Es(Ld|d,u,!0)}function Zr(u,d=[],g=[]){Q_(d,g,w=>{Es(Ld,()=>u(...w.map(De)),!0)})}function Wa(u,d=0){var g=Es(oc|d,u,!0);return g}function ji(u,d=!0){return Es(aa|cc,u,!0,d)}function hy(u){var d=u.teardown;if(d!==null){const g=Uo,w=Ht;e_(!0),Vi(null);try{d.call(null)}finally{e_(g),Vi(w)}}}function dy(u,d=!1){var g=u.first;for(u.first=u.last=null;g!==null;){const C=g.ac;C!==null&&jd(()=>{C.abort(Gf)});var w=g.next;(g.f&Oo)!==0?g.parent=null:Di(g,d),g=w}}function Ab(u){for(var d=u.first;d!==null;){var g=d.next;(d.f&aa)===0&&Di(d),d=g}}function Di(u,d=!0){var g=!1;(d||(u.f&D0)!==0)&&u.nodes_start!==null&&u.nodes_end!==null&&(kb(u.nodes_start,u.nodes_end),g=!0),dy(u,d&&!g),Cd(u,0),tn(u,jo);var w=u.transitions;if(w!==null)for(const z of w)z.stop();hy(u);var C=u.parent;C!==null&&C.first!==null&&py(u),u.next=u.prev=u.teardown=u.ctx=u.deps=u.fn=u.nodes_start=u.nodes_end=u.ac=null}function kb(u,d){for(;u!==null;){var g=u===d?null:Gu(u);u.remove(),u=g}}function py(u){var d=u.parent,g=u.prev,w=u.next;g!==null&&(g.next=w),w!==null&&(w.prev=g),d!==null&&(d.first===u&&(d.first=w),d.last===u&&(d.last=g))}function Ps(u,d){var g=[];Kf(u,g,!0),fy(g,()=>{Di(u),d&&d()})}function fy(u,d){var g=u.length;if(g>0){var w=()=>--g||d();for(var C of u)C.out(w)}else d()}function Kf(u,d,g){if((u.f&rs)===0){if(u.f^=rs,u.transitions!==null)for(const T of u.transitions)(T.is_global||g)&&d.push(T);for(var w=u.first;w!==null;){var C=w.next,z=(w.f&lc)!==0||(w.f&aa)!==0;Kf(w,d,z?g:!1),w=C}}}function Hu(u){my(u,!0)}function my(u,d){if((u.f&rs)!==0){u.f^=rs,(u.f&Ni)===0&&(tn(u,Fn),Ql(u));for(var g=u.first;g!==null;){var w=g.next,C=(g.f&lc)!==0||(g.f&aa)!==0;my(g,C?d:!1),g=w}if(u.transitions!==null)for(const z of u.transitions)(z.is_global||d)&&z.in()}}let Xl=!1;function Qg(u){Xl=u}let Uo=!1;function e_(u){Uo=u}let Ht=null,es=!1;function Vi(u){Ht=u}let Zt=null;function sn(u){Zt=u}let ra=null;function gy(u){Ht!==null&&(ra===null?ra=[u]:ra.push(u))}let Xi=null,wn=0,Rn=null;function zb(u){Rn=u}let _y=1,Vu=0,ia=Vu;function t_(u){ia=u}let ja=!1;function yy(){return++_y}function Vd(u){var d=u.f;if((d&Fn)!==0)return!0;if((d&qa)!==0){var g=u.deps,w=(d&Ln)!==0;if(g!==null){var C,z,T=(d&Td)!==0,o=w&&Zt!==null&&!ja,B=g.length;if((T||o)&&(Zt===null||(Zt.f&jo)===0)){var K=u,X=K.parent;for(C=0;C<B;C++)z=g[C],(T||!z?.reactions?.includes(K))&&(z.reactions??=[]).push(K);T&&(K.f^=Td),o&&X!==null&&(X.f&Ln)===0&&(K.f^=Ln)}for(C=0;C<B;C++)if(z=g[C],Vd(z)&&ry(z),z.wv>u.wv)return!0}(!w||Zt!==null&&!ja)&&tn(u,Ni)}return!1}function vy(u,d,g=!0){var w=u.reactions;if(w!==null&&!ra?.includes(u))for(var C=0;C<w.length;C++){var z=w[C];(z.f&Mn)!==0?vy(z,d,!1):d===z&&(g?tn(z,Fn):(z.f&Ni)!==0&&tn(z,qa),Ql(z))}}function xy(u){var d=Xi,g=wn,w=Rn,C=Ht,z=ja,T=ra,o=Er,B=es,K=ia,X=u.f;Xi=null,wn=0,Rn=null,ja=(X&Ln)!==0&&(es||!Xl||Ht===null),Ht=(X&(aa|Oo))===0?u:null,ra=null,Za(u.ctx),es=!1,ia=++Vu,u.ac!==null&&(jd(()=>{u.ac.abort(Gf)}),u.ac=null);try{u.f|=Mf;var ce=u.fn,he=ce(),q=u.deps;if(Xi!==null){var de;if(Cd(u,wn),q!==null&&wn>0)for(q.length=wn+Xi.length,de=0;de<Xi.length;de++)q[wn+de]=Xi[de];else u.deps=q=Xi;if(!ja||(X&Mn)!==0&&u.reactions!==null)for(de=wn;de<q.length;de++)(q[de].reactions??=[]).push(u)}else q!==null&&wn<q.length&&(Cd(u,wn),q.length=wn);if(dc()&&Rn!==null&&!es&&q!==null&&(u.f&(Mn|qa|Fn))===0)for(de=0;de<Rn.length;de++)vy(Rn[de],u);return C!==null&&C!==u&&(Vu++,Rn!==null&&(w===null?w=Rn:w.push(...Rn))),(u.f&Do)!==0&&(u.f^=Do),he}catch(Se){return X_(Se)}finally{u.f^=Mf,Xi=d,wn=g,Rn=w,Ht=C,ja=z,ra=T,Za(o),es=B,ia=K}}function Db(u,d){let g=d.reactions;if(g!==null){var w=M0.call(g,u);if(w!==-1){var C=g.length-1;C===0?g=d.reactions=null:(g[w]=g[C],g.pop())}}g===null&&(d.f&Mn)!==0&&(Xi===null||!Xi.includes(d))&&(tn(d,qa),(d.f&(Ln|Td))===0&&(d.f^=Td),ty(d),Cd(d,0))}function Cd(u,d){var g=u.deps;if(g!==null)for(var w=d;w<g.length;w++)Db(u,g[w])}function Kl(u){var d=u.f;if((d&jo)===0){tn(u,Ni);var g=Zt,w=Xl;Zt=u,Xl=!0;try{(d&oc)!==0?Ab(u):dy(u),hy(u);var C=xy(u);u.teardown=typeof C=="function"?C:null,u.wv=_y;var z;j_&&sb&&(u.f&Fn)!==0&&u.deps}finally{Xl=w,Zt=g}}}async function Rb(){await Promise.resolve(),Y_()}function De(u){var d=u.f,g=(d&Mn)!==0;if(Ht!==null&&!es){var w=Zt!==null&&(Zt.f&jo)!==0;if(!w&&!ra?.includes(u)){var C=Ht.deps;if((Ht.f&Mf)!==0)u.rv<Vu&&(u.rv=Vu,Xi===null&&C!==null&&C[wn]===u?wn++:Xi===null?Xi=[u]:(!ja||!Xi.includes(u))&&Xi.push(u));else{(Ht.deps??=[]).push(u);var z=u.reactions;z===null?u.reactions=[Ht]:z.includes(Ht)||z.push(Ht)}}}else if(g&&u.deps===null&&u.effects===null){var T=u,o=T.parent;o!==null&&(o.f&Ln)===0&&(T.f^=Ln)}if(Uo){if(Ua.has(u))return Ua.get(u);if(g){T=u;var B=T.v;return((T.f&Ni)===0&&T.reactions!==null||by(T))&&(B=Xf(T)),Ua.set(T,B),B}}else g&&(T=u,Vd(T)&&ry(T));if((u.f&Do)!==0)throw u.v;return u.v}function by(u){if(u.v===fi)return!0;if(u.deps===null)return!1;for(const d of u.deps)if(Ua.has(d)||(d.f&Mn)!==0&&by(d))return!0;return!1}function On(u){var d=es;try{return es=!0,u()}finally{es=d}}const Lb=-7169;function tn(u,d){u.f=u.f&Lb|d}function zo(u){if(!(typeof u!="object"||!u||u instanceof EventTarget)){if(Ss in u)Ef(u);else if(!Array.isArray(u))for(let d in u){const g=u[d];typeof g=="object"&&g&&Ss in g&&Ef(g)}}}function Ef(u,d=new Set){if(typeof u=="object"&&u!==null&&!(u instanceof EventTarget)&&!d.has(u)){d.add(u),u instanceof Date&&u.getTime();for(let w in u)try{Ef(u[w],d)}catch{}const g=Nf(u);if(g!==Object.prototype&&g!==Array.prototype&&g!==Map.prototype&&g!==Set.prototype&&g!==Date.prototype){const w=N_(g);for(let C in w){const z=w[C].get;if(z)try{z.call(u)}catch{}}}}}function Bb(u){return u.endsWith("capture")&&u!=="gotpointercapture"&&u!=="lostpointercapture"}const Fb=["beforeinput","click","change","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"];function Ob(u){return Fb.includes(u)}const jb={formnovalidate:"formNoValidate",ismap:"isMap",nomodule:"noModule",playsinline:"playsInline",readonly:"readOnly",defaultvalue:"defaultValue",defaultchecked:"defaultChecked",srcobject:"srcObject",novalidate:"noValidate",allowfullscreen:"allowFullscreen",disablepictureinpicture:"disablePictureInPicture",disableremoteplayback:"disableRemotePlayback"};function Nb(u){return u=u.toLowerCase(),jb[u]??u}const Vb=["touchstart","touchmove"];function Ub(u){return Vb.includes(u)}const wy=new Set,Af=new Set;function Ty(u,d,g,w={}){function C(z){if(w.capture||ku.call(d,z),!z.cancelBubble)return jd(()=>g?.call(this,z))}return u.startsWith("pointer")||u.startsWith("touch")||u==="wheel"?Cs(()=>{d.addEventListener(u,C,w)}):d.addEventListener(u,C,w),C}function Id(u,d,g,w,C){var z={capture:w,passive:C},T=Ty(u,d,g,z);(d===document.body||d===window||d===document||d instanceof HTMLMediaElement)&&qu(()=>{d.removeEventListener(u,T,z)})}function As(u){for(var d=0;d<u.length;d++)wy.add(u[d]);for(var g of Af)g(u)}let r_=null;function ku(u){var d=this,g=d.ownerDocument,w=u.type,C=u.composedPath?.()||[],z=C[0]||u.target;r_=u;var T=0,o=r_===u&&u.__root;if(o){var B=C.indexOf(o);if(B!==-1&&(d===document||d===window)){u.__root=d;return}var K=C.indexOf(d);if(K===-1)return;B<=K&&(T=B)}if(z=C[T]||u.target,z!==d){wd(u,"currentTarget",{configurable:!0,get(){return z||g}});var X=Ht,ce=Zt;Vi(null),sn(null);try{for(var he,q=[];z!==null;){var de=z.assignedSlot||z.parentNode||z.host||null;try{var Se=z["__"+w];if(Se!=null&&(!z.disabled||u.target===z))if(Rd(Se)){var[Me,...ke]=Se;Me.apply(z,[u,...ke])}else Se.call(z,u)}catch(Ce){he?q.push(Ce):he=Ce}if(u.cancelBubble||de===d||de===null)break;z=de}if(he){for(let Ce of q)queueMicrotask(()=>{throw Ce});throw he}}finally{u.__root=d,delete u.currentTarget,Vi(X),sn(ce)}}}function Sy(u){var d=document.createElement("template");return d.innerHTML=u.replaceAll("<!>","<!---->"),d.content}function tc(u,d){var g=Zt;g.nodes_start===null&&(g.nodes_start=u,g.nodes_end=d)}function Xt(u,d){var g=(d&Y0)!==0,w=(d&J0)!==0,C,z=!u.startsWith("<!>");return()=>{C===void 0&&(C=Sy(z?u:"<!>"+u),g||(C=ec(C)));var T=w||sy?document.importNode(C,!0):C.cloneNode(!0);if(g){var o=ec(T),B=T.lastChild;tc(o,B)}else tc(T,T);return T}}function $b(u,d,g="svg"){var w=!u.startsWith("<!>"),C=`<${g}>${w?u:"<!>"+u}</${g}>`,z;return()=>{if(!z){var T=Sy(C),o=ec(T);z=ec(o)}var B=z.cloneNode(!0);return tc(B,B),B}}function Zb(u,d){return $b(u,d,"svg")}function lf(u=""){{var d=Vo(u+"");return tc(d,d),d}}function Qn(){var u=document.createDocumentFragment(),d=document.createComment(""),g=Vo();return u.append(d,g),tc(d,g),u}function _t(u,d){u!==null&&u.before(d)}let kf=!0;function i_(u){kf=u}function sr(u,d){var g=d==null?"":typeof d=="object"?d+"":d;g!==(u.__t??=u.nodeValue)&&(u.__t=g,u.nodeValue=g+"")}function bS(u,d){return Gb(u,d)}const Gl=new Map;function Gb(u,{target:d,anchor:g,props:w={},events:C,context:z,intro:T=!0}){bb();var o=new Set,B=ce=>{for(var he=0;he<ce.length;he++){var q=ce[he];if(!o.has(q)){o.add(q);var de=Ub(q);d.addEventListener(q,ku,{passive:de});var Se=Gl.get(q);Se===void 0?(document.addEventListener(q,ku,{passive:de}),Gl.set(q,1)):Gl.set(q,Se+1)}}};B(jf(wy)),Af.add(B);var K=void 0,X=Ib(()=>{var ce=g??d.appendChild(Vo());return mb(ce,{pending:()=>{}},he=>{if(z){ss({});var q=Er;q.c=z}C&&(w.$$events=C),kf=T,K=u(he,w)||{},kf=!0,z&&as()}),()=>{for(var he of o){d.removeEventListener(he,ku);var q=Gl.get(he);--q===0?(document.removeEventListener(he,ku),Gl.delete(he)):Gl.set(he,q)}Af.delete(B),ce!==g&&ce.parentNode?.removeChild(ce)}});return qb.set(K,X),K}let qb=new WeakMap;const cf=0,dd=1,uf=2;function wS(u,d,g,w,C){var z=u,T=dc(),o=Er,B=fi,K,X,ce,he=T?ns(void 0):Pd(void 0,!1,!1),q=T?ns(void 0):Pd(void 0,!1,!1),de=!1;function Se(ke,Ce){de=!0,Ce&&(sn(Me),Vi(Me),Za(o));try{ke===dd&&w&&(X?Hu(X):X=ji(()=>w(z,he))),ke!==cf&&K&&Ps(K,()=>K=null),ke!==dd&&X&&Ps(X,()=>X=null),ke!==uf&&ce&&Ps(ce,()=>ce=null)}finally{Ce&&(Za(null),Vi(null),sn(null),Y_())}}var Me=Wa(()=>{if(B!==(B=d())){if(E0(B)){var ke=B;de=!1,ke.then(Ce=>{ke===B&&(ta(he,Ce),Se(dd,!0))},Ce=>{if(ke===B)throw ta(q,Ce),Se(uf,!0),q.v}),Cs(()=>{de||Se(cf,!0)})}else ta(he,B),Se(dd,!1);return()=>B=fi}})}function Na(u,d,g=!1){var w=u,C=null,z=null,T=fi,o=g?lc:0,B=!1;const K=(q,de=!0)=>{B=!0,he(de,q)};var X=null;function ce(){X!==null&&(X.lastChild.remove(),w.before(X),X=null);var q=T?C:z,de=T?z:C;q&&Hu(q),de&&Ps(de,()=>{T?z=null:C=null})}const he=(q,de)=>{if(T!==(T=q)){var Se=ly(),Me=w;if(Se&&(X=document.createDocumentFragment(),X.append(Me=Vo())),T?C??=de&&ji(()=>de(Me)):z??=de&&ji(()=>de(Me)),Se){var ke=Vr,Ce=T?C:z,Ee=T?z:C;Ce&&ke.skipped_effects.delete(Ce),Ee&&ke.skipped_effects.add(Ee),ke.add_callback(ce)}else ce()}};Wa(()=>{B=!1,d(K),B||he(null,null)},o)}function Py(u,d){return d}function Wb(u,d,g){for(var w=u.items,C=[],z=d.length,T=0;T<z;T++)Kf(d[T].e,C,!0);var o=z>0&&C.length===0&&g!==null;if(o){var B=g.parentNode;wb(B),B.append(g),w.clear(),ws(u,d[0].prev,d[z-1].next)}fy(C,()=>{for(var K=0;K<z;K++){var X=d[K];o||(w.delete(X.k),ws(u,X.prev,X.next)),Di(X.e,!o)}})}function My(u,d,g,w,C,z=null){var T=u,o={flags:d,items:new Map,first:null},B=(d&$_)!==0;if(B){var K=u;T=K.appendChild(Vo())}var X=null,ce=!1,he=new Map,q=Hf(()=>{var ke=g();return Rd(ke)?ke:ke==null?[]:jf(ke)}),de,Se;function Me(){Hb(Se,de,o,he,T,C,d,w,g),z!==null&&(de.length===0?X?Hu(X):X=ji(()=>z(T)):X!==null&&Ps(X,()=>{X=null}))}Wa(()=>{Se??=Zt,de=De(q);var ke=de.length;if(!(ce&&ke===0)){ce=ke===0;var Ce,Ee,ae,$e;if(ly()){var Re=new Set,Oe=Vr;for(Ee=0;Ee<ke;Ee+=1){ae=de[Ee],$e=w(ae,Ee);var Xe=o.items.get($e)??he.get($e);Xe?(d&(Bd|Fd))!==0&&Cy(Xe,ae,Ee,d):(Ce=Iy(null,o,null,null,ae,$e,Ee,C,d,g,!0),he.set($e,Ce)),Re.add($e)}for(const[gt,at]of o.items)Re.has(gt)||Oe.skipped_effects.add(at.e);Oe.add_callback(Me)}else Me();De(q)}})}function Hb(u,d,g,w,C,z,T,o,B){var K=(T&G0)!==0,X=(T&(Bd|Fd))!==0,ce=d.length,he=g.items,q=g.first,de=q,Se,Me=null,ke,Ce=[],Ee=[],ae,$e,Re,Oe;if(K)for(Oe=0;Oe<ce;Oe+=1)ae=d[Oe],$e=o(ae,Oe),Re=he.get($e),Re!==void 0&&(Re.a?.measure(),(ke??=new Set).add(Re));for(Oe=0;Oe<ce;Oe+=1){if(ae=d[Oe],$e=o(ae,Oe),Re=he.get($e),Re===void 0){var Xe=w.get($e);if(Xe!==void 0){w.delete($e),he.set($e,Xe);var gt=Me?Me.next:de;ws(g,Me,Xe),ws(g,Xe,gt),hf(Xe,gt,C),Me=Xe}else{var at=de?de.e.nodes_start:C;Me=Iy(at,g,Me,Me===null?g.first:Me.next,ae,$e,Oe,z,T,B)}he.set($e,Me),Ce=[],Ee=[],de=Me.next;continue}if(X&&Cy(Re,ae,Oe,T),(Re.e.f&rs)!==0&&(Hu(Re.e),K&&(Re.a?.unfix(),(ke??=new Set).delete(Re))),Re!==de){if(Se!==void 0&&Se.has(Re)){if(Ce.length<Ee.length){var rt=Ee[0],nt;Me=rt.prev;var mt=Ce[0],At=Ce[Ce.length-1];for(nt=0;nt<Ce.length;nt+=1)hf(Ce[nt],rt,C);for(nt=0;nt<Ee.length;nt+=1)Se.delete(Ee[nt]);ws(g,mt.prev,At.next),ws(g,Me,mt),ws(g,At,rt),de=rt,Me=At,Oe-=1,Ce=[],Ee=[]}else Se.delete(Re),hf(Re,de,C),ws(g,Re.prev,Re.next),ws(g,Re,Me===null?g.first:Me.next),ws(g,Me,Re),Me=Re;continue}for(Ce=[],Ee=[];de!==null&&de.k!==$e;)(de.e.f&rs)===0&&(Se??=new Set).add(de),Ee.push(de),de=de.next;if(de===null)continue;Re=de}Ce.push(Re),Me=Re,de=Re.next}if(de!==null||Se!==void 0){for(var St=Se===void 0?[]:jf(Se);de!==null;)(de.e.f&rs)===0&&St.push(de),de=de.next;var jt=St.length;if(jt>0){var Mt=(T&$_)!==0&&ce===0?C:null;if(K){for(Oe=0;Oe<jt;Oe+=1)St[Oe].a?.measure();for(Oe=0;Oe<jt;Oe+=1)St[Oe].a?.fix()}Wb(g,St,Mt)}}K&&Cs(()=>{if(ke!==void 0)for(Re of ke)Re.a?.apply()}),u.first=g.first&&g.first.e,u.last=Me&&Me.e;for(var pt of w.values())Di(pt.e);w.clear()}function Cy(u,d,g,w){(w&Bd)!==0&&ta(u.v,d),(w&Fd)!==0?ta(u.i,g):u.i=g}function Iy(u,d,g,w,C,z,T,o,B,K,X){var ce=(B&Bd)!==0,he=(B&q0)===0,q=ce?he?Pd(C,!1,!1):ns(C):C,de=(B&Fd)===0?T:ns(T),Se={i:de,v:q,k:z,a:null,e:null,prev:g,next:w};try{if(u===null){var Me=document.createDocumentFragment();Me.append(u=Vo())}return Se.e=ji(()=>o(u,q,de,K),nb),Se.e.prev=g&&g.e,Se.e.next=w&&w.e,g===null?X||(d.first=Se):(g.next=Se,g.e.next=Se.e),w!==null&&(w.prev=Se,w.e.prev=Se.e),Se}finally{}}function hf(u,d,g){for(var w=u.next?u.next.e.nodes_start:g,C=d?d.e.nodes_start:g,z=u.e.nodes_start;z!==null&&z!==w;){var T=Gu(z);C.before(z),z=T}}function ws(u,d,g){d===null?u.first=g:(d.next=g,d.e.next=g&&g.e),g!==null&&(g.prev=d,g.e.prev=d&&d.e)}function Xu(u,d,g,w,C){var z=d.$$slots?.[g],T=!1;z===!0&&(z=d.children,T=!0),z===void 0||z(u,T?()=>w:w)}function Ga(u,d,...g){var w=u,C=fr,z;Wa(()=>{C!==(C=d())&&(z&&(Di(z),z=null),z=ji(()=>C(w,...g)))},lc)}function Xb(u,d,g,w,C,z){var T,o,B=null,K=u,X;Wa(()=>{const ce=d()||null;var he=g||ce==="svg"?eb:null;ce!==T&&(X&&(ce===null?Ps(X,()=>{X=null,o=null}):ce===o?Hu(X):(Di(X),i_(!1))),ce&&ce!==o&&(X=ji(()=>{if(B=he?document.createElementNS(he,ce):document.createElement(ce),tc(B,B),w){var q=B.appendChild(Vo());w(B,q)}Zt.nodes_end=B,K.before(B)})),T=ce,T&&(o=T),i_(!0))},lc)}function n_(u,d,g){Wu(()=>{var w=On(()=>d(u,g?.())||{});if(g&&w?.update){var C=!1,z={};pc(()=>{var T=g();zo(T),C&&Wf(z,T)&&(z=T,w.update(T))}),C=!0}if(w?.destroy)return()=>w.destroy()})}function Kb(u,d){var g=void 0,w;Wa(()=>{g!==(g=d())&&(w&&(Di(w),w=null),g&&(w=ji(()=>{Wu(()=>g(u))})))})}function Ey(u){var d,g,w="";if(typeof u=="string"||typeof u=="number")w+=u;else if(typeof u=="object")if(Array.isArray(u)){var C=u.length;for(d=0;d<C;d++)u[d]&&(g=Ey(u[d]))&&(w&&(w+=" "),w+=g)}else for(g in u)u[g]&&(w&&(w+=" "),w+=g);return w}function Yb(){for(var u,d,g=0,w="",C=arguments.length;g<C;g++)(u=arguments[g])&&(d=Ey(u))&&(w&&(w+=" "),w+=d);return w}function Ay(u){return typeof u=="object"?Yb(u):u??""}const s_=[...` 	
\r\f \v\uFEFF`];function Jb(u,d,g){var w=u==null?"":""+u;if(d&&(w=w?w+" "+d:d),g){for(var C in g)if(g[C])w=w?w+" "+C:C;else if(w.length)for(var z=C.length,T=0;(T=w.indexOf(C,T))>=0;){var o=T+z;(T===0||s_.includes(w[T-1]))&&(o===w.length||s_.includes(w[o]))?w=(T===0?"":w.substring(0,T))+w.substring(o+1):T=o}}return w===""?null:w}function a_(u,d=!1){var g=d?" !important;":";",w="";for(var C in u){var z=u[C];z!=null&&z!==""&&(w+=" "+C+": "+z+g)}return w}function df(u){return u[0]!=="-"||u[1]!=="-"?u.toLowerCase():u}function Qb(u,d){if(d){var g="",w,C;if(Array.isArray(d)?(w=d[0],C=d[1]):w=d,u){u=String(u).replaceAll(/\s*\/\*.*?\*\/\s*/g,"").trim();var z=!1,T=0,o=!1,B=[];w&&B.push(...Object.keys(w).map(df)),C&&B.push(...Object.keys(C).map(df));var K=0,X=-1;const Se=u.length;for(var ce=0;ce<Se;ce++){var he=u[ce];if(o?he==="/"&&u[ce-1]==="*"&&(o=!1):z?z===he&&(z=!1):he==="/"&&u[ce+1]==="*"?o=!0:he==='"'||he==="'"?z=he:he==="("?T++:he===")"&&T--,!o&&z===!1&&T===0){if(he===":"&&X===-1)X=ce;else if(he===";"||ce===Se-1){if(X!==-1){var q=df(u.substring(K,X).trim());if(!B.includes(q)){he!==";"&&ce++;var de=u.substring(K,ce).trim();g+=" "+de+";"}}K=ce+1,X=-1}}}}return w&&(g+=a_(w)),C&&(g+=a_(C,!0)),g=g.trim(),g===""?null:g}return u==null?null:String(u)}function Yf(u,d,g,w,C,z){var T=u.__className;if(T!==g||T===void 0){var o=Jb(g,w,z);o==null?u.removeAttribute("class"):d?u.className=o:u.setAttribute("class",o),u.__className=g}else if(z&&C!==z)for(var B in z){var K=!!z[B];(C==null||K!==!!C[B])&&u.classList.toggle(B,K)}return z}function pf(u,d={},g,w){for(var C in g){var z=g[C];d[C]!==z&&(g[C]==null?u.style.removeProperty(C):u.style.setProperty(C,z,w))}}function ky(u,d,g,w){var C=u.__style;if(C!==d){var z=Qb(d,w);z==null?u.removeAttribute("style"):u.style.cssText=z,u.__style=d}else w&&(Array.isArray(w)?(pf(u,g?.[0],w[0]),pf(u,g?.[1],w[1],"important")):pf(u,g,w));return w}function Ed(u,d,g=!1){if(u.multiple){if(d==null)return;if(!Rd(d))return rb();for(var w of u.options)w.selected=d.includes(Ru(w));return}for(w of u.options){var C=Ru(w);if(ny(C,d)){w.selected=!0;return}}(!g||d!==void 0)&&(u.selectedIndex=-1)}function zy(u){var d=new MutationObserver(()=>{Ed(u,u.__value)});d.observe(u,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),qu(()=>{d.disconnect()})}function e1(u,d,g=d){var w=!0;Nd(u,"change",C=>{var z=C?"[selected]":":checked",T;if(u.multiple)T=[].map.call(u.querySelectorAll(z),Ru);else{var o=u.querySelector(z)??u.querySelector("option:not([disabled])");T=o&&Ru(o)}g(T)}),Wu(()=>{var C=d();if(Ed(u,C,w),w&&C===void 0){var z=u.querySelector(":checked");z!==null&&(C=Ru(z),g(C))}u.__value=C,w=!1}),zy(u)}function Ru(u){return"__value"in u?u.__value:u.value}const Mu=Symbol("class"),Cu=Symbol("style"),Dy=Symbol("is custom element"),Ry=Symbol("is html");function TS(u,d){var g=Jf(u);g.value===(g.value=d??void 0)||u.value===d&&(d!==0||u.nodeName!=="PROGRESS")||(u.value=d??"")}function t1(u,d){d?u.hasAttribute("selected")||u.setAttribute("selected",""):u.removeAttribute("selected")}function na(u,d,g,w){var C=Jf(u);C[d]!==(C[d]=g)&&(d==="loading"&&(u[R0]=g),g==null?u.removeAttribute(d):typeof g!="string"&&Ly(u).includes(d)?u[d]=g:u.setAttribute(d,g))}function r1(u,d,g,w,C=!1,z=!1){var T=Jf(u),o=T[Dy],B=!T[Ry],K=d||{},X=u.tagName==="OPTION";for(var ce in d)ce in g||(g[ce]=null);g.class?g.class=Ay(g.class):(w||g[Mu])&&(g.class=null),g[Cu]&&(g.style??=null);var he=Ly(u);for(const Ee in g){let ae=g[Ee];if(X&&Ee==="value"&&ae==null){u.value=u.__value="",K[Ee]=ae;continue}if(Ee==="class"){var q=u.namespaceURI==="http://www.w3.org/1999/xhtml";Yf(u,q,ae,w,d?.[Mu],g[Mu]),K[Ee]=ae,K[Mu]=g[Mu];continue}if(Ee==="style"){ky(u,ae,d?.[Cu],g[Cu]),K[Ee]=ae,K[Cu]=g[Cu];continue}var de=K[Ee];if(!(ae===de&&!(ae===void 0&&u.hasAttribute(Ee)))){K[Ee]=ae;var Se=Ee[0]+Ee[1];if(Se!=="$$")if(Se==="on"){const $e={},Re="$$"+Ee;let Oe=Ee.slice(2);var Me=Ob(Oe);if(Bb(Oe)&&(Oe=Oe.slice(0,-7),$e.capture=!0),!Me&&de){if(ae!=null)continue;u.removeEventListener(Oe,K[Re],$e),K[Re]=null}if(ae!=null)if(Me)u[`__${Oe}`]=ae,As([Oe]);else{let Xe=function(gt){K[Ee].call(this,gt)};K[Re]=Ty(Oe,u,Xe,$e)}else Me&&(u[`__${Oe}`]=void 0)}else if(Ee==="style")na(u,Ee,ae);else if(Ee==="autofocus")Tb(u,!!ae);else if(!o&&(Ee==="__value"||Ee==="value"&&ae!=null))u.value=u.__value=ae;else if(Ee==="selected"&&X)t1(u,ae);else{var ke=Ee;B||(ke=Nb(ke));var Ce=ke==="defaultValue"||ke==="defaultChecked";if(ae==null&&!o&&!Ce)if(T[Ee]=null,ke==="value"||ke==="checked"){let $e=u;const Re=d===void 0;if(ke==="value"){let Oe=$e.defaultValue;$e.removeAttribute(ke),$e.defaultValue=Oe,$e.value=$e.__value=Re?Oe:null}else{let Oe=$e.defaultChecked;$e.removeAttribute(ke),$e.defaultChecked=Oe,$e.checked=Re?Oe:!1}}else u.removeAttribute(Ee);else Ce||he.includes(ke)&&(o||typeof ae!="string")?(u[ke]=ae,ke in T&&(T[ke]=fi)):typeof ae!="function"&&na(u,ke,ae)}}}return K}function o_(u,d,g=[],w=[],C,z=!1,T=!1){Q_(g,w,o=>{var B=void 0,K={},X=u.nodeName==="SELECT",ce=!1;if(Wa(()=>{var q=d(...o.map(De)),de=r1(u,B,q,C,z,T);ce&&X&&"value"in q&&Ed(u,q.value);for(let Me of Object.getOwnPropertySymbols(K))q[Me]||Di(K[Me]);for(let Me of Object.getOwnPropertySymbols(q)){var Se=q[Me];Me.description===tb&&(!B||Se!==B[Me])&&(K[Me]&&Di(K[Me]),K[Me]=ji(()=>Kb(u,()=>Se))),de[Me]=Se}B=de}),X){var he=u;Wu(()=>{Ed(he,B.value,!0),zy(he)})}ce=!0})}function Jf(u){return u.__attributes??={[Dy]:u.nodeName.includes("-"),[Ry]:u.namespaceURI===Q0}}var l_=new Map;function Ly(u){var d=u.getAttribute("is")||u.nodeName,g=l_.get(d);if(g)return g;l_.set(d,g=[]);for(var w,C=u,z=Element.prototype;z!==C;){w=N_(C);for(var T in w)w[T].set&&g.push(T);C=Nf(C)}return g}function SS(u,d,g=d){var w=new WeakSet;Nd(u,"input",async C=>{var z=C?u.defaultValue:u.value;if(z=mf(u)?gf(z):z,g(z),Vr!==null&&w.add(Vr),await Rb(),z!==(z=d())){var T=u.selectionStart,o=u.selectionEnd;u.value=z??"",o!==null&&(u.selectionStart=T,u.selectionEnd=Math.min(o,u.value.length))}}),On(d)==null&&u.value&&(g(mf(u)?gf(u.value):u.value),Vr!==null&&w.add(Vr)),pc(()=>{var C=d();if(u===document.activeElement){var z=_d??Vr;if(w.has(z))return}mf(u)&&C===gf(u.value)||u.type==="date"&&!C&&!u.value||C!==u.value&&(u.value=C??"")})}const ff=new Set;function c_(u,d,g,w,C=w){var z=g.getAttribute("type")==="checkbox",T=u;if(d!==null)for(var o of d)T=T[o]??=[];T.push(g),Nd(g,"change",()=>{var B=g.__value;z&&(B=n1(T,B,g.checked)),C(B)},()=>C(z?[]:null)),pc(()=>{var B=w();z?(B=B||[],g.checked=B.includes(g.__value)):g.checked=ny(g.__value,B)}),qu(()=>{var B=T.indexOf(g);B!==-1&&T.splice(B,1)}),ff.has(T)||(ff.add(T),Cs(()=>{T.sort((B,K)=>B.compareDocumentPosition(K)===4?-1:1),ff.delete(T)})),Cs(()=>{})}function i1(u,d,g=d){Nd(u,"change",w=>{var C=w?u.defaultChecked:u.checked;g(C)}),On(d)==null&&g(u.checked),pc(()=>{var w=d();u.checked=!!w})}function n1(u,d,g){for(var w=new Set,C=0;C<u.length;C+=1)u[C].checked&&w.add(u[C].__value);return g||w.delete(d),Array.from(w)}function mf(u){var d=u.type;return d==="number"||d==="range"}function gf(u){return u===""?null:+u}function u_(u,d){return u===d||u?.[Ss]===d}function s1(u={},d,g,w){return Wu(()=>{var C,z;return pc(()=>{C=z,z=w?.()||[],On(()=>{u!==g(...z)&&(d(u,...z),C&&u_(g(...C),u)&&d(null,...C))})}),()=>{Cs(()=>{z&&u_(g(...z),u)&&d(null,...z)})}}),u}function a1(u=!1){const d=Er,g=d.l.u;if(!g)return;let w=()=>zo(d.s);if(u){let C=0,z={};const T=Zu(()=>{let o=!1;const B=d.s;for(const K in B)B[K]!==z[K]&&(z[K]=B[K],o=!0);return o&&C++,C});w=()=>De(T)}g.b.length&&Cb(()=>{h_(d,w),Nu(g.b)}),Oa(()=>{const C=On(()=>g.m.map(A0));return()=>{for(const z of C)typeof z=="function"&&z()}}),g.a.length&&Oa(()=>{h_(d,w),Nu(g.a)})}function h_(u,d){if(u.l.s)for(const g of u.l.s)De(g);d()}function Qf(u,d,g){if(u==null)return d(void 0),g&&g(void 0),fr;const w=On(()=>u.subscribe(d,g));return w.unsubscribe?()=>w.unsubscribe():w}const ql=[];function o1(u,d){return{subscribe:dr(u,d).subscribe}}function dr(u,d=fr){let g=null;const w=new Set;function C(o){if(Wf(u,o)&&(u=o,g)){const B=!ql.length;for(const K of w)K[1](),ql.push(K,u);if(B){for(let K=0;K<ql.length;K+=2)ql[K][0](ql[K+1]);ql.length=0}}}function z(o){C(o(u))}function T(o,B=fr){const K=[o,B];return w.add(K),w.size===1&&(g=d(C,z)||fr),o(u),()=>{w.delete(K),w.size===0&&g&&(g(),g=null)}}return{set:C,update:z,subscribe:T}}function By(u,d,g){const w=!Array.isArray(u),C=w?[u]:u;if(!C.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const z=d.length<2;return o1(g,(T,o)=>{let B=!1;const K=[];let X=0,ce=fr;const he=()=>{if(X)return;ce();const de=d(w?K[0]:K,T,o);z?T(de):ce=typeof de=="function"?de:fr},q=C.map((de,Se)=>Qf(de,Me=>{K[Se]=Me,X&=~(1<<Se),B&&he()},()=>{X|=1<<Se}));return B=!0,he(),function(){Nu(q),ce(),B=!1}})}function is(u){let d;return Qf(u,g=>d=g)(),d}let zu=!1,zf=Symbol();function em(u,d,g){const w=g[d]??={store:null,source:Pd(void 0),unsubscribe:fr};if(w.store!==u&&!(zf in g))if(w.unsubscribe(),w.store=u??null,u==null)w.source.v=void 0,w.unsubscribe=fr;else{var C=!0;w.unsubscribe=Qf(u,z=>{C?w.source.v=z:Tr(w.source,z)}),C=!1}return u&&zf in g?is(u):De(w.source)}function d_(u,d){return u.set(d),d}function tm(){const u={};function d(){qu(()=>{for(var g in u)u[g].unsubscribe();wd(u,zf,{enumerable:!1,value:!0})})}return[u,d]}function PS(u,d,g=1){return u.set(d+g),d}function MS(){zu=!0}function l1(u){var d=zu;try{return zu=!1,[u(),zu]}finally{zu=d}}function p_(u,d=1){const g=u();return u(g+d),g}const c1={get(u,d){if(!u.exclude.includes(d))return u.props[d]},set(u,d){return!1},getOwnPropertyDescriptor(u,d){if(!u.exclude.includes(d)&&d in u.props)return{enumerable:!0,configurable:!0,value:u.props[d]}},has(u,d){return u.exclude.includes(d)?!1:d in u.props},ownKeys(u){return Reflect.ownKeys(u.props).filter(d=>!u.exclude.includes(d))}};function u1(u,d,g){return new Proxy({props:u,exclude:d},c1)}const h1={get(u,d){if(!u.exclude.includes(d))return De(u.version),d in u.special?u.special[d]():u.props[d]},set(u,d,g){if(!(d in u.special)){var w=Zt;try{sn(u.parent_effect),u.special[d]=hr({get[d](){return u.props[d]}},d,Z_)}finally{sn(w)}}return u.special[d](g),Kg(u.version),!0},getOwnPropertyDescriptor(u,d){if(!u.exclude.includes(d)&&d in u.props)return{enumerable:!0,configurable:!0,value:u.props[d]}},deleteProperty(u,d){return u.exclude.includes(d)||(u.exclude.push(d),Kg(u.version)),!0},has(u,d){return u.exclude.includes(d)?!1:d in u.props},ownKeys(u){return Reflect.ownKeys(u.props).filter(d=>!u.exclude.includes(d))}};function rc(u,d){return new Proxy({props:u,exclude:d,special:{},version:ns(0),parent_effect:Zt},h1)}const d1={get(u,d){let g=u.props.length;for(;g--;){let w=u.props[g];if(Pu(w)&&(w=w()),typeof w=="object"&&w!==null&&d in w)return w[d]}},set(u,d,g){let w=u.props.length;for(;w--;){let C=u.props[w];Pu(C)&&(C=C());const z=Va(C,d);if(z&&z.set)return z.set(g),!0}return!1},getOwnPropertyDescriptor(u,d){let g=u.props.length;for(;g--;){let w=u.props[g];if(Pu(w)&&(w=w()),typeof w=="object"&&w!==null&&d in w){const C=Va(w,d);return C&&!C.configurable&&(C.configurable=!0),C}}},has(u,d){if(d===Ss||d===U_)return!1;for(let g of u.props)if(Pu(g)&&(g=g()),g!=null&&d in g)return!0;return!1},ownKeys(u){const d=[];for(let g of u.props)if(Pu(g)&&(g=g()),!!g){for(const w in g)d.includes(w)||d.push(w);for(const w of Object.getOwnPropertySymbols(g))d.includes(w)||d.push(w)}return d}};function Ud(...u){return new Proxy({props:u},d1)}function hr(u,d,g,w){var C=!uc||(g&H0)!==0,z=(g&X0)!==0,T=(g&K0)!==0,o=w,B=!0,K=()=>(B&&(B=!1,o=T?On(w):w),o),X;if(z){var ce=Ss in u||U_ in u;X=Va(u,d)?.set??(ce&&d in u?Ee=>u[d]=Ee:void 0)}var he,q=!1;z?[he,q]=l1(()=>u[d]):he=u[d],he===void 0&&w!==void 0&&(he=K(),X&&(C&&N0(),X(he)));var de;if(C?de=()=>{var Ee=u[d];return Ee===void 0?K():(B=!0,Ee)}:de=()=>{var Ee=u[d];return Ee!==void 0&&(o=void 0),Ee===void 0?o:Ee},C&&(g&Z_)===0)return de;if(X){var Se=u.$$legacy;return(function(Ee,ae){return arguments.length>0?((!C||!ae||Se||q)&&X(ae?de():Ee),Ee):de()})}var Me=!1,ke=((g&W0)!==0?Zu:Hf)(()=>(Me=!1,de()));z&&De(ke);var Ce=Zt;return(function(Ee,ae){if(arguments.length>0){const $e=ae?De(ke):C&&z?Fa(Ee):Ee;return Tr(ke,$e),Me=!0,o!==void 0&&(o=$e),Ee}return Uo&&Me||(Ce.f&jo)!==0?ke.v:De(ke)})}function Fy(u){Er===null&&qf(),uc&&Er.l!==null?p1(Er).m.push(u):Oa(()=>{const d=On(u);if(typeof d=="function")return d})}function Oy(u){Er===null&&qf(),Fy(()=>()=>On(u))}function p1(u){var d=u.l;return d.u??={a:[],b:[],m:[]}}const f1="5";typeof window<"u"&&((window.__svelte??={}).v??=new Set).add(f1);let f_=()=>"",m1=class{_={c:[]};static onInvalid=d=>{f_=d};constructor(d){d&&(this._=d)}cx=d=>{const g=this._.c[d];return typeof g=="string"?[g]:Array.isArray(g)?g:[f_(d,this._.c)]};tx=(d,g=[],w=1)=>{let C="";for(let z=w;z<d.length;z++){const T=d[z];typeof T=="string"?C+=T:C+=g[T]}return C};tp=d=>this._.c[d]??[];t=(d,g=[])=>this.tx(this.cx(d),g,0)};const Ku=u=>new m1(u),g1="modulepreload",_1=function(u){return"/ltn/"+u},m_={},_f=function(d,g,w){let C=Promise.resolve();if(g&&g.length>0){let B=function(K){return Promise.all(K.map(X=>Promise.resolve(X).then(ce=>({status:"fulfilled",value:ce}),ce=>({status:"rejected",reason:ce}))))};document.getElementsByTagName("link");const T=document.querySelector("meta[property=csp-nonce]"),o=T?.nonce||T?.getAttribute("nonce");C=B(g.map(K=>{if(K=_1(K),K in m_)return;m_[K]=!0;const X=K.endsWith(".css"),ce=X?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${K}"]${ce}`))return;const he=document.createElement("link");if(he.rel=X?"stylesheet":g1,X||(he.as="script"),he.crossOrigin="",he.href=K,o&&he.setAttribute("nonce",o),document.head.appendChild(he),X)return new Promise((q,de)=>{he.addEventListener("load",q),he.addEventListener("error",()=>de(new Error(`Unable to preload CSS for ${K}`)))})}))}function z(T){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=T,window.dispatchEvent(o),!o.defaultPrevented)throw T}return C.then(T=>{for(const o of T||[])o.status==="rejected"&&z(o.reason);return d().catch(z)})},y1={main:{en:()=>_f(()=>import("./loader.svelte-CbsABIej.js"),[]),fr:()=>_f(()=>import("./loader.svelte-BB4Q8Gx7.js"),[]),hu:()=>_f(()=>import("./loader.svelte-GJnPtAlK.js"),[])}},v1=(u,d)=>y1[u][d](),x1=["main"],b1="main";function jy(u){return{get:d=>u[d],set:(d,g)=>{d in u?Object.assign(u[d],g):u[d]=g}}}const yd={},w1={c:[]};function T1(u,d,g,w){yd[u]={load:d,loadIDs:g,collection:w??jy({})};for(const C of g)yd[u].collection.set(C,w1);return C=>yd[u].collection.get(C)}function S1(u){return Object.values(yd)}async function IS(u,d){const g=[],w=[];for(const C of S1())for(const z of C.loadIDs)g.push(C.load(z,u)),w.push([z,C]);for(const[C,z]of(await Promise.all(g)).entries()){const[T,o]=w[C];o.collection.set(T,z)}}const P1=Fa({}),Yu=T1(b1,v1,x1,jy(P1));function Tn(u,d){ss(d,!0);const g=hr(d,"n",3,!1);var w=Qn(),C=Ki(w);My(C,17,()=>d.x,Py,(z,T,o)=>{var B=Qn(),K=Ki(B);{var X=he=>{var q=lf();Zr(()=>sr(q,De(T))),_t(he,q)},ce=he=>{var q=Qn(),de=Ki(q);{var Se=ke=>{var Ce=Qn(),Ee=Ki(Ce);{var ae=$e=>{var Re=lf();Zr(()=>sr(Re,d.a[De(T)])),_t($e,Re)};Na(Ee,$e=>{(!g()||o>0)&&$e(ae)})}_t(ke,Ce)},Me=ke=>{const Ce=ar(()=>d.t[De(T)[0]]);var Ee=Qn(),ae=Ki(Ee);{var $e=Oe=>{var Xe=lf("[i18n-404:tag]");_t(Oe,Xe)},Re=Oe=>{var Xe=Qn(),gt=Ki(Xe);Ga(gt,()=>De(Ce),()=>De(T)),_t(Oe,Xe)};Na(ae,Oe=>{De(Ce)==null?Oe($e):Oe(Re,!1)})}_t(ke,Ee)};Na(de,ke=>{typeof De(T)=="number"?ke(Se):ke(Me,!1)},!0)}_t(he,q)};Na(K,he=>{typeof De(T)=="string"?he(X):he(ce,!1)})}_t(z,B)}),_t(u,w),as()}var M1=Xt('<a href="https://github.com/a-b-street/ltn" target="_blank"> </a>'),C1=Xt('<a href="https://www.transport.gov.scot/" target="_blank"> </a>'),I1=Xt('<a href="https://www.sustrans.org.uk" target="_blank"> </a>'),E1=Xt('<a href="https://abstreet.uk" target="_blank"> </a>'),A1=Xt('<a href="https://github.com/michaelkirk/" target="_blank"> </a>'),k1=Xt('<a href="https://www.linkedin.com/in/congying-hu/" target="_blank"> </a>'),z1=Xt("<li><!></li>"),D1=Xt('<a href="https://www.linkedin.com/in/angus-calder-a69543206" target="_blank"> </a>'),R1=Xt("<li><!></li>"),L1=Xt("<li> </li>"),B1=Xt('<a href="https://www.linkedin.com/in/matthew-davis-6b3a8124/" target="_blank"> </a>'),F1=Xt("<li><!></li>"),O1=Xt("<ul><!></ul>"),j1=Xt('<a href="https://a-b-street.github.io/docs/software/ltn/index.html#credits" target="_blank"> </a>'),N1=Xt('<p><!></p> <ul><li><!></li> <li><!></li> <li><!></li></ul> <p><!></p> <ul><li><a href="https://github.com/XioNoX" target="_blank"> </a></li> <li><a href="https://github.com/rouelibre1" target="_blank"> </a></li> <li><a href="https://github.com/TFCx" target="_blank"> </a></li></ul> <p> </p> <ul><li><a href="https://www.openstreetmap.org/about" target="_blank"> </a></li> <li><a href="https://www.maptiler.com/" target="_blank"> </a></li> <li><a href="https://georust.org/" target="_blank"> </a></li> <li><a href="https://lucide.dev/" target="_blank"> </a></li> <li> </li></ul> <p> </p>',1);function ES(u,d){ss(d,!0);const g=ar(()=>Ku(Yu("main")));var w=N1(),C=Ki(w);{const Vt=(Ot,Rt=fr)=>{var yt=M1(),Gt=tt(yt);Zr(mr=>sr(Gt,mr),[()=>De(g).tx(Rt())]),_t(Ot,yt)},kt=(Ot,Rt=fr)=>{var yt=C1(),Gt=tt(yt);Zr(mr=>sr(Gt,mr),[()=>De(g).tx(Rt())]),_t(Ot,yt)},Ft=(Ot,Rt=fr)=>{var yt=I1(),Gt=tt(yt);Zr(mr=>sr(Gt,mr),[()=>De(g).tx(Rt())]),_t(Ot,yt)};var z=tt(C);{let Ot=ar(()=>[Vt,kt,Ft]),Rt=ar(()=>De(g).cx(0));Tn(z,{get t(){return De(Ot)},get x(){return De(Rt)}})}}var T=Ir(C,2),o=tt(T);{const Vt=(kt,Ft=fr)=>{var Ot=E1(),Rt=tt(Ot);Zr(yt=>sr(Rt,yt),[()=>De(g).tx(Ft())]),_t(kt,Ot)};var B=tt(o);{let kt=ar(()=>[Vt]),Ft=ar(()=>De(g).cx(1));Tn(B,{get t(){return De(kt)},get x(){return De(Ft)}})}}var K=Ir(o,2);{const Vt=(kt,Ft=fr)=>{var Ot=A1(),Rt=tt(Ot);Zr(yt=>sr(Rt,yt),[()=>De(g).tx(Ft())]),_t(kt,Ot)};var X=tt(K);{let kt=ar(()=>[Vt]),Ft=ar(()=>De(g).cx(2));Tn(X,{get t(){return De(kt)},get x(){return De(Ft)}})}}var ce=Ir(K,2);{const Vt=(kt,Ft=fr)=>{var Ot=O1();{const yt=(xr,Ar=fr)=>{var pr=z1();{const br=(gr,Br=fr)=>{var Fr=k1(),Qr=tt(Fr);Zr(ei=>sr(Qr,ei),[()=>De(g).tx(Br())]),_t(gr,Fr)};var Sr=tt(pr);{let gr=ar(()=>[br]);Tn(Sr,{get t(){return De(gr)},get x(){return Ar()},n:!0})}}_t(xr,pr)},Gt=(xr,Ar=fr)=>{var pr=R1();{const br=(gr,Br=fr)=>{var Fr=D1(),Qr=tt(Fr);Zr(ei=>sr(Qr,ei),[()=>De(g).tx(Br())]),_t(gr,Fr)};var Sr=tt(pr);{let gr=ar(()=>[br]);Tn(Sr,{get t(){return De(gr)},get x(){return Ar()},n:!0})}}_t(xr,pr)},mr=(xr,Ar=fr)=>{var pr=L1(),Sr=tt(pr);Zr(br=>sr(Sr,br),[()=>De(g).tx(Ar())]),_t(xr,pr)},Gr=(xr,Ar=fr)=>{var pr=F1();{const br=(gr,Br=fr)=>{var Fr=B1(),Qr=tt(Fr);Zr(ei=>sr(Qr,ei),[()=>De(g).tx(Br())]),_t(gr,Fr)};var Sr=tt(pr);{let gr=ar(()=>[br]);Tn(Sr,{get t(){return De(gr)},get x(){return Ar()},n:!0})}}_t(xr,pr)};var Rt=tt(Ot);{let xr=ar(()=>[yt,Gt,mr,Gr]);Tn(Rt,{get t(){return De(xr)},get x(){return Ft()},n:!0})}}_t(kt,Ot)};var he=tt(ce);{let kt=ar(()=>[Vt]),Ft=ar(()=>De(g).cx(3));Tn(he,{get t(){return De(kt)},get x(){return De(Ft)}})}}var q=Ir(T,2);{const Vt=(kt,Ft=fr)=>{var Ot=j1(),Rt=tt(Ot);Zr(yt=>sr(Rt,yt),[()=>De(g).tx(Ft())]),_t(kt,Ot)};var de=tt(q);{let kt=ar(()=>[Vt]),Ft=ar(()=>De(g).cx(4));Tn(de,{get t(){return De(kt)},get x(){return De(Ft)}})}}var Se=Ir(q,2),Me=tt(Se),ke=tt(Me),Ce=tt(ke),Ee=Ir(Me,2),ae=tt(Ee),$e=tt(ae),Re=Ir(Ee,2),Oe=tt(Re),Xe=tt(Oe),gt=Ir(Se,2),at=tt(gt),rt=Ir(gt,2),nt=tt(rt),mt=tt(nt),At=tt(mt),St=Ir(nt,2),jt=tt(St),Mt=tt(jt),pt=Ir(St,2),ht=tt(pt),lr=tt(ht),Nt=Ir(pt,2),qt=tt(Nt),Kt=tt(qt),Jt=Ir(Nt,2),vr=tt(Jt),Qt=Ir(rt,2),Jr=tt(Qt);Zr((Vt,kt,Ft,Ot,Rt,yt,Gt,mr,Gr,xr)=>{sr(Ce,Vt),sr($e,kt),sr(Xe,Ft),sr(at,Ot),sr(At,Rt),sr(Mt,yt),sr(lr,Gt),sr(Kt,mr),sr(vr,Gr),sr(Jr,xr)},[()=>De(g).t(5),()=>De(g).t(6),()=>De(g).t(7),()=>De(g).t(8),()=>De(g).t(9),()=>De(g).t(10),()=>De(g).t(11),()=>De(g).t(12),()=>De(g).t(13),()=>De(g).t(14)]),_t(u,w),as()}ab();/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 * ---
 * 
 * The MIT License (MIT) (for portions derived from Feather)
 * 
 * Copyright (c) 2013-2023 Cole Bemis
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const V1={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};var U1=Zb("<svg><!><!></svg>");function $d(u,d){const g=rc(d,["children","$$slots","$$events","$$legacy"]),w=rc(g,["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"]);ss(d,!1);let C=hr(d,"name",8,void 0),z=hr(d,"color",8,"currentColor"),T=hr(d,"size",8,24),o=hr(d,"strokeWidth",8,2),B=hr(d,"absoluteStrokeWidth",8,!1),K=hr(d,"iconNode",24,()=>[]);const X=(...de)=>de.filter((Se,Me,ke)=>!!Se&&ke.indexOf(Se)===Me).join(" ");a1();var ce=U1();o_(ce,(de,Se)=>({...V1,...w,width:T(),height:T(),stroke:z(),"stroke-width":de,class:Se}),[()=>(zo(B()),zo(o()),zo(T()),On(()=>B()?Number(o())*24/Number(T()):o())),()=>(zo(C()),zo(g),On(()=>X("lucide-icon","lucide",C()?`lucide-${C()}`:"",g.class)))]);var he=tt(ce);My(he,1,K,Py,(de,Se)=>{var Me=ar(()=>z0(De(Se),2));let ke=()=>De(Me)[0],Ce=()=>De(Me)[1];var Ee=Qn(),ae=Ki(Ee);Xb(ae,ke,!0,($e,Re)=>{o_($e,()=>({...Ce()}))}),_t(de,Ee)});var q=Ir(he);Xu(q,d,"default",{}),_t(u,ce),as()}function $1(u,d){const g=rc(d,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const w=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];$d(u,Ud({name:"circle-question-mark"},()=>g,{get iconNode(){return w},children:(C,z)=>{var T=Qn(),o=Ki(T);Xu(o,d,"default",{}),_t(C,T)},$$slots:{default:!0}}))}function Z1(u,d){const g=rc(d,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const w=[["path",{d:"m15 18-.722-3.25"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0"}],["path",{d:"m20 15-1.726-2.05"}],["path",{d:"m4 15 1.726-2.05"}],["path",{d:"m9 18 .722-3.25"}]];$d(u,Ud({name:"eye-closed"},()=>g,{get iconNode(){return w},children:(C,z)=>{var T=Qn(),o=Ki(T);Xu(o,d,"default",{}),_t(C,T)},$$slots:{default:!0}}))}function G1(u,d){const g=rc(d,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const w=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];$d(u,Ud({name:"eye"},()=>g,{get iconNode(){return w},children:(C,z)=>{var T=Qn(),o=Ki(T);Xu(o,d,"default",{}),_t(C,T)},$$slots:{default:!0}}))}function q1(u,d){const g=rc(d,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.544.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2023 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2025.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 * ---
 *
 * The MIT License (MIT) (for portions derived from Feather)
 *
 * Copyright (c) 2013-2023 Cole Bemis
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 *
 */const w=[["path",{d:"m5 8 6 6"}],["path",{d:"m4 14 6-6 2-3"}],["path",{d:"M2 5h12"}],["path",{d:"M7 2h1"}],["path",{d:"m22 22-5-10-5 10"}],["path",{d:"M14 18h6"}]];$d(u,Ud({name:"languages"},()=>g,{get iconNode(){return w},children:(C,z)=>{var T=Qn(),o=Ki(T);Xu(o,d,"default",{}),_t(C,T)},$$slots:{default:!0}}))}var W1=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],H1=["difference","intersection","symmetricDifference","union"],g_=!1;class Ad extends Set{#t=new Map;#e=si(0);#i=si(0);#n=ia||-1;constructor(d){if(super(),d){for(var g of d)super.add(g);this.#i.v=super.size}g_||this.#s()}#l(d){return ia===this.#n?si(d):ns(d)}#s(){g_=!0;var d=Ad.prototype,g=Set.prototype;for(const w of W1)d[w]=function(...C){return De(this.#e),g[w].apply(this,C)};for(const w of H1)d[w]=function(...C){De(this.#e);var z=g[w].apply(this,C);return new Ad(z)}}has(d){var g=super.has(d),w=this.#t,C=w.get(d);if(C===void 0){if(!g)return De(this.#e),!1;C=this.#l(!0),w.set(d,C)}return De(C),g}add(d){return super.has(d)||(super.add(d),Tr(this.#i,super.size),$a(this.#e)),this}delete(d){var g=super.delete(d),w=this.#t,C=w.get(d);return C!==void 0&&(w.delete(d),Tr(C,!1)),g&&(Tr(this.#i,super.size),$a(this.#e)),g}clear(){if(super.size!==0){super.clear();var d=this.#t;for(var g of d.values())Tr(g,!1);d.clear(),Tr(this.#i,0),$a(this.#e)}}keys(){return this.values()}values(){return De(this.#e),super.values()}entries(){return De(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return De(this.#i)}}let X1=Date.now();function AS(u){return`${u}-${X1++}`}class Bo{#t=si();get value(){return De(this.#t)}set value(d){Tr(this.#t,d,!0)}constructor(d){this.value=d}}class K1{#t=si();get map(){return De(this.#t)}set map(d){Tr(this.#t,d,!0)}#e=si(!1);get loaded(){return De(this.#e)}set loaded(d){Tr(this.#e,d,!0)}loadedImages=new Ad;#i=si(0);get minzoom(){return De(this.#i)}set minzoom(d){Tr(this.#i,d,!0)}#n=si(24);get maxzoom(){return De(this.#n)}set maxzoom(d){Tr(this.#n,d,!0)}layerInfo=new Map;eventTracker=new WeakMap;_eventTopMost(d){let g=this.eventTracker.get(d.originalEvent);if(g!==void 0)return g;let C=d.target.queryRenderedFeatures(d.point).find(z=>this.layerInfo.get(z.layer.id)?.interactive)?.layer.id;return this.eventTracker.set(d.originalEvent,C),C}eventTopMost;markerClickManager=new nw;constructor(){this.eventTopMost=this._eventTopMost.bind(this)}}function Y1(u){No(Zy,u)}function kS(){return hc(Zy)}function J1(u){No(Gy,u)}function zS(){return hc(Gy)}function Ny(u){No($y,u)}function DS(){return hc($y)}function Q1(u){No(tw,u)}function RS(){return hc(qy)}function Vy(u){No(qy,u)}function ew(u){No(Wy,u)}function LS(){return hc(Wy)}const Uy=Symbol.for("svelte-maplibre"),$y=Symbol.for("svelte-maplibre.popup-target"),Zy=Symbol.for("svelte-maplibre.layer"),Gy=Symbol.for("svelte-maplibre.source"),tw=Symbol.for("svelte-maplibre.cluster"),qy=Symbol.for("svelte-maplibre.layer-event"),Wy=Symbol.for("svelte-maplibre.lng-lat");function rw(){return hc(Uy)}function BS(){return No(Uy,new K1)}function FS(){const u=new Bo(void 0),d=new Bo(void 0);return J1(u),Q1(d),{source:u,cluster:d}}function OS(u=!0){const d=new Bo(void 0),g=new Bo(void 0);return Y1(d),u&&(Ny(d),Vy(g)),{layer:d,layerEvent:g}}function iw(){const u=new Bo(void 0),d=new Bo(void 0);return Ny(u),Vy(d),{marker:u,layerEvent:d}}function jS(u){return"layerType"in u&&u.layerType==="deckgl"}class nw{_handlers=new Set;add(d){this._handlers.add(d)}remove(d){this._handlers.delete(d)}handleClick(d){for(const g of this._handlers)g(d)}}function sw(u){return u&&u.__esModule&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u}var vd={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.6.2/LICENSE.txt
 */var aw=vd.exports,__;function ow(){return __||(__=1,(function(u,d){(function(g,w){u.exports=w()})(aw,(function(){var g={},w={};function C(T,o,B){if(w[T]=B,T==="index"){var K="var sharedModule = {}; ("+w.shared+")(sharedModule); ("+w.worker+")(sharedModule);",X={};return w.shared(X),w.index(g,X),typeof window<"u"&&g.setWorkerUrl(window.URL.createObjectURL(new Blob([K],{type:"text/javascript"}))),g}}C("shared",["exports"],(function(T){function o(i,t,r,s){return new(r||(r=Promise))((function(l,f){function m(S){try{v(s.next(S))}catch(M){f(M)}}function y(S){try{v(s.throw(S))}catch(M){f(M)}}function v(S){var M;S.done?l(S.value):(M=S.value,M instanceof r?M:new r((function(E){E(M)}))).then(m,y)}v((s=s.apply(i,t||[])).next())}))}function B(i,t){this.x=i,this.y=t}function K(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var X,ce;typeof SuppressedError=="function"&&SuppressedError,B.prototype={clone(){return new B(this.x,this.y)},add(i){return this.clone()._add(i)},sub(i){return this.clone()._sub(i)},multByPoint(i){return this.clone()._multByPoint(i)},divByPoint(i){return this.clone()._divByPoint(i)},mult(i){return this.clone()._mult(i)},div(i){return this.clone()._div(i)},rotate(i){return this.clone()._rotate(i)},rotateAround(i,t){return this.clone()._rotateAround(i,t)},matMult(i){return this.clone()._matMult(i)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(i){return this.x===i.x&&this.y===i.y},dist(i){return Math.sqrt(this.distSqr(i))},distSqr(i){const t=i.x-this.x,r=i.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith(i){return this.angleWithSep(i.x,i.y)},angleWithSep(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult(i){const t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add(i){return this.x+=i.x,this.y+=i.y,this},_sub(i){return this.x-=i.x,this.y-=i.y,this},_mult(i){return this.x*=i,this.y*=i,this},_div(i){return this.x/=i,this.y/=i,this},_multByPoint(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint(i){return this.x/=i.x,this.y/=i.y,this},_unit(){return this._div(this.mag()),this},_perp(){const i=this.y;return this.y=this.x,this.x=-i,this},_rotate(i){const t=Math.cos(i),r=Math.sin(i),s=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=s,this},_rotateAround(i,t){const r=Math.cos(i),s=Math.sin(i),l=t.y+s*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-s*(this.y-t.y),this.y=l,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:B},B.convert=function(i){if(i instanceof B)return i;if(Array.isArray(i))return new B(+i[0],+i[1]);if(i.x!==void 0&&i.y!==void 0)return new B(+i.x,+i.y);throw new Error("Expected [x, y] or {x, y} point format")};var he=(function(){if(ce)return X;function i(t,r,s,l){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=s,this.p2y=l}return ce=1,X=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var s=t,l=0;l<8;l++){var f=this.sampleCurveX(s)-t;if(Math.abs(f)<r)return s;var m=this.sampleCurveDerivativeX(s);if(Math.abs(m)<1e-6)break;s-=f/m}var y=0,v=1;for(s=t,l=0;l<20&&(f=this.sampleCurveX(s),!(Math.abs(f-t)<r));l++)t>f?y=s:v=s,s=.5*(v-y)+y;return s},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},X})(),q=K(he);let de,Se;function Me(){return de==null&&(de=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),de}function ke(){if(Se==null&&(Se=!1,Me())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let s=0;s<25;s++){const l=4*s;t.fillStyle=`rgb(${l},${l+1},${l+2})`,t.fillRect(s%5,Math.floor(s/5),1,1)}const r=t.getImageData(0,0,5,5).data;for(let s=0;s<100;s++)if(s%4!=3&&r[s]!==s){Se=!0;break}}}return Se||!1}var Ce=1e-6,Ee=typeof Float32Array<"u"?Float32Array:Array;function ae(){var i=new Ee(9);return Ee!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[5]=0,i[6]=0,i[7]=0),i[0]=1,i[4]=1,i[8]=1,i}function $e(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Re(){var i=new Ee(3);return Ee!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i}function Oe(i){return Math.hypot(i[0],i[1],i[2])}function Xe(i,t,r){var s=new Ee(3);return s[0]=i,s[1]=t,s[2]=r,s}function gt(i,t,r){return i[0]=t[0]+r[0],i[1]=t[1]+r[1],i[2]=t[2]+r[2],i}function at(i,t,r){return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i}function rt(i,t,r){var s=t[0],l=t[1],f=t[2],m=r[0],y=r[1],v=r[2];return i[0]=l*v-f*y,i[1]=f*m-s*v,i[2]=s*y-l*m,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var nt,mt=Oe;function At(i,t,r){var s=t[0],l=t[1],f=t[2],m=t[3];return i[0]=r[0]*s+r[4]*l+r[8]*f+r[12]*m,i[1]=r[1]*s+r[5]*l+r[9]*f+r[13]*m,i[2]=r[2]*s+r[6]*l+r[10]*f+r[14]*m,i[3]=r[3]*s+r[7]*l+r[11]*f+r[15]*m,i}function St(){var i=new Ee(4);return Ee!=Float32Array&&(i[0]=0,i[1]=0,i[2]=0),i[3]=1,i}function jt(i,t,r,s){var l=.5*Math.PI/180;t*=l,r*=l,s*=l;var f=Math.sin(t),m=Math.cos(t),y=Math.sin(r),v=Math.cos(r),S=Math.sin(s),M=Math.cos(s);return i[0]=f*v*M-m*y*S,i[1]=m*y*M+f*v*S,i[2]=m*v*S-f*y*M,i[3]=m*v*M+f*y*S,i}function Mt(){var i=new Ee(2);return Ee!=Float32Array&&(i[0]=0,i[1]=0),i}function pt(i,t){var r=new Ee(2);return r[0]=i,r[1]=t,r}Re(),nt=new Ee(4),Ee!=Float32Array&&(nt[0]=0,nt[1]=0,nt[2]=0,nt[3]=0),Re(),Xe(1,0,0),Xe(0,1,0),St(),St(),ae(),Mt();const ht=8192;function lr(i,t,r){return t*(ht/(i.tileSize*Math.pow(2,r-i.tileID.overscaledZ)))}function Nt(i,t){return(i%t+t)%t}function qt(i,t,r){return i*(1-r)+t*r}function Kt(i){if(i<=0)return 0;if(i>=1)return 1;const t=i*i,r=t*i;return 4*(i<.5?r:3*(i-t)+r-.75)}function Jt(i,t,r,s){const l=new q(i,t,r,s);return f=>l.solve(f)}const vr=Jt(.25,.1,.25,1);function Qt(i,t,r){return Math.min(r,Math.max(t,i))}function Jr(i,t,r){const s=r-t,l=((i-t)%s+s)%s+t;return l===t?r:l}function Vt(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}let kt=1;function Ft(i,t,r){const s={};for(const l in i)s[l]=t.call(this,i[l],l,i);return s}function Ot(i,t,r){const s={};for(const l in i)t.call(this,i[l],l,i)&&(s[l]=i[l]);return s}function Rt(i){return Array.isArray(i)?i.map(Rt):typeof i=="object"&&i?Ft(i,Rt):i}const yt={};function Gt(i){yt[i]||(typeof console<"u"&&console.warn(i),yt[i]=!0)}function mr(i,t,r){return(r.y-i.y)*(t.x-i.x)>(t.y-i.y)*(r.x-i.x)}function Gr(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let xr=null;function Ar(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const pr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Sr(i,t,r,s,l){return o(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const f=new VideoFrame(i,{timestamp:0});try{const m=f?.format;if(!m||!m.startsWith("BGR")&&!m.startsWith("RGB"))throw new Error(`Unrecognized format ${m}`);const y=m.startsWith("BGR"),v=new Uint8ClampedArray(s*l*4);if(yield f.copyTo(v,(function(S,M,E,D,L){const F=4*Math.max(-M,0),N=(Math.max(0,E)-E)*D*4+F,Z=4*D,Y=Math.max(0,M),me=Math.max(0,E);return{rect:{x:Y,y:me,width:Math.min(S.width,M+D)-Y,height:Math.min(S.height,E+L)-me},layout:[{offset:N,stride:Z}]}})(i,t,r,s,l)),y)for(let S=0;S<v.length;S+=4){const M=v[S];v[S]=v[S+2],v[S+2]=M}return v}finally{f.close()}}))}let br,gr;function Br(i,t,r,s){return i.addEventListener(t,r,s),{unsubscribe:()=>{i.removeEventListener(t,r,s)}}}function Fr(i){return i*Math.PI/180}function Qr(i){return i/Math.PI*180}const ei={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Ui={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},an="AbortError";function fe(){return new Error(an)}const j={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function V(i){return j.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const $="global-dispatcher";class te extends Error{constructor(t,r,s,l){super(`AJAXError: ${r} (${t}): ${s}`),this.status=t,this.statusText=r,this.url=s,this.body=l}}const U=()=>Gr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,re=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const s=V(i.url);if(s)return s(i,t);if(Gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:$},t)}if(!(/^file:/.test(r=i.url)||/^file:/.test(U())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(s,l){return o(this,void 0,void 0,(function*(){const f=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:U(),signal:l.signal});let m,y;s.type!=="json"||f.headers.has("Accept")||f.headers.set("Accept","application/json");try{m=yield fetch(f)}catch(S){throw new te(0,S.message,s.url,new Blob)}if(!m.ok){const S=yield m.blob();throw new te(m.status,m.statusText,s.url,S)}y=s.type==="arrayBuffer"||s.type==="image"?m.arrayBuffer():s.type==="json"?m.json():m.text();const v=yield y;if(l.signal.aborted)throw fe();return{data:v,cacheControl:m.headers.get("Cache-Control"),expires:m.headers.get("Expires")}}))})(i,t);if(Gr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:$},t)}var r;return(function(s,l){return new Promise(((f,m)=>{var y;const v=new XMLHttpRequest;v.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(v.responseType="arraybuffer");for(const S in s.headers)v.setRequestHeader(S,s.headers[S]);s.type==="json"&&(v.responseType="text",!((y=s.headers)===null||y===void 0)&&y.Accept||v.setRequestHeader("Accept","application/json")),v.withCredentials=s.credentials==="include",v.onerror=()=>{m(new Error(v.statusText))},v.onload=()=>{if(!l.signal.aborted)if((v.status>=200&&v.status<300||v.status===0)&&v.response!==null){let S=v.response;if(s.type==="json")try{S=JSON.parse(v.response)}catch(M){return void m(M)}f({data:S,cacheControl:v.getResponseHeader("Cache-Control"),expires:v.getResponseHeader("Expires")})}else{const S=new Blob([v.response],{type:v.getResponseHeader("Content-Type")});m(new te(v.status,v.statusText,s.url,S))}},l.signal.addEventListener("abort",(()=>{v.abort(),m(fe())})),v.send(s.body)}))})(i,t)};function pe(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),r=window.location;return t.protocol===r.protocol&&t.host===r.host}function le(i,t,r){r[i]&&r[i].indexOf(t)!==-1||(r[i]=r[i]||[],r[i].push(t))}function ye(i,t,r){if(r&&r[i]){const s=r[i].indexOf(t);s!==-1&&r[i].splice(s,1)}}class ze{constructor(t,r={}){Vt(this,r),this.type=t}}class Ie extends ze{constructor(t,r={}){super("error",Vt({error:t},r))}}class Ke{on(t,r){return this._listeners=this._listeners||{},le(t,r,this._listeners),{unsubscribe:()=>{this.off(t,r)}}}off(t,r){return ye(t,r,this._listeners),ye(t,r,this._oneTimeListeners),this}once(t,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},le(t,r,this._oneTimeListeners),this):new Promise((s=>this.once(t,s)))}fire(t,r){typeof t=="string"&&(t=new ze(t,r||{}));const s=t.type;if(this.listens(s)){t.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of l)y.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of f)ye(s,y,this._oneTimeListeners),y.call(this,t);const m=this._eventedParent;m&&(Vt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof Ie&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,r){return this._eventedParent=t,this._eventedParentData=r,this}}var _e={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const ot=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function bt(i,t){const r={};for(const s in i)s!=="ref"&&(r[s]=i[s]);return ot.forEach((s=>{s in t&&(r[s]=t[s])})),r}function Qe(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let r=0;r<i.length;r++)if(!Qe(i[r],t[r]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const r in i)if(!Qe(i[r],t[r]))return!1;return!0}return i===t}function dt(i,t){i.push(t)}function tr(i,t,r){dt(r,{command:"addSource",args:[i,t[i]]})}function kr(i,t,r){dt(t,{command:"removeSource",args:[i]}),r[i]=!0}function Pr(i,t,r,s){kr(i,r,s),tr(i,t,r)}function Ur(i,t,r){let s;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!Qe(i[r][s],t[r][s]))return!1;for(s in t[r])if(Object.prototype.hasOwnProperty.call(t[r],s)&&s!=="data"&&!Qe(i[r][s],t[r][s]))return!1;return!0}function zt(i,t,r,s,l,f){i=i||{},t=t||{};for(const m in i)Object.prototype.hasOwnProperty.call(i,m)&&(Qe(i[m],t[m])||r.push({command:f,args:[s,m,t[m],l]}));for(const m in t)Object.prototype.hasOwnProperty.call(t,m)&&!Object.prototype.hasOwnProperty.call(i,m)&&(Qe(i[m],t[m])||r.push({command:f,args:[s,m,t[m],l]}))}function Ut(i){return i.id}function qr(i,t){return i[t.id]=t,i}class je{constructor(t,r,s,l){this.message=(t?`${t}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function xi(i,...t){for(const r of t)for(const s in r)i[s]=r[s];return i}class zr extends Error{constructor(t,r){super(r),this.message=r,this.key=t}}class os{constructor(t,r=[]){this.parent=t,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(t){return new os(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const oa={kind:"null"},We={kind:"number"},Ct={kind:"string"},Pt={kind:"boolean"},mi={kind:"color"},ks={kind:"projectionDefinition"},ls={kind:"object"},wt={kind:"value"},Zo={kind:"collator"},cs={kind:"formatted"},Go={kind:"padding"},In={kind:"colorArray"},la={kind:"numberArray"},Or={kind:"resolvedImage"},qo={kind:"variableAnchorOffsetCollection"};function Ri(i,t){return{kind:"array",itemType:i,N:t}}function cr(i){if(i.kind==="array"){const t=cr(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const rh=[oa,We,Ct,Pt,mi,ks,cs,ls,Ri(wt),Go,la,In,Or,qo];function Xa(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Xa(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const r of rh)if(!Xa(r,t))return null}}return`Expected ${cr(i)} but found ${cr(t)} instead.`}function mc(i,t){return t.some((r=>r.kind===i.kind))}function us(i,t){return t.some((r=>r==="null"?i===null:r==="array"?Array.isArray(i):r==="object"?i&&!Array.isArray(i)&&typeof i=="object":r===typeof i))}function hs(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const gc=.96422,ih=.82521,nh=4/29,ca=6/29,sh=3*ca*ca,qd=ca*ca*ca,Wd=Math.PI/180,Hd=180/Math.PI;function _c(i){return(i%=360)<0&&(i+=360),i}function ua([i,t,r,s]){let l,f;const m=vc((.2225045*(i=yc(i))+.7168786*(t=yc(t))+.0606169*(r=yc(r)))/1);i===t&&t===r?l=f=m:(l=vc((.4360747*i+.3850649*t+.1430804*r)/gc),f=vc((.0139322*i+.0971045*t+.7141733*r)/ih));const y=116*m-16;return[y<0?0:y,500*(l-m),200*(m-f),s]}function yc(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function vc(i){return i>qd?Math.pow(i,1/3):i/sh+nh}function ha([i,t,r,s]){let l=(i+16)/116,f=isNaN(t)?l:l+t/500,m=isNaN(r)?l:l-r/200;return l=1*bc(l),f=gc*bc(f),m=ih*bc(m),[xc(3.1338561*f-1.6168667*l-.4906146*m),xc(-.9787684*f+1.9161415*l+.033454*m),xc(.0719453*f-.2289914*l+1.4052427*m),s]}function xc(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function bc(i){return i>ca?i*i*i:sh*(i-nh)}const Xd=Object.hasOwn||function(i,t){return Object.prototype.hasOwnProperty.call(i,t)};function da(i,t){return Xd(i,t)?i[t]:void 0}function Ka(i){return parseInt(i.padEnd(2,i),16)/255}function on(i,t){return It(t?i/100:i,0,1)}function It(i,t,r){return Math.min(Math.max(t,i),r)}function zs(i){return!i.some(Number.isNaN)}const ds={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Vn(i,t,r){return i+r*(t-i)}function Ds(i,t,r){return i.map(((s,l)=>Vn(s,t[l],r)))}class Et{constructor(t,r,s,l=1,f=!0){this.r=t,this.g=r,this.b=s,this.a=l,f||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[t,r,s,l]))}static parse(t){if(t instanceof Et)return t;if(typeof t!="string")return;const r=(function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=da(ds,s);if(l){const[m,y,v]=l;return[m/255,y/255,v/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const m=s.length<6?1:2;let y=1;return[Ka(s.slice(y,y+=m)),Ka(s.slice(y,y+=m)),Ka(s.slice(y,y+=m)),Ka(s.slice(y,y+m)||"ff")]}if(s.startsWith("rgb")){const m=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(m){const[y,v,S,M,E,D,L,F,N,Z,Y,me]=m,ne=[M||" ",L||" ",Z].join("");if(ne==="  "||ne==="  /"||ne===",,"||ne===",,,"){const oe=[S,D,N].join(""),be=oe==="%%%"?100:oe===""?255:0;if(be){const Pe=[It(+v/be,0,1),It(+E/be,0,1),It(+F/be,0,1),Y?on(+Y,me):1];if(zs(Pe))return Pe}}return}}const f=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[m,y,v,S,M,E,D,L,F]=f,N=[v||" ",M||" ",D].join("");if(N==="  "||N==="  /"||N===",,"||N===",,,"){const Z=[+y,It(+S,0,100),It(+E,0,100),L?on(+L,F):1];if(zs(Z))return(function([Y,me,ne,oe]){function be(Pe){const Be=(Pe+Y/30)%12,qe=me*Math.min(ne,1-ne);return ne-qe*Math.max(-1,Math.min(Be-3,9-Be,1))}return Y=_c(Y),me/=100,ne/=100,[be(0),be(8),be(4),oe]})(Z)}}})(t);return r?new Et(...r,!1):void 0}get rgb(){const{r:t,g:r,b:s,a:l}=this,f=l||1/0;return this.overwriteGetter("rgb",[t/f,r/f,s/f,l])}get hcl(){return this.overwriteGetter("hcl",(function(t){const[r,s,l,f]=ua(t),m=Math.sqrt(s*s+l*l);return[Math.round(1e4*m)?_c(Math.atan2(l,s)*Hd):NaN,m,r,f]})(this.rgb))}get lab(){return this.overwriteGetter("lab",ua(this.rgb))}overwriteGetter(t,r){return Object.defineProperty(this,t,{value:r}),r}toString(){const[t,r,s,l]=this.rgb;return`rgba(${[t,r,s].map((f=>Math.round(255*f))).join(",")},${l})`}static interpolate(t,r,s,l="rgb"){switch(l){case"rgb":{const[f,m,y,v]=Ds(t.rgb,r.rgb,s);return new Et(f,m,y,v,!1)}case"hcl":{const[f,m,y,v]=t.hcl,[S,M,E,D]=r.hcl;let L,F;if(isNaN(f)||isNaN(S))isNaN(f)?isNaN(S)?L=NaN:(L=S,y!==1&&y!==0||(F=M)):(L=f,E!==1&&E!==0||(F=m));else{let ne=S-f;S>f&&ne>180?ne-=360:S<f&&f-S>180&&(ne+=360),L=f+s*ne}const[N,Z,Y,me]=(function([ne,oe,be,Pe]){return ne=isNaN(ne)?0:ne*Wd,ha([be,Math.cos(ne)*oe,Math.sin(ne)*oe,Pe])})([L,F??Vn(m,M,s),Vn(y,E,s),Vn(v,D,s)]);return new Et(N,Z,Y,me,!1)}case"lab":{const[f,m,y,v]=ha(Ds(t.lab,r.lab,s));return new Et(f,m,y,v,!1)}}}}Et.black=new Et(0,0,0,1),Et.white=new Et(1,1,1,1),Et.transparent=new Et(0,0,0,0),Et.red=new Et(1,0,0,1);class Rs{constructor(t,r,s){this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,r){return this.collator.compare(t,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const Wo=["bottom","center","top"];class Ho{constructor(t,r,s,l,f,m){this.text=t,this.image=r,this.scale=s,this.fontStack=l,this.textColor=f,this.verticalAlign=m}}class Pi{constructor(t){this.sections=t}static fromString(t){return new Pi([new Ho(t,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||t.image&&t.image.name.length!==0))}static factory(t){return t instanceof Pi?t:Pi.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}}class ai{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof ai)return t;if(typeof t=="number")return new ai([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const r of t)if(typeof r!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new ai(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s){return new ai(Ds(t.values,r.values,s))}}class Mi{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Mi)return t;if(typeof t=="number")return new Mi([t]);if(Array.isArray(t)){for(const r of t)if(typeof r!="number")return;return new Mi(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s){return new Mi(Ds(t.values,r.values,s))}}class Wr{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Wr)return t;if(typeof t=="string"){const s=Et.parse(t);return s?new Wr([s]):void 0}if(!Array.isArray(t))return;const r=[];for(const s of t){if(typeof s!="string")return;const l=Et.parse(s);if(!l)return;r.push(l)}return new Wr(r)}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s,l="rgb"){const f=[];if(t.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${t.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let m=0;m<t.values.length;m++)f.push(Et.interpolate(t.values[m],r.values[m],s,l));return new Wr(f)}}class ur extends Error{constructor(t){super(t),this.name="RuntimeError"}toJSON(){return this.message}}const ah=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Ci{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Ci)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let r=0;r<t.length;r+=2){const s=t[r],l=t[r+1];if(typeof s!="string"||!ah.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new Ci(t)}}toString(){return JSON.stringify(this.values)}static interpolate(t,r,s){const l=t.values,f=r.values;if(l.length!==f.length)throw new ur(`Cannot interpolate values of different length. from: ${t.toString()}, to: ${r.toString()}`);const m=[];for(let y=0;y<l.length;y+=2){if(l[y]!==f[y])throw new ur(`Cannot interpolate values containing mismatched anchors. from[${y}]: ${l[y]}, to[${y}]: ${f[y]}`);m.push(l[y]);const[v,S]=l[y+1],[M,E]=f[y+1];m.push([Vn(v,M,s),Vn(S,E,s)])}return new Ci(m)}}class $i{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new $i({name:t,available:!1}):null}}class bi{constructor(t,r,s){this.from=t,this.to=r,this.transition=s}static interpolate(t,r,s){return new bi(t,r,s)}static parse(t){return t instanceof bi?t:Array.isArray(t)&&t.length===3&&typeof t[0]=="string"&&typeof t[1]=="string"&&typeof t[2]=="number"?new bi(t[0],t[1],t[2]):typeof t=="object"&&typeof t.from=="string"&&typeof t.to=="string"&&typeof t.transition=="number"?new bi(t.from,t.to,t.transition):typeof t=="string"?new bi(t,t,1):void 0}}function _r(i,t,r,s){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[i,t,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[i,t,r,s]:[i,t,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ls(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof bi||i instanceof Et||i instanceof Rs||i instanceof Pi||i instanceof ai||i instanceof Mi||i instanceof Wr||i instanceof Ci||i instanceof $i)return!0;if(Array.isArray(i)){for(const t of i)if(!Ls(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Ls(i[t]))return!1;return!0}return!1}function ct(i){if(i===null)return oa;if(typeof i=="string")return Ct;if(typeof i=="boolean")return Pt;if(typeof i=="number")return We;if(i instanceof Et)return mi;if(i instanceof bi)return ks;if(i instanceof Rs)return Zo;if(i instanceof Pi)return cs;if(i instanceof ai)return Go;if(i instanceof Mi)return la;if(i instanceof Wr)return In;if(i instanceof Ci)return qo;if(i instanceof $i)return Or;if(Array.isArray(i)){const t=i.length;let r;for(const s of i){const l=ct(s);if(r){if(r===l)continue;r=wt;break}r=l}return Ri(r||wt,t)}return ls}function vt(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Et||i instanceof bi||i instanceof Pi||i instanceof ai||i instanceof Mi||i instanceof Wr||i instanceof Ci||i instanceof $i?i.toString():JSON.stringify(i)}class Un{constructor(t,r){this.type=t,this.value=r}static parse(t,r){if(t.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ls(t[1]))return r.error("invalid value");const s=t[1];let l=ct(s);const f=r.expectedType;return l.kind!=="array"||l.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(l=f),new Un(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const $t={string:Ct,number:We,boolean:Pt,object:ls};class Zi{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s,l=1;const f=t[0];if(f==="array"){let y,v;if(t.length>2){const S=t[1];if(typeof S!="string"||!(S in $t)||S==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=$t[S],l++}else y=wt;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);v=t[2],l++}s=Ri(y,v)}else{if(!$t[f])throw new Error(`Types doesn't contain name = ${f}`);s=$t[f]}const m=[];for(;l<t.length;l++){const y=r.parse(t[l],l,wt);if(!y)return null;m.push(y)}return new Zi(s,m)}evaluate(t){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(t);if(!Xa(this.type,ct(s)))return s;if(r===this.args.length-1)throw new ur(`Expected value to be of type ${cr(this.type)}, but found ${cr(ct(s))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const En={"to-boolean":Pt,"to-color":mi,"to-number":We,"to-string":Ct};class An{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[0];if(!En[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&t.length!==2)return r.error("Expected one argument.");const l=En[s],f=[];for(let m=1;m<t.length;m++){const y=r.parse(t[m],m,wt);if(!y)return null;f.push(y)}return new An(l,f)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(t),s=null,r instanceof Et)return r;if(typeof r=="string"){const f=t.parseColor(r);if(f)return f}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:_r(r[0],r[1],r[2],r[3]),!s))return new Et(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new ur(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(t);const l=ai.parse(r);if(l)return l}throw new ur(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const s of this.args){r=s.evaluate(t);const l=Mi.parse(r);if(l)return l}throw new ur(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const s of this.args){r=s.evaluate(t);const l=Wr.parse(r);if(l)return l}throw new ur(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(t);const l=Ci.parse(r);if(l)return l}throw new ur(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(t),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new ur(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return Pi.fromString(vt(this.args[0].evaluate(t)));case"resolvedImage":return $i.fromString(vt(this.args[0].evaluate(t)));case"projectionDefinition":return this.args[0].evaluate(t);default:return vt(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}const Xo=["Unknown","Point","LineString","Polygon"];class wc{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Xo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let r=this._parseColorCache.get(t);return r||(r=Et.parse(t),this._parseColorCache.set(t,r)),r}}class pa{constructor(t,r,s=[],l,f=new os,m=[]){this.registry=t,this.path=s,this.key=s.map((y=>`[${y}]`)).join(""),this.scope=f,this.errors=m,this.expectedType=l,this._isConstant=r}parse(t,r,s,l,f={}){return r?this.concat(r,s,l)._parse(t,f):this._parse(t,f)}_parse(t,r){function s(l,f,m){return m==="assert"?new Zi(f,[l]):m==="coerce"?new An(f,[l]):l}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=t[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[l];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,v=m.type;if(y.kind!=="string"&&y.kind!=="number"&&y.kind!=="boolean"&&y.kind!=="object"&&y.kind!=="array"||v.kind!=="value"){if(y.kind==="projectionDefinition"&&["string","array"].includes(v.kind)||["color","formatted","resolvedImage"].includes(y.kind)&&["value","string"].includes(v.kind)||["padding","numberArray"].includes(y.kind)&&["value","number","array"].includes(v.kind)||y.kind==="colorArray"&&["value","string","array"].includes(v.kind)||y.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(v.kind))m=s(m,y,r.typeAnnotation||"coerce");else if(this.checkSubtype(y,v))return null}else m=s(m,y,r.typeAnnotation||"assert")}if(!(m instanceof Un)&&m.type.kind!=="resolvedImage"&&this._isConstant(m)){const y=new wc;try{m=new Un(m.type,m.evaluate(y))}catch(v){return this.error(v.message),null}}return m}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,r,s){const l=typeof t=="number"?this.path.concat(t):this.path,f=s?this.scope.concat(s):this.scope;return new pa(this.registry,this._isConstant,l,r||null,f,this.errors)}error(t,...r){const s=`${this.key}${r.map((l=>`[${l}]`)).join("")}`;this.errors.push(new zr(s,t))}checkSubtype(t,r){const s=Xa(t,r);return s&&this.error(s),s}}class Ya{constructor(t,r){this.type=r.type,this.bindings=[].concat(t),this.result=r}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const r of this.bindings)t(r[1]);t(this.result)}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const s=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return r.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",f);const y=r.parse(t[f+1],f+1);if(!y)return null;s.push([m,y])}const l=r.parse(t[t.length-1],t.length-1,r.expectedType,s);return l?new Ya(s,l):null}outputDefined(){return this.result.outputDefined()}}class Ko{constructor(t,r){this.type=r.type,this.name=t,this.boundExpression=r}static parse(t,r){if(t.length!==2||typeof t[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=t[1];return r.scope.has(s)?new Ko(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Yo{constructor(t,r,s){this.type=t,this.index=r,this.input=s}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,We),l=r.parse(t[2],2,Ri(r.expectedType||wt));return s&&l?new Yo(l.type.itemType,s,l):null}evaluate(t){const r=this.index.evaluate(t),s=this.input.evaluate(t);if(r<0)throw new ur(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new ur(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new ur(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Jo{constructor(t,r){this.type=Pt,this.needle=t,this.haystack=r}static parse(t,r){if(t.length!==3)return r.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,wt),l=r.parse(t[2],2,wt);return s&&l?mc(s.type,[Pt,Ct,We,oa,wt])?new Jo(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${cr(s.type)} instead`):null}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!us(r,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${cr(ct(r))} instead.`);if(!us(s,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${cr(ct(s))} instead.`);return s.indexOf(r)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class ln{constructor(t,r,s){this.type=We,this.needle=t,this.haystack=r,this.fromIndex=s}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,wt),l=r.parse(t[2],2,wt);if(!s||!l)return null;if(!mc(s.type,[Pt,Ct,We,oa,wt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${cr(s.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,We);return f?new ln(s,l,f):null}return new ln(s,l)}evaluate(t){const r=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!us(r,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${cr(ct(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(t)),us(s,["string"])){const f=s.indexOf(r,l);return f===-1?-1:[...s.slice(0,f)].length}if(us(s,["array"]))return s.indexOf(r,l);throw new ur(`Expected second argument to be of type array or string, but found ${cr(ct(s))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class oi{constructor(t,r,s,l,f,m){this.inputType=t,this.type=r,this.input=s,this.cases=l,this.outputs=f,this.otherwise=m}static parse(t,r){if(t.length<5)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const f={},m=[];for(let S=2;S<t.length-1;S+=2){let M=t[S];const E=t[S+1];Array.isArray(M)||(M=[M]);const D=r.concat(S);if(M.length===0)return D.error("Expected at least one branch label.");for(const F of M){if(typeof F!="number"&&typeof F!="string")return D.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return D.error("Numeric branch labels must be integer values.");if(s){if(D.checkSubtype(s,ct(F)))return null}else s=ct(F);if(f[String(F)]!==void 0)return D.error("Branch labels must be unique.");f[String(F)]=m.length}const L=r.parse(E,S,l);if(!L)return null;l=l||L.type,m.push(L)}const y=r.parse(t[1],1,wt);if(!y)return null;const v=r.parse(t[t.length-1],t.length-1,l);return v?y.type.kind!=="value"&&r.concat(1).checkSubtype(s,y.type)?null:new oi(s,l,y,f,m,v):null}evaluate(t){const r=this.input.evaluate(t);return(ct(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}}class fa{constructor(t,r,s){this.type=t,this.branches=r,this.otherwise=s}static parse(t,r){if(t.length<4)return r.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let m=1;m<t.length-1;m+=2){const y=r.parse(t[m],m,Pt);if(!y)return null;const v=r.parse(t[m+1],m+1,s);if(!v)return null;l.push([y,v]),s=s||v.type}const f=r.parse(t[t.length-1],t.length-1,s);if(!f)return null;if(!s)throw new Error("Can't infer output type");return new fa(s,l,f)}evaluate(t){for(const[r,s]of this.branches)if(r.evaluate(t))return s.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[r,s]of this.branches)t(r),t(s);t(this.otherwise)}outputDefined(){return this.branches.every((([t,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class Ja{constructor(t,r,s,l){this.type=t,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(t,r){if(t.length<=2||t.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const s=r.parse(t[1],1,wt),l=r.parse(t[2],2,We);if(!s||!l)return null;if(!mc(s.type,[Ri(wt),Ct,wt]))return r.error(`Expected first argument to be of type array or string, but found ${cr(s.type)} instead`);if(t.length===4){const f=r.parse(t[3],3,We);return f?new Ja(s.type,s,l,f):null}return new Ja(s.type,s,l)}evaluate(t){const r=this.input.evaluate(t),s=this.beginIndex.evaluate(t);let l;if(this.endIndex&&(l=this.endIndex.evaluate(t)),us(r,["string"]))return[...r].slice(s,l).join("");if(us(r,["array"]))return r.slice(s,l);throw new ur(`Expected first argument to be of type array or string, but found ${cr(ct(r))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function Bs(i,t){const r=i.length-1;let s,l,f=0,m=r,y=0;for(;f<=m;)if(y=Math.floor((f+m)/2),s=i[y],l=i[y+1],s<=t){if(y===r||t<l)return y;f=y+1}else{if(!(s>t))throw new ur("Input is not a number.");m=y-1}return 0}class jr{constructor(t,r,s){this.type=t,this.input=r,this.labels=[],this.outputs=[];for(const[l,f]of s)this.labels.push(l),this.outputs.push(f)}static parse(t,r){if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(t[1],1,We);if(!s)return null;const l=[];let f=null;r.expectedType&&r.expectedType.kind!=="value"&&(f=r.expectedType);for(let m=1;m<t.length;m+=2){const y=m===1?-1/0:t[m],v=t[m+1],S=m,M=m+1;if(typeof y!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(l.length&&l[l.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const E=r.parse(v,M,f);if(!E)return null;f=f||E.type,l.push([y,E])}return new jr(f,s,l)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const f=r.length;return l>=r[f-1]?s[f-1].evaluate(t):s[Bs(r,l)].evaluate(t)}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function oh(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Qa,Tc,Kd=(function(){if(Tc)return Qa;function i(t,r,s,l){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=s,this.p2y=l}return Tc=1,Qa=i,i.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,r){if(r===void 0&&(r=1e-6),t<0)return 0;if(t>1)return 1;for(var s=t,l=0;l<8;l++){var f=this.sampleCurveX(s)-t;if(Math.abs(f)<r)return s;var m=this.sampleCurveDerivativeX(s);if(Math.abs(m)<1e-6)break;s-=f/m}var y=0,v=1;for(s=t,l=0;l<20&&(f=this.sampleCurveX(s),!(Math.abs(f-t)<r));l++)t>f?y=s:v=s,s=.5*(v-y)+y;return s},solve:function(t,r){return this.sampleCurveY(this.solveCurveX(t,r))}},Qa})(),ma=oh(Kd);class gi{constructor(t,r,s,l,f){this.type=t,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[m,y]of f)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(t,r,s,l){let f=0;if(t.name==="exponential")f=eo(r,t.base,s,l);else if(t.name==="linear")f=eo(r,1,s,l);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new ma(m[0],m[1],m[2],m[3]).solve(eo(r,1,s,l))}return f}static parse(t,r){let[s,l,f,...m]=t;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const S=l[1];if(typeof S!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:S}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const S=l.slice(1);if(S.length!==4||S.some((M=>typeof M!="number"||M<0||M>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:S}}}if(t.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(f=r.parse(f,2,We),!f)return null;const y=[];let v=null;s!=="interpolate-hcl"&&s!=="interpolate-lab"||r.expectedType==In?r.expectedType&&r.expectedType.kind!=="value"&&(v=r.expectedType):v=mi;for(let S=0;S<m.length;S+=2){const M=m[S],E=m[S+1],D=S+3,L=S+4;if(typeof M!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(y.length&&y[y.length-1][0]>=M)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const F=r.parse(E,L,v);if(!F)return null;v=v||F.type,y.push([M,F])}return hs(v,We)||hs(v,ks)||hs(v,mi)||hs(v,Go)||hs(v,la)||hs(v,In)||hs(v,qo)||hs(v,Ri(We))?new gi(v,s,l,f,y):r.error(`Type ${cr(v)} is not interpolatable.`)}evaluate(t){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(t);const l=this.input.evaluate(t);if(l<=r[0])return s[0].evaluate(t);const f=r.length;if(l>=r[f-1])return s[f-1].evaluate(t);const m=Bs(r,l),y=gi.interpolationFactor(this.interpolation,l,r[m],r[m+1]),v=s[m].evaluate(t),S=s[m+1].evaluate(t);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Vn(v,S,y);case"color":return Et.interpolate(v,S,y);case"padding":return ai.interpolate(v,S,y);case"colorArray":return Wr.interpolate(v,S,y);case"numberArray":return Mi.interpolate(v,S,y);case"variableAnchorOffsetCollection":return Ci.interpolate(v,S,y);case"array":return Ds(v,S,y);case"projectionDefinition":return bi.interpolate(v,S,y)}case"interpolate-hcl":switch(this.type.kind){case"color":return Et.interpolate(v,S,y,"hcl");case"colorArray":return Wr.interpolate(v,S,y,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Et.interpolate(v,S,y,"lab");case"colorArray":return Wr.interpolate(v,S,y,"lab")}}}eachChild(t){t(this.input);for(const r of this.outputs)t(r)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}}function eo(i,t,r,s){const l=s-r,f=i-r;return l===0?0:t===1?f/l:(Math.pow(t,f)-1)/(Math.pow(t,l)-1)}const kn={color:Et.interpolate,number:Vn,padding:ai.interpolate,numberArray:Mi.interpolate,colorArray:Wr.interpolate,variableAnchorOffsetCollection:Ci.interpolate,array:Ds};class to{constructor(t,r){this.type=t,this.args=r}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const f=[];for(const y of t.slice(1)){const v=r.parse(y,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!v)return null;s=s||v.type,f.push(v)}if(!s)throw new Error("No output type");const m=l&&f.some((y=>Xa(l,y.type)));return new to(m?wt:s,f)}evaluate(t){let r,s=null,l=0;for(const f of this.args)if(l++,s=f.evaluate(t),s&&s instanceof $i&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}}function ro(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function io(i,t,r,s){return s.compare(t,r)===0}function wi(i,t,r){const s=i!=="=="&&i!=="!=";return class Hy{constructor(f,m,y){this.type=Pt,this.lhs=f,this.rhs=m,this.collator=y,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const y=f[0];let v=m.parse(f[1],1,wt);if(!v)return null;if(!ro(y,v.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${cr(v.type)}'.`);let S=m.parse(f[2],2,wt);if(!S)return null;if(!ro(y,S.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${cr(S.type)}'.`);if(v.type.kind!==S.type.kind&&v.type.kind!=="value"&&S.type.kind!=="value")return m.error(`Cannot compare types '${cr(v.type)}' and '${cr(S.type)}'.`);s&&(v.type.kind==="value"&&S.type.kind!=="value"?v=new Zi(S.type,[v]):v.type.kind!=="value"&&S.type.kind==="value"&&(S=new Zi(v.type,[S])));let M=null;if(f.length===4){if(v.type.kind!=="string"&&S.type.kind!=="string"&&v.type.kind!=="value"&&S.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(M=m.parse(f[3],3,Zo),!M)return null}return new Hy(v,S,M)}evaluate(f){const m=this.lhs.evaluate(f),y=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const v=ct(m),S=ct(y);if(v.kind!==S.kind||v.kind!=="string"&&v.kind!=="number")throw new ur(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${v.kind}, ${S.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const v=ct(m),S=ct(y);if(v.kind!=="string"||S.kind!=="string")return t(f,m,y)}return this.collator?r(f,m,y,this.collator.evaluate(f)):t(f,m,y)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}}}const lh=wi("==",(function(i,t,r){return t===r}),io),Qo=wi("!=",(function(i,t,r){return t!==r}),(function(i,t,r,s){return!io(0,t,r,s)})),Yd=wi("<",(function(i,t,r){return t<r}),(function(i,t,r,s){return s.compare(t,r)<0})),Sc=wi(">",(function(i,t,r){return t>r}),(function(i,t,r,s){return s.compare(t,r)>0})),Jd=wi("<=",(function(i,t,r){return t<=r}),(function(i,t,r,s){return s.compare(t,r)<=0})),Qd=wi(">=",(function(i,t,r){return t>=r}),(function(i,t,r,s){return s.compare(t,r)>=0}));class el{constructor(t,r,s){this.type=Zo,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=r}static parse(t,r){if(t.length!==2)return r.error("Expected one argument.");const s=t[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Pt);if(!l)return null;const f=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Pt);if(!f)return null;let m=null;return s.locale&&(m=r.parse(s.locale,1,Ct),!m)?null:new el(l,f,m)}evaluate(t){return new Rs(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class Pc{constructor(t,r,s,l,f){this.type=Ct,this.number=t,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=f}static parse(t,r){if(t.length!==3)return r.error("Expected two arguments.");const s=r.parse(t[1],1,We);if(!s)return null;const l=t[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let f=null;if(l.locale&&(f=r.parse(l.locale,1,Ct),!f))return null;let m=null;if(l.currency&&(m=r.parse(l.currency,1,Ct),!m))return null;let y=null;if(l["min-fraction-digits"]&&(y=r.parse(l["min-fraction-digits"],1,We),!y))return null;let v=null;return l["max-fraction-digits"]&&(v=r.parse(l["max-fraction-digits"],1,We),!v)?null:new Pc(s,f,m,y,v)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class Fs{constructor(t){this.type=cs,this.sections=t}static parse(t,r){if(t.length<2)return r.error("Expected at least one argument.");const s=t[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let f=!1;for(let m=1;m<=t.length-1;++m){const y=t[m];if(f&&typeof y=="object"&&!Array.isArray(y)){f=!1;let v=null;if(y["font-scale"]&&(v=r.parse(y["font-scale"],1,We),!v))return null;let S=null;if(y["text-font"]&&(S=r.parse(y["text-font"],1,Ri(Ct)),!S))return null;let M=null;if(y["text-color"]&&(M=r.parse(y["text-color"],1,mi),!M))return null;let E=null;if(y["vertical-align"]){if(typeof y["vertical-align"]=="string"&&!Wo.includes(y["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${y["vertical-align"]}' instead.`);if(E=r.parse(y["vertical-align"],1,Ct),!E)return null}const D=l[l.length-1];D.scale=v,D.font=S,D.textColor=M,D.verticalAlign=E}else{const v=r.parse(t[m],1,wt);if(!v)return null;const S=v.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,l.push({content:v,scale:null,font:null,textColor:null,verticalAlign:null})}}return new Fs(l)}evaluate(t){return new Pi(this.sections.map((r=>{const s=r.content.evaluate(t);return ct(s)===Or?new Ho("",s,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(t):null):new Ho(vt(s),null,r.scale?r.scale.evaluate(t):null,r.font?r.font.evaluate(t).join(","):null,r.textColor?r.textColor.evaluate(t):null,r.verticalAlign?r.verticalAlign.evaluate(t):null)})))}eachChild(t){for(const r of this.sections)t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor),r.verticalAlign&&t(r.verticalAlign)}outputDefined(){return!1}}class Mc{constructor(t){this.type=Or,this.input=t}static parse(t,r){if(t.length!==2)return r.error("Expected two arguments.");const s=r.parse(t[1],1,Ct);return s?new Mc(s):r.error("No image name provided.")}evaluate(t){const r=this.input.evaluate(t),s=$i.fromString(r);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(r)>-1),s}eachChild(t){t(this.input)}outputDefined(){return!1}}class tl{constructor(t){this.type=We,this.input=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=r.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${cr(s.type)} instead.`):new tl(s):null}evaluate(t){const r=this.input.evaluate(t);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new ur(`Expected value to be of type string or array, but found ${cr(ct(r))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const cn=8192;function ep(i,t){const r=(180+i[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,l=Math.pow(2,t.z);return[Math.round(r*l*cn),Math.round(s*l*cn)]}function rl(i,t){const r=Math.pow(2,t.z);return[(l=(i[0]/cn+t.x)/r,360*l-180),(s=(i[1]/cn+t.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,l}function no(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function so(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function tp(i,t,r){const s=i[0]-t[0],l=i[1]-t[1],f=i[0]-r[0],m=i[1]-r[1];return s*m-f*l==0&&s*f<=0&&l*m<=0}function il(i,t,r,s){return(l=[s[0]-r[0],s[1]-r[1]])[0]*(f=[t[0]-i[0],t[1]-i[1]])[1]-l[1]*f[0]!=0&&!(!uh(i,t,r,s)||!uh(r,s,i,t));var l,f}function rp(i,t,r){for(const s of r)for(let l=0;l<s.length-1;++l)if(il(i,t,s[l],s[l+1]))return!0;return!1}function Os(i,t,r=!1){let s=!1;for(const y of t)for(let v=0;v<y.length-1;v++){if(tp(i,y[v],y[v+1]))return r;(f=y[v])[1]>(l=i)[1]!=(m=y[v+1])[1]>l[1]&&l[0]<(m[0]-f[0])*(l[1]-f[1])/(m[1]-f[1])+f[0]&&(s=!s)}var l,f,m;return s}function ch(i,t){for(const r of t)if(Os(i,r))return!0;return!1}function Cc(i,t){for(const r of i)if(!Os(r,t))return!1;for(let r=0;r<i.length-1;++r)if(rp(i[r],i[r+1],t))return!1;return!0}function ip(i,t){for(const r of t)if(Cc(i,r))return!0;return!1}function uh(i,t,r,s){const l=s[0]-r[0],f=s[1]-r[1],m=(i[0]-r[0])*f-l*(i[1]-r[1]),y=(t[0]-r[0])*f-l*(t[1]-r[1]);return m>0&&y<0||m<0&&y>0}function Ic(i,t,r){const s=[];for(let l=0;l<i.length;l++){const f=[];for(let m=0;m<i[l].length;m++){const y=ep(i[l][m],r);no(t,y),f.push(y)}s.push(f)}return s}function hh(i,t,r){const s=[];for(let l=0;l<i.length;l++){const f=Ic(i[l],t,r);s.push(f)}return s}function nl(i,t,r,s){if(i[0]<r[0]||i[0]>r[2]){const l=.5*s;let f=i[0]-r[0]>l?-s:r[0]-i[0]>l?s:0;f===0&&(f=i[0]-r[2]>l?-s:r[2]-i[0]>l?s:0),i[0]+=f}no(t,i)}function dh(i,t,r,s){const l=Math.pow(2,s.z)*cn,f=[s.x*cn,s.y*cn],m=[];for(const y of i)for(const v of y){const S=[v.x+f[0],v.y+f[1]];nl(S,t,r,l),m.push(S)}return m}function ph(i,t,r,s){const l=Math.pow(2,s.z)*cn,f=[s.x*cn,s.y*cn],m=[];for(const v of i){const S=[];for(const M of v){const E=[M.x+f[0],M.y+f[1]];no(t,E),S.push(E)}m.push(S)}if(t[2]-t[0]<=l/2){(y=t)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const v of m)for(const S of v)nl(S,t,r,l)}var y;return m}class js{constructor(t,r){this.type=Pt,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ls(t[1])){const s=t[1];if(s.type==="FeatureCollection"){const l=[];for(const f of s.features){const{type:m,coordinates:y}=f.geometry;m==="Polygon"&&l.push(y),m==="MultiPolygon"&&l.push(...y)}if(l.length)return new js(s,{type:"MultiPolygon",coordinates:l})}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new js(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new js(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,s){const l=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(s.type==="Polygon"){const y=Ic(s.coordinates,f,m),v=dh(r.geometry(),l,f,m);if(!so(l,f))return!1;for(const S of v)if(!Os(S,y))return!1}if(s.type==="MultiPolygon"){const y=hh(s.coordinates,f,m),v=dh(r.geometry(),l,f,m);if(!so(l,f))return!1;for(const S of v)if(!ch(S,y))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,s){const l=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if(s.type==="Polygon"){const y=Ic(s.coordinates,f,m),v=ph(r.geometry(),l,f,m);if(!so(l,f))return!1;for(const S of v)if(!Cc(S,y))return!1}if(s.type==="MultiPolygon"){const y=hh(s.coordinates,f,m),v=ph(r.geometry(),l,f,m);if(!so(l,f))return!1;for(const S of v)if(!ip(S,y))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Ec=class{constructor(i=[],t=(r,s)=>r<s?-1:r>s?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:r}=this,s=t[i];for(;i>0;){const l=i-1>>1,f=t[l];if(r(s,f)>=0)break;t[i]=f,i=l}t[i]=s}_down(i){const{data:t,compare:r}=this,s=this.length>>1,l=t[i];for(;i<s;){let f=1+(i<<1);const m=f+1;if(m<this.length&&r(t[m],t[f])<0&&(f=m),r(t[f],l)>=0)break;t[i]=t[f],i=f}t[i]=l}};function Ac(i,t,r=0,s=i.length-1,l=np){for(;s>r;){if(s-r>600){const v=s-r+1,S=t-r+1,M=Math.log(v),E=.5*Math.exp(2*M/3),D=.5*Math.sqrt(M*E*(v-E)/v)*(S-v/2<0?-1:1);Ac(i,t,Math.max(r,Math.floor(t-S*E/v+D)),Math.min(s,Math.floor(t+(v-S)*E/v+D)),l)}const f=i[t];let m=r,y=s;for(ao(i,r,t),l(i[s],f)>0&&ao(i,r,s);m<y;){for(ao(i,m,y),m++,y--;l(i[m],f)<0;)m++;for(;l(i[y],f)>0;)y--}l(i[r],f)===0?ao(i,r,y):(y++,ao(i,y,s)),y<=t&&(r=y+1),t<=y&&(s=y-1)}}function ao(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}function np(i,t){return i<t?-1:i>t?1:0}function oo(i,t){if(i.length<=1)return[i];const r=[];let s,l;for(const f of i){const m=sp(f);m!==0&&(f.area=Math.abs(m),l===void 0&&(l=m<0),l===m<0?(s&&r.push(s),s=[f]):s.push(f))}if(s&&r.push(s),t>1)for(let f=0;f<r.length;f++)r[f].length<=t||(Ac(r[f],t,1,r[f].length-1,fh),r[f]=r[f].slice(0,t));return r}function fh(i,t){return t.area-i.area}function sp(i){let t=0;for(let r,s,l=0,f=i.length,m=f-1;l<f;m=l++)r=i[l],s=i[m],t+=(s.x-r.x)*(r.y+s.y);return t}const mh=1/298.257223563,gh=mh*(2-mh),kc=Math.PI/180;class zc{constructor(t){const r=6378.137*kc*1e3,s=Math.cos(t*kc),l=1/(1-gh*(1-s*s)),f=Math.sqrt(l);this.kx=r*f*s,this.ky=r*f*l*(1-gh)}distance(t,r){const s=this.wrap(t[0]-r[0])*this.kx,l=(t[1]-r[1])*this.ky;return Math.sqrt(s*s+l*l)}pointOnLine(t,r){let s,l,f,m,y=1/0;for(let v=0;v<t.length-1;v++){let S=t[v][0],M=t[v][1],E=this.wrap(t[v+1][0]-S)*this.kx,D=(t[v+1][1]-M)*this.ky,L=0;E===0&&D===0||(L=(this.wrap(r[0]-S)*this.kx*E+(r[1]-M)*this.ky*D)/(E*E+D*D),L>1?(S=t[v+1][0],M=t[v+1][1]):L>0&&(S+=E/this.kx*L,M+=D/this.ky*L)),E=this.wrap(r[0]-S)*this.kx,D=(r[1]-M)*this.ky;const F=E*E+D*D;F<y&&(y=F,s=S,l=M,f=v,m=L)}return{point:[s,l],index:f,t:Math.max(0,Math.min(1,m))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function _h(i,t){return t[0]-i[0]}function sl(i){return i[1]-i[0]+1}function $n(i,t){return i[1]>=i[0]&&i[1]<t}function Wt(i,t){if(i[0]>i[1])return[null,null];const r=sl(i);if(t){if(r===2)return[i,null];const l=Math.floor(r/2);return[[i[0],i[0]+l],[i[0]+l,i[1]]]}if(r===1)return[i,null];const s=Math.floor(r/2)-1;return[[i[0],i[0]+s],[i[0]+s+1,i[1]]]}function Dc(i,t){if(!$n(t,i.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=t[0];s<=t[1];++s)no(r,i[s]);return r}function Rc(i){const t=[1/0,1/0,-1/0,-1/0];for(const r of i)for(const s of r)no(t,s);return t}function yh(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Lc(i,t,r){if(!yh(i)||!yh(t))return NaN;let s=0,l=0;return i[2]<t[0]&&(s=t[0]-i[2]),i[0]>t[2]&&(s=i[0]-t[2]),i[1]>t[3]&&(l=i[1]-t[3]),i[3]<t[1]&&(l=t[1]-i[3]),r.distance([0,0],[s,l])}function Ns(i,t,r){const s=r.pointOnLine(t,i);return r.distance(i,s.point)}function Bc(i,t,r,s,l){const f=Math.min(Ns(i,[r,s],l),Ns(t,[r,s],l)),m=Math.min(Ns(r,[i,t],l),Ns(s,[i,t],l));return Math.min(f,m)}function ap(i,t,r,s,l){if(!$n(t,i.length)||!$n(s,r.length))return 1/0;let f=1/0;for(let m=t[0];m<t[1];++m){const y=i[m],v=i[m+1];for(let S=s[0];S<s[1];++S){const M=r[S],E=r[S+1];if(il(y,v,M,E))return 0;f=Math.min(f,Bc(y,v,M,E,l))}}return f}function op(i,t,r,s,l){if(!$n(t,i.length)||!$n(s,r.length))return NaN;let f=1/0;for(let m=t[0];m<=t[1];++m)for(let y=s[0];y<=s[1];++y)if(f=Math.min(f,l.distance(i[m],r[y])),f===0)return f;return f}function lp(i,t,r){if(Os(i,t,!0))return 0;let s=1/0;for(const l of t){const f=l[0],m=l[l.length-1];if(f!==m&&(s=Math.min(s,Ns(i,[m,f],r)),s===0))return s;const y=r.pointOnLine(l,i);if(s=Math.min(s,r.distance(i,y.point)),s===0)return s}return s}function cp(i,t,r,s){if(!$n(t,i.length))return NaN;for(let f=t[0];f<=t[1];++f)if(Os(i[f],r,!0))return 0;let l=1/0;for(let f=t[0];f<t[1];++f){const m=i[f],y=i[f+1];for(const v of r)for(let S=0,M=v.length,E=M-1;S<M;E=S++){const D=v[E],L=v[S];if(il(m,y,D,L))return 0;l=Math.min(l,Bc(m,y,D,L,s))}}return l}function vh(i,t){for(const r of i)for(const s of r)if(Os(s,t,!0))return!0;return!1}function up(i,t,r,s=1/0){const l=Rc(i),f=Rc(t);if(s!==1/0&&Lc(l,f,r)>=s)return s;if(so(l,f)){if(vh(i,t))return 0}else if(vh(t,i))return 0;let m=1/0;for(const y of i)for(let v=0,S=y.length,M=S-1;v<S;M=v++){const E=y[M],D=y[v];for(const L of t)for(let F=0,N=L.length,Z=N-1;F<N;Z=F++){const Y=L[Z],me=L[F];if(il(E,D,Y,me))return 0;m=Math.min(m,Bc(E,D,Y,me,r))}}return m}function xh(i,t,r,s,l,f){if(!f)return;const m=Lc(Dc(s,f),l,r);m<t&&i.push([m,f,[0,0]])}function al(i,t,r,s,l,f,m){if(!f||!m)return;const y=Lc(Dc(s,f),Dc(l,m),r);y<t&&i.push([y,f,m])}function ol(i,t,r,s,l=1/0){let f=Math.min(s.distance(i[0],r[0][0]),l);if(f===0)return f;const m=new Ec([[0,[0,i.length-1],[0,0]]],_h),y=Rc(r);for(;m.length>0;){const v=m.pop();if(v[0]>=f)continue;const S=v[1],M=t?50:100;if(sl(S)<=M){if(!$n(S,i.length))return NaN;if(t){const E=cp(i,S,r,s);if(isNaN(E)||E===0)return E;f=Math.min(f,E)}else for(let E=S[0];E<=S[1];++E){const D=lp(i[E],r,s);if(f=Math.min(f,D),f===0)return 0}}else{const E=Wt(S,t);xh(m,f,s,i,y,E[0]),xh(m,f,s,i,y,E[1])}}return f}function ll(i,t,r,s,l,f=1/0){let m=Math.min(f,l.distance(i[0],r[0]));if(m===0)return m;const y=new Ec([[0,[0,i.length-1],[0,r.length-1]]],_h);for(;y.length>0;){const v=y.pop();if(v[0]>=m)continue;const S=v[1],M=v[2],E=t?50:100,D=s?50:100;if(sl(S)<=E&&sl(M)<=D){if(!$n(S,i.length)&&$n(M,r.length))return NaN;let L;if(t&&s)L=ap(i,S,r,M,l),m=Math.min(m,L);else if(t&&!s){const F=i.slice(S[0],S[1]+1);for(let N=M[0];N<=M[1];++N)if(L=Ns(r[N],F,l),m=Math.min(m,L),m===0)return m}else if(!t&&s){const F=r.slice(M[0],M[1]+1);for(let N=S[0];N<=S[1];++N)if(L=Ns(i[N],F,l),m=Math.min(m,L),m===0)return m}else L=op(i,S,r,M,l),m=Math.min(m,L)}else{const L=Wt(S,t),F=Wt(M,s);al(y,m,l,i,r,L[0],F[0]),al(y,m,l,i,r,L[0],F[1]),al(y,m,l,i,r,L[1],F[0]),al(y,m,l,i,r,L[1],F[1])}}return m}function Fc(i){return i.type==="MultiPolygon"?i.coordinates.map((t=>({type:"Polygon",coordinates:t}))):i.type==="MultiLineString"?i.coordinates.map((t=>({type:"LineString",coordinates:t}))):i.type==="MultiPoint"?i.coordinates.map((t=>({type:"Point",coordinates:t}))):[i]}class Vs{constructor(t,r){this.type=We,this.geojson=t,this.geometries=r}static parse(t,r){if(t.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ls(t[1])){const s=t[1];if(s.type==="FeatureCollection")return new Vs(s,s.features.map((l=>Fc(l.geometry))).flat());if(s.type==="Feature")return new Vs(s,Fc(s.geometry));if("type"in s&&"coordinates"in s)return new Vs(s,Fc(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(r,s){const l=r.geometry(),f=l.flat().map((v=>rl([v.x,v.y],r.canonical)));if(l.length===0)return NaN;const m=new zc(f[0][1]);let y=1/0;for(const v of s){switch(v.type){case"Point":y=Math.min(y,ll(f,!1,[v.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ll(f,!1,v.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,ol(f,!1,v.coordinates,m,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="LineString")return(function(r,s){const l=r.geometry(),f=l.flat().map((v=>rl([v.x,v.y],r.canonical)));if(l.length===0)return NaN;const m=new zc(f[0][1]);let y=1/0;for(const v of s){switch(v.type){case"Point":y=Math.min(y,ll(f,!0,[v.coordinates],!1,m,y));break;case"LineString":y=Math.min(y,ll(f,!0,v.coordinates,!0,m,y));break;case"Polygon":y=Math.min(y,ol(f,!0,v.coordinates,m,y))}if(y===0)return y}return y})(t,this.geometries);if(t.geometryType()==="Polygon")return(function(r,s){const l=r.geometry();if(l.length===0||l[0].length===0)return NaN;const f=oo(l,0).map((v=>v.map((S=>S.map((M=>rl([M.x,M.y],r.canonical))))))),m=new zc(f[0][0][0][1]);let y=1/0;for(const v of s)for(const S of f){switch(v.type){case"Point":y=Math.min(y,ol([v.coordinates],!1,S,m,y));break;case"LineString":y=Math.min(y,ol(v.coordinates,!0,S,m,y));break;case"Polygon":y=Math.min(y,up(S,v.coordinates,m,y))}if(y===0)return y}return y})(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class lo{constructor(t){this.type=wt,this.key=t}static parse(t,r){if(t.length!==2)return r.error(`Expected 1 argument, but found ${t.length-1} instead.`);const s=t[1];return s==null?r.error("Global state property must be defined."):typeof s!="string"?r.error(`Global state property must be string, but found ${typeof t[1]} instead.`):new lo(s)}evaluate(t){var r;const s=(r=t.globals)===null||r===void 0?void 0:r.globalState;return s&&Object.keys(s).length!==0?da(s,this.key):null}eachChild(){}outputDefined(){return!1}}const ga={"==":lh,"!=":Qo,">":Sc,"<":Yd,">=":Qd,"<=":Jd,array:Zi,at:Yo,boolean:Zi,case:fa,coalesce:to,collator:el,format:Fs,image:Mc,in:Jo,"index-of":ln,interpolate:gi,"interpolate-hcl":gi,"interpolate-lab":gi,length:tl,let:Ya,literal:Un,match:oi,number:Zi,"number-format":Pc,object:Zi,slice:Ja,step:jr,string:Zi,"to-boolean":An,"to-color":An,"to-number":An,"to-string":An,var:Ko,within:js,distance:Vs,"global-state":lo};class Yi{constructor(t,r,s,l){this.name=t,this.type=r,this._evaluate=s,this.args=l}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,r){const s=t[0],l=Yi.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(l)?l[0]:l.type,m=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,y=m.filter((([S])=>!Array.isArray(S)||S.length===t.length-1));let v=null;for(const[S,M]of y){v=new pa(r.registry,cl,r.path,null,r.scope);const E=[];let D=!1;for(let L=1;L<t.length;L++){const F=t[L],N=Array.isArray(S)?S[L-1]:S.type,Z=v.parse(F,1+E.length,N);if(!Z){D=!0;break}E.push(Z)}if(!D)if(Array.isArray(S)&&S.length!==E.length)v.error(`Expected ${S.length} arguments, but found ${E.length} instead.`);else{for(let L=0;L<E.length;L++){const F=Array.isArray(S)?S[L]:S.type,N=E[L];v.concat(L+1).checkSubtype(F,N.type)}if(v.errors.length===0)return new Yi(s,f,M,E)}}if(y.length===1)r.errors.push(...v.errors);else{const S=(y.length?y:m).map((([E])=>{return D=E,Array.isArray(D)?`(${D.map(cr).join(", ")})`:`(${cr(D.type)}...)`;var D})).join(" | "),M=[];for(let E=1;E<t.length;E++){const D=r.parse(t[E],1+M.length);if(!D)return null;M.push(cr(D.type))}r.error(`Expected arguments of type ${S}, but found (${M.join(", ")}) instead.`)}return null}static register(t,r){Yi.definitions=r;for(const s in r)t[s]=Yi}}function bh(i,[t,r,s,l]){t=t.evaluate(i),r=r.evaluate(i),s=s.evaluate(i);const f=l?l.evaluate(i):1,m=_r(t,r,s,f);if(m)throw new ur(m);return new Et(t/255,r/255,s/255,f,!1)}function wh(i,t){return i in t}function Oc(i,t){const r=t[i];return r===void 0?null:r}function Us(i){return{type:i}}function cl(i){if(i instanceof Ko)return cl(i.boundExpression);if(i instanceof Yi&&i.name==="error"||i instanceof el||i instanceof js||i instanceof Vs||i instanceof lo)return!1;const t=i instanceof An||i instanceof Zi;let r=!0;return i.eachChild((s=>{r=t?r&&cl(s):r&&s instanceof Un})),!!r&&ul(i)&&hl(i,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function ul(i){if(i instanceof Yi&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof js||i instanceof Vs)return!1;let t=!0;return i.eachChild((r=>{t&&!ul(r)&&(t=!1)})),t}function co(i){if(i instanceof Yi&&i.name==="feature-state")return!1;let t=!0;return i.eachChild((r=>{t&&!co(r)&&(t=!1)})),t}function hl(i,t){if(i instanceof Yi&&t.indexOf(i.name)>=0)return!1;let r=!0;return i.eachChild((s=>{r&&!hl(s,t)&&(r=!1)})),r}function Th(i){return{result:"success",value:i}}function _a(i){return{result:"error",value:i}}function ps(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function Sh(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function jc(i){return!!i.expression&&i.expression.interpolated}function Dt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function uo(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)&&ct(i)===ls}function hp(i){return i}function Ph(i,t){const r=i.stops&&typeof i.stops[0][0]=="object",s=r||!(r||i.property!==void 0),l=i.type||(jc(t)?"exponential":"interval"),f=(function(M){switch(M.type){case"color":return Et.parse;case"padding":return ai.parse;case"numberArray":return Mi.parse;case"colorArray":return Wr.parse;default:return null}})(t);if(f&&((i=xi({},i)).stops&&(i.stops=i.stops.map((M=>[M[0],f(M[1])]))),i.default=f(i.default?i.default:t.default)),i.colorSpace&&(m=i.colorSpace)!=="rgb"&&m!=="hcl"&&m!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var m;const y=(function(M){switch(M){case"exponential":return Ch;case"interval":return dp;case"categorical":return Mh;case"identity":return pp;default:throw new Error(`Unknown function type "${M}"`)}})(l);let v,S;if(l==="categorical"){v=Object.create(null);for(const M of i.stops)v[M[0]]=M[1];S=typeof i.stops[0][0]}if(r){const M={},E=[];for(let F=0;F<i.stops.length;F++){const N=i.stops[F],Z=N[0].zoom;M[Z]===void 0&&(M[Z]={zoom:Z,type:i.type,property:i.property,default:i.default,stops:[]},E.push(Z)),M[Z].stops.push([N[0].value,N[1]])}const D=[];for(const F of E)D.push([M[F].zoom,Ph(M[F],t)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:gi.interpolationFactor.bind(void 0,L),zoomStops:D.map((F=>F[0])),evaluate:({zoom:F},N)=>Ch({stops:D,base:i.base},t,F).evaluate(F,N)}}if(s){const M=l==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:M,interpolationFactor:gi.interpolationFactor.bind(void 0,M),zoomStops:i.stops.map((E=>E[0])),evaluate:({zoom:E})=>y(i,t,E,v,S)}}return{kind:"source",evaluate(M,E){const D=E&&E.properties?E.properties[i.property]:void 0;return D===void 0?fs(i.default,t.default):y(i,t,D,v,S)}}}function fs(i,t,r){return i!==void 0?i:t!==void 0?t:r!==void 0?r:void 0}function Mh(i,t,r,s,l){return fs(typeof r===l?s[r]:void 0,i.default,t.default)}function dp(i,t,r){if(Dt(r)!=="number")return fs(i.default,t.default);const s=i.stops.length;if(s===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[s-1][0])return i.stops[s-1][1];const l=Bs(i.stops.map((f=>f[0])),r);return i.stops[l][1]}function Ch(i,t,r){const s=i.base!==void 0?i.base:1;if(Dt(r)!=="number")return fs(i.default,t.default);const l=i.stops.length;if(l===1||r<=i.stops[0][0])return i.stops[0][1];if(r>=i.stops[l-1][0])return i.stops[l-1][1];const f=Bs(i.stops.map((M=>M[0])),r),m=(function(M,E,D,L){const F=L-D,N=M-D;return F===0?0:E===1?N/F:(Math.pow(E,N)-1)/(Math.pow(E,F)-1)})(r,s,i.stops[f][0],i.stops[f+1][0]),y=i.stops[f][1],v=i.stops[f+1][1],S=kn[t.type]||hp;return typeof y.evaluate=="function"?{evaluate(...M){const E=y.evaluate.apply(void 0,M),D=v.evaluate.apply(void 0,M);if(E!==void 0&&D!==void 0)return S(E,D,m,i.colorSpace)}}:S(y,v,m,i.colorSpace)}function pp(i,t,r){switch(t.type){case"color":r=Et.parse(r);break;case"formatted":r=Pi.fromString(r.toString());break;case"resolvedImage":r=$i.fromString(r.toString());break;case"padding":r=ai.parse(r);break;case"colorArray":r=Wr.parse(r);break;case"numberArray":r=Mi.parse(r);break;default:Dt(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0)}return fs(r,i.default,t.default)}Yi.register(ga,{error:[{kind:"error"},[Ct],(i,[t])=>{throw new ur(t.evaluate(i))}],typeof:[Ct,[wt],(i,[t])=>cr(ct(t.evaluate(i)))],"to-rgba":[Ri(We,4),[mi],(i,[t])=>{const[r,s,l,f]=t.evaluate(i).rgb;return[255*r,255*s,255*l,f]}],rgb:[mi,[We,We,We],bh],rgba:[mi,[We,We,We,We],bh],has:{type:Pt,overloads:[[[Ct],(i,[t])=>wh(t.evaluate(i),i.properties())],[[Ct,ls],(i,[t,r])=>wh(t.evaluate(i),r.evaluate(i))]]},get:{type:wt,overloads:[[[Ct],(i,[t])=>Oc(t.evaluate(i),i.properties())],[[Ct,ls],(i,[t,r])=>Oc(t.evaluate(i),r.evaluate(i))]]},"feature-state":[wt,[Ct],(i,[t])=>Oc(t.evaluate(i),i.featureState||{})],properties:[ls,[],i=>i.properties()],"geometry-type":[Ct,[],i=>i.geometryType()],id:[wt,[],i=>i.id()],zoom:[We,[],i=>i.globals.zoom],"heatmap-density":[We,[],i=>i.globals.heatmapDensity||0],elevation:[We,[],i=>i.globals.elevation||0],"line-progress":[We,[],i=>i.globals.lineProgress||0],accumulated:[wt,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[We,Us(We),(i,t)=>{let r=0;for(const s of t)r+=s.evaluate(i);return r}],"*":[We,Us(We),(i,t)=>{let r=1;for(const s of t)r*=s.evaluate(i);return r}],"-":{type:We,overloads:[[[We,We],(i,[t,r])=>t.evaluate(i)-r.evaluate(i)],[[We],(i,[t])=>-t.evaluate(i)]]},"/":[We,[We,We],(i,[t,r])=>t.evaluate(i)/r.evaluate(i)],"%":[We,[We,We],(i,[t,r])=>t.evaluate(i)%r.evaluate(i)],ln2:[We,[],()=>Math.LN2],pi:[We,[],()=>Math.PI],e:[We,[],()=>Math.E],"^":[We,[We,We],(i,[t,r])=>Math.pow(t.evaluate(i),r.evaluate(i))],sqrt:[We,[We],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[We,[We],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[We,[We],(i,[t])=>Math.log(t.evaluate(i))],log2:[We,[We],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[We,[We],(i,[t])=>Math.sin(t.evaluate(i))],cos:[We,[We],(i,[t])=>Math.cos(t.evaluate(i))],tan:[We,[We],(i,[t])=>Math.tan(t.evaluate(i))],asin:[We,[We],(i,[t])=>Math.asin(t.evaluate(i))],acos:[We,[We],(i,[t])=>Math.acos(t.evaluate(i))],atan:[We,[We],(i,[t])=>Math.atan(t.evaluate(i))],min:[We,Us(We),(i,t)=>Math.min(...t.map((r=>r.evaluate(i))))],max:[We,Us(We),(i,t)=>Math.max(...t.map((r=>r.evaluate(i))))],abs:[We,[We],(i,[t])=>Math.abs(t.evaluate(i))],round:[We,[We],(i,[t])=>{const r=t.evaluate(i);return r<0?-Math.round(-r):Math.round(r)}],floor:[We,[We],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[We,[We],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[Pt,[Ct,wt],(i,[t,r])=>i.properties()[t.value]===r.value],"filter-id-==":[Pt,[wt],(i,[t])=>i.id()===t.value],"filter-type-==":[Pt,[Ct],(i,[t])=>i.geometryType()===t.value],"filter-<":[Pt,[Ct,wt],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[Pt,[wt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<s}],"filter->":[Pt,[Ct,wt],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[Pt,[wt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>s}],"filter-<=":[Pt,[Ct,wt],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[Pt,[wt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r<=s}],"filter->=":[Pt,[Ct,wt],(i,[t,r])=>{const s=i.properties()[t.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[Pt,[wt],(i,[t])=>{const r=i.id(),s=t.value;return typeof r==typeof s&&r>=s}],"filter-has":[Pt,[wt],(i,[t])=>t.value in i.properties()],"filter-has-id":[Pt,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[Pt,[Ri(Ct)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[Pt,[Ri(wt)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[Pt,[Ct,Ri(wt)],(i,[t,r])=>r.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[Pt,[Ct,Ri(wt)],(i,[t,r])=>(function(s,l,f,m){for(;f<=m;){const y=f+m>>1;if(l[y]===s)return!0;l[y]>s?m=y-1:f=y+1}return!1})(i.properties()[t.value],r.value,0,r.value.length-1)],all:{type:Pt,overloads:[[[Pt,Pt],(i,[t,r])=>t.evaluate(i)&&r.evaluate(i)],[Us(Pt),(i,t)=>{for(const r of t)if(!r.evaluate(i))return!1;return!0}]]},any:{type:Pt,overloads:[[[Pt,Pt],(i,[t,r])=>t.evaluate(i)||r.evaluate(i)],[Us(Pt),(i,t)=>{for(const r of t)if(r.evaluate(i))return!0;return!1}]]},"!":[Pt,[Pt],(i,[t])=>!t.evaluate(i)],"is-supported-script":[Pt,[Ct],(i,[t])=>{const r=i.globals&&i.globals.isSupportedScript;return!r||r(t.evaluate(i))}],upcase:[Ct,[Ct],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[Ct,[Ct],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[Ct,Us(wt),(i,t)=>t.map((r=>vt(r.evaluate(i)))).join("")],"resolved-locale":[Ct,[Zo],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Nc{constructor(t,r){this.expression=t,this._warningHistory={},this._evaluator=new wc,this._defaultValue=r?(function(s){if(s.type==="color"&&uo(s.default))return new Et(0,0,0,0);switch(s.type){case"color":return Et.parse(s.default)||null;case"padding":return ai.parse(s.default)||null;case"numberArray":return Mi.parse(s.default)||null;case"colorArray":return Wr.parse(s.default)||null;case"variableAnchorOffsetCollection":return Ci.parse(s.default)||null;case"projectionDefinition":return bi.parse(s.default)||null;default:return s.default===void 0?null:s.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null}evaluateWithoutErrorHandling(t,r,s,l,f,m){return this._evaluator.globals=t,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this.expression.evaluate(this._evaluator)}evaluate(t,r,s,l,f,m){this._evaluator.globals=t,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new ur(`Expected value to be one of ${Object.keys(this._enumValues).map((v=>JSON.stringify(v))).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function dl(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ga}function ho(i,t){const r=new pa(ga,cl,[],t?(function(l){const f={color:mi,string:Ct,number:We,enum:Ct,boolean:Pt,formatted:cs,padding:Go,numberArray:la,colorArray:In,projectionDefinition:ks,resolvedImage:Or,variableAnchorOffsetCollection:qo};return l.type==="array"?Ri(f[l.value]||wt,l.length):f[l.type]})(t):void 0),s=r.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return s?Th(new Nc(s,t)):_a(r.errors)}class po{constructor(t,r){this.kind=t,this._styleExpression=r,this.isStateDependent=t!=="constant"&&!co(r.expression),this.globalStateRefs=go(r.expression)}evaluateWithoutErrorHandling(t,r,s,l,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,f,m)}evaluate(t,r,s,l,f,m){return this._styleExpression.evaluate(t,r,s,l,f,m)}}class Vc{constructor(t,r,s,l){this.kind=t,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=t!=="camera"&&!co(r.expression),this.globalStateRefs=go(r.expression),this.interpolationType=l}evaluateWithoutErrorHandling(t,r,s,l,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,r,s,l,f,m)}evaluate(t,r,s,l,f,m){return this._styleExpression.evaluate(t,r,s,l,f,m)}interpolationFactor(t,r,s){return this.interpolationType?gi.interpolationFactor(this.interpolationType,t,r,s):0}}function Ih(i,t){const r=ho(i,t);if(r.result==="error")return r;const s=r.value.expression,l=ul(s);if(!l&&!ps(t))return _a([new zr("","data expressions not supported")]);const f=hl(s,["zoom"]);if(!f&&!Sh(t))return _a([new zr("","zoom expressions not supported")]);const m=mo(s);return m||f?m instanceof zr?_a([m]):m instanceof gi&&!jc(t)?_a([new zr("",'"interpolate" expressions cannot be used with this property')]):Th(m?new Vc(l?"camera":"composite",r.value,m.labels,m instanceof gi?m.interpolation:void 0):new po(l?"constant":"source",r.value)):_a([new zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fo{constructor(t,r){this._parameters=t,this._specification=r,xi(this,Ph(this._parameters,this._specification))}static deserialize(t){return new fo(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function mo(i){let t=null;if(i instanceof Ya)t=mo(i.result);else if(i instanceof to){for(const r of i.args)if(t=mo(r),t)break}else(i instanceof jr||i instanceof gi)&&i.input instanceof Yi&&i.input.name==="zoom"&&(t=i);return t instanceof zr||i.eachChild((r=>{const s=mo(r);s instanceof zr?t=s:!t&&s?t=new zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&s&&t!==s&&(t=new zr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}function go(i,t=new Set){return i instanceof lo&&t.add(i.key),i.eachChild((r=>{go(r,t)})),t}function pl(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!pl(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Uc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function $s(i){if(i==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};pl(i)||(i=Zs(i));const t=ho(i,Uc);if(t.result==="error")throw new Error(t.value.map((r=>`${r.key}: ${r.message}`)).join(", "));return{filter:(r,s,l)=>t.value.evaluate(r,s,{},l),needGeometry:fl(i),getGlobalStateRefs:()=>go(t.value.expression)}}function $c(i,t){return i<t?-1:i>t?1:0}function fl(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(fl(i[t]))return!0;return!1}function Zs(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Zc(i[1],i[2],"=="):t==="!="?ml(Zc(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Zc(i[1],i[2],t):t==="any"?(r=i.slice(1),["any"].concat(r.map(Zs))):t==="all"?["all"].concat(i.slice(1).map(Zs)):t==="none"?["all"].concat(i.slice(1).map(Zs).map(ml)):t==="in"?Eh(i[1],i.slice(2)):t==="!in"?ml(Eh(i[1],i.slice(2))):t==="has"?Ah(i[1]):t!=="!has"||ml(Ah(i[1]));var r}function Zc(i,t,r){switch(i){case"$type":return[`filter-type-${r}`,t];case"$id":return[`filter-id-${r}`,t];default:return[`filter-${r}`,i,t]}}function Eh(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((r=>typeof r!=typeof t[0]))?["filter-in-large",i,["literal",t.sort($c)]]:["filter-in-small",i,["literal",t]]}}function Ah(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function ml(i){return["!",i]}function Gc(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let l="[";for(const f of i)l+=`${Gc(f)},`;return`${l}]`}const r=Object.keys(i).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${Gc(i[r[l]])},`;return`${s}}`}function fp(i){let t="";for(const r of ot)t+=`/${Gc(i[r])}`;return t}function qc(i){const t=i.value;return t?[new je(i.key,t,"constants have been deprecated as of v8")]:[]}function Dr(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function zn(i){if(Array.isArray(i))return i.map(zn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const r in i)t[r]=zn(i[r]);return t}return Dr(i)}function Ji(i){const t=i.key,r=i.value,s=i.valueSpec||{},l=i.objectElementValidators||{},f=i.style,m=i.styleSpec,y=i.validateSpec;let v=[];const S=Dt(r);if(S!=="object")return[new je(t,r,`object expected, ${S} found`)];for(const M in r){const E=M.split(".")[0],D=da(s,E)||s["*"];let L;if(da(l,E))L=l[E];else if(da(s,E))L=y;else if(l["*"])L=l["*"];else{if(!s["*"]){v.push(new je(t,r[M],`unknown property "${M}"`));continue}L=y}v=v.concat(L({key:(t&&`${t}.`)+M,value:r[M],valueSpec:D,style:f,styleSpec:m,object:r,objectKey:M,validateSpec:y},r))}for(const M in s)l[M]||s[M].required&&s[M].default===void 0&&r[M]===void 0&&v.push(new je(t,r,`missing required property "${M}"`));return v}function gl(i){const t=i.value,r=i.valueSpec,s=i.style,l=i.styleSpec,f=i.key,m=i.arrayElementValidator||i.validateSpec;if(Dt(t)!=="array")return[new je(f,t,`array expected, ${Dt(t)} found`)];if(r.length&&t.length!==r.length)return[new je(f,t,`array length ${r.length} expected, length ${t.length} found`)];if(r["min-length"]&&t.length<r["min-length"])return[new je(f,t,`array length at least ${r["min-length"]} expected, length ${t.length} found`)];let y={type:r.value,values:r.values};l.$version<7&&(y.function=r.function),Dt(r.value)==="object"&&(y=r.value);let v=[];for(let S=0;S<t.length;S++)v=v.concat(m({array:t,arrayIndex:S,value:t[S],valueSpec:y,validateSpec:i.validateSpec,style:s,styleSpec:l,key:`${f}[${S}]`}));return v}function _o(i){const t=i.key,r=i.value,s=i.valueSpec;let l=Dt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new je(t,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new je(t,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new je(t,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function kh(i){const t=i.valueSpec,r=Dr(i.value.type);let s,l,f,m={};const y=r!=="categorical"&&i.value.property===void 0,v=!y,S=Dt(i.value.stops)==="array"&&Dt(i.value.stops[0])==="array"&&Dt(i.value.stops[0][0])==="object",M=Ji({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(L){if(r==="identity")return[new je(L.key,L.value,'identity function may not have a "stops" property')];let F=[];const N=L.value;return F=F.concat(gl({key:L.key,value:N,valueSpec:L.valueSpec,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,arrayElementValidator:E})),Dt(N)==="array"&&N.length===0&&F.push(new je(L.key,N,"array must have at least one stop")),F},default:function(L){return L.validateSpec({key:L.key,value:L.value,valueSpec:t,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec})}}});return r==="identity"&&y&&M.push(new je(i.key,i.value,'missing required property "property"')),r==="identity"||i.value.stops||M.push(new je(i.key,i.value,'missing required property "stops"')),r==="exponential"&&i.valueSpec.expression&&!jc(i.valueSpec)&&M.push(new je(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(v&&!ps(i.valueSpec)?M.push(new je(i.key,i.value,"property functions not supported")):y&&!Sh(i.valueSpec)&&M.push(new je(i.key,i.value,"zoom functions not supported"))),r!=="categorical"&&!S||i.value.property!==void 0||M.push(new je(i.key,i.value,'"property" property is required')),M;function E(L){let F=[];const N=L.value,Z=L.key;if(Dt(N)!=="array")return[new je(Z,N,`array expected, ${Dt(N)} found`)];if(N.length!==2)return[new je(Z,N,`array length 2 expected, length ${N.length} found`)];if(S){if(Dt(N[0])!=="object")return[new je(Z,N,`object expected, ${Dt(N[0])} found`)];if(N[0].zoom===void 0)return[new je(Z,N,"object stop key must have zoom")];if(N[0].value===void 0)return[new je(Z,N,"object stop key must have value")];if(f&&f>Dr(N[0].zoom))return[new je(Z,N[0].zoom,"stop zoom values must appear in ascending order")];Dr(N[0].zoom)!==f&&(f=Dr(N[0].zoom),l=void 0,m={}),F=F.concat(Ji({key:`${Z}[0]`,value:N[0],valueSpec:{zoom:{}},validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec,objectElementValidators:{zoom:_o,value:D}}))}else F=F.concat(D({key:`${Z}[0]`,value:N[0],validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec},N));return dl(zn(N[1]))?F.concat([new je(`${Z}[1]`,N[1],"expressions are not allowed in function stops.")]):F.concat(L.validateSpec({key:`${Z}[1]`,value:N[1],valueSpec:t,validateSpec:L.validateSpec,style:L.style,styleSpec:L.styleSpec}))}function D(L,F){const N=Dt(L.value),Z=Dr(L.value),Y=L.value!==null?L.value:F;if(s){if(N!==s)return[new je(L.key,Y,`${N} stop domain type must match previous stop domain type ${s}`)]}else s=N;if(N!=="number"&&N!=="string"&&N!=="boolean")return[new je(L.key,Y,"stop domain value must be a number, string, or boolean")];if(N!=="number"&&r!=="categorical"){let me=`number expected, ${N} found`;return ps(t)&&r===void 0&&(me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new je(L.key,Y,me)]}return r!=="categorical"||N!=="number"||isFinite(Z)&&Math.floor(Z)===Z?r!=="categorical"&&N==="number"&&l!==void 0&&Z<l?[new je(L.key,Y,"stop domain values must appear in ascending order")]:(l=Z,r==="categorical"&&Z in m?[new je(L.key,Y,"stop domain values must be unique")]:(m[Z]=!0,[])):[new je(L.key,Y,`integer expected, found ${Z}`)]}}function Gs(i){const t=(i.expressionContext==="property"?Ih:ho)(zn(i.value),i.valueSpec);if(t.result==="error")return t.value.map((s=>new je(`${i.key}${s.key}`,i.value,s.message)));const r=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!r.outputDefined())return[new je(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!co(r))return[new je(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!co(r))return[new je(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!hl(r,["zoom","feature-state"]))return[new je(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!ul(r))return[new je(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _l(i){const t=i.key,r=i.value,s=Dt(r);return s!=="string"?[new je(t,r,`color expected, ${s} found`)]:Et.parse(String(r))?[]:[new je(t,r,`color expected, "${r}" found`)]}function Zn(i){const t=i.key,r=i.value,s=i.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(Dr(r))===-1&&l.push(new je(t,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(Dr(r))===-1&&l.push(new je(t,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function Wc(i){return pl(zn(i.value))?Gs(xi({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):zh(i)}function zh(i){const t=i.value,r=i.key;if(Dt(t)!=="array")return[new je(r,t,`array expected, ${Dt(t)} found`)];const s=i.styleSpec;let l,f=[];if(t.length<1)return[new je(r,t,"filter array must have at least 1 element")];switch(f=f.concat(Zn({key:`${r}[0]`,value:t[0],valueSpec:s.filter_operator,style:i.style,styleSpec:i.styleSpec})),Dr(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&Dr(t[1])==="$type"&&f.push(new je(r,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new je(r,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(l=Dt(t[1]),l!=="string"&&f.push(new je(`${r}[1]`,t[1],`string expected, ${l} found`)));for(let m=2;m<t.length;m++)l=Dt(t[m]),Dr(t[1])==="$type"?f=f.concat(Zn({key:`${r}[${m}]`,value:t[m],valueSpec:s.geometry_type,style:i.style,styleSpec:i.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&f.push(new je(`${r}[${m}]`,t[m],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat(zh({key:`${r}[${m}]`,value:t[m],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":l=Dt(t[1]),t.length!==2?f.push(new je(r,t,`filter array for "${t[0]}" operator must have 2 elements`)):l!=="string"&&f.push(new je(`${r}[1]`,t[1],`string expected, ${l} found`))}return f}function Dh(i,t){const r=i.key,s=i.validateSpec,l=i.style,f=i.styleSpec,m=i.value,y=i.objectKey,v=f[`${t}_${i.layerType}`];if(!v)return[];const S=y.match(/^(.*)-transition$/);if(t==="paint"&&S&&v[S[1]]&&v[S[1]].transition)return s({key:r,value:m,valueSpec:f.transition,style:l,styleSpec:f});const M=i.valueSpec||v[y];if(!M)return[new je(r,m,`unknown property "${y}"`)];let E;if(Dt(m)==="string"&&ps(M)&&!M.tokens&&(E=/^{([^}]+)}$/.exec(m)))return[new je(r,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(E[1])} }\`.`)];const D=[];return i.layerType==="symbol"&&(y==="text-field"&&l&&!l.glyphs&&D.push(new je(r,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&uo(zn(m))&&Dr(m.type)==="identity"&&D.push(new je(r,m,'"text-font" does not support identity functions'))),D.concat(s({key:i.key,value:m,valueSpec:M,style:l,styleSpec:f,expressionContext:"property",propertyType:t,propertyKey:y}))}function Rh(i){return Dh(i,"paint")}function Lh(i){return Dh(i,"layout")}function Bh(i){let t=[];const r=i.value,s=i.key,l=i.style,f=i.styleSpec;if(Dt(r)!=="object")return[new je(s,r,`object expected, ${Dt(r)} found`)];r.type||r.ref||t.push(new je(s,r,'either "type" or "ref" is required'));let m=Dr(r.type);const y=Dr(r.ref);if(r.id){const v=Dr(r.id);for(let S=0;S<i.arrayIndex;S++){const M=l.layers[S];Dr(M.id)===v&&t.push(new je(s,r.id,`duplicate layer id "${r.id}", previously used at line ${M.id.__line__}`))}}if("ref"in r){let v;["type","source","source-layer","filter","layout"].forEach((S=>{S in r&&t.push(new je(s,r[S],`"${S}" is prohibited for ref layers`))})),l.layers.forEach((S=>{Dr(S.id)===y&&(v=S)})),v?v.ref?t.push(new je(s,r.ref,"ref cannot reference another ref layer")):m=Dr(v.type):t.push(new je(s,r.ref,`ref layer "${y}" not found`))}else if(m!=="background")if(r.source){const v=l.sources&&l.sources[r.source],S=v&&Dr(v.type);v?S==="vector"&&m==="raster"?t.push(new je(s,r.source,`layer "${r.id}" requires a raster source`)):S!=="raster-dem"&&m==="hillshade"||S!=="raster-dem"&&m==="color-relief"?t.push(new je(s,r.source,`layer "${r.id}" requires a raster-dem source`)):S==="raster"&&m!=="raster"?t.push(new je(s,r.source,`layer "${r.id}" requires a vector source`)):S!=="vector"||r["source-layer"]?S==="raster-dem"&&m!=="hillshade"&&m!=="color-relief"?t.push(new je(s,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):m!=="line"||!r.paint||!r.paint["line-gradient"]||S==="geojson"&&v.lineMetrics||t.push(new je(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new je(s,r,`layer "${r.id}" must specify a "source-layer"`)):t.push(new je(s,r.source,`source "${r.source}" not found`))}else t.push(new je(s,r,'missing required property "source"'));return t=t.concat(Ji({key:s,value:r,valueSpec:f.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${s}.type`,value:r.type,valueSpec:f.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:r,objectKey:"type"}),filter:Wc,layout:v=>Ji({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":S=>Lh(xi({layerType:m},S))}}),paint:v=>Ji({layer:r,key:v.key,value:v.value,style:v.style,styleSpec:v.styleSpec,validateSpec:v.validateSpec,objectElementValidators:{"*":S=>Rh(xi({layerType:m},S))}})}})),t}function un(i){const t=i.value,r=i.key,s=Dt(t);return s!=="string"?[new je(r,t,`string expected, ${s} found`)]:[]}const ya={promoteId:function({key:i,value:t}){if(Dt(t)==="string")return un({key:i,value:t});{const r=[];for(const s in t)r.push(...un({key:`${i}.${s}`,value:t[s]}));return r}}};function Li(i){const t=i.value,r=i.key,s=i.styleSpec,l=i.style,f=i.validateSpec;if(!t.type)return[new je(r,t,'"type" is required')];const m=Dr(t.type);let y;switch(m){case"vector":case"raster":return y=Ji({key:r,value:t,valueSpec:s[`source_${m.replace("-","_")}`],style:i.style,styleSpec:s,objectElementValidators:ya,validateSpec:f}),y;case"raster-dem":return y=(function(v){var S;const M=(S=v.sourceName)!==null&&S!==void 0?S:"",E=v.value,D=v.styleSpec,L=D.source_raster_dem,F=v.style;let N=[];const Z=Dt(E);if(E===void 0)return N;if(Z!=="object")return N.push(new je("source_raster_dem",E,`object expected, ${Z} found`)),N;const Y=Dr(E.encoding)==="custom",me=["redFactor","greenFactor","blueFactor","baseShift"],ne=v.value.encoding?`"${v.value.encoding}"`:"Default";for(const oe in E)!Y&&me.includes(oe)?N.push(new je(oe,E[oe],`In "${M}": "${oe}" is only valid when "encoding" is set to "custom". ${ne} encoding found`)):L[oe]?N=N.concat(v.validateSpec({key:oe,value:E[oe],valueSpec:L[oe],validateSpec:v.validateSpec,style:F,styleSpec:D})):N.push(new je(oe,E[oe],`unknown property "${oe}"`));return N})({sourceName:r,value:t,style:i.style,styleSpec:s,validateSpec:f}),y;case"geojson":if(y=Ji({key:r,value:t,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:f,objectElementValidators:ya}),t.cluster)for(const v in t.clusterProperties){const[S,M]=t.clusterProperties[v],E=typeof S=="string"?[S,["accumulated"],["get",v]]:S;y.push(...Gs({key:`${r}.${v}.map`,value:M,expressionContext:"cluster-map"})),y.push(...Gs({key:`${r}.${v}.reduce`,value:E,expressionContext:"cluster-reduce"}))}return y;case"video":return Ji({key:r,value:t,valueSpec:s.source_video,style:l,validateSpec:f,styleSpec:s});case"image":return Ji({key:r,value:t,valueSpec:s.source_image,style:l,validateSpec:f,styleSpec:s});case"canvas":return[new je(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Zn({key:`${r}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function va(i){const t=i.value,r=i.styleSpec,s=r.light,l=i.style;let f=[];const m=Dt(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new je("light",t,`object expected, ${m} found`)]),f;for(const y in t){const v=y.match(/^(.*)-transition$/);f=f.concat(v&&s[v[1]]&&s[v[1]].transition?i.validateSpec({key:y,value:t[y],valueSpec:r.transition,validateSpec:i.validateSpec,style:l,styleSpec:r}):s[y]?i.validateSpec({key:y,value:t[y],valueSpec:s[y],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new je(y,t[y],`unknown property "${y}"`)])}return f}function Hc(i){const t=i.value,r=i.styleSpec,s=r.sky,l=i.style,f=Dt(t);if(t===void 0)return[];if(f!=="object")return[new je("sky",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(s[y]?i.validateSpec({key:y,value:t[y],valueSpec:s[y],style:l,styleSpec:r}):[new je(y,t[y],`unknown property "${y}"`)]);return m}function Fh(i){const t=i.value,r=i.styleSpec,s=r.terrain,l=i.style;let f=[];const m=Dt(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new je("terrain",t,`object expected, ${m} found`)]),f;for(const y in t)f=f.concat(s[y]?i.validateSpec({key:y,value:t[y],valueSpec:s[y],validateSpec:i.validateSpec,style:l,styleSpec:r}):[new je(y,t[y],`unknown property "${y}"`)]);return f}function Oh(i){let t=[];const r=i.value,s=i.key;if(Array.isArray(r)){const l=[],f=[];for(const m in r)r[m].id&&l.includes(r[m].id)&&t.push(new je(s,r,`all the sprites' ids must be unique, but ${r[m].id} is duplicated`)),l.push(r[m].id),r[m].url&&f.includes(r[m].url)&&t.push(new je(s,r,`all the sprites' URLs must be unique, but ${r[m].url} is duplicated`)),f.push(r[m].url),t=t.concat(Ji({key:`${s}[${m}]`,value:r[m],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return un({key:s,value:r})}function xa(i){return t=i.value,t&&t.constructor===Object?[]:[new je(i.key,i.value,`object expected, ${Dt(i.value)} found`)];var t}const Xc={"*":()=>[],array:gl,boolean:function(i){const t=i.value,r=i.key,s=Dt(t);return s!=="boolean"?[new je(r,t,`boolean expected, ${s} found`)]:[]},number:_o,color:_l,constants:qc,enum:Zn,filter:Wc,function:kh,layer:Bh,object:Ji,source:Li,light:va,sky:Hc,terrain:Fh,projection:function(i){const t=i.value,r=i.styleSpec,s=r.projection,l=i.style,f=Dt(t);if(t===void 0)return[];if(f!=="object")return[new je("projection",t,`object expected, ${f} found`)];let m=[];for(const y in t)m=m.concat(s[y]?i.validateSpec({key:y,value:t[y],valueSpec:s[y],style:l,styleSpec:r}):[new je(y,t[y],`unknown property "${y}"`)]);return m},projectionDefinition:function(i){const t=i.key;let r=i.value;r=r instanceof String?r.valueOf():r;const s=Dt(r);return s!=="array"||(function(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"})(r)||(function(l){return!!["interpolate","step","literal"].includes(l[0])})(r)?["array","string"].includes(s)?[]:[new je(t,r,`projection expected, invalid type "${s}" found`)]:[new je(t,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:un,formatted:function(i){return un(i).length===0?[]:Gs(i)},resolvedImage:function(i){return un(i).length===0?[]:Gs(i)},padding:function(i){const t=i.key,r=i.value;if(Dt(r)==="array"){if(r.length<1||r.length>4)return[new je(t,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let f=0;f<r.length;f++)l=l.concat(i.validateSpec({key:`${t}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:s}));return l}return _o({key:t,value:r,valueSpec:{}})},numberArray:function(i){const t=i.key,r=i.value;if(Dt(r)==="array"){const s={type:"number"};if(r.length<1)return[new je(t,r,"array length at least 1 expected, length 0 found")];let l=[];for(let f=0;f<r.length;f++)l=l.concat(i.validateSpec({key:`${t}[${f}]`,value:r[f],validateSpec:i.validateSpec,valueSpec:s}));return l}return _o({key:t,value:r,valueSpec:{}})},colorArray:function(i){const t=i.key,r=i.value;if(Dt(r)==="array"){if(r.length<1)return[new je(t,r,"array length at least 1 expected, length 0 found")];let s=[];for(let l=0;l<r.length;l++)s=s.concat(_l({key:`${t}[${l}]`,value:r[l]}));return s}return _l({key:t,value:r})},variableAnchorOffsetCollection:function(i){const t=i.key,r=i.value,s=Dt(r),l=i.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new je(t,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let f=[];for(let m=0;m<r.length;m+=2)f=f.concat(Zn({key:`${t}[${m}]`,value:r[m],valueSpec:l.layout_symbol["text-anchor"]})),f=f.concat(gl({key:`${t}[${m+1}]`,value:r[m+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:l}));return f},sprite:Oh,state:xa};function ba(i){const t=i.value,r=i.valueSpec,s=i.styleSpec;return i.validateSpec=ba,r.expression&&uo(Dr(t))?kh(i):r.expression&&dl(zn(t))?Gs(i):r.type&&Xc[r.type]?Xc[r.type](i):Ji(xi({},i,{valueSpec:r.type?s[r.type]:r}))}function jh(i){const t=i.value,r=i.key,s=un(i);return s.length||(t.indexOf("{fontstack}")===-1&&s.push(new je(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&s.push(new je(r,t,'"glyphs" url must include a "{range}" token'))),s}function Bi(i,t=_e){let r=[];return r=r.concat(ba({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:ba,objectElementValidators:{glyphs:jh,"*":()=>[]}})),i.constants&&(r=r.concat(qc({key:"constants",value:i.constants}))),wa(r)}function hn(i){return function(t){return i({...t,validateSpec:ba})}}function wa(i){return[].concat(i).sort(((t,r)=>t.line-r.line))}function dn(i){return function(...t){return wa(i.apply(this,t))}}Bi.source=dn(hn(Li)),Bi.sprite=dn(hn(Oh)),Bi.glyphs=dn(hn(jh)),Bi.light=dn(hn(va)),Bi.sky=dn(hn(Hc)),Bi.terrain=dn(hn(Fh)),Bi.state=dn(hn(xa)),Bi.layer=dn(hn(Bh)),Bi.filter=dn(hn(Wc)),Bi.paintProperty=dn(hn(Rh)),Bi.layoutProperty=dn(hn(Lh));const Ta=Bi,mp=Ta.light,yo=Ta.sky,gp=Ta.paintProperty,_p=Ta.layoutProperty;function vo(i,t){let r=!1;if(t&&t.length)for(const s of t)i.fire(new Ie(new Error(s.message))),r=!0;return r}class xo{constructor(t,r,s){const l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(r=m[1])+2*(s=m[2]);for(let v=0;v<this.d*this.d;v++){const S=m[3+v],M=m[3+v+1];l.push(S===M?null:m.subarray(S,M))}const y=m[3+l.length+1];this.keys=m.subarray(m[3+l.length],y),this.bboxes=m.subarray(y),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let m=0;m<this.d*this.d;m++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=s,this.scale=r/t,this.uid=0;const f=s/r*t;this.min=-f,this.max=t+f}insert(t,r,s,l,f){this._forEachCell(r,s,l,f,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(f)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,r,s,l,f,m){this.cells[f].push(m)}query(t,r,s,l,f){const m=this.min,y=this.max;if(t<=m&&r<=m&&y<=s&&y<=l&&!f)return Array.prototype.slice.call(this.keys);{const v=[];return this._forEachCell(t,r,s,l,this._queryCell,v,{},f),v}}_queryCell(t,r,s,l,f,m,y,v){const S=this.cells[f];if(S!==null){const M=this.keys,E=this.bboxes;for(let D=0;D<S.length;D++){const L=S[D];if(y[L]===void 0){const F=4*L;(v?v(E[F+0],E[F+1],E[F+2],E[F+3]):t<=E[F+2]&&r<=E[F+3]&&s>=E[F+0]&&l>=E[F+1])?(y[L]=!0,m.push(M[L])):y[L]=!1}}}}_forEachCell(t,r,s,l,f,m,y,v){const S=this._convertToCellCoord(t),M=this._convertToCellCoord(r),E=this._convertToCellCoord(s),D=this._convertToCellCoord(l);for(let L=S;L<=E;L++)for(let F=M;F<=D;F++){const N=this.d*F+L;if((!v||v(this._convertFromCellCoord(L),this._convertFromCellCoord(F),this._convertFromCellCoord(L+1),this._convertFromCellCoord(F+1)))&&f.call(this,t,r,s,l,N,m,y,v))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,r=3+this.cells.length+1+1;let s=0;for(let m=0;m<this.cells.length;m++)s+=this.cells[m].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let f=r;for(let m=0;m<t.length;m++){const y=t[m];l[3+m]=f,l.set(y,f),f+=y.length}return l[3+t.length]=f,l.set(this.keys,f),f+=this.keys.length,l[3+t.length+1]=f,l.set(this.bboxes,f),f+=this.bboxes.length,l.buffer}static serialize(t,r){const s=t.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(t){return new xo(t.buffer)}}const pn={};function He(i,t,r={}){if(pn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),pn[i]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}He("Object",Object),He("Set",Set),He("TransferableGridIndex",xo),He("Color",Et),He("Error",Error),He("AJAXError",te),He("ResolvedImage",$i),He("StylePropertyFunction",fo),He("StyleExpression",Nc,{omit:["_evaluator"]}),He("ZoomDependentExpression",Vc),He("ZoomConstantExpression",po),He("CompoundExpression",Yi,{omit:["_evaluate"]});for(const i in ga)ga[i]._classRegistryKey||He(`Expression_${i}`,ga[i]);function Kc(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function yl(i){return i.$name||i.constructor._classRegistryKey}function Yc(i){return!(function(t){if(t===null||typeof t!="object")return!1;const r=yl(t);return!(!r||r==="Object")})(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Kc(i)||Ar(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function Sa(i,t){if(Yc(i))return(Kc(i)||Ar(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const f=[];for(const m of i)f.push(Sa(m,t));return f}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const r=yl(i);if(!r)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!pn[r])throw new Error(`${r} is not registered.`);const{klass:s}=pn[r],l=s.serialize?s.serialize(i,t):{};if(s.serialize){if(t&&l===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const f in i){if(!i.hasOwnProperty(f)||pn[r].omit.indexOf(f)>=0)continue;const m=i[f];l[f]=pn[r].shallow.indexOf(f)>=0?m:Sa(m,t)}i instanceof Error&&(l.message=i.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function qs(i){if(Yc(i))return i;if(Array.isArray(i))return i.map(qs);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=yl(i)||"Object";if(!pn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:r}=pn[t];if(!r)throw new Error(`can't deserialize unregistered class ${t}`);if(r.deserialize)return r.deserialize(i);const s=Object.create(r.prototype);for(const l of Object.keys(i)){if(l==="$name")continue;const f=i[l];s[l]=pn[t].shallow.indexOf(l)>=0?f:qs(f)}return s}class vl{constructor(){this.first=!0}update(t,r){const s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))}}const Lt={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Hiragana:i=>i>=12352&&i<=12447,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"CJK Unified Ideographs":i=>i>=19968&&i<=40959,"Hangul Syllables":i=>i>=44032&&i<=55215,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function xl(i){for(const t of i)if(Qc(t.charCodeAt(0)))return!0;return!1}function yp(i){for(const t of i)if(!Nh(t.charCodeAt(0)))return!1;return!0}function bl(i){const t=i.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(t.join("|"),"u")}const vp=bl(["Arab","Dupl","Mong","Ougr","Syrc"]);function Nh(i){return!vp.test(String.fromCodePoint(i))}const Jc=bl(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Qc(i){return!(i!==746&&i!==747&&(i<4352||!(Lt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||Lt["CJK Compatibility"](i)||Lt["CJK Strokes"](i)||!(!Lt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||Lt["Enclosed CJK Letters and Months"](i)||Lt["Ideographic Description Characters"](i)||Lt.Kanbun(i)||Lt.Katakana(i)&&i!==12540||!(!Lt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!Lt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||Lt["Vertical Forms"](i)||Lt["Yijing Hexagram Symbols"](i)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(i))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(i))||Jc.test(String.fromCodePoint(i)))))}function Vh(i){return!(Qc(i)||(function(t){return!!(Lt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||Lt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||Lt["Letterlike Symbols"](t)||Lt["Number Forms"](t)||Lt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||Lt["Control Pictures"](t)&&t!==9251||Lt["Optical Character Recognition"](t)||Lt["Enclosed Alphanumerics"](t)||Lt["Geometric Shapes"](t)||Lt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Lt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Lt["CJK Symbols and Punctuation"](t)||Lt.Katakana(t)||Lt["Private Use Area"](t)||Lt["CJK Compatibility Forms"](t)||Lt["Small Form Variants"](t)||Lt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(i))}const Uh=bl(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function eu(i){return Uh.test(String.fromCodePoint(i))}function $h(i,t){return!(!t&&eu(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||Lt.Khmer(i))}function Zh(i){for(const t of i)if(eu(t.charCodeAt(0)))return!0;return!1}const fn=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){if(fn.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(i,t){return o(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(i.pluginStatus!=="loading")return this.setState(i),i;const r=i.pluginURL,s=new Promise((f=>{this.loadScriptResolve=f}));t(r);const l=new Promise((f=>setTimeout((()=>f()),this.TIMEOUT)));if(yield Promise.race([s,l]),this.isParsed()){const f={pluginStatus:"loaded",pluginURL:r};return this.setState(f),f}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class wr{constructor(t,r){this.zoom=t,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new vl,this.transition=r.transition||{},this.globalState=r.globalState||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new vl,this.transition={},this.globalState={})}isSupportedScript(t){return(function(r,s){for(const l of r)if(!$h(l.charCodeAt(0),s))return!1;return!0})(t,fn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,r=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class Pa{constructor(t,r){this.property=t,this.value=r,this.expression=(function(s,l){if(uo(s))return new fo(s,l);if(dl(s)){const f=Ih(s,l);if(f.result==="error")throw new Error(f.value.map((m=>`${m.key}: ${m.message}`)).join(", "));return f.value}{let f=s;return l.type==="color"&&typeof s=="string"?f=Et.parse(s):l.type!=="padding"||typeof s!="number"&&!Array.isArray(s)?l.type!=="numberArray"||typeof s!="number"&&!Array.isArray(s)?l.type!=="colorArray"||typeof s!="string"&&!Array.isArray(s)?l.type==="variableAnchorOffsetCollection"&&Array.isArray(s)?f=Ci.parse(s):l.type==="projectionDefinition"&&typeof s=="string"&&(f=bi.parse(s)):f=Wr.parse(s):f=Mi.parse(s):f=ai.parse(s),{globalStateRefs:new Set,kind:"constant",evaluate:()=>f}}})(r===void 0?t.specification.default:r,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(t,r,s){return this.property.possiblyEvaluate(this,t,r,s)}}class tu{constructor(t){this.property=t,this.value=new Pa(t,void 0)}transitioned(t,r){return new ru(this.property,this.value,r,Vt({},t.transition,this.transition),t.now)}untransitioned(){return new ru(this.property,this.value,null,{},0)}}class Gh{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return Rt(this._values[t].value.value)}setValue(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new tu(this._values[t].property)),this._values[t].value=new Pa(this._values[t].property,r===null?void 0:Rt(r))}getTransition(t){return Rt(this._values[t].transition)}setTransition(t,r){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new tu(this._values[t].property)),this._values[t].transition=Rt(r)||void 0}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s);const l=this.getTransition(r);l!==void 0&&(t[`${r}-transition`]=l)}return t}transitioned(t,r){const s=new iu(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(t,r._values[l]);return s}untransitioned(){const t=new iu(this._properties);for(const r of Object.keys(this._values))t._values[r]=this._values[r].untransitioned();return t}}class ru{constructor(t,r,s,l,f){this.property=t,this.value=r,this.begin=f+l.delay||0,this.end=this.begin+l.duration||0,t.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(t,r,s){const l=t.now||0,f=this.value.possiblyEvaluate(t,r,s),m=this.prior;if(m){if(l>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(l<this.begin)return m.possiblyEvaluate(t,r,s);{const y=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,r,s),f,Kt(y))}}return f}}class iu{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,r,s){const l=new wl(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].possiblyEvaluate(t,r,s);return l}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class qh{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return Rt(this._values[t].value)}setValue(t,r){this._values[t]=new Pa(this._values[t].property,r===null?void 0:Rt(r))}serialize(){const t={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(t[r]=s)}return t}possiblyEvaluate(t,r,s){const l=new wl(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].possiblyEvaluate(t,r,s);return l}}class Dn{constructor(t,r,s){this.property=t,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,r,s,l){return this.property.evaluate(this.value,this.parameters,t,r,s,l)}}class wl{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class et{constructor(t){this.specification=t}possiblyEvaluate(t,r){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(r)}interpolate(t,r,s){const l=kn[this.specification.type];return l?l(t,r,s):t}}class lt{constructor(t,r){this.specification=t,this.overrides=r}possiblyEvaluate(t,r,s,l){return new Dn(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(r,null,{},s,l)}:t.expression,r)}interpolate(t,r,s){if(t.value.kind!=="constant"||r.value.kind!=="constant")return t;if(t.value.value===void 0||r.value.value===void 0)return new Dn(this,{kind:"constant",value:void 0},t.parameters);const l=kn[this.specification.type];if(l){const f=l(t.value.value,r.value.value,s);return new Dn(this,{kind:"constant",value:f},t.parameters)}return t}evaluate(t,r,s,l,f,m){return t.kind==="constant"?t.value:t.evaluate(r,s,l,f,m)}}class Tl extends lt{possiblyEvaluate(t,r,s,l){if(t.value===void 0)return new Dn(this,{kind:"constant",value:void 0},r);if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},s,l),m=t.property.specification.type==="resolvedImage"&&typeof f!="string"?f.name:f,y=this._calculate(m,m,m,r);return new Dn(this,{kind:"constant",value:y},r)}if(t.expression.kind==="camera"){const f=this._calculate(t.expression.evaluate({zoom:r.zoom-1}),t.expression.evaluate({zoom:r.zoom}),t.expression.evaluate({zoom:r.zoom+1}),r);return new Dn(this,{kind:"constant",value:f},r)}return new Dn(this,t.expression,r)}evaluate(t,r,s,l,f,m){if(t.kind==="source"){const y=t.evaluate(r,s,l,f,m);return this._calculate(y,y,y,r)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(r.zoom)-1},s,l),t.evaluate({zoom:Math.floor(r.zoom)},s,l),t.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):t.value}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class ms{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){if(t.value!==void 0){if(t.expression.kind==="constant"){const f=t.expression.evaluate(r,null,{},s,l);return this._calculate(f,f,f,r)}return this._calculate(t.expression.evaluate(new wr(Math.floor(r.zoom-1),r)),t.expression.evaluate(new wr(Math.floor(r.zoom),r)),t.expression.evaluate(new wr(Math.floor(r.zoom+1),r)),r)}}_calculate(t,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:t,to:r}:{from:s,to:r}}interpolate(t){return t}}class Sl{constructor(t){this.specification=t}possiblyEvaluate(t,r,s,l){return!!t.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class Ii{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in t){const s=t[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new Pa(s,void 0),f=this.defaultTransitionablePropertyValues[r]=new tu(s);this.defaultTransitioningPropertyValues[r]=f.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}He("DataDrivenProperty",lt),He("DataConstantProperty",et),He("CrossFadedDataDrivenProperty",Tl),He("CrossFadedProperty",ms),He("ColorRampProperty",Sl);const Wh="-transition";class Qi extends Ke{constructor(t,r){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter,this._featureFilter=$s(t.filter)),r.layout&&(this._unevaluatedLayout=new qh(r.layout)),r.paint)){this._transitionablePaint=new Gh(r.paint);for(const s in t.paint)this.setPaintProperty(s,t.paint[s],{validate:!1});for(const s in t.layout)this.setLayoutProperty(s,t.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new wl(r.paint)}}setFilter(t){this.filter=t,this._featureFilter=$s(t)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}getLayoutAffectingGlobalStateRefs(){const t=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const s=this._unevaluatedLayout._values[r];for(const l of s.getGlobalStateRefs())t.add(l)}for(const r of this._featureFilter.getGlobalStateRefs())t.add(r);return t}setLayoutProperty(t,r,s={}){r!=null&&this._validate(_p,`layers.${this.id}.layout.${t}`,t,r,s)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,r):this.visibility=r)}getPaintProperty(t){return t.endsWith(Wh)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,r,s={}){if(r!=null&&this._validate(gp,`layers.${this.id}.paint.${t}`,t,r,s))return!1;if(t.endsWith(Wh))return this._transitionablePaint.setTransition(t.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[t],f=l.property.specification["property-type"]==="cross-faded-data-driven",m=l.value.isDataDriven(),y=l.value;this._transitionablePaint.setValue(t,r),this._handleSpecialPaintPropertyUpdate(t);const v=this._transitionablePaint._values[t].value;return v.isDataDriven()||m||f||this._handleOverridablePaintPropertyUpdate(t,y,v)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,r,s){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,r){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,r)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ot(t,((r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length)))}_validate(t,r,s,l,f={}){return(!f||f.validate!==!1)&&vo(this,t.call(Ta,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:_e,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const r=this.paint.get(t);if(r instanceof Dn&&ps(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}const xp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bo{constructor(t,r){this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class rr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,r){return t._trim(),r&&(t.isTransferred=!0,r.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const r=Object.create(this.prototype);return r.arrayBuffer=t.arrayBuffer,r.length=t.length,r.capacity=t.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Nr(i,t=1){let r=0,s=0;return{members:i.map((l=>{const f=xp[l.type].BYTES_PER_ELEMENT,m=r=Pl(r,Math.max(t,f)),y=l.components||1;return s=Math.max(s,f),r+=f*y,{name:l.name,type:l.type,components:y,offset:m}})),size:Pl(r,Math.max(s,t)),alignment:t}}function Pl(i,t){return Math.ceil(i/t)*t}class Ma extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.int16[l+0]=r,this.int16[l+1]=s,t}}Ma.prototype.bytesPerElement=4,He("StructArrayLayout2i4",Ma);class Ca extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const f=3*t;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=l,t}}Ca.prototype.bytesPerElement=6,He("StructArrayLayout3i6",Ca);class nu extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,l)}emplace(t,r,s,l,f){const m=4*t;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=l,this.int16[m+3]=f,t}}nu.prototype.bytesPerElement=8,He("StructArrayLayout4i8",nu);class Ia extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,s,l,f,m)}emplace(t,r,s,l,f,m,y){const v=6*t;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=l,this.int16[v+3]=f,this.int16[v+4]=m,this.int16[v+5]=y,t}}Ia.prototype.bytesPerElement=12,He("StructArrayLayout2i4i12",Ia);class Ws extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,s,l,f,m)}emplace(t,r,s,l,f,m,y){const v=4*t,S=8*t;return this.int16[v+0]=r,this.int16[v+1]=s,this.uint8[S+4]=l,this.uint8[S+5]=f,this.uint8[S+6]=m,this.uint8[S+7]=y,t}}Ws.prototype.bytesPerElement=8,He("StructArrayLayout2i4ub8",Ws);class wo extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.float32[l+0]=r,this.float32[l+1]=s,t}}wo.prototype.bytesPerElement=8,He("StructArrayLayout2f8",wo);class Ml extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f,m,y,v,S,M){const E=this.length;return this.resize(E+1),this.emplace(E,t,r,s,l,f,m,y,v,S,M)}emplace(t,r,s,l,f,m,y,v,S,M,E){const D=10*t;return this.uint16[D+0]=r,this.uint16[D+1]=s,this.uint16[D+2]=l,this.uint16[D+3]=f,this.uint16[D+4]=m,this.uint16[D+5]=y,this.uint16[D+6]=v,this.uint16[D+7]=S,this.uint16[D+8]=M,this.uint16[D+9]=E,t}}Ml.prototype.bytesPerElement=20,He("StructArrayLayout10ui20",Ml);class Hs extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f,m,y,v,S,M,E,D){const L=this.length;return this.resize(L+1),this.emplace(L,t,r,s,l,f,m,y,v,S,M,E,D)}emplace(t,r,s,l,f,m,y,v,S,M,E,D,L){const F=12*t;return this.int16[F+0]=r,this.int16[F+1]=s,this.int16[F+2]=l,this.int16[F+3]=f,this.uint16[F+4]=m,this.uint16[F+5]=y,this.uint16[F+6]=v,this.uint16[F+7]=S,this.int16[F+8]=M,this.int16[F+9]=E,this.int16[F+10]=D,this.int16[F+11]=L,t}}Hs.prototype.bytesPerElement=24,He("StructArrayLayout4i4ui4i24",Hs);class su extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const f=3*t;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,t}}su.prototype.bytesPerElement=12,He("StructArrayLayout3f12",su);class au extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint32[1*t+0]=r,t}}au.prototype.bytesPerElement=4,He("StructArrayLayout1ul4",au);class Cl extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f,m,y,v,S){const M=this.length;return this.resize(M+1),this.emplace(M,t,r,s,l,f,m,y,v,S)}emplace(t,r,s,l,f,m,y,v,S,M){const E=10*t,D=5*t;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=l,this.int16[E+3]=f,this.int16[E+4]=m,this.int16[E+5]=y,this.uint32[D+3]=v,this.uint16[E+8]=S,this.uint16[E+9]=M,t}}Cl.prototype.bytesPerElement=20,He("StructArrayLayout6i1ul2ui20",Cl);class ou extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,s,l,f,m)}emplace(t,r,s,l,f,m,y){const v=6*t;return this.int16[v+0]=r,this.int16[v+1]=s,this.int16[v+2]=l,this.int16[v+3]=f,this.int16[v+4]=m,this.int16[v+5]=y,t}}ou.prototype.bytesPerElement=12,He("StructArrayLayout2i2i2i12",ou);class h extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,r,s,l,f)}emplace(t,r,s,l,f,m){const y=4*t,v=8*t;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=l,this.int16[v+6]=f,this.int16[v+7]=m,t}}h.prototype.bytesPerElement=16,He("StructArrayLayout2f1f2i16",h);class e extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f,m){const y=this.length;return this.resize(y+1),this.emplace(y,t,r,s,l,f,m)}emplace(t,r,s,l,f,m,y){const v=16*t,S=4*t,M=8*t;return this.uint8[v+0]=r,this.uint8[v+1]=s,this.float32[S+1]=l,this.float32[S+2]=f,this.int16[M+6]=m,this.int16[M+7]=y,t}}e.prototype.bytesPerElement=16,He("StructArrayLayout2ub2f2i16",e);class n extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const f=3*t;return this.uint16[f+0]=r,this.uint16[f+1]=s,this.uint16[f+2]=l,t}}n.prototype.bytesPerElement=6,He("StructArrayLayout3ui6",n);class a extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f,m,y,v,S,M,E,D,L,F,N,Z,Y){const me=this.length;return this.resize(me+1),this.emplace(me,t,r,s,l,f,m,y,v,S,M,E,D,L,F,N,Z,Y)}emplace(t,r,s,l,f,m,y,v,S,M,E,D,L,F,N,Z,Y,me){const ne=24*t,oe=12*t,be=48*t;return this.int16[ne+0]=r,this.int16[ne+1]=s,this.uint16[ne+2]=l,this.uint16[ne+3]=f,this.uint32[oe+2]=m,this.uint32[oe+3]=y,this.uint32[oe+4]=v,this.uint16[ne+10]=S,this.uint16[ne+11]=M,this.uint16[ne+12]=E,this.float32[oe+7]=D,this.float32[oe+8]=L,this.uint8[be+36]=F,this.uint8[be+37]=N,this.uint8[be+38]=Z,this.uint32[oe+10]=Y,this.int16[ne+22]=me,t}}a.prototype.bytesPerElement=48,He("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",a);class c extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l,f,m,y,v,S,M,E,D,L,F,N,Z,Y,me,ne,oe,be,Pe,Be,qe,Ne,Ze,it,Ue){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,t,r,s,l,f,m,y,v,S,M,E,D,L,F,N,Z,Y,me,ne,oe,be,Pe,Be,qe,Ne,Ze,it,Ue)}emplace(t,r,s,l,f,m,y,v,S,M,E,D,L,F,N,Z,Y,me,ne,oe,be,Pe,Be,qe,Ne,Ze,it,Ue,Ge){const Ae=32*t,ut=16*t;return this.int16[Ae+0]=r,this.int16[Ae+1]=s,this.int16[Ae+2]=l,this.int16[Ae+3]=f,this.int16[Ae+4]=m,this.int16[Ae+5]=y,this.int16[Ae+6]=v,this.int16[Ae+7]=S,this.uint16[Ae+8]=M,this.uint16[Ae+9]=E,this.uint16[Ae+10]=D,this.uint16[Ae+11]=L,this.uint16[Ae+12]=F,this.uint16[Ae+13]=N,this.uint16[Ae+14]=Z,this.uint16[Ae+15]=Y,this.uint16[Ae+16]=me,this.uint16[Ae+17]=ne,this.uint16[Ae+18]=oe,this.uint16[Ae+19]=be,this.uint16[Ae+20]=Pe,this.uint16[Ae+21]=Be,this.uint16[Ae+22]=qe,this.uint32[ut+12]=Ne,this.float32[ut+13]=Ze,this.float32[ut+14]=it,this.uint16[Ae+30]=Ue,this.uint16[Ae+31]=Ge,t}}c.prototype.bytesPerElement=64,He("StructArrayLayout8i15ui1ul2f2ui64",c);class p extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.float32[1*t+0]=r,t}}p.prototype.bytesPerElement=4,He("StructArrayLayout1f4",p);class _ extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const f=3*t;return this.uint16[6*t+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,t}}_.prototype.bytesPerElement=12,He("StructArrayLayout1ui2f12",_);class x extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,t,r,s)}emplace(t,r,s,l){const f=4*t;return this.uint32[2*t+0]=r,this.uint16[f+2]=s,this.uint16[f+3]=l,t}}x.prototype.bytesPerElement=8,He("StructArrayLayout1ul2ui8",x);class b extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,r){const s=this.length;return this.resize(s+1),this.emplace(s,t,r)}emplace(t,r,s){const l=2*t;return this.uint16[l+0]=r,this.uint16[l+1]=s,t}}b.prototype.bytesPerElement=4,He("StructArrayLayout2ui4",b);class P extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const r=this.length;return this.resize(r+1),this.emplace(r,t)}emplace(t,r){return this.uint16[1*t+0]=r,t}}P.prototype.bytesPerElement=2,He("StructArrayLayout1ui2",P);class I extends rr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,r,s,l){const f=this.length;return this.resize(f+1),this.emplace(f,t,r,s,l)}emplace(t,r,s,l,f){const m=4*t;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=l,this.float32[m+3]=f,t}}I.prototype.bytesPerElement=16,He("StructArrayLayout4f16",I);class k extends bo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new B(this.anchorPointX,this.anchorPointY)}}k.prototype.size=20;class A extends Cl{get(t){return new k(this,t)}}He("CollisionBoxArray",A);class R extends bo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}R.prototype.size=48;class O extends a{get(t){return new R(this,t)}}He("PlacedSymbolArray",O);class W extends bo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}W.prototype.size=64;class G extends c{get(t){return new W(this,t)}}He("SymbolInstanceArray",G);class H extends p{getoffsetX(t){return this.float32[1*t+0]}}He("GlyphOffsetArray",H);class J extends Ca{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}He("SymbolLineVertexArray",J);class ie extends bo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ie.prototype.size=12;class Q extends _{get(t){return new ie(this,t)}}He("TextAnchorOffsetArray",Q);class se extends bo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}se.prototype.size=8;class ue extends x{get(t){return new se(this,t)}}He("FeatureIndexArray",ue);class ee extends Ma{}class ge extends Ma{}class Te extends Ma{}class ve extends Ia{}class xe extends Ws{}class we extends wo{}class Fe extends Ml{}class Ve extends Hs{}class Le extends su{}class Ye extends au{}class Tt extends ou{}class Yt extends e{}class ir extends n{}class er extends b{}const Mr=Nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Rr}=Mr;class xt{constructor(t=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=t}prepareSegment(t,r,s,l){const f=this.segments[this.segments.length-1];return t>xt.MAX_VERTEX_ARRAY_LENGTH&&Gt(`Max vertices per segment is ${xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${xt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!f||f.vertexLength+t>xt.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==l?this.createNewSegment(r,s,l):f}createNewSegment(t,r,s){const l={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return s!==void 0&&(l.sortKey=s),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(l),l}getOrCreateLatestSegment(t,r,s){return this.prepareSegment(0,t,r,s)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const t of this.segments)for(const r in t.vaos)t.vaos[r].destroy()}static simpleSegment(t,r,s,l){return new xt([{vertexOffset:t,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function nr(i,t){return 256*(i=Qt(Math.floor(i),0,255))+Qt(Math.floor(t),0,255)}xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,He("SegmentVector",xt);const Hr=Nr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var ti,li,Ei,mn={exports:{}},gs={exports:{}},_s={exports:{}},Ea=(function(){if(Ei)return mn.exports;Ei=1;var i=(ti||(ti=1,gs.exports=function(r,s){var l,f,m,y,v,S,M,E;for(f=r.length-(l=3&r.length),m=s,v=3432918353,S=461845907,E=0;E<f;)M=255&r.charCodeAt(E)|(255&r.charCodeAt(++E))<<8|(255&r.charCodeAt(++E))<<16|(255&r.charCodeAt(++E))<<24,++E,m=27492+(65535&(y=5*(65535&(m=(m^=M=(65535&(M=(M=(65535&M)*v+(((M>>>16)*v&65535)<<16)&4294967295)<<15|M>>>17))*S+(((M>>>16)*S&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(M=0,l){case 3:M^=(255&r.charCodeAt(E+2))<<16;case 2:M^=(255&r.charCodeAt(E+1))<<8;case 1:m^=M=(65535&(M=(M=(65535&(M^=255&r.charCodeAt(E)))*v+(((M>>>16)*v&65535)<<16)&4294967295)<<15|M>>>17))*S+(((M>>>16)*S&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),gs.exports),t=(li||(li=1,_s.exports=function(r,s){for(var l,f=r.length,m=s^f,y=0;f>=4;)l=1540483477*(65535&(l=255&r.charCodeAt(y)|(255&r.charCodeAt(++y))<<8|(255&r.charCodeAt(++y))<<16|(255&r.charCodeAt(++y))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),f-=4,++y;switch(f){case 3:m^=(255&r.charCodeAt(y+2))<<16;case 2:m^=(255&r.charCodeAt(y+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(y)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),_s.exports);return mn.exports=i,mn.exports.murmur3=i,mn.exports.murmur2=t,mn.exports})(),Aa=K(Ea);class Xs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,r,s,l){this.ids.push(Ks(t)),this.positions.push(r,s,l)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Ks(t);let s=0,l=this.ids.length-1;for(;s<l;){const m=s+l>>1;this.ids[m]>=r?l=m:s=m+1}const f=[];for(;this.ids[s]===r;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(t,r){const s=new Float64Array(t.ids),l=new Uint32Array(t.positions);return Fi(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(t){const r=new Xs;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}function Ks(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:Aa(String(i))}function Fi(i,t,r,s){for(;r<s;){const l=i[r+s>>1];let f=r-1,m=s+1;for(;;){do f++;while(i[f]<l);do m--;while(i[m]>l);if(f>=m)break;gn(i,f,m),gn(t,3*f,3*m),gn(t,3*f+1,3*m+1),gn(t,3*f+2,3*m+2)}m-r<s-m?(Fi(i,t,r,m),r=m+1):(Fi(i,t,m+1,s),s=m)}}function gn(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}He("FeaturePositionMap",Xs);class Ai{constructor(t,r){this.gl=t.gl,this.location=r}}class ys extends Ai{constructor(t,r){super(t,r),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Xr extends Ai{constructor(t,r){super(t,r),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ri extends Ai{constructor(t,r){super(t,r),this.current=Et.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const en=new Float32Array(16);function Kr(i){return[nr(255*i.r,255*i.g),nr(255*i.b,255*i.a)]}class To{constructor(t,r,s){this.value=t,this.uniformNames=r.map((l=>`u_${l}`)),this.type=s}setUniform(t,r,s){t.set(s.constantOr(this.value))}getBinding(t,r,s){return this.type==="color"?new ri(t,r):new ys(t,r)}}class ka{constructor(t,r){this.uniformNames=r.map((s=>`u_${s}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=t.tlbr}setUniform(t,r,s,l){const f=l==="u_pattern_to"?this.patternTo:l==="u_pattern_from"?this.patternFrom:l==="u_pixel_ratio_to"?this.pixelRatioTo:l==="u_pixel_ratio_from"?this.pixelRatioFrom:null;f&&t.set(f)}getBinding(t,r,s){return s.substr(0,9)==="u_pattern"?new Xr(t,r):new ys(t,r)}}class Gn{constructor(t,r,s,l){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map((f=>({name:`a_${f}`,type:"Float32",components:s==="color"?2:1,offset:0}))),this.paintVertexArray=new l}populatePaintArray(t,r,s,l,f){const m=this.paintVertexArray.length,y=this.expression.evaluate(new wr(0),r,{},l,[],f);this.paintVertexArray.resize(t),this._setPaintValue(m,t,y)}updatePaintArray(t,r,s,l){const f=this.expression.evaluate({zoom:0},s,l);this._setPaintValue(t,r,f)}_setPaintValue(t,r,s){if(this.type==="color"){const l=Kr(s);for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,l[0],l[1])}else{for(let l=t;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class _n{constructor(t,r,s,l,f,m){this.expression=t,this.uniformNames=r.map((y=>`u_${y}_t`)),this.type=s,this.useIntegerZoom=l,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=r.map((y=>({name:`a_${y}`,type:"Float32",components:s==="color"?4:2,offset:0}))),this.paintVertexArray=new m}populatePaintArray(t,r,s,l,f){const m=this.expression.evaluate(new wr(this.zoom),r,{},l,[],f),y=this.expression.evaluate(new wr(this.zoom+1),r,{},l,[],f),v=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(v,t,m,y)}updatePaintArray(t,r,s,l){const f=this.expression.evaluate({zoom:this.zoom},s,l),m=this.expression.evaluate({zoom:this.zoom+1},s,l);this._setPaintValue(t,r,f,m)}_setPaintValue(t,r,s,l){if(this.type==="color"){const f=Kr(s),m=Kr(l);for(let y=t;y<r;y++)this.paintVertexArray.emplace(y,f[0],f[1],m[0],m[1])}else{for(let f=t;f<r;f++)this.paintVertexArray.emplace(f,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=Qt(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(l)}getBinding(t,r,s){return new ys(t,r)}}class vs{constructor(t,r,s,l,f,m){this.expression=t,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=m,this.zoomInPaintVertexArray=new f,this.zoomOutPaintVertexArray=new f}populatePaintArray(t,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(l,t,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(t,r,s,l,f){this._setPaintValues(t,r,s.patterns&&s.patterns[this.layerId],f)}_setPaintValues(t,r,s,l){if(!l||!s)return;const{min:f,mid:m,max:y}=s,v=l[f],S=l[m],M=l[y];if(v&&S&&M)for(let E=t;E<r;E++)this.zoomInPaintVertexArray.emplace(E,S.tl[0],S.tl[1],S.br[0],S.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],S.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(E,S.tl[0],S.tl[1],S.br[0],S.br[1],M.tl[0],M.tl[1],M.br[0],M.br[1],S.pixelRatio,M.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Hr.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Hr.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Hh{constructor(t,r,s){this.binders={},this._buffers=[];const l=[];for(const f in t.paint._values){if(!s(f))continue;const m=t.paint.get(f);if(!(m instanceof Dn&&ps(m.property.specification)))continue;const y=Xh(f,t.type),v=m.value,S=m.property.specification.type,M=m.property.useIntegerZoom,E=m.property.specification["property-type"],D=E==="cross-faded"||E==="cross-faded-data-driven";if(v.kind==="constant")this.binders[f]=D?new ka(v.value,y):new To(v.value,y,S),l.push(`/u_${f}`);else if(v.kind==="source"||D){const L=lu(f,S,"source");this.binders[f]=D?new vs(v,S,M,r,L,t.id):new Gn(v,y,S,L),l.push(`/a_${f}`)}else{const L=lu(f,S,"composite");this.binders[f]=new _n(v,y,S,M,r,L),l.push(`/z_${f}`)}}this.cacheKey=l.sort().join("")}getMaxValue(t){const r=this.binders[t];return r instanceof Gn||r instanceof _n?r.maxValue:0}populatePaintArrays(t,r,s,l,f){for(const m in this.binders){const y=this.binders[m];(y instanceof Gn||y instanceof _n||y instanceof vs)&&y.populatePaintArray(t,r,s,l,f)}}setConstantPatternPositions(t,r){for(const s in this.binders){const l=this.binders[s];l instanceof ka&&l.setConstantPatternPositions(t,r)}}updatePaintArrays(t,r,s,l,f){let m=!1;for(const y in t){const v=r.getPositions(y);for(const S of v){const M=s.feature(S.index);for(const E in this.binders){const D=this.binders[E];if((D instanceof Gn||D instanceof _n||D instanceof vs)&&D.expression.isStateDependent===!0){const L=l.paint.get(E);D.expression=L.value,D.updatePaintArray(S.start,S.end,M,t[y],f),m=!0}}}}return m}defines(){const t=[];for(const r in this.binders){const s=this.binders[r];(s instanceof To||s instanceof ka)&&t.push(...s.uniformNames.map((l=>`#define HAS_UNIFORM_${l}`)))}return t}getBinderAttributes(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Gn||s instanceof _n)for(let l=0;l<s.paintVertexAttributes.length;l++)t.push(s.paintVertexAttributes[l].name);else if(s instanceof vs)for(let l=0;l<Hr.members.length;l++)t.push(Hr.members[l].name)}return t}getBinderUniforms(){const t=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof To||s instanceof ka||s instanceof _n)for(const l of s.uniformNames)t.push(l)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,r){const s=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof To||f instanceof ka||f instanceof _n){for(const m of f.uniformNames)if(r[m]){const y=f.getBinding(t,r[m],m);s.push({name:m,property:l,binding:y})}}}return s}setUniforms(t,r,s,l){for(const{name:f,property:m,binding:y}of r)this.binders[m].setUniform(y,l,s.get(m),f)}updatePaintBuffers(t){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(t&&s instanceof vs){const l=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof Gn||s instanceof _n)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(t){for(const r in this.binders){const s=this.binders[r];(s instanceof Gn||s instanceof _n||s instanceof vs)&&s.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const r=this.binders[t];(r instanceof Gn||r instanceof _n||r instanceof vs)&&r.destroy()}}}class Gi{constructor(t,r,s=()=>!0){this.programConfigurations={};for(const l of t)this.programConfigurations[l.id]=new Hh(l,r,s);this.needsUpload=!1,this._featureMap=new Xs,this._bufferOffset=0}populatePaintArrays(t,r,s,l,f,m){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(t,r,l,f,m);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,r,s,l){for(const f of s)this.needsUpload=this.programConfigurations[f.id].updatePaintArrays(t,this._featureMap,r,f,l)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function Xh(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function lu(i,t,r){const s={color:{source:wo,composite:I},number:{source:p,composite:wo}},l=(function(f){return{"line-pattern":{source:Fe,composite:Fe},"fill-pattern":{source:Fe,composite:Fe},"fill-extrusion-pattern":{source:Fe,composite:Fe}}[f]})(i);return l&&l[r]||s[t][r]}He("ConstantBinder",To),He("CrossFadedConstantBinder",ka),He("SourceExpressionBinder",Gn),He("CrossFadedCompositeBinder",vs),He("CompositeExpressionBinder",_n),He("ProgramConfiguration",Hh,{omit:["_buffers"]}),He("ProgramConfigurationSet",Gi);const Il=Math.pow(2,14)-1,El=-Il-1;function xs(i){const t=ht/i.extent,r=i.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let f=0;f<l.length;f++){const m=l[f],y=Math.round(m.x*t),v=Math.round(m.y*t);m.x=Qt(y,El,Il),m.y=Qt(v,El,Il),(y<m.x||y>m.x+1||v<m.y||v>m.y+1)&&Gt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function qn(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?xs(i):[]}}const pm=-32768;function kv(i,t,r,s,l){i.emplaceBack(pm+8*t+s,pm+8*r+l)}class bp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ge,this.indexArray=new ir,this.segments=new xt,this.programConfigurations=new Gi(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,s){const l=this.layers[0],f=[];let m=null,y=!1,v=l.type==="heatmap";if(l.type==="circle"){const M=l;m=M.layout.get("circle-sort-key"),y=!m.isConstant(),v=v||M.paint.get("circle-pitch-alignment")==="map"}const S=v?r.subdivisionGranularity.circle:1;for(const{feature:M,id:E,index:D,sourceLayerIndex:L}of t){const F=this.layers[0]._featureFilter.needGeometry,N=qn(M,F);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{globalState:this.globalState}),N,s))continue;const Z=y?m.evaluate(N,{},s):void 0,Y={id:E,properties:M.properties,type:M.type,sourceLayerIndex:L,index:D,geometry:F?N.geometry:xs(M),patterns:{},sortKey:Z};f.push(Y)}y&&f.sort(((M,E)=>M.sortKey-E.sortKey));for(const M of f){const{geometry:E,index:D,sourceLayerIndex:L}=M,F=t[D].feature;this.addFeature(M,E,D,s,S),r.featureIndex.insert(F,E,D,L,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rr),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,r,s,l,f=1){let m;switch(f){case 1:m=[0,7];break;case 3:m=[0,2,5,7];break;case 5:m=[0,1,3,4,6,7];break;case 7:m=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${f}; valid values are 1, 3, 5, 7.`)}const y=m.length;for(const v of r)for(const S of v){const M=S.x,E=S.y;if(M<0||M>=ht||E<0||E>=ht)continue;const D=this.segments.prepareSegment(y*y,this.layoutVertexArray,this.indexArray,t.sortKey),L=D.vertexLength;for(let F=0;F<y;F++)for(let N=0;N<y;N++)kv(this.layoutVertexArray,M,E,m[N],m[F]);for(let F=0;F<y-1;F++)for(let N=0;N<y-1;N++){const Z=L+F*y+N,Y=L+(F+1)*y+N;this.indexArray.emplaceBack(Z,Y+1,Z+1),this.indexArray.emplaceBack(Z,Y,Y+1)}D.vertexLength+=y*y,D.primitiveLength+=(y-1)*(y-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},l)}}function fm(i,t){for(let r=0;r<i.length;r++)if(Al(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(Al(i,t[r]))return!0;return!!wp(i,t)}function zv(i,t,r){return!!Al(i,t)||!!Tp(t,i,r)}function mm(i,t){if(i.length===1)return _m(t,i[0]);for(let r=0;r<t.length;r++){const s=t[r];for(let l=0;l<s.length;l++)if(Al(i,s[l]))return!0}for(let r=0;r<i.length;r++)if(_m(t,i[r]))return!0;for(let r=0;r<t.length;r++)if(wp(i,t[r]))return!0;return!1}function Dv(i,t,r){if(i.length>1){if(wp(i,t))return!0;for(let s=0;s<t.length;s++)if(Tp(t[s],i,r))return!0}for(let s=0;s<i.length;s++)if(Tp(i[s],t,r))return!0;return!1}function wp(i,t){if(i.length===0||t.length===0)return!1;for(let r=0;r<i.length-1;r++){const s=i[r],l=i[r+1];for(let f=0;f<t.length-1;f++)if(Rv(s,l,t[f],t[f+1]))return!0}return!1}function Rv(i,t,r,s){return mr(i,r,s)!==mr(t,r,s)&&mr(i,t,r)!==mr(i,t,s)}function Tp(i,t,r){const s=r*r;if(t.length===1)return i.distSqr(t[0])<s;for(let l=1;l<t.length;l++)if(gm(i,t[l-1],t[l])<s)return!0;return!1}function gm(i,t,r){const s=t.distSqr(r);if(s===0)return i.distSqr(t);const l=((i.x-t.x)*(r.x-t.x)+(i.y-t.y)*(r.y-t.y))/s;return i.distSqr(l<0?t:l>1?r:r.sub(t)._mult(l)._add(t))}function _m(i,t){let r,s,l,f=!1;for(let m=0;m<i.length;m++){r=i[m];for(let y=0,v=r.length-1;y<r.length;v=y++)s=r[y],l=r[v],s.y>t.y!=l.y>t.y&&t.x<(l.x-s.x)*(t.y-s.y)/(l.y-s.y)+s.x&&(f=!f)}return f}function Al(i,t){let r=!1;for(let s=0,l=i.length-1;s<i.length;l=s++){const f=i[s],m=i[l];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(r=!r)}return r}function Lv(i,t,r){const s=r[0],l=r[2];if(i.x<s.x&&t.x<s.x||i.x>l.x&&t.x>l.x||i.y<s.y&&t.y<s.y||i.y>l.y&&t.y>l.y)return!1;const f=mr(i,t,r[0]);return f!==mr(i,t,r[1])||f!==mr(i,t,r[2])||f!==mr(i,t,r[3])}function cu(i,t,r){const s=t.paint.get(i).value;return s.kind==="constant"?s.value:r.programConfigurations.get(t.id).getMaxValue(i)}function Kh(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Yh(i,t,r,s,l){if(!t[0]&&!t[1])return i;const f=B.convert(t)._mult(l);r==="viewport"&&f._rotate(-s);const m=[];for(let y=0;y<i.length;y++)m.push(i[y].sub(f));return m}let ym,vm;He("CircleBucket",bp,{omit:["layers"]});var Bv={get paint(){return vm=vm||new Ii({"circle-radius":new lt(_e.paint_circle["circle-radius"]),"circle-color":new lt(_e.paint_circle["circle-color"]),"circle-blur":new lt(_e.paint_circle["circle-blur"]),"circle-opacity":new lt(_e.paint_circle["circle-opacity"]),"circle-translate":new et(_e.paint_circle["circle-translate"]),"circle-translate-anchor":new et(_e.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new et(_e.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new et(_e.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new lt(_e.paint_circle["circle-stroke-width"]),"circle-stroke-color":new lt(_e.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new lt(_e.paint_circle["circle-stroke-opacity"])})},get layout(){return ym=ym||new Ii({"circle-sort-key":new lt(_e.layout_circle["circle-sort-key"])})}};class Fv extends Qi{constructor(t){super(t,Bv)}createBucket(t){return new bp(t)}queryRadius(t){const r=t;return cu("circle-radius",this,r)+cu("circle-stroke-width",this,r)+Kh(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:s,geometry:l,transform:f,pixelsToTileUnits:m,unwrappedTileID:y,getElevation:v}){const S=Yh(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-f.bearingInRadians,m),M=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),E=this.paint.get("circle-pitch-alignment")==="map",D=E?S:(function(F,N,Z,Y){return F.map((me=>xm(me,N,Z,Y)))})(S,f,y,v),L=E?M*m:M;for(const F of l)for(const N of F){const Z=E?N:xm(N,f,y,v);let Y=L;const me=f.projectTileCoordinates(N.x,N.y,y,v).signedDistanceFromCamera;if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Y*=me/f.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Y*=f.cameraToCenterDistance/me),zv(D,Z,Y))return!0}return!1}}function xm(i,t,r,s){const l=t.projectTileCoordinates(i.x,i.y,r,s).point;return new B((.5*l.x+.5)*t.width,(.5*-l.y+.5)*t.height)}class bm extends bp{}let wm;He("HeatmapBucket",bm,{omit:["layers"]});var Ov={get paint(){return wm=wm||new Ii({"heatmap-radius":new lt(_e.paint_heatmap["heatmap-radius"]),"heatmap-weight":new lt(_e.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new et(_e.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Sl(_e.paint_heatmap["heatmap-color"]),"heatmap-opacity":new et(_e.paint_heatmap["heatmap-opacity"])})}};function Sp(i,{width:t,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==t*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${t*r*s}`)}else l=new Uint8Array(t*r*s);return i.width=t,i.height=r,i.data=l,i}function Tm(i,{width:t,height:r},s){if(t===i.width&&r===i.height)return;const l=Sp({},{width:t,height:r},s);Pp(i,l,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,r)},s),i.width=t,i.height=r,i.data=l.data}function Pp(i,t,r,s,l,f){if(l.width===0||l.height===0)return t;if(l.width>i.width||l.height>i.height||r.x>i.width-l.width||r.y>i.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>t.width||l.height>t.height||s.x>t.width-l.width||s.y>t.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const m=i.data,y=t.data;if(m===y)throw new Error("srcData equals dstData, so image is already copied");for(let v=0;v<l.height;v++){const S=((r.y+v)*i.width+r.x)*f,M=((s.y+v)*t.width+s.x)*f;for(let E=0;E<l.width*f;E++)y[M+E]=m[S+E]}return t}class uu{constructor(t,r){Sp(this,t,1,r)}resize(t){Tm(this,t,1)}clone(){return new uu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,f){Pp(t,r,s,l,f,1)}}class qi{constructor(t,r){Sp(this,t,4,r)}resize(t){Tm(this,t,4)}replace(t,r){r?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new qi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,r,s,l,f){Pp(t,r,s,l,f,4)}setPixel(t,r,s){const l=4*(t*this.width+r);this.data[l+0]=Math.round(255*s.r/s.a),this.data[l+1]=Math.round(255*s.g/s.a),this.data[l+2]=Math.round(255*s.b/s.a),this.data[l+3]=Math.round(255*s.a)}}function Sm(i){const t={},r=i.resolution||256,s=i.clips?i.clips.length:1,l=i.image||new qi({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const f=(m,y,v)=>{t[i.evaluationKey]=v;const S=i.expression.evaluate(t);l.setPixel(m/4/r,y/4,S)};if(i.clips)for(let m=0,y=0;m<s;++m,y+=4*r)for(let v=0,S=0;v<r;v++,S+=4){const M=v/(r-1),{start:E,end:D}=i.clips[m];f(y,S,E*(1-M)+D*M)}else for(let m=0,y=0;m<r;m++,y+=4)f(0,y,m/(r-1));return l}He("AlphaImage",uu),He("RGBAImage",qi);const Mp="big-fb";class jv extends Qi{createBucket(t){return new bm(t)}constructor(t){super(t,Ov),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Sm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(Mp)&&this.heatmapFbos.delete(Mp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Pm;var Nv={get paint(){return Pm=Pm||new Ii({"hillshade-illumination-direction":new et(_e.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new et(_e.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new et(_e.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new et(_e.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new et(_e.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new et(_e.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new et(_e.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new et(_e.paint_hillshade["hillshade-method"])})}};class Vv extends Qi{constructor(t){super(t,Nv),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let t=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,s=this.paint.get("hillshade-highlight-color").values,l=this.paint.get("hillshade-shadow-color").values;const f=Math.max(t.length,r.length,s.length,l.length);t=t.concat(Array(f-t.length).fill(t.at(-1))),r=r.concat(Array(f-r.length).fill(r.at(-1))),s=s.concat(Array(f-s.length).fill(s.at(-1))),l=l.concat(Array(f-l.length).fill(l.at(-1)));const m=r.map(Fr);return{directionRadians:t.map(Fr),altitudeRadians:m,shadowColor:l,highlightColor:s}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let Mm;var Uv={get paint(){return Mm=Mm||new Ii({"color-relief-opacity":new et(_e["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Sl(_e["paint_color-relief"]["color-relief-color"])})}};class Cp{constructor(t,r,s,l){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(r,l)}update(t,r,s){const{width:l,height:f}=t,m=!(this.size&&this.size[0]===l&&this.size[1]===f||s),{context:y}=this,{gl:v}=y;if(this.useMipmap=!!(r&&r.useMipmap),v.bindTexture(v.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA&&(!r||r.premultiply!==!1)),m)this.size=[l,f],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Ar(t)?v.texImage2D(v.TEXTURE_2D,0,this.format,this.format,v.UNSIGNED_BYTE,t):v.texImage2D(v.TEXTURE_2D,0,this.format,l,f,0,this.format,v.UNSIGNED_BYTE,t.data);else{const{x:S,y:M}=s||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||Ar(t)?v.texSubImage2D(v.TEXTURE_2D,0,S,M,v.RGBA,v.UNSIGNED_BYTE,t):v.texSubImage2D(v.TEXTURE_2D,0,S,M,l,f,v.RGBA,v.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&v.generateMipmap(v.TEXTURE_2D),y.pixelStoreUnpackFlipY.setDefault(),y.pixelStoreUnpack.setDefault(),y.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(t,r,s){const{context:l}=this,{gl:f}=l;f.bindTexture(f.TEXTURE_2D,this.texture),s!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=f.LINEAR),t!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,s||t),this.filter=t),r!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,r),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class Cm{constructor(t,r,s,l=1,f=1,m=1,y=0){if(this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Gt(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const v=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=f,this.blueFactor=m,this.baseShift=y;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let S=0;S<v;S++)this.data[this._idx(-1,S)]=this.data[this._idx(0,S)],this.data[this._idx(v,S)]=this.data[this._idx(v-1,S)],this.data[this._idx(S,-1)]=this.data[this._idx(S,0)],this.data[this._idx(S,v)]=this.data[this._idx(S,v-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(v,-1)]=this.data[this._idx(v-1,0)],this.data[this._idx(-1,v)]=this.data[this._idx(0,v-1)],this.data[this._idx(v,v)]=this.data[this._idx(v-1,v-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let S=0;S<v;S++)for(let M=0;M<v;M++){const E=this.get(S,M);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(t,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(t,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,r){if(t<-1||t>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(t+1)}unpack(t,r,s){return t*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}pack(t){return Im(t,this.getUnpackVector())}getPixels(){return new qi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,r,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,f=r*this.dim+this.dim,m=s*this.dim,y=s*this.dim+this.dim;switch(r){case-1:l=f-1;break;case 1:f=l+1}switch(s){case-1:m=y-1;break;case 1:y=m+1}const v=-r*this.dim,S=-s*this.dim;for(let M=m;M<y;M++)for(let E=l;E<f;E++)this.data[this._idx(E,M)]=t.data[this._idx(E+v,M+S)]}}function Im(i,t){const r=t[0],s=t[1],l=t[2],f=t[3],m=Math.min(r,s,l),y=Math.round((i+f)/m);return{r:Math.floor(y*m/r)%256,g:Math.floor(y*m/s)%256,b:Math.floor(y*m/l)%256}}He("DEMData",Cm);class $v extends Qi{constructor(t){super(t,Uv)}_createColorRamp(t){const r={elevationStops:[],colorStops:[]},s=this._transitionablePaint._values["color-relief-color"].value.expression;if(s instanceof po&&s._styleExpression.expression instanceof gi){this.colorRampExpression=s;const m=s._styleExpression.expression;r.elevationStops=m.labels,r.colorStops=[];for(const y of r.elevationStops)r.colorStops.push(m.evaluate({globals:{elevation:y}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[Et.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=t)return r;const l={elevationStops:[],colorStops:[]},f=(r.elevationStops.length-1)/(t-1);for(let m=0;m<r.elevationStops.length-.5;m+=f)l.elevationStops.push(r.elevationStops[Math.round(m)]),l.colorStops.push(r.colorStops[Math.round(m)]);return Gt(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),l}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(t,r,s){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const l=this._createColorRamp(r),f=new qi({width:l.colorStops.length,height:1}),m=new qi({width:l.colorStops.length,height:1});for(let y=0;y<l.elevationStops.length;y++){const v=Im(l.elevationStops[y],s);m.setPixel(0,y,new Et(v.r/255,v.g/255,v.b/255,1)),f.setPixel(0,y,l.colorStops[y])}return this.colorRampTextures={elevationTexture:new Cp(t,m,t.gl.RGBA),colorTexture:new Cp(t,f,t.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const Zv=Nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Gv}=Zv;function Ip(i,t,r){const s=r.patternDependencies;let l=!1;for(const f of t){const m=f.paint.get(`${i}-pattern`);m.isConstant()||(l=!0);const y=m.constantOr(null);y&&(l=!0,s[y.to]=!0,s[y.from]=!0)}return l}function Ep(i,t,r,s,l){const f=l.patternDependencies;for(const m of t){const y=m.paint.get(`${i}-pattern`).value;if(y.kind!=="constant"){let v=y.evaluate({zoom:s-1},r,{},l.availableImages),S=y.evaluate({zoom:s},r,{},l.availableImages),M=y.evaluate({zoom:s+1},r,{},l.availableImages);v=v&&v.name?v.name:v,S=S&&S.name?S.name:S,M=M&&M.name?M.name:M,f[v]=!0,f[S]=!0,f[M]=!0,r.patterns[m.id]={min:v,mid:S,max:M}}}return r}function Em(i,t,r,s,l){let f;if(l===(function(m,y,v,S){let M=0;for(let E=y,D=v-S;E<v;E+=S)M+=(m[D]-m[E])*(m[E+1]+m[D+1]),D=E;return M})(i,t,r,s)>0)for(let m=t;m<r;m+=s)f=Dm(m/s|0,i[m],i[m+1],f);else for(let m=r-s;m>=t;m-=s)f=Dm(m/s|0,i[m],i[m+1],f);return f&&kl(f,f.next)&&(fu(f),f=f.next),f}function So(i,t){if(!i)return i;t||(t=i);let r,s=i;do if(r=!1,s.steiner||!kl(s,s.next)&&$r(s.prev,s,s.next)!==0)s=s.next;else{if(fu(s),s=t=s.prev,s===s.next)break;r=!0}while(r||s!==t);return t}function hu(i,t,r,s,l,f,m){if(!i)return;!m&&f&&(function(v,S,M,E){let D=v;do D.z===0&&(D.z=Ap(D.x,D.y,S,M,E)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==v);D.prevZ.nextZ=null,D.prevZ=null,(function(L){let F,N=1;do{let Z,Y=L;L=null;let me=null;for(F=0;Y;){F++;let ne=Y,oe=0;for(let Pe=0;Pe<N&&(oe++,ne=ne.nextZ,ne);Pe++);let be=N;for(;oe>0||be>0&&ne;)oe!==0&&(be===0||!ne||Y.z<=ne.z)?(Z=Y,Y=Y.nextZ,oe--):(Z=ne,ne=ne.nextZ,be--),me?me.nextZ=Z:L=Z,Z.prevZ=me,me=Z;Y=ne}me.nextZ=null,N*=2}while(F>1)})(D)})(i,s,l,f);let y=i;for(;i.prev!==i.next;){const v=i.prev,S=i.next;if(f?Wv(i,s,l,f):qv(i))t.push(v.i,i.i,S.i),fu(i),i=S.next,y=S.next;else if((i=S)===y){m?m===1?hu(i=Hv(So(i),t),t,r,s,l,f,2):m===2&&Xv(i,t,r,s,l,f):hu(So(i),t,r,s,l,f,1);break}}}function qv(i){const t=i.prev,r=i,s=i.next;if($r(t,r,s)>=0)return!1;const l=t.x,f=r.x,m=s.x,y=t.y,v=r.y,S=s.y,M=Math.min(l,f,m),E=Math.min(y,v,S),D=Math.max(l,f,m),L=Math.max(y,v,S);let F=s.next;for(;F!==t;){if(F.x>=M&&F.x<=D&&F.y>=E&&F.y<=L&&du(l,y,f,v,m,S,F.x,F.y)&&$r(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function Wv(i,t,r,s){const l=i.prev,f=i,m=i.next;if($r(l,f,m)>=0)return!1;const y=l.x,v=f.x,S=m.x,M=l.y,E=f.y,D=m.y,L=Math.min(y,v,S),F=Math.min(M,E,D),N=Math.max(y,v,S),Z=Math.max(M,E,D),Y=Ap(L,F,t,r,s),me=Ap(N,Z,t,r,s);let ne=i.prevZ,oe=i.nextZ;for(;ne&&ne.z>=Y&&oe&&oe.z<=me;){if(ne.x>=L&&ne.x<=N&&ne.y>=F&&ne.y<=Z&&ne!==l&&ne!==m&&du(y,M,v,E,S,D,ne.x,ne.y)&&$r(ne.prev,ne,ne.next)>=0||(ne=ne.prevZ,oe.x>=L&&oe.x<=N&&oe.y>=F&&oe.y<=Z&&oe!==l&&oe!==m&&du(y,M,v,E,S,D,oe.x,oe.y)&&$r(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;ne&&ne.z>=Y;){if(ne.x>=L&&ne.x<=N&&ne.y>=F&&ne.y<=Z&&ne!==l&&ne!==m&&du(y,M,v,E,S,D,ne.x,ne.y)&&$r(ne.prev,ne,ne.next)>=0)return!1;ne=ne.prevZ}for(;oe&&oe.z<=me;){if(oe.x>=L&&oe.x<=N&&oe.y>=F&&oe.y<=Z&&oe!==l&&oe!==m&&du(y,M,v,E,S,D,oe.x,oe.y)&&$r(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function Hv(i,t){let r=i;do{const s=r.prev,l=r.next.next;!kl(s,l)&&km(s,r,r.next,l)&&pu(s,l)&&pu(l,s)&&(t.push(s.i,r.i,l.i),fu(r),fu(r.next),r=i=l),r=r.next}while(r!==i);return So(r)}function Xv(i,t,r,s,l,f){let m=i;do{let y=m.next.next;for(;y!==m.prev;){if(m.i!==y.i&&ex(m,y)){let v=zm(m,y);return m=So(m,m.next),v=So(v,v.next),hu(m,t,r,s,l,f,0),void hu(v,t,r,s,l,f,0)}y=y.next}m=m.next}while(m!==i)}function Kv(i,t){let r=i.x-t.x;return r===0&&(r=i.y-t.y,r===0)&&(r=(i.next.y-i.y)/(i.next.x-i.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function Yv(i,t){const r=(function(l,f){let m=f;const y=l.x,v=l.y;let S,M=-1/0;if(kl(l,m))return m;do{if(kl(l,m.next))return m.next;if(v<=m.y&&v>=m.next.y&&m.next.y!==m.y){const N=m.x+(v-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(N<=y&&N>M&&(M=N,S=m.x<m.next.x?m:m.next,N===y))return S}m=m.next}while(m!==f);if(!S)return null;const E=S,D=S.x,L=S.y;let F=1/0;m=S;do{if(y>=m.x&&m.x>=D&&y!==m.x&&Am(v<L?y:M,v,D,L,v<L?M:y,v,m.x,m.y)){const N=Math.abs(v-m.y)/(y-m.x);pu(m,l)&&(N<F||N===F&&(m.x>S.x||m.x===S.x&&Jv(S,m)))&&(S=m,F=N)}m=m.next}while(m!==E);return S})(i,t);if(!r)return t;const s=zm(r,i);return So(s,s.next),So(r,r.next)}function Jv(i,t){return $r(i.prev,i,t.prev)<0&&$r(t.next,i,i.next)<0}function Ap(i,t,r,s,l){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-r)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-s)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qv(i){let t=i,r=i;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==i);return r}function Am(i,t,r,s,l,f,m,y){return(l-m)*(t-y)>=(i-m)*(f-y)&&(i-m)*(s-y)>=(r-m)*(t-y)&&(r-m)*(f-y)>=(l-m)*(s-y)}function du(i,t,r,s,l,f,m,y){return!(i===m&&t===y)&&Am(i,t,r,s,l,f,m,y)}function ex(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!(function(r,s){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&km(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1})(i,t)&&(pu(i,t)&&pu(t,i)&&(function(r,s){let l=r,f=!1;const m=(r.x+s.x)/2,y=(r.y+s.y)/2;do l.y>y!=l.next.y>y&&l.next.y!==l.y&&m<(l.next.x-l.x)*(y-l.y)/(l.next.y-l.y)+l.x&&(f=!f),l=l.next;while(l!==r);return f})(i,t)&&($r(i.prev,i,t.prev)||$r(i,t.prev,t))||kl(i,t)&&$r(i.prev,i,i.next)>0&&$r(t.prev,t,t.next)>0)}function $r(i,t,r){return(t.y-i.y)*(r.x-t.x)-(t.x-i.x)*(r.y-t.y)}function kl(i,t){return i.x===t.x&&i.y===t.y}function km(i,t,r,s){const l=Qh($r(i,t,r)),f=Qh($r(i,t,s)),m=Qh($r(r,s,i)),y=Qh($r(r,s,t));return l!==f&&m!==y||!(l!==0||!Jh(i,r,t))||!(f!==0||!Jh(i,s,t))||!(m!==0||!Jh(r,i,s))||!(y!==0||!Jh(r,t,s))}function Jh(i,t,r){return t.x<=Math.max(i.x,r.x)&&t.x>=Math.min(i.x,r.x)&&t.y<=Math.max(i.y,r.y)&&t.y>=Math.min(i.y,r.y)}function Qh(i){return i>0?1:i<0?-1:0}function pu(i,t){return $r(i.prev,i,i.next)<0?$r(i,t,i.next)>=0&&$r(i,i.prev,t)>=0:$r(i,t,i.prev)<0||$r(i,i.next,t)<0}function zm(i,t){const r=kp(i.i,i.x,i.y),s=kp(t.i,t.x,t.y),l=i.next,f=t.prev;return i.next=t,t.prev=i,r.next=l,l.prev=r,s.next=r,r.prev=s,f.next=s,s.prev=f,s}function Dm(i,t,r,s){const l=kp(i,t,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function fu(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function kp(i,t,r){return{i,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class zl{constructor(t,r){if(r>t)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=t,this._minGranularity=r}getGranularityForZoomLevel(t){return Math.max(Math.floor(this._baseZoomGranularity/(1<<t)),this._minGranularity,1)}}class ed{constructor(t){this.fill=t.fill,this.line=t.line,this.tile=t.tile,this.stencil=t.stencil,this.circle=t.circle}}ed.noSubdivision=new ed({fill:new zl(0,0),line:new zl(0,0),tile:new zl(0,0),stencil:new zl(0,0),circle:1}),He("SubdivisionGranularityExpression",zl),He("SubdivisionGranularitySetting",ed);const Dl=-32768,mu=32767;class tx{constructor(t,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=t,this._granularityCellSize=ht/t,this._canonical=r}_getKey(t,r){return(t+=32768)<<16|r+32768}_vertexToIndex(t,r){if(t<-32768||r<-32768||t>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const s=0|Math.round(t),l=0|Math.round(r),f=this._getKey(s,l);if(this._vertexDictionary.has(f))return this._vertexDictionary.get(f);const m=this._vertexBuffer.length/2;return this._vertexDictionary.set(f,m),this._vertexBuffer.push(s,l),m}_subdivideTrianglesScanline(t){if(this._granularity<2)return(function(l,f){const m=[];for(let y=0;y<f.length;y+=3){const v=f[y],S=f[y+1],M=f[y+2],E=l[2*v],D=l[2*v+1];(l[2*S]-E)*(l[2*M+1]-D)-(l[2*S+1]-D)*(l[2*M]-E)>0?(m.push(v),m.push(M),m.push(S)):(m.push(v),m.push(S),m.push(M))}return m})(this._vertexBuffer,t);const r=[],s=t.length;for(let l=0;l<s;l+=3){const f=[t[l+0],t[l+1],t[l+2]],m=[this._vertexBuffer[2*t[l+0]+0],this._vertexBuffer[2*t[l+0]+1],this._vertexBuffer[2*t[l+1]+0],this._vertexBuffer[2*t[l+1]+1],this._vertexBuffer[2*t[l+2]+0],this._vertexBuffer[2*t[l+2]+1]];let y=1/0,v=1/0,S=-1/0,M=-1/0;for(let N=0;N<3;N++){const Z=m[2*N],Y=m[2*N+1];y=Math.min(y,Z),S=Math.max(S,Z),v=Math.min(v,Y),M=Math.max(M,Y)}if(y===S||v===M)continue;const E=Math.floor(y/this._granularityCellSize),D=Math.ceil(S/this._granularityCellSize),L=Math.floor(v/this._granularityCellSize),F=Math.ceil(M/this._granularityCellSize);if(E!==D||L!==F)for(let N=L;N<F;N++){const Z=this._scanlineGenerateVertexRingForCellRow(N,m,f);rx(this._vertexBuffer,Z,r)}else r.push(...f)}return r}_scanlineGenerateVertexRingForCellRow(t,r,s){const l=t*this._granularityCellSize,f=l+this._granularityCellSize,m=[];for(let y=0;y<3;y++){const v=r[2*y],S=r[2*y+1],M=r[2*(y+1)%6],E=r[(2*(y+1)+1)%6],D=r[2*(y+2)%6],L=r[(2*(y+2)+1)%6],F=M-v,N=E-S,Z=F===0,Y=N===0,me=(l-S)/N,ne=(f-S)/N,oe=Math.min(me,ne),be=Math.max(me,ne);if(!Y&&(oe>=1||be<=0)||Y&&(S<l||S>f)){E>=l&&E<=f&&m.push(s[(y+1)%3]);continue}!Y&&oe>0&&m.push(this._vertexToIndex(v+F*oe,S+N*oe));const Pe=v+F*Math.max(oe,0),Be=v+F*Math.min(be,1);Z||this._generateIntraEdgeVertices(m,v,S,M,E,Pe,Be),!Y&&be<1&&m.push(this._vertexToIndex(v+F*be,S+N*be)),(Y||E>=l&&E<=f)&&m.push(s[(y+1)%3]),!Y&&(E<=l||E>=f)&&this._generateInterEdgeVertices(m,v,S,M,E,D,L,Be,l,f)}return m}_generateIntraEdgeVertices(t,r,s,l,f,m,y){const v=l-r,S=f-s,M=S===0,E=M?Math.min(r,l):Math.min(m,y),D=M?Math.max(r,l):Math.max(m,y),L=Math.floor(E/this._granularityCellSize)+1,F=Math.ceil(D/this._granularityCellSize)-1;if(M?r<l:m<y)for(let N=L;N<=F;N++){const Z=N*this._granularityCellSize;t.push(this._vertexToIndex(Z,s+S*(Z-r)/v))}else for(let N=F;N>=L;N--){const Z=N*this._granularityCellSize;t.push(this._vertexToIndex(Z,s+S*(Z-r)/v))}}_generateInterEdgeVertices(t,r,s,l,f,m,y,v,S,M){const E=f-s,D=m-l,L=y-f,F=(S-f)/L,N=(M-f)/L,Z=Math.min(F,N),Y=Math.max(F,N),me=l+D*Z;let ne=Math.floor(Math.min(me,v)/this._granularityCellSize)+1,oe=Math.ceil(Math.max(me,v)/this._granularityCellSize)-1,be=v<me;const Pe=L===0;if(Pe&&(y===S||y===M))return;if(Pe||Z>=1||Y<=0){const qe=s-y,Ne=m+(r-m)*Math.min((S-y)/qe,(M-y)/qe);ne=Math.floor(Math.min(Ne,v)/this._granularityCellSize)+1,oe=Math.ceil(Math.max(Ne,v)/this._granularityCellSize)-1,be=v<Ne}const Be=E>0?M:S;if(be)for(let qe=ne;qe<=oe;qe++)t.push(this._vertexToIndex(qe*this._granularityCellSize,Be));else for(let qe=oe;qe>=ne;qe--)t.push(this._vertexToIndex(qe*this._granularityCellSize,Be))}_generateOutline(t){const r=[];for(const s of t){const l=Po(s,this._granularity,!0),f=this._pointArrayToIndices(l),m=[];for(let y=1;y<f.length;y++)m.push(f[y-1]),m.push(f[y]);r.push(m)}return r}_handlePoles(t){let r=!1,s=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(s=!0)),(r||s)&&this._fillPoles(t,r,s)}_ensureNoPoleVertices(){const t=this._vertexBuffer;for(let r=0;r<t.length;r+=2){const s=t[r+1];s===Dl&&(t[r+1]=-32767),s===mu&&(t[r+1]=32766)}}_generatePoleQuad(t,r,s,l,f,m){l>f!=(m===Dl)?(t.push(r),t.push(s),t.push(this._vertexToIndex(l,m)),t.push(s),t.push(this._vertexToIndex(f,m)),t.push(this._vertexToIndex(l,m))):(t.push(s),t.push(r),t.push(this._vertexToIndex(l,m)),t.push(this._vertexToIndex(f,m)),t.push(s),t.push(this._vertexToIndex(l,m)))}_fillPoles(t,r,s){const l=this._vertexBuffer,f=ht,m=t.length;for(let y=2;y<m;y+=3){const v=t[y-2],S=t[y-1],M=t[y],E=l[2*v],D=l[2*v+1],L=l[2*S],F=l[2*S+1],N=l[2*M],Z=l[2*M+1];r&&(D===0&&F===0&&this._generatePoleQuad(t,v,S,E,L,Dl),F===0&&Z===0&&this._generatePoleQuad(t,S,M,L,N,Dl),Z===0&&D===0&&this._generatePoleQuad(t,M,v,N,E,Dl)),s&&(D===f&&F===f&&this._generatePoleQuad(t,v,S,E,L,mu),F===f&&Z===f&&this._generatePoleQuad(t,S,M,L,N,mu),Z===f&&D===f&&this._generatePoleQuad(t,M,v,N,E,mu))}}_initializeVertices(t){for(let r=0;r<t.length;r+=2)this._vertexToIndex(t[r],t[r+1])}subdividePolygonInternal(t,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:s,holeIndices:l}=(function(y){const v=[],S=[];for(const M of y)if(M.length!==0){M!==y[0]&&v.push(S.length/2);for(let E=0;E<M.length;E++)S.push(M[E].x),S.push(M[E].y)}return{flattened:S,holeIndices:v}})(t);let f;this._initializeVertices(s);try{const y=(function(S,M,E=2){const D=M&&M.length,L=D?M[0]*E:S.length;let F=Em(S,0,L,E,!0);const N=[];if(!F||F.next===F.prev)return N;let Z,Y,me;if(D&&(F=(function(ne,oe,be,Pe){const Be=[];for(let qe=0,Ne=oe.length;qe<Ne;qe++){const Ze=Em(ne,oe[qe]*Pe,qe<Ne-1?oe[qe+1]*Pe:ne.length,Pe,!1);Ze===Ze.next&&(Ze.steiner=!0),Be.push(Qv(Ze))}Be.sort(Kv);for(let qe=0;qe<Be.length;qe++)be=Yv(Be[qe],be);return be})(S,M,F,E)),S.length>80*E){Z=S[0],Y=S[1];let ne=Z,oe=Y;for(let be=E;be<L;be+=E){const Pe=S[be],Be=S[be+1];Pe<Z&&(Z=Pe),Be<Y&&(Y=Be),Pe>ne&&(ne=Pe),Be>oe&&(oe=Be)}me=Math.max(ne-Z,oe-Y),me=me!==0?32767/me:0}return hu(F,N,E,Z,Y,me,0),N})(s,l),v=this._convertIndices(s,y);f=this._subdivideTrianglesScanline(v)}catch(y){console.error(y)}let m=[];return r&&(m=this._generateOutline(t)),this._ensureNoPoleVertices(),this._handlePoles(f),{verticesFlattened:this._vertexBuffer,indicesTriangles:f,indicesLineList:m}}_convertIndices(t,r){const s=[];for(let l=0;l<r.length;l++)s.push(this._vertexToIndex(t[2*r[l]],t[2*r[l]+1]));return s}_pointArrayToIndices(t){const r=[];for(let s=0;s<t.length;s++){const l=t[s];r.push(this._vertexToIndex(l.x,l.y))}return r}}function Rm(i,t,r,s=!0){return new tx(r,t).subdividePolygonInternal(i,s)}function Po(i,t,r=!1){if(!i||i.length<1)return[];if(i.length<2)return[];const s=i[0],l=i[i.length-1],f=r&&(s.x!==l.x||s.y!==l.y);if(t<2)return f?[...i,i[0]]:[...i];const m=Math.floor(ht/t),y=[];y.push(new B(i[0].x,i[0].y));const v=i.length,S=f?v:v-1;for(let M=0;M<S;M++){const E=i[M],D=M<v-1?i[M+1]:i[0],L=E.x,F=E.y,N=D.x,Z=D.y,Y=L!==N,me=F!==Z;if(!Y&&!me)continue;const ne=N-L,oe=Z-F,be=Math.abs(ne),Pe=Math.abs(oe);let Be=L,qe=F;for(;;){const Ze=ne>0?(Math.floor(Be/m)+1)*m:(Math.ceil(Be/m)-1)*m,it=oe>0?(Math.floor(qe/m)+1)*m:(Math.ceil(qe/m)-1)*m,Ue=Math.abs(Be-Ze),Ge=Math.abs(qe-it),Ae=Math.abs(Be-N),ut=Math.abs(qe-Z),ft=Y?Ue/be:Number.POSITIVE_INFINITY,st=me?Ge/Pe:Number.POSITIVE_INFINITY;if((Ae<=Ue||!Y)&&(ut<=Ge||!me))break;if(ft<st&&Y||!me){Be=Ze,qe+=oe*ft;const Je=new B(Be,Math.round(qe));y[y.length-1].x===Je.x&&y[y.length-1].y===Je.y||y.push(Je)}else{Be+=ne*st,qe=it;const Je=new B(Math.round(Be),qe);y[y.length-1].x===Je.x&&y[y.length-1].y===Je.y||y.push(Je)}}const Ne=new B(N,Z);y[y.length-1].x===Ne.x&&y[y.length-1].y===Ne.y||y.push(Ne)}return y}function rx(i,t,r){if(t.length===0)throw new Error("Subdivision vertex ring is empty.");let s=0,l=i[2*t[0]];for(let v=1;v<t.length;v++){const S=i[2*t[v]];S<l&&(l=S,s=v)}const f=t.length;let m=s,y=(m+1)%f;for(;;){const v=m-1>=0?m-1:f-1,S=(y+1)%f,M=i[2*t[v]],E=i[2*t[S]],D=i[2*t[m]],L=i[2*t[m]+1],F=i[2*t[y]+1];let N=!1;if(M<E)N=!0;else if(M>E)N=!1;else{const Z=F-L,Y=-(i[2*t[y]]-D),me=L<F?1:-1;((M-D)*Z+(i[2*t[v]+1]-L)*Y)*me>((E-D)*Z+(i[2*t[S]+1]-L)*Y)*me&&(N=!0)}if(N){const Z=t[v],Y=t[m],me=t[y];Z!==Y&&Z!==me&&Y!==me&&r.push(me,Y,Z),m--,m<0&&(m=f-1)}else{const Z=t[S],Y=t[m],me=t[y];Z!==Y&&Z!==me&&Y!==me&&r.push(me,Y,Z),y++,y>=f&&(y=0)}if(v===S)break}}function Lm(i,t,r,s,l,f,m,y,v){const S=l.length/2,M=m&&y&&v;if(S<xt.MAX_VERTEX_ARRAY_LENGTH){const E=t.prepareSegment(S,r,s),D=E.vertexLength;for(let N=0;N<f.length;N+=3)s.emplaceBack(D+f[N],D+f[N+1],D+f[N+2]);let L,F;E.vertexLength+=S,E.primitiveLength+=f.length/3,M&&(F=m.prepareSegment(S,r,y),L=F.vertexLength,F.vertexLength+=S);for(let N=0;N<l.length;N+=2)i(l[N],l[N+1]);if(M)for(let N=0;N<v.length;N++){const Z=v[N];for(let Y=1;Y<Z.length;Y+=2)y.emplaceBack(L+Z[Y-1],L+Z[Y]);F.primitiveLength+=Z.length/2}}else(function(E,D,L,F,N,Z){const Y=[];for(let Pe=0;Pe<F.length/2;Pe++)Y.push(-1);const me={count:0};let ne=0,oe=E.getOrCreateLatestSegment(D,L),be=oe.vertexLength;for(let Pe=2;Pe<N.length;Pe+=3){const Be=N[Pe-2],qe=N[Pe-1],Ne=N[Pe];let Ze=Y[Be]<ne,it=Y[qe]<ne,Ue=Y[Ne]<ne;oe.vertexLength+((Ze?1:0)+(it?1:0)+(Ue?1:0))>xt.MAX_VERTEX_ARRAY_LENGTH&&(oe=E.createNewSegment(D,L),ne=me.count,Ze=!0,it=!0,Ue=!0,be=0);const Ge=gu(Y,F,Z,me,Be,Ze,oe),Ae=gu(Y,F,Z,me,qe,it,oe),ut=gu(Y,F,Z,me,Ne,Ue,oe);L.emplaceBack(be+Ge-ne,be+Ae-ne,be+ut-ne),oe.primitiveLength++}})(t,r,s,l,f,i),M&&(function(E,D,L,F,N,Z){const Y=[];for(let Pe=0;Pe<F.length/2;Pe++)Y.push(-1);const me={count:0};let ne=0,oe=E.getOrCreateLatestSegment(D,L),be=oe.vertexLength;for(let Pe=0;Pe<N.length;Pe++){const Be=N[Pe];for(let qe=1;qe<N[Pe].length;qe+=2){const Ne=Be[qe-1],Ze=Be[qe];let it=Y[Ne]<ne,Ue=Y[Ze]<ne;oe.vertexLength+((it?1:0)+(Ue?1:0))>xt.MAX_VERTEX_ARRAY_LENGTH&&(oe=E.createNewSegment(D,L),ne=me.count,it=!0,Ue=!0,be=0);const Ge=gu(Y,F,Z,me,Ne,it,oe),Ae=gu(Y,F,Z,me,Ze,Ue,oe);L.emplaceBack(be+Ge-ne,be+Ae-ne),oe.primitiveLength++}}})(m,r,y,l,v,i),t.forceNewSegmentOnNextPrepare(),m?.forceNewSegmentOnNextPrepare()}function gu(i,t,r,s,l,f,m){if(f){const y=s.count;return r(t[2*l],t[2*l+1]),i[l]=s.count,s.count++,m.vertexLength++,y}return i[l]}class zp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Te,this.indexArray=new ir,this.indexArray2=new er,this.programConfigurations=new Gi(t.layers,t.zoom),this.segments=new xt,this.segments2=new xt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,s){this.hasPattern=Ip("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),f=!l.isConstant(),m=[];for(const{feature:y,id:v,index:S,sourceLayerIndex:M}of t){const E=this.layers[0]._featureFilter.needGeometry,D=qn(y,E);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{globalState:this.globalState}),D,s))continue;const L=f?l.evaluate(D,{},s,r.availableImages):void 0,F={id:v,properties:y.properties,type:y.type,sourceLayerIndex:M,index:S,geometry:E?D.geometry:xs(y),patterns:{},sortKey:L};m.push(F)}f&&m.sort(((y,v)=>y.sortKey-v.sortKey));for(const y of m){const{geometry:v,index:S,sourceLayerIndex:M}=y;if(this.hasPattern){const E=Ep("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(y,v,S,s,{},r.subdivisionGranularity);r.featureIndex.insert(t[S].feature,v,S,M,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Gv),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,r,s,l,f,m){for(const y of oo(r,500)){const v=Rm(y,l,m.fill.getGranularityForZoomLevel(l.z)),S=this.layoutVertexArray;Lm(((M,E)=>{S.emplaceBack(M,E)}),this.segments,this.layoutVertexArray,this.indexArray,v.verticesFlattened,v.indicesTriangles,this.segments2,this.indexArray2,v.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,l)}}let Bm,Fm;He("FillBucket",zp,{omit:["layers","patternFeatures"]});var ix={get paint(){return Fm=Fm||new Ii({"fill-antialias":new et(_e.paint_fill["fill-antialias"]),"fill-opacity":new lt(_e.paint_fill["fill-opacity"]),"fill-color":new lt(_e.paint_fill["fill-color"]),"fill-outline-color":new lt(_e.paint_fill["fill-outline-color"]),"fill-translate":new et(_e.paint_fill["fill-translate"]),"fill-translate-anchor":new et(_e.paint_fill["fill-translate-anchor"]),"fill-pattern":new Tl(_e.paint_fill["fill-pattern"])})},get layout(){return Bm=Bm||new Ii({"fill-sort-key":new lt(_e.layout_fill["fill-sort-key"])})}};class nx extends Qi{constructor(t){super(t,ix)}recalculate(t,r){super.recalculate(t,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new zp(t)}queryRadius(){return Kh(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:t,geometry:r,transform:s,pixelsToTileUnits:l}){return mm(Yh(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-s.bearingInRadians,l),r)}isTileClipped(){return!0}}const sx=Nr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ax=Nr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ox}=sx;class Rl{constructor(t,r,s,l,f){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=f,t.readFields(lx,this,r)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos,s=[];let l,f=1,m=0,y=0,v=0;for(;t.pos<r;){if(m<=0){const S=t.readVarint();f=7&S,m=S>>3}if(m--,f===1||f===2)y+=t.readSVarint(),v+=t.readSVarint(),f===1&&(l&&s.push(l),l=[]),l&&l.push(new B(y,v));else{if(f!==7)throw new Error(`unknown command ${f}`);l&&l.push(l[0].clone())}}return l&&s.push(l),s}bbox(){const t=this._pbf;t.pos=this._geometry;const r=t.readVarint()+t.pos;let s=1,l=0,f=0,m=0,y=1/0,v=-1/0,S=1/0,M=-1/0;for(;t.pos<r;){if(l<=0){const E=t.readVarint();s=7&E,l=E>>3}if(l--,s===1||s===2)f+=t.readSVarint(),m+=t.readSVarint(),f<y&&(y=f),f>v&&(v=f),m<S&&(S=m),m>M&&(M=m);else if(s!==7)throw new Error(`unknown command ${s}`)}return[y,S,v,M]}toGeoJSON(t,r,s){const l=this.extent*Math.pow(2,s),f=this.extent*t,m=this.extent*r,y=this.loadGeometry();function v(D){return[360*(D.x+f)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(D.y+m)/l)*Math.PI))-90]}function S(D){return D.map(v)}let M;if(this.type===1){const D=[];for(const F of y)D.push(F[0]);const L=S(D);M=D.length===1?{type:"Point",coordinates:L[0]}:{type:"MultiPoint",coordinates:L}}else if(this.type===2){const D=y.map(S);M=D.length===1?{type:"LineString",coordinates:D[0]}:{type:"MultiLineString",coordinates:D}}else{if(this.type!==3)throw new Error("unknown feature type");{const D=(function(F){const N=F.length;if(N<=1)return[F];const Z=[];let Y,me;for(let ne=0;ne<N;ne++){const oe=cx(F[ne]);oe!==0&&(me===void 0&&(me=oe<0),me===oe<0?(Y&&Z.push(Y),Y=[F[ne]]):Y&&Y.push(F[ne]))}return Y&&Z.push(Y),Z})(y),L=[];for(const F of D)L.push(F.map(S));M=L.length===1?{type:"Polygon",coordinates:L[0]}:{type:"MultiPolygon",coordinates:L}}}const E={type:"Feature",geometry:M,properties:this.properties};return this.id!=null&&(E.id=this.id),E}}function lx(i,t,r){i===1?t.id=r.readVarint():i===2?(function(s,l){const f=s.readVarint()+s.pos;for(;s.pos<f;){const m=l._keys[s.readVarint()],y=l._values[s.readVarint()];l.properties[m]=y}})(r,t):i===3?t.type=r.readVarint():i===4&&(t._geometry=r.pos)}function cx(i){let t=0;for(let r,s,l=0,f=i.length,m=f-1;l<f;m=l++)r=i[l],s=i[m],t+=(s.x-r.x)*(r.y+s.y);return t}Rl.types=["Unknown","Point","LineString","Polygon"];class Om{constructor(t,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ux,this,r),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const r=this._pbf.readVarint()+this._pbf.pos;return new Rl(this._pbf,r,this.extent,this._keys,this._values)}}function ux(i,t,r){i===15?t.version=r.readVarint():i===1?t.name=r.readString():i===5?t.extent=r.readVarint():i===2?t._features.push(r.pos):i===3?t._keys.push(r.readString()):i===4&&t._values.push((function(s){let l=null;const f=s.readVarint()+s.pos;for(;s.pos<f;){const m=s.readVarint()>>3;l=m===1?s.readString():m===2?s.readFloat():m===3?s.readDouble():m===4?s.readVarint64():m===5?s.readVarint():m===6?s.readSVarint():m===7?s.readBoolean():null}if(l==null)throw new Error("unknown feature value");return l})(r))}class jm{constructor(t,r){this.layers=t.readFields(hx,{},r)}}function hx(i,t,r){if(i===3){const s=new Om(r,r.readVarint()+r.pos);s.length&&(t[s.name]=s)}}const Dp=Math.pow(2,13);function _u(i,t,r,s,l,f,m,y){i.emplaceBack(t,r,2*Math.floor(s*Dp)+m,l*Dp*2,f*Dp*2,Math.round(y))}class Rp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new ve,this.centroidVertexArray=new ee,this.indexArray=new ir,this.programConfigurations=new Gi(t.layers,t.zoom),this.segments=new xt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,s){this.features=[],this.hasPattern=Ip("fill-extrusion",this.layers,r);for(const{feature:l,id:f,index:m,sourceLayerIndex:y}of t){const v=this.layers[0]._featureFilter.needGeometry,S=qn(l,v);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{globalState:this.globalState}),S,s))continue;const M={id:f,sourceLayerIndex:y,index:m,geometry:v?S.geometry:xs(l),properties:l.properties,type:l.type,patterns:{}};this.hasPattern?this.features.push(Ep("fill-extrusion",this.layers,M,this.zoom,r)):this.addFeature(M,M.geometry,m,s,{},r.subdivisionGranularity),r.featureIndex.insert(l,M.geometry,m,y,this.index,!0)}}addFeatures(t,r,s){for(const l of this.features){const{geometry:f}=l;this.addFeature(l,f,l.index,r,s,t.subdivisionGranularity)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ox),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ax.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,r,s,l,f,m){for(const y of oo(r,500)){const v={x:0,y:0,sampleCount:0},S=this.layoutVertexArray.length;this.processPolygon(v,l,t,y,m);const M=this.layoutVertexArray.length-S,E=Math.floor(v.x/v.sampleCount),D=Math.floor(v.y/v.sampleCount);for(let L=0;L<M;L++)this.centroidVertexArray.emplaceBack(E,D)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,l)}processPolygon(t,r,s,l,f){if(l.length<1||Nm(l[0]))return;for(const E of l)E.length!==0&&dx(t,E);const m={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},y=f.fill.getGranularityForZoomLevel(r.z),v=Rl.types[s.type]==="Polygon";for(const E of l){if(E.length===0||Nm(E))continue;const D=Po(E,y,v);this._generateSideFaces(D,m)}if(!v)return;const S=Rm(l,r,y,!1),M=this.layoutVertexArray;Lm(((E,D)=>{_u(M,E,D,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,S.verticesFlattened,S.indicesTriangles)}_generateSideFaces(t,r){let s=0;for(let l=1;l<t.length;l++){const f=t[l],m=t[l-1];if(px(f,m))continue;r.segment.vertexLength+4>xt.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const y=f.sub(m)._perp()._unit(),v=m.dist(f);s+v>32768&&(s=0),_u(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,0,s),_u(this.layoutVertexArray,f.x,f.y,y.x,y.y,0,1,s),s+=v,_u(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,0,s),_u(this.layoutVertexArray,m.x,m.y,y.x,y.y,0,1,s);const S=r.segment.vertexLength;this.indexArray.emplaceBack(S,S+2,S+1),this.indexArray.emplaceBack(S+1,S+2,S+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function dx(i,t){for(let r=0;r<t.length;r++){const s=t[r];r===t.length-1&&t[0].x===s.x&&t[0].y===s.y||(i.x+=s.x,i.y+=s.y,i.sampleCount++)}}function px(i,t){return i.x===t.x&&(i.x<0||i.x>ht)||i.y===t.y&&(i.y<0||i.y>ht)}function Nm(i){return i.every((t=>t.x<0))||i.every((t=>t.x>ht))||i.every((t=>t.y<0))||i.every((t=>t.y>ht))}let Vm;He("FillExtrusionBucket",Rp,{omit:["layers","features"]});var fx={get paint(){return Vm=Vm||new Ii({"fill-extrusion-opacity":new et(_e["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new lt(_e["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new et(_e["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new et(_e["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Tl(_e["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new lt(_e["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new lt(_e["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new et(_e["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class mx extends Qi{constructor(t){super(t,fx)}createBucket(t){return new Rp(t)}queryRadius(){return Kh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:s,geometry:l,transform:f,pixelsToTileUnits:m,pixelPosMatrix:y}){const v=Yh(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-f.bearingInRadians,m),S=this.paint.get("fill-extrusion-height").evaluate(r,s),M=this.paint.get("fill-extrusion-base").evaluate(r,s),E=(function(L,F){const N=[];for(const Z of L){const Y=[Z.x,Z.y,0,1];At(Y,Y,F),N.push(new B(Y[0]/Y[3],Y[1]/Y[3]))}return N})(v,y),D=(function(L,F,N,Z){const Y=[],me=[],ne=Z[8]*F,oe=Z[9]*F,be=Z[10]*F,Pe=Z[11]*F,Be=Z[8]*N,qe=Z[9]*N,Ne=Z[10]*N,Ze=Z[11]*N;for(const it of L){const Ue=[],Ge=[];for(const Ae of it){const ut=Ae.x,ft=Ae.y,st=Z[0]*ut+Z[4]*ft+Z[12],Je=Z[1]*ut+Z[5]*ft+Z[13],Bt=Z[2]*ut+Z[6]*ft+Z[14],Lr=Z[3]*ut+Z[7]*ft+Z[15],ii=Bt+be,Si=Lr+Pe,vn=st+Be,Wi=Je+qe,_i=Bt+Ne,Cr=Lr+Ze,ui=new B((st+ne)/Si,(Je+oe)/Si);ui.z=ii/Si,Ue.push(ui);const yi=new B(vn/Cr,Wi/Cr);yi.z=_i/Cr,Ge.push(yi)}Y.push(Ue),me.push(Ge)}return[Y,me]})(l,M,S,y);return(function(L,F,N){let Z=1/0;mm(N,F)&&(Z=Um(N,F[0]));for(let Y=0;Y<F.length;Y++){const me=F[Y],ne=L[Y];for(let oe=0;oe<me.length-1;oe++){const be=me[oe],Pe=[be,me[oe+1],ne[oe+1],ne[oe],be];fm(N,Pe)&&(Z=Math.min(Z,Um(N,Pe)))}}return Z!==1/0&&Z})(D[0],D[1],E)}}function yu(i,t){return i.x*t.x+i.y*t.y}function Um(i,t){if(i.length===1){let r=0;const s=t[r++];let l;for(;!l||s.equals(l);)if(l=t[r++],!l)return 1/0;for(;r<t.length;r++){const f=t[r],m=i[0],y=l.sub(s),v=f.sub(s),S=m.sub(s),M=yu(y,y),E=yu(y,v),D=yu(v,v),L=yu(S,y),F=yu(S,v),N=M*D-E*E,Z=(D*L-E*F)/N,Y=(M*F-E*L)/N,me=s.z*(1-Z-Y)+l.z*Z+f.z*Y;if(isFinite(me))return me}return 1/0}{let r=1/0;for(const s of t)r=Math.min(r,s.z);return r}}const gx=Nr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:_x}=gx,yx=Nr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:vx}=yx,xx=Math.cos(Math.PI/180*37.5),$m=Math.pow(2,14)/.5;class Lp{constructor(t){this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new xe,this.layoutVertexArray2=new we,this.indexArray=new ir,this.programConfigurations=new Gi(t.layers,t.zoom),this.segments=new xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(t,r,s){this.hasPattern=Ip("line",this.layers,r);const l=this.layers[0].layout.get("line-sort-key"),f=!l.isConstant(),m=[];for(const{feature:y,id:v,index:S,sourceLayerIndex:M}of t){const E=this.layers[0]._featureFilter.needGeometry,D=qn(y,E);if(!this.layers[0]._featureFilter.filter(new wr(this.zoom,{globalState:this.globalState}),D,s))continue;const L=f?l.evaluate(D,{},s):void 0,F={id:v,properties:y.properties,type:y.type,sourceLayerIndex:M,index:S,geometry:E?D.geometry:xs(y),patterns:{},sortKey:L};m.push(F)}f&&m.sort(((y,v)=>y.sortKey-v.sortKey));for(const y of m){const{geometry:v,index:S,sourceLayerIndex:M}=y;if(this.hasPattern){const E=Ep("line",this.layers,y,this.zoom,r);this.patternFeatures.push(E)}else this.addFeature(y,v,S,s,{},r.subdivisionGranularity);r.featureIndex.insert(t[S].feature,v,S,M,this.index)}}update(t,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,r,this.stateDependentLayers,s)}addFeatures(t,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s,t.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,vx)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_x),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,r,s,l,f,m){const y=this.layers[0].layout,v=y.get("line-join").evaluate(t,{}),S=y.get("line-cap"),M=y.get("line-miter-limit"),E=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const D of r)this.addLine(D,t,v,S,M,E,l,m);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,f,l)}addLine(t,r,s,l,f,m,y,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,t=Po(t,y?v.line.getGranularityForZoomLevel(y.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ne=0;ne<t.length-1;ne++)this.totalDistance+=t[ne].dist(t[ne+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const S=Rl.types[r.type]==="Polygon";let M=t.length;for(;M>=2&&t[M-1].equals(t[M-2]);)M--;let E=0;for(;E<M-1&&t[E].equals(t[E+1]);)E++;if(M<(S?3:2))return;s==="bevel"&&(f=1.05);const D=this.overscaling<=16?122880/(512*this.overscaling):0,L=this.segments.prepareSegment(10*M,this.layoutVertexArray,this.indexArray);let F,N,Z,Y,me;this.e1=this.e2=-1,S&&(F=t[M-2],me=t[E].sub(F)._unit()._perp());for(let ne=E;ne<M;ne++){if(Z=ne===M-1?S?t[E+1]:void 0:t[ne+1],Z&&t[ne].equals(Z))continue;me&&(Y=me),F&&(N=F),F=t[ne],me=Z?Z.sub(F)._unit()._perp():Y,Y=Y||me;let oe=Y.add(me);oe.x===0&&oe.y===0||oe._unit();const be=Y.x*me.x+Y.y*me.y,Pe=oe.x*me.x+oe.y*me.y,Be=Pe!==0?1/Pe:1/0,qe=2*Math.sqrt(2-2*Pe),Ne=Pe<xx&&N&&Z,Ze=Y.x*me.y-Y.y*me.x>0;if(Ne&&ne>E){const Ge=F.dist(N);if(Ge>2*D){const Ae=F.sub(F.sub(N)._mult(D/Ge)._round());this.updateDistance(N,Ae),this.addCurrentVertex(Ae,Y,0,0,L),N=Ae}}const it=N&&Z;let Ue=it?s:S?"butt":l;if(it&&Ue==="round"&&(Be<m?Ue="miter":Be<=2&&(Ue="fakeround")),Ue==="miter"&&Be>f&&(Ue="bevel"),Ue==="bevel"&&(Be>2&&(Ue="flipbevel"),Be<f&&(Ue="miter")),N&&this.updateDistance(N,F),Ue==="miter")oe._mult(Be),this.addCurrentVertex(F,oe,0,0,L);else if(Ue==="flipbevel"){if(Be>100)oe=me.mult(-1);else{const Ge=Be*Y.add(me).mag()/Y.sub(me).mag();oe._perp()._mult(Ge*(Ze?-1:1))}this.addCurrentVertex(F,oe,0,0,L),this.addCurrentVertex(F,oe.mult(-1),0,0,L)}else if(Ue==="bevel"||Ue==="fakeround"){const Ge=-Math.sqrt(Be*Be-1),Ae=Ze?Ge:0,ut=Ze?0:Ge;if(N&&this.addCurrentVertex(F,Y,Ae,ut,L),Ue==="fakeround"){const ft=Math.round(180*qe/Math.PI/20);for(let st=1;st<ft;st++){let Je=st/ft;if(Je!==.5){const Lr=Je-.5;Je+=Je*Lr*(Je-1)*((1.0904+be*(be*(3.55645-1.43519*be)-3.2452))*Lr*Lr+(.848013+be*(.215638*be-1.06021)))}const Bt=me.sub(Y)._mult(Je)._add(Y)._unit()._mult(Ze?-1:1);this.addHalfVertex(F,Bt.x,Bt.y,!1,Ze,0,L)}}Z&&this.addCurrentVertex(F,me,-Ae,-ut,L)}else if(Ue==="butt")this.addCurrentVertex(F,oe,0,0,L);else if(Ue==="square"){const Ge=N?1:-1;this.addCurrentVertex(F,oe,Ge,Ge,L)}else Ue==="round"&&(N&&(this.addCurrentVertex(F,Y,0,0,L),this.addCurrentVertex(F,Y,1,1,L,!0)),Z&&(this.addCurrentVertex(F,me,-1,-1,L,!0),this.addCurrentVertex(F,me,0,0,L)));if(Ne&&ne<M-1){const Ge=F.dist(Z);if(Ge>2*D){const Ae=F.add(Z.sub(F)._mult(D/Ge)._round());this.updateDistance(F,Ae),this.addCurrentVertex(Ae,me,0,0,L),F=Ae}}}}addCurrentVertex(t,r,s,l,f,m=!1){const y=r.y*l-r.x,v=-r.y-r.x*l;this.addHalfVertex(t,r.x+r.y*s,r.y-r.x*s,m,!1,s,f),this.addHalfVertex(t,y,v,m,!0,-l,f),this.distance>$m/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,r,s,l,f,m))}addHalfVertex({x:t,y:r},s,l,f,m,y,v){const S=.5*(this.lineClips?this.scaledDistance*($m-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(r<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(y===0?0:y<0?-1:1)|(63&S)<<2,S>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const M=v.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,M,this.e2),v.primitiveLength++),m?this.e2=M:this.e1=M}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,r){this.distance+=t.dist(r),this.updateScaledDistance()}}let Zm,Gm;He("LineBucket",Lp,{omit:["layers","patternFeatures"]});var qm={get paint(){return Gm=Gm||new Ii({"line-opacity":new lt(_e.paint_line["line-opacity"]),"line-color":new lt(_e.paint_line["line-color"]),"line-translate":new et(_e.paint_line["line-translate"]),"line-translate-anchor":new et(_e.paint_line["line-translate-anchor"]),"line-width":new lt(_e.paint_line["line-width"]),"line-gap-width":new lt(_e.paint_line["line-gap-width"]),"line-offset":new lt(_e.paint_line["line-offset"]),"line-blur":new lt(_e.paint_line["line-blur"]),"line-dasharray":new ms(_e.paint_line["line-dasharray"]),"line-pattern":new Tl(_e.paint_line["line-pattern"]),"line-gradient":new Sl(_e.paint_line["line-gradient"])})},get layout(){return Zm=Zm||new Ii({"line-cap":new et(_e.layout_line["line-cap"]),"line-join":new lt(_e.layout_line["line-join"]),"line-miter-limit":new et(_e.layout_line["line-miter-limit"]),"line-round-limit":new et(_e.layout_line["line-round-limit"]),"line-sort-key":new lt(_e.layout_line["line-sort-key"])})}};class bx extends lt{possiblyEvaluate(t,r){return r=new wr(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(t,r)}evaluate(t,r,s,l){return r=Vt({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(t,r,s,l)}}let td;class wx extends Qi{constructor(t){super(t,qm),this.gradientVersion=0,td||(td=new bx(qm.paint.properties["line-width"].specification),td.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(s){return s._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof jr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,r){super.recalculate(t,r),this.paint._values["line-floorwidth"]=td.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Lp(t)}queryRadius(t){const r=t,s=Wm(cu("line-width",this,r),cu("line-gap-width",this,r)),l=cu("line-offset",this,r);return s/2+Math.abs(l)+Kh(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:t,feature:r,featureState:s,geometry:l,transform:f,pixelsToTileUnits:m}){const y=Yh(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-f.bearingInRadians,m),v=m/2*Wm(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),S=this.paint.get("line-offset").evaluate(r,s);return S&&(l=(function(M,E){const D=[];for(let L=0;L<M.length;L++){const F=M[L],N=[];for(let Z=0;Z<F.length;Z++){const Y=F[Z-1],me=F[Z],ne=F[Z+1],oe=Z===0?new B(0,0):me.sub(Y)._unit()._perp(),be=Z===F.length-1?new B(0,0):ne.sub(me)._unit()._perp(),Pe=oe._add(be)._unit(),Be=Pe.x*be.x+Pe.y*be.y;Be!==0&&Pe._mult(1/Be),N.push(Pe._mult(E)._add(me))}D.push(N)}return D})(l,S*m)),(function(M,E,D){for(let L=0;L<E.length;L++){const F=E[L];if(M.length>=3){for(let N=0;N<F.length;N++)if(Al(M,F[N]))return!0}if(Dv(M,F,D))return!0}return!1})(y,l,v)}isTileClipped(){return!0}}function Wm(i,t){return t>0?t+2*i:i}const Tx=Nr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sx=Nr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Nr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Px=Nr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Nr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hm=Nr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Mx=Nr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Cx(i,t,r){return i.sections.forEach((s=>{s.text=(function(l,f,m){const y=f.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?l=l.toLocaleUpperCase():y==="lowercase"&&(l=l.toLocaleLowerCase()),fn.applyArabicShaping&&(l=fn.applyArabicShaping(l)),l})(s.text,t,r)})),i}Nr([{name:"triangle",components:3,type:"Uint16"}]),Nr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Nr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Nr([{type:"Float32",name:"offsetX"}]),Nr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Nr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const vu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var ci=24;const Bp=4294967296,Xm=1/Bp,Km=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Fp{constructor(t=new Uint8Array(16)){this.buf=ArrayBuffer.isView(t)?t:new Uint8Array(t),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(t,r,s=this.length){for(;this.pos<s;){const l=this.readVarint(),f=l>>3,m=this.pos;this.type=7&l,t(f,r,this),this.pos===m&&this.skip(l)}return r}readMessage(t,r){return this.readFields(t,r,this.readVarint()+this.pos)}readFixed32(){const t=this.dataView.getUint32(this.pos,!0);return this.pos+=4,t}readSFixed32(){const t=this.dataView.getInt32(this.pos,!0);return this.pos+=4,t}readFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Bp;return this.pos+=8,t}readSFixed64(){const t=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Bp;return this.pos+=8,t}readFloat(){const t=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,t}readDouble(){const t=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,t}readVarint(t){const r=this.buf;let s,l;return l=r[this.pos++],s=127&l,l<128?s:(l=r[this.pos++],s|=(127&l)<<7,l<128?s:(l=r[this.pos++],s|=(127&l)<<14,l<128?s:(l=r[this.pos++],s|=(127&l)<<21,l<128?s:(l=r[this.pos],s|=(15&l)<<28,(function(f,m,y){const v=y.buf;let S,M;if(M=v[y.pos++],S=(112&M)>>4,M<128||(M=v[y.pos++],S|=(127&M)<<3,M<128)||(M=v[y.pos++],S|=(127&M)<<10,M<128)||(M=v[y.pos++],S|=(127&M)<<17,M<128)||(M=v[y.pos++],S|=(127&M)<<24,M<128)||(M=v[y.pos++],S|=(1&M)<<31,M<128))return Ll(f,S,m);throw new Error("Expected varint not more than 10 bytes")})(s,t,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const t=this.readVarint();return t%2==1?(t+1)/-2:t/2}readBoolean(){return!!this.readVarint()}readString(){const t=this.readVarint()+this.pos,r=this.pos;return this.pos=t,t-r>=12&&Km?Km.decode(this.buf.subarray(r,t)):(function(s,l,f){let m="",y=l;for(;y<f;){const v=s[y];let S,M,E,D=null,L=v>239?4:v>223?3:v>191?2:1;if(y+L>f)break;L===1?v<128&&(D=v):L===2?(S=s[y+1],(192&S)==128&&(D=(31&v)<<6|63&S,D<=127&&(D=null))):L===3?(S=s[y+1],M=s[y+2],(192&S)==128&&(192&M)==128&&(D=(15&v)<<12|(63&S)<<6|63&M,(D<=2047||D>=55296&&D<=57343)&&(D=null))):L===4&&(S=s[y+1],M=s[y+2],E=s[y+3],(192&S)==128&&(192&M)==128&&(192&E)==128&&(D=(15&v)<<18|(63&S)<<12|(63&M)<<6|63&E,(D<=65535||D>=1114112)&&(D=null))),D===null?(D=65533,L=1):D>65535&&(D-=65536,m+=String.fromCharCode(D>>>10&1023|55296),D=56320|1023&D),m+=String.fromCharCode(D),y+=L}return m})(this.buf,r,t)}readBytes(){const t=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,t);return this.pos=t,r}readPackedVarint(t=[],r){const s=this.readPackedEnd();for(;this.pos<s;)t.push(this.readVarint(r));return t}readPackedSVarint(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSVarint());return t}readPackedBoolean(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readBoolean());return t}readPackedFloat(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFloat());return t}readPackedDouble(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readDouble());return t}readPackedFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed32());return t}readPackedSFixed32(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed32());return t}readPackedFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readFixed64());return t}readPackedSFixed64(t=[]){const r=this.readPackedEnd();for(;this.pos<r;)t.push(this.readSFixed64());return t}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(t){const r=7&t;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(t,r){this.writeVarint(t<<3|r)}realloc(t){let r=this.length||16;for(;r<this.pos+t;)r*=2;if(r!==this.length){const s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeSFixed32(t){this.realloc(4),this.dataView.setInt32(this.pos,t,!0),this.pos+=4}writeFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Xm),!0),this.pos+=8}writeSFixed64(t){this.realloc(8),this.dataView.setInt32(this.pos,-1&t,!0),this.dataView.setInt32(this.pos+4,Math.floor(t*Xm),!0),this.pos+=8}writeVarint(t){(t=+t||0)>268435455||t<0?(function(r,s){let l,f;if(r>=0?(l=r%4294967296|0,f=r/4294967296|0):(l=~(-r%4294967296),f=~(-r/4294967296),4294967295^l?l=l+1|0:(l=0,f=f+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),(function(m,y,v){v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,m>>>=7,v.buf[v.pos++]=127&m|128,v.buf[v.pos]=127&(m>>>=7)})(l,0,s),(function(m,y){const v=(7&m)<<4;y.buf[y.pos++]|=v|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))})(f,s)})(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))}writeSVarint(t){this.writeVarint(t<0?2*-t-1:2*t)}writeBoolean(t){this.writeVarint(+t)}writeString(t){t=String(t),this.realloc(4*t.length),this.pos++;const r=this.pos;this.pos=(function(l,f,m){for(let y,v,S=0;S<f.length;S++){if(y=f.charCodeAt(S),y>55295&&y<57344){if(!v){y>56319||S+1===f.length?(l[m++]=239,l[m++]=191,l[m++]=189):v=y;continue}if(y<56320){l[m++]=239,l[m++]=191,l[m++]=189,v=y;continue}y=v-55296<<10|y-56320|65536,v=null}else v&&(l[m++]=239,l[m++]=191,l[m++]=189,v=null);y<128?l[m++]=y:(y<2048?l[m++]=y>>6|192:(y<65536?l[m++]=y>>12|224:(l[m++]=y>>18|240,l[m++]=y>>12&63|128),l[m++]=y>>6&63|128),l[m++]=63&y|128)}return m})(this.buf,t,this.pos);const s=this.pos-r;s>=128&&Ym(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s}writeFloat(t){this.realloc(4),this.dataView.setFloat32(this.pos,t,!0),this.pos+=4}writeDouble(t){this.realloc(8),this.dataView.setFloat64(this.pos,t,!0),this.pos+=8}writeBytes(t){const r=t.length;this.writeVarint(r),this.realloc(r);for(let s=0;s<r;s++)this.buf[this.pos++]=t[s]}writeRawMessage(t,r){this.pos++;const s=this.pos;t(r,this);const l=this.pos-s;l>=128&&Ym(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l}writeMessage(t,r,s){this.writeTag(t,2),this.writeRawMessage(r,s)}writePackedVarint(t,r){r.length&&this.writeMessage(t,Ix,r)}writePackedSVarint(t,r){r.length&&this.writeMessage(t,Ex,r)}writePackedBoolean(t,r){r.length&&this.writeMessage(t,zx,r)}writePackedFloat(t,r){r.length&&this.writeMessage(t,Ax,r)}writePackedDouble(t,r){r.length&&this.writeMessage(t,kx,r)}writePackedFixed32(t,r){r.length&&this.writeMessage(t,Dx,r)}writePackedSFixed32(t,r){r.length&&this.writeMessage(t,Rx,r)}writePackedFixed64(t,r){r.length&&this.writeMessage(t,Lx,r)}writePackedSFixed64(t,r){r.length&&this.writeMessage(t,Bx,r)}writeBytesField(t,r){this.writeTag(t,2),this.writeBytes(r)}writeFixed32Field(t,r){this.writeTag(t,5),this.writeFixed32(r)}writeSFixed32Field(t,r){this.writeTag(t,5),this.writeSFixed32(r)}writeFixed64Field(t,r){this.writeTag(t,1),this.writeFixed64(r)}writeSFixed64Field(t,r){this.writeTag(t,1),this.writeSFixed64(r)}writeVarintField(t,r){this.writeTag(t,0),this.writeVarint(r)}writeSVarintField(t,r){this.writeTag(t,0),this.writeSVarint(r)}writeStringField(t,r){this.writeTag(t,2),this.writeString(r)}writeFloatField(t,r){this.writeTag(t,5),this.writeFloat(r)}writeDoubleField(t,r){this.writeTag(t,1),this.writeDouble(r)}writeBooleanField(t,r){this.writeVarintField(t,+r)}}function Ll(i,t,r){return r?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function Ym(i,t,r){const s=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(s);for(let l=r.pos-1;l>=i;l--)r.buf[l+s]=r.buf[l]}function Ix(i,t){for(let r=0;r<i.length;r++)t.writeVarint(i[r])}function Ex(i,t){for(let r=0;r<i.length;r++)t.writeSVarint(i[r])}function Ax(i,t){for(let r=0;r<i.length;r++)t.writeFloat(i[r])}function kx(i,t){for(let r=0;r<i.length;r++)t.writeDouble(i[r])}function zx(i,t){for(let r=0;r<i.length;r++)t.writeBoolean(i[r])}function Dx(i,t){for(let r=0;r<i.length;r++)t.writeFixed32(i[r])}function Rx(i,t){for(let r=0;r<i.length;r++)t.writeSFixed32(i[r])}function Lx(i,t){for(let r=0;r<i.length;r++)t.writeFixed64(i[r])}function Bx(i,t){for(let r=0;r<i.length;r++)t.writeSFixed64(i[r])}function Fx(i,t,r){i===1&&r.readMessage(Ox,t)}function Ox(i,t,r){if(i===3){const{id:s,bitmap:l,width:f,height:m,left:y,top:v,advance:S}=r.readMessage(jx,{});t.push({id:s,bitmap:new uu({width:f+6,height:m+6},l),metrics:{width:f,height:m,left:y,top:v,advance:S}})}}function jx(i,t,r){i===1?t.id=r.readVarint():i===2?t.bitmap=r.readBytes():i===3?t.width=r.readVarint():i===4?t.height=r.readVarint():i===5?t.left=r.readSVarint():i===6?t.top=r.readSVarint():i===7&&(t.advance=r.readVarint())}function Jm(i){let t=0,r=0;for(const m of i)t+=m.w*m.h,r=Math.max(r,m.w);i.sort(((m,y)=>y.h-m.h));const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let l=0,f=0;for(const m of i)for(let y=s.length-1;y>=0;y--){const v=s[y];if(!(m.w>v.w||m.h>v.h)){if(m.x=v.x,m.y=v.y,f=Math.max(f,m.y+m.h),l=Math.max(l,m.x+m.w),m.w===v.w&&m.h===v.h){const S=s.pop();S&&y<s.length&&(s[y]=S)}else m.h===v.h?(v.x+=m.w,v.w-=m.w):m.w===v.w?(v.y+=m.h,v.h-=m.h):(s.push({x:v.x+m.w,y:v.y,w:v.w-m.w,h:m.h}),v.y+=m.h,v.h-=m.h);break}}return{w:l,h:f,fill:t/(l*f)||0}}class Op{constructor(t,{pixelRatio:r,version:s,stretchX:l,stretchY:f,content:m,textFitWidth:y,textFitHeight:v}){this.paddedRect=t,this.pixelRatio=r,this.stretchX=l,this.stretchY=f,this.content=m,this.version=s,this.textFitWidth=y,this.textFitHeight=v}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Qm{constructor(t,r){const s={},l={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,s,f),this.addImages(r,l,f);const{w:m,h:y}=Jm(f),v=new qi({width:m||1,height:y||1});for(const S in t){const M=t[S],E=s[S].paddedRect;qi.copy(M.data,v,{x:0,y:0},{x:E.x+1,y:E.y+1},M.data)}for(const S in r){const M=r[S],E=l[S].paddedRect,D=E.x+1,L=E.y+1,F=M.data.width,N=M.data.height;qi.copy(M.data,v,{x:0,y:0},{x:D,y:L},M.data),qi.copy(M.data,v,{x:0,y:N-1},{x:D,y:L-1},{width:F,height:1}),qi.copy(M.data,v,{x:0,y:0},{x:D,y:L+N},{width:F,height:1}),qi.copy(M.data,v,{x:F-1,y:0},{x:D-1,y:L},{width:1,height:N}),qi.copy(M.data,v,{x:0,y:0},{x:D+F,y:L},{width:1,height:N})}this.image=v,this.iconPositions=s,this.patternPositions=l}addImages(t,r,s){for(const l in t){const f=t[l],m={x:0,y:0,w:f.data.width+2,h:f.data.height+2};s.push(m),r[l]=new Op(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(t,r){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),r)}patchUpdatedImage(t,r,s){if(!t||!r||t.version===r.version)return;t.version=r.version;const[l,f]=t.tl;s.update(r.data,void 0,{x:l,y:f})}}var za;He("ImagePosition",Op),He("ImageAtlas",Qm),T.ao=void 0,(za=T.ao||(T.ao={}))[za.none=0]="none",za[za.horizontal=1]="horizontal",za[za.vertical=2]="vertical",za[za.horizontalOnly=3]="horizontalOnly";class xu{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(t,r,s){const l=new xu;return l.scale=t||1,l.fontStack=r,l.verticalAlign=s||"bottom",l}static forImage(t,r){const s=new xu;return s.imageName=t,s.verticalAlign=r||"bottom",s}}class Bl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,r){const s=new Bl;for(let l=0;l<t.sections.length;l++){const f=t.sections[l];f.image?s.addImageSection(f):s.addTextSection(f,r)}return s}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=(function(t){let r="";for(let s=0;s<t.length;s++){const l=t.charCodeAt(s+1)||null,f=t.charCodeAt(s-1)||null;r+=l&&Vh(l)&&!vu[t[s+1]]||f&&Vh(f)&&!vu[t[s-1]]||!vu[t[s]]?t[s]:vu[t[s]]}return r})(this.text)}trim(){let t=0;for(let s=0;s<this.text.length&&id[this.text.charCodeAt(s)];s++)t++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=t&&id[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(t,r),this.sectionIndex=this.sectionIndex.slice(t,r)}substring(t,r){const s=new Bl;return s.text=this.text.substring(t,r),s.sectionIndex=this.sectionIndex.slice(t,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,r)=>Math.max(t,this.sections[r].scale)),0)}getMaxImageSize(t){let r=0,s=0;for(let l=0;l<this.length();l++){const f=this.getSection(l);if(f.imageName){const m=t[f.imageName];if(!m)continue;const y=m.displaySize;r=Math.max(r,y[0]),s=Math.max(s,y[1])}}return{maxImageWidth:r,maxImageHeight:s}}addTextSection(t,r){this.text+=t.text,this.sections.push(xu.forText(t.scale,t.fontStack||r,t.verticalAlign));const s=this.sections.length-1;for(let l=0;l<t.text.length;++l)this.sectionIndex.push(s)}addImageSection(t){const r=t.image?t.image.name:"";if(r.length===0)return void Gt("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(xu.forImage(r,t.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Gt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rd(i,t,r,s,l,f,m,y,v,S,M,E,D,L,F){const N=Bl.fromFeature(i,l);let Z;E===T.ao.vertical&&N.verticalizePunctuation();const{processBidirectionalText:Y,processStyledBidirectionalText:me}=fn;if(Y&&N.sections.length===1){Z=[];const be=Y(N.toString(),jp(N,S,f,t,s,L));for(const Pe of be){const Be=new Bl;Be.text=Pe,Be.sections=N.sections;for(let qe=0;qe<Pe.length;qe++)Be.sectionIndex.push(0);Z.push(Be)}}else if(me){Z=[];const be=me(N.text,N.sectionIndex,jp(N,S,f,t,s,L));for(const Pe of be){const Be=new Bl;Be.text=Pe[0],Be.sectionIndex=Pe[1],Be.sections=N.sections,Z.push(Be)}}else Z=(function(be,Pe){const Be=[],qe=be.text;let Ne=0;for(const Ze of Pe)Be.push(be.substring(Ne,Ze)),Ne=Ze;return Ne<qe.length&&Be.push(be.substring(Ne,qe.length)),Be})(N,jp(N,S,f,t,s,L));const ne=[],oe={positionedLines:ne,text:N.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:E,iconsInText:!1,verticalizable:!1};return(function(be,Pe,Be,qe,Ne,Ze,it,Ue,Ge,Ae,ut,ft){let st=0,Je=0,Bt=0,Lr=0;const ii=Ue==="right"?1:Ue==="left"?0:.5,Si=ci/ft;let vn=0;for(const Cr of Ne){Cr.trim();const ui=Cr.getMaxScale(),yi={positionedGlyphs:[],lineOffset:0};be.positionedLines[vn]=yi;const vi=yi.positionedGlyphs;let Oi=0;if(!Cr.length()){Je+=Ze,++vn;continue}const xn=$x(qe,Cr,Si);for(let Hi=0;Hi<Cr.length();Hi++){const ni=Cr.getSection(Hi),di=Cr.getSectionIndex(Hi),pi=Cr.getCharCode(Hi),Yr=Zx(Ge,ut,pi);let yr;if(ni.imageName){if(be.iconsInText=!0,ni.scale=ni.scale*Si,yr=qx(ni,Yr,ui,xn,qe),!yr)continue;Oi=Math.max(Oi,yr.imageOffset)}else if(yr=Gx(ni,pi,Yr,xn,Pe,Be),!yr)continue;const{rect:Wn,metrics:Nl,baselineOffset:Hn}=yr;vi.push({glyph:pi,imageName:ni.imageName,x:st,y:Je+Hn+-17,vertical:Yr,scale:ni.scale,fontStack:ni.fontStack,sectionIndex:di,metrics:Nl,rect:Wn}),Yr?(be.verticalizable=!0,st+=(ni.imageName?Nl.advance:ci)*ni.scale+Ae):st+=Nl.advance*ni.scale+Ae}vi.length!==0&&(Bt=Math.max(st-Ae,Bt),Wx(vi,0,vi.length-1,ii)),st=0,yi.lineOffset=Math.max(Oi,(ui-1)*ci);const hi=Ze*ui+Oi;Je+=hi,Lr=Math.max(hi,Lr),++vn}const{horizontalAlign:Wi,verticalAlign:_i}=Np(it);(function(Cr,ui,yi,vi,Oi,xn,hi,Hi,ni){const di=(ui-yi)*Oi;let pi=0;pi=xn!==hi?-Hi*vi- -17:-vi*ni*hi+.5*hi;for(const Yr of Cr)for(const yr of Yr.positionedGlyphs)yr.x+=di,yr.y+=pi})(be.positionedLines,ii,Wi,_i,Bt,Lr,Ze,Je,Ne.length),be.top+=-_i*Je,be.bottom=be.top+Je,be.left+=-Wi*Bt,be.right=be.left+Bt})(oe,t,r,s,Z,m,y,v,E,S,D,F),!(function(be){for(const Pe of be)if(Pe.positionedGlyphs.length!==0)return!1;return!0})(ne)&&oe}const id={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Nx={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Vx={40:!0};function eg(i,t,r,s,l,f){if(t.imageName){const m=s[t.imageName];return m?m.displaySize[0]*t.scale*ci/f+l:0}{const m=r[t.fontStack],y=m&&m[i];return y?y.metrics.advance*t.scale+l:0}}function tg(i,t,r,s){const l=Math.pow(i-t,2);return s?i<t?l/2:2*l:l+Math.abs(r)*r}function Ux(i,t,r){let s=0;return i===10&&(s-=1e4),r&&(s+=150),i!==40&&i!==65288||(s+=50),t!==41&&t!==65289||(s+=50),s}function rg(i,t,r,s,l,f){let m=null,y=tg(t,r,l,f);for(const v of s){const S=tg(t-v.x,r,l,f)+v.badness;S<=y&&(m=v,y=S)}return{index:i,x:t,priorBreak:m,badness:y}}function ig(i){return i?ig(i.priorBreak).concat(i.index):[]}function jp(i,t,r,s,l,f){if(!i)return[];const m=[],y=(function(E,D,L,F,N,Z){let Y=0;for(let me=0;me<E.length();me++){const ne=E.getSection(me);Y+=eg(E.getCharCode(me),ne,F,N,D,Z)}return Y/Math.max(1,Math.ceil(Y/L))})(i,t,r,s,l,f),v=i.text.indexOf("​")>=0;let S=0;for(let E=0;E<i.length();E++){const D=i.getSection(E),L=i.getCharCode(E);if(id[L]||(S+=eg(L,D,s,l,t,f)),E<i.length()-1){const F=!((M=L)<11904)&&(!!Lt["CJK Compatibility Forms"](M)||!!Lt["CJK Compatibility"](M)||!!Lt["CJK Strokes"](M)||!!Lt["CJK Symbols and Punctuation"](M)||!!Lt["Enclosed CJK Letters and Months"](M)||!!Lt["Halfwidth and Fullwidth Forms"](M)||!!Lt["Ideographic Description Characters"](M)||!!Lt["Vertical Forms"](M)||Jc.test(String.fromCodePoint(M)));(Nx[L]||F||D.imageName||E!==i.length()-2&&Vx[i.getCharCode(E+1)])&&m.push(rg(E+1,S,y,m,Ux(L,i.getCharCode(E+1),F&&v),!1))}}var M;return ig(rg(i.length(),S,y,m,0,!0))}function Np(i){let t=.5,r=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function $x(i,t,r){const s=t.getMaxScale()*ci,{maxImageWidth:l,maxImageHeight:f}=t.getMaxImageSize(i),m=Math.max(s,f*r);return{verticalLineContentWidth:Math.max(s,l*r),horizontalLineContentHeight:m}}function ng(i){switch(i){case"top":return 0;case"center":return .5;default:return 1}}function Zx(i,t,r){return!(i===T.ao.horizontal||!t&&!Qc(r)||t&&(id[r]||(s=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(s)))));var s}function Gx(i,t,r,s,l,f){const m=f[i.fontStack],y=(function(S,M,E,D){if(S&&S.rect)return S;const L=M[E.fontStack],F=L&&L[D];return F?{rect:null,metrics:F.metrics}:null})(m&&m[t],l,i,t);if(y===null)return null;let v;if(r)v=s.verticalLineContentWidth-i.scale*ci;else{const S=ng(i.verticalAlign);v=(s.horizontalLineContentHeight-i.scale*ci)*S}return{rect:y.rect,metrics:y.metrics,baselineOffset:v}}function qx(i,t,r,s,l){const f=l[i.imageName];if(!f)return null;const m=f.paddedRect,y=f.displaySize,v={width:y[0],height:y[1],left:1,top:-3,advance:t?y[1]:y[0]};let S;if(t)S=s.verticalLineContentWidth-y[1]*i.scale;else{const M=ng(i.verticalAlign);S=(s.horizontalLineContentHeight-y[1]*i.scale)*M}return{rect:m,metrics:v,baselineOffset:S,imageOffset:(t?y[0]:y[1])*i.scale-ci*r}}function Wx(i,t,r,s){if(s===0)return;const l=i[r],f=(i[r].x+l.metrics.advance*l.scale)*s;for(let m=t;m<=r;m++)i[m].x-=f}function Hx(i,t,r){const{horizontalAlign:s,verticalAlign:l}=Np(r),f=t[0]-i.displaySize[0]*s,m=t[1]-i.displaySize[1]*l;return{image:i,top:m,bottom:m+i.displaySize[1],left:f,right:f+i.displaySize[0]}}function sg(i){var t,r;let s=i.left,l=i.top,f=i.right-s,m=i.bottom-l;const y=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",v=(r=i.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",S=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(v==="proportional"){if(y==="stretchOnly"&&f/m<S||y==="proportional"){const M=Math.ceil(m*S);s*=M/f,f=M}}else if(y==="proportional"&&v==="stretchOnly"&&S!==0&&f/m>S){const M=Math.ceil(f/S);l*=M/m,m=M}return{x1:s,y1:l,x2:s+f,y2:l+m}}function ag(i,t,r,s,l,f){const m=i.image;let y;if(m.content){const Z=m.content,Y=m.pixelRatio||1;y=[Z[0]/Y,Z[1]/Y,m.displaySize[0]-Z[2]/Y,m.displaySize[1]-Z[3]/Y]}const v=t.left*f,S=t.right*f;let M,E,D,L;r==="width"||r==="both"?(L=l[0]+v-s[3],E=l[0]+S+s[1]):(L=l[0]+(v+S-m.displaySize[0])/2,E=L+m.displaySize[0]);const F=t.top*f,N=t.bottom*f;return r==="height"||r==="both"?(M=l[1]+F-s[0],D=l[1]+N+s[2]):(M=l[1]+(F+N-m.displaySize[1])/2,D=M+m.displaySize[1]),{image:m,top:M,right:E,bottom:D,left:L,collisionPadding:y}}const Ys=128,Da=32640;function og(i,t){const{expression:r}=t;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new wr(i+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let f=0;for(;f<s.length&&s[f]<=i;)f++;f=Math.max(0,f-1);let m=f;for(;m<s.length&&s[m]<i+1;)m++;m=Math.min(s.length-1,m);const y=s[f],v=s[m];return r.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:v,interpolationType:l}:{kind:"camera",minZoom:y,maxZoom:v,minSize:r.evaluate(new wr(y)),maxSize:r.evaluate(new wr(v)),interpolationType:l}}}function Vp(i,t,r){let s="never";const l=i.get(t);return l?s=l:i.get(r)&&(s="always"),s}const Xx=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function nd(i,t,r,s,l,f,m,y,v,S,M,E,D){const L=y?Math.min(Da,Math.round(y[0])):0,F=y?Math.min(Da,Math.round(y[1])):0;i.emplaceBack(t,r,Math.round(32*s),Math.round(32*l),f,m,(L<<1)+(v?1:0),F,16*S,16*M,256*E,256*D)}function Up(i,t,r){i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r),i.emplaceBack(t.x,t.y,r)}function Kx(i){for(const t of i.sections)if(Zh(t.text))return!0;return!1}class $p{constructor(t){this.layoutVertexArray=new Ve,this.indexArray=new ir,this.programConfigurations=t,this.segments=new xt,this.dynamicLayoutVertexArray=new Le,this.opacityVertexArray=new Ye,this.hasVisibleVertices=!1,this.placedSymbolArray=new O}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Tx.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Sx.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Xx,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}He("SymbolBuffers",$p);class Zp{constructor(t,r,s){this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new s,this.segments=new xt,this.collisionVertexArray=new Yt}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Px.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}He("CollisionBuffers",Zp);class Fl{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.globalState=t.globalState,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((m=>m.id)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=og(this.zoom,r["text-size"]),this.iconSizeData=og(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=Vp(s,"text-overlap","text-allow-overlap")!=="never"||Vp(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map((m=>T.ao[m]))),this.stateDependentLayerIds=this.layers.filter((m=>m.isStateDependent())).map((m=>m.id)),this.sourceID=t.sourceID}createArrays(){this.text=new $p(new Gi(this.layers,this.zoom,(t=>/^text/.test(t)))),this.icon=new $p(new Gi(this.layers,this.zoom,(t=>/^icon/.test(t)))),this.glyphOffsetArray=new H,this.lineVertexArray=new J,this.symbolInstances=new G,this.textAnchorOffsets=new Q}calculateGlyphDependencies(t,r,s,l,f){for(let m=0;m<t.length;m++)if(r[t.charCodeAt(m)]=!0,(s||l)&&f){const y=vu[t.charAt(m)];y&&(r[y.charCodeAt(0)]=!0)}}populate(t,r,s){const l=this.layers[0],f=l.layout,m=f.get("text-font"),y=f.get("text-field"),v=f.get("icon-image"),S=(y.value.kind!=="constant"||y.value.value instanceof Pi&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(m.value.kind!=="constant"||m.value.value.length>0),M=v.value.kind!=="constant"||!!v.value.value||Object.keys(v.parameters).length>0,E=f.get("symbol-sort-key");if(this.features=[],!S&&!M)return;const D=r.iconDependencies,L=r.glyphDependencies,F=r.availableImages,N=new wr(this.zoom,{globalState:this.globalState});for(const{feature:Z,id:Y,index:me,sourceLayerIndex:ne}of t){const oe=l._featureFilter.needGeometry,be=qn(Z,oe);if(!l._featureFilter.filter(N,be,s))continue;let Pe,Be;if(oe||(be.geometry=xs(Z)),S){const Ne=l.getValueAndResolveTokens("text-field",be,s,F),Ze=Pi.factory(Ne),it=this.hasRTLText=this.hasRTLText||Kx(Ze);(!it||fn.getRTLTextPluginStatus()==="unavailable"||it&&fn.isParsed())&&(Pe=Cx(Ze,l,be))}if(M){const Ne=l.getValueAndResolveTokens("icon-image",be,s,F);Be=Ne instanceof $i?Ne:$i.fromString(Ne)}if(!Pe&&!Be)continue;const qe=this.sortFeaturesByKey?E.evaluate(be,{},s):void 0;if(this.features.push({id:Y,text:Pe,icon:Be,index:me,sourceLayerIndex:ne,geometry:be.geometry,properties:Z.properties,type:Rl.types[Z.type],sortKey:qe}),Be&&(D[Be.name]=!0),Pe){const Ne=m.evaluate(be,{},s).join(","),Ze=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.ao.vertical)>=0;for(const it of Pe.sections)if(it.image)D[it.image.name]=!0;else{const Ue=xl(Pe.toString()),Ge=it.fontStack||Ne,Ae=L[Ge]=L[Ge]||{};this.calculateGlyphDependencies(it.text,Ae,Ze,this.allowVerticalPlacement,Ue)}}}f.get("symbol-placement")==="line"&&(this.features=(function(Z){const Y={},me={},ne=[];let oe=0;function be(Ne){ne.push(Z[Ne]),oe++}function Pe(Ne,Ze,it){const Ue=me[Ne];return delete me[Ne],me[Ze]=Ue,ne[Ue].geometry[0].pop(),ne[Ue].geometry[0]=ne[Ue].geometry[0].concat(it[0]),Ue}function Be(Ne,Ze,it){const Ue=Y[Ze];return delete Y[Ze],Y[Ne]=Ue,ne[Ue].geometry[0].shift(),ne[Ue].geometry[0]=it[0].concat(ne[Ue].geometry[0]),Ue}function qe(Ne,Ze,it){const Ue=it?Ze[0][Ze[0].length-1]:Ze[0][0];return`${Ne}:${Ue.x}:${Ue.y}`}for(let Ne=0;Ne<Z.length;Ne++){const Ze=Z[Ne],it=Ze.geometry,Ue=Ze.text?Ze.text.toString():null;if(!Ue){be(Ne);continue}const Ge=qe(Ue,it),Ae=qe(Ue,it,!0);if(Ge in me&&Ae in Y&&me[Ge]!==Y[Ae]){const ut=Be(Ge,Ae,it),ft=Pe(Ge,Ae,ne[ut].geometry);delete Y[Ge],delete me[Ae],me[qe(Ue,ne[ft].geometry,!0)]=ft,ne[ut].geometry=null}else Ge in me?Pe(Ge,Ae,it):Ae in Y?Be(Ge,Ae,it):(be(Ne),Y[Ge]=oe-1,me[Ae]=oe-1)}return ne.filter((Ne=>Ne.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((Z,Y)=>Z.sortKey-Y.sortKey))}update(t,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,r,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,r,this.layers,s))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,r){const s=this.lineVertexArray.length;if(t.segment!==void 0){let l=t.dist(r[t.segment+1]),f=t.dist(r[t.segment]);const m={};for(let y=t.segment+1;y<r.length;y++)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:l},y<r.length-1&&(l+=r[y+1].dist(r[y]));for(let y=t.segment||0;y>=0;y--)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:f},y>0&&(f+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const v=m[y];this.lineVertexArray.emplaceBack(v.x,v.y,v.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(t,r,s,l,f,m,y,v,S,M,E,D){const L=t.indexArray,F=t.layoutVertexArray,N=t.segments.prepareSegment(4*r.length,F,L,this.canOverlap?m.sortKey:void 0),Z=this.glyphOffsetArray.length,Y=N.vertexLength,me=this.allowVerticalPlacement&&y===T.ao.vertical?Math.PI/2:0,ne=m.text&&m.text.sections;for(let oe=0;oe<r.length;oe++){const{tl:be,tr:Pe,bl:Be,br:qe,tex:Ne,pixelOffsetTL:Ze,pixelOffsetBR:it,minFontScaleX:Ue,minFontScaleY:Ge,glyphOffset:Ae,isSDF:ut,sectionIndex:ft}=r[oe],st=N.vertexLength,Je=Ae[1];nd(F,v.x,v.y,be.x,Je+be.y,Ne.x,Ne.y,s,ut,Ze.x,Ze.y,Ue,Ge),nd(F,v.x,v.y,Pe.x,Je+Pe.y,Ne.x+Ne.w,Ne.y,s,ut,it.x,Ze.y,Ue,Ge),nd(F,v.x,v.y,Be.x,Je+Be.y,Ne.x,Ne.y+Ne.h,s,ut,Ze.x,it.y,Ue,Ge),nd(F,v.x,v.y,qe.x,Je+qe.y,Ne.x+Ne.w,Ne.y+Ne.h,s,ut,it.x,it.y,Ue,Ge),Up(t.dynamicLayoutVertexArray,v,me),L.emplaceBack(st,st+2,st+1),L.emplaceBack(st+1,st+2,st+3),N.vertexLength+=4,N.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ae[0]),oe!==r.length-1&&ft===r[oe+1].sectionIndex||t.programConfigurations.populatePaintArrays(F.length,m,m.index,{},D,ne&&ne[ft])}t.placedSymbolArray.emplaceBack(v.x,v.y,Z,this.glyphOffsetArray.length-Z,Y,S,M,v.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],y,0,!1,0,E)}_addCollisionDebugVertex(t,r,s,l,f,m){return r.emplaceBack(0,0),t.emplaceBack(s.x,s.y,l,f,Math.round(m.x),Math.round(m.y))}addCollisionDebugVertices(t,r,s,l,f,m,y){const v=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),S=v.vertexLength,M=f.layoutVertexArray,E=f.collisionVertexArray,D=y.anchorX,L=y.anchorY;this._addCollisionDebugVertex(M,E,m,D,L,new B(t,r)),this._addCollisionDebugVertex(M,E,m,D,L,new B(s,r)),this._addCollisionDebugVertex(M,E,m,D,L,new B(s,l)),this._addCollisionDebugVertex(M,E,m,D,L,new B(t,l)),v.vertexLength+=4;const F=f.indexArray;F.emplaceBack(S,S+1),F.emplaceBack(S+1,S+2),F.emplaceBack(S+2,S+3),F.emplaceBack(S+3,S),v.primitiveLength+=4}addDebugCollisionBoxes(t,r,s,l){for(let f=t;f<r;f++){const m=this.collisionBoxArray.get(f);this.addCollisionDebugVertices(m.x1,m.y1,m.x2,m.y2,l?this.textCollisionBox:this.iconCollisionBox,m.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zp(Tt,Hm.members,er),this.iconCollisionBox=new Zp(Tt,Hm.members,er);for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(t,r,s,l,f,m,y,v,S){const M={};for(let E=r;E<s;E++){const D=t.get(E);M.textBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},M.textFeatureIndex=D.featureIndex;break}for(let E=l;E<f;E++){const D=t.get(E);M.verticalTextBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},M.verticalTextFeatureIndex=D.featureIndex;break}for(let E=m;E<y;E++){const D=t.get(E);M.iconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},M.iconFeatureIndex=D.featureIndex;break}for(let E=v;E<S;E++){const D=t.get(E);M.verticalIconBox={x1:D.x1,y1:D.y1,x2:D.x2,y2:D.y2,anchorPointX:D.anchorPointX,anchorPointY:D.anchorPointY},M.verticalIconFeatureIndex=D.featureIndex;break}return M}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,r){const s=t.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<l;f+=4)t.indexArray.emplaceBack(f,f+2,f+1),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(t),s=Math.cos(t),l=[],f=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const v=this.symbolInstances.get(y);l.push(0|Math.round(r*v.anchorX+s*v.anchorY)),f.push(v.featureIndex)}return m.sort(((y,v)=>l[y]-l[v]||f[v]-f[y])),m}addToSortKeyRanges(t,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach(((l,f,m)=>{l>=0&&m.indexOf(l)===f&&this.addIndicesForPlacedSymbol(this.text,l)})),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let lg,cg;He("SymbolBucket",Fl,{omit:["layers","collisionBoxArray","features","compareText"]}),Fl.MAX_GLYPHS=65535,Fl.addDynamicAttributes=Up;var Gp={get paint(){return cg=cg||new Ii({"icon-opacity":new lt(_e.paint_symbol["icon-opacity"]),"icon-color":new lt(_e.paint_symbol["icon-color"]),"icon-halo-color":new lt(_e.paint_symbol["icon-halo-color"]),"icon-halo-width":new lt(_e.paint_symbol["icon-halo-width"]),"icon-halo-blur":new lt(_e.paint_symbol["icon-halo-blur"]),"icon-translate":new et(_e.paint_symbol["icon-translate"]),"icon-translate-anchor":new et(_e.paint_symbol["icon-translate-anchor"]),"text-opacity":new lt(_e.paint_symbol["text-opacity"]),"text-color":new lt(_e.paint_symbol["text-color"],{runtimeType:mi,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new lt(_e.paint_symbol["text-halo-color"]),"text-halo-width":new lt(_e.paint_symbol["text-halo-width"]),"text-halo-blur":new lt(_e.paint_symbol["text-halo-blur"]),"text-translate":new et(_e.paint_symbol["text-translate"]),"text-translate-anchor":new et(_e.paint_symbol["text-translate-anchor"])})},get layout(){return lg=lg||new Ii({"symbol-placement":new et(_e.layout_symbol["symbol-placement"]),"symbol-spacing":new et(_e.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new et(_e.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new lt(_e.layout_symbol["symbol-sort-key"]),"symbol-z-order":new et(_e.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new et(_e.layout_symbol["icon-allow-overlap"]),"icon-overlap":new et(_e.layout_symbol["icon-overlap"]),"icon-ignore-placement":new et(_e.layout_symbol["icon-ignore-placement"]),"icon-optional":new et(_e.layout_symbol["icon-optional"]),"icon-rotation-alignment":new et(_e.layout_symbol["icon-rotation-alignment"]),"icon-size":new lt(_e.layout_symbol["icon-size"]),"icon-text-fit":new et(_e.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(_e.layout_symbol["icon-text-fit-padding"]),"icon-image":new lt(_e.layout_symbol["icon-image"]),"icon-rotate":new lt(_e.layout_symbol["icon-rotate"]),"icon-padding":new lt(_e.layout_symbol["icon-padding"]),"icon-keep-upright":new et(_e.layout_symbol["icon-keep-upright"]),"icon-offset":new lt(_e.layout_symbol["icon-offset"]),"icon-anchor":new lt(_e.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new et(_e.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new et(_e.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new et(_e.layout_symbol["text-rotation-alignment"]),"text-field":new lt(_e.layout_symbol["text-field"]),"text-font":new lt(_e.layout_symbol["text-font"]),"text-size":new lt(_e.layout_symbol["text-size"]),"text-max-width":new lt(_e.layout_symbol["text-max-width"]),"text-line-height":new et(_e.layout_symbol["text-line-height"]),"text-letter-spacing":new lt(_e.layout_symbol["text-letter-spacing"]),"text-justify":new lt(_e.layout_symbol["text-justify"]),"text-radial-offset":new lt(_e.layout_symbol["text-radial-offset"]),"text-variable-anchor":new et(_e.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new lt(_e.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new lt(_e.layout_symbol["text-anchor"]),"text-max-angle":new et(_e.layout_symbol["text-max-angle"]),"text-writing-mode":new et(_e.layout_symbol["text-writing-mode"]),"text-rotate":new lt(_e.layout_symbol["text-rotate"]),"text-padding":new et(_e.layout_symbol["text-padding"]),"text-keep-upright":new et(_e.layout_symbol["text-keep-upright"]),"text-transform":new lt(_e.layout_symbol["text-transform"]),"text-offset":new lt(_e.layout_symbol["text-offset"]),"text-allow-overlap":new et(_e.layout_symbol["text-allow-overlap"]),"text-overlap":new et(_e.layout_symbol["text-overlap"]),"text-ignore-placement":new et(_e.layout_symbol["text-ignore-placement"]),"text-optional":new et(_e.layout_symbol["text-optional"])})}};class ug{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:oa,this.defaultValue=t}evaluate(t){if(t.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(t.formattedSection))return r.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}He("FormatSectionOverride",ug,{omit:["defaultValue"]});class sd extends Qi{constructor(t){super(t,Gp)}recalculate(t,r){if(super.recalculate(t,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const f of s)l.indexOf(f)<0&&l.push(f);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,r,s,l){const f=this.layout.get(t).evaluate(r,{},s,l),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||dl(m.value)||!f?f:(function(y,v){return v.replace(/{([^{}]+)}/g,((S,M)=>y&&M in y?String(y[M]):""))})(r.properties,f)}createBucket(t){return new Fl(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Gp.paint.overridableProperties){if(!sd.hasPaintOverride(this.layout,t))continue;const r=this.paint.get(t),s=new ug(r),l=new Nc(s,r.property.specification);let f=null;f=r.value.kind==="constant"||r.value.kind==="source"?new po("source",l):new Vc("composite",l,r.value.zoomStops),this.paint._values[t]=new Dn(r.property,f,r.parameters)}}_handleOverridablePaintPropertyUpdate(t,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&sd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,r){const s=t.get("text-field"),l=Gp.paint.properties[r];let f=!1;const m=y=>{for(const v of y)if(l.overrides&&l.overrides.hasOverride(v))return void(f=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Pi)m(s.value.value.sections);else if(s.value.kind==="source"){const y=S=>{f||(S instanceof Un&&ct(S.value)===cs?m(S.value.sections):S instanceof Fs?m(S.sections):S.eachChild(y))},v=s.value;v._styleExpression&&y(v._styleExpression.expression)}return f}}let hg;var Yx={get paint(){return hg=hg||new Ii({"background-color":new et(_e.paint_background["background-color"]),"background-pattern":new ms(_e.paint_background["background-pattern"]),"background-opacity":new et(_e.paint_background["background-opacity"])})}};class Jx extends Qi{constructor(t){super(t,Yx)}}let dg;var Qx={get paint(){return dg=dg||new Ii({"raster-opacity":new et(_e.paint_raster["raster-opacity"]),"raster-hue-rotate":new et(_e.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new et(_e.paint_raster["raster-brightness-min"]),"raster-brightness-max":new et(_e.paint_raster["raster-brightness-max"]),"raster-saturation":new et(_e.paint_raster["raster-saturation"]),"raster-contrast":new et(_e.paint_raster["raster-contrast"]),"raster-resampling":new et(_e.paint_raster["raster-resampling"]),"raster-fade-duration":new et(_e.paint_raster["raster-fade-duration"])})}};class e0 extends Qi{constructor(t){super(t,Qx)}}class t0 extends Qi{constructor(t){super(t,{}),this.onAdd=r=>{this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},this.onRemove=r=>{this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class r0{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const i0={once:!0},qp=63710088e-1;class Ra{constructor(t,r){if(isNaN(t)||isNaN(r))throw new Error(`Invalid LngLat object: (${t}, ${r})`);if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ra(Jr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const r=Math.PI/180,s=this.lat*r,l=t.lat*r,f=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((t.lng-this.lng)*r);return qp*Math.acos(Math.min(f,1))}static convert(t){if(t instanceof Ra)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Ra(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Ra(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const pg=2*Math.PI*qp;function fg(i){return pg*Math.cos(i*Math.PI/180)}function mg(i){return(180+i)/360}function gg(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function _g(i,t){return i/fg(t)}function Wp(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}function yg(i,t){return i*fg(Wp(t))}class bu{constructor(t,r,s=0){this.x=+t,this.y=+r,this.z=+s}static fromLngLat(t,r=0){const s=Ra.convert(t);return new bu(mg(s.lng),gg(s.lat),_g(r,s.lat))}toLngLat(){return new Ra(360*this.x-180,Wp(this.y))}toAltitude(){return yg(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/pg*(t=Wp(this.y),1/Math.cos(t*Math.PI/180));var t}}function vg(i,t,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[i*s-2*Math.PI*6378137/2,t*s-2*Math.PI*6378137/2]}class Hp{constructor(t,r,s){if(!(function(l,f,m){return!(l<0||l>25||m<0||m>=Math.pow(2,l)||f<0||f>=Math.pow(2,l))})(t,r,s))throw new Error(`x=${r}, y=${s}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=r,this.y=s,this.key=Ol(0,t,t,r,s)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,r,s){const l=(m=this.y,y=this.z,v=vg(256*(f=this.x),256*(m=Math.pow(2,y)-m-1),y),S=vg(256*(f+1),256*(m+1),y),v[0]+","+v[1]+","+S[0]+","+S[1]);var f,m,y,v,S;const M=(function(E,D,L){let F,N="";for(let Z=E;Z>0;Z--)F=1<<Z-1,N+=(D&F?1:0)+(L&F?2:0);return N})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,M).replace(/{bbox-epsg-3857}/g,l)}isChildOf(t){const r=this.z-t.z;return r>0&&t.x===this.x>>r&&t.y===this.y>>r}getTilePoint(t){const r=Math.pow(2,this.z);return new B((t.x*r-this.x)*ht,(t.y*r-this.y)*ht)}toString(){return`${this.z}/${this.x}/${this.y}`}}class xg{constructor(t,r){this.wrap=t,this.canonical=r,this.key=Ol(t,r.z,r.z,r.x,r.y)}}class yn{constructor(t,r,s,l,f){if(this.terrainRttPosMatrix32f=null,t<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${s}`);this.overscaledZ=t,this.wrap=r,this.canonical=new Hp(s,+l,+f),this.key=Ol(r,t,s,l,f)}clone(){return new yn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-t;return t>this.canonical.z?new yn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yn(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(t,r){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-t;return t>this.canonical.z?Ol(this.wrap*+r,t,this.canonical.z,this.canonical.x,this.canonical.y):Ol(this.wrap*+r,t,t,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const r=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>r&&t.canonical.y===this.canonical.y>>r}children(t){if(this.overscaledZ>=t)return[new yn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new yn(r,this.wrap,r,s,l),new yn(r,this.wrap,r,s+1,l),new yn(r,this.wrap,r,s,l+1),new yn(r,this.wrap,r,s+1,l+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new yn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new yn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new bu(t.x-this.wrap,t.y))}}function Ol(i,t,r,s,l){(i*=2)<0&&(i=-1*i-1);const f=1<<r;return(f*f*i+f*l+s).toString(36)+r.toString(36)+t.toString(36)}function wu(i,t){return t?i.properties[t]:i.id}He("CanonicalTileID",Hp),He("OverscaledTileID",yn,{omit:["terrainRttPosMatrix32f"]});class Mo{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(t){return this.minX=Math.min(this.minX,t.x),this.minY=Math.min(this.minY,t.y),this.maxX=Math.max(this.maxX,t.x),this.maxY=Math.max(this.maxY,t.y),this}expandBy(t){return this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(t){return this.expandBy(-t)}map(t){const r=new Mo;return r.extend(t(new B(this.minX,this.minY))),r.extend(t(new B(this.maxX,this.minY))),r.extend(t(new B(this.minX,this.maxY))),r.extend(t(new B(this.maxX,this.maxY))),r}static fromPoints(t){const r=new Mo;for(const s of t)r.extend(s);return r}contains(t){return t.x>=this.minX&&t.x<=this.maxX&&t.y>=this.minY&&t.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(t){return!this.empty()&&!t.empty()&&t.minX>=this.minX&&t.maxX<=this.maxX&&t.minY>=this.minY&&t.maxY<=this.maxY}intersects(t){return!this.empty()&&!t.empty()&&t.minX<=this.maxX&&t.maxX>=this.minX&&t.minY<=this.maxY&&t.maxY>=this.minY}}class bg{constructor(t){this._stringToNumber={},this._numberToString=[];for(let r=0;r<t.length;r++){const s=t[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class wg{constructor(t,r,s,l,f){this.type="Feature",this._vectorTileFeature=t,t._z=r,t._x=s,t._y=l,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(t[r]=this[r]);return t}}class Tg{constructor(t,r){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new xo(ht,16,0),this.grid3D=new xo(ht,16,0),this.featureIndexArray=new ue,this.promoteId=r}insert(t,r,s,l,f,m){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,f);const v=m?this.grid3D:this.grid;for(let S=0;S<r.length;S++){const M=r[S],E=[1/0,1/0,-1/0,-1/0];for(let D=0;D<M.length;D++){const L=M[D];E[0]=Math.min(E[0],L.x),E[1]=Math.min(E[1],L.y),E[2]=Math.max(E[2],L.x),E[3]=Math.max(E[3],L.y)}E[0]<ht&&E[1]<ht&&E[2]>=0&&E[3]>=0&&v.insert(y,E[0],E[1],E[2],E[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new jm(new Fp(this.rawTileData)).layers,this.sourceLayerCoder=new bg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,r,s,l){this.loadVTLayers();const f=t.params,m=ht/t.tileSize/t.scale,y=$s(f.filter),v=t.queryGeometry,S=t.queryPadding*m,M=Mo.fromPoints(v),E=this.grid.query(M.minX-S,M.minY-S,M.maxX+S,M.maxY+S),D=Mo.fromPoints(t.cameraQueryGeometry).expandBy(S),L=this.grid3D.query(D.minX,D.minY,D.maxX,D.maxY,((Z,Y,me,ne)=>(function(oe,be,Pe,Be,qe){for(const Ze of oe)if(be<=Ze.x&&Pe<=Ze.y&&Be>=Ze.x&&qe>=Ze.y)return!0;const Ne=[new B(be,Pe),new B(be,qe),new B(Be,qe),new B(Be,Pe)];if(oe.length>2){for(const Ze of Ne)if(Al(oe,Ze))return!0}for(let Ze=0;Ze<oe.length-1;Ze++)if(Lv(oe[Ze],oe[Ze+1],Ne))return!0;return!1})(t.cameraQueryGeometry,Z-S,Y-S,me+S,ne+S)));for(const Z of L)E.push(Z);E.sort(n0);const F={};let N;for(let Z=0;Z<E.length;Z++){const Y=E[Z];if(Y===N)continue;N=Y;const me=this.featureIndexArray.get(Y);let ne=null;this.loadMatchingFeature(F,me.bucketIndex,me.sourceLayerIndex,me.featureIndex,y,f.layers,f.availableImages,r,s,l,((oe,be,Pe)=>(ne||(ne=xs(oe)),be.queryIntersectsFeature({queryGeometry:v,feature:oe,featureState:Pe,geometry:ne,zoom:this.z,transform:t.transform,pixelsToTileUnits:m,pixelPosMatrix:t.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:t.getElevation}))))}return F}loadMatchingFeature(t,r,s,l,f,m,y,v,S,M,E){const D=this.bucketLayerIDs[r];if(m&&!D.some((Z=>m.has(Z))))return;const L=this.sourceLayerCoder.decode(s),F=this.vtLayers[L].feature(l);if(f.needGeometry){const Z=qn(F,!0);if(!f.filter(new wr(this.tileID.overscaledZ),Z,this.tileID.canonical))return}else if(!f.filter(new wr(this.tileID.overscaledZ),F))return;const N=this.getId(F,L);for(let Z=0;Z<D.length;Z++){const Y=D[Z];if(m&&!m.has(Y))continue;const me=v[Y];if(!me)continue;let ne={};N&&M&&(ne=M.getState(me.sourceLayer||"_geojsonTileLayer",N));const oe=Vt({},S[Y]);oe.paint=Sg(oe.paint,me.paint,F,ne,y),oe.layout=Sg(oe.layout,me.layout,F,ne,y);const be=!E||E(F,me,ne);if(!be)continue;const Pe=new wg(F,this.z,this.x,this.y,N);Pe.layer=oe;let Be=t[Y];Be===void 0&&(Be=t[Y]=[]),Be.push({featureIndex:l,feature:Pe,intersectionZ:be})}}lookupSymbolFeatures(t,r,s,l,f,m,y,v){const S={};this.loadVTLayers();const M=$s(f);for(const E of t)this.loadMatchingFeature(S,s,l,E,M,m,y,v,r);return S}hasLayer(t){for(const r of this.bucketLayerIDs)for(const s of r)if(t===s)return!0;return!1}getId(t,r){var s;let l=t.id;return this.promoteId&&(l=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof l=="boolean"&&(l=Number(l)),l===void 0&&(!((s=t.properties)===null||s===void 0)&&s.cluster)&&this.promoteId&&(l=Number(t.properties.cluster_id))),l}}function Sg(i,t,r,s,l){return Ft(i,((f,m)=>{const y=t instanceof wl?t.get(m):null;return y&&y.evaluate?y.evaluate(r,s,l):y}))}function n0(i,t){return t-i}function Pg(i,t,r,s,l){const f=[];for(let m=0;m<i.length;m++){const y=i[m];let v;for(let S=0;S<y.length-1;S++){let M=y[S],E=y[S+1];M.x<t&&E.x<t||(M.x<t?M=new B(t,M.y+(t-M.x)/(E.x-M.x)*(E.y-M.y))._round():E.x<t&&(E=new B(t,M.y+(t-M.x)/(E.x-M.x)*(E.y-M.y))._round()),M.y<r&&E.y<r||(M.y<r?M=new B(M.x+(r-M.y)/(E.y-M.y)*(E.x-M.x),r)._round():E.y<r&&(E=new B(M.x+(r-M.y)/(E.y-M.y)*(E.x-M.x),r)._round()),M.x>=s&&E.x>=s||(M.x>=s?M=new B(s,M.y+(s-M.x)/(E.x-M.x)*(E.y-M.y))._round():E.x>=s&&(E=new B(s,M.y+(s-M.x)/(E.x-M.x)*(E.y-M.y))._round()),M.y>=l&&E.y>=l||(M.y>=l?M=new B(M.x+(l-M.y)/(E.y-M.y)*(E.x-M.x),l)._round():E.y>=l&&(E=new B(M.x+(l-M.y)/(E.y-M.y)*(E.x-M.x),l)._round()),v&&M.equals(v[v.length-1])||(v=[M],f.push(v)),v.push(E)))))}}return f}He("FeatureIndex",Tg,{omit:["rawTileData","sourceLayerCoder"]});class La extends B{constructor(t,r,s,l){super(t,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new La(this.x,this.y,this.angle,this.segment)}}function Mg(i,t,r,s,l){if(t.segment===void 0||r===0)return!0;let f=t,m=t.segment+1,y=0;for(;y>-r/2;){if(m--,m<0)return!1;y-=i[m].dist(f),f=i[m]}y+=i[m].dist(i[m+1]),m++;const v=[];let S=0;for(;y<r/2;){const M=i[m],E=i[m+1];if(!E)return!1;let D=i[m-1].angleTo(M)-M.angleTo(E);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),v.push({distance:y,angleDelta:D}),S+=D;y-v[0].distance>s;)S-=v.shift().angleDelta;if(S>l)return!1;m++,y+=M.dist(E)}return!0}function Cg(i){let t=0;for(let r=0;r<i.length-1;r++)t+=i[r].dist(i[r+1]);return t}function Ig(i,t,r){return i?.6*t*r:0}function Eg(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function s0(i,t,r,s,l,f){const m=Ig(r,l,f),y=Eg(r,s)*f;let v=0;const S=Cg(i)/2;for(let M=0;M<i.length-1;M++){const E=i[M],D=i[M+1],L=E.dist(D);if(v+L>S){const F=(S-v)/L,N=kn.number(E.x,D.x,F),Z=kn.number(E.y,D.y,F),Y=new La(N,Z,D.angleTo(E),M);return Y._round(),!m||Mg(i,Y,y,m,t)?Y:void 0}v+=L}}function a0(i,t,r,s,l,f,m,y,v){const S=Ig(s,f,m),M=Eg(s,l),E=M*m,D=i[0].x===0||i[0].x===v||i[0].y===0||i[0].y===v;return t-E<t/4&&(t=E+t/4),Ag(i,D?t/2*y%t:(M/2+2*f)*m*y%t,t,S,r,E,D,!1,v)}function Ag(i,t,r,s,l,f,m,y,v){const S=f/2,M=Cg(i);let E=0,D=t-r,L=[];for(let F=0;F<i.length-1;F++){const N=i[F],Z=i[F+1],Y=N.dist(Z),me=Z.angleTo(N);for(;D+r<E+Y;){D+=r;const ne=(D-E)/Y,oe=kn.number(N.x,Z.x,ne),be=kn.number(N.y,Z.y,ne);if(oe>=0&&oe<v&&be>=0&&be<v&&D-S>=0&&D+S<=M){const Pe=new La(oe,be,me,F);Pe._round(),s&&!Mg(i,Pe,f,s,l)||L.push(Pe)}}E+=Y}return y||L.length||m||(L=Ag(i,E/2,r,s,l,f,m,!0,v)),L}function kg(i,t,r,s){const l=[],f=i.image,m=f.pixelRatio,y=f.paddedRect.w-2,v=f.paddedRect.h-2;let S={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const M=f.stretchX||[[0,y]],E=f.stretchY||[[0,v]],D=(Ae,ut)=>Ae+ut[1]-ut[0],L=M.reduce(D,0),F=E.reduce(D,0),N=y-L,Z=v-F;let Y=0,me=L,ne=0,oe=F,be=0,Pe=N,Be=0,qe=Z;if(f.content&&s){const Ae=f.content,ut=Ae[2]-Ae[0],ft=Ae[3]-Ae[1];(f.textFitWidth||f.textFitHeight)&&(S=sg(i)),Y=ad(M,0,Ae[0]),ne=ad(E,0,Ae[1]),me=ad(M,Ae[0],Ae[2]),oe=ad(E,Ae[1],Ae[3]),be=Ae[0]-Y,Be=Ae[1]-ne,Pe=ut-me,qe=ft-oe}const Ne=S.x1,Ze=S.y1,it=S.x2-Ne,Ue=S.y2-Ze,Ge=(Ae,ut,ft,st)=>{const Je=od(Ae.stretch-Y,me,it,Ne),Bt=ld(Ae.fixed-be,Pe,Ae.stretch,L),Lr=od(ut.stretch-ne,oe,Ue,Ze),ii=ld(ut.fixed-Be,qe,ut.stretch,F),Si=od(ft.stretch-Y,me,it,Ne),vn=ld(ft.fixed-be,Pe,ft.stretch,L),Wi=od(st.stretch-ne,oe,Ue,Ze),_i=ld(st.fixed-Be,qe,st.stretch,F),Cr=new B(Je,Lr),ui=new B(Si,Lr),yi=new B(Si,Wi),vi=new B(Je,Wi),Oi=new B(Bt/m,ii/m),xn=new B(vn/m,_i/m),hi=t*Math.PI/180;if(hi){const di=Math.sin(hi),pi=Math.cos(hi),Yr=[pi,-di,di,pi];Cr._matMult(Yr),ui._matMult(Yr),vi._matMult(Yr),yi._matMult(Yr)}const Hi=Ae.stretch+Ae.fixed,ni=ut.stretch+ut.fixed;return{tl:Cr,tr:ui,bl:vi,br:yi,tex:{x:f.paddedRect.x+1+Hi,y:f.paddedRect.y+1+ni,w:ft.stretch+ft.fixed-Hi,h:st.stretch+st.fixed-ni},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oi,pixelOffsetBR:xn,minFontScaleX:Pe/m/it,minFontScaleY:qe/m/Ue,isSDF:r}};if(s&&(f.stretchX||f.stretchY)){const Ae=zg(M,N,L),ut=zg(E,Z,F);for(let ft=0;ft<Ae.length-1;ft++){const st=Ae[ft],Je=Ae[ft+1];for(let Bt=0;Bt<ut.length-1;Bt++)l.push(Ge(st,ut[Bt],Je,ut[Bt+1]))}}else l.push(Ge({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:v+1}));return l}function ad(i,t,r){let s=0;for(const l of i)s+=Math.max(t,Math.min(r,l[1]))-Math.max(t,Math.min(r,l[0]));return s}function zg(i,t,r){const s=[{fixed:-1,stretch:0}];for(const[l,f]of i){const m=s[s.length-1];s.push({fixed:l-m.stretch,stretch:m.stretch}),s.push({fixed:l-m.stretch,stretch:m.stretch+(f-l)})}return s.push({fixed:t+1,stretch:r}),s}function od(i,t,r,s){return i/t*r+s}function ld(i,t,r,s){return i-t*r/s}He("Anchor",La);class cd{constructor(t,r,s,l,f,m,y,v,S,M){var E;if(this.boxStartIndex=t.length,S){let D=m.top,L=m.bottom;const F=m.collisionPadding;F&&(D-=F[1],L+=F[3]);let N=L-D;N>0&&(N=Math.max(10,N),this.circleDiameter=N)}else{const D=!((E=m.image)===null||E===void 0)&&E.content&&(m.image.textFitWidth||m.image.textFitHeight)?sg(m):{x1:m.left,y1:m.top,x2:m.right,y2:m.bottom};D.y1=D.y1*y-v[0],D.y2=D.y2*y+v[2],D.x1=D.x1*y-v[3],D.x2=D.x2*y+v[1];const L=m.collisionPadding;if(L&&(D.x1-=L[0]*y,D.y1-=L[1]*y,D.x2+=L[2]*y,D.y2+=L[3]*y),M){const F=new B(D.x1,D.y1),N=new B(D.x2,D.y1),Z=new B(D.x1,D.y2),Y=new B(D.x2,D.y2),me=M*Math.PI/180;F._rotate(me),N._rotate(me),Z._rotate(me),Y._rotate(me),D.x1=Math.min(F.x,N.x,Z.x,Y.x),D.x2=Math.max(F.x,N.x,Z.x,Y.x),D.y1=Math.min(F.y,N.y,Z.y,Y.y),D.y2=Math.max(F.y,N.y,Z.y,Y.y)}t.emplaceBack(r.x,r.y,D.x1,D.y1,D.x2,D.y2,s,l,f)}this.boxEndIndex=t.length}}class o0{constructor(t=[],r=(s,l)=>s<l?-1:s>l?1:0){if(this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:r,compare:s}=this,l=r[t];for(;t>0;){const f=t-1>>1,m=r[f];if(s(l,m)>=0)break;r[t]=m,t=f}r[t]=l}_down(t){const{data:r,compare:s}=this,l=this.length>>1,f=r[t];for(;t<l;){let m=1+(t<<1);const y=m+1;if(y<this.length&&s(r[y],r[m])<0&&(m=y),s(r[m],f)>=0)break;r[t]=r[m],t=m}r[t]=f}}function l0(i,t=1,r=!1){const s=Mo.fromPoints(i[0]),l=Math.min(s.width(),s.height());let f=l/2;const m=new o0([],c0),{minX:y,minY:v,maxX:S,maxY:M}=s;if(l===0)return new B(y,v);for(let L=y;L<S;L+=l)for(let F=v;F<M;F+=l)m.push(new jl(L+f,F+f,f,i));let E=(function(L){let F=0,N=0,Z=0;const Y=L[0];for(let me=0,ne=Y.length,oe=ne-1;me<ne;oe=me++){const be=Y[me],Pe=Y[oe],Be=be.x*Pe.y-Pe.x*be.y;N+=(be.x+Pe.x)*Be,Z+=(be.y+Pe.y)*Be,F+=3*Be}return new jl(N/F,Z/F,0,L)})(i),D=m.length;for(;m.length;){const L=m.pop();(L.d>E.d||!E.d)&&(E=L,r&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,D)),L.max-E.d<=t||(f=L.h/2,m.push(new jl(L.p.x-f,L.p.y-f,f,i)),m.push(new jl(L.p.x+f,L.p.y-f,f,i)),m.push(new jl(L.p.x-f,L.p.y+f,f,i)),m.push(new jl(L.p.x+f,L.p.y+f,f,i)),D+=4)}return r&&(console.log(`num probes: ${D}`),console.log(`best distance: ${E.d}`)),E.p}function c0(i,t){return t.max-i.max}function jl(i,t,r,s){this.p=new B(i,t),this.h=r,this.d=(function(l,f){let m=!1,y=1/0;for(let v=0;v<f.length;v++){const S=f[v];for(let M=0,E=S.length,D=E-1;M<E;D=M++){const L=S[M],F=S[D];L.y>l.y!=F.y>l.y&&l.x<(F.x-L.x)*(l.y-L.y)/(F.y-L.y)+L.x&&(m=!m),y=Math.min(y,gm(l,L,F))}}return(m?1:-1)*Math.sqrt(y)})(this.p,s),this.max=this.d+this.h*Math.SQRT2}var Ti;T.aE=void 0,(Ti=T.aE||(T.aE={}))[Ti.center=1]="center",Ti[Ti.left=2]="left",Ti[Ti.right=3]="right",Ti[Ti.top=4]="top",Ti[Ti.bottom=5]="bottom",Ti[Ti["top-left"]=6]="top-left",Ti[Ti["top-right"]=7]="top-right",Ti[Ti["bottom-left"]=8]="bottom-left",Ti[Ti["bottom-right"]=9]="bottom-right";const Xp=Number.POSITIVE_INFINITY;function Dg(i,t){return t[1]!==Xp?(function(r,s,l){let f=0,m=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":m=l-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-l}switch(r){case"top-right":case"bottom-right":case"right":f=-s;break;case"top-left":case"bottom-left":case"left":f=s}return[f,m]})(i,t[0],t[1]):(function(r,s){let l=0,f=0;s<0&&(s=0);const m=s/Math.SQRT2;switch(r){case"top-right":case"top-left":f=m-7;break;case"bottom-right":case"bottom-left":f=7-m;break;case"bottom":f=7-s;break;case"top":f=s-7}switch(r){case"top-right":case"bottom-right":l=-m;break;case"top-left":case"bottom-left":l=m;break;case"left":l=s;break;case"right":l=-s}return[l,f]})(i,t[0])}function Rg(i,t,r){var s;const l=i.layout,f=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(t,{},r);if(f){const y=f.values,v=[];for(let S=0;S<y.length;S+=2){const M=v[S]=y[S],E=y[S+1].map((D=>D*ci));M.startsWith("top")?E[1]-=7:M.startsWith("bottom")&&(E[1]+=7),v[S+1]=E}return new Ci(v)}const m=l.get("text-variable-anchor");if(m){let y;y=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(t,{},r)*ci,Xp]:l.get("text-offset").evaluate(t,{},r).map((S=>S*ci));const v=[];for(const S of m)v.push(S,Dg(S,y));return new Ci(v)}return null}function Kp(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function u0(i,t,r,s,l,f,m,y,v,S,M,E){let D=f.textMaxSize.evaluate(t,{});D===void 0&&(D=m);const L=i.layers[0].layout,F=L.get("icon-offset").evaluate(t,{},M),N=Bg(r.horizontal),Z=m/24,Y=i.tilePixelRatio*Z,me=i.tilePixelRatio*D/24,ne=i.tilePixelRatio*y,oe=i.tilePixelRatio*L.get("symbol-spacing"),be=L.get("text-padding")*i.tilePixelRatio,Pe=(function(ft,st,Je,Bt=1){const Lr=ft.get("icon-padding").evaluate(st,{},Je),ii=Lr&&Lr.values;return[ii[0]*Bt,ii[1]*Bt,ii[2]*Bt,ii[3]*Bt]})(L,t,M,i.tilePixelRatio),Be=L.get("text-max-angle")/180*Math.PI,qe=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",Ne=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ze=L.get("symbol-placement"),it=oe/2,Ue=L.get("icon-text-fit");let Ge;s&&Ue!=="none"&&(i.allowVerticalPlacement&&r.vertical&&(Ge=ag(s,r.vertical,Ue,L.get("icon-text-fit-padding"),F,Z)),N&&(s=ag(s,N,Ue,L.get("icon-text-fit-padding"),F,Z)));const Ae=M?E.line.getGranularityForZoomLevel(M.z):1,ut=(ft,st)=>{st.x<0||st.x>=ht||st.y<0||st.y>=ht||(function(Je,Bt,Lr,ii,Si,vn,Wi,_i,Cr,ui,yi,vi,Oi,xn,hi,Hi,ni,di,pi,Yr,yr,Wn,Nl,Hn,p0){const Vl=Je.addToLineVertexArray(Bt,Lr);let Co,Ul,$l,Zl,Ng=0,Vg=0,Ug=0,$g=0,sf=-1,af=-1;const Js={};let Zg=Aa("");if(Je.allowVerticalPlacement&&ii.vertical){const ki=_i.layout.get("text-rotate").evaluate(yr,{},Hn)+90;$l=new cd(Cr,Bt,ui,yi,vi,ii.vertical,Oi,xn,hi,ki),Wi&&(Zl=new cd(Cr,Bt,ui,yi,vi,Wi,ni,di,hi,ki))}if(Si){const ki=_i.layout.get("icon-rotate").evaluate(yr,{}),bn=_i.layout.get("icon-text-fit")!=="none",Io=kg(Si,ki,Nl,bn),Kn=Wi?kg(Wi,ki,Nl,bn):void 0;Ul=new cd(Cr,Bt,ui,yi,vi,Si,ni,di,!1,ki),Ng=4*Io.length;const Eo=Je.iconSizeData;let bs=null;Eo.kind==="source"?(bs=[Ys*_i.layout.get("icon-size").evaluate(yr,{})],bs[0]>Da&&Gt(`${Je.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Eo.kind==="composite"&&(bs=[Ys*Wn.compositeIconSizes[0].evaluate(yr,{},Hn),Ys*Wn.compositeIconSizes[1].evaluate(yr,{},Hn)],(bs[0]>Da||bs[1]>Da)&&Gt(`${Je.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Je.addSymbols(Je.icon,Io,bs,Yr,pi,yr,T.ao.none,Bt,Vl.lineStartIndex,Vl.lineLength,-1,Hn),sf=Je.icon.placedSymbolArray.length-1,Kn&&(Vg=4*Kn.length,Je.addSymbols(Je.icon,Kn,bs,Yr,pi,yr,T.ao.vertical,Bt,Vl.lineStartIndex,Vl.lineLength,-1,Hn),af=Je.icon.placedSymbolArray.length-1)}const Gg=Object.keys(ii.horizontal);for(const ki of Gg){const bn=ii.horizontal[ki];if(!Co){Zg=Aa(bn.text);const Kn=_i.layout.get("text-rotate").evaluate(yr,{},Hn);Co=new cd(Cr,Bt,ui,yi,vi,bn,Oi,xn,hi,Kn)}const Io=bn.positionedLines.length===1;if(Ug+=Lg(Je,Bt,bn,vn,_i,hi,yr,Hi,Vl,ii.vertical?T.ao.horizontal:T.ao.horizontalOnly,Io?Gg:[ki],Js,sf,Wn,Hn),Io)break}ii.vertical&&($g+=Lg(Je,Bt,ii.vertical,vn,_i,hi,yr,Hi,Vl,T.ao.vertical,["vertical"],Js,af,Wn,Hn));const f0=Co?Co.boxStartIndex:Je.collisionBoxArray.length,m0=Co?Co.boxEndIndex:Je.collisionBoxArray.length,g0=$l?$l.boxStartIndex:Je.collisionBoxArray.length,_0=$l?$l.boxEndIndex:Je.collisionBoxArray.length,y0=Ul?Ul.boxStartIndex:Je.collisionBoxArray.length,v0=Ul?Ul.boxEndIndex:Je.collisionBoxArray.length,x0=Zl?Zl.boxStartIndex:Je.collisionBoxArray.length,b0=Zl?Zl.boxEndIndex:Je.collisionBoxArray.length;let Xn=-1;const hd=(ki,bn)=>ki&&ki.circleDiameter?Math.max(ki.circleDiameter,bn):bn;Xn=hd(Co,Xn),Xn=hd($l,Xn),Xn=hd(Ul,Xn),Xn=hd(Zl,Xn);const qg=Xn>-1?1:0;qg&&(Xn*=p0/ci),Je.glyphOffsetArray.length>=Fl.MAX_GLYPHS&&Gt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),yr.sortKey!==void 0&&Je.addToSortKeyRanges(Je.symbolInstances.length,yr.sortKey);const w0=Rg(_i,yr,Hn),[T0,S0]=(function(ki,bn){const Io=ki.length,Kn=bn?.values;if(Kn?.length>0)for(let Eo=0;Eo<Kn.length;Eo+=2){const bs=Kn[Eo+1];ki.emplaceBack(T.aE[Kn[Eo]],bs[0],bs[1])}return[Io,ki.length]})(Je.textAnchorOffsets,w0);Je.symbolInstances.emplaceBack(Bt.x,Bt.y,Js.right>=0?Js.right:-1,Js.center>=0?Js.center:-1,Js.left>=0?Js.left:-1,Js.vertical||-1,sf,af,Zg,f0,m0,g0,_0,y0,v0,x0,b0,ui,Ug,$g,Ng,Vg,qg,0,Oi,Xn,T0,S0)})(i,st,ft,r,s,l,Ge,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,Y,[be,be,be,be],qe,v,ne,Pe,Ne,F,t,f,S,M,m)};if(Ze==="line")for(const ft of Pg(t.geometry,0,0,ht,ht)){const st=Po(ft,Ae),Je=a0(st,oe,Be,r.vertical||N,s,24,me,i.overscaling,ht);for(const Bt of Je)N&&h0(i,N.text,it,Bt)||ut(st,Bt)}else if(Ze==="line-center"){for(const ft of t.geometry)if(ft.length>1){const st=Po(ft,Ae),Je=s0(st,Be,r.vertical||N,s,24,me);Je&&ut(st,Je)}}else if(t.type==="Polygon")for(const ft of oo(t.geometry,0)){const st=l0(ft,16);ut(Po(ft[0],Ae,!0),new La(st.x,st.y,0))}else if(t.type==="LineString")for(const ft of t.geometry){const st=Po(ft,Ae);ut(st,new La(st[0].x,st[0].y,0))}else if(t.type==="Point")for(const ft of t.geometry)for(const st of ft)ut([st],new La(st.x,st.y,0))}function Lg(i,t,r,s,l,f,m,y,v,S,M,E,D,L,F){const N=(function(me,ne,oe,be,Pe,Be,qe,Ne){const Ze=be.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,it=[];for(const Ue of ne.positionedLines)for(const Ge of Ue.positionedGlyphs){if(!Ge.rect)continue;const Ae=Ge.rect||{};let ut=4,ft=!0,st=1,Je=0;const Bt=(Pe||Ne)&&Ge.vertical,Lr=Ge.metrics.advance*Ge.scale/2;if(Ne&&ne.verticalizable&&(Je=Ue.lineOffset/2-(Ge.imageName?-(ci-Ge.metrics.width*Ge.scale)/2:(Ge.scale-1)*ci)),Ge.imageName){const di=qe[Ge.imageName];ft=di.sdf,st=di.pixelRatio,ut=1/st}const ii=Pe?[Ge.x+Lr,Ge.y]:[0,0];let Si=Pe?[0,0]:[Ge.x+Lr+oe[0],Ge.y+oe[1]-Je],vn=[0,0];Bt&&(vn=Si,Si=[0,0]);const Wi=Ge.metrics.isDoubleResolution?2:1,_i=(Ge.metrics.left-ut)*Ge.scale-Lr+Si[0],Cr=(-Ge.metrics.top-ut)*Ge.scale+Si[1],ui=_i+Ae.w/Wi*Ge.scale/st,yi=Cr+Ae.h/Wi*Ge.scale/st,vi=new B(_i,Cr),Oi=new B(ui,Cr),xn=new B(_i,yi),hi=new B(ui,yi);if(Bt){const di=new B(-Lr,Lr- -17),pi=-Math.PI/2,Yr=12-Lr,yr=new B(22-Yr,-(Ge.imageName?Yr:0)),Wn=new B(...vn);vi._rotateAround(pi,di)._add(yr)._add(Wn),Oi._rotateAround(pi,di)._add(yr)._add(Wn),xn._rotateAround(pi,di)._add(yr)._add(Wn),hi._rotateAround(pi,di)._add(yr)._add(Wn)}if(Ze){const di=Math.sin(Ze),pi=Math.cos(Ze),Yr=[pi,-di,di,pi];vi._matMult(Yr),Oi._matMult(Yr),xn._matMult(Yr),hi._matMult(Yr)}const Hi=new B(0,0),ni=new B(0,0);it.push({tl:vi,tr:Oi,bl:xn,br:hi,tex:Ae,writingMode:ne.writingMode,glyphOffset:ii,sectionIndex:Ge.sectionIndex,isSDF:ft,pixelOffsetTL:Hi,pixelOffsetBR:ni,minFontScaleX:0,minFontScaleY:0})}return it})(0,r,y,l,f,m,s,i.allowVerticalPlacement),Z=i.textSizeData;let Y=null;Z.kind==="source"?(Y=[Ys*l.layout.get("text-size").evaluate(m,{})],Y[0]>Da&&Gt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Z.kind==="composite"&&(Y=[Ys*L.compositeTextSizes[0].evaluate(m,{},F),Ys*L.compositeTextSizes[1].evaluate(m,{},F)],(Y[0]>Da||Y[1]>Da)&&Gt(`${i.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),i.addSymbols(i.text,N,Y,y,f,m,S,t,v.lineStartIndex,v.lineLength,D,F);for(const me of M)E[me]=i.text.placedSymbolArray.length-1;return 4*N.length}function Bg(i){for(const t in i)return i[t];return null}function h0(i,t,r,s){const l=i.compareText;if(t in l){const f=l[t];for(let m=f.length-1;m>=0;m--)if(s.dist(f[m])<r)return!0}else l[t]=[];return l[t].push(s),!1}const Fg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yp{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(t,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const f=Fg[15&s];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[y]=new Uint32Array(t,4,1);return new Yp(y,m,f,t)}constructor(t,r=64,s=Float64Array,l){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=Fg.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,y=t*this.IndexArrayType.BYTES_PER_ELEMENT,v=(8-y%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+v,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+v),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+y+v,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=t)}add(t,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=t,this.coords[this._pos++]=r,s}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Jp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:y}=this,v=[0,f.length-1,0],S=[];for(;v.length;){const M=v.pop()||0,E=v.pop()||0,D=v.pop()||0;if(E-D<=y){for(let Z=D;Z<=E;Z++){const Y=m[2*Z],me=m[2*Z+1];Y>=t&&Y<=s&&me>=r&&me<=l&&S.push(f[Z])}continue}const L=D+E>>1,F=m[2*L],N=m[2*L+1];F>=t&&F<=s&&N>=r&&N<=l&&S.push(f[L]),(M===0?t<=F:r<=N)&&(v.push(D),v.push(L-1),v.push(1-M)),(M===0?s>=F:l>=N)&&(v.push(L+1),v.push(E),v.push(1-M))}return S}within(t,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:f,nodeSize:m}=this,y=[0,l.length-1,0],v=[],S=s*s;for(;y.length;){const M=y.pop()||0,E=y.pop()||0,D=y.pop()||0;if(E-D<=m){for(let Z=D;Z<=E;Z++)jg(f[2*Z],f[2*Z+1],t,r)<=S&&v.push(l[Z]);continue}const L=D+E>>1,F=f[2*L],N=f[2*L+1];jg(F,N,t,r)<=S&&v.push(l[L]),(M===0?t-s<=F:r-s<=N)&&(y.push(D),y.push(L-1),y.push(1-M)),(M===0?t+s>=F:r+s>=N)&&(y.push(L+1),y.push(E),y.push(1-M))}return v}}function Jp(i,t,r,s,l,f){if(l-s<=r)return;const m=s+l>>1;Og(i,t,m,s,l,f),Jp(i,t,r,s,m-1,1-f),Jp(i,t,r,m+1,l,1-f)}function Og(i,t,r,s,l,f){for(;l>s;){if(l-s>600){const S=l-s+1,M=r-s+1,E=Math.log(S),D=.5*Math.exp(2*E/3),L=.5*Math.sqrt(E*D*(S-D)/S)*(M-S/2<0?-1:1);Og(i,t,r,Math.max(s,Math.floor(r-M*D/S+L)),Math.min(l,Math.floor(r+(S-M)*D/S+L)),f)}const m=t[2*r+f];let y=s,v=l;for(Tu(i,t,s,r),t[2*l+f]>m&&Tu(i,t,s,l);y<v;){for(Tu(i,t,y,v),y++,v--;t[2*y+f]<m;)y++;for(;t[2*v+f]>m;)v--}t[2*s+f]===m?Tu(i,t,s,v):(v++,Tu(i,t,v,l)),v<=r&&(s=v+1),r<=v&&(l=v-1)}}function Tu(i,t,r,s){Qp(i,r,s),Qp(t,2*r,2*s),Qp(t,2*r+1,2*s+1)}function Qp(i,t,r){const s=i[t];i[t]=i[r],i[r]=s}function jg(i,t,r,s){const l=i-r,f=t-s;return l*l+f*f}var ef;T.cx=void 0,(ef=T.cx||(T.cx={})).create="create",ef.load="load",ef.fullLoad="fullLoad";let ud=null,Su=[];const tf=1e3/60,rf="loadTime",nf="fullLoadTime",d0={mark(i){performance.mark(i)},frame(i){const t=i;ud!=null&&Su.push(t-ud),ud=t},clearMetrics(){ud=null,Su=[],performance.clearMeasures(rf),performance.clearMeasures(nf);for(const i in T.cx)performance.clearMarks(T.cx[i])},getPerformanceMetrics(){performance.measure(rf,T.cx.create,T.cx.load),performance.measure(nf,T.cx.create,T.cx.fullLoad);const i=performance.getEntriesByName(rf)[0].duration,t=performance.getEntriesByName(nf)[0].duration,r=Su.length,s=1/(Su.reduce(((f,m)=>f+m),0)/r/1e3),l=Su.filter((f=>f>tf)).reduce(((f,m)=>f+(m-tf)/tf),0);return{loadTime:i,fullLoadTime:t,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};T.$=ht,T.A=Ee,T.B=function([i,t,r]){return t+=90,t*=Math.PI/180,r*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(r),y:i*Math.sin(t)*Math.sin(r),z:i*Math.cos(r)}},T.C=kn,T.D=et,T.E=Ke,T.F=wr,T.G=yo,T.H=function(i){if(xr==null){const t=i.navigator?i.navigator.userAgent:null;xr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return xr},T.I=Op,T.J=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new r0((()=>this.process())),this.subscription=Br(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=Gr(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise(((r,s)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10),f=t?Br(t.signal,"abort",(()=>{f?.unsubscribe(),delete this.resolveRejects[l];const v={id:l,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)}),i0):null;this.resolveRejects[l]={resolve:v=>{f?.unsubscribe(),r(v)},reject:v=>{f?.unsubscribe(),s(v)}};const m=[],y=Object.assign(Object.assign({},i),{id:l,sourceMapId:this.mapId,origin:location.origin,data:Sa(i.data,m)});this.target.postMessage(y,{transfer:m})}))}receive(i){const t=i.data,r=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(Gr(self)||t.mustQueue)return this.tasks[r]=t,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return o(this,void 0,void 0,(function*(){if(t.type==="<response>"){const l=this.resolveRejects[i];return delete this.resolveRejects[i],l?void(t.error?l.reject(qs(t.error)):l.resolve(qs(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=qs(t.data),s=new AbortController;this.abortControllers[i]=s;try{const l=yield this.messageHandlers[t.type](t.sourceMapId,r,s);this.completeTask(i,null,l)}catch(l){this.completeTask(i,l)}}))}completeTask(i,t,r){const s=[];delete this.abortControllers[i];const l={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?Sa(t):null,data:Sa(r,s)};this.target.postMessage(l,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.K=$,T.L=function(){var i=new Ee(16);return Ee!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},T.M=function(i,t,r){var s,l,f,m,y,v,S,M,E,D,L,F,N=r[0],Z=r[1],Y=r[2];return t===i?(i[12]=t[0]*N+t[4]*Z+t[8]*Y+t[12],i[13]=t[1]*N+t[5]*Z+t[9]*Y+t[13],i[14]=t[2]*N+t[6]*Z+t[10]*Y+t[14],i[15]=t[3]*N+t[7]*Z+t[11]*Y+t[15]):(l=t[1],f=t[2],m=t[3],y=t[4],v=t[5],S=t[6],M=t[7],E=t[8],D=t[9],L=t[10],F=t[11],i[0]=s=t[0],i[1]=l,i[2]=f,i[3]=m,i[4]=y,i[5]=v,i[6]=S,i[7]=M,i[8]=E,i[9]=D,i[10]=L,i[11]=F,i[12]=s*N+y*Z+E*Y+t[12],i[13]=l*N+v*Z+D*Y+t[13],i[14]=f*N+S*Z+L*Y+t[14],i[15]=m*N+M*Z+F*Y+t[15]),i},T.N=function(i,t,r){var s=r[0],l=r[1],f=r[2];return i[0]=t[0]*s,i[1]=t[1]*s,i[2]=t[2]*s,i[3]=t[3]*s,i[4]=t[4]*l,i[5]=t[5]*l,i[6]=t[6]*l,i[7]=t[7]*l,i[8]=t[8]*f,i[9]=t[9]*f,i[10]=t[10]*f,i[11]=t[11]*f,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},T.O=function(i,t,r){var s=t[0],l=t[1],f=t[2],m=t[3],y=t[4],v=t[5],S=t[6],M=t[7],E=t[8],D=t[9],L=t[10],F=t[11],N=t[12],Z=t[13],Y=t[14],me=t[15],ne=r[0],oe=r[1],be=r[2],Pe=r[3];return i[0]=ne*s+oe*y+be*E+Pe*N,i[1]=ne*l+oe*v+be*D+Pe*Z,i[2]=ne*f+oe*S+be*L+Pe*Y,i[3]=ne*m+oe*M+be*F+Pe*me,i[4]=(ne=r[4])*s+(oe=r[5])*y+(be=r[6])*E+(Pe=r[7])*N,i[5]=ne*l+oe*v+be*D+Pe*Z,i[6]=ne*f+oe*S+be*L+Pe*Y,i[7]=ne*m+oe*M+be*F+Pe*me,i[8]=(ne=r[8])*s+(oe=r[9])*y+(be=r[10])*E+(Pe=r[11])*N,i[9]=ne*l+oe*v+be*D+Pe*Z,i[10]=ne*f+oe*S+be*L+Pe*Y,i[11]=ne*m+oe*M+be*F+Pe*me,i[12]=(ne=r[12])*s+(oe=r[13])*y+(be=r[14])*E+(Pe=r[15])*N,i[13]=ne*l+oe*v+be*D+Pe*Z,i[14]=ne*f+oe*S+be*L+Pe*Y,i[15]=ne*m+oe*M+be*F+Pe*me,i},T.P=B,T.Q=function(i,t){const r={};for(let s=0;s<t.length;s++){const l=t[s];l in i&&(r[l]=i[l])}return r},T.R=qi,T.S=Ra,T.T=Cp,T.U=gg,T.V=mg,T.W=Me,T.X=ke,T.Y=Sr,T.Z=yn,T._=o,T.a=j,T.a$=mt,T.a0=function(i,t){var r,s,l,f;if(!i)return t??{};if(!t)return i;const m=Object.assign({},i);if(t.removeAll&&(m.removeAll=!0),t.remove){const y=new Set(m.remove?m.remove.concat(t.remove):t.remove);m.remove=Array.from(y.values())}if(t.add){const y=m.add?m.add.concat(t.add):t.add,v=new Map(y.map((S=>[S.id,S])));m.add=Array.from(v.values())}if(t.update){const y=new Map((r=m.update)===null||r===void 0?void 0:r.map((v=>[v.id,v])));for(const v of t.update){const S=(s=y.get(v.id))!==null&&s!==void 0?s:{id:v.id};v.newGeometry&&(S.newGeometry=v.newGeometry),v.addOrUpdateProperties&&(S.addOrUpdateProperties=((l=S.addOrUpdateProperties)!==null&&l!==void 0?l:[]).concat(v.addOrUpdateProperties)),v.removeProperties&&(S.removeProperties=((f=S.removeProperties)!==null&&f!==void 0?f:[]).concat(v.removeProperties)),v.removeAllProperties&&(S.removeAllProperties=!0),y.set(v.id,S)}m.update=Array.from(y.values())}return m},T.a1=bu,T.a2=Mo,T.a3=25,T.a4=Hp,T.a5=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise((r=>{t.onloadstart=()=>{r(t)};for(const s of i){const l=window.document.createElement("source");pe(s)||(t.crossOrigin="Anonymous"),l.src=s,t.appendChild(l)}}))},T.a6=je,T.a7=function(){return kt++},T.a8=A,T.a9=Fl,T.aA=function(i){let t=1/0,r=1/0,s=-1/0,l=-1/0;for(const f of i)t=Math.min(t,f.x),r=Math.min(r,f.y),s=Math.max(s,f.x),l=Math.max(l,f.y);return[t,r,s,l]},T.aB=ci,T.aC=lr,T.aD=function(i,t,r,s,l=!1){if(!r[0]&&!r[1])return[0,0];const f=l?s==="map"?-i.bearingInRadians:0:s==="viewport"?i.bearingInRadians:0;if(f){const m=Math.sin(f),y=Math.cos(f);r=[r[0]*y-r[1]*m,r[0]*m+r[1]*y]}return[l?r[0]:lr(t,r[0],i.zoom),l?r[1]:lr(t,r[1],i.zoom)]},T.aF=Vp,T.aG=Kp,T.aH=Np,T.aI=Yp,T.aJ=Nr,T.aK=ed,T.aL=ee,T.aM=xt,T.aN=ir,T.aO=Jr,T.aP=Qr,T.aQ=yg,T.aR=at,T.aS=gt,T.aT=function(i){var t=new Ee(3);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t},T.aU=function(i,t,r){return i[0]=t[0]-r[0],i[1]=t[1]-r[1],i[2]=t[2]-r[2],i},T.aV=function(i,t){var r=t[0],s=t[1],l=t[2],f=r*r+s*s+l*l;return f>0&&(f=1/Math.sqrt(f)),i[0]=t[0]*f,i[1]=t[1]*f,i[2]=t[2]*f,i},T.aW=rt,T.aX=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]},T.aY=function(i,t,r){return i[0]=t[0]*r[0],i[1]=t[1]*r[1],i[2]=t[2]*r[2],i[3]=t[3]*r[3],i},T.aZ=Oe,T.a_=function(i,t,r){const s=t[0]*r[0]+t[1]*r[1]+t[2]*r[2];return s===0?null:(-(i[0]*r[0]+i[1]*r[1]+i[2]*r[2])-r[3])/s},T.aa=$s,T.ab=qn,T.ac=wg,T.ad=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,s,l,f)=>{const m=l||f;return t[s]=!m||m.toLowerCase(),""})),t["max-age"]){const r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t},T.ae=Fr,T.af=function(i){return Math.pow(2,i)},T.ag=$e,T.ah=Qt,T.ai=85.051129,T.aj=_g,T.ak=function(i){return Math.log(i)/Math.LN2},T.al=function(i){var t=i[0],r=i[1];return t*t+r*r},T.am=function(i,t){const r=[];for(const s in i)s in t||r.push(s);return r},T.an=function(i,t){let r=0,s=0;if(i.kind==="constant")s=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:l,minZoom:f,maxZoom:m}=i,y=l?Qt(gi.interpolationFactor(l,t,f,m),0,1):0;i.kind==="camera"?s=kn.number(i.minSize,i.maxSize,y):r=y}return{uSizeT:r,uSize:s}},T.ap=function(i,{uSize:t,uSizeT:r},{lowerSize:s,upperSize:l}){return i.kind==="source"?s/Ys:i.kind==="composite"?kn.number(s/Ys,l/Ys,r):t},T.aq=function(i,t){var r=t[0],s=t[1],l=t[2],f=t[3],m=t[4],y=t[5],v=t[6],S=t[7],M=t[8],E=t[9],D=t[10],L=t[11],F=t[12],N=t[13],Z=t[14],Y=t[15],me=r*y-s*m,ne=r*v-l*m,oe=r*S-f*m,be=s*v-l*y,Pe=s*S-f*y,Be=l*S-f*v,qe=M*N-E*F,Ne=M*Z-D*F,Ze=M*Y-L*F,it=E*Z-D*N,Ue=E*Y-L*N,Ge=D*Y-L*Z,Ae=me*Ge-ne*Ue+oe*it+be*Ze-Pe*Ne+Be*qe;return Ae?(i[0]=(y*Ge-v*Ue+S*it)*(Ae=1/Ae),i[1]=(l*Ue-s*Ge-f*it)*Ae,i[2]=(N*Be-Z*Pe+Y*be)*Ae,i[3]=(D*Pe-E*Be-L*be)*Ae,i[4]=(v*Ze-m*Ge-S*Ne)*Ae,i[5]=(r*Ge-l*Ze+f*Ne)*Ae,i[6]=(Z*oe-F*Be-Y*ne)*Ae,i[7]=(M*Be-D*oe+L*ne)*Ae,i[8]=(m*Ue-y*Ze+S*qe)*Ae,i[9]=(s*Ze-r*Ue-f*qe)*Ae,i[10]=(F*Pe-N*oe+Y*me)*Ae,i[11]=(E*oe-M*Pe-L*me)*Ae,i[12]=(y*Ne-m*it-v*qe)*Ae,i[13]=(r*it-s*Ne+l*qe)*Ae,i[14]=(N*ne-F*be-Z*me)*Ae,i[15]=(M*be-E*ne+D*me)*Ae,i):null},T.ar=Mt,T.as=function(i){return Math.hypot(i[0],i[1])},T.at=function(i){return i[0]=0,i[1]=0,i},T.au=function(i,t,r){return i[0]=t[0]*r,i[1]=t[1]*r,i},T.av=Up,T.aw=At,T.ax=function(i,t,r,s){const l=t.y-i.y,f=t.x-i.x,m=s.y-r.y,y=s.x-r.x,v=m*f-y*l;if(v===0)return null;const S=(y*(i.y-r.y)-m*(i.x-r.x))/v;return new B(i.x+S*f,i.y+S*l)},T.ay=Pg,T.az=fm,T.b=Ar,T.b$=class extends h{},T.b0=function(i,t,r){return i[0]=t[0]*r,i[1]=t[1]*r,i[2]=t[2]*r,i[3]=t[3]*r,i},T.b1=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]},T.b2=xg,T.b3=Ol,T.b4=function(i,t,r,s,l){var f,m=1/Math.tan(t/2);return i[0]=m/r,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=m,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,l!=null&&l!==1/0?(i[10]=(l+s)*(f=1/(s-l)),i[14]=2*l*s*f):(i[10]=-1,i[14]=-2*s),i},T.b5=function(i){var t=new Ee(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},T.b6=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),f=t[0],m=t[1],y=t[2],v=t[3],S=t[4],M=t[5],E=t[6],D=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*l+S*s,i[1]=m*l+M*s,i[2]=y*l+E*s,i[3]=v*l+D*s,i[4]=S*l-f*s,i[5]=M*l-m*s,i[6]=E*l-y*s,i[7]=D*l-v*s,i},T.b7=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),f=t[4],m=t[5],y=t[6],v=t[7],S=t[8],M=t[9],E=t[10],D=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=f*l+S*s,i[5]=m*l+M*s,i[6]=y*l+E*s,i[7]=v*l+D*s,i[8]=S*l-f*s,i[9]=M*l-m*s,i[10]=E*l-y*s,i[11]=D*l-v*s,i},T.b8=function(){const i=new Float32Array(16);return $e(i),i},T.b9=function(){const i=new Float64Array(16);return $e(i),i},T.bA=function(i,t){const r=Nt(i,360),s=Nt(t,360),l=s-r,f=s>r?l-360:l+360;return Math.abs(l)<Math.abs(f)?l:f},T.bB=function(i){return i[0]=0,i[1]=0,i[2]=0,i},T.bC=function(i,t,r,s){const l=Math.sqrt(i*i+t*t),f=Math.sqrt(r*r+s*s);i/=l,t/=l,r/=f,s/=f;const m=Math.acos(i*r+t*s);return-t*r+i*s>0?m:-m},T.bD=function(i,t){const r=Nt(i,2*Math.PI),s=Nt(t,2*Math.PI);return Math.min(Math.abs(r-s),Math.abs(r-s+2*Math.PI),Math.abs(r-s-2*Math.PI))},T.bE=function(){const i={},t=_e.$version;for(const r in _e.$root){const s=_e.$root[r];if(s.required){let l=null;l=r==="version"?t:s.type==="array"?[]:{},l!=null&&(i[r]=l)}}return i},T.bF=vl,T.bG=U,T.bH=function i(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!i(t[s],r[s]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(const s in t)if(!i(t[s],r[s]))return!1;return!0}return t===r},T.bI=function(i){i=i.slice();const t=Object.create(null);for(let r=0;r<i.length;r++)t[i[r].id]=i[r];for(let r=0;r<i.length;r++)"ref"in i[r]&&(i[r]=bt(i[r],t[i[r].ref]));return i},T.bJ=function(i){if(i.type==="custom")return new t0(i);switch(i.type){case"background":return new Jx(i);case"circle":return new Fv(i);case"color-relief":return new $v(i);case"fill":return new nx(i);case"fill-extrusion":return new mx(i);case"heatmap":return new jv(i);case"hillshade":return new Vv(i);case"line":return new wx(i);case"raster":return new e0(i);case"symbol":return new sd(i)}},T.bK=Rt,T.bL=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let r=[];try{if(!Qe(i.version,t.version))return[{command:"setStyle",args:[t]}];Qe(i.center,t.center)||r.push({command:"setCenter",args:[t.center]}),Qe(i.state,t.state)||r.push({command:"setGlobalState",args:[t.state]}),Qe(i.centerAltitude,t.centerAltitude)||r.push({command:"setCenterAltitude",args:[t.centerAltitude]}),Qe(i.zoom,t.zoom)||r.push({command:"setZoom",args:[t.zoom]}),Qe(i.bearing,t.bearing)||r.push({command:"setBearing",args:[t.bearing]}),Qe(i.pitch,t.pitch)||r.push({command:"setPitch",args:[t.pitch]}),Qe(i.roll,t.roll)||r.push({command:"setRoll",args:[t.roll]}),Qe(i.sprite,t.sprite)||r.push({command:"setSprite",args:[t.sprite]}),Qe(i.glyphs,t.glyphs)||r.push({command:"setGlyphs",args:[t.glyphs]}),Qe(i.transition,t.transition)||r.push({command:"setTransition",args:[t.transition]}),Qe(i.light,t.light)||r.push({command:"setLight",args:[t.light]}),Qe(i.terrain,t.terrain)||r.push({command:"setTerrain",args:[t.terrain]}),Qe(i.sky,t.sky)||r.push({command:"setSky",args:[t.sky]}),Qe(i.projection,t.projection)||r.push({command:"setProjection",args:[t.projection]});const s={},l=[];(function(m,y,v,S){let M;for(M in y=y||{},m=m||{})Object.prototype.hasOwnProperty.call(m,M)&&(Object.prototype.hasOwnProperty.call(y,M)||kr(M,v,S));for(M in y)Object.prototype.hasOwnProperty.call(y,M)&&(Object.prototype.hasOwnProperty.call(m,M)?Qe(m[M],y[M])||(m[M].type==="geojson"&&y[M].type==="geojson"&&Ur(m,y,M)?dt(v,{command:"setGeoJSONSourceData",args:[M,y[M].data]}):Pr(M,y,v,S)):tr(M,y,v))})(i.sources,t.sources,l,s);const f=[];i.layers&&i.layers.forEach((m=>{"source"in m&&s[m.source]?r.push({command:"removeLayer",args:[m.id]}):f.push(m)})),r=r.concat(l),(function(m,y,v){y=y||[];const S=(m=m||[]).map(Ut),M=y.map(Ut),E=m.reduce(qr,{}),D=y.reduce(qr,{}),L=S.slice(),F=Object.create(null);let N,Z,Y,me,ne;for(let oe=0,be=0;oe<S.length;oe++)N=S[oe],Object.prototype.hasOwnProperty.call(D,N)?be++:(dt(v,{command:"removeLayer",args:[N]}),L.splice(L.indexOf(N,be),1));for(let oe=0,be=0;oe<M.length;oe++)N=M[M.length-1-oe],L[L.length-1-oe]!==N&&(Object.prototype.hasOwnProperty.call(E,N)?(dt(v,{command:"removeLayer",args:[N]}),L.splice(L.lastIndexOf(N,L.length-be),1)):be++,me=L[L.length-oe],dt(v,{command:"addLayer",args:[D[N],me]}),L.splice(L.length-oe,0,N),F[N]=!0);for(let oe=0;oe<M.length;oe++)if(N=M[oe],Z=E[N],Y=D[N],!F[N]&&!Qe(Z,Y))if(Qe(Z.source,Y.source)&&Qe(Z["source-layer"],Y["source-layer"])&&Qe(Z.type,Y.type)){for(ne in zt(Z.layout,Y.layout,v,N,null,"setLayoutProperty"),zt(Z.paint,Y.paint,v,N,null,"setPaintProperty"),Qe(Z.filter,Y.filter)||dt(v,{command:"setFilter",args:[N,Y.filter]}),Qe(Z.minzoom,Y.minzoom)&&Qe(Z.maxzoom,Y.maxzoom)||dt(v,{command:"setLayerZoomRange",args:[N,Y.minzoom,Y.maxzoom]}),Z)Object.prototype.hasOwnProperty.call(Z,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?zt(Z[ne],Y[ne],v,N,ne.slice(6),"setPaintProperty"):Qe(Z[ne],Y[ne])||dt(v,{command:"setLayerProperty",args:[N,ne,Y[ne]]}));for(ne in Y)Object.prototype.hasOwnProperty.call(Y,ne)&&!Object.prototype.hasOwnProperty.call(Z,ne)&&ne!=="layout"&&ne!=="paint"&&ne!=="filter"&&ne!=="metadata"&&ne!=="minzoom"&&ne!=="maxzoom"&&(ne.indexOf("paint.")===0?zt(Z[ne],Y[ne],v,N,ne.slice(6),"setPaintProperty"):Qe(Z[ne],Y[ne])||dt(v,{command:"setLayerProperty",args:[N,ne,Y[ne]]}))}else dt(v,{command:"removeLayer",args:[N]}),me=L[L.lastIndexOf(N)+1],dt(v,{command:"addLayer",args:[Y,me]})})(f,t.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[t]}]}return r},T.bM=function(i){const t=[],r=i.id;return r===void 0&&t.push({message:`layers.${r}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${r}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),t},T.bN=Ft,T.bO=Ot,T.bP=class extends Ai{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},T.bQ=ri,T.bR=class extends Ai{constructor(i,t){super(i,t),this.current=en}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},T.bS=Xr,T.bT=class extends Ai{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},T.bU=class extends Ai{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},T.bV=ae,T.bW=function(i,t){var r=Math.sin(t),s=Math.cos(t);return i[0]=s,i[1]=r,i[2]=0,i[3]=-r,i[4]=s,i[5]=0,i[6]=0,i[7]=0,i[8]=1,i},T.bX=function(i,t,r){var s=t[0],l=t[1],f=t[2];return i[0]=s*r[0]+l*r[3]+f*r[6],i[1]=s*r[1]+l*r[4]+f*r[7],i[2]=s*r[2]+l*r[5]+f*r[8],i},T.bY=function(i,t,r,s,l,f,m){var y=1/(t-r),v=1/(s-l),S=1/(f-m);return i[0]=-2*y,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*v,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*S,i[11]=0,i[12]=(t+r)*y,i[13]=(l+s)*v,i[14]=(m+f)*S,i[15]=1,i},T.bZ=class extends Ai{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;const t=new Float32Array(4*i.length);for(let r=0;r<i.length;r++)t[4*r]=i[r].r,t[4*r+1]=i[r].g,t[4*r+2]=i[r].b,t[4*r+3]=i[r].a;this.gl.uniform4fv(this.location,t)}}},T.b_=class extends Ai{constructor(i,t){super(i,t),this.current=new Array}set(i){if(i!=this.current){this.current=i;const t=new Float32Array(i);this.gl.uniform1fv(this.location,t)}}},T.ba=function(){return new Float64Array(16)},T.bb=function(i,t,r){const s=new Float64Array(4);return jt(s,i,t-90,r),s},T.bc=function(i,t,r,s){var l,f,m,y,v,S=t[0],M=t[1],E=t[2],D=t[3],L=r[0],F=r[1],N=r[2],Z=r[3];return(f=S*L+M*F+E*N+D*Z)<0&&(f=-f,L=-L,F=-F,N=-N,Z=-Z),1-f>Ce?(l=Math.acos(f),m=Math.sin(l),y=Math.sin((1-s)*l)/m,v=Math.sin(s*l)/m):(y=1-s,v=s),i[0]=y*S+v*L,i[1]=y*M+v*F,i[2]=y*E+v*N,i[3]=y*D+v*Z,i},T.bd=function(i){const t=new Float64Array(9);var r,s,l,f,m,y,v,S,M,E,D,L,F,N,Z,Y,me,ne;E=(l=(s=i)[0])*(v=l+l),D=(f=s[1])*v,F=(m=s[2])*v,N=m*(S=f+f),Y=(y=s[3])*v,me=y*S,ne=y*(M=m+m),(r=t)[0]=1-(L=f*S)-(Z=m*M),r[3]=D-ne,r[6]=F+me,r[1]=D+ne,r[4]=1-E-Z,r[7]=N-Y,r[2]=F-me,r[5]=N+Y,r[8]=1-E-L;const oe=Qr(-Math.asin(Qt(t[2],-1,1)));let be,Pe;return Math.hypot(t[5],t[8])<.001?(be=0,Pe=-Qr(Math.atan2(t[3],t[4]))):(be=Qr(t[5]===0&&t[8]===0?0:Math.atan2(t[5],t[8])),Pe=Qr(t[1]===0&&t[0]===0?0:Math.atan2(t[1],t[0]))),{roll:be,pitch:oe+90,bearing:Pe}},T.be=function(i,t){return i.roll==t.roll&&i.pitch==t.pitch&&i.bearing==t.bearing},T.bf=Et,T.bg=ys,T.bh=Dl,T.bi=mu,T.bj=zl,T.bk=qt,T.bl=Kt,T.bm=bi,T.bn=function(i,t,r,s,l){return qt(s,l,Qt((i-t)/(r-t),0,1))},T.bo=Nt,T.bp=function(){return new Float64Array(3)},T.bq=function(i,t,r,s){return i[0]=t[0]+r[0]*s,i[1]=t[1]+r[1]*s,i[2]=t[2]+r[2]*s,i},T.br=jt,T.bs=function(i,t,r){var s=r[0],l=r[1],f=r[2],m=t[0],y=t[1],v=t[2],S=l*v-f*y,M=f*m-s*v,E=s*y-l*m,D=l*E-f*M,L=f*S-s*E,F=s*M-l*S,N=2*r[3];return M*=N,E*=N,L*=2,F*=2,i[0]=m+(S*=N)+(D*=2),i[1]=y+M+L,i[2]=v+E+F,i},T.bt=function(i,t,r){const s=(l=[i[0],i[1],i[2],t[0],t[1],t[2],r[0],r[1],r[2]])[0]*((M=l[8])*(m=l[4])-(y=l[5])*(S=l[7]))+l[1]*(-M*(f=l[3])+y*(v=l[6]))+l[2]*(S*f-m*v);var l,f,m,y,v,S,M;if(s===0)return null;const E=rt([],[t[0],t[1],t[2]],[r[0],r[1],r[2]]),D=rt([],[r[0],r[1],r[2]],[i[0],i[1],i[2]]),L=rt([],[i[0],i[1],i[2]],[t[0],t[1],t[2]]),F=at([],E,-i[3]);return gt(F,F,at([],D,-t[3])),gt(F,F,at([],L,-r[3])),at(F,F,1/s),F},T.bu=qp,T.bv=function(){return new Float64Array(4)},T.bw=function(i,t,r,s){var l=[],f=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],f[0]=l[0]*Math.cos(s)-l[1]*Math.sin(s),f[1]=l[0]*Math.sin(s)+l[1]*Math.cos(s),f[2]=l[2],i[0]=f[0]+r[0],i[1]=f[1]+r[1],i[2]=f[2]+r[2],i},T.bx=function(i,t,r,s){var l=[],f=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],f[0]=l[0],f[1]=l[1]*Math.cos(s)-l[2]*Math.sin(s),f[2]=l[1]*Math.sin(s)+l[2]*Math.cos(s),i[0]=f[0]+r[0],i[1]=f[1]+r[1],i[2]=f[2]+r[2],i},T.by=function(i,t,r,s){var l=[],f=[];return l[0]=t[0]-r[0],l[1]=t[1]-r[1],l[2]=t[2]-r[2],f[0]=l[2]*Math.sin(s)+l[0]*Math.cos(s),f[1]=l[1],f[2]=l[2]*Math.cos(s)-l[0]*Math.sin(s),i[0]=f[0]+r[0],i[1]=f[1]+r[1],i[2]=f[2]+r[2],i},T.bz=function(i,t,r){var s=Math.sin(r),l=Math.cos(r),f=t[0],m=t[1],y=t[2],v=t[3],S=t[8],M=t[9],E=t[10],D=t[11];return t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=f*l-S*s,i[1]=m*l-M*s,i[2]=y*l-E*s,i[3]=v*l-D*s,i[8]=f*s+S*l,i[9]=m*s+M*l,i[10]=y*s+E*l,i[11]=v*s+D*l,i},T.c=fe,T.c0=Mx,T.c1=class extends n{},T.c2=Mp,T.c3=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},T.c4=Sm,T.c5=function(i,t,r){var s=t[0],l=t[1],f=t[2],m=r[3]*s+r[7]*l+r[11]*f+r[15];return i[0]=(r[0]*s+r[4]*l+r[8]*f+r[12])/(m=m||1),i[1]=(r[1]*s+r[5]*l+r[9]*f+r[13])/m,i[2]=(r[2]*s+r[6]*l+r[10]*f+r[14])/m,i},T.c6=class extends nu{},T.c7=class extends P{},T.c8=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},T.c9=function(i,t){var r=i[0],s=i[1],l=i[2],f=i[3],m=i[4],y=i[5],v=i[6],S=i[7],M=i[8],E=i[9],D=i[10],L=i[11],F=i[12],N=i[13],Z=i[14],Y=i[15],me=t[0],ne=t[1],oe=t[2],be=t[3],Pe=t[4],Be=t[5],qe=t[6],Ne=t[7],Ze=t[8],it=t[9],Ue=t[10],Ge=t[11],Ae=t[12],ut=t[13],ft=t[14],st=t[15];return Math.abs(r-me)<=Ce*Math.max(1,Math.abs(r),Math.abs(me))&&Math.abs(s-ne)<=Ce*Math.max(1,Math.abs(s),Math.abs(ne))&&Math.abs(l-oe)<=Ce*Math.max(1,Math.abs(l),Math.abs(oe))&&Math.abs(f-be)<=Ce*Math.max(1,Math.abs(f),Math.abs(be))&&Math.abs(m-Pe)<=Ce*Math.max(1,Math.abs(m),Math.abs(Pe))&&Math.abs(y-Be)<=Ce*Math.max(1,Math.abs(y),Math.abs(Be))&&Math.abs(v-qe)<=Ce*Math.max(1,Math.abs(v),Math.abs(qe))&&Math.abs(S-Ne)<=Ce*Math.max(1,Math.abs(S),Math.abs(Ne))&&Math.abs(M-Ze)<=Ce*Math.max(1,Math.abs(M),Math.abs(Ze))&&Math.abs(E-it)<=Ce*Math.max(1,Math.abs(E),Math.abs(it))&&Math.abs(D-Ue)<=Ce*Math.max(1,Math.abs(D),Math.abs(Ue))&&Math.abs(L-Ge)<=Ce*Math.max(1,Math.abs(L),Math.abs(Ge))&&Math.abs(F-Ae)<=Ce*Math.max(1,Math.abs(F),Math.abs(Ae))&&Math.abs(N-ut)<=Ce*Math.max(1,Math.abs(N),Math.abs(ut))&&Math.abs(Z-ft)<=Ce*Math.max(1,Math.abs(Z),Math.abs(ft))&&Math.abs(Y-st)<=Ce*Math.max(1,Math.abs(Y),Math.abs(st))},T.cA=function(i,t){j.REGISTERED_PROTOCOLS[i]=t},T.cB=function(i){delete j.REGISTERED_PROTOCOLS[i]},T.cC=function(i,t){const r={};for(let l=0;l<i.length;l++){const f=t&&t[i[l].id]||fp(i[l]);t&&(t[i[l].id]=f);let m=r[f];m||(m=r[f]=[]),m.push(i[l])}const s=[];for(const l in r)s.push(r[l]);return s},T.cD=He,T.cE=bg,T.cF=Tg,T.cG=Qm,T.cH=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=ht/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],r=t.layout,s=t._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new wr(i.bucket.zoom+1),i.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new wr(i.bucket.zoom+1),i.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new wr(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:S,maxZoom:M}=i.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new wr(S),i.canonical),s["text-size"].possiblyEvaluate(new wr(M),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:S,maxZoom:M}=i.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new wr(S),i.canonical),s["icon-size"].possiblyEvaluate(new wr(M),i.canonical)]}const f=r.get("text-line-height")*ci,m=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",y=r.get("text-keep-upright"),v=r.get("text-size");for(const S of i.bucket.features){const M=r.get("text-font").evaluate(S,{},i.canonical).join(","),E=v.evaluate(S,{},i.canonical),D=l.layoutTextSize.evaluate(S,{},i.canonical),L=l.layoutIconSize.evaluate(S,{},i.canonical),F={horizontal:{},vertical:void 0},N=S.text;let Z,Y=[0,0];if(N){const oe=N.toString(),be=r.get("text-letter-spacing").evaluate(S,{},i.canonical)*ci,Pe=yp(oe)?be:0,Be=r.get("text-anchor").evaluate(S,{},i.canonical),qe=Rg(t,S,i.canonical);if(!qe){const Ue=r.get("text-radial-offset").evaluate(S,{},i.canonical);Y=Ue?Dg(Be,[Ue*ci,Xp]):r.get("text-offset").evaluate(S,{},i.canonical).map((Ge=>Ge*ci))}let Ne=m?"center":r.get("text-justify").evaluate(S,{},i.canonical);const Ze=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(S,{},i.canonical)*ci:1/0,it=()=>{i.bucket.allowVerticalPlacement&&xl(oe)&&(F.vertical=rd(N,i.glyphMap,i.glyphPositions,i.imagePositions,M,Ze,f,Be,"left",Pe,Y,T.ao.vertical,!0,D,E))};if(!m&&qe){const Ue=new Set;if(Ne==="auto")for(let Ae=0;Ae<qe.values.length;Ae+=2)Ue.add(Kp(qe.values[Ae]));else Ue.add(Ne);let Ge=!1;for(const Ae of Ue)if(!F.horizontal[Ae])if(Ge)F.horizontal[Ae]=F.horizontal[0];else{const ut=rd(N,i.glyphMap,i.glyphPositions,i.imagePositions,M,Ze,f,"center",Ae,Pe,Y,T.ao.horizontal,!1,D,E);ut&&(F.horizontal[Ae]=ut,Ge=ut.positionedLines.length===1)}it()}else{Ne==="auto"&&(Ne=Kp(Be));const Ue=rd(N,i.glyphMap,i.glyphPositions,i.imagePositions,M,Ze,f,Be,Ne,Pe,Y,T.ao.horizontal,!1,D,E);Ue&&(F.horizontal[Ne]=Ue),it(),xl(oe)&&m&&y&&(F.vertical=rd(N,i.glyphMap,i.glyphPositions,i.imagePositions,M,Ze,f,Be,Ne,Pe,Y,T.ao.vertical,!1,D,E))}}let me=!1;if(S.icon&&S.icon.name){const oe=i.imageMap[S.icon.name];oe&&(Z=Hx(i.imagePositions[S.icon.name],r.get("icon-offset").evaluate(S,{},i.canonical),r.get("icon-anchor").evaluate(S,{},i.canonical)),me=!!oe.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=me:i.bucket.sdfIcons!==me&&Gt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==i.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const ne=Bg(F.horizontal)||F.vertical;i.bucket.iconsInText=!!ne&&ne.iconsInText,(ne||Z)&&u0(i.bucket,S,F,Z,i.imageMap,l,D,L,Y,me,i.canonical,i.subdivisionGranularity)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},T.cI=Lp,T.cJ=zp,T.cK=Rp,T.cL=jm,T.cM=Fp,T.cN=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},T.cO=function(i,t,r,s,l){return o(this,void 0,void 0,(function*(){if(ke())try{return yield Sr(i,t,r,s,l)}catch{}return(function(f,m,y,v,S){const M=f.width,E=f.height;br&&gr||(br=new OffscreenCanvas(M,E),gr=br.getContext("2d",{willReadFrequently:!0})),br.width=M,br.height=E,gr.drawImage(f,0,0,M,E);const D=gr.getImageData(m,y,v,S);return gr.clearRect(0,0,M,E),D.data})(i,t,r,s,l)}))},T.cP=Cm,T.cQ=K,T.cR=Om,T.cS=Rl,T.cT=ho,T.cU=function(i,t){const r=new Map;if(i!=null)if(i.type==="Feature")r.set(wu(i,t),i);else for(const s of i.features)r.set(wu(s,t),s);return r},T.cV=function(i,t){if(i==null)return!0;if(i.type==="Feature")return wu(i,t)!=null;if(i.type==="FeatureCollection"){const r=new Set;for(const s of i.features){const l=wu(s,t);if(l==null||r.has(l))return!1;r.add(l)}return!0}return!1},T.cW=function(i,t,r){var s,l,f,m;if(t.removeAll&&i.clear(),t.remove)for(const y of t.remove)i.delete(y);if(t.add)for(const y of t.add){const v=wu(y,r);v!=null&&i.set(v,y)}if(t.update)for(const y of t.update){let v=i.get(y.id);if(v==null)continue;const S=!y.removeAllProperties&&(((s=y.removeProperties)===null||s===void 0?void 0:s.length)>0||((l=y.addOrUpdateProperties)===null||l===void 0?void 0:l.length)>0);if((y.newGeometry||y.removeAllProperties||S)&&(v=Object.assign({},v),i.set(y.id,v),S&&(v.properties=Object.assign({},v.properties))),y.newGeometry&&(v.geometry=y.newGeometry),y.removeAllProperties)v.properties={};else if(((f=y.removeProperties)===null||f===void 0?void 0:f.length)>0)for(const M of y.removeProperties)Object.prototype.hasOwnProperty.call(v.properties,M)&&delete v.properties[M];if(((m=y.addOrUpdateProperties)===null||m===void 0?void 0:m.length)>0)for(const{key:M,value:E}of y.addOrUpdateProperties)v.properties[M]=E}},T.cX=fn,T.ca=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},T.cb=i=>i.type==="symbol",T.cc=i=>i.type==="circle",T.cd=i=>i.type==="heatmap",T.ce=i=>i.type==="line",T.cf=i=>i.type==="fill",T.cg=i=>i.type==="fill-extrusion",T.ch=i=>i.type==="hillshade",T.ci=i=>i.type==="color-relief",T.cj=i=>i.type==="raster",T.ck=i=>i.type==="background",T.cl=i=>i.type==="custom",T.cm=Jt,T.cn=function(i,t,r){const s=pt(t.x-r.x,t.y-r.y),l=pt(i.x-r.x,i.y-r.y);var f,m;return Qr(Math.atan2(s[0]*l[1]-s[1]*l[0],(f=s)[0]*(m=l)[0]+f[1]*m[1]))},T.co=vr,T.cp=function(i,t){return Ui[t]&&(i instanceof MouseEvent||i instanceof WheelEvent)},T.cq=function(i,t){return ei[t]&&"touches"in i},T.cr=function(i){return ei[i]||Ui[i]},T.cs=function(i,t,r){var s=t[0],l=t[1];return i[0]=r[0]*s+r[4]*l+r[12],i[1]=r[1]*s+r[5]*l+r[13],i},T.ct=function(i,t){const{x:r,y:s}=bu.fromLngLat(t);return!(i<0||i>25||s<0||s>=1||r<0||r>=1)},T.cu=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},T.cv=class extends Ca{},T.cw=d0,T.cy=function(i){return i.message===an},T.cz=te,T.d=pe,T.e=Vt,T.f=i=>o(void 0,void 0,void 0,(function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),T.g=V,T.h=i=>new Promise(((t,r)=>{const s=new Image;s.onload=()=>{t(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame((()=>{s.src=pr}))},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(i)],{type:"image/png"});s.src=i.byteLength?URL.createObjectURL(l):pr})),T.i=Gr,T.j=(i,t)=>re(Vt(i,{type:"json"}),t),T.k=Ie,T.l=ze,T.m=re,T.n=(i,t)=>re(Vt(i,{type:"arrayBuffer"}),t),T.o=function(i){return new Fp(i).readFields(Fx,[])},T.p=Jm,T.q=uu,T.r=Ii,T.s=Br,T.t=Gh,T.u=Lt,T.v=_e,T.w=Gt,T.x=mp,T.y=vo,T.z=Ta})),C("worker",["./shared"],(function(T){class o{constructor(j){this.keyCache={},j&&this.replace(j)}replace(j){this._layerConfigs={},this._layers={},this.update(j,[])}update(j,V){for(const te of j){this._layerConfigs[te.id]=te;const U=this._layers[te.id]=T.bJ(te);U._featureFilter=T.aa(U.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(const te of V)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const $=T.cC(Object.values(this._layerConfigs),this.keyCache);for(const te of $){const U=te.map((Ie=>this._layers[Ie.id])),re=U[0];if(re.visibility==="none")continue;const pe=re.source||"";let le=this.familiesBySource[pe];le||(le=this.familiesBySource[pe]={});const ye=re.sourceLayer||"_geojsonTileLayer";let ze=le[ye];ze||(ze=le[ye]=[]),ze.push(U)}}}class B{constructor(j){const V={},$=[];for(const pe in j){const le=j[pe],ye=V[pe]={};for(const ze in le){const Ie=le[+ze];if(!Ie||Ie.bitmap.width===0||Ie.bitmap.height===0)continue;const Ke={x:0,y:0,w:Ie.bitmap.width+2,h:Ie.bitmap.height+2};$.push(Ke),ye[ze]={rect:Ke,metrics:Ie.metrics}}}const{w:te,h:U}=T.p($),re=new T.q({width:te||1,height:U||1});for(const pe in j){const le=j[pe];for(const ye in le){const ze=le[+ye];if(!ze||ze.bitmap.width===0||ze.bitmap.height===0)continue;const Ie=V[pe][ye].rect;T.q.copy(ze.bitmap,re,{x:0,y:0},{x:Ie.x+1,y:Ie.y+1},ze.bitmap)}}this.image=re,this.positions=V}}T.cD("GlyphAtlas",B);class K{constructor(j){this.tileID=new T.Z(j.tileID.overscaledZ,j.tileID.wrap,j.tileID.canonical.z,j.tileID.canonical.x,j.tileID.canonical.y),this.uid=j.uid,this.zoom=j.zoom,this.pixelRatio=j.pixelRatio,this.tileSize=j.tileSize,this.source=j.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=j.showCollisionBoxes,this.collectResourceTiming=!!j.collectResourceTiming,this.returnDependencies=!!j.returnDependencies,this.promoteId=j.promoteId,this.inFlightDependencies=[],this.globalState=j.globalState}parse(j,V,$,te,U){return T._(this,void 0,void 0,(function*(){this.status="parsing",this.data=j,this.collisionBoxArray=new T.a8;const re=new T.cE(Object.keys(j.layers).sort()),pe=new T.cF(this.tileID,this.promoteId);pe.bucketLayerIDs=[];const le={},ye={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$,subdivisionGranularity:U},ze=V.familiesBySource[this.source];for(const zt in ze){const Ut=j.layers[zt];if(!Ut)continue;Ut.version===1&&T.w(`Vector tile source "${this.source}" layer "${zt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const qr=re.encode(zt),je=[];for(let xi=0;xi<Ut.length;xi++){const zr=Ut.feature(xi),os=pe.getId(zr,zt);je.push({feature:zr,id:os,index:xi,sourceLayerIndex:qr})}for(const xi of ze[zt]){const zr=xi[0];zr.source!==this.source&&T.w(`layer.source = ${zr.source} does not equal this.source = ${this.source}`),zr.minzoom&&this.zoom<Math.floor(zr.minzoom)||zr.maxzoom&&this.zoom>=zr.maxzoom||zr.visibility!=="none"&&(X(xi,this.zoom,$),(le[zr.id]=zr.createBucket({index:pe.bucketLayerIDs.length,layers:xi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:qr,sourceID:this.source,globalState:this.globalState})).populate(je,ye,this.tileID.canonical),pe.bucketLayerIDs.push(xi.map((os=>os.id))))}}const Ie=T.bN(ye.glyphDependencies,(zt=>Object.keys(zt).map(Number)));this.inFlightDependencies.forEach((zt=>zt?.abort())),this.inFlightDependencies=[];let Ke=Promise.resolve({});if(Object.keys(Ie).length){const zt=new AbortController;this.inFlightDependencies.push(zt),Ke=te.sendAsync({type:"GG",data:{stacks:Ie,source:this.source,tileID:this.tileID,type:"glyphs"}},zt)}const _e=Object.keys(ye.iconDependencies);let ot=Promise.resolve({});if(_e.length){const zt=new AbortController;this.inFlightDependencies.push(zt),ot=te.sendAsync({type:"GI",data:{icons:_e,source:this.source,tileID:this.tileID,type:"icons"}},zt)}const bt=Object.keys(ye.patternDependencies);let Qe=Promise.resolve({});if(bt.length){const zt=new AbortController;this.inFlightDependencies.push(zt),Qe=te.sendAsync({type:"GI",data:{icons:bt,source:this.source,tileID:this.tileID,type:"patterns"}},zt)}const[dt,tr,kr]=yield Promise.all([Ke,ot,Qe]),Pr=new B(dt),Ur=new T.cG(tr,kr);for(const zt in le){const Ut=le[zt];Ut instanceof T.a9?(X(Ut.layers,this.zoom,$),T.cH({bucket:Ut,glyphMap:dt,glyphPositions:Pr.positions,imageMap:tr,imagePositions:Ur.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ye.subdivisionGranularity})):Ut.hasPattern&&(Ut instanceof T.cI||Ut instanceof T.cJ||Ut instanceof T.cK)&&(X(Ut.layers,this.zoom,$),Ut.addFeatures(ye,this.tileID.canonical,Ur.patternPositions))}return this.status="done",{buckets:Object.values(le).filter((zt=>!zt.isEmpty())),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Pr.image,imageAtlas:Ur,glyphMap:this.returnDependencies?dt:null,iconMap:this.returnDependencies?tr:null,glyphPositions:this.returnDependencies?Pr.positions:null}}))}}function X(fe,j,V){const $=new T.F(j);for(const te of fe)te.recalculate($,V)}class ce{constructor(j,V,$){this.actor=j,this.layerIndex=V,this.availableImages=$,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(j,V){return T._(this,void 0,void 0,(function*(){const $=yield T.n(j.request,V);try{return{vectorTile:new T.cL(new T.cM($.data)),rawData:$.data,cacheControl:$.cacheControl,expires:$.expires}}catch(te){const U=new Uint8Array($.data);let re=`Unable to parse the tile at ${j.request.url}, `;throw re+=U[0]===31&&U[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.message}`,new Error(re)}}))}loadTile(j){return T._(this,void 0,void 0,(function*(){const V=j.uid,$=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.cN(j.request),te=new K(j);this.loading[V]=te;const U=new AbortController;te.abort=U;try{const re=yield this.loadVectorTile(j,U);if(delete this.loading[V],!re)return null;const pe=re.rawData,le={};re.expires&&(le.expires=re.expires),re.cacheControl&&(le.cacheControl=re.cacheControl);const ye={};if($){const Ie=$.finish();Ie&&(ye.resourceTiming=JSON.parse(JSON.stringify(Ie)))}te.vectorTile=re.vectorTile;const ze=te.parse(re.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);this.loaded[V]=te,this.fetching[V]={rawTileData:pe,cacheControl:le,resourceTiming:ye};try{const Ie=yield ze;return T.e({rawTileData:pe.slice(0)},Ie,le,ye)}finally{delete this.fetching[V]}}catch(re){throw delete this.loading[V],te.status="done",this.loaded[V]=te,re}}))}reloadTile(j){return T._(this,void 0,void 0,(function*(){const V=j.uid;if(!this.loaded||!this.loaded[V])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const $=this.loaded[V];if($.showCollisionBoxes=j.showCollisionBoxes,$.globalState=j.globalState,$.status==="parsing"){const te=yield $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity);let U;if(this.fetching[V]){const{rawTileData:re,cacheControl:pe,resourceTiming:le}=this.fetching[V];delete this.fetching[V],U=T.e({rawTileData:re.slice(0)},te,pe,le)}else U=te;return U}if($.status==="done"&&$.vectorTile)return $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor,j.subdivisionGranularity)}))}abortTile(j){return T._(this,void 0,void 0,(function*(){const V=this.loading,$=j.uid;V&&V[$]&&V[$].abort&&(V[$].abort.abort(),delete V[$])}))}removeTile(j){return T._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[j.uid]&&delete this.loaded[j.uid]}))}}class he{constructor(){this.loaded={}}loadTile(j){return T._(this,void 0,void 0,(function*(){const{uid:V,encoding:$,rawImageData:te,redFactor:U,greenFactor:re,blueFactor:pe,baseShift:le}=j,ye=te.width+2,ze=te.height+2,Ie=T.b(te)?new T.R({width:ye,height:ze},yield T.cO(te,-1,-1,ye,ze)):te,Ke=new T.cP(V,Ie,$,U,re,pe,le);return this.loaded=this.loaded||{},this.loaded[V]=Ke,Ke}))}removeTile(j){const V=this.loaded,$=j.uid;V&&V[$]&&delete V[$]}}var q,de,Se=(function(){if(de)return q;function fe(V,$){if(V.length!==0){j(V[0],$);for(var te=1;te<V.length;te++)j(V[te],!$)}}function j(V,$){for(var te=0,U=0,re=0,pe=V.length,le=pe-1;re<pe;le=re++){var ye=(V[re][0]-V[le][0])*(V[le][1]+V[re][1]),ze=te+ye;U+=Math.abs(te)>=Math.abs(ye)?te-ze+ye:ye-ze+te,te=ze}te+U>=0!=!!$&&V.reverse()}return de=1,q=function V($,te){var U,re=$&&$.type;if(re==="FeatureCollection")for(U=0;U<$.features.length;U++)V($.features[U],te);else if(re==="GeometryCollection")for(U=0;U<$.geometries.length;U++)V($.geometries[U],te);else if(re==="Feature")V($.geometry,te);else if(re==="Polygon")fe($.coordinates,te);else if(re==="MultiPolygon")for(U=0;U<$.coordinates.length;U++)fe($.coordinates[U],te);return $}})(),Me=T.cQ(Se);class ke extends T.cS{constructor(j,V){super(new T.cM,0,V,[],[]),this.feature=j,this.type=j.type,this.properties=j.tags?j.tags:{},"id"in j&&(typeof j.id=="string"?this.id=parseInt(j.id,10):typeof j.id!="number"||isNaN(j.id)||(this.id=j.id))}loadGeometry(){const j=[],V=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const $ of V){const te=[];for(const U of $)te.push(new T.P(U[0],U[1]));j.push(te)}return j}}class Ce extends T.cR{constructor(j,V){super(new T.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=V?V.version:1,this.extent=V?V.extent:4096,this.length=j.length,this.features=j}feature(j){return new ke(this.features[j],this.extent)}}function Ee(fe,j){j.writeVarintField(15,fe.version||1),j.writeStringField(1,fe.name||""),j.writeVarintField(5,fe.extent||4096);const V={keys:[],values:[],keycache:{},valuecache:{}};for(let U=0;U<fe.length;U++)V.feature=fe.feature(U),j.writeMessage(2,ae,V);const $=V.keys;for(const U of $)j.writeStringField(3,U);const te=V.values;for(const U of te)j.writeMessage(4,gt,U)}function ae(fe,j){if(!fe.feature)return;const V=fe.feature;V.id!==void 0&&j.writeVarintField(1,V.id),j.writeMessage(2,$e,fe),j.writeVarintField(3,V.type),j.writeMessage(4,Xe,V)}function $e(fe,j){for(const V in fe.feature?.properties){let $=fe.feature.properties[V],te=fe.keycache[V];if($===null)continue;te===void 0&&(fe.keys.push(V),te=fe.keys.length-1,fe.keycache[V]=te),j.writeVarint(te),typeof $!="string"&&typeof $!="boolean"&&typeof $!="number"&&($=JSON.stringify($));const U=typeof $+":"+$;let re=fe.valuecache[U];re===void 0&&(fe.values.push($),re=fe.values.length-1,fe.valuecache[U]=re),j.writeVarint(re)}}function Re(fe,j){return(j<<3)+(7&fe)}function Oe(fe){return fe<<1^fe>>31}function Xe(fe,j){const V=fe.loadGeometry(),$=fe.type;let te=0,U=0;for(const re of V){let pe=1;$===1&&(pe=re.length),j.writeVarint(Re(1,pe));const le=$===3?re.length-1:re.length;for(let ye=0;ye<le;ye++){ye===1&&$!==1&&j.writeVarint(Re(2,le-1));const ze=re[ye].x-te,Ie=re[ye].y-U;j.writeVarint(Oe(ze)),j.writeVarint(Oe(Ie)),te+=ze,U+=Ie}fe.type===3&&j.writeVarint(Re(7,1))}}function gt(fe,j){const V=typeof fe;V==="string"?j.writeStringField(1,fe):V==="boolean"?j.writeBooleanField(7,fe):V==="number"&&(fe%1!=0?j.writeDoubleField(3,fe):fe<0?j.writeSVarintField(6,fe):j.writeVarintField(5,fe))}const at={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:fe=>fe},rt=Math.fround||(nt=new Float32Array(1),fe=>(nt[0]=+fe,nt[0]));var nt;class mt{constructor(j){this.options=Object.assign(Object.create(at),j),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(j){const{log:V,minZoom:$,maxZoom:te}=this.options;V&&console.time("total time");const U=`prepare ${j.length} points`;V&&console.time(U),this.points=j;const re=[];for(let le=0;le<j.length;le++){const ye=j[le];if(!ye.geometry)continue;const[ze,Ie]=ye.geometry.coordinates,Ke=rt(jt(ze)),_e=rt(Mt(Ie));re.push(Ke,_e,1/0,le,-1,1),this.options.reduce&&re.push(0)}let pe=this.trees[te+1]=this._createTree(re);V&&console.timeEnd(U);for(let le=te;le>=$;le--){const ye=+Date.now();pe=this.trees[le]=this._createTree(this._cluster(pe,le)),V&&console.log("z%d: %d clusters in %dms",le,pe.numItems,+Date.now()-ye)}return V&&console.timeEnd("total time"),this}getClusters(j,V){let $=((j[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,j[1]));let U=j[2]===180?180:((j[2]+180)%360+360)%360-180;const re=Math.max(-90,Math.min(90,j[3]));if(j[2]-j[0]>=360)$=-180,U=180;else if($>U){const Ie=this.getClusters([$,te,180,re],V),Ke=this.getClusters([-180,te,U,re],V);return Ie.concat(Ke)}const pe=this.trees[this._limitZoom(V)],le=pe.range(jt($),Mt(re),jt(U),Mt(te)),ye=pe.data,ze=[];for(const Ie of le){const Ke=this.stride*Ie;ze.push(ye[Ke+5]>1?At(ye,Ke,this.clusterProps):this.points[ye[Ke+3]])}return ze}getChildren(j){const V=this._getOriginId(j),$=this._getOriginZoom(j),te="No cluster with the specified id.",U=this.trees[$];if(!U)throw new Error(te);const re=U.data;if(V*this.stride>=re.length)throw new Error(te);const pe=this.options.radius/(this.options.extent*Math.pow(2,$-1)),le=U.within(re[V*this.stride],re[V*this.stride+1],pe),ye=[];for(const ze of le){const Ie=ze*this.stride;re[Ie+4]===j&&ye.push(re[Ie+5]>1?At(re,Ie,this.clusterProps):this.points[re[Ie+3]])}if(ye.length===0)throw new Error(te);return ye}getLeaves(j,V,$){const te=[];return this._appendLeaves(te,j,V=V||10,$=$||0,0),te}getTile(j,V,$){const te=this.trees[this._limitZoom(j)],U=Math.pow(2,j),{extent:re,radius:pe}=this.options,le=pe/re,ye=($-le)/U,ze=($+1+le)/U,Ie={features:[]};return this._addTileFeatures(te.range((V-le)/U,ye,(V+1+le)/U,ze),te.data,V,$,U,Ie),V===0&&this._addTileFeatures(te.range(1-le/U,ye,1,ze),te.data,U,$,U,Ie),V===U-1&&this._addTileFeatures(te.range(0,ye,le/U,ze),te.data,-1,$,U,Ie),Ie.features.length?Ie:null}getClusterExpansionZoom(j){let V=this._getOriginZoom(j)-1;for(;V<=this.options.maxZoom;){const $=this.getChildren(j);if(V++,$.length!==1)break;j=$[0].properties.cluster_id}return V}_appendLeaves(j,V,$,te,U){const re=this.getChildren(V);for(const pe of re){const le=pe.properties;if(le&&le.cluster?U+le.point_count<=te?U+=le.point_count:U=this._appendLeaves(j,le.cluster_id,$,te,U):U<te?U++:j.push(pe),j.length===$)break}return U}_createTree(j){const V=new T.aI(j.length/this.stride|0,this.options.nodeSize,Float32Array);for(let $=0;$<j.length;$+=this.stride)V.add(j[$],j[$+1]);return V.finish(),V.data=j,V}_addTileFeatures(j,V,$,te,U,re){for(const pe of j){const le=pe*this.stride,ye=V[le+5]>1;let ze,Ie,Ke;if(ye)ze=St(V,le,this.clusterProps),Ie=V[le],Ke=V[le+1];else{const bt=this.points[V[le+3]];ze=bt.properties;const[Qe,dt]=bt.geometry.coordinates;Ie=jt(Qe),Ke=Mt(dt)}const _e={type:1,geometry:[[Math.round(this.options.extent*(Ie*U-$)),Math.round(this.options.extent*(Ke*U-te))]],tags:ze};let ot;ot=ye||this.options.generateId?V[le+3]:this.points[V[le+3]].id,ot!==void 0&&(_e.id=ot),re.features.push(_e)}}_limitZoom(j){return Math.max(this.options.minZoom,Math.min(Math.floor(+j),this.options.maxZoom+1))}_cluster(j,V){const{radius:$,extent:te,reduce:U,minPoints:re}=this.options,pe=$/(te*Math.pow(2,V)),le=j.data,ye=[],ze=this.stride;for(let Ie=0;Ie<le.length;Ie+=ze){if(le[Ie+2]<=V)continue;le[Ie+2]=V;const Ke=le[Ie],_e=le[Ie+1],ot=j.within(le[Ie],le[Ie+1],pe),bt=le[Ie+5];let Qe=bt;for(const dt of ot){const tr=dt*ze;le[tr+2]>V&&(Qe+=le[tr+5])}if(Qe>bt&&Qe>=re){let dt,tr=Ke*bt,kr=_e*bt,Pr=-1;const Ur=(Ie/ze<<5)+(V+1)+this.points.length;for(const zt of ot){const Ut=zt*ze;if(le[Ut+2]<=V)continue;le[Ut+2]=V;const qr=le[Ut+5];tr+=le[Ut]*qr,kr+=le[Ut+1]*qr,le[Ut+4]=Ur,U&&(dt||(dt=this._map(le,Ie,!0),Pr=this.clusterProps.length,this.clusterProps.push(dt)),U(dt,this._map(le,Ut)))}le[Ie+4]=Ur,ye.push(tr/Qe,kr/Qe,1/0,Ur,-1,Qe),U&&ye.push(Pr)}else{for(let dt=0;dt<ze;dt++)ye.push(le[Ie+dt]);if(Qe>1)for(const dt of ot){const tr=dt*ze;if(!(le[tr+2]<=V)){le[tr+2]=V;for(let kr=0;kr<ze;kr++)ye.push(le[tr+kr])}}}}return ye}_getOriginId(j){return j-this.points.length>>5}_getOriginZoom(j){return(j-this.points.length)%32}_map(j,V,$){if(j[V+5]>1){const re=this.clusterProps[j[V+6]];return $?Object.assign({},re):re}const te=this.points[j[V+3]].properties,U=this.options.map(te);return $&&U===te?Object.assign({},U):U}}function At(fe,j,V){return{type:"Feature",id:fe[j+3],properties:St(fe,j,V),geometry:{type:"Point",coordinates:[($=fe[j],360*($-.5)),pt(fe[j+1])]}};var $}function St(fe,j,V){const $=fe[j+5],te=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$,U=fe[j+6],re=U===-1?{}:Object.assign({},V[U]);return Object.assign(re,{cluster:!0,cluster_id:fe[j+3],point_count:$,point_count_abbreviated:te})}function jt(fe){return fe/360+.5}function Mt(fe){const j=Math.sin(fe*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function pt(fe){const j=(180-360*fe)*Math.PI/180;return 360*Math.atan(Math.exp(j))/Math.PI-90}function ht(fe,j,V,$){let te=$;const U=j+(V-j>>1);let re,pe=V-j;const le=fe[j],ye=fe[j+1],ze=fe[V],Ie=fe[V+1];for(let Ke=j+3;Ke<V;Ke+=3){const _e=lr(fe[Ke],fe[Ke+1],le,ye,ze,Ie);if(_e>te)re=Ke,te=_e;else if(_e===te){const ot=Math.abs(Ke-U);ot<pe&&(re=Ke,pe=ot)}}te>$&&(re-j>3&&ht(fe,j,re,$),fe[re+2]=te,V-re>3&&ht(fe,re,V,$))}function lr(fe,j,V,$,te,U){let re=te-V,pe=U-$;if(re!==0||pe!==0){const le=((fe-V)*re+(j-$)*pe)/(re*re+pe*pe);le>1?(V=te,$=U):le>0&&(V+=re*le,$+=pe*le)}return re=fe-V,pe=j-$,re*re+pe*pe}function Nt(fe,j,V,$){const te={id:fe??null,type:j,geometry:V,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(j==="Point"||j==="MultiPoint"||j==="LineString")qt(te,V);else if(j==="Polygon")qt(te,V[0]);else if(j==="MultiLineString")for(const U of V)qt(te,U);else if(j==="MultiPolygon")for(const U of V)qt(te,U[0]);return te}function qt(fe,j){for(let V=0;V<j.length;V+=3)fe.minX=Math.min(fe.minX,j[V]),fe.minY=Math.min(fe.minY,j[V+1]),fe.maxX=Math.max(fe.maxX,j[V]),fe.maxY=Math.max(fe.maxY,j[V+1])}function Kt(fe,j,V,$){if(!j.geometry)return;const te=j.geometry.coordinates;if(te&&te.length===0)return;const U=j.geometry.type,re=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2);let pe=[],le=j.id;if(V.promoteId?le=j.properties[V.promoteId]:V.generateId&&(le=$||0),U==="Point")Jt(te,pe);else if(U==="MultiPoint")for(const ye of te)Jt(ye,pe);else if(U==="LineString")vr(te,pe,re,!1);else if(U==="MultiLineString"){if(V.lineMetrics){for(const ye of te)pe=[],vr(ye,pe,re,!1),fe.push(Nt(le,"LineString",pe,j.properties));return}Qt(te,pe,re,!1)}else if(U==="Polygon")Qt(te,pe,re,!0);else{if(U!=="MultiPolygon"){if(U==="GeometryCollection"){for(const ye of j.geometry.geometries)Kt(fe,{id:le,geometry:ye,properties:j.properties},V,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ye of te){const ze=[];Qt(ye,ze,re,!0),pe.push(ze)}}fe.push(Nt(le,U,pe,j.properties))}function Jt(fe,j){j.push(Jr(fe[0]),Vt(fe[1]),0)}function vr(fe,j,V,$){let te,U,re=0;for(let le=0;le<fe.length;le++){const ye=Jr(fe[le][0]),ze=Vt(fe[le][1]);j.push(ye,ze,0),le>0&&(re+=$?(te*ze-ye*U)/2:Math.sqrt(Math.pow(ye-te,2)+Math.pow(ze-U,2))),te=ye,U=ze}const pe=j.length-3;j[2]=1,ht(j,0,pe,V),j[pe+2]=1,j.size=Math.abs(re),j.start=0,j.end=j.size}function Qt(fe,j,V,$){for(let te=0;te<fe.length;te++){const U=[];vr(fe[te],U,V,$),j.push(U)}}function Jr(fe){return fe/360+.5}function Vt(fe){const j=Math.sin(fe*Math.PI/180),V=.5-.25*Math.log((1+j)/(1-j))/Math.PI;return V<0?0:V>1?1:V}function kt(fe,j,V,$,te,U,re,pe){if($/=j,U>=(V/=j)&&re<$)return fe;if(re<V||U>=$)return null;const le=[];for(const ye of fe){const ze=ye.geometry;let Ie=ye.type;const Ke=te===0?ye.minX:ye.minY,_e=te===0?ye.maxX:ye.maxY;if(Ke>=V&&_e<$){le.push(ye);continue}if(_e<V||Ke>=$)continue;let ot=[];if(Ie==="Point"||Ie==="MultiPoint")Ft(ze,ot,V,$,te);else if(Ie==="LineString")Ot(ze,ot,V,$,te,!1,pe.lineMetrics);else if(Ie==="MultiLineString")yt(ze,ot,V,$,te,!1);else if(Ie==="Polygon")yt(ze,ot,V,$,te,!0);else if(Ie==="MultiPolygon")for(const bt of ze){const Qe=[];yt(bt,Qe,V,$,te,!0),Qe.length&&ot.push(Qe)}if(ot.length){if(pe.lineMetrics&&Ie==="LineString"){for(const bt of ot)le.push(Nt(ye.id,Ie,bt,ye.tags));continue}Ie!=="LineString"&&Ie!=="MultiLineString"||(ot.length===1?(Ie="LineString",ot=ot[0]):Ie="MultiLineString"),Ie!=="Point"&&Ie!=="MultiPoint"||(Ie=ot.length===3?"Point":"MultiPoint"),le.push(Nt(ye.id,Ie,ot,ye.tags))}}return le.length?le:null}function Ft(fe,j,V,$,te){for(let U=0;U<fe.length;U+=3){const re=fe[U+te];re>=V&&re<=$&&Gt(j,fe[U],fe[U+1],fe[U+2])}}function Ot(fe,j,V,$,te,U,re){let pe=Rt(fe);const le=te===0?mr:Gr;let ye,ze,Ie=fe.start;for(let Qe=0;Qe<fe.length-3;Qe+=3){const dt=fe[Qe],tr=fe[Qe+1],kr=fe[Qe+2],Pr=fe[Qe+3],Ur=fe[Qe+4],zt=te===0?dt:tr,Ut=te===0?Pr:Ur;let qr=!1;re&&(ye=Math.sqrt(Math.pow(dt-Pr,2)+Math.pow(tr-Ur,2))),zt<V?Ut>V&&(ze=le(pe,dt,tr,Pr,Ur,V),re&&(pe.start=Ie+ye*ze)):zt>$?Ut<$&&(ze=le(pe,dt,tr,Pr,Ur,$),re&&(pe.start=Ie+ye*ze)):Gt(pe,dt,tr,kr),Ut<V&&zt>=V&&(ze=le(pe,dt,tr,Pr,Ur,V),qr=!0),Ut>$&&zt<=$&&(ze=le(pe,dt,tr,Pr,Ur,$),qr=!0),!U&&qr&&(re&&(pe.end=Ie+ye*ze),j.push(pe),pe=Rt(fe)),re&&(Ie+=ye)}let Ke=fe.length-3;const _e=fe[Ke],ot=fe[Ke+1],bt=te===0?_e:ot;bt>=V&&bt<=$&&Gt(pe,_e,ot,fe[Ke+2]),Ke=pe.length-3,U&&Ke>=3&&(pe[Ke]!==pe[0]||pe[Ke+1]!==pe[1])&&Gt(pe,pe[0],pe[1],pe[2]),pe.length&&j.push(pe)}function Rt(fe){const j=[];return j.size=fe.size,j.start=fe.start,j.end=fe.end,j}function yt(fe,j,V,$,te,U){for(const re of fe)Ot(re,j,V,$,te,U,!1)}function Gt(fe,j,V,$){fe.push(j,V,$)}function mr(fe,j,V,$,te,U){const re=(U-j)/($-j);return Gt(fe,U,V+(te-V)*re,1),re}function Gr(fe,j,V,$,te,U){const re=(U-V)/(te-V);return Gt(fe,j+($-j)*re,U,1),re}function xr(fe,j){const V=[];for(let $=0;$<fe.length;$++){const te=fe[$],U=te.type;let re;if(U==="Point"||U==="MultiPoint"||U==="LineString")re=Ar(te.geometry,j);else if(U==="MultiLineString"||U==="Polygon"){re=[];for(const pe of te.geometry)re.push(Ar(pe,j))}else if(U==="MultiPolygon"){re=[];for(const pe of te.geometry){const le=[];for(const ye of pe)le.push(Ar(ye,j));re.push(le)}}V.push(Nt(te.id,U,re,te.tags))}return V}function Ar(fe,j){const V=[];V.size=fe.size,fe.start!==void 0&&(V.start=fe.start,V.end=fe.end);for(let $=0;$<fe.length;$+=3)V.push(fe[$]+j,fe[$+1],fe[$+2]);return V}function pr(fe,j){if(fe.transformed)return fe;const V=1<<fe.z,$=fe.x,te=fe.y;for(const U of fe.features){const re=U.geometry,pe=U.type;if(U.geometry=[],pe===1)for(let le=0;le<re.length;le+=2)U.geometry.push(Sr(re[le],re[le+1],j,V,$,te));else for(let le=0;le<re.length;le++){const ye=[];for(let ze=0;ze<re[le].length;ze+=2)ye.push(Sr(re[le][ze],re[le][ze+1],j,V,$,te));U.geometry.push(ye)}}return fe.transformed=!0,fe}function Sr(fe,j,V,$,te,U){return[Math.round(V*(fe*$-te)),Math.round(V*(j*$-U))]}function br(fe,j,V,$,te){const U=j===te.maxZoom?0:te.tolerance/((1<<j)*te.extent),re={features:[],numPoints:0,numSimplified:0,numFeatures:fe.length,source:null,x:V,y:$,z:j,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const pe of fe)gr(re,pe,U,te);return re}function gr(fe,j,V,$){const te=j.geometry,U=j.type,re=[];if(fe.minX=Math.min(fe.minX,j.minX),fe.minY=Math.min(fe.minY,j.minY),fe.maxX=Math.max(fe.maxX,j.maxX),fe.maxY=Math.max(fe.maxY,j.maxY),U==="Point"||U==="MultiPoint")for(let pe=0;pe<te.length;pe+=3)re.push(te[pe],te[pe+1]),fe.numPoints++,fe.numSimplified++;else if(U==="LineString")Br(re,te,fe,V,!1,!1);else if(U==="MultiLineString"||U==="Polygon")for(let pe=0;pe<te.length;pe++)Br(re,te[pe],fe,V,U==="Polygon",pe===0);else if(U==="MultiPolygon")for(let pe=0;pe<te.length;pe++){const le=te[pe];for(let ye=0;ye<le.length;ye++)Br(re,le[ye],fe,V,!0,ye===0)}if(re.length){let pe=j.tags||null;if(U==="LineString"&&$.lineMetrics){pe={};for(const ye in j.tags)pe[ye]=j.tags[ye];pe.mapbox_clip_start=te.start/te.size,pe.mapbox_clip_end=te.end/te.size}const le={geometry:re,type:U==="Polygon"||U==="MultiPolygon"?3:U==="LineString"||U==="MultiLineString"?2:1,tags:pe};j.id!==null&&(le.id=j.id),fe.features.push(le)}}function Br(fe,j,V,$,te,U){const re=$*$;if($>0&&j.size<(te?re:$))return void(V.numPoints+=j.length/3);const pe=[];for(let le=0;le<j.length;le+=3)($===0||j[le+2]>re)&&(V.numSimplified++,pe.push(j[le],j[le+1])),V.numPoints++;te&&(function(le,ye){let ze=0;for(let Ie=0,Ke=le.length,_e=Ke-2;Ie<Ke;_e=Ie,Ie+=2)ze+=(le[Ie]-le[_e])*(le[Ie+1]+le[_e+1]);if(ze>0===ye)for(let Ie=0,Ke=le.length;Ie<Ke/2;Ie+=2){const _e=le[Ie],ot=le[Ie+1];le[Ie]=le[Ke-2-Ie],le[Ie+1]=le[Ke-1-Ie],le[Ke-2-Ie]=_e,le[Ke-1-Ie]=ot}})(pe,U),fe.push(pe)}const Fr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Qr{constructor(j,V){const $=(V=this.options=(function(U,re){for(const pe in re)U[pe]=re[pe];return U})(Object.create(Fr),V)).debug;if($&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");let te=(function(U,re){const pe=[];if(U.type==="FeatureCollection")for(let le=0;le<U.features.length;le++)Kt(pe,U.features[le],re,le);else Kt(pe,U.type==="Feature"?U:{geometry:U},re);return pe})(j,V);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),te=(function(U,re){const pe=re.buffer/re.extent;let le=U;const ye=kt(U,1,-1-pe,pe,0,-1,2,re),ze=kt(U,1,1-pe,2+pe,0,-1,2,re);return(ye||ze)&&(le=kt(U,1,-pe,1+pe,0,-1,2,re)||[],ye&&(le=xr(ye,1).concat(le)),ze&&(le=le.concat(xr(ze,-1)))),le})(te,V),te.length&&this.splitTile(te,0,0,0),$&&(te.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(j,V,$,te,U,re,pe){const le=[j,V,$,te],ye=this.options,ze=ye.debug;for(;le.length;){te=le.pop(),$=le.pop(),V=le.pop(),j=le.pop();const Ie=1<<V,Ke=ei(V,$,te);let _e=this.tiles[Ke];if(!_e&&(ze>1&&console.time("creation"),_e=this.tiles[Ke]=br(j,V,$,te,ye),this.tileCoords.push({z:V,x:$,y:te}),ze)){ze>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,$,te,_e.numFeatures,_e.numPoints,_e.numSimplified),console.timeEnd("creation"));const qr=`z${V}`;this.stats[qr]=(this.stats[qr]||0)+1,this.total++}if(_e.source=j,U==null){if(V===ye.indexMaxZoom||_e.numPoints<=ye.indexMaxPoints)continue}else{if(V===ye.maxZoom||V===U)continue;if(U!=null){const qr=U-V;if($!==re>>qr||te!==pe>>qr)continue}}if(_e.source=null,j.length===0)continue;ze>1&&console.time("clipping");const ot=.5*ye.buffer/ye.extent,bt=.5-ot,Qe=.5+ot,dt=1+ot;let tr=null,kr=null,Pr=null,Ur=null,zt=kt(j,Ie,$-ot,$+Qe,0,_e.minX,_e.maxX,ye),Ut=kt(j,Ie,$+bt,$+dt,0,_e.minX,_e.maxX,ye);j=null,zt&&(tr=kt(zt,Ie,te-ot,te+Qe,1,_e.minY,_e.maxY,ye),kr=kt(zt,Ie,te+bt,te+dt,1,_e.minY,_e.maxY,ye),zt=null),Ut&&(Pr=kt(Ut,Ie,te-ot,te+Qe,1,_e.minY,_e.maxY,ye),Ur=kt(Ut,Ie,te+bt,te+dt,1,_e.minY,_e.maxY,ye),Ut=null),ze>1&&console.timeEnd("clipping"),le.push(tr||[],V+1,2*$,2*te),le.push(kr||[],V+1,2*$,2*te+1),le.push(Pr||[],V+1,2*$+1,2*te),le.push(Ur||[],V+1,2*$+1,2*te+1)}}getTile(j,V,$){j=+j,V=+V,$=+$;const te=this.options,{extent:U,debug:re}=te;if(j<0||j>24)return null;const pe=1<<j,le=ei(j,V=V+pe&pe-1,$);if(this.tiles[le])return pr(this.tiles[le],U);re>1&&console.log("drilling down to z%d-%d-%d",j,V,$);let ye,ze=j,Ie=V,Ke=$;for(;!ye&&ze>0;)ze--,Ie>>=1,Ke>>=1,ye=this.tiles[ei(ze,Ie,Ke)];return ye&&ye.source?(re>1&&(console.log("found parent tile z%d-%d-%d",ze,Ie,Ke),console.time("drilling down")),this.splitTile(ye.source,ze,Ie,Ke,j,V,$),re>1&&console.timeEnd("drilling down"),this.tiles[le]?pr(this.tiles[le],U):null):null}}function ei(fe,j,V){return 32*((1<<fe)*V+j)+fe}class Ui extends ce{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(j,V){return T._(this,void 0,void 0,(function*(){const $=j.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const te=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!te)return null;const U=new Ce(te.features,{version:2,extent:T.$});let re=(function(pe){const le=new T.cM;return(function(ye,ze){for(const Ie in ye.layers)ze.writeMessage(3,Ee,ye.layers[Ie])})(pe,le),le.finish()})(U);return re.byteOffset===0&&re.byteLength===re.buffer.byteLength||(re=new Uint8Array(re)),{vectorTile:U,rawData:re.buffer}}))}loadData(j){return T._(this,void 0,void 0,(function*(){var V;(V=this._pendingRequest)===null||V===void 0||V.abort();const $=!!(j&&j.request&&j.request.collectResourceTiming)&&new T.cN(j.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(j,this._pendingRequest);const te=yield this._pendingData;this._geoJSONIndex=j.cluster?new mt((function({superclusterOptions:re,clusterProperties:pe}){if(!pe||!re)return re;const le={},ye={},ze={accumulated:null,zoom:0},Ie={properties:null},Ke=Object.keys(pe);for(const _e of Ke){const[ot,bt]=pe[_e],Qe=T.cT(bt),dt=T.cT(typeof ot=="string"?[ot,["accumulated"],["get",_e]]:ot);le[_e]=Qe.value,ye[_e]=dt.value}return re.map=_e=>{Ie.properties=_e;const ot={};for(const bt of Ke)ot[bt]=le[bt].evaluate(ze,Ie);return ot},re.reduce=(_e,ot)=>{Ie.properties=ot;for(const bt of Ke)ze.accumulated=_e[bt],_e[bt]=ye[bt].evaluate(ze,Ie)},re})(j)).load(te.features):(function(re,pe){return new Qr(re,pe)})(te,j.geojsonVtOptions),this.loaded={};const U={data:te};if($){const re=$.finish();re&&(U.resourceTiming={},U.resourceTiming[j.source]=JSON.parse(JSON.stringify(re)))}return U}catch(te){if(delete this._pendingRequest,T.cy(te))return{abandoned:!0};throw te}}))}getData(){return T._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(j){const V=this.loaded;return V&&V[j.uid]?super.reloadTile(j):this.loadTile(j)}loadAndProcessGeoJSON(j,V){return T._(this,void 0,void 0,(function*(){let $=yield this.loadGeoJSON(j,V);if(delete this._pendingRequest,typeof $!="object")throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(Me($,!0),j.filter){const te=T.cT(j.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(te.result==="error")throw new Error(te.value.map((re=>`${re.key}: ${re.message}`)).join(", "));$={type:"FeatureCollection",features:$.features.filter((re=>te.value.evaluate({zoom:0},re)))}}return $}))}loadGeoJSON(j,V){return T._(this,void 0,void 0,(function*(){const{promoteId:$}=j;if(j.request){const te=yield T.j(j.request,V);return this._dataUpdateable=T.cV(te.data,$)?T.cU(te.data,$):void 0,te.data}if(typeof j.data=="string")try{const te=JSON.parse(j.data);return this._dataUpdateable=T.cV(te,$)?T.cU(te,$):void 0,te}catch{throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`)}if(!j.dataDiff)throw new Error(`Input data given to '${j.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${j.source}`);return T.cW(this._dataUpdateable,j.dataDiff,$),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(j){return T._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(j){return this._geoJSONIndex.getClusterExpansionZoom(j.clusterId)}getClusterChildren(j){return this._geoJSONIndex.getChildren(j.clusterId)}getClusterLeaves(j){return this._geoJSONIndex.getLeaves(j.clusterId,j.limit,j.offset)}}class an{constructor(j){this.self=j,this.actor=new T.J(j),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(V,$)=>{if(this.externalWorkerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.externalWorkerSourceTypes[V]=$},this.self.addProtocol=T.cA,this.self.removeProtocol=T.cB,this.self.registerRTLTextPlugin=V=>{T.cX.setMethods(V)},this.actor.registerMessageHandler("LDT",((V,$)=>this._getDEMWorkerSource(V,$.source).loadTile($))),this.actor.registerMessageHandler("RDT",((V,$)=>T._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(V,$.source).removeTile($)})))),this.actor.registerMessageHandler("GCEZ",((V,$)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,$.type,$.source).getClusterExpansionZoom($)})))),this.actor.registerMessageHandler("GCC",((V,$)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,$.type,$.source).getClusterChildren($)})))),this.actor.registerMessageHandler("GCL",((V,$)=>T._(this,void 0,void 0,(function*(){return this._getWorkerSource(V,$.type,$.source).getClusterLeaves($)})))),this.actor.registerMessageHandler("LD",((V,$)=>this._getWorkerSource(V,$.type,$.source).loadData($))),this.actor.registerMessageHandler("GD",((V,$)=>this._getWorkerSource(V,$.type,$.source).getData())),this.actor.registerMessageHandler("LT",((V,$)=>this._getWorkerSource(V,$.type,$.source).loadTile($))),this.actor.registerMessageHandler("RT",((V,$)=>this._getWorkerSource(V,$.type,$.source).reloadTile($))),this.actor.registerMessageHandler("AT",((V,$)=>this._getWorkerSource(V,$.type,$.source).abortTile($))),this.actor.registerMessageHandler("RMT",((V,$)=>this._getWorkerSource(V,$.type,$.source).removeTile($))),this.actor.registerMessageHandler("RS",((V,$)=>T._(this,void 0,void 0,(function*(){if(!this.workerSources[V]||!this.workerSources[V][$.type]||!this.workerSources[V][$.type][$.source])return;const te=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],te.removeSource!==void 0&&te.removeSource($)})))),this.actor.registerMessageHandler("RM",(V=>T._(this,void 0,void 0,(function*(){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V]})))),this.actor.registerMessageHandler("SR",((V,$)=>T._(this,void 0,void 0,(function*(){this.referrer=$})))),this.actor.registerMessageHandler("SRPS",((V,$)=>this._syncRTLPluginState(V,$))),this.actor.registerMessageHandler("IS",((V,$)=>T._(this,void 0,void 0,(function*(){this.self.importScripts($)})))),this.actor.registerMessageHandler("SI",((V,$)=>this._setImages(V,$))),this.actor.registerMessageHandler("UL",((V,$)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(V).update($.layers,$.removedIds)})))),this.actor.registerMessageHandler("SL",((V,$)=>T._(this,void 0,void 0,(function*(){this._getLayerIndex(V).replace($)}))))}_setImages(j,V){return T._(this,void 0,void 0,(function*(){this.availableImages[j]=V;for(const $ in this.workerSources[j]){const te=this.workerSources[j][$];for(const U in te)te[U].availableImages=V}}))}_syncRTLPluginState(j,V){return T._(this,void 0,void 0,(function*(){return yield T.cX.syncState(V,this.self.importScripts)}))}_getAvailableImages(j){let V=this.availableImages[j];return V||(V=[]),V}_getLayerIndex(j){let V=this.layerIndexes[j];return V||(V=this.layerIndexes[j]=new o),V}_getWorkerSource(j,V,$){if(this.workerSources[j]||(this.workerSources[j]={}),this.workerSources[j][V]||(this.workerSources[j][V]={}),!this.workerSources[j][V][$]){const te={sendAsync:(U,re)=>(U.targetMapId=j,this.actor.sendAsync(U,re))};switch(V){case"vector":this.workerSources[j][V][$]=new ce(te,this._getLayerIndex(j),this._getAvailableImages(j));break;case"geojson":this.workerSources[j][V][$]=new Ui(te,this._getLayerIndex(j),this._getAvailableImages(j));break;default:this.workerSources[j][V][$]=new this.externalWorkerSourceTypes[V](te,this._getLayerIndex(j),this._getAvailableImages(j))}}return this.workerSources[j][V][$]}_getDEMWorkerSource(j,V){return this.demWorkerSources[j]||(this.demWorkerSources[j]={}),this.demWorkerSources[j][V]||(this.demWorkerSources[j][V]=new he),this.demWorkerSources[j][V]}}return T.i(self)&&(self.worker=new an(self)),an})),C("index",["exports","./shared"],(function(T,o){var B="5.6.2";function K(){var h=new o.A(4);return o.A!=Float32Array&&(h[1]=0,h[2]=0),h[0]=1,h[3]=1,h}let X,ce;const he={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(h,e,n){const a=requestAnimationFrame((p=>{c(),e(p)})),{unsubscribe:c}=o.s(h.signal,"abort",(()=>{c(),cancelAnimationFrame(a),n(o.c())}),!1)},frameAsync(h){return new Promise(((e,n)=>{this.frame(h,e,n)}))},getImageData(h,e=0){return this.getImageCanvasContext(h).getImageData(-e,-e,h.width+2*e,h.height+2*e)},getImageCanvasContext(h){const e=window.document.createElement("canvas"),n=e.getContext("2d",{willReadFrequently:!0});if(!n)throw new Error("failed to create canvas 2d context");return e.width=h.width,e.height=h.height,n.drawImage(h,0,0,h.width,h.height),n},resolveURL:h=>(X||(X=document.createElement("a")),X.href=h,X.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ce==null&&(ce=matchMedia("(prefers-reduced-motion: reduce)")),ce.matches)}};class q{static testProp(e){if(!q.docStyle)return e[0];for(let n=0;n<e.length;n++)if(e[n]in q.docStyle)return e[n];return e[0]}static create(e,n,a){const c=window.document.createElement(e);return n!==void 0&&(c.className=n),a&&a.appendChild(c),c}static createNS(e,n){return window.document.createElementNS(e,n)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(e,n){e.style[q.transformProp]=n}static addEventListener(e,n,a,c={}){e.addEventListener(n,a,"passive"in c?c:c.capture)}static removeEventListener(e,n,a,c={}){e.removeEventListener(n,a,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",q.suppressClickInternal,!0)}),0)}static getScale(e){const n=e.getBoundingClientRect();return{x:n.width/e.offsetWidth||1,y:n.height/e.offsetHeight||1,boundingClientRect:n}}static getPoint(e,n,a){const c=n.boundingClientRect;return new o.P((a.clientX-c.left)/n.x-e.clientLeft,(a.clientY-c.top)/n.y-e.clientTop)}static mousePos(e,n){const a=q.getScale(e);return q.getPoint(e,a,n)}static touchPos(e,n){const a=[],c=q.getScale(e);for(let p=0;p<n.length;p++)a.push(q.getPoint(e,c,n[p]));return a}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const n=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),a=n.querySelectorAll("script");for(const c of a)c.remove();return q.clean(n),n.innerHTML}static isPossiblyDangerous(e,n){const a=n.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!a.includes("javascript:")&&!a.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const n=e.children;for(const a of n)q.removeAttributes(a),q.clean(a)}static removeAttributes(e){for(const{name:n,value:a}of e.attributes)q.isPossiblyDangerous(n,a)&&e.removeAttribute(n)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);const de={supported:!1,testSupport:function(h){!ke&&Me&&(Ce?Ee(h):Se=h)}};let Se,Me,ke=!1,Ce=!1;function Ee(h){const e=h.createTexture();h.bindTexture(h.TEXTURE_2D,e);try{if(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,Me),h.isContextLost())return;de.supported=!0}catch{}h.deleteTexture(e),ke=!0}var ae;typeof document<"u"&&(Me=document.createElement("img"),Me.onload=()=>{Se&&Ee(Se),Se=null,Ce=!0},Me.onerror=()=>{ke=!0,Se=null},Me.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(h){let e,n,a,c;h.resetRequestQueue=()=>{e=[],n=0,a=0,c={}},h.addThrottleControl=b=>{const P=a++;return c[P]=b,P},h.removeThrottleControl=b=>{delete c[b],_()},h.getImage=(b,P,I=!0)=>new Promise(((k,A)=>{de.supported&&(b.headers||(b.headers={}),b.headers.accept="image/webp,*/*"),o.e(b,{type:"image"}),e.push({abortController:P,requestParameters:b,supportImageRefresh:I,state:"queued",onError:R=>{A(R)},onSuccess:R=>{k(R)}}),_()}));const p=b=>o._(this,void 0,void 0,(function*(){b.state="running";const{requestParameters:P,supportImageRefresh:I,onError:k,onSuccess:A,abortController:R}=b,O=I===!1&&!o.i(self)&&!o.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce(((H,J)=>H&&J==="accept"),!0));n++;const W=O?x(P,R):o.m(P,R);try{const H=yield W;delete b.abortController,b.state="completed",H.data instanceof HTMLImageElement||o.b(H.data)?A(H):H.data&&A({data:yield(G=H.data,typeof createImageBitmap=="function"?o.f(G):o.h(G)),cacheControl:H.cacheControl,expires:H.expires})}catch(H){delete b.abortController,k(H)}finally{n--,_()}var G})),_=()=>{const b=(()=>{for(const P of Object.keys(c))if(c[P]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=n;P<b&&e.length>0;P++){const I=e.shift();I.abortController.signal.aborted?P--:p(I)}},x=(b,P)=>new Promise(((I,k)=>{const A=new Image,R=b.url,O=b.credentials;O&&O==="include"?A.crossOrigin="use-credentials":(O&&O==="same-origin"||!o.d(R))&&(A.crossOrigin="anonymous"),P.signal.addEventListener("abort",(()=>{A.src="",k(o.c())})),A.fetchPriority="high",A.onload=()=>{A.onerror=A.onload=null,I({data:A})},A.onerror=()=>{A.onerror=A.onload=null,P.signal.aborted||k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},A.src=R}))})(ae||(ae={})),ae.resetRequestQueue();class $e{constructor(e){this._transformRequestFn=e??null}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Re(h){const e=[];if(typeof h=="string")e.push({id:"default",url:h});else if(h&&h.length>0){const n=[];for(const{id:a,url:c}of h){const p=`${a}${c}`;n.indexOf(p)===-1&&(n.push(p),e.push({id:a,url:c}))}}return e}function Oe(h,e,n){try{const a=new URL(h);return a.pathname+=`${e}${n}`,a.toString()}catch{throw new Error(`Invalid sprite URL "${h}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Xe(h){const{userImage:e}=h;return!!(e&&e.render&&e.render())&&(h.data.replace(new Uint8Array(e.data.buffer)),!0)}class gt extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:n,promiseResolve:a}of this.requestors)a(this._getImagesForIds(n));this.requestors=[]}}getImage(e){const n=this.images[e];if(n&&!n.data&&n.spriteData){const a=n.spriteData;n.data=new o.R({width:a.width,height:a.height},a.context.getImageData(a.x,a.y,a.width,a.height).data),n.spriteData=null}return n}addImage(e,n){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,n)&&(this.images[e]=n)}_validate(e,n){let a=!0;const c=n.data||n.spriteData;return this._validateStretch(n.stretchX,c&&c.width)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchX" value`))),a=!1),this._validateStretch(n.stretchY,c&&c.height)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "stretchY" value`))),a=!1),this._validateContent(n.content,n)||(this.fire(new o.k(new Error(`Image "${e}" has invalid "content" value`))),a=!1),a}_validateStretch(e,n){if(!e)return!0;let a=0;for(const c of e){if(c[0]<a||c[1]<c[0]||n<c[1])return!1;a=c[1]}return!0}_validateContent(e,n){if(!e)return!0;if(e.length!==4)return!1;const a=n.spriteData,c=a&&a.width||n.data.width,p=a&&a.height||n.data.height;return!(e[0]<0||c<e[0]||e[1]<0||p<e[1]||e[2]<0||c<e[2]||e[3]<0||p<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,n,a=!0){const c=this.getImage(e);if(a&&(c.data.width!==n.data.width||c.data.height!==n.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${n.data.width}x${n.data.height}).`);n.version=c.version+1,this.images[e]=n,this.updatedImages[e]=!0}removeImage(e){const n=this.images[e];delete this.images[e],delete this.patterns[e],n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((n,a)=>{let c=!0;if(!this.isLoaded())for(const p of e)this.images[p]||(c=!1);this.isLoaded()||c?n(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:n})}))}_getImagesForIds(e){const n={};for(const a of e){let c=this.getImage(a);c||(this.fire(new o.l("styleimagemissing",{id:a})),c=this.getImage(a)),c?n[a]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:o.w(`Image "${a}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return n}getPixelSize(){const{width:e,height:n}=this.atlasImage;return{width:e,height:n}}getPattern(e){const n=this.patterns[e],a=this.getImage(e);if(!a)return null;if(n&&n.position.version===a.version)return n.position;if(n)n.position.version=a.version;else{const c={w:a.data.width+2,h:a.data.height+2,x:0,y:0},p=new o.I(c,a);this.patterns[e]={bin:c,position:p}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new o.T(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const p in this.patterns)e.push(this.patterns[p].bin);const{w:n,h:a}=o.p(e),c=this.atlasImage;c.resize({width:n||1,height:a||1});for(const p in this.patterns){const{bin:_}=this.patterns[p],x=_.x+1,b=_.y+1,P=this.getImage(p).data,I=P.width,k=P.height;o.R.copy(P,c,{x:0,y:0},{x,y:b},{width:I,height:k}),o.R.copy(P,c,{x:0,y:k-1},{x,y:b-1},{width:I,height:1}),o.R.copy(P,c,{x:0,y:0},{x,y:b+k},{width:I,height:1}),o.R.copy(P,c,{x:I-1,y:0},{x:x-1,y:b},{width:1,height:k}),o.R.copy(P,c,{x:0,y:0},{x:x+I,y:b},{width:1,height:k})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const n of e){if(this.callbackDispatchedThisFrame[n])continue;this.callbackDispatchedThisFrame[n]=!0;const a=this.getImage(n);a||o.w(`Image with ID: "${n}" was not found`),Xe(a)&&this.updateImage(n,a)}}}const at=1e20;function rt(h,e,n,a,c,p,_,x,b){for(let P=e;P<e+a;P++)nt(h,n*p+P,p,c,_,x,b);for(let P=n;P<n+c;P++)nt(h,P*p+e,1,a,_,x,b)}function nt(h,e,n,a,c,p,_){p[0]=0,_[0]=-at,_[1]=at,c[0]=h[e];for(let x=1,b=0,P=0;x<a;x++){c[x]=h[e+x*n];const I=x*x;do{const k=p[b];P=(c[x]-c[k]+I-k*k)/(x-k)/2}while(P<=_[b]&&--b>-1);b++,p[b]=x,_[b]=P,_[b+1]=at}for(let x=0,b=0;x<a;x++){for(;_[b+1]<x;)b++;const P=p[b],I=x-P;h[e+x*n]=c[P]+I*I}}class mt{constructor(e,n){this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return o._(this,void 0,void 0,(function*(){const n=[];for(const p in e)for(const _ of e[p])n.push(this._getAndCacheGlyphsPromise(p,_));const a=yield Promise.all(n),c={};for(const{stack:p,id:_,glyph:x}of a)c[p]||(c[p]={}),c[p][_]=x&&{id:x.id,bitmap:x.bitmap.clone(),metrics:x.metrics};return c}))}_getAndCacheGlyphsPromise(e,n){return o._(this,void 0,void 0,(function*(){let a=this.entries[e];a||(a=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=a.glyphs[n];if(c!==void 0)return{stack:e,id:n,glyph:c};if(c=this._tinySDF(a,e,n),c)return a.glyphs[n]=c,{stack:e,id:n,glyph:c};const p=Math.floor(n/256);if(256*p>65535)throw new Error("glyphs > 65535 not supported");if(a.ranges[p])return{stack:e,id:n,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!a.requests[p]){const x=mt.loadGlyphRange(e,p,this.url,this.requestManager);a.requests[p]=x}const _=yield a.requests[p];for(const x in _)this._doesCharSupportLocalGlyph(+x)||(a.glyphs[+x]=_[+x]);return a.ranges[p]=!0,{stack:e,id:n,glyph:_[n]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||o.u["CJK Unified Ideographs"](e)||o.u["Hangul Syllables"](e)||o.u.Hiragana(e)||o.u.Katakana(e)||o.u["CJK Symbols and Punctuation"](e)||o.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,n,a){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(a))return;let p=e.tinySDF;if(!p){let x="400";/bold/i.test(n)?x="900":/medium/i.test(n)?x="500":/light/i.test(n)&&(x="200"),p=e.tinySDF=new mt.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:x})}const _=p.draw(String.fromCharCode(a));return{id:a,bitmap:new o.q({width:_.width||60,height:_.height||60},_.data),metrics:{width:_.glyphWidth/2||24,height:_.glyphHeight/2||24,left:_.glyphLeft/2+.5||0,top:_.glyphTop/2-27.5||-8,advance:_.glyphAdvance/2||24,isDoubleResolution:!0}}}}mt.loadGlyphRange=function(h,e,n,a){return o._(this,void 0,void 0,(function*(){const c=256*e,p=c+255,_=a.transformRequest(n.replace("{fontstack}",h).replace("{range}",`${c}-${p}`),"Glyphs"),x=yield o.n(_,new AbortController);if(!x||!x.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${p}`);const b={};for(const P of o.o(x.data))b[P.id]=P;return b}))},mt.TinySDF=class{constructor({fontSize:h=24,buffer:e=3,radius:n=8,cutoff:a=.25,fontFamily:c="sans-serif",fontWeight:p="normal",fontStyle:_="normal",lang:x=null}={}){this.buffer=e,this.cutoff=a,this.radius=n,this.lang=x;const b=this.size=h+4*e,P=this._createCanvas(b),I=this.ctx=P.getContext("2d",{willReadFrequently:!0});I.font=`${_} ${p} ${h}px ${c}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(h){const e=document.createElement("canvas");return e.width=e.height=h,e}draw(h){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:a,actualBoundingBoxLeft:c,actualBoundingBoxRight:p}=this.ctx.measureText(h),_=Math.ceil(n),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-c))),b=Math.min(this.size-this.buffer,_+Math.ceil(a)),P=x+2*this.buffer,I=b+2*this.buffer,k=Math.max(P*I,0),A=new Uint8ClampedArray(k),R={data:A,width:P,height:I,glyphWidth:x,glyphHeight:b,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(x===0||b===0)return R;const{ctx:O,buffer:W,gridInner:G,gridOuter:H}=this;this.lang&&(O.lang=this.lang),O.clearRect(W,W,x,b),O.fillText(h,W,W+_);const J=O.getImageData(W,W,x,b);H.fill(at,0,k),G.fill(0,0,k);for(let ie=0;ie<b;ie++)for(let Q=0;Q<x;Q++){const se=J.data[4*(ie*x+Q)+3]/255;if(se===0)continue;const ue=(ie+W)*P+Q+W;if(se===1)H[ue]=0,G[ue]=at;else{const ee=.5-se;H[ue]=ee>0?ee*ee:0,G[ue]=ee<0?ee*ee:0}}rt(H,0,0,P,I,P,this.f,this.v,this.z),rt(G,W,W,x,b,P,this.f,this.v,this.z);for(let ie=0;ie<k;ie++){const Q=Math.sqrt(H[ie])-Math.sqrt(G[ie]);A[ie]=Math.round(255-255*(Q/this.radius+this.cutoff))}return R}};class At{constructor(){this.specification=o.v.light.position}possiblyEvaluate(e,n){return o.B(e.expression.evaluate(n))}interpolate(e,n,a){return{x:o.C.number(e.x,n.x,a),y:o.C.number(e.y,n.y,a),z:o.C.number(e.z,n.z,a)}}}let St;class jt extends o.E{constructor(e){super(),St=St||new o.r({anchor:new o.D(o.v.light.anchor),position:new At,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.t(St),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(o.x,e,n))for(const a in e){const c=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),c):this._transitionable.setValue(a,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a){return(!a||a.validate!==!1)&&o.y(this,e.call(o.z,{value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}const Mt=new o.r({"sky-color":new o.D(o.v.sky["sky-color"]),"horizon-color":new o.D(o.v.sky["horizon-color"]),"fog-color":new o.D(o.v.sky["fog-color"]),"fog-ground-blend":new o.D(o.v.sky["fog-ground-blend"]),"horizon-fog-blend":new o.D(o.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new o.D(o.v.sky["sky-horizon-blend"]),"atmosphere-blend":new o.D(o.v.sky["atmosphere-blend"])});class pt extends o.E{constructor(e){super(),this._transitionable=new o.t(Mt),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0))}setSky(e,n={}){if(!this._validate(o.G,e,n)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const a in e){const c=e[a];a.endsWith("-transition")?this._transitionable.setTransition(a.slice(0,-11),c):this._transitionable.setValue(a,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,a={}){return a?.validate!==!1&&o.y(this,e.call(o.z,o.e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class ht{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,n){const a=e.join(",")+String(n);return this.dashEntry[a]||(this.dashEntry[a]=this.addDash(e,n)),this.dashEntry[a]}getDashRanges(e,n,a){const c=[];let p=e.length%2==1?-e[e.length-1]*a:0,_=e[0]*a,x=!0;c.push({left:p,right:_,isDash:x,zeroLength:e[0]===0});let b=e[0];for(let P=1;P<e.length;P++){x=!x;const I=e[P];p=b*a,b+=I,_=b*a,c.push({left:p,right:_,isDash:x,zeroLength:I===0})}return c}addRoundDash(e,n,a){const c=n/2;for(let p=-a;p<=a;p++){const _=this.width*(this.nextRow+a+p);let x=0,b=e[x];for(let P=0;P<this.width;P++){P/b.right>1&&(b=e[++x]);const I=Math.abs(P-b.left),k=Math.abs(P-b.right),A=Math.min(I,k);let R;const O=p/a*(c+1);if(b.isDash){const W=c-Math.abs(O);R=Math.sqrt(A*A+W*W)}else R=c-Math.sqrt(A*A+O*O);this.data[_+P]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e){for(let x=e.length-1;x>=0;--x){const b=e[x],P=e[x+1];b.zeroLength?e.splice(x,1):P&&P.isDash===b.isDash&&(P.left=b.left,e.splice(x,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const c=this.width*this.nextRow;let p=0,_=e[p];for(let x=0;x<this.width;x++){x/_.right>1&&(_=e[++p]);const b=Math.abs(x-_.left),P=Math.abs(x-_.right),I=Math.min(b,P);this.data[c+x]=Math.max(0,Math.min(255,(_.isDash?I:-I)+128))}}addDash(e,n){const a=n?7:0,c=2*a+1;if(this.nextRow+c>this.height)return o.w("LineAtlas out of space"),null;let p=0;for(let x=0;x<e.length;x++)p+=e[x];if(p!==0){const x=this.width/p,b=this.getDashRanges(e,this.width,x);n?this.addRoundDash(b,x,a):this.addRegularDash(b)}const _={y:(this.nextRow+a+.5)/this.height,height:2*a/this.height,width:p};return this.nextRow+=c,this.dirty=!0,_}bind(e){const n=e.gl;this.texture?(n.bindTexture(n.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.width,this.height,n.ALPHA,n.UNSIGNED_BYTE,this.data))):(this.texture=n.createTexture(),n.bindTexture(n.TEXTURE_2D,this.texture),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.REPEAT),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texImage2D(n.TEXTURE_2D,0,n.ALPHA,this.width,this.height,0,n.ALPHA,n.UNSIGNED_BYTE,this.data))}}const lr="maplibre_preloaded_worker_pool";class Nt{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Nt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((n=>{n.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[lr]}numActive(){return Object.keys(this.active).length}}const qt=Math.floor(he.hardwareConcurrency/2);let Kt,Jt;function vr(){return Kt||(Kt=new Nt),Kt}Nt.workerCount=o.H(globalThis)?Math.max(Math.min(qt,3),1):1;class Qt{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=n;const a=this.workerPool.acquire(n);for(let c=0;c<a.length;c++){const p=new o.J(a[c],n);p.name=`Worker ${c}`,this.actors.push(p)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,n){const a=[];for(const c of this.actors)a.push(c.sendAsync({type:e,data:n}));return Promise.all(a)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((n=>{n.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,n){for(const a of this.actors)a.registerMessageHandler(e,n)}}function Jr(){return Jt||(Jt=new Qt(vr(),o.K),Jt.registerMessageHandler("GR",((h,e,n)=>o.m(e,n)))),Jt}function Vt(h,e){const n=o.L();return o.M(n,n,[1,1,0]),o.N(n,n,[.5*h.width,.5*h.height,1]),h.calculatePosMatrix?o.O(n,n,h.calculatePosMatrix(e.toUnwrapped())):n}function kt(h,e,n,a,c,p,_){var x;const b=(function(A,R,O){if(A)for(const W of A){const G=R[W];if(G&&G.source===O&&G.type==="fill-extrusion")return!0}else for(const W in R){const G=R[W];if(G.source===O&&G.type==="fill-extrusion")return!0}return!1})((x=c?.layers)!==null&&x!==void 0?x:null,e,h.id),P=p.maxPitchScaleFactor(),I=h.tilesIn(a,P,b);I.sort(Ft);const k=[];for(const A of I)k.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(e,n,h._state,A.queryGeometry,A.cameraQueryGeometry,A.scale,c,p,P,Vt(h.transform,A.tileID),_?(R,O)=>_(A.tileID,R,O):void 0)});return(function(A,R){for(const O in A)for(const W of A[O])Ot(W,R);return A})((function(A){const R={},O={};for(const W of A){const G=W.queryResults,H=W.wrappedTileID,J=O[H]=O[H]||{};for(const ie in G){const Q=G[ie],se=J[ie]=J[ie]||{},ue=R[ie]=R[ie]||[];for(const ee of Q)se[ee.featureIndex]||(se[ee.featureIndex]=!0,ue.push(ee))}}return R})(k),h)}function Ft(h,e){const n=h.tileID,a=e.tileID;return n.overscaledZ-a.overscaledZ||n.canonical.y-a.canonical.y||n.wrap-a.wrap||n.canonical.x-a.canonical.x}function Ot(h,e){const n=h.feature,a=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=a}function Rt(h,e,n){return o._(this,void 0,void 0,(function*(){let a=h;if(h.url?a=(yield o.j(e.transformRequest(h.url,"Source"),n)).data:yield he.frameAsync(n),!a)return null;const c=o.Q(o.e(a,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in a&&a.vector_layers&&(c.vectorLayerIds=a.vector_layers.map((p=>p.id))),c}))}class yt{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof o.S?new o.S(e.lng,e.lat):o.S.convert(e),this}extend(e){const n=this._sw,a=this._ne;let c,p;if(e instanceof o.S)c=e,p=e;else{if(!(e instanceof yt))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(yt.convert(e)):this.extend(o.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(o.S.convert(e)):this;if(c=e._sw,p=e._ne,!c||!p)return this}return n||a?(n.lng=Math.min(c.lng,n.lng),n.lat=Math.min(c.lat,n.lat),a.lng=Math.max(p.lng,a.lng),a.lat=Math.max(p.lat,a.lat)):(this._sw=new o.S(c.lng,c.lat),this._ne=new o.S(p.lng,p.lat)),this}getCenter(){return new o.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.S(this.getWest(),this.getNorth())}getSouthEast(){return new o.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:a}=o.S.convert(e);let c=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&c}static convert(e){return e instanceof yt?e:e&&new yt(e)}static fromLngLat(e,n=0){const a=360*n/40075017,c=a/Math.cos(Math.PI/180*e.lat);return new yt(new o.S(e.lng-c,e.lat-a),new o.S(e.lng+c,e.lat+a))}adjustAntiMeridian(){const e=new o.S(this._sw.lng,this._sw.lat),n=new o.S(this._ne.lng,this._ne.lat);return new yt(e,e.lng>n.lng?new o.S(n.lng+360,n.lat):n)}}class Gt{constructor(e,n,a){this.bounds=yt.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=a||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),a=Math.floor(o.V(this.bounds.getWest())*n),c=Math.floor(o.U(this.bounds.getNorth())*n),p=Math.ceil(o.V(this.bounds.getEast())*n),_=Math.ceil(o.U(this.bounds.getSouth())*n);return e.x>=a&&e.x<p&&e.y>=c&&e.y<_}}class mr extends o.E{constructor(e,n,a,c){if(super(),this.id=e,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.Q(n,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Rt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(o.e(this,e),e.bounds&&(this.tileBounds=new Gt(e.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new o.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(e){return o._(this,void 0,void 0,(function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a={request:this.map._requestManager.transformRequest(n,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};a.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((p,_)=>{e.reloadPromise={resolve:p,reject:_}}))}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const p=yield e.actor.sendAsync({type:c,data:a},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,p)}catch(p){if(delete e.abortController,e.aborted)return;if(p&&p.status!==404)throw p;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,n){if(n&&n.resourceTiming&&(e.resourceTiming=n.resourceTiming),n&&this.map._refreshExpiredTiles&&e.setExpiryData(n),e.loadVectorData(n,this.map.painter),e.reloadPromise){const a=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(a.resolve).catch(a.reject)}}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Gr extends o.E{constructor(e,n,a,c){super(),this.id=e,this.dispatcher=a,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},n),o.e(this,o.Q(n,["url","scheme","tileSize"]))}load(){return o._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const n=yield Rt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,n&&(o.e(this,n),n.bounds&&(this.tileBounds=new Gt(n.bounds,this.minzoom,this.maxzoom)),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(n){this._tileJSONRequest=null,this.fire(new o.k(n))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return o.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return o._(this,void 0,void 0,(function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const a=yield ae.getImage(this.map._requestManager.transformRequest(n,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(a&&a.data){this.map._refreshExpiredTiles&&(a.cacheControl||a.expires)&&e.setExpiryData({cacheControl:a.cacheControl,expires:a.expires});const c=this.map.painter.context,p=c.gl,_=a.data;e.texture=this.map.painter.getTileTexture(_.width),e.texture?e.texture.update(_,{useMipmap:!0}):(e.texture=new o.T(c,_,p.RGBA,{useMipmap:!0}),e.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE,p.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(a){if(delete e.abortController,e.aborted)e.state="unloaded";else if(a)throw e.state="errored",a}}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class xr extends Gr{constructor(e,n,a,c){super(e,n,a,c),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox",this.redFactor=n.redFactor,this.greenFactor=n.greenFactor,this.blueFactor=n.blueFactor,this.baseShift=n.baseShift}loadTile(e){return o._(this,void 0,void 0,(function*(){const n=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),a=this.map._requestManager.transformRequest(n,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield ae.getImage(a,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const p=c.data;this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const _=o.b(p)&&o.W()?p:yield this.readImageNow(p),x={type:this.type,uid:e.uid,source:this.id,rawImageData:_,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const b=yield e.actor.sendAsync({type:"LDT",data:x});e.dem=b,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}}))}readImageNow(e){return o._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&o.X()){const n=e.width+2,a=e.height+2;try{return new o.R({width:n,height:a},yield o.Y(e,-1,-1,n,a))}catch{}}return he.getImageData(e,1)}))}_getNeighboringTiles(e){const n=e.canonical,a=Math.pow(2,n.z),c=(n.x-1+a)%a,p=n.x===0?e.wrap-1:e.wrap,_=(n.x+1+a)%a,x=n.x+1===a?e.wrap+1:e.wrap,b={};return b[new o.Z(e.overscaledZ,p,n.z,c,n.y).key]={backfilled:!1},b[new o.Z(e.overscaledZ,x,n.z,_,n.y).key]={backfilled:!1},n.y>0&&(b[new o.Z(e.overscaledZ,p,n.z,c,n.y-1).key]={backfilled:!1},b[new o.Z(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},b[new o.Z(e.overscaledZ,x,n.z,_,n.y-1).key]={backfilled:!1}),n.y+1<a&&(b[new o.Z(e.overscaledZ,p,n.z,c,n.y+1).key]={backfilled:!1},b[new o.Z(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},b[new o.Z(e.overscaledZ,x,n.z,_,n.y+1).key]={backfilled:!1}),b}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class Ar extends o.E{constructor(e,n,a,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:n.data},this.actor=a.getActor(),this.setEventedParent(c),this._data=n.data,this._options=o.e({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId,n.clusterMaxZoom!==void 0&&this.maxzoom<=n.clusterMaxZoom&&o.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${n.clusterMaxZoom}".`),this.workerOptions=o.e({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(n.buffer!==void 0?n.buffer:128),tolerance:this._pixelsToTileUnits(n.tolerance!==void 0?n.tolerance:.375),extent:o.$,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(n.clusterMaxZoom),minPoints:Math.max(2,n.clusterMinPoints||2),extent:o.$,radius:this._pixelsToTileUnits(n.clusterRadius||50),log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(e){return e*(o.$/this.tileSize)}_getClusterMaxZoom(e){const n=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||o.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${n}"`),n}load(){return o._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=o.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return o._(this,void 0,void 0,(function*(){const e=o.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((n=>n.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return o._(this,void 0,void 0,(function*(){const e=new yt,n=yield this.getData();let a;switch(n.type){case"FeatureCollection":a=n.features.map((c=>this.getCoordinatesFromGeometry(c.geometry))).flat(1/0);break;case"Feature":a=this.getCoordinatesFromGeometry(n.geometry);break;default:a=this.getCoordinatesFromGeometry(n)}if(a.length==0)return e;for(let c=0;c<a.length-1;c+=2)e.extend([a[c],a[c+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom))),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,n,a){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:n,offset:a}})}_updateWorkerData(){return o._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;const{data:e,diff:n}=this._pendingWorkerUpdate;if(!e&&!n)return void o.w(`No data or diff provided to GeoJSONSource ${this.id}.`);const a=o.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(a.request=this.map._requestManager.transformRequest(he.resolveURL(e),"Source"),a.request.collectResourceTiming=this._collectResourceTiming):a.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):n&&(a.dataDiff=n,this._pendingWorkerUpdate.diff=void 0),this._isUpdatingWorker=!0,this.fire(new o.l("dataloading",{dataType:"source"}));try{const c=yield this.actor.sendAsync({type:"LD",data:a});if(this._isUpdatingWorker=!1,this._removed||c.abandoned)return void this.fire(new o.l("dataabort",{dataType:"source"}));this._data=c.data;let p=null;c.resourceTiming&&c.resourceTiming[this.id]&&(p=c.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&p&&p.length>0&&o.e(_,{resourceTiming:p}),this.fire(new o.l("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new o.l("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(c){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new o.l("dataabort",{dataType:"source"}));this.fire(new o.k(c))}finally{(this._pendingWorkerUpdate.data||this._pendingWorkerUpdate.diff)&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&this._pendingWorkerUpdate.data===void 0&&this._pendingWorkerUpdate.diff===void 0}loadTile(e){return o._(this,void 0,void 0,(function*(){const n=e.actor?"RT":"LT";e.actor=this.actor;const a={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity,globalState:this.map.getGlobalState()};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:n,data:a},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,n==="RT")}))}abortTile(e){return o._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return o._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class pr extends o.E{constructor(e,n,a,c){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=a,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=n}load(e){return o._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new o.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const n=yield ae.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,n&&n.data&&(this.image=n.data,e&&(this.coordinates=e),this._finishLoading())}catch(n){this._request=null,this._loaded=!0,this.fire(new o.k(n))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const n=e.map(o.a1.fromLngLat);var a;return this.tileID=(function(c){const p=o.a2.fromPoints(c),_=p.width(),x=p.height(),b=Math.max(_,x),P=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),I=Math.pow(2,P);return new o.a4(P,Math.floor((p.minX+p.maxX)/2*I),Math.floor((p.minY+p.maxY)/2*I))})(n),this.terrainTileRanges=this._getOverlappingTileRanges(n),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=n.map((c=>this.tileID.getTilePoint(c)._round())),this.flippedWindingOrder=((a=this.tileCoords)[1].x-a[0].x)*(a[2].y-a[0].y)-(a[1].y-a[0].y)*(a[2].x-a[0].x)<0,this.fire(new o.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,n=e.gl;this.texture||(this.texture=new o.T(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,a=!0)}a&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return o._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:n,minY:a,maxX:c,maxY:p}=o.a2.fromPoints(e),_={};for(let x=0;x<=o.a3;x++){const b=Math.pow(2,x),P=Math.floor(n*b),I=Math.floor(a*b),k=Math.floor(c*b),A=Math.floor(p*b);_[x]={minTileX:P,minTileY:I,maxTileX:k,maxTileY:A}}return _}}class Sr extends pr{constructor(e,n,a,c){super(e,n,a,c),this.roundZoom=!0,this.type="video",this.options=n}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,"Source").url);try{const n=yield o.a5(this.urls);if(this._loaded=!0,!n)return;this.video=n,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(n){this.fire(new o.k(n))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new o.k(new o.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE));let a=!1;for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture,a=!0)}a&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class br extends pr{constructor(e,n,a,c){super(e,n,a,c),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some((p=>!Array.isArray(p)||p.length!==2||p.some((_=>typeof _!="number"))))||this.fire(new o.k(new o.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.k(new o.a6(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new o.k(new o.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof HTMLCanvasElement||this.fire(new o.k(new o.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.k(new o.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){return o._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context,a=n.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(n,this.canvas,a.RGBA,{premultiply:!0});let c=!1;for(const p in this.tiles){const _=this.tiles[p];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,c=!0)}c&&this.fire(new o.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const gr={},Br=h=>{switch(h){case"geojson":return Ar;case"image":return pr;case"raster":return Gr;case"raster-dem":return xr;case"vector":return mr;case"video":return Sr;case"canvas":return br}return gr[h]},Fr="RTLPluginLoaded";class Qr extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Jr()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((n=>{throw this.status="error",n}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return o._(this,arguments,void 0,(function*(n,a=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=he.resolveURL(n),!this.url)throw new Error(`requested url ${n} is invalid`);if(this.status==="unavailable"){if(!a)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return o._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.l(Fr))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let ei=null;function Ui(){return ei||(ei=new Qr),ei}class an{constructor(e,n){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=o.a7(),this.uses=0,this.tileSize=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const n=e+this.timeAdded;n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,n,a){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(c,p){const _={};if(!p)return _;for(const x of c){const b=x.layerIds.map((P=>p.getLayer(P))).filter(Boolean);if(b.length!==0){x.layers=b,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map((P=>b.filter((I=>I.id===P))[0])));for(const P of b)_[P.id]=x}}return _})(e.buckets,n?.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const p=this.buckets[c];if(p instanceof o.a9){if(this.hasSymbolBuckets=!0,!a)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const p=this.buckets[c];if(p instanceof o.a9&&p.hasRTLText){this.hasRTLText=!0,Ui().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const p=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(c).queryRadius(p))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new o.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const a in this.buckets){const c=this.buckets[a];c.uploadPending()&&c.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new o.T(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,a,c,p,_,x,b,P,I,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:p,scale:_,tileSize:this.tileSize,pixelPosMatrix:I,transform:b,params:x,queryPadding:this.queryPadding*P,getElevation:k},e,n,a):{}}querySourceFeatures(e,n){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const c=a.loadVTLayers(),p=n&&n.sourceLayer?n.sourceLayer:"",_=c._geojsonTileLayer||c[p];if(!_)return;const x=o.aa(n&&n.filter),{z:b,x:P,y:I}=this.tileID.canonical,k={z:b,x:P,y:I};for(let A=0;A<_.length;A++){const R=_.feature(A);if(x.needGeometry){const G=o.ab(R,!0);if(!x.filter(new o.F(this.tileID.overscaledZ),G,this.tileID.canonical))continue}else if(!x.filter(new o.F(this.tileID.overscaledZ),R))continue;const O=a.getId(R,p),W=new o.ac(R,b,P,I,O);W.tile=k,e.push(W)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const a=o.ad(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let c=!1;if(this.expirationTime>a)c=!1;else if(n)if(this.expirationTime<n)c=!0;else{const p=this.expirationTime-n;p?this.expirationTime=a+Math.max(p,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const a=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!n.style.hasLayer(c))continue;const p=this.buckets[c],_=p.layers[0].sourceLayer||"_geojsonTileLayer",x=a[_],b=e[_];if(!x||!b||Object.keys(b).length===0)continue;p.update(b,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=n&&n.style&&n.style.getLayer(c);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(p)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<he.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=he.now()+e}setDependencies(e,n){const a={};for(const c of n)a[c]=!0;this.dependencies[e]=a}hasDependency(e,n){for(const a of e){const c=this.dependencies[a];if(c){for(const p of n)if(c[p])return!0}}return!1}}class fe{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,a){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const p={value:n,timeout:void 0};if(a!==void 0&&(p.timeout=setTimeout((()=>{this.remove(e,p)}),a)),this.data[c].push(p),this.order.push(c),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const a=e.wrapped().key,c=n===void 0?0:this.data[a].indexOf(n),p=this.data[a][c];return this.data[a].splice(c,1),p.timeout&&clearTimeout(p.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(p.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const a in this.data)for(const c of this.data[a])e(c.value)||n.push(c);for(const a of n)this.remove(a.value.tileID,a)}}class j{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,a){const c=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},o.e(this.stateChanges[e][c],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==c&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const p in this.state[e][c])a[p]||(this.deletedStates[e][c][p]=null)}else for(const p in a)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][p]===null&&delete this.deletedStates[e][c][p]}removeFeatureState(e,n,a){if(this.deletedStates[e]===null)return;const c=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&n!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][a]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(a in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][a]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,n){const a=String(n),c=o.e({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][n];if(p===null)return{};for(const _ in p)delete c[_]}return c}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const a={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const p={};for(const _ in this.stateChanges[c])this.state[c][_]||(this.state[c][_]={}),o.e(this.state[c][_],this.stateChanges[c][_]),p[_]=this.state[c][_];a[c]=p}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const p={};if(this.deletedStates[c]===null)for(const _ in this.state[c])p[_]={},this.state[c][_]={};else for(const _ in this.deletedStates[c]){if(this.deletedStates[c][_]===null)this.state[c][_]={};else for(const x of Object.keys(this.deletedStates[c][_]))delete this.state[c][_][x];p[_]=this.state[c][_]}a[c]=a[c]||{},o.e(a[c],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const c in e)e[c].setFeatureState(a,n)}}const V=89.25;function $(h,e){const n=o.ah(e.lat,-o.ai,o.ai);return new o.P(o.V(e.lng)*h,o.U(n)*h)}function te(h,e){return new o.a1(e.x/h,e.y/h).toLngLat()}function U(h){return h.cameraToCenterDistance*Math.min(.85*Math.tan(o.ae(90-h.pitch)),Math.tan(o.ae(V-h.pitch)))}function re(h,e){const n=h.canonical,a=e/o.af(n.z),c=n.x+Math.pow(2,n.z)*h.wrap,p=o.ag(new Float64Array(16));return o.M(p,p,[c*a,n.y*a,0]),o.N(p,p,[a/o.$,a/o.$,1]),p}function pe(h,e,n,a,c){const p=o.a1.fromLngLat(h,e),_=c*o.aj(1,h.lat),x=_*Math.cos(o.ae(n)),b=Math.sqrt(_*_-x*x),P=b*Math.sin(o.ae(-a)),I=b*Math.cos(o.ae(-a));return new o.a1(p.x+P,p.y+I,p.z+x)}function le(h,e,n){const a=e.intersectsFrustum(h);if(!n||a===0)return a;const c=e.intersectsPlane(n);return c===0?0:a===2&&c===2?2:1}function ye(h,e,n){let a=0;const c=(n-e)/10;for(let p=0;p<10;p++)a+=c*Math.pow(Math.cos(e+(p+.5)/10*(n-e)),h);return a}function ze(h,e){return function(n,a,c,p,_){const x=2*((h-1)/o.ak(Math.cos(o.ae(V-_))/Math.cos(o.ae(V)))-1),b=Math.acos(c/p),P=2*ye(x-1,0,o.ae(_/2)),I=Math.min(o.ae(V),b+o.ae(_/2)),k=ye(x-1,Math.min(I,b-o.ae(_/2)),I),A=Math.atan(a/c),R=Math.hypot(a,c);let O=n;return O+=o.ak(p/R/Math.max(.5,Math.cos(o.ae(_/2)))),O+=x*o.ak(Math.cos(A))/2,O-=o.ak(Math.max(1,k/P/e))/2,O}}const Ie=ze(9.314,3);function Ke(h,e){const n=(e.roundZoom?Math.round:Math.floor)(h.zoom+o.ak(h.tileSize/e.tileSize));return Math.max(0,n)}function _e(h,e){const n=h.getCameraFrustum(),a=h.getClippingPlane(),c=h.screenPointToMercatorCoordinate(h.getCameraPoint()),p=o.a1.fromLngLat(h.center,h.elevation);c.z=p.z+Math.cos(h.pitchInRadians)*h.cameraToCenterDistance/h.worldSize;const _=h.getCoveringTilesDetailsProvider(),x=_.allowVariableZoom(h,e),b=Ke(h,e),P=e.minzoom||0,I=e.maxzoom!==void 0?e.maxzoom:h.maxZoom,k=Math.min(Math.max(0,b),I),A=Math.pow(2,k),R=[A*c.x,A*c.y,0],O=[A*p.x,A*p.y,0],W=Math.hypot(p.x-c.x,p.y-c.y),G=Math.abs(p.z-c.z),H=Math.hypot(W,G),J=se=>({zoom:0,x:0,y:0,wrap:se,fullyVisible:!1}),ie=[],Q=[];if(h.renderWorldCopies&&_.allowWorldCopies())for(let se=1;se<=3;se++)ie.push(J(-se)),ie.push(J(se));for(ie.push(J(0));ie.length>0;){const se=ie.pop(),ue=se.x,ee=se.y;let ge=se.fullyVisible;const Te={x:ue,y:ee,z:se.zoom},ve=_.getTileBoundingVolume(Te,se.wrap,h.elevation,e);if(!ge){const Ve=le(n,ve,a);if(Ve===0)continue;ge=Ve===2}const xe=_.distanceToTile2d(c.x,c.y,Te,ve);let we=b;x&&(we=(e.calculateTileZoom||Ie)(h.zoom+o.ak(h.tileSize/e.tileSize),xe,G,H,h.fov)),we=(e.roundZoom?Math.round:Math.floor)(we),we=Math.max(0,we);const Fe=Math.min(we,I);if(se.wrap=_.getWrap(p,Te,se.wrap),se.zoom>=Fe){if(se.zoom<P)continue;const Ve=k-se.zoom,Le=R[0]-.5-(ue<<Ve),Ye=R[1]-.5-(ee<<Ve),Tt=e.reparseOverscaled?Math.max(se.zoom,we):se.zoom;Q.push({tileID:new o.Z(se.zoom===I?Tt:se.zoom,se.wrap,se.zoom,ue,ee),distanceSq:o.al([O[0]-.5-ue,O[1]-.5-ee]),tileDistanceToCamera:Math.sqrt(Le*Le+Ye*Ye)})}else for(let Ve=0;Ve<4;Ve++)ie.push({zoom:se.zoom+1,x:(ue<<1)+Ve%2,y:(ee<<1)+(Ve>>1),wrap:se.wrap,fullyVisible:ge})}return Q.sort(((se,ue)=>se.distanceSq-ue.distanceSq)).map((se=>se.tileID))}const ot=o.a2.fromPoints([new o.P(0,0),new o.P(o.$,o.$)]);class bt extends o.E{constructor(e,n,a){super(),this.id=e,this.dispatcher=a,this.on("data",(c=>this._dataHandler(c))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((c,p,_,x)=>{const b=new(Br(p.type))(c,p,_,x);if(b.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${b.id}`);return b})(e,n,a,this),this._tiles={},this._cache=new fe(0,(c=>this._unloadTile(c))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new j,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const n=this._tiles[e];if(n.state!=="loaded"&&n.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,n,a){return o._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,n,a)}catch(c){e.state="errored",c.status!==404?this._source.fire(new o.k(c,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new o.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const a=this._tiles[n];a.upload(e),a.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(Qe).map((e=>e.key))}getRenderableIds(e){const n=[];for(const a in this._tiles)this._isIdRenderable(a,e)&&n.push(this._tiles[a]);return e?n.sort(((a,c)=>{const p=a.tileID,_=c.tileID,x=new o.P(p.canonical.x,p.canonical.y)._rotate(-this.transform.bearingInRadians),b=new o.P(_.canonical.x,_.canonical.y)._rotate(-this.transform.bearingInRadians);return p.overscaledZ-_.overscaledZ||b.y-x.y||b.x-x.x})).map((a=>a.tileID.key)):n.map((a=>a.tileID)).sort(Qe).map((a=>a.key))}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)e?this._reloadTile(n,"expired"):this._tiles[n].state!=="errored"&&this._reloadTile(n,"reloading")}}_reloadTile(e,n){return o._(this,void 0,void 0,(function*(){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=n),yield this._loadTile(a,e,n))}))}_tileLoaded(e,n,a){e.timeAdded=he.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new o.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const n=this.getRenderableIds();for(let c=0;c<n.length;c++){const p=n[c];if(e.neighboringTiles&&e.neighboringTiles[p]){const _=this.getTileByID(p);a(e,_),a(_,e)}}function a(c,p){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let _=p.tileID.canonical.x-c.tileID.canonical.x;const x=p.tileID.canonical.y-c.tileID.canonical.y,b=Math.pow(2,c.tileID.canonical.z),P=p.tileID.key;_===0&&x===0||Math.abs(x)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),p.dem&&c.dem&&(c.dem.backfillBorder(p.dem,_,x),c.neighboringTiles&&c.neighboringTiles[P]&&(c.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,a,c){for(const p in this._tiles){let _=this._tiles[p];if(c[p]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>a)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const P=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[P.key],_&&_.hasData()&&(x=P)}let b=x;for(;b.overscaledZ>n;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]||e[b.canonical.key]){c[x.key]=x;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=n?a:null}for(let a=e.overscaledZ-1;a>=n;a--){const c=e.scaledTo(a),p=this._getLoadedTile(c);if(p)return p}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const n=Math.ceil(e.width/this._source.tileSize)+1,a=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(n*a*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),p=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(p)}handleWrapJump(e){const n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){const a={};for(const c in this._tiles){const p=this._tiles[c];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+n),a[p.tileID.key]=p}this._tiles=a;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,n,a,c,p,_){const x={},b={},P=Object.keys(e),I=he.now();for(const k of P){const A=e[k],R=this._tiles[k];if(!R||R.fadeEndTime!==0&&R.fadeEndTime<=I)continue;const O=this.findLoadedParent(A,n),W=this.findLoadedSibling(A),G=O||W||null;G&&(this._addTile(G.tileID),x[G.tileID.key]=G.tileID),b[k]=A}this._retainLoadedChildren(b,c,a,e);for(const k in x)e[k]||(this._coveredTiles[k]=!0,e[k]=x[k]);if(_){const k={},A={};for(const R of p)this._tiles[R.key].hasData()?k[R.key]=R:A[R.key]=R;for(const R in A){const O=A[R].children(this._source.maxzoom);this._tiles[O[0].key]&&this._tiles[O[1].key]&&this._tiles[O[2].key]&&this._tiles[O[3].key]&&(k[O[0].key]=e[O[0].key]=O[0],k[O[1].key]=e[O[1].key]=O[1],k[O[2].key]=e[O[2].key]=O[2],k[O[3].key]=e[O[3].key]=O[3],delete A[R])}for(const R in A){const O=A[R],W=this.findLoadedParent(O,this._source.minzoom),G=this.findLoadedSibling(O),H=W||G||null;if(H){k[H.tileID.key]=e[H.tileID.key]=H.tileID;for(const J in k)k[J].isChildOf(H.tileID)&&delete k[J]}}for(const R in this._tiles)k[R]||(this._coveredTiles[R]=!0)}}update(e,n){if(!this._sourceLoaded||this._paused)return;let a;this.transform=e,this.terrain=n,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((I=>new o.Z(I.canonical.z,I.wrap,I.canonical.z,I.canonical.x,I.canonical.y))):(a=_e(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:n,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(a=a.filter((I=>this._source.hasTile(I))))):a=[];const c=Ke(e,this._source),p=Math.max(c-bt.maxOverzooming,this._source.minzoom),_=Math.max(c+bt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const I={};for(const k of a)if(k.canonical.z>this._source.minzoom){const A=k.scaledTo(k.canonical.z-1);I[A.key]=A;const R=k.scaledTo(Math.max(this._source.minzoom,Math.min(k.canonical.z,5)));I[R.key]=R}a=a.concat(Object.values(I))}const x=a.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,x&&this.fire(new o.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const b=this._updateRetainedTiles(a,c);dt(this._source.type)&&this._updateCoveredAndRetainedTiles(b,p,_,c,a,n);for(const I in b)this._tiles[I].clearFadeHold();const P=o.am(this._tiles,b);for(const I of P){const k=this._tiles[I];k.hasSymbolBuckets&&!k.holdingForFade()?k.setHoldDuration(this.map._fadeDuration):k.hasSymbolBuckets&&!k.symbolFadeFinished()||this._removeTile(I)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,n){var a;const c={},p={},_=Math.max(n-bt.maxOverzooming,this._source.minzoom),x=Math.max(n+bt.maxUnderzooming,this._source.minzoom),b={};for(const P of e){const I=this._addTile(P);c[P.key]=P,I.hasData()||n<this._source.maxzoom&&(b[P.key]=P)}this._retainLoadedChildren(b,n,x,c);for(const P of e){let I=this._tiles[P.key];if(I.hasData())continue;if(n+1>this._source.maxzoom){const A=P.children(this._source.maxzoom)[0],R=this.getTile(A);if(R&&R.hasData()){c[A.key]=A;continue}}else{const A=P.children(this._source.maxzoom);if(c[A[0].key]&&c[A[1].key]&&c[A[2].key]&&c[A[3].key])continue}let k=I.wasRequested();for(let A=P.overscaledZ-1;A>=_;--A){const R=P.scaledTo(A);if(p[R.key])break;if(p[R.key]=!0,I=this.getTile(R),!I&&k&&(I=this._addTile(R)),I){const O=I.hasData();if((O||!(!((a=this.map)===null||a===void 0)&&a.cancelPendingTileRequestsWhileZooming)||k)&&(c[R.key]=R),k=I.wasRequested(),O)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let a,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){a=this._loadedParentTiles[c.key];break}n.push(c.key);const p=c.scaledTo(c.overscaledZ-1);if(a=this._getLoadedTile(p),a)break;c=p}for(const p of n)this._loadedParentTiles[p]=a}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const n=this._tiles[e].tileID,a=this._getLoadedTile(n);this._loadedSiblingTiles[n.key]=a}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const a=n;return n||(n=new an(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,e.key,n.state)),n.uses++,this._tiles[e.key]=n,a||this._source.fire(new o.l("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=n.getExpiryTimeout();a&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),a))}refreshTiles(e){for(const n in this._tiles)(this._isIdRenderable(n)||this._tiles[n].state=="errored")&&e.some((a=>a.equals(this._tiles[n].tileID.canonical)))&&this._reloadTile(n,"expired")}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}_dataHandler(e){const n=e.sourceDataType;e.dataType==="source"&&n==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&n==="content"&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,n,a){const c=[],p=this.transform;if(!p)return c;const _=p.getCoveringTilesDetailsProvider().allowWorldCopies(),x=a?p.getCameraQueryGeometry(e):e,b=R=>p.screenPointToMercatorCoordinate(R,this.terrain),P=this.transformBbox(e,b,!_),I=this.transformBbox(x,b,!_),k=this.getIds(),A=o.a2.fromPoints(I);for(let R=0;R<k.length;R++){const O=this._tiles[k[R]];if(O.holdingForFade())continue;const W=_?[O.tileID]:[O.tileID.unwrapTo(-1),O.tileID.unwrapTo(0)],G=Math.pow(2,p.zoom-O.tileID.overscaledZ),H=n*O.queryPadding*o.$/O.tileSize/G;for(const J of W){const ie=A.map((Q=>J.getTilePoint(new o.a1(Q.x,Q.y))));if(ie.expandBy(H),ie.intersects(ot)){const Q=P.map((ue=>J.getTilePoint(ue))),se=I.map((ue=>J.getTilePoint(ue)));c.push({tile:O,tileID:_?J:J.unwrapTo(0),queryGeometry:Q,cameraQueryGeometry:se,scale:G})}}}return c}transformBbox(e,n,a){let c=e.map(n);if(a){const p=o.a2.fromPoints(e);p.shrinkBy(.001*Math.min(p.width(),p.height()));const _=p.map(n);o.a2.fromPoints(c).covers(_)||(c=c.map((x=>x.x>.5?new o.a1(x.x-1,x.y,x.z):x)))}return c}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map((a=>this._tiles[a].tileID));return this.transform&&this.transform.populateCache(n),n}hasTransition(){if(this._source.hasTransition())return!0;if(dt(this._source.type)){const e=he.now();for(const n in this._tiles)if(this._tiles[n].fadeEndTime>=e)return!0}return!1}setFeatureState(e,n,a){this._state.updateState(e=e||"_geojsonTileLayer",n,a)}removeFeatureState(e,n,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,a)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,a){const c=this._tiles[e];c&&c.setDependencies(n,a)}reloadTilesForDependencies(e,n){for(const a in this._tiles)this._tiles[a].hasDependency(e,n)&&this._reloadTile(a,"reloading");this._cache.filter((a=>!a.hasDependency(e,n)))}}function Qe(h,e){const n=Math.abs(2*h.wrap)-+(h.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return h.overscaledZ-e.overscaledZ||a-n||e.canonical.y-h.canonical.y||e.canonical.x-h.canonical.x}function dt(h){return h==="raster"||h==="image"||h==="video"}bt.maxOverzooming=10,bt.maxUnderzooming=3;class tr{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=o.ah(e,0,1);let n=1,a=this._distances[n];const c=e*this.paddedLength+this.padding;for(;a<c&&n<this._distances.length;)a=this._distances[++n];const p=n-1,_=this._distances[p],x=a-_,b=x>0?(c-_)/x:0;return this.points[p].mult(1-b).add(this.points[n].mult(b))}}function kr(h,e){let n=!0;return h==="always"||h!=="never"&&e!=="never"||(n=!1),n}class Pr{constructor(e,n,a){const c=this.boxCells=[],p=this.circleCells=[];this.xCellCount=Math.ceil(e/a),this.yCellCount=Math.ceil(n/a);for(let _=0;_<this.xCellCount*this.yCellCount;_++)c.push([]),p.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,a,c,p){this._forEachCell(n,a,c,p,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(a),this.bboxes.push(c),this.bboxes.push(p)}insertCircle(e,n,a,c){this._forEachCell(n-c,a-c,n+c,a+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(a),this.circles.push(c)}_insertBoxCell(e,n,a,c,p,_){this.boxCells[p].push(_)}_insertCircleCell(e,n,a,c,p,_){this.circleCells[p].push(_)}_query(e,n,a,c,p,_,x){if(a<0||e>this.width||c<0||n>this.height)return[];const b=[];if(e<=0&&n<=0&&this.width<=a&&this.height<=c){if(p)return[{key:null,x1:e,y1:n,x2:a,y2:c}];for(let P=0;P<this.boxKeys.length;P++)b.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const I=this.circles[3*P],k=this.circles[3*P+1],A=this.circles[3*P+2];b.push({key:this.circleKeys[P],x1:I-A,y1:k-A,x2:I+A,y2:k+A})}}else this._forEachCell(e,n,a,c,this._queryCell,b,{hitTest:p,overlapMode:_,seenUids:{box:{},circle:{}}},x);return b}query(e,n,a,c){return this._query(e,n,a,c,!1,null)}hitTest(e,n,a,c,p,_){return this._query(e,n,a,c,!0,p,_).length>0}hitTestCircle(e,n,a,c,p){const _=e-a,x=e+a,b=n-a,P=n+a;if(x<0||_>this.width||P<0||b>this.height)return!1;const I=[];return this._forEachCell(_,b,x,P,this._queryCellCircle,I,{hitTest:!0,overlapMode:c,circle:{x:e,y:n,radius:a},seenUids:{box:{},circle:{}}},p),I.length>0}_queryCell(e,n,a,c,p,_,x,b){const{seenUids:P,hitTest:I,overlapMode:k}=x,A=this.boxCells[p];if(A!==null){const O=this.bboxes;for(const W of A)if(!P.box[W]){P.box[W]=!0;const G=4*W,H=this.boxKeys[W];if(e<=O[G+2]&&n<=O[G+3]&&a>=O[G+0]&&c>=O[G+1]&&(!b||b(H))&&(!I||!kr(k,H.overlapMode))&&(_.push({key:H,x1:O[G],y1:O[G+1],x2:O[G+2],y2:O[G+3]}),I))return!0}}const R=this.circleCells[p];if(R!==null){const O=this.circles;for(const W of R)if(!P.circle[W]){P.circle[W]=!0;const G=3*W,H=this.circleKeys[W];if(this._circleAndRectCollide(O[G],O[G+1],O[G+2],e,n,a,c)&&(!b||b(H))&&(!I||!kr(k,H.overlapMode))){const J=O[G],ie=O[G+1],Q=O[G+2];if(_.push({key:H,x1:J-Q,y1:ie-Q,x2:J+Q,y2:ie+Q}),I)return!0}}}return!1}_queryCellCircle(e,n,a,c,p,_,x,b){const{circle:P,seenUids:I,overlapMode:k}=x,A=this.boxCells[p];if(A!==null){const O=this.bboxes;for(const W of A)if(!I.box[W]){I.box[W]=!0;const G=4*W,H=this.boxKeys[W];if(this._circleAndRectCollide(P.x,P.y,P.radius,O[G+0],O[G+1],O[G+2],O[G+3])&&(!b||b(H))&&!kr(k,H.overlapMode))return _.push(!0),!0}}const R=this.circleCells[p];if(R!==null){const O=this.circles;for(const W of R)if(!I.circle[W]){I.circle[W]=!0;const G=3*W,H=this.circleKeys[W];if(this._circlesCollide(O[G],O[G+1],O[G+2],P.x,P.y,P.radius)&&(!b||b(H))&&!kr(k,H.overlapMode))return _.push(!0),!0}}}_forEachCell(e,n,a,c,p,_,x,b){const P=this._convertToXCellCoord(e),I=this._convertToYCellCoord(n),k=this._convertToXCellCoord(a),A=this._convertToYCellCoord(c);for(let R=P;R<=k;R++)for(let O=I;O<=A;O++)if(p.call(this,e,n,a,c,this.xCellCount*O+R,_,x,b))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,a,c,p,_){const x=c-e,b=p-n,P=a+_;return P*P>x*x+b*b}_circleAndRectCollide(e,n,a,c,p,_,x){const b=(_-c)/2,P=Math.abs(e-(c+b));if(P>b+a)return!1;const I=(x-p)/2,k=Math.abs(n-(p+I));if(k>I+a)return!1;if(P<=b||k<=I)return!0;const A=P-b,R=k-I;return A*A+R*R<=a*a}}function Ur(h,e,n){const a=o.L();if(!h){const{vecSouth:k,vecEast:A}=Ut(e),R=K();R[0]=A[0],R[1]=A[1],R[2]=k[0],R[3]=k[1],c=R,(I=(_=(p=R)[0])*(P=p[3])-(b=p[2])*(x=p[1]))&&(c[0]=P*(I=1/I),c[1]=-x*I,c[2]=-b*I,c[3]=_*I),a[0]=R[0],a[1]=R[1],a[4]=R[2],a[5]=R[3]}var c,p,_,x,b,P,I;return o.N(a,a,[1/n,1/n,1]),a}function zt(h,e,n,a){if(h){const c=o.L();if(!e){const{vecSouth:p,vecEast:_}=Ut(n);c[0]=_[0],c[1]=_[1],c[4]=p[0],c[5]=p[1]}return o.N(c,c,[a,a,1]),c}return n.pixelsToClipSpaceMatrix}function Ut(h){const e=Math.cos(h.rollInRadians),n=Math.sin(h.rollInRadians),a=Math.cos(h.pitchInRadians),c=Math.cos(h.bearingInRadians),p=Math.sin(h.bearingInRadians),_=o.ar();_[0]=-c*a*n-p*e,_[1]=-p*a*n+c*e;const x=o.as(_);x<1e-9?o.at(_):o.au(_,_,1/x);const b=o.ar();b[0]=c*a*e-p*n,b[1]=p*a*e+c*n;const P=o.as(b);return P<1e-9?o.at(b):o.au(b,b,1/P),{vecEast:b,vecSouth:_}}function qr(h,e,n,a){let c;a?(c=[h,e,a(h,e),1],o.aw(c,c,n)):(c=[h,e,0,1],la(c,c,n));const p=c[3];return{point:new o.P(c[0]/p,c[1]/p),signedDistanceFromCamera:p,isOccluded:!1}}function je(h,e){return .5+h/e*.5}function xi(h,e){return h.x>=-e[0]&&h.x<=e[0]&&h.y>=-e[1]&&h.y<=e[1]}function zr(h,e,n,a,c,p,_,x,b,P,I,k,A){const R=n?h.textSizeData:h.iconSizeData,O=o.an(R,e.transform.zoom),W=[256/e.width*2+1,256/e.height*2+1],G=n?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;G.clear();const H=h.lineVertexArray,J=n?h.text.placedSymbolArray:h.icon.placedSymbolArray,ie=e.transform.width/e.transform.height;let Q=!1;for(let se=0;se<J.length;se++){const ue=J.get(se);if(ue.hidden||ue.writingMode===o.ao.vertical&&!Q){In(ue.numGlyphs,G);continue}Q=!1;const ee=new o.P(ue.anchorX,ue.anchorY),ge={getElevation:A,pitchedLabelPlaneMatrix:a,lineVertexArray:H,pitchWithMap:p,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:ee,unwrappedTileID:b,width:P,height:I,translation:k},Te=ls(ue.anchorX,ue.anchorY,ge);if(!xi(Te.point,W)){In(ue.numGlyphs,G);continue}const ve=je(e.transform.cameraToCenterDistance,Te.signedDistanceFromCamera),xe=o.ap(R,O,ue),we=p?xe*e.transform.getPitchedTextCorrection(ue.anchorX,ue.anchorY,b)/ve:xe*ve,Fe=We({projectionContext:ge,pitchedLabelPlaneMatrixInverse:c,symbol:ue,fontSize:we,flip:!1,keepUpright:_,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:G,aspectRatio:ie,rotateToLine:x});Q=Fe.useVertical,(Fe.notEnoughRoom||Q||Fe.needsFlipping&&We({projectionContext:ge,pitchedLabelPlaneMatrixInverse:c,symbol:ue,fontSize:we,flip:!0,keepUpright:_,glyphOffsetArray:h.glyphOffsetArray,dynamicLayoutVertexArray:G,aspectRatio:ie,rotateToLine:x}).notEnoughRoom)&&In(ue.numGlyphs,G)}n?h.text.dynamicLayoutVertexBuffer.updateData(G):h.icon.dynamicLayoutVertexBuffer.updateData(G)}function os(h,e,n,a,c,p,_,x){const b=p.glyphStartIndex+p.numGlyphs,P=p.lineStartIndex,I=p.lineStartIndex+p.lineLength,k=e.getoffsetX(p.glyphStartIndex),A=e.getoffsetX(b-1),R=cs(h*k,n,a,c,p.segment,P,I,x,_);if(!R)return null;const O=cs(h*A,n,a,c,p.segment,P,I,x,_);return O?x.projectionCache.anyProjectionOccluded?null:{first:R,last:O}:null}function oa(h,e,n,a){return h===o.ao.horizontal&&Math.abs(n.y-e.y)>Math.abs(n.x-e.x)*a?{useVertical:!0}:(h===o.ao.vertical?e.y<n.y:e.x>n.x)?{needsFlipping:!0}:null}function We(h){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:n,symbol:a,fontSize:c,flip:p,keepUpright:_,glyphOffsetArray:x,dynamicLayoutVertexArray:b,aspectRatio:P,rotateToLine:I}=h,k=c/24,A=a.lineOffsetX*k,R=a.lineOffsetY*k;let O;if(a.numGlyphs>1){const W=a.glyphStartIndex+a.numGlyphs,G=a.lineStartIndex,H=a.lineStartIndex+a.lineLength,J=os(k,x,A,R,p,a,I,e);if(!J)return{notEnoughRoom:!0};const ie=ks(J.first.point.x,J.first.point.y,e,n),Q=ks(J.last.point.x,J.last.point.y,e,n);if(_&&!p){const se=oa(a.writingMode,ie,Q,P);if(se)return se}O=[J.first];for(let se=a.glyphStartIndex+1;se<W-1;se++){const ue=cs(k*x.getoffsetX(se),A,R,p,a.segment,G,H,e,I);if(!ue)return{notEnoughRoom:!0};O.push(ue)}O.push(J.last)}else{if(_&&!p){const G=mi(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,H=a.lineStartIndex+a.segment+1,J=new o.P(e.lineVertexArray.getx(H),e.lineVertexArray.gety(H)),ie=mi(J.x,J.y,e),Q=ie.signedDistanceFromCamera>0?ie.point:Ct(e.tileAnchorPoint,J,G,1,e),se=ks(G.x,G.y,e,n),ue=ks(Q.x,Q.y,e,n),ee=oa(a.writingMode,se,ue,P);if(ee)return ee}const W=cs(k*x.getoffsetX(a.glyphStartIndex),A,R,p,a.segment,a.lineStartIndex,a.lineStartIndex+a.lineLength,e,I);if(!W||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};O=[W]}for(const W of O)o.av(b,W.point,W.angle);return{}}function Ct(h,e,n,a,c){const p=h.add(h.sub(e)._unit()),_=mi(p.x,p.y,c).point,x=n.sub(_);return n.add(x._mult(a/x.mag()))}function Pt(h,e,n){const a=e.projectionCache;if(a.projections[h])return a.projections[h];const c=new o.P(e.lineVertexArray.getx(h),e.lineVertexArray.gety(h)),p=mi(c.x,c.y,e);if(p.signedDistanceFromCamera>0)return a.projections[h]=p.point,a.anyProjectionOccluded=a.anyProjectionOccluded||p.isOccluded,p.point;const _=h-n.direction;return Ct(n.distanceFromAnchor===0?e.tileAnchorPoint:new o.P(e.lineVertexArray.getx(_),e.lineVertexArray.gety(_)),c,n.previousVertex,n.absOffsetX-n.distanceFromAnchor+1,e)}function mi(h,e,n){const a=h+n.translation[0],c=e+n.translation[1];let p;return n.pitchWithMap?(p=qr(a,c,n.pitchedLabelPlaneMatrix,n.getElevation),p.isOccluded=!1):(p=n.transform.projectTileCoordinates(a,c,n.unwrappedTileID,n.getElevation),p.point.x=(.5*p.point.x+.5)*n.width,p.point.y=(.5*-p.point.y+.5)*n.height),p}function ks(h,e,n,a){if(n.pitchWithMap){const c=[h,e,0,1];return o.aw(c,c,a),n.transform.projectTileCoordinates(c[0]/c[3],c[1]/c[3],n.unwrappedTileID,n.getElevation).point}return{x:h/n.width*2-1,y:1-e/n.height*2}}function ls(h,e,n){return n.transform.projectTileCoordinates(h,e,n.unwrappedTileID,n.getElevation)}function wt(h,e,n){return h._unit()._perp()._mult(e*n)}function Zo(h,e,n,a,c,p,_,x,b){if(x.projectionCache.offsets[h])return x.projectionCache.offsets[h];const P=n.add(e);if(h+b.direction<a||h+b.direction>=c)return x.projectionCache.offsets[h]=P,P;const I=Pt(h+b.direction,x,b),k=wt(I.sub(n),_,b.direction),A=n.add(k),R=I.add(k);return x.projectionCache.offsets[h]=o.ax(p,P,A,R)||P,x.projectionCache.offsets[h]}function cs(h,e,n,a,c,p,_,x,b){const P=a?h-e:h+e;let I=P>0?1:-1,k=0;a&&(I*=-1,k=Math.PI),I<0&&(k+=Math.PI);let A,R=I>0?p+c:p+c+1;x.projectionCache.cachedAnchorPoint?A=x.projectionCache.cachedAnchorPoint:(A=mi(x.tileAnchorPoint.x,x.tileAnchorPoint.y,x).point,x.projectionCache.cachedAnchorPoint=A);let O,W,G=A,H=A,J=0,ie=0;const Q=Math.abs(P),se=[];let ue;for(;J+ie<=Q;){if(R+=I,R<p||R>=_)return null;J+=ie,H=G,W=O;const Te={absOffsetX:Q,direction:I,distanceFromAnchor:J,previousVertex:H};if(G=Pt(R,x,Te),n===0)se.push(H),ue=G.sub(H);else{let ve;const xe=G.sub(H);ve=xe.mag()===0?wt(Pt(R+I,x,Te).sub(G),n,I):wt(xe,n,I),W||(W=H.add(ve)),O=Zo(R,ve,G,p,_,W,n,x,Te),se.push(W),ue=O.sub(W)}ie=ue.mag()}const ee=ue._mult((Q-J)/ie)._add(W||H),ge=k+Math.atan2(G.y-H.y,G.x-H.x);return se.push(ee),{point:ee,angle:b?ge:0,path:se}}const Go=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function In(h,e){for(let n=0;n<h;n++){const a=e.length;e.resize(a+4),e.float32.set(Go,3*a)}}function la(h,e,n){const a=e[0],c=e[1];return h[0]=n[0]*a+n[4]*c+n[12],h[1]=n[1]*a+n[5]*c+n[13],h[3]=n[3]*a+n[7]*c+n[15],h}const Or=100;class qo{constructor(e,n=new Pr(e.width+200,e.height+200,25),a=new Pr(e.width+200,e.height+200,25)){this.transform=e,this.grid=n,this.ignoredGrid=a,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Or,this.screenBottomBoundary=e.height+Or,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,n,a,c,p,_,x,b,P,I,k,A){const R=this.projectAndGetPerspectiveRatio(e.anchorPointX+b[0],e.anchorPointY+b[1],p,I,A),O=a*R.perspectiveRatio;let W;if(_||x)W=this._projectCollisionBox(e,O,c,p,_,x,b,R,I,k,A);else{const ue=R.x+(k?k.x*O:0),ee=R.y+(k?k.y*O:0);W={allPointsOccluded:!1,box:[ue+e.x1*O,ee+e.y1*O,ue+e.x2*O,ee+e.y2*O]}}const[G,H,J,ie]=W.box,Q=_?W.allPointsOccluded:R.isOccluded;let se=Q;return se||(se=R.perspectiveRatio<this.perspectiveRatioCutoff),se||(se=!this.isInsideGrid(G,H,J,ie)),se||n!=="always"&&this.grid.hitTest(G,H,J,ie,n,P)?{box:[G,H,J,ie],placeable:!1,offscreen:!1,occluded:Q}:{box:[G,H,J,ie],placeable:!0,offscreen:this.isOffscreen(G,H,J,ie),occluded:Q}}placeCollisionCircles(e,n,a,c,p,_,x,b,P,I,k,A,R,O){const W=[],G=new o.P(n.anchorX,n.anchorY),H=this.getPerspectiveRatio(G.x,G.y,_,O),J=(P?p*this.transform.getPitchedTextCorrection(n.anchorX,n.anchorY,_)/H:p*H)/o.aB,ie={getElevation:O,pitchedLabelPlaneMatrix:x,lineVertexArray:a,pitchWithMap:P,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:G,unwrappedTileID:_,width:this.transform.width,height:this.transform.height,translation:R},Q=os(J,c,n.lineOffsetX*J,n.lineOffsetY*J,!1,n,!1,ie);let se=!1,ue=!1,ee=!0;if(Q){const ge=.5*k*H+A,Te=new o.P(-100,-100),ve=new o.P(this.screenRightBoundary,this.screenBottomBoundary),xe=new tr,we=Q.first,Fe=Q.last;let Ve=[];for(let Tt=we.path.length-1;Tt>=1;Tt--)Ve.push(we.path[Tt]);for(let Tt=1;Tt<Fe.path.length;Tt++)Ve.push(Fe.path[Tt]);const Le=2.5*ge;if(P){const Tt=this.projectPathToScreenSpace(Ve,ie);Ve=Tt.some((Yt=>Yt.signedDistanceFromCamera<=0))?[]:Tt.map((Yt=>Yt.point))}let Ye=[];if(Ve.length>0){const Tt=Ve[0].clone(),Yt=Ve[0].clone();for(let ir=1;ir<Ve.length;ir++)Tt.x=Math.min(Tt.x,Ve[ir].x),Tt.y=Math.min(Tt.y,Ve[ir].y),Yt.x=Math.max(Yt.x,Ve[ir].x),Yt.y=Math.max(Yt.y,Ve[ir].y);Ye=Tt.x>=Te.x&&Yt.x<=ve.x&&Tt.y>=Te.y&&Yt.y<=ve.y?[Ve]:Yt.x<Te.x||Tt.x>ve.x||Yt.y<Te.y||Tt.y>ve.y?[]:o.ay([Ve],Te.x,Te.y,ve.x,ve.y)}for(const Tt of Ye){xe.reset(Tt,.25*ge);let Yt=0;Yt=xe.length<=.5*ge?1:Math.ceil(xe.paddedLength/Le)+1;for(let ir=0;ir<Yt;ir++){const er=ir/Math.max(Yt-1,1),Mr=xe.lerp(er),Rr=Mr.x+Or,xt=Mr.y+Or;W.push(Rr,xt,ge,0);const nr=Rr-ge,Hr=xt-ge,ti=Rr+ge,li=xt+ge;if(ee=ee&&this.isOffscreen(nr,Hr,ti,li),ue=ue||this.isInsideGrid(nr,Hr,ti,li),e!=="always"&&this.grid.hitTestCircle(Rr,xt,ge,e,I)&&(se=!0,!b))return{circles:[],offscreen:!1,collisionDetected:se}}}}return{circles:!b&&se||!ue||H<this.perspectiveRatioCutoff?[]:W,offscreen:ee,collisionDetected:se}}projectPathToScreenSpace(e,n){const a=(function(c,p){const _=o.L();return o.aq(_,p.pitchedLabelPlaneMatrix),c.map((x=>{const b=qr(x.x,x.y,_,p.getElevation),P=p.transform.projectTileCoordinates(b.point.x,b.point.y,p.unwrappedTileID,p.getElevation);return P.point.x=(.5*P.point.x+.5)*p.width,P.point.y=(.5*-P.point.y+.5)*p.height,P}))})(e,n);return(function(c){let p=0,_=0,x=0,b=0;for(let P=0;P<c.length;P++)c[P].isOccluded?(x=P+1,b=0):(b++,b>_&&(_=b,p=x));return c.slice(p,p+_)})(a)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[],a=new o.a2;for(const k of e){const A=new o.P(k.x+Or,k.y+Or);a.extend(A),n.push(A)}const{minX:c,minY:p,maxX:_,maxY:x}=a,b=this.grid.query(c,p,_,x).concat(this.ignoredGrid.query(c,p,_,x)),P={},I={};for(const k of b){const A=k.key;if(P[A.bucketInstanceId]===void 0&&(P[A.bucketInstanceId]={}),P[A.bucketInstanceId][A.featureIndex])continue;const R=[new o.P(k.x1,k.y1),new o.P(k.x2,k.y1),new o.P(k.x2,k.y2),new o.P(k.x1,k.y2)];o.az(n,R)&&(P[A.bucketInstanceId][A.featureIndex]=!0,I[A.bucketInstanceId]===void 0&&(I[A.bucketInstanceId]=[]),I[A.bucketInstanceId].push(A.featureIndex))}return I}insertCollisionBox(e,n,a,c,p,_){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:p,collisionGroupID:_,overlapMode:n},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,a,c,p,_){const x=a?this.ignoredGrid:this.grid,b={bucketInstanceId:c,featureIndex:p,collisionGroupID:_,overlapMode:n};for(let P=0;P<e.length;P+=4)x.insertCircle(b,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,n,a,c,p){if(p){let _;c?(_=[e,n,c(e,n),1],o.aw(_,_,p)):(_=[e,n,0,1],la(_,_,p));const x=_[3];return{x:(_[0]/x+1)/2*this.transform.width+Or,y:(-_[1]/x+1)/2*this.transform.height+Or,perspectiveRatio:.5+this.transform.cameraToCenterDistance/x*.5,isOccluded:!1,signedDistanceFromCamera:x}}{const _=this.transform.projectTileCoordinates(e,n,a,c);return{x:(_.point.x+1)/2*this.transform.width+Or,y:(1-_.point.y)/2*this.transform.height+Or,perspectiveRatio:.5+this.transform.cameraToCenterDistance/_.signedDistanceFromCamera*.5,isOccluded:_.isOccluded,signedDistanceFromCamera:_.signedDistanceFromCamera}}}getPerspectiveRatio(e,n,a,c){const p=this.transform.projectTileCoordinates(e,n,a,c);return .5+this.transform.cameraToCenterDistance/p.signedDistanceFromCamera*.5}isOffscreen(e,n,a,c){return a<Or||e>=this.screenRightBoundary||c<Or||n>this.screenBottomBoundary}isInsideGrid(e,n,a,c){return a>=0&&e<this.gridRightBoundary&&c>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const e=o.ag([]);return o.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,n,a,c,p,_,x,b,P,I,k){let A=1,R=0,O=0,W=1;const G=e.anchorPointX+x[0],H=e.anchorPointY+x[1];if(_&&!p){const Ve=this.projectAndGetPerspectiveRatio(G+1,H,c,P,k),Le=Ve.x-b.x,Ye=Math.atan((Ve.y-b.y)/Le)+(Le<0?Math.PI:0),Tt=Math.sin(Ye),Yt=Math.cos(Ye);A=Yt,R=Tt,O=-Tt,W=Yt}else if(!_&&p){const Ve=Ut(this.transform);A=Ve.vecEast[0],R=Ve.vecEast[1],O=Ve.vecSouth[0],W=Ve.vecSouth[1]}let J=b.x,ie=b.y,Q=n;p&&(J=G,ie=H,Q=Math.pow(2,-(this.transform.zoom-a.overscaledZ)),Q*=this.transform.getPitchedTextCorrection(G,H,c),I||(Q*=o.ah(.5+b.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),I&&(J+=A*I.x*Q+O*I.y*Q,ie+=R*I.x*Q+W*I.y*Q);const se=e.x1*Q,ue=e.x2*Q,ee=(se+ue)/2,ge=e.y1*Q,Te=e.y2*Q,ve=(ge+Te)/2,xe=[{offsetX:se,offsetY:ge},{offsetX:ee,offsetY:ge},{offsetX:ue,offsetY:ge},{offsetX:ue,offsetY:ve},{offsetX:ue,offsetY:Te},{offsetX:ee,offsetY:Te},{offsetX:se,offsetY:Te},{offsetX:se,offsetY:ve}];let we=[];for(const{offsetX:Ve,offsetY:Le}of xe)we.push(new o.P(J+A*Ve+O*Le,ie+R*Ve+W*Le));let Fe=!1;if(p){const Ve=we.map((Le=>this.projectAndGetPerspectiveRatio(Le.x,Le.y,c,P,k)));Fe=Ve.some((Le=>!Le.isOccluded)),we=Ve.map((Le=>new o.P(Le.x,Le.y)))}else Fe=!0;return{box:o.aA(we),allPointsOccluded:!Fe}}}class Ri{constructor(e,n,a,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):c&&a?1:0,this.placed=a}isHidden(){return this.opacity===0&&!this.placed}}class cr{constructor(e,n,a,c,p){this.text=new Ri(e?e.text:null,n,a,p),this.icon=new Ri(e?e.icon:null,n,c,p)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rh{constructor(e,n,a){this.text=e,this.icon=n,this.skipFade=a}}class Xa{constructor(e,n,a,c,p){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=a,this.bucketIndex=c,this.tileID=p}}class mc{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:a=>a.collisionGroupID===n}}return this.collisionGroups[e]}}function us(h,e,n,a,c){const{horizontalAlign:p,verticalAlign:_}=o.aH(h);return new o.P(-(p-.5)*e+a[0]*c,-(_-.5)*n+a[1]*c)}class hs{constructor(e,n,a,c,p){this.transform=e.clone(),this.terrain=n,this.collisionIndex=new qo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new mc(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const n=this.terrain;return n?(a,c)=>n.getElevation(e,a,c):null}getBucketParts(e,n,a,c){const p=a.getBucket(n),_=a.latestFeatureIndex;if(!p||!_||n.id!==p.layerIds[0])return;const x=a.collisionBoxArray,b=p.layers[0].layout,P=p.layers[0].paint,I=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),k=a.tileSize/o.$,A=a.tileID.toUnwrapped(),R=b.get("text-rotation-alignment")==="map",O=o.aC(a,1,this.transform.zoom),W=o.aD(this.collisionIndex.transform,a,P.get("text-translate"),P.get("text-translate-anchor")),G=o.aD(this.collisionIndex.transform,a,P.get("icon-translate"),P.get("icon-translate-anchor")),H=Ur(R,this.transform,O);this.retainedQueryData[p.bucketInstanceId]=new Xa(p.bucketInstanceId,_,p.sourceLayerIndex,p.index,a.tileID);const J={bucket:p,layout:b,translationText:W,translationIcon:G,unwrappedTileID:A,pitchedLabelPlaneMatrix:H,scale:I,textPixelRatio:k,holdingForFade:a.holdingForFade(),collisionBoxArray:x,partiallyEvaluatedTextSize:o.an(p.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(p.sourceID)};if(c)for(const ie of p.sortKeyRanges){const{sortKey:Q,symbolInstanceStart:se,symbolInstanceEnd:ue}=ie;e.push({sortKey:Q,symbolInstanceStart:se,symbolInstanceEnd:ue,parameters:J})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:p.symbolInstances.length,parameters:J})}attemptAnchorPlacement(e,n,a,c,p,_,x,b,P,I,k,A,R,O,W,G,H,J,ie,Q){const se=o.aE[e.textAnchor],ue=[e.textOffset0,e.textOffset1],ee=us(se,a,c,ue,p),ge=this.collisionIndex.placeCollisionBox(n,A,b,P,I,x,_,G,k.predicate,ie,ee,Q);if((!J||this.collisionIndex.placeCollisionBox(J,A,b,P,I,x,_,H,k.predicate,ie,ee,Q).placeable)&&ge.placeable){let Te;if(this.prevPlacement&&this.prevPlacement.variableOffsets[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID].text&&(Te=this.prevPlacement.variableOffsets[R.crossTileID].anchor),R.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[R.crossTileID]={textOffset:ue,width:a,height:c,anchor:se,textBoxScale:p,prevAnchor:Te},this.markUsedJustification(O,se,R,W),O.allowVerticalPlacement&&(this.markUsedOrientation(O,W,R),this.placedOrientations[R.crossTileID]=W),{shift:ee,placedGlyphBoxes:ge}}}placeLayerBucketPart(e,n,a){const{bucket:c,layout:p,translationText:_,translationIcon:x,unwrappedTileID:b,pitchedLabelPlaneMatrix:P,textPixelRatio:I,holdingForFade:k,collisionBoxArray:A,partiallyEvaluatedTextSize:R,collisionGroup:O}=e.parameters,W=p.get("text-optional"),G=p.get("icon-optional"),H=o.aF(p,"text-overlap","text-allow-overlap"),J=H==="always",ie=o.aF(p,"icon-overlap","icon-allow-overlap"),Q=ie==="always",se=p.get("text-rotation-alignment")==="map",ue=p.get("text-pitch-alignment")==="map",ee=p.get("icon-text-fit")!=="none",ge=p.get("symbol-z-order")==="viewport-y",Te=J&&(Q||!c.hasIconData()||G),ve=Q&&(J||!c.hasTextData()||W);!c.collisionArrays&&A&&c.deserializeCollisionBoxes(A);const xe=this.retainedQueryData[c.bucketInstanceId].tileID,we=this._getTerrainElevationFunc(xe),Fe=this.transform.getFastPathSimpleProjectionMatrix(xe),Ve=(Le,Ye,Tt)=>{var Yt,ir;if(n[Le.crossTileID])return;if(k)return void(this.placements[Le.crossTileID]=new rh(!1,!1,!1));let er=!1,Mr=!1,Rr=!0,xt=null,nr={box:null,placeable:!1,offscreen:null,occluded:!1},Hr={placeable:!1},ti=null,li=null,Ei=null,mn=0,gs=0,_s=0;Ye.textFeatureIndex?mn=Ye.textFeatureIndex:Le.useRuntimeCollisionCircles&&(mn=Le.featureIndex),Ye.verticalTextFeatureIndex&&(gs=Ye.verticalTextFeatureIndex);const Ea=Ye.textBox;if(Ea){const Fi=Xr=>{let ri=o.ao.horizontal;if(c.allowVerticalPlacement&&!Xr&&this.prevPlacement){const en=this.prevPlacement.placedOrientations[Le.crossTileID];en&&(this.placedOrientations[Le.crossTileID]=en,ri=en,this.markUsedOrientation(c,ri,Le))}return ri},gn=(Xr,ri)=>{if(c.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&Ye.verticalTextBox){for(const en of c.writingModes)if(en===o.ao.vertical?(nr=ri(),Hr=nr):nr=Xr(),nr&&nr.placeable)break}else nr=Xr()},Ai=Le.textAnchorOffsetStartIndex,ys=Le.textAnchorOffsetEndIndex;if(ys===Ai){const Xr=(ri,en)=>{const Kr=this.collisionIndex.placeCollisionBox(ri,H,I,xe,b,ue,se,_,O.predicate,we,void 0,Fe);return Kr&&Kr.placeable&&(this.markUsedOrientation(c,en,Le),this.placedOrientations[Le.crossTileID]=en),Kr};gn((()=>Xr(Ea,o.ao.horizontal)),(()=>{const ri=Ye.verticalTextBox;return c.allowVerticalPlacement&&Le.numVerticalGlyphVertices>0&&ri?Xr(ri,o.ao.vertical):{box:null,offscreen:null}})),Fi(nr&&nr.placeable)}else{let Xr=o.aE[(ir=(Yt=this.prevPlacement)===null||Yt===void 0?void 0:Yt.variableOffsets[Le.crossTileID])===null||ir===void 0?void 0:ir.anchor];const ri=(Kr,To,ka)=>{const Gn=Kr.x2-Kr.x1,_n=Kr.y2-Kr.y1,vs=Le.textBoxScale,Hh=ee&&ie==="never"?To:null;let Gi=null,Xh=H==="never"?1:2,lu="never";Xr&&Xh++;for(let Il=0;Il<Xh;Il++){for(let El=Ai;El<ys;El++){const xs=c.textAnchorOffsets.get(El);if(Xr&&xs.textAnchor!==Xr)continue;const qn=this.attemptAnchorPlacement(xs,Kr,Gn,_n,vs,se,ue,I,xe,b,O,lu,Le,c,ka,_,x,Hh,we);if(qn&&(Gi=qn.placedGlyphBoxes,Gi&&Gi.placeable))return er=!0,xt=qn.shift,Gi}Xr?Xr=null:lu=H}return a&&!Gi&&(Gi={box:this.collisionIndex.placeCollisionBox(Ea,"always",I,xe,b,ue,se,_,O.predicate,we,void 0,Fe).box,offscreen:!1,placeable:!1,occluded:!1}),Gi};gn((()=>ri(Ea,Ye.iconBox,o.ao.horizontal)),(()=>{const Kr=Ye.verticalTextBox;return c.allowVerticalPlacement&&(!nr||!nr.placeable)&&Le.numVerticalGlyphVertices>0&&Kr?ri(Kr,Ye.verticalIconBox,o.ao.vertical):{box:null,occluded:!0,offscreen:null}})),nr&&(er=nr.placeable,Rr=nr.offscreen);const en=Fi(nr&&nr.placeable);if(!er&&this.prevPlacement){const Kr=this.prevPlacement.variableOffsets[Le.crossTileID];Kr&&(this.variableOffsets[Le.crossTileID]=Kr,this.markUsedJustification(c,Kr.anchor,Le,en))}}}if(ti=nr,er=ti&&ti.placeable,Rr=ti&&ti.offscreen,Le.useRuntimeCollisionCircles){const Fi=c.text.placedSymbolArray.get(Le.centerJustifiedTextSymbolIndex),gn=o.ap(c.textSizeData,R,Fi),Ai=p.get("text-padding");li=this.collisionIndex.placeCollisionCircles(H,Fi,c.lineVertexArray,c.glyphOffsetArray,gn,b,P,a,ue,O.predicate,Le.collisionCircleDiameter,Ai,_,we),li.circles.length&&li.collisionDetected&&!a&&o.w("Collisions detected, but collision boxes are not shown"),er=J||li.circles.length>0&&!li.collisionDetected,Rr=Rr&&li.offscreen}if(Ye.iconFeatureIndex&&(_s=Ye.iconFeatureIndex),Ye.iconBox){const Fi=gn=>this.collisionIndex.placeCollisionBox(gn,ie,I,xe,b,ue,se,x,O.predicate,we,ee&&xt?xt:void 0,Fe);Hr&&Hr.placeable&&Ye.verticalIconBox?(Ei=Fi(Ye.verticalIconBox),Mr=Ei.placeable):(Ei=Fi(Ye.iconBox),Mr=Ei.placeable),Rr=Rr&&Ei.offscreen}const Aa=W||Le.numHorizontalGlyphVertices===0&&Le.numVerticalGlyphVertices===0,Xs=G||Le.numIconVertices===0;Aa||Xs?Xs?Aa||(Mr=Mr&&er):er=Mr&&er:Mr=er=Mr&&er;const Ks=Mr&&Ei.placeable;if(er&&ti.placeable&&this.collisionIndex.insertCollisionBox(ti.box,H,p.get("text-ignore-placement"),c.bucketInstanceId,Hr&&Hr.placeable&&gs?gs:mn,O.ID),Ks&&this.collisionIndex.insertCollisionBox(Ei.box,ie,p.get("icon-ignore-placement"),c.bucketInstanceId,_s,O.ID),li&&er&&this.collisionIndex.insertCollisionCircles(li.circles,H,p.get("text-ignore-placement"),c.bucketInstanceId,mn,O.ID),a&&this.storeCollisionData(c.bucketInstanceId,Tt,Ye,ti,Ei,li),Le.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Le.crossTileID]=new rh((er||Te)&&!ti?.occluded,(Mr||ve)&&!Ei?.occluded,Rr||c.justReloaded),n[Le.crossTileID]=!0};if(ge){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Le=c.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Ye=Le.length-1;Ye>=0;--Ye){const Tt=Le[Ye];Ve(c.symbolInstances.get(Tt),c.collisionArrays[Tt],Tt)}}else for(let Le=e.symbolInstanceStart;Le<e.symbolInstanceEnd;Le++)Ve(c.symbolInstances.get(Le),c.collisionArrays[Le],Le);c.justReloaded=!1}storeCollisionData(e,n,a,c,p,_){if(a.textBox||a.iconBox){let x,b;this.collisionBoxArrays.has(e)?x=this.collisionBoxArrays.get(e):(x=new Map,this.collisionBoxArrays.set(e,x)),x.has(n)?b=x.get(n):(b={text:null,icon:null},x.set(n,b)),a.textBox&&(b.text=c.box),a.iconBox&&(b.icon=p.box)}if(_){let x=this.collisionCircleArrays[e];x===void 0&&(x=this.collisionCircleArrays[e]=[]);for(let b=0;b<_.circles.length;b+=4)x.push(_.circles[b+0]-Or),x.push(_.circles[b+1]-Or),x.push(_.circles[b+2]),x.push(_.collisionDetected?1:0)}}markUsedJustification(e,n,a,c){let p;p=c===o.ao.vertical?a.verticalPlacedTextSymbolIndex:{left:a.leftJustifiedTextSymbolIndex,center:a.centerJustifiedTextSymbolIndex,right:a.rightJustifiedTextSymbolIndex}[o.aG(n)];const _=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex,a.verticalPlacedTextSymbolIndex];for(const x of _)x>=0&&(e.text.placedSymbolArray.get(x).crossTileID=p>=0&&x!==p?0:a.crossTileID)}markUsedOrientation(e,n,a){const c=n===o.ao.horizontal||n===o.ao.horizontalOnly?n:0,p=n===o.ao.vertical?n:0,_=[a.leftJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.rightJustifiedTextSymbolIndex];for(const x of _)e.text.placedSymbolArray.get(x).placedOrientation=c;a.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).placedOrientation=p)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let a=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const c=n?n.symbolFadeChange(e):1,p=n?n.opacities:{},_=n?n.variableOffsets:{},x=n?n.placedOrientations:{};for(const b in this.placements){const P=this.placements[b],I=p[b];I?(this.opacities[b]=new cr(I,c,P.text,P.icon),a=a||P.text!==I.text.placed||P.icon!==I.icon.placed):(this.opacities[b]=new cr(null,c,P.text,P.icon,P.skipFade),a=a||P.text||P.icon)}for(const b in p){const P=p[b];if(!this.opacities[b]){const I=new cr(P,c,!1,!1);I.isHidden()||(this.opacities[b]=I,a=a||P.text.placed||P.icon.placed)}}for(const b in _)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=_[b]);for(const b in x)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=x[b]);if(n&&n.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");a?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){const a={};for(const c of n){const p=c.getBucket(e);p&&c.latestFeatureIndex&&e.id===p.layerIds[0]&&this.updateBucketOpacities(p,c.tileID,a,c.collisionBoxArray)}}updateBucketOpacities(e,n,a,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const p=e.layers[0],_=p.layout,x=new cr(null,0,!1,!1,!0),b=_.get("text-allow-overlap"),P=_.get("icon-allow-overlap"),I=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),k=_.get("text-rotation-alignment")==="map",A=_.get("text-pitch-alignment")==="map",R=_.get("icon-text-fit")!=="none",O=new cr(null,0,b&&(P||!e.hasIconData()||_.get("icon-optional")),P&&(b||!e.hasTextData()||_.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const W=(H,J,ie)=>{for(let Q=0;Q<J/4;Q++)H.opacityVertexArray.emplaceBack(ie);H.hasVisibleVertices=H.hasVisibleVertices||ie!==ua},G=this.collisionBoxArrays.get(e.bucketInstanceId);for(let H=0;H<e.symbolInstances.length;H++){const J=e.symbolInstances.get(H),{numHorizontalGlyphVertices:ie,numVerticalGlyphVertices:Q,crossTileID:se}=J;let ue=this.opacities[se];a[se]?ue=x:ue||(ue=O,this.opacities[se]=ue),a[se]=!0;const ee=J.numIconVertices>0,ge=this.placedOrientations[J.crossTileID],Te=ge===o.ao.vertical,ve=ge===o.ao.horizontal||ge===o.ao.horizontalOnly;if(ie>0||Q>0){const we=_c(ue.text);W(e.text,ie,Te?ua:we),W(e.text,Q,ve?ua:we);const Fe=ue.text.isHidden();[J.rightJustifiedTextSymbolIndex,J.centerJustifiedTextSymbolIndex,J.leftJustifiedTextSymbolIndex].forEach((Ye=>{Ye>=0&&(e.text.placedSymbolArray.get(Ye).hidden=Fe||Te?1:0)})),J.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(J.verticalPlacedTextSymbolIndex).hidden=Fe||ve?1:0);const Ve=this.variableOffsets[J.crossTileID];Ve&&this.markUsedJustification(e,Ve.anchor,J,ge);const Le=this.placedOrientations[J.crossTileID];Le&&(this.markUsedJustification(e,"left",J,Le),this.markUsedOrientation(e,Le,J))}if(ee){const we=_c(ue.icon),Fe=!(R&&J.verticalPlacedIconSymbolIndex&&Te);J.placedIconSymbolIndex>=0&&(W(e.icon,J.numIconVertices,Fe?we:ua),e.icon.placedSymbolArray.get(J.placedIconSymbolIndex).hidden=ue.icon.isHidden()),J.verticalPlacedIconSymbolIndex>=0&&(W(e.icon,J.numVerticalIconVertices,Fe?ua:we),e.icon.placedSymbolArray.get(J.verticalPlacedIconSymbolIndex).hidden=ue.icon.isHidden())}const xe=G&&G.has(H)?G.get(H):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const we=e.collisionArrays[H];if(we){let Fe=new o.P(0,0);if(we.textBox||we.verticalTextBox){let Ve=!0;if(I){const Le=this.variableOffsets[se];Le?(Fe=us(Le.anchor,Le.width,Le.height,Le.textOffset,Le.textBoxScale),k&&Fe._rotate(A?-this.transform.bearingInRadians:this.transform.bearingInRadians)):Ve=!1}if(we.textBox||we.verticalTextBox){let Le;we.textBox&&(Le=Te),we.verticalTextBox&&(Le=ve),gc(e.textCollisionBox.collisionVertexArray,ue.text.placed,!Ve||Le,xe.text,Fe.x,Fe.y)}}if(we.iconBox||we.verticalIconBox){const Ve=!!(!ve&&we.verticalIconBox);let Le;we.iconBox&&(Le=Ve),we.verticalIconBox&&(Le=!Ve),gc(e.iconCollisionBox.collisionVertexArray,ue.icon.placed,Le,xe.icon,R?Fe.x:0,R?Fe.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){const a=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*a>e}setStale(){this.stale=!0}}function gc(h,e,n,a,c,p){a&&a.length!==0||(a=[0,0,0,0]);const _=a[0]-Or,x=a[1]-Or,b=a[2]-Or,P=a[3]-Or;h.emplaceBack(e?1:0,n?1:0,c||0,p||0,_,x),h.emplaceBack(e?1:0,n?1:0,c||0,p||0,b,x),h.emplaceBack(e?1:0,n?1:0,c||0,p||0,b,P),h.emplaceBack(e?1:0,n?1:0,c||0,p||0,_,P)}const ih=Math.pow(2,25),nh=Math.pow(2,24),ca=Math.pow(2,17),sh=Math.pow(2,16),qd=Math.pow(2,9),Wd=Math.pow(2,8),Hd=Math.pow(2,1);function _c(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const e=h.placed?1:0,n=Math.floor(127*h.opacity);return n*ih+e*nh+n*ca+e*sh+n*qd+e*Wd+n*Hd+e}const ua=0;class yc{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,n,a,c,p){const _=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(_,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,p())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,_.sort(((x,b)=>x.sortKey-b.sortKey)));this._currentPartIndex<_.length;)if(n.placeLayerBucketPart(_[this._currentPartIndex],this._seenCrossTileIDs,a),this._currentPartIndex++,p())return!0;return!1}}class vc{constructor(e,n,a,c,p,_,x,b){this.placement=new hs(e,n,_,x,b),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(e,n,a){const c=he.now(),p=()=>!this._forceFullPlacement&&he.now()-c>2;for(;this._currentPlacementIndex>=0;){const _=n[e[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if(_.type==="symbol"&&(!_.minzoom||_.minzoom<=x)&&(!_.maxzoom||_.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new yc(_)),this._inProgressLayer.continuePlacement(a[_.source],this.placement,this._showCollisionBoxes,_,p))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const ha=512/o.$/2;class xc{constructor(e,n,a){this.tileID=e,this.bucketInstanceId=a,this._symbolsByKey={};const c=new Map;for(let p=0;p<n.length;p++){const _=n.get(p),x=_.key,b=c.get(x);b?b.push(_):c.set(x,[_])}for(const[p,_]of c){const x={positions:_.map((b=>({x:Math.floor(b.anchorX*ha),y:Math.floor(b.anchorY*ha)}))),crossTileIDs:_.map((b=>b.crossTileID))};if(x.positions.length>128){const b=new o.aI(x.positions.length,16,Uint16Array);for(const{x:P,y:I}of x.positions)b.add(P,I);b.finish(),delete x.positions,x.index=b}this._symbolsByKey[p]=x}}getScaledCoordinates(e,n){const{x:a,y:c,z:p}=this.tileID.canonical,{x:_,y:x,z:b}=n.canonical,P=ha/Math.pow(2,b-p),I=(x*o.$+e.anchorY)*P,k=c*o.$*ha;return{x:Math.floor((_*o.$+e.anchorX)*P-a*o.$*ha),y:Math.floor(I-k)}}findMatches(e,n,a){const c=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z);for(let p=0;p<e.length;p++){const _=e.get(p);if(_.crossTileID)continue;const x=this._symbolsByKey[_.key];if(!x)continue;const b=this.getScaledCoordinates(_,n);if(x.index){const P=x.index.range(b.x-c,b.y-c,b.x+c,b.y+c).sort();for(const I of P){const k=x.crossTileIDs[I];if(!a[k]){a[k]=!0,_.crossTileID=k;break}}}else if(x.positions)for(let P=0;P<x.positions.length;P++){const I=x.positions[P],k=x.crossTileIDs[P];if(Math.abs(I.x-b.x)<=c&&Math.abs(I.y-b.y)<=c&&!a[k]){a[k]=!0,_.crossTileID=k;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class bc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const n=Math.round((e-this.lng)/360);if(n!==0)for(const a in this.indexes){const c=this.indexes[a],p={};for(const _ in c){const x=c[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+n),p[x.tileID.key]=x}this.indexes[a]=p}this.lng=e}addBucket(e,n,a){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let p=0;p<n.symbolInstances.length;p++)n.symbolInstances.get(p).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const p in this.indexes){const _=this.indexes[p];if(Number(p)>e.overscaledZ)for(const x in _){const b=_[x];b.tileID.isChildOf(e)&&b.findMatches(n.symbolInstances,e,c)}else{const x=_[e.scaledTo(Number(p)).key];x&&x.findMatches(n.symbolInstances,e,c)}}for(let p=0;p<n.symbolInstances.length;p++){const _=n.symbolInstances.get(p);_.crossTileID||(_.crossTileID=a.generate(),c[_.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new xc(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(const a of n.getCrossTileIDsLists())for(const c of a)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let n=!1;for(const a in this.indexes){const c=this.indexes[a];for(const p in c)e[c[p].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,c[p]),delete c[p],n=!0)}return n}}class da{constructor(){this.layerIndexes={},this.crossTileIDs=new bc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,a){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new Xd);let p=!1;const _={};c.handleWrapJump(a);for(const x of n){const b=x.getBucket(e);b&&e.id===b.layerIds[0]&&(b.bucketInstanceId||(b.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(x.tileID,b,this.crossTileIDs)&&(p=!0),_[b.bucketInstanceId]=!0)}return c.removeStaleBuckets(_)&&(p=!0),p}pruneUnusedLayers(e){const n={};e.forEach((a=>{n[a]=!0}));for(const a in this.layerIndexes)n[a]||delete this.layerIndexes[a]}}var Ka="void main() {fragColor=vec4(1.0);}";const on={prelude:It(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:It("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:It("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:It(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:It(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:It(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:It(Ka,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:It(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:It(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:It("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:It("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:It(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:It("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:It(Ka,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:It(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:It(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:It(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:It(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:It(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:It(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:It(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:It(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:It(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:It(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:It(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:It(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:It(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:It(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:It("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:It("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:It("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:It("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:It(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:It("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function It(h,e){const n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=e.match(/in ([\w]+) ([\w]+)/g),c=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),p=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=p?p.concat(c):c,x={};return{fragmentSource:h=h.replace(n,((b,P,I,k,A)=>(x[A]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${A}
in ${I} ${k} ${A};
#else
uniform ${I} ${k} u_${A};
#endif
`:`
#ifdef HAS_UNIFORM_u_${A}
    ${I} ${k} ${A} = u_${A};
#endif
`))),vertexSource:e=e.replace(n,((b,P,I,k,A)=>{const R=k==="float"?"vec2":"vec4",O=A.match(/color/)?"color":R;return x[A]?P==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${I} ${R} a_${A};
out ${I} ${k} ${A};
#else
uniform ${I} ${k} u_${A};
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = a_${A};
#else
    ${I} ${k} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${A} = unpack_mix_${O}(a_${A}, u_${A}_t);
#else
    ${I} ${k} ${A} = u_${A};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${A}
uniform lowp float u_${A}_t;
in ${I} ${R} a_${A};
#else
uniform ${I} ${k} u_${A};
#endif
`:O==="vec4"?`
#ifndef HAS_UNIFORM_u_${A}
    ${I} ${k} ${A} = a_${A};
#else
    ${I} ${k} ${A} = u_${A};
#endif
`:`
#ifndef HAS_UNIFORM_u_${A}
    ${I} ${k} ${A} = unpack_mix_${O}(a_${A}, u_${A}_t);
#else
    ${I} ${k} ${A} = u_${A};
#endif
`})),staticAttributes:a,staticUniforms:_}}class zs{constructor(e,n,a){this.vertexBuffer=e,this.indexBuffer=n,this.segments=a}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var ds=o.aJ([{name:"a_pos",type:"Int16",components:2}]);const Vn="#define PROJECTION_MERCATOR",Ds="mercator";class Et{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return Ds}get shaderDefine(){return Vn}get shaderPreludeCode(){return on.projectionMercator}get vertexShaderPreludeCode(){return on.projectionMercator.vertexSource}get subdivisionGranularity(){return o.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,n,a,c,p){if(this._cachedMesh)return this._cachedMesh;const _=new o.aL;_.emplaceBack(0,0),_.emplaceBack(o.$,0),_.emplaceBack(0,o.$),_.emplaceBack(o.$,o.$);const x=e.createVertexBuffer(_,ds.members),b=o.aM.simpleSegment(0,0,4,2),P=new o.aN;P.emplaceBack(1,0,2),P.emplaceBack(1,2,3);const I=e.createIndexBuffer(P);return this._cachedMesh=new zs(x,I,b),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class Rs{constructor(e=0,n=0,a=0,c=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(a)||a<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=a,this.right=c}interpolate(e,n,a){return n.top!=null&&e.top!=null&&(this.top=o.C.number(e.top,n.top,a)),n.bottom!=null&&e.bottom!=null&&(this.bottom=o.C.number(e.bottom,n.bottom,a)),n.left!=null&&e.left!=null&&(this.left=o.C.number(e.left,n.left,a)),n.right!=null&&e.right!=null&&(this.right=o.C.number(e.right,n.right,a)),this}getCenter(e,n){const a=o.ah((this.left+e-this.right)/2,0,e),c=o.ah((this.top+n-this.bottom)/2,0,n);return new o.P(a,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Rs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Wo(h,e){if(!h.renderWorldCopies||h.lngRange)return;const n=e.lng-h.center.lng;e.lng+=n>180?-360:n<-180?360:0}function Ho(h){return Math.max(0,Math.floor(h))}class Pi{constructor(e,n,a,c,p,_){this._callbacks=e,this._tileSize=512,this._renderWorldCopies=_===void 0||!!_,this._minZoom=n||0,this._maxZoom=a||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new o.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Ho(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new Rs,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,n,a){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=Ho(this._zoom),this._scale=o.af(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new Rs(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!a&&e.autoCalculateNearFarZ,n&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const n=o.aO(e,-180,180)*Math.PI/180;var a,c,p,_,x,b,P,I,k;this._bearingInRadians!==n&&(this._unmodified=!1,this._bearingInRadians=n,this._calcMatrices(),this._rotationMatrix=K(),a=this._rotationMatrix,p=-this._bearingInRadians,_=(c=this._rotationMatrix)[0],x=c[1],b=c[2],P=c[3],I=Math.sin(p),k=Math.cos(p),a[0]=_*k+b*I,a[1]=x*k+P*I,a[2]=_*-I+b*k,a[3]=x*-I+P*k)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const n=o.ah(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==n&&(this._unmodified=!1,this._pitchInRadians=n,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const n=e/180*Math.PI;this._rollInRadians!==n&&(this._unmodified=!1,this._rollInRadians=n,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return o.aP(this._fovInRadians)}setFov(e){e=o.ah(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=o.ae(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const n=this.getConstrained(this._center,e).zoom;this._zoom!==n&&(this._unmodified=!1,this._zoom=n,this._tileZoom=Math.max(0,Math.floor(n)),this._scale=o.af(n),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,n){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=n,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,a){this._unmodified=!1,this._edgeInsets.interpolate(e,n,a),this._constrain(),this._calcMatrices()}resize(e,n,a=!0){this._width=e,this._height=n,a&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new yt([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-o.ai,o.ai])}getConstrained(e,n){return this._callbacks.getConstrained(e,n)}getCameraQueryGeometry(e,n){if(n.length===1)return[n[0],e];{const{minX:a,minY:c,maxX:p,maxY:_}=o.a2.fromPoints(n).extend(e);return[new o.P(a,c),new o.P(p,c),new o.P(p,_),new o.P(a,_),new o.P(a,c)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:n,zoom:a}=this.getConstrained(this.center,this.zoom);this.setCenter(n),this.setZoom(a),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=o.ag(new Float64Array(16));o.N(e,e,[this._width/2,-this._height/2,1]),o.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=o.ag(new Float64Array(16)),o.N(e,e,[1,-1,1]),o.M(e,e,[-1,-1,0]),o.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,n,a,c){const p=a!==void 0?a:this.bearing,_=c=c!==void 0?c:this.pitch,x=o.a1.fromLngLat(e,n),b=-Math.cos(o.ae(_)),P=Math.sin(o.ae(_)),I=P*Math.sin(o.ae(p)),k=-P*Math.cos(o.ae(p));let A=this.elevation;const R=n-A;let O;b*R>=0||Math.abs(b)<.1?(O=1e4,A=n+O*b):O=-R/b;let W,G,H=o.aQ(1,x.y),J=0;do{if(J+=1,J>10)break;G=O/H,W=new o.a1(x.x+I*G,x.y+k*G),H=1/W.meterInMercatorCoordinateUnits()}while(Math.abs(O-G*H)>1e-12);return{center:W.toLngLat(),elevation:A,zoom:o.ak(this.height/2/Math.tan(this.fovInRadians/2)/G/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const n=o.aj(1,this.center.lat)*this.worldSize,a=this.cameraToCenterDistance/n,c=o.a1.fromLngLat(this.center,this.elevation),p=pe(this.center,this.elevation,this.pitch,this.bearing,a);this._elevation=e;const _=this.calculateCenterFromCameraLngLatAlt(p.toLngLat(),o.aQ(p.z,c.y),this.bearing,this.pitch);this._elevation=_.elevation,this._center=_.center,this.setZoom(_.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=o.aj(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const n=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/n,e.canonical.y/n,1/n/o.$,1/n/o.$]}}class ai{constructor(e,n){this.min=e,this.max=n,this.center=o.aR([],o.aS([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],a=o.aT(this.min),c=o.aT(this.max);for(let p=0;p<n.length;p++)a[p]=n[p]?this.min[p]:this.center[p],c[p]=n[p]?this.center[p]:this.max[p];return c[2]=this.max[2],new ai(a,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let n=!0;for(let a=0;a<e.planes.length;a++){const c=this.intersectsPlane(e.planes[a]);if(c===0)return 0;c===1&&(n=!1)}return n?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let n=e[3],a=e[3];for(let c=0;c<3;c++)e[c]>0?(n+=e[c]*this.min[c],a+=e[c]*this.max[c]):(a+=e[c]*this.min[c],n+=e[c]*this.max[c]);return n>=0?2:a<0?0:1}}class Mi{distanceToTile2d(e,n,a,c){const p=c.distanceX([e,n]),_=c.distanceY([e,n]);return Math.hypot(p,_)}getWrap(e,n,a){return a}getTileBoundingVolume(e,n,a,c){var p,_;let x=0,b=0;if(c?.terrain){const I=new o.Z(e.z,n,e.z,e.x,e.y),k=c.terrain.getMinMaxElevation(I);x=(p=k.minElevation)!==null&&p!==void 0?p:Math.min(0,a),b=(_=k.maxElevation)!==null&&_!==void 0?_:Math.max(0,a)}const P=1<<e.z;return new ai([n+e.x/P,e.y/P,x],[n+(e.x+1)/P,(e.y+1)/P,b])}allowVariableZoom(e,n){const a=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,c=o.ah(78.5-a/2,0,60);return!!n.terrain||e.pitch>c}allowWorldCopies(){return!0}prepareNextFrame(){}}class Wr{constructor(e,n,a){this.points=e,this.planes=n,this.aabb=a}static fromInvProjectionMatrix(e,n=1,a=0,c,p){const _=p?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],x=Math.pow(2,a),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((A=>(function(R,O,W,G){const H=o.aw([],R,O),J=1/H[3]/W*G;return o.aY(H,H,[J,J,1/H[3],J])})(A,e,n,x)));c&&(function(A,R,O,W){const G=W?4:0,H=W?0:4;let J=0;const ie=[],Q=[];for(let ee=0;ee<4;ee++){const ge=o.aU([],A[ee+H],A[ee+G]),Te=o.aZ(ge);o.aR(ge,ge,1/Te),ie.push(Te),Q.push(ge)}for(let ee=0;ee<4;ee++){const ge=o.a_(A[ee+G],Q[ee],O);J=ge!==null&&ge>=0?Math.max(J,ge):Math.max(J,ie[ee])}const se=(function(ee,ge){const Te=o.aU([],ee[ge[0]],ee[ge[1]]),ve=o.aU([],ee[ge[2]],ee[ge[1]]),xe=[0,0,0,0];return o.aV(xe,o.aW([],Te,ve)),xe[3]=-o.aX(xe,ee[ge[0]]),xe})(A,R),ue=(function(ee,ge){const Te=o.a$(ee),ve=o.b0([],ee,1/Te),xe=o.aU([],ge,o.aR([],ve,o.aX(ge,ve))),we=o.a$(xe);if(we>0){const Fe=Math.sqrt(1-ve[3]*ve[3]),Ve=o.aR([],ve,-ve[3]),Le=o.aS([],Ve,o.aR([],xe,Fe/we));return o.b1(ge,Le)}return null})(O,se);if(ue!==null){const ee=ue/o.aX(Q[0],se);J=Math.min(J,ee)}for(let ee=0;ee<4;ee++){const ge=Math.min(J,ie[ee]);A[ee+H]=[A[ee+G][0]+Q[ee][0]*ge,A[ee+G][1]+Q[ee][1]*ge,A[ee+G][2]+Q[ee][2]*ge,1]}})(b,_[0],c,p);const P=_.map((A=>{const R=o.aU([],b[A[0]],b[A[1]]),O=o.aU([],b[A[2]],b[A[1]]),W=o.aV([],o.aW([],R,O)),G=-o.aX(W,b[A[1]]);return W.concat(G)})),I=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],k=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const A of b)for(let R=0;R<3;R++)I[R]=Math.min(I[R],A[R]),k[R]=Math.max(k[R],A[R]);return new Wr(b,P,new ai(I,k))}}class ur{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,a){return this._helper.interpolatePadding(e,n,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,a=!0){this._helper.resize(e,n,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,n){}constructor(e,n,a,c,p){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(_,x)=>this.getConstrained(_,x)},e,n,a,c,p),this._coveringTilesDetailsProvider=new Mi}clone(){const e=new ur;return e.apply(this),e}apply(e,n,a){this._helper.apply(e,n,a)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const n=[new o.b2(0,e)];if(this._helper._renderWorldCopies){const a=this.screenPointToMercatorCoordinate(new o.P(0,0)),c=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,0)),p=this.screenPointToMercatorCoordinate(new o.P(this._helper._width,this._helper._height)),_=this.screenPointToMercatorCoordinate(new o.P(0,this._helper._height)),x=Math.floor(Math.min(a.x,c.x,p.x,_.x)),b=Math.floor(Math.max(a.x,c.x,p.x,_.x)),P=1;for(let I=x-P;I<=b+P;I++)I!==0&&n.push(new o.b2(I,e))}return n}getCameraFrustum(){return Wr.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const n=this.screenPointToLocation(this.centerPoint,e),a=e?e.getElevationForLngLatZoom(n,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(a)}setLocationAtPoint(e,n){const a=o.aj(this.elevation,this.center.lat),c=this.screenPointToMercatorCoordinateAtZ(n,a),p=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,a),_=o.a1.fromLngLat(e),x=new o.a1(_.x-(c.x-p.x),_.y-(c.y-p.y));this.setCenter(x?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,n){return n?this.coordinatePoint(o.a1.fromLngLat(e),n.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(o.a1.fromLngLat(e))}screenPointToLocation(e,n){var a;return(a=this.screenPointToMercatorCoordinate(e,n))===null||a===void 0?void 0:a.toLngLat()}screenPointToMercatorCoordinate(e,n){if(n){const a=n.pointCoordinate(e);if(a!=null)return a}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,n){const a=n||0,c=[e.x,e.y,0,1],p=[e.x,e.y,1,1];o.aw(c,c,this._pixelMatrixInverse),o.aw(p,p,this._pixelMatrixInverse);const _=c[3],x=p[3],b=c[1]/_,P=p[1]/x,I=c[2]/_,k=p[2]/x,A=I===k?0:(a-I)/(k-I);return new o.a1(o.C.number(c[0]/_,p[0]/x,A)/this.worldSize,o.C.number(b,P,A)/this.worldSize,a)}coordinatePoint(e,n=0,a=this._pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,n,1];return o.aw(c,c,a),new o.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this._helper._height/2-U(this));return new yt().extend(this.screenPointToLocation(new o.P(0,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,e))).extend(this.screenPointToLocation(new o.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new o.P(0,this._helper._height)))}isPointOnMapSurface(e,n){return n?n.pointCoordinate(e)!=null:e.y>this.height/2-U(this)}calculatePosMatrix(e,n=!1,a){var c;const p=(c=e.key)!==null&&c!==void 0?c:o.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),_=n?this._alignedPosMatrixCache:this._posMatrixCache;if(_.has(p)){const P=_.get(p);return a?P.f32:P.f64}const x=re(e,this.worldSize);o.O(x,n?this._alignedProjMatrix:this._viewProjMatrix,x);const b={f64:x,f32:new Float32Array(x)};return _.set(p,b),a?b.f32:b.f64}calculateFogMatrix(e){const n=e.key,a=this._fogMatrixCacheF32;if(a.has(n))return a.get(n);const c=re(e,this.worldSize);return o.O(c,this._fogMatrix,c),a.set(n,new Float32Array(c)),a.get(n)}getConstrained(e,n){n=o.ah(+n,this.minZoom,this.maxZoom);const a={center:new o.S(e.lng,e.lat),zoom:n};let c=this._helper._lngRange;if(!this._helper._renderWorldCopies&&c===null){const ie=179.9999999999;c=[-ie,ie]}const p=this.tileSize*o.af(a.zoom);let _=0,x=p,b=0,P=p,I=0,k=0;const{x:A,y:R}=this.size;if(this._helper._latRange){const ie=this._helper._latRange;_=o.U(ie[1])*p,x=o.U(ie[0])*p,x-_<R&&(I=R/(x-_))}c&&(b=o.aO(o.V(c[0])*p,0,p),P=o.aO(o.V(c[1])*p,0,p),P<b&&(P+=p),P-b<A&&(k=A/(P-b)));const{x:O,y:W}=$(p,e);let G,H;const J=Math.max(k||0,I||0);if(J){const ie=new o.P(k?(P+b)/2:O,I?(x+_)/2:W);return a.center=te(p,ie).wrap(),a.zoom+=o.ak(J),a}if(this._helper._latRange){const ie=R/2;W-ie<_&&(H=_+ie),W+ie>x&&(H=x-ie)}if(c){const ie=(b+P)/2;let Q=O;this._helper._renderWorldCopies&&(Q=o.aO(O,ie-p/2,ie+p/2));const se=A/2;Q-se<b&&(G=b+se),Q+se>P&&(G=P-se)}if(G!==void 0||H!==void 0){const ie=new o.P(G??O,H??W);a.center=te(p,ie).wrap()}return a}calculateCenterFromCameraLngLatAlt(e,n,a,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,a,c)}_calculateNearFarZIfNeeded(e,n,a){if(!this._helper.autoCalculateNearFarZ)return;const c=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),p=e-c*this._helper._pixelPerMeter/Math.cos(n),_=c<0?p:e,x=Math.PI/2+this.pitchInRadians,b=o.ae(this.fov)*(Math.abs(Math.cos(o.ae(this.roll)))*this.height+Math.abs(Math.sin(o.ae(this.roll)))*this.width)/this.height*(.5+a.y/this.height),P=Math.sin(b)*_/Math.sin(o.ah(Math.PI-x-b,.01,Math.PI-.01)),I=U(this),k=Math.atan(I/this._helper.cameraToCenterDistance),A=o.ae(.75),R=k>A?2*k*(.5+a.y/(2*I)):A,O=Math.sin(R)*_/Math.sin(o.ah(Math.PI-x-R,.01,Math.PI-.01)),W=Math.min(P,O);this._helper._farZ=1.01*(Math.cos(Math.PI/2-n)*W+_),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,n=$(this.worldSize,this.center),a=n.x,c=n.y;this._helper._pixelPerMeter=o.aj(1,this.center.lat)*this.worldSize;const p=o.ae(Math.min(this.pitch,V)),_=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(p));let x;this._calculateNearFarZIfNeeded(_,p,e),x=new Float64Array(16),o.b4(x,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),o.aq(this._invProjMatrix,x),x[8]=2*-e.x/this._helper._width,x[9]=2*e.y/this._helper._height,this._projectionMatrix=o.b5(x),o.N(x,x,[1,-1,1]),o.M(x,x,[0,0,-this._helper.cameraToCenterDistance]),o.b6(x,x,-this.rollInRadians),o.b7(x,x,this.pitchInRadians),o.b6(x,x,-this.bearingInRadians),o.M(x,x,[-a,-c,0]),this._mercatorMatrix=o.N([],x,[this.worldSize,this.worldSize,this.worldSize]),o.N(x,x,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,x),o.M(x,x,[0,0,-this.elevation]),this._viewProjMatrix=x,this._invViewProjMatrix=o.aq([],x);const b=[0,0,-1,1];o.aw(b,b,this._invViewProjMatrix),this._cameraPosition=[b[0]/b[3],b[1]/b[3],b[2]/b[3]],this._fogMatrix=new Float64Array(16),o.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,_,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,o.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),o.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),o.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),o.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),o.M(this._fogMatrix,this._fogMatrix,[-a,-c,0]),o.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),o.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=o.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,x);const P=this._helper._width%2/2,I=this._helper._height%2/2,k=Math.cos(this.bearingInRadians),A=Math.sin(-this.bearingInRadians),R=a-Math.round(a)+k*P+A*I,O=c-Math.round(c)+k*I+A*P,W=new Float64Array(x);if(o.M(W,W,[R>.5?R-1:R,O>.5?O-1:O,0]),this._alignedProjMatrix=W,x=o.aq(new Float64Array(16),this._pixelMatrix),!x)throw new Error("failed to invert matrix");this._pixelMatrixInverse=x,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new o.P(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return o.aw(n,n,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=o.aj(1,this.center.lat)*this.worldSize;return pe(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,n){const a=o.a1.fromLngLat(e),c=[a.x*this.worldSize,a.y*this.worldSize,n,1];return o.aw(c,c,this._viewProjMatrix),c[2]/c[3]}getProjectionData(e){const{overscaledTileID:n,aligned:a,applyTerrainMatrix:c}=e,p=this._helper.getMercatorTileCoordinates(n),_=n?this.calculatePosMatrix(n,a,!0):null;let x;return x=n&&n.terrainRttPosMatrix32f&&c?n.terrainRttPosMatrix32f:_||o.b8(),{mainMatrix:x,tileMercatorCoords:p,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:x}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,n,a){return 1}transformLightDirection(e){return o.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,n,a,c){const p=this.calculatePosMatrix(a);let _;c?(_=[e,n,c(e,n),1],o.aw(_,_,p)):(_=[e,n,0,1],la(_,_,p));const x=_[3];return{point:new o.P(_[0]/x,_[1]/x),signedDistanceFromCamera:x,isOccluded:!1}}populateCache(e){for(const n of e)this.calculatePosMatrix(n)}getMatrixForModel(e,n){const a=o.a1.fromLngLat(e,n),c=a.meterInMercatorCoordinateUnits(),p=o.b9();return o.M(p,p,[a.x,a.y,a.z]),o.b6(p,p,Math.PI),o.b7(p,p,Math.PI/2),o.N(p,p,[-c,c,c]),p}getProjectionDataForCustomLayer(e=!0){const n=new o.Z(0,0,0,0,0),a=this.getProjectionData({overscaledTileID:n,applyGlobeMatrix:e}),c=re(n,this.worldSize);o.O(c,this._viewProjMatrix,c),a.tileMercatorCoords=[0,0,1,1];const p=[o.$,o.$,this.worldSize/this._helper.pixelsPerMeter],_=o.ba();return o.N(_,c,p),a.fallbackMatrix=_,a.mainMatrix=_,a}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function ah(){o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function Ci(h){if(h.useSlerp)if(h.k<1){const e=o.bb(h.startEulerAngles.roll,h.startEulerAngles.pitch,h.startEulerAngles.bearing),n=o.bb(h.endEulerAngles.roll,h.endEulerAngles.pitch,h.endEulerAngles.bearing),a=new Float64Array(4);o.bc(a,e,n,h.k);const c=o.bd(a);h.tr.setRoll(c.roll),h.tr.setPitch(c.pitch),h.tr.setBearing(c.bearing)}else h.tr.setRoll(h.endEulerAngles.roll),h.tr.setPitch(h.endEulerAngles.pitch),h.tr.setBearing(h.endEulerAngles.bearing);else h.tr.setRoll(o.C.number(h.startEulerAngles.roll,h.endEulerAngles.roll,h.k)),h.tr.setPitch(o.C.number(h.startEulerAngles.pitch,h.endEulerAngles.pitch,h.k)),h.tr.setBearing(o.C.number(h.startEulerAngles.bearing,h.endEulerAngles.bearing,h.k))}function $i(h,e,n,a,c){const p=c.padding,_=$(c.worldSize,n.getNorthWest()),x=$(c.worldSize,n.getNorthEast()),b=$(c.worldSize,n.getSouthEast()),P=$(c.worldSize,n.getSouthWest()),I=o.ae(-a),k=_.rotate(I),A=x.rotate(I),R=b.rotate(I),O=P.rotate(I),W=new o.P(Math.max(k.x,A.x,O.x,R.x),Math.max(k.y,A.y,O.y,R.y)),G=new o.P(Math.min(k.x,A.x,O.x,R.x),Math.min(k.y,A.y,O.y,R.y)),H=W.sub(G),J=(c.width-(p.left+p.right+e.left+e.right))/H.x,ie=(c.height-(p.top+p.bottom+e.top+e.bottom))/H.y;if(ie<0||J<0)return void ah();const Q=Math.min(o.ak(c.scale*Math.min(J,ie)),h.maxZoom),se=o.P.convert(h.offset),ue=new o.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(o.ae(a)),ee=se.add(ue).mult(c.scale/o.af(Q));return{center:te(c.worldSize,_.add(b).div(2).sub(ee)),zoom:Q,bearing:a}}class bi{get useGlobeControls(){return!1}handlePanInertia(e,n){return{easingOffset:e,easingCenter:n.center}}handleMapControlsRollPitchBearingZoom(e,n){e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta),e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta)}handleMapControlsPan(e,n,a){e.around.distSqr(n.centerPoint)<.01||n.setLocationAtPoint(a,e.around)}cameraForBoxAndBearing(e,n,a,c,p){return $i(e,n,a,c,p)}handleJumpToCenterZoom(e,n){e.zoom!==(n.zoom!==void 0?+n.zoom:e.zoom)&&e.setZoom(+n.zoom),n.center!==void 0&&e.setCenter(o.S.convert(n.center))}handleEaseTo(e,n){const a=e.zoom,c=e.padding,p={roll:e.roll,pitch:e.pitch,bearing:e.bearing},_={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},x=n.zoom!==void 0,b=!e.isPaddingEqual(n.padding);let P=!1;const I=x?+n.zoom:e.zoom;let k=e.centerPoint.add(n.offsetAsPoint);const A=e.screenPointToLocation(k),{center:R,zoom:O}=e.getConstrained(o.S.convert(n.center||A),I??a);Wo(e,R);const W=$(e.worldSize,A),G=$(e.worldSize,R).sub(W),H=o.af(O-a);return P=O!==a,{easeFunc:J=>{if(P&&e.setZoom(o.C.number(a,O,J)),o.be(p,_)||Ci({startEulerAngles:p,endEulerAngles:_,tr:e,k:J,useSlerp:p.roll!=_.roll}),b&&(e.interpolatePadding(c,n.padding,J),k=e.centerPoint.add(n.offsetAsPoint)),n.around)e.setLocationAtPoint(n.around,n.aroundPoint);else{const ie=o.af(e.zoom-a),Q=O>a?Math.min(2,H):Math.max(.5,H),se=Math.pow(Q,1-J),ue=te(e.worldSize,W.add(G.mult(J*se)).mult(ie));e.setLocationAtPoint(e.renderWorldCopies?ue.wrap():ue,k)}},isZooming:P,elevationCenter:R}}handleFlyTo(e,n){const a=n.zoom!==void 0,c=e.zoom,p=e.getConstrained(o.S.convert(n.center||n.locationAtOffset),a?+n.zoom:c),_=p.center,x=p.zoom;Wo(e,_);const b=$(e.worldSize,n.locationAtOffset),P=$(e.worldSize,_).sub(b),I=P.mag(),k=o.af(x-c);let A;if(n.minZoom!==void 0){const R=Math.min(+n.minZoom,c,x),O=e.getConstrained(_,R).zoom;A=o.af(O-c)}return{easeFunc:(R,O,W,G)=>{e.setZoom(R===1?x:c+o.ak(O));const H=R===1?_:te(e.worldSize,b.add(P.mult(W)).mult(O));e.setLocationAtPoint(e.renderWorldCopies?H.wrap():H,G)},scaleOfZoom:k,targetCenter:_,scaleOfMinZoom:A,pixelPathLength:I}}}class _r{constructor(e,n,a){this.blendFunction=e,this.blendColor=n,this.mask=a}}_r.Replace=[1,0],_r.disabled=new _r(_r.Replace,o.bf.transparent,[!1,!1,!1,!1]),_r.unblended=new _r(_r.Replace,o.bf.transparent,[!0,!0,!0,!0]),_r.alphaBlended=new _r([1,771],o.bf.transparent,[!0,!0,!0,!0]);const Ls=2305;class ct{constructor(e,n,a){this.enable=e,this.mode=n,this.frontFace=a}}ct.disabled=new ct(!1,1029,Ls),ct.backCCW=new ct(!0,1029,Ls),ct.frontCCW=new ct(!0,1028,Ls);class vt{constructor(e,n,a){this.func=e,this.mask=n,this.range=a}}vt.ReadOnly=!1,vt.ReadWrite=!0,vt.disabled=new vt(519,vt.ReadOnly,[0,1]);const Un=7680;class $t{constructor(e,n,a,c,p,_){this.test=e,this.ref=n,this.mask=a,this.fail=c,this.depthFail=p,this.pass=_}}$t.disabled=new $t({func:519,mask:0},0,0,Un,Un,Un);const Zi=new WeakMap;function En(h){var e;if(Zi.has(h))return Zi.get(h);{const n=(e=h.getParameter(h.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Zi.set(h,n),n}}class An{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const n=e.context,a=n.gl;this._texFormat=a.RGBA,this._texType=a.UNSIGNED_BYTE;const c=new o.aL;c.emplaceBack(-1,-1),c.emplaceBack(2,-1),c.emplaceBack(-1,2);const p=new o.aN;p.emplaceBack(0,1,2),this._fullscreenTriangle=new zs(n.createVertexBuffer(c,ds.members),n.createIndexBuffer(p),o.aM.simpleSegment(0,0,c.length,p.length)),this._resultBuffer=new Uint8Array(4),n.activeTexture.set(a.TEXTURE1);const _=a.createTexture();a.bindTexture(a.TEXTURE_2D,_),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texImage2D(a.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=n.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(_),En(a)&&(this._pbo=a.createBuffer(),a.bindBuffer(a.PIXEL_PACK_BUFFER,this._pbo),a.bufferData(a.PIXEL_PACK_BUFFER,4,a.STREAM_READ),a.bindBuffer(a.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,n){const a=this._updateCount;return this._readbackQueue?a>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():a>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,n),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,n=e.gl;e.activeTexture.set(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,n){const a=this._cachedRenderContext.context,c=a.gl;if(this._bindFramebuffer(),a.viewport.set([0,0,this._texWidth,this._texHeight]),a.clear({color:o.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(a,c.TRIANGLES,vt.disabled,$t.disabled,_r.unblended,ct.disabled,((p,_)=>({u_input:p,u_output_expected:_}))(e,n),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&En(c)){c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.readBuffer(c.COLOR_ATTACHMENT0),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);const p=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:p}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&En(e)){const n=e.clientWaitSync(this._readbackQueue.sync,0,0);if(n===e.WAIT_FAILED)return o.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(n===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=An._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let n=0;return n+=e[0]/256,n+=e[1]/65536,n+=e[2]/16777216,e[3]<127&&(n=-n),n/128}}const Xo=o.$/128;function wc(h,e){const n=h.granularity!==void 0?Math.max(h.granularity,1):1,a=n+(h.generateBorders?2:0),c=n+(h.extendToNorthPole||h.generateBorders?1:0)+(h.extendToSouthPole||h.generateBorders?1:0),p=a+1,_=c+1,x=h.generateBorders?-1:0,b=h.generateBorders||h.extendToNorthPole?-1:0,P=n+(h.generateBorders?1:0),I=n+(h.generateBorders||h.extendToSouthPole?1:0),k=p*_,A=a*c*6,R=p*_>65536;if(R&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const O=R||e==="32bit",W=new Int16Array(2*k);let G=0;for(let ie=b;ie<=I;ie++)for(let Q=x;Q<=P;Q++){let se=Q/n*o.$;Q===-1&&(se=-Xo),Q===n+1&&(se=o.$+Xo);let ue=ie/n*o.$;ie===-1&&(ue=h.extendToNorthPole?o.bh:-Xo),ie===n+1&&(ue=h.extendToSouthPole?o.bi:o.$+Xo),W[G++]=se,W[G++]=ue}const H=O?new Uint32Array(A):new Uint16Array(A);let J=0;for(let ie=0;ie<c;ie++)for(let Q=0;Q<a;Q++){const se=Q+1+ie*p,ue=Q+(ie+1)*p,ee=Q+1+(ie+1)*p;H[J++]=Q+ie*p,H[J++]=ue,H[J++]=se,H[J++]=se,H[J++]=ue,H[J++]=ee}return{vertices:W.buffer.slice(0),indices:H.buffer.slice(0),uses32bitIndices:O}}const pa=new o.aK({fill:new o.bj(128,2),line:new o.bj(512,0),tile:new o.bj(128,32),stencil:new o.bj(128,1),circle:3});class Ya{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return on.projectionGlobe}get vertexShaderPreludeCode(){return on.projectionMercator.vertexSource}get subdivisionGranularity(){return pa}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new An(e));const n=o.U(this._errorQueryLatitudeDegrees),a=2*Math.atan(Math.exp(Math.PI-n*Math.PI*2))-.5*Math.PI,c=this._errorMeasurement.updateErrorLoop(n,a),p=he.now();c!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=c,this._errorMeasurementLastChangeTime=p);const _=Math.min(Math.max((p-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=o.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,o.bl(_))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,n,a,c,p){const _=(p==="stencil"?pa.stencil:pa.tile).getGranularityForZoomLevel(n.z);return this._getMesh(e,{granularity:_,generateBorders:a,extendToNorthPole:n.y===0&&c,extendToSouthPole:n.y===(1<<n.z)-1&&c})}_getMesh(e,n){const a=this._getMeshKey(n);if(a in this._tileMeshCache)return this._tileMeshCache[a];const c=(function(p,_){const x=wc(_,"16bit"),b=o.aL.deserialize({arrayBuffer:x.vertices,length:x.vertices.byteLength/2/2}),P=o.aN.deserialize({arrayBuffer:x.indices,length:x.indices.byteLength/2/3});return new zs(p.createVertexBuffer(b,ds.members),p.createIndexBuffer(P),o.aM.simpleSegment(0,0,b.length,P.length))})(e,n);return this._tileMeshCache[a]=c,c}recalculate(e){}hasTransition(){const e=he.now();let n=!1;return n=n||(e-this._errorMeasurementLastChangeTime)/1e3<.7,n=n||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,n}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const Ko=new o.r({type:new o.D(o.v.projection.type)});class Yo extends o.E{constructor(e){super(),this._transitionable=new o.t(Ko),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new o.F(0)),this._mercatorProjection=new Et,this._verticalPerspectiveProjection=new Ya}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof o.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,n,a,c,p){return this.currentProjection.getMeshFromTileID(e,n,a,c,p)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function Jo(h){const e=fa(h.worldSize,h.center.lat);return 2*Math.PI*e}function ln(h,e,n,a,c){const p=1/(1<<c),_=e/o.$*p+a*p,x=o.bo((h/o.$*p+n*p)*Math.PI*2+Math.PI,2*Math.PI),b=2*Math.atan(Math.exp(Math.PI-_*Math.PI*2))-.5*Math.PI,P=Math.cos(b),I=new Float64Array(3);return I[0]=Math.sin(x)*P,I[1]=Math.sin(b),I[2]=Math.cos(x)*P,I}function oi(h){return(function(e,n){const a=Math.cos(n),c=new Float64Array(3);return c[0]=Math.sin(e)*a,c[1]=Math.sin(n),c[2]=Math.cos(e)*a,c})(h.lng*Math.PI/180,h.lat*Math.PI/180)}function fa(h,e){return h/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Ja(h){const e=Math.asin(h[1])/Math.PI*180,n=Math.sqrt(h[0]*h[0]+h[2]*h[2]);if(n>1e-6){const a=h[0]/n,c=Math.acos(h[2]/n),p=(a>0?c:-c)/Math.PI*180;return new o.S(o.aO(p,-180,180),e)}return new o.S(0,e)}function Bs(h){return Math.cos(h*Math.PI/180)}function jr(h,e){const n=Bs(h),a=Bs(e);return o.ak(a/n)}function oh(h,e){const n=h.rotate(e.bearingInRadians),a=e.zoom+jr(e.center.lat,0),c=o.bk(1/Bs(e.center.lat),1/Bs(Math.min(Math.abs(e.center.lat),60)),o.bn(a,7,3,0,1)),p=360/Jo({worldSize:e.worldSize,center:{lat:e.center.lat}});return new o.S(e.center.lng-n.x*p*c,o.ah(e.center.lat+n.y*p,-o.ai,o.ai))}function Qa(h){const e=.5*h,n=Math.sin(e),a=Math.cos(e);return Math.log(n+a)-Math.log(a-n)}function Tc(h,e,n,a){const c=h.lat+n*a;if(Math.abs(n)>1){const p=(Math.sign(h.lat+n)!==Math.sign(h.lat)?-Math.abs(h.lat):Math.abs(h.lat))*Math.PI/180,_=Math.abs(h.lat+n)*Math.PI/180,x=Qa(p+a*(_-p)),b=Qa(p),P=Qa(_);return new o.S(h.lng+e*((x-b)/(P-b)),c)}return new o.S(h.lng+e*a,c)}class Kd{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,n,a,c){const p=`${e.z}_${e.x}_${e.y}_${c?.terrain?"t":""}`,_=this._cache.get(p);if(_)return _;const x=this._cachePrevious.get(p);if(x)return this._cache.set(p,x),x;const b=this._boundingVolumeFactory(e,n,a,c);return this._cache.set(p,b),this._hadAnyChanges=!0,b}}class ma{constructor(e,n,a,c){this.min=a,this.max=c,this.points=e,this.planes=n}static fromAabb(e,n){const a=[];for(let c=0;c<8;c++)a.push([1&~c?e[0]:n[0],(c>>1&1)==1?n[1]:e[1],(c>>2&1)==1?n[2]:e[2]]);return new ma(a,[[-1,0,0,n[0]],[1,0,0,-e[0]],[0,-1,0,n[1]],[0,1,0,-e[1]],[0,0,-1,n[2]],[0,0,1,-e[2]]],e,n)}static fromCenterSizeAngles(e,n,a){const c=o.br([],a[0],a[1],a[2]),p=o.bs([],[n[0],0,0],c),_=o.bs([],[0,n[1],0],c),x=o.bs([],[0,0,n[2]],c),b=[...e],P=[...e];for(let k=0;k<8;k++)for(let A=0;A<3;A++){const R=e[A]+p[A]*(1&~k?-1:1)+_[A]*((k>>1&1)==1?1:-1)+x[A]*((k>>2&1)==1?1:-1);b[A]=Math.min(b[A],R),P[A]=Math.max(P[A],R)}const I=[];for(let k=0;k<8;k++){const A=[...e];o.aS(A,A,o.aR([],p,1&~k?-1:1)),o.aS(A,A,o.aR([],_,(k>>1&1)==1?1:-1)),o.aS(A,A,o.aR([],x,(k>>2&1)==1?1:-1)),I.push(A)}return new ma(I,[[...p,-o.aX(p,I[0])],[..._,-o.aX(_,I[0])],[...x,-o.aX(x,I[0])],[-p[0],-p[1],-p[2],-o.aX(p,I[7])],[-_[0],-_[1],-_[2],-o.aX(_,I[7])],[-x[0],-x[1],-x[2],-o.aX(x,I[7])]],b,P)}intersectsFrustum(e){let n=!0;const a=this.points.length,c=this.planes.length,p=e.planes.length,_=e.points.length;for(let x=0;x<p;x++){const b=e.planes[x];let P=0;for(let I=0;I<a;I++){const k=this.points[I];b[0]*k[0]+b[1]*k[1]+b[2]*k[2]+b[3]>=0&&P++}if(P===0)return 0;P<a&&(n=!1)}if(n)return 2;for(let x=0;x<c;x++){const b=this.planes[x];let P=0;for(let I=0;I<_;I++){const k=e.points[I];b[0]*k[0]+b[1]*k[1]+b[2]*k[2]+b[3]>=0&&P++}if(P===0)return 0}return 1}intersectsPlane(e){const n=this.points.length;let a=0;for(let c=0;c<n;c++){const p=this.points[c];e[0]*p[0]+e[1]*p[1]+e[2]*p[2]+e[3]>=0&&a++}return a===n?2:a===0?0:1}}function gi(h,e,n){const a=h-e;return a<0?-a:Math.max(0,a-n)}function eo(h,e,n,a,c){const p=h-n;let _;return _=p<0?Math.min(-p,1+p-c):p>1?Math.min(Math.max(p-c,0),1-p):0,Math.max(_,gi(e,a,c))}class kn{constructor(){this._boundingVolumeCache=new Kd(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,n,a,c){const p=1<<a.z,_=1/p,x=a.x/p,b=a.y/p;let P=2;return P=Math.min(P,eo(e,n,x,b,_)),P=Math.min(P,eo(e,n,x+.5,-b-_,_)),P=Math.min(P,eo(e,n,x+.5,2-b-_,_)),P}getWrap(e,n,a){const c=1<<n.z,p=1/c,_=n.x/c,x=gi(e.x,_,p),b=gi(e.x,_-1,p),P=gi(e.x,_+1,p),I=Math.min(x,b,P);return I===P?1:I===b?-1:0}allowVariableZoom(e,n){return Ke(e,n)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,n,a,c){return this._boundingVolumeCache.getTileBoundingVolume(e,n,a,c)}_computeTileBoundingVolume(e,n,a,c){var p,_;let x=0,b=0;if(c?.terrain){const P=new o.Z(e.z,n,e.z,e.x,e.y),I=c.terrain.getMinMaxElevation(P);x=(p=I.minElevation)!==null&&p!==void 0?p:Math.min(0,a),b=(_=I.maxElevation)!==null&&_!==void 0?_:Math.max(0,a)}if(x/=o.bu,b/=o.bu,x+=1,b+=1,e.z<=0)return ma.fromAabb([-b,-b,-b],[b,b,b]);if(e.z===1)return ma.fromAabb([e.x===0?-b:0,e.y===0?0:-b,-b],[e.x===0?0:b,e.y===0?b:0,b]);{const P=[ln(0,0,e.x,e.y,e.z),ln(o.$,0,e.x,e.y,e.z),ln(o.$,o.$,e.x,e.y,e.z),ln(0,o.$,e.x,e.y,e.z)],I=[];for(const xe of P)I.push(o.aR([],xe,b));if(b!==x)for(const xe of P)I.push(o.aR([],xe,x));e.y===0&&I.push([0,1,0]),e.y===(1<<e.z)-1&&I.push([0,-1,0]);const k=[1,1,1],A=[-1,-1,-1];for(const xe of I)for(let we=0;we<3;we++)k[we]=Math.min(k[we],xe[we]),A[we]=Math.max(A[we],xe[we]);const R=ln(o.$/2,o.$/2,e.x,e.y,e.z),O=o.aW([],[0,1,0],R);o.aV(O,O);const W=o.aW([],R,O);o.aV(W,W);const G=o.aW([],P[2],P[1]);o.aV(G,G);const H=o.aW([],P[0],P[3]);o.aV(H,H),I.push(o.aR([],R,b)),e.y>=(1<<e.z)/2&&I.push(o.aR([],ln(o.$/2,0,e.x,e.y,e.z),b)),e.y<(1<<e.z)/2&&I.push(o.aR([],ln(o.$/2,o.$,e.x,e.y,e.z),b));const J=to(R,I),ie=to(W,I),Q=[-R[0],-R[1],-R[2],J.max],se=[R[0],R[1],R[2],-J.min],ue=[-W[0],-W[1],-W[2],ie.max],ee=[W[0],W[1],W[2],-ie.min],ge=[...G,0],Te=[...H,0],ve=[];return e.y===0?ve.push(o.bt(Te,ge,Q),o.bt(Te,ge,se)):ve.push(o.bt(ue,ge,Q),o.bt(ue,ge,se),o.bt(ue,Te,Q),o.bt(ue,Te,se)),e.y===(1<<e.z)-1?ve.push(o.bt(Te,ge,Q),o.bt(Te,ge,se)):ve.push(o.bt(ee,ge,Q),o.bt(ee,ge,se),o.bt(ee,Te,Q),o.bt(ee,Te,se)),new ma(ve,[Q,se,ue,ee,ge,Te],k,A)}}}function to(h,e){let n=1/0,a=-1/0;for(const c of e){const p=o.aX(h,c);n=Math.min(n,p),a=Math.max(a,p)}return{min:n,max:a}}class ro{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,a){return this._helper.interpolatePadding(e,n,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n){this._helper.resize(e,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(){this._cachedClippingPlane=o.bv(),this._projectionMatrix=o.b9(),this._globeViewProjMatrix32f=o.b8(),this._globeViewProjMatrixNoCorrection=o.b9(),this._globeViewProjMatrixNoCorrectionInverted=o.b9(),this._globeProjMatrixInverted=o.b9(),this._cameraPosition=o.bp(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._coveringTilesDetailsProvider=new kn}clone(){const e=new ro;return e.apply(this),e}apply(e,n){this._globeLatitudeErrorCorrectionRadians=n||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=o.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:n,applyGlobeMatrix:a}=e,c=this._helper.getMercatorTileCoordinates(n);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:c,clippingPlane:this._cachedClippingPlane,projectionTransition:a?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const n=this.pitchInRadians,a=this.cameraToCenterDistance/e,c=Math.sin(n)*a,p=Math.cos(n)*a+1,_=1/Math.sqrt(c*c+p*p)*1;let x=-c,b=p;const P=Math.sqrt(x*x+b*b);x/=P,b/=P;const I=[0,x,b];o.bw(I,I,[0,0,0],-this.bearingInRadians),o.bx(I,I,[0,0,0],-1*this.center.lat*Math.PI/180),o.by(I,I,[0,0,0],this.center.lng*Math.PI/180);const k=1/o.aZ(I);return o.aR(I,I,k),[...I,-_*k]}isLocationOccluded(e){return!this.isSurfacePointVisible(oi(e))}transformLightDirection(e){const n=this._helper._center.lng*Math.PI/180,a=this._helper._center.lat*Math.PI/180,c=Math.cos(a),p=[Math.sin(n)*c,Math.sin(a),Math.cos(n)*c],_=[p[2],0,-p[0]],x=[0,0,0];o.aW(x,_,p),o.aV(_,_),o.aV(x,x);const b=[0,0,0];return o.aV(b,[_[0]*e[0]+x[0]*e[1]+p[0]*e[2],_[1]*e[0]+x[1]*e[1]+p[1]*e[2],_[2]*e[0]+x[2]*e[1]+p[2]*e[2]]),b}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,n,a){const c=(function(x,b,P){const I=1/(1<<P.z);return new o.a1(x/o.$*I+P.x*I,b/o.$*I+P.y*I)})(e,n,a.canonical),p=(_=c.y,[o.bo(c.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-_*Math.PI*2))-.5*Math.PI]);var _;return this.getCircleRadiusCorrection()/Math.cos(p[1])}projectTileCoordinates(e,n,a,c){const p=a.canonical,_=ln(e,n,p.x,p.y,p.z),x=1+(c?c(e,n):0)/o.bu,b=[_[0]*x,_[1]*x,_[2]*x,1];o.aw(b,b,this._globeViewProjMatrixNoCorrection);const P=this._cachedClippingPlane,I=P[0]*_[0]+P[1]*_[1]+P[2]*_[2]+P[3]<0;return{point:new o.P(b[0]/b[3],b[1]/b[3]),signedDistanceFromCamera:b[3],isOccluded:I}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=fa(this.worldSize,this.center.lat),n=o.ba(),a=o.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),o.b4(n,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const c=this.centerOffset;n[8]=2*-c.x/this._helper._width,n[9]=2*c.y/this._helper._height,this._projectionMatrix=o.b5(n),this._globeProjMatrixInverted=o.ba(),o.aq(this._globeProjMatrixInverted,n),o.M(n,n,[0,0,-this.cameraToCenterDistance]),o.b6(n,n,this.rollInRadians),o.b7(n,n,-this.pitchInRadians),o.b6(n,n,this.bearingInRadians),o.M(n,n,[0,0,-e]);const p=o.bp();p[0]=e,p[1]=e,p[2]=e,o.b7(a,n,this.center.lat*Math.PI/180),o.bz(a,a,-this.center.lng*Math.PI/180),o.N(a,a,p),this._globeViewProjMatrixNoCorrection=a,o.b7(n,n,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),o.bz(n,n,-this.center.lng*Math.PI/180),o.N(n,n,p),this._globeViewProjMatrix32f=new Float32Array(n),this._globeViewProjMatrixNoCorrectionInverted=o.ba(),o.aq(this._globeViewProjMatrixNoCorrectionInverted,a);const _=o.bp();this._cameraPosition=o.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,o.bw(this._cameraPosition,this._cameraPosition,_,-this.rollInRadians),o.bx(this._cameraPosition,this._cameraPosition,_,this.pitchInRadians),o.bw(this._cameraPosition,this._cameraPosition,_,-this.bearingInRadians),o.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),o.bx(this._cameraPosition,this._cameraPosition,_,-this.center.lat*Math.PI/180),o.by(this._cameraPosition,this._cameraPosition,_,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const x=o.b5(this._globeViewProjMatrixNoCorrectionInverted);o.N(x,x,[1,1,-1]),this._cachedFrustum=Wr.fromInvProjectionMatrix(x,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){o.w("calculateFogMatrix is not supported on globe projection.");const n=o.ba();return o.ag(n),n}getVisibleUnwrappedCoordinates(e){return[new o.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&o.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){if(!this._globeViewProjMatrixNoCorrection)return 1;const a=oi(e);o.aR(a,a,1+n/o.bu);const c=o.bv();return o.aw(c,[a[0],a[1],a[2],1],this._globeViewProjMatrixNoCorrection),c[2]/c[3]}populateCache(e){}getBounds(){const e=.5*this.width,n=.5*this.height,a=[new o.P(0,0),new o.P(e,0),new o.P(this.width,0),new o.P(this.width,n),new o.P(this.width,this.height),new o.P(e,this.height),new o.P(0,this.height),new o.P(0,n)],c=[];for(const k of a)c.push(this.unprojectScreenPoint(k));let p=0,_=0,x=0,b=0;const P=this.center;for(const k of c){const A=o.bA(P.lng,k.lng),R=o.bA(P.lat,k.lat);A<_&&(_=A),A>p&&(p=A),R<b&&(b=R),R>x&&(x=R)}const I=[P.lng+_,P.lat+b,P.lng+p,P.lat+x];return this.isSurfacePointOnScreen([0,1,0])&&(I[3]=90,I[0]=-180,I[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(I[1]=-90,I[0]=-180,I[2]=180),new yt(I)}getConstrained(e,n){const a=o.ah(e.lat,-o.ai,o.ai),c=o.ah(+n,this.minZoom+jr(0,a),this.maxZoom);return{center:new o.S(e.lng,a),zoom:c}}calculateCenterFromCameraLngLatAlt(e,n,a,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,a,c)}setLocationAtPoint(e,n){const a=oi(this.unprojectScreenPoint(n)),c=oi(e),p=o.bp();o.bB(p);const _=o.bp();o.by(_,a,p,-this.center.lng*Math.PI/180),o.bx(_,_,p,this.center.lat*Math.PI/180);const x=c[0]*c[0]+c[2]*c[2],b=_[0]*_[0];if(x<b)return;const P=Math.sqrt(x-b),I=-P,k=o.bC(c[0],c[2],_[0],P),A=o.bC(c[0],c[2],_[0],I),R=o.bp();o.by(R,c,p,-k);const O=o.bC(R[1],R[2],_[1],_[2]),W=o.bp();o.by(W,c,p,-A);const G=o.bC(W[1],W[2],_[1],_[2]),H=.5*Math.PI,J=O>=-H&&O<=H,ie=G>=-H&&G<=H;let Q,se;if(J&&ie){const Te=this.center.lng*Math.PI/180,ve=this.center.lat*Math.PI/180;o.bD(k,Te)+o.bD(O,ve)<o.bD(A,Te)+o.bD(G,ve)?(Q=k,se=O):(Q=A,se=G)}else if(J)Q=k,se=O;else{if(!ie)return;Q=A,se=G}const ue=Q/Math.PI*180,ee=se/Math.PI*180,ge=this.center.lat;this.setCenter(new o.S(ue,o.ah(ee,-90,90))),this.setZoom(this.zoom+jr(ge,this.center.lat))}locationToScreenPoint(e,n){const a=oi(e);if(n){const c=n.getElevationForLngLatZoom(e,this._helper._tileZoom);o.aR(a,a,1+c/o.bu)}return this._projectSurfacePointToScreen(a)}_projectSurfacePointToScreen(e){const n=o.bv();return o.aw(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],new o.P((.5*n[0]+.5)*this.width,(.5*-n[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,n){if(n){const a=n.pointCoordinate(e);if(a)return a}return o.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,n){var a;return(a=this.screenPointToMercatorCoordinate(e,n))===null||a===void 0?void 0:a.toLngLat()}isPointOnMapSurface(e,n){const a=this._cameraPosition,c=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(a,c)}getRayDirectionFromPixel(e){const n=o.bv();n[0]=e.x/this.width*2-1,n[1]=-1*(e.y/this.height*2-1),n[2]=1,n[3]=1,o.aw(n,n,this._globeViewProjMatrixNoCorrectionInverted),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3];const a=o.bp();a[0]=n[0]-this._cameraPosition[0],a[1]=n[1]-this._cameraPosition[1],a[2]=n[2]-this._cameraPosition[2];const c=o.bp();return o.aV(c,a),c}isSurfacePointVisible(e){const n=this._cachedClippingPlane;return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]+n[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const n=o.bv();return o.aw(n,[...e,1],this._globeViewProjMatrixNoCorrection),n[0]/=n[3],n[1]/=n[3],n[2]/=n[3],n[0]>-1&&n[0]<1&&n[1]>-1&&n[1]<1&&n[2]>-1&&n[2]<1}rayPlanetIntersection(e,n){const a=o.aX(e,n),c=o.bp(),p=o.bp();o.aR(p,n,a),o.aU(c,e,p);const _=1-o.aX(c,c);if(_<0)return null;const x=o.aX(e,e)-1,b=-a+(a<0?1:-1)*Math.sqrt(_),P=x/b,I=b;return{tMin:Math.min(P,I),tMax:Math.max(P,I)}}unprojectScreenPoint(e){const n=this._cameraPosition,a=this.getRayDirectionFromPixel(e),c=this.rayPlanetIntersection(n,a);if(c){const I=o.bp();o.aS(I,n,[a[0]*c.tMin,a[1]*c.tMin,a[2]*c.tMin]);const k=o.bp();return o.aV(k,I),Ja(k)}const p=this._cachedClippingPlane,_=p[0]*a[0]+p[1]*a[1]+p[2]*a[2],x=-o.b1(p,n)/_,b=o.bp();if(x>0)o.aS(b,n,[a[0]*x,a[1]*x,a[2]*x]);else{const I=o.bp();o.aS(I,n,[2*a[0],2*a[1],2*a[2]]);const k=o.b1(this._cachedClippingPlane,I);o.aU(b,I,[this._cachedClippingPlane[0]*k,this._cachedClippingPlane[1]*k,this._cachedClippingPlane[2]*k])}const P=(function(I){const k=o.bp();return k[0]=I[0]*-I[3],k[1]=I[1]*-I[3],k[2]=I[2]*-I[3],{center:k,radius:Math.sqrt(1-I[3]*I[3])}})(p);return Ja((function(I,k,A){const R=o.bp();o.aU(R,A,I);const O=o.bp();return o.bq(O,I,R,k/o.a$(R)),O})(P.center,P.radius,b))}getMatrixForModel(e,n){const a=o.S.convert(e),c=1/o.bu,p=o.b9();return o.bz(p,p,a.lng/180*Math.PI),o.b7(p,p,-a.lat/180*Math.PI),o.M(p,p,[0,0,1+n/o.bu]),o.b7(p,p,.5*Math.PI),o.N(p,p,[c,c,c]),p}getProjectionDataForCustomLayer(e=!0){const n=this.getProjectionData({overscaledTileID:new o.Z(0,0,0,0,0),applyGlobeMatrix:e});return n.tileMercatorCoords=[0,0,1,1],n}getFastPathSimpleProjectionMatrix(e){}}class io{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,n,a){return this._helper.interpolatePadding(e,n,a)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,n,a=!0){this._helper.resize(e,n,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}overrideNearFarZ(e,n){this._helper.overrideNearFarZ(e,n)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,n){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=n,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Pi({calcMatrices:()=>{this._calcMatrices()},getConstrained:(e,n)=>this.getConstrained(e,n)}),this._globeness=1,this._mercatorTransform=new ur,this._verticalPerspectiveTransform=new ro}clone(){const e=new io;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const n=this._mercatorTransform.getProjectionData(e),a=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?a.mainMatrix:n.mainMatrix,clippingPlane:a.clippingPlane,tileMercatorCoords:a.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:n.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return o.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return o.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,n,a){const c=this._mercatorTransform.getPitchedTextCorrection(e,n,a),p=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,n,a);return o.bk(c,p,this._globeness)}projectTileCoordinates(e,n,a,c){return this.currentTransform.projectTileCoordinates(e,n,a,c)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,n){return this.currentTransform.lngLatToCameraDepth(e,n)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}getConstrained(e,n){return this.currentTransform.getConstrained(e,n)}calculateCenterFromCameraLngLatAlt(e,n,a,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,n,a,c)}setLocationAtPoint(e,n){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,n),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,n),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,n){return this.currentTransform.locationToScreenPoint(e,n)}screenPointToMercatorCoordinate(e,n){return this.currentTransform.screenPointToMercatorCoordinate(e,n)}screenPointToLocation(e,n){return this.currentTransform.screenPointToLocation(e,n)}isPointOnMapSurface(e,n){return this.currentTransform.isPointOnMapSurface(e,n)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,n){return this.currentTransform.getMatrixForModel(e,n)}getProjectionDataForCustomLayer(e=!0){const n=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return n;const a=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return a.fallbackMatrix=n.mainMatrix,a}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class wi{get useGlobeControls(){return!0}handlePanInertia(e,n){const a=oh(e,n);return Math.abs(a.lng-n.center.lng)>180&&(a.lng=n.center.lng+179.5*Math.sign(a.lng-n.center.lng)),{easingCenter:a,easingOffset:new o.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,n){const a=e.around,c=n.screenPointToLocation(a);e.bearingDelta&&n.setBearing(n.bearing+e.bearingDelta),e.pitchDelta&&n.setPitch(n.pitch+e.pitchDelta),e.rollDelta&&n.setRoll(n.roll+e.rollDelta);const p=n.zoom;e.zoomDelta&&n.setZoom(n.zoom+e.zoomDelta);const _=n.zoom-p;if(_===0)return;const x=o.bA(n.center.lng,c.lng),b=x/(Math.abs(x/180)+1),P=o.bA(n.center.lat,c.lat),I=n.getRayDirectionFromPixel(a),k=n.cameraPosition,A=-1*o.aX(k,I),R=o.bp();o.aS(R,k,[I[0]*A,I[1]*A,I[2]*A]);const O=o.aZ(R)-1,W=Math.exp(.5*-Math.max(O-.3,0)),G=fa(n.worldSize,n.center.lat)/Math.min(n.width,n.height),H=o.bn(G,.9,.5,1,.25),J=(1-o.af(-_))*Math.min(W,H),ie=n.center.lat,Q=n.zoom,se=new o.S(n.center.lng+b*J,o.ah(n.center.lat+P*J,-o.ai,o.ai));n.setLocationAtPoint(c,a);const ue=n.center,ee=o.bn(Math.abs(x),45,85,0,1),ge=o.bn(G,.75,.35,0,1),Te=Math.pow(Math.max(ee,ge),.25),ve=o.bA(ue.lng,se.lng),xe=o.bA(ue.lat,se.lat);n.setCenter(new o.S(ue.lng+ve*Te,ue.lat+xe*Te).wrap()),n.setZoom(Q+jr(ie,n.center.lat))}handleMapControlsPan(e,n,a){if(!e.panDelta)return;const c=n.center.lat,p=n.zoom;n.setCenter(oh(e.panDelta,n).wrap()),n.setZoom(p+jr(c,n.center.lat))}cameraForBoxAndBearing(e,n,a,c,p){const _=$i(e,n,a,c,p),x=n.left/p.width*2-1,b=(p.width-n.right)/p.width*2-1,P=n.top/p.height*-2+1,I=(p.height-n.bottom)/p.height*-2+1,k=o.bA(a.getWest(),a.getEast())<0,A=k?a.getEast():a.getWest(),R=k?a.getWest():a.getEast(),O=Math.max(a.getNorth(),a.getSouth()),W=Math.min(a.getNorth(),a.getSouth()),G=A+.5*o.bA(A,R),H=O+.5*o.bA(O,W),J=p.clone();J.setCenter(_.center),J.setBearing(_.bearing),J.setPitch(0),J.setRoll(0),J.setZoom(_.zoom);const ie=J.modelViewProjectionMatrix,Q=[oi(a.getNorthWest()),oi(a.getNorthEast()),oi(a.getSouthWest()),oi(a.getSouthEast()),oi(new o.S(R,H)),oi(new o.S(A,H)),oi(new o.S(G,O)),oi(new o.S(G,W))],se=oi(_.center);let ue=Number.POSITIVE_INFINITY;for(const ee of Q)x<0&&(ue=wi.getLesserNonNegativeNonNull(ue,wi.solveVectorScale(ee,se,ie,"x",x))),b>0&&(ue=wi.getLesserNonNegativeNonNull(ue,wi.solveVectorScale(ee,se,ie,"x",b))),P>0&&(ue=wi.getLesserNonNegativeNonNull(ue,wi.solveVectorScale(ee,se,ie,"y",P))),I<0&&(ue=wi.getLesserNonNegativeNonNull(ue,wi.solveVectorScale(ee,se,ie,"y",I)));if(Number.isFinite(ue)&&ue!==0)return _.zoom=J.zoom+o.ak(ue),_;ah()}handleJumpToCenterZoom(e,n){const a=e.center.lat,c=e.getConstrained(n.center?o.S.convert(n.center):e.center,e.zoom).center;e.setCenter(c.wrap());const p=n.zoom!==void 0?+n.zoom:e.zoom+jr(a,c.lat);e.zoom!==p&&e.setZoom(p)}handleEaseTo(e,n){const a=e.zoom,c=e.center,p=e.padding,_={roll:e.roll,pitch:e.pitch,bearing:e.bearing},x={roll:n.roll===void 0?e.roll:n.roll,pitch:n.pitch===void 0?e.pitch:n.pitch,bearing:n.bearing===void 0?e.bearing:n.bearing},b=n.zoom!==void 0,P=!e.isPaddingEqual(n.padding);let I=!1;const k=n.center?o.S.convert(n.center):c,A=e.getConstrained(k,a).center;Wo(e,A);const R=e.clone();R.setCenter(A),R.setZoom(b?+n.zoom:a+jr(c.lat,k.lat)),R.setBearing(n.bearing);const O=new o.P(o.ah(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),o.ah(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));R.setLocationAtPoint(A,O);const W=(n.offset&&n.offsetAsPoint.mag())>0?R.center:A,G=b?+n.zoom:a+jr(c.lat,W.lat),H=a+jr(c.lat,0),J=G+jr(W.lat,0),ie=o.bA(c.lng,W.lng),Q=o.bA(c.lat,W.lat),se=o.af(J-H);return I=G!==a,{easeFunc:ue=>{if(o.be(_,x)||Ci({startEulerAngles:_,endEulerAngles:x,tr:e,k:ue,useSlerp:_.roll!=x.roll}),P&&e.interpolatePadding(p,n.padding,ue),n.around)o.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(n.around,n.aroundPoint);else{const ee=J>H?Math.min(2,se):Math.max(.5,se),ge=Math.pow(ee,1-ue),Te=Tc(c,ie,Q,ue*ge);e.setCenter(Te.wrap())}if(I){const ee=o.C.number(H,J,ue)+jr(0,e.center.lat);e.setZoom(ee)}},isZooming:I,elevationCenter:W}}handleFlyTo(e,n){const a=n.zoom!==void 0,c=e.center,p=e.zoom,_=e.padding,x=!e.isPaddingEqual(n.padding),b=e.getConstrained(o.S.convert(n.center||n.locationAtOffset),p).center,P=a?+n.zoom:e.zoom+jr(e.center.lat,b.lat),I=e.clone();I.setCenter(b),I.setZoom(P),I.setBearing(n.bearing);const k=new o.P(o.ah(e.centerPoint.x+n.offsetAsPoint.x,0,e.width),o.ah(e.centerPoint.y+n.offsetAsPoint.y,0,e.height));I.setLocationAtPoint(b,k);const A=I.center;Wo(e,A);const R=(function(Q,se,ue){const ee=oi(se),ge=oi(ue),Te=o.aX(ee,ge),ve=Math.acos(Te),xe=Jo(Q);return ve/(2*Math.PI)*xe})(e,c,A),O=p+jr(c.lat,0),W=P+jr(A.lat,0),G=o.af(W-O);let H;if(typeof n.minZoom=="number"){const Q=+n.minZoom+jr(A.lat,0),se=Math.min(Q,O,W)+jr(0,A.lat),ue=e.getConstrained(A,se).zoom+jr(A.lat,0);H=o.af(ue-O)}const J=o.bA(c.lng,A.lng),ie=o.bA(c.lat,A.lat);return{easeFunc:(Q,se,ue,ee)=>{const ge=Tc(c,J,ie,ue);x&&e.interpolatePadding(_,n.padding,Q);const Te=Q===1?A:ge;e.setCenter(Te.wrap());const ve=O+o.ak(se);e.setZoom(Q===1?P:ve+jr(0,Te.lat))},scaleOfZoom:G,targetCenter:A,scaleOfMinZoom:H,pixelPathLength:R}}static solveVectorScale(e,n,a,c,p){const _=c==="x"?[a[0],a[4],a[8],a[12]]:[a[1],a[5],a[9],a[13]],x=[a[3],a[7],a[11],a[15]],b=e[0]*_[0]+e[1]*_[1]+e[2]*_[2],P=e[0]*x[0]+e[1]*x[1]+e[2]*x[2],I=n[0]*_[0]+n[1]*_[1]+n[2]*_[2],k=n[0]*x[0]+n[1]*x[1]+n[2]*x[2];return I+p*P===b+p*k||x[3]*(b-I)+_[3]*(k-P)+b*k==I*P?null:(I+_[3]-p*k-p*x[3])/(I-b-p*k+p*P)}static getLesserNonNegativeNonNull(e,n){return n!==null&&n>=0&&n<e?n:e}}class lh{constructor(e){this._globe=e,this._mercatorCameraHelper=new bi,this._verticalPerspectiveCameraHelper=new wi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,n){return this.currentHelper.handlePanInertia(e,n)}handleMapControlsRollPitchBearingZoom(e,n){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,n)}handleMapControlsPan(e,n,a){this.currentHelper.handleMapControlsPan(e,n,a)}cameraForBoxAndBearing(e,n,a,c,p){return this.currentHelper.cameraForBoxAndBearing(e,n,a,c,p)}handleJumpToCenterZoom(e,n){this.currentHelper.handleJumpToCenterZoom(e,n)}handleEaseTo(e,n){return this.currentHelper.handleEaseTo(e,n)}handleFlyTo(e,n){return this.currentHelper.handleFlyTo(e,n)}}const Qo=(h,e)=>o.y(h,e&&e.filter((n=>n.identifier!=="source.canvas"))),Yd=o.bE();class Sc extends o.E{constructor(e,n={}){super(),this._rtlPluginLoaded=()=>{for(const a in this.sourceCaches){const c=this.sourceCaches[a].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[a].reload()}},this.map=e,this.dispatcher=new Qt(vr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((a,c)=>this.getGlyphs(a,c))),this.dispatcher.registerMessageHandler("GI",((a,c)=>this.getImages(a,c))),this.imageManager=new gt,this.imageManager.setEventedParent(this),this.glyphManager=new mt(e._requestManager,n.localIdeographFontFamily),this.lineAtlas=new ht(256,512),this.crossTileSymbolIndex=new da,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",o.bG()),Ui().on(Fr,this._rtlPluginLoaded),this.on("data",(a=>{if(a.dataType!=="source"||a.sourceDataType!=="metadata")return;const c=this.sourceCaches[a.sourceId];if(!c)return;const p=c.getSource();if(p&&p.vectorLayerIds)for(const _ in this._layers){const x=this._layers[_];x.source===p.id&&this._validateLayer(x)}}))}setGlobalStateProperty(e,n){var a,c,p;this._checkLoaded();const _=n===null?(p=(c=(a=this.stylesheet.state)===null||a===void 0?void 0:a[e])===null||c===void 0?void 0:c.default)!==null&&p!==void 0?p:null:n;if(o.bH(_,this._globalState[e]))return this;this._globalState[e]=_;const x=this._findGlobalStateAffectedSources([e]);for(const b in this.sourceCaches)x.has(b)&&(this._reloadSource(b),this._changed=!0)}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const n=[];for(const c in e)!o.bH(this._globalState[c],e[c].default)&&(n.push(c),this._globalState[c]=e[c].default);const a=this._findGlobalStateAffectedSources(n);for(const c in this.sourceCaches)a.has(c)&&(this._reloadSource(c),this._changed=!0)}_findGlobalStateAffectedSources(e){if(e.length===0)return new Set;const n=new Set;for(const a in this._layers){const c=this._layers[a],p=c.getLayoutAffectingGlobalStateRefs();for(const _ of e)p.has(_)&&n.add(c.source)}return n}loadURL(e,n={},a){this.fire(new o.l("dataloading",{dataType:"style"})),n.validate=typeof n.validate!="boolean"||n.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const p=this._loadStyleRequest;o.j(c,this._loadStyleRequest).then((_=>{this._loadStyleRequest=null,this._load(_.data,n,a)})).catch((_=>{this._loadStyleRequest=null,_&&!p.signal.aborted&&this.fire(new o.k(_))}))}loadJSON(e,n={},a){this.fire(new o.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,he.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,n.validate=n.validate!==!1,this._load(e,n,a)})).catch((()=>{}))}loadEmpty(){this.fire(new o.l("dataloading",{dataType:"style"})),this._load(Yd,{validate:!1})}_load(e,n,a){var c,p,_;const x=n.transformStyle?n.transformStyle(a,e):e;if(!n.validate||!Qo(this,o.z(x))){this._loaded=!0,this.stylesheet=x;for(const b in x.sources)this.addSource(b,x.sources[b],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new jt(this.stylesheet.light),this._setProjectionInternal(((c=this.stylesheet.projection)===null||c===void 0?void 0:c.type)||"mercator"),this.sky=new pt(this.stylesheet.sky),this.map.setTerrain((p=this.stylesheet.terrain)!==null&&p!==void 0?p:null),this.setGlobalState((_=this.stylesheet.state)!==null&&_!==void 0?_:null),this.fire(new o.l("data",{dataType:"style"})),this.fire(new o.l("style.load"))}}_createLayers(){const e=o.bI(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map((n=>n.id)),this._layers={},this._serializedLayers=null;for(const n of e){const a=o.bJ(n);a.setEventedParent(this,{layer:{id:n.id}}),this._layers[n.id]=a}}_loadSprite(e,n=!1,a=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(p,_,x,b){return o._(this,void 0,void 0,(function*(){const P=Re(p),I=x>1?"@2x":"",k={},A={};for(const{id:R,url:O}of P){const W=_.transformRequest(Oe(O,I,".json"),"SpriteJSON");k[R]=o.j(W,b);const G=_.transformRequest(Oe(O,I,".png"),"SpriteImage");A[R]=ae.getImage(G,b)}return yield Promise.all([...Object.values(k),...Object.values(A)]),(function(R,O){return o._(this,void 0,void 0,(function*(){const W={};for(const G in R){W[G]={};const H=he.getImageCanvasContext((yield O[G]).data),J=(yield R[G]).data;for(const ie in J){const{width:Q,height:se,x:ue,y:ee,sdf:ge,pixelRatio:Te,stretchX:ve,stretchY:xe,content:we,textFitWidth:Fe,textFitHeight:Ve}=J[ie];W[G][ie]={data:null,pixelRatio:Te,sdf:ge,stretchX:ve,stretchY:xe,content:we,textFitWidth:Fe,textFitHeight:Ve,spriteData:{width:Q,height:se,x:ue,y:ee,context:H}}}}return W}))})(k,A)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((p=>{if(this._spriteRequest=null,p)for(const _ in p){this._spritesImagesIds[_]=[];const x=this._spritesImagesIds[_]?this._spritesImagesIds[_].filter((b=>!(b in p))):[];for(const b of x)this.imageManager.removeImage(b),this._changedImages[b]=!0;for(const b in p[_]){const P=_==="default"?b:`${_}:${b}`;this._spritesImagesIds[_].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,p[_][b],!1):this.imageManager.addImage(P,p[_][b]),n&&(this._changedImages[P]=!0)}}})).catch((p=>{this._spriteRequest=null,c=p,this.fire(new o.k(c))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),n&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"})),a&&a(c)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}_validateLayer(e){const n=this.sourceCaches[e.source];if(!n)return;const a=e.sourceLayer;if(!a)return;const c=n.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(a)===-1)&&this.fire(new o.k(new Error(`Source layer "${a}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,n=!1){const a=this._serializedAllLayers();if(!e||e.length===0)return Object.values(n?o.bK(a):a);const c=[];for(const p of e)if(a[p]){const _=n?o.bK(a[p]):a[p];c.push(_)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const n=Object.keys(this._layers);for(const a of n){const c=this._layers[a];c.type!=="custom"&&(e[a]=c.serialize())}return e}hasTransitions(){var e,n,a;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((n=this.sky)===null||n===void 0)&&n.hasTransition()||!((a=this.projection)===null||a===void 0)&&a.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const n=this._changed;if(n){const c=Object.keys(this._updatedLayers),p=Object.keys(this._removedLayers);(c.length||p.length)&&this._updateWorkerLayers(c,p);for(const _ in this._updatedSources){const x=this._updatedSources[_];if(x==="reload")this._reloadSource(_);else{if(x!=="clear")throw new Error(`Invalid action ${x}`);this._clearSource(_)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const _ in this._updatedPaintProps)this._layers[_].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const a={};for(const c in this.sourceCaches){const p=this.sourceCaches[c];a[c]=p.used,p.used=!1}for(const c of this._order){const p=this._layers[c];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(const c in a){const p=this.sourceCaches[c];!!a[c]!=!!p.used&&p.fire(new o.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,n&&this.fire(new o.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const n in this.sourceCaches)this.sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,n){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:n})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,n={}){var a;this._checkLoaded();const c=this.serialize();if(e=n.transformStyle?n.transformStyle(c,e):e,((a=n.validate)===null||a===void 0||a)&&Qo(this,o.z(e)))return!1;(e=o.bK(e)).layers=o.bI(e.layers);const p=o.bL(c,e),_=this._getOperationsToPerform(p);if(_.unimplemented.length>0)throw new Error(`Unimplemented: ${_.unimplemented.join(", ")}.`);if(_.operations.length===0)return!1;for(const x of _.operations)x();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const n=[],a=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":n.push((()=>this.addLayer.apply(this,c.args)));break;case"removeLayer":n.push((()=>this.removeLayer.apply(this,c.args)));break;case"setPaintProperty":n.push((()=>this.setPaintProperty.apply(this,c.args)));break;case"setLayoutProperty":n.push((()=>this.setLayoutProperty.apply(this,c.args)));break;case"setFilter":n.push((()=>this.setFilter.apply(this,c.args)));break;case"addSource":n.push((()=>this.addSource.apply(this,c.args)));break;case"removeSource":n.push((()=>this.removeSource.apply(this,c.args)));break;case"setLayerZoomRange":n.push((()=>this.setLayerZoomRange.apply(this,c.args)));break;case"setLight":n.push((()=>this.setLight.apply(this,c.args)));break;case"setGeoJSONSourceData":n.push((()=>this.setGeoJSONSourceData.apply(this,c.args)));break;case"setGlyphs":n.push((()=>this.setGlyphs.apply(this,c.args)));break;case"setSprite":n.push((()=>this.setSprite.apply(this,c.args)));break;case"setTerrain":n.push((()=>this.map.setTerrain.apply(this,c.args)));break;case"setSky":n.push((()=>this.setSky.apply(this,c.args)));break;case"setProjection":this.setProjection.apply(this,c.args);break;case"setGlobalState":n.push((()=>this.setGlobalState.apply(this,c.args)));break;case"setTransition":n.push((()=>{}));break;default:a.push(c.command)}return{operations:n,unimplemented:a}}addImage(e,n){if(this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,n),this._afterImageUpdated(e)}updateImage(e,n){this.imageManager.updateImage(e,n)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new o.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,n,a={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(o.z.source,`sources.${e}`,n,null,a))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const c=this.sourceCaches[e]=new bt(e,n,this.dispatcher);c.style=this,c.setEventedParent(this,(()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e}))),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const a in this._layers)if(this._layers[a].source===e)return this.fire(new o.k(new Error(`Source "${e}" cannot be removed while layer "${a}" is using it.`)));const n=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],n.fire(new o.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),n.setEventedParent(null),n.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,n){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const a=this.sourceCaches[e].getSource();if(a.type!=="geojson")throw new Error(`geojsonSource.type is ${a.type}, which is !== 'geojson`);a.setData(n),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,n,a={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new o.k(new Error(`Layer "${c}" already exists on this map.`)));let p;if(e.type==="custom"){if(Qo(this,o.bM(e)))return;p=o.bJ(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=o.bK(e),e=o.e(e,{source:c})),this._validate(o.z.layer,`layers.${c}`,e,{arrayIndex:-1},a))return;p=o.bJ(e),this._validateLayer(p),p.setEventedParent(this,{layer:{id:c}})}const _=n?this._order.indexOf(n):this._order.length;if(n&&_===-1)this.fire(new o.k(new Error(`Cannot add layer "${c}" before non-existing layer "${n}".`)));else{if(this._order.splice(_,0,c),this._layerOrderChanged=!0,this._layers[c]=p,this._removedLayers[c]&&p.source&&p.type!=="custom"){const x=this._removedLayers[c];delete this._removedLayers[c],x.type!==p.type?this._updatedSources[p.source]="clear":(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause())}this._updateLayer(p),p.onAdd&&p.onAdd(this.map)}}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new o.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const a=this._order.indexOf(e);this._order.splice(a,1);const c=n?this._order.indexOf(n):this._order.length;n&&c===-1?this.fire(new o.k(new Error(`Cannot move layer "${e}" before non-existing layer "${n}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new o.k(new Error(`Cannot remove non-existing layer "${e}".`)));n.setEventedParent(null);const a=this._order.indexOf(e);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,n,a){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===n&&c.maxzoom===a||(n!=null&&(c.minzoom=n),a!=null&&(c.maxzoom=a),this._updateLayer(c)):this.fire(new o.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,n,a={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!o.bH(c.filter,n))return n==null?(c.setFilter(void 0),void this._updateLayer(c)):void(this._validate(o.z.filter,`layers.${c.id}.filter`,n,null,a)||(c.setFilter(o.bK(n)),this._updateLayer(c)))}else this.fire(new o.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return o.bK(this.getLayer(e).filter)}setLayoutProperty(e,n,a,c={}){this._checkLoaded();const p=this.getLayer(e);p?o.bH(p.getLayoutProperty(n),a)||(p.setLayoutProperty(n,a,c),this._updateLayer(p)):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,n){const a=this.getLayer(e);if(a)return a.getLayoutProperty(n);this.fire(new o.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,n,a,c={}){this._checkLoaded();const p=this.getLayer(e);p?o.bH(p.getPaintProperty(n),a)||(p.setPaintProperty(n,a,c)&&this._updateLayer(p),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new o.k(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,n){return this.getLayer(e).getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();const a=e.source,c=e.sourceLayer,p=this.sourceCaches[a];if(p===void 0)return void this.fire(new o.k(new Error(`The source '${a}' does not exist in the map's style.`)));const _=p.getSource().type;_==="geojson"&&c?this.fire(new o.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):_!=="vector"||c?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),p.setFeatureState(c,e.id,n)):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,n){this._checkLoaded();const a=e.source,c=this.sourceCaches[a];if(c===void 0)return void this.fire(new o.k(new Error(`The source '${a}' does not exist in the map's style.`)));const p=c.getSource().type,_=p==="vector"?e.sourceLayer:void 0;p!=="vector"||_?n&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new o.k(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(_,e.id,n):this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const n=e.source,a=e.sourceLayer,c=this.sourceCaches[n];if(c!==void 0)return c.getSource().type!=="vector"||a?(e.id===void 0&&this.fire(new o.k(new Error("The feature id parameter must be provided."))),c.getFeatureState(a,e.id)):void this.fire(new o.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.k(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=o.bN(this.sourceCaches,(p=>p.serialize())),n=this._serializeByIds(this._order,!0),a=this.map.getTerrain()||void 0,c=this.stylesheet;return o.bO({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,projection:c.projection,sources:e,layers:n,terrain:a},(p=>p!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const n=_=>this._layers[_].type==="fill-extrusion",a={},c=[];for(let _=this._order.length-1;_>=0;_--){const x=this._order[_];if(n(x)){a[x]=_;for(const b of e){const P=b[x];if(P)for(const I of P)c.push(I)}}}c.sort(((_,x)=>x.intersectionZ-_.intersectionZ));const p=[];for(let _=this._order.length-1;_>=0;_--){const x=this._order[_];if(n(x))for(let b=c.length-1;b>=0;b--){const P=c[b].feature;if(a[P.layer.id]<_)break;p.push(P),c.pop()}else for(const b of e){const P=b[x];if(P)for(const I of P)p.push(I.feature)}}return p}queryRenderedFeatures(e,n,a){n&&n.filter&&this._validate(o.z.filter,"queryRenderedFeatures.filter",n.filter,null,n);const c={};if(n&&n.layers){if(!(Array.isArray(n.layers)||n.layers instanceof Set))return this.fire(new o.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const P of n.layers){const I=this._layers[P];if(!I)return this.fire(new o.k(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];c[I.source]=!0}}const p=[];n.availableImages=this._availableImages;const _=this._serializedAllLayers(),x=n.layers instanceof Set?n.layers:Array.isArray(n.layers)?new Set(n.layers):null,b=Object.assign(Object.assign({},n),{layers:x});for(const P in this.sourceCaches)n.layers&&!c[P]||p.push(kt(this.sourceCaches[P],this._layers,_,e,b,a,this.map.terrain?(I,k,A)=>this.map.terrain.getElevation(I,k,A):void 0));return this.placement&&p.push((function(P,I,k,A,R,O,W){const G={},H=O.queryRenderedSymbols(A),J=[];for(const ie of Object.keys(H).map(Number))J.push(W[ie]);J.sort(Ft);for(const ie of J){const Q=ie.featureIndex.lookupSymbolFeatures(H[ie.bucketInstanceId],I,ie.bucketIndex,ie.sourceLayerIndex,R.filter,R.layers,R.availableImages,P);for(const se in Q){const ue=G[se]=G[se]||[],ee=Q[se];ee.sort(((ge,Te)=>{const ve=ie.featureSortOrder;if(ve){const xe=ve.indexOf(ge.featureIndex);return ve.indexOf(Te.featureIndex)-xe}return Te.featureIndex-ge.featureIndex}));for(const ge of ee)ue.push(ge)}}return(function(ie,Q,se){for(const ue in ie)for(const ee of ie[ue])Ot(ee,se[Q[ue].source]);return ie})(G,P,k)})(this._layers,_,this.sourceCaches,e,b,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(p)}querySourceFeatures(e,n){n&&n.filter&&this._validate(o.z.filter,"querySourceFeatures.filter",n.filter,null,n);const a=this.sourceCaches[e];return a?(function(c,p){const _=c.getRenderableIds().map((P=>c.getTileByID(P))),x=[],b={};for(let P=0;P<_.length;P++){const I=_[P],k=I.tileID.canonical.key;b[k]||(b[k]=!0,I.querySourceFeatures(x,p))}return x})(a,n):[]}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const a=this.light.getLight();let c=!1;for(const _ in e)if(!o.bH(e[_],a[_])){c=!0;break}if(!c)return;const p={now:he.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(p)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,n={}){this._checkLoaded();const a=this.getSky();let c=!1;if(!e&&!a)return;if(e&&!a)c=!0;else if(!e&&a)c=!0;else for(const _ in e)if(!o.bH(e[_],a[_])){c=!0;break}if(!c)return;const p={now:he.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,n),this.sky.updateTransitions(p)}_setProjectionInternal(e){const n=(function(a){if(Array.isArray(a)){const c=new Yo({type:a});return{projection:c,transform:new io,cameraHelper:new lh(c)}}switch(a){case"mercator":return{projection:new Et,transform:new ur,cameraHelper:new bi};case"globe":{const c=new Yo({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:c,transform:new io,cameraHelper:new lh(c)}}case"vertical-perspective":return{projection:new Ya,transform:new ro,cameraHelper:new wi};default:return o.w(`Unknown projection name: ${a}. Falling back to mercator projection.`),{projection:new Et,transform:new ur,cameraHelper:new bi}}})(e);this.projection=n.projection,this.map.migrateProjection(n.transform,n.cameraHelper);for(const a in this.sourceCaches)this.sourceCaches[a].reload()}_validate(e,n,a,c,p={}){return(!p||p.validate!==!1)&&Qo(this,e.call(o.z,o.e({key:n,style:this.serialize(),value:a,styleSpec:o.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ui().off(Fr,this._rtlPluginLoaded);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this.sourceCaches){const a=this.sourceCaches[n];a.setEventedParent(null),a.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const n in this.sourceCaches)this.sourceCaches[n].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,n,a,c,p=!1){let _=!1,x=!1;const b={};for(const P of this._order){const I=this._layers[P];if(I.type!=="symbol")continue;if(!b[I.source]){const A=this.sourceCaches[I.source];b[I.source]=A.getRenderableIds(!0).map((R=>A.getTileByID(R))).sort(((R,O)=>O.tileID.overscaledZ-R.tileID.overscaledZ||(R.tileID.isLessThan(O.tileID)?-1:1)))}const k=this.crossTileSymbolIndex.addLayer(I,b[I.source],e.center.lng);_=_||k}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((p=p||this._layerOrderChanged||a===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(he.now(),e.zoom))&&(this.pauseablePlacement=new vc(e,this.map.terrain,this._order,p,n,a,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(he.now()),x=!0),_&&this.pauseablePlacement.placement.setStale()),x||_)for(const P of this._order){const I=this._layers[P];I.type==="symbol"&&this.placement.updateLayerOpacities(I,b[I.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(he.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,n){return o._(this,void 0,void 0,(function*(){const a=yield this.imageManager.getImages(n.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[n.source];return c&&c.setDependencies(n.tileID.key,n.type,n.icons),a}))}getGlyphs(e,n){return o._(this,void 0,void 0,(function*(){const a=yield this.glyphManager.getGlyphs(n.stacks),c=this.sourceCaches[n.source];return c&&c.setDependencies(n.tileID.key,n.type,[""]),a}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,n={}){this._checkLoaded(),e&&this._validate(o.z.glyphs,"glyphs",e,null,n)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,n,a={},c){this._checkLoaded();const p=[{id:e,url:n}],_=[...Re(this.stylesheet.sprite),...p];this._validate(o.z.sprite,"sprite",_,null,a)||(this.stylesheet.sprite=_,this._loadSprite(p,!0,c))}removeSprite(e){this._checkLoaded();const n=Re(this.stylesheet.sprite);if(n.find((a=>a.id===e))){if(this._spritesImagesIds[e])for(const a of this._spritesImagesIds[e])this.imageManager.removeImage(a),this._changedImages[a]=!0;n.splice(n.findIndex((a=>a.id===e)),1),this.stylesheet.sprite=n.length>0?n:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new o.l("data",{dataType:"style"}))}else this.fire(new o.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Re(this.stylesheet.sprite)}setSprite(e,n={},a){this._checkLoaded(),e&&this._validate(o.z.sprite,"sprite",e,null,n)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,a):(this._unloadSprite(),a&&a(null)))}}var Jd=o.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Qd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,n,a,c,p,_,x,b,P){this.context=e;let I=this.boundPaintVertexBuffers.length!==c.length;for(let k=0;!I&&k<c.length;k++)this.boundPaintVertexBuffers[k]!==c[k]&&(I=!0);!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==a||I||this.boundIndexBuffer!==p||this.boundVertexOffset!==_||this.boundDynamicVertexBuffer!==x||this.boundDynamicVertexBuffer2!==b||this.boundDynamicVertexBuffer3!==P?this.freshBind(n,a,c,p,_,x,b,P):(e.bindVertexArray.set(this.vao),x&&x.bind(),p&&p.dynamicDraw&&p.bind(),b&&b.bind(),P&&P.bind())}freshBind(e,n,a,c,p,_,x,b){const P=e.numAttributes,I=this.context,k=I.gl;this.vao&&this.destroy(),this.vao=I.createVertexArray(),I.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=c,this.boundVertexOffset=p,this.boundDynamicVertexBuffer=_,this.boundDynamicVertexBuffer2=x,this.boundDynamicVertexBuffer3=b,n.enableAttributes(k,e);for(const A of a)A.enableAttributes(k,e);_&&_.enableAttributes(k,e),x&&x.enableAttributes(k,e),b&&b.enableAttributes(k,e),n.bind(),n.setVertexAttribPointers(k,e,p);for(const A of a)A.bind(),A.setVertexAttribPointers(k,e,p);_&&(_.bind(),_.setVertexAttribPointers(k,e,p)),c&&c.bind(),x&&(x.bind(),x.setVertexAttribPointers(k,e,p)),b&&(b.bind(),b.setVertexAttribPointers(k,e,p)),I.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const el=(h,e,n,a,c)=>({u_texture:0,u_ele_delta:h,u_fog_matrix:e,u_fog_color:n?n.properties.get("fog-color"):o.bf.white,u_fog_ground_blend:n?n.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?0:n?n.calculateFogBlendOpacity(a):0,u_horizon_color:n?n.properties.get("horizon-color"):o.bf.white,u_horizon_fog_blend:n?n.properties.get("horizon-fog-blend"):1,u_is_globe_mode:c?1:0}),Pc={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Fs(h){const e=[];for(let n=0;n<h.length;n++){if(h[n]===null)continue;const a=h[n].split(" ");e.push(a.pop())}return e}class Mc{constructor(e,n,a,c,p,_,x,b,P=[]){const I=e.gl;this.program=I.createProgram();const k=Fs(n.staticAttributes),A=a?a.getBinderAttributes():[],R=k.concat(A),O=on.prelude.staticUniforms?Fs(on.prelude.staticUniforms):[],W=x.staticUniforms?Fs(x.staticUniforms):[],G=n.staticUniforms?Fs(n.staticUniforms):[],H=a?a.getBinderUniforms():[],J=O.concat(W).concat(G).concat(H),ie=[];for(const ve of J)ie.indexOf(ve)<0&&ie.push(ve);const Q=a?a.defines():[];En(I)&&Q.unshift("#version 300 es"),p&&Q.push("#define OVERDRAW_INSPECTOR;"),_&&Q.push("#define TERRAIN3D;"),b&&Q.push(b),P&&Q.push(...P);let se=Q.concat(on.prelude.fragmentSource,x.fragmentSource,n.fragmentSource).join(`
`),ue=Q.concat(on.prelude.vertexSource,x.vertexSource,n.vertexSource).join(`
`);En(I)||(se=(function(ve){return ve.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(se),ue=(function(ve){return ve.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(ue));const ee=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(ee,se),I.compileShader(ee),!I.getShaderParameter(ee,I.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${I.getShaderInfoLog(ee)}`);I.attachShader(this.program,ee);const ge=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(ge,ue),I.compileShader(ge),!I.getShaderParameter(ge,I.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${I.getShaderInfoLog(ge)}`);I.attachShader(this.program,ge),this.attributes={};const Te={};this.numAttributes=R.length;for(let ve=0;ve<this.numAttributes;ve++)R[ve]&&(I.bindAttribLocation(this.program,ve,R[ve]),this.attributes[R[ve]]=ve);if(I.linkProgram(this.program),!I.getProgramParameter(this.program,I.LINK_STATUS))throw new Error(`Program failed to link: ${I.getProgramInfoLog(this.program)}`);I.deleteShader(ge),I.deleteShader(ee);for(let ve=0;ve<ie.length;ve++){const xe=ie[ve];if(xe&&!Te[xe]){const we=I.getUniformLocation(this.program,xe);we&&(Te[xe]=we)}}this.fixedUniforms=c(e,Te),this.terrainUniforms=((ve,xe)=>({u_depth:new o.bP(ve,xe.u_depth),u_terrain:new o.bP(ve,xe.u_terrain),u_terrain_dim:new o.bg(ve,xe.u_terrain_dim),u_terrain_matrix:new o.bR(ve,xe.u_terrain_matrix),u_terrain_unpack:new o.bS(ve,xe.u_terrain_unpack),u_terrain_exaggeration:new o.bg(ve,xe.u_terrain_exaggeration)}))(e,Te),this.projectionUniforms=((ve,xe)=>({u_projection_matrix:new o.bR(ve,xe.u_projection_matrix),u_projection_tile_mercator_coords:new o.bS(ve,xe.u_projection_tile_mercator_coords),u_projection_clipping_plane:new o.bS(ve,xe.u_projection_clipping_plane),u_projection_transition:new o.bg(ve,xe.u_projection_transition),u_projection_fallback_matrix:new o.bR(ve,xe.u_projection_fallback_matrix)}))(e,Te),this.binderUniforms=a?a.getUniforms(e,Te):[]}draw(e,n,a,c,p,_,x,b,P,I,k,A,R,O,W,G,H,J,ie){const Q=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(a),e.setStencilMode(c),e.setColorMode(p),e.setCullFace(_),b){e.activeTexture.set(Q.TEXTURE2),Q.bindTexture(Q.TEXTURE_2D,b.depthTexture),e.activeTexture.set(Q.TEXTURE3),Q.bindTexture(Q.TEXTURE_2D,b.texture);for(const ue in this.terrainUniforms)this.terrainUniforms[ue].set(b[ue])}if(P)for(const ue in P)this.projectionUniforms[Pc[ue]].set(P[ue]);if(x)for(const ue in this.fixedUniforms)this.fixedUniforms[ue].set(x[ue]);G&&G.setUniforms(e,this.binderUniforms,O,{zoom:W});let se=0;switch(n){case Q.LINES:se=2;break;case Q.TRIANGLES:se=3;break;case Q.LINE_STRIP:se=1}for(const ue of R.get()){const ee=ue.vaos||(ue.vaos={});(ee[I]||(ee[I]=new Qd)).bind(e,this,k,G?G.getPaintVertexBuffers():[],A,ue.vertexOffset,H,J,ie),Q.drawElements(n,ue.primitiveLength*se,Q.UNSIGNED_SHORT,ue.primitiveOffset*se*2)}}}function tl(h,e,n){const a=1/o.aC(n,1,e.transform.tileZoom),c=Math.pow(2,n.tileID.overscaledZ),p=n.tileSize*Math.pow(2,e.transform.tileZoom)/c,_=p*(n.tileID.canonical.x+n.tileID.wrap*c),x=p*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[a,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[_>>16,x>>16],u_pixel_coord_lower:[65535&_,65535&x]}}const cn=(h,e,n,a)=>{const c=h.style.light,p=c.properties.get("position"),_=[p.x,p.y,p.z],x=o.bV();c.properties.get("anchor")==="viewport"&&o.bW(x,h.transform.bearingInRadians),o.bX(_,_,x);const b=h.transform.transformLightDirection(_),P=c.properties.get("color");return{u_lightpos:_,u_lightpos_globe:b,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[P.r,P.g,P.b],u_vertical_gradient:+e,u_opacity:n,u_fill_translate:a}},ep=(h,e,n,a,c,p,_)=>o.e(cn(h,e,n,a),tl(p,h,_),{u_height_factor:-Math.pow(2,c.overscaledZ)/_.tileSize/8}),rl=(h,e,n,a)=>o.e(tl(e,h,n),{u_fill_translate:a}),no=(h,e)=>({u_world:h,u_fill_translate:e}),so=(h,e,n,a,c)=>o.e(rl(h,e,n,c),{u_world:a}),tp=(h,e,n,a,c)=>{const p=h.transform;let _,x,b=0;if(n.paint.get("circle-pitch-alignment")==="map"){const P=o.aC(e,1,p.zoom);_=!0,x=[P,P],b=P/(o.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*c}else _=!1,x=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(n.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+_,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:x,u_globe_extrude_scale:b,u_translate:a}},il=h=>({u_pixel_extrude_scale:[1/h.width,1/h.height]}),rp=h=>({u_viewport_size:[h.width,h.height]}),Os=(h,e=1)=>({u_color:h,u_overlay:0,u_overlay_scale:e}),ch=(h,e,n,a)=>{const c=o.aC(h,1,e)/(o.$*Math.pow(2,h.tileID.overscaledZ))*2*Math.PI*a;return{u_extrude_scale:o.aC(h,1,e),u_intensity:n,u_globe_extrude_scale:c}},Cc=(h,e,n,a)=>{const c=o.L();o.bY(c,0,h.width,h.height,0,0,1);const p=h.context.gl;return{u_matrix:c,u_world:[p.drawingBufferWidth,p.drawingBufferHeight],u_image:n,u_color_ramp:a,u_opacity:e.paint.get("heatmap-opacity")}},ip=(h,e,n)=>{const a=n.paint.get("hillshade-accent-color");let c;switch(n.paint.get("hillshade-method")){case"basic":c=4;break;case"combined":c=1;break;case"igor":c=2;break;case"multidirectional":c=3;break;default:c=0}const p=n.getIlluminationProperties();for(let _=0;_<p.directionRadians.length;_++)n.paint.get("hillshade-illumination-anchor")==="viewport"&&(p.directionRadians[_]+=h.transform.bearingInRadians);return{u_image:0,u_latrange:Ic(0,e.tileID),u_exaggeration:n.paint.get("hillshade-exaggeration"),u_altitudes:p.altitudeRadians,u_azimuths:p.directionRadians,u_accent:a,u_method:c,u_highlights:p.highlightColor,u_shadows:p.shadowColor}},uh=(h,e)=>{const n=e.stride,a=o.L();return o.bY(a,0,o.$,-o.$,0,0,1),o.M(a,a,[0,-o.$,0]),{u_matrix:a,u_image:1,u_dimension:[n,n],u_zoom:h.overscaledZ,u_unpack:e.getUnpackVector()}};function Ic(h,e){const n=Math.pow(2,e.canonical.z),a=e.canonical.y;return[new o.a1(0,a/n).toLngLat().lat,new o.a1(0,(a+1)/n).toLngLat().lat]}const hh=(h,e,n=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:n,u_opacity:h.paint.get("color-relief-opacity")}),nl=(h,e,n,a)=>{const c=h.transform;return{u_translation:Ac(h,e,n),u_ratio:a/o.aC(e,1,c.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},dh=(h,e,n,a,c)=>o.e(nl(h,e,n,a),{u_image:0,u_image_height:c}),ph=(h,e,n,a,c)=>{const p=h.transform,_=Ec(e,p);return{u_translation:Ac(h,e,n),u_texsize:e.imageAtlasTexture.size,u_ratio:a/o.aC(e,1,p.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[_,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},js=(h,e,n,a,c,p)=>{const _=h.lineAtlas,x=Ec(e,h.transform),b=n.layout.get("line-cap")==="round",P=_.getDash(c.from,b),I=_.getDash(c.to,b),k=P.width*p.fromScale,A=I.width*p.toScale;return o.e(nl(h,e,n,a),{u_patternscale_a:[x/k,-P.height/2],u_patternscale_b:[x/A,-I.height/2],u_sdfgamma:_.width/(256*Math.min(k,A)*h.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:I.y,u_mix:p.t})};function Ec(h,e){return 1/o.aC(h,1,e.tileZoom)}function Ac(h,e,n){return o.aD(h.transform,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}const ao=(h,e,n,a,c)=>{return{u_tl_parent:h,u_scale_parent:e,u_buffer_scale:1,u_fade_t:n.mix,u_opacity:n.opacity*a.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:a.paint.get("raster-brightness-min"),u_brightness_high:a.paint.get("raster-brightness-max"),u_saturation_factor:(_=a.paint.get("raster-saturation"),_>0?1-1/(1.001-_):-_),u_contrast_factor:(p=a.paint.get("raster-contrast"),p>0?1/(1-p):1+p),u_spin_weights:np(a.paint.get("raster-hue-rotate")),u_coords_top:[c[0].x,c[0].y,c[1].x,c[1].y],u_coords_bottom:[c[3].x,c[3].y,c[2].x,c[2].y]};var p,_};function np(h){h*=Math.PI/180;const e=Math.sin(h),n=Math.cos(h);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const oo=(h,e,n,a,c,p,_,x,b,P,I,k,A)=>{const R=_.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:R.cameraToCenterDistance,u_pitch:R.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:R.width/R.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_label_plane_matrix:x,u_coord_matrix:b,u_is_text:+I,u_pitch_with_map:+a,u_is_along_line:c,u_is_variable_anchor:p,u_texsize:k,u_texture:0,u_translation:P,u_pitched_scale:A}},fh=(h,e,n,a,c,p,_,x,b,P,I,k,A,R)=>{const O=_.transform;return o.e(oo(h,e,n,a,c,p,_,x,b,P,I,k,R),{u_gamma_scale:a?Math.cos(O.pitch*Math.PI/180)*O.cameraToCenterDistance:1,u_device_pixel_ratio:_.pixelRatio,u_is_halo:1})},sp=(h,e,n,a,c,p,_,x,b,P,I,k,A)=>o.e(fh(h,e,n,a,c,p,_,x,b,P,!0,I,0,A),{u_texsize_icon:k,u_texture_icon:1}),mh=(h,e)=>({u_opacity:h,u_color:e}),gh=(h,e,n,a,c)=>o.e((function(p,_,x,b){const P=x.imageManager.getPattern(p.from.toString()),I=x.imageManager.getPattern(p.to.toString()),{width:k,height:A}=x.imageManager.getPixelSize(),R=Math.pow(2,b.tileID.overscaledZ),O=b.tileSize*Math.pow(2,x.transform.tileZoom)/R,W=O*(b.tileID.canonical.x+b.tileID.wrap*R),G=O*b.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:P.tl,u_pattern_br_a:P.br,u_pattern_tl_b:I.tl,u_pattern_br_b:I.br,u_texsize:[k,A],u_mix:_.t,u_pattern_size_a:P.displaySize,u_pattern_size_b:I.displaySize,u_scale_a:_.fromScale,u_scale_b:_.toScale,u_tile_units_to_pixels:1/o.aC(b,1,x.transform.tileZoom),u_pixel_coord_upper:[W>>16,G>>16],u_pixel_coord_lower:[65535&W,65535&G]}})(n,c,e,a),{u_opacity:h}),kc=(h,e)=>{},zc={fillExtrusion:(h,e)=>({u_lightpos:new o.bT(h,e.u_lightpos),u_lightpos_globe:new o.bT(h,e.u_lightpos_globe),u_lightintensity:new o.bg(h,e.u_lightintensity),u_lightcolor:new o.bT(h,e.u_lightcolor),u_vertical_gradient:new o.bg(h,e.u_vertical_gradient),u_opacity:new o.bg(h,e.u_opacity),u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillExtrusionPattern:(h,e)=>({u_lightpos:new o.bT(h,e.u_lightpos),u_lightpos_globe:new o.bT(h,e.u_lightpos_globe),u_lightintensity:new o.bg(h,e.u_lightintensity),u_lightcolor:new o.bT(h,e.u_lightcolor),u_vertical_gradient:new o.bg(h,e.u_vertical_gradient),u_height_factor:new o.bg(h,e.u_height_factor),u_opacity:new o.bg(h,e.u_opacity),u_fill_translate:new o.bU(h,e.u_fill_translate),u_image:new o.bP(h,e.u_image),u_texsize:new o.bU(h,e.u_texsize),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade)}),fill:(h,e)=>({u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillPattern:(h,e)=>({u_image:new o.bP(h,e.u_image),u_texsize:new o.bU(h,e.u_texsize),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade),u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillOutline:(h,e)=>({u_world:new o.bU(h,e.u_world),u_fill_translate:new o.bU(h,e.u_fill_translate)}),fillOutlinePattern:(h,e)=>({u_world:new o.bU(h,e.u_world),u_image:new o.bP(h,e.u_image),u_texsize:new o.bU(h,e.u_texsize),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade),u_fill_translate:new o.bU(h,e.u_fill_translate)}),circle:(h,e)=>({u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_scale_with_map:new o.bP(h,e.u_scale_with_map),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_extrude_scale:new o.bU(h,e.u_extrude_scale),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_globe_extrude_scale:new o.bg(h,e.u_globe_extrude_scale),u_translate:new o.bU(h,e.u_translate)}),collisionBox:(h,e)=>({u_pixel_extrude_scale:new o.bU(h,e.u_pixel_extrude_scale)}),collisionCircle:(h,e)=>({u_viewport_size:new o.bU(h,e.u_viewport_size)}),debug:(h,e)=>({u_color:new o.bQ(h,e.u_color),u_overlay:new o.bP(h,e.u_overlay),u_overlay_scale:new o.bg(h,e.u_overlay_scale)}),depth:kc,clippingMask:kc,heatmap:(h,e)=>({u_extrude_scale:new o.bg(h,e.u_extrude_scale),u_intensity:new o.bg(h,e.u_intensity),u_globe_extrude_scale:new o.bg(h,e.u_globe_extrude_scale)}),heatmapTexture:(h,e)=>({u_matrix:new o.bR(h,e.u_matrix),u_world:new o.bU(h,e.u_world),u_image:new o.bP(h,e.u_image),u_color_ramp:new o.bP(h,e.u_color_ramp),u_opacity:new o.bg(h,e.u_opacity)}),hillshade:(h,e)=>({u_image:new o.bP(h,e.u_image),u_latrange:new o.bU(h,e.u_latrange),u_exaggeration:new o.bg(h,e.u_exaggeration),u_altitudes:new o.b_(h,e.u_altitudes),u_azimuths:new o.b_(h,e.u_azimuths),u_accent:new o.bQ(h,e.u_accent),u_method:new o.bP(h,e.u_method),u_shadows:new o.bZ(h,e.u_shadows),u_highlights:new o.bZ(h,e.u_highlights)}),hillshadePrepare:(h,e)=>({u_matrix:new o.bR(h,e.u_matrix),u_image:new o.bP(h,e.u_image),u_dimension:new o.bU(h,e.u_dimension),u_zoom:new o.bg(h,e.u_zoom),u_unpack:new o.bS(h,e.u_unpack)}),colorRelief:(h,e)=>({u_image:new o.bP(h,e.u_image),u_unpack:new o.bS(h,e.u_unpack),u_dimension:new o.bU(h,e.u_dimension),u_elevation_stops:new o.bP(h,e.u_elevation_stops),u_color_stops:new o.bP(h,e.u_color_stops),u_color_ramp_size:new o.bP(h,e.u_color_ramp_size),u_opacity:new o.bg(h,e.u_opacity)}),line:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels)}),lineGradient:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels),u_image:new o.bP(h,e.u_image),u_image_height:new o.bg(h,e.u_image_height)}),linePattern:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_texsize:new o.bU(h,e.u_texsize),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_image:new o.bP(h,e.u_image),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels),u_scale:new o.bT(h,e.u_scale),u_fade:new o.bg(h,e.u_fade)}),lineSDF:(h,e)=>({u_translation:new o.bU(h,e.u_translation),u_ratio:new o.bg(h,e.u_ratio),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_units_to_pixels:new o.bU(h,e.u_units_to_pixels),u_patternscale_a:new o.bU(h,e.u_patternscale_a),u_patternscale_b:new o.bU(h,e.u_patternscale_b),u_sdfgamma:new o.bg(h,e.u_sdfgamma),u_image:new o.bP(h,e.u_image),u_tex_y_a:new o.bg(h,e.u_tex_y_a),u_tex_y_b:new o.bg(h,e.u_tex_y_b),u_mix:new o.bg(h,e.u_mix)}),raster:(h,e)=>({u_tl_parent:new o.bU(h,e.u_tl_parent),u_scale_parent:new o.bg(h,e.u_scale_parent),u_buffer_scale:new o.bg(h,e.u_buffer_scale),u_fade_t:new o.bg(h,e.u_fade_t),u_opacity:new o.bg(h,e.u_opacity),u_image0:new o.bP(h,e.u_image0),u_image1:new o.bP(h,e.u_image1),u_brightness_low:new o.bg(h,e.u_brightness_low),u_brightness_high:new o.bg(h,e.u_brightness_high),u_saturation_factor:new o.bg(h,e.u_saturation_factor),u_contrast_factor:new o.bg(h,e.u_contrast_factor),u_spin_weights:new o.bT(h,e.u_spin_weights),u_coords_top:new o.bS(h,e.u_coords_top),u_coords_bottom:new o.bS(h,e.u_coords_bottom)}),symbolIcon:(h,e)=>({u_is_size_zoom_constant:new o.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(h,e.u_is_size_feature_constant),u_size_t:new o.bg(h,e.u_size_t),u_size:new o.bg(h,e.u_size),u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_pitch:new o.bg(h,e.u_pitch),u_rotate_symbol:new o.bP(h,e.u_rotate_symbol),u_aspect_ratio:new o.bg(h,e.u_aspect_ratio),u_fade_change:new o.bg(h,e.u_fade_change),u_label_plane_matrix:new o.bR(h,e.u_label_plane_matrix),u_coord_matrix:new o.bR(h,e.u_coord_matrix),u_is_text:new o.bP(h,e.u_is_text),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_is_along_line:new o.bP(h,e.u_is_along_line),u_is_variable_anchor:new o.bP(h,e.u_is_variable_anchor),u_texsize:new o.bU(h,e.u_texsize),u_texture:new o.bP(h,e.u_texture),u_translation:new o.bU(h,e.u_translation),u_pitched_scale:new o.bg(h,e.u_pitched_scale)}),symbolSDF:(h,e)=>({u_is_size_zoom_constant:new o.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(h,e.u_is_size_feature_constant),u_size_t:new o.bg(h,e.u_size_t),u_size:new o.bg(h,e.u_size),u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_pitch:new o.bg(h,e.u_pitch),u_rotate_symbol:new o.bP(h,e.u_rotate_symbol),u_aspect_ratio:new o.bg(h,e.u_aspect_ratio),u_fade_change:new o.bg(h,e.u_fade_change),u_label_plane_matrix:new o.bR(h,e.u_label_plane_matrix),u_coord_matrix:new o.bR(h,e.u_coord_matrix),u_is_text:new o.bP(h,e.u_is_text),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_is_along_line:new o.bP(h,e.u_is_along_line),u_is_variable_anchor:new o.bP(h,e.u_is_variable_anchor),u_texsize:new o.bU(h,e.u_texsize),u_texture:new o.bP(h,e.u_texture),u_gamma_scale:new o.bg(h,e.u_gamma_scale),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_is_halo:new o.bP(h,e.u_is_halo),u_translation:new o.bU(h,e.u_translation),u_pitched_scale:new o.bg(h,e.u_pitched_scale)}),symbolTextAndIcon:(h,e)=>({u_is_size_zoom_constant:new o.bP(h,e.u_is_size_zoom_constant),u_is_size_feature_constant:new o.bP(h,e.u_is_size_feature_constant),u_size_t:new o.bg(h,e.u_size_t),u_size:new o.bg(h,e.u_size),u_camera_to_center_distance:new o.bg(h,e.u_camera_to_center_distance),u_pitch:new o.bg(h,e.u_pitch),u_rotate_symbol:new o.bP(h,e.u_rotate_symbol),u_aspect_ratio:new o.bg(h,e.u_aspect_ratio),u_fade_change:new o.bg(h,e.u_fade_change),u_label_plane_matrix:new o.bR(h,e.u_label_plane_matrix),u_coord_matrix:new o.bR(h,e.u_coord_matrix),u_is_text:new o.bP(h,e.u_is_text),u_pitch_with_map:new o.bP(h,e.u_pitch_with_map),u_is_along_line:new o.bP(h,e.u_is_along_line),u_is_variable_anchor:new o.bP(h,e.u_is_variable_anchor),u_texsize:new o.bU(h,e.u_texsize),u_texsize_icon:new o.bU(h,e.u_texsize_icon),u_texture:new o.bP(h,e.u_texture),u_texture_icon:new o.bP(h,e.u_texture_icon),u_gamma_scale:new o.bg(h,e.u_gamma_scale),u_device_pixel_ratio:new o.bg(h,e.u_device_pixel_ratio),u_is_halo:new o.bP(h,e.u_is_halo),u_translation:new o.bU(h,e.u_translation),u_pitched_scale:new o.bg(h,e.u_pitched_scale)}),background:(h,e)=>({u_opacity:new o.bg(h,e.u_opacity),u_color:new o.bQ(h,e.u_color)}),backgroundPattern:(h,e)=>({u_opacity:new o.bg(h,e.u_opacity),u_image:new o.bP(h,e.u_image),u_pattern_tl_a:new o.bU(h,e.u_pattern_tl_a),u_pattern_br_a:new o.bU(h,e.u_pattern_br_a),u_pattern_tl_b:new o.bU(h,e.u_pattern_tl_b),u_pattern_br_b:new o.bU(h,e.u_pattern_br_b),u_texsize:new o.bU(h,e.u_texsize),u_mix:new o.bg(h,e.u_mix),u_pattern_size_a:new o.bU(h,e.u_pattern_size_a),u_pattern_size_b:new o.bU(h,e.u_pattern_size_b),u_scale_a:new o.bg(h,e.u_scale_a),u_scale_b:new o.bg(h,e.u_scale_b),u_pixel_coord_upper:new o.bU(h,e.u_pixel_coord_upper),u_pixel_coord_lower:new o.bU(h,e.u_pixel_coord_lower),u_tile_units_to_pixels:new o.bg(h,e.u_tile_units_to_pixels)}),terrain:(h,e)=>({u_texture:new o.bP(h,e.u_texture),u_ele_delta:new o.bg(h,e.u_ele_delta),u_fog_matrix:new o.bR(h,e.u_fog_matrix),u_fog_color:new o.bQ(h,e.u_fog_color),u_fog_ground_blend:new o.bg(h,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new o.bg(h,e.u_fog_ground_blend_opacity),u_horizon_color:new o.bQ(h,e.u_horizon_color),u_horizon_fog_blend:new o.bg(h,e.u_horizon_fog_blend),u_is_globe_mode:new o.bg(h,e.u_is_globe_mode)}),terrainDepth:(h,e)=>({u_ele_delta:new o.bg(h,e.u_ele_delta)}),terrainCoords:(h,e)=>({u_texture:new o.bP(h,e.u_texture),u_terrain_coords_id:new o.bg(h,e.u_terrain_coords_id),u_ele_delta:new o.bg(h,e.u_ele_delta)}),projectionErrorMeasurement:(h,e)=>({u_input:new o.bg(h,e.u_input),u_output_expected:new o.bg(h,e.u_output_expected)}),atmosphere:(h,e)=>({u_sun_pos:new o.bT(h,e.u_sun_pos),u_atmosphere_blend:new o.bg(h,e.u_atmosphere_blend),u_globe_position:new o.bT(h,e.u_globe_position),u_globe_radius:new o.bg(h,e.u_globe_radius),u_inv_proj_matrix:new o.bR(h,e.u_inv_proj_matrix)}),sky:(h,e)=>({u_sky_color:new o.bQ(h,e.u_sky_color),u_horizon_color:new o.bQ(h,e.u_horizon_color),u_horizon:new o.bU(h,e.u_horizon),u_horizon_normal:new o.bU(h,e.u_horizon_normal),u_sky_horizon_blend:new o.bg(h,e.u_sky_horizon_blend),u_sky_blend:new o.bg(h,e.u_sky_blend)})};class _h{constructor(e,n,a){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const n=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const sl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $n{constructor(e,n,a,c){this.length=n.length,this.attributes=a,this.itemSize=n.bytesPerElement,this.dynamicDraw=c,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),e.bindVertexBuffer.set(this.buffer),p.bufferData(p.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let a=0;a<this.attributes.length;a++){const c=n.attributes[this.attributes[a].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,n,a){for(let c=0;c<this.attributes.length;c++){const p=this.attributes[c],_=n.attributes[p.name];_!==void 0&&e.vertexAttribPointer(_,p.components,e[sl[p.type]],!1,this.itemSize,p.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Wt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Dc extends Wt{getDefault(){return o.bf.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Rc extends Wt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class yh extends Wt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Lc extends Wt{getDefault(){return[!0,!0,!0,!0]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ns extends Wt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Bc extends Wt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class ap extends Wt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class op extends Wt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class lp extends Wt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class cp extends Wt{getDefault(){return[0,1]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class vh extends Wt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class up extends Wt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class xh extends Wt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class al extends Wt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ol extends Wt{getDefault(){return o.bf.transparent}set(e){const n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class ll extends Wt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Fc extends Wt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class Vs extends Wt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class lo extends Wt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class ga extends Wt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Yi extends Wt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class bh extends Wt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class wh extends Wt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Oc extends Wt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Us extends Wt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class cl extends Wt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ul extends Wt{getDefault(){return null}set(e){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class co extends Wt{getDefault(){return null}set(e){var n;if(e===this.current&&!this.dirty)return;const a=this.gl;En(a)?a.bindVertexArray(e):(n=a.getExtension("OES_vertex_array_object"))===null||n===void 0||n.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class hl extends Wt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Th extends Wt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class _a extends Wt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class ps extends Wt{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class Sh extends ps{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class jc extends ps{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Dt extends ps{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const uo="Framebuffer is not complete";class hp{constructor(e,n,a,c,p){this.context=e,this.width=n,this.height=a;const _=e.gl,x=this.framebuffer=_.createFramebuffer();if(this.colorAttachment=new Sh(e,x),c)this.depthAttachment=p?new Dt(e,x):new jc(e,x);else if(p)throw new Error("Stencil cannot be set without depth");if(_.checkFramebufferStatus(_.FRAMEBUFFER)!==_.FRAMEBUFFER_COMPLETE)throw new Error(uo)}destroy(){const e=this.context.gl,n=this.colorAttachment.get();if(n&&e.deleteTexture(n),this.depthAttachment){const a=this.depthAttachment.get();a&&e.deleteRenderbuffer(a)}e.deleteFramebuffer(this.framebuffer)}}class Ph{constructor(e){var n,a;if(this.gl=e,this.clearColor=new Dc(this),this.clearDepth=new Rc(this),this.clearStencil=new yh(this),this.colorMask=new Lc(this),this.depthMask=new Ns(this),this.stencilMask=new Bc(this),this.stencilFunc=new ap(this),this.stencilOp=new op(this),this.stencilTest=new lp(this),this.depthRange=new cp(this),this.depthTest=new vh(this),this.depthFunc=new up(this),this.blend=new xh(this),this.blendFunc=new al(this),this.blendColor=new ol(this),this.blendEquation=new ll(this),this.cullFace=new Fc(this),this.cullFaceSide=new Vs(this),this.frontFace=new lo(this),this.program=new ga(this),this.activeTexture=new Yi(this),this.viewport=new bh(this),this.bindFramebuffer=new wh(this),this.bindRenderbuffer=new Oc(this),this.bindTexture=new Us(this),this.bindVertexBuffer=new cl(this),this.bindElementBuffer=new ul(this),this.bindVertexArray=new co(this),this.pixelStoreUnpack=new hl(this),this.pixelStoreUnpackPremultiplyAlpha=new Th(this),this.pixelStoreUnpackFlipY=new _a(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),En(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(n=e.RGBA16F)!==null&&n!==void 0?n:c?.RGBA16F_EXT,this.RGB16F=(a=e.RGB16F)!==null&&a!==void 0?a:c?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n){return new _h(this,e,n)}createVertexBuffer(e,n,a){return new $n(this,e,n,a)}createRenderbuffer(e,n,a){const c=this.gl,p=c.createRenderbuffer();return this.bindRenderbuffer.set(p),c.renderbufferStorage(c.RENDERBUFFER,e,n,a),this.bindRenderbuffer.set(null),p}createFramebuffer(e,n,a,c){return new hp(this,e,n,a,c)}clear({color:e,depth:n,stencil:a}){const c=this.gl;let p=0;e&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),n!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),a!==void 0&&(p|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),c.clear(p)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){o.bH(e.blendFunction,_r.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return En(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var n;return En(this.gl)?this.gl.deleteVertexArray(e):(n=this.gl.getExtension("OES_vertex_array_object"))===null||n===void 0?void 0:n.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let fs;function Mh(h,e,n,a,c){const p=h.context,_=h.transform,x=p.gl,b=h.useProgram("collisionBox"),P=[];let I=0,k=0;for(let H=0;H<a.length;H++){const J=a[H],ie=e.getTile(J).getBucket(n);if(!ie)continue;const Q=c?ie.textCollisionBox:ie.iconCollisionBox,se=ie.collisionCircleArray;se.length>0&&(P.push({circleArray:se,circleOffset:k,coord:J}),I+=se.length/4,k=I),Q&&b.draw(p,x.LINES,vt.disabled,$t.disabled,h.colorModeForRenderPass(),ct.disabled,il(h.transform),h.style.map.terrain&&h.style.map.terrain.getTerrainData(J),_.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),n.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,null,h.transform.zoom,null,null,Q.collisionVertexBuffer)}if(!c||!P.length)return;const A=h.useProgram("collisionCircle"),R=new o.b$;R.resize(4*I),R._trim();let O=0;for(const H of P)for(let J=0;J<H.circleArray.length/4;J++){const ie=4*J,Q=H.circleArray[ie+0],se=H.circleArray[ie+1],ue=H.circleArray[ie+2],ee=H.circleArray[ie+3];R.emplace(O++,Q,se,ue,ee,0),R.emplace(O++,Q,se,ue,ee,1),R.emplace(O++,Q,se,ue,ee,2),R.emplace(O++,Q,se,ue,ee,3)}(!fs||fs.length<2*I)&&(fs=(function(H){const J=2*H,ie=new o.c1;ie.resize(J),ie._trim();for(let Q=0;Q<J;Q++){const se=6*Q;ie.uint16[se+0]=4*Q+0,ie.uint16[se+1]=4*Q+1,ie.uint16[se+2]=4*Q+2,ie.uint16[se+3]=4*Q+2,ie.uint16[se+4]=4*Q+3,ie.uint16[se+5]=4*Q+0}return ie})(I));const W=p.createIndexBuffer(fs,!0),G=p.createVertexBuffer(R,o.c0.members,!0);for(const H of P){const J=rp(h.transform);A.draw(p,x.TRIANGLES,vt.disabled,$t.disabled,h.colorModeForRenderPass(),ct.disabled,J,h.style.map.terrain&&h.style.map.terrain.getTerrainData(H.coord),null,n.id,G,W,o.aM.simpleSegment(0,2*H.circleOffset,H.circleArray.length,H.circleArray.length/2),null,h.transform.zoom,null,null,null)}G.destroy(),W.destroy()}const dp=o.ag(new Float32Array(16));function Ch(h,e,n,a,c,p){const{horizontalAlign:_,verticalAlign:x}=o.aH(h);return new o.P((-(_-.5)*e/c+a[0])*p,(-(x-.5)*n/c+a[1])*p)}function pp(h,e,n,a,c,p){const _=e.tileAnchorPoint.add(new o.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let x=a.mult(p);n||(x=x.rotate(-c));const b=_.add(x);return qr(b.x,b.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(n){const x=mi(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(h),b=Math.atan(x.y/x.x)+(x.x<0?Math.PI:0);return h.add(a.rotate(b))}return h.add(a)}function Nc(h,e,n,a,c,p,_,x,b,P,I,k){const A=h.text.placedSymbolArray,R=h.text.dynamicLayoutVertexArray,O=h.icon.dynamicLayoutVertexArray,W={};R.clear();for(let G=0;G<A.length;G++){const H=A.get(G),J=H.hidden||!H.crossTileID||h.allowVerticalPlacement&&!H.placedOrientation?null:a[H.crossTileID];if(J){const ie=new o.P(H.anchorX,H.anchorY),Q={getElevation:k,width:c.width,height:c.height,pitchedLabelPlaneMatrix:p,pitchWithMap:n,transform:c,tileAnchorPoint:ie,translation:P,unwrappedTileID:I},se=n?ls(ie.x,ie.y,Q):mi(ie.x,ie.y,Q),ue=je(c.cameraToCenterDistance,se.signedDistanceFromCamera);let ee=o.ap(h.textSizeData,x,H)*ue/o.aB;n&&(ee*=h.tilePixelRatio/_);const{width:ge,height:Te,anchor:ve,textOffset:xe,textBoxScale:we}=J,Fe=Ch(ve,ge,Te,xe,we,ee),Ve=c.getPitchedTextCorrection(ie.x+P[0],ie.y+P[1],I),Le=pp(se.point,Q,e,Fe,-c.bearingInRadians,Ve),Ye=h.allowVerticalPlacement&&H.placedOrientation===o.ao.vertical?Math.PI/2:0;for(let Tt=0;Tt<H.numGlyphs;Tt++)o.av(R,Le,Ye);b&&H.associatedIconIndex>=0&&(W[H.associatedIconIndex]={shiftedAnchor:Le,angle:Ye})}else In(H.numGlyphs,R)}if(b){O.clear();const G=h.icon.placedSymbolArray;for(let H=0;H<G.length;H++){const J=G.get(H);if(J.hidden)In(J.numGlyphs,O);else{const ie=W[H];if(ie)for(let Q=0;Q<J.numGlyphs;Q++)o.av(O,ie.shiftedAnchor,ie.angle);else In(J.numGlyphs,O)}}h.icon.dynamicLayoutVertexBuffer.updateData(O)}h.text.dynamicLayoutVertexBuffer.updateData(R)}function dl(h,e,n){return n.iconsInText&&e?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function ho(h,e,n,a,c,p,_,x,b,P,I,k,A){const R=h.context,O=R.gl,W=h.transform,G=x==="map",H=b==="map",J=x!=="viewport"&&n.layout.get("symbol-placement")!=="point",ie=G&&!H&&!J,Q=!n.layout.get("symbol-sort-key").isConstant();let se=!1;const ue=h.getDepthModeForSublayer(0,vt.ReadOnly),ee=n._unevaluatedLayout.hasValue("text-variable-anchor")||n._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ge=[],Te=W.getCircleRadiusCorrection();for(const ve of a){const xe=e.getTile(ve),we=xe.getBucket(n);if(!we)continue;const Fe=c?we.text:we.icon;if(!Fe||!Fe.segments.get().length||!Fe.hasVisibleVertices)continue;const Ve=Fe.programConfigurations.get(n.id),Le=c||we.sdfIcons,Ye=c?we.textSizeData:we.iconSizeData,Tt=H||W.pitch!==0,Yt=h.useProgram(dl(Le,c,we),Ve),ir=o.an(Ye,W.zoom),er=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ve);let Mr,Rr,xt,nr,Hr=[0,0],ti=null;if(c)Rr=xe.glyphAtlasTexture,xt=O.LINEAR,Mr=xe.glyphAtlasTexture.size,we.iconsInText&&(Hr=xe.imageAtlasTexture.size,ti=xe.imageAtlasTexture,nr=Tt||h.options.rotating||h.options.zooming||Ye.kind==="composite"||Ye.kind==="camera"?O.LINEAR:O.NEAREST);else{const Xr=n.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear;Rr=xe.imageAtlasTexture,xt=Le||h.options.rotating||h.options.zooming||Xr||Tt?O.LINEAR:O.NEAREST,Mr=xe.imageAtlasTexture.size}const li=o.aC(xe,1,h.transform.zoom),Ei=Ur(G,h.transform,li),mn=o.L();o.aq(mn,Ei);const gs=zt(H,G,h.transform,li),_s=o.aD(W,xe,p,_),Ea=W.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),Aa=ee&&we.hasTextData(),Xs=n.layout.get("icon-text-fit")!=="none"&&Aa&&we.hasIconData();if(J){const Xr=h.style.map.terrain?(en,Kr)=>h.style.map.terrain.getElevation(ve,en,Kr):null,ri=n.layout.get("text-rotation-alignment")==="map";zr(we,h,c,Ei,mn,H,P,ri,ve.toUnwrapped(),W.width,W.height,_s,Xr)}const Ks=c&&ee||Xs,Fi=J||Ks?dp:H?Ei:h.transform.clipSpaceToPixelsMatrix,gn=Le&&n.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ai;Ai=Le?we.iconsInText?sp(Ye.kind,ir,ie,H,J,Ks,h,Fi,gs,_s,Mr,Hr,Te):fh(Ye.kind,ir,ie,H,J,Ks,h,Fi,gs,_s,c,Mr,0,Te):oo(Ye.kind,ir,ie,H,J,Ks,h,Fi,gs,_s,c,Mr,Te);const ys={program:Yt,buffers:Fe,uniformValues:Ai,projectionData:Ea,atlasTexture:Rr,atlasTextureIcon:ti,atlasInterpolation:xt,atlasInterpolationIcon:nr,isSDF:Le,hasHalo:gn};if(Q&&we.canOverlap){se=!0;const Xr=Fe.segments.get();for(const ri of Xr)ge.push({segments:new o.aM([ri]),sortKey:ri.sortKey,state:ys,terrainData:er})}else ge.push({segments:Fe.segments,sortKey:0,state:ys,terrainData:er})}se&&ge.sort(((ve,xe)=>ve.sortKey-xe.sortKey));for(const ve of ge){const xe=ve.state;if(R.activeTexture.set(O.TEXTURE0),xe.atlasTexture.bind(xe.atlasInterpolation,O.CLAMP_TO_EDGE),xe.atlasTextureIcon&&(R.activeTexture.set(O.TEXTURE1),xe.atlasTextureIcon&&xe.atlasTextureIcon.bind(xe.atlasInterpolationIcon,O.CLAMP_TO_EDGE)),xe.isSDF){const we=xe.uniformValues;xe.hasHalo&&(we.u_is_halo=1,po(xe.buffers,ve.segments,n,h,xe.program,ue,I,k,we,xe.projectionData,ve.terrainData)),we.u_is_halo=0}po(xe.buffers,ve.segments,n,h,xe.program,ue,I,k,xe.uniformValues,xe.projectionData,ve.terrainData)}}function po(h,e,n,a,c,p,_,x,b,P,I){const k=a.context;c.draw(k,k.gl.TRIANGLES,p,_,x,ct.backCCW,b,I,P,n.id,h.layoutVertexBuffer,h.indexBuffer,e,n.paint,a.transform.zoom,h.programConfigurations.get(n.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Vc(h,e,n,a,c){const p=h.context,_=p.gl,x=$t.disabled,b=new _r([_.ONE,_.ONE],o.bf.transparent,[!0,!0,!0,!0]),P=e.getBucket(n);if(!P)return;const I=a.key;let k=n.heatmapFbos.get(I);k||(k=fo(p,e.tileSize,e.tileSize),n.heatmapFbos.set(I,k)),p.bindFramebuffer.set(k.framebuffer),p.viewport.set([0,0,e.tileSize,e.tileSize]),p.clear({color:o.bf.transparent});const A=P.programConfigurations.get(n.id),R=h.useProgram("heatmap",A,!c),O=h.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),W=h.style.map.terrain.getTerrainData(a);R.draw(p,_.TRIANGLES,vt.disabled,x,b,ct.disabled,ch(e,h.transform.zoom,n.paint.get("heatmap-intensity"),1),W,O,n.id,P.layoutVertexBuffer,P.indexBuffer,P.segments,n.paint,h.transform.zoom,A)}function Ih(h,e,n,a,c){const p=h.context,_=p.gl,x=h.transform;p.setColorMode(h.colorModeForRenderPass());const b=mo(p,e),P=n.key,I=e.heatmapFbos.get(P);if(!I)return;p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,I.colorAttachment.get()),p.activeTexture.set(_.TEXTURE1),b.bind(_.LINEAR,_.CLAMP_TO_EDGE);const k=x.getProjectionData({overscaledTileID:n,applyTerrainMatrix:c,applyGlobeMatrix:!a});h.useProgram("heatmapTexture").draw(p,_.TRIANGLES,vt.disabled,$t.disabled,h.colorModeForRenderPass(),ct.disabled,Cc(h,e,0,1),null,k,e.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments,e.paint,x.zoom),I.destroy(),e.heatmapFbos.delete(P)}function fo(h,e,n){var a,c;const p=h.gl,_=p.createTexture();p.bindTexture(p.TEXTURE_2D,_),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR);const x=(a=h.HALF_FLOAT)!==null&&a!==void 0?a:p.UNSIGNED_BYTE,b=(c=h.RGBA16F)!==null&&c!==void 0?c:p.RGBA;p.texImage2D(p.TEXTURE_2D,0,b,e,n,0,p.RGBA,x,null);const P=h.createFramebuffer(e,n,!1,!1);return P.colorAttachment.set(_),P}function mo(h,e){return e.colorRampTexture||(e.colorRampTexture=new o.T(h,e.colorRamp,h.gl.RGBA)),e.colorRampTexture}function go(h,e,n,a,c){if(!n||!a||!a.imageAtlas)return;const p=a.imageAtlas.patternPositions;let _=p[n.to.toString()],x=p[n.from.toString()];if(!_&&x&&(_=x),!x&&_&&(x=_),!_||!x){const b=c.getPaintProperty(e);_=p[b],x=p[b]}_&&x&&h.setConstantPatternPositions(_,x)}function pl(h,e,n,a,c,p,_,x){const b=h.context.gl,P="fill-pattern",I=n.paint.get(P),k=I&&I.constantOr(1),A=n.getCrossfadeParameters();let R,O,W,G,H;const J=h.transform,ie=n.paint.get("fill-translate"),Q=n.paint.get("fill-translate-anchor");_?(O=k&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=b.LINES):(O=k?"fillPattern":"fill",R=b.TRIANGLES);const se=I.constantOr(null);for(const ue of a){const ee=e.getTile(ue);if(k&&!ee.patternsLoaded())continue;const ge=ee.getBucket(n);if(!ge)continue;const Te=ge.programConfigurations.get(n.id),ve=h.useProgram(O,Te),xe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(ue);k&&(h.context.activeTexture.set(b.TEXTURE0),ee.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),Te.updatePaintBuffers(A)),go(Te,P,se,ee,n);const we=J.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!x,applyTerrainMatrix:!0}),Fe=o.aD(J,ee,ie,Q);if(_){G=ge.indexBuffer2,H=ge.segments2;const Le=[b.drawingBufferWidth,b.drawingBufferHeight];W=O==="fillOutlinePattern"&&k?so(h,A,ee,Le,Fe):no(Le,Fe)}else G=ge.indexBuffer,H=ge.segments,W=k?rl(h,A,ee,Fe):{u_fill_translate:Fe};const Ve=h.stencilModeForClipping(ue);ve.draw(h.context,R,c,Ve,p,ct.backCCW,W,xe,we,n.id,ge.layoutVertexBuffer,G,H,n.paint,h.transform.zoom,Te)}}function Uc(h,e,n,a,c,p,_,x){const b=h.context,P=b.gl,I="fill-extrusion-pattern",k=n.paint.get(I),A=k.constantOr(1),R=n.getCrossfadeParameters(),O=n.paint.get("fill-extrusion-opacity"),W=k.constantOr(null),G=h.transform;for(const H of a){const J=e.getTile(H),ie=J.getBucket(n);if(!ie)continue;const Q=h.style.map.terrain&&h.style.map.terrain.getTerrainData(H),se=ie.programConfigurations.get(n.id),ue=h.useProgram(A?"fillExtrusionPattern":"fillExtrusion",se);A&&(h.context.activeTexture.set(P.TEXTURE0),J.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),se.updatePaintBuffers(R));const ee=G.getProjectionData({overscaledTileID:H,applyGlobeMatrix:!x,applyTerrainMatrix:!0});go(se,I,W,J,n);const ge=o.aD(G,J,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Te=n.paint.get("fill-extrusion-vertical-gradient"),ve=A?ep(h,Te,O,ge,H,R,J):cn(h,Te,O,ge);ue.draw(b,b.gl.TRIANGLES,c,p,_,ct.backCCW,ve,Q,ee,n.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,n.paint,h.transform.zoom,se,h.style.map.terrain&&ie.centroidVertexBuffer)}}function $s(h,e,n,a,c,p,_,x,b){var P;const I=h.style.projection,k=h.context,A=h.transform,R=k.gl,O=[`#define NUM_ILLUMINATION_SOURCES ${n.paint.get("hillshade-highlight-color").values.length}`],W=h.useProgram("hillshade",null,!1,O),G=!h.options.moving;for(const H of a){const J=e.getTile(H),ie=J.fbo;if(!ie)continue;const Q=I.getMeshFromTileID(k,H.canonical,x,!0,"raster"),se=(P=h.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(H);k.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,ie.colorAttachment.get());const ue=A.getProjectionData({overscaledTileID:H,aligned:G,applyGlobeMatrix:!b,applyTerrainMatrix:!0});W.draw(k,R.TRIANGLES,p,c[H.overscaledZ],_,ct.backCCW,ip(h,J,n),se,ue,n.id,Q.vertexBuffer,Q.indexBuffer,Q.segments)}}function $c(h,e,n,a,c,p,_,x,b){var P;const I=h.style.projection,k=h.context,A=h.transform,R=k.gl,O=h.useProgram("colorRelief"),W=!h.options.moving;let G=!0,H=0;for(const J of a){const ie=e.getTile(J),Q=ie.dem;if(G){const ve=R.getParameter(R.MAX_TEXTURE_SIZE),{elevationTexture:xe,colorTexture:we}=n.getColorRampTextures(k,ve,Q.getUnpackVector());k.activeTexture.set(R.TEXTURE1),xe.bind(R.NEAREST,R.CLAMP_TO_EDGE),k.activeTexture.set(R.TEXTURE4),we.bind(R.LINEAR,R.CLAMP_TO_EDGE),G=!1,H=xe.size[0]}if(!Q||!Q.data)continue;const se=Q.stride,ue=Q.getPixels();if(k.activeTexture.set(R.TEXTURE0),k.pixelStoreUnpackPremultiplyAlpha.set(!1),ie.demTexture=ie.demTexture||h.getTileTexture(se),ie.demTexture){const ve=ie.demTexture;ve.update(ue,{premultiply:!1}),ve.bind(R.LINEAR,R.CLAMP_TO_EDGE)}else ie.demTexture=new o.T(k,ue,R.RGBA,{premultiply:!1}),ie.demTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE);const ee=I.getMeshFromTileID(k,J.canonical,x,!0,"raster"),ge=(P=h.style.map.terrain)===null||P===void 0?void 0:P.getTerrainData(J),Te=A.getProjectionData({overscaledTileID:J,aligned:W,applyGlobeMatrix:!b,applyTerrainMatrix:!0});O.draw(k,R.TRIANGLES,p,c[J.overscaledZ],_,ct.backCCW,hh(n,ie.dem,H),ge,Te,n.id,ee.vertexBuffer,ee.indexBuffer,ee.segments)}}const fl=[new o.P(0,0),new o.P(o.$,0),new o.P(o.$,o.$),new o.P(0,o.$)];function Zs(h,e,n,a,c,p,_,x,b=!1,P=!1){const I=a[a.length-1].overscaledZ,k=h.context,A=k.gl,R=h.useProgram("raster"),O=h.transform,W=h.style.projection,G=h.colorModeForRenderPass(),H=!h.options.moving;for(const J of a){const ie=h.getDepthModeForSublayer(J.overscaledZ-I,n.paint.get("raster-opacity")===1?vt.ReadWrite:vt.ReadOnly,A.LESS),Q=e.getTile(J);Q.registerFadeDuration(n.paint.get("raster-fade-duration"));const se=e.findLoadedParent(J,0),ue=e.findLoadedSibling(J),ee=Zc(Q,se||ue||null,e,n,h.transform,h.style.map.terrain);let ge,Te;const ve=n.paint.get("raster-resampling")==="nearest"?A.NEAREST:A.LINEAR;k.activeTexture.set(A.TEXTURE0),Q.texture.bind(ve,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),k.activeTexture.set(A.TEXTURE1),se?(se.texture.bind(ve,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),ge=Math.pow(2,se.tileID.overscaledZ-Q.tileID.overscaledZ),Te=[Q.tileID.canonical.x*ge%1,Q.tileID.canonical.y*ge%1]):Q.texture.bind(ve,A.CLAMP_TO_EDGE,A.LINEAR_MIPMAP_NEAREST),Q.texture.useMipmap&&k.extTextureFilterAnisotropic&&h.transform.pitch>20&&A.texParameterf(A.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const xe=h.style.map.terrain&&h.style.map.terrain.getTerrainData(J),we=O.getProjectionData({overscaledTileID:J,aligned:H,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),Fe=ao(Te||[0,0],ge||1,ee,n,x),Ve=W.getMeshFromTileID(k,J.canonical,p,_,"raster");R.draw(k,A.TRIANGLES,ie,c?c[J.overscaledZ]:$t.disabled,G,b?ct.frontCCW:ct.backCCW,Fe,xe,we,n.id,Ve.vertexBuffer,Ve.indexBuffer,Ve.segments)}}function Zc(h,e,n,a,c,p){const _=a.paint.get("raster-fade-duration");if(!p&&_>0){const x=he.now(),b=(x-h.timeAdded)/_,P=e?(x-e.timeAdded)/_:-1,I=n.getSource(),k=Ke(c,{tileSize:I.tileSize,roundZoom:I.roundZoom}),A=!e||Math.abs(e.tileID.overscaledZ-k)>Math.abs(h.tileID.overscaledZ-k),R=A&&h.refreshedUponExpiration?1:o.ah(A?b:1-P,0,1);return h.refreshedUponExpiration&&b>=1&&(h.refreshedUponExpiration=!1),e?{opacity:1,mix:1-R}:{opacity:R,mix:0}}return{opacity:1,mix:0}}const Eh=new o.bf(1,0,0,1),Ah=new o.bf(0,1,0,1),ml=new o.bf(0,0,1,1),Gc=new o.bf(1,0,1,1),fp=new o.bf(0,1,1,1);function qc(h,e,n,a){zn(h,0,e+n/2,h.transform.width,n,a)}function Dr(h,e,n,a){zn(h,e-n/2,0,n,h.transform.height,a)}function zn(h,e,n,a,c,p){const _=h.context,x=_.gl;x.enable(x.SCISSOR_TEST),x.scissor(e*h.pixelRatio,n*h.pixelRatio,a*h.pixelRatio,c*h.pixelRatio),_.clear({color:p}),x.disable(x.SCISSOR_TEST)}function Ji(h,e,n){const a=h.context,c=a.gl,p=h.useProgram("debug"),_=vt.disabled,x=$t.disabled,b=h.colorModeForRenderPass(),P="$debug",I=h.style.map.terrain&&h.style.map.terrain.getTerrainData(n);a.activeTexture.set(c.TEXTURE0);const k=e.getTileByID(n.key).latestRawTileData,A=Math.floor((k&&k.byteLength||0)/1024),R=e.getTile(n).tileSize,O=512/Math.min(R,512)*(n.overscaledZ/h.transform.zoom)*.5;let W=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(W+=` => ${n.overscaledZ}`),(function(H,J){H.initDebugOverlayCanvas();const ie=H.debugOverlayCanvas,Q=H.context.gl,se=H.debugOverlayCanvas.getContext("2d");se.clearRect(0,0,ie.width,ie.height),se.shadowColor="white",se.shadowBlur=2,se.lineWidth=1.5,se.strokeStyle="white",se.textBaseline="top",se.font="bold 36px Open Sans, sans-serif",se.fillText(J,5,5),se.strokeText(J,5,5),H.debugOverlayTexture.update(ie),H.debugOverlayTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE)})(h,`${W} ${A}kB`);const G=h.transform.getProjectionData({overscaledTileID:n,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(a,c.TRIANGLES,_,x,_r.alphaBlended,ct.disabled,Os(o.bf.transparent,O),null,G,P,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),p.draw(a,c.LINE_STRIP,_,x,b,ct.disabled,Os(o.bf.red),I,G,P,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function gl(h,e,n,a){const{isRenderingGlobe:c}=a,p=h.context,_=p.gl,x=h.transform,b=h.colorModeForRenderPass(),P=h.getDepthModeFor3D(),I=h.useProgram("terrain");p.bindFramebuffer.set(null),p.viewport.set([0,0,h.width,h.height]);for(const k of n){const A=e.getTerrainMesh(k.tileID),R=h.renderToTexture.getTexture(k),O=e.getTerrainData(k.tileID);p.activeTexture.set(_.TEXTURE0),_.bindTexture(_.TEXTURE_2D,R.texture);const W=e.getMeshFrameDelta(x.zoom),G=x.calculateFogMatrix(k.tileID.toUnwrapped()),H=el(W,G,h.style.sky,x.pitch,c),J=x.getProjectionData({overscaledTileID:k.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});I.draw(p,_.TRIANGLES,P,$t.disabled,b,ct.backCCW,H,O,J,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}}function _o(h,e){if(!e.mesh){const n=new o.aL;n.emplaceBack(-1,-1),n.emplaceBack(1,-1),n.emplaceBack(1,1),n.emplaceBack(-1,1);const a=new o.aN;a.emplaceBack(0,1,2),a.emplaceBack(0,2,3),e.mesh=new zs(h.createVertexBuffer(n,ds.members),h.createIndexBuffer(a),o.aM.simpleSegment(0,0,n.length,a.length))}return e.mesh}class kh{constructor(e,n){this.context=new Ph(e),this.transform=n,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.ag(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=bt.maxUnderzooming+bt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new da}resize(e,n,a){if(this.width=Math.floor(e*a),this.height=Math.floor(n*a),this.pixelRatio=a,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,n=new o.aL;n.emplaceBack(0,0),n.emplaceBack(o.$,0),n.emplaceBack(0,o.$),n.emplaceBack(o.$,o.$),this.tileExtentBuffer=e.createVertexBuffer(n,ds.members),this.tileExtentSegments=o.aM.simpleSegment(0,0,4,2);const a=new o.aL;a.emplaceBack(0,0),a.emplaceBack(o.$,0),a.emplaceBack(0,o.$),a.emplaceBack(o.$,o.$),this.debugBuffer=e.createVertexBuffer(a,ds.members),this.debugSegments=o.aM.simpleSegment(0,0,4,5);const c=new o.c6;c.emplaceBack(0,0,0,0),c.emplaceBack(o.$,0,o.$,0),c.emplaceBack(0,o.$,0,o.$),c.emplaceBack(o.$,o.$,o.$,o.$),this.rasterBoundsBuffer=e.createVertexBuffer(c,Jd.members),this.rasterBoundsSegments=o.aM.simpleSegment(0,0,4,2);const p=new o.aL;p.emplaceBack(0,0),p.emplaceBack(o.$,0),p.emplaceBack(0,o.$),p.emplaceBack(o.$,o.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(p,ds.members),this.rasterBoundsSegmentsPosOnly=o.aM.simpleSegment(0,0,4,5);const _=new o.aL;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(_,ds.members),this.viewportSegments=o.aM.simpleSegment(0,0,4,2);const x=new o.c7;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(x);const b=new o.aN;b.emplaceBack(1,0,2),b.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(b);const P=this.context.gl;this.stencilClearMode=new $t({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.tileExtentMesh=new zs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const a=o.L();o.bY(a,0,this.width,this.height,0,0,1),o.N(a,a,[n.drawingBufferWidth,n.drawingBufferHeight,0]);const c={mainMatrix:a,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:a};this.useProgram("clippingMask",null,!0).draw(e,n.TRIANGLES,vt.disabled,this.stencilClearMode,_r.disabled,ct.disabled,null,null,c,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,n,a){if(this.currentStencilSource===e.source||!e.isTileClipped()||!n||!n.length)return;this.currentStencilSource=e.source,this.nextStencilID+n.length>256&&this.clearStencil();const c=this.context;c.setColorMode(_r.disabled),c.setDepthMode(vt.disabled);const p={};for(const _ of n)p[_.key]=this.nextStencilID++;this._renderTileMasks(p,n,a,!0),this._renderTileMasks(p,n,a,!1),this._tileClippingMaskIDs=p}_renderTileMasks(e,n,a,c){const p=this.context,_=p.gl,x=this.style.projection,b=this.transform,P=this.useProgram("clippingMask");for(const I of n){const k=e[I.key],A=this.style.map.terrain&&this.style.map.terrain.getTerrainData(I),R=x.getMeshFromTileID(this.context,I.canonical,c,!0,"stencil"),O=b.getProjectionData({overscaledTileID:I,applyGlobeMatrix:!a,applyTerrainMatrix:!0});P.draw(p,_.TRIANGLES,vt.disabled,new $t({func:_.ALWAYS,mask:0},k,255,_.KEEP,_.KEEP,_.REPLACE),_r.disabled,a?ct.disabled:ct.backCCW,null,A,O,"$clipping",R.vertexBuffer,R.indexBuffer,R.segments)}}_renderTilesDepthBuffer(){const e=this.context,n=e.gl,a=this.style.projection,c=this.transform,p=this.useProgram("depth"),_=this.getDepthModeFor3D(),x=_e(c,{tileSize:c.tileSize});for(const b of x){const P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(b),I=a.getMeshFromTileID(this.context,b.canonical,!0,!0,"raster"),k=c.getProjectionData({overscaledTileID:b,applyGlobeMatrix:!0,applyTerrainMatrix:!0});p.draw(e,n.TRIANGLES,_,$t.disabled,_r.disabled,ct.backCCW,null,P,k,"$clipping",I.vertexBuffer,I.indexBuffer,I.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new $t({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){const n=this.context.gl;return new $t({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const n=this.context.gl,a=e.sort(((_,x)=>x.overscaledZ-_.overscaledZ)),c=a[a.length-1].overscaledZ,p=a[0].overscaledZ-c+1;if(p>1){this.currentStencilSource=void 0,this.nextStencilID+p>256&&this.clearStencil();const _={};for(let x=0;x<p;x++)_[x+c]=new $t({func:n.GEQUAL,mask:255},x+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=p,[_,a]}return[{[c]:$t.disabled},a]}stencilConfigForOverlapTwoPass(e){const n=this.context.gl,a=e.sort(((_,x)=>x.overscaledZ-_.overscaledZ)),c=a[a.length-1].overscaledZ,p=a[0].overscaledZ-c+1;if(this.clearStencil(),p>1){const _={},x={};for(let b=0;b<p;b++)_[b+c]=new $t({func:n.GREATER,mask:255},p+1+b,255,n.KEEP,n.KEEP,n.REPLACE),x[b+c]=new $t({func:n.GREATER,mask:255},1+b,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID=2*p+1,[_,x,a]}return this.nextStencilID=3,[{[c]:new $t({func:n.GREATER,mask:255},2,255,n.KEEP,n.KEEP,n.REPLACE)},{[c]:new $t({func:n.GREATER,mask:255},1,255,n.KEEP,n.KEEP,n.REPLACE)},a]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new _r([e.CONSTANT_COLOR,e.ONE],new o.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?_r.unblended:_r.alphaBlended}getDepthModeForSublayer(e,n,a){if(!this.opaquePassEnabledForLayer())return vt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new vt(a||this.context.gl.LEQUAL,n,[c,c])}getDepthModeFor3D(){return new vt(this.context.gl.LEQUAL,vt.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){var a,c;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(he.now()),this.imageManager.beginFrame();const p=this.style._order,_=this.style.sourceCaches,x={},b={},P={},I={isRenderingToTexture:!1,isRenderingGlobe:((a=e.projection)===null||a===void 0?void 0:a.transitionState)>0};for(const A in _){const R=_[A];R.used&&R.prepare(this.context),x[A]=R.getVisibleCoordinates(!1),b[A]=x[A].slice().reverse(),P[A]=R.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<p.length;A++)if(this.style._layers[p[A]].is3D()){this.opaquePassCutoff=A;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const A of p){const R=this.style._layers[A];if(!R.hasOffscreenPass()||R.isHidden(this.transform.zoom))continue;const O=b[R.source];(R.type==="custom"||O.length)&&this.renderLayer(this,_[R.source],R,O,I)}if((c=this.style.projection)===null||c===void 0||c.updateGPUdependent({context:this.context,useProgram:A=>this.useProgram(A)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?o.bf.black:o.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(A,R){const O=A.context,W=O.gl,G=((ue,ee,ge)=>{const Te=Math.cos(ee.rollInRadians),ve=Math.sin(ee.rollInRadians),xe=U(ee),we=ee.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:ue.properties.get("sky-color"),u_horizon_color:ue.properties.get("horizon-color"),u_horizon:[(ee.width/2-xe*ve)*ge,(ee.height/2+xe*Te)*ge],u_horizon_normal:[-ve,Te],u_sky_horizon_blend:ue.properties.get("sky-horizon-blend")*ee.height/2*ge,u_sky_blend:we}})(R,A.style.map.transform,A.pixelRatio),H=new vt(W.LEQUAL,vt.ReadWrite,[0,1]),J=$t.disabled,ie=A.colorModeForRenderPass(),Q=A.useProgram("sky"),se=_o(O,R);Q.draw(O,W.TRIANGLES,H,J,ie,ct.disabled,G,null,void 0,"sky",se.vertexBuffer,se.indexBuffer,se.segments)})(this,this.style.sky),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[p[this.currentLayer]],R=_[A.source],O=x[A.source];this._renderTileClippingMasks(A,O,!1),this.renderLayer(this,R,A,O,I)}this.renderPass="translucent";let k=!1;for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const A=this.style._layers[p[this.currentLayer]],R=_[A.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(A,I))continue;this.opaquePassEnabledForLayer()||k||(k=!0,I.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const O=(A.type==="symbol"?P:b)[A.source];this._renderTileClippingMasks(A,x[A.source],!!this.renderToTexture),this.renderLayer(this,R,A,O,I)}if(I.isRenderingGlobe&&(function(A,R,O){const W=A.context,G=W.gl,H=A.useProgram("atmosphere"),J=new vt(G.LEQUAL,vt.ReadOnly,[0,1]),ie=A.transform,Q=(function(we,Fe){const Ve=we.properties.get("position"),Le=[-Ve.x,-Ve.y,-Ve.z],Ye=o.ag(new Float64Array(16));return we.properties.get("anchor")==="map"&&(o.b6(Ye,Ye,Fe.rollInRadians),o.b7(Ye,Ye,-Fe.pitchInRadians),o.b6(Ye,Ye,Fe.bearingInRadians),o.b7(Ye,Ye,Fe.center.lat*Math.PI/180),o.bz(Ye,Ye,-Fe.center.lng*Math.PI/180)),o.c5(Le,Le,Ye),Le})(O,A.transform),se=ie.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),ue=R.properties.get("atmosphere-blend")*se.projectionTransition;if(ue===0)return;const ee=fa(ie.worldSize,ie.center.lat),ge=ie.inverseProjectionMatrix,Te=new Float64Array(4);Te[3]=1,o.aw(Te,Te,ie.modelViewProjectionMatrix),Te[0]/=Te[3],Te[1]/=Te[3],Te[2]/=Te[3],Te[3]=1,o.aw(Te,Te,ge),Te[0]/=Te[3],Te[1]/=Te[3],Te[2]/=Te[3],Te[3]=1;const ve=((we,Fe,Ve,Le,Ye)=>({u_sun_pos:we,u_atmosphere_blend:Fe,u_globe_position:Ve,u_globe_radius:Le,u_inv_proj_matrix:Ye}))(Q,ue,[Te[0],Te[1],Te[2]],ee,ge),xe=_o(W,R);H.draw(W,G.TRIANGLES,J,$t.disabled,_r.alphaBlended,ct.disabled,ve,null,null,"atmosphere",xe.vertexBuffer,xe.indexBuffer,xe.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const A=(function(R,O){let W=null;const G=Object.values(R._layers).flatMap((Q=>Q.source&&!Q.isHidden(O)?[R.sourceCaches[Q.source]]:[])),H=G.filter((Q=>Q.getSource().type==="vector")),J=G.filter((Q=>Q.getSource().type!=="vector")),ie=Q=>{(!W||W.getSource().maxzoom<Q.getSource().maxzoom)&&(W=Q)};return H.forEach((Q=>ie(Q))),W||J.forEach((Q=>ie(Q))),W})(this.style,this.transform.zoom);A&&(function(R,O,W){for(let G=0;G<W.length;G++)Ji(R,O,W[G])})(this,A,A.getVisibleCoordinates())}this.options.showPadding&&(function(A){const R=A.transform.padding;qc(A,A.transform.height-(R.top||0),3,Eh),qc(A,R.bottom||0,3,Ah),Dr(A,R.left||0,3,ml),Dr(A,A.transform.width-(R.right||0),3,Gc);const O=A.transform.centerPoint;(function(W,G,H,J){zn(W,G-1,H-10,2,20,J),zn(W,G-10,H-1,20,2,J)})(A,O.x,A.transform.height-O.y,fp)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const n=this.terrainFacilitator.matrix,a=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!o.c8(n,a):!o.c9(n,a)),c||(c=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),c&&(o.ca(n,a),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(p,_){const x=p.context,b=x.gl,P=p.transform,I=_r.unblended,k=new vt(b.LEQUAL,vt.ReadWrite,[0,1]),A=_.sourceCache.getRenderableTiles(),R=p.useProgram("terrainDepth");x.bindFramebuffer.set(_.getFramebuffer("depth").framebuffer),x.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),x.clear({color:o.bf.transparent,depth:1});for(const O of A){const W=_.getTerrainMesh(O.tileID),G=_.getTerrainData(O.tileID),H=P.getProjectionData({overscaledTileID:O.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),J={u_ele_delta:_.getMeshFrameDelta(P.zoom)};R.draw(x,b.TRIANGLES,k,$t.disabled,I,ct.backCCW,J,G,H,"terrain",W.vertexBuffer,W.indexBuffer,W.segments)}x.bindFramebuffer.set(null),x.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain),(function(p,_){const x=p.context,b=x.gl,P=p.transform,I=_r.unblended,k=new vt(b.LEQUAL,vt.ReadWrite,[0,1]),A=_.getCoordsTexture(),R=_.sourceCache.getRenderableTiles(),O=p.useProgram("terrainCoords");x.bindFramebuffer.set(_.getFramebuffer("coords").framebuffer),x.viewport.set([0,0,p.width/devicePixelRatio,p.height/devicePixelRatio]),x.clear({color:o.bf.transparent,depth:1}),_.coordsIndex=[];for(const W of R){const G=_.getTerrainMesh(W.tileID),H=_.getTerrainData(W.tileID);x.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,A.texture);const J={u_terrain_coords_id:(255-_.coordsIndex.length)/255,u_texture:0,u_ele_delta:_.getMeshFrameDelta(P.zoom)},ie=P.getProjectionData({overscaledTileID:W.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});O.draw(x,b.TRIANGLES,k,$t.disabled,I,ct.backCCW,J,H,ie,"terrain",G.vertexBuffer,G.indexBuffer,G.segments),_.coordsIndex.push(W.tileID.key)}x.bindFramebuffer.set(null),x.viewport.set([0,0,p.width,p.height])})(this,this.style.map.terrain))}renderLayer(e,n,a,c,p){a.isHidden(this.transform.zoom)||(a.type==="background"||a.type==="custom"||(c||[]).length)&&(this.id=a.id,o.cb(a)?(function(_,x,b,P,I,k){if(_.renderPass!=="translucent")return;const{isRenderingToTexture:A}=k,R=$t.disabled,O=_.colorModeForRenderPass();(b._unevaluatedLayout.hasValue("text-variable-anchor")||b._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(W,G,H,J,ie,Q,se,ue,ee){const ge=G.transform,Te=G.style.map.terrain,ve=ie==="map",xe=Q==="map";for(const we of W){const Fe=J.getTile(we),Ve=Fe.getBucket(H);if(!Ve||!Ve.text||!Ve.text.segments.get().length)continue;const Le=o.an(Ve.textSizeData,ge.zoom),Ye=o.aC(Fe,1,G.transform.zoom),Tt=Ur(ve,G.transform,Ye),Yt=H.layout.get("icon-text-fit")!=="none"&&Ve.hasIconData();if(Le){const ir=Math.pow(2,ge.zoom-Fe.tileID.overscaledZ),er=Te?(Mr,Rr)=>Te.getElevation(we,Mr,Rr):null;Nc(Ve,ve,xe,ee,ge,Tt,ir,Le,Yt,o.aD(ge,Fe,se,ue),we.toUnwrapped(),er)}}})(P,_,b,x,b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),I),b.paint.get("icon-opacity").constantOr(1)!==0&&ho(_,x,b,P,!1,b.paint.get("icon-translate"),b.paint.get("icon-translate-anchor"),b.layout.get("icon-rotation-alignment"),b.layout.get("icon-pitch-alignment"),b.layout.get("icon-keep-upright"),R,O,A),b.paint.get("text-opacity").constantOr(1)!==0&&ho(_,x,b,P,!0,b.paint.get("text-translate"),b.paint.get("text-translate-anchor"),b.layout.get("text-rotation-alignment"),b.layout.get("text-pitch-alignment"),b.layout.get("text-keep-upright"),R,O,A),x.map.showCollisionBoxes&&(Mh(_,x,b,P,!0),Mh(_,x,b,P,!1))})(e,n,a,c,this.style.placement.variableOffsets,p):o.cc(a)?(function(_,x,b,P,I){if(_.renderPass!=="translucent")return;const{isRenderingToTexture:k}=I,A=b.paint.get("circle-opacity"),R=b.paint.get("circle-stroke-width"),O=b.paint.get("circle-stroke-opacity"),W=!b.layout.get("circle-sort-key").isConstant();if(A.constantOr(1)===0&&(R.constantOr(1)===0||O.constantOr(1)===0))return;const G=_.context,H=G.gl,J=_.transform,ie=_.getDepthModeForSublayer(0,vt.ReadOnly),Q=$t.disabled,se=_.colorModeForRenderPass(),ue=[],ee=J.getCircleRadiusCorrection();for(let ge=0;ge<P.length;ge++){const Te=P[ge],ve=x.getTile(Te),xe=ve.getBucket(b);if(!xe)continue;const we=b.paint.get("circle-translate"),Fe=b.paint.get("circle-translate-anchor"),Ve=o.aD(J,ve,we,Fe),Le=xe.programConfigurations.get(b.id),Ye=_.useProgram("circle",Le),Tt=xe.layoutVertexBuffer,Yt=xe.indexBuffer,ir=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Te),er={programConfiguration:Le,program:Ye,layoutVertexBuffer:Tt,indexBuffer:Yt,uniformValues:tp(_,ve,b,Ve,ee),terrainData:ir,projectionData:J.getProjectionData({overscaledTileID:Te,applyGlobeMatrix:!k,applyTerrainMatrix:!0})};if(W){const Mr=xe.segments.get();for(const Rr of Mr)ue.push({segments:new o.aM([Rr]),sortKey:Rr.sortKey,state:er})}else ue.push({segments:xe.segments,sortKey:0,state:er})}W&&ue.sort(((ge,Te)=>ge.sortKey-Te.sortKey));for(const ge of ue){const{programConfiguration:Te,program:ve,layoutVertexBuffer:xe,indexBuffer:we,uniformValues:Fe,terrainData:Ve,projectionData:Le}=ge.state;ve.draw(G,H.TRIANGLES,ie,Q,se,ct.backCCW,Fe,Ve,Le,b.id,xe,we,ge.segments,b.paint,_.transform.zoom,Te)}})(e,n,a,c,p):o.cd(a)?(function(_,x,b,P,I){if(b.paint.get("heatmap-opacity")===0)return;const k=_.context,{isRenderingToTexture:A,isRenderingGlobe:R}=I;if(_.style.map.terrain){for(const O of P){const W=x.getTile(O);x.hasRenderableParent(O)||(_.renderPass==="offscreen"?Vc(_,W,b,O,R):_.renderPass==="translucent"&&Ih(_,b,O,A,R))}k.viewport.set([0,0,_.width,_.height])}else _.renderPass==="offscreen"?(function(O,W,G,H){const J=O.context,ie=J.gl,Q=O.transform,se=$t.disabled,ue=new _r([ie.ONE,ie.ONE],o.bf.transparent,[!0,!0,!0,!0]);(function(ee,ge,Te){const ve=ee.gl;ee.activeTexture.set(ve.TEXTURE1),ee.viewport.set([0,0,ge.width/4,ge.height/4]);let xe=Te.heatmapFbos.get(o.c2);xe?(ve.bindTexture(ve.TEXTURE_2D,xe.colorAttachment.get()),ee.bindFramebuffer.set(xe.framebuffer)):(xe=fo(ee,ge.width/4,ge.height/4),Te.heatmapFbos.set(o.c2,xe))})(J,O,G),J.clear({color:o.bf.transparent});for(let ee=0;ee<H.length;ee++){const ge=H[ee];if(W.hasRenderableParent(ge))continue;const Te=W.getTile(ge),ve=Te.getBucket(G);if(!ve)continue;const xe=ve.programConfigurations.get(G.id),we=O.useProgram("heatmap",xe),Fe=Q.getProjectionData({overscaledTileID:ge,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),Ve=Q.getCircleRadiusCorrection();we.draw(J,ie.TRIANGLES,vt.disabled,se,ue,ct.backCCW,ch(Te,Q.zoom,G.paint.get("heatmap-intensity"),Ve),null,Fe,G.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,G.paint,Q.zoom,xe)}J.viewport.set([0,0,O.width,O.height])})(_,x,b,P):_.renderPass==="translucent"&&(function(O,W){const G=O.context,H=G.gl;G.setColorMode(O.colorModeForRenderPass());const J=W.heatmapFbos.get(o.c2);J&&(G.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,J.colorAttachment.get()),G.activeTexture.set(H.TEXTURE1),mo(G,W).bind(H.LINEAR,H.CLAMP_TO_EDGE),O.useProgram("heatmapTexture").draw(G,H.TRIANGLES,vt.disabled,$t.disabled,O.colorModeForRenderPass(),ct.disabled,Cc(O,W,0,1),null,null,W.id,O.viewportBuffer,O.quadTriangleIndexBuffer,O.viewportSegments,W.paint,O.transform.zoom))})(_,b)})(e,n,a,c,p):o.ce(a)?(function(_,x,b,P,I){if(_.renderPass!=="translucent")return;const{isRenderingToTexture:k}=I,A=b.paint.get("line-opacity"),R=b.paint.get("line-width");if(A.constantOr(1)===0||R.constantOr(1)===0)return;const O=_.getDepthModeForSublayer(0,vt.ReadOnly),W=_.colorModeForRenderPass(),G=b.paint.get("line-dasharray"),H=b.paint.get("line-pattern"),J=H.constantOr(1),ie=b.paint.get("line-gradient"),Q=b.getCrossfadeParameters(),se=J?"linePattern":G?"lineSDF":ie?"lineGradient":"line",ue=_.context,ee=ue.gl,ge=_.transform;let Te=!0;for(const ve of P){const xe=x.getTile(ve);if(J&&!xe.patternsLoaded())continue;const we=xe.getBucket(b);if(!we)continue;const Fe=we.programConfigurations.get(b.id),Ve=_.context.program.get(),Le=_.useProgram(se,Fe),Ye=Te||Le.program!==Ve,Tt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(ve),Yt=H.constantOr(null);if(Yt&&xe.imageAtlas){const xt=xe.imageAtlas,nr=xt.patternPositions[Yt.to.toString()],Hr=xt.patternPositions[Yt.from.toString()];nr&&Hr&&Fe.setConstantPatternPositions(nr,Hr)}const ir=ge.getProjectionData({overscaledTileID:ve,applyGlobeMatrix:!k,applyTerrainMatrix:!0}),er=ge.getPixelScale(),Mr=J?ph(_,xe,b,er,Q):G?js(_,xe,b,er,G,Q):ie?dh(_,xe,b,er,we.lineClipsArray.length):nl(_,xe,b,er);if(J)ue.activeTexture.set(ee.TEXTURE0),xe.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Fe.updatePaintBuffers(Q);else if(G&&(Ye||_.lineAtlas.dirty))ue.activeTexture.set(ee.TEXTURE0),_.lineAtlas.bind(ue);else if(ie){const xt=we.gradients[b.id];let nr=xt.texture;if(b.gradientVersion!==xt.version){let Hr=256;if(b.stepInterpolant){const ti=x.getSource().maxzoom,li=ve.canonical.z===ti?Math.ceil(1<<_.transform.maxZoom-ve.canonical.z):1;Hr=o.ah(o.c3(we.maxLineLength/o.$*1024*li),256,ue.maxTextureSize)}xt.gradient=o.c4({expression:b.gradientExpression(),evaluationKey:"lineProgress",resolution:Hr,image:xt.gradient||void 0,clips:we.lineClipsArray}),xt.texture?xt.texture.update(xt.gradient):xt.texture=new o.T(ue,xt.gradient,ee.RGBA),xt.version=b.gradientVersion,nr=xt.texture}ue.activeTexture.set(ee.TEXTURE0),nr.bind(b.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}const Rr=_.stencilModeForClipping(ve);Le.draw(ue,ee.TRIANGLES,O,Rr,W,ct.disabled,Mr,Tt,ir,b.id,we.layoutVertexBuffer,we.indexBuffer,we.segments,b.paint,_.transform.zoom,Fe,we.layoutVertexBuffer2),Te=!1}})(e,n,a,c,p):o.cf(a)?(function(_,x,b,P,I){const k=b.paint.get("fill-color"),A=b.paint.get("fill-opacity");if(A.constantOr(1)===0)return;const{isRenderingToTexture:R}=I,O=_.colorModeForRenderPass(),W=b.paint.get("fill-pattern"),G=_.opaquePassEnabledForLayer()&&!W.constantOr(1)&&k.constantOr(o.bf.transparent).a===1&&A.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===G){const H=_.getDepthModeForSublayer(1,_.renderPass==="opaque"?vt.ReadWrite:vt.ReadOnly);pl(_,x,b,P,H,O,!1,R)}if(_.renderPass==="translucent"&&b.paint.get("fill-antialias")){const H=_.getDepthModeForSublayer(b.getPaintProperty("fill-outline-color")?2:0,vt.ReadOnly);pl(_,x,b,P,H,O,!0,R)}})(e,n,a,c,p):o.cg(a)?(function(_,x,b,P,I){const k=b.paint.get("fill-extrusion-opacity");if(k===0)return;const{isRenderingToTexture:A}=I;if(_.renderPass==="translucent"){const R=new vt(_.context.gl.LEQUAL,vt.ReadWrite,_.depthRangeFor3D);if(k!==1||b.paint.get("fill-extrusion-pattern").constantOr(1))Uc(_,x,b,P,R,$t.disabled,_r.disabled,A),Uc(_,x,b,P,R,_.stencilModeFor3D(),_.colorModeForRenderPass(),A);else{const O=_.colorModeForRenderPass();Uc(_,x,b,P,R,$t.disabled,O,A)}}})(e,n,a,c,p):o.ch(a)?(function(_,x,b,P,I){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const{isRenderingToTexture:k}=I,A=_.context,R=_.style.projection.useSubdivision,O=_.getDepthModeForSublayer(0,vt.ReadOnly),W=_.colorModeForRenderPass();if(_.renderPass==="offscreen")(function(G,H,J,ie,Q,se,ue){const ee=G.context,ge=ee.gl;for(const Te of J){const ve=H.getTile(Te),xe=ve.dem;if(!xe||!xe.data||!ve.needsHillshadePrepare)continue;const we=xe.dim,Fe=xe.stride,Ve=xe.getPixels();if(ee.activeTexture.set(ge.TEXTURE1),ee.pixelStoreUnpackPremultiplyAlpha.set(!1),ve.demTexture=ve.demTexture||G.getTileTexture(Fe),ve.demTexture){const Ye=ve.demTexture;Ye.update(Ve,{premultiply:!1}),Ye.bind(ge.NEAREST,ge.CLAMP_TO_EDGE)}else ve.demTexture=new o.T(ee,Ve,ge.RGBA,{premultiply:!1}),ve.demTexture.bind(ge.NEAREST,ge.CLAMP_TO_EDGE);ee.activeTexture.set(ge.TEXTURE0);let Le=ve.fbo;if(!Le){const Ye=new o.T(ee,{width:we,height:we,data:null},ge.RGBA);Ye.bind(ge.LINEAR,ge.CLAMP_TO_EDGE),Le=ve.fbo=ee.createFramebuffer(we,we,!0,!1),Le.colorAttachment.set(Ye.texture)}ee.bindFramebuffer.set(Le.framebuffer),ee.viewport.set([0,0,we,we]),G.useProgram("hillshadePrepare").draw(ee,ge.TRIANGLES,Q,se,ue,ct.disabled,uh(ve.tileID,xe),null,null,ie.id,G.rasterBoundsBuffer,G.quadTriangleIndexBuffer,G.rasterBoundsSegments),ve.needsHillshadePrepare=!1}})(_,x,P,b,O,$t.disabled,W),A.viewport.set([0,0,_.width,_.height]);else if(_.renderPass==="translucent")if(R){const[G,H,J]=_.stencilConfigForOverlapTwoPass(P);$s(_,x,b,J,G,O,W,!1,k),$s(_,x,b,J,H,O,W,!0,k)}else{const[G,H]=_.getStencilConfigForOverlapAndUpdateStencilID(P);$s(_,x,b,H,G,O,W,!1,k)}})(e,n,a,c,p):o.ci(a)?(function(_,x,b,P,I){if(_.renderPass!=="translucent"||!P.length)return;const{isRenderingToTexture:k}=I,A=_.style.projection.useSubdivision,R=_.getDepthModeForSublayer(0,vt.ReadOnly),O=_.colorModeForRenderPass();if(A){const[W,G,H]=_.stencilConfigForOverlapTwoPass(P);$c(_,x,b,H,W,R,O,!1,k),$c(_,x,b,H,G,R,O,!0,k)}else{const[W,G]=_.getStencilConfigForOverlapAndUpdateStencilID(P);$c(_,x,b,G,W,R,O,!1,k)}})(e,n,a,c,p):o.cj(a)?(function(_,x,b,P,I){if(_.renderPass!=="translucent"||b.paint.get("raster-opacity")===0||!P.length)return;const{isRenderingToTexture:k}=I,A=x.getSource(),R=_.style.projection.useSubdivision;if(A instanceof pr)Zs(_,x,b,P,null,!1,!1,A.tileCoords,A.flippedWindingOrder,k);else if(R){const[O,W,G]=_.stencilConfigForOverlapTwoPass(P);Zs(_,x,b,G,O,!1,!0,fl,!1,k),Zs(_,x,b,G,W,!0,!0,fl,!1,k)}else{const[O,W]=_.getStencilConfigForOverlapAndUpdateStencilID(P);Zs(_,x,b,W,O,!1,!0,fl,!1,k)}})(e,n,a,c,p):o.ck(a)?(function(_,x,b,P,I){const k=b.paint.get("background-color"),A=b.paint.get("background-opacity");if(A===0)return;const{isRenderingToTexture:R}=I,O=_.context,W=O.gl,G=_.style.projection,H=_.transform,J=H.tileSize,ie=b.paint.get("background-pattern");if(_.isPatternMissing(ie))return;const Q=!ie&&k.a===1&&A===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==Q)return;const se=$t.disabled,ue=_.getDepthModeForSublayer(0,Q==="opaque"?vt.ReadWrite:vt.ReadOnly),ee=_.colorModeForRenderPass(),ge=_.useProgram(ie?"backgroundPattern":"background"),Te=P||_e(H,{tileSize:J,terrain:_.style.map.terrain});ie&&(O.activeTexture.set(W.TEXTURE0),_.imageManager.bind(_.context));const ve=b.getCrossfadeParameters();for(const xe of Te){const we=H.getProjectionData({overscaledTileID:xe,applyGlobeMatrix:!R,applyTerrainMatrix:!0}),Fe=ie?gh(A,_,ie,{tileID:xe,tileSize:J},ve):mh(A,k),Ve=_.style.map.terrain&&_.style.map.terrain.getTerrainData(xe),Le=G.getMeshFromTileID(O,xe.canonical,!1,!0,"raster");ge.draw(O,W.TRIANGLES,ue,se,ee,ct.backCCW,Fe,Ve,we,b.id,Le.vertexBuffer,Le.indexBuffer,Le.segments)}})(e,0,a,c,p):o.cl(a)&&(function(_,x,b,P){const{isRenderingGlobe:I}=P,k=_.context,A=b.implementation,R=_.style.projection,O=_.transform,W=O.getProjectionDataForCustomLayer(I),G={farZ:O.farZ,nearZ:O.nearZ,fov:O.fov*Math.PI/180,modelViewProjectionMatrix:O.modelViewProjectionMatrix,projectionMatrix:O.projectionMatrix,shaderData:{variantName:R.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${R.shaderPreludeCode.vertexSource}`,define:R.shaderDefine},defaultProjectionData:W},H=A.renderingMode?A.renderingMode:"2d";if(_.renderPass==="offscreen"){const J=A.prerender;J&&(_.setCustomLayerDefaults(),k.setColorMode(_.colorModeForRenderPass()),J.call(A,k.gl,G),k.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),k.setColorMode(_.colorModeForRenderPass()),k.setStencilMode($t.disabled);const J=H==="3d"?_.getDepthModeFor3D():_.getDepthModeForSublayer(0,vt.ReadOnly);k.setDepthMode(J),A.render(k.gl,G),k.setDirty(),_.setBaseState(),k.bindFramebuffer.set(null)}})(e,0,a,p))}saveTileTexture(e){const n=this._tileTextures[e.size[0]];n?n.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const n=this.imageManager.getPattern(e.from.toString()),a=this.imageManager.getPattern(e.to.toString());return!n||!a}useProgram(e,n,a=!1,c=[]){this.cache=this.cache||{};const p=!!this.style.map.terrain,_=this.style.projection,x=a?on.projectionMercator:_.shaderPreludeCode,b=a?Vn:_.shaderDefine,P=e+(n?n.cacheKey:"")+`/${a?Ds:_.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(p?"/terrain":"")+(c?`/${c.join("/")}`:"");return this.cache[P]||(this.cache[P]=new Mc(this.context,on[e],n,zc[e],this._showOverdrawInspector,p,x,b,c)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:n}=this.context.gl;return this.width!==e||this.height!==n}}function Gs(h,e){let n,a=!1,c=null,p=null;const _=()=>{c=null,a&&(h.apply(p,n),c=setTimeout(_,e),a=!1)};return(...x)=>(a=!0,p=this,n=x,c||_(),c)}class _l{constructor(e){this._getCurrentHash=()=>{const n=window.location.hash.replace("#","");if(this._hashName){let a;return n.split("&").map((c=>c.split("="))).forEach((c=>{c[0]===this._hashName&&(a=c)})),(a&&a[1]||"").split("/")}return n.split("/")},this._onHashChange=()=>{const n=this._getCurrentHash();if(!this._isValidHash(n))return!1;const a=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:a,pitch:+(n[4]||0)}),!0},this._updateHashUnthrottled=()=>{const n=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,n)},this._removeHash=()=>{const n=this._getCurrentHash();if(n.length===0)return;const a=n.join("/");let c=a;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${a}`);let p=window.location.hash.replace(c,"");p.startsWith("#&")?p=p.slice(0,1)+p.slice(2):p==="#"&&(p="");let _=window.location.href.replace(/(#.+)?$/,p);_=_.replace("&&","&"),window.history.replaceState(window.history.state,null,_)},this._updateHash=Gs(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const n=this._map.getCenter(),a=Math.round(100*this._map.getZoom())/100,c=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),p=Math.pow(10,c),_=Math.round(n.lng*p)/p,x=Math.round(n.lat*p)/p,b=this._map.getBearing(),P=this._map.getPitch();let I="";if(I+=e?`/${_}/${x}/${a}`:`${a}/${x}/${_}`,(b||P)&&(I+="/"+Math.round(10*b)/10),P&&(I+=`/${Math.round(P)}`),this._hashName){const k=this._hashName;let A=!1;const R=window.location.hash.slice(1).split("&").map((O=>{const W=O.split("=")[0];return W===k?(A=!0,`${W}=${I}`):O})).filter((O=>O));return A||R.push(`${k}=${I}`),`#${R.join("&")}`}return`#${I}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new o.S(+e[2],+e[1])}catch{return!1}const n=+e[0],a=+(e[3]||0),c=+(e[4]||0);return n>=this._map.getMinZoom()&&n<=this._map.getMaxZoom()&&a>=-180&&a<=180&&c>=this._map.getMinPitch()&&c<=this._map.getMaxPitch()}}const Zn={linearity:.3,easing:o.cm(0,0,.3,1)},Wc=o.e({deceleration:2500,maxSpeed:1400},Zn),zh=o.e({deceleration:20,maxSpeed:1400},Zn),Dh=o.e({deceleration:1e3,maxSpeed:360},Zn),Rh=o.e({deceleration:1e3,maxSpeed:90},Zn),Lh=o.e({deceleration:1e3,maxSpeed:360},Zn);class Bh{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:he.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=he.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,roll:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:p}of this._inertiaBuffer)n.zoom+=p.zoomDelta||0,n.bearing+=p.bearingDelta||0,n.pitch+=p.pitchDelta||0,n.roll+=p.rollDelta||0,p.panDelta&&n.pan._add(p.panDelta),p.around&&(n.around=p.around),p.pinchAround&&(n.pinchAround=p.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(n.pan.mag()){const p=ya(n.pan.mag(),a,o.e({},Wc,e||{})),_=n.pan.mult(p.amount/n.pan.mag()),x=this._map.cameraHelper.handlePanInertia(_,this._map.transform);c.center=x.easingCenter,c.offset=x.easingOffset,un(c,p)}if(n.zoom){const p=ya(n.zoom,a,zh);c.zoom=this._map.transform.zoom+p.amount,un(c,p)}if(n.bearing){const p=ya(n.bearing,a,Dh);c.bearing=this._map.transform.bearing+o.ah(p.amount,-179,179),un(c,p)}if(n.pitch){const p=ya(n.pitch,a,Rh);c.pitch=this._map.transform.pitch+p.amount,un(c,p)}if(n.roll){const p=ya(n.roll,a,Lh);c.roll=this._map.transform.roll+o.ah(p.amount,-179,179),un(c,p)}if(c.zoom||c.bearing){const p=n.pinchAround===void 0?n.around:n.pinchAround;c.around=p?this._map.unproject(p):this._map.getCenter()}return this.clear(),o.e(c,{noMoveStart:!0})}}function un(h,e){(!h.duration||h.duration<e.duration)&&(h.duration=e.duration,h.easing=e.easing)}function ya(h,e,n){const{maxSpeed:a,linearity:c,deceleration:p}=n,_=o.ah(h*c/(e/1e3),-a,a),x=Math.abs(_)/(p*c);return{easing:n.easing,duration:1e3*x,amount:_*(x/2)}}class Li extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a,c={}){a=a instanceof MouseEvent?a:new MouseEvent(e,a);const p=q.mousePos(n.getCanvas(),a),_=n.unproject(p);super(e,o.e({point:p,lngLat:_,originalEvent:a},c)),this._defaultPrevented=!1,this.target=n}}class va extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){const c=e==="touchend"?a.changedTouches:a.touches,p=q.touchPos(n.getCanvasContainer(),c),_=p.map((b=>n.unproject(b))),x=p.reduce(((b,P,I,k)=>b.add(P.div(k.length))),new o.P(0,0));super(e,{points:p,point:x,lngLats:_,lngLat:n.unproject(x),originalEvent:a}),this._defaultPrevented=!1}}class Hc extends o.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,a){super(e,{originalEvent:a}),this._defaultPrevented=!1}}class Fh{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Hc(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new Li(e.type,this._map,e))}mouseup(e){this._map.fire(new Li(e.type,this._map,e))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||this._map.fire(new Li(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Li(e.type,this._map,e))}mouseover(e){this._map.fire(new Li(e.type,this._map,e))}mouseout(e){this._map.fire(new Li(e.type,this._map,e))}touchstart(e){return this._firePreventable(new va(e.type,this._map,e))}touchmove(e){this._map.fire(new va(e.type,this._map,e))}touchend(e){this._map.fire(new va(e.type,this._map,e))}touchcancel(e){this._map.fire(new va(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oh{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Li(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Li("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Li(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xa{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(o.P.convert(e),this._map.terrain)}}class Xc{constructor(e,n){this._map=e,this._tr=new xa(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(q.disableDrag(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;const a=n;if(this._lastPos.equals(a)||!this._box&&a.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=a,this._box||(this._box=q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const p=Math.min(c.x,a.x),_=Math.max(c.x,a.x),x=Math.min(c.y,a.y),b=Math.max(c.y,a.y);q.setTransform(this._box,`translate(${p}px,${x}px)`),this._box.style.width=_-p+"px",this._box.style.height=b-x+"px"}mouseupWindow(e,n){if(!this._active||e.button!==0)return;const a=this._startPos,c=n;if(this.reset(),q.suppressClick(),a.x!==c.x||a.y!==c.y)return this._map.fire(new o.l("boxzoomend",{originalEvent:e})),{cameraAnimation:p=>p.fitScreenCoordinates(a,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new o.l(e,{originalEvent:n}))}}function ba(h,e){if(h.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${e.length}`);const n={};for(let a=0;a<h.length;a++)n[h[a].identifier]=e[a];return n}class jh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,n,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),a.length===this.numTouches&&(this.centroid=(function(c){const p=new o.P(0,0);for(const _ of c)p._add(_);return p.div(c.length)})(n),this.touches=ba(a,n)))}touchmove(e,n,a){if(this.aborted||!this.centroid)return;const c=ba(a,n);for(const p in this.touches){const _=c[p];(!_||_.dist(this.touches[p])>30)&&(this.aborted=!0)}}touchend(e,n,a){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),a.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class Bi{constructor(e){this.singleTap=new jh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,n,a){this.singleTap.touchstart(e,n,a)}touchmove(e,n,a){this.singleTap.touchmove(e,n,a)}touchend(e,n,a){const c=this.singleTap.touchend(e,n,a);if(c){const p=e.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(c)<30;if(p&&_||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class hn{constructor(e){this._tr=new xa(e),this._zoomIn=new Bi({numTouches:1,numTaps:2}),this._zoomOut=new Bi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,a){this._zoomIn.touchstart(e,n,a),this._zoomOut.touchstart(e,n,a)}touchmove(e,n,a){this._zoomIn.touchmove(e,n,a),this._zoomOut.touchmove(e,n,a)}touchend(e,n,a){const c=this._zoomIn.touchend(e,n,a),p=this._zoomOut.touchend(e,n,a),_=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:_.zoom+1,around:_.unproject(c)},{originalEvent:e})}):p?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:_.zoom-1,around:_.unproject(p)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wa{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const n=this._moveFunction(...e);if(n.bearingDelta||n.pitchDelta||n.rollDelta||n.around||n.panDelta)return this._active=!0,n}dragStart(e,n){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(n)?n[0]:n,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,n){if(!this.isEnabled())return;const a=this._lastPoint;if(!a)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=Array.isArray(n)?n[0]:n;return!this._moved&&c.dist(a)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(a,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&q.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const dn=0,Ta=2,mp={[dn]:1,[Ta]:2};class yo{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const n=q.mouseButton(e);this._eventButton=n}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(n,a){const c=mp[a];return n.buttons===void 0||(n.buttons&c)!==c})(e,this._eventButton)}isValidEndEvent(e){return q.mouseButton(e)===this._eventButton}}class gp{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class _p{constructor(e=new yo({checkCorrectEvent:()=>!0}),n=new gp){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=n}_executeRelevantHandler(e,n,a){return e instanceof MouseEvent?n(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?a(e):void 0}startMove(e){this._executeRelevantHandler(e,(n=>this.mouseMoveStateManager.startMove(n)),(n=>this.oneFingerTouchMoveStateManager.startMove(n)))}endMove(e){this._executeRelevantHandler(e,(n=>this.mouseMoveStateManager.endMove(n)),(n=>this.oneFingerTouchMoveStateManager.endMove(n)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(n=>this.mouseMoveStateManager.isValidStartEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidStartEvent(n)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(n=>this.mouseMoveStateManager.isValidMoveEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(n)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(n=>this.mouseMoveStateManager.isValidEndEvent(n)),(n=>this.oneFingerTouchMoveStateManager.isValidEndEvent(n)))}}const vo=h=>{h.mousedown=h.dragStart,h.mousemoveWindow=h.dragMove,h.mouseup=h.dragEnd,h.contextmenu=e=>{e.preventDefault()}};class xo{constructor(e,n){this._clickTolerance=e.clickTolerance||1,this._map=n,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,n,a){return this._calculateTransform(e,n,a)}touchmove(e,n,a){if(this._active){if(!this._shouldBePrevented(a.length))return e.preventDefault(),this._calculateTransform(e,n,a);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,n,a){this._calculateTransform(e,n,a),this._active&&this._shouldBePrevented(a.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,a){a.length>0&&(this._active=!0);const c=ba(a,n),p=new o.P(0,0),_=new o.P(0,0);let x=0;for(const P in c){const I=c[P],k=this._touches[P];k&&(p._add(I),_._add(I.sub(k)),x++,c[P]=I)}if(this._touches=c,this._shouldBePrevented(x)||!_.mag())return;const b=_.div(x);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:p.div(x),panDelta:b}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pn{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,n,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,a){if(!this._firstTwoTouches)return;e.preventDefault();const[c,p]=this._firstTwoTouches,_=He(a,n,c),x=He(a,n,p);if(!_||!x)return;const b=this._aroundCenter?null:_.add(x).div(2);return this._move([_,x],b,e)}touchend(e,n,a){if(!this._firstTwoTouches)return;const[c,p]=this._firstTwoTouches,_=He(a,n,c),x=He(a,n,p);_&&x||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function He(h,e,n){for(let a=0;a<h.length;a++)if(h[a].identifier===n)return e[a]}function Kc(h,e){return Math.log(h/e)/Math.LN2}class yl extends pn{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){const a=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Kc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kc(this._distance,a),pinchAround:n}}}function Yc(h,e){return 180*h.angleWith(e)/Math.PI}class Sa extends pn{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n,a){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Yc(this._vector,c),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const n=25/(Math.PI*this._minDiameter)*360,a=Yc(e,this._startVector);return Math.abs(a)<n}}function qs(h){return Math.abs(h.y)>Math.abs(h.x)}class vl extends pn{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,n,a){super.touchstart(e,n,a),this._currentTouchCount=a.length}_start(e){this._lastPoints=e,qs(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,a){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),p=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,p,a.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+p.y)/2*-.5}):void 0}gestureBeginsVertically(e,n,a){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,p=n.mag()>=2;if(!c&&!p)return;if(!c||!p)return this._firstMove===void 0&&(this._firstMove=a),a-this._firstMove<100&&void 0;const _=e.y>0==n.y>0;return qs(e)&&qs(n)&&_}}const Lt={panStep:100,bearingStep:15,pitchStep:10};class xl{constructor(e){this._tr=new xa(e);const n=Lt;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,a=0,c=0,p=0,_=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?a=-1:(e.preventDefault(),p=-1);break;case 39:e.shiftKey?a=1:(e.preventDefault(),p=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),_=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(a=0,c=0),{cameraAnimation:x=>{const b=this._tr;x.easeTo({duration:300,easeId:"keyboardHandler",easing:yp,zoom:n?Math.round(b.zoom)+n*(e.shiftKey?2:1):b.zoom,bearing:b.bearing+a*this._bearingStep,pitch:b.pitch+c*this._pitchStep,offset:[-p*this._panStep,-_*this._panStep],center:b.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function yp(h){return h*(2-h)}const bl=4.000244140625,vp=1/450;class Nh{constructor(e,n){this._onTimeout=a=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(a)},this._map=e,this._tr=new xa(e),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=vp}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let n=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const a=he.now(),c=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,n!==0&&n%bl==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=q.mousePos(this._map.getCanvas(),e),a=this._tr;this._aroundPoint=this._aroundCenter?a.transform.locationToScreenPoint(o.S.convert(a.center)):n,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const x=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=x),typeof this._targetZoom=="number"&&(this._targetZoom+=x)}if(this._delta!==0){const x=this._type==="wheel"&&Math.abs(this._delta)>bl?this._wheelZoomRate:this._defaultZoomRate;let b=2/(1+Math.exp(-Math.abs(this._delta*x)));this._delta<0&&b!==0&&(b=1/b);const P=typeof this._targetZoom!="number"?e.scale:o.af(this._targetZoom);this._targetZoom=e.getConstrained(e.getCameraLngLat(),o.ak(P*b)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const n=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,a=this._startZoom,c=this._easing;let p,_=!1;if(this._type==="wheel"&&a&&c){const x=he.now()-this._lastWheelEventTime,b=Math.min((x+5)/200,1),P=c(b);p=o.C.number(a,n,P),b<1?this._frameId||(this._frameId=!0):_=!0}else p=n,_=!0;return this._active=!0,_&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=p,{noInertia:!0,needsRenderFrame:!_,zoomDelta:p-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=o.co;if(this._prevEase){const a=this._prevEase,c=(he.now()-a.start)/a.duration,p=a.easing(c+.01)-a.easing(c),_=.27/Math.sqrt(p*p+1e-4)*.01,x=Math.sqrt(.0729-_*_);n=o.cm(_,x,.25,1)}return this._prevEase={start:he.now(),duration:e,easing:n},n}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Jc{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Qc{constructor(e){this._tr=new xa(e),this.reset()}reset(){this._active=!1}dblclick(e,n){return e.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vh{constructor(){this._tap=new Bi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,n,a){if(!this._swipePoint)if(this._tapTime){const c=n[0],p=e.timeStamp-this._tapTime<500,_=this._tapPoint.dist(c)<30;p&&_?a.length>0&&(this._swipePoint=c,this._swipeTouch=a[0].identifier):this.reset()}else this._tap.touchstart(e,n,a)}touchmove(e,n,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const c=n[0],p=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:p/128}}}else this._tap.touchmove(e,n,a)}touchend(e,n,a){if(this._tapTime)this._swipePoint&&a.length===0&&this.reset();else{const c=this._tap.touchend(e,n,a);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uh{constructor(e,n,a){this._el=e,this._mousePan=n,this._touchPan=a}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class eu{constructor(e,n,a,c){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=n,this._mousePitch=a,this._mouseRoll=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class $h{constructor(e,n,a,c){this._el=e,this._touchZoom=n,this._touchRotate=a,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Zh{constructor(e,n){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=n,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=q.create("div","maplibregl-cooperative-gesture-screen",e);let n=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(n=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const a=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=n,this._container.appendChild(c);const p=document.createElement("div");p.className="maplibregl-mobile-message",p.textContent=a,this._container.appendChild(p),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,n){this._enabled&&(this._map.fire(new o.l("cooperativegestureprevented",{gestureType:e,originalEvent:n})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const fn=h=>h.zoom||h.drag||h.roll||h.pitch||h.rotate;class wr extends o.l{}function Pa(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta||h.rollDelta}class tu{constructor(e,n){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,p)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const _=c.type==="renderFrame"?void 0:c,x={needsRenderFrame:!1},b={},P={};for(const{handlerName:A,handler:R,allowed:O}of this._handlers){if(!R.isEnabled())continue;let W;if(this._blockedByActive(P,O,A))R.reset();else if(R[p||c.type]){if(o.cp(c,p||c.type)){const G=q.mousePos(this._map.getCanvas(),c);W=R[p||c.type](c,G)}else if(o.cq(c,p||c.type)){const G=this._getMapTouches(c.touches),H=q.touchPos(this._map.getCanvas(),G);W=R[p||c.type](c,H,G)}else o.cr(p||c.type)||(W=R[p||c.type](c));this.mergeHandlerResult(x,b,W,A,_),W&&W.needsRenderFrame&&this._triggerRenderFrame()}(W||R.isActive())&&(P[A]=R)}const I={};for(const A in this._previousActiveHandlers)P[A]||(I[A]=_);this._previousActiveHandlers=P,(Object.keys(I).length||Pa(x))&&(this._changes.push([x,b,I]),this._triggerRenderFrame()),(Object.keys(P).length||Pa(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=x;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Bh(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,p,_]of this._listeners)q.addEventListener(c,p,c===document?this.handleWindowEvent:this.handleEvent,_)}destroy(){for(const[e,n,a]of this._listeners)q.removeEventListener(e,n,e===document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(e){const n=this._map,a=n.getCanvasContainer();this._add("mapEvent",new Fh(n,e));const c=n.boxZoom=new Xc(n,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const p=n.cooperativeGestures=new Zh(n,e.cooperativeGestures);this._add("cooperativeGestures",p),e.cooperativeGestures&&p.enable();const _=new hn(n),x=new Qc(n);n.doubleClickZoom=new Jc(x,_),this._add("tapZoom",_),this._add("clickZoom",x),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();const b=new Vh;this._add("tapDragZoom",b);const P=n.touchPitch=new vl(n);this._add("touchPitch",P),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);const I=()=>n.project(n.getCenter()),k=(function({enable:Q,clickTolerance:se,aroundCenter:ue=!0,minPixelCenterThreshold:ee=100,rotateDegreesPerPixelMoved:ge=.8},Te){const ve=new yo({checkCorrectEvent:xe=>q.mouseButton(xe)===0&&xe.ctrlKey||q.mouseButton(xe)===2&&!xe.ctrlKey});return new wa({clickTolerance:se,move:(xe,we)=>{const Fe=Te();if(ue&&Math.abs(Fe.y-xe.y)>ee)return{bearingDelta:o.cn(new o.P(xe.x,we.y),we,Fe)};let Ve=(we.x-xe.x)*ge;return ue&&we.y<Fe.y&&(Ve=-Ve),{bearingDelta:Ve}},moveStateManager:ve,enable:Q,assignEvents:vo})})(e,I),A=(function({enable:Q,clickTolerance:se,pitchDegreesPerPixelMoved:ue=-.5}){const ee=new yo({checkCorrectEvent:ge=>q.mouseButton(ge)===0&&ge.ctrlKey||q.mouseButton(ge)===2});return new wa({clickTolerance:se,move:(ge,Te)=>({pitchDelta:(Te.y-ge.y)*ue}),moveStateManager:ee,enable:Q,assignEvents:vo})})(e),R=(function({enable:Q,clickTolerance:se,rollDegreesPerPixelMoved:ue=.3},ee){const ge=new yo({checkCorrectEvent:Te=>q.mouseButton(Te)===2&&Te.ctrlKey});return new wa({clickTolerance:se,move:(Te,ve)=>{const xe=ee();let we=(ve.x-Te.x)*ue;return ve.y<xe.y&&(we=-we),{rollDelta:we}},moveStateManager:ge,enable:Q,assignEvents:vo})})(e,I);n.dragRotate=new eu(e,k,A,R),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",A,["mouseRotate","mouseRoll"]),this._add("mouseRoll",R,["mousePitch"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();const O=(function({enable:Q,clickTolerance:se}){const ue=new yo({checkCorrectEvent:ee=>q.mouseButton(ee)===0&&!ee.ctrlKey});return new wa({clickTolerance:se,move:(ee,ge)=>({around:ge,panDelta:ge.sub(ee)}),activateOnStart:!0,moveStateManager:ue,enable:Q,assignEvents:vo})})(e),W=new xo(e,n);n.dragPan=new Uh(a,O,W),this._add("mousePan",O),this._add("touchPan",W,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);const G=new Sa,H=new yl;n.touchZoomRotate=new $h(a,H,G,b),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",H,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);const J=n.scrollZoom=new Nh(n,(()=>this._triggerRenderFrame()));this._add("scrollZoom",J,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);const ie=n.keyboard=new xl(n);this._add("keyboard",ie),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new Oh(n))}_add(e,n,a){this._handlers.push({handlerName:e,handler:n,allowed:a}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,n,a){for(const c in e)if(c!==a&&(!n||n.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const n=[];for(const a of e)this._el.contains(a.target)&&n.push(a);return n}mergeHandlerResult(e,n,a,c,p){if(!a)return;o.e(e,a);const _={handlerName:c,originalEvent:a.originalEvent||p};a.zoomDelta!==void 0&&(n.zoom=_),a.panDelta!==void 0&&(n.drag=_),a.rollDelta!==void 0&&(n.roll=_),a.pitchDelta!==void 0&&(n.pitch=_),a.bearingDelta!==void 0&&(n.rotate=_)}_applyChanges(){const e={},n={},a={};for(const[c,p,_]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new o.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.rollDelta&&(e.rollDelta=(e.rollDelta||0)+c.rollDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),o.e(n,p),o.e(a,_);this._updateMapTransform(e,n,a),this._changes=[]}_updateMapTransform(e,n,a){const c=this._map,p=c._getTransformForUpdate(),_=c.terrain;if(!(Pa(e)||_&&this._terrainMovement))return this._fireEvents(n,a,!0);c._stop(!0);let{panDelta:x,zoomDelta:b,bearingDelta:P,pitchDelta:I,rollDelta:k,around:A,pinchAround:R}=e;R!==void 0&&(A=R),A=A||c.transform.centerPoint,_&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);const O={panDelta:x,zoomDelta:b,rollDelta:k,pitchDelta:I,bearingDelta:P,around:A};this._map.cameraHelper.useGlobeControls&&!p.isPointOnMapSurface(A)&&(A=p.centerPoint);const W=A.distSqr(p.centerPoint)<.01?p.center:p.screenPointToLocation(x?A.sub(x):A);_?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(O,p),this._terrainMovement||!n.drag&&!n.zoom?n.drag&&this._terrainMovement?p.setCenter(p.screenPointToLocation(p.centerPoint.sub(x))):this._map.cameraHelper.handleMapControlsPan(O,p,W):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(O,p,W))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(O,p),this._map.cameraHelper.handleMapControlsPan(O,p,W)),c._applyUpdatedTransform(p),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,a,!0)}_fireEvents(e,n,a){const c=fn(this._eventsInProgress),p=fn(e),_={};for(const k in e){const{originalEvent:A}=e[k];this._eventsInProgress[k]||(_[`${k}start`]=A),this._eventsInProgress[k]=e[k]}!c&&p&&this._fireEvent("movestart",p.originalEvent);for(const k in _)this._fireEvent(k,_[k]);p&&this._fireEvent("move",p.originalEvent);for(const k in e){const{originalEvent:A}=e[k];this._fireEvent(k,A)}const x={};let b;for(const k in this._eventsInProgress){const{handlerName:A,originalEvent:R}=this._eventsInProgress[k];this._handlersById[A].isActive()||(delete this._eventsInProgress[k],b=n[A]||R,x[`${k}end`]=b)}for(const k in x)this._fireEvent(k,x[k]);const P=fn(this._eventsInProgress),I=(c||p)&&!P;if(I&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const k=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&k.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(k)}if(a&&I){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),A=R=>R!==0&&-this._bearingSnap<R&&R<this._bearingSnap;!k||!k.essential&&he.prefersReducedMotion?(this._map.fire(new o.l("moveend",{originalEvent:b})),A(this._map.getBearing())&&this._map.resetNorth()):(A(k.bearing||this._map.getBearing())&&(k.bearing=0),k.freezeElevation=!0,this._map.easeTo(k,{originalEvent:b})),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new o.l(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new wr("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Gh extends o.E{constructor(e,n,a){super(),this._renderFrameCallback=()=>{const c=Math.min((he.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=a.bearingSnap,this.cameraHelper=n,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,n){e.apply(this.transform),this.transform=e,this.cameraHelper=n}getCenter(){return new o.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,n){return this.jumpTo({elevation:e},n),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,n,a){return e=o.P.convert(e).mult(-1),this.panTo(this.transform.center,o.e({offset:e},n),a)}panTo(e,n,a){return this.easeTo(o.e({center:e},n),a)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,a){return this.easeTo(o.e({zoom:e},n),a)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,n){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new o.l("movestart",n)).fire(new o.l("move",n)).fire(new o.l("moveend",n))),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,a){return this.easeTo(o.e({bearing:e},n),a)}resetNorth(e,n){return this.rotateTo(0,o.e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(o.e({bearing:0,pitch:0,roll:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}getRoll(){return this.transform.roll}setRoll(e,n){return this.jumpTo({roll:e},n),this}cameraForBounds(e,n){e=yt.convert(e).adjustAntiMeridian();const a=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),a,n)}_cameraForBoxAndBearing(e,n,a,c){const p={top:0,bottom:0,right:0,left:0};if(typeof(c=o.e({padding:p,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const P=c.padding;c.padding={top:P,bottom:P,right:P,left:P}}const _=o.e(p,c.padding);c.padding=_;const x=this.transform,b=new yt(e,n);return this.cameraHelper.cameraForBoxAndBearing(c,_,b,a,x)}fitBounds(e,n,a){return this._fitInternal(this.cameraForBounds(e,n),n,a)}fitScreenCoordinates(e,n,a,c,p){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(o.P.convert(e)),this.transform.screenPointToLocation(o.P.convert(n)),a,c),c,p)}_fitInternal(e,n,a){return e?(delete(n=o.e(e,n)).padding,n.linear?this.easeTo(n,a):this.flyTo(n,a)):this}jumpTo(e,n){this.stop();const a=this._getTransformForUpdate();let c=!1,p=!1,_=!1;const x=a.zoom;this.cameraHelper.handleJumpToCenterZoom(a,e);const b=a.zoom!==x;return"elevation"in e&&a.elevation!==+e.elevation&&a.setElevation(+e.elevation),"bearing"in e&&a.bearing!==+e.bearing&&(c=!0,a.setBearing(+e.bearing)),"pitch"in e&&a.pitch!==+e.pitch&&(p=!0,a.setPitch(+e.pitch)),"roll"in e&&a.roll!==+e.roll&&(_=!0,a.setRoll(+e.roll)),e.padding==null||a.isPaddingEqual(e.padding)||a.setPadding(e.padding),this._applyUpdatedTransform(a),this.fire(new o.l("movestart",n)).fire(new o.l("move",n)),b&&this.fire(new o.l("zoomstart",n)).fire(new o.l("zoom",n)).fire(new o.l("zoomend",n)),c&&this.fire(new o.l("rotatestart",n)).fire(new o.l("rotate",n)).fire(new o.l("rotateend",n)),p&&this.fire(new o.l("pitchstart",n)).fire(new o.l("pitch",n)).fire(new o.l("pitchend",n)),_&&this.fire(new o.l("rollstart",n)).fire(new o.l("roll",n)).fire(new o.l("rollend",n)),this.fire(new o.l("moveend",n))}calculateCameraOptionsFromTo(e,n,a,c=0){const p=o.a1.fromLngLat(e,n),_=o.a1.fromLngLat(a,c),x=_.x-p.x,b=_.y-p.y,P=_.z-p.z,I=Math.hypot(x,b,P);if(I===0)throw new Error("Can't calculate camera options with same From and To");const k=Math.hypot(x,b),A=o.ak(this.transform.cameraToCenterDistance/I/this.transform.tileSize),R=180*Math.atan2(x,-b)/Math.PI;let O=180*Math.acos(k/I)/Math.PI;return O=P<0?90-O:90+O,{center:_.toLngLat(),elevation:c,zoom:A,pitch:O,bearing:R}}calculateCameraOptionsFromCameraLngLatAltRotation(e,n,a,c,p){const _=this.transform.calculateCenterFromCameraLngLatAlt(e,n,a,c);return{center:_.center,elevation:_.elevation,zoom:_.zoom,bearing:a,pitch:c,roll:p}}easeTo(e,n){this._stop(!1,e.easeId),((e=o.e({offset:[0,0],duration:500,easing:o.co},e)).animate===!1||!e.essential&&he.prefersReducedMotion)&&(e.duration=0);const a=this._getTransformForUpdate(),c=this.getBearing(),p=a.pitch,_=a.roll,x="bearing"in e?this._normalizeBearing(e.bearing,c):c,b="pitch"in e?+e.pitch:p,P="roll"in e?this._normalizeBearing(e.roll,_):_,I="padding"in e?e.padding:a.padding,k=o.P.convert(e.offset);let A,R;e.around&&(A=o.S.convert(e.around),R=a.locationToScreenPoint(A));const O={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},W=this.cameraHelper.handleEaseTo(a,{bearing:x,pitch:b,roll:P,padding:I,around:A,aroundPoint:R,offsetAsPoint:k,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||c!==x,this._pitching=this._pitching||b!==p,this._rolling=this._rolling||P!==_,this._padding=!a.isPaddingEqual(I),this._zooming=this._zooming||W.isZooming,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,O),this.terrain&&this._prepareElevation(W.elevationCenter),this._ease((G=>{W.easeFunc(G),this.terrain&&!e.freezeElevation&&this._updateElevation(G),this._applyUpdatedTransform(a),this._fireMoveEvents(n)}),(G=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n,G)}),e),this}_prepareEase(e,n,a={}){this._moving=!0,n||a.moving||this.fire(new o.l("movestart",e)),this._zooming&&!a.zooming&&this.fire(new o.l("zoomstart",e)),this._rotating&&!a.rotating&&this.fire(new o.l("rotatestart",e)),this._pitching&&!a.pitching&&this.fire(new o.l("pitchstart",e)),this._rolling&&!a.rolling&&this.fire(new o.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const n=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&n!==this._elevationTarget){const a=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(a-(n-(a*e+this._elevationStart))/(1-e)),this._elevationTarget=n}this.transform.setElevation(o.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const n=e.getCameraLngLat(),a=e.getCameraAltitude(),c=this.terrain?this.terrain.getElevationForLngLatZoom(n,e.zoom):0;if(a<c){const p=this.calculateCameraOptionsFromTo(n,c,e.center,e.elevation);return{pitch:p.pitch,zoom:p.zoom}}return{}}_applyUpdatedTransform(e){const n=[];if(n.push((c=>this._elevateCameraIfInsideTerrain(c))),this.transformCameraUpdate&&n.push((c=>this.transformCameraUpdate(c))),!n.length)return;const a=e.clone();for(const c of n){const p=a.clone(),{center:_,zoom:x,roll:b,pitch:P,bearing:I,elevation:k}=c(p);_&&p.setCenter(_),k!==void 0&&p.setElevation(k),x!==void 0&&p.setZoom(x),b!==void 0&&p.setRoll(b),P!==void 0&&p.setPitch(P),I!==void 0&&p.setBearing(I),a.apply(p)}this.transform.apply(a)}_fireMoveEvents(e){this.fire(new o.l("move",e)),this._zooming&&this.fire(new o.l("zoom",e)),this._rotating&&this.fire(new o.l("rotate",e)),this._pitching&&this.fire(new o.l("pitch",e)),this._rolling&&this.fire(new o.l("roll",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;delete this._easeId;const a=this._zooming,c=this._rotating,p=this._pitching,_=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,a&&this.fire(new o.l("zoomend",e)),c&&this.fire(new o.l("rotateend",e)),p&&this.fire(new o.l("pitchend",e)),_&&this.fire(new o.l("rollend",e)),this.fire(new o.l("moveend",e))}flyTo(e,n){if(!e.essential&&he.prefersReducedMotion){const we=o.Q(e,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(we,n)}this.stop(),e=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.co},e);const a=this._getTransformForUpdate(),c=a.bearing,p=a.pitch,_=a.roll,x=a.padding,b="bearing"in e?this._normalizeBearing(e.bearing,c):c,P="pitch"in e?+e.pitch:p,I="roll"in e?this._normalizeBearing(e.roll,_):_,k="padding"in e?e.padding:a.padding,A=o.P.convert(e.offset);let R=a.centerPoint.add(A);const O=a.screenPointToLocation(R),W=this.cameraHelper.handleFlyTo(a,{bearing:b,pitch:P,roll:I,padding:k,locationAtOffset:O,offsetAsPoint:A,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let G=e.curve;const H=Math.max(a.width,a.height),J=H/W.scaleOfZoom,ie=W.pixelPathLength;typeof W.scaleOfMinZoom=="number"&&(G=Math.sqrt(H/W.scaleOfMinZoom/ie*2));const Q=G*G;function se(we){const Fe=(J*J-H*H+(we?-1:1)*Q*Q*ie*ie)/(2*(we?J:H)*Q*ie);return Math.log(Math.sqrt(Fe*Fe+1)-Fe)}function ue(we){return(Math.exp(we)-Math.exp(-we))/2}function ee(we){return(Math.exp(we)+Math.exp(-we))/2}const ge=se(!1);let Te=function(we){return ee(ge)/ee(ge+G*we)},ve=function(we){return H*((ee(ge)*(ue(Fe=ge+G*we)/ee(Fe))-ue(ge))/Q)/ie;var Fe},xe=(se(!0)-ge)/G;if(Math.abs(ie)<2e-6||!isFinite(xe)){if(Math.abs(H-J)<1e-6)return this.easeTo(e,n);const we=J<H?-1:1;xe=Math.abs(Math.log(J/H))/G,ve=()=>0,Te=Fe=>Math.exp(we*G*Fe)}return e.duration="duration"in e?+e.duration:1e3*xe/("screenSpeed"in e?+e.screenSpeed/G:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=c!==b,this._pitching=P!==p,this._rolling=I!==_,this._padding=!a.isPaddingEqual(k),this._prepareEase(n,!1),this.terrain&&this._prepareElevation(W.targetCenter),this._ease((we=>{const Fe=we*xe,Ve=1/Te(Fe),Le=ve(Fe);this._rotating&&a.setBearing(o.C.number(c,b,we)),this._pitching&&a.setPitch(o.C.number(p,P,we)),this._rolling&&a.setRoll(o.C.number(_,I,we)),this._padding&&(a.interpolatePadding(x,k,we),R=a.centerPoint.add(A)),W.easeFunc(we,Ve,Le,R),this.terrain&&!e.freezeElevation&&this._updateElevation(we),this._applyUpdatedTransform(a),this._fireMoveEvents(n)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(n)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){var a;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,n)}return e||(a=this.handlers)===null||a===void 0||a.stop(!1),this}_ease(e,n,a){a.animate===!1||a.duration===0?(e(1),n()):(this._easeStart=he.now(),this._easeOptions=a,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,n){e=o.aO(e,-180,180);const a=Math.abs(e-n);return Math.abs(e-360-n)<a&&(e-=360),Math.abs(e+360-n)<a&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(o.S.convert(e),this.transform.tileZoom):null}}const ru={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class iu{constructor(e=ru){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=n=>{!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"&&n.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,n){const a=this._map._getUIString(`AttributionControl.${n}`);e.title=a,e.setAttribute("aria-label",a)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((c=>typeof c!="string"?"":c))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const n=this._map.style.sourceCaches;for(const c in n){const p=n[c];if(p.used||p.usedForTerrain){const _=p.getSource();_.attribution&&e.indexOf(_.attribution)<0&&e.push(_.attribution)}}e=e.filter((c=>String(c).trim())),e.sort(((c,p)=>c.length-p.length)),e=e.filter(((c,p)=>{for(let _=p+1;_<e.length;_++)if(e[_].indexOf(c)>=0)return!1;return!0}));const a=e.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,e.length?(this._innerContainer.innerHTML=q.sanitize(a),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class qh{constructor(e={}){this._updateCompact=()=>{const n=this._container.children;if(n.length){const a=n[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&a.classList.add("maplibregl-compact"):a.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl");const n=q.create("a","maplibregl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://maplibre.org/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Dn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){const n=this._currentlyRunning,a=n?this._queue.concat(n):this._queue;for(const c of a)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const n=this._currentlyRunning=this._queue;this._queue=[];for(const a of n)if(!a.cancelled&&(a.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var wl=o.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class et extends o.E{constructor(e){super(),this._lastTilesetChange=he.now(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,n){this.sourceCache.update(e,n),this._renderableTilesKeys=[];const a={};for(const c of _e(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:n,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))a[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.terrainRttPosMatrix32f=new Float64Array(16),o.bY(c.terrainRttPosMatrix32f,0,o.$,o.$,0,0,1),this._tiles[c.key]=new an(c,this.tileSize),this._lastTilesetChange=he.now());for(const c in this._tiles)a[c]||delete this._tiles[c]}freeRtt(e){for(const n in this._tiles){const a=this._tiles[n];(!e||a.tileID.equals(e)||a.tileID.isChildOf(e)||e.isChildOf(a.tileID))&&(a.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,n){return n?this._getTerrainCoordsForTileRanges(e,n):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const n={};for(const a of this._renderableTilesKeys){const c=this._tiles[a].tileID,p=e.clone(),_=o.ba();if(c.canonical.equals(e.canonical))o.bY(_,0,o.$,o.$,0,0,1);else if(c.canonical.isChildOf(e.canonical)){const x=c.canonical.z-e.canonical.z,b=c.canonical.x-(c.canonical.x>>x<<x),P=c.canonical.y-(c.canonical.y>>x<<x),I=o.$>>x;o.bY(_,0,I,I,0,0,1),o.M(_,_,[-b*I,-P*I,0])}else{if(!e.canonical.isChildOf(c.canonical))continue;{const x=e.canonical.z-c.canonical.z,b=e.canonical.x-(e.canonical.x>>x<<x),P=e.canonical.y-(e.canonical.y>>x<<x),I=o.$>>x;o.bY(_,0,o.$,o.$,0,0,1),o.M(_,_,[b*I,P*I,0]),o.N(_,_,[1/2**x,1/2**x,0])}}p.terrainRttPosMatrix32f=new Float32Array(_),n[a]=p}return n}_getTerrainCoordsForTileRanges(e,n){const a={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID;if(!this._isWithinTileRanges(p,n))continue;const _=e.clone(),x=o.ba();if(p.canonical.z===e.canonical.z){const b=e.canonical.x-p.canonical.x,P=e.canonical.y-p.canonical.y;o.bY(x,0,o.$,o.$,0,0,1),o.M(x,x,[b*o.$,P*o.$,0])}else if(p.canonical.z>e.canonical.z){const b=p.canonical.z-e.canonical.z,P=p.canonical.x-(p.canonical.x>>b<<b),I=p.canonical.y-(p.canonical.y>>b<<b),k=e.canonical.x-(p.canonical.x>>b),A=e.canonical.y-(p.canonical.y>>b),R=o.$>>b;o.bY(x,0,R,R,0,0,1),o.M(x,x,[-P*R+k*o.$,-I*R+A*o.$,0])}else{const b=e.canonical.z-p.canonical.z,P=e.canonical.x-(e.canonical.x>>b<<b),I=e.canonical.y-(e.canonical.y>>b<<b),k=(e.canonical.x>>b)-p.canonical.x,A=(e.canonical.y>>b)-p.canonical.y,R=o.$<<b;o.bY(x,0,R,R,0,0,1),o.M(x,x,[P*o.$+k*R,I*o.$+A*R,0])}_.terrainRttPosMatrix32f=new Float32Array(x),a[c]=_}return a}getSourceTile(e,n){const a=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>a.maxzoom&&(c=a.maxzoom),c<a.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let p=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!p||!p.dem)&&n)for(;c>=a.minzoom&&(!p||!p.dem);)p=this.sourceCache.getTileByID(e.scaledTo(c--).key);return p}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,n){return n[e.canonical.z]&&e.canonical.x>=n[e.canonical.z].minTileX&&e.canonical.x<=n[e.canonical.z].maxTileX&&e.canonical.y>=n[e.canonical.z].minTileY&&e.canonical.y<=n[e.canonical.z].maxTileY}}class lt{constructor(e,n,a){this._meshCache={},this.painter=e,this.sourceCache=new et(n),this.options=a,this.exaggeration=typeof a.exaggeration=="number"?a.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,n,a,c=o.$){var p;if(!(n>=0&&n<c&&a>=0&&a<c))return 0;const _=this.getTerrainData(e),x=(p=_.tile)===null||p===void 0?void 0:p.dem;if(!x)return 0;const b=o.cs([],[n/c*o.$,a/c*o.$],_.u_terrain_matrix),P=[b[0]*x.dim,b[1]*x.dim],I=Math.floor(P[0]),k=Math.floor(P[1]),A=P[0]-I,R=P[1]-k;return x.get(I,k)*(1-A)*(1-R)+x.get(I+1,k)*A*(1-R)+x.get(I,k+1)*(1-A)*R+x.get(I+1,k+1)*A*R}getElevationForLngLatZoom(e,n){if(!o.ct(n,e.wrap()))return 0;const{tileID:a,mercatorX:c,mercatorY:p}=this._getOverscaledTileIDFromLngLatZoom(e,n);return this.getElevation(a,c%o.$,p%o.$,o.$)}getElevation(e,n,a,c=o.$){return this.getDEMElevation(e,n,a,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,p=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new o.T(c,p,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new o.T(c,new o.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.ag([])}const n=this.sourceCache.getSourceTile(e,!0);if(n&&n.dem&&(!n.demTexture||n.needsTerrainPrepare)){const c=this.painter.context;n.demTexture=this.painter.getTileTexture(n.dem.stride),n.demTexture?n.demTexture.update(n.dem.getPixels(),{premultiply:!1}):n.demTexture=new o.T(c,n.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),n.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),n.needsTerrainPrepare=!1}const a=n&&n+n.tileID.key+e.key;if(a&&!this._demMatrixCache[a]){const c=this.sourceCache.sourceCache._source.maxzoom;let p=e.canonical.z-n.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?p=e.canonical.z-c:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const _=e.canonical.x-(e.canonical.x>>p<<p),x=e.canonical.y-(e.canonical.y>>p<<p),b=o.cu(new Float64Array(16),[1/(o.$<<p),1/(o.$<<p),0]);o.M(b,b,[_*o.$,x*o.$,0]),this._demMatrixCache[e.key]={matrix:b,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:n&&n.dem&&n.dem.dim||1,u_terrain_matrix:a?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:n&&n.dem&&n.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(n&&n.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:n}}getFramebuffer(e){const n=this.painter,a=n.width/devicePixelRatio,c=n.height/devicePixelRatio;return!this._fbo||this._fbo.width===a&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new o.T(n.context,{width:a,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new o.T(n.context,{width:a,height:c,data:null},n.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(n.context.gl.NEAREST,n.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=n.context.createFramebuffer(a,c,!0,!1),this._fbo.depthAttachment.set(n.context.createRenderbuffer(n.context.gl.DEPTH_COMPONENT16,a,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const n=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let p=0,_=0;p<this._coordsTextureSize;p++)for(let x=0;x<this._coordsTextureSize;x++,_+=4)n[_+0]=255&x,n[_+1]=255&p,n[_+2]=x>>8<<4|p>>8,n[_+3]=0;const a=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(n.buffer)),c=new o.T(e,a,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const n=new Uint8Array(4),a=this.painter.context,c=a.gl,p=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),_=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),x=Math.round(this.painter.height/devicePixelRatio);a.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(p,x-_-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null);const b=n[0]+(n[2]>>4<<8),P=n[1]+((15&n[2])<<8),I=this.coordsIndex[255-n[3]],k=I&&this.sourceCache.getTileByID(I);if(!k)return null;const A=this._coordsTextureSize,R=(1<<k.tileID.canonical.z)*A;return new o.a1((k.tileID.canonical.x*A+b)/R+k.tileID.wrap,(k.tileID.canonical.y*A+P)/R,this.getElevation(k.tileID,b,P,A))}depthAtPoint(e){const n=new Uint8Array(4),a=this.painter.context,c=a.gl;return a.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,n),a.bindFramebuffer.set(null),(n[0]/16777216+n[1]/65536+n[2]/256+n[3])/256}getTerrainMesh(e){var n;const a=((n=this.painter.style.projection)===null||n===void 0?void 0:n.transitionState)>0,c=a&&e.canonical.y===0,p=a&&e.canonical.y===(1<<e.canonical.z)-1,_=`m_${c?"n":""}_${p?"s":""}`;if(this._meshCache[_])return this._meshCache[_];const x=this.painter.context,b=new o.cv,P=new o.aN,I=this.meshSize,k=o.$/I,A=I*I;for(let ee=0;ee<=I;ee++)for(let ge=0;ge<=I;ge++)b.emplaceBack(ge*k,ee*k,0);for(let ee=0;ee<A;ee+=I+1)for(let ge=0;ge<I;ge++)P.emplaceBack(ge+ee,I+ge+ee+1,I+ge+ee+2),P.emplaceBack(ge+ee,I+ge+ee+2,ge+ee+1);const R=b.length,O=R+(I+1),W=(I+1)*I,G=c?o.bh:0,H=c?0:1,J=p?o.bi:o.$,ie=p?0:1;for(let ee=0;ee<=I;ee++)b.emplaceBack(ee*k,G,H);for(let ee=0;ee<=I;ee++)b.emplaceBack(ee*k,J,ie);for(let ee=0;ee<I;ee++)P.emplaceBack(W+ee,O+ee,O+ee+1),P.emplaceBack(W+ee,O+ee+1,W+ee+1),P.emplaceBack(0+ee,R+ee+1,R+ee),P.emplaceBack(0+ee,0+ee+1,R+ee+1);const Q=b.length,se=Q+2*(I+1);for(const ee of[0,1])for(let ge=0;ge<=I;ge++)for(const Te of[0,1])b.emplaceBack(ee*o.$,ge*k,Te);for(let ee=0;ee<2*I;ee+=2)P.emplaceBack(Q+ee,Q+ee+1,Q+ee+3),P.emplaceBack(Q+ee,Q+ee+3,Q+ee+2),P.emplaceBack(se+ee,se+ee+3,se+ee+1),P.emplaceBack(se+ee,se+ee+2,se+ee+3);const ue=new zs(x.createVertexBuffer(b,wl.members),x.createIndexBuffer(P),o.aM.simpleSegment(0,0,b.length,P.length));return this._meshCache[_]=ue,ue}getMeshFrameDelta(e){return 2*Math.PI*o.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,n){var a;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,n);return(a=this.getMinMaxElevation(c).minElevation)!==null&&a!==void 0?a:0}getMinMaxElevation(e){const n=this.getTerrainData(e).tile,a={minElevation:null,maxElevation:null};return n&&n.dem&&(a.minElevation=n.dem.min*this.exaggeration,a.maxElevation=n.dem.max*this.exaggeration),a}_getOverscaledTileIDFromLngLatZoom(e,n){const a=o.a1.fromLngLat(e.wrap()),c=(1<<n)*o.$,p=a.x*c,_=a.y*c,x=Math.floor(p/o.$),b=Math.floor(_/o.$);return{tileID:new o.Z(n,0,n,x,b),mercatorX:p,mercatorY:_}}}class Tl{constructor(e,n,a){this._context=e,this._size=n,this._tileSize=a,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const n=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),a=new o.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return a.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),n.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),n.colorAttachment.set(a.texture),{id:e,fbo:n,texture:a,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((n=>e.id!==n)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const n of this._recentlyUsed)if(!this._objects[n].inUse)return this._objects[n];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const ms={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class Sl{constructor(e,n){this.painter=e,this.terrain=n,this.pool=new Tl(e.context,30,n.sourceCache.tileSize*n.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,n){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((a=>!e._layers[a].isHidden(n))),this._coordsAscending={};for(const a in e.sourceCaches){this._coordsAscending[a]={};const c=e.sourceCaches[a].getVisibleCoordinates(),p=e.sourceCaches[a].getSource(),_=p instanceof pr?p.terrainTileRanges:null;for(const x of c){const b=this.terrain.sourceCache.getTerrainCoords(x,_);for(const P in b)this._coordsAscending[a][P]||(this._coordsAscending[a][P]=[]),this._coordsAscending[a][P].push(b[P])}}this._coordsAscendingStr={};for(const a of e._order){const c=e._layers[a],p=c.source;if(ms[c.type]&&!this._coordsAscendingStr[p]){this._coordsAscendingStr[p]={};for(const _ in this._coordsAscending[p])this._coordsAscendingStr[p][_]=this._coordsAscending[p][_].map((x=>x.key)).sort().join()}}for(const a of this._renderableTiles)for(const c in this._coordsAscendingStr){const p=this._coordsAscendingStr[c][a.tileID.key];p&&p!==a.rttCoords[c]&&(a.rtt=[])}}renderLayer(e,n){if(e.isHidden(this.painter.transform.zoom))return!1;const a=Object.assign(Object.assign({},n),{isRenderingToTexture:!0}),c=e.type,p=this.painter,_=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ms[c]&&(this._prevType&&ms[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!_))return!0;if(ms[this._prevType]||ms[c]&&_){this._prevType=c;const x=this._stacks.length-1,b=this._stacks[x]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(gl(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[x]){const k=this.pool.getObjectForId(P.rtt[x].id);if(k.stamp===P.rtt[x].stamp){this.pool.useObject(k);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),P.rtt[x]={id:I.id,stamp:I.stamp},p.context.bindFramebuffer.set(I.fbo.framebuffer),p.context.clear({color:o.bf.transparent,stencil:0}),p.currentStencilSource=void 0;for(let k=0;k<b.length;k++){const A=p.style._layers[b[k]],R=A.source?this._coordsAscending[A.source][P.tileID.key]:[P.tileID];p.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),p._renderTileClippingMasks(A,R,!0),p.renderLayer(p,p.style.sourceCaches[A.source],A,R,a),A.source&&(P.rttCoords[A.source]=this._coordsAscendingStr[A.source][P.tileID.key])}}return gl(this.painter,this.terrain,this._rttTiles,a),this._rttTiles=[],this.pool.freeAllObjects(),ms[c]}return!1}}const Ii={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Wh=B,Qi={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ru,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},xp={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class bo{constructor(e,n,a=!1){this.mousedown=p=>{this.startMove(p,q.mousePos(this.element,p)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=p=>{this.move(p,q.mousePos(this.element,p))},this.mouseup=p=>{this._rotatePitchHandler.dragEnd(p),this.offTemp()},this.touchstart=p=>{p.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,p.targetTouches)[0],this.startMove(p,this._startPos),q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.addEventListener(window,"touchend",this.touchend))},this.touchmove=p=>{p.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,p.targetTouches)[0],this.move(p,this._lastPos))},this.touchend=p=>{p.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=n;const c=new _p;this._rotatePitchHandler=new wa({clickTolerance:3,move:(p,_)=>{const x=n.getBoundingClientRect(),b=new o.P((x.bottom-x.top)/2,(x.right-x.left)/2);return{bearingDelta:o.cn(new o.P(p.x,_.y),_,b),pitchDelta:a?-.5*(_.y-p.y):void 0}},moveStateManager:c,enable:!0,assignEvents:()=>{}}),this.map=e,q.addEventListener(n,"mousedown",this.mousedown),q.addEventListener(n,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(n,"touchcancel",this.reset)}startMove(e,n){this._rotatePitchHandler.dragStart(e,n),q.disableDrag()}move(e,n){const a=this.map,{bearingDelta:c,pitchDelta:p}=this._rotatePitchHandler.dragMove(e,n)||{};c&&a.setBearing(a.getBearing()+c),p&&a.setPitch(a.getPitch()+p)}off(){const e=this.element;q.removeEventListener(e,"mousedown",this.mousedown),q.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend),q.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup),q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),q.removeEventListener(window,"touchend",this.touchend)}}let rr;function Nr(h,e,n,a=!1){if(a||!n.getCoveringTilesDetailsProvider().allowWorldCopies())return h?.wrap();const c=new o.S(h.lng,h.lat);if(h=new o.S(h.lng,h.lat),e){const p=new o.S(h.lng-360,h.lat),_=new o.S(h.lng+360,h.lat),x=n.locationToScreenPoint(h).distSqr(e);n.locationToScreenPoint(p).distSqr(e)<x?h=p:n.locationToScreenPoint(_).distSqr(e)<x&&(h=_)}for(;Math.abs(h.lng-n.center.lng)>180;){const p=n.locationToScreenPoint(h);if(p.x>=0&&p.y>=0&&p.x<=n.width&&p.y<=n.height)break;h.lng>n.center.lng?h.lng-=360:h.lng+=360}return h.lng!==c.lng&&n.isPointOnMapSurface(n.locationToScreenPoint(h))?h:c}const Pl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ma(h,e,n){const a=h.classList;for(const c in Pl)a.remove(`maplibregl-${n}-anchor-${c}`);a.add(`maplibregl-${n}-anchor-${e}`)}class Ca extends o.E{constructor(e){if(super(),this._onKeyPress=n=>{const a=n.code,c=n.charCode||n.keyCode;a!=="Space"&&a!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=n=>{const a=n.originalEvent.target,c=this._element;this._popup&&(a===c||c.contains(a))&&this.togglePopup()},this._update=n=>{if(!this._map)return;const a=this._map.loaded()&&!this._map.isMoving();(n?.type==="terrain"||n?.type==="render"&&!a)&&this._map.once("render",this._update),this._lngLat=Nr(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let p="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?p="rotateX(0deg)":this._pitchAlignment==="map"&&(p=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||n&&n.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${Pl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${p} ${c}`),he.frameAsync(new AbortController).then((()=>{this._updateOpacity(n&&n.type==="moveend")})).catch((()=>{}))},this._onMove=n=>{if(!this._isDragging){const a=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=a}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.l("dragstart"))),this.fire(new o.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.l("dragend")),this._state="inactive"},this._addDragHandler=n=>{this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._offset),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=o.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div");const n=q.createNS("http://www.w3.org/2000/svg","svg"),a=41,c=27;n.setAttributeNS(null,"display","block"),n.setAttributeNS(null,"height",`${a}px`),n.setAttributeNS(null,"width",`${c}px`),n.setAttributeNS(null,"viewBox",`0 0 ${c} ${a}`);const p=q.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"stroke","none"),p.setAttributeNS(null,"stroke-width","1"),p.setAttributeNS(null,"fill","none"),p.setAttributeNS(null,"fill-rule","evenodd");const _=q.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"fill-rule","nonzero");const x=q.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"transform","translate(3.0, 29.0)"),x.setAttributeNS(null,"fill","#000000");const b=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const H of b){const J=q.createNS("http://www.w3.org/2000/svg","ellipse");J.setAttributeNS(null,"opacity","0.04"),J.setAttributeNS(null,"cx","10.5"),J.setAttributeNS(null,"cy","5.80029008"),J.setAttributeNS(null,"rx",H.rx),J.setAttributeNS(null,"ry",H.ry),x.appendChild(J)}const P=q.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const I=q.createNS("http://www.w3.org/2000/svg","path");I.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(I);const k=q.createNS("http://www.w3.org/2000/svg","g");k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"fill","#000000");const A=q.createNS("http://www.w3.org/2000/svg","path");A.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),k.appendChild(A);const R=q.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(6.0, 7.0)"),R.setAttributeNS(null,"fill","#FFFFFF");const O=q.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(8.0, 8.0)");const W=q.createNS("http://www.w3.org/2000/svg","circle");W.setAttributeNS(null,"fill","#000000"),W.setAttributeNS(null,"opacity","0.25"),W.setAttributeNS(null,"cx","5.5"),W.setAttributeNS(null,"cy","5.5"),W.setAttributeNS(null,"r","5.4999962");const G=q.createNS("http://www.w3.org/2000/svg","circle");G.setAttributeNS(null,"fill","#FFFFFF"),G.setAttributeNS(null,"cx","5.5"),G.setAttributeNS(null,"cy","5.5"),G.setAttributeNS(null,"r","5.4999962"),O.appendChild(W),O.appendChild(G),_.appendChild(x),_.appendChild(P),_.appendChild(k),_.appendChild(R),_.appendChild(O),n.appendChild(_),n.setAttributeNS(null,"height",a*this._scale+"px"),n.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(n),this._offset=o.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(n=>{n.preventDefault()})),this._element.addEventListener("mousedown",(n=>{n.preventDefault()})),Ma(this._element,this._anchor,"marker"),e&&e.className)for(const n of e.className.split(" "))this._element.classList.add(n);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=o.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var n,a;const c=(n=this._map)===null||n===void 0?void 0:n.terrain,p=this._map.transform.isLocationOccluded(this._lngLat);if(!c||p){const R=p?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==R&&(this._element.style.opacity=R))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const _=this._map,x=_.terrain.depthAtPoint(this._pos),b=_.terrain.getElevationForLngLatZoom(this._lngLat,_.transform.tileZoom);if(_.transform.lngLatToCameraDepth(this._lngLat,b)-x<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/_.transform.pixelsPerMeter,I=Math.sin(_.getPitch()*Math.PI/180)*P,k=_.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),A=_.transform.lngLatToCameraDepth(this._lngLat,b+I)-k>.006;!((a=this._popup)===null||a===void 0)&&a.isOpen()&&A&&this._popup.remove(),this._element.style.opacity=A?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=o.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,n){return(this._opacity===void 0||e===void 0&&n===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),n!==void 0&&(this._opacityWhenCovered=n),this._map&&this._updateOpacity(!0),this}}const nu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ia=0,Ws=!1;const wo={maxWidth:100,unit:"metric"};function Ml(h,e,n){const a=n&&n.maxWidth||100,c=h._container.clientHeight/2,p=h._container.clientWidth/2,_=h.unproject([p-a/2,c]),x=h.unproject([p+a/2,c]),b=Math.round(h.project(x).x-h.project(_).x),P=Math.min(a,b,h._container.clientWidth),I=_.distanceTo(x);if(n&&n.unit==="imperial"){const k=3.2808*I;k>5280?Hs(e,P,k/5280,h._getUIString("ScaleControl.Miles")):Hs(e,P,k,h._getUIString("ScaleControl.Feet"))}else n&&n.unit==="nautical"?Hs(e,P,I/1852,h._getUIString("ScaleControl.NauticalMiles")):I>=1e3?Hs(e,P,I/1e3,h._getUIString("ScaleControl.Kilometers")):Hs(e,P,I,h._getUIString("ScaleControl.Meters"))}function Hs(h,e,n,a){const c=(function(p){const _=Math.pow(10,`${Math.floor(p)}`.length-1);let x=p/_;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:x>=1?1:(function(b){const P=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*P)/P})(x),_*x})(n);h.style.width=e*(c/n)+"px",h.innerHTML=`${c}&nbsp;${a}`}const su={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},au=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Cl(h){if(h){if(typeof h=="number"){const e=Math.round(Math.abs(h)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,h),"top-left":new o.P(e,e),"top-right":new o.P(-e,e),bottom:new o.P(0,-h),"bottom-left":new o.P(e,-e),"bottom-right":new o.P(-e,-e),left:new o.P(h,0),right:new o.P(-h,0)}}if(h instanceof o.P||Array.isArray(h)){const e=o.P.convert(h);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:o.P.convert(h.center||[0,0]),top:o.P.convert(h.top||[0,0]),"top-left":o.P.convert(h["top-left"]||[0,0]),"top-right":o.P.convert(h["top-right"]||[0,0]),bottom:o.P.convert(h.bottom||[0,0]),"bottom-left":o.P.convert(h["bottom-left"]||[0,0]),"bottom-right":o.P.convert(h["bottom-right"]||[0,0]),left:o.P.convert(h.left||[0,0]),right:o.P.convert(h.right||[0,0])}}return Cl(new o.P(0,0))}const ou=B;T.AJAXError=o.cz,T.Event=o.l,T.Evented=o.E,T.LngLat=o.S,T.MercatorCoordinate=o.a1,T.Point=o.P,T.addProtocol=o.cA,T.config=o.a,T.removeProtocol=o.cB,T.AttributionControl=iu,T.BoxZoomHandler=Xc,T.CanvasSource=br,T.CooperativeGesturesHandler=Zh,T.DoubleClickZoomHandler=Jc,T.DragPanHandler=Uh,T.DragRotateHandler=eu,T.EdgeInsets=Rs,T.FullscreenControl=class extends o.E{constructor(h={}){super(),this._onFullscreenChange=()=>{var e;let n=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=n?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)n=n.shadowRoot.fullscreenElement;n===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const h=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=Ar,T.GeolocateControl=class extends o.E{constructor(h){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new o.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const n=new o.S(e.coords.longitude,e.coords.latitude),a=e.coords.accuracy,c=this._map.getBearing(),p=o.e({bearing:c},this.options.fitBoundsOptions),_=yt.fromLngLat(n,a);this._map.fitBounds(_,p,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const n=new o.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&Ws)return;this.options.trackUserLocation&&this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Ca({element:this._dotElement}),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ca({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(n=>{const a=n?.[0]instanceof ResizeObserverEntry;n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||a||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.l("trackuserlocationend")),this.fire(new o.l("userlocationlostfocus")))}))}},this.options=o.e({},nu,h)}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return o._(this,arguments,void 0,(function*(e=!1){if(rr!==void 0&&!e)return rr;if(window.navigator.permissions===void 0)return rr=!!window.navigator.geolocation,rr;try{rr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{rr=!!window.navigator.geolocation}return rr}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ia=0,Ws=!1}_isOutOfMapMaxBounds(h){const e=this._map.getMaxBounds(),n=h.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const h=this._map.getBounds(),e=h.getSouthEast(),n=h.getNorthEast(),a=e.distanceTo(n),c=Math.ceil(this._accuracy/(a/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ia--,Ws=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.l("trackuserlocationstart")),this.fire(new o.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ia++,Ia>1?(h={maximumAge:6e5,timeout:0},Ws=!0):(h=this.options.positionOptions,Ws=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.GlobeControl=class{constructor(){this._toggleProjection=()=>{var h;const e=(h=this._map.getProjection())===null||h===void 0?void 0:h.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var h;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((h=this._map.getProjection())===null||h===void 0?void 0:h.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=q.create("button","maplibregl-ctrl-globe",this._container),q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},T.Hash=_l,T.ImageSource=pr,T.KeyboardHandler=xl,T.LngLatBounds=yt,T.LogoControl=qh,T.Map=class extends Gh{constructor(h){var e,n;o.cw.mark(o.cx.create);const a=Object.assign(Object.assign(Object.assign({},Qi),h),{canvasContextAttributes:Object.assign(Object.assign({},Qi.canvasContextAttributes),h.canvasContextAttributes)});if(a.minZoom!=null&&a.maxZoom!=null&&a.minZoom>a.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(a.minPitch!=null&&a.maxPitch!=null&&a.minPitch>a.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(a.minPitch!=null&&a.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(a.maxPitch!=null&&a.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const c=new ur,p=new bi;if(a.minZoom!==void 0&&c.setMinZoom(a.minZoom),a.maxZoom!==void 0&&c.setMaxZoom(a.maxZoom),a.minPitch!==void 0&&c.setMinPitch(a.minPitch),a.maxPitch!==void 0&&c.setMaxPitch(a.maxPitch),a.renderWorldCopies!==void 0&&c.setRenderWorldCopies(a.renderWorldCopies),super(c,p,{bearingSnap:a.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Dn,this._controls=[],this._mapId=o.a7(),this._contextLost=x=>{x.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.l("webglcontextlost",{originalEvent:x}))},this._contextRestored=x=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.l("webglcontextrestored",{originalEvent:x}))},this._onMapScroll=x=>{if(x.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=a.interactive,this._maxTileCacheSize=a.maxTileCacheSize,this._maxTileCacheZoomLevels=a.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},a.canvasContextAttributes),this._trackResize=a.trackResize===!0,this._bearingSnap=a.bearingSnap,this._centerClampedToGround=a.centerClampedToGround,this._refreshExpiredTiles=a.refreshExpiredTiles===!0,this._fadeDuration=a.fadeDuration,this._crossSourceCollisions=a.crossSourceCollisions===!0,this._collectResourceTiming=a.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Ii),a.locale),this._clickTolerance=a.clickTolerance,this._overridePixelRatio=a.pixelRatio,this._maxCanvasSize=a.maxCanvasSize,this.transformCameraUpdate=a.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=a.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=ae.addThrottleControl((()=>this.isMoving())),this._requestManager=new $e(a.transformRequest),typeof a.container=="string"){if(this._container=document.getElementById(a.container),!this._container)throw new Error(`Container '${a.container}' not found.`)}else{if(!(a.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=a.container}if(a.maxBounds&&this.setMaxBounds(a.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let x=!1;const b=Gs((P=>{this._trackResize&&!this._removed&&(this.resize(P),this.redraw())}),50);this._resizeObserver=new ResizeObserver((P=>{x?b(P):x=!0})),this._resizeObserver.observe(this._container)}this.handlers=new tu(this,a),this._hash=a.hash&&new _l(typeof a.hash=="string"&&a.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:a.center,elevation:a.elevation,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch,roll:a.roll}),a.bounds&&(this.resize(),this.fitBounds(a.bounds,o.e({},a.fitBoundsOptions,{duration:0}))));const _=typeof a.style=="string"||((n=(e=a.style)===null||e===void 0?void 0:e.projection)===null||n===void 0?void 0:n.type)!=="globe";this.resize(null,_),this._localIdeographFontFamily=a.localIdeographFontFamily,this._validateStyle=a.validateStyle,a.style&&this.setStyle(a.style,{localIdeographFontFamily:a.localIdeographFontFamily}),a.attributionControl&&this.addControl(new iu(typeof a.attributionControl=="boolean"?void 0:a.attributionControl)),a.maplibreLogo&&this.addControl(new qh,a.logoPosition),this.on("style.load",(()=>{if(_||this._resizeTransform(),this.transform.unmodified){const x=o.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(x)}})),this.on("data",(x=>{this._update(x.dataType==="style"),this.fire(new o.l(`${x.dataType}data`,x))})),this.on("dataloading",(x=>{this.fire(new o.l(`${x.dataType}dataloading`,x))})),this.on("dataabort",(x=>{this.fire(new o.l("sourcedataabort",x))}))}_getMapId(){return this._mapId}setGlobalStateProperty(h,e){return this.style.setGlobalStateProperty(h,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(h,e){if(e===void 0&&(e=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new o.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=h.onAdd(this);this._controls.push(h);const a=this._controlPositions[e];return e.indexOf("bottom")!==-1?a.insertBefore(n,a.firstChild):a.appendChild(n),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new o.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(h);return e>-1&&this._controls.splice(e,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,e,n,a){return a==null&&this.terrain&&(a=this.terrain.getElevationForLngLatZoom(n,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(h,e,n,a)}resize(h,e=!0){const[n,a]=this._containerDimensions(),c=this._getClampedPixelRatio(n,a);if(this._resizeCanvas(n,a,c),this.painter.resize(n,a,c),this.painter.overLimit()){const _=this.painter.context.gl;this._maxCanvasSize=[_.drawingBufferWidth,_.drawingBufferHeight];const x=this._getClampedPixelRatio(n,a);this._resizeCanvas(n,a,x),this.painter.resize(n,a,x)}this._resizeTransform(e);const p=!this._moving;return p&&(this.stop(),this.fire(new o.l("movestart",h)).fire(new o.l("move",h))),this.fire(new o.l("resize",h)),p&&this.fire(new o.l("moveend",h)),this}_resizeTransform(h=!0){var e;const[n,a]=this._containerDimensions();this.transform.resize(n,a,h),(e=this._requestedCameraState)===null||e===void 0||e.resize(n,a,h)}_getClampedPixelRatio(h,e){const{0:n,1:a}=this._maxCanvasSize,c=this.getPixelRatio(),p=h*c,_=e*c;return Math.min(p>n?n/p:1,_>a?a/_:1)*c}getPixelRatio(){var h;return(h=this._overridePixelRatio)!==null&&h!==void 0?h:devicePixelRatio}setPixelRatio(h){this._overridePixelRatio=h,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(yt.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.setMinZoom(h),this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.setMaxZoom(h),this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.setMinPitch(h),this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(h>=this.transform.minPitch)return this.transform.setMaxPitch(h),this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.setRenderWorldCopies(h),this._update()}project(h){return this.transform.locationToScreenPoint(o.S.convert(h),this.style&&this.terrain)}unproject(h){return this.transform.screenPointToLocation(o.P.convert(h),this.terrain)}isMoving(){var h;return this._moving||((h=this.handlers)===null||h===void 0?void 0:h.isMoving())}isZooming(){var h;return this._zooming||((h=this.handlers)===null||h===void 0?void 0:h.isZooming())}isRotating(){var h;return this._rotating||((h=this.handlers)===null||h===void 0?void 0:h.isRotating())}_createDelegatedListener(h,e,n){if(h==="mouseenter"||h==="mouseover"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:p=>{const _=e.filter((b=>this.getLayer(b))),x=_.length!==0?this.queryRenderedFeatures(p.point,{layers:_}):[];x.length?a||(a=!0,n.call(this,new Li(h,this,p.originalEvent,{features:x}))):a=!1},mouseout:()=>{a=!1}}}}if(h==="mouseleave"||h==="mouseout"){let a=!1;return{layers:e,listener:n,delegates:{mousemove:_=>{const x=e.filter((b=>this.getLayer(b)));(x.length!==0?this.queryRenderedFeatures(_.point,{layers:x}):[]).length?a=!0:a&&(a=!1,n.call(this,new Li(h,this,_.originalEvent)))},mouseout:_=>{a&&(a=!1,n.call(this,new Li(h,this,_.originalEvent)))}}}}{const a=c=>{const p=e.filter((x=>this.getLayer(x))),_=p.length!==0?this.queryRenderedFeatures(c.point,{layers:p}):[];_.length&&(c.features=_,n.call(this,c),delete c.features)};return{layers:e,listener:n,delegates:{[h]:a}}}}_saveDelegatedListener(h,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(e)}_removeDelegatedListener(h,e,n){if(!this._delegatedListeners||!this._delegatedListeners[h])return;const a=this._delegatedListeners[h];for(let c=0;c<a.length;c++){const p=a[c];if(p.listener===n&&p.layers.length===e.length&&p.layers.every((_=>e.includes(_)))){for(const _ in p.delegates)this.off(_,p.delegates[_]);return void a.splice(c,1)}}}on(h,e,n){if(n===void 0)return super.on(h,e);const a=typeof e=="string"?[e]:e,c=this._createDelegatedListener(h,a,n);this._saveDelegatedListener(h,c);for(const p in c.delegates)this.on(p,c.delegates[p]);return{unsubscribe:()=>{this._removeDelegatedListener(h,a,n)}}}once(h,e,n){if(n===void 0)return super.once(h,e);const a=typeof e=="string"?[e]:e,c=this._createDelegatedListener(h,a,n);for(const p in c.delegates){const _=c.delegates[p];c.delegates[p]=(...x)=>{this._removeDelegatedListener(h,a,n),_(...x)}}this._saveDelegatedListener(h,c);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(h,e,n){return n===void 0?super.off(h,e):(this._removeDelegatedListener(h,typeof e=="string"?[e]:e,n),this)}queryRenderedFeatures(h,e){if(!this.style)return[];let n;const a=h instanceof o.P||Array.isArray(h),c=a?h:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(a?{}:h)||{},c instanceof o.P||typeof c[0]=="number")n=[o.P.convert(c)];else{const p=o.P.convert(c[0]),_=o.P.convert(c[1]);n=[p,new o.P(_.x,p.y),_,new o.P(p.x,_.y),p]}return this.style.queryRenderedFeatures(n,e,this.transform)}querySourceFeatures(h,e){return this.style.querySourceFeatures(h,e)}setStyle(h,e){return(e=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(h,e))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const e=this._locale[h];if(e==null)throw new Error(`Missing UI string '${h}'`);return e}_updateStyle(h,e){var n,a;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(h,e)));const c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!h)),h?(this.style=new Sc(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h,e,c):this.style.loadJSON(h,e,c),this):((a=(n=this.style)===null||n===void 0?void 0:n.projection)===null||a===void 0||a.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Sc(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,e){if(typeof h=="string"){const n=this._requestManager.transformRequest(h,"Style");o.j(n,new AbortController).then((a=>{this._updateDiff(a.data,e)})).catch((a=>{a&&this.fire(new o.k(a))}))}else typeof h=="object"&&this._updateDiff(h,e)}_updateDiff(h,e){try{this.style.setState(h,e)&&this._update(!0)}catch(n){o.w(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(h,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(h,e){return this._lazyInitEmptyStyle(),this.style.addSource(h,e),this._update(!0)}isSourceLoaded(h){const e=this.style&&this.style.sourceCaches[h];if(e!==void 0)return e.loaded();this.fire(new o.k(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),h){const e=this.style.sourceCaches[h.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${h.source}`);this.terrain===null&&e.reload();for(const n in this.style._layers){const a=this.style._layers[n];a.type==="hillshade"&&a.source===h.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),a.type==="color-relief"&&a.source===h.source&&o.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new lt(this.painter,e,h),this.painter.renderToTexture=new Sl(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=n=>{var a;n.dataType==="style"?this.terrain.sourceCache.freeRtt():n.dataType==="source"&&n.tile&&(n.sourceId!==h.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((a=n.source)===null||a===void 0?void 0:a.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(n.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new o.l("terrain",{terrain:h})),this}getTerrain(){var h,e;return(e=(h=this.terrain)===null||h===void 0?void 0:h.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const e in h){const n=h[e]._tiles;for(const a in n){const c=n[a];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}setSourceTileLodParams(h,e,n){if(n){const a=this.getSource(n);if(!a)throw new Error(`There is no source with ID "${n}", cannot set LOD parameters`);a.calculateTileZoom=ze(Math.max(1,h),Math.max(1,e))}else for(const a in this.style.sourceCaches)this.style.sourceCaches[a].getSource().calculateTileZoom=ze(Math.max(1,h),Math.max(1,e));return this._update(!0),this}refreshTiles(h,e){const n=this.style.sourceCaches[h];if(!n)throw new Error(`There is no source cache with ID "${h}", cannot refresh tile`);e===void 0?n.reload(!0):n.refreshTiles(e.map((a=>new o.a4(a.z,a.x,a.y))))}addImage(h,e,n={}){const{pixelRatio:a=1,sdf:c=!1,stretchX:p,stretchY:_,content:x,textFitWidth:b,textFitHeight:P}=n;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||o.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:k,data:A}=e,R=e;return this.style.addImage(h,{data:new o.R({width:I,height:k},new Uint8Array(A)),pixelRatio:a,stretchX:p,stretchY:_,content:x,textFitWidth:b,textFitHeight:P,sdf:c,version:0,userImage:R}),R.onAdd&&R.onAdd(this,h),this}}{const{width:I,height:k,data:A}=he.getImageData(e);this.style.addImage(h,{data:new o.R({width:I,height:k},A),pixelRatio:a,stretchX:p,stretchY:_,content:x,textFitWidth:b,textFitHeight:P,sdf:c,version:0})}}updateImage(h,e){const n=this.style.getImage(h);if(!n)return this.fire(new o.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=e instanceof HTMLImageElement||o.b(e)?he.getImageData(e):e,{width:c,height:p,data:_}=a;if(c===void 0||p===void 0)return this.fire(new o.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==n.data.width||p!==n.data.height)return this.fire(new o.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const x=!(e instanceof HTMLImageElement||o.b(e));return n.data.replace(_,x),this.style.updateImage(h,n),this}getImage(h){return this.style.getImage(h)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new o.k(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h){return ae.getImage(this._requestManager.transformRequest(h,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(h,e){return this._lazyInitEmptyStyle(),this.style.addLayer(h,e),this._update(!0)}moveLayer(h,e){return this.style.moveLayer(h,e),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(h,e,n){return this.style.setLayerZoomRange(h,e,n),this._update(!0)}setFilter(h,e,n={}){return this.style.setFilter(h,e,n),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,e,n,a={}){return this.style.setPaintProperty(h,e,n,a),this._update(!0)}getPaintProperty(h,e){return this.style.getPaintProperty(h,e)}setLayoutProperty(h,e,n,a={}){return this.style.setLayoutProperty(h,e,n,a),this._update(!0)}getLayoutProperty(h,e){return this.style.getLayoutProperty(h,e)}setGlyphs(h,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(h,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(h,e,n={}){return this._lazyInitEmptyStyle(),this.style.addSprite(h,e,n,(a=>{a||this._update(!0)})),this}removeSprite(h){return this._lazyInitEmptyStyle(),this.style.removeSprite(h),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(h,e,(n=>{n||this._update(!0)})),this}setLight(h,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(h,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(h,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(h,e){return this.style.setFeatureState(h,e),this._update()}removeFeatureState(h,e){return this.style.removeFeatureState(h,e),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,e=0;return this._container&&(h=this._container.clientWidth||400,e=this._container.clientHeight||300),[h,e]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map");const e=this._canvasContainer=q.create("div","maplibregl-canvas-container",h);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const n=this._containerDimensions(),a=this._getClampedPixelRatio(n[0],n[1]);this._resizeCanvas(n[0],n[1],a);const c=this._controlContainer=q.create("div","maplibregl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((_=>{p[_]=q.create("div",`maplibregl-ctrl-${_} `,c)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,e,n){this._canvas.width=Math.floor(n*h),this._canvas.height=Math.floor(n*e),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const h=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(a=>{e={requestedAttributes:h},a&&(e.statusMessage=a.statusMessage,e.type=a.type)}),{once:!0});let n=null;if(n=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,h):this._canvas.getContext("webgl2",h)||this._canvas.getContext("webgl",h),!n){const a="Failed to initialize WebGL";throw e?(e.message=a,new Error(JSON.stringify(e))):new Error(a)}this.painter=new kh(n,this.transform),de.testSupport(n)}migrateProjection(h,e){super.migrateProjection(h,e),this.painter.transform=h,this.fire(new o.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){var e,n,a,c,p;const _=this._idleTriggered?this._fadeDuration:0,x=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let b=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,A=he.now();this.style.zoomHistory.update(k,A);const R=new o.F(k,{now:A,fadeDuration:_,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition(),globalState:this.style.getGlobalState()}),O=R.crossFadingFactor();O===1&&O===this._crossFadingFactor||(b=!0,this._crossFadingFactor=O),this.style.update(R)}const P=((n=this.style.projection)===null||n===void 0?void 0:n.transitionState)>0!==x;(a=this.style.projection)===null||a===void 0||a.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((c=this.style.projection)===null||c===void 0?void 0:c.transitionState,(p=this.style.projection)===null||p===void 0?void 0:p.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||P)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,_,this._crossSourceCollisions,P),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,showPadding:this.showPadding}),this.fire(new o.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.cw.mark(o.cx.load),this.fire(new o.l("load"))),this.style&&(this.style.hasTransitions()||b)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const I=this._sourcesDirty||this._styleDirty||this._placementDirty;return I||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.l("idle")),!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,o.cw.mark(o.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var h;this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),ae.removeThrottleControl(this._imageQueueHandle),(h=this._resizeObserver)===null||h===void 0||h.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),o.cw.clearMetrics(),this._removed=!0,this.fire(new o.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,he.frame(this._frameRequest,(h=>{o.cw.frame(h),this._frameRequest=null;try{this._render(h)}catch(e){if(!o.cy(e)&&!(function(n){return n.message===uo})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get version(){return Wh}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(h){return this._lazyInitEmptyStyle(),this.style.setProjection(h),this._update(!0)}},T.MapMouseEvent=Li,T.MapTouchEvent=va,T.MapWheelEvent=Hc,T.Marker=Ca,T.NavigationControl=class{constructor(h){this._updateZoomButtons=()=>{const e=this._map.getZoom(),n=e===this._map.getMaxZoom(),a=e===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,n)=>{const a=this._map._getUIString(`NavigationControl.${n}`);e.title=a,e.setAttribute("aria-label",a)},this.options=o.e({},xp,h),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new bo(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,e){const n=q.create("button",h,this._container);return n.type="button",n.addEventListener("click",e),n}},T.Popup=class extends o.E{constructor(h){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const _ of this.options.className.split(" "))this._container.classList.add(_);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Nr(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const n=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let a=this.options.anchor;const c=Cl(this.options.offset);if(!a){const _=this._container.offsetWidth,x=this._container.offsetHeight;let b;b=n.y+c.bottom.y<x?["top"]:n.y>this._map.transform.height-x?["bottom"]:[],n.x<_/2?b.push("left"):n.x>this._map.transform.width-_/2&&b.push("right"),a=b.length===0?"bottom":b.join("-")}let p=n.add(c[a]);this.options.subpixelPositioning||(p=p.round()),q.setTransform(this._container,`${Pl[a]} translate(${p.x}px,${p.y}px)`),Ma(this._container,a,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(su),h)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=o.S.convert(h),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const e=document.createDocumentFragment(),n=document.createElement("body");let a;for(n.innerHTML=h;a=n.firstChild,a;)e.appendChild(a);return this.setDOMContent(e)}getMaxWidth(){var h;return(h=this._container)===null||h===void 0?void 0:h.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){return this._container&&this._container.classList.add(h),this}removeClassName(h){return this._container&&this._container.classList.remove(h),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}setSubpixelPositioning(h){this.options.subpixelPositioning=h}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(au);h&&h.focus()}},T.RasterDEMTileSource=xr,T.RasterTileSource=Gr,T.ScaleControl=class{constructor(h){this._onMove=()=>{Ml(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Ml(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},wo),h)}getDefaultPosition(){return"bottom-left"}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=Nh,T.Style=Sc,T.TerrainControl=class{constructor(h){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=h}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=vl,T.TwoFingersTouchRotateHandler=Sa,T.TwoFingersTouchZoomHandler=yl,T.TwoFingersTouchZoomRotateHandler=$h,T.VectorTileSource=mr,T.VideoSource=Sr,T.addSourceType=(h,e)=>o._(void 0,void 0,void 0,(function*(){if(Br(h))throw new Error(`A source type called "${h}" already exists.`);((n,a)=>{gr[n]=a})(h,e)})),T.clearPrewarmedResources=function(){const h=Kt;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(lr),Kt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.createTileMesh=wc,T.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return Ui().getRTLTextPluginStatus()},T.getVersion=function(){return ou},T.getWorkerCount=function(){return Nt.workerCount},T.getWorkerUrl=function(){return o.a.WORKER_URL},T.importScriptInWorkers=function(h){return Jr().broadcast("IS",h)},T.prewarm=function(){vr().acquire(lr)},T.setMaxParallelImageRequests=function(h){o.a.MAX_PARALLEL_IMAGE_REQUESTS=h},T.setRTLTextPlugin=function(h,e){return Ui().setRTLTextPlugin(h,e)},T.setWorkerCount=function(h){Nt.workerCount=h},T.setWorkerUrl=function(h){o.a.WORKER_URL=h}}));var z=g;return z}))})(vd)),vd.exports}var fc=ow();const rm=sw(fc),NS=P0({__proto__:null,default:rm},[fc]);var lw=Xt('<button type="button"><div><!></div></button>');function cw(u,d){let g=hr(d,"icon",3,!0),w=hr(d,"center",3,!0),C=hr(d,"title",3,void 0),z=hr(d,"class",3,void 0);var T=lw();T.__click=function(...X){d.onclick?.apply(this,X)};var o=tt(T);let B;var K=tt(o);Ga(K,()=>d.children??fr),Zr(X=>{na(T,"title",C()),B=Yf(o,1,Ay(z()),"svelte-sbz81i",B,X)},[()=>({"maplibregl-ctrl-icon":g(),"ctrl-btn-center":w()})]),_t(u,T)}As(["click"]);const{LngLatBounds:uw,LngLat:hw}=rm;function pd(u,d){return Math.abs(u-d)<1e-6}function VS(u,d){let g=uw.convert(u);if(!d)return{equal:!1,bounds:g};let w=g.getNorthEast(),C=d.getNorthEast();if(!pd(w.lat,C.lat)||!pd(w.wrap().lng,C.wrap().lng))return{equal:!1,bounds:g};let z=g.getSouthWest(),T=d.getSouthWest();return!pd(z.lat,T.lat)||!pd(z.wrap().lng,T.wrap().lng)?{equal:!1,bounds:g}:{equal:!0,bounds:g}}function US(u,d){const g=u.getSouthWest(),w=u.getNorthEast();if(Array.isArray(d)){if(d.length===4)return[g.lng,g.lat,w.lng,w.lat];if(d.length===2)return d[0]instanceof hw?[g,w]:[[g.lng,g.lat],[w.lng,w.lat]]}return u}function dw(u,d){u.key===" "&&(u.preventDefault(),u.stopPropagation(),d("click"))}var pw=(u,d)=>{u.stopPropagation(),d("click")},fw=(u,d)=>{u.stopPropagation(),d("dblclick")},mw=(u,d)=>{u.stopPropagation(),u.preventDefault(),d("contextmenu")},gw=(u,d)=>d("mousemove"),_w=Xt("<div><!></div>");function $S(u,d){ss(d,!0);let g=hr(d,"marker",15,void 0),w=hr(d,"lngLat",15),C=hr(d,"class",3,void 0),z=hr(d,"interactive",3,!0),T=hr(d,"asButton",3,!1),o=hr(d,"draggable",3,!1),B=hr(d,"feature",3,void 0),K=hr(d,"offset",3,void 0),X=hr(d,"zIndex",3,void 0),ce=hr(d,"rotation",3,0),he=hr(d,"opacity",3,1),q=u1(d,["$$slots","$$events","$$legacy","marker","lngLat","class","interactive","asButton","draggable","feature","offset","zIndex","rotation","opacity","anchor","children"]);const de=ar(rw),Se=ar(()=>De(de).map),Me=ar(()=>De(de).markerClickManager),{layerEvent:ke,marker:Ce}=iw();function Ee(rt){Ce.value=new rm.Marker({element:rt,rotation:ce(),draggable:o(),offset:K(),anchor:d.anchor,opacity:he().toString()}).setLngLat(w()).addTo(De(Se)),g(Ce.value);const nt=()=>Oe("dragstart"),mt=()=>{Re(),Oe("drag")},At=()=>{Re(),Oe("dragend")};return o()&&(Ce.value.on("dragstart",nt),Ce.value.on("drag",mt),Ce.value.on("dragend",At)),{destroy(){o()&&(Ce.value?.off("dragstart",nt),Ce.value?.off("drag",mt),Ce.value?.off("dragend",At)),g(void 0),Ce.value?.remove()}}}function ae(rt,nt){const mt=rt.className;function At(St){St?rt.className=`${mt} ${St}`:rt.className=mt}return At(nt),{update:At}}let $e=new Bo(w());ew($e),Oa(()=>{Ce.value?.setLngLat(w()),$e.value=w()}),Oa(()=>{K()&&Ce.value?.setOffset(K())}),Oa(()=>{Ce.value?.setRotation(ce())}),Oa(()=>{Ce.value?.setOpacity(he().toString())});function Re(){let rt=Ce.value?.getLngLat();rt&&(Array.isArray(w())?w([rt.lng,rt.lat]):w()&&"lon"in w()?w({lon:rt.lng,lat:rt.lat}):w(rt))}function Oe(rt){if(!z())return;let nt=Ce.value?.getLngLat();if(!nt)return;const mt=[nt.lng,nt.lat];let At={map:De(Se),marker:Ce.value,lngLat:mt,features:[{type:"Feature",properties:B()?.properties??{},geometry:{type:"Point",coordinates:mt}}]};(rt==="click"||rt==="contextmenu")&&De(Me).handleClick(At),ke.value={...At,layerType:"marker",type:rt};const St=q["on"+rt];St?.(At)}var Xe=_w();Xe.__click=[pw,Oe],Xe.__dblclick=[fw,Oe],Xe.__contextmenu=[mw,Oe],Xe.__mousemove=[gw,Oe],Xe.__keydown=[dw,Oe];let gt;var at=tt(Xe);Ga(at,()=>d.children??fr,()=>({marker:Ce.value})),n_(Xe,rt=>Ee?.(rt)),n_(Xe,(rt,nt)=>ae?.(rt,nt),C),Zr(rt=>{na(Xe,"tabindex",T()?0:void 0),na(Xe,"role",T()?"button":void 0),gt=ky(Xe,"",gt,rt)},[()=>({"z-index":X()})]),Id("mouseenter",Xe,()=>{Oe("mouseenter")}),Id("mouseleave",Xe,()=>{Oe("mouseleave")}),_t(u,Xe),as()}As(["click","dblclick","contextmenu","mousemove","keydown"]);var Yl=Math.pow,zi=(u,d,g)=>new Promise((w,C)=>{var z=B=>{try{o(g.next(B))}catch(K){C(K)}},T=B=>{try{o(g.throw(B))}catch(K){C(K)}},o=B=>B.done?w(B.value):Promise.resolve(B.value).then(z,T);o((g=g.apply(u,d)).next())}),Pn=Uint8Array,Lu=Uint16Array,yw=Int32Array,Xy=new Pn([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ky=new Pn([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vw=new Pn([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Yy=function(u,d){for(var g=new Lu(31),w=0;w<31;++w)g[w]=d+=1<<u[w-1];for(var C=new yw(g[30]),w=1;w<30;++w)for(var z=g[w];z<g[w+1];++z)C[z]=z-g[w]<<5|w;return{b:g,r:C}},Jy=Yy(Xy,2),Qy=Jy.b,xw=Jy.r;Qy[28]=258,xw[258]=28;var bw=Yy(Ky,0),ww=bw.b,ev=new Lu(32768);for(or=0;or<32768;++or)Qs=(or&43690)>>1|(or&21845)<<1,Qs=(Qs&52428)>>2|(Qs&13107)<<2,Qs=(Qs&61680)>>4|(Qs&3855)<<4,ev[or]=((Qs&65280)>>8|(Qs&255)<<8)>>1;var Qs,or,Bu=function(u,d,g){for(var w=u.length,C=0,z=new Lu(d);C<w;++C)u[C]&&++z[u[C]-1];var T=new Lu(d);for(C=1;C<d;++C)T[C]=T[C-1]+z[C-1]<<1;var o;{o=new Lu(1<<d);var B=15-d;for(C=0;C<w;++C)if(u[C])for(var K=C<<4|u[C],X=d-u[C],ce=T[u[C]-1]++<<X,he=ce|(1<<X)-1;ce<=he;++ce)o[ev[ce]>>B]=K}return o},Ju=new Pn(288);for(or=0;or<144;++or)Ju[or]=8;var or;for(or=144;or<256;++or)Ju[or]=9;var or;for(or=256;or<280;++or)Ju[or]=7;var or;for(or=280;or<288;++or)Ju[or]=8;var or,tv=new Pn(32);for(or=0;or<32;++or)tv[or]=5;var or,Tw=Bu(Ju,9),Sw=Bu(tv,5),yf=function(u){for(var d=u[0],g=1;g<u.length;++g)u[g]>d&&(d=u[g]);return d},Yn=function(u,d,g){var w=d/8|0;return(u[w]|u[w+1]<<8)>>(d&7)&g},vf=function(u,d){var g=d/8|0;return(u[g]|u[g+1]<<8|u[g+2]<<16)>>(d&7)},Pw=function(u){return(u+7)/8|0},Mw=function(u,d,g){(g==null||g>u.length)&&(g=u.length);var w=new Pn(g-d);return w.set(u.subarray(d,g)),w},Cw=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Sn=function(u,d,g){var w=new Error(d||Cw[u]);if(w.code=u,Error.captureStackTrace&&Error.captureStackTrace(w,Sn),!g)throw w;return w},im=function(u,d,g,w){var C=u.length,z=0;if(!C||d.f&&!d.l)return g||new Pn(0);var T=!g||d.i!=2,o=d.i;g||(g=new Pn(C*3));var B=function(Ft){var Ot=g.length;if(Ft>Ot){var Rt=new Pn(Math.max(Ot*2,Ft));Rt.set(g),g=Rt}},K=d.f||0,X=d.p||0,ce=d.b||0,he=d.l,q=d.d,de=d.m,Se=d.n,Me=C*8;do{if(!he){K=Yn(u,X,1);var ke=Yn(u,X+1,3);if(X+=3,ke)if(ke==1)he=Tw,q=Sw,de=9,Se=5;else if(ke==2){var $e=Yn(u,X,31)+257,Re=Yn(u,X+10,15)+4,Oe=$e+Yn(u,X+5,31)+1;X+=14;for(var Xe=new Pn(Oe),gt=new Pn(19),at=0;at<Re;++at)gt[vw[at]]=Yn(u,X+at*3,7);X+=Re*3;for(var rt=yf(gt),nt=(1<<rt)-1,mt=Bu(gt,rt),at=0;at<Oe;){var At=mt[Yn(u,X,nt)];X+=At&15;var Ce=At>>4;if(Ce<16)Xe[at++]=Ce;else{var St=0,jt=0;for(Ce==16?(jt=3+Yn(u,X,3),X+=2,St=Xe[at-1]):Ce==17?(jt=3+Yn(u,X,7),X+=3):Ce==18&&(jt=11+Yn(u,X,127),X+=7);jt--;)Xe[at++]=St}}var Mt=Xe.subarray(0,$e),pt=Xe.subarray($e);de=yf(Mt),Se=yf(pt),he=Bu(Mt,de),q=Bu(pt,Se)}else Sn(1);else{var Ce=Pw(X)+4,Ee=u[Ce-4]|u[Ce-3]<<8,ae=Ce+Ee;if(ae>C){o&&Sn(0);break}T&&B(ce+Ee),g.set(u.subarray(Ce,ae),ce),d.b=ce+=Ee,d.p=X=ae*8,d.f=K;continue}if(X>Me){o&&Sn(0);break}}T&&B(ce+131072);for(var ht=(1<<de)-1,lr=(1<<Se)-1,Nt=X;;Nt=X){var St=he[vf(u,X)&ht],qt=St>>4;if(X+=St&15,X>Me){o&&Sn(0);break}if(St||Sn(2),qt<256)g[ce++]=qt;else if(qt==256){Nt=X,he=null;break}else{var Kt=qt-254;if(qt>264){var at=qt-257,Jt=Xy[at];Kt=Yn(u,X,(1<<Jt)-1)+Qy[at],X+=Jt}var vr=q[vf(u,X)&lr],Qt=vr>>4;vr||Sn(3),X+=vr&15;var pt=ww[Qt];if(Qt>3){var Jt=Ky[Qt];pt+=vf(u,X)&(1<<Jt)-1,X+=Jt}if(X>Me){o&&Sn(0);break}T&&B(ce+131072);var Jr=ce+Kt;if(ce<pt){var Vt=z-pt,kt=Math.min(pt,Jr);for(Vt+ce<0&&Sn(3);ce<kt;++ce)g[ce]=w[Vt+ce]}for(;ce<Jr;ce+=4)g[ce]=g[ce-pt],g[ce+1]=g[ce+1-pt],g[ce+2]=g[ce+2-pt],g[ce+3]=g[ce+3-pt];ce=Jr}}d.l=he,d.p=Nt,d.b=ce,d.f=K,he&&(K=1,d.m=de,d.d=q,d.n=Se)}while(!K);return ce==g.length?g:Mw(g,0,ce)},Iw=new Pn(0),Ew=function(u){(u[0]!=31||u[1]!=139||u[2]!=8)&&Sn(6,"invalid gzip data");var d=u[3],g=10;d&4&&(g+=(u[10]|u[11]<<8)+2);for(var w=(d>>3&1)+(d>>4&1);w>0;w-=!u[g++]);return g+(d&2)},Aw=function(u){var d=u.length;return(u[d-4]|u[d-3]<<8|u[d-2]<<16|u[d-1]<<24)>>>0},kw=function(u,d){return((u[0]&15)!=8||u[0]>>4>7||(u[0]<<8|u[1])%31)&&Sn(6,"invalid zlib data"),(u[1]>>5&1)==1&&Sn(6,"invalid zlib data: "+(u[1]&32?"need":"unexpected")+" dictionary"),(u[1]>>3&4)+2};function zw(u,d){return im(u,{i:2},d,d)}function Dw(u,d){var g=Ew(u);return g+8>u.length&&Sn(6,"invalid gzip data"),im(u.subarray(g,-8),{i:2},new Pn(Aw(u)),d)}function Rw(u,d){return im(u.subarray(kw(u),-4),{i:2},d,d)}function Df(u,d){return u[0]==31&&u[1]==139&&u[2]==8?Dw(u,d):(u[0]&15)!=8||u[0]>>4>7||(u[0]<<8|u[1])%31?zw(u,d):Rw(u,d)}var Lw=typeof TextDecoder<"u"&&new TextDecoder,Bw=0;try{Lw.decode(Iw,{stream:!0}),Bw=1}catch{}var rv=(u,d)=>u*Yl(2,d),Iu=(u,d)=>Math.floor(u/Yl(2,d)),kd=(u,d)=>rv(u.getUint16(d+1,!0),8)+u.getUint8(d),iv=(u,d)=>rv(u.getUint32(d+2,!0),16)+u.getUint16(d,!0),Fw=(u,d,g,w,C)=>{if(u!==w.getUint8(C))return u-w.getUint8(C);const z=kd(w,C+1);if(d!==z)return d-z;const T=kd(w,C+4);return g!==T?g-T:0},Ow=(u,d,g,w)=>{const C=nv(u,d|128,g,w);return C?{z:d,x:g,y:w,offset:C[0],length:C[1],isDir:!0}:null},y_=(u,d,g,w)=>{const C=nv(u,d,g,w);return C?{z:d,x:g,y:w,offset:C[0],length:C[1],isDir:!1}:null},nv=(u,d,g,w)=>{let C=0,z=u.byteLength/17-1;for(;C<=z;){const T=z+C>>1,o=Fw(d,g,w,u,T*17);if(o>0)C=T+1;else if(o<0)z=T-1;else return[iv(u,T*17+7),u.getUint32(T*17+13,!0)]}return null},jw=(u,d)=>u.isDir&&!d.isDir?1:!u.isDir&&d.isDir?-1:u.z!==d.z?u.z-d.z:u.x!==d.x?u.x-d.x:u.y-d.y,sv=(u,d)=>{const g=u.getUint8(d*17);return{z:g&127,x:kd(u,d*17+1),y:kd(u,d*17+4),offset:iv(u,d*17+7),length:u.getUint32(d*17+13,!0),isDir:g>>7===1}},v_=u=>{const d=[],g=new DataView(u);for(let w=0;w<g.byteLength/17;w++)d.push(sv(g,w));return Nw(d)},Nw=u=>{u.sort(jw);const d=new ArrayBuffer(17*u.length),g=new Uint8Array(d);for(let w=0;w<u.length;w++){const C=u[w];let z=C.z;C.isDir&&(z=z|128),g[w*17]=z,g[w*17+1]=C.x&255,g[w*17+2]=C.x>>8&255,g[w*17+3]=C.x>>16&255,g[w*17+4]=C.y&255,g[w*17+5]=C.y>>8&255,g[w*17+6]=C.y>>16&255,g[w*17+7]=C.offset&255,g[w*17+8]=Iu(C.offset,8)&255,g[w*17+9]=Iu(C.offset,16)&255,g[w*17+10]=Iu(C.offset,24)&255,g[w*17+11]=Iu(C.offset,32)&255,g[w*17+12]=Iu(C.offset,48)&255,g[w*17+13]=C.length&255,g[w*17+14]=C.length>>8&255,g[w*17+15]=C.length>>16&255,g[w*17+16]=C.length>>24&255}return d},Vw=(u,d)=>{if(u.byteLength<17)return null;const g=u.byteLength/17,w=sv(u,g-1);if(w.isDir){const C=w.z,z=d.z-C,T=Math.trunc(d.x/(1<<z)),o=Math.trunc(d.y/(1<<z));return{z:C,x:T,y:o}}return null};function Uw(u){return zi(this,null,function*(){const d=yield u.getBytes(0,512e3),g=new DataView(d.data),w=g.getUint32(4,!0),C=g.getUint16(8,!0),z=new TextDecoder("utf-8"),T=JSON.parse(z.decode(new DataView(d.data,10,w)));let o=0;T.compression==="gzip"&&(o=2);let B=0;"minzoom"in T&&(B=+T.minzoom);let K=0;"maxzoom"in T&&(K=+T.maxzoom);let X=0,ce=0,he=0,q=-180,de=-85,Se=180,Me=85;if(T.bounds){const Ce=T.bounds.split(",");q=+Ce[0],de=+Ce[1],Se=+Ce[2],Me=+Ce[3]}if(T.center){const Ce=T.center.split(",");X=+Ce[0],ce=+Ce[1],he=+Ce[2]}return{specVersion:g.getUint16(2,!0),rootDirectoryOffset:10+w,rootDirectoryLength:C*17,jsonMetadataOffset:10,jsonMetadataLength:w,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:o,tileType:1,minZoom:B,maxZoom:K,minLon:q,minLat:de,maxLon:Se,maxLat:Me,centerZoom:he,centerLon:X,centerLat:ce,etag:d.etag}})}function $w(u,d,g,w,C,z,T){return zi(this,null,function*(){let o=yield g.getArrayBuffer(d,u.rootDirectoryOffset,u.rootDirectoryLength,u);u.specVersion===1&&(o=v_(o));const B=y_(new DataView(o),w,C,z);if(B){let ce=(yield d.getBytes(B.offset,B.length,T)).data;const he=new DataView(ce);return he.getUint8(0)===31&&he.getUint8(1)===139&&(ce=Df(new Uint8Array(ce))),{data:ce}}const K=Vw(new DataView(o),{z:w,x:C,y:z});if(K){const X=Ow(new DataView(o),K.z,K.x,K.y);if(X){let ce=yield g.getArrayBuffer(d,X.offset,X.length,u);u.specVersion===1&&(ce=v_(ce));const he=y_(new DataView(ce),w,C,z);if(he){let de=(yield d.getBytes(he.offset,he.length,T)).data;const Se=new DataView(de);return Se.getUint8(0)===31&&Se.getUint8(1)===139&&(de=Df(new Uint8Array(de))),{data:de}}}}})}var av={getHeader:Uw,getZxy:$w},Zw=u=>(d,g)=>{if(g instanceof AbortController)return u(d,g);const w=new AbortController;return u(d,w).then(C=>g(void 0,C.data,C.cacheControl||"",C.expires||""),C=>g(C)).catch(C=>g(C)),{cancel:()=>w.abort()}},ZS=class{constructor(u){this.tilev4=(d,g)=>zi(this,null,function*(){if(d.type==="json"){const he=d.url.substr(10);let q=this.tiles.get(he);if(q||(q=new x_(he),this.tiles.set(he,q)),this.metadata)return{data:yield q.getTileJson(d.url)};const de=yield q.getHeader();return{data:{tiles:[`${d.url}/{z}/{x}/{y}`],minzoom:de.minZoom,maxzoom:de.maxZoom,bounds:[de.minLon,de.minLat,de.maxLon,de.maxLat]}}}const w=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),C=d.url.match(w);if(!C)throw new Error("Invalid PMTiles protocol URL");const z=C[1];let T=this.tiles.get(z);T||(T=new x_(z),this.tiles.set(z,T));const o=C[2],B=C[3],K=C[4],X=yield T.getHeader(),ce=yield T?.getZxy(+o,+B,+K,g.signal);return ce?{data:new Uint8Array(ce.data),cacheControl:ce.cacheControl,expires:ce.expires}:X.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=Zw(this.tilev4),this.tiles=new Map,this.metadata=u?.metadata||!1}add(u){this.tiles.set(u.source.getKey(),u)}get(u){return this.tiles.get(u)}};function Wl(u,d){return(d>>>0)*4294967296+(u>>>0)}function Gw(u,d){const g=d.buf;let w=g[d.pos++],C=(w&112)>>4;if(w<128||(w=g[d.pos++],C|=(w&127)<<3,w<128)||(w=g[d.pos++],C|=(w&127)<<10,w<128)||(w=g[d.pos++],C|=(w&127)<<17,w<128)||(w=g[d.pos++],C|=(w&127)<<24,w<128)||(w=g[d.pos++],C|=(w&1)<<31,w<128))return Wl(u,C);throw new Error("Expected varint not more than 10 bytes")}function Eu(u){const d=u.buf;let g=d[u.pos++],w=g&127;return g<128||(g=d[u.pos++],w|=(g&127)<<7,g<128)||(g=d[u.pos++],w|=(g&127)<<14,g<128)||(g=d[u.pos++],w|=(g&127)<<21,g<128)?w:(g=d[u.pos],w|=(g&15)<<28,Gw(w,u))}function qw(u,d,g,w){if(w===0){g===1&&(d[0]=u-1-d[0],d[1]=u-1-d[1]);const C=d[0];d[0]=d[1],d[1]=C}}var Ww=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function Hw(u,d,g){if(u>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(d>Yl(2,u)-1||g>Yl(2,u)-1)throw Error("tile x/y outside zoom level bounds");const w=Ww[u],C=Yl(2,u);let z=0,T=0,o=0;const B=[d,g];let K=C/2;for(;K>0;)z=(B[0]&K)>0?1:0,T=(B[1]&K)>0?1:0,o+=K*K*(3*z^T),qw(K,B,z,T),K=K/2;return w+o}function ov(u,d){return zi(this,null,function*(){if(d===1||d===0)return u;if(d===2){if(typeof globalThis.DecompressionStream>"u")return Df(new Uint8Array(u));const g=new Response(u).body;if(!g)throw Error("Failed to read response stream");const w=g.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(w).arrayBuffer()}throw Error("Compression method not supported")})}function Xw(u){return u===1?".mvt":u===2?".png":u===3?".jpg":u===4?".webp":u===5?".avif":""}var Kw=127;function Yw(u,d){let g=0,w=u.length-1;for(;g<=w;){const C=w+g>>1,z=d-u[C].tileId;if(z>0)g=C+1;else if(z<0)w=C-1;else return u[C]}return w>=0&&(u[w].runLength===0||d-u[w].tileId<u[w].runLength)?u[w]:null}var Jw=class{constructor(u,d=new Headers){this.url=u,this.customHeaders=d,this.mustReload=!1;let g="";"navigator"in globalThis&&(g=globalThis.navigator.userAgent||"");const w=g.indexOf("Windows")>-1,C=/Chrome|Chromium|Edg|OPR|Brave/.test(g);this.chromeWindowsNoCache=!1,w&&C&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(u){this.customHeaders=u}getBytes(u,d,g,w){return zi(this,null,function*(){let C,z;g?z=g:(C=new AbortController,z=C.signal);const T=new Headers(this.customHeaders);T.set("range",`bytes=${u}-${u+d-1}`);let o;this.mustReload?o="reload":this.chromeWindowsNoCache&&(o="no-store");let B=yield fetch(this.url,{signal:z,cache:o,headers:T});if(u===0&&B.status===416){const he=B.headers.get("Content-Range");if(!he||!he.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const q=+he.substr(8);B=yield fetch(this.url,{signal:z,cache:"reload",headers:{range:`bytes=0-${q-1}`}})}let K=B.headers.get("Etag");if(K?.startsWith("W/")&&(K=null),B.status===416||w&&K&&K!==w)throw this.mustReload=!0,new Rf(`Server returned non-matching ETag ${w} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(B.status>=300)throw Error(`Bad response code: ${B.status}`);const X=B.headers.get("Content-Length");if(B.status===200&&(!X||+X>d))throw C&&C.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield B.arrayBuffer(),etag:K||void 0,cacheControl:B.headers.get("Cache-Control")||void 0,expires:B.headers.get("Expires")||void 0}})}};function Jn(u,d){const g=u.getUint32(d+4,!0),w=u.getUint32(d+0,!0);return g*Yl(2,32)+w}function Qw(u,d){const g=new DataView(u),w=g.getUint8(7);if(w>3)throw Error(`Archive is spec version ${w} but this library supports up to spec version 3`);return{specVersion:w,rootDirectoryOffset:Jn(g,8),rootDirectoryLength:Jn(g,16),jsonMetadataOffset:Jn(g,24),jsonMetadataLength:Jn(g,32),leafDirectoryOffset:Jn(g,40),leafDirectoryLength:Jn(g,48),tileDataOffset:Jn(g,56),tileDataLength:Jn(g,64),numAddressedTiles:Jn(g,72),numTileEntries:Jn(g,80),numTileContents:Jn(g,88),clustered:g.getUint8(96)===1,internalCompression:g.getUint8(97),tileCompression:g.getUint8(98),tileType:g.getUint8(99),minZoom:g.getUint8(100),maxZoom:g.getUint8(101),minLon:g.getInt32(102,!0)/1e7,minLat:g.getInt32(106,!0)/1e7,maxLon:g.getInt32(110,!0)/1e7,maxLat:g.getInt32(114,!0)/1e7,centerZoom:g.getUint8(118),centerLon:g.getInt32(119,!0)/1e7,centerLat:g.getInt32(123,!0)/1e7,etag:d}}function lv(u){const d={buf:new Uint8Array(u),pos:0},g=Eu(d),w=[];let C=0;for(let z=0;z<g;z++){const T=Eu(d);w.push({tileId:C+T,offset:0,length:0,runLength:1}),C+=T}for(let z=0;z<g;z++)w[z].runLength=Eu(d);for(let z=0;z<g;z++)w[z].length=Eu(d);for(let z=0;z<g;z++){const T=Eu(d);T===0&&z>0?w[z].offset=w[z-1].offset+w[z-1].length:w[z].offset=T-1}return w}function e2(u){const d=new DataView(u);return d.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):d.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Rf=class extends Error{};function t2(u,d){return zi(this,null,function*(){const g=yield u.getBytes(0,16384);if(new DataView(g.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(e2(g.data)<3)return[yield av.getHeader(u)];const C=g.data.slice(0,Kw),z=Qw(C,g.etag),T=g.data.slice(z.rootDirectoryOffset,z.rootDirectoryOffset+z.rootDirectoryLength),o=`${u.getKey()}|${z.etag||""}|${z.rootDirectoryOffset}|${z.rootDirectoryLength}`,B=lv(yield d(T,z.internalCompression));return[z,[o,B.length,B]]})}function r2(u,d,g,w,C){return zi(this,null,function*(){const z=yield u.getBytes(g,w,void 0,C.etag),T=yield d(z.data,C.internalCompression),o=lv(T);if(o.length===0)throw new Error("Empty directory is invalid");return o})}var i2=class{constructor(u=100,d=!0,g=ov){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=u,this.counter=1,this.decompress=g}getHeader(u){return zi(this,null,function*(){const d=u.getKey(),g=this.cache.get(d);if(g)return g.lastUsed=this.counter++,yield g.data;const w=new Promise((C,z)=>{t2(u,this.decompress).then(T=>{T[1]&&this.cache.set(T[1][0],{lastUsed:this.counter++,data:Promise.resolve(T[1][2])}),C(T[0]),this.prune()}).catch(T=>{z(T)})});return this.cache.set(d,{lastUsed:this.counter++,data:w}),w})}getDirectory(u,d,g,w){return zi(this,null,function*(){const C=`${u.getKey()}|${w.etag||""}|${d}|${g}`,z=this.cache.get(C);if(z)return z.lastUsed=this.counter++,yield z.data;const T=new Promise((o,B)=>{r2(u,this.decompress,d,g,w).then(K=>{o(K),this.prune()}).catch(K=>{B(K)})});return this.cache.set(C,{lastUsed:this.counter++,data:T}),T})}getArrayBuffer(u,d,g,w){return zi(this,null,function*(){const C=`${u.getKey()}|${w.etag||""}|${d}|${g}`,z=this.cache.get(C);if(z)return z.lastUsed=this.counter++,yield z.data;const T=new Promise((o,B)=>{u.getBytes(d,g,void 0,w.etag).then(K=>{o(K.data),this.cache.has(C),this.prune()}).catch(K=>{B(K)})});return this.cache.set(C,{lastUsed:this.counter++,data:T}),T})}prune(){if(this.cache.size>=this.maxCacheEntries){let u=1/0,d;this.cache.forEach((g,w)=>{g.lastUsed<u&&(u=g.lastUsed,d=w)}),d&&this.cache.delete(d)}}invalidate(u){return zi(this,null,function*(){const d=u.getKey();if(this.invalidations.get(d))return yield this.invalidations.get(d);this.cache.delete(u.getKey());const g=new Promise((w,C)=>{this.getHeader(u).then(z=>{w(),this.invalidations.delete(d)}).catch(z=>{C(z)})});this.invalidations.set(d,g)})}},x_=class{constructor(u,d,g){typeof u=="string"?this.source=new Jw(u):this.source=u,g?this.decompress=g:this.decompress=ov,d?this.cache=d:this.cache=new i2}getHeader(){return zi(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(u,d,g,w){return zi(this,null,function*(){const C=Hw(u,d,g),z=yield this.cache.getHeader(this.source);if(z.specVersion<3)return av.getZxy(z,this.source,this.cache,u,d,g,w);if(u<z.minZoom||u>z.maxZoom)return;let T=z.rootDirectoryOffset,o=z.rootDirectoryLength;for(let B=0;B<=3;B++){const K=yield this.cache.getDirectory(this.source,T,o,z),X=Yw(K,C);if(X){if(X.runLength>0){const ce=yield this.source.getBytes(z.tileDataOffset+X.offset,X.length,w,z.etag);return{data:yield this.decompress(ce.data,z.tileCompression),cacheControl:ce.cacheControl,expires:ce.expires}}T=z.leafDirectoryOffset+X.offset,o=X.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(u,d,g,w){return zi(this,null,function*(){try{return yield this.getZxyAttempt(u,d,g,w)}catch(C){if(C instanceof Rf)return this.cache.invalidate(this.source),yield this.getZxyAttempt(u,d,g,w);throw C}})}getMetadataAttempt(){return zi(this,null,function*(){const u=yield this.cache.getHeader(this.source),d=yield this.source.getBytes(u.jsonMetadataOffset,u.jsonMetadataLength,void 0,u.etag),g=yield this.decompress(d.data,u.internalCompression),w=new TextDecoder("utf-8");return JSON.parse(w.decode(g))})}getMetadata(){return zi(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(u){if(u instanceof Rf)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw u}})}getTileJson(u){return zi(this,null,function*(){const d=yield this.getHeader(),g=yield this.getMetadata(),w=Xw(d.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${u}/{z}/{x}/{y}${w}`],vector_layers:g.vector_layers,attribution:g.attribution,description:g.description,name:g.name,version:g.version,bounds:[d.minLon,d.minLat,d.maxLon,d.maxLat],center:[d.centerLon,d.centerLat,d.centerZoom],minzoom:d.minZoom,maxzoom:d.maxZoom}})}};function n2(u,d,g){u.target==De(d)&&(u.stopPropagation(),g(!1))}function s2(u,d){(u.key=="Escape"||u.key=="Enter")&&(u.stopPropagation(),d(!1))}var a2=Xt('<dialog class="svelte-1f8bzsb"><div class="svelte-1f8bzsb"><!></div></dialog>');function o2(u,d){ss(d,!0);let g=hr(d,"show",15,!1),w=si(void 0);Oa(()=>{De(w)&&(g()?De(w).showModal():De(w).close())});var C=a2();C.__click=[n2,w,g],C.__keydown=[s2,g];var z=tt(C),T=tt(z);Ga(T,()=>d.children??fr),s1(C,o=>Tr(w,o),()=>De(w)),_t(u,C),as()}As(["click","keydown"]);function l2(u,d){let g=document.createElement("a");g.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(d)),g.setAttribute("download",u),document.body.appendChild(g),g.click(),document.body.removeChild(g)}async function GS(u,d){let g=await fetch(u);if(!g.ok)throw new Error(`${u} not OK: ${g.status}`);let w=g.body.getReader(),C=g.headers.get("Content-Length");if(!C)throw new Error(`No Content-Length header from ${u}`);let z=parseInt(C),T=0,o=[];for(;;){let{done:X,value:ce}=await w.read();if(X)break;ce&&(o.push(ce),T+=ce.length,d(100*T/z))}let B=new Uint8Array(T),K=0;for(let X of o)B.set(X,K),K+=X.length;return B}var rn="top",jn="bottom",Nn="right",nn="left",nm="auto",Qu=[rn,jn,Nn,nn],ic="start",Uu="end",c2="clippingParents",cv="viewport",Au="popper",u2="reference",b_=Qu.reduce(function(u,d){return u.concat([d+"-"+ic,d+"-"+Uu])},[]),uv=[].concat(Qu,[nm]).reduce(function(u,d){return u.concat([d,d+"-"+ic,d+"-"+Uu])},[]),h2="beforeRead",d2="read",p2="afterRead",f2="beforeMain",m2="main",g2="afterMain",_2="beforeWrite",y2="write",v2="afterWrite",x2=[h2,d2,p2,f2,m2,g2,_2,y2,v2];function Is(u){return u?(u.nodeName||"").toLowerCase():null}function Cn(u){if(u==null)return window;if(u.toString()!=="[object Window]"){var d=u.ownerDocument;return d&&d.defaultView||window}return u}function Fo(u){var d=Cn(u).Element;return u instanceof d||u instanceof Element}function Bn(u){var d=Cn(u).HTMLElement;return u instanceof d||u instanceof HTMLElement}function sm(u){if(typeof ShadowRoot>"u")return!1;var d=Cn(u).ShadowRoot;return u instanceof d||u instanceof ShadowRoot}function b2(u){var d=u.state;Object.keys(d.elements).forEach(function(g){var w=d.styles[g]||{},C=d.attributes[g]||{},z=d.elements[g];!Bn(z)||!Is(z)||(Object.assign(z.style,w),Object.keys(C).forEach(function(T){var o=C[T];o===!1?z.removeAttribute(T):z.setAttribute(T,o===!0?"":o)}))})}function w2(u){var d=u.state,g={popper:{position:d.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(d.elements.popper.style,g.popper),d.styles=g,d.elements.arrow&&Object.assign(d.elements.arrow.style,g.arrow),function(){Object.keys(d.elements).forEach(function(w){var C=d.elements[w],z=d.attributes[w]||{},T=Object.keys(d.styles.hasOwnProperty(w)?d.styles[w]:g[w]),o=T.reduce(function(B,K){return B[K]="",B},{});!Bn(C)||!Is(C)||(Object.assign(C.style,o),Object.keys(z).forEach(function(B){C.removeAttribute(B)}))})}}const hv={name:"applyStyles",enabled:!0,phase:"write",fn:b2,effect:w2,requires:["computeStyles"]};function Ms(u){return u.split("-")[0]}var Ro=Math.max,zd=Math.min,nc=Math.round;function Lf(){var u=navigator.userAgentData;return u!=null&&u.brands&&Array.isArray(u.brands)?u.brands.map(function(d){return d.brand+"/"+d.version}).join(" "):navigator.userAgent}function dv(){return!/^((?!chrome|android).)*safari/i.test(Lf())}function sc(u,d,g){d===void 0&&(d=!1),g===void 0&&(g=!1);var w=u.getBoundingClientRect(),C=1,z=1;d&&Bn(u)&&(C=u.offsetWidth>0&&nc(w.width)/u.offsetWidth||1,z=u.offsetHeight>0&&nc(w.height)/u.offsetHeight||1);var T=Fo(u)?Cn(u):window,o=T.visualViewport,B=!dv()&&g,K=(w.left+(B&&o?o.offsetLeft:0))/C,X=(w.top+(B&&o?o.offsetTop:0))/z,ce=w.width/C,he=w.height/z;return{width:ce,height:he,top:X,right:K+ce,bottom:X+he,left:K,x:K,y:X}}function am(u){var d=sc(u),g=u.offsetWidth,w=u.offsetHeight;return Math.abs(d.width-g)<=1&&(g=d.width),Math.abs(d.height-w)<=1&&(w=d.height),{x:u.offsetLeft,y:u.offsetTop,width:g,height:w}}function pv(u,d){var g=d.getRootNode&&d.getRootNode();if(u.contains(d))return!0;if(g&&sm(g)){var w=d;do{if(w&&u.isSameNode(w))return!0;w=w.parentNode||w.host}while(w)}return!1}function sa(u){return Cn(u).getComputedStyle(u)}function T2(u){return["table","td","th"].indexOf(Is(u))>=0}function Ha(u){return((Fo(u)?u.ownerDocument:u.document)||window.document).documentElement}function Zd(u){return Is(u)==="html"?u:u.assignedSlot||u.parentNode||(sm(u)?u.host:null)||Ha(u)}function w_(u){return!Bn(u)||sa(u).position==="fixed"?null:u.offsetParent}function S2(u){var d=/firefox/i.test(Lf()),g=/Trident/i.test(Lf());if(g&&Bn(u)){var w=sa(u);if(w.position==="fixed")return null}var C=Zd(u);for(sm(C)&&(C=C.host);Bn(C)&&["html","body"].indexOf(Is(C))<0;){var z=sa(C);if(z.transform!=="none"||z.perspective!=="none"||z.contain==="paint"||["transform","perspective"].indexOf(z.willChange)!==-1||d&&z.willChange==="filter"||d&&z.filter&&z.filter!=="none")return C;C=C.parentNode}return null}function eh(u){for(var d=Cn(u),g=w_(u);g&&T2(g)&&sa(g).position==="static";)g=w_(g);return g&&(Is(g)==="html"||Is(g)==="body"&&sa(g).position==="static")?d:g||S2(u)||d}function om(u){return["top","bottom"].indexOf(u)>=0?"x":"y"}function Fu(u,d,g){return Ro(u,zd(d,g))}function P2(u,d,g){var w=Fu(u,d,g);return w>g?g:w}function fv(){return{top:0,right:0,bottom:0,left:0}}function mv(u){return Object.assign({},fv(),u)}function gv(u,d){return d.reduce(function(g,w){return g[w]=u,g},{})}var M2=function(d,g){return d=typeof d=="function"?d(Object.assign({},g.rects,{placement:g.placement})):d,mv(typeof d!="number"?d:gv(d,Qu))};function C2(u){var d,g=u.state,w=u.name,C=u.options,z=g.elements.arrow,T=g.modifiersData.popperOffsets,o=Ms(g.placement),B=om(o),K=[nn,Nn].indexOf(o)>=0,X=K?"height":"width";if(!(!z||!T)){var ce=M2(C.padding,g),he=am(z),q=B==="y"?rn:nn,de=B==="y"?jn:Nn,Se=g.rects.reference[X]+g.rects.reference[B]-T[B]-g.rects.popper[X],Me=T[B]-g.rects.reference[B],ke=eh(z),Ce=ke?B==="y"?ke.clientHeight||0:ke.clientWidth||0:0,Ee=Se/2-Me/2,ae=ce[q],$e=Ce-he[X]-ce[de],Re=Ce/2-he[X]/2+Ee,Oe=Fu(ae,Re,$e),Xe=B;g.modifiersData[w]=(d={},d[Xe]=Oe,d.centerOffset=Oe-Re,d)}}function I2(u){var d=u.state,g=u.options,w=g.element,C=w===void 0?"[data-popper-arrow]":w;C!=null&&(typeof C=="string"&&(C=d.elements.popper.querySelector(C),!C)||pv(d.elements.popper,C)&&(d.elements.arrow=C))}const E2={name:"arrow",enabled:!0,phase:"main",fn:C2,effect:I2,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ac(u){return u.split("-")[1]}var A2={top:"auto",right:"auto",bottom:"auto",left:"auto"};function k2(u,d){var g=u.x,w=u.y,C=d.devicePixelRatio||1;return{x:nc(g*C)/C||0,y:nc(w*C)/C||0}}function T_(u){var d,g=u.popper,w=u.popperRect,C=u.placement,z=u.variation,T=u.offsets,o=u.position,B=u.gpuAcceleration,K=u.adaptive,X=u.roundOffsets,ce=u.isFixed,he=T.x,q=he===void 0?0:he,de=T.y,Se=de===void 0?0:de,Me=typeof X=="function"?X({x:q,y:Se}):{x:q,y:Se};q=Me.x,Se=Me.y;var ke=T.hasOwnProperty("x"),Ce=T.hasOwnProperty("y"),Ee=nn,ae=rn,$e=window;if(K){var Re=eh(g),Oe="clientHeight",Xe="clientWidth";if(Re===Cn(g)&&(Re=Ha(g),sa(Re).position!=="static"&&o==="absolute"&&(Oe="scrollHeight",Xe="scrollWidth")),Re=Re,C===rn||(C===nn||C===Nn)&&z===Uu){ae=jn;var gt=ce&&Re===$e&&$e.visualViewport?$e.visualViewport.height:Re[Oe];Se-=gt-w.height,Se*=B?1:-1}if(C===nn||(C===rn||C===jn)&&z===Uu){Ee=Nn;var at=ce&&Re===$e&&$e.visualViewport?$e.visualViewport.width:Re[Xe];q-=at-w.width,q*=B?1:-1}}var rt=Object.assign({position:o},K&&A2),nt=X===!0?k2({x:q,y:Se},Cn(g)):{x:q,y:Se};if(q=nt.x,Se=nt.y,B){var mt;return Object.assign({},rt,(mt={},mt[ae]=Ce?"0":"",mt[Ee]=ke?"0":"",mt.transform=($e.devicePixelRatio||1)<=1?"translate("+q+"px, "+Se+"px)":"translate3d("+q+"px, "+Se+"px, 0)",mt))}return Object.assign({},rt,(d={},d[ae]=Ce?Se+"px":"",d[Ee]=ke?q+"px":"",d.transform="",d))}function z2(u){var d=u.state,g=u.options,w=g.gpuAcceleration,C=w===void 0?!0:w,z=g.adaptive,T=z===void 0?!0:z,o=g.roundOffsets,B=o===void 0?!0:o,K={placement:Ms(d.placement),variation:ac(d.placement),popper:d.elements.popper,popperRect:d.rects.popper,gpuAcceleration:C,isFixed:d.options.strategy==="fixed"};d.modifiersData.popperOffsets!=null&&(d.styles.popper=Object.assign({},d.styles.popper,T_(Object.assign({},K,{offsets:d.modifiersData.popperOffsets,position:d.options.strategy,adaptive:T,roundOffsets:B})))),d.modifiersData.arrow!=null&&(d.styles.arrow=Object.assign({},d.styles.arrow,T_(Object.assign({},K,{offsets:d.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:B})))),d.attributes.popper=Object.assign({},d.attributes.popper,{"data-popper-placement":d.placement})}const D2={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:z2,data:{}};var fd={passive:!0};function R2(u){var d=u.state,g=u.instance,w=u.options,C=w.scroll,z=C===void 0?!0:C,T=w.resize,o=T===void 0?!0:T,B=Cn(d.elements.popper),K=[].concat(d.scrollParents.reference,d.scrollParents.popper);return z&&K.forEach(function(X){X.addEventListener("scroll",g.update,fd)}),o&&B.addEventListener("resize",g.update,fd),function(){z&&K.forEach(function(X){X.removeEventListener("scroll",g.update,fd)}),o&&B.removeEventListener("resize",g.update,fd)}}const L2={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:R2,data:{}};var B2={left:"right",right:"left",bottom:"top",top:"bottom"};function xd(u){return u.replace(/left|right|bottom|top/g,function(d){return B2[d]})}var F2={start:"end",end:"start"};function S_(u){return u.replace(/start|end/g,function(d){return F2[d]})}function lm(u){var d=Cn(u),g=d.pageXOffset,w=d.pageYOffset;return{scrollLeft:g,scrollTop:w}}function cm(u){return sc(Ha(u)).left+lm(u).scrollLeft}function O2(u,d){var g=Cn(u),w=Ha(u),C=g.visualViewport,z=w.clientWidth,T=w.clientHeight,o=0,B=0;if(C){z=C.width,T=C.height;var K=dv();(K||!K&&d==="fixed")&&(o=C.offsetLeft,B=C.offsetTop)}return{width:z,height:T,x:o+cm(u),y:B}}function j2(u){var d,g=Ha(u),w=lm(u),C=(d=u.ownerDocument)==null?void 0:d.body,z=Ro(g.scrollWidth,g.clientWidth,C?C.scrollWidth:0,C?C.clientWidth:0),T=Ro(g.scrollHeight,g.clientHeight,C?C.scrollHeight:0,C?C.clientHeight:0),o=-w.scrollLeft+cm(u),B=-w.scrollTop;return sa(C||g).direction==="rtl"&&(o+=Ro(g.clientWidth,C?C.clientWidth:0)-z),{width:z,height:T,x:o,y:B}}function um(u){var d=sa(u),g=d.overflow,w=d.overflowX,C=d.overflowY;return/auto|scroll|overlay|hidden/.test(g+C+w)}function _v(u){return["html","body","#document"].indexOf(Is(u))>=0?u.ownerDocument.body:Bn(u)&&um(u)?u:_v(Zd(u))}function Ou(u,d){var g;d===void 0&&(d=[]);var w=_v(u),C=w===((g=u.ownerDocument)==null?void 0:g.body),z=Cn(w),T=C?[z].concat(z.visualViewport||[],um(w)?w:[]):w,o=d.concat(T);return C?o:o.concat(Ou(Zd(T)))}function Bf(u){return Object.assign({},u,{left:u.x,top:u.y,right:u.x+u.width,bottom:u.y+u.height})}function N2(u,d){var g=sc(u,!1,d==="fixed");return g.top=g.top+u.clientTop,g.left=g.left+u.clientLeft,g.bottom=g.top+u.clientHeight,g.right=g.left+u.clientWidth,g.width=u.clientWidth,g.height=u.clientHeight,g.x=g.left,g.y=g.top,g}function P_(u,d,g){return d===cv?Bf(O2(u,g)):Fo(d)?N2(d,g):Bf(j2(Ha(u)))}function V2(u){var d=Ou(Zd(u)),g=["absolute","fixed"].indexOf(sa(u).position)>=0,w=g&&Bn(u)?eh(u):u;return Fo(w)?d.filter(function(C){return Fo(C)&&pv(C,w)&&Is(C)!=="body"}):[]}function U2(u,d,g,w){var C=d==="clippingParents"?V2(u):[].concat(d),z=[].concat(C,[g]),T=z[0],o=z.reduce(function(B,K){var X=P_(u,K,w);return B.top=Ro(X.top,B.top),B.right=zd(X.right,B.right),B.bottom=zd(X.bottom,B.bottom),B.left=Ro(X.left,B.left),B},P_(u,T,w));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function yv(u){var d=u.reference,g=u.element,w=u.placement,C=w?Ms(w):null,z=w?ac(w):null,T=d.x+d.width/2-g.width/2,o=d.y+d.height/2-g.height/2,B;switch(C){case rn:B={x:T,y:d.y-g.height};break;case jn:B={x:T,y:d.y+d.height};break;case Nn:B={x:d.x+d.width,y:o};break;case nn:B={x:d.x-g.width,y:o};break;default:B={x:d.x,y:d.y}}var K=C?om(C):null;if(K!=null){var X=K==="y"?"height":"width";switch(z){case ic:B[K]=B[K]-(d[X]/2-g[X]/2);break;case Uu:B[K]=B[K]+(d[X]/2-g[X]/2);break}}return B}function $u(u,d){d===void 0&&(d={});var g=d,w=g.placement,C=w===void 0?u.placement:w,z=g.strategy,T=z===void 0?u.strategy:z,o=g.boundary,B=o===void 0?c2:o,K=g.rootBoundary,X=K===void 0?cv:K,ce=g.elementContext,he=ce===void 0?Au:ce,q=g.altBoundary,de=q===void 0?!1:q,Se=g.padding,Me=Se===void 0?0:Se,ke=mv(typeof Me!="number"?Me:gv(Me,Qu)),Ce=he===Au?u2:Au,Ee=u.rects.popper,ae=u.elements[de?Ce:he],$e=U2(Fo(ae)?ae:ae.contextElement||Ha(u.elements.popper),B,X,T),Re=sc(u.elements.reference),Oe=yv({reference:Re,element:Ee,placement:C}),Xe=Bf(Object.assign({},Ee,Oe)),gt=he===Au?Xe:Re,at={top:$e.top-gt.top+ke.top,bottom:gt.bottom-$e.bottom+ke.bottom,left:$e.left-gt.left+ke.left,right:gt.right-$e.right+ke.right},rt=u.modifiersData.offset;if(he===Au&&rt){var nt=rt[C];Object.keys(at).forEach(function(mt){var At=[Nn,jn].indexOf(mt)>=0?1:-1,St=[rn,jn].indexOf(mt)>=0?"y":"x";at[mt]+=nt[St]*At})}return at}function $2(u,d){d===void 0&&(d={});var g=d,w=g.placement,C=g.boundary,z=g.rootBoundary,T=g.padding,o=g.flipVariations,B=g.allowedAutoPlacements,K=B===void 0?uv:B,X=ac(w),ce=X?o?b_:b_.filter(function(de){return ac(de)===X}):Qu,he=ce.filter(function(de){return K.indexOf(de)>=0});he.length===0&&(he=ce);var q=he.reduce(function(de,Se){return de[Se]=$u(u,{placement:Se,boundary:C,rootBoundary:z,padding:T})[Ms(Se)],de},{});return Object.keys(q).sort(function(de,Se){return q[de]-q[Se]})}function Z2(u){if(Ms(u)===nm)return[];var d=xd(u);return[S_(u),d,S_(d)]}function G2(u){var d=u.state,g=u.options,w=u.name;if(!d.modifiersData[w]._skip){for(var C=g.mainAxis,z=C===void 0?!0:C,T=g.altAxis,o=T===void 0?!0:T,B=g.fallbackPlacements,K=g.padding,X=g.boundary,ce=g.rootBoundary,he=g.altBoundary,q=g.flipVariations,de=q===void 0?!0:q,Se=g.allowedAutoPlacements,Me=d.options.placement,ke=Ms(Me),Ce=ke===Me,Ee=B||(Ce||!de?[xd(Me)]:Z2(Me)),ae=[Me].concat(Ee).reduce(function(Jt,vr){return Jt.concat(Ms(vr)===nm?$2(d,{placement:vr,boundary:X,rootBoundary:ce,padding:K,flipVariations:de,allowedAutoPlacements:Se}):vr)},[]),$e=d.rects.reference,Re=d.rects.popper,Oe=new Map,Xe=!0,gt=ae[0],at=0;at<ae.length;at++){var rt=ae[at],nt=Ms(rt),mt=ac(rt)===ic,At=[rn,jn].indexOf(nt)>=0,St=At?"width":"height",jt=$u(d,{placement:rt,boundary:X,rootBoundary:ce,altBoundary:he,padding:K}),Mt=At?mt?Nn:nn:mt?jn:rn;$e[St]>Re[St]&&(Mt=xd(Mt));var pt=xd(Mt),ht=[];if(z&&ht.push(jt[nt]<=0),o&&ht.push(jt[Mt]<=0,jt[pt]<=0),ht.every(function(Jt){return Jt})){gt=rt,Xe=!1;break}Oe.set(rt,ht)}if(Xe)for(var lr=de?3:1,Nt=function(vr){var Qt=ae.find(function(Jr){var Vt=Oe.get(Jr);if(Vt)return Vt.slice(0,vr).every(function(kt){return kt})});if(Qt)return gt=Qt,"break"},qt=lr;qt>0;qt--){var Kt=Nt(qt);if(Kt==="break")break}d.placement!==gt&&(d.modifiersData[w]._skip=!0,d.placement=gt,d.reset=!0)}}const q2={name:"flip",enabled:!0,phase:"main",fn:G2,requiresIfExists:["offset"],data:{_skip:!1}};function M_(u,d,g){return g===void 0&&(g={x:0,y:0}),{top:u.top-d.height-g.y,right:u.right-d.width+g.x,bottom:u.bottom-d.height+g.y,left:u.left-d.width-g.x}}function C_(u){return[rn,Nn,jn,nn].some(function(d){return u[d]>=0})}function W2(u){var d=u.state,g=u.name,w=d.rects.reference,C=d.rects.popper,z=d.modifiersData.preventOverflow,T=$u(d,{elementContext:"reference"}),o=$u(d,{altBoundary:!0}),B=M_(T,w),K=M_(o,C,z),X=C_(B),ce=C_(K);d.modifiersData[g]={referenceClippingOffsets:B,popperEscapeOffsets:K,isReferenceHidden:X,hasPopperEscaped:ce},d.attributes.popper=Object.assign({},d.attributes.popper,{"data-popper-reference-hidden":X,"data-popper-escaped":ce})}const H2={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:W2};function X2(u,d,g){var w=Ms(u),C=[nn,rn].indexOf(w)>=0?-1:1,z=typeof g=="function"?g(Object.assign({},d,{placement:u})):g,T=z[0],o=z[1];return T=T||0,o=(o||0)*C,[nn,Nn].indexOf(w)>=0?{x:o,y:T}:{x:T,y:o}}function K2(u){var d=u.state,g=u.options,w=u.name,C=g.offset,z=C===void 0?[0,0]:C,T=uv.reduce(function(X,ce){return X[ce]=X2(ce,d.rects,z),X},{}),o=T[d.placement],B=o.x,K=o.y;d.modifiersData.popperOffsets!=null&&(d.modifiersData.popperOffsets.x+=B,d.modifiersData.popperOffsets.y+=K),d.modifiersData[w]=T}const Y2={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:K2};function J2(u){var d=u.state,g=u.name;d.modifiersData[g]=yv({reference:d.rects.reference,element:d.rects.popper,placement:d.placement})}const Q2={name:"popperOffsets",enabled:!0,phase:"read",fn:J2,data:{}};function eT(u){return u==="x"?"y":"x"}function tT(u){var d=u.state,g=u.options,w=u.name,C=g.mainAxis,z=C===void 0?!0:C,T=g.altAxis,o=T===void 0?!1:T,B=g.boundary,K=g.rootBoundary,X=g.altBoundary,ce=g.padding,he=g.tether,q=he===void 0?!0:he,de=g.tetherOffset,Se=de===void 0?0:de,Me=$u(d,{boundary:B,rootBoundary:K,padding:ce,altBoundary:X}),ke=Ms(d.placement),Ce=ac(d.placement),Ee=!Ce,ae=om(ke),$e=eT(ae),Re=d.modifiersData.popperOffsets,Oe=d.rects.reference,Xe=d.rects.popper,gt=typeof Se=="function"?Se(Object.assign({},d.rects,{placement:d.placement})):Se,at=typeof gt=="number"?{mainAxis:gt,altAxis:gt}:Object.assign({mainAxis:0,altAxis:0},gt),rt=d.modifiersData.offset?d.modifiersData.offset[d.placement]:null,nt={x:0,y:0};if(Re){if(z){var mt,At=ae==="y"?rn:nn,St=ae==="y"?jn:Nn,jt=ae==="y"?"height":"width",Mt=Re[ae],pt=Mt+Me[At],ht=Mt-Me[St],lr=q?-Xe[jt]/2:0,Nt=Ce===ic?Oe[jt]:Xe[jt],qt=Ce===ic?-Xe[jt]:-Oe[jt],Kt=d.elements.arrow,Jt=q&&Kt?am(Kt):{width:0,height:0},vr=d.modifiersData["arrow#persistent"]?d.modifiersData["arrow#persistent"].padding:fv(),Qt=vr[At],Jr=vr[St],Vt=Fu(0,Oe[jt],Jt[jt]),kt=Ee?Oe[jt]/2-lr-Vt-Qt-at.mainAxis:Nt-Vt-Qt-at.mainAxis,Ft=Ee?-Oe[jt]/2+lr+Vt+Jr+at.mainAxis:qt+Vt+Jr+at.mainAxis,Ot=d.elements.arrow&&eh(d.elements.arrow),Rt=Ot?ae==="y"?Ot.clientTop||0:Ot.clientLeft||0:0,yt=(mt=rt?.[ae])!=null?mt:0,Gt=Mt+kt-yt-Rt,mr=Mt+Ft-yt,Gr=Fu(q?zd(pt,Gt):pt,Mt,q?Ro(ht,mr):ht);Re[ae]=Gr,nt[ae]=Gr-Mt}if(o){var xr,Ar=ae==="x"?rn:nn,pr=ae==="x"?jn:Nn,Sr=Re[$e],br=$e==="y"?"height":"width",gr=Sr+Me[Ar],Br=Sr-Me[pr],Fr=[rn,nn].indexOf(ke)!==-1,Qr=(xr=rt?.[$e])!=null?xr:0,ei=Fr?gr:Sr-Oe[br]-Xe[br]-Qr+at.altAxis,Ui=Fr?Sr+Oe[br]+Xe[br]-Qr-at.altAxis:Br,an=q&&Fr?P2(ei,Sr,Ui):Fu(q?ei:gr,Sr,q?Ui:Br);Re[$e]=an,nt[$e]=an-Sr}d.modifiersData[w]=nt}}const rT={name:"preventOverflow",enabled:!0,phase:"main",fn:tT,requiresIfExists:["offset"]};function iT(u){return{scrollLeft:u.scrollLeft,scrollTop:u.scrollTop}}function nT(u){return u===Cn(u)||!Bn(u)?lm(u):iT(u)}function sT(u){var d=u.getBoundingClientRect(),g=nc(d.width)/u.offsetWidth||1,w=nc(d.height)/u.offsetHeight||1;return g!==1||w!==1}function aT(u,d,g){g===void 0&&(g=!1);var w=Bn(d),C=Bn(d)&&sT(d),z=Ha(d),T=sc(u,C,g),o={scrollLeft:0,scrollTop:0},B={x:0,y:0};return(w||!w&&!g)&&((Is(d)!=="body"||um(z))&&(o=nT(d)),Bn(d)?(B=sc(d,!0),B.x+=d.clientLeft,B.y+=d.clientTop):z&&(B.x=cm(z))),{x:T.left+o.scrollLeft-B.x,y:T.top+o.scrollTop-B.y,width:T.width,height:T.height}}function oT(u){var d=new Map,g=new Set,w=[];u.forEach(function(z){d.set(z.name,z)});function C(z){g.add(z.name);var T=[].concat(z.requires||[],z.requiresIfExists||[]);T.forEach(function(o){if(!g.has(o)){var B=d.get(o);B&&C(B)}}),w.push(z)}return u.forEach(function(z){g.has(z.name)||C(z)}),w}function lT(u){var d=oT(u);return x2.reduce(function(g,w){return g.concat(d.filter(function(C){return C.phase===w}))},[])}function cT(u){var d;return function(){return d||(d=new Promise(function(g){Promise.resolve().then(function(){d=void 0,g(u())})})),d}}function uT(u){var d=u.reduce(function(g,w){var C=g[w.name];return g[w.name]=C?Object.assign({},C,w,{options:Object.assign({},C.options,w.options),data:Object.assign({},C.data,w.data)}):w,g},{});return Object.keys(d).map(function(g){return d[g]})}var I_={placement:"bottom",modifiers:[],strategy:"absolute"};function E_(){for(var u=arguments.length,d=new Array(u),g=0;g<u;g++)d[g]=arguments[g];return!d.some(function(w){return!(w&&typeof w.getBoundingClientRect=="function")})}function hT(u){u===void 0&&(u={});var d=u,g=d.defaultModifiers,w=g===void 0?[]:g,C=d.defaultOptions,z=C===void 0?I_:C;return function(o,B,K){K===void 0&&(K=z);var X={placement:"bottom",orderedModifiers:[],options:Object.assign({},I_,z),modifiersData:{},elements:{reference:o,popper:B},attributes:{},styles:{}},ce=[],he=!1,q={state:X,setOptions:function(ke){var Ce=typeof ke=="function"?ke(X.options):ke;Se(),X.options=Object.assign({},z,X.options,Ce),X.scrollParents={reference:Fo(o)?Ou(o):o.contextElement?Ou(o.contextElement):[],popper:Ou(B)};var Ee=lT(uT([].concat(w,X.options.modifiers)));return X.orderedModifiers=Ee.filter(function(ae){return ae.enabled}),de(),q.update()},forceUpdate:function(){if(!he){var ke=X.elements,Ce=ke.reference,Ee=ke.popper;if(E_(Ce,Ee)){X.rects={reference:aT(Ce,eh(Ee),X.options.strategy==="fixed"),popper:am(Ee)},X.reset=!1,X.placement=X.options.placement,X.orderedModifiers.forEach(function(at){return X.modifiersData[at.name]=Object.assign({},at.data)});for(var ae=0;ae<X.orderedModifiers.length;ae++){if(X.reset===!0){X.reset=!1,ae=-1;continue}var $e=X.orderedModifiers[ae],Re=$e.fn,Oe=$e.options,Xe=Oe===void 0?{}:Oe,gt=$e.name;typeof Re=="function"&&(X=Re({state:X,options:Xe,name:gt,instance:q})||X)}}}},update:cT(function(){return new Promise(function(Me){q.forceUpdate(),Me(X)})}),destroy:function(){Se(),he=!0}};if(!E_(o,B))return q;q.setOptions(K).then(function(Me){!he&&K.onFirstUpdate&&K.onFirstUpdate(Me)});function de(){X.orderedModifiers.forEach(function(Me){var ke=Me.name,Ce=Me.options,Ee=Ce===void 0?{}:Ce,ae=Me.effect;if(typeof ae=="function"){var $e=ae({state:X,name:ke,instance:q,options:Ee}),Re=function(){};ce.push($e||Re)}})}function Se(){ce.forEach(function(Me){return Me()}),ce=[]}return q}}var dT=[L2,Q2,D2,hv,Y2,q2,rT,E2,H2],pT=hT({defaultModifiers:dT}),fT="tippy-box",vv="tippy-content",mT="tippy-backdrop",xv="tippy-arrow",bv="tippy-svg-arrow",Ao={passive:!0,capture:!0},wv=function(){return document.body};function xf(u,d,g){if(Array.isArray(u)){var w=u[d];return w??(Array.isArray(g)?g[d]:g)}return u}function hm(u,d){var g={}.toString.call(u);return g.indexOf("[object")===0&&g.indexOf(d+"]")>-1}function Tv(u,d){return typeof u=="function"?u.apply(void 0,d):u}function A_(u,d){if(d===0)return u;var g;return function(w){clearTimeout(g),g=setTimeout(function(){u(w)},d)}}function gT(u){return u.split(/\s+/).filter(Boolean)}function Hl(u){return[].concat(u)}function k_(u,d){u.indexOf(d)===-1&&u.push(d)}function _T(u){return u.filter(function(d,g){return u.indexOf(d)===g})}function yT(u){return u.split("-")[0]}function Dd(u){return[].slice.call(u)}function z_(u){return Object.keys(u).reduce(function(d,g){return u[g]!==void 0&&(d[g]=u[g]),d},{})}function ju(){return document.createElement("div")}function Gd(u){return["Element","Fragment"].some(function(d){return hm(u,d)})}function vT(u){return hm(u,"NodeList")}function xT(u){return hm(u,"MouseEvent")}function bT(u){return!!(u&&u._tippy&&u._tippy.reference===u)}function wT(u){return Gd(u)?[u]:vT(u)?Dd(u):Array.isArray(u)?u:Dd(document.querySelectorAll(u))}function bf(u,d){u.forEach(function(g){g&&(g.style.transitionDuration=d+"ms")})}function D_(u,d){u.forEach(function(g){g&&g.setAttribute("data-state",d)})}function TT(u){var d,g=Hl(u),w=g[0];return w!=null&&(d=w.ownerDocument)!=null&&d.body?w.ownerDocument:document}function ST(u,d){var g=d.clientX,w=d.clientY;return u.every(function(C){var z=C.popperRect,T=C.popperState,o=C.props,B=o.interactiveBorder,K=yT(T.placement),X=T.modifiersData.offset;if(!X)return!0;var ce=K==="bottom"?X.top.y:0,he=K==="top"?X.bottom.y:0,q=K==="right"?X.left.x:0,de=K==="left"?X.right.x:0,Se=z.top-w+ce>B,Me=w-z.bottom-he>B,ke=z.left-g+q>B,Ce=g-z.right-de>B;return Se||Me||ke||Ce})}function wf(u,d,g){var w=d+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(C){u[w](C,g)})}function R_(u,d){for(var g=d;g;){var w;if(u.contains(g))return!0;g=g.getRootNode==null||(w=g.getRootNode())==null?void 0:w.host}return!1}var Ts={isTouch:!1},L_=0;function PT(){Ts.isTouch||(Ts.isTouch=!0,window.performance&&document.addEventListener("mousemove",Sv))}function Sv(){var u=performance.now();u-L_<20&&(Ts.isTouch=!1,document.removeEventListener("mousemove",Sv)),L_=u}function MT(){var u=document.activeElement;if(bT(u)){var d=u._tippy;u.blur&&!d.state.isVisible&&u.blur()}}function CT(){document.addEventListener("touchstart",PT,Ao),window.addEventListener("blur",MT)}var IT=typeof window<"u"&&typeof document<"u",ET=IT?!!window.msCrypto:!1,AT={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},kT={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},ts=Object.assign({appendTo:wv,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},AT,kT),zT=Object.keys(ts),DT=function(d){var g=Object.keys(d);g.forEach(function(w){ts[w]=d[w]})};function Pv(u){var d=u.plugins||[],g=d.reduce(function(w,C){var z=C.name,T=C.defaultValue;if(z){var o;w[z]=u[z]!==void 0?u[z]:(o=ts[z])!=null?o:T}return w},{});return Object.assign({},u,g)}function RT(u,d){var g=d?Object.keys(Pv(Object.assign({},ts,{plugins:d}))):zT,w=g.reduce(function(C,z){var T=(u.getAttribute("data-tippy-"+z)||"").trim();if(!T)return C;if(z==="content")C[z]=T;else try{C[z]=JSON.parse(T)}catch{C[z]=T}return C},{});return w}function B_(u,d){var g=Object.assign({},d,{content:Tv(d.content,[u])},d.ignoreAttributes?{}:RT(u,d.plugins));return g.aria=Object.assign({},ts.aria,g.aria),g.aria={expanded:g.aria.expanded==="auto"?d.interactive:g.aria.expanded,content:g.aria.content==="auto"?d.interactive?null:"describedby":g.aria.content},g}var LT=function(){return"innerHTML"};function Ff(u,d){u[LT()]=d}function F_(u){var d=ju();return u===!0?d.className=xv:(d.className=bv,Gd(u)?d.appendChild(u):Ff(d,u)),d}function O_(u,d){Gd(d.content)?(Ff(u,""),u.appendChild(d.content)):typeof d.content!="function"&&(d.allowHTML?Ff(u,d.content):u.textContent=d.content)}function Of(u){var d=u.firstElementChild,g=Dd(d.children);return{box:d,content:g.find(function(w){return w.classList.contains(vv)}),arrow:g.find(function(w){return w.classList.contains(xv)||w.classList.contains(bv)}),backdrop:g.find(function(w){return w.classList.contains(mT)})}}function Mv(u){var d=ju(),g=ju();g.className=fT,g.setAttribute("data-state","hidden"),g.setAttribute("tabindex","-1");var w=ju();w.className=vv,w.setAttribute("data-state","hidden"),O_(w,u.props),d.appendChild(g),g.appendChild(w),C(u.props,u.props);function C(z,T){var o=Of(d),B=o.box,K=o.content,X=o.arrow;T.theme?B.setAttribute("data-theme",T.theme):B.removeAttribute("data-theme"),typeof T.animation=="string"?B.setAttribute("data-animation",T.animation):B.removeAttribute("data-animation"),T.inertia?B.setAttribute("data-inertia",""):B.removeAttribute("data-inertia"),B.style.maxWidth=typeof T.maxWidth=="number"?T.maxWidth+"px":T.maxWidth,T.role?B.setAttribute("role",T.role):B.removeAttribute("role"),(z.content!==T.content||z.allowHTML!==T.allowHTML)&&O_(K,u.props),T.arrow?X?z.arrow!==T.arrow&&(B.removeChild(X),B.appendChild(F_(T.arrow))):B.appendChild(F_(T.arrow)):X&&B.removeChild(X)}return{popper:d,onUpdate:C}}Mv.$$tippy=!0;var BT=1,md=[],Tf=[];function FT(u,d){var g=B_(u,Object.assign({},ts,Pv(z_(d)))),w,C,z,T=!1,o=!1,B=!1,K=!1,X,ce,he,q=[],de=A_(Gt,g.interactiveDebounce),Se,Me=BT++,ke=null,Ce=_T(g.plugins),Ee={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},ae={id:Me,reference:u,popper:ju(),popperInstance:ke,props:g,state:Ee,plugins:Ce,clearDelayTimeouts:ei,setProps:Ui,setContent:an,show:fe,hide:j,hideWithInteractivity:V,enable:Fr,disable:Qr,unmount:$,destroy:te};if(!g.render)return ae;var $e=g.render(ae),Re=$e.popper,Oe=$e.onUpdate;Re.setAttribute("data-tippy-root",""),Re.id="tippy-"+ae.id,ae.popper=Re,u._tippy=ae,Re._tippy=ae;var Xe=Ce.map(function(U){return U.fn(ae)}),gt=u.hasAttribute("aria-expanded");return Ot(),lr(),Mt(),pt("onCreate",[ae]),g.showOnCreate&&gr(),Re.addEventListener("mouseenter",function(){ae.props.interactive&&ae.state.isVisible&&ae.clearDelayTimeouts()}),Re.addEventListener("mouseleave",function(){ae.props.interactive&&ae.props.trigger.indexOf("mouseenter")>=0&&At().addEventListener("mousemove",de)}),ae;function at(){var U=ae.props.touch;return Array.isArray(U)?U:[U,0]}function rt(){return at()[0]==="hold"}function nt(){var U;return!!((U=ae.props.render)!=null&&U.$$tippy)}function mt(){return Se||u}function At(){var U=mt().parentNode;return U?TT(U):document}function St(){return Of(Re)}function jt(U){return ae.state.isMounted&&!ae.state.isVisible||Ts.isTouch||X&&X.type==="focus"?0:xf(ae.props.delay,U?0:1,ts.delay)}function Mt(U){U===void 0&&(U=!1),Re.style.pointerEvents=ae.props.interactive&&!U?"":"none",Re.style.zIndex=""+ae.props.zIndex}function pt(U,re,pe){if(pe===void 0&&(pe=!0),Xe.forEach(function(ye){ye[U]&&ye[U].apply(ye,re)}),pe){var le;(le=ae.props)[U].apply(le,re)}}function ht(){var U=ae.props.aria;if(U.content){var re="aria-"+U.content,pe=Re.id,le=Hl(ae.props.triggerTarget||u);le.forEach(function(ye){var ze=ye.getAttribute(re);if(ae.state.isVisible)ye.setAttribute(re,ze?ze+" "+pe:pe);else{var Ie=ze&&ze.replace(pe,"").trim();Ie?ye.setAttribute(re,Ie):ye.removeAttribute(re)}})}}function lr(){if(!(gt||!ae.props.aria.expanded)){var U=Hl(ae.props.triggerTarget||u);U.forEach(function(re){ae.props.interactive?re.setAttribute("aria-expanded",ae.state.isVisible&&re===mt()?"true":"false"):re.removeAttribute("aria-expanded")})}}function Nt(){At().removeEventListener("mousemove",de),md=md.filter(function(U){return U!==de})}function qt(U){if(!(Ts.isTouch&&(B||U.type==="mousedown"))){var re=U.composedPath&&U.composedPath()[0]||U.target;if(!(ae.props.interactive&&R_(Re,re))){if(Hl(ae.props.triggerTarget||u).some(function(pe){return R_(pe,re)})){if(Ts.isTouch||ae.state.isVisible&&ae.props.trigger.indexOf("click")>=0)return}else pt("onClickOutside",[ae,U]);ae.props.hideOnClick===!0&&(ae.clearDelayTimeouts(),ae.hide(),o=!0,setTimeout(function(){o=!1}),ae.state.isMounted||Qt())}}}function Kt(){B=!0}function Jt(){B=!1}function vr(){var U=At();U.addEventListener("mousedown",qt,!0),U.addEventListener("touchend",qt,Ao),U.addEventListener("touchstart",Jt,Ao),U.addEventListener("touchmove",Kt,Ao)}function Qt(){var U=At();U.removeEventListener("mousedown",qt,!0),U.removeEventListener("touchend",qt,Ao),U.removeEventListener("touchstart",Jt,Ao),U.removeEventListener("touchmove",Kt,Ao)}function Jr(U,re){kt(U,function(){!ae.state.isVisible&&Re.parentNode&&Re.parentNode.contains(Re)&&re()})}function Vt(U,re){kt(U,re)}function kt(U,re){var pe=St().box;function le(ye){ye.target===pe&&(wf(pe,"remove",le),re())}if(U===0)return re();wf(pe,"remove",ce),wf(pe,"add",le),ce=le}function Ft(U,re,pe){pe===void 0&&(pe=!1);var le=Hl(ae.props.triggerTarget||u);le.forEach(function(ye){ye.addEventListener(U,re,pe),q.push({node:ye,eventType:U,handler:re,options:pe})})}function Ot(){rt()&&(Ft("touchstart",yt,{passive:!0}),Ft("touchend",mr,{passive:!0})),gT(ae.props.trigger).forEach(function(U){if(U!=="manual")switch(Ft(U,yt),U){case"mouseenter":Ft("mouseleave",mr);break;case"focus":Ft(ET?"focusout":"blur",Gr);break;case"focusin":Ft("focusout",Gr);break}})}function Rt(){q.forEach(function(U){var re=U.node,pe=U.eventType,le=U.handler,ye=U.options;re.removeEventListener(pe,le,ye)}),q=[]}function yt(U){var re,pe=!1;if(!(!ae.state.isEnabled||xr(U)||o)){var le=((re=X)==null?void 0:re.type)==="focus";X=U,Se=U.currentTarget,lr(),!ae.state.isVisible&&xT(U)&&md.forEach(function(ye){return ye(U)}),U.type==="click"&&(ae.props.trigger.indexOf("mouseenter")<0||T)&&ae.props.hideOnClick!==!1&&ae.state.isVisible?pe=!0:gr(U),U.type==="click"&&(T=!pe),pe&&!le&&Br(U)}}function Gt(U){var re=U.target,pe=mt().contains(re)||Re.contains(re);if(!(U.type==="mousemove"&&pe)){var le=br().concat(Re).map(function(ye){var ze,Ie=ye._tippy,Ke=(ze=Ie.popperInstance)==null?void 0:ze.state;return Ke?{popperRect:ye.getBoundingClientRect(),popperState:Ke,props:g}:null}).filter(Boolean);ST(le,U)&&(Nt(),Br(U))}}function mr(U){var re=xr(U)||ae.props.trigger.indexOf("click")>=0&&T;if(!re){if(ae.props.interactive){ae.hideWithInteractivity(U);return}Br(U)}}function Gr(U){ae.props.trigger.indexOf("focusin")<0&&U.target!==mt()||ae.props.interactive&&U.relatedTarget&&Re.contains(U.relatedTarget)||Br(U)}function xr(U){return Ts.isTouch?rt()!==U.type.indexOf("touch")>=0:!1}function Ar(){pr();var U=ae.props,re=U.popperOptions,pe=U.placement,le=U.offset,ye=U.getReferenceClientRect,ze=U.moveTransition,Ie=nt()?Of(Re).arrow:null,Ke=ye?{getBoundingClientRect:ye,contextElement:ye.contextElement||mt()}:u,_e={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Qe){var dt=Qe.state;if(nt()){var tr=St(),kr=tr.box;["placement","reference-hidden","escaped"].forEach(function(Pr){Pr==="placement"?kr.setAttribute("data-placement",dt.placement):dt.attributes.popper["data-popper-"+Pr]?kr.setAttribute("data-"+Pr,""):kr.removeAttribute("data-"+Pr)}),dt.attributes.popper={}}}},ot=[{name:"offset",options:{offset:le}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ze}},_e];nt()&&Ie&&ot.push({name:"arrow",options:{element:Ie,padding:3}}),ot.push.apply(ot,re?.modifiers||[]),ae.popperInstance=pT(Ke,Re,Object.assign({},re,{placement:pe,onFirstUpdate:he,modifiers:ot}))}function pr(){ae.popperInstance&&(ae.popperInstance.destroy(),ae.popperInstance=null)}function Sr(){var U=ae.props.appendTo,re,pe=mt();ae.props.interactive&&U===wv||U==="parent"?re=pe.parentNode:re=Tv(U,[pe]),re.contains(Re)||re.appendChild(Re),ae.state.isMounted=!0,Ar()}function br(){return Dd(Re.querySelectorAll("[data-tippy-root]"))}function gr(U){ae.clearDelayTimeouts(),U&&pt("onTrigger",[ae,U]),vr();var re=jt(!0),pe=at(),le=pe[0],ye=pe[1];Ts.isTouch&&le==="hold"&&ye&&(re=ye),re?w=setTimeout(function(){ae.show()},re):ae.show()}function Br(U){if(ae.clearDelayTimeouts(),pt("onUntrigger",[ae,U]),!ae.state.isVisible){Qt();return}if(!(ae.props.trigger.indexOf("mouseenter")>=0&&ae.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(U.type)>=0&&T)){var re=jt(!1);re?C=setTimeout(function(){ae.state.isVisible&&ae.hide()},re):z=requestAnimationFrame(function(){ae.hide()})}}function Fr(){ae.state.isEnabled=!0}function Qr(){ae.hide(),ae.state.isEnabled=!1}function ei(){clearTimeout(w),clearTimeout(C),cancelAnimationFrame(z)}function Ui(U){if(!ae.state.isDestroyed){pt("onBeforeUpdate",[ae,U]),Rt();var re=ae.props,pe=B_(u,Object.assign({},re,z_(U),{ignoreAttributes:!0}));ae.props=pe,Ot(),re.interactiveDebounce!==pe.interactiveDebounce&&(Nt(),de=A_(Gt,pe.interactiveDebounce)),re.triggerTarget&&!pe.triggerTarget?Hl(re.triggerTarget).forEach(function(le){le.removeAttribute("aria-expanded")}):pe.triggerTarget&&u.removeAttribute("aria-expanded"),lr(),Mt(),Oe&&Oe(re,pe),ae.popperInstance&&(Ar(),br().forEach(function(le){requestAnimationFrame(le._tippy.popperInstance.forceUpdate)})),pt("onAfterUpdate",[ae,U])}}function an(U){ae.setProps({content:U})}function fe(){var U=ae.state.isVisible,re=ae.state.isDestroyed,pe=!ae.state.isEnabled,le=Ts.isTouch&&!ae.props.touch,ye=xf(ae.props.duration,0,ts.duration);if(!(U||re||pe||le)&&!mt().hasAttribute("disabled")&&(pt("onShow",[ae],!1),ae.props.onShow(ae)!==!1)){if(ae.state.isVisible=!0,nt()&&(Re.style.visibility="visible"),Mt(),vr(),ae.state.isMounted||(Re.style.transition="none"),nt()){var ze=St(),Ie=ze.box,Ke=ze.content;bf([Ie,Ke],0)}he=function(){var ot;if(!(!ae.state.isVisible||K)){if(K=!0,Re.offsetHeight,Re.style.transition=ae.props.moveTransition,nt()&&ae.props.animation){var bt=St(),Qe=bt.box,dt=bt.content;bf([Qe,dt],ye),D_([Qe,dt],"visible")}ht(),lr(),k_(Tf,ae),(ot=ae.popperInstance)==null||ot.forceUpdate(),pt("onMount",[ae]),ae.props.animation&&nt()&&Vt(ye,function(){ae.state.isShown=!0,pt("onShown",[ae])})}},Sr()}}function j(){var U=!ae.state.isVisible,re=ae.state.isDestroyed,pe=!ae.state.isEnabled,le=xf(ae.props.duration,1,ts.duration);if(!(U||re||pe)&&(pt("onHide",[ae],!1),ae.props.onHide(ae)!==!1)){if(ae.state.isVisible=!1,ae.state.isShown=!1,K=!1,T=!1,nt()&&(Re.style.visibility="hidden"),Nt(),Qt(),Mt(!0),nt()){var ye=St(),ze=ye.box,Ie=ye.content;ae.props.animation&&(bf([ze,Ie],le),D_([ze,Ie],"hidden"))}ht(),lr(),ae.props.animation?nt()&&Jr(le,ae.unmount):ae.unmount()}}function V(U){At().addEventListener("mousemove",de),k_(md,de),de(U)}function $(){ae.state.isVisible&&ae.hide(),ae.state.isMounted&&(pr(),br().forEach(function(U){U._tippy.unmount()}),Re.parentNode&&Re.parentNode.removeChild(Re),Tf=Tf.filter(function(U){return U!==ae}),ae.state.isMounted=!1,pt("onHidden",[ae]))}function te(){ae.state.isDestroyed||(ae.clearDelayTimeouts(),ae.unmount(),Rt(),delete u._tippy,ae.state.isDestroyed=!0,pt("onDestroy",[ae]))}}function th(u,d){d===void 0&&(d={});var g=ts.plugins.concat(d.plugins||[]);CT();var w=Object.assign({},d,{plugins:g}),C=wT(u),z=C.reduce(function(T,o){var B=o&&FT(o,w);return B&&T.push(B),T},[]);return Gd(u)?z[0]:z}th.defaultProps=ts;th.setDefaultProps=DT;th.currentInput=Ts;Object.assign({},hv,{effect:function(d){var g=d.state,w={popper:{position:g.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(g.elements.popper.style,w.popper),g.styles=w,g.elements.arrow&&Object.assign(g.elements.arrow.style,w.arrow)}});th.setDefaultProps({render:Mv});class OT{rootKey="ltn";get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let d,g=window.localStorage.getItem(this.schemaVersionKey);return g?(d=parseInt(g),Number.isNaN(d)&&(d=0)):d=0,d}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty — nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,"2");return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const g of["cnt","global"]){const w=g,C=new Sf(w,1,bd);for(const[z,T]of jT(w))for(const{projectKey:o,projectName:B}of T){let K=window.localStorage.getItem(o);if(!K){console.warn(`Project features not found for ${o}, skipping migration`);continue}let X=JSON.parse(K);X.app_focus=w,X.study_area_name=z,X.project_name=B,console.log(`migrating project ${o}`);let ce=C.createProject(X);console.log(`Successfully migrated v0->v1 project ${o} -> ${C.projectKey(ce)}`),window.localStorage.removeItem(o)}}}if(this.storedSchemaVersion<2)for(const g of["cnt","global"]){const w=g,C=new Sf(w,2,bd);for(const[z,T]of C.projects()){if(T.db_schema_version>=2){console.log(`skipping previously migrated project: ${z}`);continue}T.db_schema_version=2,C.saveProject(z,T),console.log(`Successfully migrated v1->v2 project: ${C.projectKey(z)}`)}}window.localStorage.setItem(this.schemaVersionKey,"2"),console.debug("Completed migrating database to v2")}projectStorage(d){return this.ensureMigrated(),new Sf(d,this.storedSchemaVersion,bd)}}const bd=Symbol("internal_method_token");class Sf{appFocus;dbSchemaVersion;constructor(d,g,w){if(w!==bd)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=d,this.dbSchemaVersion=g}get collectionKey(){return"ltn/projects"}projectKey(d){if(!d)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${d}`}projectName(d){return this.project(d).project_name}projectNameAlreadyExists(d){for(const[g,w]of this.projects())if(w.project_name==d)return!0;return!1}nextAvailableProjectName(d){if(this.projectNameAlreadyExists(d)){let g=d,w=2;do d=`${g} (${w})`,w++;while(this.projectNameAlreadyExists(d))}return d}nextAvailableNeighbourhoodName(d){let g="My neighbourhood",C=this.project(d).features.filter(o=>o.properties?.kind=="boundary"),z=g,T=1;for(;C.some(o=>o.properties?.name==z);)T++,z=`${g} #${T}`;return z}createEmptyProject(d,g){const w={type:"FeatureCollection",features:[],study_area_name:g,project_name:d,app_focus:this.appFocus};return this.createProject(w)}createProject(d){if(this.projectNameAlreadyExists(d.project_name))throw new Error(`Project name already taken: ${d.project_name}`);d.db_schema_version||(d.db_schema_version=this.dbSchemaVersion);let g=crypto.randomUUID();return this.saveProject(g,d),g}studyAreaProjects(){let d=new Map;for(const[g,w]of this.projects()){const C=w.study_area_name;d.has(C)||d.set(C,[]),d.get(C).push({projectID:g,projectName:w.project_name})}for(const[g,w]of d.entries())w.sort((C,z)=>C.projectName.localeCompare(z.projectName));return Array.from(d.entries()).sort((g,w)=>g[0]==null?1:w[0]==null?-1:g[0].localeCompare(w[0]))}projectIDFromKey(d){let g=d.match(/ltn\/projects\/([a-z0-9-]+)/);if(!g)return;let w=g[1];if(w)return w}projects(){return this.allProjectKeys().map(d=>{let g=this.projectIDFromKey(d);if(!g)throw new Error(`Cannot get project: no projectID parsed from ${d}`);let w=window.localStorage.getItem(d);if(!w)throw new Error(`Cannot get project: no project found for ${d}`);let C=JSON.parse(w);return C.app_focus!=this.appFocus?null:[g,C]}).filter(d=>d!==null)}allProjectKeys(){const d=this.collectionKey;let g=[];for(let w=0;w<localStorage.length;w++){const C=localStorage.key(w);C&&C.startsWith(d)&&g.push(C)}return g}saveProject(d,g){let w=this.projectKey(d);g.study_area_name||delete g.study_area_name,window.localStorage.setItem(w,JSON.stringify(g))}removeProject(d){let g=this.projectKey(d);window.localStorage.removeItem(g)}renameProject(d,g){let w=this.project(d);if(!w)throw new Error(`Cannot rename project: no existing project found for ${d}`);if(w.project_name==g){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(g))throw new Error(`Project name ${g} already taken. Choose a different name.`);w.project_name=g,this.saveProject(d,w)}copyProject(d,g){let w=this.project(d);if(!w)throw new Error(`Cannot copy project: no existing project found for ${d}`);if(this.projectNameAlreadyExists(g))throw new Error(`Project name ${g} already taken. Choose a different name.`);let C=crypto.randomUUID();return w.project_name=g,this.saveProject(C,w),C}project(d){let g=this.projectKey(d),w=window.localStorage.getItem(g);if(!w)throw new Error(`Cannot get project: no project found for ${d}`);let C=JSON.parse(w);return console.assert(C.study_area_name||C.app_focus!="cnt","missing study area name for cnt project"),console.assert(C.project_name,"missing project name"),C}}function jT(u){let d=new Map,g=[];for(let C=0;C<window.localStorage.length;C++){let z=window.localStorage.key(C);if(z.startsWith("ltn_cnt/")){if(u!="cnt")continue;try{let[T,o,B]=z.split("/");d.has(o)||d.set(o,[]),d.get(o).push({projectKey:z,projectName:B})}catch(T){console.log(`error loading cnt project: ${z}`,T)}}else if(z.startsWith("ltn_")){if(u!="global")continue;let T=z.split("ltn_"),o=T[T.length-1],B="";try{B=JSON.parse(window.localStorage.getItem(z)).study_area_name}catch(K){console.log(`error loading global project: ${z}`,K)}B&&B.length>0?(d.has(B)||d.set(B,[]),d.get(B).push({projectKey:z,projectName:o})):g.push({projectKey:z,projectName:o})}}let w=[...d.entries()];return w.sort((C,z)=>C[0].localeCompare(z[0])),g.length>0&&w.push([void 0,g]),w}const qS="MZEJTanw3WpxRvt7qDfo";let Cv=dr(void 0),Iv=dr("global"),Ev=dr(void 0),WS=By(Ev,u=>{if(u)return is(dm).project(u)}),HS=dr(void 0),NT=new OT,dm=By(Iv,u=>NT.projectStorage(u)),XS=dr(!0),VT=dr(null),KS=dr({population_density:[0,1,2,3,4,5],collision_density:[0,1,2,3,4,5],poi_density:[0,1,2,3,4,5]}),YS=dr(new fc.LngLat(0,0)),JS=dr(new fc.LngLat(0,0)),QS=dr(new fc.LngLat(0,0)),eP=dr(1),tP=dr(1),rP=dr({mode:"title",firstLoad:!0}),iP=dr(!1),nP=dr(!1),sP=dr("streets-v2"),aP=dr("walk_cycle_only"),oP=dr(!1),lP=dr(!0),cP=dr(!1),uP=dr(!0),hP=dr("shortcuts"),dP=dr(!1),UT=dr(!1),pP=dr(!0),fP=dr(500);function mP(){const u=is(Ev);try{is(dm).saveProject(u,is(VT).toSavefile())}catch(d){window.alert(`Autosave failed: ${d}`)}}let $T=dr(!1),ZT=dr(GT());function GT(){let u=new URL(window.location.href).searchParams.get("lang");return u&&["en","fr","hu"].includes(u)?u:"en"}function gP(u){return is($T)?`/${u}`:u.startsWith("cnt/")?`https://assets.cnt.scot/${Av(u,"cnt/")}`:u.startsWith("england/")?`https://assets.od2net.org/ltn/${u}`:`https://assets.od2net.org/${u}`}function _P(u){function d(w){const C=w.getEast()-w.getWest();let z=w.getWest()+Math.random()*C;const T=w.getNorth()-w.getSouth();let o=w.getSouth()+Math.random()*T;return new fc.LngLat(z,o)}const g=is(Cv)?.getBounds();if(!g){console.assert(!1,"missing map bounds");return}g.contains(is(u))||u.set(d(g))}function yP(u){return is(UT)?`${Math.round(1.60934*u)} km/h`:`${Math.round(u)} mph`}var qT=(u,d,g)=>{d(!d()),g()()},WT=Xt('<div class="context-layer-help-content"><!></div>'),HT=Xt('<span style="margin-left: auto"><!></span>'),XT=Xt('<div class="legend svelte-7mfws1"><!></div>'),KT=Xt('<button class="context-control svelte-7mfws1"><input style="aspect-ratio: 1.0" type="checkbox"/> <!></button> <!>',1);function vP(u,d){ss(d,!0);let g=hr(d,"show",15,!1),w=hr(d,"onChange",3,()=>{}),C=hr(d,"help",3,void 0),z=hr(d,"legend",3,void 0);var T=KT(),o=Ki(T);o.__click=[qT,g,w];var B=tt(o);B.__change=function(...de){w()?.apply(this,de)};var K=Ir(B),X=Ir(K);{var ce=de=>{var Se=HT(),Me=tt(Se);eS(Me,{children:(ke,Ce)=>{var Ee=WT(),ae=tt(Ee);Ga(ae,C),_t(ke,Ee)},$$slots:{default:!0}}),_t(de,Se)};Na(X,de=>{C()&&de(ce)})}var he=Ir(o,2);{var q=de=>{var Se=XT(),Me=tt(Se);Ga(Me,z),_t(de,Se)};Na(he,de=>{g()&&z()&&de(q)})}Zr(()=>sr(K,` ${d.label??""} `)),i1(B,g),_t(u,T),as()}As(["click","change"]);let Pf=dr(!0);function YT(u,d){u.stopPropagation(),Tr(d,!0)}var JT=Xt('<article style="max-height: 80vh; max-width: 80vw; overflow: auto"><h2> </h2> <!></article>'),QT=Xt('<button class="icon-btn help svelte-1xlrcrs"><!></button> <div class="pico"><!></div>',1);function eS(u,d){ss(d,!0);const g=ar(()=>Ku(Yu("main")));let w=si(!1),C=hr(d,"color",3,"black");var z=QT(),T=Ki(z);T.__click=[YT,w];var o=tt(T);$1(o,{get color(){return C()}});var B=Ir(T,2),K=tt(B);o2(K,{get show(){return De(w)},set show(X){Tr(w,X,!0)},children:(X,ce)=>{var he=JT(),q=tt(he),de=tt(q),Se=Ir(q,2);Ga(Se,()=>d.children),Zr(Me=>sr(de,Me),[()=>De(g).t(106)]),_t(X,he)},$$slots:{default:!0}}),Zr(X=>na(T,"title",X),[()=>De(g).t(106)]),_t(u,z),as()}As(["click"]);function tS(u,d){const g=new URL(window.location.href);De(d)=="en"?g.searchParams.delete("lang"):g.searchParams.set("lang",De(d)),window.location.href=g}var rS=Xt('<label><span style="font-size: 20px; margin-left: 8px; margin-top: 4px;"><!></span> <select style="width: 80%"><option> </option><option> </option><option> </option></select></label>');function xP(u,d){ss(d,!0);const g=()=>em(ZT,"$locale",w),[w,C]=tm(),z=ar(()=>Ku(Yu("main")));let T=si(Fa(JSON.parse(JSON.stringify(g()))));var o=rS(),B=tt(o);{const ke=Ce=>{q1(Ce,{})};var K=tt(B);{let Ce=ar(()=>[ke]),Ee=ar(()=>De(z).cx(471));Tn(K,{get t(){return De(Ce)},get x(){return De(Ee)}})}}var X=Ir(B,2);X.__change=[tS,T];var ce=tt(X),he=tt(ce);ce.value=ce.__value="en";var q=Ir(ce),de=tt(q);q.value=q.__value="fr";var Se=Ir(q),Me=tt(Se);Se.value=Se.__value="hu",Zr((ke,Ce,Ee)=>{sr(he,ke),sr(de,Ce),sr(Me,Ee)},[()=>De(z).t(472),()=>De(z).t(473),()=>De(z).t(474)]),e1(X,()=>De(T),ke=>Tr(T,ke)),_t(u,o),as(),C()}As(["change"]);var iS=Xt('<a href="#"><!></a>');function bP(u,d){function g(T){return function(o){o.preventDefault(),T()}}var w=iS(),C=ar(()=>g(d.onclick));w.__click=function(...T){De(C)?.apply(this,T)};var z=tt(w);Ga(z,()=>d.children),_t(u,w)}As(["click"]);var nS=Xt('<div style="display: flex; justify-content: space-between; align-items: center;"><button> </button> <button> </button></div>');function wP(u,d){ss(d,!0);const g=()=>em(Cv,"$map",w),[w,C]=tm(),z=ar(()=>Ku(Yu("main")));let T=hr(d,"idx",15,0);Fy(()=>{g()?.keyboard.disable(),gS()}),Oy(()=>{g()?.keyboard.enable()});function o(Me){Me.key==De(z).t(119)&&(Me.stopPropagation(),B()),Me.key==De(z).t(120)&&(Me.stopPropagation(),K())}function B(){T()!=0&&p_(T,-1)}function K(){T()!=d.list.length-1&&p_(T)}var X=nS();Id("keydown",Md,o);var ce=tt(X);ce.__click=B;var he=tt(ce),q=Ir(ce),de=Ir(q);de.__click=K;var Se=tt(de);Zr((Me,ke,Ce,Ee)=>{ce.disabled=T()==0,na(ce,"data-tippy-content",Me),sr(he,ke),sr(q,` ${T()+1} / ${d.list.length??""} `),de.disabled=T()==d.list.length-1,na(de,"data-tippy-content",Ce),sr(Se,Ee)},[()=>De(z).t(121),()=>De(z).t(122),()=>De(z).t(123),()=>De(z).t(124)]),_t(u,X),as(),C()}As(["click"]);function sS(u,d){let g=new Set(u.getStyle().layers.filter(w=>w.type=="line").map(w=>w.id));return d=="dataviz"?["Road network","Path"].filter(w=>g.has(w)):d=="hybrid"?["Path","Road","Tunnel"].filter(w=>g.has(w)):d=="streets-v2"?u.getStyle().layers.filter(w=>w["source-layer"]=="transportation"&&w.type=="line").map(w=>w.id):d=="uk-openzoomstack-light"?u.getStyle().layers.filter(w=>w["source-layer"]=="roads"&&w.type=="line").map(w=>w.id):[]}var aS=(u,d,g,w)=>{Tr(d,!De(d)),De(d)?g():w()},oS=Xt("<br/>"),lS=Xt("<br/>"),cS=Xt("<b> </b>"),uS=Xt('<input type="radio" class="svelte-17riygv"/>'),hS=Xt('<label class="svelte-17riygv"><!></label>'),dS=Xt('<input type="radio" class="svelte-17riygv"/>'),pS=Xt('<label class="svelte-17riygv"><!></label>'),fS=Xt("<div><!></div>"),mS=Xt('<button><div class="ltn-map-btn"><!></div></button> <!>',1);function TP(u,d){ss(d,!0);const g=()=>em(Pf,"$interactiveMapLayersEnabled",w),[w,C]=tm(),z=[],T=ar(()=>Ku(Yu("main")));let o=si(!1),B=si("google"),K=[];function X(){d_(Pf,!1),d.map.on("click",he),d.map.getCanvas().style.cursor="crosshair";for(let de of sS(d.map,d.maptilerBasemap))K.push([de,d.map.getPaintProperty(de,"line-color")]),d.map.setPaintProperty(de,"line-color","cyan")}function ce(){d_(Pf,!0),d.map.off("click",he),d.map.getCanvas().style.cursor="inherit";for(let[de,Se]of K)d.map.setPaintProperty(de,"line-color",Se);K=[]}Oy(ce);function he(de){let Se=de.lngLat.lng,Me=de.lngLat.lat;De(B)=="google"?window.open(`https://maps.google.com/maps?q=&layer=c&cbll=${Me},${Se}&cbp=11,0,0,0,0`,"_blank"):De(B)=="bing"&&window.open(`https://www.bing.com/maps?cp=${Me}~${Se}&style=x`,"_blank")}function q(de){!g()&&de.key==De(T).t(49)&&(de.stopPropagation(),ce())}Id("keydown",Md,q),cw(u,{children:(de,Se)=>{var Me=mS(),ke=Ki(Me);ke.__click=[aS,o,X,ce];var Ce=tt(ke),Ee=tt(Ce);{var ae=Xe=>{Z1(Xe,{})},$e=Xe=>{G1(Xe,{})};Na(Ee,Xe=>{De(o)?Xe(ae):Xe($e,!1)})}var Re=Ir(ke,2);{var Oe=Xe=>{var gt=fS();let at;{const nt=Mt=>{var pt=oS();_t(Mt,pt)},mt=Mt=>{var pt=lS();_t(Mt,pt)},At=(Mt,pt=fr)=>{var ht=cS(),lr=tt(ht);Zr(Nt=>sr(lr,Nt),[()=>De(T).tx(pt())]),_t(Mt,ht)},St=(Mt,pt=fr)=>{var ht=hS();{const Nt=qt=>{var Kt=uS();Kt.value=Kt.__value="google",c_(z,[],Kt,()=>De(B),Jt=>Tr(B,Jt)),_t(qt,Kt)};var lr=tt(ht);{let qt=ar(()=>[Nt]);Tn(lr,{get t(){return De(qt)},get x(){return pt()},n:!0})}}_t(Mt,ht)},jt=(Mt,pt=fr)=>{var ht=pS();{const Nt=qt=>{var Kt=dS();Kt.value=Kt.__value="bing",c_(z,[],Kt,()=>De(B),Jt=>Tr(B,Jt)),_t(qt,Kt)};var lr=tt(ht);{let qt=ar(()=>[Nt]);Tn(lr,{get t(){return De(qt)},get x(){return pt()},n:!0})}}_t(Mt,ht)};var rt=tt(gt);{let Mt=ar(()=>[nt,mt,At,St,jt]),pt=ar(()=>De(T).cx(126));Tn(rt,{get t(){return De(Mt)},get x(){return De(pt)}})}}Zr(nt=>at=Yf(gt,1,"street-view-control-source svelte-17riygv",null,at,nt),[()=>({expanded:De(o)})]),_t(Xe,gt)};Na(Re,Xe=>{De(o)&&Xe(Oe)})}Zr(Xe=>na(ke,"title",Xe),[()=>De(T).t(125)]),_t(de,Me)},$$slots:{default:!0}}),as(),C()}As(["click"]);let SP=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],PP=[20,30,40,50,60,70],MP=[10,20,30,50,70,90],$o=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],CP=$o,IP=[0,20,40,60,80,100],EP=$o.toReversed(),AP=$o.toReversed(),kP=[0,.25,.5,1,1.5,2],zP=["#F8E4AF","#9ECC4E","#00BB44","#4ACD8B","#B9E9E9"],DP=$o.toReversed(),RP=$o.toReversed(),LP=[0,20,40,60,80,100],BP=$o,FP=[1,2,3,4,5],OP=$o.toReversed();function jP(u){let d=[];for(let g=1;g<u.length;g++)d.push(g);return d}const NP="#0C793A",VP={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function UP(u){return u}function gS(){th("[data-tippy-content]")}function $P(u){return["interpolate",["linear"],["zoom"],5,.5+u,10,1+u,12,gd(1.5+u,1+u),14,gd(4+u,2+u),16,gd(7+u,4+u),20,gd(24+u,16+u)]}function gd(u,d){return["match",["get","road_kind"],["private","pedestrian","service"],d,u]}function ZP(u){return u<1e3?Math.round(u)+"m":(u/1e3).toFixed(1)+"km"}function GP(u){if(u<60)return Math.round(u)+"s";let d=Math.floor(u/60),g=Math.round(u-d*60);return`${d}m${g}s`}function qP(u,d){return d===0?"0%":`${Math.round(u/d*100)}%`}function WP(u){if(!u)return"custom area";let d=is(Iv);return d=="cnt"||d=="england"?Av(u,"LAD_"):u}function HP(u){let d=is(dm).project(u),g=new Date().toISOString().split("T")[0],w=`${d.project_name}-${g}.geojson`;l2(w,JSON.stringify(d))}function XP(u,d=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",u,15654.303392],d],22,["max",["/",u,.0597164283],d]]}async function KP(u){let d=await fetch(u);if(!d.ok)throw new Error(`${u} not OK: ${d.status}`);return d}function YP(u){return u.reduce((d,g)=>d+g,0)}function Av(u,d){return u.startsWith(d)?u.slice(d.length):u}function JP(u,d){return u.endsWith(d)?u.slice(0,-d.length):u}async function QP(){await new Promise(u=>{requestAnimationFrame(()=>{requestAnimationFrame(u)})})}export{VS as $,zS as A,OS as B,Oy as C,Oa as D,ar as E,Na as F,as as G,D0 as H,$d as I,AS as J,rw as K,Ga as L,fr as M,Xt as N,s1 as O,Zr as P,tt as Q,Yf as R,Ay as S,rm as T,fi as U,Rb as V,FS as W,u1 as X,BS as Y,Vy as Z,Fa as _,ji as a,zP as a$,Id as a0,n_ as a1,Bo as a2,Md as a3,Ir as a4,US as a5,LS as a6,kS as a7,RS as a8,DS as a9,Ku as aA,Yu as aB,NS as aC,fc as aD,As as aE,e1 as aF,VT as aG,lf as aH,qP as aI,KS as aJ,EP as aK,CP as aL,jP as aM,BP as aN,LP as aO,IP as aP,na as aQ,SS as aR,xP as aS,nP as aT,uP as aU,sP as aV,Iv as aW,MS as aX,UT as aY,dr as aZ,c_ as a_,Fy as aa,jS as ab,ZS as ac,i1 as ad,My as ae,sr as af,Py as ag,z0 as ah,ky as ai,Hf as aj,tm as ak,em as al,Pf as am,$S as an,TS as ao,is as ap,HS as aq,WS as ar,bP as as,d_ as at,rP as au,Cv as av,vP as aw,$P as ax,Tn as ay,gP as az,Wa as b,lc as b$,RP as b0,DP as b1,FP as b2,OP as b3,kP as b4,QP as b5,mP as b6,l2 as b7,dm as b8,Ev as b9,GP as bA,YS as bB,JS as bC,HP as bD,eS as bE,fP as bF,eP as bG,YP as bH,KP as bI,GS as bJ,WP as bK,JP as bL,Av as bM,NT as bN,On as bO,XS as bP,GT as bQ,wS as bR,$T as bS,ES as bT,$1 as bU,IS as bV,cw as bW,TP as bX,ZT as bY,qS as bZ,Zt as b_,AP as ba,wP as bb,hP as bc,lP as bd,a1 as be,dP as bf,VP as bg,NP as bh,SP as bi,MP as bj,PP as bk,tP as bl,XP as bm,o2 as bn,aP as bo,iP as bp,yP as bq,gS as br,oP as bs,PS as bt,cP as bu,pP as bv,UP as bw,_P as bx,QS as by,ZP as bz,Vo as c,oc as c0,$f as c1,Wu as c2,yS as c3,jd as c4,Pu as c5,Cs as c6,kf as c7,xS as c8,Zb as c9,o_ as ca,Xb as cb,Vr as d,ly as e,Ud as f,Qn as g,Ki as h,dc as i,Xu as j,_t as k,rc as l,bS as m,vS as n,si as o,Ps as p,ns as q,pc as r,Wf as s,qu as t,ia as u,De as v,Tr as w,$a as x,ss as y,hr as z};
