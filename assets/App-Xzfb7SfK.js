var KA=Object.defineProperty;var YA=(r,e,t)=>e in r?KA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var mr=(r,e,t)=>YA(r,typeof e!="symbol"?e+"":e,t);import{S as kt,i as St,s as gt,e as zn,c as _n,a as wt,d as H,b as Jr,t as G,f as N,u as yn,g as bn,h as vn,j as Od,k as Tn,l as W,m as z,n as ds,o as rr,p as H0,q as Yn,r as he,v as Tr,w as de,x as pe,y as ht,z as QA,A as Er,B as Xu,C as Qd,D as Wf,E as Zt,F as Ht,G as ps,H as rt,I as ei,J as on,K as wn,L as On,M as Nn,N as Pn,O as ce,P as Nt,Q as q,R as Oa,T as _t,U as tw,V as li,W as jm,X as ae,Y as Ze,Z as Cf,_ as Mg,$ as Eg,a0 as Yo,a1 as yt,a2 as Te,a3 as Ig,a4 as Gn,a5 as Or,a6 as e3,a7 as t3,a8 as Mi,a9 as Ks,aa as Ys,ab as kl,ac as n3,ad as r3}from"./pico.conditional.jade.min-D8uPS9mO.js";const Lg=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,i3="/ltn/assets/arrow-big-up-DKeSc1KD.png",o3="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAk0lEQVRIS+3U0Q2AIAwEUNjMUXQydRJH0zZB0wjGuwJfSsKfuWfO1hg6n9g5P3wPWKTSXe6EVstUNEjoloIVghAG0OxR7swgLEAjHoBCvACM1AAQUgJ0DL0nm67WwJom7XrBlhVl4arUAHYniuE1ABTuBeBwD0CFs4D92T12fp9v9iPrnJ8LBu0KC0Ch9qEfeK3sAPceHxk8hJ17AAAAAElFTkSuQmCC",s3="/ltn/assets/favicon-DMAVMD4u.ico",a3="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==",nw="/ltn/assets/no_left_turn-Xpmw1_3C.png",Pg="/ltn/assets/no_right_turn-CZwHVCpW.png",rw="/ltn/assets/no_straight_turn-BWpcWQch.png",iw="/ltn/assets/no_u_left_to_right_turn-C4sWYlhS.png",ow="/ltn/assets/no_u_right_to_left_turn-ClrJyulH.png",l3="/ltn/assets/logo-3MjkCCFo.svg",sw="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAJCAYAAAACTR1pAAAACXBIWXMAAANVAAADaAEorMqLAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAPtJREFUKJF9kT1LwwAURc+NAQsdtFYHa8HBSAcHJ0HBUVz0n7i4ObkoKAV/gYObm5ubu7OKFMQPECFuoQgWRJtch9aSYvSO770D53Flm58kM401BdkesAJcYw4m4scz8kf9qGBGe3ZuNcuCHcEmcGv7qBo/nWKnAzCpR8+/yMGWUWAcU0L6wn4DOgAhcFHEGEoBLGAqoK7te6Eb406h6vv0/NRnyBawDYyATzKFzcmXu9chmaQeHfesVDZeFGqAU0QrMy3BR5FRCKz31FxGGrMdIrpATVD98/0hVSlo16INB9oFLyEuldKsxA/n/4O59DvdB5YNVzKH+U6/AaiZavkY71DDAAAAAElFTkSuQmCC";/**
 * @license lucide-svelte v0.539.0 - ISC
 *
 * ISC License
 * 
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 * 
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 * 
 */const W0={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};function X0(r,e,t){const n=r.slice();return n[11]=e[t][0],n[12]=e[t][1],n}function km(r){let e,t=[r[12]],n={};for(let i=0;i<t.length;i+=1)n=wt(n,t[i]);return{c(){e=ds(r[11]),Od(e,n)},m(i,o){W(i,e,o)},p(i,o){Od(e,n=Tn(t,[o&32&&i[12]]))},d(i){i&&H(e)}}}function J0(r){let e=r[11],t,n=r[11]&&km(r);return{c(){n&&n.c(),t=rr()},m(i,o){n&&n.m(i,o),W(i,t,o)},p(i,o){i[11]?e?gt(e,i[11])?(n.d(1),n=km(i),e=i[11],n.c(),n.m(t.parentNode,t)):n.p(i,o):(n=km(i),e=i[11],n.c(),n.m(t.parentNode,t)):e&&(n.d(1),n=null,e=i[11])},d(i){i&&H(t),n&&n.d(i)}}}function u3(r){let e,t,n,i,o,u=zn(r[5]),a=[];for(let S=0;S<u.length;S+=1)a[S]=J0(X0(r,u,S));const d=r[10].default,m=_n(d,r,r[9],null);let _=[W0,r[7],{width:r[2]},{height:r[2]},{stroke:r[1]},{"stroke-width":n=r[4]?Number(r[3])*24/Number(r[2]):r[3]},{class:i=r[6]("lucide-icon","lucide",r[0]?`lucide-${r[0]}`:"",r[8].class)}],v={};for(let S=0;S<_.length;S+=1)v=wt(v,_[S]);return{c(){e=ds("svg");for(let S=0;S<a.length;S+=1)a[S].c();t=rr(),m&&m.c(),Od(e,v)},m(S,T){W(S,e,T);for(let C=0;C<a.length;C+=1)a[C]&&a[C].m(e,null);z(e,t),m&&m.m(e,null),o=!0},p(S,[T]){if(T&32){u=zn(S[5]);let C;for(C=0;C<u.length;C+=1){const L=X0(S,u,C);a[C]?a[C].p(L,T):(a[C]=J0(L),a[C].c(),a[C].m(e,t))}for(;C<a.length;C+=1)a[C].d(1);a.length=u.length}m&&m.p&&(!o||T&512)&&yn(m,d,S,S[9],o?vn(d,S[9],T,null):bn(S[9]),null),Od(e,v=Tn(_,[W0,T&128&&S[7],(!o||T&4)&&{width:S[2]},(!o||T&4)&&{height:S[2]},(!o||T&2)&&{stroke:S[1]},(!o||T&28&&n!==(n=S[4]?Number(S[3])*24/Number(S[2]):S[3]))&&{"stroke-width":n},(!o||T&257&&i!==(i=S[6]("lucide-icon","lucide",S[0]?`lucide-${S[0]}`:"",S[8].class)))&&{class:i}]))},i(S){o||(N(m,S),o=!0)},o(S){G(m,S),o=!1},d(S){S&&H(e),Jr(a,S),m&&m.d(S)}}}function c3(r,e,t){const n=["name","color","size","strokeWidth","absoluteStrokeWidth","iconNode"];let i=H0(e,n),{$$slots:o={},$$scope:u}=e,{name:a=void 0}=e,{color:d="currentColor"}=e,{size:m=24}=e,{strokeWidth:_=2}=e,{absoluteStrokeWidth:v=!1}=e,{iconNode:S=[]}=e;const T=(...C)=>C.filter((L,P,D)=>!!L&&D.indexOf(L)===P).join(" ");return r.$$set=C=>{t(8,e=wt(wt({},e),Yn(C))),t(7,i=H0(e,n)),"name"in C&&t(0,a=C.name),"color"in C&&t(1,d=C.color),"size"in C&&t(2,m=C.size),"strokeWidth"in C&&t(3,_=C.strokeWidth),"absoluteStrokeWidth"in C&&t(4,v=C.absoluteStrokeWidth),"iconNode"in C&&t(5,S=C.iconNode),"$$scope"in C&&t(9,u=C.$$scope)},e=Yn(e),[a,d,m,_,v,S,T,i,e,u,o]}class yi extends kt{constructor(e){super(),St(this,e,c3,u3,gt,{name:0,color:1,size:2,strokeWidth:3,absoluteStrokeWidth:4,iconNode:5})}}function f3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function h3(r){let e,t;const n=[{name:"arrow-up"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[f3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function d3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m5 12 7-7 7 7"}],["path",{d:"M12 19V5"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class p3 extends kt{constructor(e){super(),St(this,e,d3,h3,gt,{})}}function m3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function g3(r){let e,t;const n=[{name:"circle-plus"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[m3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function _3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M8 12h8"}],["path",{d:"M12 8v8"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class y3 extends kt{constructor(e){super(),St(this,e,_3,g3,gt,{})}}function b3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function v3(r){let e,t;const n=[{name:"circle-question-mark"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[b3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function w3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"}],["path",{d:"M12 17h.01"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class aw extends kt{constructor(e){super(),St(this,e,w3,v3,gt,{})}}function x3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function A3(r){let e,t;const n=[{name:"copy"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[x3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function k3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class lw extends kt{constructor(e){super(),St(this,e,k3,A3,gt,{})}}function S3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function T3(r){let e,t;const n=[{name:"eraser"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[S3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function C3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21"}],["path",{d:"m5.082 11.09 8.828 8.828"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class M3 extends kt{constructor(e){super(),St(this,e,C3,T3,gt,{})}}function E3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function I3(r){let e,t;const n=[{name:"eye-closed"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[E3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function L3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m15 18-.722-3.25"}],["path",{d:"M2 8a10.645 10.645 0 0 0 20 0"}],["path",{d:"m20 15-1.726-2.05"}],["path",{d:"m4 15 1.726-2.05"}],["path",{d:"m9 18 .722-3.25"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class P3 extends kt{constructor(e){super(),St(this,e,L3,I3,gt,{})}}function z3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function D3(r){let e,t;const n=[{name:"eye"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[z3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function R3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"}],["circle",{cx:"12",cy:"12",r:"3"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class B3 extends kt{constructor(e){super(),St(this,e,R3,D3,gt,{})}}function F3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function O3(r){let e,t;const n=[{name:"file-down"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[F3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function N3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}],["path",{d:"M12 18v-6"}],["path",{d:"m9 15 3 3 3-3"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class uw extends kt{constructor(e){super(),St(this,e,N3,O3,gt,{})}}function $3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function j3(r){let e,t;const n=[{name:"folder-open"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[$3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function U3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class V3 extends kt{constructor(e){super(),St(this,e,U3,j3,gt,{})}}function q3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function G3(r){let e,t;const n=[{name:"globe"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[q3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Z3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"12",cy:"12",r:"10"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"}],["path",{d:"M2 12h20"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class H3 extends kt{constructor(e){super(),St(this,e,Z3,G3,gt,{})}}function W3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function X3(r){let e,t;const n=[{name:"house"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[W3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function J3(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class K3 extends kt{constructor(e){super(),St(this,e,J3,X3,gt,{})}}function Y3(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Q3(r){let e,t;const n=[{name:"layers"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Y3]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function ek(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class tk extends kt{constructor(e){super(),St(this,e,ek,Q3,gt,{})}}function nk(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function rk(r){let e,t;const n=[{name:"paintbrush"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[nk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function ik(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"m14.622 17.897-10.68-2.913"}],["path",{d:"M18.376 2.622a1 1 0 1 1 3.002 3.002L17.36 9.643a.5.5 0 0 0 0 .707l.944.944a2.41 2.41 0 0 1 0 3.408l-.944.944a.5.5 0 0 1-.707 0L8.354 7.348a.5.5 0 0 1 0-.707l.944-.944a2.41 2.41 0 0 1 3.408 0l.944.944a.5.5 0 0 0 .707 0z"}],["path",{d:"M9 8c-1.804 2.71-3.97 3.46-6.583 3.948a.507.507 0 0 0-.302.819l7.32 8.883a1 1 0 0 0 1.185.204C12.735 20.405 16 16.792 16 15"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class ok extends kt{constructor(e){super(),St(this,e,ik,rk,gt,{})}}function sk(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function ak(r){let e,t;const n=[{name:"pencil"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[sk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function lk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z"}],["path",{d:"m15 5 4 4"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class zg extends kt{constructor(e){super(),St(this,e,lk,ak,gt,{})}}function uk(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function ck(r){let e,t;const n=[{name:"pointer"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[uk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function fk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M22 14a8 8 0 0 1-8 8"}],["path",{d:"M18 11v-1a2 2 0 0 0-2-2a2 2 0 0 0-2 2"}],["path",{d:"M14 10V9a2 2 0 0 0-2-2a2 2 0 0 0-2 2v1"}],["path",{d:"M10 9.5V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v10"}],["path",{d:"M18 11a2 2 0 1 1 4 0v3a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class cw extends kt{constructor(e){super(),St(this,e,fk,ck,gt,{})}}function hk(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function dk(r){let e,t;const n=[{name:"redo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[hk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function pk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M21 7v6h-6"}],["path",{d:"M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class mk extends kt{constructor(e){super(),St(this,e,pk,dk,gt,{})}}function gk(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function _k(r){let e,t;const n=[{name:"route"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[gk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function yk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["circle",{cx:"6",cy:"19",r:"3"}],["path",{d:"M9 19h8.5a3.5 3.5 0 0 0 0-7h-11a3.5 3.5 0 0 1 0-7H15"}],["circle",{cx:"18",cy:"5",r:"3"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class bk extends kt{constructor(e){super(),St(this,e,yk,_k,gt,{})}}function vk(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function wk(r){let e,t;const n=[{name:"trash-2"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[vk]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function xk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M10 11v6"}],["path",{d:"M14 11v6"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"}],["path",{d:"M3 6h18"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class ep extends kt{constructor(e){super(),St(this,e,xk,wk,gt,{})}}function Ak(r){let e;const t=r[2].default,n=_n(t,r,r[3],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8)&&yn(n,t,i,i[3],e?vn(t,i[3],o,null):bn(i[3]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function kk(r){let e,t;const n=[{name:"undo"},r[1],{iconNode:r[0]}];let i={$$slots:{default:[Ak]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new yi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[n[0],u&2&&Tr(o[1]),u&1&&{iconNode:o[0]}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Sk(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=[["path",{d:"M3 7v6h6"}],["path",{d:"M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"}]];return r.$$set=u=>{t(1,e=wt(wt({},e),Yn(u))),"$$scope"in u&&t(3,i=u.$$scope)},e=Yn(e),[o,e,n,i]}class Tk extends kt{constructor(e){super(),St(this,e,Sk,kk,gt,{})}}const Su=[];function Td(r,e){return{subscribe:Dn(r,e).subscribe}}function Dn(r,e=ht){let t;const n=new Set;function i(a){if(gt(r,a)&&(r=a,t)){const d=!Su.length;for(const m of n)m[1](),Su.push(m,r);if(d){for(let m=0;m<Su.length;m+=2)Su[m][0](Su[m+1]);Su.length=0}}}function o(a){i(a(r))}function u(a,d=ht){const m=[a,d];return n.add(m),n.size===1&&(t=e(i,o)||ht),a(r),()=>{n.delete(m),n.size===0&&t&&(t(),t=null)}}return{set:i,update:o,subscribe:u}}function fw(r,e,t){const n=!Array.isArray(r),i=n?[r]:r;if(!i.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return Td(t,(u,a)=>{let d=!1;const m=[];let _=0,v=ht;const S=()=>{if(_)return;v();const C=e(n?m[0]:m,u,a);o?u(C):v=Xu(C)?C:ht},T=i.map((C,L)=>QA(C,P=>{m[L]=P,_&=~(1<<L),d&&S()},()=>{_|=1<<L}));return d=!0,S(),function(){Er(T),v(),d=!1}})}let Ck=Date.now();function Ua(r){return`${r}-${Ck++}`}const Dg=Symbol.for("svelte-maplibre");function Va(){return Wf(Dg)}function Mk(r){let e=new WeakMap;return t=>{var u;let n=e.get(t.originalEvent);if(n!==void 0)return n;let o=(u=t.target.queryRenderedFeatures(t.point).find(a=>{var d;return(d=r.get(a.layer.id))==null?void 0:d.interactive}))==null?void 0:u.layer.id;return e.set(t.originalEvent,o),o}}function Ek(){let r=new Map;return Qd(Dg,{map:Dn(null),source:Td(null),layer:Td(null),popupTarget:Td(null),cluster:Dn(),loadedImages:Dn(new Set),minzoom:Dn(0),maxzoom:Dn(24),layerEvent:Dn(null),layerInfo:r,eventTopMost:Mk(r),markerClickManager:new Pk})}function K0(r){return{subscribe:r.subscribe}}function Rg({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=Va(),o=Dn(null),u=K0(o),a={...i,[r]:K0(o)};if(e&&(a.popupTarget=u),n){let d=Dn(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=Dn()),Qd(Dg,a),{...i,self:o}}function hw(){return Rg({key:"source",setCluster:!0})}function dw(r=!0){return Rg({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Ik(){return Rg({key:"popupTarget",setPopupTarget:!0,setMouseEvent:!0})}function Lk(r){return"layerType"in r&&r.layerType==="deckgl"}class Pk{constructor(){mr(this,"_handlers",new Set)}add(e){this._handlers.add(e)}remove(e){this._handlers.delete(e)}handleClick(e){for(const t of this._handlers)t(e)}}var pw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function mw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function gw(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var _w={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */(function(r,e){(function(t,n){r.exports=n()})(pw,function(){var t={},n={};function i(u,a,d){if(n[u]=d,u==="index"){var m="var sharedModule = {}; ("+n.shared+")(sharedModule); ("+n.worker+")(sharedModule);",_={};return n.shared(_),n.index(t,_),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([m],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function a(c,l,f,p){return new(f||(f=Promise))(function(b,A){function k(V){try{R(p.next(V))}catch(K){A(K)}}function M(V){try{R(p.throw(V))}catch(K){A(K)}}function R(V){var K;V.done?b(V.value):(K=V.value,K instanceof f?K:new f(function(te){te(K)})).then(k,M)}R((p=p.apply(c,l||[])).next())})}function d(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var m=_;function _(c,l){this.x=c,this.y=l}_.prototype={clone:function(){return new _(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,l){return this.clone()._rotateAround(c,l)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var l=c.x-this.x,f=c.y-this.y;return l*l+f*f},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,l){return Math.atan2(this.x*l-this.y*c,this.x*c+this.y*l)},_matMult:function(c){var l=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=l,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var l=Math.cos(c),f=Math.sin(c),p=f*this.x+l*this.y;return this.x=l*this.x-f*this.y,this.y=p,this},_rotateAround:function(c,l){var f=Math.cos(c),p=Math.sin(c),b=l.y+p*(this.x-l.x)+f*(this.y-l.y);return this.x=l.x+f*(this.x-l.x)-p*(this.y-l.y),this.y=b,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},_.convert=function(c){return c instanceof _?c:Array.isArray(c)?new _(c[0],c[1]):c};var v=d(m),S=T;function T(c,l,f,p){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=l,this.p2x=f,this.p2y=p}T.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,l){if(l===void 0&&(l=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,p=0;p<8;p++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<l)return f;var A=this.sampleCurveDerivativeX(f);if(Math.abs(A)<1e-6)break;f-=b/A}var k=0,M=1;for(f=c,p=0;p<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<l));p++)c>b?k=f:M=f,f=.5*(M-k)+k;return f},solve:function(c,l){return this.sampleCurveY(this.solveCurveX(c,l))}};var C=d(S);let L,P;function D(){return L==null&&(L=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),L}function I(){if(P==null&&(P=!1,D())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let p=0;p<5*5;p++){const b=4*p;l.fillStyle=`rgb(${b},${b+1},${b+2})`,l.fillRect(p%5,Math.floor(p/5),1,1)}const f=l.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&f[p]!==p){P=!0;break}}}return P||!1}function U(c,l,f,p){const b=new C(c,l,f,p);return A=>b.solve(A)}const O=U(.25,.1,.25,1);function ee(c,l,f){return Math.min(f,Math.max(l,c))}function X(c,l,f){const p=f-l,b=((c-l)%p+p)%p+l;return b===l?f:b}function ue(c,...l){for(const f of l)for(const p in f)c[p]=f[p];return c}let $=1;function Q(c,l,f){const p={};for(const b in c)p[b]=l.call(this,c[b],b,c);return p}function ne(c,l,f){const p={};for(const b in c)l.call(this,c[b],b,c)&&(p[b]=c[b]);return p}function F(c){return Array.isArray(c)?c.map(F):typeof c=="object"&&c?Q(c,F):c}const Z={};function J(c){Z[c]||(typeof console<"u"&&console.warn(c),Z[c]=!0)}function be(c,l,f){return(f.y-c.y)*(l.x-c.x)>(l.y-c.y)*(f.x-c.x)}function ke(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let ge=null;function ve(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const fe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Pe(c,l,f,p,b){return a(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const A=new VideoFrame(c,{timestamp:0});try{const k=A==null?void 0:A.format;if(!k||!k.startsWith("BGR")&&!k.startsWith("RGB"))throw new Error(`Unrecognized format ${k}`);const M=k.startsWith("BGR"),R=new Uint8ClampedArray(p*b*4);if(yield A.copyTo(R,function(V,K,te,se,me){const ye=4*Math.max(-K,0),xe=(Math.max(0,te)-te)*se*4+ye,Le=4*se,De=Math.max(0,K),Qe=Math.max(0,te);return{rect:{x:De,y:Qe,width:Math.min(V.width,K+se)-De,height:Math.min(V.height,te+me)-Qe},layout:[{offset:xe,stride:Le}]}}(c,l,f,p,b)),M)for(let V=0;V<R.length;V+=4){const K=R[V];R[V]=R[V+2],R[V+2]=K}return R}finally{A.close()}})}let Ee,Fe;const ot="AbortError";function ct(){return new Error(ot)}const it={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function at(c){return it.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const ft="global-dispatcher";class Ct extends Error{constructor(l,f,p,b){super(`AJAXError: ${f} (${l}): ${p}`),this.status=l,this.statusText=f,this.url=p,this.body=b}}const xt=()=>ke(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,It=function(c,l){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const p=at(c.url);if(p)return p(c,l);if(ke(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,targetMapId:ft},l)}if(!(/^file:/.test(f=c.url)||/^file:/.test(xt())&&!/^\w+:/.test(f))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,b){return a(this,void 0,void 0,function*(){const A=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:xt(),signal:b.signal});p.type!=="json"||A.headers.has("Accept")||A.headers.set("Accept","application/json");const k=yield fetch(A);if(!k.ok){const V=yield k.blob();throw new Ct(k.status,k.statusText,p.url,V)}let M;M=p.type==="arrayBuffer"||p.type==="image"?k.arrayBuffer():p.type==="json"?k.json():k.text();const R=yield M;if(b.signal.aborted)throw ct();return{data:R,cacheControl:k.headers.get("Cache-Control"),expires:k.headers.get("Expires")}})}(c,l);if(ke(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:c,mustQueue:!0,targetMapId:ft},l)}var f;return function(p,b){return new Promise((A,k)=>{var M;const R=new XMLHttpRequest;R.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(R.responseType="arraybuffer");for(const V in p.headers)R.setRequestHeader(V,p.headers[V]);p.type==="json"&&(R.responseType="text",!((M=p.headers)===null||M===void 0)&&M.Accept||R.setRequestHeader("Accept","application/json")),R.withCredentials=p.credentials==="include",R.onerror=()=>{k(new Error(R.statusText))},R.onload=()=>{if(!b.signal.aborted)if((R.status>=200&&R.status<300||R.status===0)&&R.response!==null){let V=R.response;if(p.type==="json")try{V=JSON.parse(R.response)}catch(K){return void k(K)}A({data:V,cacheControl:R.getResponseHeader("Cache-Control"),expires:R.getResponseHeader("Expires")})}else{const V=new Blob([R.response],{type:R.getResponseHeader("Content-Type")});k(new Ct(R.status,R.statusText,p.url,V))}},b.signal.addEventListener("abort",()=>{R.abort(),k(ct())}),R.send(p.body)})}(c,l)};function Qt(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const l=new URL(c),f=window.location;return l.protocol===f.protocol&&l.host===f.host}function tn(c,l,f){f[c]&&f[c].indexOf(l)!==-1||(f[c]=f[c]||[],f[c].push(l))}function rn(c,l,f){if(f&&f[c]){const p=f[c].indexOf(l);p!==-1&&f[c].splice(p,1)}}class Ue{constructor(l,f={}){ue(this,f),this.type=l}}class Xe extends Ue{constructor(l,f={}){super("error",ue({error:l},f))}}class qt{on(l,f){return this._listeners=this._listeners||{},tn(l,f,this._listeners),this}off(l,f){return rn(l,f,this._listeners),rn(l,f,this._oneTimeListeners),this}once(l,f){return f?(this._oneTimeListeners=this._oneTimeListeners||{},tn(l,f,this._oneTimeListeners),this):new Promise(p=>this.once(l,p))}fire(l,f){typeof l=="string"&&(l=new Ue(l,f||{}));const p=l.type;if(this.listens(p)){l.target=this;const b=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const M of b)M.call(this,l);const A=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const M of A)rn(p,M,this._oneTimeListeners),M.call(this,l);const k=this._eventedParent;k&&(ue(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(l))}else l instanceof Xe&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,f){return this._eventedParent=l,this._eventedParentData=f,this}}var Ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const et=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function nn(c,l){const f={};for(const p in c)p!=="ref"&&(f[p]=c[p]);return et.forEach(p=>{p in l&&(f[p]=l[p])}),f}function Ye(c,l){if(Array.isArray(c)){if(!Array.isArray(l)||c.length!==l.length)return!1;for(let f=0;f<c.length;f++)if(!Ye(c[f],l[f]))return!1;return!0}if(typeof c=="object"&&c!==null&&l!==null){if(typeof l!="object"||Object.keys(c).length!==Object.keys(l).length)return!1;for(const f in c)if(!Ye(c[f],l[f]))return!1;return!0}return c===l}function Ft(c,l){c.push(l)}function Tt(c,l,f){Ft(f,{command:"addSource",args:[c,l[c]]})}function Rn(c,l,f){Ft(l,{command:"removeSource",args:[c]}),f[c]=!0}function fr(c,l,f,p){Rn(c,f,p),Tt(c,l,f)}function un(c,l,f){let p;for(p in c[f])if(Object.prototype.hasOwnProperty.call(c[f],p)&&p!=="data"&&!Ye(c[f][p],l[f][p]))return!1;for(p in l[f])if(Object.prototype.hasOwnProperty.call(l[f],p)&&p!=="data"&&!Ye(c[f][p],l[f][p]))return!1;return!0}function Dt(c,l,f,p,b,A){c=c||{},l=l||{};for(const k in c)Object.prototype.hasOwnProperty.call(c,k)&&(Ye(c[k],l[k])||f.push({command:A,args:[p,k,l[k],b]}));for(const k in l)Object.prototype.hasOwnProperty.call(l,k)&&!Object.prototype.hasOwnProperty.call(c,k)&&(Ye(c[k],l[k])||f.push({command:A,args:[p,k,l[k],b]}))}function Mt(c){return c.id}function Vr(c,l){return c[l.id]=l,c}class vt{constructor(l,f,p,b){this.message=(l?`${l}: `:"")+p,b&&(this.identifier=b),f!=null&&f.__line__&&(this.line=f.__line__)}}function Cn(c,...l){for(const f of l)for(const p in f)c[p]=f[p];return c}class Zn extends Error{constructor(l,f){super(f),this.message=f,this.key=l}}class jr{constructor(l,f=[]){this.parent=l,this.bindings={};for(const[p,b]of f)this.bindings[p]=b}concat(l){return new jr(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const Nr={kind:"null"},Lt={kind:"number"},tt={kind:"string"},pt={kind:"boolean"},$t={kind:"color"},Bn={kind:"object"},zt={kind:"value"},hr={kind:"collator"},ir={kind:"formatted"},Gr={kind:"padding"},br={kind:"resolvedImage"},Ce={kind:"variableAnchorOffsetCollection"};function oe(c,l){return{kind:"array",itemType:c,N:l}}function le(c){if(c.kind==="array"){const l=le(c.itemType);return typeof c.N=="number"?`array<${l}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${l}>`}return c.kind}const we=[Nr,Lt,tt,pt,$t,ir,Bn,oe(zt),Gr,br,Ce];function Me(c,l){if(l.kind==="error")return null;if(c.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!Me(c.itemType,l.itemType))&&(typeof c.N!="number"||c.N===l.N))return null}else{if(c.kind===l.kind)return null;if(c.kind==="value"){for(const f of we)if(!Me(f,l))return null}}return`Expected ${le(c)} but found ${le(l)} instead.`}function Ne(c,l){return l.some(f=>f.kind===c.kind)}function Ve(c,l){return l.some(f=>f==="null"?c===null:f==="array"?Array.isArray(c):f==="object"?c&&!Array.isArray(c)&&typeof c=="object":f===typeof c)}function Ke(c,l){return c.kind==="array"&&l.kind==="array"?c.itemType.kind===l.itemType.kind&&typeof c.N=="number":c.kind===l.kind}const Oe=.96422,ut=.82521,At=4/29,st=6/29,Rt=3*st*st,hn=st*st*st,mn=Math.PI/180,Qn=180/Math.PI;function Ln(c){return(c%=360)<0&&(c+=360),c}function er([c,l,f,p]){let b,A;const k=Zr((.2225045*(c=Un(c))+.7168786*(l=Un(l))+.0606169*(f=Un(f)))/1);c===l&&l===f?b=A=k:(b=Zr((.4360747*c+.3850649*l+.1430804*f)/Oe),A=Zr((.0139322*c+.0971045*l+.7141733*f)/ut));const M=116*k-16;return[M<0?0:M,500*(b-k),200*(k-A),p]}function Un(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Zr(c){return c>hn?Math.pow(c,1/3):c/Rt+At}function $r([c,l,f,p]){let b=(c+16)/116,A=isNaN(l)?b:b+l/500,k=isNaN(f)?b:b-f/200;return b=1*Sn(b),A=Oe*Sn(A),k=ut*Sn(k),[He(3.1338561*A-1.6168667*b-.4906146*k),He(-.9787684*A+1.9161415*b+.033454*k),He(.0719453*A-.2289914*b+1.4052427*k),p]}function He(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Sn(c){return c>st?c*c*c:Rt*(c-At)}function Fn(c){return parseInt(c.padEnd(2,c),16)/255}function dr(c,l){return _r(l?c/100:c,0,1)}function _r(c,l,f){return Math.min(Math.max(l,c),f)}function Pr(c){return!c.some(Number.isNaN)}const Ei={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class gn{constructor(l,f,p,b=1,A=!0){this.r=l,this.g=f,this.b=p,this.a=b,A||(this.r*=b,this.g*=b,this.b*=b,b||this.overwriteGetter("rgb",[l,f,p,b]))}static parse(l){if(l instanceof gn)return l;if(typeof l!="string")return;const f=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const b=Ei[p];if(b){const[k,M,R]=b;return[k/255,M/255,R/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const k=p.length<6?1:2;let M=1;return[Fn(p.slice(M,M+=k)),Fn(p.slice(M,M+=k)),Fn(p.slice(M,M+=k)),Fn(p.slice(M,M+k)||"ff")]}if(p.startsWith("rgb")){const k=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(k){const[M,R,V,K,te,se,me,ye,xe,Le,De,Qe]=k,je=[K||" ",me||" ",Le].join("");if(je==="  "||je==="  /"||je===",,"||je===",,,"){const Je=[V,se,xe].join(""),lt=Je==="%%%"?100:Je===""?255:0;if(lt){const Et=[_r(+R/lt,0,1),_r(+te/lt,0,1),_r(+ye/lt,0,1),De?dr(+De,Qe):1];if(Pr(Et))return Et}}return}}const A=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(A){const[k,M,R,V,K,te,se,me,ye]=A,xe=[R||" ",K||" ",se].join("");if(xe==="  "||xe==="  /"||xe===",,"||xe===",,,"){const Le=[+M,_r(+V,0,100),_r(+te,0,100),me?dr(+me,ye):1];if(Pr(Le))return function([De,Qe,je,Je]){function lt(Et){const Xt=(Et+De/30)%12,xn=Qe*Math.min(je,1-je);return je-xn*Math.max(-1,Math.min(Xt-3,9-Xt,1))}return De=Ln(De),Qe/=100,je/=100,[lt(0),lt(8),lt(4),Je]}(Le)}}}(l);return f?new gn(...f,!1):void 0}get rgb(){const{r:l,g:f,b:p,a:b}=this,A=b||1/0;return this.overwriteGetter("rgb",[l/A,f/A,p/A,b])}get hcl(){return this.overwriteGetter("hcl",function(l){const[f,p,b,A]=er(l),k=Math.sqrt(p*p+b*b);return[Math.round(1e4*k)?Ln(Math.atan2(b,p)*Qn):NaN,k,f,A]}(this.rgb))}get lab(){return this.overwriteGetter("lab",er(this.rgb))}overwriteGetter(l,f){return Object.defineProperty(this,l,{value:f}),f}toString(){const[l,f,p,b]=this.rgb;return`rgba(${[l,f,p].map(A=>Math.round(255*A)).join(",")},${b})`}}gn.black=new gn(0,0,0,1),gn.white=new gn(1,1,1,1),gn.transparent=new gn(0,0,0,0),gn.red=new gn(1,0,0,1);class Qo{constructor(l,f,p){this.sensitivity=l?f?"variant":"case":f?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,f){return this.collator.compare(l,f)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class bi{constructor(l,f,p,b,A){this.text=l,this.image=f,this.scale=p,this.fontStack=b,this.textColor=A}}class pi{constructor(l){this.sections=l}static fromString(l){return new pi([new bi(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(l=>l.text.length!==0||l.image&&l.image.name.length!==0)}static factory(l){return l instanceof pi?l:pi.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map(l=>l.text).join("")}}class Ur{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Ur)return l;if(typeof l=="number")return new Ur([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const f of l)if(typeof f!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new Ur(l)}}toString(){return JSON.stringify(this.values)}}const Il=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ci{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof ci)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let f=0;f<l.length;f+=2){const p=l[f],b=l[f+1];if(typeof p!="string"||!Il.has(p)||!Array.isArray(b)||b.length!==2||typeof b[0]!="number"||typeof b[1]!="number")return}return new ci(l)}}toString(){return JSON.stringify(this.values)}}class Ii{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Ii({name:l,available:!1}):null}}function mo(c,l,f,p){return typeof c=="number"&&c>=0&&c<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof f=="number"&&f>=0&&f<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[c,l,f,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[c,l,f,p]:[c,l,f]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Hi(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof gn||c instanceof Qo||c instanceof pi||c instanceof Ur||c instanceof ci||c instanceof Ii)return!0;if(Array.isArray(c)){for(const l of c)if(!Hi(l))return!1;return!0}if(typeof c=="object"){for(const l in c)if(!Hi(c[l]))return!1;return!0}return!1}function tr(c){if(c===null)return Nr;if(typeof c=="string")return tt;if(typeof c=="boolean")return pt;if(typeof c=="number")return Lt;if(c instanceof gn)return $t;if(c instanceof Qo)return hr;if(c instanceof pi)return ir;if(c instanceof Ur)return Gr;if(c instanceof ci)return Ce;if(c instanceof Ii)return br;if(Array.isArray(c)){const l=c.length;let f;for(const p of c){const b=tr(p);if(f){if(f===b)continue;f=zt;break}f=b}return oe(f||zt,l)}return Bn}function Ga(c){const l=typeof c;return c===null?"":l==="string"||l==="number"||l==="boolean"?String(c):c instanceof gn||c instanceof pi||c instanceof Ur||c instanceof ci||c instanceof Ii?c.toString():JSON.stringify(c)}class go{constructor(l,f){this.type=l,this.value=f}static parse(l,f){if(l.length!==2)return f.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Hi(l[1]))return f.error("invalid value");const p=l[1];let b=tr(p);const A=f.expectedType;return b.kind!=="array"||b.N!==0||!A||A.kind!=="array"||typeof A.N=="number"&&A.N!==0||(b=A),new go(b,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Kr{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const Ll={string:tt,number:Lt,boolean:pt,object:Bn};class _o{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");let p,b=1;const A=l[0];if(A==="array"){let M,R;if(l.length>2){const V=l[1];if(typeof V!="string"||!(V in Ll)||V==="object")return f.error('The item type argument of "array" must be one of string, number, boolean',1);M=Ll[V],b++}else M=zt;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return f.error('The length argument to "array" must be a positive integer literal',2);R=l[2],b++}p=oe(M,R)}else{if(!Ll[A])throw new Error(`Types doesn't contain name = ${A}`);p=Ll[A]}const k=[];for(;b<l.length;b++){const M=f.parse(l[b],b,zt);if(!M)return null;k.push(M)}return new _o(p,k)}evaluate(l){for(let f=0;f<this.args.length;f++){const p=this.args[f].evaluate(l);if(!Me(this.type,tr(p)))return p;if(f===this.args.length-1)throw new Kr(`Expected value to be of type ${le(this.type)}, but found ${le(tr(p))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const rc={"to-boolean":pt,"to-color":$t,"to-number":Lt,"to-string":tt};class yo{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");const p=l[0];if(!rc[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&l.length!==2)return f.error("Expected one argument.");const b=rc[p],A=[];for(let k=1;k<l.length;k++){const M=f.parse(l[k],k,zt);if(!M)return null;A.push(M)}return new yo(b,A)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let f,p;for(const b of this.args){if(f=b.evaluate(l),p=null,f instanceof gn)return f;if(typeof f=="string"){const A=l.parseColor(f);if(A)return A}else if(Array.isArray(f)&&(p=f.length<3||f.length>4?`Invalid rbga value ${JSON.stringify(f)}: expected an array containing either three or four numeric values.`:mo(f[0],f[1],f[2],f[3]),!p))return new gn(f[0]/255,f[1]/255,f[2]/255,f[3])}throw new Kr(p||`Could not parse color from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"padding":{let f;for(const p of this.args){f=p.evaluate(l);const b=Ur.parse(f);if(b)return b}throw new Kr(`Could not parse padding from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"variableAnchorOffsetCollection":{let f;for(const p of this.args){f=p.evaluate(l);const b=ci.parse(f);if(b)return b}throw new Kr(`Could not parse variableAnchorOffsetCollection from value '${typeof f=="string"?f:JSON.stringify(f)}'`)}case"number":{let f=null;for(const p of this.args){if(f=p.evaluate(l),f===null)return 0;const b=Number(f);if(!isNaN(b))return b}throw new Kr(`Could not convert ${JSON.stringify(f)} to number.`)}case"formatted":return pi.fromString(Ga(this.args[0].evaluate(l)));case"resolvedImage":return Ii.fromString(Ga(this.args[0].evaluate(l)));default:return Ga(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}const cp=["Unknown","Point","LineString","Polygon"];class Pl{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?cp[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let f=this._parseColorCache[l];return f||(f=this._parseColorCache[l]=gn.parse(l)),f}}class Ls{constructor(l,f,p=[],b,A=new jr,k=[]){this.registry=l,this.path=p,this.key=p.map(M=>`[${M}]`).join(""),this.scope=A,this.errors=k,this.expectedType=b,this._isConstant=f}parse(l,f,p,b,A={}){return f?this.concat(f,p,b)._parse(l,A):this._parse(l,A)}_parse(l,f){function p(b,A,k){return k==="assert"?new _o(A,[b]):k==="coerce"?new yo(A,[b]):b}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const b=l[0];if(typeof b!="string")return this.error(`Expression name must be a string, but found ${typeof b} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const A=this.registry[b];if(A){let k=A.parse(l,this);if(!k)return null;if(this.expectedType){const M=this.expectedType,R=k.type;if(M.kind!=="string"&&M.kind!=="number"&&M.kind!=="boolean"&&M.kind!=="object"&&M.kind!=="array"||R.kind!=="value")if(M.kind!=="color"&&M.kind!=="formatted"&&M.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(M.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(M.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(M,R))return null}else k=p(k,M,f.typeAnnotation||"coerce");else k=p(k,M,f.typeAnnotation||"coerce");else k=p(k,M,f.typeAnnotation||"coerce");else k=p(k,M,f.typeAnnotation||"assert")}if(!(k instanceof go)&&k.type.kind!=="resolvedImage"&&this._isConstant(k)){const M=new Pl;try{k=new go(k.type,k.evaluate(M))}catch(R){return this.error(R.message),null}}return k}return this.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,f,p){const b=typeof l=="number"?this.path.concat(l):this.path,A=p?this.scope.concat(p):this.scope;return new Ls(this.registry,this._isConstant,b,f||null,A,this.errors)}error(l,...f){const p=`${this.key}${f.map(b=>`[${b}]`).join("")}`;this.errors.push(new Zn(p,l))}checkSubtype(l,f){const p=Me(l,f);return p&&this.error(p),p}}class ms{constructor(l,f){this.type=f.type,this.bindings=[].concat(l),this.result=f}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const f of this.bindings)l(f[1]);l(this.result)}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const p=[];for(let A=1;A<l.length-1;A+=2){const k=l[A];if(typeof k!="string")return f.error(`Expected string, but found ${typeof k} instead.`,A);if(/[^a-zA-Z0-9_]/.test(k))return f.error("Variable names must contain only alphanumeric characters or '_'.",A);const M=f.parse(l[A+1],A+1);if(!M)return null;p.push([k,M])}const b=f.parse(l[l.length-1],l.length-1,f.expectedType,p);return b?new ms(p,b):null}outputDefined(){return this.result.outputDefined()}}class ur{constructor(l,f){this.type=f.type,this.name=l,this.boundExpression=f}static parse(l,f){if(l.length!==2||typeof l[1]!="string")return f.error("'var' expression requires exactly one string literal argument.");const p=l[1];return f.scope.has(p)?new ur(p,f.scope.get(p)):f.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class ic{constructor(l,f,p){this.type=l,this.index=f,this.input=p}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const p=f.parse(l[1],1,Lt),b=f.parse(l[2],2,oe(f.expectedType||zt));return p&&b?new ic(b.type.itemType,p,b):null}evaluate(l){const f=this.index.evaluate(l),p=this.input.evaluate(l);if(f<0)throw new Kr(`Array index out of bounds: ${f} < 0.`);if(f>=p.length)throw new Kr(`Array index out of bounds: ${f} > ${p.length-1}.`);if(f!==Math.floor(f))throw new Kr(`Array index must be an integer, but found ${f} instead.`);return p[f]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class oc{constructor(l,f){this.type=pt,this.needle=l,this.haystack=f}static parse(l,f){if(l.length!==3)return f.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const p=f.parse(l[1],1,zt),b=f.parse(l[2],2,zt);return p&&b?Ne(p.type,[pt,tt,Lt,Nr,zt])?new oc(p,b):f.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(p.type)} instead`):null}evaluate(l){const f=this.needle.evaluate(l),p=this.haystack.evaluate(l);if(!p)return!1;if(!Ve(f,["boolean","string","number","null"]))throw new Kr(`Expected first argument to be of type boolean, string, number or null, but found ${le(tr(f))} instead.`);if(!Ve(p,["string","array"]))throw new Kr(`Expected second argument to be of type array or string, but found ${le(tr(p))} instead.`);return p.indexOf(f)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class ra{constructor(l,f,p){this.type=Lt,this.needle=l,this.haystack=f,this.fromIndex=p}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const p=f.parse(l[1],1,zt),b=f.parse(l[2],2,zt);if(!p||!b)return null;if(!Ne(p.type,[pt,tt,Lt,Nr,zt]))return f.error(`Expected first argument to be of type boolean, string, number or null, but found ${le(p.type)} instead`);if(l.length===4){const A=f.parse(l[3],3,Lt);return A?new ra(p,b,A):null}return new ra(p,b)}evaluate(l){const f=this.needle.evaluate(l),p=this.haystack.evaluate(l);if(!Ve(f,["boolean","string","number","null"]))throw new Kr(`Expected first argument to be of type boolean, string, number or null, but found ${le(tr(f))} instead.`);let b;if(this.fromIndex&&(b=this.fromIndex.evaluate(l)),Ve(p,["string"])){const A=p.indexOf(f,b);return A===-1?-1:[...p.slice(0,A)].length}if(Ve(p,["array"]))return p.indexOf(f,b);throw new Kr(`Expected second argument to be of type array or string, but found ${le(tr(p))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class sc{constructor(l,f,p,b,A,k){this.inputType=l,this.type=f,this.input=p,this.cases=b,this.outputs=A,this.otherwise=k}static parse(l,f){if(l.length<5)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return f.error("Expected an even number of arguments.");let p,b;f.expectedType&&f.expectedType.kind!=="value"&&(b=f.expectedType);const A={},k=[];for(let V=2;V<l.length-1;V+=2){let K=l[V];const te=l[V+1];Array.isArray(K)||(K=[K]);const se=f.concat(V);if(K.length===0)return se.error("Expected at least one branch label.");for(const ye of K){if(typeof ye!="number"&&typeof ye!="string")return se.error("Branch labels must be numbers or strings.");if(typeof ye=="number"&&Math.abs(ye)>Number.MAX_SAFE_INTEGER)return se.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ye=="number"&&Math.floor(ye)!==ye)return se.error("Numeric branch labels must be integer values.");if(p){if(se.checkSubtype(p,tr(ye)))return null}else p=tr(ye);if(A[String(ye)]!==void 0)return se.error("Branch labels must be unique.");A[String(ye)]=k.length}const me=f.parse(te,V,b);if(!me)return null;b=b||me.type,k.push(me)}const M=f.parse(l[1],1,zt);if(!M)return null;const R=f.parse(l[l.length-1],l.length-1,b);return R?M.type.kind!=="value"&&f.concat(1).checkSubtype(p,M.type)?null:new sc(p,b,M,A,k,R):null}evaluate(l){const f=this.input.evaluate(l);return(tr(f)===this.inputType&&this.outputs[this.cases[f]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every(l=>l.outputDefined())&&this.otherwise.outputDefined()}}class zl{constructor(l,f,p){this.type=l,this.branches=f,this.otherwise=p}static parse(l,f){if(l.length<4)return f.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return f.error("Expected an odd number of arguments.");let p;f.expectedType&&f.expectedType.kind!=="value"&&(p=f.expectedType);const b=[];for(let k=1;k<l.length-1;k+=2){const M=f.parse(l[k],k,pt);if(!M)return null;const R=f.parse(l[k+1],k+1,p);if(!R)return null;b.push([M,R]),p=p||R.type}const A=f.parse(l[l.length-1],l.length-1,p);if(!A)return null;if(!p)throw new Error("Can't infer output type");return new zl(p,b,A)}evaluate(l){for(const[f,p]of this.branches)if(f.evaluate(l))return p.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[f,p]of this.branches)l(f),l(p);l(this.otherwise)}outputDefined(){return this.branches.every(([l,f])=>f.outputDefined())&&this.otherwise.outputDefined()}}class Za{constructor(l,f,p,b){this.type=l,this.input=f,this.beginIndex=p,this.endIndex=b}static parse(l,f){if(l.length<=2||l.length>=5)return f.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const p=f.parse(l[1],1,zt),b=f.parse(l[2],2,Lt);if(!p||!b)return null;if(!Ne(p.type,[oe(zt),tt,zt]))return f.error(`Expected first argument to be of type array or string, but found ${le(p.type)} instead`);if(l.length===4){const A=f.parse(l[3],3,Lt);return A?new Za(p.type,p,b,A):null}return new Za(p.type,p,b)}evaluate(l){const f=this.input.evaluate(l),p=this.beginIndex.evaluate(l);let b;if(this.endIndex&&(b=this.endIndex.evaluate(l)),Ve(f,["string"]))return[...f].slice(p,b).join("");if(Ve(f,["array"]))return f.slice(p,b);throw new Kr(`Expected first argument to be of type array or string, but found ${le(tr(f))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Dl(c,l){const f=c.length-1;let p,b,A=0,k=f,M=0;for(;A<=k;)if(M=Math.floor((A+k)/2),p=c[M],b=c[M+1],p<=l){if(M===f||l<b)return M;A=M+1}else{if(!(p>l))throw new Kr("Input is not a number.");k=M-1}return 0}class ia{constructor(l,f,p){this.type=l,this.input=f,this.labels=[],this.outputs=[];for(const[b,A]of p)this.labels.push(b),this.outputs.push(A)}static parse(l,f){if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return f.error("Expected an even number of arguments.");const p=f.parse(l[1],1,Lt);if(!p)return null;const b=[];let A=null;f.expectedType&&f.expectedType.kind!=="value"&&(A=f.expectedType);for(let k=1;k<l.length;k+=2){const M=k===1?-1/0:l[k],R=l[k+1],V=k,K=k+1;if(typeof M!="number")return f.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(b.length&&b[b.length-1][0]>=M)return f.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',V);const te=f.parse(R,K,A);if(!te)return null;A=A||te.type,b.push([M,te])}return new ia(A,p,b)}evaluate(l){const f=this.labels,p=this.outputs;if(f.length===1)return p[0].evaluate(l);const b=this.input.evaluate(l);if(b<=f[0])return p[0].evaluate(l);const A=f.length;return b>=f[A-1]?p[A-1].evaluate(l):p[Dl(f,b)].evaluate(l)}eachChild(l){l(this.input);for(const f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function ch(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var fp=fh;function fh(c,l,f,p){this.cx=3*c,this.bx=3*(f-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(p-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=l,this.p2x=f,this.p2y=p}fh.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,l){if(l===void 0&&(l=1e-6),c<0)return 0;if(c>1)return 1;for(var f=c,p=0;p<8;p++){var b=this.sampleCurveX(f)-c;if(Math.abs(b)<l)return f;var A=this.sampleCurveDerivativeX(f);if(Math.abs(A)<1e-6)break;f-=b/A}var k=0,M=1;for(f=c,p=0;p<20&&(b=this.sampleCurveX(f),!(Math.abs(b-c)<l));p++)c>b?k=f:M=f,f=.5*(M-k)+k;return f},solve:function(c,l){return this.sampleCurveY(this.solveCurveX(c,l))}};var hp=ch(fp);function Ps(c,l,f){return c+f*(l-c)}function Ha(c,l,f){return c.map((p,b)=>Ps(p,l[b],f))}const Oi={number:Ps,color:function(c,l,f,p="rgb"){switch(p){case"rgb":{const[b,A,k,M]=Ha(c.rgb,l.rgb,f);return new gn(b,A,k,M,!1)}case"hcl":{const[b,A,k,M]=c.hcl,[R,V,K,te]=l.hcl;let se,me;if(isNaN(b)||isNaN(R))isNaN(b)?isNaN(R)?se=NaN:(se=R,k!==1&&k!==0||(me=V)):(se=b,K!==1&&K!==0||(me=A));else{let Qe=R-b;R>b&&Qe>180?Qe-=360:R<b&&b-R>180&&(Qe+=360),se=b+f*Qe}const[ye,xe,Le,De]=function([Qe,je,Je,lt]){return Qe=isNaN(Qe)?0:Qe*mn,$r([Je,Math.cos(Qe)*je,Math.sin(Qe)*je,lt])}([se,me??Ps(A,V,f),Ps(k,K,f),Ps(M,te,f)]);return new gn(ye,xe,Le,De,!1)}case"lab":{const[b,A,k,M]=$r(Ha(c.lab,l.lab,f));return new gn(b,A,k,M,!1)}}},array:Ha,padding:function(c,l,f){return new Ur(Ha(c.values,l.values,f))},variableAnchorOffsetCollection:function(c,l,f){const p=c.values,b=l.values;if(p.length!==b.length)throw new Kr(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${l.toString()}`);const A=[];for(let k=0;k<p.length;k+=2){if(p[k]!==b[k])throw new Kr(`Cannot interpolate values containing mismatched anchors. from[${k}]: ${p[k]}, to[${k}]: ${b[k]}`);A.push(p[k]);const[M,R]=p[k+1],[V,K]=b[k+1];A.push([Ps(M,V,f),Ps(R,K,f)])}return new ci(A)}};class Ni{constructor(l,f,p,b,A){this.type=l,this.operator=f,this.interpolation=p,this.input=b,this.labels=[],this.outputs=[];for(const[k,M]of A)this.labels.push(k),this.outputs.push(M)}static interpolationFactor(l,f,p,b){let A=0;if(l.name==="exponential")A=Rl(f,l.base,p,b);else if(l.name==="linear")A=Rl(f,1,p,b);else if(l.name==="cubic-bezier"){const k=l.controlPoints;A=new hp(k[0],k[1],k[2],k[3]).solve(Rl(f,1,p,b))}return A}static parse(l,f){let[p,b,A,...k]=l;if(!Array.isArray(b)||b.length===0)return f.error("Expected an interpolation type expression.",1);if(b[0]==="linear")b={name:"linear"};else if(b[0]==="exponential"){const V=b[1];if(typeof V!="number")return f.error("Exponential interpolation requires a numeric base.",1,1);b={name:"exponential",base:V}}else{if(b[0]!=="cubic-bezier")return f.error(`Unknown interpolation type ${String(b[0])}`,1,0);{const V=b.slice(1);if(V.length!==4||V.some(K=>typeof K!="number"||K<0||K>1))return f.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);b={name:"cubic-bezier",controlPoints:V}}}if(l.length-1<4)return f.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return f.error("Expected an even number of arguments.");if(A=f.parse(A,2,Lt),!A)return null;const M=[];let R=null;p==="interpolate-hcl"||p==="interpolate-lab"?R=$t:f.expectedType&&f.expectedType.kind!=="value"&&(R=f.expectedType);for(let V=0;V<k.length;V+=2){const K=k[V],te=k[V+1],se=V+3,me=V+4;if(typeof K!="number")return f.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',se);if(M.length&&M[M.length-1][0]>=K)return f.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',se);const ye=f.parse(te,me,R);if(!ye)return null;R=R||ye.type,M.push([K,ye])}return Ke(R,Lt)||Ke(R,$t)||Ke(R,Gr)||Ke(R,Ce)||Ke(R,oe(Lt))?new Ni(R,p,b,A,M):f.error(`Type ${le(R)} is not interpolatable.`)}evaluate(l){const f=this.labels,p=this.outputs;if(f.length===1)return p[0].evaluate(l);const b=this.input.evaluate(l);if(b<=f[0])return p[0].evaluate(l);const A=f.length;if(b>=f[A-1])return p[A-1].evaluate(l);const k=Dl(f,b),M=Ni.interpolationFactor(this.interpolation,b,f[k],f[k+1]),R=p[k].evaluate(l),V=p[k+1].evaluate(l);switch(this.operator){case"interpolate":return Oi[this.type.kind](R,V,M);case"interpolate-hcl":return Oi.color(R,V,M,"hcl");case"interpolate-lab":return Oi.color(R,V,M,"lab")}}eachChild(l){l(this.input);for(const f of this.outputs)l(f)}outputDefined(){return this.outputs.every(l=>l.outputDefined())}}function Rl(c,l,f,p){const b=p-f,A=c-f;return b===0?0:l===1?A/b:(Math.pow(l,A)-1)/(Math.pow(l,b)-1)}class Bl{constructor(l,f){this.type=l,this.args=f}static parse(l,f){if(l.length<2)return f.error("Expectected at least one argument.");let p=null;const b=f.expectedType;b&&b.kind!=="value"&&(p=b);const A=[];for(const M of l.slice(1)){const R=f.parse(M,1+A.length,p,void 0,{typeAnnotation:"omit"});if(!R)return null;p=p||R.type,A.push(R)}if(!p)throw new Error("No output type");const k=b&&A.some(M=>Me(b,M.type));return new Bl(k?zt:p,A)}evaluate(l){let f,p=null,b=0;for(const A of this.args)if(b++,p=A.evaluate(l),p&&p instanceof Ii&&!p.available&&(f||(f=p.name),p=null,b===this.args.length&&(p=f)),p!==null)break;return p}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every(l=>l.outputDefined())}}function Fl(c,l){return c==="=="||c==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function hh(c,l,f,p){return p.compare(l,f)===0}function oa(c,l,f){const p=c!=="=="&&c!=="!=";return class yw{constructor(A,k,M){this.type=pt,this.lhs=A,this.rhs=k,this.collator=M,this.hasUntypedArgument=A.type.kind==="value"||k.type.kind==="value"}static parse(A,k){if(A.length!==3&&A.length!==4)return k.error("Expected two or three arguments.");const M=A[0];let R=k.parse(A[1],1,zt);if(!R)return null;if(!Fl(M,R.type))return k.concat(1).error(`"${M}" comparisons are not supported for type '${le(R.type)}'.`);let V=k.parse(A[2],2,zt);if(!V)return null;if(!Fl(M,V.type))return k.concat(2).error(`"${M}" comparisons are not supported for type '${le(V.type)}'.`);if(R.type.kind!==V.type.kind&&R.type.kind!=="value"&&V.type.kind!=="value")return k.error(`Cannot compare types '${le(R.type)}' and '${le(V.type)}'.`);p&&(R.type.kind==="value"&&V.type.kind!=="value"?R=new _o(V.type,[R]):R.type.kind!=="value"&&V.type.kind==="value"&&(V=new _o(R.type,[V])));let K=null;if(A.length===4){if(R.type.kind!=="string"&&V.type.kind!=="string"&&R.type.kind!=="value"&&V.type.kind!=="value")return k.error("Cannot use collator to compare non-string types.");if(K=k.parse(A[3],3,hr),!K)return null}return new yw(R,V,K)}evaluate(A){const k=this.lhs.evaluate(A),M=this.rhs.evaluate(A);if(p&&this.hasUntypedArgument){const R=tr(k),V=tr(M);if(R.kind!==V.kind||R.kind!=="string"&&R.kind!=="number")throw new Kr(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${R.kind}, ${V.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const R=tr(k),V=tr(M);if(R.kind!=="string"||V.kind!=="string")return l(A,k,M)}return this.collator?f(A,k,M,this.collator.evaluate(A)):l(A,k,M)}eachChild(A){A(this.lhs),A(this.rhs),this.collator&&A(this.collator)}outputDefined(){return!0}}}const dp=oa("==",function(c,l,f){return l===f},hh),dh=oa("!=",function(c,l,f){return l!==f},function(c,l,f,p){return!hh(0,l,f,p)}),ph=oa("<",function(c,l,f){return l<f},function(c,l,f,p){return p.compare(l,f)<0}),pp=oa(">",function(c,l,f){return l>f},function(c,l,f,p){return p.compare(l,f)>0}),mp=oa("<=",function(c,l,f){return l<=f},function(c,l,f,p){return p.compare(l,f)<=0}),mh=oa(">=",function(c,l,f){return l>=f},function(c,l,f,p){return p.compare(l,f)>=0});class Wa{constructor(l,f,p){this.type=hr,this.locale=p,this.caseSensitive=l,this.diacriticSensitive=f}static parse(l,f){if(l.length!==2)return f.error("Expected one argument.");const p=l[1];if(typeof p!="object"||Array.isArray(p))return f.error("Collator options argument must be an object.");const b=f.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,pt);if(!b)return null;const A=f.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,pt);if(!A)return null;let k=null;return p.locale&&(k=f.parse(p.locale,1,tt),!k)?null:new Wa(b,A,k)}evaluate(l){return new Qo(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class ac{constructor(l,f,p,b,A){this.type=tt,this.number=l,this.locale=f,this.currency=p,this.minFractionDigits=b,this.maxFractionDigits=A}static parse(l,f){if(l.length!==3)return f.error("Expected two arguments.");const p=f.parse(l[1],1,Lt);if(!p)return null;const b=l[2];if(typeof b!="object"||Array.isArray(b))return f.error("NumberFormat options argument must be an object.");let A=null;if(b.locale&&(A=f.parse(b.locale,1,tt),!A))return null;let k=null;if(b.currency&&(k=f.parse(b.currency,1,tt),!k))return null;let M=null;if(b["min-fraction-digits"]&&(M=f.parse(b["min-fraction-digits"],1,Lt),!M))return null;let R=null;return b["max-fraction-digits"]&&(R=f.parse(b["max-fraction-digits"],1,Lt),!R)?null:new ac(p,A,k,M,R)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class Ol{constructor(l){this.type=ir,this.sections=l}static parse(l,f){if(l.length<2)return f.error("Expected at least one argument.");const p=l[1];if(!Array.isArray(p)&&typeof p=="object")return f.error("First argument must be an image or text section.");const b=[];let A=!1;for(let k=1;k<=l.length-1;++k){const M=l[k];if(A&&typeof M=="object"&&!Array.isArray(M)){A=!1;let R=null;if(M["font-scale"]&&(R=f.parse(M["font-scale"],1,Lt),!R))return null;let V=null;if(M["text-font"]&&(V=f.parse(M["text-font"],1,oe(tt)),!V))return null;let K=null;if(M["text-color"]&&(K=f.parse(M["text-color"],1,$t),!K))return null;const te=b[b.length-1];te.scale=R,te.font=V,te.textColor=K}else{const R=f.parse(l[k],1,zt);if(!R)return null;const V=R.type.kind;if(V!=="string"&&V!=="value"&&V!=="null"&&V!=="resolvedImage")return f.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");A=!0,b.push({content:R,scale:null,font:null,textColor:null})}}return new Ol(b)}evaluate(l){return new pi(this.sections.map(f=>{const p=f.content.evaluate(l);return tr(p)===br?new bi("",p,null,null,null):new bi(Ga(p),null,f.scale?f.scale.evaluate(l):null,f.font?f.font.evaluate(l).join(","):null,f.textColor?f.textColor.evaluate(l):null)}))}eachChild(l){for(const f of this.sections)l(f.content),f.scale&&l(f.scale),f.font&&l(f.font),f.textColor&&l(f.textColor)}outputDefined(){return!1}}class lc{constructor(l){this.type=br,this.input=l}static parse(l,f){if(l.length!==2)return f.error("Expected two arguments.");const p=f.parse(l[1],1,tt);return p?new lc(p):f.error("No image name provided.")}evaluate(l){const f=this.input.evaluate(l),p=Ii.fromString(f);return p&&l.availableImages&&(p.available=l.availableImages.indexOf(f)>-1),p}eachChild(l){l(this.input)}outputDefined(){return!1}}class uc{constructor(l){this.type=Lt,this.input=l}static parse(l,f){if(l.length!==2)return f.error(`Expected 1 argument, but found ${l.length-1} instead.`);const p=f.parse(l[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?f.error(`Expected argument of type string or array, but found ${le(p.type)} instead.`):new uc(p):null}evaluate(l){const f=this.input.evaluate(l);if(typeof f=="string")return[...f].length;if(Array.isArray(f))return f.length;throw new Kr(`Expected value to be of type string or array, but found ${le(tr(f))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Fo=8192;function gp(c,l){const f=(180+c[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,b=Math.pow(2,l.z);return[Math.round(f*b*Fo),Math.round(p*b*Fo)]}function cc(c,l){const f=Math.pow(2,l.z);return[(b=(c[0]/Fo+l.x)/f,360*b-180),(p=(c[1]/Fo+l.y)/f,360/Math.PI*Math.atan(Math.exp((180-360*p)*Math.PI/180))-90)];var p,b}function zs(c,l){c[0]=Math.min(c[0],l[0]),c[1]=Math.min(c[1],l[1]),c[2]=Math.max(c[2],l[0]),c[3]=Math.max(c[3],l[1])}function gs(c,l){return!(c[0]<=l[0]||c[2]>=l[2]||c[1]<=l[1]||c[3]>=l[3])}function pr(c,l,f){const p=c[0]-l[0],b=c[1]-l[1],A=c[0]-f[0],k=c[1]-f[1];return p*k-A*b==0&&p*A<=0&&b*k<=0}function Nl(c,l,f,p){return(b=[p[0]-f[0],p[1]-f[1]])[0]*(A=[l[0]-c[0],l[1]-c[1]])[1]-b[1]*A[0]!=0&&!(!_h(c,l,f,p)||!_h(f,p,c,l));var b,A}function _p(c,l,f){for(const p of f)for(let b=0;b<p.length-1;++b)if(Nl(c,l,p[b],p[b+1]))return!0;return!1}function sa(c,l,f=!1){let p=!1;for(const M of l)for(let R=0;R<M.length-1;R++){if(pr(c,M[R],M[R+1]))return f;(A=M[R])[1]>(b=c)[1]!=(k=M[R+1])[1]>b[1]&&b[0]<(k[0]-A[0])*(b[1]-A[1])/(k[1]-A[1])+A[0]&&(p=!p)}var b,A,k;return p}function yp(c,l){for(const f of l)if(sa(c,f))return!0;return!1}function gh(c,l){for(const f of c)if(!sa(f,l))return!1;for(let f=0;f<c.length-1;++f)if(_p(c[f],c[f+1],l))return!1;return!0}function bp(c,l){for(const f of l)if(gh(c,f))return!0;return!1}function _h(c,l,f,p){const b=p[0]-f[0],A=p[1]-f[1],k=(c[0]-f[0])*A-b*(c[1]-f[1]),M=(l[0]-f[0])*A-b*(l[1]-f[1]);return k>0&&M<0||k<0&&M>0}function fc(c,l,f){const p=[];for(let b=0;b<c.length;b++){const A=[];for(let k=0;k<c[b].length;k++){const M=gp(c[b][k],f);zs(l,M),A.push(M)}p.push(A)}return p}function yh(c,l,f){const p=[];for(let b=0;b<c.length;b++){const A=fc(c[b],l,f);p.push(A)}return p}function bh(c,l,f,p){if(c[0]<f[0]||c[0]>f[2]){const b=.5*p;let A=c[0]-f[0]>b?-p:f[0]-c[0]>b?p:0;A===0&&(A=c[0]-f[2]>b?-p:f[2]-c[0]>b?p:0),c[0]+=A}zs(l,c)}function vh(c,l,f,p){const b=Math.pow(2,p.z)*Fo,A=[p.x*Fo,p.y*Fo],k=[];for(const M of c)for(const R of M){const V=[R.x+A[0],R.y+A[1]];bh(V,l,f,b),k.push(V)}return k}function wh(c,l,f,p){const b=Math.pow(2,p.z)*Fo,A=[p.x*Fo,p.y*Fo],k=[];for(const R of c){const V=[];for(const K of R){const te=[K.x+A[0],K.y+A[1]];zs(l,te),V.push(te)}k.push(V)}if(l[2]-l[0]<=b/2){(M=l)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const R of k)for(const V of R)bh(V,l,f,b)}var M;return k}class Ds{constructor(l,f){this.type=pt,this.geojson=l,this.geometries=f}static parse(l,f){if(l.length!==2)return f.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Hi(l[1])){const p=l[1];if(p.type==="FeatureCollection"){const b=[];for(const A of p.features){const{type:k,coordinates:M}=A.geometry;k==="Polygon"&&b.push(M),k==="MultiPolygon"&&b.push(...M)}if(b.length)return new Ds(p,{type:"MultiPolygon",coordinates:b})}else if(p.type==="Feature"){const b=p.geometry.type;if(b==="Polygon"||b==="MultiPolygon")return new Ds(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Ds(p,p)}return f.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(f,p){const b=[1/0,1/0,-1/0,-1/0],A=[1/0,1/0,-1/0,-1/0],k=f.canonicalID();if(p.type==="Polygon"){const M=fc(p.coordinates,A,k),R=vh(f.geometry(),b,A,k);if(!gs(b,A))return!1;for(const V of R)if(!sa(V,M))return!1}if(p.type==="MultiPolygon"){const M=yh(p.coordinates,A,k),R=vh(f.geometry(),b,A,k);if(!gs(b,A))return!1;for(const V of R)if(!yp(V,M))return!1}return!0}(l,this.geometries);if(l.geometryType()==="LineString")return function(f,p){const b=[1/0,1/0,-1/0,-1/0],A=[1/0,1/0,-1/0,-1/0],k=f.canonicalID();if(p.type==="Polygon"){const M=fc(p.coordinates,A,k),R=wh(f.geometry(),b,A,k);if(!gs(b,A))return!1;for(const V of R)if(!gh(V,M))return!1}if(p.type==="MultiPolygon"){const M=yh(p.coordinates,A,k),R=wh(f.geometry(),b,A,k);if(!gs(b,A))return!1;for(const V of R)if(!bp(V,M))return!1}return!0}(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let xh=class{constructor(c=[],l=(f,p)=>f<p?-1:f>p?1:0){if(this.data=c,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(c){this.data.push(c),this._up(this.length++)}pop(){if(this.length===0)return;const c=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:l,compare:f}=this,p=l[c];for(;c>0;){const b=c-1>>1,A=l[b];if(f(p,A)>=0)break;l[c]=A,c=b}l[c]=p}_down(c){const{data:l,compare:f}=this,p=this.length>>1,b=l[c];for(;c<p;){let A=1+(c<<1);const k=A+1;if(k<this.length&&f(l[k],l[A])<0&&(A=k),f(l[A],b)>=0)break;l[c]=l[A],c=A}l[c]=b}};function vp(c,l,f,p,b){Ah(c,l,f,p||c.length-1,b||wp)}function Ah(c,l,f,p,b){for(;p>f;){if(p-f>600){var A=p-f+1,k=l-f+1,M=Math.log(A),R=.5*Math.exp(2*M/3),V=.5*Math.sqrt(M*R*(A-R)/A)*(k-A/2<0?-1:1);Ah(c,l,Math.max(f,Math.floor(l-k*R/A+V)),Math.min(p,Math.floor(l+(A-k)*R/A+V)),b)}var K=c[l],te=f,se=p;for(Xa(c,f,l),b(c[p],K)>0&&Xa(c,f,p);te<se;){for(Xa(c,te,se),te++,se--;b(c[te],K)<0;)te++;for(;b(c[se],K)>0;)se--}b(c[f],K)===0?Xa(c,f,se):Xa(c,++se,p),se<=l&&(f=se+1),l<=se&&(p=se-1)}}function Xa(c,l,f){var p=c[l];c[l]=c[f],c[f]=p}function wp(c,l){return c<l?-1:c>l?1:0}function $l(c,l){if(c.length<=1)return[c];const f=[];let p,b;for(const A of c){const k=Ap(A);k!==0&&(A.area=Math.abs(k),b===void 0&&(b=k<0),b===k<0?(p&&f.push(p),p=[A]):p.push(A))}if(p&&f.push(p),l>1)for(let A=0;A<f.length;A++)f[A].length<=l||(vp(f[A],l,1,f[A].length-1,xp),f[A]=f[A].slice(0,l));return f}function xp(c,l){return l.area-c.area}function Ap(c){let l=0;for(let f,p,b=0,A=c.length,k=A-1;b<A;k=b++)f=c[b],p=c[k],l+=(p.x-f.x)*(f.y+p.y);return l}const kh=1/298.257223563,Sh=kh*(2-kh),Th=Math.PI/180;class hc{constructor(l){const f=6378.137*Th*1e3,p=Math.cos(l*Th),b=1/(1-Sh*(1-p*p)),A=Math.sqrt(b);this.kx=f*A*p,this.ky=f*A*b*(1-Sh)}distance(l,f){const p=this.wrap(l[0]-f[0])*this.kx,b=(l[1]-f[1])*this.ky;return Math.sqrt(p*p+b*b)}pointOnLine(l,f){let p,b,A,k,M=1/0;for(let R=0;R<l.length-1;R++){let V=l[R][0],K=l[R][1],te=this.wrap(l[R+1][0]-V)*this.kx,se=(l[R+1][1]-K)*this.ky,me=0;te===0&&se===0||(me=(this.wrap(f[0]-V)*this.kx*te+(f[1]-K)*this.ky*se)/(te*te+se*se),me>1?(V=l[R+1][0],K=l[R+1][1]):me>0&&(V+=te/this.kx*me,K+=se/this.ky*me)),te=this.wrap(f[0]-V)*this.kx,se=(f[1]-K)*this.ky;const ye=te*te+se*se;ye<M&&(M=ye,p=V,b=K,A=R,k=me)}return{point:[p,b],index:A,t:Math.max(0,Math.min(1,k))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function Ch(c,l){return l[0]-c[0]}function jl(c){return c[1]-c[0]+1}function es(c,l){return c[1]>=c[0]&&c[1]<l}function dc(c,l){if(c[0]>c[1])return[null,null];const f=jl(c);if(l){if(f===2)return[c,null];const b=Math.floor(f/2);return[[c[0],c[0]+b],[c[0]+b,c[1]]]}if(f===1)return[c,null];const p=Math.floor(f/2)-1;return[[c[0],c[0]+p],[c[0]+p+1,c[1]]]}function pc(c,l){if(!es(l,c.length))return[1/0,1/0,-1/0,-1/0];const f=[1/0,1/0,-1/0,-1/0];for(let p=l[0];p<=l[1];++p)zs(f,c[p]);return f}function mc(c){const l=[1/0,1/0,-1/0,-1/0];for(const f of c)for(const p of f)zs(l,p);return l}function Ul(c){return c[0]!==-1/0&&c[1]!==-1/0&&c[2]!==1/0&&c[3]!==1/0}function gc(c,l,f){if(!Ul(c)||!Ul(l))return NaN;let p=0,b=0;return c[2]<l[0]&&(p=l[0]-c[2]),c[0]>l[2]&&(p=c[0]-l[2]),c[1]>l[3]&&(b=c[1]-l[3]),c[3]<l[1]&&(b=l[1]-c[3]),f.distance([0,0],[p,b])}function Rs(c,l,f){const p=f.pointOnLine(l,c);return f.distance(c,p.point)}function _c(c,l,f,p,b){const A=Math.min(Rs(c,[f,p],b),Rs(l,[f,p],b)),k=Math.min(Rs(f,[c,l],b),Rs(p,[c,l],b));return Math.min(A,k)}function kp(c,l,f,p,b){if(!es(l,c.length)||!es(p,f.length))return 1/0;let A=1/0;for(let k=l[0];k<l[1];++k){const M=c[k],R=c[k+1];for(let V=p[0];V<p[1];++V){const K=f[V],te=f[V+1];if(Nl(M,R,K,te))return 0;A=Math.min(A,_c(M,R,K,te,b))}}return A}function Hr(c,l,f,p,b){if(!es(l,c.length)||!es(p,f.length))return NaN;let A=1/0;for(let k=l[0];k<=l[1];++k)for(let M=p[0];M<=p[1];++M)if(A=Math.min(A,b.distance(c[k],f[M])),A===0)return A;return A}function Sp(c,l,f){if(sa(c,l,!0))return 0;let p=1/0;for(const b of l){const A=b[0],k=b[b.length-1];if(A!==k&&(p=Math.min(p,Rs(c,[k,A],f)),p===0))return p;const M=f.pointOnLine(b,c);if(p=Math.min(p,f.distance(c,M.point)),p===0)return p}return p}function Vn(c,l,f,p){if(!es(l,c.length))return NaN;for(let A=l[0];A<=l[1];++A)if(sa(c[A],f,!0))return 0;let b=1/0;for(let A=l[0];A<l[1];++A){const k=c[A],M=c[A+1];for(const R of f)for(let V=0,K=R.length,te=K-1;V<K;te=V++){const se=R[te],me=R[V];if(Nl(k,M,se,me))return 0;b=Math.min(b,_c(k,M,se,me,p))}}return b}function Vl(c,l){for(const f of c)for(const p of f)if(sa(p,l,!0))return!0;return!1}function Ir(c,l,f,p=1/0){const b=mc(c),A=mc(l);if(p!==1/0&&gc(b,A,f)>=p)return p;if(gs(b,A)){if(Vl(c,l))return 0}else if(Vl(l,c))return 0;let k=1/0;for(const M of c)for(let R=0,V=M.length,K=V-1;R<V;K=R++){const te=M[K],se=M[R];for(const me of l)for(let ye=0,xe=me.length,Le=xe-1;ye<xe;Le=ye++){const De=me[Le],Qe=me[ye];if(Nl(te,se,De,Qe))return 0;k=Math.min(k,_c(te,se,De,Qe,f))}}return k}function vr(c,l,f,p,b,A){if(!A)return;const k=gc(pc(p,A),b,f);k<l&&c.push([k,A,[0,0]])}function Bs(c,l,f,p,b,A,k){if(!A||!k)return;const M=gc(pc(p,A),pc(b,k),f);M<l&&c.push([M,A,k])}function Ja(c,l,f,p,b=1/0){let A=Math.min(p.distance(c[0],f[0][0]),b);if(A===0)return A;const k=new xh([[0,[0,c.length-1],[0,0]]],Ch),M=mc(f);for(;k.length>0;){const R=k.pop();if(R[0]>=A)continue;const V=R[1],K=l?50:100;if(jl(V)<=K){if(!es(V,c.length))return NaN;if(l){const te=Vn(c,V,f,p);if(isNaN(te)||te===0)return te;A=Math.min(A,te)}else for(let te=V[0];te<=V[1];++te){const se=Sp(c[te],f,p);if(A=Math.min(A,se),A===0)return 0}}else{const te=dc(V,l);vr(k,A,p,c,M,te[0]),vr(k,A,p,c,M,te[1])}}return A}function Ka(c,l,f,p,b,A=1/0){let k=Math.min(A,b.distance(c[0],f[0]));if(k===0)return k;const M=new xh([[0,[0,c.length-1],[0,f.length-1]]],Ch);for(;M.length>0;){const R=M.pop();if(R[0]>=k)continue;const V=R[1],K=R[2],te=l?50:100,se=p?50:100;if(jl(V)<=te&&jl(K)<=se){if(!es(V,c.length)&&es(K,f.length))return NaN;let me;if(l&&p)me=kp(c,V,f,K,b),k=Math.min(k,me);else if(l&&!p){const ye=c.slice(V[0],V[1]+1);for(let xe=K[0];xe<=K[1];++xe)if(me=Rs(f[xe],ye,b),k=Math.min(k,me),k===0)return k}else if(!l&&p){const ye=f.slice(K[0],K[1]+1);for(let xe=V[0];xe<=V[1];++xe)if(me=Rs(c[xe],ye,b),k=Math.min(k,me),k===0)return k}else me=Hr(c,V,f,K,b),k=Math.min(k,me)}else{const me=dc(V,l),ye=dc(K,p);Bs(M,k,b,c,f,me[0],ye[0]),Bs(M,k,b,c,f,me[0],ye[1]),Bs(M,k,b,c,f,me[1],ye[0]),Bs(M,k,b,c,f,me[1],ye[1])}}return k}function yc(c){return c.type==="MultiPolygon"?c.coordinates.map(l=>({type:"Polygon",coordinates:l})):c.type==="MultiLineString"?c.coordinates.map(l=>({type:"LineString",coordinates:l})):c.type==="MultiPoint"?c.coordinates.map(l=>({type:"Point",coordinates:l})):[c]}class Fs{constructor(l,f){this.type=Lt,this.geojson=l,this.geometries=f}static parse(l,f){if(l.length!==2)return f.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Hi(l[1])){const p=l[1];if(p.type==="FeatureCollection")return new Fs(p,p.features.map(b=>yc(b.geometry)).flat());if(p.type==="Feature")return new Fs(p,yc(p.geometry));if("type"in p&&"coordinates"in p)return new Fs(p,yc(p))}return f.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return function(f,p){const b=f.geometry(),A=b.flat().map(R=>cc([R.x,R.y],f.canonical));if(b.length===0)return NaN;const k=new hc(A[0][1]);let M=1/0;for(const R of p){switch(R.type){case"Point":M=Math.min(M,Ka(A,!1,[R.coordinates],!1,k,M));break;case"LineString":M=Math.min(M,Ka(A,!1,R.coordinates,!0,k,M));break;case"Polygon":M=Math.min(M,Ja(A,!1,R.coordinates,k,M))}if(M===0)return M}return M}(l,this.geometries);if(l.geometryType()==="LineString")return function(f,p){const b=f.geometry(),A=b.flat().map(R=>cc([R.x,R.y],f.canonical));if(b.length===0)return NaN;const k=new hc(A[0][1]);let M=1/0;for(const R of p){switch(R.type){case"Point":M=Math.min(M,Ka(A,!0,[R.coordinates],!1,k,M));break;case"LineString":M=Math.min(M,Ka(A,!0,R.coordinates,!0,k,M));break;case"Polygon":M=Math.min(M,Ja(A,!0,R.coordinates,k,M))}if(M===0)return M}return M}(l,this.geometries);if(l.geometryType()==="Polygon")return function(f,p){const b=f.geometry();if(b.length===0||b[0].length===0)return NaN;const A=$l(b,0).map(R=>R.map(V=>V.map(K=>cc([K.x,K.y],f.canonical)))),k=new hc(A[0][0][0][1]);let M=1/0;for(const R of p)for(const V of A){switch(R.type){case"Point":M=Math.min(M,Ja([R.coordinates],!1,V,k,M));break;case"LineString":M=Math.min(M,Ja(R.coordinates,!0,V,k,M));break;case"Polygon":M=Math.min(M,Ir(V,R.coordinates,k,M))}if(M===0)return M}return M}(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const aa={"==":dp,"!=":dh,">":pp,"<":ph,">=":mh,"<=":mp,array:_o,at:ic,boolean:_o,case:zl,coalesce:Bl,collator:Wa,format:Ol,image:lc,in:oc,"index-of":ra,interpolate:Ni,"interpolate-hcl":Ni,"interpolate-lab":Ni,length:uc,let:ms,literal:go,match:sc,number:_o,"number-format":ac,object:_o,slice:Za,step:ia,string:_o,"to-boolean":yo,"to-color":yo,"to-number":yo,"to-string":yo,var:ur,within:Ds,distance:Fs};class eo{constructor(l,f,p,b){this.name=l,this.type=f,this._evaluate=p,this.args=b}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,f){const p=l[0],b=eo.definitions[p];if(!b)return f.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const A=Array.isArray(b)?b[0]:b.type,k=Array.isArray(b)?[[b[1],b[2]]]:b.overloads,M=k.filter(([V])=>!Array.isArray(V)||V.length===l.length-1);let R=null;for(const[V,K]of M){R=new Ls(f.registry,Ya,f.path,null,f.scope);const te=[];let se=!1;for(let me=1;me<l.length;me++){const ye=l[me],xe=Array.isArray(V)?V[me-1]:V.type,Le=R.parse(ye,1+te.length,xe);if(!Le){se=!0;break}te.push(Le)}if(!se)if(Array.isArray(V)&&V.length!==te.length)R.error(`Expected ${V.length} arguments, but found ${te.length} instead.`);else{for(let me=0;me<te.length;me++){const ye=Array.isArray(V)?V[me]:V.type,xe=te[me];R.concat(me+1).checkSubtype(ye,xe.type)}if(R.errors.length===0)return new eo(p,A,K,te)}}if(M.length===1)f.errors.push(...R.errors);else{const V=(M.length?M:k).map(([te])=>{return se=te,Array.isArray(se)?`(${se.map(le).join(", ")})`:`(${le(se.type)}...)`;var se}).join(" | "),K=[];for(let te=1;te<l.length;te++){const se=f.parse(l[te],1+K.length);if(!se)return null;K.push(le(se.type))}f.error(`Expected arguments of type ${V}, but found (${K.join(", ")}) instead.`)}return null}static register(l,f){eo.definitions=f;for(const p in f)l[p]=eo}}function bc(c,[l,f,p,b]){l=l.evaluate(c),f=f.evaluate(c),p=p.evaluate(c);const A=b?b.evaluate(c):1,k=mo(l,f,p,A);if(k)throw new Kr(k);return new gn(l/255,f/255,p/255,A,!1)}function vc(c,l){return c in l}function wc(c,l){const f=l[c];return f===void 0?null:f}function Os(c){return{type:c}}function Ya(c){if(c instanceof ur)return Ya(c.boundExpression);if(c instanceof eo&&c.name==="error"||c instanceof Wa||c instanceof Ds||c instanceof Fs)return!1;const l=c instanceof yo||c instanceof _o;let f=!0;return c.eachChild(p=>{f=l?f&&Ya(p):f&&p instanceof go}),!!f&&Qa(c)&&el(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Qa(c){if(c instanceof eo&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Ds||c instanceof Fs)return!1;let l=!0;return c.eachChild(f=>{l&&!Qa(f)&&(l=!1)}),l}function la(c){if(c instanceof eo&&c.name==="feature-state")return!1;let l=!0;return c.eachChild(f=>{l&&!la(f)&&(l=!1)}),l}function el(c,l){if(c instanceof eo&&l.indexOf(c.name)>=0)return!1;let f=!0;return c.eachChild(p=>{f&&!el(p,l)&&(f=!1)}),f}function ql(c){return{result:"success",value:c}}function ua(c){return{result:"error",value:c}}function ca(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Mh(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function xc(c){return!!c.expression&&c.expression.interpolated}function sr(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Gl(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Tp(c){return c}function Eh(c,l){const f=l.type==="color",p=c.stops&&typeof c.stops[0][0]=="object",b=p||!(p||c.property!==void 0),A=c.type||(xc(l)?"exponential":"interval");if(f||l.type==="padding"){const K=f?gn.parse:Ur.parse;(c=Cn({},c)).stops&&(c.stops=c.stops.map(te=>[te[0],K(te[1])])),c.default=K(c.default?c.default:l.default)}if(c.colorSpace&&(k=c.colorSpace)!=="rgb"&&k!=="hcl"&&k!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var k;let M,R,V;if(A==="exponential")M=Lh;else if(A==="interval")M=Zl;else if(A==="categorical"){M=Ih,R=Object.create(null);for(const K of c.stops)R[K[0]]=K[1];V=typeof c.stops[0][0]}else{if(A!=="identity")throw new Error(`Unknown function type "${A}"`);M=Ph}if(p){const K={},te=[];for(let ye=0;ye<c.stops.length;ye++){const xe=c.stops[ye],Le=xe[0].zoom;K[Le]===void 0&&(K[Le]={zoom:Le,type:c.type,property:c.property,default:c.default,stops:[]},te.push(Le)),K[Le].stops.push([xe[0].value,xe[1]])}const se=[];for(const ye of te)se.push([K[ye].zoom,Eh(K[ye],l)]);const me={name:"linear"};return{kind:"composite",interpolationType:me,interpolationFactor:Ni.interpolationFactor.bind(void 0,me),zoomStops:se.map(ye=>ye[0]),evaluate:({zoom:ye},xe)=>Lh({stops:se,base:c.base},l,ye).evaluate(ye,xe)}}if(b){const K=A==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:K,interpolationFactor:Ni.interpolationFactor.bind(void 0,K),zoomStops:c.stops.map(te=>te[0]),evaluate:({zoom:te})=>M(c,l,te,R,V)}}return{kind:"source",evaluate(K,te){const se=te&&te.properties?te.properties[c.property]:void 0;return se===void 0?fa(c.default,l.default):M(c,l,se,R,V)}}}function fa(c,l,f){return c!==void 0?c:l!==void 0?l:f!==void 0?f:void 0}function Ih(c,l,f,p,b){return fa(typeof f===b?p[f]:void 0,c.default,l.default)}function Zl(c,l,f){if(sr(f)!=="number")return fa(c.default,l.default);const p=c.stops.length;if(p===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[p-1][0])return c.stops[p-1][1];const b=Dl(c.stops.map(A=>A[0]),f);return c.stops[b][1]}function Lh(c,l,f){const p=c.base!==void 0?c.base:1;if(sr(f)!=="number")return fa(c.default,l.default);const b=c.stops.length;if(b===1||f<=c.stops[0][0])return c.stops[0][1];if(f>=c.stops[b-1][0])return c.stops[b-1][1];const A=Dl(c.stops.map(K=>K[0]),f),k=function(K,te,se,me){const ye=me-se,xe=K-se;return ye===0?0:te===1?xe/ye:(Math.pow(te,xe)-1)/(Math.pow(te,ye)-1)}(f,p,c.stops[A][0],c.stops[A+1][0]),M=c.stops[A][1],R=c.stops[A+1][1],V=Oi[l.type]||Tp;return typeof M.evaluate=="function"?{evaluate(...K){const te=M.evaluate.apply(void 0,K),se=R.evaluate.apply(void 0,K);if(te!==void 0&&se!==void 0)return V(te,se,k,c.colorSpace)}}:V(M,R,k,c.colorSpace)}function Ph(c,l,f){switch(l.type){case"color":f=gn.parse(f);break;case"formatted":f=pi.fromString(f.toString());break;case"resolvedImage":f=Ii.fromString(f.toString());break;case"padding":f=Ur.parse(f);break;default:sr(f)===l.type||l.type==="enum"&&l.values[f]||(f=void 0)}return fa(f,c.default,l.default)}eo.register(aa,{error:[{kind:"error"},[tt],(c,[l])=>{throw new Kr(l.evaluate(c))}],typeof:[tt,[zt],(c,[l])=>le(tr(l.evaluate(c)))],"to-rgba":[oe(Lt,4),[$t],(c,[l])=>{const[f,p,b,A]=l.evaluate(c).rgb;return[255*f,255*p,255*b,A]}],rgb:[$t,[Lt,Lt,Lt],bc],rgba:[$t,[Lt,Lt,Lt,Lt],bc],has:{type:pt,overloads:[[[tt],(c,[l])=>vc(l.evaluate(c),c.properties())],[[tt,Bn],(c,[l,f])=>vc(l.evaluate(c),f.evaluate(c))]]},get:{type:zt,overloads:[[[tt],(c,[l])=>wc(l.evaluate(c),c.properties())],[[tt,Bn],(c,[l,f])=>wc(l.evaluate(c),f.evaluate(c))]]},"feature-state":[zt,[tt],(c,[l])=>wc(l.evaluate(c),c.featureState||{})],properties:[Bn,[],c=>c.properties()],"geometry-type":[tt,[],c=>c.geometryType()],id:[zt,[],c=>c.id()],zoom:[Lt,[],c=>c.globals.zoom],"heatmap-density":[Lt,[],c=>c.globals.heatmapDensity||0],"line-progress":[Lt,[],c=>c.globals.lineProgress||0],accumulated:[zt,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[Lt,Os(Lt),(c,l)=>{let f=0;for(const p of l)f+=p.evaluate(c);return f}],"*":[Lt,Os(Lt),(c,l)=>{let f=1;for(const p of l)f*=p.evaluate(c);return f}],"-":{type:Lt,overloads:[[[Lt,Lt],(c,[l,f])=>l.evaluate(c)-f.evaluate(c)],[[Lt],(c,[l])=>-l.evaluate(c)]]},"/":[Lt,[Lt,Lt],(c,[l,f])=>l.evaluate(c)/f.evaluate(c)],"%":[Lt,[Lt,Lt],(c,[l,f])=>l.evaluate(c)%f.evaluate(c)],ln2:[Lt,[],()=>Math.LN2],pi:[Lt,[],()=>Math.PI],e:[Lt,[],()=>Math.E],"^":[Lt,[Lt,Lt],(c,[l,f])=>Math.pow(l.evaluate(c),f.evaluate(c))],sqrt:[Lt,[Lt],(c,[l])=>Math.sqrt(l.evaluate(c))],log10:[Lt,[Lt],(c,[l])=>Math.log(l.evaluate(c))/Math.LN10],ln:[Lt,[Lt],(c,[l])=>Math.log(l.evaluate(c))],log2:[Lt,[Lt],(c,[l])=>Math.log(l.evaluate(c))/Math.LN2],sin:[Lt,[Lt],(c,[l])=>Math.sin(l.evaluate(c))],cos:[Lt,[Lt],(c,[l])=>Math.cos(l.evaluate(c))],tan:[Lt,[Lt],(c,[l])=>Math.tan(l.evaluate(c))],asin:[Lt,[Lt],(c,[l])=>Math.asin(l.evaluate(c))],acos:[Lt,[Lt],(c,[l])=>Math.acos(l.evaluate(c))],atan:[Lt,[Lt],(c,[l])=>Math.atan(l.evaluate(c))],min:[Lt,Os(Lt),(c,l)=>Math.min(...l.map(f=>f.evaluate(c)))],max:[Lt,Os(Lt),(c,l)=>Math.max(...l.map(f=>f.evaluate(c)))],abs:[Lt,[Lt],(c,[l])=>Math.abs(l.evaluate(c))],round:[Lt,[Lt],(c,[l])=>{const f=l.evaluate(c);return f<0?-Math.round(-f):Math.round(f)}],floor:[Lt,[Lt],(c,[l])=>Math.floor(l.evaluate(c))],ceil:[Lt,[Lt],(c,[l])=>Math.ceil(l.evaluate(c))],"filter-==":[pt,[tt,zt],(c,[l,f])=>c.properties()[l.value]===f.value],"filter-id-==":[pt,[zt],(c,[l])=>c.id()===l.value],"filter-type-==":[pt,[tt],(c,[l])=>c.geometryType()===l.value],"filter-<":[pt,[tt,zt],(c,[l,f])=>{const p=c.properties()[l.value],b=f.value;return typeof p==typeof b&&p<b}],"filter-id-<":[pt,[zt],(c,[l])=>{const f=c.id(),p=l.value;return typeof f==typeof p&&f<p}],"filter->":[pt,[tt,zt],(c,[l,f])=>{const p=c.properties()[l.value],b=f.value;return typeof p==typeof b&&p>b}],"filter-id->":[pt,[zt],(c,[l])=>{const f=c.id(),p=l.value;return typeof f==typeof p&&f>p}],"filter-<=":[pt,[tt,zt],(c,[l,f])=>{const p=c.properties()[l.value],b=f.value;return typeof p==typeof b&&p<=b}],"filter-id-<=":[pt,[zt],(c,[l])=>{const f=c.id(),p=l.value;return typeof f==typeof p&&f<=p}],"filter->=":[pt,[tt,zt],(c,[l,f])=>{const p=c.properties()[l.value],b=f.value;return typeof p==typeof b&&p>=b}],"filter-id->=":[pt,[zt],(c,[l])=>{const f=c.id(),p=l.value;return typeof f==typeof p&&f>=p}],"filter-has":[pt,[zt],(c,[l])=>l.value in c.properties()],"filter-has-id":[pt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[pt,[oe(tt)],(c,[l])=>l.value.indexOf(c.geometryType())>=0],"filter-id-in":[pt,[oe(zt)],(c,[l])=>l.value.indexOf(c.id())>=0],"filter-in-small":[pt,[tt,oe(zt)],(c,[l,f])=>f.value.indexOf(c.properties()[l.value])>=0],"filter-in-large":[pt,[tt,oe(zt)],(c,[l,f])=>function(p,b,A,k){for(;A<=k;){const M=A+k>>1;if(b[M]===p)return!0;b[M]>p?k=M-1:A=M+1}return!1}(c.properties()[l.value],f.value,0,f.value.length-1)],all:{type:pt,overloads:[[[pt,pt],(c,[l,f])=>l.evaluate(c)&&f.evaluate(c)],[Os(pt),(c,l)=>{for(const f of l)if(!f.evaluate(c))return!1;return!0}]]},any:{type:pt,overloads:[[[pt,pt],(c,[l,f])=>l.evaluate(c)||f.evaluate(c)],[Os(pt),(c,l)=>{for(const f of l)if(f.evaluate(c))return!0;return!1}]]},"!":[pt,[pt],(c,[l])=>!l.evaluate(c)],"is-supported-script":[pt,[tt],(c,[l])=>{const f=c.globals&&c.globals.isSupportedScript;return!f||f(l.evaluate(c))}],upcase:[tt,[tt],(c,[l])=>l.evaluate(c).toUpperCase()],downcase:[tt,[tt],(c,[l])=>l.evaluate(c).toLowerCase()],concat:[tt,Os(zt),(c,l)=>l.map(f=>Ga(f.evaluate(c))).join("")],"resolved-locale":[tt,[hr],(c,[l])=>l.evaluate(c).resolvedLocale()]});class Hl{constructor(l,f){var p;this.expression=l,this._warningHistory={},this._evaluator=new Pl,this._defaultValue=f?(p=f).type==="color"&&Gl(p.default)?new gn(0,0,0,0):p.type==="color"?gn.parse(p.default)||null:p.type==="padding"?Ur.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?ci.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=f&&f.type==="enum"?f.values:null}evaluateWithoutErrorHandling(l,f,p,b,A,k){return this._evaluator.globals=l,this._evaluator.feature=f,this._evaluator.featureState=p,this._evaluator.canonical=b,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=k,this.expression.evaluate(this._evaluator)}evaluate(l,f,p,b,A,k){this._evaluator.globals=l,this._evaluator.feature=f||null,this._evaluator.featureState=p||null,this._evaluator.canonical=b,this._evaluator.availableImages=A||null,this._evaluator.formattedSection=k||null;try{const M=this.expression.evaluate(this._evaluator);if(M==null||typeof M=="number"&&M!=M)return this._defaultValue;if(this._enumValues&&!(M in this._enumValues))throw new Kr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(M)} instead.`);return M}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console<"u"&&console.warn(M.message)),this._defaultValue}}}function Wl(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in aa}function ha(c,l){const f=new Ls(aa,Ya,[],l?function(b){const A={color:$t,string:tt,number:Lt,enum:tt,boolean:pt,formatted:ir,padding:Gr,resolvedImage:br,variableAnchorOffsetCollection:Ce};return b.type==="array"?oe(A[b.value]||zt,b.length):A[b.type]}(l):void 0),p=f.parse(c,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?ql(new Hl(p,l)):ua(f.errors)}class da{constructor(l,f){this.kind=l,this._styleExpression=f,this.isStateDependent=l!=="constant"&&!la(f.expression)}evaluateWithoutErrorHandling(l,f,p,b,A,k){return this._styleExpression.evaluateWithoutErrorHandling(l,f,p,b,A,k)}evaluate(l,f,p,b,A,k){return this._styleExpression.evaluate(l,f,p,b,A,k)}}class pa{constructor(l,f,p,b){this.kind=l,this.zoomStops=p,this._styleExpression=f,this.isStateDependent=l!=="camera"&&!la(f.expression),this.interpolationType=b}evaluateWithoutErrorHandling(l,f,p,b,A,k){return this._styleExpression.evaluateWithoutErrorHandling(l,f,p,b,A,k)}evaluate(l,f,p,b,A,k){return this._styleExpression.evaluate(l,f,p,b,A,k)}interpolationFactor(l,f,p){return this.interpolationType?Ni.interpolationFactor(this.interpolationType,l,f,p):0}}function Ac(c,l){const f=ha(c,l);if(f.result==="error")return f;const p=f.value.expression,b=Qa(p);if(!b&&!ca(l))return ua([new Zn("","data expressions not supported")]);const A=el(p,["zoom"]);if(!A&&!Mh(l))return ua([new Zn("","zoom expressions not supported")]);const k=tl(p);return k||A?k instanceof Zn?ua([k]):k instanceof Ni&&!xc(l)?ua([new Zn("",'"interpolate" expressions cannot be used with this property')]):ql(k?new pa(b?"camera":"composite",f.value,k.labels,k instanceof Ni?k.interpolation:void 0):new da(b?"constant":"source",f.value)):ua([new Zn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ma{constructor(l,f){this._parameters=l,this._specification=f,Cn(this,Eh(this._parameters,this._specification))}static deserialize(l){return new ma(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function tl(c){let l=null;if(c instanceof ms)l=tl(c.result);else if(c instanceof Bl){for(const f of c.args)if(l=tl(f),l)break}else(c instanceof ia||c instanceof Ni)&&c.input instanceof eo&&c.input.name==="zoom"&&(l=c);return l instanceof Zn||c.eachChild(f=>{const p=tl(f);p instanceof Zn?l=p:!l&&p?l=new Zn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&p&&l!==p&&(l=new Zn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),l}function Xl(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const l of c.slice(1))if(!Xl(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const Jl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function kc(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Xl(c)||(c=Kl(c));const l=ha(c,Jl);if(l.result==="error")throw new Error(l.value.map(f=>`${f.key}: ${f.message}`).join(", "));return{filter:(f,p,b)=>l.value.evaluate(f,p,{},b),needGeometry:zh(c)}}function Cp(c,l){return c<l?-1:c>l?1:0}function zh(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let l=1;l<c.length;l++)if(zh(c[l]))return!0;return!1}function Kl(c){if(!c)return!0;const l=c[0];return c.length<=1?l!=="any":l==="=="?Sc(c[1],c[2],"=="):l==="!="?vi(Sc(c[1],c[2],"==")):l==="<"||l===">"||l==="<="||l===">="?Sc(c[1],c[2],l):l==="any"?(f=c.slice(1),["any"].concat(f.map(Kl))):l==="all"?["all"].concat(c.slice(1).map(Kl)):l==="none"?["all"].concat(c.slice(1).map(Kl).map(vi)):l==="in"?nl(c[1],c.slice(2)):l==="!in"?vi(nl(c[1],c.slice(2))):l==="has"?rl(c[1]):l!=="!has"||vi(rl(c[1]));var f}function Sc(c,l,f){switch(c){case"$type":return[`filter-type-${f}`,l];case"$id":return[`filter-id-${f}`,l];default:return[`filter-${f}`,c,l]}}function nl(c,l){if(l.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some(f=>typeof f!=typeof l[0])?["filter-in-large",c,["literal",l.sort(Cp)]]:["filter-in-small",c,["literal",l]]}}function rl(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function vi(c){return["!",c]}function Ns(c){const l=typeof c;if(l==="number"||l==="boolean"||l==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let b="[";for(const A of c)b+=`${Ns(A)},`;return`${b}]`}const f=Object.keys(c).sort();let p="{";for(let b=0;b<f.length;b++)p+=`${JSON.stringify(f[b])}:${Ns(c[f[b]])},`;return`${p}}`}function Dh(c){let l="";for(const f of et)l+=`/${Ns(c[f])}`;return l}function Rh(c){const l=c.value;return l?[new vt(c.key,l,"constants have been deprecated as of v8")]:[]}function Wr(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function bo(c){if(Array.isArray(c))return c.map(bo);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const l={};for(const f in c)l[f]=bo(c[f]);return l}return Wr(c)}function Wi(c){const l=c.key,f=c.value,p=c.valueSpec||{},b=c.objectElementValidators||{},A=c.style,k=c.styleSpec,M=c.validateSpec;let R=[];const V=sr(f);if(V!=="object")return[new vt(l,f,`object expected, ${V} found`)];for(const K in f){const te=K.split(".")[0],se=p[te]||p["*"];let me;if(b[te])me=b[te];else if(p[te])me=M;else if(b["*"])me=b["*"];else{if(!p["*"]){R.push(new vt(l,f[K],`unknown property "${K}"`));continue}me=M}R=R.concat(me({key:(l&&`${l}.`)+K,value:f[K],valueSpec:se,style:A,styleSpec:k,object:f,objectKey:K,validateSpec:M},f))}for(const K in p)b[K]||p[K].required&&p[K].default===void 0&&f[K]===void 0&&R.push(new vt(l,f,`missing required property "${K}"`));return R}function il(c){const l=c.value,f=c.valueSpec,p=c.style,b=c.styleSpec,A=c.key,k=c.arrayElementValidator||c.validateSpec;if(sr(l)!=="array")return[new vt(A,l,`array expected, ${sr(l)} found`)];if(f.length&&l.length!==f.length)return[new vt(A,l,`array length ${f.length} expected, length ${l.length} found`)];if(f["min-length"]&&l.length<f["min-length"])return[new vt(A,l,`array length at least ${f["min-length"]} expected, length ${l.length} found`)];let M={type:f.value,values:f.values};b.$version<7&&(M.function=f.function),sr(f.value)==="object"&&(M=f.value);let R=[];for(let V=0;V<l.length;V++)R=R.concat(k({array:l,arrayIndex:V,value:l[V],valueSpec:M,validateSpec:c.validateSpec,style:p,styleSpec:b,key:`${A}[${V}]`}));return R}function Tc(c){const l=c.key,f=c.value,p=c.valueSpec;let b=sr(f);return b==="number"&&f!=f&&(b="NaN"),b!=="number"?[new vt(l,f,`number expected, ${b} found`)]:"minimum"in p&&f<p.minimum?[new vt(l,f,`${f} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&f>p.maximum?[new vt(l,f,`${f} is greater than the maximum value ${p.maximum}`)]:[]}function Yl(c){const l=c.valueSpec,f=Wr(c.value.type);let p,b,A,k={};const M=f!=="categorical"&&c.value.property===void 0,R=!M,V=sr(c.value.stops)==="array"&&sr(c.value.stops[0])==="array"&&sr(c.value.stops[0][0])==="object",K=Wi({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(me){if(f==="identity")return[new vt(me.key,me.value,'identity function may not have a "stops" property')];let ye=[];const xe=me.value;return ye=ye.concat(il({key:me.key,value:xe,valueSpec:me.valueSpec,validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec,arrayElementValidator:te})),sr(xe)==="array"&&xe.length===0&&ye.push(new vt(me.key,xe,"array must have at least one stop")),ye},default:function(me){return me.validateSpec({key:me.key,value:me.value,valueSpec:l,validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec})}}});return f==="identity"&&M&&K.push(new vt(c.key,c.value,'missing required property "property"')),f==="identity"||c.value.stops||K.push(new vt(c.key,c.value,'missing required property "stops"')),f==="exponential"&&c.valueSpec.expression&&!xc(c.valueSpec)&&K.push(new vt(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(R&&!ca(c.valueSpec)?K.push(new vt(c.key,c.value,"property functions not supported")):M&&!Mh(c.valueSpec)&&K.push(new vt(c.key,c.value,"zoom functions not supported"))),f!=="categorical"&&!V||c.value.property!==void 0||K.push(new vt(c.key,c.value,'"property" property is required')),K;function te(me){let ye=[];const xe=me.value,Le=me.key;if(sr(xe)!=="array")return[new vt(Le,xe,`array expected, ${sr(xe)} found`)];if(xe.length!==2)return[new vt(Le,xe,`array length 2 expected, length ${xe.length} found`)];if(V){if(sr(xe[0])!=="object")return[new vt(Le,xe,`object expected, ${sr(xe[0])} found`)];if(xe[0].zoom===void 0)return[new vt(Le,xe,"object stop key must have zoom")];if(xe[0].value===void 0)return[new vt(Le,xe,"object stop key must have value")];if(A&&A>Wr(xe[0].zoom))return[new vt(Le,xe[0].zoom,"stop zoom values must appear in ascending order")];Wr(xe[0].zoom)!==A&&(A=Wr(xe[0].zoom),b=void 0,k={}),ye=ye.concat(Wi({key:`${Le}[0]`,value:xe[0],valueSpec:{zoom:{}},validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec,objectElementValidators:{zoom:Tc,value:se}}))}else ye=ye.concat(se({key:`${Le}[0]`,value:xe[0],validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec},xe));return Wl(bo(xe[1]))?ye.concat([new vt(`${Le}[1]`,xe[1],"expressions are not allowed in function stops.")]):ye.concat(me.validateSpec({key:`${Le}[1]`,value:xe[1],valueSpec:l,validateSpec:me.validateSpec,style:me.style,styleSpec:me.styleSpec}))}function se(me,ye){const xe=sr(me.value),Le=Wr(me.value),De=me.value!==null?me.value:ye;if(p){if(xe!==p)return[new vt(me.key,De,`${xe} stop domain type must match previous stop domain type ${p}`)]}else p=xe;if(xe!=="number"&&xe!=="string"&&xe!=="boolean")return[new vt(me.key,De,"stop domain value must be a number, string, or boolean")];if(xe!=="number"&&f!=="categorical"){let Qe=`number expected, ${xe} found`;return ca(l)&&f===void 0&&(Qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new vt(me.key,De,Qe)]}return f!=="categorical"||xe!=="number"||isFinite(Le)&&Math.floor(Le)===Le?f!=="categorical"&&xe==="number"&&b!==void 0&&Le<b?[new vt(me.key,De,"stop domain values must appear in ascending order")]:(b=Le,f==="categorical"&&Le in k?[new vt(me.key,De,"stop domain values must be unique")]:(k[Le]=!0,[])):[new vt(me.key,De,`integer expected, found ${Le}`)]}}function ga(c){const l=(c.expressionContext==="property"?Ac:ha)(bo(c.value),c.valueSpec);if(l.result==="error")return l.value.map(p=>new vt(`${c.key}${p.key}`,c.value,p.message));const f=l.value.expression||l.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!f.outputDefined())return[new vt(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!la(f))return[new vt(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!la(f))return[new vt(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!el(f,["zoom","feature-state"]))return[new vt(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Qa(f))return[new vt(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ts(c){const l=c.key,f=c.value,p=c.valueSpec,b=[];return Array.isArray(p.values)?p.values.indexOf(Wr(f))===-1&&b.push(new vt(l,f,`expected one of [${p.values.join(", ")}], ${JSON.stringify(f)} found`)):Object.keys(p.values).indexOf(Wr(f))===-1&&b.push(new vt(l,f,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(f)} found`)),b}function Cc(c){return Xl(bo(c.value))?ga(Cn({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Ql(c)}function Ql(c){const l=c.value,f=c.key;if(sr(l)!=="array")return[new vt(f,l,`array expected, ${sr(l)} found`)];const p=c.styleSpec;let b,A=[];if(l.length<1)return[new vt(f,l,"filter array must have at least 1 element")];switch(A=A.concat(ts({key:`${f}[0]`,value:l[0],valueSpec:p.filter_operator,style:c.style,styleSpec:c.styleSpec})),Wr(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&Wr(l[1])==="$type"&&A.push(new vt(f,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&A.push(new vt(f,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(b=sr(l[1]),b!=="string"&&A.push(new vt(`${f}[1]`,l[1],`string expected, ${b} found`)));for(let k=2;k<l.length;k++)b=sr(l[k]),Wr(l[1])==="$type"?A=A.concat(ts({key:`${f}[${k}]`,value:l[k],valueSpec:p.geometry_type,style:c.style,styleSpec:c.styleSpec})):b!=="string"&&b!=="number"&&b!=="boolean"&&A.push(new vt(`${f}[${k}]`,l[k],`string, number, or boolean expected, ${b} found`));break;case"any":case"all":case"none":for(let k=1;k<l.length;k++)A=A.concat(Ql({key:`${f}[${k}]`,value:l[k],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":b=sr(l[1]),l.length!==2?A.push(new vt(f,l,`filter array for "${l[0]}" operator must have 2 elements`)):b!=="string"&&A.push(new vt(`${f}[1]`,l[1],`string expected, ${b} found`))}return A}function Mc(c,l){const f=c.key,p=c.validateSpec,b=c.style,A=c.styleSpec,k=c.value,M=c.objectKey,R=A[`${l}_${c.layerType}`];if(!R)return[];const V=M.match(/^(.*)-transition$/);if(l==="paint"&&V&&R[V[1]]&&R[V[1]].transition)return p({key:f,value:k,valueSpec:A.transition,style:b,styleSpec:A});const K=c.valueSpec||R[M];if(!K)return[new vt(f,k,`unknown property "${M}"`)];let te;if(sr(k)==="string"&&ca(K)&&!K.tokens&&(te=/^{([^}]+)}$/.exec(k)))return[new vt(f,k,`"${M}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(te[1])} }\`.`)];const se=[];return c.layerType==="symbol"&&(M==="text-field"&&b&&!b.glyphs&&se.push(new vt(f,k,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&Gl(bo(k))&&Wr(k.type)==="identity"&&se.push(new vt(f,k,'"text-font" does not support identity functions'))),se.concat(p({key:c.key,value:k,valueSpec:K,style:b,styleSpec:A,expressionContext:"property",propertyType:l,propertyKey:M}))}function eu(c){return Mc(c,"paint")}function Ec(c){return Mc(c,"layout")}function Ic(c){let l=[];const f=c.value,p=c.key,b=c.style,A=c.styleSpec;f.type||f.ref||l.push(new vt(p,f,'either "type" or "ref" is required'));let k=Wr(f.type);const M=Wr(f.ref);if(f.id){const R=Wr(f.id);for(let V=0;V<c.arrayIndex;V++){const K=b.layers[V];Wr(K.id)===R&&l.push(new vt(p,f.id,`duplicate layer id "${f.id}", previously used at line ${K.id.__line__}`))}}if("ref"in f){let R;["type","source","source-layer","filter","layout"].forEach(V=>{V in f&&l.push(new vt(p,f[V],`"${V}" is prohibited for ref layers`))}),b.layers.forEach(V=>{Wr(V.id)===M&&(R=V)}),R?R.ref?l.push(new vt(p,f.ref,"ref cannot reference another ref layer")):k=Wr(R.type):l.push(new vt(p,f.ref,`ref layer "${M}" not found`))}else if(k!=="background")if(f.source){const R=b.sources&&b.sources[f.source],V=R&&Wr(R.type);R?V==="vector"&&k==="raster"?l.push(new vt(p,f.source,`layer "${f.id}" requires a raster source`)):V!=="raster-dem"&&k==="hillshade"?l.push(new vt(p,f.source,`layer "${f.id}" requires a raster-dem source`)):V==="raster"&&k!=="raster"?l.push(new vt(p,f.source,`layer "${f.id}" requires a vector source`)):V!=="vector"||f["source-layer"]?V==="raster-dem"&&k!=="hillshade"?l.push(new vt(p,f.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="line"||!f.paint||!f.paint["line-gradient"]||V==="geojson"&&R.lineMetrics||l.push(new vt(p,f,`layer "${f.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new vt(p,f,`layer "${f.id}" must specify a "source-layer"`)):l.push(new vt(p,f.source,`source "${f.source}" not found`))}else l.push(new vt(p,f,'missing required property "source"'));return l=l.concat(Wi({key:p,value:f,valueSpec:A.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${p}.type`,value:f.type,valueSpec:A.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:f,objectKey:"type"}),filter:Cc,layout:R=>Wi({layer:f,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":V=>Ec(Cn({layerType:k},V))}}),paint:R=>Wi({layer:f,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":V=>eu(Cn({layerType:k},V))}})}})),l}function $s(c){const l=c.value,f=c.key,p=sr(l);return p!=="string"?[new vt(f,l,`string expected, ${p} found`)]:[]}const tu={promoteId:function({key:c,value:l}){if(sr(l)==="string")return $s({key:c,value:l});{const f=[];for(const p in l)f.push(...$s({key:`${c}.${p}`,value:l[p]}));return f}}};function ol(c){const l=c.value,f=c.key,p=c.styleSpec,b=c.style,A=c.validateSpec;if(!l.type)return[new vt(f,l,'"type" is required')];const k=Wr(l.type);let M;switch(k){case"vector":case"raster":return M=Wi({key:f,value:l,valueSpec:p[`source_${k.replace("-","_")}`],style:c.style,styleSpec:p,objectElementValidators:tu,validateSpec:A}),M;case"raster-dem":return M=function(R){var V;const K=(V=R.sourceName)!==null&&V!==void 0?V:"",te=R.value,se=R.styleSpec,me=se.source_raster_dem,ye=R.style;let xe=[];const Le=sr(te);if(te===void 0)return xe;if(Le!=="object")return xe.push(new vt("source_raster_dem",te,`object expected, ${Le} found`)),xe;const De=Wr(te.encoding)==="custom",Qe=["redFactor","greenFactor","blueFactor","baseShift"],je=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Je in te)!De&&Qe.includes(Je)?xe.push(new vt(Je,te[Je],`In "${K}": "${Je}" is only valid when "encoding" is set to "custom". ${je} encoding found`)):me[Je]?xe=xe.concat(R.validateSpec({key:Je,value:te[Je],valueSpec:me[Je],validateSpec:R.validateSpec,style:ye,styleSpec:se})):xe.push(new vt(Je,te[Je],`unknown property "${Je}"`));return xe}({sourceName:f,value:l,style:c.style,styleSpec:p,validateSpec:A}),M;case"geojson":if(M=Wi({key:f,value:l,valueSpec:p.source_geojson,style:b,styleSpec:p,validateSpec:A,objectElementValidators:tu}),l.cluster)for(const R in l.clusterProperties){const[V,K]=l.clusterProperties[R],te=typeof V=="string"?[V,["accumulated"],["get",R]]:V;M.push(...ga({key:`${f}.${R}.map`,value:K,expressionContext:"cluster-map"})),M.push(...ga({key:`${f}.${R}.reduce`,value:te,expressionContext:"cluster-reduce"}))}return M;case"video":return Wi({key:f,value:l,valueSpec:p.source_video,style:b,validateSpec:A,styleSpec:p});case"image":return Wi({key:f,value:l,valueSpec:p.source_image,style:b,validateSpec:A,styleSpec:p});case"canvas":return[new vt(f,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ts({key:`${f}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Lc(c){const l=c.value,f=c.styleSpec,p=f.light,b=c.style;let A=[];const k=sr(l);if(l===void 0)return A;if(k!=="object")return A=A.concat([new vt("light",l,`object expected, ${k} found`)]),A;for(const M in l){const R=M.match(/^(.*)-transition$/);A=A.concat(R&&p[R[1]]&&p[R[1]].transition?c.validateSpec({key:M,value:l[M],valueSpec:f.transition,validateSpec:c.validateSpec,style:b,styleSpec:f}):p[M]?c.validateSpec({key:M,value:l[M],valueSpec:p[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new vt(M,l[M],`unknown property "${M}"`)])}return A}function Pc(c){const l=c.value,f=c.styleSpec,p=f.sky,b=c.style,A=sr(l);if(l===void 0)return[];if(A!=="object")return[new vt("sky",l,`object expected, ${A} found`)];let k=[];for(const M in l)k=k.concat(p[M]?c.validateSpec({key:M,value:l[M],valueSpec:p[M],style:b,styleSpec:f}):[new vt(M,l[M],`unknown property "${M}"`)]);return k}function zc(c){const l=c.value,f=c.styleSpec,p=f.terrain,b=c.style;let A=[];const k=sr(l);if(l===void 0)return A;if(k!=="object")return A=A.concat([new vt("terrain",l,`object expected, ${k} found`)]),A;for(const M in l)A=A.concat(p[M]?c.validateSpec({key:M,value:l[M],valueSpec:p[M],validateSpec:c.validateSpec,style:b,styleSpec:f}):[new vt(M,l[M],`unknown property "${M}"`)]);return A}function Dc(c){let l=[];const f=c.value,p=c.key;if(Array.isArray(f)){const b=[],A=[];for(const k in f)f[k].id&&b.includes(f[k].id)&&l.push(new vt(p,f,`all the sprites' ids must be unique, but ${f[k].id} is duplicated`)),b.push(f[k].id),f[k].url&&A.includes(f[k].url)&&l.push(new vt(p,f,`all the sprites' URLs must be unique, but ${f[k].url} is duplicated`)),A.push(f[k].url),l=l.concat(Wi({key:`${p}[${k}]`,value:f[k],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return l}return $s({key:p,value:f})}const nu={"*":()=>[],array:il,boolean:function(c){const l=c.value,f=c.key,p=sr(l);return p!=="boolean"?[new vt(f,l,`boolean expected, ${p} found`)]:[]},number:Tc,color:function(c){const l=c.key,f=c.value,p=sr(f);return p!=="string"?[new vt(l,f,`color expected, ${p} found`)]:gn.parse(String(f))?[]:[new vt(l,f,`color expected, "${f}" found`)]},constants:Rh,enum:ts,filter:Cc,function:Yl,layer:Ic,object:Wi,source:ol,light:Lc,sky:Pc,terrain:zc,projection:function(c){const l=c.value,f=c.styleSpec,p=f.projection,b=c.style,A=sr(l);if(l===void 0)return[];if(A!=="object")return[new vt("projection",l,`object expected, ${A} found`)];let k=[];for(const M in l)k=k.concat(p[M]?c.validateSpec({key:M,value:l[M],valueSpec:p[M],style:b,styleSpec:f}):[new vt(M,l[M],`unknown property "${M}"`)]);return k},string:$s,formatted:function(c){return $s(c).length===0?[]:ga(c)},resolvedImage:function(c){return $s(c).length===0?[]:ga(c)},padding:function(c){const l=c.key,f=c.value;if(sr(f)==="array"){if(f.length<1||f.length>4)return[new vt(l,f,`padding requires 1 to 4 values; ${f.length} values found`)];const p={type:"number"};let b=[];for(let A=0;A<f.length;A++)b=b.concat(c.validateSpec({key:`${l}[${A}]`,value:f[A],validateSpec:c.validateSpec,valueSpec:p}));return b}return Tc({key:l,value:f,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const l=c.key,f=c.value,p=sr(f),b=c.styleSpec;if(p!=="array"||f.length<1||f.length%2!=0)return[new vt(l,f,"variableAnchorOffsetCollection requires a non-empty array of even length")];let A=[];for(let k=0;k<f.length;k+=2)A=A.concat(ts({key:`${l}[${k}]`,value:f[k],valueSpec:b.layout_symbol["text-anchor"]})),A=A.concat(il({key:`${l}[${k+1}]`,value:f[k+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:b}));return A},sprite:Dc};function sl(c){const l=c.value,f=c.valueSpec,p=c.styleSpec;return c.validateSpec=sl,f.expression&&Gl(Wr(l))?Yl(c):f.expression&&Wl(bo(l))?ga(c):f.type&&nu[f.type]?nu[f.type](c):Wi(Cn({},c,{valueSpec:f.type?p[f.type]:f}))}function Bh(c){const l=c.value,f=c.key,p=$s(c);return p.length||(l.indexOf("{fontstack}")===-1&&p.push(new vt(f,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&p.push(new vt(f,l,'"glyphs" url must include a "{range}" token'))),p}function to(c,l=Ge){let f=[];return f=f.concat(sl({key:"",value:c,valueSpec:l.$root,styleSpec:l,style:c,validateSpec:sl,objectElementValidators:{glyphs:Bh,"*":()=>[]}})),c.constants&&(f=f.concat(Rh({key:"constants",value:c.constants}))),Rc(f)}function Oo(c){return function(l){return c({...l,validateSpec:sl})}}function Rc(c){return[].concat(c).sort((l,f)=>l.line-f.line)}function vo(c){return function(...l){return Rc(c.apply(this,l))}}to.source=vo(Oo(ol)),to.sprite=vo(Oo(Dc)),to.glyphs=vo(Oo(Bh)),to.light=vo(Oo(Lc)),to.sky=vo(Oo(Pc)),to.terrain=vo(Oo(zc)),to.layer=vo(Oo(Ic)),to.filter=vo(Oo(Cc)),to.paintProperty=vo(Oo(eu)),to.layoutProperty=vo(Oo(Ec));const js=to,Mp=js.light,Ep=js.sky,Fh=js.paintProperty,Oh=js.layoutProperty;function Bc(c,l){let f=!1;if(l&&l.length)for(const p of l)c.fire(new Xe(new Error(p.message))),f=!0;return f}class _a{constructor(l,f,p){const b=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const k=new Int32Array(this.arrayBuffer);l=k[0],this.d=(f=k[1])+2*(p=k[2]);for(let R=0;R<this.d*this.d;R++){const V=k[3+R],K=k[3+R+1];b.push(V===K?null:k.subarray(V,K))}const M=k[3+b.length+1];this.keys=k.subarray(k[3+b.length],M),this.bboxes=k.subarray(M),this.insert=this._insertReadonly}else{this.d=f+2*p;for(let k=0;k<this.d*this.d;k++)b.push([]);this.keys=[],this.bboxes=[]}this.n=f,this.extent=l,this.padding=p,this.scale=f/l,this.uid=0;const A=p/f*l;this.min=-A,this.max=l+A}insert(l,f,p,b,A){this._forEachCell(f,p,b,A,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(f),this.bboxes.push(p),this.bboxes.push(b),this.bboxes.push(A)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,f,p,b,A,k){this.cells[A].push(k)}query(l,f,p,b,A){const k=this.min,M=this.max;if(l<=k&&f<=k&&M<=p&&M<=b&&!A)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(l,f,p,b,this._queryCell,R,{},A),R}}_queryCell(l,f,p,b,A,k,M,R){const V=this.cells[A];if(V!==null){const K=this.keys,te=this.bboxes;for(let se=0;se<V.length;se++){const me=V[se];if(M[me]===void 0){const ye=4*me;(R?R(te[ye+0],te[ye+1],te[ye+2],te[ye+3]):l<=te[ye+2]&&f<=te[ye+3]&&p>=te[ye+0]&&b>=te[ye+1])?(M[me]=!0,k.push(K[me])):M[me]=!1}}}}_forEachCell(l,f,p,b,A,k,M,R){const V=this._convertToCellCoord(l),K=this._convertToCellCoord(f),te=this._convertToCellCoord(p),se=this._convertToCellCoord(b);for(let me=V;me<=te;me++)for(let ye=K;ye<=se;ye++){const xe=this.d*ye+me;if((!R||R(this._convertFromCellCoord(me),this._convertFromCellCoord(ye),this._convertFromCellCoord(me+1),this._convertFromCellCoord(ye+1)))&&A.call(this,l,f,p,b,xe,k,M,R))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,f=3+this.cells.length+1+1;let p=0;for(let k=0;k<this.cells.length;k++)p+=this.cells[k].length;const b=new Int32Array(f+p+this.keys.length+this.bboxes.length);b[0]=this.extent,b[1]=this.n,b[2]=this.padding;let A=f;for(let k=0;k<l.length;k++){const M=l[k];b[3+k]=A,b.set(M,A),A+=M.length}return b[3+l.length]=A,b.set(this.keys,A),A+=this.keys.length,b[3+l.length+1]=A,b.set(this.bboxes,A),A+=this.bboxes.length,b.buffer}static serialize(l,f){const p=l.toArrayBuffer();return f&&f.push(p),{buffer:p}}static deserialize(l){return new _a(l.buffer)}}const no={};function Yt(c,l,f={}){if(no[c])throw new Error(`${c} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:c,writeable:!1}),no[c]={klass:l,omit:f.omit||[],shallow:f.shallow||[]}}Yt("Object",Object),Yt("TransferableGridIndex",_a),Yt("Color",gn),Yt("Error",Error),Yt("AJAXError",Ct),Yt("ResolvedImage",Ii),Yt("StylePropertyFunction",ma),Yt("StyleExpression",Hl,{omit:["_evaluator"]}),Yt("ZoomDependentExpression",pa),Yt("ZoomConstantExpression",da),Yt("CompoundExpression",eo,{omit:["_evaluate"]});for(const c in aa)aa[c]._classRegistryKey||Yt(`Expression_${c}`,aa[c]);function ru(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Fc(c){return c.$name||c.constructor._classRegistryKey}function Nh(c){return!function(l){if(l===null||typeof l!="object")return!1;const f=Fc(l);return!(!f||f==="Object")}(c)&&(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||ru(c)||ve(c)||ArrayBuffer.isView(c)||c instanceof ImageData)}function ya(c,l){if(Nh(c))return(ru(c)||ve(c))&&l&&l.push(c),ArrayBuffer.isView(c)&&l&&l.push(c.buffer),c instanceof ImageData&&l&&l.push(c.data.buffer),c;if(Array.isArray(c)){const A=[];for(const k of c)A.push(ya(k,l));return A}if(typeof c!="object")throw new Error("can't serialize object of type "+typeof c);const f=Fc(c);if(!f)throw new Error(`can't serialize object of unregistered class ${c.constructor.name}`);if(!no[f])throw new Error(`${f} is not registered.`);const{klass:p}=no[f],b=p.serialize?p.serialize(c,l):{};if(p.serialize){if(l&&b===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const A in c){if(!c.hasOwnProperty(A)||no[f].omit.indexOf(A)>=0)continue;const k=c[A];b[A]=no[f].shallow.indexOf(A)>=0?k:ya(k,l)}c instanceof Error&&(b.message=c.message)}if(b.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(b.$name=f),b}function ba(c){if(Nh(c))return c;if(Array.isArray(c))return c.map(ba);if(typeof c!="object")throw new Error("can't deserialize object of type "+typeof c);const l=Fc(c)||"Object";if(!no[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:f}=no[l];if(!f)throw new Error(`can't deserialize unregistered class ${l}`);if(f.deserialize)return f.deserialize(c);const p=Object.create(f.prototype);for(const b of Object.keys(c)){if(b==="$name")continue;const A=c[b];p[b]=no[l].shallow.indexOf(b)>=0?A:ba(A)}return p}class Oc{constructor(){this.first=!0}update(l,f){const p=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=f):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=f),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=p,!0))}}const Xn={"Latin-1 Supplement":c=>c>=128&&c<=255,"Hangul Jamo":c=>c>=4352&&c<=4607,Khmer:c=>c>=6016&&c<=6143,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Katakana:c=>c>=12448&&c<=12543,Kanbun:c=>c>=12688&&c<=12703,"CJK Strokes":c=>c>=12736&&c<=12783,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"Private Use Area":c=>c>=57344&&c<=63743,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function Nc(c){for(const l of c)if(jc(l.charCodeAt(0)))return!0;return!1}function Ip(c){for(const l of c)if(!va(l.charCodeAt(0)))return!1;return!0}function $c(c){const l=c.map(f=>{try{return new RegExp(`\\p{sc=${f}}`,"u").source}catch{return null}}).filter(f=>f);return new RegExp(l.join("|"),"u")}const Lp=$c(["Arab","Dupl","Mong","Ougr","Syrc"]);function va(c){return!Lp.test(String.fromCodePoint(c))}const $h=$c(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function jc(c){return!(c!==746&&c!==747&&(c<4352||!(Xn["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||Xn["CJK Compatibility"](c)||Xn["CJK Strokes"](c)||!(!Xn["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||Xn["Enclosed CJK Letters and Months"](c)||Xn["Ideographic Description Characters"](c)||Xn.Kanbun(c)||Xn.Katakana(c)&&c!==12540||!(!Xn["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!Xn["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||Xn["Vertical Forms"](c)||Xn["Yijing Hexagram Symbols"](c)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(c))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(c))||$h.test(String.fromCodePoint(c)))))}function jh(c){return!(jc(c)||function(l){return!!(Xn["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Xn["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Xn["Letterlike Symbols"](l)||Xn["Number Forms"](l)||Xn["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Xn["Control Pictures"](l)&&l!==9251||Xn["Optical Character Recognition"](l)||Xn["Enclosed Alphanumerics"](l)||Xn["Geometric Shapes"](l)||Xn["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Xn["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Xn["CJK Symbols and Punctuation"](l)||Xn.Katakana(l)||Xn["Private Use Area"](l)||Xn["CJK Compatibility Forms"](l)||Xn["Small Form Variants"](l)||Xn["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)}(c))}const Pp=$c(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Uc(c){return Pp.test(String.fromCodePoint(c))}function zp(c,l){return!(!l&&Uc(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||Xn.Khmer(c))}function Dp(c){for(const l of c)if(Uc(l.charCodeAt(0)))return!0;return!1}const Xi=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class zr{constructor(l,f){this.zoom=l,f?(this.now=f.now,this.fadeDuration=f.fadeDuration,this.zoomHistory=f.zoomHistory,this.transition=f.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Oc,this.transition={})}isSupportedScript(l){return function(f,p){for(const b of f)if(!zp(b.charCodeAt(0),p))return!1;return!0}(l,Xi.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,f=l-Math.floor(l),p=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:f+(1-f)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*f}}}class wa{constructor(l,f){this.property=l,this.value=f,this.expression=function(p,b){if(Gl(p))return new ma(p,b);if(Wl(p)){const A=Ac(p,b);if(A.result==="error")throw new Error(A.value.map(k=>`${k.key}: ${k.message}`).join(", "));return A.value}{let A=p;return b.type==="color"&&typeof p=="string"?A=gn.parse(p):b.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?b.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(A=ci.parse(p)):A=Ur.parse(p),{kind:"constant",evaluate:()=>A}}}(f===void 0?l.specification.default:f,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,f,p){return this.property.possiblyEvaluate(this,l,f,p)}}class iu{constructor(l){this.property=l,this.value=new wa(l,void 0)}transitioned(l,f){return new Uh(this.property,this.value,f,ue({},l.transition,this.transition),l.now)}untransitioned(){return new Uh(this.property,this.value,null,{},0)}}class ou{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return F(this._values[l].value.value)}setValue(l,f){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new iu(this._values[l].property)),this._values[l].value=new wa(this._values[l].property,f===null?void 0:F(f))}getTransition(l){return F(this._values[l].transition)}setTransition(l,f){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new iu(this._values[l].property)),this._values[l].transition=F(f)||void 0}serialize(){const l={};for(const f of Object.keys(this._values)){const p=this.getValue(f);p!==void 0&&(l[f]=p);const b=this.getTransition(f);b!==void 0&&(l[`${f}-transition`]=b)}return l}transitioned(l,f){const p=new al(this._properties);for(const b of Object.keys(this._values))p._values[b]=this._values[b].transitioned(l,f._values[b]);return p}untransitioned(){const l=new al(this._properties);for(const f of Object.keys(this._values))l._values[f]=this._values[f].untransitioned();return l}}class Uh{constructor(l,f,p,b,A){this.property=l,this.value=f,this.begin=A+b.delay||0,this.end=this.begin+b.duration||0,l.specification.transition&&(b.delay||b.duration)&&(this.prior=p)}possiblyEvaluate(l,f,p){const b=l.now||0,A=this.value.possiblyEvaluate(l,f,p),k=this.prior;if(k){if(b>this.end)return this.prior=null,A;if(this.value.isDataDriven())return this.prior=null,A;if(b<this.begin)return k.possiblyEvaluate(l,f,p);{const M=(b-this.begin)/(this.end-this.begin);return this.property.interpolate(k.possiblyEvaluate(l,f,p),A,function(R){if(R<=0)return 0;if(R>=1)return 1;const V=R*R,K=V*R;return 4*(R<.5?K:3*(R-V)+K-.75)}(M))}}return A}}class al{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,f,p){const b=new ul(this._properties);for(const A of Object.keys(this._values))b._values[A]=this._values[A].possiblyEvaluate(l,f,p);return b}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class ll{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return F(this._values[l].value)}setValue(l,f){this._values[l]=new wa(this._values[l].property,f===null?void 0:F(f))}serialize(){const l={};for(const f of Object.keys(this._values)){const p=this.getValue(f);p!==void 0&&(l[f]=p)}return l}possiblyEvaluate(l,f,p){const b=new ul(this._properties);for(const A of Object.keys(this._values))b._values[A]=this._values[A].possiblyEvaluate(l,f,p);return b}}class No{constructor(l,f,p){this.property=l,this.value=f,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,f,p,b){return this.property.evaluate(this.value,this.parameters,l,f,p,b)}}class ul{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class an{constructor(l){this.specification=l}possiblyEvaluate(l,f){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(f)}interpolate(l,f,p){const b=Oi[this.specification.type];return b?b(l,f,p):l}}class An{constructor(l,f){this.specification=l,this.overrides=f}possiblyEvaluate(l,f,p,b){return new No(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(f,null,{},p,b)}:l.expression,f)}interpolate(l,f,p){if(l.value.kind!=="constant"||f.value.kind!=="constant")return l;if(l.value.value===void 0||f.value.value===void 0)return new No(this,{kind:"constant",value:void 0},l.parameters);const b=Oi[this.specification.type];if(b){const A=b(l.value.value,f.value.value,p);return new No(this,{kind:"constant",value:A},l.parameters)}return l}evaluate(l,f,p,b,A,k){return l.kind==="constant"?l.value:l.evaluate(f,p,b,A,k)}}class su extends An{possiblyEvaluate(l,f,p,b){if(l.value===void 0)return new No(this,{kind:"constant",value:void 0},f);if(l.expression.kind==="constant"){const A=l.expression.evaluate(f,null,{},p,b),k=l.property.specification.type==="resolvedImage"&&typeof A!="string"?A.name:A,M=this._calculate(k,k,k,f);return new No(this,{kind:"constant",value:M},f)}if(l.expression.kind==="camera"){const A=this._calculate(l.expression.evaluate({zoom:f.zoom-1}),l.expression.evaluate({zoom:f.zoom}),l.expression.evaluate({zoom:f.zoom+1}),f);return new No(this,{kind:"constant",value:A},f)}return new No(this,l.expression,f)}evaluate(l,f,p,b,A,k){if(l.kind==="source"){const M=l.evaluate(f,p,b,A,k);return this._calculate(M,M,M,f)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(f.zoom)-1},p,b),l.evaluate({zoom:Math.floor(f.zoom)},p,b),l.evaluate({zoom:Math.floor(f.zoom)+1},p,b),f):l.value}_calculate(l,f,p,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:l,to:f}:{from:p,to:f}}interpolate(l){return l}}class au{constructor(l){this.specification=l}possiblyEvaluate(l,f,p,b){if(l.value!==void 0){if(l.expression.kind==="constant"){const A=l.expression.evaluate(f,null,{},p,b);return this._calculate(A,A,A,f)}return this._calculate(l.expression.evaluate(new zr(Math.floor(f.zoom-1),f)),l.expression.evaluate(new zr(Math.floor(f.zoom),f)),l.expression.evaluate(new zr(Math.floor(f.zoom+1),f)),f)}}_calculate(l,f,p,b){return b.zoom>b.zoomHistory.lastIntegerZoom?{from:l,to:f}:{from:p,to:f}}interpolate(l){return l}}class Vc{constructor(l){this.specification=l}possiblyEvaluate(l,f,p,b){return!!l.expression.evaluate(f,null,{},p,b)}interpolate(){return!1}}class x{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const f in l){const p=l[f];p.specification.overridable&&this.overridableProperties.push(f);const b=this.defaultPropertyValues[f]=new wa(p,void 0),A=this.defaultTransitionablePropertyValues[f]=new iu(p);this.defaultTransitioningPropertyValues[f]=A.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=b.possiblyEvaluate({})}}}Yt("DataDrivenProperty",An),Yt("DataConstantProperty",an),Yt("CrossFadedDataDrivenProperty",su),Yt("CrossFadedProperty",au),Yt("ColorRampProperty",Vc);const s="-transition";class h extends qt{constructor(l,f){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),f.layout&&(this._unevaluatedLayout=new ll(f.layout)),f.paint)){this._transitionablePaint=new ou(f.paint);for(const p in l.paint)this.setPaintProperty(p,l.paint[p],{validate:!1});for(const p in l.layout)this.setLayoutProperty(p,l.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ul(f.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,f,p={}){f!=null&&this._validate(Oh,`layers.${this.id}.layout.${l}`,l,f,p)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,f):this.visibility=f)}getPaintProperty(l){return l.endsWith(s)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,f,p={}){if(f!=null&&this._validate(Fh,`layers.${this.id}.paint.${l}`,l,f,p))return!1;if(l.endsWith(s))return this._transitionablePaint.setTransition(l.slice(0,-11),f||void 0),!1;{const b=this._transitionablePaint._values[l],A=b.property.specification["property-type"]==="cross-faded-data-driven",k=b.value.isDataDriven(),M=b.value;this._transitionablePaint.setValue(l,f),this._handleSpecialPaintPropertyUpdate(l);const R=this._transitionablePaint._values[l].value;return R.isDataDriven()||k||A||this._handleOverridablePaintPropertyUpdate(l,M,R)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,f,p){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,f){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,f)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),ne(l,(f,p)=>!(f===void 0||p==="layout"&&!Object.keys(f).length||p==="paint"&&!Object.keys(f).length))}_validate(l,f,p,b,A={}){return(!A||A.validate!==!1)&&Bc(this,l.call(js,{key:f,layerType:this.type,objectKey:p,value:b,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const f=this.paint.get(l);if(f instanceof No&&ca(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1}}const g={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class y{constructor(l,f){this._structArray=l,this._pos1=f*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class w{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,f){return l._trim(),f&&(l.isTransferred=!0,f.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const f=Object.create(this.prototype);return f.arrayBuffer=l.arrayBuffer,f.length=l.length,f.capacity=l.arrayBuffer.byteLength/f.bytesPerElement,f._refreshViews(),f}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const f=this.uint8;this._refreshViews(),f&&this.uint8.set(f)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function E(c,l=1){let f=0,p=0;return{members:c.map(b=>{const A=g[b.type].BYTES_PER_ELEMENT,k=f=B(f,Math.max(l,A)),M=b.components||1;return p=Math.max(p,A),f+=A*M,{name:b.name,type:b.type,components:M,offset:k}}),size:B(f,Math.max(p,l)),alignment:l}}function B(c,l){return Math.ceil(c/l)*l}class j extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f){const p=this.length;return this.resize(p+1),this.emplace(p,l,f)}emplace(l,f,p){const b=2*l;return this.int16[b+0]=f,this.int16[b+1]=p,l}}j.prototype.bytesPerElement=4,Yt("StructArrayLayout2i4",j);class Y extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p)}emplace(l,f,p,b){const A=3*l;return this.int16[A+0]=f,this.int16[A+1]=p,this.int16[A+2]=b,l}}Y.prototype.bytesPerElement=6,Yt("StructArrayLayout3i6",Y);class re extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,b){const A=this.length;return this.resize(A+1),this.emplace(A,l,f,p,b)}emplace(l,f,p,b,A){const k=4*l;return this.int16[k+0]=f,this.int16[k+1]=p,this.int16[k+2]=b,this.int16[k+3]=A,l}}re.prototype.bytesPerElement=8,Yt("StructArrayLayout4i8",re);class ie extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A,k){const M=this.length;return this.resize(M+1),this.emplace(M,l,f,p,b,A,k)}emplace(l,f,p,b,A,k,M){const R=6*l;return this.int16[R+0]=f,this.int16[R+1]=p,this.int16[R+2]=b,this.int16[R+3]=A,this.int16[R+4]=k,this.int16[R+5]=M,l}}ie.prototype.bytesPerElement=12,Yt("StructArrayLayout2i4i12",ie);class _e extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A,k){const M=this.length;return this.resize(M+1),this.emplace(M,l,f,p,b,A,k)}emplace(l,f,p,b,A,k,M){const R=4*l,V=8*l;return this.int16[R+0]=f,this.int16[R+1]=p,this.uint8[V+4]=b,this.uint8[V+5]=A,this.uint8[V+6]=k,this.uint8[V+7]=M,l}}_e.prototype.bytesPerElement=8,Yt("StructArrayLayout2i4ub8",_e);class Ae extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f){const p=this.length;return this.resize(p+1),this.emplace(p,l,f)}emplace(l,f,p){const b=2*l;return this.float32[b+0]=f,this.float32[b+1]=p,l}}Ae.prototype.bytesPerElement=8,Yt("StructArrayLayout2f8",Ae);class Se extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A,k,M,R,V,K){const te=this.length;return this.resize(te+1),this.emplace(te,l,f,p,b,A,k,M,R,V,K)}emplace(l,f,p,b,A,k,M,R,V,K,te){const se=10*l;return this.uint16[se+0]=f,this.uint16[se+1]=p,this.uint16[se+2]=b,this.uint16[se+3]=A,this.uint16[se+4]=k,this.uint16[se+5]=M,this.uint16[se+6]=R,this.uint16[se+7]=V,this.uint16[se+8]=K,this.uint16[se+9]=te,l}}Se.prototype.bytesPerElement=20,Yt("StructArrayLayout10ui20",Se);class ze extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A,k,M,R,V,K,te,se){const me=this.length;return this.resize(me+1),this.emplace(me,l,f,p,b,A,k,M,R,V,K,te,se)}emplace(l,f,p,b,A,k,M,R,V,K,te,se,me){const ye=12*l;return this.int16[ye+0]=f,this.int16[ye+1]=p,this.int16[ye+2]=b,this.int16[ye+3]=A,this.uint16[ye+4]=k,this.uint16[ye+5]=M,this.uint16[ye+6]=R,this.uint16[ye+7]=V,this.int16[ye+8]=K,this.int16[ye+9]=te,this.int16[ye+10]=se,this.int16[ye+11]=me,l}}ze.prototype.bytesPerElement=24,Yt("StructArrayLayout4i4ui4i24",ze);class Re extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p)}emplace(l,f,p,b){const A=3*l;return this.float32[A+0]=f,this.float32[A+1]=p,this.float32[A+2]=b,l}}Re.prototype.bytesPerElement=12,Yt("StructArrayLayout3f12",Re);class Be extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.uint32[1*l+0]=f,l}}Be.prototype.bytesPerElement=4,Yt("StructArrayLayout1ul4",Be);class $e extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A,k,M,R,V){const K=this.length;return this.resize(K+1),this.emplace(K,l,f,p,b,A,k,M,R,V)}emplace(l,f,p,b,A,k,M,R,V,K){const te=10*l,se=5*l;return this.int16[te+0]=f,this.int16[te+1]=p,this.int16[te+2]=b,this.int16[te+3]=A,this.int16[te+4]=k,this.int16[te+5]=M,this.uint32[se+3]=R,this.uint16[te+8]=V,this.uint16[te+9]=K,l}}$e.prototype.bytesPerElement=20,Yt("StructArrayLayout6i1ul2ui20",$e);class Ie extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A,k){const M=this.length;return this.resize(M+1),this.emplace(M,l,f,p,b,A,k)}emplace(l,f,p,b,A,k,M){const R=6*l;return this.int16[R+0]=f,this.int16[R+1]=p,this.int16[R+2]=b,this.int16[R+3]=A,this.int16[R+4]=k,this.int16[R+5]=M,l}}Ie.prototype.bytesPerElement=12,Yt("StructArrayLayout2i2i2i12",Ie);class qe extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A){const k=this.length;return this.resize(k+1),this.emplace(k,l,f,p,b,A)}emplace(l,f,p,b,A,k){const M=4*l,R=8*l;return this.float32[M+0]=f,this.float32[M+1]=p,this.float32[M+2]=b,this.int16[R+6]=A,this.int16[R+7]=k,l}}qe.prototype.bytesPerElement=16,Yt("StructArrayLayout2f1f2i16",qe);class We extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A,k){const M=this.length;return this.resize(M+1),this.emplace(M,l,f,p,b,A,k)}emplace(l,f,p,b,A,k,M){const R=16*l,V=4*l,K=8*l;return this.uint8[R+0]=f,this.uint8[R+1]=p,this.float32[V+1]=b,this.float32[V+2]=A,this.int16[K+6]=k,this.int16[K+7]=M,l}}We.prototype.bytesPerElement=16,Yt("StructArrayLayout2ub2f2i16",We);class nt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p)}emplace(l,f,p,b){const A=3*l;return this.uint16[A+0]=f,this.uint16[A+1]=p,this.uint16[A+2]=b,l}}nt.prototype.bytesPerElement=6,Yt("StructArrayLayout3ui6",nt);class bt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A,k,M,R,V,K,te,se,me,ye,xe,Le,De){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,l,f,p,b,A,k,M,R,V,K,te,se,me,ye,xe,Le,De)}emplace(l,f,p,b,A,k,M,R,V,K,te,se,me,ye,xe,Le,De,Qe){const je=24*l,Je=12*l,lt=48*l;return this.int16[je+0]=f,this.int16[je+1]=p,this.uint16[je+2]=b,this.uint16[je+3]=A,this.uint32[Je+2]=k,this.uint32[Je+3]=M,this.uint32[Je+4]=R,this.uint16[je+10]=V,this.uint16[je+11]=K,this.uint16[je+12]=te,this.float32[Je+7]=se,this.float32[Je+8]=me,this.uint8[lt+36]=ye,this.uint8[lt+37]=xe,this.uint8[lt+38]=Le,this.uint32[Je+10]=De,this.int16[je+22]=Qe,l}}bt.prototype.bytesPerElement=48,Yt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",bt);class Pt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p,b,A,k,M,R,V,K,te,se,me,ye,xe,Le,De,Qe,je,Je,lt,Et,Xt,xn,Gt,Ut,fn,en){const Kt=this.length;return this.resize(Kt+1),this.emplace(Kt,l,f,p,b,A,k,M,R,V,K,te,se,me,ye,xe,Le,De,Qe,je,Je,lt,Et,Xt,xn,Gt,Ut,fn,en)}emplace(l,f,p,b,A,k,M,R,V,K,te,se,me,ye,xe,Le,De,Qe,je,Je,lt,Et,Xt,xn,Gt,Ut,fn,en,Kt){const dt=32*l,pn=16*l;return this.int16[dt+0]=f,this.int16[dt+1]=p,this.int16[dt+2]=b,this.int16[dt+3]=A,this.int16[dt+4]=k,this.int16[dt+5]=M,this.int16[dt+6]=R,this.int16[dt+7]=V,this.uint16[dt+8]=K,this.uint16[dt+9]=te,this.uint16[dt+10]=se,this.uint16[dt+11]=me,this.uint16[dt+12]=ye,this.uint16[dt+13]=xe,this.uint16[dt+14]=Le,this.uint16[dt+15]=De,this.uint16[dt+16]=Qe,this.uint16[dt+17]=je,this.uint16[dt+18]=Je,this.uint16[dt+19]=lt,this.uint16[dt+20]=Et,this.uint16[dt+21]=Xt,this.uint16[dt+22]=xn,this.uint32[pn+12]=Gt,this.float32[pn+13]=Ut,this.float32[pn+14]=fn,this.uint16[dt+30]=en,this.uint16[dt+31]=Kt,l}}Pt.prototype.bytesPerElement=64,Yt("StructArrayLayout8i15ui1ul2f2ui64",Pt);class Vt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.float32[1*l+0]=f,l}}Vt.prototype.bytesPerElement=4,Yt("StructArrayLayout1f4",Vt);class Jt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p)}emplace(l,f,p,b){const A=3*l;return this.uint16[6*l+0]=f,this.float32[A+1]=p,this.float32[A+2]=b,l}}Jt.prototype.bytesPerElement=12,Yt("StructArrayLayout1ui2f12",Jt);class Ot extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f,p){const b=this.length;return this.resize(b+1),this.emplace(b,l,f,p)}emplace(l,f,p,b){const A=4*l;return this.uint32[2*l+0]=f,this.uint16[A+2]=p,this.uint16[A+3]=b,l}}Ot.prototype.bytesPerElement=8,Yt("StructArrayLayout1ul2ui8",Ot);class Bt extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,f){const p=this.length;return this.resize(p+1),this.emplace(p,l,f)}emplace(l,f,p){const b=2*l;return this.uint16[b+0]=f,this.uint16[b+1]=p,l}}Bt.prototype.bytesPerElement=4,Yt("StructArrayLayout2ui4",Bt);class ln extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const f=this.length;return this.resize(f+1),this.emplace(f,l)}emplace(l,f){return this.uint16[1*l+0]=f,l}}ln.prototype.bytesPerElement=2,Yt("StructArrayLayout1ui2",ln);class In extends w{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,f,p,b){const A=this.length;return this.resize(A+1),this.emplace(A,l,f,p,b)}emplace(l,f,p,b,A){const k=4*l;return this.float32[k+0]=f,this.float32[k+1]=p,this.float32[k+2]=b,this.float32[k+3]=A,l}}In.prototype.bytesPerElement=16,Yt("StructArrayLayout4f16",In);class jt extends y{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new v(this.anchorPointX,this.anchorPointY)}}jt.prototype.size=20;class Wt extends $e{get(l){return new jt(this,l)}}Yt("CollisionBoxArray",Wt);class Mn extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Mn.prototype.size=48;class Dr extends bt{get(l){return new Mn(this,l)}}Yt("PlacedSymbolArray",Dr);class $n extends y{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}$n.prototype.size=64;class Hn extends Pt{get(l){return new $n(this,l)}}Yt("SymbolInstanceArray",Hn);class Rr extends Vt{getoffsetX(l){return this.float32[1*l+0]}}Yt("GlyphOffsetArray",Rr);class wi extends Y{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}Yt("SymbolLineVertexArray",wi);class wo extends y{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}wo.prototype.size=12;class Br extends Jt{get(l){return new wo(this,l)}}Yt("TextAnchorOffsetArray",Br);class $i extends y{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}$i.prototype.size=8;class Li extends Ot{get(l){return new $i(this,l)}}Yt("FeatureIndexArray",Li);class xi extends j{}class Pi extends j{}class $o extends j{}class xa extends ie{}class lu extends _e{}class Aa extends Ae{}class ro extends Se{}class uu extends ze{}class qc extends Re{}class io extends Be{}class oo extends Ie{}class _s extends We{}class xo extends nt{}class mi extends Bt{}const Ai=E([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ji}=Ai;class Jn{constructor(l=[]){this.segments=l}prepareSegment(l,f,p,b){let A=this.segments[this.segments.length-1];return l>Jn.MAX_VERTEX_ARRAY_LENGTH&&J(`Max vertices per segment is ${Jn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!A||A.vertexLength+l>Jn.MAX_VERTEX_ARRAY_LENGTH||A.sortKey!==b)&&(A={vertexOffset:f.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},b!==void 0&&(A.sortKey=b),this.segments.push(A)),A}get(){return this.segments}destroy(){for(const l of this.segments)for(const f in l.vaos)l.vaos[f].destroy()}static simpleSegment(l,f,p,b){return new Jn([{vertexOffset:l,primitiveOffset:f,vertexLength:p,primitiveLength:b,vaos:{},sortKey:0}])}}function Us(c,l){return 256*(c=ee(Math.floor(c),0,255))+ee(Math.floor(l),0,255)}Jn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Yt("SegmentVector",Jn);const ka=E([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Sa={exports:{}},Vh={exports:{}};Vh.exports=function(c,l){var f,p,b,A,k,M,R,V;for(p=c.length-(f=3&c.length),b=l,k=3432918353,M=461845907,V=0;V<p;)R=255&c.charCodeAt(V)|(255&c.charCodeAt(++V))<<8|(255&c.charCodeAt(++V))<<16|(255&c.charCodeAt(++V))<<24,++V,b=27492+(65535&(A=5*(65535&(b=(b^=R=(65535&(R=(R=(65535&R)*k+(((R>>>16)*k&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295)<<13|b>>>19))+((5*(b>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(R=0,f){case 3:R^=(255&c.charCodeAt(V+2))<<16;case 2:R^=(255&c.charCodeAt(V+1))<<8;case 1:b^=R=(65535&(R=(R=(65535&(R^=255&c.charCodeAt(V)))*k+(((R>>>16)*k&65535)<<16)&4294967295)<<15|R>>>17))*M+(((R>>>16)*M&65535)<<16)&4294967295}return b^=c.length,b=2246822507*(65535&(b^=b>>>16))+((2246822507*(b>>>16)&65535)<<16)&4294967295,b=3266489909*(65535&(b^=b>>>13))+((3266489909*(b>>>16)&65535)<<16)&4294967295,(b^=b>>>16)>>>0};var Rp=Vh.exports,qh={exports:{}};qh.exports=function(c,l){for(var f,p=c.length,b=l^p,A=0;p>=4;)f=1540483477*(65535&(f=255&c.charCodeAt(A)|(255&c.charCodeAt(++A))<<8|(255&c.charCodeAt(++A))<<16|(255&c.charCodeAt(++A))<<24))+((1540483477*(f>>>16)&65535)<<16),b=1540483477*(65535&b)+((1540483477*(b>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),p-=4,++A;switch(p){case 3:b^=(255&c.charCodeAt(A+2))<<16;case 2:b^=(255&c.charCodeAt(A+1))<<8;case 1:b=1540483477*(65535&(b^=255&c.charCodeAt(A)))+((1540483477*(b>>>16)&65535)<<16)}return b=1540483477*(65535&(b^=b>>>13))+((1540483477*(b>>>16)&65535)<<16),(b^=b>>>15)>>>0};var ys=Rp,Gh=qh.exports;Sa.exports=ys,Sa.exports.murmur3=ys,Sa.exports.murmur2=Gh;var cu=d(Sa.exports);class cl{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,f,p,b){this.ids.push(fu(l)),this.positions.push(f,p,b)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const f=fu(l);let p=0,b=this.ids.length-1;for(;p<b;){const k=p+b>>1;this.ids[k]>=f?b=k:p=k+1}const A=[];for(;this.ids[p]===f;)A.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return A}static serialize(l,f){const p=new Float64Array(l.ids),b=new Uint32Array(l.positions);return hu(p,b,0,p.length-1),f&&f.push(p.buffer,b.buffer),{ids:p,positions:b}}static deserialize(l){const f=new cl;return f.ids=l.ids,f.positions=l.positions,f.indexed=!0,f}}function fu(c){const l=+c;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:cu(String(c))}function hu(c,l,f,p){for(;f<p;){const b=c[f+p>>1];let A=f-1,k=p+1;for(;;){do A++;while(c[A]<b);do k--;while(c[k]>b);if(A>=k)break;Ta(c,A,k),Ta(l,3*A,3*k),Ta(l,3*A+1,3*k+1),Ta(l,3*A+2,3*k+2)}k-f<p-k?(hu(c,l,f,k),f=k+1):(hu(c,l,k+1,p),p=k)}}function Ta(c,l,f){const p=c[l];c[l]=c[f],c[f]=p}Yt("FeaturePositionMap",cl);class fl{constructor(l,f){this.gl=l.gl,this.location=f}}class Zh extends fl{constructor(l,f){super(l,f),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class c_ extends fl{constructor(l,f){super(l,f),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class f_ extends fl{constructor(l,f){super(l,f),this.current=gn.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const ox=new Float32Array(16);function Bp(c){return[Us(255*c.r,255*c.g),Us(255*c.b,255*c.a)]}class Gc{constructor(l,f,p){this.value=l,this.uniformNames=f.map(b=>`u_${b}`),this.type=p}setUniform(l,f,p){l.set(p.constantOr(this.value))}getBinding(l,f,p){return this.type==="color"?new f_(l,f):new Zh(l,f)}}class du{constructor(l,f){this.uniformNames=f.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,f){this.pixelRatioFrom=f.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=f.tlbr,this.patternTo=l.tlbr}setUniform(l,f,p,b){const A=b==="u_pattern_to"?this.patternTo:b==="u_pattern_from"?this.patternFrom:b==="u_pixel_ratio_to"?this.pixelRatioTo:b==="u_pixel_ratio_from"?this.pixelRatioFrom:null;A&&l.set(A)}getBinding(l,f,p){return p.substr(0,9)==="u_pattern"?new c_(l,f):new Zh(l,f)}}class Vs{constructor(l,f,p,b){this.expression=l,this.type=p,this.maxValue=0,this.paintVertexAttributes=f.map(A=>({name:`a_${A}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new b}populatePaintArray(l,f,p,b,A){const k=this.paintVertexArray.length,M=this.expression.evaluate(new zr(0),f,{},b,[],A);this.paintVertexArray.resize(l),this._setPaintValue(k,l,M)}updatePaintArray(l,f,p,b){const A=this.expression.evaluate({zoom:0},p,b);this._setPaintValue(l,f,A)}_setPaintValue(l,f,p){if(this.type==="color"){const b=Bp(p);for(let A=l;A<f;A++)this.paintVertexArray.emplace(A,b[0],b[1])}else{for(let b=l;b<f;b++)this.paintVertexArray.emplace(b,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ns{constructor(l,f,p,b,A,k){this.expression=l,this.uniformNames=f.map(M=>`u_${M}_t`),this.type=p,this.useIntegerZoom=b,this.zoom=A,this.maxValue=0,this.paintVertexAttributes=f.map(M=>({name:`a_${M}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new k}populatePaintArray(l,f,p,b,A){const k=this.expression.evaluate(new zr(this.zoom),f,{},b,[],A),M=this.expression.evaluate(new zr(this.zoom+1),f,{},b,[],A),R=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(R,l,k,M)}updatePaintArray(l,f,p,b){const A=this.expression.evaluate({zoom:this.zoom},p,b),k=this.expression.evaluate({zoom:this.zoom+1},p,b);this._setPaintValue(l,f,A,k)}_setPaintValue(l,f,p,b){if(this.type==="color"){const A=Bp(p),k=Bp(b);for(let M=l;M<f;M++)this.paintVertexArray.emplace(M,A[0],A[1],k[0],k[1])}else{for(let A=l;A<f;A++)this.paintVertexArray.emplace(A,p,b);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(b))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,f){const p=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,b=ee(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);l.set(b)}getBinding(l,f,p){return new Zh(l,f)}}class Ca{constructor(l,f,p,b,A,k){this.expression=l,this.type=f,this.useIntegerZoom=p,this.zoom=b,this.layerId=k,this.zoomInPaintVertexArray=new A,this.zoomOutPaintVertexArray=new A}populatePaintArray(l,f,p){const b=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(b,l,f.patterns&&f.patterns[this.layerId],p)}updatePaintArray(l,f,p,b,A){this._setPaintValues(l,f,p.patterns&&p.patterns[this.layerId],A)}_setPaintValues(l,f,p,b){if(!b||!p)return;const{min:A,mid:k,max:M}=p,R=b[A],V=b[k],K=b[M];if(R&&V&&K)for(let te=l;te<f;te++)this.zoomInPaintVertexArray.emplace(te,V.tl[0],V.tl[1],V.br[0],V.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],V.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(te,V.tl[0],V.tl[1],V.br[0],V.br[1],K.tl[0],K.tl[1],K.br[0],K.br[1],V.pixelRatio,K.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,ka.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,ka.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class h_{constructor(l,f,p){this.binders={},this._buffers=[];const b=[];for(const A in l.paint._values){if(!p(A))continue;const k=l.paint.get(A);if(!(k instanceof No&&ca(k.property.specification)))continue;const M=sx(A,l.type),R=k.value,V=k.property.specification.type,K=k.property.useIntegerZoom,te=k.property.specification["property-type"],se=te==="cross-faded"||te==="cross-faded-data-driven";if(R.kind==="constant")this.binders[A]=se?new du(R.value,M):new Gc(R.value,M,V),b.push(`/u_${A}`);else if(R.kind==="source"||se){const me=d_(A,V,"source");this.binders[A]=se?new Ca(R,V,K,f,me,l.id):new Vs(R,M,V,me),b.push(`/a_${A}`)}else{const me=d_(A,V,"composite");this.binders[A]=new ns(R,M,V,K,f,me),b.push(`/z_${A}`)}}this.cacheKey=b.sort().join("")}getMaxValue(l){const f=this.binders[l];return f instanceof Vs||f instanceof ns?f.maxValue:0}populatePaintArrays(l,f,p,b,A){for(const k in this.binders){const M=this.binders[k];(M instanceof Vs||M instanceof ns||M instanceof Ca)&&M.populatePaintArray(l,f,p,b,A)}}setConstantPatternPositions(l,f){for(const p in this.binders){const b=this.binders[p];b instanceof du&&b.setConstantPatternPositions(l,f)}}updatePaintArrays(l,f,p,b,A){let k=!1;for(const M in l){const R=f.getPositions(M);for(const V of R){const K=p.feature(V.index);for(const te in this.binders){const se=this.binders[te];if((se instanceof Vs||se instanceof ns||se instanceof Ca)&&se.expression.isStateDependent===!0){const me=b.paint.get(te);se.expression=me.value,se.updatePaintArray(V.start,V.end,K,l[M],A),k=!0}}}}return k}defines(){const l=[];for(const f in this.binders){const p=this.binders[f];(p instanceof Gc||p instanceof du)&&l.push(...p.uniformNames.map(b=>`#define HAS_UNIFORM_${b}`))}return l}getBinderAttributes(){const l=[];for(const f in this.binders){const p=this.binders[f];if(p instanceof Vs||p instanceof ns)for(let b=0;b<p.paintVertexAttributes.length;b++)l.push(p.paintVertexAttributes[b].name);else if(p instanceof Ca)for(let b=0;b<ka.members.length;b++)l.push(ka.members[b].name)}return l}getBinderUniforms(){const l=[];for(const f in this.binders){const p=this.binders[f];if(p instanceof Gc||p instanceof du||p instanceof ns)for(const b of p.uniformNames)l.push(b)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,f){const p=[];for(const b in this.binders){const A=this.binders[b];if(A instanceof Gc||A instanceof du||A instanceof ns){for(const k of A.uniformNames)if(f[k]){const M=A.getBinding(l,f[k],k);p.push({name:k,property:b,binding:M})}}}return p}setUniforms(l,f,p,b){for(const{name:A,property:k,binding:M}of f)this.binders[k].setUniform(M,b,p.get(k),A)}updatePaintBuffers(l){this._buffers=[];for(const f in this.binders){const p=this.binders[f];if(l&&p instanceof Ca){const b=l.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;b&&this._buffers.push(b)}else(p instanceof Vs||p instanceof ns)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(l){for(const f in this.binders){const p=this.binders[f];(p instanceof Vs||p instanceof ns||p instanceof Ca)&&p.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const f=this.binders[l];(f instanceof Vs||f instanceof ns||f instanceof Ca)&&f.destroy()}}}class hl{constructor(l,f,p=()=>!0){this.programConfigurations={};for(const b of l)this.programConfigurations[b.id]=new h_(b,f,p);this.needsUpload=!1,this._featureMap=new cl,this._bufferOffset=0}populatePaintArrays(l,f,p,b,A,k){for(const M in this.programConfigurations)this.programConfigurations[M].populatePaintArrays(l,f,b,A,k);f.id!==void 0&&this._featureMap.add(f.id,p,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,f,p,b){for(const A of p)this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(l,this._featureMap,f,A,b)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const f in this.programConfigurations)this.programConfigurations[f].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function sx(c,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${l}-`,"").replace(/-/g,"_")]}function d_(c,l,f){const p={color:{source:Ae,composite:In},number:{source:Vt,composite:Ae}},b=function(A){return{"line-pattern":{source:ro,composite:ro},"fill-pattern":{source:ro,composite:ro},"fill-extrusion-pattern":{source:ro,composite:ro}}[A]}(c);return b&&b[f]||p[l][f]}Yt("ConstantBinder",Gc),Yt("CrossFadedConstantBinder",du),Yt("SourceExpressionBinder",Vs),Yt("CrossFadedCompositeBinder",Ca),Yt("CompositeExpressionBinder",ns),Yt("ProgramConfiguration",h_,{omit:["_buffers"]}),Yt("ProgramConfigurationSet",hl);const ti=8192,Fp=Math.pow(2,14)-1,p_=-Fp-1;function dl(c){const l=ti/c.extent,f=c.loadGeometry();for(let p=0;p<f.length;p++){const b=f[p];for(let A=0;A<b.length;A++){const k=b[A],M=Math.round(k.x*l),R=Math.round(k.y*l);k.x=ee(M,p_,Fp),k.y=ee(R,p_,Fp),(M<k.x||M>k.x+1||R<k.y||R>k.y+1)&&J("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return f}function pl(c,l){return{type:c.type,id:c.id,properties:c.properties,geometry:l?dl(c):[]}}function Hh(c,l,f,p,b){c.emplaceBack(2*l+(p+1)/2,2*f+(b+1)/2)}class Op{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Pi,this.indexArray=new xo,this.segments=new Jn,this.programConfigurations=new hl(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,p){const b=this.layers[0],A=[];let k=null,M=!1;b.type==="circle"&&(k=b.layout.get("circle-sort-key"),M=!k.isConstant());for(const{feature:R,id:V,index:K,sourceLayerIndex:te}of l){const se=this.layers[0]._featureFilter.needGeometry,me=pl(R,se);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),me,p))continue;const ye=M?k.evaluate(me,{},p):void 0,xe={id:V,properties:R.properties,type:R.type,sourceLayerIndex:te,index:K,geometry:se?me.geometry:dl(R),patterns:{},sortKey:ye};A.push(xe)}M&&A.sort((R,V)=>R.sortKey-V.sortKey);for(const R of A){const{geometry:V,index:K,sourceLayerIndex:te}=R,se=l[K].feature;this.addFeature(R,V,K,p),f.featureIndex.insert(se,V,K,te,this.index)}}update(l,f,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Ji),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,f,p,b){for(const A of f)for(const k of A){const M=k.x,R=k.y;if(M<0||M>=ti||R<0||R>=ti)continue;const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),K=V.vertexLength;Hh(this.layoutVertexArray,M,R,-1,-1),Hh(this.layoutVertexArray,M,R,1,-1),Hh(this.layoutVertexArray,M,R,1,1),Hh(this.layoutVertexArray,M,R,-1,1),this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+3,K+2),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,{},b)}}function m_(c,l){for(let f=0;f<c.length;f++)if(pu(l,c[f]))return!0;for(let f=0;f<l.length;f++)if(pu(c,l[f]))return!0;return!!Np(c,l)}function ax(c,l,f){return!!pu(c,l)||!!$p(l,c,f)}function g_(c,l){if(c.length===1)return y_(l,c[0]);for(let f=0;f<l.length;f++){const p=l[f];for(let b=0;b<p.length;b++)if(pu(c,p[b]))return!0}for(let f=0;f<c.length;f++)if(y_(l,c[f]))return!0;for(let f=0;f<l.length;f++)if(Np(c,l[f]))return!0;return!1}function lx(c,l,f){if(c.length>1){if(Np(c,l))return!0;for(let p=0;p<l.length;p++)if($p(l[p],c,f))return!0}for(let p=0;p<c.length;p++)if($p(c[p],l,f))return!0;return!1}function Np(c,l){if(c.length===0||l.length===0)return!1;for(let f=0;f<c.length-1;f++){const p=c[f],b=c[f+1];for(let A=0;A<l.length-1;A++)if(ux(p,b,l[A],l[A+1]))return!0}return!1}function ux(c,l,f,p){return be(c,f,p)!==be(l,f,p)&&be(c,l,f)!==be(c,l,p)}function $p(c,l,f){const p=f*f;if(l.length===1)return c.distSqr(l[0])<p;for(let b=1;b<l.length;b++)if(__(c,l[b-1],l[b])<p)return!0;return!1}function __(c,l,f){const p=l.distSqr(f);if(p===0)return c.distSqr(l);const b=((c.x-l.x)*(f.x-l.x)+(c.y-l.y)*(f.y-l.y))/p;return c.distSqr(b<0?l:b>1?f:f.sub(l)._mult(b)._add(l))}function y_(c,l){let f,p,b,A=!1;for(let k=0;k<c.length;k++){f=c[k];for(let M=0,R=f.length-1;M<f.length;R=M++)p=f[M],b=f[R],p.y>l.y!=b.y>l.y&&l.x<(b.x-p.x)*(l.y-p.y)/(b.y-p.y)+p.x&&(A=!A)}return A}function pu(c,l){let f=!1;for(let p=0,b=c.length-1;p<c.length;b=p++){const A=c[p],k=c[b];A.y>l.y!=k.y>l.y&&l.x<(k.x-A.x)*(l.y-A.y)/(k.y-A.y)+A.x&&(f=!f)}return f}function cx(c,l,f){const p=f[0],b=f[2];if(c.x<p.x&&l.x<p.x||c.x>b.x&&l.x>b.x||c.y<p.y&&l.y<p.y||c.y>b.y&&l.y>b.y)return!1;const A=be(c,l,f[0]);return A!==be(c,l,f[1])||A!==be(c,l,f[2])||A!==be(c,l,f[3])}function Zc(c,l,f){const p=l.paint.get(c).value;return p.kind==="constant"?p.value:f.programConfigurations.get(l.id).getMaxValue(c)}function Wh(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Xh(c,l,f,p,b){if(!l[0]&&!l[1])return c;const A=v.convert(l)._mult(b);f==="viewport"&&A._rotate(-p);const k=[];for(let M=0;M<c.length;M++)k.push(c[M].sub(A));return k}let b_,v_;Yt("CircleBucket",Op,{omit:["layers"]});var fx={get paint(){return v_=v_||new x({"circle-radius":new An(Ge.paint_circle["circle-radius"]),"circle-color":new An(Ge.paint_circle["circle-color"]),"circle-blur":new An(Ge.paint_circle["circle-blur"]),"circle-opacity":new An(Ge.paint_circle["circle-opacity"]),"circle-translate":new an(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new an(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new an(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new an(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new An(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new An(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new An(Ge.paint_circle["circle-stroke-opacity"])})},get layout(){return b_=b_||new x({"circle-sort-key":new An(Ge.layout_circle["circle-sort-key"])})}},ji=1e-6,mu=typeof Float32Array<"u"?Float32Array:Array;function jp(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function w_(c,l,f){var p=l[0],b=l[1],A=l[2],k=l[3],M=l[4],R=l[5],V=l[6],K=l[7],te=l[8],se=l[9],me=l[10],ye=l[11],xe=l[12],Le=l[13],De=l[14],Qe=l[15],je=f[0],Je=f[1],lt=f[2],Et=f[3];return c[0]=je*p+Je*M+lt*te+Et*xe,c[1]=je*b+Je*R+lt*se+Et*Le,c[2]=je*A+Je*V+lt*me+Et*De,c[3]=je*k+Je*K+lt*ye+Et*Qe,c[4]=(je=f[4])*p+(Je=f[5])*M+(lt=f[6])*te+(Et=f[7])*xe,c[5]=je*b+Je*R+lt*se+Et*Le,c[6]=je*A+Je*V+lt*me+Et*De,c[7]=je*k+Je*K+lt*ye+Et*Qe,c[8]=(je=f[8])*p+(Je=f[9])*M+(lt=f[10])*te+(Et=f[11])*xe,c[9]=je*b+Je*R+lt*se+Et*Le,c[10]=je*A+Je*V+lt*me+Et*De,c[11]=je*k+Je*K+lt*ye+Et*Qe,c[12]=(je=f[12])*p+(Je=f[13])*M+(lt=f[14])*te+(Et=f[15])*xe,c[13]=je*b+Je*R+lt*se+Et*Le,c[14]=je*A+Je*V+lt*me+Et*De,c[15]=je*k+Je*K+lt*ye+Et*Qe,c}Math.hypot||(Math.hypot=function(){for(var c=0,l=arguments.length;l--;)c+=arguments[l]*arguments[l];return Math.sqrt(c)});var Hc,hx=w_;function Jh(c,l,f){var p=l[0],b=l[1],A=l[2],k=l[3];return c[0]=f[0]*p+f[4]*b+f[8]*A+f[12]*k,c[1]=f[1]*p+f[5]*b+f[9]*A+f[13]*k,c[2]=f[2]*p+f[6]*b+f[10]*A+f[14]*k,c[3]=f[3]*p+f[7]*b+f[11]*A+f[15]*k,c}Hc=new mu(4),mu!=Float32Array&&(Hc[0]=0,Hc[1]=0,Hc[2]=0,Hc[3]=0);class dx extends h{constructor(l){super(l,fx)}createBucket(l){return new Op(l)}queryRadius(l){const f=l;return Zc("circle-radius",this,f)+Zc("circle-stroke-width",this,f)+Wh(this.paint.get("circle-translate"))}queryIntersectsFeature(l,f,p,b,A,k,M,R){const V=Xh(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),k.angle,M),K=this.paint.get("circle-radius").evaluate(f,p)+this.paint.get("circle-stroke-width").evaluate(f,p),te=this.paint.get("circle-pitch-alignment")==="map",se=te?V:function(ye,xe){return ye.map(Le=>x_(Le,xe))}(V,R),me=te?K*M:K;for(const ye of b)for(const xe of ye){const Le=te?xe:x_(xe,R);let De=me;const Qe=Jh([],[xe.x,xe.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?De*=Qe[3]/k.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(De*=k.cameraToCenterDistance/Qe[3]),ax(se,Le,De))return!0}return!1}}function x_(c,l){const f=Jh([],[c.x,c.y,0,1],l);return new v(f[0]/f[3],f[1]/f[3])}class A_ extends Op{}let k_;Yt("HeatmapBucket",A_,{omit:["layers"]});var px={get paint(){return k_=k_||new x({"heatmap-radius":new An(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new An(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new an(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vc(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new an(Ge.paint_heatmap["heatmap-opacity"])})}};function Up(c,{width:l,height:f},p,b){if(b){if(b instanceof Uint8ClampedArray)b=new Uint8Array(b.buffer);else if(b.length!==l*f*p)throw new RangeError(`mismatched image size. expected: ${b.length} but got: ${l*f*p}`)}else b=new Uint8Array(l*f*p);return c.width=l,c.height=f,c.data=b,c}function S_(c,{width:l,height:f},p){if(l===c.width&&f===c.height)return;const b=Up({},{width:l,height:f},p);Vp(c,b,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,l),height:Math.min(c.height,f)},p),c.width=l,c.height=f,c.data=b.data}function Vp(c,l,f,p,b,A){if(b.width===0||b.height===0)return l;if(b.width>c.width||b.height>c.height||f.x>c.width-b.width||f.y>c.height-b.height)throw new RangeError("out of range source coordinates for image copy");if(b.width>l.width||b.height>l.height||p.x>l.width-b.width||p.y>l.height-b.height)throw new RangeError("out of range destination coordinates for image copy");const k=c.data,M=l.data;if(k===M)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<b.height;R++){const V=((f.y+R)*c.width+f.x)*A,K=((p.y+R)*l.width+p.x)*A;for(let te=0;te<b.width*A;te++)M[K+te]=k[V+te]}return l}class Wc{constructor(l,f){Up(this,l,1,f)}resize(l){S_(this,l,1)}clone(){return new Wc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,f,p,b,A){Vp(l,f,p,b,A,1)}}class Ao{constructor(l,f){Up(this,l,4,f)}resize(l){S_(this,l,4)}replace(l,f){f?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new Ao({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,f,p,b,A){Vp(l,f,p,b,A,4)}}function T_(c){const l={},f=c.resolution||256,p=c.clips?c.clips.length:1,b=c.image||new Ao({width:f,height:p});if(Math.log(f)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${f}`);const A=(k,M,R)=>{l[c.evaluationKey]=R;const V=c.expression.evaluate(l);b.data[k+M+0]=Math.floor(255*V.r/V.a),b.data[k+M+1]=Math.floor(255*V.g/V.a),b.data[k+M+2]=Math.floor(255*V.b/V.a),b.data[k+M+3]=Math.floor(255*V.a)};if(c.clips)for(let k=0,M=0;k<p;++k,M+=4*f)for(let R=0,V=0;R<f;R++,V+=4){const K=R/(f-1),{start:te,end:se}=c.clips[k];A(M,V,te*(1-K)+se*K)}else for(let k=0,M=0;k<f;k++,M+=4)A(0,M,k/(f-1));return b}Yt("AlphaImage",Wc),Yt("RGBAImage",Ao);const qp="big-fb";class mx extends h{createBucket(l){return new A_(l)}constructor(l){super(l,px),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=T_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(qp)&&this.heatmapFbos.delete(qp)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let C_;var gx={get paint(){return C_=C_||new x({"hillshade-illumination-direction":new an(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new an(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new an(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new an(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new an(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new an(Ge.paint_hillshade["hillshade-accent-color"])})}};class _x extends h{constructor(l){super(l,gx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const yx=E([{name:"a_pos",components:2,type:"Int16"}],4),{members:bx}=yx;function M_(c,l,f=2){const p=l&&l.length,b=p?l[0]*f:c.length;let A=E_(c,0,b,f,!0);const k=[];if(!A||A.next===A.prev)return k;let M,R,V;if(p&&(A=function(K,te,se,me){const ye=[];for(let xe=0,Le=te.length;xe<Le;xe++){const De=E_(K,te[xe]*me,xe<Le-1?te[xe+1]*me:K.length,me,!1);De===De.next&&(De.steiner=!0),ye.push(Cx(De))}ye.sort(kx);for(let xe=0;xe<ye.length;xe++)se=Sx(ye[xe],se);return se}(c,l,A,f)),c.length>80*f){M=1/0,R=1/0;let K=-1/0,te=-1/0;for(let se=f;se<b;se+=f){const me=c[se],ye=c[se+1];me<M&&(M=me),ye<R&&(R=ye),me>K&&(K=me),ye>te&&(te=ye)}V=Math.max(K-M,te-R),V=V!==0?32767/V:0}return Xc(A,k,f,M,R,V,0),k}function E_(c,l,f,p,b){let A;if(b===function(k,M,R,V){let K=0;for(let te=M,se=R-V;te<R;te+=V)K+=(k[se]-k[te])*(k[te+1]+k[se+1]),se=te;return K}(c,l,f,p)>0)for(let k=l;k<f;k+=p)A=P_(k/p|0,c[k],c[k+1],A);else for(let k=f-p;k>=l;k-=p)A=P_(k/p|0,c[k],c[k+1],A);return A&&Kh(A,A.next)&&(Kc(A),A=A.next),A}function ml(c,l){if(!c)return c;l||(l=c);let f,p=c;do if(f=!1,p.steiner||!Kh(p,p.next)&&Yr(p.prev,p,p.next)!==0)p=p.next;else{if(Kc(p),p=l=p.prev,p===p.next)break;f=!0}while(f||p!==l);return l}function Xc(c,l,f,p,b,A,k){if(!c)return;!k&&A&&function(R,V,K,te){let se=R;do se.z===0&&(se.z=Gp(se.x,se.y,V,K,te)),se.prevZ=se.prev,se.nextZ=se.next,se=se.next;while(se!==R);se.prevZ.nextZ=null,se.prevZ=null,function(me){let ye,xe=1;do{let Le,De=me;me=null;let Qe=null;for(ye=0;De;){ye++;let je=De,Je=0;for(let Et=0;Et<xe&&(Je++,je=je.nextZ,je);Et++);let lt=xe;for(;Je>0||lt>0&&je;)Je!==0&&(lt===0||!je||De.z<=je.z)?(Le=De,De=De.nextZ,Je--):(Le=je,je=je.nextZ,lt--),Qe?Qe.nextZ=Le:me=Le,Le.prevZ=Qe,Qe=Le;De=je}Qe.nextZ=null,xe*=2}while(ye>1)}(se)}(c,p,b,A);let M=c;for(;c.prev!==c.next;){const R=c.prev,V=c.next;if(A?wx(c,p,b,A):vx(c))l.push(R.i,c.i,V.i),Kc(c),c=V.next,M=V.next;else if((c=V)===M){k?k===1?Xc(c=xx(ml(c),l),l,f,p,b,A,2):k===2&&Ax(c,l,f,p,b,A):Xc(ml(c),l,f,p,b,A,1);break}}}function vx(c){const l=c.prev,f=c,p=c.next;if(Yr(l,f,p)>=0)return!1;const b=l.x,A=f.x,k=p.x,M=l.y,R=f.y,V=p.y,K=b<A?b<k?b:k:A<k?A:k,te=M<R?M<V?M:V:R<V?R:V,se=b>A?b>k?b:k:A>k?A:k,me=M>R?M>V?M:V:R>V?R:V;let ye=p.next;for(;ye!==l;){if(ye.x>=K&&ye.x<=se&&ye.y>=te&&ye.y<=me&&gu(b,M,A,R,k,V,ye.x,ye.y)&&Yr(ye.prev,ye,ye.next)>=0)return!1;ye=ye.next}return!0}function wx(c,l,f,p){const b=c.prev,A=c,k=c.next;if(Yr(b,A,k)>=0)return!1;const M=b.x,R=A.x,V=k.x,K=b.y,te=A.y,se=k.y,me=M<R?M<V?M:V:R<V?R:V,ye=K<te?K<se?K:se:te<se?te:se,xe=M>R?M>V?M:V:R>V?R:V,Le=K>te?K>se?K:se:te>se?te:se,De=Gp(me,ye,l,f,p),Qe=Gp(xe,Le,l,f,p);let je=c.prevZ,Je=c.nextZ;for(;je&&je.z>=De&&Je&&Je.z<=Qe;){if(je.x>=me&&je.x<=xe&&je.y>=ye&&je.y<=Le&&je!==b&&je!==k&&gu(M,K,R,te,V,se,je.x,je.y)&&Yr(je.prev,je,je.next)>=0||(je=je.prevZ,Je.x>=me&&Je.x<=xe&&Je.y>=ye&&Je.y<=Le&&Je!==b&&Je!==k&&gu(M,K,R,te,V,se,Je.x,Je.y)&&Yr(Je.prev,Je,Je.next)>=0))return!1;Je=Je.nextZ}for(;je&&je.z>=De;){if(je.x>=me&&je.x<=xe&&je.y>=ye&&je.y<=Le&&je!==b&&je!==k&&gu(M,K,R,te,V,se,je.x,je.y)&&Yr(je.prev,je,je.next)>=0)return!1;je=je.prevZ}for(;Je&&Je.z<=Qe;){if(Je.x>=me&&Je.x<=xe&&Je.y>=ye&&Je.y<=Le&&Je!==b&&Je!==k&&gu(M,K,R,te,V,se,Je.x,Je.y)&&Yr(Je.prev,Je,Je.next)>=0)return!1;Je=Je.nextZ}return!0}function xx(c,l){let f=c;do{const p=f.prev,b=f.next.next;!Kh(p,b)&&I_(p,f,f.next,b)&&Jc(p,b)&&Jc(b,p)&&(l.push(p.i,f.i,b.i),Kc(f),Kc(f.next),f=c=b),f=f.next}while(f!==c);return ml(f)}function Ax(c,l,f,p,b,A){let k=c;do{let M=k.next.next;for(;M!==k.prev;){if(k.i!==M.i&&Mx(k,M)){let R=L_(k,M);return k=ml(k,k.next),R=ml(R,R.next),Xc(k,l,f,p,b,A,0),void Xc(R,l,f,p,b,A,0)}M=M.next}k=k.next}while(k!==c)}function kx(c,l){return c.x-l.x}function Sx(c,l){const f=function(b,A){let k=A;const M=b.x,R=b.y;let V,K=-1/0;do{if(R<=k.y&&R>=k.next.y&&k.next.y!==k.y){const xe=k.x+(R-k.y)*(k.next.x-k.x)/(k.next.y-k.y);if(xe<=M&&xe>K&&(K=xe,V=k.x<k.next.x?k:k.next,xe===M))return V}k=k.next}while(k!==A);if(!V)return null;const te=V,se=V.x,me=V.y;let ye=1/0;k=V;do{if(M>=k.x&&k.x>=se&&M!==k.x&&gu(R<me?M:K,R,se,me,R<me?K:M,R,k.x,k.y)){const xe=Math.abs(R-k.y)/(M-k.x);Jc(k,b)&&(xe<ye||xe===ye&&(k.x>V.x||k.x===V.x&&Tx(V,k)))&&(V=k,ye=xe)}k=k.next}while(k!==te);return V}(c,l);if(!f)return l;const p=L_(f,c);return ml(p,p.next),ml(f,f.next)}function Tx(c,l){return Yr(c.prev,c,l.prev)<0&&Yr(l.next,c,c.next)<0}function Gp(c,l,f,p,b){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-f)*b|0)|c<<8))|c<<4))|c<<2))|c<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-p)*b|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function Cx(c){let l=c,f=c;do(l.x<f.x||l.x===f.x&&l.y<f.y)&&(f=l),l=l.next;while(l!==c);return f}function gu(c,l,f,p,b,A,k,M){return(b-k)*(l-M)>=(c-k)*(A-M)&&(c-k)*(p-M)>=(f-k)*(l-M)&&(f-k)*(A-M)>=(b-k)*(p-M)}function Mx(c,l){return c.next.i!==l.i&&c.prev.i!==l.i&&!function(f,p){let b=f;do{if(b.i!==f.i&&b.next.i!==f.i&&b.i!==p.i&&b.next.i!==p.i&&I_(b,b.next,f,p))return!0;b=b.next}while(b!==f);return!1}(c,l)&&(Jc(c,l)&&Jc(l,c)&&function(f,p){let b=f,A=!1;const k=(f.x+p.x)/2,M=(f.y+p.y)/2;do b.y>M!=b.next.y>M&&b.next.y!==b.y&&k<(b.next.x-b.x)*(M-b.y)/(b.next.y-b.y)+b.x&&(A=!A),b=b.next;while(b!==f);return A}(c,l)&&(Yr(c.prev,c,l.prev)||Yr(c,l.prev,l))||Kh(c,l)&&Yr(c.prev,c,c.next)>0&&Yr(l.prev,l,l.next)>0)}function Yr(c,l,f){return(l.y-c.y)*(f.x-l.x)-(l.x-c.x)*(f.y-l.y)}function Kh(c,l){return c.x===l.x&&c.y===l.y}function I_(c,l,f,p){const b=Qh(Yr(c,l,f)),A=Qh(Yr(c,l,p)),k=Qh(Yr(f,p,c)),M=Qh(Yr(f,p,l));return b!==A&&k!==M||!(b!==0||!Yh(c,f,l))||!(A!==0||!Yh(c,p,l))||!(k!==0||!Yh(f,c,p))||!(M!==0||!Yh(f,l,p))}function Yh(c,l,f){return l.x<=Math.max(c.x,f.x)&&l.x>=Math.min(c.x,f.x)&&l.y<=Math.max(c.y,f.y)&&l.y>=Math.min(c.y,f.y)}function Qh(c){return c>0?1:c<0?-1:0}function Jc(c,l){return Yr(c.prev,c,c.next)<0?Yr(c,l,c.next)>=0&&Yr(c,c.prev,l)>=0:Yr(c,l,c.prev)<0||Yr(c,c.next,l)<0}function L_(c,l){const f=Zp(c.i,c.x,c.y),p=Zp(l.i,l.x,l.y),b=c.next,A=l.prev;return c.next=l,l.prev=c,f.next=b,b.prev=f,p.next=f,f.prev=p,A.next=p,p.prev=A,p}function P_(c,l,f,p){const b=Zp(c,l,f);return p?(b.next=p.next,b.prev=p,p.next.prev=b,p.next=b):(b.prev=b,b.next=b),b}function Kc(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Zp(c,l,f){return{i:c,x:l,y:f,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Hp(c,l,f){const p=f.patternDependencies;let b=!1;for(const A of l){const k=A.paint.get(`${c}-pattern`);k.isConstant()||(b=!0);const M=k.constantOr(null);M&&(b=!0,p[M.to]=!0,p[M.from]=!0)}return b}function Wp(c,l,f,p,b){const A=b.patternDependencies;for(const k of l){const M=k.paint.get(`${c}-pattern`).value;if(M.kind!=="constant"){let R=M.evaluate({zoom:p-1},f,{},b.availableImages),V=M.evaluate({zoom:p},f,{},b.availableImages),K=M.evaluate({zoom:p+1},f,{},b.availableImages);R=R&&R.name?R.name:R,V=V&&V.name?V.name:V,K=K&&K.name?K.name:K,A[R]=!0,A[V]=!0,A[K]=!0,f.patterns[k.id]={min:R,mid:V,max:K}}}return f}class Xp{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $o,this.indexArray=new xo,this.indexArray2=new mi,this.programConfigurations=new hl(l.layers,l.zoom),this.segments=new Jn,this.segments2=new Jn,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,p){this.hasPattern=Hp("fill",this.layers,f);const b=this.layers[0].layout.get("fill-sort-key"),A=!b.isConstant(),k=[];for(const{feature:M,id:R,index:V,sourceLayerIndex:K}of l){const te=this.layers[0]._featureFilter.needGeometry,se=pl(M,te);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),se,p))continue;const me=A?b.evaluate(se,{},p,f.availableImages):void 0,ye={id:R,properties:M.properties,type:M.type,sourceLayerIndex:K,index:V,geometry:te?se.geometry:dl(M),patterns:{},sortKey:me};k.push(ye)}A&&k.sort((M,R)=>M.sortKey-R.sortKey);for(const M of k){const{geometry:R,index:V,sourceLayerIndex:K}=M;if(this.hasPattern){const te=Wp("fill",this.layers,M,this.zoom,f);this.patternFeatures.push(te)}else this.addFeature(M,R,V,p,{});f.featureIndex.insert(l[V].feature,R,V,K,this.index)}}update(l,f,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,p)}addFeatures(l,f,p){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,bx),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,f,p,b,A){for(const k of $l(f,500)){let M=0;for(const me of k)M+=me.length;const R=this.segments.prepareSegment(M,this.layoutVertexArray,this.indexArray),V=R.vertexLength,K=[],te=[];for(const me of k){if(me.length===0)continue;me!==k[0]&&te.push(K.length/2);const ye=this.segments2.prepareSegment(me.length,this.layoutVertexArray,this.indexArray2),xe=ye.vertexLength;this.layoutVertexArray.emplaceBack(me[0].x,me[0].y),this.indexArray2.emplaceBack(xe+me.length-1,xe),K.push(me[0].x),K.push(me[0].y);for(let Le=1;Le<me.length;Le++)this.layoutVertexArray.emplaceBack(me[Le].x,me[Le].y),this.indexArray2.emplaceBack(xe+Le-1,xe+Le),K.push(me[Le].x),K.push(me[Le].y);ye.vertexLength+=me.length,ye.primitiveLength+=me.length}const se=M_(K,te);for(let me=0;me<se.length;me+=3)this.indexArray.emplaceBack(V+se[me],V+se[me+1],V+se[me+2]);R.vertexLength+=M,R.primitiveLength+=se.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,A,b)}}let z_,D_;Yt("FillBucket",Xp,{omit:["layers","patternFeatures"]});var Ex={get paint(){return D_=D_||new x({"fill-antialias":new an(Ge.paint_fill["fill-antialias"]),"fill-opacity":new An(Ge.paint_fill["fill-opacity"]),"fill-color":new An(Ge.paint_fill["fill-color"]),"fill-outline-color":new An(Ge.paint_fill["fill-outline-color"]),"fill-translate":new an(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new an(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new su(Ge.paint_fill["fill-pattern"])})},get layout(){return z_=z_||new x({"fill-sort-key":new An(Ge.layout_fill["fill-sort-key"])})}};class Ix extends h{constructor(l){super(l,Ex)}recalculate(l,f){super.recalculate(l,f);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new Xp(l)}queryRadius(){return Wh(this.paint.get("fill-translate"))}queryIntersectsFeature(l,f,p,b,A,k,M){return g_(Xh(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),k.angle,M),b)}isTileClipped(){return!0}}const Lx=E([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Px=E([{name:"a_centroid",components:2,type:"Int16"}],4),{members:zx}=Lx;var Ma={},Dx=m,R_=_u;function _u(c,l,f,p,b){this.properties={},this.extent=f,this.type=0,this._pbf=c,this._geometry=-1,this._keys=p,this._values=b,c.readFields(Rx,this,l)}function Rx(c,l,f){c==1?l.id=f.readVarint():c==2?function(p,b){for(var A=p.readVarint()+p.pos;p.pos<A;){var k=b._keys[p.readVarint()],M=b._values[p.readVarint()];b.properties[k]=M}}(f,l):c==3?l.type=f.readVarint():c==4&&(l._geometry=f.pos)}function Bx(c){for(var l,f,p=0,b=0,A=c.length,k=A-1;b<A;k=b++)p+=((f=c[k]).x-(l=c[b]).x)*(l.y+f.y);return p}_u.types=["Unknown","Point","LineString","Polygon"],_u.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var l,f=c.readVarint()+c.pos,p=1,b=0,A=0,k=0,M=[];c.pos<f;){if(b<=0){var R=c.readVarint();p=7&R,b=R>>3}if(b--,p===1||p===2)A+=c.readSVarint(),k+=c.readSVarint(),p===1&&(l&&M.push(l),l=[]),l.push(new Dx(A,k));else{if(p!==7)throw new Error("unknown command "+p);l&&l.push(l[0].clone())}}return l&&M.push(l),M},_u.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var l=c.readVarint()+c.pos,f=1,p=0,b=0,A=0,k=1/0,M=-1/0,R=1/0,V=-1/0;c.pos<l;){if(p<=0){var K=c.readVarint();f=7&K,p=K>>3}if(p--,f===1||f===2)(b+=c.readSVarint())<k&&(k=b),b>M&&(M=b),(A+=c.readSVarint())<R&&(R=A),A>V&&(V=A);else if(f!==7)throw new Error("unknown command "+f)}return[k,R,M,V]},_u.prototype.toGeoJSON=function(c,l,f){var p,b,A=this.extent*Math.pow(2,f),k=this.extent*c,M=this.extent*l,R=this.loadGeometry(),V=_u.types[this.type];function K(me){for(var ye=0;ye<me.length;ye++){var xe=me[ye];me[ye]=[360*(xe.x+k)/A-180,360/Math.PI*Math.atan(Math.exp((180-360*(xe.y+M)/A)*Math.PI/180))-90]}}switch(this.type){case 1:var te=[];for(p=0;p<R.length;p++)te[p]=R[p][0];K(R=te);break;case 2:for(p=0;p<R.length;p++)K(R[p]);break;case 3:for(R=function(me){var ye=me.length;if(ye<=1)return[me];for(var xe,Le,De=[],Qe=0;Qe<ye;Qe++){var je=Bx(me[Qe]);je!==0&&(Le===void 0&&(Le=je<0),Le===je<0?(xe&&De.push(xe),xe=[me[Qe]]):xe.push(me[Qe]))}return xe&&De.push(xe),De}(R),p=0;p<R.length;p++)for(b=0;b<R[p].length;b++)K(R[p][b])}R.length===1?R=R[0]:V="Multi"+V;var se={type:"Feature",geometry:{type:V,coordinates:R},properties:this.properties};return"id"in this&&(se.id=this.id),se};var Fx=R_,B_=F_;function F_(c,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(Ox,this,l),this.length=this._features.length}function Ox(c,l,f){c===15?l.version=f.readVarint():c===1?l.name=f.readString():c===5?l.extent=f.readVarint():c===2?l._features.push(f.pos):c===3?l._keys.push(f.readString()):c===4&&l._values.push(function(p){for(var b=null,A=p.readVarint()+p.pos;p.pos<A;){var k=p.readVarint()>>3;b=k===1?p.readString():k===2?p.readFloat():k===3?p.readDouble():k===4?p.readVarint64():k===5?p.readVarint():k===6?p.readSVarint():k===7?p.readBoolean():null}return b}(f))}F_.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var l=this._pbf.readVarint()+this._pbf.pos;return new Fx(this._pbf,l,this.extent,this._keys,this._values)};var Nx=B_;function $x(c,l,f){if(c===3){var p=new Nx(f,f.readVarint()+f.pos);p.length&&(l[p.name]=p)}}Ma.VectorTile=function(c,l){this.layers=c.readFields($x,{},l)},Ma.VectorTileFeature=R_,Ma.VectorTileLayer=B_;const jx=Ma.VectorTileFeature.types,Jp=Math.pow(2,13);function Yc(c,l,f,p,b,A,k,M){c.emplaceBack(l,f,2*Math.floor(p*Jp)+k,b*Jp*2,A*Jp*2,Math.round(M))}class Kp{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new xa,this.centroidVertexArray=new xi,this.indexArray=new xo,this.programConfigurations=new hl(l.layers,l.zoom),this.segments=new Jn,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,p){this.features=[],this.hasPattern=Hp("fill-extrusion",this.layers,f);for(const{feature:b,id:A,index:k,sourceLayerIndex:M}of l){const R=this.layers[0]._featureFilter.needGeometry,V=pl(b,R);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),V,p))continue;const K={id:A,sourceLayerIndex:M,index:k,geometry:R?V.geometry:dl(b),properties:b.properties,type:b.type,patterns:{}};this.hasPattern?this.features.push(Wp("fill-extrusion",this.layers,K,this.zoom,f)):this.addFeature(K,K.geometry,k,p,{}),f.featureIndex.insert(b,K.geometry,k,M,this.index,!0)}}addFeatures(l,f,p){for(const b of this.features){const{geometry:A}=b;this.addFeature(b,A,b.index,f,p)}}update(l,f,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,zx),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,Px.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,f,p,b,A){for(const k of $l(f,500)){const M={x:0,y:0,vertexCount:0};let R=0;for(const ye of k)R+=ye.length;let V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ye of k){if(ye.length===0||Vx(ye))continue;let xe=0;for(let Le=0;Le<ye.length;Le++){const De=ye[Le];if(Le>=1){const Qe=ye[Le-1];if(!Ux(De,Qe)){V.vertexLength+4>Jn.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const je=De.sub(Qe)._perp()._unit(),Je=Qe.dist(De);xe+Je>32768&&(xe=0),Yc(this.layoutVertexArray,De.x,De.y,je.x,je.y,0,0,xe),Yc(this.layoutVertexArray,De.x,De.y,je.x,je.y,0,1,xe),M.x+=2*De.x,M.y+=2*De.y,M.vertexCount+=2,xe+=Je,Yc(this.layoutVertexArray,Qe.x,Qe.y,je.x,je.y,0,0,xe),Yc(this.layoutVertexArray,Qe.x,Qe.y,je.x,je.y,0,1,xe),M.x+=2*Qe.x,M.y+=2*Qe.y,M.vertexCount+=2;const lt=V.vertexLength;this.indexArray.emplaceBack(lt,lt+2,lt+1),this.indexArray.emplaceBack(lt+1,lt+2,lt+3),V.vertexLength+=4,V.primitiveLength+=2}}}}if(V.vertexLength+R>Jn.MAX_VERTEX_ARRAY_LENGTH&&(V=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),jx[l.type]!=="Polygon")continue;const K=[],te=[],se=V.vertexLength;for(const ye of k)if(ye.length!==0){ye!==k[0]&&te.push(K.length/2);for(let xe=0;xe<ye.length;xe++){const Le=ye[xe];Yc(this.layoutVertexArray,Le.x,Le.y,0,0,1,1,0),M.x+=Le.x,M.y+=Le.y,M.vertexCount+=1,K.push(Le.x),K.push(Le.y)}}const me=M_(K,te);for(let ye=0;ye<me.length;ye+=3)this.indexArray.emplaceBack(se+me[ye],se+me[ye+2],se+me[ye+1]);V.primitiveLength+=me.length/3,V.vertexLength+=R;for(let ye=0;ye<M.vertexCount;ye++){const xe=Math.floor(M.x/M.vertexCount),Le=Math.floor(M.y/M.vertexCount);this.centroidVertexArray.emplaceBack(xe,Le)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,A,b)}}function Ux(c,l){return c.x===l.x&&(c.x<0||c.x>ti)||c.y===l.y&&(c.y<0||c.y>ti)}function Vx(c){return c.every(l=>l.x<0)||c.every(l=>l.x>ti)||c.every(l=>l.y<0)||c.every(l=>l.y>ti)}let O_;Yt("FillExtrusionBucket",Kp,{omit:["layers","features"]});var qx={get paint(){return O_=O_||new x({"fill-extrusion-opacity":new an(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new An(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new an(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new an(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new su(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new An(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new An(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new an(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Gx extends h{constructor(l){super(l,qx)}createBucket(l){return new Kp(l)}queryRadius(){return Wh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,f,p,b,A,k,M,R){const V=Xh(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),k.angle,M),K=this.paint.get("fill-extrusion-height").evaluate(f,p),te=this.paint.get("fill-extrusion-base").evaluate(f,p),se=function(ye,xe,Le,De){const Qe=[];for(const je of ye){const Je=[je.x,je.y,0,1];Jh(Je,Je,xe),Qe.push(new v(Je[0]/Je[3],Je[1]/Je[3]))}return Qe}(V,R),me=function(ye,xe,Le,De){const Qe=[],je=[],Je=De[8]*xe,lt=De[9]*xe,Et=De[10]*xe,Xt=De[11]*xe,xn=De[8]*Le,Gt=De[9]*Le,Ut=De[10]*Le,fn=De[11]*Le;for(const en of ye){const Kt=[],dt=[];for(const pn of en){const cn=pn.x,En=pn.y,kr=De[0]*cn+De[4]*En+De[12],xr=De[1]*cn+De[5]*En+De[13],fi=De[2]*cn+De[6]*En+De[14],jo=De[3]*cn+De[7]*En+De[15],Si=fi+Et,hi=jo+Xt,Ui=kr+xn,Vi=xr+Gt,qi=fi+Ut,Xr=jo+fn,di=new v((kr+Je)/hi,(xr+lt)/hi);di.z=Si/hi,Kt.push(di);const zi=new v(Ui/Xr,Vi/Xr);zi.z=qi/Xr,dt.push(zi)}Qe.push(Kt),je.push(dt)}return[Qe,je]}(b,te,K,R);return function(ye,xe,Le){let De=1/0;g_(Le,xe)&&(De=N_(Le,xe[0]));for(let Qe=0;Qe<xe.length;Qe++){const je=xe[Qe],Je=ye[Qe];for(let lt=0;lt<je.length-1;lt++){const Et=je[lt],Xt=[Et,je[lt+1],Je[lt+1],Je[lt],Et];m_(Le,Xt)&&(De=Math.min(De,N_(Le,Xt)))}}return De!==1/0&&De}(me[0],me[1],se)}}function Qc(c,l){return c.x*l.x+c.y*l.y}function N_(c,l){if(c.length===1){let f=0;const p=l[f++];let b;for(;!b||p.equals(b);)if(b=l[f++],!b)return 1/0;for(;f<l.length;f++){const A=l[f],k=c[0],M=b.sub(p),R=A.sub(p),V=k.sub(p),K=Qc(M,M),te=Qc(M,R),se=Qc(R,R),me=Qc(V,M),ye=Qc(V,R),xe=K*se-te*te,Le=(se*me-te*ye)/xe,De=(K*ye-te*me)/xe,Qe=p.z*(1-Le-De)+b.z*Le+A.z*De;if(isFinite(Qe))return Qe}return 1/0}{let f=1/0;for(const p of l)f=Math.min(f,p.z);return f}}const Zx=E([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Hx}=Zx,Wx=E([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Xx}=Wx,Jx=Ma.VectorTileFeature.types,Kx=Math.cos(Math.PI/180*37.5),$_=Math.pow(2,14)/.5;class Yp{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(f=>f.id),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(f=>{this.gradients[f.id]={}}),this.layoutVertexArray=new lu,this.layoutVertexArray2=new Aa,this.indexArray=new xo,this.programConfigurations=new hl(l.layers,l.zoom),this.segments=new Jn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(f=>f.isStateDependent()).map(f=>f.id)}populate(l,f,p){this.hasPattern=Hp("line",this.layers,f);const b=this.layers[0].layout.get("line-sort-key"),A=!b.isConstant(),k=[];for(const{feature:M,id:R,index:V,sourceLayerIndex:K}of l){const te=this.layers[0]._featureFilter.needGeometry,se=pl(M,te);if(!this.layers[0]._featureFilter.filter(new zr(this.zoom),se,p))continue;const me=A?b.evaluate(se,{},p):void 0,ye={id:R,properties:M.properties,type:M.type,sourceLayerIndex:K,index:V,geometry:te?se.geometry:dl(M),patterns:{},sortKey:me};k.push(ye)}A&&k.sort((M,R)=>M.sortKey-R.sortKey);for(const M of k){const{geometry:R,index:V,sourceLayerIndex:K}=M;if(this.hasPattern){const te=Wp("line",this.layers,M,this.zoom,f);this.patternFeatures.push(te)}else this.addFeature(M,R,V,p,{});f.featureIndex.insert(l[V].feature,R,V,K,this.index)}}update(l,f,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,f,this.stateDependentLayers,p)}addFeatures(l,f,p){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,f,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,Xx)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Hx),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,f,p,b,A){const k=this.layers[0].layout,M=k.get("line-join").evaluate(l,{}),R=k.get("line-cap"),V=k.get("line-miter-limit"),K=k.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const te of f)this.addLine(te,l,M,R,V,K);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,p,A,b)}addLine(l,f,p,b,A,k){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let De=0;De<l.length-1;De++)this.totalDistance+=l[De].dist(l[De+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M=Jx[f.type]==="Polygon";let R=l.length;for(;R>=2&&l[R-1].equals(l[R-2]);)R--;let V=0;for(;V<R-1&&l[V].equals(l[V+1]);)V++;if(R<(M?3:2))return;p==="bevel"&&(A=1.05);const K=this.overscaling<=16?15*ti/(512*this.overscaling):0,te=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let se,me,ye,xe,Le;this.e1=this.e2=-1,M&&(se=l[R-2],Le=l[V].sub(se)._unit()._perp());for(let De=V;De<R;De++){if(ye=De===R-1?M?l[V+1]:void 0:l[De+1],ye&&l[De].equals(ye))continue;Le&&(xe=Le),se&&(me=se),se=l[De],Le=ye?ye.sub(se)._unit()._perp():xe,xe=xe||Le;let Qe=xe.add(Le);Qe.x===0&&Qe.y===0||Qe._unit();const je=xe.x*Le.x+xe.y*Le.y,Je=Qe.x*Le.x+Qe.y*Le.y,lt=Je!==0?1/Je:1/0,Et=2*Math.sqrt(2-2*Je),Xt=Je<Kx&&me&&ye,xn=xe.x*Le.y-xe.y*Le.x>0;if(Xt&&De>V){const fn=se.dist(me);if(fn>2*K){const en=se.sub(se.sub(me)._mult(K/fn)._round());this.updateDistance(me,en),this.addCurrentVertex(en,xe,0,0,te),me=en}}const Gt=me&&ye;let Ut=Gt?p:M?"butt":b;if(Gt&&Ut==="round"&&(lt<k?Ut="miter":lt<=2&&(Ut="fakeround")),Ut==="miter"&&lt>A&&(Ut="bevel"),Ut==="bevel"&&(lt>2&&(Ut="flipbevel"),lt<A&&(Ut="miter")),me&&this.updateDistance(me,se),Ut==="miter")Qe._mult(lt),this.addCurrentVertex(se,Qe,0,0,te);else if(Ut==="flipbevel"){if(lt>100)Qe=Le.mult(-1);else{const fn=lt*xe.add(Le).mag()/xe.sub(Le).mag();Qe._perp()._mult(fn*(xn?-1:1))}this.addCurrentVertex(se,Qe,0,0,te),this.addCurrentVertex(se,Qe.mult(-1),0,0,te)}else if(Ut==="bevel"||Ut==="fakeround"){const fn=-Math.sqrt(lt*lt-1),en=xn?fn:0,Kt=xn?0:fn;if(me&&this.addCurrentVertex(se,xe,en,Kt,te),Ut==="fakeround"){const dt=Math.round(180*Et/Math.PI/20);for(let pn=1;pn<dt;pn++){let cn=pn/dt;if(cn!==.5){const kr=cn-.5;cn+=cn*kr*(cn-1)*((1.0904+je*(je*(3.55645-1.43519*je)-3.2452))*kr*kr+(.848013+je*(.215638*je-1.06021)))}const En=Le.sub(xe)._mult(cn)._add(xe)._unit()._mult(xn?-1:1);this.addHalfVertex(se,En.x,En.y,!1,xn,0,te)}}ye&&this.addCurrentVertex(se,Le,-en,-Kt,te)}else if(Ut==="butt")this.addCurrentVertex(se,Qe,0,0,te);else if(Ut==="square"){const fn=me?1:-1;this.addCurrentVertex(se,Qe,fn,fn,te)}else Ut==="round"&&(me&&(this.addCurrentVertex(se,xe,0,0,te),this.addCurrentVertex(se,xe,1,1,te,!0)),ye&&(this.addCurrentVertex(se,Le,-1,-1,te,!0),this.addCurrentVertex(se,Le,0,0,te)));if(Xt&&De<R-1){const fn=se.dist(ye);if(fn>2*K){const en=se.add(ye.sub(se)._mult(K/fn)._round());this.updateDistance(se,en),this.addCurrentVertex(en,Le,0,0,te),se=en}}}}addCurrentVertex(l,f,p,b,A,k=!1){const M=f.y*b-f.x,R=-f.y-f.x*b;this.addHalfVertex(l,f.x+f.y*p,f.y-f.x*p,k,!1,p,A),this.addHalfVertex(l,M,R,k,!0,-b,A),this.distance>$_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,f,p,b,A,k))}addHalfVertex({x:l,y:f},p,b,A,k,M,R){const V=.5*(this.lineClips?this.scaledDistance*($_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(A?1:0),(f<<1)+(k?1:0),Math.round(63*p)+128,Math.round(63*b)+128,1+(M===0?0:M<0?-1:1)|(63&V)<<2,V>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const K=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,K),R.primitiveLength++),k?this.e2=K:this.e1=K}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,f){this.distance+=l.dist(f),this.updateScaledDistance()}}let j_,U_;Yt("LineBucket",Yp,{omit:["layers","patternFeatures"]});var V_={get paint(){return U_=U_||new x({"line-opacity":new An(Ge.paint_line["line-opacity"]),"line-color":new An(Ge.paint_line["line-color"]),"line-translate":new an(Ge.paint_line["line-translate"]),"line-translate-anchor":new an(Ge.paint_line["line-translate-anchor"]),"line-width":new An(Ge.paint_line["line-width"]),"line-gap-width":new An(Ge.paint_line["line-gap-width"]),"line-offset":new An(Ge.paint_line["line-offset"]),"line-blur":new An(Ge.paint_line["line-blur"]),"line-dasharray":new au(Ge.paint_line["line-dasharray"]),"line-pattern":new su(Ge.paint_line["line-pattern"]),"line-gradient":new Vc(Ge.paint_line["line-gradient"])})},get layout(){return j_=j_||new x({"line-cap":new an(Ge.layout_line["line-cap"]),"line-join":new An(Ge.layout_line["line-join"]),"line-miter-limit":new an(Ge.layout_line["line-miter-limit"]),"line-round-limit":new an(Ge.layout_line["line-round-limit"]),"line-sort-key":new An(Ge.layout_line["line-sort-key"])})}};class Yx extends An{possiblyEvaluate(l,f){return f=new zr(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),super.possiblyEvaluate(l,f)}evaluate(l,f,p,b){return f=ue({},f,{zoom:Math.floor(f.zoom)}),super.evaluate(l,f,p,b)}}let ed;class Qx extends h{constructor(l){super(l,V_),this.gradientVersion=0,ed||(ed=new Yx(V_.paint.properties["line-width"].specification),ed.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const f=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(f)&&f._styleExpression.expression instanceof ia,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,f){super.recalculate(l,f),this.paint._values["line-floorwidth"]=ed.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Yp(l)}queryRadius(l){const f=l,p=q_(Zc("line-width",this,f),Zc("line-gap-width",this,f)),b=Zc("line-offset",this,f);return p/2+Math.abs(b)+Wh(this.paint.get("line-translate"))}queryIntersectsFeature(l,f,p,b,A,k,M){const R=Xh(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),k.angle,M),V=M/2*q_(this.paint.get("line-width").evaluate(f,p),this.paint.get("line-gap-width").evaluate(f,p)),K=this.paint.get("line-offset").evaluate(f,p);return K&&(b=function(te,se){const me=[];for(let ye=0;ye<te.length;ye++){const xe=te[ye],Le=[];for(let De=0;De<xe.length;De++){const Qe=xe[De-1],je=xe[De],Je=xe[De+1],lt=De===0?new v(0,0):je.sub(Qe)._unit()._perp(),Et=De===xe.length-1?new v(0,0):Je.sub(je)._unit()._perp(),Xt=lt._add(Et)._unit(),xn=Xt.x*Et.x+Xt.y*Et.y;xn!==0&&Xt._mult(1/xn),Le.push(Xt._mult(se)._add(je))}me.push(Le)}return me}(b,K*M)),function(te,se,me){for(let ye=0;ye<se.length;ye++){const xe=se[ye];if(te.length>=3){for(let Le=0;Le<xe.length;Le++)if(pu(te,xe[Le]))return!0}if(lx(te,xe,me))return!0}return!1}(R,b,V)}isTileClipped(){return!0}}function q_(c,l){return l>0?l+2*c:c}const eA=E([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),tA=E([{name:"a_projected_pos",components:3,type:"Float32"}],4);E([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const nA=E([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);E([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const G_=E([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rA=E([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function iA(c,l,f){return c.sections.forEach(p=>{p.text=function(b,A,k){const M=A.layout.get("text-transform").evaluate(k,{});return M==="uppercase"?b=b.toLocaleUpperCase():M==="lowercase"&&(b=b.toLocaleLowerCase()),Xi.applyArabicShaping&&(b=Xi.applyArabicShaping(b)),b}(p.text,l,f)}),c}E([{name:"triangle",components:3,type:"Uint16"}]),E([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),E([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),E([{type:"Float32",name:"offsetX"}]),E([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),E([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const ef={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var si=24,Z_=wr,H_=function(c,l,f,p,b){var A,k,M=8*b-p-1,R=(1<<M)-1,V=R>>1,K=-7,te=b-1,se=-1,me=c[l+te];for(te+=se,A=me&(1<<-K)-1,me>>=-K,K+=M;K>0;A=256*A+c[l+te],te+=se,K-=8);for(k=A&(1<<-K)-1,A>>=-K,K+=p;K>0;k=256*k+c[l+te],te+=se,K-=8);if(A===0)A=1-V;else{if(A===R)return k?NaN:1/0*(me?-1:1);k+=Math.pow(2,p),A-=V}return(me?-1:1)*k*Math.pow(2,A-p)},W_=function(c,l,f,p,b,A){var k,M,R,V=8*A-b-1,K=(1<<V)-1,te=K>>1,se=b===23?Math.pow(2,-24)-Math.pow(2,-77):0,me=0,ye=1,xe=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(M=isNaN(l)?1:0,k=K):(k=Math.floor(Math.log(l)/Math.LN2),l*(R=Math.pow(2,-k))<1&&(k--,R*=2),(l+=k+te>=1?se/R:se*Math.pow(2,1-te))*R>=2&&(k++,R/=2),k+te>=K?(M=0,k=K):k+te>=1?(M=(l*R-1)*Math.pow(2,b),k+=te):(M=l*Math.pow(2,te-1)*Math.pow(2,b),k=0));b>=8;c[f+me]=255&M,me+=ye,M/=256,b-=8);for(k=k<<b|M,V+=b;V>0;c[f+me]=255&k,me+=ye,k/=256,V-=8);c[f+me-ye]|=128*xe};function wr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}wr.Varint=0,wr.Fixed64=1,wr.Bytes=2,wr.Fixed32=5;var Qp=4294967296,X_=1/Qp,J_=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function qs(c){return c.type===wr.Bytes?c.readVarint()+c.pos:c.pos+1}function yu(c,l,f){return f?4294967296*l+(c>>>0):4294967296*(l>>>0)+(c>>>0)}function K_(c,l,f){var p=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));f.realloc(p);for(var b=f.pos-1;b>=c;b--)f.buf[b+p]=f.buf[b]}function oA(c,l){for(var f=0;f<c.length;f++)l.writeVarint(c[f])}function sA(c,l){for(var f=0;f<c.length;f++)l.writeSVarint(c[f])}function aA(c,l){for(var f=0;f<c.length;f++)l.writeFloat(c[f])}function lA(c,l){for(var f=0;f<c.length;f++)l.writeDouble(c[f])}function uA(c,l){for(var f=0;f<c.length;f++)l.writeBoolean(c[f])}function cA(c,l){for(var f=0;f<c.length;f++)l.writeFixed32(c[f])}function fA(c,l){for(var f=0;f<c.length;f++)l.writeSFixed32(c[f])}function hA(c,l){for(var f=0;f<c.length;f++)l.writeFixed64(c[f])}function dA(c,l){for(var f=0;f<c.length;f++)l.writeSFixed64(c[f])}function td(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+16777216*c[l+3]}function bu(c,l,f){c[f]=l,c[f+1]=l>>>8,c[f+2]=l>>>16,c[f+3]=l>>>24}function Y_(c,l){return(c[l]|c[l+1]<<8|c[l+2]<<16)+(c[l+3]<<24)}wr.prototype={destroy:function(){this.buf=null},readFields:function(c,l,f){for(f=f||this.length;this.pos<f;){var p=this.readVarint(),b=p>>3,A=this.pos;this.type=7&p,c(b,l,this),this.pos===A&&this.skip(p)}return l},readMessage:function(c,l){return this.readFields(c,l,this.readVarint()+this.pos)},readFixed32:function(){var c=td(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=Y_(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=td(this.buf,this.pos)+td(this.buf,this.pos+4)*Qp;return this.pos+=8,c},readSFixed64:function(){var c=td(this.buf,this.pos)+Y_(this.buf,this.pos+4)*Qp;return this.pos+=8,c},readFloat:function(){var c=H_(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=H_(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var l,f,p=this.buf;return l=127&(f=p[this.pos++]),f<128?l:(l|=(127&(f=p[this.pos++]))<<7,f<128?l:(l|=(127&(f=p[this.pos++]))<<14,f<128?l:(l|=(127&(f=p[this.pos++]))<<21,f<128?l:function(b,A,k){var M,R,V=k.buf;if(M=(112&(R=V[k.pos++]))>>4,R<128||(M|=(127&(R=V[k.pos++]))<<3,R<128)||(M|=(127&(R=V[k.pos++]))<<10,R<128)||(M|=(127&(R=V[k.pos++]))<<17,R<128)||(M|=(127&(R=V[k.pos++]))<<24,R<128)||(M|=(1&(R=V[k.pos++]))<<31,R<128))return yu(b,M,A);throw new Error("Expected varint not more than 10 bytes")}(l|=(15&(f=p[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,l=this.pos;return this.pos=c,c-l>=12&&J_?function(f,p,b){return J_.decode(f.subarray(p,b))}(this.buf,l,c):function(f,p,b){for(var A="",k=p;k<b;){var M,R,V,K=f[k],te=null,se=K>239?4:K>223?3:K>191?2:1;if(k+se>b)break;se===1?K<128&&(te=K):se===2?(192&(M=f[k+1]))==128&&(te=(31&K)<<6|63&M)<=127&&(te=null):se===3?(R=f[k+2],(192&(M=f[k+1]))==128&&(192&R)==128&&((te=(15&K)<<12|(63&M)<<6|63&R)<=2047||te>=55296&&te<=57343)&&(te=null)):se===4&&(R=f[k+2],V=f[k+3],(192&(M=f[k+1]))==128&&(192&R)==128&&(192&V)==128&&((te=(15&K)<<18|(63&M)<<12|(63&R)<<6|63&V)<=65535||te>=1114112)&&(te=null)),te===null?(te=65533,se=1):te>65535&&(te-=65536,A+=String.fromCharCode(te>>>10&1023|55296),te=56320|1023&te),A+=String.fromCharCode(te),k+=se}return A}(this.buf,l,c)},readBytes:function(){var c=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,c);return this.pos=c,l},readPackedVarint:function(c,l){if(this.type!==wr.Bytes)return c.push(this.readVarint(l));var f=qs(this);for(c=c||[];this.pos<f;)c.push(this.readVarint(l));return c},readPackedSVarint:function(c){if(this.type!==wr.Bytes)return c.push(this.readSVarint());var l=qs(this);for(c=c||[];this.pos<l;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==wr.Bytes)return c.push(this.readBoolean());var l=qs(this);for(c=c||[];this.pos<l;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==wr.Bytes)return c.push(this.readFloat());var l=qs(this);for(c=c||[];this.pos<l;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==wr.Bytes)return c.push(this.readDouble());var l=qs(this);for(c=c||[];this.pos<l;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==wr.Bytes)return c.push(this.readFixed32());var l=qs(this);for(c=c||[];this.pos<l;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==wr.Bytes)return c.push(this.readSFixed32());var l=qs(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==wr.Bytes)return c.push(this.readFixed64());var l=qs(this);for(c=c||[];this.pos<l;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==wr.Bytes)return c.push(this.readSFixed64());var l=qs(this);for(c=c||[];this.pos<l;)c.push(this.readSFixed64());return c},skip:function(c){var l=7&c;if(l===wr.Varint)for(;this.buf[this.pos++]>127;);else if(l===wr.Bytes)this.pos=this.readVarint()+this.pos;else if(l===wr.Fixed32)this.pos+=4;else{if(l!==wr.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(c,l){this.writeVarint(c<<3|l)},realloc:function(c){for(var l=this.length||16;l<this.pos+c;)l*=2;if(l!==this.length){var f=new Uint8Array(l);f.set(this.buf),this.buf=f,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),bu(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),bu(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),bu(this.buf,-1&c,this.pos),bu(this.buf,Math.floor(c*X_),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),bu(this.buf,-1&c,this.pos),bu(this.buf,Math.floor(c*X_),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(l,f){var p,b;if(l>=0?(p=l%4294967296|0,b=l/4294967296|0):(b=~(-l/4294967296),4294967295^(p=~(-l%4294967296))?p=p+1|0:(p=0,b=b+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");f.realloc(10),function(A,k,M){M.buf[M.pos++]=127&A|128,A>>>=7,M.buf[M.pos++]=127&A|128,A>>>=7,M.buf[M.pos++]=127&A|128,A>>>=7,M.buf[M.pos++]=127&A|128,M.buf[M.pos]=127&(A>>>=7)}(p,0,f),function(A,k){var M=(7&A)<<4;k.buf[k.pos++]|=M|((A>>>=3)?128:0),A&&(k.buf[k.pos++]=127&A|((A>>>=7)?128:0),A&&(k.buf[k.pos++]=127&A|((A>>>=7)?128:0),A&&(k.buf[k.pos++]=127&A|((A>>>=7)?128:0),A&&(k.buf[k.pos++]=127&A|((A>>>=7)?128:0),A&&(k.buf[k.pos++]=127&A)))))}(b,f)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var l=this.pos;this.pos=function(p,b,A){for(var k,M,R=0;R<b.length;R++){if((k=b.charCodeAt(R))>55295&&k<57344){if(!M){k>56319||R+1===b.length?(p[A++]=239,p[A++]=191,p[A++]=189):M=k;continue}if(k<56320){p[A++]=239,p[A++]=191,p[A++]=189,M=k;continue}k=M-55296<<10|k-56320|65536,M=null}else M&&(p[A++]=239,p[A++]=191,p[A++]=189,M=null);k<128?p[A++]=k:(k<2048?p[A++]=k>>6|192:(k<65536?p[A++]=k>>12|224:(p[A++]=k>>18|240,p[A++]=k>>12&63|128),p[A++]=k>>6&63|128),p[A++]=63&k|128)}return A}(this.buf,c,this.pos);var f=this.pos-l;f>=128&&K_(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f},writeFloat:function(c){this.realloc(4),W_(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),W_(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var l=c.length;this.writeVarint(l),this.realloc(l);for(var f=0;f<l;f++)this.buf[this.pos++]=c[f]},writeRawMessage:function(c,l){this.pos++;var f=this.pos;c(l,this);var p=this.pos-f;p>=128&&K_(f,p,this),this.pos=f-1,this.writeVarint(p),this.pos+=p},writeMessage:function(c,l,f){this.writeTag(c,wr.Bytes),this.writeRawMessage(l,f)},writePackedVarint:function(c,l){l.length&&this.writeMessage(c,oA,l)},writePackedSVarint:function(c,l){l.length&&this.writeMessage(c,sA,l)},writePackedBoolean:function(c,l){l.length&&this.writeMessage(c,uA,l)},writePackedFloat:function(c,l){l.length&&this.writeMessage(c,aA,l)},writePackedDouble:function(c,l){l.length&&this.writeMessage(c,lA,l)},writePackedFixed32:function(c,l){l.length&&this.writeMessage(c,cA,l)},writePackedSFixed32:function(c,l){l.length&&this.writeMessage(c,fA,l)},writePackedFixed64:function(c,l){l.length&&this.writeMessage(c,hA,l)},writePackedSFixed64:function(c,l){l.length&&this.writeMessage(c,dA,l)},writeBytesField:function(c,l){this.writeTag(c,wr.Bytes),this.writeBytes(l)},writeFixed32Field:function(c,l){this.writeTag(c,wr.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(c,l){this.writeTag(c,wr.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(c,l){this.writeTag(c,wr.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(c,l){this.writeTag(c,wr.Fixed64),this.writeSFixed64(l)},writeVarintField:function(c,l){this.writeTag(c,wr.Varint),this.writeVarint(l)},writeSVarintField:function(c,l){this.writeTag(c,wr.Varint),this.writeSVarint(l)},writeStringField:function(c,l){this.writeTag(c,wr.Bytes),this.writeString(l)},writeFloatField:function(c,l){this.writeTag(c,wr.Fixed32),this.writeFloat(l)},writeDoubleField:function(c,l){this.writeTag(c,wr.Fixed64),this.writeDouble(l)},writeBooleanField:function(c,l){this.writeVarintField(c,!!l)}};var em=d(Z_);const tm=3;function pA(c,l,f){c===1&&f.readMessage(mA,l)}function mA(c,l,f){if(c===3){const{id:p,bitmap:b,width:A,height:k,left:M,top:R,advance:V}=f.readMessage(gA,{});l.push({id:p,bitmap:new Wc({width:A+2*tm,height:k+2*tm},b),metrics:{width:A,height:k,left:M,top:R,advance:V}})}}function gA(c,l,f){c===1?l.id=f.readVarint():c===2?l.bitmap=f.readBytes():c===3?l.width=f.readVarint():c===4?l.height=f.readVarint():c===5?l.left=f.readSVarint():c===6?l.top=f.readSVarint():c===7&&(l.advance=f.readVarint())}const Q_=tm;function e0(c){let l=0,f=0;for(const k of c)l+=k.w*k.h,f=Math.max(f,k.w);c.sort((k,M)=>M.h-k.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),f),h:1/0}];let b=0,A=0;for(const k of c)for(let M=p.length-1;M>=0;M--){const R=p[M];if(!(k.w>R.w||k.h>R.h)){if(k.x=R.x,k.y=R.y,A=Math.max(A,k.y+k.h),b=Math.max(b,k.x+k.w),k.w===R.w&&k.h===R.h){const V=p.pop();M<p.length&&(p[M]=V)}else k.h===R.h?(R.x+=k.w,R.w-=k.w):k.w===R.w?(R.y+=k.h,R.h-=k.h):(p.push({x:R.x+k.w,y:R.y,w:R.w-k.w,h:k.h}),R.y+=k.h,R.h-=k.h);break}}return{w:b,h:A,fill:l/(b*A)||0}}const Ki=1;class nm{constructor(l,{pixelRatio:f,version:p,stretchX:b,stretchY:A,content:k,textFitWidth:M,textFitHeight:R}){this.paddedRect=l,this.pixelRatio=f,this.stretchX=b,this.stretchY=A,this.content=k,this.version=p,this.textFitWidth=M,this.textFitHeight=R}get tl(){return[this.paddedRect.x+Ki,this.paddedRect.y+Ki]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ki,this.paddedRect.y+this.paddedRect.h-Ki]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Ki)/this.pixelRatio,(this.paddedRect.h-2*Ki)/this.pixelRatio]}}class t0{constructor(l,f){const p={},b={};this.haveRenderCallbacks=[];const A=[];this.addImages(l,p,A),this.addImages(f,b,A);const{w:k,h:M}=e0(A),R=new Ao({width:k||1,height:M||1});for(const V in l){const K=l[V],te=p[V].paddedRect;Ao.copy(K.data,R,{x:0,y:0},{x:te.x+Ki,y:te.y+Ki},K.data)}for(const V in f){const K=f[V],te=b[V].paddedRect,se=te.x+Ki,me=te.y+Ki,ye=K.data.width,xe=K.data.height;Ao.copy(K.data,R,{x:0,y:0},{x:se,y:me},K.data),Ao.copy(K.data,R,{x:0,y:xe-1},{x:se,y:me-1},{width:ye,height:1}),Ao.copy(K.data,R,{x:0,y:0},{x:se,y:me+xe},{width:ye,height:1}),Ao.copy(K.data,R,{x:ye-1,y:0},{x:se-1,y:me},{width:1,height:xe}),Ao.copy(K.data,R,{x:0,y:0},{x:se+ye,y:me},{width:1,height:xe})}this.image=R,this.iconPositions=p,this.patternPositions=b}addImages(l,f,p){for(const b in l){const A=l[b],k={x:0,y:0,w:A.data.width+2*Ki,h:A.data.height+2*Ki};p.push(k),f[b]=new nm(k,A),A.hasRenderCallback&&this.haveRenderCallbacks.push(b)}}patchUpdatedImages(l,f){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in l.updatedImages)this.patchUpdatedImage(this.iconPositions[p],l.getImage(p),f),this.patchUpdatedImage(this.patternPositions[p],l.getImage(p),f)}patchUpdatedImage(l,f,p){if(!l||!f||l.version===f.version)return;l.version=f.version;const[b,A]=l.tl;p.update(f.data,void 0,{x:b,y:A})}}var Ea;Yt("ImagePosition",nm),Yt("ImageAtlas",t0),u.ah=void 0,(Ea=u.ah||(u.ah={}))[Ea.none=0]="none",Ea[Ea.horizontal=1]="horizontal",Ea[Ea.vertical=2]="vertical",Ea[Ea.horizontalOnly=3]="horizontalOnly";const tf=-17;class nf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,f){const p=new nf;return p.scale=l||1,p.fontStack=f,p}static forImage(l){const f=new nf;return f.imageName=l,f}}class vu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,f){const p=new vu;for(let b=0;b<l.sections.length;b++){const A=l.sections[b];A.image?p.addImageSection(A):p.addTextSection(A,f)}return p}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=function(l){let f="";for(let p=0;p<l.length;p++){const b=l.charCodeAt(p+1)||null,A=l.charCodeAt(p-1)||null;f+=b&&jh(b)&&!ef[l[p+1]]||A&&jh(A)&&!ef[l[p-1]]||!ef[l[p]]?l[p]:ef[l[p]]}return f}(this.text)}trim(){let l=0;for(let p=0;p<this.text.length&&rd[this.text.charCodeAt(p)];p++)l++;let f=this.text.length;for(let p=this.text.length-1;p>=0&&p>=l&&rd[this.text.charCodeAt(p)];p--)f--;this.text=this.text.substring(l,f),this.sectionIndex=this.sectionIndex.slice(l,f)}substring(l,f){const p=new vu;return p.text=this.text.substring(l,f),p.sectionIndex=this.sectionIndex.slice(l,f),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((l,f)=>Math.max(l,this.sections[f].scale),0)}addTextSection(l,f){this.text+=l.text,this.sections.push(nf.forText(l.scale,l.fontStack||f));const p=this.sections.length-1;for(let b=0;b<l.text.length;++b)this.sectionIndex.push(p)}addImageSection(l){const f=l.image?l.image.name:"";if(f.length===0)return void J("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(nf.forImage(f)),this.sectionIndex.push(this.sections.length-1)):J("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function nd(c,l,f,p,b,A,k,M,R,V,K,te,se,me,ye){const xe=vu.fromFeature(c,b);let Le;te===u.ah.vertical&&xe.verticalizePunctuation();const{processBidirectionalText:De,processStyledBidirectionalText:Qe}=Xi;if(De&&xe.sections.length===1){Le=[];const lt=De(xe.toString(),rm(xe,V,A,l,p,me));for(const Et of lt){const Xt=new vu;Xt.text=Et,Xt.sections=xe.sections;for(let xn=0;xn<Et.length;xn++)Xt.sectionIndex.push(0);Le.push(Xt)}}else if(Qe){Le=[];const lt=Qe(xe.text,xe.sectionIndex,rm(xe,V,A,l,p,me));for(const Et of lt){const Xt=new vu;Xt.text=Et[0],Xt.sectionIndex=Et[1],Xt.sections=xe.sections,Le.push(Xt)}}else Le=function(lt,Et){const Xt=[],xn=lt.text;let Gt=0;for(const Ut of Et)Xt.push(lt.substring(Gt,Ut)),Gt=Ut;return Gt<xn.length&&Xt.push(lt.substring(Gt,xn.length)),Xt}(xe,rm(xe,V,A,l,p,me));const je=[],Je={positionedLines:je,text:xe.toString(),top:K[1],bottom:K[1],left:K[0],right:K[0],writingMode:te,iconsInText:!1,verticalizable:!1};return function(lt,Et,Xt,xn,Gt,Ut,fn,en,Kt,dt,pn,cn){let En=0,kr=tf,xr=0,fi=0;const jo=en==="right"?1:en==="left"?0:.5;let Si=0;for(const Xr of Gt){Xr.trim();const di=Xr.getMaxScale(),zi=(di-1)*si,Ti={positionedGlyphs:[],lineOffset:0};lt.positionedLines[Si]=Ti;const Gi=Ti.positionedGlyphs;let Ci=0;if(!Xr.length()){kr+=Ut,++Si;continue}for(let Yi=0;Yi<Xr.length();Yi++){const ar=Xr.getSection(Yi),Lr=Xr.getSectionIndex(Yi),Fr=Xr.getCharCode(Yi);let so=0,qr=null,ku=null,vs=null,ws=si;const Uo=!(Kt===u.ah.horizontal||!pn&&!jc(Fr)||pn&&(rd[Fr]||(hi=Fr,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(hi)))));if(ar.imageName){const To=xn[ar.imageName];if(!To)continue;vs=ar.imageName,lt.iconsInText=lt.iconsInText||!0,ku=To.paddedRect;const gi=To.displaySize;ar.scale=ar.scale*si/cn,qr={width:gi[0],height:gi[1],left:Ki,top:-Q_,advance:Uo?gi[1]:gi[0]},so=zi+(si-gi[1]*ar.scale),ws=qr.advance;const Gs=Uo?gi[0]*ar.scale-si*di:gi[1]*ar.scale-si*di;Gs>0&&Gs>Ci&&(Ci=Gs)}else{const To=Xt[ar.fontStack],gi=To&&To[Fr];if(gi&&gi.rect)ku=gi.rect,qr=gi.metrics;else{const Gs=Et[ar.fontStack],uf=Gs&&Gs[Fr];if(!uf)continue;qr=uf.metrics}so=(di-ar.scale)*si}Uo?(lt.verticalizable=!0,Gi.push({glyph:Fr,imageName:vs,x:En,y:kr+so,vertical:Uo,scale:ar.scale,fontStack:ar.fontStack,sectionIndex:Lr,metrics:qr,rect:ku}),En+=ws*ar.scale+dt):(Gi.push({glyph:Fr,imageName:vs,x:En,y:kr+so,vertical:Uo,scale:ar.scale,fontStack:ar.fontStack,sectionIndex:Lr,metrics:qr,rect:ku}),En+=qr.advance*ar.scale+dt)}Gi.length!==0&&(xr=Math.max(En-dt,xr),vA(Gi,0,Gi.length-1,jo,Ci)),En=0;const So=Ut*di+Ci;Ti.lineOffset=Math.max(Ci,zi),kr+=So,fi=Math.max(So,fi),++Si}var hi;const Ui=kr-tf,{horizontalAlign:Vi,verticalAlign:qi}=im(fn);(function(Xr,di,zi,Ti,Gi,Ci,So,Yi,ar){const Lr=(di-zi)*Gi;let Fr=0;Fr=Ci!==So?-Yi*Ti-tf:(-Ti*ar+.5)*So;for(const so of Xr)for(const qr of so.positionedGlyphs)qr.x+=Lr,qr.y+=Fr})(lt.positionedLines,jo,Vi,qi,xr,fi,Ut,Ui,Gt.length),lt.top+=-qi*Ui,lt.bottom=lt.top+Ui,lt.left+=-Vi*xr,lt.right=lt.left+xr}(Je,l,f,p,Le,k,M,R,te,V,se,ye),!function(lt){for(const Et of lt)if(Et.positionedGlyphs.length!==0)return!1;return!0}(je)&&Je}const rd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},_A={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},yA={40:!0};function n0(c,l,f,p,b,A){if(l.imageName){const k=p[l.imageName];return k?k.displaySize[0]*l.scale*si/A+b:0}{const k=f[l.fontStack],M=k&&k[c];return M?M.metrics.advance*l.scale+b:0}}function r0(c,l,f,p){const b=Math.pow(c-l,2);return p?c<l?b/2:2*b:b+Math.abs(f)*f}function bA(c,l,f){let p=0;return c===10&&(p-=1e4),f&&(p+=150),c!==40&&c!==65288||(p+=50),l!==41&&l!==65289||(p+=50),p}function i0(c,l,f,p,b,A){let k=null,M=r0(l,f,b,A);for(const R of p){const V=r0(l-R.x,f,b,A)+R.badness;V<=M&&(k=R,M=V)}return{index:c,x:l,priorBreak:k,badness:M}}function o0(c){return c?o0(c.priorBreak).concat(c.index):[]}function rm(c,l,f,p,b,A){if(!c)return[];const k=[],M=function(te,se,me,ye,xe,Le){let De=0;for(let Qe=0;Qe<te.length();Qe++){const je=te.getSection(Qe);De+=n0(te.getCharCode(Qe),je,ye,xe,se,Le)}return De/Math.max(1,Math.ceil(De/me))}(c,l,f,p,b,A),R=c.text.indexOf("")>=0;let V=0;for(let te=0;te<c.length();te++){const se=c.getSection(te),me=c.getCharCode(te);if(rd[me]||(V+=n0(me,se,p,b,l,A)),te<c.length()-1){const ye=!((K=me)<11904)&&(!!Xn["CJK Compatibility Forms"](K)||!!Xn["CJK Compatibility"](K)||!!Xn["CJK Strokes"](K)||!!Xn["CJK Symbols and Punctuation"](K)||!!Xn["Enclosed CJK Letters and Months"](K)||!!Xn["Halfwidth and Fullwidth Forms"](K)||!!Xn["Ideographic Description Characters"](K)||!!Xn["Vertical Forms"](K)||$h.test(String.fromCodePoint(K)));(_A[me]||ye||se.imageName||te!==c.length()-2&&yA[c.getCharCode(te+1)])&&k.push(i0(te+1,V,M,k,bA(me,c.getCharCode(te+1),ye&&R),!1))}}var K;return o0(i0(c.length(),V,M,k,0,!0))}function im(c){let l=.5,f=.5;switch(c){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":f=1;break;case"top":case"top-right":case"top-left":f=0}return{horizontalAlign:l,verticalAlign:f}}function vA(c,l,f,p,b){if(!p&&!b)return;const A=c[f],k=(c[f].x+A.metrics.advance*A.scale)*p;for(let M=l;M<=f;M++)c[M].x-=k,c[M].y+=b}function wA(c,l,f){const{horizontalAlign:p,verticalAlign:b}=im(f),A=l[0]-c.displaySize[0]*p,k=l[1]-c.displaySize[1]*b;return{image:c,top:k,bottom:k+c.displaySize[1],left:A,right:A+c.displaySize[0]}}function s0(c){var l,f;let p=c.left,b=c.top,A=c.right-p,k=c.bottom-b;const M=(l=c.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",R=(f=c.image.textFitHeight)!==null&&f!==void 0?f:"stretchOrShrink",V=(c.image.content[2]-c.image.content[0])/(c.image.content[3]-c.image.content[1]);if(R==="proportional"){if(M==="stretchOnly"&&A/k<V||M==="proportional"){const K=Math.ceil(k*V);p*=K/A,A=K}}else if(M==="proportional"&&R==="stretchOnly"&&V!==0&&A/k>V){const K=Math.ceil(A/V);b*=K/k,k=K}return{x1:p,y1:b,x2:p+A,y2:b+k}}function a0(c,l,f,p,b,A){const k=c.image;let M;if(k.content){const Le=k.content,De=k.pixelRatio||1;M=[Le[0]/De,Le[1]/De,k.displaySize[0]-Le[2]/De,k.displaySize[1]-Le[3]/De]}const R=l.left*A,V=l.right*A;let K,te,se,me;f==="width"||f==="both"?(me=b[0]+R-p[3],te=b[0]+V+p[1]):(me=b[0]+(R+V-k.displaySize[0])/2,te=me+k.displaySize[0]);const ye=l.top*A,xe=l.bottom*A;return f==="height"||f==="both"?(K=b[1]+ye-p[0],se=b[1]+xe+p[2]):(K=b[1]+(ye+xe-k.displaySize[1])/2,se=K+k.displaySize[1]),{image:k,top:K,right:te,bottom:se,left:me,collisionPadding:M}}const rf=255,bs=128,Ia=rf*bs;function l0(c,l){const{expression:f}=l;if(f.kind==="constant")return{kind:"constant",layoutSize:f.evaluate(new zr(c+1))};if(f.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:b}=f;let A=0;for(;A<p.length&&p[A]<=c;)A++;A=Math.max(0,A-1);let k=A;for(;k<p.length&&p[k]<c+1;)k++;k=Math.min(p.length-1,k);const M=p[A],R=p[k];return f.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:R,interpolationType:b}:{kind:"camera",minZoom:M,maxZoom:R,minSize:f.evaluate(new zr(M)),maxSize:f.evaluate(new zr(R)),interpolationType:b}}}function om(c,l,f){let p="never";const b=c.get(l);return b?p=b:c.get(f)&&(p="always"),p}const xA=Ma.VectorTileFeature.types,AA=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function id(c,l,f,p,b,A,k,M,R,V,K,te,se){const me=M?Math.min(Ia,Math.round(M[0])):0,ye=M?Math.min(Ia,Math.round(M[1])):0;c.emplaceBack(l,f,Math.round(32*p),Math.round(32*b),A,k,(me<<1)+(R?1:0),ye,16*V,16*K,256*te,256*se)}function sm(c,l,f){c.emplaceBack(l.x,l.y,f),c.emplaceBack(l.x,l.y,f),c.emplaceBack(l.x,l.y,f),c.emplaceBack(l.x,l.y,f)}function kA(c){for(const l of c.sections)if(Dp(l.text))return!0;return!1}class am{constructor(l){this.layoutVertexArray=new uu,this.indexArray=new xo,this.programConfigurations=l,this.segments=new Jn,this.dynamicLayoutVertexArray=new qc,this.opacityVertexArray=new io,this.hasVisibleVertices=!1,this.placedSymbolArray=new Dr}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,f,p,b){this.isEmpty()||(p&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,eA.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,f),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,tA.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,AA,!0),this.opacityVertexBuffer.itemSize=1),(p||b)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Yt("SymbolBuffers",am);class lm{constructor(l,f,p){this.layoutVertexArray=new l,this.layoutAttributes=f,this.indexArray=new p,this.segments=new Jn,this.collisionVertexArray=new _s}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,nA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Yt("CollisionBuffers",lm);class wu{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map(k=>k.id),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=jp([]),this.placementViewportMatrix=jp([]);const f=this.layers[0]._unevaluatedLayout._values;this.textSizeData=l0(this.zoom,f["text-size"]),this.iconSizeData=l0(this.zoom,f["icon-size"]);const p=this.layers[0].layout,b=p.get("symbol-sort-key"),A=p.get("symbol-z-order");this.canOverlap=om(p,"text-overlap","text-allow-overlap")!=="never"||om(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=A!=="viewport-y"&&!b.isConstant(),this.sortFeaturesByY=(A==="viewport-y"||A==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(k=>u.ah[k])),this.stateDependentLayerIds=this.layers.filter(k=>k.isStateDependent()).map(k=>k.id),this.sourceID=l.sourceID}createArrays(){this.text=new am(new hl(this.layers,this.zoom,l=>/^text/.test(l))),this.icon=new am(new hl(this.layers,this.zoom,l=>/^icon/.test(l))),this.glyphOffsetArray=new Rr,this.lineVertexArray=new wi,this.symbolInstances=new Hn,this.textAnchorOffsets=new Br}calculateGlyphDependencies(l,f,p,b,A){for(let k=0;k<l.length;k++)if(f[l.charCodeAt(k)]=!0,(p||b)&&A){const M=ef[l.charAt(k)];M&&(f[M.charCodeAt(0)]=!0)}}populate(l,f,p){const b=this.layers[0],A=b.layout,k=A.get("text-font"),M=A.get("text-field"),R=A.get("icon-image"),V=(M.value.kind!=="constant"||M.value.value instanceof pi&&!M.value.value.isEmpty()||M.value.value.toString().length>0)&&(k.value.kind!=="constant"||k.value.value.length>0),K=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,te=A.get("symbol-sort-key");if(this.features=[],!V&&!K)return;const se=f.iconDependencies,me=f.glyphDependencies,ye=f.availableImages,xe=new zr(this.zoom);for(const{feature:Le,id:De,index:Qe,sourceLayerIndex:je}of l){const Je=b._featureFilter.needGeometry,lt=pl(Le,Je);if(!b._featureFilter.filter(xe,lt,p))continue;let Et,Xt;if(Je||(lt.geometry=dl(Le)),V){const Gt=b.getValueAndResolveTokens("text-field",lt,p,ye),Ut=pi.factory(Gt),fn=this.hasRTLText=this.hasRTLText||kA(Ut);(!fn||Xi.getRTLTextPluginStatus()==="unavailable"||fn&&Xi.isParsed())&&(Et=iA(Ut,b,lt))}if(K){const Gt=b.getValueAndResolveTokens("icon-image",lt,p,ye);Xt=Gt instanceof Ii?Gt:Ii.fromString(Gt)}if(!Et&&!Xt)continue;const xn=this.sortFeaturesByKey?te.evaluate(lt,{},p):void 0;if(this.features.push({id:De,text:Et,icon:Xt,index:Qe,sourceLayerIndex:je,geometry:lt.geometry,properties:Le.properties,type:xA[Le.type],sortKey:xn}),Xt&&(se[Xt.name]=!0),Et){const Gt=k.evaluate(lt,{},p).join(","),Ut=A.get("text-rotation-alignment")!=="viewport"&&A.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const fn of Et.sections)if(fn.image)se[fn.image.name]=!0;else{const en=Nc(Et.toString()),Kt=fn.fontStack||Gt,dt=me[Kt]=me[Kt]||{};this.calculateGlyphDependencies(fn.text,dt,Ut,this.allowVerticalPlacement,en)}}}A.get("symbol-placement")==="line"&&(this.features=function(Le){const De={},Qe={},je=[];let Je=0;function lt(Gt){je.push(Le[Gt]),Je++}function Et(Gt,Ut,fn){const en=Qe[Gt];return delete Qe[Gt],Qe[Ut]=en,je[en].geometry[0].pop(),je[en].geometry[0]=je[en].geometry[0].concat(fn[0]),en}function Xt(Gt,Ut,fn){const en=De[Ut];return delete De[Ut],De[Gt]=en,je[en].geometry[0].shift(),je[en].geometry[0]=fn[0].concat(je[en].geometry[0]),en}function xn(Gt,Ut,fn){const en=fn?Ut[0][Ut[0].length-1]:Ut[0][0];return`${Gt}:${en.x}:${en.y}`}for(let Gt=0;Gt<Le.length;Gt++){const Ut=Le[Gt],fn=Ut.geometry,en=Ut.text?Ut.text.toString():null;if(!en){lt(Gt);continue}const Kt=xn(en,fn),dt=xn(en,fn,!0);if(Kt in Qe&&dt in De&&Qe[Kt]!==De[dt]){const pn=Xt(Kt,dt,fn),cn=Et(Kt,dt,je[pn].geometry);delete De[Kt],delete Qe[dt],Qe[xn(en,je[cn].geometry,!0)]=cn,je[pn].geometry=null}else Kt in Qe?Et(Kt,dt,fn):dt in De?Xt(Kt,dt,fn):(lt(Gt),De[Kt]=Je-1,Qe[dt]=Je-1)}return je.filter(Gt=>Gt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Le,De)=>Le.sortKey-De.sortKey)}update(l,f,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,f,this.layers,p),this.icon.programConfigurations.updatePaintArrays(l,f,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,f){const p=this.lineVertexArray.length;if(l.segment!==void 0){let b=l.dist(f[l.segment+1]),A=l.dist(f[l.segment]);const k={};for(let M=l.segment+1;M<f.length;M++)k[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:b},M<f.length-1&&(b+=f[M+1].dist(f[M]));for(let M=l.segment||0;M>=0;M--)k[M]={x:f[M].x,y:f[M].y,tileUnitDistanceFromAnchor:A},M>0&&(A+=f[M-1].dist(f[M]));for(let M=0;M<f.length;M++){const R=k[M];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(l,f,p,b,A,k,M,R,V,K,te,se){const me=l.indexArray,ye=l.layoutVertexArray,xe=l.segments.prepareSegment(4*f.length,ye,me,this.canOverlap?k.sortKey:void 0),Le=this.glyphOffsetArray.length,De=xe.vertexLength,Qe=this.allowVerticalPlacement&&M===u.ah.vertical?Math.PI/2:0,je=k.text&&k.text.sections;for(let Je=0;Je<f.length;Je++){const{tl:lt,tr:Et,bl:Xt,br:xn,tex:Gt,pixelOffsetTL:Ut,pixelOffsetBR:fn,minFontScaleX:en,minFontScaleY:Kt,glyphOffset:dt,isSDF:pn,sectionIndex:cn}=f[Je],En=xe.vertexLength,kr=dt[1];id(ye,R.x,R.y,lt.x,kr+lt.y,Gt.x,Gt.y,p,pn,Ut.x,Ut.y,en,Kt),id(ye,R.x,R.y,Et.x,kr+Et.y,Gt.x+Gt.w,Gt.y,p,pn,fn.x,Ut.y,en,Kt),id(ye,R.x,R.y,Xt.x,kr+Xt.y,Gt.x,Gt.y+Gt.h,p,pn,Ut.x,fn.y,en,Kt),id(ye,R.x,R.y,xn.x,kr+xn.y,Gt.x+Gt.w,Gt.y+Gt.h,p,pn,fn.x,fn.y,en,Kt),sm(l.dynamicLayoutVertexArray,R,Qe),me.emplaceBack(En,En+1,En+2),me.emplaceBack(En+1,En+2,En+3),xe.vertexLength+=4,xe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(dt[0]),Je!==f.length-1&&cn===f[Je+1].sectionIndex||l.programConfigurations.populatePaintArrays(ye.length,k,k.index,{},se,je&&je[cn])}l.placedSymbolArray.emplaceBack(R.x,R.y,Le,this.glyphOffsetArray.length-Le,De,V,K,R.segment,p?p[0]:0,p?p[1]:0,b[0],b[1],M,0,!1,0,te)}_addCollisionDebugVertex(l,f,p,b,A,k){return f.emplaceBack(0,0),l.emplaceBack(p.x,p.y,b,A,Math.round(k.x),Math.round(k.y))}addCollisionDebugVertices(l,f,p,b,A,k,M){const R=A.segments.prepareSegment(4,A.layoutVertexArray,A.indexArray),V=R.vertexLength,K=A.layoutVertexArray,te=A.collisionVertexArray,se=M.anchorX,me=M.anchorY;this._addCollisionDebugVertex(K,te,k,se,me,new v(l,f)),this._addCollisionDebugVertex(K,te,k,se,me,new v(p,f)),this._addCollisionDebugVertex(K,te,k,se,me,new v(p,b)),this._addCollisionDebugVertex(K,te,k,se,me,new v(l,b)),R.vertexLength+=4;const ye=A.indexArray;ye.emplaceBack(V,V+1),ye.emplaceBack(V+1,V+2),ye.emplaceBack(V+2,V+3),ye.emplaceBack(V+3,V),R.primitiveLength+=4}addDebugCollisionBoxes(l,f,p,b){for(let A=l;A<f;A++){const k=this.collisionBoxArray.get(A);this.addCollisionDebugVertices(k.x1,k.y1,k.x2,k.y2,b?this.textCollisionBox:this.iconCollisionBox,k.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lm(oo,G_.members,mi),this.iconCollisionBox=new lm(oo,G_.members,mi);for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.addDebugCollisionBoxes(f.textBoxStartIndex,f.textBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f,!0),this.addDebugCollisionBoxes(f.iconBoxStartIndex,f.iconBoxEndIndex,f,!1),this.addDebugCollisionBoxes(f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex,f,!1)}}_deserializeCollisionBoxesForSymbol(l,f,p,b,A,k,M,R,V){const K={};for(let te=f;te<p;te++){const se=l.get(te);K.textBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},K.textFeatureIndex=se.featureIndex;break}for(let te=b;te<A;te++){const se=l.get(te);K.verticalTextBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},K.verticalTextFeatureIndex=se.featureIndex;break}for(let te=k;te<M;te++){const se=l.get(te);K.iconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},K.iconFeatureIndex=se.featureIndex;break}for(let te=R;te<V;te++){const se=l.get(te);K.verticalIconBox={x1:se.x1,y1:se.y1,x2:se.x2,y2:se.y2,anchorPointX:se.anchorPointX,anchorPointY:se.anchorPointY},K.verticalIconFeatureIndex=se.featureIndex;break}return K}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,f){const p=l.placedSymbolArray.get(f),b=p.vertexStartIndex+4*p.numGlyphs;for(let A=p.vertexStartIndex;A<b;A+=4)l.indexArray.emplaceBack(A,A+1,A+2),l.indexArray.emplaceBack(A+1,A+2,A+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const f=Math.sin(l),p=Math.cos(l),b=[],A=[],k=[];for(let M=0;M<this.symbolInstances.length;++M){k.push(M);const R=this.symbolInstances.get(M);b.push(0|Math.round(f*R.anchorX+p*R.anchorY)),A.push(R.featureIndex)}return k.sort((M,R)=>b[M]-b[R]||A[R]-A[M]),k}addToSortKeyRanges(l,f){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===f?p.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:f,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const f of this.symbolInstanceIndexes){const p=this.symbolInstances.get(f);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((b,A,k)=>{b>=0&&k.indexOf(b)===A&&this.addIndicesForPlacedSymbol(this.text,b)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let u0,c0;Yt("SymbolBucket",wu,{omit:["layers","collisionBoxArray","features","compareText"]}),wu.MAX_GLYPHS=65535,wu.addDynamicAttributes=sm;var um={get paint(){return c0=c0||new x({"icon-opacity":new An(Ge.paint_symbol["icon-opacity"]),"icon-color":new An(Ge.paint_symbol["icon-color"]),"icon-halo-color":new An(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new An(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new An(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new an(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new an(Ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new An(Ge.paint_symbol["text-opacity"]),"text-color":new An(Ge.paint_symbol["text-color"],{runtimeType:$t,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new An(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new An(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new An(Ge.paint_symbol["text-halo-blur"]),"text-translate":new an(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new an(Ge.paint_symbol["text-translate-anchor"])})},get layout(){return u0=u0||new x({"symbol-placement":new an(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new an(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new an(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new An(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new an(Ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new an(Ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new an(Ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new an(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new an(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new an(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new An(Ge.layout_symbol["icon-size"]),"icon-text-fit":new an(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new an(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new An(Ge.layout_symbol["icon-image"]),"icon-rotate":new An(Ge.layout_symbol["icon-rotate"]),"icon-padding":new An(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new an(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new An(Ge.layout_symbol["icon-offset"]),"icon-anchor":new An(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new an(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new an(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new an(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new An(Ge.layout_symbol["text-field"]),"text-font":new An(Ge.layout_symbol["text-font"]),"text-size":new An(Ge.layout_symbol["text-size"]),"text-max-width":new An(Ge.layout_symbol["text-max-width"]),"text-line-height":new an(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new An(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new An(Ge.layout_symbol["text-justify"]),"text-radial-offset":new An(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new an(Ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new An(Ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new An(Ge.layout_symbol["text-anchor"]),"text-max-angle":new an(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new an(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new An(Ge.layout_symbol["text-rotate"]),"text-padding":new an(Ge.layout_symbol["text-padding"]),"text-keep-upright":new an(Ge.layout_symbol["text-keep-upright"]),"text-transform":new An(Ge.layout_symbol["text-transform"]),"text-offset":new An(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new an(Ge.layout_symbol["text-allow-overlap"]),"text-overlap":new an(Ge.layout_symbol["text-overlap"]),"text-ignore-placement":new an(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new an(Ge.layout_symbol["text-optional"])})}};class f0{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:Nr,this.defaultValue=l}evaluate(l){if(l.formattedSection){const f=this.defaultValue.property.overrides;if(f&&f.hasOverride(l.formattedSection))return f.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Yt("FormatSectionOverride",f0,{omit:["defaultValue"]});class od extends h{constructor(l){super(l,um)}recalculate(l,f){if(super.recalculate(l,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const b=[];for(const A of p)b.indexOf(A)<0&&b.push(A);this.layout._values["text-writing-mode"]=b}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,f,p,b){const A=this.layout.get(l).evaluate(f,{},p,b),k=this._unevaluatedLayout._values[l];return k.isDataDriven()||Wl(k.value)||!A?A:function(M,R){return R.replace(/{([^{}]+)}/g,(V,K)=>M&&K in M?String(M[K]):"")}(f.properties,A)}createBucket(l){return new wu(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of um.paint.overridableProperties){if(!od.hasPaintOverride(this.layout,l))continue;const f=this.paint.get(l),p=new f0(f),b=new Hl(p,f.property.specification);let A=null;A=f.value.kind==="constant"||f.value.kind==="source"?new da("source",b):new pa("composite",b,f.value.zoomStops),this.paint._values[l]=new No(f.property,A,f.parameters)}}_handleOverridablePaintPropertyUpdate(l,f,p){return!(!this.layout||f.isDataDriven()||p.isDataDriven())&&od.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,f){const p=l.get("text-field"),b=um.paint.properties[f];let A=!1;const k=M=>{for(const R of M)if(b.overrides&&b.overrides.hasOverride(R))return void(A=!0)};if(p.value.kind==="constant"&&p.value.value instanceof pi)k(p.value.value.sections);else if(p.value.kind==="source"){const M=V=>{A||(V instanceof go&&tr(V.value)===ir?k(V.value.sections):V instanceof Ol?k(V.sections):V.eachChild(M))},R=p.value;R._styleExpression&&M(R._styleExpression.expression)}return A}}let h0;var SA={get paint(){return h0=h0||new x({"background-color":new an(Ge.paint_background["background-color"]),"background-pattern":new au(Ge.paint_background["background-pattern"]),"background-opacity":new an(Ge.paint_background["background-opacity"])})}};class TA extends h{constructor(l){super(l,SA)}}let d0;var CA={get paint(){return d0=d0||new x({"raster-opacity":new an(Ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new an(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new an(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new an(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new an(Ge.paint_raster["raster-saturation"]),"raster-contrast":new an(Ge.paint_raster["raster-contrast"]),"raster-resampling":new an(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new an(Ge.paint_raster["raster-fade-duration"])})}};class MA extends h{constructor(l){super(l,CA)}}class EA extends h{constructor(l){super(l,{}),this.onAdd=f=>{this.implementation.onAdd&&this.implementation.onAdd(f,f.painter.context.gl)},this.onRemove=f=>{this.implementation.onRemove&&this.implementation.onRemove(f,f.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class IA{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const cm=63710088e-1;class La{constructor(l,f){if(isNaN(l)||isNaN(f))throw new Error(`Invalid LngLat object: (${l}, ${f})`);if(this.lng=+l,this.lat=+f,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new La(X(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const f=Math.PI/180,p=this.lat*f,b=l.lat*f,A=Math.sin(p)*Math.sin(b)+Math.cos(p)*Math.cos(b)*Math.cos((l.lng-this.lng)*f);return cm*Math.acos(Math.min(A,1))}static convert(l){if(l instanceof La)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new La(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new La(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const p0=2*Math.PI*cm;function m0(c){return p0*Math.cos(c*Math.PI/180)}function g0(c){return(180+c)/360}function _0(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function y0(c,l){return c/m0(l)}function fm(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class of{constructor(l,f,p=0){this.x=+l,this.y=+f,this.z=+p}static fromLngLat(l,f=0){const p=La.convert(l);return new of(g0(p.lng),_0(p.lat),y0(f,p.lat))}toLngLat(){return new La(360*this.x-180,fm(this.y))}toAltitude(){return this.z*m0(fm(this.y))}meterInMercatorCoordinateUnits(){return 1/p0*(l=fm(this.y),1/Math.cos(l*Math.PI/180));var l}}function b0(c,l,f){var p=2*Math.PI*6378137/256/Math.pow(2,f);return[c*p-2*Math.PI*6378137/2,l*p-2*Math.PI*6378137/2]}class hm{constructor(l,f,p){if(!function(b,A,k){return!(b<0||b>25||k<0||k>=Math.pow(2,b)||A<0||A>=Math.pow(2,b))}(l,f,p))throw new Error(`x=${f}, y=${p}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=f,this.y=p,this.key=sf(0,l,l,f,p)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,f,p){const b=(k=this.y,M=this.z,R=b0(256*(A=this.x),256*(k=Math.pow(2,M)-k-1),M),V=b0(256*(A+1),256*(k+1),M),R[0]+","+R[1]+","+V[0]+","+V[1]);var A,k,M,R,V;const K=function(te,se,me){let ye,xe="";for(let Le=te;Le>0;Le--)ye=1<<Le-1,xe+=(se&ye?1:0)+(me&ye?2:0);return xe}(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,f>1?"@2x":"").replace(/{quadkey}/g,K).replace(/{bbox-epsg-3857}/g,b)}isChildOf(l){const f=this.z-l.z;return f>0&&l.x===this.x>>f&&l.y===this.y>>f}getTilePoint(l){const f=Math.pow(2,this.z);return new v((l.x*f-this.x)*ti,(l.y*f-this.y)*ti)}toString(){return`${this.z}/${this.x}/${this.y}`}}class v0{constructor(l,f){this.wrap=l,this.canonical=f,this.key=sf(l,f.z,f.z,f.x,f.y)}}class ko{constructor(l,f,p,b,A){if(l<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${p}`);this.overscaledZ=l,this.wrap=f,this.canonical=new hm(p,+b,+A),this.key=sf(f,l,p,b,A)}clone(){return new ko(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-l;return l>this.canonical.z?new ko(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ko(l,this.wrap,l,this.canonical.x>>f,this.canonical.y>>f)}calculateScaledKey(l,f){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-l;return l>this.canonical.z?sf(this.wrap*+f,l,this.canonical.z,this.canonical.x,this.canonical.y):sf(this.wrap*+f,l,l,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const f=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>f&&l.canonical.y===this.canonical.y>>f}children(l){if(this.overscaledZ>=l)return[new ko(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const f=this.canonical.z+1,p=2*this.canonical.x,b=2*this.canonical.y;return[new ko(f,this.wrap,f,p,b),new ko(f,this.wrap,f,p+1,b),new ko(f,this.wrap,f,p,b+1),new ko(f,this.wrap,f,p+1,b+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new ko(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new ko(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new v0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new of(l.x-this.wrap,l.y))}}function sf(c,l,f,p,b){(c*=2)<0&&(c=-1*c-1);const A=1<<f;return(A*A*c+A*b+p).toString(36)+f.toString(36)+l.toString(36)}Yt("CanonicalTileID",hm),Yt("OverscaledTileID",ko,{omit:["posMatrix"]});class w0{constructor(l,f,p,b=1,A=1,k=1,M=0){if(this.uid=l,f.height!==f.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void J(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=f.height;const R=this.dim=f.height-2;switch(this.data=new Uint32Array(f.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=b,this.greenFactor=A,this.blueFactor=k,this.baseShift=M;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let V=0;V<R;V++)this.data[this._idx(-1,V)]=this.data[this._idx(0,V)],this.data[this._idx(R,V)]=this.data[this._idx(R-1,V)],this.data[this._idx(V,-1)]=this.data[this._idx(V,0)],this.data[this._idx(V,R)]=this.data[this._idx(V,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let V=0;V<R;V++)for(let K=0;K<R;K++){const te=this.get(V,K);te>this.max&&(this.max=te),te<this.min&&(this.min=te)}}get(l,f){const p=new Uint8Array(this.data.buffer),b=4*this._idx(l,f);return this.unpack(p[b],p[b+1],p[b+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,f){if(l<-1||l>=this.dim+1||f<-1||f>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(f+1)*this.stride+(l+1)}unpack(l,f,p){return l*this.redFactor+f*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new Ao({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,f,p){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let b=f*this.dim,A=f*this.dim+this.dim,k=p*this.dim,M=p*this.dim+this.dim;switch(f){case-1:b=A-1;break;case 1:A=b+1}switch(p){case-1:k=M-1;break;case 1:M=k+1}const R=-f*this.dim,V=-p*this.dim;for(let K=k;K<M;K++)for(let te=b;te<A;te++)this.data[this._idx(te,K)]=l.data[this._idx(te+R,K+V)]}}Yt("DEMData",w0);class x0{constructor(l){this._stringToNumber={},this._numberToString=[];for(let f=0;f<l.length;f++){const p=l[f];this._stringToNumber[p]=f,this._numberToString[f]=p}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class A0{constructor(l,f,p,b,A){this.type="Feature",this._vectorTileFeature=l,l._z=f,l._x=p,l._y=b,this.properties=l.properties,this.id=A}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const f in this)f!=="_geometry"&&f!=="_vectorTileFeature"&&(l[f]=this[f]);return l}}class k0{constructor(l,f){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new _a(ti,16,0),this.grid3D=new _a(ti,16,0),this.featureIndexArray=new Li,this.promoteId=f}insert(l,f,p,b,A,k){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,b,A);const R=k?this.grid3D:this.grid;for(let V=0;V<f.length;V++){const K=f[V],te=[1/0,1/0,-1/0,-1/0];for(let se=0;se<K.length;se++){const me=K[se];te[0]=Math.min(te[0],me.x),te[1]=Math.min(te[1],me.y),te[2]=Math.max(te[2],me.x),te[3]=Math.max(te[3],me.y)}te[0]<ti&&te[1]<ti&&te[2]>=0&&te[3]>=0&&R.insert(M,te[0],te[1],te[2],te[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ma.VectorTile(new em(this.rawTileData)).layers,this.sourceLayerCoder=new x0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,f,p,b){this.loadVTLayers();const A=l.params||{},k=ti/l.tileSize/l.scale,M=kc(A.filter),R=l.queryGeometry,V=l.queryPadding*k,K=T0(R),te=this.grid.query(K.minX-V,K.minY-V,K.maxX+V,K.maxY+V),se=T0(l.cameraQueryGeometry),me=this.grid3D.query(se.minX-V,se.minY-V,se.maxX+V,se.maxY+V,(Le,De,Qe,je)=>function(Je,lt,Et,Xt,xn){for(const Ut of Je)if(lt<=Ut.x&&Et<=Ut.y&&Xt>=Ut.x&&xn>=Ut.y)return!0;const Gt=[new v(lt,Et),new v(lt,xn),new v(Xt,xn),new v(Xt,Et)];if(Je.length>2){for(const Ut of Gt)if(pu(Je,Ut))return!0}for(let Ut=0;Ut<Je.length-1;Ut++)if(cx(Je[Ut],Je[Ut+1],Gt))return!0;return!1}(l.cameraQueryGeometry,Le-V,De-V,Qe+V,je+V));for(const Le of me)te.push(Le);te.sort(LA);const ye={};let xe;for(let Le=0;Le<te.length;Le++){const De=te[Le];if(De===xe)continue;xe=De;const Qe=this.featureIndexArray.get(De);let je=null;this.loadMatchingFeature(ye,Qe.bucketIndex,Qe.sourceLayerIndex,Qe.featureIndex,M,A.layers,A.availableImages,f,p,b,(Je,lt,Et)=>(je||(je=dl(Je)),lt.queryIntersectsFeature(R,Je,Et,je,this.z,l.transform,k,l.pixelPosMatrix)))}return ye}loadMatchingFeature(l,f,p,b,A,k,M,R,V,K,te){const se=this.bucketLayerIDs[f];if(k&&!function(Le,De){for(let Qe=0;Qe<Le.length;Qe++)if(De.indexOf(Le[Qe])>=0)return!0;return!1}(k,se))return;const me=this.sourceLayerCoder.decode(p),ye=this.vtLayers[me].feature(b);if(A.needGeometry){const Le=pl(ye,!0);if(!A.filter(new zr(this.tileID.overscaledZ),Le,this.tileID.canonical))return}else if(!A.filter(new zr(this.tileID.overscaledZ),ye))return;const xe=this.getId(ye,me);for(let Le=0;Le<se.length;Le++){const De=se[Le];if(k&&k.indexOf(De)<0)continue;const Qe=R[De];if(!Qe)continue;let je={};xe&&K&&(je=K.getState(Qe.sourceLayer||"_geojsonTileLayer",xe));const Je=ue({},V[De]);Je.paint=S0(Je.paint,Qe.paint,ye,je,M),Je.layout=S0(Je.layout,Qe.layout,ye,je,M);const lt=!te||te(ye,Qe,je);if(!lt)continue;const Et=new A0(ye,this.z,this.x,this.y,xe);Et.layer=Je;let Xt=l[De];Xt===void 0&&(Xt=l[De]=[]),Xt.push({featureIndex:b,feature:Et,intersectionZ:lt})}}lookupSymbolFeatures(l,f,p,b,A,k,M,R){const V={};this.loadVTLayers();const K=kc(A);for(const te of l)this.loadMatchingFeature(V,p,b,te,K,k,M,R,f);return V}hasLayer(l){for(const f of this.bucketLayerIDs)for(const p of f)if(l===p)return!0;return!1}getId(l,f){let p=l.id;return this.promoteId&&(p=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[f]],typeof p=="boolean"&&(p=Number(p))),p}}function S0(c,l,f,p,b){return Q(c,(A,k)=>{const M=l instanceof ul?l.get(k):null;return M&&M.evaluate?M.evaluate(f,p,b):M})}function T0(c){let l=1/0,f=1/0,p=-1/0,b=-1/0;for(const A of c)l=Math.min(l,A.x),f=Math.min(f,A.y),p=Math.max(p,A.x),b=Math.max(b,A.y);return{minX:l,minY:f,maxX:p,maxY:b}}function LA(c,l){return l-c}function C0(c,l,f,p,b){const A=[];for(let k=0;k<c.length;k++){const M=c[k];let R;for(let V=0;V<M.length-1;V++){let K=M[V],te=M[V+1];K.x<l&&te.x<l||(K.x<l?K=new v(l,K.y+(l-K.x)/(te.x-K.x)*(te.y-K.y))._round():te.x<l&&(te=new v(l,K.y+(l-K.x)/(te.x-K.x)*(te.y-K.y))._round()),K.y<f&&te.y<f||(K.y<f?K=new v(K.x+(f-K.y)/(te.y-K.y)*(te.x-K.x),f)._round():te.y<f&&(te=new v(K.x+(f-K.y)/(te.y-K.y)*(te.x-K.x),f)._round()),K.x>=p&&te.x>=p||(K.x>=p?K=new v(p,K.y+(p-K.x)/(te.x-K.x)*(te.y-K.y))._round():te.x>=p&&(te=new v(p,K.y+(p-K.x)/(te.x-K.x)*(te.y-K.y))._round()),K.y>=b&&te.y>=b||(K.y>=b?K=new v(K.x+(b-K.y)/(te.y-K.y)*(te.x-K.x),b)._round():te.y>=b&&(te=new v(K.x+(b-K.y)/(te.y-K.y)*(te.x-K.x),b)._round()),R&&K.equals(R[R.length-1])||(R=[K],A.push(R)),R.push(te)))))}}return A}Yt("FeatureIndex",k0,{omit:["rawTileData","sourceLayerCoder"]});class Pa extends v{constructor(l,f,p,b){super(l,f),this.angle=p,b!==void 0&&(this.segment=b)}clone(){return new Pa(this.x,this.y,this.angle,this.segment)}}function M0(c,l,f,p,b){if(l.segment===void 0||f===0)return!0;let A=l,k=l.segment+1,M=0;for(;M>-f/2;){if(k--,k<0)return!1;M-=c[k].dist(A),A=c[k]}M+=c[k].dist(c[k+1]),k++;const R=[];let V=0;for(;M<f/2;){const K=c[k],te=c[k+1];if(!te)return!1;let se=c[k-1].angleTo(K)-K.angleTo(te);for(se=Math.abs((se+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:M,angleDelta:se}),V+=se;M-R[0].distance>p;)V-=R.shift().angleDelta;if(V>b)return!1;k++,M+=K.dist(te)}return!0}function E0(c){let l=0;for(let f=0;f<c.length-1;f++)l+=c[f].dist(c[f+1]);return l}function I0(c,l,f){return c?.6*l*f:0}function L0(c,l){return Math.max(c?c.right-c.left:0,l?l.right-l.left:0)}function PA(c,l,f,p,b,A){const k=I0(f,b,A),M=L0(f,p)*A;let R=0;const V=E0(c)/2;for(let K=0;K<c.length-1;K++){const te=c[K],se=c[K+1],me=te.dist(se);if(R+me>V){const ye=(V-R)/me,xe=Oi.number(te.x,se.x,ye),Le=Oi.number(te.y,se.y,ye),De=new Pa(xe,Le,se.angleTo(te),K);return De._round(),!k||M0(c,De,M,k,l)?De:void 0}R+=me}}function zA(c,l,f,p,b,A,k,M,R){const V=I0(p,A,k),K=L0(p,b),te=K*k,se=c[0].x===0||c[0].x===R||c[0].y===0||c[0].y===R;return l-te<l/4&&(l=te+l/4),P0(c,se?l/2*M%l:(K/2+2*A)*k*M%l,l,V,f,te,se,!1,R)}function P0(c,l,f,p,b,A,k,M,R){const V=A/2,K=E0(c);let te=0,se=l-f,me=[];for(let ye=0;ye<c.length-1;ye++){const xe=c[ye],Le=c[ye+1],De=xe.dist(Le),Qe=Le.angleTo(xe);for(;se+f<te+De;){se+=f;const je=(se-te)/De,Je=Oi.number(xe.x,Le.x,je),lt=Oi.number(xe.y,Le.y,je);if(Je>=0&&Je<R&&lt>=0&&lt<R&&se-V>=0&&se+V<=K){const Et=new Pa(Je,lt,Qe,ye);Et._round(),p&&!M0(c,Et,A,p,b)||me.push(Et)}}te+=De}return M||me.length||k||(me=P0(c,te/2,f,p,b,A,k,!0,R)),me}Yt("Anchor",Pa);const xu=Ki;function z0(c,l,f,p){const b=[],A=c.image,k=A.pixelRatio,M=A.paddedRect.w-2*xu,R=A.paddedRect.h-2*xu;let V={x1:c.left,y1:c.top,x2:c.right,y2:c.bottom};const K=A.stretchX||[[0,M]],te=A.stretchY||[[0,R]],se=(dt,pn)=>dt+pn[1]-pn[0],me=K.reduce(se,0),ye=te.reduce(se,0),xe=M-me,Le=R-ye;let De=0,Qe=me,je=0,Je=ye,lt=0,Et=xe,Xt=0,xn=Le;if(A.content&&p){const dt=A.content,pn=dt[2]-dt[0],cn=dt[3]-dt[1];(A.textFitWidth||A.textFitHeight)&&(V=s0(c)),De=sd(K,0,dt[0]),je=sd(te,0,dt[1]),Qe=sd(K,dt[0],dt[2]),Je=sd(te,dt[1],dt[3]),lt=dt[0]-De,Xt=dt[1]-je,Et=pn-Qe,xn=cn-Je}const Gt=V.x1,Ut=V.y1,fn=V.x2-Gt,en=V.y2-Ut,Kt=(dt,pn,cn,En)=>{const kr=ad(dt.stretch-De,Qe,fn,Gt),xr=ld(dt.fixed-lt,Et,dt.stretch,me),fi=ad(pn.stretch-je,Je,en,Ut),jo=ld(pn.fixed-Xt,xn,pn.stretch,ye),Si=ad(cn.stretch-De,Qe,fn,Gt),hi=ld(cn.fixed-lt,Et,cn.stretch,me),Ui=ad(En.stretch-je,Je,en,Ut),Vi=ld(En.fixed-Xt,xn,En.stretch,ye),qi=new v(kr,fi),Xr=new v(Si,fi),di=new v(Si,Ui),zi=new v(kr,Ui),Ti=new v(xr/k,jo/k),Gi=new v(hi/k,Vi/k),Ci=l*Math.PI/180;if(Ci){const ar=Math.sin(Ci),Lr=Math.cos(Ci),Fr=[Lr,-ar,ar,Lr];qi._matMult(Fr),Xr._matMult(Fr),zi._matMult(Fr),di._matMult(Fr)}const So=dt.stretch+dt.fixed,Yi=pn.stretch+pn.fixed;return{tl:qi,tr:Xr,bl:zi,br:di,tex:{x:A.paddedRect.x+xu+So,y:A.paddedRect.y+xu+Yi,w:cn.stretch+cn.fixed-So,h:En.stretch+En.fixed-Yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ti,pixelOffsetBR:Gi,minFontScaleX:Et/k/fn,minFontScaleY:xn/k/en,isSDF:f}};if(p&&(A.stretchX||A.stretchY)){const dt=D0(K,xe,me),pn=D0(te,Le,ye);for(let cn=0;cn<dt.length-1;cn++){const En=dt[cn],kr=dt[cn+1];for(let xr=0;xr<pn.length-1;xr++)b.push(Kt(En,pn[xr],kr,pn[xr+1]))}}else b.push(Kt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:R+1}));return b}function sd(c,l,f){let p=0;for(const b of c)p+=Math.max(l,Math.min(f,b[1]))-Math.max(l,Math.min(f,b[0]));return p}function D0(c,l,f){const p=[{fixed:-xu,stretch:0}];for(const[b,A]of c){const k=p[p.length-1];p.push({fixed:b-k.stretch,stretch:k.stretch}),p.push({fixed:b-k.stretch,stretch:k.stretch+(A-b)})}return p.push({fixed:l+xu,stretch:f}),p}function ad(c,l,f,p){return c/l*f+p}function ld(c,l,f,p){return c-l*f/p}class ud{constructor(l,f,p,b,A,k,M,R,V,K){var te;if(this.boxStartIndex=l.length,V){let se=k.top,me=k.bottom;const ye=k.collisionPadding;ye&&(se-=ye[1],me+=ye[3]);let xe=me-se;xe>0&&(xe=Math.max(10,xe),this.circleDiameter=xe)}else{const se=!((te=k.image)===null||te===void 0)&&te.content&&(k.image.textFitWidth||k.image.textFitHeight)?s0(k):{x1:k.left,y1:k.top,x2:k.right,y2:k.bottom};se.y1=se.y1*M-R[0],se.y2=se.y2*M+R[2],se.x1=se.x1*M-R[3],se.x2=se.x2*M+R[1];const me=k.collisionPadding;if(me&&(se.x1-=me[0]*M,se.y1-=me[1]*M,se.x2+=me[2]*M,se.y2+=me[3]*M),K){const ye=new v(se.x1,se.y1),xe=new v(se.x2,se.y1),Le=new v(se.x1,se.y2),De=new v(se.x2,se.y2),Qe=K*Math.PI/180;ye._rotate(Qe),xe._rotate(Qe),Le._rotate(Qe),De._rotate(Qe),se.x1=Math.min(ye.x,xe.x,Le.x,De.x),se.x2=Math.max(ye.x,xe.x,Le.x,De.x),se.y1=Math.min(ye.y,xe.y,Le.y,De.y),se.y2=Math.max(ye.y,xe.y,Le.y,De.y)}l.emplaceBack(f.x,f.y,se.x1,se.y1,se.x2,se.y2,p,b,A)}this.boxEndIndex=l.length}}class DA{constructor(l=[],f=(p,b)=>p<b?-1:p>b?1:0){if(this.data=l,this.length=this.data.length,this.compare=f,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],f=this.data.pop();return--this.length>0&&(this.data[0]=f,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:f,compare:p}=this,b=f[l];for(;l>0;){const A=l-1>>1,k=f[A];if(p(b,k)>=0)break;f[l]=k,l=A}f[l]=b}_down(l){const{data:f,compare:p}=this,b=this.length>>1,A=f[l];for(;l<b;){let k=1+(l<<1);const M=k+1;if(M<this.length&&p(f[M],f[k])<0&&(k=M),p(f[k],A)>=0)break;f[l]=f[k],l=k}f[l]=A}}function RA(c,l=1,f=!1){let p=1/0,b=1/0,A=-1/0,k=-1/0;const M=c[0];for(let me=0;me<M.length;me++){const ye=M[me];(!me||ye.x<p)&&(p=ye.x),(!me||ye.y<b)&&(b=ye.y),(!me||ye.x>A)&&(A=ye.x),(!me||ye.y>k)&&(k=ye.y)}const R=Math.min(A-p,k-b);let V=R/2;const K=new DA([],BA);if(R===0)return new v(p,b);for(let me=p;me<A;me+=R)for(let ye=b;ye<k;ye+=R)K.push(new Au(me+V,ye+V,V,c));let te=function(me){let ye=0,xe=0,Le=0;const De=me[0];for(let Qe=0,je=De.length,Je=je-1;Qe<je;Je=Qe++){const lt=De[Qe],Et=De[Je],Xt=lt.x*Et.y-Et.x*lt.y;xe+=(lt.x+Et.x)*Xt,Le+=(lt.y+Et.y)*Xt,ye+=3*Xt}return new Au(xe/ye,Le/ye,0,me)}(c),se=K.length;for(;K.length;){const me=K.pop();(me.d>te.d||!te.d)&&(te=me,f&&console.log("found best %d after %d probes",Math.round(1e4*me.d)/1e4,se)),me.max-te.d<=l||(V=me.h/2,K.push(new Au(me.p.x-V,me.p.y-V,V,c)),K.push(new Au(me.p.x+V,me.p.y-V,V,c)),K.push(new Au(me.p.x-V,me.p.y+V,V,c)),K.push(new Au(me.p.x+V,me.p.y+V,V,c)),se+=4)}return f&&(console.log(`num probes: ${se}`),console.log(`best distance: ${te.d}`)),te.p}function BA(c,l){return l.max-c.max}function Au(c,l,f,p){this.p=new v(c,l),this.h=f,this.d=function(b,A){let k=!1,M=1/0;for(let R=0;R<A.length;R++){const V=A[R];for(let K=0,te=V.length,se=te-1;K<te;se=K++){const me=V[K],ye=V[se];me.y>b.y!=ye.y>b.y&&b.x<(ye.x-me.x)*(b.y-me.y)/(ye.y-me.y)+me.x&&(k=!k),M=Math.min(M,__(b,me,ye))}}return(k?1:-1)*Math.sqrt(M)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var ki;u.aq=void 0,(ki=u.aq||(u.aq={}))[ki.center=1]="center",ki[ki.left=2]="left",ki[ki.right=3]="right",ki[ki.top=4]="top",ki[ki.bottom=5]="bottom",ki[ki["top-left"]=6]="top-left",ki[ki["top-right"]=7]="top-right",ki[ki["bottom-left"]=8]="bottom-left",ki[ki["bottom-right"]=9]="bottom-right";const za=7,dm=Number.POSITIVE_INFINITY;function R0(c,l){return l[1]!==dm?function(f,p,b){let A=0,k=0;switch(p=Math.abs(p),b=Math.abs(b),f){case"top-right":case"top-left":case"top":k=b-za;break;case"bottom-right":case"bottom-left":case"bottom":k=-b+za}switch(f){case"top-right":case"bottom-right":case"right":A=-p;break;case"top-left":case"bottom-left":case"left":A=p}return[A,k]}(c,l[0],l[1]):function(f,p){let b=0,A=0;p<0&&(p=0);const k=p/Math.SQRT2;switch(f){case"top-right":case"top-left":A=k-za;break;case"bottom-right":case"bottom-left":A=-k+za;break;case"bottom":A=-p+za;break;case"top":A=p-za}switch(f){case"top-right":case"bottom-right":b=-k;break;case"top-left":case"bottom-left":b=k;break;case"left":b=p;break;case"right":b=-p}return[b,A]}(c,l[0])}function B0(c,l,f){var p;const b=c.layout,A=(p=b.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(l,{},f);if(A){const M=A.values,R=[];for(let V=0;V<M.length;V+=2){const K=R[V]=M[V],te=M[V+1].map(se=>se*si);K.startsWith("top")?te[1]-=za:K.startsWith("bottom")&&(te[1]+=za),R[V+1]=te}return new ci(R)}const k=b.get("text-variable-anchor");if(k){let M;M=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[b.get("text-radial-offset").evaluate(l,{},f)*si,dm]:b.get("text-offset").evaluate(l,{},f).map(V=>V*si);const R=[];for(const V of k)R.push(V,R0(V,M));return new ci(R)}return null}function pm(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function FA(c,l,f,p,b,A,k,M,R,V,K){let te=A.textMaxSize.evaluate(l,{});te===void 0&&(te=k);const se=c.layers[0].layout,me=se.get("icon-offset").evaluate(l,{},K),ye=O0(f.horizontal),xe=k/24,Le=c.tilePixelRatio*xe,De=c.tilePixelRatio*te/24,Qe=c.tilePixelRatio*M,je=c.tilePixelRatio*se.get("symbol-spacing"),Je=se.get("text-padding")*c.tilePixelRatio,lt=function(dt,pn,cn,En=1){const kr=dt.get("icon-padding").evaluate(pn,{},cn),xr=kr&&kr.values;return[xr[0]*En,xr[1]*En,xr[2]*En,xr[3]*En]}(se,l,K,c.tilePixelRatio),Et=se.get("text-max-angle")/180*Math.PI,Xt=se.get("text-rotation-alignment")!=="viewport"&&se.get("symbol-placement")!=="point",xn=se.get("icon-rotation-alignment")==="map"&&se.get("symbol-placement")!=="point",Gt=se.get("symbol-placement"),Ut=je/2,fn=se.get("icon-text-fit");let en;p&&fn!=="none"&&(c.allowVerticalPlacement&&f.vertical&&(en=a0(p,f.vertical,fn,se.get("icon-text-fit-padding"),me,xe)),ye&&(p=a0(p,ye,fn,se.get("icon-text-fit-padding"),me,xe)));const Kt=(dt,pn)=>{pn.x<0||pn.x>=ti||pn.y<0||pn.y>=ti||function(cn,En,kr,xr,fi,jo,Si,hi,Ui,Vi,qi,Xr,di,zi,Ti,Gi,Ci,So,Yi,ar,Lr,Fr,so,qr,ku){const vs=cn.addToLineVertexArray(En,kr);let ws,Uo,To,gi,Gs=0,uf=0,U0=0,V0=0,xm=-1,Am=-1;const Zs={};let q0=cu("");if(cn.allowVerticalPlacement&&xr.vertical){const Di=hi.layout.get("text-rotate").evaluate(Lr,{},qr)+90;To=new ud(Ui,En,Vi,qi,Xr,xr.vertical,di,zi,Ti,Di),Si&&(gi=new ud(Ui,En,Vi,qi,Xr,Si,Ci,So,Ti,Di))}if(fi){const Di=hi.layout.get("icon-rotate").evaluate(Lr,{}),Co=hi.layout.get("icon-text-fit")!=="none",gl=z0(fi,Di,so,Co),is=Si?z0(Si,Di,so,Co):void 0;Uo=new ud(Ui,En,Vi,qi,Xr,fi,Ci,So,!1,Di),Gs=4*gl.length;const _l=cn.iconSizeData;let xs=null;_l.kind==="source"?(xs=[bs*hi.layout.get("icon-size").evaluate(Lr,{})],xs[0]>Ia&&J(`${cn.layerIds[0]}: Value for "icon-size" is >= ${rf}. Reduce your "icon-size".`)):_l.kind==="composite"&&(xs=[bs*Fr.compositeIconSizes[0].evaluate(Lr,{},qr),bs*Fr.compositeIconSizes[1].evaluate(Lr,{},qr)],(xs[0]>Ia||xs[1]>Ia)&&J(`${cn.layerIds[0]}: Value for "icon-size" is >= ${rf}. Reduce your "icon-size".`)),cn.addSymbols(cn.icon,gl,xs,ar,Yi,Lr,u.ah.none,En,vs.lineStartIndex,vs.lineLength,-1,qr),xm=cn.icon.placedSymbolArray.length-1,is&&(uf=4*is.length,cn.addSymbols(cn.icon,is,xs,ar,Yi,Lr,u.ah.vertical,En,vs.lineStartIndex,vs.lineLength,-1,qr),Am=cn.icon.placedSymbolArray.length-1)}const G0=Object.keys(xr.horizontal);for(const Di of G0){const Co=xr.horizontal[Di];if(!ws){q0=cu(Co.text);const is=hi.layout.get("text-rotate").evaluate(Lr,{},qr);ws=new ud(Ui,En,Vi,qi,Xr,Co,di,zi,Ti,is)}const gl=Co.positionedLines.length===1;if(U0+=F0(cn,En,Co,jo,hi,Ti,Lr,Gi,vs,xr.vertical?u.ah.horizontal:u.ah.horizontalOnly,gl?G0:[Di],Zs,xm,Fr,qr),gl)break}xr.vertical&&(V0+=F0(cn,En,xr.vertical,jo,hi,Ti,Lr,Gi,vs,u.ah.vertical,["vertical"],Zs,Am,Fr,qr));const $A=ws?ws.boxStartIndex:cn.collisionBoxArray.length,jA=ws?ws.boxEndIndex:cn.collisionBoxArray.length,UA=To?To.boxStartIndex:cn.collisionBoxArray.length,VA=To?To.boxEndIndex:cn.collisionBoxArray.length,qA=Uo?Uo.boxStartIndex:cn.collisionBoxArray.length,GA=Uo?Uo.boxEndIndex:cn.collisionBoxArray.length,ZA=gi?gi.boxStartIndex:cn.collisionBoxArray.length,HA=gi?gi.boxEndIndex:cn.collisionBoxArray.length;let rs=-1;const fd=(Di,Co)=>Di&&Di.circleDiameter?Math.max(Di.circleDiameter,Co):Co;rs=fd(ws,rs),rs=fd(To,rs),rs=fd(Uo,rs),rs=fd(gi,rs);const Z0=rs>-1?1:0;Z0&&(rs*=ku/si),cn.glyphOffsetArray.length>=wu.MAX_GLYPHS&&J("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Lr.sortKey!==void 0&&cn.addToSortKeyRanges(cn.symbolInstances.length,Lr.sortKey);const WA=B0(hi,Lr,qr),[XA,JA]=function(Di,Co){const gl=Di.length,is=Co==null?void 0:Co.values;if((is==null?void 0:is.length)>0)for(let _l=0;_l<is.length;_l+=2){const xs=is[_l+1];Di.emplaceBack(u.aq[is[_l]],xs[0],xs[1])}return[gl,Di.length]}(cn.textAnchorOffsets,WA);cn.symbolInstances.emplaceBack(En.x,En.y,Zs.right>=0?Zs.right:-1,Zs.center>=0?Zs.center:-1,Zs.left>=0?Zs.left:-1,Zs.vertical||-1,xm,Am,q0,$A,jA,UA,VA,qA,GA,ZA,HA,Vi,U0,V0,Gs,uf,Z0,0,di,rs,XA,JA)}(c,pn,dt,f,p,b,en,c.layers[0],c.collisionBoxArray,l.index,l.sourceLayerIndex,c.index,Le,[Je,Je,Je,Je],Xt,R,Qe,lt,xn,me,l,A,V,K,k)};if(Gt==="line")for(const dt of C0(l.geometry,0,0,ti,ti)){const pn=zA(dt,je,Et,f.vertical||ye,p,24,De,c.overscaling,ti);for(const cn of pn)ye&&OA(c,ye.text,Ut,cn)||Kt(dt,cn)}else if(Gt==="line-center"){for(const dt of l.geometry)if(dt.length>1){const pn=PA(dt,Et,f.vertical||ye,p,24,De);pn&&Kt(dt,pn)}}else if(l.type==="Polygon")for(const dt of $l(l.geometry,0)){const pn=RA(dt,16);Kt(dt[0],new Pa(pn.x,pn.y,0))}else if(l.type==="LineString")for(const dt of l.geometry)Kt(dt,new Pa(dt[0].x,dt[0].y,0));else if(l.type==="Point")for(const dt of l.geometry)for(const pn of dt)Kt([pn],new Pa(pn.x,pn.y,0))}function F0(c,l,f,p,b,A,k,M,R,V,K,te,se,me,ye){const xe=function(Qe,je,Je,lt,Et,Xt,xn,Gt){const Ut=lt.layout.get("text-rotate").evaluate(Xt,{})*Math.PI/180,fn=[];for(const en of je.positionedLines)for(const Kt of en.positionedGlyphs){if(!Kt.rect)continue;const dt=Kt.rect||{};let pn=Q_+1,cn=!0,En=1,kr=0;const xr=(Et||Gt)&&Kt.vertical,fi=Kt.metrics.advance*Kt.scale/2;if(Gt&&je.verticalizable&&(kr=en.lineOffset/2-(Kt.imageName?-(si-Kt.metrics.width*Kt.scale)/2:(Kt.scale-1)*si)),Kt.imageName){const ar=xn[Kt.imageName];cn=ar.sdf,En=ar.pixelRatio,pn=Ki/En}const jo=Et?[Kt.x+fi,Kt.y]:[0,0];let Si=Et?[0,0]:[Kt.x+fi+Je[0],Kt.y+Je[1]-kr],hi=[0,0];xr&&(hi=Si,Si=[0,0]);const Ui=Kt.metrics.isDoubleResolution?2:1,Vi=(Kt.metrics.left-pn)*Kt.scale-fi+Si[0],qi=(-Kt.metrics.top-pn)*Kt.scale+Si[1],Xr=Vi+dt.w/Ui*Kt.scale/En,di=qi+dt.h/Ui*Kt.scale/En,zi=new v(Vi,qi),Ti=new v(Xr,qi),Gi=new v(Vi,di),Ci=new v(Xr,di);if(xr){const ar=new v(-fi,fi-tf),Lr=-Math.PI/2,Fr=si/2-fi,so=new v(5-tf-Fr,-(Kt.imageName?Fr:0)),qr=new v(...hi);zi._rotateAround(Lr,ar)._add(so)._add(qr),Ti._rotateAround(Lr,ar)._add(so)._add(qr),Gi._rotateAround(Lr,ar)._add(so)._add(qr),Ci._rotateAround(Lr,ar)._add(so)._add(qr)}if(Ut){const ar=Math.sin(Ut),Lr=Math.cos(Ut),Fr=[Lr,-ar,ar,Lr];zi._matMult(Fr),Ti._matMult(Fr),Gi._matMult(Fr),Ci._matMult(Fr)}const So=new v(0,0),Yi=new v(0,0);fn.push({tl:zi,tr:Ti,bl:Gi,br:Ci,tex:dt,writingMode:je.writingMode,glyphOffset:jo,sectionIndex:Kt.sectionIndex,isSDF:cn,pixelOffsetTL:So,pixelOffsetBR:Yi,minFontScaleX:0,minFontScaleY:0})}return fn}(0,f,M,b,A,k,p,c.allowVerticalPlacement),Le=c.textSizeData;let De=null;Le.kind==="source"?(De=[bs*b.layout.get("text-size").evaluate(k,{})],De[0]>Ia&&J(`${c.layerIds[0]}: Value for "text-size" is >= ${rf}. Reduce your "text-size".`)):Le.kind==="composite"&&(De=[bs*me.compositeTextSizes[0].evaluate(k,{},ye),bs*me.compositeTextSizes[1].evaluate(k,{},ye)],(De[0]>Ia||De[1]>Ia)&&J(`${c.layerIds[0]}: Value for "text-size" is >= ${rf}. Reduce your "text-size".`)),c.addSymbols(c.text,xe,De,M,A,k,V,l,R.lineStartIndex,R.lineLength,se,ye);for(const Qe of K)te[Qe]=c.text.placedSymbolArray.length-1;return 4*xe.length}function O0(c){for(const l in c)return c[l];return null}function OA(c,l,f,p){const b=c.compareText;if(l in b){const A=b[l];for(let k=A.length-1;k>=0;k--)if(p.dist(A[k])<f)return!0}else b[l]=[];return b[l].push(p),!1}const N0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mm{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[f,p]=new Uint8Array(l,0,2);if(f!==219)throw new Error("Data does not appear to be in a KDBush format.");const b=p>>4;if(b!==1)throw new Error(`Got v${b} data when expected v1.`);const A=N0[15&p];if(!A)throw new Error("Unrecognized array type.");const[k]=new Uint16Array(l,2,1),[M]=new Uint32Array(l,4,1);return new mm(M,k,A,l)}constructor(l,f=64,p=Float64Array,b){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+f,2),65535),this.ArrayType=p,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const A=N0.indexOf(this.ArrayType),k=2*l*this.ArrayType.BYTES_PER_ELEMENT,M=l*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-M%8)%8;if(A<0)throw new Error(`Unexpected typed array class: ${p}.`);b&&b instanceof ArrayBuffer?(this.data=b,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+M+R,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+k+M+R),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+M+R,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+A]),new Uint16Array(this.data,2,1)[0]=f,new Uint32Array(this.data,4,1)[0]=l)}add(l,f){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=l,this.coords[this._pos++]=f,p}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return gm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,f,p,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:A,coords:k,nodeSize:M}=this,R=[0,A.length-1,0],V=[];for(;R.length;){const K=R.pop()||0,te=R.pop()||0,se=R.pop()||0;if(te-se<=M){for(let Le=se;Le<=te;Le++){const De=k[2*Le],Qe=k[2*Le+1];De>=l&&De<=p&&Qe>=f&&Qe<=b&&V.push(A[Le])}continue}const me=se+te>>1,ye=k[2*me],xe=k[2*me+1];ye>=l&&ye<=p&&xe>=f&&xe<=b&&V.push(A[me]),(K===0?l<=ye:f<=xe)&&(R.push(se),R.push(me-1),R.push(1-K)),(K===0?p>=ye:b>=xe)&&(R.push(me+1),R.push(te),R.push(1-K))}return V}within(l,f,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:A,nodeSize:k}=this,M=[0,b.length-1,0],R=[],V=p*p;for(;M.length;){const K=M.pop()||0,te=M.pop()||0,se=M.pop()||0;if(te-se<=k){for(let Le=se;Le<=te;Le++)j0(A[2*Le],A[2*Le+1],l,f)<=V&&R.push(b[Le]);continue}const me=se+te>>1,ye=A[2*me],xe=A[2*me+1];j0(ye,xe,l,f)<=V&&R.push(b[me]),(K===0?l-p<=ye:f-p<=xe)&&(M.push(se),M.push(me-1),M.push(1-K)),(K===0?l+p>=ye:f+p>=xe)&&(M.push(me+1),M.push(te),M.push(1-K))}return R}}function gm(c,l,f,p,b,A){if(b-p<=f)return;const k=p+b>>1;$0(c,l,k,p,b,A),gm(c,l,f,p,k-1,1-A),gm(c,l,f,k+1,b,1-A)}function $0(c,l,f,p,b,A){for(;b>p;){if(b-p>600){const V=b-p+1,K=f-p+1,te=Math.log(V),se=.5*Math.exp(2*te/3),me=.5*Math.sqrt(te*se*(V-se)/V)*(K-V/2<0?-1:1);$0(c,l,f,Math.max(p,Math.floor(f-K*se/V+me)),Math.min(b,Math.floor(f+(V-K)*se/V+me)),A)}const k=l[2*f+A];let M=p,R=b;for(af(c,l,p,f),l[2*b+A]>k&&af(c,l,p,b);M<R;){for(af(c,l,M,R),M++,R--;l[2*M+A]<k;)M++;for(;l[2*R+A]>k;)R--}l[2*p+A]===k?af(c,l,p,R):(R++,af(c,l,R,b)),R<=f&&(p=R+1),f<=R&&(b=R-1)}}function af(c,l,f,p){_m(c,f,p),_m(l,2*f,2*p),_m(l,2*f+1,2*p+1)}function _m(c,l,f){const p=c[l];c[l]=c[f],c[f]=p}function j0(c,l,f,p){const b=c-f,A=l-p;return b*b+A*A}var ym;u.bg=void 0,(ym=u.bg||(u.bg={})).create="create",ym.load="load",ym.fullLoad="fullLoad";let cd=null,lf=[];const bm=1e3/60,vm="loadTime",wm="fullLoadTime",NA={mark(c){performance.mark(c)},frame(c){const l=c;cd!=null&&lf.push(l-cd),cd=l},clearMetrics(){cd=null,lf=[],performance.clearMeasures(vm),performance.clearMeasures(wm);for(const c in u.bg)performance.clearMarks(u.bg[c])},getPerformanceMetrics(){performance.measure(vm,u.bg.create,u.bg.load),performance.measure(wm,u.bg.create,u.bg.fullLoad);const c=performance.getEntriesByName(vm)[0].duration,l=performance.getEntriesByName(wm)[0].duration,f=lf.length,p=1/(lf.reduce((A,k)=>A+k,0)/f/1e3),b=lf.filter(A=>A>bm).reduce((A,k)=>A+(k-bm)/bm,0);return{loadTime:c,fullLoadTime:l,fps:p,percentDroppedFrames:b/(f+b)*100,totalFrames:f}}};u.$=class extends re{},u.A=mu,u.B=Ep,u.C=function(c){if(ge==null){const l=c.navigator?c.navigator.userAgent:null;ge=!!c.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return ge},u.D=an,u.E=qt,u.F=class{constructor(c,l){this.target=c,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new IA(()=>this.process()),this.subscription=function(f,p,b,A){return f.addEventListener(p,b,!1),{unsubscribe:()=>{f.removeEventListener(p,b,!1)}}}(this.target,"message",f=>this.receive(f)),this.globalScope=ke(self)?c:window}registerMessageHandler(c,l){this.messageHandlers[c]=l}sendAsync(c,l){return new Promise((f,p)=>{const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[b]={resolve:f,reject:p},l&&l.signal.addEventListener("abort",()=>{delete this.resolveRejects[b];const M={id:b,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(M)},{once:!0});const A=[],k=Object.assign(Object.assign({},c),{id:b,sourceMapId:this.mapId,origin:location.origin,data:ya(c.data,A)});this.target.postMessage(k,{transfer:A})})}receive(c){const l=c.data,f=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[f];const p=this.abortControllers[f];return delete this.abortControllers[f],void(p&&p.abort())}if(ke(self)||l.mustQueue)return this.tasks[f]=l,this.taskQueue.push(f),void this.invoker.trigger();this.processTask(f,l)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),l=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(c,l)}processTask(c,l){return a(this,void 0,void 0,function*(){if(l.type==="<response>"){const b=this.resolveRejects[c];return delete this.resolveRejects[c],b?void(l.error?b.reject(ba(l.error)):b.resolve(ba(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const f=ba(l.data),p=new AbortController;this.abortControllers[c]=p;try{const b=yield this.messageHandlers[l.type](l.sourceMapId,f,p);this.completeTask(c,null,b)}catch(b){this.completeTask(c,b)}})}completeTask(c,l,f){const p=[];delete this.abortControllers[c];const b={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?ya(l):null,data:ya(f,p)};this.target.postMessage(b,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.G=ft,u.H=function(){var c=new mu(16);return mu!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.I=nm,u.J=function(c,l,f){var p,b,A,k,M,R,V,K,te,se,me,ye,xe=f[0],Le=f[1],De=f[2];return l===c?(c[12]=l[0]*xe+l[4]*Le+l[8]*De+l[12],c[13]=l[1]*xe+l[5]*Le+l[9]*De+l[13],c[14]=l[2]*xe+l[6]*Le+l[10]*De+l[14],c[15]=l[3]*xe+l[7]*Le+l[11]*De+l[15]):(b=l[1],A=l[2],k=l[3],M=l[4],R=l[5],V=l[6],K=l[7],te=l[8],se=l[9],me=l[10],ye=l[11],c[0]=p=l[0],c[1]=b,c[2]=A,c[3]=k,c[4]=M,c[5]=R,c[6]=V,c[7]=K,c[8]=te,c[9]=se,c[10]=me,c[11]=ye,c[12]=p*xe+M*Le+te*De+l[12],c[13]=b*xe+R*Le+se*De+l[13],c[14]=A*xe+V*Le+me*De+l[14],c[15]=k*xe+K*Le+ye*De+l[15]),c},u.K=function(c,l,f){var p=f[0],b=f[1],A=f[2];return c[0]=l[0]*p,c[1]=l[1]*p,c[2]=l[2]*p,c[3]=l[3]*p,c[4]=l[4]*b,c[5]=l[5]*b,c[6]=l[6]*b,c[7]=l[7]*b,c[8]=l[8]*A,c[9]=l[9]*A,c[10]=l[10]*A,c[11]=l[11]*A,c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15],c},u.L=w_,u.M=function(c,l){const f={};for(let p=0;p<l.length;p++){const b=l[p];b in c&&(f[b]=c[b])}return f},u.N=La,u.O=g0,u.P=v,u.Q=_0,u.R=Ao,u.S=ko,u.T=ou,u.U=D,u.V=I,u.W=Pe,u.X=ti,u.Y=E,u.Z=of,u._=a,u.a=it,u.a$=function(c,l){var f=c[0],p=c[1],b=c[2],A=c[3],k=c[4],M=c[5],R=c[6],V=c[7],K=c[8],te=c[9],se=c[10],me=c[11],ye=c[12],xe=c[13],Le=c[14],De=c[15],Qe=l[0],je=l[1],Je=l[2],lt=l[3],Et=l[4],Xt=l[5],xn=l[6],Gt=l[7],Ut=l[8],fn=l[9],en=l[10],Kt=l[11],dt=l[12],pn=l[13],cn=l[14],En=l[15];return Math.abs(f-Qe)<=ji*Math.max(1,Math.abs(f),Math.abs(Qe))&&Math.abs(p-je)<=ji*Math.max(1,Math.abs(p),Math.abs(je))&&Math.abs(b-Je)<=ji*Math.max(1,Math.abs(b),Math.abs(Je))&&Math.abs(A-lt)<=ji*Math.max(1,Math.abs(A),Math.abs(lt))&&Math.abs(k-Et)<=ji*Math.max(1,Math.abs(k),Math.abs(Et))&&Math.abs(M-Xt)<=ji*Math.max(1,Math.abs(M),Math.abs(Xt))&&Math.abs(R-xn)<=ji*Math.max(1,Math.abs(R),Math.abs(xn))&&Math.abs(V-Gt)<=ji*Math.max(1,Math.abs(V),Math.abs(Gt))&&Math.abs(K-Ut)<=ji*Math.max(1,Math.abs(K),Math.abs(Ut))&&Math.abs(te-fn)<=ji*Math.max(1,Math.abs(te),Math.abs(fn))&&Math.abs(se-en)<=ji*Math.max(1,Math.abs(se),Math.abs(en))&&Math.abs(me-Kt)<=ji*Math.max(1,Math.abs(me),Math.abs(Kt))&&Math.abs(ye-dt)<=ji*Math.max(1,Math.abs(ye),Math.abs(dt))&&Math.abs(xe-pn)<=ji*Math.max(1,Math.abs(xe),Math.abs(pn))&&Math.abs(Le-cn)<=ji*Math.max(1,Math.abs(Le),Math.abs(cn))&&Math.abs(De-En)<=ji*Math.max(1,Math.abs(De),Math.abs(En))},u.a0=Jn,u.a1=hm,u.a2=vt,u.a3=c=>{const l=window.document.createElement("video");return l.muted=!0,new Promise(f=>{l.onloadstart=()=>{f(l)};for(const p of c){const b=window.document.createElement("source");Qt(p)||(l.crossOrigin="Anonymous"),b.src=p,l.appendChild(b)}})},u.a4=function(){return $++},u.a5=Wt,u.a6=wu,u.a7=kc,u.a8=pl,u.a9=A0,u.aA=function(c){if(c.type==="custom")return new EA(c);switch(c.type){case"background":return new TA(c);case"circle":return new dx(c);case"fill":return new Ix(c);case"fill-extrusion":return new Gx(c);case"heatmap":return new mx(c);case"hillshade":return new _x(c);case"line":return new Qx(c);case"raster":return new MA(c);case"symbol":return new od(c)}},u.aB=F,u.aC=function(c,l){if(!c)return[{command:"setStyle",args:[l]}];let f=[];try{if(!Ye(c.version,l.version))return[{command:"setStyle",args:[l]}];Ye(c.center,l.center)||f.push({command:"setCenter",args:[l.center]}),Ye(c.zoom,l.zoom)||f.push({command:"setZoom",args:[l.zoom]}),Ye(c.bearing,l.bearing)||f.push({command:"setBearing",args:[l.bearing]}),Ye(c.pitch,l.pitch)||f.push({command:"setPitch",args:[l.pitch]}),Ye(c.sprite,l.sprite)||f.push({command:"setSprite",args:[l.sprite]}),Ye(c.glyphs,l.glyphs)||f.push({command:"setGlyphs",args:[l.glyphs]}),Ye(c.transition,l.transition)||f.push({command:"setTransition",args:[l.transition]}),Ye(c.light,l.light)||f.push({command:"setLight",args:[l.light]}),Ye(c.terrain,l.terrain)||f.push({command:"setTerrain",args:[l.terrain]}),Ye(c.sky,l.sky)||f.push({command:"setSky",args:[l.sky]}),Ye(c.projection,l.projection)||f.push({command:"setProjection",args:[l.projection]});const p={},b=[];(function(k,M,R,V){let K;for(K in M=M||{},k=k||{})Object.prototype.hasOwnProperty.call(k,K)&&(Object.prototype.hasOwnProperty.call(M,K)||Rn(K,R,V));for(K in M)Object.prototype.hasOwnProperty.call(M,K)&&(Object.prototype.hasOwnProperty.call(k,K)?Ye(k[K],M[K])||(k[K].type==="geojson"&&M[K].type==="geojson"&&un(k,M,K)?Ft(R,{command:"setGeoJSONSourceData",args:[K,M[K].data]}):fr(K,M,R,V)):Tt(K,M,R))})(c.sources,l.sources,b,p);const A=[];c.layers&&c.layers.forEach(k=>{"source"in k&&p[k.source]?f.push({command:"removeLayer",args:[k.id]}):A.push(k)}),f=f.concat(b),function(k,M,R){M=M||[];const V=(k=k||[]).map(Mt),K=M.map(Mt),te=k.reduce(Vr,{}),se=M.reduce(Vr,{}),me=V.slice(),ye=Object.create(null);let xe,Le,De,Qe,je;for(let Je=0,lt=0;Je<V.length;Je++)xe=V[Je],Object.prototype.hasOwnProperty.call(se,xe)?lt++:(Ft(R,{command:"removeLayer",args:[xe]}),me.splice(me.indexOf(xe,lt),1));for(let Je=0,lt=0;Je<K.length;Je++)xe=K[K.length-1-Je],me[me.length-1-Je]!==xe&&(Object.prototype.hasOwnProperty.call(te,xe)?(Ft(R,{command:"removeLayer",args:[xe]}),me.splice(me.lastIndexOf(xe,me.length-lt),1)):lt++,Qe=me[me.length-Je],Ft(R,{command:"addLayer",args:[se[xe],Qe]}),me.splice(me.length-Je,0,xe),ye[xe]=!0);for(let Je=0;Je<K.length;Je++)if(xe=K[Je],Le=te[xe],De=se[xe],!ye[xe]&&!Ye(Le,De))if(Ye(Le.source,De.source)&&Ye(Le["source-layer"],De["source-layer"])&&Ye(Le.type,De.type)){for(je in Dt(Le.layout,De.layout,R,xe,null,"setLayoutProperty"),Dt(Le.paint,De.paint,R,xe,null,"setPaintProperty"),Ye(Le.filter,De.filter)||Ft(R,{command:"setFilter",args:[xe,De.filter]}),Ye(Le.minzoom,De.minzoom)&&Ye(Le.maxzoom,De.maxzoom)||Ft(R,{command:"setLayerZoomRange",args:[xe,De.minzoom,De.maxzoom]}),Le)Object.prototype.hasOwnProperty.call(Le,je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Dt(Le[je],De[je],R,xe,je.slice(6),"setPaintProperty"):Ye(Le[je],De[je])||Ft(R,{command:"setLayerProperty",args:[xe,je,De[je]]}));for(je in De)Object.prototype.hasOwnProperty.call(De,je)&&!Object.prototype.hasOwnProperty.call(Le,je)&&je!=="layout"&&je!=="paint"&&je!=="filter"&&je!=="metadata"&&je!=="minzoom"&&je!=="maxzoom"&&(je.indexOf("paint.")===0?Dt(Le[je],De[je],R,xe,je.slice(6),"setPaintProperty"):Ye(Le[je],De[je])||Ft(R,{command:"setLayerProperty",args:[xe,je,De[je]]}))}else Ft(R,{command:"removeLayer",args:[xe]}),Qe=me[me.lastIndexOf(xe)+1],Ft(R,{command:"addLayer",args:[De,Qe]})}(A,l.layers,f)}catch(p){console.warn("Unable to compute style diff:",p),f=[{command:"setStyle",args:[l]}]}return f},u.aD=function(c){const l=[],f=c.id;return f===void 0&&l.push({message:`layers.${f}: missing required property "id"`}),c.render===void 0&&l.push({message:`layers.${f}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&l.push({message:`layers.${f}: property "renderingMode" must be either "2d" or "3d"`}),l},u.aE=function c(l,f){if(Array.isArray(l)){if(!Array.isArray(f)||l.length!==f.length)return!1;for(let p=0;p<l.length;p++)if(!c(l[p],f[p]))return!1;return!0}if(typeof l=="object"&&l!==null&&f!==null){if(typeof f!="object"||Object.keys(l).length!==Object.keys(f).length)return!1;for(const p in l)if(!c(l[p],f[p]))return!1;return!0}return l===f},u.aF=Q,u.aG=ne,u.aH=class extends fl{constructor(c,l){super(c,l),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aI=Zh,u.aJ=class extends fl{constructor(c,l){super(c,l),this.current=ox}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let l=1;l<16;l++)if(c[l]!==this.current[l]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aK=c_,u.aL=f_,u.aM=gn,u.aN=class extends fl{constructor(c,l){super(c,l),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aO=class extends fl{constructor(c,l){super(c,l),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aP=function(c,l,f,p,b,A,k){var M=1/(l-f),R=1/(p-b),V=1/(A-k);return c[0]=-2*M,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*R,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*V,c[11]=0,c[12]=(l+f)*M,c[13]=(b+p)*R,c[14]=(k+A)*V,c[15]=1,c},u.aQ=hx,u.aR=class extends qe{},u.aS=rA,u.aT=class extends nt{},u.aU=qp,u.aV=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aW=T_,u.aX=xi,u.aY=xo,u.aZ=class extends ln{},u.a_=function(c,l){return c[0]===l[0]&&c[1]===l[1]&&c[2]===l[2]&&c[3]===l[3]&&c[4]===l[4]&&c[5]===l[5]&&c[6]===l[6]&&c[7]===l[7]&&c[8]===l[8]&&c[9]===l[9]&&c[10]===l[10]&&c[11]===l[11]&&c[12]===l[12]&&c[13]===l[13]&&c[14]===l[14]&&c[15]===l[15]},u.aa=function(c){const l={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(f,p,b,A)=>{const k=b||A;return l[p]=!k||k.toLowerCase(),""}),l["max-age"]){const f=parseInt(l["max-age"],10);isNaN(f)?delete l["max-age"]:l["max-age"]=f}return l},u.ab=function(c,l){const f=[];for(const p in c)p in l||f.push(p);return f},u.ac=ee,u.ad=function(c,l,f){var p=Math.sin(f),b=Math.cos(f),A=l[0],k=l[1],M=l[2],R=l[3],V=l[4],K=l[5],te=l[6],se=l[7];return l!==c&&(c[8]=l[8],c[9]=l[9],c[10]=l[10],c[11]=l[11],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[0]=A*b+V*p,c[1]=k*b+K*p,c[2]=M*b+te*p,c[3]=R*b+se*p,c[4]=V*b-A*p,c[5]=K*b-k*p,c[6]=te*b-M*p,c[7]=se*b-R*p,c},u.ae=function(c){var l=new mu(16);return l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5],l[6]=c[6],l[7]=c[7],l[8]=c[8],l[9]=c[9],l[10]=c[10],l[11]=c[11],l[12]=c[12],l[13]=c[13],l[14]=c[14],l[15]=c[15],l},u.af=Jh,u.ag=function(c,l){let f=0,p=0;if(c.kind==="constant")p=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:b,minZoom:A,maxZoom:k}=c,M=b?ee(Ni.interpolationFactor(b,l,A,k),0,1):0;c.kind==="camera"?p=Oi.number(c.minSize,c.maxSize,M):f=M}return{uSizeT:f,uSize:p}},u.ai=function(c,{uSize:l,uSizeT:f},{lowerSize:p,upperSize:b}){return c.kind==="source"?p/bs:c.kind==="composite"?Oi.number(p/bs,b/bs,f):l},u.aj=sm,u.ak=function(c,l,f,p){const b=l.y-c.y,A=l.x-c.x,k=p.y-f.y,M=p.x-f.x,R=k*A-M*b;if(R===0)return null;const V=(M*(c.y-f.y)-k*(c.x-f.x))/R;return new v(c.x+V*A,c.y+V*b)},u.al=C0,u.am=m_,u.an=jp,u.ao=function(c){let l=1/0,f=1/0,p=-1/0,b=-1/0;for(const A of c)l=Math.min(l,A.x),f=Math.min(f,A.y),p=Math.max(p,A.x),b=Math.max(b,A.y);return[l,f,p,b]},u.ap=si,u.ar=om,u.as=function(c,l){var f=l[0],p=l[1],b=l[2],A=l[3],k=l[4],M=l[5],R=l[6],V=l[7],K=l[8],te=l[9],se=l[10],me=l[11],ye=l[12],xe=l[13],Le=l[14],De=l[15],Qe=f*M-p*k,je=f*R-b*k,Je=f*V-A*k,lt=p*R-b*M,Et=p*V-A*M,Xt=b*V-A*R,xn=K*xe-te*ye,Gt=K*Le-se*ye,Ut=K*De-me*ye,fn=te*Le-se*xe,en=te*De-me*xe,Kt=se*De-me*Le,dt=Qe*Kt-je*en+Je*fn+lt*Ut-Et*Gt+Xt*xn;return dt?(c[0]=(M*Kt-R*en+V*fn)*(dt=1/dt),c[1]=(b*en-p*Kt-A*fn)*dt,c[2]=(xe*Xt-Le*Et+De*lt)*dt,c[3]=(se*Et-te*Xt-me*lt)*dt,c[4]=(R*Ut-k*Kt-V*Gt)*dt,c[5]=(f*Kt-b*Ut+A*Gt)*dt,c[6]=(Le*Je-ye*Xt-De*je)*dt,c[7]=(K*Xt-se*Je+me*je)*dt,c[8]=(k*en-M*Ut+V*xn)*dt,c[9]=(p*Ut-f*en-A*xn)*dt,c[10]=(ye*Et-xe*Je+De*Qe)*dt,c[11]=(te*Je-K*Et-me*Qe)*dt,c[12]=(M*Gt-k*fn-R*xn)*dt,c[13]=(f*fn-p*Gt+b*xn)*dt,c[14]=(xe*je-ye*lt-Le*Qe)*dt,c[15]=(K*lt-te*je+se*Qe)*dt,c):null},u.at=pm,u.au=im,u.av=mm,u.aw=function(){const c={},l=Ge.$version;for(const f in Ge.$root){const p=Ge.$root[f];if(p.required){let b=null;b=f==="version"?l:p.type==="array"?[]:{},b!=null&&(c[f]=b)}}return c},u.ax=Oc,u.ay=xt,u.az=function(c){c=c.slice();const l=Object.create(null);for(let f=0;f<c.length;f++)l[c[f].id]=c[f];for(let f=0;f<c.length;f++)"ref"in c[f]&&(c[f]=nn(c[f],l[c[f].ref]));return c},u.b=ve,u.b0=function(c,l){return c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],c[4]=l[4],c[5]=l[5],c[6]=l[6],c[7]=l[7],c[8]=l[8],c[9]=l[9],c[10]=l[10],c[11]=l[11],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15],c},u.b1=function(c,l,f){return c[0]=l[0]*f[0],c[1]=l[1]*f[1],c[2]=l[2]*f[2],c[3]=l[3]*f[3],c},u.b2=function(c,l){return c[0]*l[0]+c[1]*l[1]+c[2]*l[2]+c[3]*l[3]},u.b3=X,u.b4=v0,u.b5=y0,u.b6=function(c,l,f,p,b){var A,k=1/Math.tan(l/2);return c[0]=k/f,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=k,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,b!=null&&b!==1/0?(c[10]=(b+p)*(A=1/(p-b)),c[14]=2*b*p*A):(c[10]=-1,c[14]=-2*p),c},u.b7=function(c,l,f){var p=Math.sin(f),b=Math.cos(f),A=l[4],k=l[5],M=l[6],R=l[7],V=l[8],K=l[9],te=l[10],se=l[11];return l!==c&&(c[0]=l[0],c[1]=l[1],c[2]=l[2],c[3]=l[3],c[12]=l[12],c[13]=l[13],c[14]=l[14],c[15]=l[15]),c[4]=A*b+V*p,c[5]=k*b+K*p,c[6]=M*b+te*p,c[7]=R*b+se*p,c[8]=V*b-A*p,c[9]=K*b-k*p,c[10]=te*b-M*p,c[11]=se*b-R*p,c},u.b8=U,u.b9=O,u.bA=Z_,u.bB=function(c){return c.message===ot},u.bC=ha,u.bD=Xi,u.ba=function(c){return c*Math.PI/180},u.bb=function(c,l){const{x:f,y:p}=of.fromLngLat(l);return!(c<0||c>25||p<0||p>=1||f<0||f>=1)},u.bc=function(c,l){return c[0]=l[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=l[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=l[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bd=class extends Y{},u.be=cm,u.bf=NA,u.bh=Ct,u.bi=function(c,l){it.REGISTERED_PROTOCOLS[c]=l},u.bj=function(c){delete it.REGISTERED_PROTOCOLS[c]},u.bk=function(c,l){const f={};for(let b=0;b<c.length;b++){const A=l&&l[c[b].id]||Dh(c[b]);l&&(l[c[b].id]=A);let k=f[A];k||(k=f[A]=[]),k.push(c[b])}const p=[];for(const b in f)p.push(f[b]);return p},u.bl=Yt,u.bm=x0,u.bn=k0,u.bo=t0,u.bp=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=ti/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const l=c.bucket.layers[0],f=l.layout,p=l._unevaluatedLayout._values,b={layoutIconSize:p["icon-size"].possiblyEvaluate(new zr(c.bucket.zoom+1),c.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new zr(c.bucket.zoom+1),c.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new zr(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:K}=c.bucket.textSizeData;b.compositeTextSizes=[p["text-size"].possiblyEvaluate(new zr(V),c.canonical),p["text-size"].possiblyEvaluate(new zr(K),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:K}=c.bucket.iconSizeData;b.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new zr(V),c.canonical),p["icon-size"].possiblyEvaluate(new zr(K),c.canonical)]}const A=f.get("text-line-height")*si,k=f.get("text-rotation-alignment")!=="viewport"&&f.get("symbol-placement")!=="point",M=f.get("text-keep-upright"),R=f.get("text-size");for(const V of c.bucket.features){const K=f.get("text-font").evaluate(V,{},c.canonical).join(","),te=R.evaluate(V,{},c.canonical),se=b.layoutTextSize.evaluate(V,{},c.canonical),me=b.layoutIconSize.evaluate(V,{},c.canonical),ye={horizontal:{},vertical:void 0},xe=V.text;let Le,De=[0,0];if(xe){const Je=xe.toString(),lt=f.get("text-letter-spacing").evaluate(V,{},c.canonical)*si,Et=Ip(Je)?lt:0,Xt=f.get("text-anchor").evaluate(V,{},c.canonical),xn=B0(l,V,c.canonical);if(!xn){const en=f.get("text-radial-offset").evaluate(V,{},c.canonical);De=en?R0(Xt,[en*si,dm]):f.get("text-offset").evaluate(V,{},c.canonical).map(Kt=>Kt*si)}let Gt=k?"center":f.get("text-justify").evaluate(V,{},c.canonical);const Ut=f.get("symbol-placement")==="point"?f.get("text-max-width").evaluate(V,{},c.canonical)*si:1/0,fn=()=>{c.bucket.allowVerticalPlacement&&Nc(Je)&&(ye.vertical=nd(xe,c.glyphMap,c.glyphPositions,c.imagePositions,K,Ut,A,Xt,"left",Et,De,u.ah.vertical,!0,se,te))};if(!k&&xn){const en=new Set;if(Gt==="auto")for(let dt=0;dt<xn.values.length;dt+=2)en.add(pm(xn.values[dt]));else en.add(Gt);let Kt=!1;for(const dt of en)if(!ye.horizontal[dt])if(Kt)ye.horizontal[dt]=ye.horizontal[0];else{const pn=nd(xe,c.glyphMap,c.glyphPositions,c.imagePositions,K,Ut,A,"center",dt,Et,De,u.ah.horizontal,!1,se,te);pn&&(ye.horizontal[dt]=pn,Kt=pn.positionedLines.length===1)}fn()}else{Gt==="auto"&&(Gt=pm(Xt));const en=nd(xe,c.glyphMap,c.glyphPositions,c.imagePositions,K,Ut,A,Xt,Gt,Et,De,u.ah.horizontal,!1,se,te);en&&(ye.horizontal[Gt]=en),fn(),Nc(Je)&&k&&M&&(ye.vertical=nd(xe,c.glyphMap,c.glyphPositions,c.imagePositions,K,Ut,A,Xt,Gt,Et,De,u.ah.vertical,!1,se,te))}}let Qe=!1;if(V.icon&&V.icon.name){const Je=c.imageMap[V.icon.name];Je&&(Le=wA(c.imagePositions[V.icon.name],f.get("icon-offset").evaluate(V,{},c.canonical),f.get("icon-anchor").evaluate(V,{},c.canonical)),Qe=!!Je.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Qe:c.bucket.sdfIcons!==Qe&&J("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Je.pixelRatio!==c.bucket.pixelRatio||f.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const je=O0(ye.horizontal)||ye.vertical;c.bucket.iconsInText=!!je&&je.iconsInText,(je||Le)&&FA(c.bucket,V,ye,Le,c.imageMap,b,se,me,De,Qe,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bq=Yp,u.br=Xp,u.bs=Kp,u.bt=Ma,u.bu=em,u.bv=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bw=function(c,l,f,p,b){return a(this,void 0,void 0,function*(){if(I())try{return yield Pe(c,l,f,p,b)}catch{}return function(A,k,M,R,V){const K=A.width,te=A.height;Ee&&Fe||(Ee=new OffscreenCanvas(K,te),Fe=Ee.getContext("2d",{willReadFrequently:!0})),Ee.width=K,Ee.height=te,Fe.drawImage(A,0,0,K,te);const se=Fe.getImageData(k,M,R,V);return Fe.clearRect(0,0,K,te),se.data}(c,l,f,p,b)})},u.bx=w0,u.by=d,u.bz=m,u.c=ct,u.d=c=>a(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(l)}catch(f){throw new Error(`Could not load image because of ${f.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=ue,u.f=c=>new Promise((l,f)=>{const p=new Image;p.onload=()=>{l(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=fe})},p.onerror=()=>f(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const b=new Blob([new Uint8Array(c)],{type:"image/png"});p.src=c.byteLength?URL.createObjectURL(b):fe}),u.g=at,u.h=(c,l)=>It(ue(c,{type:"json"}),l),u.i=ke,u.j=Xe,u.k=Ue,u.l=(c,l)=>It(ue(c,{type:"arrayBuffer"}),l),u.m=It,u.n=function(c){return new em(c).readFields(pA,[])},u.o=Wc,u.p=e0,u.q=x,u.r=Mp,u.s=Qt,u.t=Bc,u.u=js,u.v=Ge,u.w=J,u.x=function([c,l,f]){return l+=90,l*=Math.PI/180,f*=Math.PI/180,{x:c*Math.cos(l)*Math.sin(f),y:c*Math.sin(l)*Math.sin(f),z:c*Math.cos(f)}},u.y=Oi,u.z=zr}),i("worker",["./shared"],function(u){class a{constructor(oe){this.keyCache={},oe&&this.replace(oe)}replace(oe){this._layerConfigs={},this._layers={},this.update(oe,[])}update(oe,le){for(const Me of oe){this._layerConfigs[Me.id]=Me;const Ne=this._layers[Me.id]=u.aA(Me);Ne._featureFilter=u.a7(Ne.filter),this.keyCache[Me.id]&&delete this.keyCache[Me.id]}for(const Me of le)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const we=u.bk(Object.values(this._layerConfigs),this.keyCache);for(const Me of we){const Ne=Me.map(st=>this._layers[st.id]),Ve=Ne[0];if(Ve.visibility==="none")continue;const Ke=Ve.source||"";let Oe=this.familiesBySource[Ke];Oe||(Oe=this.familiesBySource[Ke]={});const ut=Ve.sourceLayer||"_geojsonTileLayer";let At=Oe[ut];At||(At=Oe[ut]=[]),At.push(Ne)}}}class d{constructor(oe){const le={},we=[];for(const Ke in oe){const Oe=oe[Ke],ut=le[Ke]={};for(const At in Oe){const st=Oe[+At];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const Rt={x:0,y:0,w:st.bitmap.width+2,h:st.bitmap.height+2};we.push(Rt),ut[At]={rect:Rt,metrics:st.metrics}}}const{w:Me,h:Ne}=u.p(we),Ve=new u.o({width:Me||1,height:Ne||1});for(const Ke in oe){const Oe=oe[Ke];for(const ut in Oe){const At=Oe[+ut];if(!At||At.bitmap.width===0||At.bitmap.height===0)continue;const st=le[Ke][ut].rect;u.o.copy(At.bitmap,Ve,{x:0,y:0},{x:st.x+1,y:st.y+1},At.bitmap)}}this.image=Ve,this.positions=le}}u.bl("GlyphAtlas",d);class m{constructor(oe){this.tileID=new u.S(oe.tileID.overscaledZ,oe.tileID.wrap,oe.tileID.canonical.z,oe.tileID.canonical.x,oe.tileID.canonical.y),this.uid=oe.uid,this.zoom=oe.zoom,this.pixelRatio=oe.pixelRatio,this.tileSize=oe.tileSize,this.source=oe.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=oe.showCollisionBoxes,this.collectResourceTiming=!!oe.collectResourceTiming,this.returnDependencies=!!oe.returnDependencies,this.promoteId=oe.promoteId,this.inFlightDependencies=[]}parse(oe,le,we,Me){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=oe,this.collisionBoxArray=new u.a5;const Ne=new u.bm(Object.keys(oe.layers).sort()),Ve=new u.bn(this.tileID,this.promoteId);Ve.bucketLayerIDs=[];const Ke={},Oe={featureIndex:Ve,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:we},ut=le.familiesBySource[this.source];for(const He in ut){const Sn=oe.layers[He];if(!Sn)continue;Sn.version===1&&u.w(`Vector tile source "${this.source}" layer "${He}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fn=Ne.encode(He),dr=[];for(let _r=0;_r<Sn.length;_r++){const Pr=Sn.feature(_r),Ei=Ve.getId(Pr,He);dr.push({feature:Pr,id:Ei,index:_r,sourceLayerIndex:Fn})}for(const _r of ut[He]){const Pr=_r[0];Pr.source!==this.source&&u.w(`layer.source = ${Pr.source} does not equal this.source = ${this.source}`),Pr.minzoom&&this.zoom<Math.floor(Pr.minzoom)||Pr.maxzoom&&this.zoom>=Pr.maxzoom||Pr.visibility!=="none"&&(_(_r,this.zoom,we),(Ke[Pr.id]=Pr.createBucket({index:Ve.bucketLayerIDs.length,layers:_r,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fn,sourceID:this.source})).populate(dr,Oe,this.tileID.canonical),Ve.bucketLayerIDs.push(_r.map(Ei=>Ei.id)))}}const At=u.aF(Oe.glyphDependencies,He=>Object.keys(He).map(Number));this.inFlightDependencies.forEach(He=>He==null?void 0:He.abort()),this.inFlightDependencies=[];let st=Promise.resolve({});if(Object.keys(At).length){const He=new AbortController;this.inFlightDependencies.push(He),st=Me.sendAsync({type:"GG",data:{stacks:At,source:this.source,tileID:this.tileID,type:"glyphs"}},He)}const Rt=Object.keys(Oe.iconDependencies);let hn=Promise.resolve({});if(Rt.length){const He=new AbortController;this.inFlightDependencies.push(He),hn=Me.sendAsync({type:"GI",data:{icons:Rt,source:this.source,tileID:this.tileID,type:"icons"}},He)}const mn=Object.keys(Oe.patternDependencies);let Qn=Promise.resolve({});if(mn.length){const He=new AbortController;this.inFlightDependencies.push(He),Qn=Me.sendAsync({type:"GI",data:{icons:mn,source:this.source,tileID:this.tileID,type:"patterns"}},He)}const[Ln,er,Un]=yield Promise.all([st,hn,Qn]),Zr=new d(Ln),$r=new u.bo(er,Un);for(const He in Ke){const Sn=Ke[He];Sn instanceof u.a6?(_(Sn.layers,this.zoom,we),u.bp({bucket:Sn,glyphMap:Ln,glyphPositions:Zr.positions,imageMap:er,imagePositions:$r.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Sn.hasPattern&&(Sn instanceof u.bq||Sn instanceof u.br||Sn instanceof u.bs)&&(_(Sn.layers,this.zoom,we),Sn.addFeatures(Oe,this.tileID.canonical,$r.patternPositions))}return this.status="done",{buckets:Object.values(Ke).filter(He=>!He.isEmpty()),featureIndex:Ve,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Zr.image,imageAtlas:$r,glyphMap:this.returnDependencies?Ln:null,iconMap:this.returnDependencies?er:null,glyphPositions:this.returnDependencies?Zr.positions:null}})}}function _(Ce,oe,le){const we=new u.z(oe);for(const Me of Ce)Me.recalculate(we,le)}class v{constructor(oe,le,we){this.actor=oe,this.layerIndex=le,this.availableImages=we,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(oe,le){return u._(this,void 0,void 0,function*(){const we=yield u.l(oe.request,le);try{return{vectorTile:new u.bt.VectorTile(new u.bu(we.data)),rawData:we.data,cacheControl:we.cacheControl,expires:we.expires}}catch(Me){const Ne=new Uint8Array(we.data);let Ve=`Unable to parse the tile at ${oe.request.url}, `;throw Ve+=Ne[0]===31&&Ne[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Me.message}`,new Error(Ve)}})}loadTile(oe){return u._(this,void 0,void 0,function*(){const le=oe.uid,we=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new u.bv(oe.request),Me=new m(oe);this.loading[le]=Me;const Ne=new AbortController;Me.abort=Ne;try{const Ve=yield this.loadVectorTile(oe,Ne);if(delete this.loading[le],!Ve)return null;const Ke=Ve.rawData,Oe={};Ve.expires&&(Oe.expires=Ve.expires),Ve.cacheControl&&(Oe.cacheControl=Ve.cacheControl);const ut={};if(we){const st=we.finish();st&&(ut.resourceTiming=JSON.parse(JSON.stringify(st)))}Me.vectorTile=Ve.vectorTile;const At=Me.parse(Ve.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[le]=Me,this.fetching[le]={rawTileData:Ke,cacheControl:Oe,resourceTiming:ut};try{const st=yield At;return u.e({rawTileData:Ke.slice(0)},st,Oe,ut)}finally{delete this.fetching[le]}}catch(Ve){throw delete this.loading[le],Me.status="done",this.loaded[le]=Me,Ve}})}reloadTile(oe){return u._(this,void 0,void 0,function*(){const le=oe.uid;if(!this.loaded||!this.loaded[le])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const we=this.loaded[le];if(we.showCollisionBoxes=oe.showCollisionBoxes,we.status==="parsing"){const Me=yield we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor);let Ne;if(this.fetching[le]){const{rawTileData:Ve,cacheControl:Ke,resourceTiming:Oe}=this.fetching[le];delete this.fetching[le],Ne=u.e({rawTileData:Ve.slice(0)},Me,Ke,Oe)}else Ne=Me;return Ne}if(we.status==="done"&&we.vectorTile)return we.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(oe){return u._(this,void 0,void 0,function*(){const le=this.loading,we=oe.uid;le&&le[we]&&le[we].abort&&(le[we].abort.abort(),delete le[we])})}removeTile(oe){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[oe.uid]&&delete this.loaded[oe.uid]})}}class S{constructor(){this.loaded={}}loadTile(oe){return u._(this,void 0,void 0,function*(){const{uid:le,encoding:we,rawImageData:Me,redFactor:Ne,greenFactor:Ve,blueFactor:Ke,baseShift:Oe}=oe,ut=Me.width+2,At=Me.height+2,st=u.b(Me)?new u.R({width:ut,height:At},yield u.bw(Me,-1,-1,ut,At)):Me,Rt=new u.bx(le,st,we,Ne,Ve,Ke,Oe);return this.loaded=this.loaded||{},this.loaded[le]=Rt,Rt})}removeTile(oe){const le=this.loaded,we=oe.uid;le&&le[we]&&delete le[we]}}function T(Ce,oe){if(Ce.length!==0){C(Ce[0],oe);for(var le=1;le<Ce.length;le++)C(Ce[le],!oe)}}function C(Ce,oe){for(var le=0,we=0,Me=0,Ne=Ce.length,Ve=Ne-1;Me<Ne;Ve=Me++){var Ke=(Ce[Me][0]-Ce[Ve][0])*(Ce[Ve][1]+Ce[Me][1]),Oe=le+Ke;we+=Math.abs(le)>=Math.abs(Ke)?le-Oe+Ke:Ke-Oe+le,le=Oe}le+we>=0!=!!oe&&Ce.reverse()}var L=u.by(function Ce(oe,le){var we,Me=oe&&oe.type;if(Me==="FeatureCollection")for(we=0;we<oe.features.length;we++)Ce(oe.features[we],le);else if(Me==="GeometryCollection")for(we=0;we<oe.geometries.length;we++)Ce(oe.geometries[we],le);else if(Me==="Feature")Ce(oe.geometry,le);else if(Me==="Polygon")T(oe.coordinates,le);else if(Me==="MultiPolygon")for(we=0;we<oe.coordinates.length;we++)T(oe.coordinates[we],le);return oe});const P=u.bt.VectorTileFeature.prototype.toGeoJSON;var D={exports:{}},I=u.bz,U=u.bt.VectorTileFeature,O=ee;function ee(Ce,oe){this.options=oe||{},this.features=Ce,this.length=Ce.length}function X(Ce,oe){this.id=typeof Ce.id=="number"?Ce.id:void 0,this.type=Ce.type,this.rawGeometry=Ce.type===1?[Ce.geometry]:Ce.geometry,this.properties=Ce.tags,this.extent=oe||4096}ee.prototype.feature=function(Ce){return new X(this.features[Ce],this.options.extent)},X.prototype.loadGeometry=function(){var Ce=this.rawGeometry;this.geometry=[];for(var oe=0;oe<Ce.length;oe++){for(var le=Ce[oe],we=[],Me=0;Me<le.length;Me++)we.push(new I(le[Me][0],le[Me][1]));this.geometry.push(we)}return this.geometry},X.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ce=this.geometry,oe=1/0,le=-1/0,we=1/0,Me=-1/0,Ne=0;Ne<Ce.length;Ne++)for(var Ve=Ce[Ne],Ke=0;Ke<Ve.length;Ke++){var Oe=Ve[Ke];oe=Math.min(oe,Oe.x),le=Math.max(le,Oe.x),we=Math.min(we,Oe.y),Me=Math.max(Me,Oe.y)}return[oe,we,le,Me]},X.prototype.toGeoJSON=U.prototype.toGeoJSON;var ue=u.bA,$=O;function Q(Ce){var oe=new ue;return function(le,we){for(var Me in le.layers)we.writeMessage(3,ne,le.layers[Me])}(Ce,oe),oe.finish()}function ne(Ce,oe){var le;oe.writeVarintField(15,Ce.version||1),oe.writeStringField(1,Ce.name||""),oe.writeVarintField(5,Ce.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(le=0;le<Ce.length;le++)we.feature=Ce.feature(le),oe.writeMessage(2,F,we);var Me=we.keys;for(le=0;le<Me.length;le++)oe.writeStringField(3,Me[le]);var Ne=we.values;for(le=0;le<Ne.length;le++)oe.writeMessage(4,ge,Ne[le])}function F(Ce,oe){var le=Ce.feature;le.id!==void 0&&oe.writeVarintField(1,le.id),oe.writeMessage(2,Z,Ce),oe.writeVarintField(3,le.type),oe.writeMessage(4,ke,le)}function Z(Ce,oe){var le=Ce.feature,we=Ce.keys,Me=Ce.values,Ne=Ce.keycache,Ve=Ce.valuecache;for(var Ke in le.properties){var Oe=le.properties[Ke],ut=Ne[Ke];if(Oe!==null){ut===void 0&&(we.push(Ke),Ne[Ke]=ut=we.length-1),oe.writeVarint(ut);var At=typeof Oe;At!=="string"&&At!=="boolean"&&At!=="number"&&(Oe=JSON.stringify(Oe));var st=At+":"+Oe,Rt=Ve[st];Rt===void 0&&(Me.push(Oe),Ve[st]=Rt=Me.length-1),oe.writeVarint(Rt)}}}function J(Ce,oe){return(oe<<3)+(7&Ce)}function be(Ce){return Ce<<1^Ce>>31}function ke(Ce,oe){for(var le=Ce.loadGeometry(),we=Ce.type,Me=0,Ne=0,Ve=le.length,Ke=0;Ke<Ve;Ke++){var Oe=le[Ke],ut=1;we===1&&(ut=Oe.length),oe.writeVarint(J(1,ut));for(var At=we===3?Oe.length-1:Oe.length,st=0;st<At;st++){st===1&&we!==1&&oe.writeVarint(J(2,At-1));var Rt=Oe[st].x-Me,hn=Oe[st].y-Ne;oe.writeVarint(be(Rt)),oe.writeVarint(be(hn)),Me+=Rt,Ne+=hn}we===3&&oe.writeVarint(J(7,1))}}function ge(Ce,oe){var le=typeof Ce;le==="string"?oe.writeStringField(1,Ce):le==="boolean"?oe.writeBooleanField(7,Ce):le==="number"&&(Ce%1!=0?oe.writeDoubleField(3,Ce):Ce<0?oe.writeSVarintField(6,Ce):oe.writeVarintField(5,Ce))}D.exports=Q,D.exports.fromVectorTileJs=Q,D.exports.fromGeojsonVt=function(Ce,oe){oe=oe||{};var le={};for(var we in Ce)le[we]=new $(Ce[we].features,oe),le[we].name=we,le[we].version=oe.version,le[we].extent=oe.extent;return Q({layers:le})},D.exports.GeoJSONWrapper=$;var ve=u.by(D.exports);const fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ce=>Ce},Pe=Math.fround||(Ee=new Float32Array(1),Ce=>(Ee[0]=+Ce,Ee[0]));var Ee;const Fe=3,ot=5,ct=6;class it{constructor(oe){this.options=Object.assign(Object.create(fe),oe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(oe){const{log:le,minZoom:we,maxZoom:Me}=this.options;le&&console.time("total time");const Ne=`prepare ${oe.length} points`;le&&console.time(Ne),this.points=oe;const Ve=[];for(let Oe=0;Oe<oe.length;Oe++){const ut=oe[Oe];if(!ut.geometry)continue;const[At,st]=ut.geometry.coordinates,Rt=Pe(Ct(At)),hn=Pe(xt(st));Ve.push(Rt,hn,1/0,Oe,-1,1),this.options.reduce&&Ve.push(0)}let Ke=this.trees[Me+1]=this._createTree(Ve);le&&console.timeEnd(Ne);for(let Oe=Me;Oe>=we;Oe--){const ut=+Date.now();Ke=this.trees[Oe]=this._createTree(this._cluster(Ke,Oe)),le&&console.log("z%d: %d clusters in %dms",Oe,Ke.numItems,+Date.now()-ut)}return le&&console.timeEnd("total time"),this}getClusters(oe,le){let we=((oe[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,oe[1]));let Ne=oe[2]===180?180:((oe[2]+180)%360+360)%360-180;const Ve=Math.max(-90,Math.min(90,oe[3]));if(oe[2]-oe[0]>=360)we=-180,Ne=180;else if(we>Ne){const st=this.getClusters([we,Me,180,Ve],le),Rt=this.getClusters([-180,Me,Ne,Ve],le);return st.concat(Rt)}const Ke=this.trees[this._limitZoom(le)],Oe=Ke.range(Ct(we),xt(Ve),Ct(Ne),xt(Me)),ut=Ke.data,At=[];for(const st of Oe){const Rt=this.stride*st;At.push(ut[Rt+ot]>1?at(ut,Rt,this.clusterProps):this.points[ut[Rt+Fe]])}return At}getChildren(oe){const le=this._getOriginId(oe),we=this._getOriginZoom(oe),Me="No cluster with the specified id.",Ne=this.trees[we];if(!Ne)throw new Error(Me);const Ve=Ne.data;if(le*this.stride>=Ve.length)throw new Error(Me);const Ke=this.options.radius/(this.options.extent*Math.pow(2,we-1)),Oe=Ne.within(Ve[le*this.stride],Ve[le*this.stride+1],Ke),ut=[];for(const At of Oe){const st=At*this.stride;Ve[st+4]===oe&&ut.push(Ve[st+ot]>1?at(Ve,st,this.clusterProps):this.points[Ve[st+Fe]])}if(ut.length===0)throw new Error(Me);return ut}getLeaves(oe,le,we){const Me=[];return this._appendLeaves(Me,oe,le=le||10,we=we||0,0),Me}getTile(oe,le,we){const Me=this.trees[this._limitZoom(oe)],Ne=Math.pow(2,oe),{extent:Ve,radius:Ke}=this.options,Oe=Ke/Ve,ut=(we-Oe)/Ne,At=(we+1+Oe)/Ne,st={features:[]};return this._addTileFeatures(Me.range((le-Oe)/Ne,ut,(le+1+Oe)/Ne,At),Me.data,le,we,Ne,st),le===0&&this._addTileFeatures(Me.range(1-Oe/Ne,ut,1,At),Me.data,Ne,we,Ne,st),le===Ne-1&&this._addTileFeatures(Me.range(0,ut,Oe/Ne,At),Me.data,-1,we,Ne,st),st.features.length?st:null}getClusterExpansionZoom(oe){let le=this._getOriginZoom(oe)-1;for(;le<=this.options.maxZoom;){const we=this.getChildren(oe);if(le++,we.length!==1)break;oe=we[0].properties.cluster_id}return le}_appendLeaves(oe,le,we,Me,Ne){const Ve=this.getChildren(le);for(const Ke of Ve){const Oe=Ke.properties;if(Oe&&Oe.cluster?Ne+Oe.point_count<=Me?Ne+=Oe.point_count:Ne=this._appendLeaves(oe,Oe.cluster_id,we,Me,Ne):Ne<Me?Ne++:oe.push(Ke),oe.length===we)break}return Ne}_createTree(oe){const le=new u.av(oe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let we=0;we<oe.length;we+=this.stride)le.add(oe[we],oe[we+1]);return le.finish(),le.data=oe,le}_addTileFeatures(oe,le,we,Me,Ne,Ve){for(const Ke of oe){const Oe=Ke*this.stride,ut=le[Oe+ot]>1;let At,st,Rt;if(ut)At=ft(le,Oe,this.clusterProps),st=le[Oe],Rt=le[Oe+1];else{const Qn=this.points[le[Oe+Fe]];At=Qn.properties;const[Ln,er]=Qn.geometry.coordinates;st=Ct(Ln),Rt=xt(er)}const hn={type:1,geometry:[[Math.round(this.options.extent*(st*Ne-we)),Math.round(this.options.extent*(Rt*Ne-Me))]],tags:At};let mn;mn=ut||this.options.generateId?le[Oe+Fe]:this.points[le[Oe+Fe]].id,mn!==void 0&&(hn.id=mn),Ve.features.push(hn)}}_limitZoom(oe){return Math.max(this.options.minZoom,Math.min(Math.floor(+oe),this.options.maxZoom+1))}_cluster(oe,le){const{radius:we,extent:Me,reduce:Ne,minPoints:Ve}=this.options,Ke=we/(Me*Math.pow(2,le)),Oe=oe.data,ut=[],At=this.stride;for(let st=0;st<Oe.length;st+=At){if(Oe[st+2]<=le)continue;Oe[st+2]=le;const Rt=Oe[st],hn=Oe[st+1],mn=oe.within(Oe[st],Oe[st+1],Ke),Qn=Oe[st+ot];let Ln=Qn;for(const er of mn){const Un=er*At;Oe[Un+2]>le&&(Ln+=Oe[Un+ot])}if(Ln>Qn&&Ln>=Ve){let er,Un=Rt*Qn,Zr=hn*Qn,$r=-1;const He=((st/At|0)<<5)+(le+1)+this.points.length;for(const Sn of mn){const Fn=Sn*At;if(Oe[Fn+2]<=le)continue;Oe[Fn+2]=le;const dr=Oe[Fn+ot];Un+=Oe[Fn]*dr,Zr+=Oe[Fn+1]*dr,Oe[Fn+4]=He,Ne&&(er||(er=this._map(Oe,st,!0),$r=this.clusterProps.length,this.clusterProps.push(er)),Ne(er,this._map(Oe,Fn)))}Oe[st+4]=He,ut.push(Un/Ln,Zr/Ln,1/0,He,-1,Ln),Ne&&ut.push($r)}else{for(let er=0;er<At;er++)ut.push(Oe[st+er]);if(Ln>1)for(const er of mn){const Un=er*At;if(!(Oe[Un+2]<=le)){Oe[Un+2]=le;for(let Zr=0;Zr<At;Zr++)ut.push(Oe[Un+Zr])}}}}return ut}_getOriginId(oe){return oe-this.points.length>>5}_getOriginZoom(oe){return(oe-this.points.length)%32}_map(oe,le,we){if(oe[le+ot]>1){const Ve=this.clusterProps[oe[le+ct]];return we?Object.assign({},Ve):Ve}const Me=this.points[oe[le+Fe]].properties,Ne=this.options.map(Me);return we&&Ne===Me?Object.assign({},Ne):Ne}}function at(Ce,oe,le){return{type:"Feature",id:Ce[oe+Fe],properties:ft(Ce,oe,le),geometry:{type:"Point",coordinates:[(we=Ce[oe],360*(we-.5)),It(Ce[oe+1])]}};var we}function ft(Ce,oe,le){const we=Ce[oe+ot],Me=we>=1e4?`${Math.round(we/1e3)}k`:we>=1e3?Math.round(we/100)/10+"k":we,Ne=Ce[oe+ct],Ve=Ne===-1?{}:Object.assign({},le[Ne]);return Object.assign(Ve,{cluster:!0,cluster_id:Ce[oe+Fe],point_count:we,point_count_abbreviated:Me})}function Ct(Ce){return Ce/360+.5}function xt(Ce){const oe=Math.sin(Ce*Math.PI/180),le=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return le<0?0:le>1?1:le}function It(Ce){const oe=(180-360*Ce)*Math.PI/180;return 360*Math.atan(Math.exp(oe))/Math.PI-90}function Qt(Ce,oe,le,we){let Me=we;const Ne=oe+(le-oe>>1);let Ve,Ke=le-oe;const Oe=Ce[oe],ut=Ce[oe+1],At=Ce[le],st=Ce[le+1];for(let Rt=oe+3;Rt<le;Rt+=3){const hn=tn(Ce[Rt],Ce[Rt+1],Oe,ut,At,st);if(hn>Me)Ve=Rt,Me=hn;else if(hn===Me){const mn=Math.abs(Rt-Ne);mn<Ke&&(Ve=Rt,Ke=mn)}}Me>we&&(Ve-oe>3&&Qt(Ce,oe,Ve,we),Ce[Ve+2]=Me,le-Ve>3&&Qt(Ce,Ve,le,we))}function tn(Ce,oe,le,we,Me,Ne){let Ve=Me-le,Ke=Ne-we;if(Ve!==0||Ke!==0){const Oe=((Ce-le)*Ve+(oe-we)*Ke)/(Ve*Ve+Ke*Ke);Oe>1?(le=Me,we=Ne):Oe>0&&(le+=Ve*Oe,we+=Ke*Oe)}return Ve=Ce-le,Ke=oe-we,Ve*Ve+Ke*Ke}function rn(Ce,oe,le,we){const Me={id:Ce??null,type:oe,geometry:le,tags:we,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(oe==="Point"||oe==="MultiPoint"||oe==="LineString")Ue(Me,le);else if(oe==="Polygon")Ue(Me,le[0]);else if(oe==="MultiLineString")for(const Ne of le)Ue(Me,Ne);else if(oe==="MultiPolygon")for(const Ne of le)Ue(Me,Ne[0]);return Me}function Ue(Ce,oe){for(let le=0;le<oe.length;le+=3)Ce.minX=Math.min(Ce.minX,oe[le]),Ce.minY=Math.min(Ce.minY,oe[le+1]),Ce.maxX=Math.max(Ce.maxX,oe[le]),Ce.maxY=Math.max(Ce.maxY,oe[le+1])}function Xe(Ce,oe,le,we){if(!oe.geometry)return;const Me=oe.geometry.coordinates;if(Me&&Me.length===0)return;const Ne=oe.geometry.type,Ve=Math.pow(le.tolerance/((1<<le.maxZoom)*le.extent),2);let Ke=[],Oe=oe.id;if(le.promoteId?Oe=oe.properties[le.promoteId]:le.generateId&&(Oe=we||0),Ne==="Point")qt(Me,Ke);else if(Ne==="MultiPoint")for(const ut of Me)qt(ut,Ke);else if(Ne==="LineString")Ge(Me,Ke,Ve,!1);else if(Ne==="MultiLineString"){if(le.lineMetrics){for(const ut of Me)Ke=[],Ge(ut,Ke,Ve,!1),Ce.push(rn(Oe,"LineString",Ke,oe.properties));return}et(Me,Ke,Ve,!1)}else if(Ne==="Polygon")et(Me,Ke,Ve,!0);else{if(Ne!=="MultiPolygon"){if(Ne==="GeometryCollection"){for(const ut of oe.geometry.geometries)Xe(Ce,{id:Oe,geometry:ut,properties:oe.properties},le,we);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ut of Me){const At=[];et(ut,At,Ve,!0),Ke.push(At)}}Ce.push(rn(Oe,Ne,Ke,oe.properties))}function qt(Ce,oe){oe.push(nn(Ce[0]),Ye(Ce[1]),0)}function Ge(Ce,oe,le,we){let Me,Ne,Ve=0;for(let Oe=0;Oe<Ce.length;Oe++){const ut=nn(Ce[Oe][0]),At=Ye(Ce[Oe][1]);oe.push(ut,At,0),Oe>0&&(Ve+=we?(Me*At-ut*Ne)/2:Math.sqrt(Math.pow(ut-Me,2)+Math.pow(At-Ne,2))),Me=ut,Ne=At}const Ke=oe.length-3;oe[2]=1,Qt(oe,0,Ke,le),oe[Ke+2]=1,oe.size=Math.abs(Ve),oe.start=0,oe.end=oe.size}function et(Ce,oe,le,we){for(let Me=0;Me<Ce.length;Me++){const Ne=[];Ge(Ce[Me],Ne,le,we),oe.push(Ne)}}function nn(Ce){return Ce/360+.5}function Ye(Ce){const oe=Math.sin(Ce*Math.PI/180),le=.5-.25*Math.log((1+oe)/(1-oe))/Math.PI;return le<0?0:le>1?1:le}function Ft(Ce,oe,le,we,Me,Ne,Ve,Ke){if(we/=oe,Ne>=(le/=oe)&&Ve<we)return Ce;if(Ve<le||Ne>=we)return null;const Oe=[];for(const ut of Ce){const At=ut.geometry;let st=ut.type;const Rt=Me===0?ut.minX:ut.minY,hn=Me===0?ut.maxX:ut.maxY;if(Rt>=le&&hn<we){Oe.push(ut);continue}if(hn<le||Rt>=we)continue;let mn=[];if(st==="Point"||st==="MultiPoint")Tt(At,mn,le,we,Me);else if(st==="LineString")Rn(At,mn,le,we,Me,!1,Ke.lineMetrics);else if(st==="MultiLineString")un(At,mn,le,we,Me,!1);else if(st==="Polygon")un(At,mn,le,we,Me,!0);else if(st==="MultiPolygon")for(const Qn of At){const Ln=[];un(Qn,Ln,le,we,Me,!0),Ln.length&&mn.push(Ln)}if(mn.length){if(Ke.lineMetrics&&st==="LineString"){for(const Qn of mn)Oe.push(rn(ut.id,st,Qn,ut.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(mn.length===1?(st="LineString",mn=mn[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=mn.length===3?"Point":"MultiPoint"),Oe.push(rn(ut.id,st,mn,ut.tags))}}return Oe.length?Oe:null}function Tt(Ce,oe,le,we,Me){for(let Ne=0;Ne<Ce.length;Ne+=3){const Ve=Ce[Ne+Me];Ve>=le&&Ve<=we&&Dt(oe,Ce[Ne],Ce[Ne+1],Ce[Ne+2])}}function Rn(Ce,oe,le,we,Me,Ne,Ve){let Ke=fr(Ce);const Oe=Me===0?Mt:Vr;let ut,At,st=Ce.start;for(let Ln=0;Ln<Ce.length-3;Ln+=3){const er=Ce[Ln],Un=Ce[Ln+1],Zr=Ce[Ln+2],$r=Ce[Ln+3],He=Ce[Ln+4],Sn=Me===0?er:Un,Fn=Me===0?$r:He;let dr=!1;Ve&&(ut=Math.sqrt(Math.pow(er-$r,2)+Math.pow(Un-He,2))),Sn<le?Fn>le&&(At=Oe(Ke,er,Un,$r,He,le),Ve&&(Ke.start=st+ut*At)):Sn>we?Fn<we&&(At=Oe(Ke,er,Un,$r,He,we),Ve&&(Ke.start=st+ut*At)):Dt(Ke,er,Un,Zr),Fn<le&&Sn>=le&&(At=Oe(Ke,er,Un,$r,He,le),dr=!0),Fn>we&&Sn<=we&&(At=Oe(Ke,er,Un,$r,He,we),dr=!0),!Ne&&dr&&(Ve&&(Ke.end=st+ut*At),oe.push(Ke),Ke=fr(Ce)),Ve&&(st+=ut)}let Rt=Ce.length-3;const hn=Ce[Rt],mn=Ce[Rt+1],Qn=Me===0?hn:mn;Qn>=le&&Qn<=we&&Dt(Ke,hn,mn,Ce[Rt+2]),Rt=Ke.length-3,Ne&&Rt>=3&&(Ke[Rt]!==Ke[0]||Ke[Rt+1]!==Ke[1])&&Dt(Ke,Ke[0],Ke[1],Ke[2]),Ke.length&&oe.push(Ke)}function fr(Ce){const oe=[];return oe.size=Ce.size,oe.start=Ce.start,oe.end=Ce.end,oe}function un(Ce,oe,le,we,Me,Ne){for(const Ve of Ce)Rn(Ve,oe,le,we,Me,Ne,!1)}function Dt(Ce,oe,le,we){Ce.push(oe,le,we)}function Mt(Ce,oe,le,we,Me,Ne){const Ve=(Ne-oe)/(we-oe);return Dt(Ce,Ne,le+(Me-le)*Ve,1),Ve}function Vr(Ce,oe,le,we,Me,Ne){const Ve=(Ne-le)/(Me-le);return Dt(Ce,oe+(we-oe)*Ve,Ne,1),Ve}function vt(Ce,oe){const le=[];for(let we=0;we<Ce.length;we++){const Me=Ce[we],Ne=Me.type;let Ve;if(Ne==="Point"||Ne==="MultiPoint"||Ne==="LineString")Ve=Cn(Me.geometry,oe);else if(Ne==="MultiLineString"||Ne==="Polygon"){Ve=[];for(const Ke of Me.geometry)Ve.push(Cn(Ke,oe))}else if(Ne==="MultiPolygon"){Ve=[];for(const Ke of Me.geometry){const Oe=[];for(const ut of Ke)Oe.push(Cn(ut,oe));Ve.push(Oe)}}le.push(rn(Me.id,Ne,Ve,Me.tags))}return le}function Cn(Ce,oe){const le=[];le.size=Ce.size,Ce.start!==void 0&&(le.start=Ce.start,le.end=Ce.end);for(let we=0;we<Ce.length;we+=3)le.push(Ce[we]+oe,Ce[we+1],Ce[we+2]);return le}function Zn(Ce,oe){if(Ce.transformed)return Ce;const le=1<<Ce.z,we=Ce.x,Me=Ce.y;for(const Ne of Ce.features){const Ve=Ne.geometry,Ke=Ne.type;if(Ne.geometry=[],Ke===1)for(let Oe=0;Oe<Ve.length;Oe+=2)Ne.geometry.push(jr(Ve[Oe],Ve[Oe+1],oe,le,we,Me));else for(let Oe=0;Oe<Ve.length;Oe++){const ut=[];for(let At=0;At<Ve[Oe].length;At+=2)ut.push(jr(Ve[Oe][At],Ve[Oe][At+1],oe,le,we,Me));Ne.geometry.push(ut)}}return Ce.transformed=!0,Ce}function jr(Ce,oe,le,we,Me,Ne){return[Math.round(le*(Ce*we-Me)),Math.round(le*(oe*we-Ne))]}function Nr(Ce,oe,le,we,Me){const Ne=oe===Me.maxZoom?0:Me.tolerance/((1<<oe)*Me.extent),Ve={features:[],numPoints:0,numSimplified:0,numFeatures:Ce.length,source:null,x:le,y:we,z:oe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ke of Ce)Lt(Ve,Ke,Ne,Me);return Ve}function Lt(Ce,oe,le,we){const Me=oe.geometry,Ne=oe.type,Ve=[];if(Ce.minX=Math.min(Ce.minX,oe.minX),Ce.minY=Math.min(Ce.minY,oe.minY),Ce.maxX=Math.max(Ce.maxX,oe.maxX),Ce.maxY=Math.max(Ce.maxY,oe.maxY),Ne==="Point"||Ne==="MultiPoint")for(let Ke=0;Ke<Me.length;Ke+=3)Ve.push(Me[Ke],Me[Ke+1]),Ce.numPoints++,Ce.numSimplified++;else if(Ne==="LineString")tt(Ve,Me,Ce,le,!1,!1);else if(Ne==="MultiLineString"||Ne==="Polygon")for(let Ke=0;Ke<Me.length;Ke++)tt(Ve,Me[Ke],Ce,le,Ne==="Polygon",Ke===0);else if(Ne==="MultiPolygon")for(let Ke=0;Ke<Me.length;Ke++){const Oe=Me[Ke];for(let ut=0;ut<Oe.length;ut++)tt(Ve,Oe[ut],Ce,le,!0,ut===0)}if(Ve.length){let Ke=oe.tags||null;if(Ne==="LineString"&&we.lineMetrics){Ke={};for(const ut in oe.tags)Ke[ut]=oe.tags[ut];Ke.mapbox_clip_start=Me.start/Me.size,Ke.mapbox_clip_end=Me.end/Me.size}const Oe={geometry:Ve,type:Ne==="Polygon"||Ne==="MultiPolygon"?3:Ne==="LineString"||Ne==="MultiLineString"?2:1,tags:Ke};oe.id!==null&&(Oe.id=oe.id),Ce.features.push(Oe)}}function tt(Ce,oe,le,we,Me,Ne){const Ve=we*we;if(we>0&&oe.size<(Me?Ve:we))return void(le.numPoints+=oe.length/3);const Ke=[];for(let Oe=0;Oe<oe.length;Oe+=3)(we===0||oe[Oe+2]>Ve)&&(le.numSimplified++,Ke.push(oe[Oe],oe[Oe+1])),le.numPoints++;Me&&function(Oe,ut){let At=0;for(let st=0,Rt=Oe.length,hn=Rt-2;st<Rt;hn=st,st+=2)At+=(Oe[st]-Oe[hn])*(Oe[st+1]+Oe[hn+1]);if(At>0===ut)for(let st=0,Rt=Oe.length;st<Rt/2;st+=2){const hn=Oe[st],mn=Oe[st+1];Oe[st]=Oe[Rt-2-st],Oe[st+1]=Oe[Rt-1-st],Oe[Rt-2-st]=hn,Oe[Rt-1-st]=mn}}(Ke,Ne),Ce.push(Ke)}const pt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class $t{constructor(oe,le){const we=(le=this.options=function(Ne,Ve){for(const Ke in Ve)Ne[Ke]=Ve[Ke];return Ne}(Object.create(pt),le)).debug;if(we&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");let Me=function(Ne,Ve){const Ke=[];if(Ne.type==="FeatureCollection")for(let Oe=0;Oe<Ne.features.length;Oe++)Xe(Ke,Ne.features[Oe],Ve,Oe);else Xe(Ke,Ne.type==="Feature"?Ne:{geometry:Ne},Ve);return Ke}(oe,le);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=function(Ne,Ve){const Ke=Ve.buffer/Ve.extent;let Oe=Ne;const ut=Ft(Ne,1,-1-Ke,Ke,0,-1,2,Ve),At=Ft(Ne,1,1-Ke,2+Ke,0,-1,2,Ve);return(ut||At)&&(Oe=Ft(Ne,1,-Ke,1+Ke,0,-1,2,Ve)||[],ut&&(Oe=vt(ut,1).concat(Oe)),At&&(Oe=Oe.concat(vt(At,-1)))),Oe}(Me,le),Me.length&&this.splitTile(Me,0,0,0),we&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(oe,le,we,Me,Ne,Ve,Ke){const Oe=[oe,le,we,Me],ut=this.options,At=ut.debug;for(;Oe.length;){Me=Oe.pop(),we=Oe.pop(),le=Oe.pop(),oe=Oe.pop();const st=1<<le,Rt=Bn(le,we,Me);let hn=this.tiles[Rt];if(!hn&&(At>1&&console.time("creation"),hn=this.tiles[Rt]=Nr(oe,le,we,Me,ut),this.tileCoords.push({z:le,x:we,y:Me}),At)){At>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,we,Me,hn.numFeatures,hn.numPoints,hn.numSimplified),console.timeEnd("creation"));const dr=`z${le}`;this.stats[dr]=(this.stats[dr]||0)+1,this.total++}if(hn.source=oe,Ne==null){if(le===ut.indexMaxZoom||hn.numPoints<=ut.indexMaxPoints)continue}else{if(le===ut.maxZoom||le===Ne)continue;if(Ne!=null){const dr=Ne-le;if(we!==Ve>>dr||Me!==Ke>>dr)continue}}if(hn.source=null,oe.length===0)continue;At>1&&console.time("clipping");const mn=.5*ut.buffer/ut.extent,Qn=.5-mn,Ln=.5+mn,er=1+mn;let Un=null,Zr=null,$r=null,He=null,Sn=Ft(oe,st,we-mn,we+Ln,0,hn.minX,hn.maxX,ut),Fn=Ft(oe,st,we+Qn,we+er,0,hn.minX,hn.maxX,ut);oe=null,Sn&&(Un=Ft(Sn,st,Me-mn,Me+Ln,1,hn.minY,hn.maxY,ut),Zr=Ft(Sn,st,Me+Qn,Me+er,1,hn.minY,hn.maxY,ut),Sn=null),Fn&&($r=Ft(Fn,st,Me-mn,Me+Ln,1,hn.minY,hn.maxY,ut),He=Ft(Fn,st,Me+Qn,Me+er,1,hn.minY,hn.maxY,ut),Fn=null),At>1&&console.timeEnd("clipping"),Oe.push(Un||[],le+1,2*we,2*Me),Oe.push(Zr||[],le+1,2*we,2*Me+1),Oe.push($r||[],le+1,2*we+1,2*Me),Oe.push(He||[],le+1,2*we+1,2*Me+1)}}getTile(oe,le,we){oe=+oe,le=+le,we=+we;const Me=this.options,{extent:Ne,debug:Ve}=Me;if(oe<0||oe>24)return null;const Ke=1<<oe,Oe=Bn(oe,le=le+Ke&Ke-1,we);if(this.tiles[Oe])return Zn(this.tiles[Oe],Ne);Ve>1&&console.log("drilling down to z%d-%d-%d",oe,le,we);let ut,At=oe,st=le,Rt=we;for(;!ut&&At>0;)At--,st>>=1,Rt>>=1,ut=this.tiles[Bn(At,st,Rt)];return ut&&ut.source?(Ve>1&&(console.log("found parent tile z%d-%d-%d",At,st,Rt),console.time("drilling down")),this.splitTile(ut.source,At,st,Rt,oe,le,we),Ve>1&&console.timeEnd("drilling down"),this.tiles[Oe]?Zn(this.tiles[Oe],Ne):null):null}}function Bn(Ce,oe,le){return 32*((1<<Ce)*le+oe)+Ce}function zt(Ce,oe){return oe?Ce.properties[oe]:Ce.id}function hr(Ce,oe){if(Ce==null)return!0;if(Ce.type==="Feature")return zt(Ce,oe)!=null;if(Ce.type==="FeatureCollection"){const le=new Set;for(const we of Ce.features){const Me=zt(we,oe);if(Me==null||le.has(Me))return!1;le.add(Me)}return!0}return!1}function ir(Ce,oe){const le=new Map;if(Ce!=null)if(Ce.type==="Feature")le.set(zt(Ce,oe),Ce);else for(const we of Ce.features)le.set(zt(we,oe),we);return le}class Gr extends v{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(oe,le){return u._(this,void 0,void 0,function*(){const we=oe.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Me=this._geoJSONIndex.getTile(we.z,we.x,we.y);if(!Me)return null;const Ne=new class{constructor(Ke){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.X,this.length=Ke.length,this._features=Ke}feature(Ke){return new class{constructor(Oe){this._feature=Oe,this.extent=u.X,this.type=Oe.type,this.properties=Oe.tags,"id"in Oe&&!isNaN(Oe.id)&&(this.id=parseInt(Oe.id,10))}loadGeometry(){if(this._feature.type===1){const Oe=[];for(const ut of this._feature.geometry)Oe.push([new u.P(ut[0],ut[1])]);return Oe}{const Oe=[];for(const ut of this._feature.geometry){const At=[];for(const st of ut)At.push(new u.P(st[0],st[1]));Oe.push(At)}return Oe}}toGeoJSON(Oe,ut,At){return P.call(this,Oe,ut,At)}}(this._features[Ke])}}(Me.features);let Ve=ve(Ne);return Ve.byteOffset===0&&Ve.byteLength===Ve.buffer.byteLength||(Ve=new Uint8Array(Ve)),{vectorTile:Ne,rawData:Ve.buffer}})}loadData(oe){return u._(this,void 0,void 0,function*(){var le;(le=this._pendingRequest)===null||le===void 0||le.abort();const we=!!(oe&&oe.request&&oe.request.collectResourceTiming)&&new u.bv(oe.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(oe,this._pendingRequest),this._geoJSONIndex=oe.cluster?new it(function({superclusterOptions:Ve,clusterProperties:Ke}){if(!Ke||!Ve)return Ve;const Oe={},ut={},At={accumulated:null,zoom:0},st={properties:null},Rt=Object.keys(Ke);for(const hn of Rt){const[mn,Qn]=Ke[hn],Ln=u.bC(Qn),er=u.bC(typeof mn=="string"?[mn,["accumulated"],["get",hn]]:mn);Oe[hn]=Ln.value,ut[hn]=er.value}return Ve.map=hn=>{st.properties=hn;const mn={};for(const Qn of Rt)mn[Qn]=Oe[Qn].evaluate(At,st);return mn},Ve.reduce=(hn,mn)=>{st.properties=mn;for(const Qn of Rt)At.accumulated=hn[Qn],hn[Qn]=ut[Qn].evaluate(At,st)},Ve}(oe)).load((yield this._pendingData).features):(Me=yield this._pendingData,new $t(Me,oe.geojsonVtOptions)),this.loaded={};const Ne={};if(we){const Ve=we.finish();Ve&&(Ne.resourceTiming={},Ne.resourceTiming[oe.source]=JSON.parse(JSON.stringify(Ve)))}return Ne}catch(Ne){if(delete this._pendingRequest,u.bB(Ne))return{abandoned:!0};throw Ne}var Me})}getData(){return u._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(oe){const le=this.loaded;return le&&le[oe.uid]?super.reloadTile(oe):this.loadTile(oe)}loadAndProcessGeoJSON(oe,le){return u._(this,void 0,void 0,function*(){let we=yield this.loadGeoJSON(oe,le);if(delete this._pendingRequest,typeof we!="object")throw new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`);if(L(we,!0),oe.filter){const Me=u.bC(oe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Me.result==="error")throw new Error(Me.value.map(Ve=>`${Ve.key}: ${Ve.message}`).join(", "));we={type:"FeatureCollection",features:we.features.filter(Ve=>Me.value.evaluate({zoom:0},Ve))}}return we})}loadGeoJSON(oe,le){return u._(this,void 0,void 0,function*(){const{promoteId:we}=oe;if(oe.request){const Me=yield u.h(oe.request,le);return this._dataUpdateable=hr(Me.data,we)?ir(Me.data,we):void 0,Me.data}if(typeof oe.data=="string")try{const Me=JSON.parse(oe.data);return this._dataUpdateable=hr(Me,we)?ir(Me,we):void 0,Me}catch{throw new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`)}if(!oe.dataDiff)throw new Error(`Input data given to '${oe.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${oe.source}`);return function(Me,Ne,Ve){var Ke,Oe,ut,At;if(Ne.removeAll&&Me.clear(),Ne.remove)for(const st of Ne.remove)Me.delete(st);if(Ne.add)for(const st of Ne.add){const Rt=zt(st,Ve);Rt!=null&&Me.set(Rt,st)}if(Ne.update)for(const st of Ne.update){let Rt=Me.get(st.id);if(Rt==null)continue;const hn=!st.removeAllProperties&&(((Ke=st.removeProperties)===null||Ke===void 0?void 0:Ke.length)>0||((Oe=st.addOrUpdateProperties)===null||Oe===void 0?void 0:Oe.length)>0);if((st.newGeometry||st.removeAllProperties||hn)&&(Rt=Object.assign({},Rt),Me.set(st.id,Rt),hn&&(Rt.properties=Object.assign({},Rt.properties))),st.newGeometry&&(Rt.geometry=st.newGeometry),st.removeAllProperties)Rt.properties={};else if(((ut=st.removeProperties)===null||ut===void 0?void 0:ut.length)>0)for(const mn of st.removeProperties)Object.prototype.hasOwnProperty.call(Rt.properties,mn)&&delete Rt.properties[mn];if(((At=st.addOrUpdateProperties)===null||At===void 0?void 0:At.length)>0)for(const{key:mn,value:Qn}of st.addOrUpdateProperties)Rt.properties[mn]=Qn}}(this._dataUpdateable,oe.dataDiff,we),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(oe){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(oe){return this._geoJSONIndex.getClusterExpansionZoom(oe.clusterId)}getClusterChildren(oe){return this._geoJSONIndex.getChildren(oe.clusterId)}getClusterLeaves(oe){return this._geoJSONIndex.getLeaves(oe.clusterId,oe.limit,oe.offset)}}class br{constructor(oe){this.self=oe,this.actor=new u.F(oe),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(le,we)=>{if(this.externalWorkerSourceTypes[le])throw new Error(`Worker source with name "${le}" already registered.`);this.externalWorkerSourceTypes[le]=we},this.self.addProtocol=u.bi,this.self.removeProtocol=u.bj,this.self.registerRTLTextPlugin=le=>{if(u.bD.isParsed())throw new Error("RTL text plugin already registered.");u.bD.setMethods(le)},this.actor.registerMessageHandler("LDT",(le,we)=>this._getDEMWorkerSource(le,we.source).loadTile(we)),this.actor.registerMessageHandler("RDT",(le,we)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(le,we.source).removeTile(we)})),this.actor.registerMessageHandler("GCEZ",(le,we)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(le,we.type,we.source).getClusterExpansionZoom(we)})),this.actor.registerMessageHandler("GCC",(le,we)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(le,we.type,we.source).getClusterChildren(we)})),this.actor.registerMessageHandler("GCL",(le,we)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(le,we.type,we.source).getClusterLeaves(we)})),this.actor.registerMessageHandler("LD",(le,we)=>this._getWorkerSource(le,we.type,we.source).loadData(we)),this.actor.registerMessageHandler("GD",(le,we)=>this._getWorkerSource(le,we.type,we.source).getData()),this.actor.registerMessageHandler("LT",(le,we)=>this._getWorkerSource(le,we.type,we.source).loadTile(we)),this.actor.registerMessageHandler("RT",(le,we)=>this._getWorkerSource(le,we.type,we.source).reloadTile(we)),this.actor.registerMessageHandler("AT",(le,we)=>this._getWorkerSource(le,we.type,we.source).abortTile(we)),this.actor.registerMessageHandler("RMT",(le,we)=>this._getWorkerSource(le,we.type,we.source).removeTile(we)),this.actor.registerMessageHandler("RS",(le,we)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[le]||!this.workerSources[le][we.type]||!this.workerSources[le][we.type][we.source])return;const Me=this.workerSources[le][we.type][we.source];delete this.workerSources[le][we.type][we.source],Me.removeSource!==void 0&&Me.removeSource(we)})),this.actor.registerMessageHandler("RM",le=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le]})),this.actor.registerMessageHandler("SR",(le,we)=>u._(this,void 0,void 0,function*(){this.referrer=we})),this.actor.registerMessageHandler("SRPS",(le,we)=>this._syncRTLPluginState(le,we)),this.actor.registerMessageHandler("IS",(le,we)=>u._(this,void 0,void 0,function*(){this.self.importScripts(we)})),this.actor.registerMessageHandler("SI",(le,we)=>this._setImages(le,we)),this.actor.registerMessageHandler("UL",(le,we)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(le).update(we.layers,we.removedIds)})),this.actor.registerMessageHandler("SL",(le,we)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(le).replace(we)}))}_setImages(oe,le){return u._(this,void 0,void 0,function*(){this.availableImages[oe]=le;for(const we in this.workerSources[oe]){const Me=this.workerSources[oe][we];for(const Ne in Me)Me[Ne].availableImages=le}})}_syncRTLPluginState(oe,le){return u._(this,void 0,void 0,function*(){if(u.bD.isParsed())return u.bD.getState();if(le.pluginStatus!=="loading")return u.bD.setState(le),le;const we=le.pluginURL;if(this.self.importScripts(we),u.bD.isParsed()){const Me={pluginStatus:"loaded",pluginURL:we};return u.bD.setState(Me),Me}throw u.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${we}`)})}_getAvailableImages(oe){let le=this.availableImages[oe];return le||(le=[]),le}_getLayerIndex(oe){let le=this.layerIndexes[oe];return le||(le=this.layerIndexes[oe]=new a),le}_getWorkerSource(oe,le,we){if(this.workerSources[oe]||(this.workerSources[oe]={}),this.workerSources[oe][le]||(this.workerSources[oe][le]={}),!this.workerSources[oe][le][we]){const Me={sendAsync:(Ne,Ve)=>(Ne.targetMapId=oe,this.actor.sendAsync(Ne,Ve))};switch(le){case"vector":this.workerSources[oe][le][we]=new v(Me,this._getLayerIndex(oe),this._getAvailableImages(oe));break;case"geojson":this.workerSources[oe][le][we]=new Gr(Me,this._getLayerIndex(oe),this._getAvailableImages(oe));break;default:this.workerSources[oe][le][we]=new this.externalWorkerSourceTypes[le](Me,this._getLayerIndex(oe),this._getAvailableImages(oe))}}return this.workerSources[oe][le][we]}_getDEMWorkerSource(oe,le){return this.demWorkerSources[oe]||(this.demWorkerSources[oe]={}),this.demWorkerSources[oe][le]||(this.demWorkerSources[oe][le]=new S),this.demWorkerSources[oe][le]}}return u.i(self)&&(self.worker=new br(self)),br}),i("index",["exports","./shared"],function(u,a){var d="4.7.1";let m,_;const v={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:x=>new Promise((s,h)=>{const g=requestAnimationFrame(s);x.signal.addEventListener("abort",()=>{cancelAnimationFrame(g),h(a.c())})}),getImageData(x,s=0){return this.getImageCanvasContext(x).getImageData(-s,-s,x.width+2*s,x.height+2*s)},getImageCanvasContext(x){const s=window.document.createElement("canvas"),h=s.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return s.width=x.width,s.height=x.height,h.drawImage(x,0,0,x.width,x.height),h},resolveURL:x=>(m||(m=document.createElement("a")),m.href=x,m.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(_==null&&(_=matchMedia("(prefers-reduced-motion: reduce)")),_.matches)}};class S{static testProp(s){if(!S.docStyle)return s[0];for(let h=0;h<s.length;h++)if(s[h]in S.docStyle)return s[h];return s[0]}static create(s,h,g){const y=window.document.createElement(s);return h!==void 0&&(y.className=h),g&&g.appendChild(y),y}static createNS(s,h){return window.document.createElementNS(s,h)}static disableDrag(){S.docStyle&&S.selectProp&&(S.userSelect=S.docStyle[S.selectProp],S.docStyle[S.selectProp]="none")}static enableDrag(){S.docStyle&&S.selectProp&&(S.docStyle[S.selectProp]=S.userSelect)}static setTransform(s,h){s.style[S.transformProp]=h}static addEventListener(s,h,g,y={}){s.addEventListener(h,g,"passive"in y?y:y.capture)}static removeEventListener(s,h,g,y={}){s.removeEventListener(h,g,"passive"in y?y:y.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",S.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",S.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",S.suppressClickInternal,!0)},0)}static getScale(s){const h=s.getBoundingClientRect();return{x:h.width/s.offsetWidth||1,y:h.height/s.offsetHeight||1,boundingClientRect:h}}static getPoint(s,h,g){const y=h.boundingClientRect;return new a.P((g.clientX-y.left)/h.x-s.clientLeft,(g.clientY-y.top)/h.y-s.clientTop)}static mousePos(s,h){const g=S.getScale(s);return S.getPoint(s,g,h)}static touchPos(s,h){const g=[],y=S.getScale(s);for(let w=0;w<h.length;w++)g.push(S.getPoint(s,y,h[w]));return g}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}S.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,S.selectProp=S.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),S.transformProp=S.testProp(["transform","WebkitTransform"]);const T={supported:!1,testSupport:function(x){!P&&L&&(D?I(x):C=x)}};let C,L,P=!1,D=!1;function I(x){const s=x.createTexture();x.bindTexture(x.TEXTURE_2D,s);try{if(x.texImage2D(x.TEXTURE_2D,0,x.RGBA,x.RGBA,x.UNSIGNED_BYTE,L),x.isContextLost())return;T.supported=!0}catch{}x.deleteTexture(s),P=!0}var U;typeof document<"u"&&(L=document.createElement("img"),L.onload=()=>{C&&I(C),C=null,D=!0},L.onerror=()=>{P=!0,C=null},L.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(x){let s,h,g,y;x.resetRequestQueue=()=>{s=[],h=0,g=0,y={}},x.addThrottleControl=j=>{const Y=g++;return y[Y]=j,Y},x.removeThrottleControl=j=>{delete y[j],E()},x.getImage=(j,Y,re=!0)=>new Promise((ie,_e)=>{T.supported&&(j.headers||(j.headers={}),j.headers.accept="image/webp,*/*"),a.e(j,{type:"image"}),s.push({abortController:Y,requestParameters:j,supportImageRefresh:re,state:"queued",onError:Ae=>{_e(Ae)},onSuccess:Ae=>{ie(Ae)}}),E()});const w=j=>a._(this,void 0,void 0,function*(){j.state="running";const{requestParameters:Y,supportImageRefresh:re,onError:ie,onSuccess:_e,abortController:Ae}=j,Se=re===!1&&!a.i(self)&&!a.g(Y.url)&&(!Y.headers||Object.keys(Y.headers).reduce((Be,$e)=>Be&&$e==="accept",!0));h++;const ze=Se?B(Y,Ae):a.m(Y,Ae);try{const Be=yield ze;delete j.abortController,j.state="completed",Be.data instanceof HTMLImageElement||a.b(Be.data)?_e(Be):Be.data&&_e({data:yield(Re=Be.data,typeof createImageBitmap=="function"?a.d(Re):a.f(Re)),cacheControl:Be.cacheControl,expires:Be.expires})}catch(Be){delete j.abortController,ie(Be)}finally{h--,E()}var Re}),E=()=>{const j=(()=>{for(const Y of Object.keys(y))if(y[Y]())return!0;return!1})()?a.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:a.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let Y=h;Y<j&&s.length>0;Y++){const re=s.shift();re.abortController.signal.aborted?Y--:w(re)}},B=(j,Y)=>new Promise((re,ie)=>{const _e=new Image,Ae=j.url,Se=j.credentials;Se&&Se==="include"?_e.crossOrigin="use-credentials":(Se&&Se==="same-origin"||!a.s(Ae))&&(_e.crossOrigin="anonymous"),Y.signal.addEventListener("abort",()=>{_e.src="",ie(a.c())}),_e.fetchPriority="high",_e.onload=()=>{_e.onerror=_e.onload=null,re({data:_e})},_e.onerror=()=>{_e.onerror=_e.onload=null,Y.signal.aborted||ie(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},_e.src=Ae})}(U||(U={})),U.resetRequestQueue();class O{constructor(s){this._transformRequestFn=s}transformRequest(s,h){return this._transformRequestFn&&this._transformRequestFn(s,h)||{url:s}}setTransformRequest(s){this._transformRequestFn=s}}function ee(x){var s=new a.A(3);return s[0]=x[0],s[1]=x[1],s[2]=x[2],s}var X,ue=function(x,s,h){return x[0]=s[0]-h[0],x[1]=s[1]-h[1],x[2]=s[2]-h[2],x};X=new a.A(3),a.A!=Float32Array&&(X[0]=0,X[1]=0,X[2]=0);var $=function(x){var s=x[0],h=x[1];return s*s+h*h};function Q(x){const s=[];if(typeof x=="string")s.push({id:"default",url:x});else if(x&&x.length>0){const h=[];for(const{id:g,url:y}of x){const w=`${g}${y}`;h.indexOf(w)===-1&&(h.push(w),s.push({id:g,url:y}))}}return s}function ne(x,s,h){const g=x.split("?");return g[0]+=`${s}${h}`,g.join("?")}(function(){var x=new a.A(2);a.A!=Float32Array&&(x[0]=0,x[1]=0)})();class F{constructor(s,h,g,y){this.context=s,this.format=g,this.texture=s.gl.createTexture(),this.update(h,y)}update(s,h,g){const{width:y,height:w}=s,E=!(this.size&&this.size[0]===y&&this.size[1]===w||g),{context:B}=this,{gl:j}=B;if(this.useMipmap=!!(h&&h.useMipmap),j.bindTexture(j.TEXTURE_2D,this.texture),B.pixelStoreUnpackFlipY.set(!1),B.pixelStoreUnpack.set(1),B.pixelStoreUnpackPremultiplyAlpha.set(this.format===j.RGBA&&(!h||h.premultiply!==!1)),E)this.size=[y,w],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.b(s)?j.texImage2D(j.TEXTURE_2D,0,this.format,this.format,j.UNSIGNED_BYTE,s):j.texImage2D(j.TEXTURE_2D,0,this.format,y,w,0,this.format,j.UNSIGNED_BYTE,s.data);else{const{x:Y,y:re}=g||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||a.b(s)?j.texSubImage2D(j.TEXTURE_2D,0,Y,re,j.RGBA,j.UNSIGNED_BYTE,s):j.texSubImage2D(j.TEXTURE_2D,0,Y,re,y,w,j.RGBA,j.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&j.generateMipmap(j.TEXTURE_2D)}bind(s,h,g){const{context:y}=this,{gl:w}=y;w.bindTexture(w.TEXTURE_2D,this.texture),g!==w.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(g=w.LINEAR),s!==this.filter&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,s),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,g||s),this.filter=s),h!==this.wrap&&(w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,h),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function Z(x){const{userImage:s}=x;return!!(s&&s.render&&s.render())&&(x.data.replace(new Uint8Array(s.data.buffer)),!0)}class J extends a.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new a.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:h,promiseResolve:g}of this.requestors)g(this._getImagesForIds(h));this.requestors=[]}}getImage(s){const h=this.images[s];if(h&&!h.data&&h.spriteData){const g=h.spriteData;h.data=new a.R({width:g.width,height:g.height},g.context.getImageData(g.x,g.y,g.width,g.height).data),h.spriteData=null}return h}addImage(s,h){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,h)&&(this.images[s]=h)}_validate(s,h){let g=!0;const y=h.data||h.spriteData;return this._validateStretch(h.stretchX,y&&y.width)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchX" value`))),g=!1),this._validateStretch(h.stretchY,y&&y.height)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "stretchY" value`))),g=!1),this._validateContent(h.content,h)||(this.fire(new a.j(new Error(`Image "${s}" has invalid "content" value`))),g=!1),g}_validateStretch(s,h){if(!s)return!0;let g=0;for(const y of s){if(y[0]<g||y[1]<y[0]||h<y[1])return!1;g=y[1]}return!0}_validateContent(s,h){if(!s)return!0;if(s.length!==4)return!1;const g=h.spriteData,y=g&&g.width||h.data.width,w=g&&g.height||h.data.height;return!(s[0]<0||y<s[0]||s[1]<0||w<s[1]||s[2]<0||y<s[2]||s[3]<0||w<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,h,g=!0){const y=this.getImage(s);if(g&&(y.data.width!==h.data.width||y.data.height!==h.data.height))throw new Error(`size mismatch between old image (${y.data.width}x${y.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=y.version+1,this.images[s]=h,this.updatedImages[s]=!0}removeImage(s){const h=this.images[s];delete this.images[s],delete this.patterns[s],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((h,g)=>{let y=!0;if(!this.isLoaded())for(const w of s)this.images[w]||(y=!1);this.isLoaded()||y?h(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:h})})}_getImagesForIds(s){const h={};for(const g of s){let y=this.getImage(g);y||(this.fire(new a.k("styleimagemissing",{id:g})),y=this.getImage(g)),y?h[g]={data:y.data.clone(),pixelRatio:y.pixelRatio,sdf:y.sdf,version:y.version,stretchX:y.stretchX,stretchY:y.stretchY,content:y.content,textFitWidth:y.textFitWidth,textFitHeight:y.textFitHeight,hasRenderCallback:!!(y.userImage&&y.userImage.render)}:a.w(`Image "${g}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:s,height:h}=this.atlasImage;return{width:s,height:h}}getPattern(s){const h=this.patterns[s],g=this.getImage(s);if(!g)return null;if(h&&h.position.version===g.version)return h.position;if(h)h.position.version=g.version;else{const y={w:g.data.width+2,h:g.data.height+2,x:0,y:0},w=new a.I(y,g);this.patterns[s]={bin:y,position:w}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const h=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new F(s,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const w in this.patterns)s.push(this.patterns[w].bin);const{w:h,h:g}=a.p(s),y=this.atlasImage;y.resize({width:h||1,height:g||1});for(const w in this.patterns){const{bin:E}=this.patterns[w],B=E.x+1,j=E.y+1,Y=this.getImage(w).data,re=Y.width,ie=Y.height;a.R.copy(Y,y,{x:0,y:0},{x:B,y:j},{width:re,height:ie}),a.R.copy(Y,y,{x:0,y:ie-1},{x:B,y:j-1},{width:re,height:1}),a.R.copy(Y,y,{x:0,y:0},{x:B,y:j+ie},{width:re,height:1}),a.R.copy(Y,y,{x:re-1,y:0},{x:B-1,y:j},{width:1,height:ie}),a.R.copy(Y,y,{x:0,y:0},{x:B+re,y:j},{width:1,height:ie})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const h of s){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const g=this.getImage(h);g||a.w(`Image with ID: "${h}" was not found`),Z(g)&&this.updateImage(h,g)}}}const be=1e20;function ke(x,s,h,g,y,w,E,B,j){for(let Y=s;Y<s+g;Y++)ge(x,h*w+Y,w,y,E,B,j);for(let Y=h;Y<h+y;Y++)ge(x,Y*w+s,1,g,E,B,j)}function ge(x,s,h,g,y,w,E){w[0]=0,E[0]=-be,E[1]=be,y[0]=x[s];for(let B=1,j=0,Y=0;B<g;B++){y[B]=x[s+B*h];const re=B*B;do{const ie=w[j];Y=(y[B]-y[ie]+re-ie*ie)/(B-ie)/2}while(Y<=E[j]&&--j>-1);j++,w[j]=B,E[j]=Y,E[j+1]=be}for(let B=0,j=0;B<g;B++){for(;E[j+1]<B;)j++;const Y=w[j],re=B-Y;x[s+B*h]=y[Y]+re*re}}class ve{constructor(s,h){this.requestManager=s,this.localIdeographFontFamily=h,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return a._(this,void 0,void 0,function*(){const h=[];for(const w in s)for(const E of s[w])h.push(this._getAndCacheGlyphsPromise(w,E));const g=yield Promise.all(h),y={};for(const{stack:w,id:E,glyph:B}of g)y[w]||(y[w]={}),y[w][E]=B&&{id:B.id,bitmap:B.bitmap.clone(),metrics:B.metrics};return y})}_getAndCacheGlyphsPromise(s,h){return a._(this,void 0,void 0,function*(){let g=this.entries[s];g||(g=this.entries[s]={glyphs:{},requests:{},ranges:{}});let y=g.glyphs[h];if(y!==void 0)return{stack:s,id:h,glyph:y};if(y=this._tinySDF(g,s,h),y)return g.glyphs[h]=y,{stack:s,id:h,glyph:y};const w=Math.floor(h/256);if(256*w>65535)throw new Error("glyphs > 65535 not supported");if(g.ranges[w])return{stack:s,id:h,glyph:y};if(!this.url)throw new Error("glyphsUrl is not set");if(!g.requests[w]){const B=ve.loadGlyphRange(s,w,this.url,this.requestManager);g.requests[w]=B}const E=yield g.requests[w];for(const B in E)this._doesCharSupportLocalGlyph(+B)||(g.glyphs[+B]=E[+B]);return g.ranges[w]=!0,{stack:s,id:h,glyph:E[h]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(s))}_tinySDF(s,h,g){const y=this.localIdeographFontFamily;if(!y||!this._doesCharSupportLocalGlyph(g))return;let w=s.tinySDF;if(!w){let B="400";/bold/i.test(h)?B="900":/medium/i.test(h)?B="500":/light/i.test(h)&&(B="200"),w=s.tinySDF=new ve.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:y,fontWeight:B})}const E=w.draw(String.fromCharCode(g));return{id:g,bitmap:new a.o({width:E.width||60,height:E.height||60},E.data),metrics:{width:E.glyphWidth/2||24,height:E.glyphHeight/2||24,left:E.glyphLeft/2+.5||0,top:E.glyphTop/2-27.5||-8,advance:E.glyphAdvance/2||24,isDoubleResolution:!0}}}}ve.loadGlyphRange=function(x,s,h,g){return a._(this,void 0,void 0,function*(){const y=256*s,w=y+255,E=g.transformRequest(h.replace("{fontstack}",x).replace("{range}",`${y}-${w}`),"Glyphs"),B=yield a.l(E,new AbortController);if(!B||!B.data)throw new Error(`Could not load glyph range. range: ${s}, ${y}-${w}`);const j={};for(const Y of a.n(B.data))j[Y.id]=Y;return j})},ve.TinySDF=class{constructor({fontSize:x=24,buffer:s=3,radius:h=8,cutoff:g=.25,fontFamily:y="sans-serif",fontWeight:w="normal",fontStyle:E="normal"}={}){this.buffer=s,this.cutoff=g,this.radius=h;const B=this.size=x+4*s,j=this._createCanvas(B),Y=this.ctx=j.getContext("2d",{willReadFrequently:!0});Y.font=`${E} ${w} ${x}px ${y}`,Y.textBaseline="alphabetic",Y.textAlign="left",Y.fillStyle="black",this.gridOuter=new Float64Array(B*B),this.gridInner=new Float64Array(B*B),this.f=new Float64Array(B),this.z=new Float64Array(B+1),this.v=new Uint16Array(B)}_createCanvas(x){const s=document.createElement("canvas");return s.width=s.height=x,s}draw(x){const{width:s,actualBoundingBoxAscent:h,actualBoundingBoxDescent:g,actualBoundingBoxLeft:y,actualBoundingBoxRight:w}=this.ctx.measureText(x),E=Math.ceil(h),B=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(w-y))),j=Math.min(this.size-this.buffer,E+Math.ceil(g)),Y=B+2*this.buffer,re=j+2*this.buffer,ie=Math.max(Y*re,0),_e=new Uint8ClampedArray(ie),Ae={data:_e,width:Y,height:re,glyphWidth:B,glyphHeight:j,glyphTop:E,glyphLeft:0,glyphAdvance:s};if(B===0||j===0)return Ae;const{ctx:Se,buffer:ze,gridInner:Re,gridOuter:Be}=this;Se.clearRect(ze,ze,B,j),Se.fillText(x,ze,ze+E);const $e=Se.getImageData(ze,ze,B,j);Be.fill(be,0,ie),Re.fill(0,0,ie);for(let Ie=0;Ie<j;Ie++)for(let qe=0;qe<B;qe++){const We=$e.data[4*(Ie*B+qe)+3]/255;if(We===0)continue;const nt=(Ie+ze)*Y+qe+ze;if(We===1)Be[nt]=0,Re[nt]=be;else{const bt=.5-We;Be[nt]=bt>0?bt*bt:0,Re[nt]=bt<0?bt*bt:0}}ke(Be,0,0,Y,re,Y,this.f,this.v,this.z),ke(Re,ze,ze,B,j,Y,this.f,this.v,this.z);for(let Ie=0;Ie<ie;Ie++){const qe=Math.sqrt(Be[Ie])-Math.sqrt(Re[Ie]);_e[Ie]=Math.round(255-255*(qe/this.radius+this.cutoff))}return Ae}};class fe{constructor(){this.specification=a.v.light.position}possiblyEvaluate(s,h){return a.x(s.expression.evaluate(h))}interpolate(s,h,g){return{x:a.y.number(s.x,h.x,g),y:a.y.number(s.y,h.y,g),z:a.y.number(s.z,h.z,g)}}}let Pe;class Ee extends a.E{constructor(s){super(),Pe=Pe||new a.q({anchor:new a.D(a.v.light.anchor),position:new fe,color:new a.D(a.v.light.color),intensity:new a.D(a.v.light.intensity)}),this._transitionable=new a.T(Pe),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,h={}){if(!this._validate(a.r,s,h))for(const g in s){const y=s[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),y):this._transitionable.setValue(g,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g){return(!g||g.validate!==!1)&&a.t(this,s.call(a.u,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v}))}}const Fe=new a.q({"sky-color":new a.D(a.v.sky["sky-color"]),"horizon-color":new a.D(a.v.sky["horizon-color"]),"fog-color":new a.D(a.v.sky["fog-color"]),"fog-ground-blend":new a.D(a.v.sky["fog-ground-blend"]),"horizon-fog-blend":new a.D(a.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new a.D(a.v.sky["sky-horizon-blend"]),"atmosphere-blend":new a.D(a.v.sky["atmosphere-blend"])});class ot extends a.E{constructor(s){super(),this._transitionable=new a.T(Fe),this.setSky(s),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new a.z(0))}setSky(s,h={}){if(!this._validate(a.B,s,h)){s||(s={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const g in s){const y=s[g];g.endsWith("-transition")?this._transitionable.setTransition(g.slice(0,-11),y):this._transitionable.setValue(g,y)}}}getSky(){return this._transitionable.serialize()}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,h,g={}){return(g==null?void 0:g.validate)!==!1&&a.t(this,s.call(a.u,a.e({value:h,style:{glyphs:!0,sprite:!0},styleSpec:a.v})))}calculateFogBlendOpacity(s){return s<60?0:s<70?(s-60)/10:1}}class ct{constructor(s,h){this.width=s,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,h){const g=s.join(",")+String(h);return this.dashEntry[g]||(this.dashEntry[g]=this.addDash(s,h)),this.dashEntry[g]}getDashRanges(s,h,g){const y=[];let w=s.length%2==1?-s[s.length-1]*g:0,E=s[0]*g,B=!0;y.push({left:w,right:E,isDash:B,zeroLength:s[0]===0});let j=s[0];for(let Y=1;Y<s.length;Y++){B=!B;const re=s[Y];w=j*g,j+=re,E=j*g,y.push({left:w,right:E,isDash:B,zeroLength:re===0})}return y}addRoundDash(s,h,g){const y=h/2;for(let w=-g;w<=g;w++){const E=this.width*(this.nextRow+g+w);let B=0,j=s[B];for(let Y=0;Y<this.width;Y++){Y/j.right>1&&(j=s[++B]);const re=Math.abs(Y-j.left),ie=Math.abs(Y-j.right),_e=Math.min(re,ie);let Ae;const Se=w/g*(y+1);if(j.isDash){const ze=y-Math.abs(Se);Ae=Math.sqrt(_e*_e+ze*ze)}else Ae=y-Math.sqrt(_e*_e+Se*Se);this.data[E+Y]=Math.max(0,Math.min(255,Ae+128))}}}addRegularDash(s){for(let B=s.length-1;B>=0;--B){const j=s[B],Y=s[B+1];j.zeroLength?s.splice(B,1):Y&&Y.isDash===j.isDash&&(Y.left=j.left,s.splice(B,1))}const h=s[0],g=s[s.length-1];h.isDash===g.isDash&&(h.left=g.left-this.width,g.right=h.right+this.width);const y=this.width*this.nextRow;let w=0,E=s[w];for(let B=0;B<this.width;B++){B/E.right>1&&(E=s[++w]);const j=Math.abs(B-E.left),Y=Math.abs(B-E.right),re=Math.min(j,Y);this.data[y+B]=Math.max(0,Math.min(255,(E.isDash?re:-re)+128))}}addDash(s,h){const g=h?7:0,y=2*g+1;if(this.nextRow+y>this.height)return a.w("LineAtlas out of space"),null;let w=0;for(let B=0;B<s.length;B++)w+=s[B];if(w!==0){const B=this.width/w,j=this.getDashRanges(s,this.width,B);h?this.addRoundDash(j,B,g):this.addRegularDash(j)}const E={y:(this.nextRow+g+.5)/this.height,height:2*g/this.height,width:w};return this.nextRow+=y,this.dirty=!0,E}bind(s){const h=s.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const it="maplibre_preloaded_worker_pool";class at{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<at.workerCount;)this.workers.push(new Worker(a.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[it]}numActive(){return Object.keys(this.active).length}}const ft=Math.floor(v.hardwareConcurrency/2);let Ct,xt;function It(){return Ct||(Ct=new at),Ct}at.workerCount=a.C(globalThis)?Math.max(Math.min(ft,3),1):1;class Qt{constructor(s,h){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=h;const g=this.workerPool.acquire(h);for(let y=0;y<g.length;y++){const w=new a.F(g[y],h);w.name=`Worker ${y}`,this.actors.push(w)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,h){const g=[];for(const y of this.actors)g.push(y.sendAsync({type:s,data:h}));return Promise.all(g)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,h){for(const g of this.actors)g.registerMessageHandler(s,h)}}function tn(){return xt||(xt=new Qt(It(),a.G),xt.registerMessageHandler("GR",(x,s,h)=>a.m(s,h))),xt}function rn(x,s){const h=a.H();return a.J(h,h,[1,1,0]),a.K(h,h,[.5*x.width,.5*x.height,1]),a.L(h,h,x.calculatePosMatrix(s.toUnwrapped()))}function Ue(x,s,h,g,y,w){const E=function(ie,_e,Ae){if(ie)for(const Se of ie){const ze=_e[Se];if(ze&&ze.source===Ae&&ze.type==="fill-extrusion")return!0}else for(const Se in _e){const ze=_e[Se];if(ze.source===Ae&&ze.type==="fill-extrusion")return!0}return!1}(y&&y.layers,s,x.id),B=w.maxPitchScaleFactor(),j=x.tilesIn(g,B,E);j.sort(Xe);const Y=[];for(const ie of j)Y.push({wrappedTileID:ie.tileID.wrapped().key,queryResults:ie.tile.queryRenderedFeatures(s,h,x._state,ie.queryGeometry,ie.cameraQueryGeometry,ie.scale,y,w,B,rn(x.transform,ie.tileID))});const re=function(ie){const _e={},Ae={};for(const Se of ie){const ze=Se.queryResults,Re=Se.wrappedTileID,Be=Ae[Re]=Ae[Re]||{};for(const $e in ze){const Ie=ze[$e],qe=Be[$e]=Be[$e]||{},We=_e[$e]=_e[$e]||[];for(const nt of Ie)qe[nt.featureIndex]||(qe[nt.featureIndex]=!0,We.push(nt))}}return _e}(Y);for(const ie in re)re[ie].forEach(_e=>{const Ae=_e.feature,Se=x.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=Se});return re}function Xe(x,s){const h=x.tileID,g=s.tileID;return h.overscaledZ-g.overscaledZ||h.canonical.y-g.canonical.y||h.wrap-g.wrap||h.canonical.x-g.canonical.x}function qt(x,s,h){return a._(this,void 0,void 0,function*(){let g=x;if(x.url?g=(yield a.h(s.transformRequest(x.url,"Source"),h)).data:yield v.frameAsync(h),!g)return null;const y=a.M(a.e(g,x),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in g&&g.vector_layers&&(y.vectorLayerIds=g.vector_layers.map(w=>w.id)),y})}class Ge{constructor(s,h){s&&(h?this.setSouthWest(s).setNorthEast(h):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof a.N?new a.N(s.lng,s.lat):a.N.convert(s),this}setSouthWest(s){return this._sw=s instanceof a.N?new a.N(s.lng,s.lat):a.N.convert(s),this}extend(s){const h=this._sw,g=this._ne;let y,w;if(s instanceof a.N)y=s,w=s;else{if(!(s instanceof Ge))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Ge.convert(s)):this.extend(a.N.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(a.N.convert(s)):this;if(y=s._sw,w=s._ne,!y||!w)return this}return h||g?(h.lng=Math.min(y.lng,h.lng),h.lat=Math.min(y.lat,h.lat),g.lng=Math.max(w.lng,g.lng),g.lat=Math.max(w.lat,g.lat)):(this._sw=new a.N(y.lng,y.lat),this._ne=new a.N(w.lng,w.lat)),this}getCenter(){return new a.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a.N(this.getWest(),this.getNorth())}getSouthEast(){return new a.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:h,lat:g}=a.N.convert(s);let y=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(y=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=g&&g<=this._ne.lat&&y}static convert(s){return s instanceof Ge?s:s&&new Ge(s)}static fromLngLat(s,h=0){const g=360*h/40075017,y=g/Math.cos(Math.PI/180*s.lat);return new Ge(new a.N(s.lng-y,s.lat-g),new a.N(s.lng+y,s.lat+g))}adjustAntiMeridian(){const s=new a.N(this._sw.lng,this._sw.lat),h=new a.N(this._ne.lng,this._ne.lat);return new Ge(s,s.lng>h.lng?new a.N(h.lng+360,h.lat):h)}}class et{constructor(s,h,g){this.bounds=Ge.convert(this.validateBounds(s)),this.minzoom=h||0,this.maxzoom=g||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const h=Math.pow(2,s.z),g=Math.floor(a.O(this.bounds.getWest())*h),y=Math.floor(a.Q(this.bounds.getNorth())*h),w=Math.ceil(a.O(this.bounds.getEast())*h),E=Math.ceil(a.Q(this.bounds.getSouth())*h);return s.x>=g&&s.x<w&&s.y>=y&&s.y<E}}class nn extends a.E{constructor(s,h,g,y){if(super(),this.id=s,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,a.e(this,a.M(h,["url","scheme","tileSize","promoteId"])),this._options=a.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y)}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield qt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(a.e(this,s),s.bounds&&(this.tileBounds=new et(s.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new a.j(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return a.e({},this._options)}loadTile(s){return a._(this,void 0,void 0,function*(){const h=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g={request:this.map._requestManager.transformRequest(h,"Tile"),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};g.request.collectResourceTiming=this._collectResourceTiming;let y="RT";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((w,E)=>{s.reloadPromise={resolve:w,reject:E}})}else s.actor=this.dispatcher.getActor(),y="LT";s.abortController=new AbortController;try{const w=yield s.actor.sendAsync({type:y,data:g},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,w)}catch(w){if(delete s.abortController,s.aborted)return;if(w&&w.status!==404)throw w;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,h){if(h&&h.resourceTiming&&(s.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&s.setExpiryData(h),s.loadVectorData(h,this.map.painter),s.reloadPromise){const g=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(g.resolve).catch(g.reject)}}abortTile(s){return a._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"AT",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return a._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ye extends a.E{constructor(s,h,g,y){super(),this.id=s,this.dispatcher=g,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=a.e({type:"raster"},h),a.e(this,a.M(h,["url","scheme","tileSize"]))}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield qt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(a.e(this,s),s.bounds&&(this.tileBounds=new et(s.bounds,this.minzoom,this.maxzoom)),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new a.j(s))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return a.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return a._(this,void 0,void 0,function*(){const h=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const g=yield U.getImage(this.map._requestManager.transformRequest(h,"Tile"),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(g&&g.data){this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&s.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const y=this.map.painter.context,w=y.gl,E=g.data;s.texture=this.map.painter.getTileTexture(E.width),s.texture?s.texture.update(E,{useMipmap:!0}):(s.texture=new F(y,E,w.RGBA,{useMipmap:!0}),s.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST)),s.state="loaded"}}catch(g){if(delete s.abortController,s.aborted)s.state="unloaded";else if(g)throw s.state="errored",g}})}abortTile(s){return a._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return a._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class Ft extends Ye{constructor(s,h,g,y){super(s,h,g,y),this.type="raster-dem",this.maxzoom=22,this._options=a.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(s){return a._(this,void 0,void 0,function*(){const h=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),g=this.map._requestManager.transformRequest(h,"Tile");s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const y=yield U.getImage(g,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(y&&y.data){const w=y.data;this.map._refreshExpiredTiles&&y.cacheControl&&y.expires&&s.setExpiryData({cacheControl:y.cacheControl,expires:y.expires});const E=a.b(w)&&a.U()?w:yield this.readImageNow(w),B={type:this.type,uid:s.uid,source:this.id,rawImageData:E,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const j=yield s.actor.sendAsync({type:"LDT",data:B});s.dem=j,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(y){if(delete s.abortController,s.aborted)s.state="unloaded";else if(y)throw s.state="errored",y}})}readImageNow(s){return a._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&a.V()){const h=s.width+2,g=s.height+2;try{return new a.R({width:h,height:g},yield a.W(s,-1,-1,h,g))}catch{}}return v.getImageData(s,1)})}_getNeighboringTiles(s){const h=s.canonical,g=Math.pow(2,h.z),y=(h.x-1+g)%g,w=h.x===0?s.wrap-1:s.wrap,E=(h.x+1+g)%g,B=h.x+1===g?s.wrap+1:s.wrap,j={};return j[new a.S(s.overscaledZ,w,h.z,y,h.y).key]={backfilled:!1},j[new a.S(s.overscaledZ,B,h.z,E,h.y).key]={backfilled:!1},h.y>0&&(j[new a.S(s.overscaledZ,w,h.z,y,h.y-1).key]={backfilled:!1},j[new a.S(s.overscaledZ,s.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},j[new a.S(s.overscaledZ,B,h.z,E,h.y-1).key]={backfilled:!1}),h.y+1<g&&(j[new a.S(s.overscaledZ,w,h.z,y,h.y+1).key]={backfilled:!1},j[new a.S(s.overscaledZ,s.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},j[new a.S(s.overscaledZ,B,h.z,E,h.y+1).key]={backfilled:!1}),j}unloadTile(s){return a._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"RDT",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class Tt extends a.E{constructor(s,h,g,y){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=g.getActor(),this.setEventedParent(y),this._data=h.data,this._options=a.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const w=a.X/this.tileSize;h.clusterMaxZoom!==void 0&&this.maxzoom<=h.clusterMaxZoom&&a.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${h.clusterMaxZoom}".`),this.workerOptions=a.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*w,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*w,extent:a.X,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:a.X,radius:(h.clusterRadius||50)*w,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return a._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}getData(){return a._(this,void 0,void 0,function*(){const s=a.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:s})})}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,h,g){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:s,limit:h,offset:g}})}_updateWorkerData(s){return a._(this,void 0,void 0,function*(){const h=a.e({type:this.type},this.workerOptions);s?h.dataDiff=s:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(v.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new a.k("dataloading",{dataType:"source"}));try{const g=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||g.abandoned)return void this.fire(new a.k("dataabort",{dataType:"source"}));let y=null;g.resourceTiming&&g.resourceTiming[this.id]&&(y=g.resourceTiming[this.id].slice(0));const w={dataType:"source"};this._collectResourceTiming&&y&&y.length>0&&a.e(w,{resourceTiming:y}),this.fire(new a.k("data",Object.assign(Object.assign({},w),{sourceDataType:"metadata"}))),this.fire(new a.k("data",Object.assign(Object.assign({},w),{sourceDataType:"content"})))}catch(g){if(this._pendingLoads--,this._removed)return void this.fire(new a.k("dataabort",{dataType:"source"}));this.fire(new a.j(g))}})}loaded(){return this._pendingLoads===0}loadTile(s){return a._(this,void 0,void 0,function*(){const h=s.actor?"RT":"LT";s.actor=this.actor;const g={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.abortController=new AbortController;const y=yield this.actor.sendAsync({type:h,data:g},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(y,this.map.painter,h==="RT")})}abortTile(s){return a._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return a._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return a.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Rn=a.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class fr extends a.E{constructor(s,h,g,y){super(),this.id=s,this.dispatcher=g,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=h}load(s){return a._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new a.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield U.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,s&&(this.coordinates=s),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new a.j(h))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new a.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const h=s.map(a.Z.fromLngLat);this.tileID=function(y){let w=1/0,E=1/0,B=-1/0,j=-1/0;for(const _e of y)w=Math.min(w,_e.x),E=Math.min(E,_e.y),B=Math.max(B,_e.x),j=Math.max(j,_e.y);const Y=Math.max(B-w,j-E),re=Math.max(0,Math.floor(-Math.log(Y)/Math.LN2)),ie=Math.pow(2,re);return new a.a1(re,Math.floor((w+B)/2*ie),Math.floor((E+j)/2*ie))}(h),this.minzoom=this.maxzoom=this.tileID.z;const g=h.map(y=>this.tileID.getTilePoint(y)._round());return this._boundsArray=new a.$,this._boundsArray.emplaceBack(g[0].x,g[0].y,0,0),this._boundsArray.emplaceBack(g[1].x,g[1].y,a.X,0),this._boundsArray.emplaceBack(g[3].x,g[3].y,0,a.X),this._boundsArray.emplaceBack(g[2].x,g[2].y,a.X,a.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new a.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Rn.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new F(s,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let g=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,g=!0)}g&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return a._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class un extends fr{constructor(s,h,g,y){super(s,h,g,y),this.roundZoom=!0,this.type="video",this.options=h}load(){return a._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const h of s.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield a.a3(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new a.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const h=this.video.seekable;s<h.start(0)||s>h.end(0)?this.fire(new a.j(new a.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,h=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Rn.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new F(s,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let g=!1;for(const y in this.tiles){const w=this.tiles[y];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture,g=!0)}g&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Dt extends fr{constructor(s,h,g,y){super(s,h,g,y),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(E=>typeof E!="number"))||this.fire(new a.j(new a.a2(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new a.j(new a.a2(`sources.${s}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new a.j(new a.a2(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new a.j(new a.a2(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new a.j(new a.a2(`sources.${s}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return a._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new a.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,g=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Rn.members)),this.boundsSegments||(this.boundsSegments=a.a0.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new F(h,this.canvas,g.RGBA,{premultiply:!0});let y=!1;for(const w in this.tiles){const E=this.tiles[w];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture,y=!0)}y&&this.fire(new a.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Mt={},Vr=x=>{switch(x){case"geojson":return Tt;case"image":return fr;case"raster":return Ye;case"raster-dem":return Ft;case"vector":return nn;case"video":return un;case"canvas":return Dt}return Mt[x]},vt="RTLPluginLoaded";class Cn extends a.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=tn()}_syncState(s){return this.status=s,this.dispatcher.broadcast("SRPS",{pluginStatus:s,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return a._(this,arguments,void 0,function*(h,g=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=v.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!g)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return a._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new a.k(vt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Zn=null;function jr(){return Zn||(Zn=new Cn),Zn}class Nr{constructor(s,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=a.a4(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const h=s+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,h,g){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(y,w){const E={};if(!w)return E;for(const B of y){const j=B.layerIds.map(Y=>w.getLayer(Y)).filter(Boolean);if(j.length!==0){B.layers=j,B.stateDependentLayerIds&&(B.stateDependentLayers=B.stateDependentLayerIds.map(Y=>j.filter(re=>re.id===Y)[0]));for(const Y of j)E[Y.id]=B}}return E}(s.buckets,h.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const w=this.buckets[y];if(w instanceof a.a6){if(this.hasSymbolBuckets=!0,!g)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const w=this.buckets[y];if(w instanceof a.a6&&w.hasRTLText){this.hasRTLText=!0,jr().lazyLoad();break}}this.queryPadding=0;for(const y in this.buckets){const w=this.buckets[y];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(y).queryRadius(w))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new a.a5}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const g in this.buckets){const y=this.buckets[g];y.uploadPending()&&y.upload(s)}const h=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new F(s,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new F(s,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,h,g,y,w,E,B,j,Y,re){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:y,cameraQueryGeometry:w,scale:E,tileSize:this.tileSize,pixelPosMatrix:re,transform:j,params:B,queryPadding:this.queryPadding*Y},s,h,g):{}}querySourceFeatures(s,h){const g=this.latestFeatureIndex;if(!g||!g.rawTileData)return;const y=g.loadVTLayers(),w=h&&h.sourceLayer?h.sourceLayer:"",E=y._geojsonTileLayer||y[w];if(!E)return;const B=a.a7(h&&h.filter),{z:j,x:Y,y:re}=this.tileID.canonical,ie={z:j,x:Y,y:re};for(let _e=0;_e<E.length;_e++){const Ae=E.feature(_e);if(B.needGeometry){const Re=a.a8(Ae,!0);if(!B.filter(new a.z(this.tileID.overscaledZ),Re,this.tileID.canonical))continue}else if(!B.filter(new a.z(this.tileID.overscaledZ),Ae))continue;const Se=g.getId(Ae,w),ze=new a.a9(Ae,j,Y,re,Se);ze.tile=ie,s.push(ze)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const h=this.expirationTime;if(s.cacheControl){const g=a.aa(s.cacheControl);g["max-age"]&&(this.expirationTime=Date.now()+1e3*g["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const g=Date.now();let y=!1;if(this.expirationTime>g)y=!1;else if(h)if(this.expirationTime<h)y=!0;else{const w=this.expirationTime-h;w?this.expirationTime=g+Math.max(w,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const g=this.latestFeatureIndex.loadVTLayers();for(const y in this.buckets){if(!h.style.hasLayer(y))continue;const w=this.buckets[y],E=w.layers[0].sourceLayer||"_geojsonTileLayer",B=g[E],j=s[E];if(!B||!j||Object.keys(j).length===0)continue;w.update(j,B,this.imageAtlas&&this.imageAtlas.patternPositions||{});const Y=h&&h.style&&h.style.getLayer(y);Y&&(this.queryPadding=Math.max(this.queryPadding,Y.queryRadius(w)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<v.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=v.now()+s}setDependencies(s,h){const g={};for(const y of h)g[y]=!0;this.dependencies[s]=g}hasDependency(s,h){for(const g of s){const y=this.dependencies[g];if(y){for(const w of h)if(y[w])return!0}}return!1}}class Lt{constructor(s,h){this.max=s,this.onRemove=h,this.reset()}reset(){for(const s in this.data)for(const h of this.data[s])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(s,h,g){const y=s.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const w={value:h,timeout:void 0};if(g!==void 0&&(w.timeout=setTimeout(()=>{this.remove(s,w)},g)),this.data[y].push(w),this.order.push(y),this.order.length>this.max){const E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const h=this.data[s].shift();return h.timeout&&clearTimeout(h.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),h.value}getByKey(s){const h=this.data[s];return h?h[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,h){if(!this.has(s))return this;const g=s.wrapped().key,y=h===void 0?0:this.data[g].indexOf(h),w=this.data[g][y];return this.data[g].splice(y,1),w.timeout&&clearTimeout(w.timeout),this.data[g].length===0&&delete this.data[g],this.onRemove(w.value),this.order.splice(this.order.indexOf(g),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(s){const h=[];for(const g in this.data)for(const y of this.data[g])s(y.value)||h.push(y);for(const g of h)this.remove(g.value.tileID,g)}}class tt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,h,g){const y=String(h);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][y]=this.stateChanges[s][y]||{},a.e(this.stateChanges[s][y],g),this.deletedStates[s]===null){this.deletedStates[s]={};for(const w in this.state[s])w!==y&&(this.deletedStates[s][w]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][y]===null){this.deletedStates[s][y]={};for(const w in this.state[s][y])g[w]||(this.deletedStates[s][y][w]=null)}else for(const w in g)this.deletedStates[s]&&this.deletedStates[s][y]&&this.deletedStates[s][y][w]===null&&delete this.deletedStates[s][y][w]}removeFeatureState(s,h,g){if(this.deletedStates[s]===null)return;const y=String(h);if(this.deletedStates[s]=this.deletedStates[s]||{},g&&h!==void 0)this.deletedStates[s][y]!==null&&(this.deletedStates[s][y]=this.deletedStates[s][y]||{},this.deletedStates[s][y][g]=null);else if(h!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][y])for(g in this.deletedStates[s][y]={},this.stateChanges[s][y])this.deletedStates[s][y][g]=null;else this.deletedStates[s][y]=null;else this.deletedStates[s]=null}getState(s,h){const g=String(h),y=a.e({},(this.state[s]||{})[g],(this.stateChanges[s]||{})[g]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const w=this.deletedStates[s][h];if(w===null)return{};for(const E in w)delete y[E]}return y}initializeTileState(s,h){s.setFeatureState(this.state,h)}coalesceChanges(s,h){const g={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const w={};for(const E in this.stateChanges[y])this.state[y][E]||(this.state[y][E]={}),a.e(this.state[y][E],this.stateChanges[y][E]),w[E]=this.state[y][E];g[y]=w}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const w={};if(this.deletedStates[y]===null)for(const E in this.state[y])w[E]={},this.state[y][E]={};else for(const E in this.deletedStates[y]){if(this.deletedStates[y][E]===null)this.state[y][E]={};else for(const B of Object.keys(this.deletedStates[y][E]))delete this.state[y][E][B];w[E]=this.state[y][E]}g[y]=g[y]||{},a.e(g[y],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(g).length!==0)for(const y in s)s[y].setFeatureState(g,h)}}class pt extends a.E{constructor(s,h,g){super(),this.id=s,this.dispatcher=g,this.on("data",y=>this._dataHandler(y)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((y,w,E,B)=>{const j=new(Vr(w.type))(y,w,E,B);if(j.id!==y)throw new Error(`Expected Source id to be ${y} instead of ${j.id}`);return j})(s,h,g,this),this._tiles={},this._cache=new Lt(0,y=>this._unloadTile(y)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new tt,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const h=this._tiles[s];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,h,g){return a._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,h,g)}catch(y){s.state="errored",y.status!==404?this._source.fire(new a.j(y,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new a.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const g=this._tiles[h];g.upload(s),g.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort($t).map(s=>s.key)}getRenderableIds(s){const h=[];for(const g in this._tiles)this._isIdRenderable(g,s)&&h.push(this._tiles[g]);return s?h.sort((g,y)=>{const w=g.tileID,E=y.tileID,B=new a.P(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),j=new a.P(E.canonical.x,E.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-E.overscaledZ||j.y-B.y||j.x-B.x}).map(g=>g.tileID.key):h.map(g=>g.tileID).sort($t).map(g=>g.key)}hasRenderableParent(s){const h=this.findLoadedParent(s,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(s,h){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(h||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,h){return a._(this,void 0,void 0,function*(){const g=this._tiles[s];g&&(g.state!=="loading"&&(g.state=h),yield this._loadTile(g,s,h))})}_tileLoaded(s,h,g){s.timeAdded=v.now(),g==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(h,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new a.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const h=this.getRenderableIds();for(let y=0;y<h.length;y++){const w=h[y];if(s.neighboringTiles&&s.neighboringTiles[w]){const E=this.getTileByID(w);g(s,E),g(E,s)}}function g(y,w){y.needsHillshadePrepare=!0,y.needsTerrainPrepare=!0;let E=w.tileID.canonical.x-y.tileID.canonical.x;const B=w.tileID.canonical.y-y.tileID.canonical.y,j=Math.pow(2,y.tileID.canonical.z),Y=w.tileID.key;E===0&&B===0||Math.abs(B)>1||(Math.abs(E)>1&&(Math.abs(E+j)===1?E+=j:Math.abs(E-j)===1&&(E-=j)),w.dem&&y.dem&&(y.dem.backfillBorder(w.dem,E,B),y.neighboringTiles&&y.neighboringTiles[Y]&&(y.neighboringTiles[Y].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,h,g,y){for(const w in this._tiles){let E=this._tiles[w];if(y[w]||!E.hasData()||E.tileID.overscaledZ<=h||E.tileID.overscaledZ>g)continue;let B=E.tileID;for(;E&&E.tileID.overscaledZ>h+1;){const Y=E.tileID.scaledTo(E.tileID.overscaledZ-1);E=this._tiles[Y.key],E&&E.hasData()&&(B=Y)}let j=B;for(;j.overscaledZ>h;)if(j=j.scaledTo(j.overscaledZ-1),s[j.key]){y[B.key]=B;break}}}findLoadedParent(s,h){if(s.key in this._loadedParentTiles){const g=this._loadedParentTiles[s.key];return g&&g.tileID.overscaledZ>=h?g:null}for(let g=s.overscaledZ-1;g>=h;g--){const y=s.scaledTo(g),w=this._getLoadedTile(y);if(w)return w}}findLoadedSibling(s){return this._getLoadedTile(s)}_getLoadedTile(s){const h=this._tiles[s.key];return h&&h.hasData()?h:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const h=Math.ceil(s.width/this._source.tileSize)+1,g=Math.ceil(s.height/this._source.tileSize)+1,y=Math.floor(h*g*(this._maxTileCacheZoomLevels===null?a.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),w=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(s){const h=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,h){const g={};for(const y in this._tiles){const w=this._tiles[y];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+h),g[w.tileID.key]=w}this._tiles=g;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(y,this._tiles[y])}}_updateCoveredAndRetainedTiles(s,h,g,y,w,E){const B={},j={},Y=Object.keys(s),re=v.now();for(const ie of Y){const _e=s[ie],Ae=this._tiles[ie];if(!Ae||Ae.fadeEndTime!==0&&Ae.fadeEndTime<=re)continue;const Se=this.findLoadedParent(_e,h),ze=this.findLoadedSibling(_e),Re=Se||ze||null;Re&&(this._addTile(Re.tileID),B[Re.tileID.key]=Re.tileID),j[ie]=_e}this._retainLoadedChildren(j,y,g,s);for(const ie in B)s[ie]||(this._coveredTiles[ie]=!0,s[ie]=B[ie]);if(E){const ie={},_e={};for(const Ae of w)this._tiles[Ae.key].hasData()?ie[Ae.key]=Ae:_e[Ae.key]=Ae;for(const Ae in _e){const Se=_e[Ae].children(this._source.maxzoom);this._tiles[Se[0].key]&&this._tiles[Se[1].key]&&this._tiles[Se[2].key]&&this._tiles[Se[3].key]&&(ie[Se[0].key]=s[Se[0].key]=Se[0],ie[Se[1].key]=s[Se[1].key]=Se[1],ie[Se[2].key]=s[Se[2].key]=Se[2],ie[Se[3].key]=s[Se[3].key]=Se[3],delete _e[Ae])}for(const Ae in _e){const Se=_e[Ae],ze=this.findLoadedParent(Se,this._source.minzoom),Re=this.findLoadedSibling(Se),Be=ze||Re||null;if(Be){ie[Be.tileID.key]=s[Be.tileID.key]=Be.tileID;for(const $e in ie)ie[$e].isChildOf(Be.tileID)&&delete ie[$e]}}for(const Ae in this._tiles)ie[Ae]||(this._coveredTiles[Ae]=!0)}}update(s,h){if(!this._sourceLoaded||this._paused)return;let g;this.transform=s,this.terrain=h,this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?g=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(re=>new a.S(re.canonical.z,re.wrap,re.canonical.z,re.canonical.x,re.canonical.y)):(g=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(g=g.filter(re=>this._source.hasTile(re)))):g=[];const y=s.coveringZoomLevel(this._source),w=Math.max(y-pt.maxOverzooming,this._source.minzoom),E=Math.max(y+pt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const re={};for(const ie of g)if(ie.canonical.z>this._source.minzoom){const _e=ie.scaledTo(ie.canonical.z-1);re[_e.key]=_e;const Ae=ie.scaledTo(Math.max(this._source.minzoom,Math.min(ie.canonical.z,5)));re[Ae.key]=Ae}g=g.concat(Object.values(re))}const B=g.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,B&&this.fire(new a.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const j=this._updateRetainedTiles(g,y);Bn(this._source.type)&&this._updateCoveredAndRetainedTiles(j,w,E,y,g,h);for(const re in j)this._tiles[re].clearFadeHold();const Y=a.ab(this._tiles,j);for(const re of Y){const ie=this._tiles[re];ie.hasSymbolBuckets&&!ie.holdingForFade()?ie.setHoldDuration(this.map._fadeDuration):ie.hasSymbolBuckets&&!ie.symbolFadeFinished()||this._removeTile(re)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,h){var g;const y={},w={},E=Math.max(h-pt.maxOverzooming,this._source.minzoom),B=Math.max(h+pt.maxUnderzooming,this._source.minzoom),j={};for(const Y of s){const re=this._addTile(Y);y[Y.key]=Y,re.hasData()||h<this._source.maxzoom&&(j[Y.key]=Y)}this._retainLoadedChildren(j,h,B,y);for(const Y of s){let re=this._tiles[Y.key];if(re.hasData())continue;if(h+1>this._source.maxzoom){const _e=Y.children(this._source.maxzoom)[0],Ae=this.getTile(_e);if(Ae&&Ae.hasData()){y[_e.key]=_e;continue}}else{const _e=Y.children(this._source.maxzoom);if(y[_e[0].key]&&y[_e[1].key]&&y[_e[2].key]&&y[_e[3].key])continue}let ie=re.wasRequested();for(let _e=Y.overscaledZ-1;_e>=E;--_e){const Ae=Y.scaledTo(_e);if(w[Ae.key])break;if(w[Ae.key]=!0,re=this.getTile(Ae),!re&&ie&&(re=this._addTile(Ae)),re){const Se=re.hasData();if((Se||!(!((g=this.map)===null||g===void 0)&&g.cancelPendingTileRequestsWhileZooming)||ie)&&(y[Ae.key]=Ae),ie=re.wasRequested(),Se)break}}}return y}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const h=[];let g,y=this._tiles[s].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){g=this._loadedParentTiles[y.key];break}h.push(y.key);const w=y.scaledTo(y.overscaledZ-1);if(g=this._getLoadedTile(w),g)break;y=w}for(const w of h)this._loadedParentTiles[w]=g}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const s in this._tiles){const h=this._tiles[s].tileID,g=this._getLoadedTile(h);this._loadedSiblingTiles[h.key]=g}}_addTile(s){let h=this._tiles[s.key];if(h)return h;h=this._cache.getAndRemove(s),h&&(this._setTileReloadTimer(s.key,h),h.tileID=s,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,h)));const g=h;return h||(h=new Nr(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(h,s.key,h.state)),h.uses++,this._tiles[s.key]=h,g||this._source.fire(new a.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(s,h){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const g=h.getExpiryTimeout();g&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},g))}_removeTile(s){const h=this._tiles[s];h&&(h.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(s){const h=s.sourceDataType;s.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&s.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,h,g){const y=[],w=this.transform;if(!w)return y;const E=g?w.getCameraQueryGeometry(s):s,B=s.map(Se=>w.pointCoordinate(Se,this.terrain)),j=E.map(Se=>w.pointCoordinate(Se,this.terrain)),Y=this.getIds();let re=1/0,ie=1/0,_e=-1/0,Ae=-1/0;for(const Se of j)re=Math.min(re,Se.x),ie=Math.min(ie,Se.y),_e=Math.max(_e,Se.x),Ae=Math.max(Ae,Se.y);for(let Se=0;Se<Y.length;Se++){const ze=this._tiles[Y[Se]];if(ze.holdingForFade())continue;const Re=ze.tileID,Be=Math.pow(2,w.zoom-ze.tileID.overscaledZ),$e=h*ze.queryPadding*a.X/ze.tileSize/Be,Ie=[Re.getTilePoint(new a.Z(re,ie)),Re.getTilePoint(new a.Z(_e,Ae))];if(Ie[0].x-$e<a.X&&Ie[0].y-$e<a.X&&Ie[1].x+$e>=0&&Ie[1].y+$e>=0){const qe=B.map(nt=>Re.getTilePoint(nt)),We=j.map(nt=>Re.getTilePoint(nt));y.push({tile:ze,tileID:Re,queryGeometry:qe,cameraQueryGeometry:We,scale:Be})}}return y}getVisibleCoordinates(s){const h=this.getRenderableIds(s).map(g=>this._tiles[g].tileID);for(const g of h)g.posMatrix=this.transform.calculatePosMatrix(g.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(Bn(this._source.type)){const s=v.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=s)return!0}return!1}setFeatureState(s,h,g){this._state.updateState(s=s||"_geojsonTileLayer",h,g)}removeFeatureState(s,h,g){this._state.removeFeatureState(s=s||"_geojsonTileLayer",h,g)}getFeatureState(s,h){return this._state.getState(s=s||"_geojsonTileLayer",h)}setDependencies(s,h,g){const y=this._tiles[s];y&&y.setDependencies(h,g)}reloadTilesForDependencies(s,h){for(const g in this._tiles)this._tiles[g].hasDependency(s,h)&&this._reloadTile(g,"reloading");this._cache.filter(g=>!g.hasDependency(s,h))}}function $t(x,s){const h=Math.abs(2*x.wrap)-+(x.wrap<0),g=Math.abs(2*s.wrap)-+(s.wrap<0);return x.overscaledZ-s.overscaledZ||g-h||s.canonical.y-x.canonical.y||s.canonical.x-x.canonical.x}function Bn(x){return x==="raster"||x==="image"||x==="video"}pt.maxOverzooming=10,pt.maxUnderzooming=3;class zt{constructor(s,h){this.reset(s,h)}reset(s,h){this.points=s||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=a.ac(s,0,1);let h=1,g=this._distances[h];const y=s*this.paddedLength+this.padding;for(;g<y&&h<this._distances.length;)g=this._distances[++h];const w=h-1,E=this._distances[w],B=g-E,j=B>0?(y-E)/B:0;return this.points[w].mult(1-j).add(this.points[h].mult(j))}}function hr(x,s){let h=!0;return x==="always"||x!=="never"&&s!=="never"||(h=!1),h}class ir{constructor(s,h,g){const y=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(s/g),this.yCellCount=Math.ceil(h/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)y.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=h,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,h,g,y,w){this._forEachCell(h,g,y,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(y),this.bboxes.push(w)}insertCircle(s,h,g,y){this._forEachCell(h-y,g-y,h+y,g+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(h),this.circles.push(g),this.circles.push(y)}_insertBoxCell(s,h,g,y,w,E){this.boxCells[w].push(E)}_insertCircleCell(s,h,g,y,w,E){this.circleCells[w].push(E)}_query(s,h,g,y,w,E,B){if(g<0||s>this.width||y<0||h>this.height)return[];const j=[];if(s<=0&&h<=0&&this.width<=g&&this.height<=y){if(w)return[{key:null,x1:s,y1:h,x2:g,y2:y}];for(let Y=0;Y<this.boxKeys.length;Y++)j.push({key:this.boxKeys[Y],x1:this.bboxes[4*Y],y1:this.bboxes[4*Y+1],x2:this.bboxes[4*Y+2],y2:this.bboxes[4*Y+3]});for(let Y=0;Y<this.circleKeys.length;Y++){const re=this.circles[3*Y],ie=this.circles[3*Y+1],_e=this.circles[3*Y+2];j.push({key:this.circleKeys[Y],x1:re-_e,y1:ie-_e,x2:re+_e,y2:ie+_e})}}else this._forEachCell(s,h,g,y,this._queryCell,j,{hitTest:w,overlapMode:E,seenUids:{box:{},circle:{}}},B);return j}query(s,h,g,y){return this._query(s,h,g,y,!1,null)}hitTest(s,h,g,y,w,E){return this._query(s,h,g,y,!0,w,E).length>0}hitTestCircle(s,h,g,y,w){const E=s-g,B=s+g,j=h-g,Y=h+g;if(B<0||E>this.width||Y<0||j>this.height)return!1;const re=[];return this._forEachCell(E,j,B,Y,this._queryCellCircle,re,{hitTest:!0,overlapMode:y,circle:{x:s,y:h,radius:g},seenUids:{box:{},circle:{}}},w),re.length>0}_queryCell(s,h,g,y,w,E,B,j){const{seenUids:Y,hitTest:re,overlapMode:ie}=B,_e=this.boxCells[w];if(_e!==null){const Se=this.bboxes;for(const ze of _e)if(!Y.box[ze]){Y.box[ze]=!0;const Re=4*ze,Be=this.boxKeys[ze];if(s<=Se[Re+2]&&h<=Se[Re+3]&&g>=Se[Re+0]&&y>=Se[Re+1]&&(!j||j(Be))&&(!re||!hr(ie,Be.overlapMode))&&(E.push({key:Be,x1:Se[Re],y1:Se[Re+1],x2:Se[Re+2],y2:Se[Re+3]}),re))return!0}}const Ae=this.circleCells[w];if(Ae!==null){const Se=this.circles;for(const ze of Ae)if(!Y.circle[ze]){Y.circle[ze]=!0;const Re=3*ze,Be=this.circleKeys[ze];if(this._circleAndRectCollide(Se[Re],Se[Re+1],Se[Re+2],s,h,g,y)&&(!j||j(Be))&&(!re||!hr(ie,Be.overlapMode))){const $e=Se[Re],Ie=Se[Re+1],qe=Se[Re+2];if(E.push({key:Be,x1:$e-qe,y1:Ie-qe,x2:$e+qe,y2:Ie+qe}),re)return!0}}}return!1}_queryCellCircle(s,h,g,y,w,E,B,j){const{circle:Y,seenUids:re,overlapMode:ie}=B,_e=this.boxCells[w];if(_e!==null){const Se=this.bboxes;for(const ze of _e)if(!re.box[ze]){re.box[ze]=!0;const Re=4*ze,Be=this.boxKeys[ze];if(this._circleAndRectCollide(Y.x,Y.y,Y.radius,Se[Re+0],Se[Re+1],Se[Re+2],Se[Re+3])&&(!j||j(Be))&&!hr(ie,Be.overlapMode))return E.push(!0),!0}}const Ae=this.circleCells[w];if(Ae!==null){const Se=this.circles;for(const ze of Ae)if(!re.circle[ze]){re.circle[ze]=!0;const Re=3*ze,Be=this.circleKeys[ze];if(this._circlesCollide(Se[Re],Se[Re+1],Se[Re+2],Y.x,Y.y,Y.radius)&&(!j||j(Be))&&!hr(ie,Be.overlapMode))return E.push(!0),!0}}}_forEachCell(s,h,g,y,w,E,B,j){const Y=this._convertToXCellCoord(s),re=this._convertToYCellCoord(h),ie=this._convertToXCellCoord(g),_e=this._convertToYCellCoord(y);for(let Ae=Y;Ae<=ie;Ae++)for(let Se=re;Se<=_e;Se++)if(w.call(this,s,h,g,y,this.xCellCount*Se+Ae,E,B,j))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,h,g,y,w,E){const B=y-s,j=w-h,Y=g+E;return Y*Y>B*B+j*j}_circleAndRectCollide(s,h,g,y,w,E,B){const j=(E-y)/2,Y=Math.abs(s-(y+j));if(Y>j+g)return!1;const re=(B-w)/2,ie=Math.abs(h-(w+re));if(ie>re+g)return!1;if(Y<=j||ie<=re)return!0;const _e=Y-j,Ae=ie-re;return _e*_e+Ae*Ae<=g*g}}function Gr(x,s,h,g,y){const w=a.H();return s?(a.K(w,w,[1/y,1/y,1]),h||a.ad(w,w,g.angle)):a.L(w,g.labelPlaneMatrix,x),w}function br(x,s,h,g,y){if(s){const w=a.ae(x);return a.K(w,w,[y,y,1]),h||a.ad(w,w,-g.angle),w}return g.glCoordMatrix}function Ce(x,s,h,g){let y;g?(y=[x,s,g(x,s),1],a.af(y,y,h)):(y=[x,s,0,1],Qn(y,y,h));const w=y[3];return{point:new a.P(y[0]/w,y[1]/w),signedDistanceFromCamera:w,isOccluded:!1}}function oe(x,s){return .5+x/s*.5}function le(x,s){return x.x>=-s[0]&&x.x<=s[0]&&x.y>=-s[1]&&x.y<=s[1]}function we(x,s,h,g,y,w,E,B,j,Y,re,ie,_e,Ae,Se){const ze=g?x.textSizeData:x.iconSizeData,Re=a.ag(ze,h.transform.zoom),Be=[256/h.width*2+1,256/h.height*2+1],$e=g?x.text.dynamicLayoutVertexArray:x.icon.dynamicLayoutVertexArray;$e.clear();const Ie=x.lineVertexArray,qe=g?x.text.placedSymbolArray:x.icon.placedSymbolArray,We=h.transform.width/h.transform.height;let nt=!1;for(let bt=0;bt<qe.length;bt++){const Pt=qe.get(bt);if(Pt.hidden||Pt.writingMode===a.ah.vertical&&!nt){mn(Pt.numGlyphs,$e);continue}nt=!1;const Vt=Ce(Pt.anchorX,Pt.anchorY,s,Se);if(!le(Vt.point,Be)){mn(Pt.numGlyphs,$e);continue}const Jt=oe(h.transform.cameraToCenterDistance,Vt.signedDistanceFromCamera),Ot=a.ai(ze,Re,Pt),Bt=E?Ot/Jt:Ot*Jt,ln={getElevation:Se,labelPlaneMatrix:y,lineVertexArray:Ie,pitchWithMap:E,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:Y,tileAnchorPoint:new a.P(Pt.anchorX,Pt.anchorY),unwrappedTileID:re,width:ie,height:_e,translation:Ae},In=Ve(ln,Pt,Bt,!1,B,s,w,x.glyphOffsetArray,$e,We,j);nt=In.useVertical,(In.notEnoughRoom||nt||In.needsFlipping&&Ve(ln,Pt,Bt,!0,B,s,w,x.glyphOffsetArray,$e,We,j).notEnoughRoom)&&mn(Pt.numGlyphs,$e)}g?x.text.dynamicLayoutVertexBuffer.updateData($e):x.icon.dynamicLayoutVertexBuffer.updateData($e)}function Me(x,s,h,g,y,w,E,B){const j=w.glyphStartIndex+w.numGlyphs,Y=w.lineStartIndex,re=w.lineStartIndex+w.lineLength,ie=s.getoffsetX(w.glyphStartIndex),_e=s.getoffsetX(j-1),Ae=Rt(x*ie,h,g,y,w.segment,Y,re,B,E);if(!Ae)return null;const Se=Rt(x*_e,h,g,y,w.segment,Y,re,B,E);return Se?B.projectionCache.anyProjectionOccluded?null:{first:Ae,last:Se}:null}function Ne(x,s,h,g){return x===a.ah.horizontal&&Math.abs(h.y-s.y)>Math.abs(h.x-s.x)*g?{useVertical:!0}:(x===a.ah.vertical?s.y<h.y:s.x>h.x)?{needsFlipping:!0}:null}function Ve(x,s,h,g,y,w,E,B,j,Y,re){const ie=h/24,_e=s.lineOffsetX*ie,Ae=s.lineOffsetY*ie;let Se;if(s.numGlyphs>1){const ze=s.glyphStartIndex+s.numGlyphs,Re=s.lineStartIndex,Be=s.lineStartIndex+s.lineLength,$e=Me(ie,B,_e,Ae,g,s,re,x);if(!$e)return{notEnoughRoom:!0};const Ie=Ce($e.first.point.x,$e.first.point.y,E,x.getElevation).point,qe=Ce($e.last.point.x,$e.last.point.y,E,x.getElevation).point;if(y&&!g){const We=Ne(s.writingMode,Ie,qe,Y);if(We)return We}Se=[$e.first];for(let We=s.glyphStartIndex+1;We<ze-1;We++)Se.push(Rt(ie*B.getoffsetX(We),_e,Ae,g,s.segment,Re,Be,x,re));Se.push($e.last)}else{if(y&&!g){const Re=Ce(x.tileAnchorPoint.x,x.tileAnchorPoint.y,w,x.getElevation).point,Be=s.lineStartIndex+s.segment+1,$e=new a.P(x.lineVertexArray.getx(Be),x.lineVertexArray.gety(Be)),Ie=Ce($e.x,$e.y,w,x.getElevation),qe=Ie.signedDistanceFromCamera>0?Ie.point:function(nt,bt,Pt,Vt,Jt,Ot){return Ke(nt,bt,Pt,1,Jt,Ot)}(x.tileAnchorPoint,$e,Re,0,w,x),We=Ne(s.writingMode,Re,qe,Y);if(We)return We}const ze=Rt(ie*B.getoffsetX(s.glyphStartIndex),_e,Ae,g,s.segment,s.lineStartIndex,s.lineStartIndex+s.lineLength,x,re);if(!ze||x.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};Se=[ze]}for(const ze of Se)a.aj(j,ze.point,ze.angle);return{}}function Ke(x,s,h,g,y,w){const E=x.add(x.sub(s)._unit()),B=y!==void 0?Ce(E.x,E.y,y,w.getElevation).point:ut(E.x,E.y,w).point,j=h.sub(B);return h.add(j._mult(g/j.mag()))}function Oe(x,s,h){const g=s.projectionCache;if(g.projections[x])return g.projections[x];const y=new a.P(s.lineVertexArray.getx(x),s.lineVertexArray.gety(x)),w=ut(y.x,y.y,s);if(w.signedDistanceFromCamera>0)return g.projections[x]=w.point,g.anyProjectionOccluded=g.anyProjectionOccluded||w.isOccluded,w.point;const E=x-h.direction;return function(B,j,Y,re,ie){return Ke(B,j,Y,re,void 0,ie)}(h.distanceFromAnchor===0?s.tileAnchorPoint:new a.P(s.lineVertexArray.getx(E),s.lineVertexArray.gety(E)),y,h.previousVertex,h.absOffsetX-h.distanceFromAnchor+1,s)}function ut(x,s,h){const g=x+h.translation[0],y=s+h.translation[1];let w;return!h.pitchWithMap&&h.projection.useSpecialProjectionForSymbols?(w=h.projection.projectTileCoordinates(g,y,h.unwrappedTileID,h.getElevation),w.point.x=(.5*w.point.x+.5)*h.width,w.point.y=(.5*-w.point.y+.5)*h.height):(w=Ce(g,y,h.labelPlaneMatrix,h.getElevation),w.isOccluded=!1),w}function At(x,s,h){return x._unit()._perp()._mult(s*h)}function st(x,s,h,g,y,w,E,B,j){if(B.projectionCache.offsets[x])return B.projectionCache.offsets[x];const Y=h.add(s);if(x+j.direction<g||x+j.direction>=y)return B.projectionCache.offsets[x]=Y,Y;const re=Oe(x+j.direction,B,j),ie=At(re.sub(h),E,j.direction),_e=h.add(ie),Ae=re.add(ie);return B.projectionCache.offsets[x]=a.ak(w,Y,_e,Ae)||Y,B.projectionCache.offsets[x]}function Rt(x,s,h,g,y,w,E,B,j){const Y=g?x-s:x+s;let re=Y>0?1:-1,ie=0;g&&(re*=-1,ie=Math.PI),re<0&&(ie+=Math.PI);let _e,Ae=re>0?w+y:w+y+1;B.projectionCache.cachedAnchorPoint?_e=B.projectionCache.cachedAnchorPoint:(_e=ut(B.tileAnchorPoint.x,B.tileAnchorPoint.y,B).point,B.projectionCache.cachedAnchorPoint=_e);let Se,ze,Re=_e,Be=_e,$e=0,Ie=0;const qe=Math.abs(Y),We=[];let nt;for(;$e+Ie<=qe;){if(Ae+=re,Ae<w||Ae>=E)return null;$e+=Ie,Be=Re,ze=Se;const Vt={absOffsetX:qe,direction:re,distanceFromAnchor:$e,previousVertex:Be};if(Re=Oe(Ae,B,Vt),h===0)We.push(Be),nt=Re.sub(Be);else{let Jt;const Ot=Re.sub(Be);Jt=Ot.mag()===0?At(Oe(Ae+re,B,Vt).sub(Re),h,re):At(Ot,h,re),ze||(ze=Be.add(Jt)),Se=st(Ae,Jt,Re,w,E,ze,h,B,Vt),We.push(ze),nt=Se.sub(ze)}Ie=nt.mag()}const bt=nt._mult((qe-$e)/Ie)._add(ze||Be),Pt=ie+Math.atan2(Re.y-Be.y,Re.x-Be.x);return We.push(bt),{point:bt,angle:j?Pt:0,path:We}}const hn=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function mn(x,s){for(let h=0;h<x;h++){const g=s.length;s.resize(g+4),s.float32.set(hn,3*g)}}function Qn(x,s,h){const g=s[0],y=s[1];return x[0]=h[0]*g+h[4]*y+h[12],x[1]=h[1]*g+h[5]*y+h[13],x[3]=h[3]*g+h[7]*y+h[15],x}const Ln=100;class er{constructor(s,h,g=new ir(s.width+200,s.height+200,25),y=new ir(s.width+200,s.height+200,25)){this.transform=s,this.mapProjection=h,this.grid=g,this.ignoredGrid=y,this.pitchFactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Ln,this.screenBottomBoundary=s.height+Ln,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,h,g,y,w,E,B,j,Y,re,ie){const _e=s.anchorPointX+j[0],Ae=s.anchorPointY+j[1],Se=this.projectAndGetPerspectiveRatio(y,_e,Ae,w,re),ze=g*Se.perspectiveRatio;let Re;if(E||B)Re=this._projectCollisionBox(s,ze,y,w,E,B,j,Se,re,ie);else{const We=Se.point.x+(ie?ie.x*ze:0),nt=Se.point.y+(ie?ie.y*ze:0);Re={allPointsOccluded:!1,box:[We+s.x1*ze,nt+s.y1*ze,We+s.x2*ze,nt+s.y2*ze]}}const[Be,$e,Ie,qe]=Re.box;return this.mapProjection.useSpecialProjectionForSymbols&&(E?Re.allPointsOccluded:this.mapProjection.isOccluded(_e,Ae,w))||Se.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Be,$e,Ie,qe)||h!=="always"&&this.grid.hitTest(Be,$e,Ie,qe,h,Y)?{box:[Be,$e,Ie,qe],placeable:!1,offscreen:!1}:{box:[Be,$e,Ie,qe],placeable:!0,offscreen:this.isOffscreen(Be,$e,Ie,qe)}}placeCollisionCircles(s,h,g,y,w,E,B,j,Y,re,ie,_e,Ae,Se,ze,Re){const Be=[],$e=new a.P(h.anchorX,h.anchorY),Ie=this.getPerspectiveRatio(E,$e.x,$e.y,B,Re),qe=(ie?w/Ie:w*Ie)/a.ap,We={getElevation:Re,labelPlaneMatrix:j,lineVertexArray:g,pitchWithMap:ie,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:$e,unwrappedTileID:B,width:this.transform.width,height:this.transform.height,translation:ze},nt=Me(qe,y,h.lineOffsetX*qe,h.lineOffsetY*qe,!1,h,!1,We);let bt=!1,Pt=!1,Vt=!0;if(nt){const Jt=.5*Ae*Ie+Se,Ot=new a.P(-100,-100),Bt=new a.P(this.screenRightBoundary,this.screenBottomBoundary),ln=new zt,In=nt.first,jt=nt.last;let Wt=[];for(let $n=In.path.length-1;$n>=1;$n--)Wt.push(In.path[$n]);for(let $n=1;$n<jt.path.length;$n++)Wt.push(jt.path[$n]);const Mn=2.5*Jt;if(Y){const $n=this.projectPathToScreenSpace(Wt,We,Y);Wt=$n.some(Hn=>Hn.signedDistanceFromCamera<=0)?[]:$n.map(Hn=>Hn.point)}let Dr=[];if(Wt.length>0){const $n=Wt[0].clone(),Hn=Wt[0].clone();for(let Rr=1;Rr<Wt.length;Rr++)$n.x=Math.min($n.x,Wt[Rr].x),$n.y=Math.min($n.y,Wt[Rr].y),Hn.x=Math.max(Hn.x,Wt[Rr].x),Hn.y=Math.max(Hn.y,Wt[Rr].y);Dr=$n.x>=Ot.x&&Hn.x<=Bt.x&&$n.y>=Ot.y&&Hn.y<=Bt.y?[Wt]:Hn.x<Ot.x||$n.x>Bt.x||Hn.y<Ot.y||$n.y>Bt.y?[]:a.al([Wt],Ot.x,Ot.y,Bt.x,Bt.y)}for(const $n of Dr){ln.reset($n,.25*Jt);let Hn=0;Hn=ln.length<=.5*Jt?1:Math.ceil(ln.paddedLength/Mn)+1;for(let Rr=0;Rr<Hn;Rr++){const wi=Rr/Math.max(Hn-1,1),wo=ln.lerp(wi),Br=wo.x+Ln,$i=wo.y+Ln;Be.push(Br,$i,Jt,0);const Li=Br-Jt,xi=$i-Jt,Pi=Br+Jt,$o=$i+Jt;if(Vt=Vt&&this.isOffscreen(Li,xi,Pi,$o),Pt=Pt||this.isInsideGrid(Li,xi,Pi,$o),s!=="always"&&this.grid.hitTestCircle(Br,$i,Jt,s,_e)&&(bt=!0,!re))return{circles:[],offscreen:!1,collisionDetected:bt}}}}return{circles:!re&&bt||!Pt||Ie<this.perspectiveRatioCutoff?[]:Be,offscreen:Vt,collisionDetected:bt}}projectPathToScreenSpace(s,h,g){return s.map(y=>Ce(y.x,y.y,g,h.getElevation))}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let g=1/0,y=1/0,w=-1/0,E=-1/0;for(const re of s){const ie=new a.P(re.x+Ln,re.y+Ln);g=Math.min(g,ie.x),y=Math.min(y,ie.y),w=Math.max(w,ie.x),E=Math.max(E,ie.y),h.push(ie)}const B=this.grid.query(g,y,w,E).concat(this.ignoredGrid.query(g,y,w,E)),j={},Y={};for(const re of B){const ie=re.key;if(j[ie.bucketInstanceId]===void 0&&(j[ie.bucketInstanceId]={}),j[ie.bucketInstanceId][ie.featureIndex])continue;const _e=[new a.P(re.x1,re.y1),new a.P(re.x2,re.y1),new a.P(re.x2,re.y2),new a.P(re.x1,re.y2)];a.am(h,_e)&&(j[ie.bucketInstanceId][ie.featureIndex]=!0,Y[ie.bucketInstanceId]===void 0&&(Y[ie.bucketInstanceId]=[]),Y[ie.bucketInstanceId].push(ie.featureIndex))}return Y}insertCollisionBox(s,h,g,y,w,E){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:E,overlapMode:h},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,h,g,y,w,E){const B=g?this.ignoredGrid:this.grid,j={bucketInstanceId:y,featureIndex:w,collisionGroupID:E,overlapMode:h};for(let Y=0;Y<s.length;Y+=4)B.insertCircle(j,s[Y],s[Y+1],s[Y+2])}projectAndGetPerspectiveRatio(s,h,g,y,w){let E;w?(E=[h,g,w(h,g),1],a.af(E,E,s)):(E=[h,g,0,1],Qn(E,E,s));const B=E[3];return{point:new a.P((E[0]/B+1)/2*this.transform.width+Ln,(-E[1]/B+1)/2*this.transform.height+Ln),perspectiveRatio:.5+this.transform.cameraToCenterDistance/B*.5,isOccluded:!1,signedDistanceFromCamera:B}}getPerspectiveRatio(s,h,g,y,w){const E=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(h,g,y,w):Ce(h,g,s,w);return .5+this.transform.cameraToCenterDistance/E.signedDistanceFromCamera*.5}isOffscreen(s,h,g,y){return g<Ln||s>=this.screenRightBoundary||y<Ln||h>this.screenBottomBoundary}isInsideGrid(s,h,g,y){return g>=0&&s<this.gridRightBoundary&&y>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const s=a.an([]);return a.J(s,s,[-100,-100,0]),s}_projectCollisionBox(s,h,g,y,w,E,B,j,Y,re){let ie=new a.P(1,0),_e=new a.P(0,1);const Ae=new a.P(s.anchorPointX+B[0],s.anchorPointY+B[1]);if(E&&!w){const Vt=this.projectAndGetPerspectiveRatio(g,Ae.x+1,Ae.y,y,Y).point.sub(j.point).unit(),Jt=Math.atan(Vt.y/Vt.x)+(Vt.x<0?Math.PI:0),Ot=Math.sin(Jt),Bt=Math.cos(Jt);ie=new a.P(Bt,Ot),_e=new a.P(-Ot,Bt)}else if(!E&&w){const Vt=-this.transform.angle,Jt=Math.sin(Vt),Ot=Math.cos(Vt);ie=new a.P(Ot,Jt),_e=new a.P(-Jt,Ot)}let Se=j.point,ze=h;if(w){Se=Ae;const Vt=this.transform.zoom-Math.floor(this.transform.zoom);ze=Math.pow(2,-Vt),ze*=this.mapProjection.getPitchedTextCorrection(this.transform,Ae,y),re||(ze*=a.ac(.5+j.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}re&&(Se=Se.add(ie.mult(re.x*ze)).add(_e.mult(re.y*ze)));const Re=s.x1*ze,Be=s.x2*ze,$e=(Re+Be)/2,Ie=s.y1*ze,qe=s.y2*ze,We=(Ie+qe)/2,nt=[{offsetX:Re,offsetY:Ie},{offsetX:$e,offsetY:Ie},{offsetX:Be,offsetY:Ie},{offsetX:Be,offsetY:We},{offsetX:Be,offsetY:qe},{offsetX:$e,offsetY:qe},{offsetX:Re,offsetY:qe},{offsetX:Re,offsetY:We}];let bt=[];for(const{offsetX:Vt,offsetY:Jt}of nt)bt.push(new a.P(Se.x+ie.x*Vt+_e.x*Jt,Se.y+ie.y*Vt+_e.y*Jt));let Pt=!1;if(w){const Vt=bt.map(Jt=>this.projectAndGetPerspectiveRatio(g,Jt.x,Jt.y,y,Y));Pt=Vt.some(Jt=>!Jt.isOccluded),bt=Vt.map(Jt=>Jt.point)}else Pt=!0;return{box:a.ao(bt),allPointsOccluded:!Pt}}}function Un(x,s,h){return s*(a.X/(x.tileSize*Math.pow(2,h-x.tileID.overscaledZ)))}class Zr{constructor(s,h,g,y){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?h:-h))):y&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class $r{constructor(s,h,g,y,w){this.text=new Zr(s?s.text:null,h,g,w),this.icon=new Zr(s?s.icon:null,h,y,w)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class He{constructor(s,h,g){this.text=s,this.icon=h,this.skipFade=g}}class Sn{constructor(){this.invProjMatrix=a.H(),this.viewportMatrix=a.H(),this.circles=[]}}class Fn{constructor(s,h,g,y,w){this.bucketInstanceId=s,this.featureIndex=h,this.sourceLayerIndex=g,this.bucketIndex=y,this.tileID=w}}class dr{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const h=++this.maxGroupID;this.collisionGroups[s]={ID:h,predicate:g=>g.collisionGroupID===h}}return this.collisionGroups[s]}}function _r(x,s,h,g,y){const{horizontalAlign:w,verticalAlign:E}=a.au(x);return new a.P(-(w-.5)*s+g[0]*y,-(E-.5)*h+g[1]*y)}class Pr{constructor(s,h,g,y,w,E){this.transform=s.clone(),this.terrain=g,this.collisionIndex=new er(this.transform,h),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=y,this.retainedQueryData={},this.collisionGroups=new dr(w),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(s){const h=this.terrain;return h?(g,y)=>h.getElevation(s,g,y):null}getBucketParts(s,h,g,y){const w=g.getBucket(h),E=g.latestFeatureIndex;if(!w||!E||h.id!==w.layerIds[0])return;const B=g.collisionBoxArray,j=w.layers[0].layout,Y=w.layers[0].paint,re=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),ie=g.tileSize/a.X,_e=g.tileID.toUnwrapped(),Ae=this.transform.calculatePosMatrix(_e),Se=j.get("text-pitch-alignment")==="map",ze=j.get("text-rotation-alignment")==="map",Re=Un(g,1,this.transform.zoom),Be=this.collisionIndex.mapProjection.translatePosition(this.transform,g,Y.get("text-translate"),Y.get("text-translate-anchor")),$e=this.collisionIndex.mapProjection.translatePosition(this.transform,g,Y.get("icon-translate"),Y.get("icon-translate-anchor")),Ie=Gr(Ae,Se,ze,this.transform,Re);let qe=null;if(Se){const nt=br(Ae,Se,ze,this.transform,Re);qe=a.L([],this.transform.labelPlaneMatrix,nt)}this.retainedQueryData[w.bucketInstanceId]=new Fn(w.bucketInstanceId,E,w.sourceLayerIndex,w.index,g.tileID);const We={bucket:w,layout:j,translationText:Be,translationIcon:$e,posMatrix:Ae,unwrappedTileID:_e,textLabelPlaneMatrix:Ie,labelToScreenMatrix:qe,scale:re,textPixelRatio:ie,holdingForFade:g.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:a.ag(w.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(w.sourceID)};if(y)for(const nt of w.sortKeyRanges){const{sortKey:bt,symbolInstanceStart:Pt,symbolInstanceEnd:Vt}=nt;s.push({sortKey:bt,symbolInstanceStart:Pt,symbolInstanceEnd:Vt,parameters:We})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:w.symbolInstances.length,parameters:We})}attemptAnchorPlacement(s,h,g,y,w,E,B,j,Y,re,ie,_e,Ae,Se,ze,Re,Be,$e,Ie){const qe=a.aq[s.textAnchor],We=[s.textOffset0,s.textOffset1],nt=_r(qe,g,y,We,w),bt=this.collisionIndex.placeCollisionBox(h,_e,j,Y,re,B,E,Re,ie.predicate,Ie,nt);if((!$e||this.collisionIndex.placeCollisionBox($e,_e,j,Y,re,B,E,Be,ie.predicate,Ie,nt).placeable)&&bt.placeable){let Pt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ae.crossTileID]&&this.prevPlacement.placements[Ae.crossTileID]&&this.prevPlacement.placements[Ae.crossTileID].text&&(Pt=this.prevPlacement.variableOffsets[Ae.crossTileID].anchor),Ae.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Ae.crossTileID]={textOffset:We,width:g,height:y,anchor:qe,textBoxScale:w,prevAnchor:Pt},this.markUsedJustification(Se,qe,Ae,ze),Se.allowVerticalPlacement&&(this.markUsedOrientation(Se,ze,Ae),this.placedOrientations[Ae.crossTileID]=ze),{shift:nt,placedGlyphBoxes:bt}}}placeLayerBucketPart(s,h,g){const{bucket:y,layout:w,translationText:E,translationIcon:B,posMatrix:j,unwrappedTileID:Y,textLabelPlaneMatrix:re,labelToScreenMatrix:ie,textPixelRatio:_e,holdingForFade:Ae,collisionBoxArray:Se,partiallyEvaluatedTextSize:ze,collisionGroup:Re}=s.parameters,Be=w.get("text-optional"),$e=w.get("icon-optional"),Ie=a.ar(w,"text-overlap","text-allow-overlap"),qe=Ie==="always",We=a.ar(w,"icon-overlap","icon-allow-overlap"),nt=We==="always",bt=w.get("text-rotation-alignment")==="map",Pt=w.get("text-pitch-alignment")==="map",Vt=w.get("icon-text-fit")!=="none",Jt=w.get("symbol-z-order")==="viewport-y",Ot=qe&&(nt||!y.hasIconData()||$e),Bt=nt&&(qe||!y.hasTextData()||Be);!y.collisionArrays&&Se&&y.deserializeCollisionBoxes(Se);const ln=this._getTerrainElevationFunc(this.retainedQueryData[y.bucketInstanceId].tileID),In=(jt,Wt,Mn)=>{var Dr,$n;if(h[jt.crossTileID])return;if(Ae)return void(this.placements[jt.crossTileID]=new He(!1,!1,!1));let Hn=!1,Rr=!1,wi=!0,wo=null,Br={box:null,placeable:!1,offscreen:null},$i={placeable:!1},Li=null,xi=null,Pi=null,$o=0,xa=0,lu=0;Wt.textFeatureIndex?$o=Wt.textFeatureIndex:jt.useRuntimeCollisionCircles&&($o=jt.featureIndex),Wt.verticalTextFeatureIndex&&(xa=Wt.verticalTextFeatureIndex);const Aa=Wt.textBox;if(Aa){const io=mi=>{let Ai=a.ah.horizontal;if(y.allowVerticalPlacement&&!mi&&this.prevPlacement){const Ji=this.prevPlacement.placedOrientations[jt.crossTileID];Ji&&(this.placedOrientations[jt.crossTileID]=Ji,Ai=Ji,this.markUsedOrientation(y,Ai,jt))}return Ai},oo=(mi,Ai)=>{if(y.allowVerticalPlacement&&jt.numVerticalGlyphVertices>0&&Wt.verticalTextBox){for(const Ji of y.writingModes)if(Ji===a.ah.vertical?(Br=Ai(),$i=Br):Br=mi(),Br&&Br.placeable)break}else Br=mi()},_s=jt.textAnchorOffsetStartIndex,xo=jt.textAnchorOffsetEndIndex;if(xo===_s){const mi=(Ai,Ji)=>{const Jn=this.collisionIndex.placeCollisionBox(Ai,Ie,_e,j,Y,Pt,bt,E,Re.predicate,ln);return Jn&&Jn.placeable&&(this.markUsedOrientation(y,Ji,jt),this.placedOrientations[jt.crossTileID]=Ji),Jn};oo(()=>mi(Aa,a.ah.horizontal),()=>{const Ai=Wt.verticalTextBox;return y.allowVerticalPlacement&&jt.numVerticalGlyphVertices>0&&Ai?mi(Ai,a.ah.vertical):{box:null,offscreen:null}}),io(Br&&Br.placeable)}else{let mi=a.aq[($n=(Dr=this.prevPlacement)===null||Dr===void 0?void 0:Dr.variableOffsets[jt.crossTileID])===null||$n===void 0?void 0:$n.anchor];const Ai=(Jn,Us,ka)=>{const Sa=Jn.x2-Jn.x1,Vh=Jn.y2-Jn.y1,Rp=jt.textBoxScale,qh=Vt&&We==="never"?Us:null;let ys=null,Gh=Ie==="never"?1:2,cu="never";mi&&Gh++;for(let cl=0;cl<Gh;cl++){for(let fu=_s;fu<xo;fu++){const hu=y.textAnchorOffsets.get(fu);if(mi&&hu.textAnchor!==mi)continue;const Ta=this.attemptAnchorPlacement(hu,Jn,Sa,Vh,Rp,bt,Pt,_e,j,Y,Re,cu,jt,y,ka,E,B,qh,ln);if(Ta&&(ys=Ta.placedGlyphBoxes,ys&&ys.placeable))return Hn=!0,wo=Ta.shift,ys}mi?mi=null:cu=Ie}return g&&!ys&&(ys={box:this.collisionIndex.placeCollisionBox(Aa,"always",_e,j,Y,Pt,bt,E,Re.predicate,ln,new a.P(0,0)).box,offscreen:!1,placeable:!1}),ys};oo(()=>Ai(Aa,Wt.iconBox,a.ah.horizontal),()=>{const Jn=Wt.verticalTextBox;return y.allowVerticalPlacement&&(!Br||!Br.placeable)&&jt.numVerticalGlyphVertices>0&&Jn?Ai(Jn,Wt.verticalIconBox,a.ah.vertical):{box:null,occluded:!0,offscreen:null}}),Br&&(Hn=Br.placeable,wi=Br.offscreen);const Ji=io(Br&&Br.placeable);if(!Hn&&this.prevPlacement){const Jn=this.prevPlacement.variableOffsets[jt.crossTileID];Jn&&(this.variableOffsets[jt.crossTileID]=Jn,this.markUsedJustification(y,Jn.anchor,jt,Ji))}}}if(Li=Br,Hn=Li&&Li.placeable,wi=Li&&Li.offscreen,jt.useRuntimeCollisionCircles){const io=y.text.placedSymbolArray.get(jt.centerJustifiedTextSymbolIndex),oo=a.ai(y.textSizeData,ze,io),_s=w.get("text-padding");xi=this.collisionIndex.placeCollisionCircles(Ie,io,y.lineVertexArray,y.glyphOffsetArray,oo,j,Y,re,ie,g,Pt,Re.predicate,jt.collisionCircleDiameter,_s,E,ln),xi.circles.length&&xi.collisionDetected&&!g&&a.w("Collisions detected, but collision boxes are not shown"),Hn=qe||xi.circles.length>0&&!xi.collisionDetected,wi=wi&&xi.offscreen}if(Wt.iconFeatureIndex&&(lu=Wt.iconFeatureIndex),Wt.iconBox){const io=oo=>this.collisionIndex.placeCollisionBox(oo,We,_e,j,Y,Pt,bt,B,Re.predicate,ln,Vt&&wo?wo:void 0);$i&&$i.placeable&&Wt.verticalIconBox?(Pi=io(Wt.verticalIconBox),Rr=Pi.placeable):(Pi=io(Wt.iconBox),Rr=Pi.placeable),wi=wi&&Pi.offscreen}const ro=Be||jt.numHorizontalGlyphVertices===0&&jt.numVerticalGlyphVertices===0,uu=$e||jt.numIconVertices===0;ro||uu?uu?ro||(Rr=Rr&&Hn):Hn=Rr&&Hn:Rr=Hn=Rr&&Hn;const qc=Rr&&Pi.placeable;if(Hn&&Li.placeable&&this.collisionIndex.insertCollisionBox(Li.box,Ie,w.get("text-ignore-placement"),y.bucketInstanceId,$i&&$i.placeable&&xa?xa:$o,Re.ID),qc&&this.collisionIndex.insertCollisionBox(Pi.box,We,w.get("icon-ignore-placement"),y.bucketInstanceId,lu,Re.ID),xi&&Hn&&this.collisionIndex.insertCollisionCircles(xi.circles,Ie,w.get("text-ignore-placement"),y.bucketInstanceId,$o,Re.ID),g&&this.storeCollisionData(y.bucketInstanceId,Mn,Wt,Li,Pi,xi),jt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(y.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[jt.crossTileID]=new He(Hn||Ot,Rr||Bt,wi||y.justReloaded),h[jt.crossTileID]=!0};if(Jt){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const jt=y.getSortedSymbolIndexes(this.transform.angle);for(let Wt=jt.length-1;Wt>=0;--Wt){const Mn=jt[Wt];In(y.symbolInstances.get(Mn),y.collisionArrays[Mn],Mn)}}else for(let jt=s.symbolInstanceStart;jt<s.symbolInstanceEnd;jt++)In(y.symbolInstances.get(jt),y.collisionArrays[jt],jt);if(g&&y.bucketInstanceId in this.collisionCircleArrays){const jt=this.collisionCircleArrays[y.bucketInstanceId];a.as(jt.invProjMatrix,j),jt.viewportMatrix=this.collisionIndex.getViewportMatrix()}y.justReloaded=!1}storeCollisionData(s,h,g,y,w,E){if(g.textBox||g.iconBox){let B,j;this.collisionBoxArrays.has(s)?B=this.collisionBoxArrays.get(s):(B=new Map,this.collisionBoxArrays.set(s,B)),B.has(h)?j=B.get(h):(j={text:null,icon:null},B.set(h,j)),g.textBox&&(j.text=y.box),g.iconBox&&(j.icon=w.box)}if(E){let B=this.collisionCircleArrays[s];B===void 0&&(B=this.collisionCircleArrays[s]=new Sn);for(let j=0;j<E.circles.length;j+=4)B.circles.push(E.circles[j+0]),B.circles.push(E.circles[j+1]),B.circles.push(E.circles[j+2]),B.circles.push(E.collisionDetected?1:0)}}markUsedJustification(s,h,g,y){let w;w=y===a.ah.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[a.at(h)];const E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const B of E)B>=0&&(s.text.placedSymbolArray.get(B).crossTileID=w>=0&&B!==w?0:g.crossTileID)}markUsedOrientation(s,h,g){const y=h===a.ah.horizontal||h===a.ah.horizontalOnly?h:0,w=h===a.ah.vertical?h:0,E=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const B of E)s.text.placedSymbolArray.get(B).placedOrientation=y;g.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=w)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let g=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const y=h?h.symbolFadeChange(s):1,w=h?h.opacities:{},E=h?h.variableOffsets:{},B=h?h.placedOrientations:{};for(const j in this.placements){const Y=this.placements[j],re=w[j];re?(this.opacities[j]=new $r(re,y,Y.text,Y.icon),g=g||Y.text!==re.text.placed||Y.icon!==re.icon.placed):(this.opacities[j]=new $r(null,y,Y.text,Y.icon,Y.skipFade),g=g||Y.text||Y.icon)}for(const j in w){const Y=w[j];if(!this.opacities[j]){const re=new $r(Y,y,!1,!1);re.isHidden()||(this.opacities[j]=re,g=g||Y.text.placed||Y.icon.placed)}}for(const j in E)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=E[j]);for(const j in B)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=B[j]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");g?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:s)}updateLayerOpacities(s,h){const g={};for(const y of h){const w=y.getBucket(s);w&&y.latestFeatureIndex&&s.id===w.layerIds[0]&&this.updateBucketOpacities(w,y.tileID,g,y.collisionBoxArray)}}updateBucketOpacities(s,h,g,y){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const w=s.layers[0],E=w.layout,B=new $r(null,0,!1,!1,!0),j=E.get("text-allow-overlap"),Y=E.get("icon-allow-overlap"),re=w._unevaluatedLayout.hasValue("text-variable-anchor")||w._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ie=E.get("text-rotation-alignment")==="map",_e=E.get("text-pitch-alignment")==="map",Ae=E.get("icon-text-fit")!=="none",Se=new $r(null,0,j&&(Y||!s.hasIconData()||E.get("icon-optional")),Y&&(j||!s.hasTextData()||E.get("text-optional")),!0);!s.collisionArrays&&y&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(y);const ze=(Be,$e,Ie)=>{for(let qe=0;qe<$e/4;qe++)Be.opacityVertexArray.emplaceBack(Ie);Be.hasVisibleVertices=Be.hasVisibleVertices||Ie!==mo},Re=this.collisionBoxArrays.get(s.bucketInstanceId);for(let Be=0;Be<s.symbolInstances.length;Be++){const $e=s.symbolInstances.get(Be),{numHorizontalGlyphVertices:Ie,numVerticalGlyphVertices:qe,crossTileID:We}=$e;let nt=this.opacities[We];g[We]?nt=B:nt||(nt=Se,this.opacities[We]=nt),g[We]=!0;const bt=$e.numIconVertices>0,Pt=this.placedOrientations[$e.crossTileID],Vt=Pt===a.ah.vertical,Jt=Pt===a.ah.horizontal||Pt===a.ah.horizontalOnly;if(Ie>0||qe>0){const Bt=Ii(nt.text);ze(s.text,Ie,Vt?mo:Bt),ze(s.text,qe,Jt?mo:Bt);const ln=nt.text.isHidden();[$e.rightJustifiedTextSymbolIndex,$e.centerJustifiedTextSymbolIndex,$e.leftJustifiedTextSymbolIndex].forEach(Wt=>{Wt>=0&&(s.text.placedSymbolArray.get(Wt).hidden=ln||Vt?1:0)}),$e.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get($e.verticalPlacedTextSymbolIndex).hidden=ln||Jt?1:0);const In=this.variableOffsets[$e.crossTileID];In&&this.markUsedJustification(s,In.anchor,$e,Pt);const jt=this.placedOrientations[$e.crossTileID];jt&&(this.markUsedJustification(s,"left",$e,jt),this.markUsedOrientation(s,jt,$e))}if(bt){const Bt=Ii(nt.icon),ln=!(Ae&&$e.verticalPlacedIconSymbolIndex&&Vt);$e.placedIconSymbolIndex>=0&&(ze(s.icon,$e.numIconVertices,ln?Bt:mo),s.icon.placedSymbolArray.get($e.placedIconSymbolIndex).hidden=nt.icon.isHidden()),$e.verticalPlacedIconSymbolIndex>=0&&(ze(s.icon,$e.numVerticalIconVertices,ln?mo:Bt),s.icon.placedSymbolArray.get($e.verticalPlacedIconSymbolIndex).hidden=nt.icon.isHidden())}const Ot=Re&&Re.has(Be)?Re.get(Be):{text:null,icon:null};if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const Bt=s.collisionArrays[Be];if(Bt){let ln=new a.P(0,0);if(Bt.textBox||Bt.verticalTextBox){let In=!0;if(re){const jt=this.variableOffsets[We];jt?(ln=_r(jt.anchor,jt.width,jt.height,jt.textOffset,jt.textBoxScale),ie&&ln._rotate(_e?this.transform.angle:-this.transform.angle)):In=!1}if(Bt.textBox||Bt.verticalTextBox){let jt;Bt.textBox&&(jt=Vt),Bt.verticalTextBox&&(jt=Jt),Ei(s.textCollisionBox.collisionVertexArray,nt.text.placed,!In||jt,Ot.text,ln.x,ln.y)}}if(Bt.iconBox||Bt.verticalIconBox){const In=!!(!Jt&&Bt.verticalIconBox);let jt;Bt.iconBox&&(jt=In),Bt.verticalIconBox&&(jt=!In),Ei(s.iconCollisionBox.collisionVertexArray,nt.icon.placed,jt,Ot.icon,Ae?ln.x:0,Ae?ln.y:0)}}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const Be=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Be.invProjMatrix,s.placementViewportMatrix=Be.viewportMatrix,s.collisionCircleArray=Be.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,h){const g=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*g>s}setStale(){this.stale=!0}}function Ei(x,s,h,g,y,w){g&&g.length!==0||(g=[0,0,0,0]);const E=g[0]-Ln,B=g[1]-Ln,j=g[2]-Ln,Y=g[3]-Ln;x.emplaceBack(s?1:0,h?1:0,y||0,w||0,E,B),x.emplaceBack(s?1:0,h?1:0,y||0,w||0,j,B),x.emplaceBack(s?1:0,h?1:0,y||0,w||0,j,Y),x.emplaceBack(s?1:0,h?1:0,y||0,w||0,E,Y)}const gn=Math.pow(2,25),Qo=Math.pow(2,24),bi=Math.pow(2,17),pi=Math.pow(2,16),Ur=Math.pow(2,9),Il=Math.pow(2,8),ci=Math.pow(2,1);function Ii(x){if(x.opacity===0&&!x.placed)return 0;if(x.opacity===1&&x.placed)return 4294967295;const s=x.placed?1:0,h=Math.floor(127*x.opacity);return h*gn+s*Qo+h*bi+s*pi+h*Ur+s*Il+h*ci+s}const mo=0;function Hi(){return{isOccluded:(x,s,h)=>!1,getPitchedTextCorrection:(x,s,h)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(x,s,h,g){throw new Error("Not implemented.")},translatePosition:(x,s,h,g)=>function(y,w,E,B,j=!1){if(!E[0]&&!E[1])return[0,0];const Y=j?B==="map"?y.angle:0:B==="viewport"?-y.angle:0;if(Y){const re=Math.sin(Y),ie=Math.cos(Y);E=[E[0]*ie-E[1]*re,E[0]*re+E[1]*ie]}return[j?E[0]:Un(w,E[0],y.zoom),j?E[1]:Un(w,E[1],y.zoom)]}(x,s,h,g),getCircleRadiusCorrection:x=>1}}class tr{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,h,g,y,w){const E=this._bucketParts;for(;this._currentTileIndex<s.length;)if(h.getBucketParts(E,y,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((B,j)=>B.sortKey-j.sortKey));this._currentPartIndex<E.length;)if(h.placeLayerBucketPart(E[this._currentPartIndex],this._seenCrossTileIDs,g),this._currentPartIndex++,w())return!0;return!1}}class Ga{constructor(s,h,g,y,w,E,B,j){this.placement=new Pr(s,Hi(),h,E,B,j),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(s,h,g){const y=v.now(),w=()=>!this._forceFullPlacement&&v.now()-y>2;for(;this._currentPlacementIndex>=0;){const E=h[s[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=B)&&(!E.maxzoom||E.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new tr(E)),this._inProgressLayer.continuePlacement(g[E.source],this.placement,this._showCollisionBoxes,E,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const go=512/a.X/2;class Kr{constructor(s,h,g){this.tileID=s,this.bucketInstanceId=g,this._symbolsByKey={};const y=new Map;for(let w=0;w<h.length;w++){const E=h.get(w),B=E.key,j=y.get(B);j?j.push(E):y.set(B,[E])}for(const[w,E]of y){const B={positions:E.map(j=>({x:Math.floor(j.anchorX*go),y:Math.floor(j.anchorY*go)})),crossTileIDs:E.map(j=>j.crossTileID)};if(B.positions.length>128){const j=new a.av(B.positions.length,16,Uint16Array);for(const{x:Y,y:re}of B.positions)j.add(Y,re);j.finish(),delete B.positions,B.index=j}this._symbolsByKey[w]=B}}getScaledCoordinates(s,h){const{x:g,y,z:w}=this.tileID.canonical,{x:E,y:B,z:j}=h.canonical,Y=go/Math.pow(2,j-w),re=(B*a.X+s.anchorY)*Y,ie=y*a.X*go;return{x:Math.floor((E*a.X+s.anchorX)*Y-g*a.X*go),y:Math.floor(re-ie)}}findMatches(s,h,g){const y=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let w=0;w<s.length;w++){const E=s.get(w);if(E.crossTileID)continue;const B=this._symbolsByKey[E.key];if(!B)continue;const j=this.getScaledCoordinates(E,h);if(B.index){const Y=B.index.range(j.x-y,j.y-y,j.x+y,j.y+y).sort();for(const re of Y){const ie=B.crossTileIDs[re];if(!g[ie]){g[ie]=!0,E.crossTileID=ie;break}}}else if(B.positions)for(let Y=0;Y<B.positions.length;Y++){const re=B.positions[Y],ie=B.crossTileIDs[Y];if(Math.abs(re.x-j.x)<=y&&Math.abs(re.y-j.y)<=y&&!g[ie]){g[ie]=!0,E.crossTileID=ie;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Ll{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _o{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const h=Math.round((s-this.lng)/360);if(h!==0)for(const g in this.indexes){const y=this.indexes[g],w={};for(const E in y){const B=y[E];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+h),w[B.tileID.key]=B}this.indexes[g]=w}this.lng=s}addBucket(s,h,g){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let w=0;w<h.symbolInstances.length;w++)h.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const y=this.usedCrossTileIDs[s.overscaledZ];for(const w in this.indexes){const E=this.indexes[w];if(Number(w)>s.overscaledZ)for(const B in E){const j=E[B];j.tileID.isChildOf(s)&&j.findMatches(h.symbolInstances,s,y)}else{const B=E[s.scaledTo(Number(w)).key];B&&B.findMatches(h.symbolInstances,s,y)}}for(let w=0;w<h.symbolInstances.length;w++){const E=h.symbolInstances.get(w);E.crossTileID||(E.crossTileID=g.generate(),y[E.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Kr(s,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(s,h){for(const g of h.getCrossTileIDsLists())for(const y of g)delete this.usedCrossTileIDs[s][y]}removeStaleBuckets(s){let h=!1;for(const g in this.indexes){const y=this.indexes[g];for(const w in y)s[y[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,y[w]),delete y[w],h=!0)}return h}}class rc{constructor(){this.layerIndexes={},this.crossTileIDs=new Ll,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,h,g){let y=this.layerIndexes[s.id];y===void 0&&(y=this.layerIndexes[s.id]=new _o);let w=!1;const E={};y.handleWrapJump(g);for(const B of h){const j=B.getBucket(s);j&&s.id===j.layerIds[0]&&(j.bucketInstanceId||(j.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(B.tileID,j,this.crossTileIDs)&&(w=!0),E[j.bucketInstanceId]=!0)}return y.removeStaleBuckets(E)&&(w=!0),w}pruneUnusedLayers(s){const h={};s.forEach(g=>{h[g]=!0});for(const g in this.layerIndexes)h[g]||delete this.layerIndexes[g]}}const yo=(x,s)=>a.t(x,s&&s.filter(h=>h.identifier!=="source.canvas")),cp=a.aw();class Pl extends a.E{constructor(s,h={}){super(),this._rtlPluginLoaded=()=>{for(const g in this.sourceCaches){const y=this.sourceCaches[g].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[g].reload()}},this.map=s,this.dispatcher=new Qt(It(),s._getMapId()),this.dispatcher.registerMessageHandler("GG",(g,y)=>this.getGlyphs(g,y)),this.dispatcher.registerMessageHandler("GI",(g,y)=>this.getImages(g,y)),this.imageManager=new J,this.imageManager.setEventedParent(this),this.glyphManager=new ve(s._requestManager,h.localIdeographFontFamily),this.lineAtlas=new ct(256,512),this.crossTileSymbolIndex=new rc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new a.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",a.ay()),jr().on(vt,this._rtlPluginLoaded),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const y=this.sourceCaches[g.sourceId];if(!y)return;const w=y.getSource();if(w&&w.vectorLayerIds)for(const E in this._layers){const B=this._layers[E];B.source===w.id&&this._validateLayer(B)}})}loadURL(s,h={},g){this.fire(new a.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const y=this.map._requestManager.transformRequest(s,"Style");this._loadStyleRequest=new AbortController;const w=this._loadStyleRequest;a.h(y,this._loadStyleRequest).then(E=>{this._loadStyleRequest=null,this._load(E.data,h,g)}).catch(E=>{this._loadStyleRequest=null,E&&!w.signal.aborted&&this.fire(new a.j(E))})}loadJSON(s,h={},g){this.fire(new a.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,v.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(s,h,g)}).catch(()=>{})}loadEmpty(){this.fire(new a.k("dataloading",{dataType:"style"})),this._load(cp,{validate:!1})}_load(s,h,g){var y;const w=h.transformStyle?h.transformStyle(g,s):s;if(!h.validate||!yo(this,a.u(w))){this._loaded=!0,this.stylesheet=w;for(const E in w.sources)this.addSource(E,w.sources[E],{validate:!1});w.sprite?this._loadSprite(w.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(w.glyphs),this._createLayers(),this.light=new Ee(this.stylesheet.light),this.sky=new ot(this.stylesheet.sky),this.map.setTerrain((y=this.stylesheet.terrain)!==null&&y!==void 0?y:null),this.fire(new a.k("data",{dataType:"style"})),this.fire(new a.k("style.load"))}}_createLayers(){const s=a.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",s),this._order=s.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of s){const g=a.aA(h);g.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=g}}_loadSprite(s,h=!1,g=void 0){let y;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(w,E,B,j){return a._(this,void 0,void 0,function*(){const Y=Q(w),re=B>1?"@2x":"",ie={},_e={};for(const{id:Ae,url:Se}of Y){const ze=E.transformRequest(ne(Se,re,".json"),"SpriteJSON");ie[Ae]=a.h(ze,j);const Re=E.transformRequest(ne(Se,re,".png"),"SpriteImage");_e[Ae]=U.getImage(Re,j)}return yield Promise.all([...Object.values(ie),...Object.values(_e)]),function(Ae,Se){return a._(this,void 0,void 0,function*(){const ze={};for(const Re in Ae){ze[Re]={};const Be=v.getImageCanvasContext((yield Se[Re]).data),$e=(yield Ae[Re]).data;for(const Ie in $e){const{width:qe,height:We,x:nt,y:bt,sdf:Pt,pixelRatio:Vt,stretchX:Jt,stretchY:Ot,content:Bt,textFitWidth:ln,textFitHeight:In}=$e[Ie];ze[Re][Ie]={data:null,pixelRatio:Vt,sdf:Pt,stretchX:Jt,stretchY:Ot,content:Bt,textFitWidth:ln,textFitHeight:In,spriteData:{width:qe,height:We,x:nt,y:bt,context:Be}}}}return ze})}(ie,_e)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(w=>{if(this._spriteRequest=null,w)for(const E in w){this._spritesImagesIds[E]=[];const B=this._spritesImagesIds[E]?this._spritesImagesIds[E].filter(j=>!(j in w)):[];for(const j of B)this.imageManager.removeImage(j),this._changedImages[j]=!0;for(const j in w[E]){const Y=E==="default"?j:`${E}:${j}`;this._spritesImagesIds[E].push(Y),Y in this.imageManager.images?this.imageManager.updateImage(Y,w[E][j],!1):this.imageManager.addImage(Y,w[E][j]),h&&(this._changedImages[Y]=!0)}}}).catch(w=>{this._spriteRequest=null,y=w,this.fire(new a.j(y))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"})),g&&g(y)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}_validateLayer(s){const h=this.sourceCaches[s.source];if(!h)return;const g=s.sourceLayer;if(!g)return;const y=h.getSource();(y.type==="geojson"||y.vectorLayerIds&&y.vectorLayerIds.indexOf(g)===-1)&&this.fire(new a.j(new Error(`Source layer "${g}" does not exist on source "${y.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s,h=!1){const g=this._serializedAllLayers();if(!s||s.length===0)return Object.values(h?a.aB(g):g);const y=[];for(const w of s)if(g[w]){const E=h?a.aB(g[w]):g[w];y.push(E)}return y}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const h=Object.keys(this._layers);for(const g of h){const y=this._layers[g];y.type!=="custom"&&(s[g]=y.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const h=this._changed;if(h){const y=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);(y.length||w.length)&&this._updateWorkerLayers(y,w);for(const E in this._updatedSources){const B=this._updatedSources[E];if(B==="reload")this._reloadSource(E);else{if(B!=="clear")throw new Error(`Invalid action ${B}`);this._clearSource(E)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const E in this._updatedPaintProps)this._layers[E].updateTransitions(s);this.light.updateTransitions(s),this.sky.updateTransitions(s),this._resetUpdates()}const g={};for(const y in this.sourceCaches){const w=this.sourceCaches[y];g[y]=w.used,w.used=!1}for(const y of this._order){const w=this._layers[y];w.recalculate(s,this._availableImages),!w.isHidden(s.zoom)&&w.source&&(this.sourceCaches[w.source].used=!0)}for(const y in g){const w=this.sourceCaches[y];!!g[y]!=!!w.used&&w.fire(new a.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:y}))}this.light.recalculate(s),this.sky.recalculate(s),this.z=s.zoom,h&&this.fire(new a.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(s,!1),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,h={}){var g;this._checkLoaded();const y=this.serialize();if(s=h.transformStyle?h.transformStyle(y,s):s,((g=h.validate)===null||g===void 0||g)&&yo(this,a.u(s)))return!1;(s=a.aB(s)).layers=a.az(s.layers);const w=a.aC(y,s),E=this._getOperationsToPerform(w);if(E.unimplemented.length>0)throw new Error(`Unimplemented: ${E.unimplemented.join(", ")}.`);if(E.operations.length===0)return!1;for(const B of E.operations)B();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const h=[],g=[];for(const y of s)switch(y.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,y.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,y.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,y.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,y.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,y.args));break;case"addSource":h.push(()=>this.addSource.apply(this,y.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,y.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,y.args));break;case"setLight":h.push(()=>this.setLight.apply(this,y.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,y.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,y.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,y.args));break;case"setSky":h.push(()=>this.setSky.apply(this,y.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,y.args));break;case"setTransition":h.push(()=>{});break;default:g.push(y.command)}return{operations:h,unimplemented:g}}addImage(s,h){if(this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,h),this._afterImageUpdated(s)}updateImage(s,h){this.imageManager.updateImage(s,h)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new a.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,h,g={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(a.u.source,`sources.${s}`,h,null,g))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const y=this.sourceCaches[s]=new pt(s,h,this.dispatcher);y.style=this,y.setEventedParent(this,()=>({isSourceLoaded:y.loaded(),source:y.serialize(),sourceId:s})),y.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===s)return this.fire(new a.j(new Error(`Source "${s}" cannot be removed while layer "${g}" is using it.`)));const h=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],h.fire(new a.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,h){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const g=this.sourceCaches[s].getSource();if(g.type!=="geojson")throw new Error(`geojsonSource.type is ${g.type}, which is !== 'geojson`);g.setData(h),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,h,g={}){this._checkLoaded();const y=s.id;if(this.getLayer(y))return void this.fire(new a.j(new Error(`Layer "${y}" already exists on this map.`)));let w;if(s.type==="custom"){if(yo(this,a.aD(s)))return;w=a.aA(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(y,s.source),s=a.aB(s),s=a.e(s,{source:y})),this._validate(a.u.layer,`layers.${y}`,s,{arrayIndex:-1},g))return;w=a.aA(s),this._validateLayer(w),w.setEventedParent(this,{layer:{id:y}})}const E=h?this._order.indexOf(h):this._order.length;if(h&&E===-1)this.fire(new a.j(new Error(`Cannot add layer "${y}" before non-existing layer "${h}".`)));else{if(this._order.splice(E,0,y),this._layerOrderChanged=!0,this._layers[y]=w,this._removedLayers[y]&&w.source&&w.type!=="custom"){const B=this._removedLayers[y];delete this._removedLayers[y],B.type!==w.type?this._updatedSources[w.source]="clear":(this._updatedSources[w.source]="reload",this.sourceCaches[w.source].pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map)}}moveLayer(s,h){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new a.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===h)return;const g=this._order.indexOf(s);this._order.splice(g,1);const y=h?this._order.indexOf(h):this._order.length;h&&y===-1?this.fire(new a.j(new Error(`Cannot move layer "${s}" before non-existing layer "${h}".`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const h=this._layers[s];if(!h)return void this.fire(new a.j(new Error(`Cannot remove non-existing layer "${s}".`)));h.setEventedParent(null);const g=this._order.indexOf(s);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=h,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],h.onRemove&&h.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,h,g){this._checkLoaded();const y=this.getLayer(s);y?y.minzoom===h&&y.maxzoom===g||(h!=null&&(y.minzoom=h),g!=null&&(y.maxzoom=g),this._updateLayer(y)):this.fire(new a.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,h,g={}){this._checkLoaded();const y=this.getLayer(s);if(y){if(!a.aE(y.filter,h))return h==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(a.u.filter,`layers.${y.id}.filter`,h,null,g)||(y.filter=a.aB(h),this._updateLayer(y)))}else this.fire(new a.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return a.aB(this.getLayer(s).filter)}setLayoutProperty(s,h,g,y={}){this._checkLoaded();const w=this.getLayer(s);w?a.aE(w.getLayoutProperty(h),g)||(w.setLayoutProperty(h,g,y),this._updateLayer(w)):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,h){const g=this.getLayer(s);if(g)return g.getLayoutProperty(h);this.fire(new a.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,h,g,y={}){this._checkLoaded();const w=this.getLayer(s);w?a.aE(w.getPaintProperty(h),g)||(w.setPaintProperty(h,g,y)&&this._updateLayer(w),this._changed=!0,this._updatedPaintProps[s]=!0,this._serializedLayers=null):this.fire(new a.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,h){return this.getLayer(s).getPaintProperty(h)}setFeatureState(s,h){this._checkLoaded();const g=s.source,y=s.sourceLayer,w=this.sourceCaches[g];if(w===void 0)return void this.fire(new a.j(new Error(`The source '${g}' does not exist in the map's style.`)));const E=w.getSource().type;E==="geojson"&&y?this.fire(new a.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):E!=="vector"||y?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),w.setFeatureState(y,s.id,h)):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,h){this._checkLoaded();const g=s.source,y=this.sourceCaches[g];if(y===void 0)return void this.fire(new a.j(new Error(`The source '${g}' does not exist in the map's style.`)));const w=y.getSource().type,E=w==="vector"?s.sourceLayer:void 0;w!=="vector"||E?h&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new a.j(new Error("A feature id is required to remove its specific state property."))):y.removeFeatureState(E,s.id,h):this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const h=s.source,g=s.sourceLayer,y=this.sourceCaches[h];if(y!==void 0)return y.getSource().type!=="vector"||g?(s.id===void 0&&this.fire(new a.j(new Error("The feature id parameter must be provided."))),y.getFeatureState(g,s.id)):void this.fire(new a.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new a.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return a.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=a.aF(this.sourceCaches,w=>w.serialize()),h=this._serializeByIds(this._order,!0),g=this.map.getTerrain()||void 0,y=this.stylesheet;return a.aG({version:y.version,name:y.name,metadata:y.metadata,light:y.light,sky:y.sky,center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch,sprite:y.sprite,glyphs:y.glyphs,transition:y.transition,sources:s,layers:h,terrain:g},w=>w!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const h=E=>this._layers[E].type==="fill-extrusion",g={},y=[];for(let E=this._order.length-1;E>=0;E--){const B=this._order[E];if(h(B)){g[B]=E;for(const j of s){const Y=j[B];if(Y)for(const re of Y)y.push(re)}}}y.sort((E,B)=>B.intersectionZ-E.intersectionZ);const w=[];for(let E=this._order.length-1;E>=0;E--){const B=this._order[E];if(h(B))for(let j=y.length-1;j>=0;j--){const Y=y[j].feature;if(g[Y.layer.id]<E)break;w.push(Y),y.pop()}else for(const j of s){const Y=j[B];if(Y)for(const re of Y)w.push(re.feature)}}return w}queryRenderedFeatures(s,h,g){h&&h.filter&&this._validate(a.u.filter,"queryRenderedFeatures.filter",h.filter,null,h);const y={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new a.j(new Error("parameters.layers must be an Array."))),[];for(const B of h.layers){const j=this._layers[B];if(!j)return this.fire(new a.j(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];y[j.source]=!0}}const w=[];h.availableImages=this._availableImages;const E=this._serializedAllLayers();for(const B in this.sourceCaches)h.layers&&!y[B]||w.push(Ue(this.sourceCaches[B],this._layers,E,s,h,g));return this.placement&&w.push(function(B,j,Y,re,ie,_e,Ae){const Se={},ze=_e.queryRenderedSymbols(re),Re=[];for(const Be of Object.keys(ze).map(Number))Re.push(Ae[Be]);Re.sort(Xe);for(const Be of Re){const $e=Be.featureIndex.lookupSymbolFeatures(ze[Be.bucketInstanceId],j,Be.bucketIndex,Be.sourceLayerIndex,ie.filter,ie.layers,ie.availableImages,B);for(const Ie in $e){const qe=Se[Ie]=Se[Ie]||[],We=$e[Ie];We.sort((nt,bt)=>{const Pt=Be.featureSortOrder;if(Pt){const Vt=Pt.indexOf(nt.featureIndex);return Pt.indexOf(bt.featureIndex)-Vt}return bt.featureIndex-nt.featureIndex});for(const nt of We)qe.push(nt)}}for(const Be in Se)Se[Be].forEach($e=>{const Ie=$e.feature,qe=Y[B[Be].source].getFeatureState(Ie.layer["source-layer"],Ie.id);Ie.source=Ie.layer.source,Ie.layer["source-layer"]&&(Ie.sourceLayer=Ie.layer["source-layer"]),Ie.state=qe});return Se}(this._layers,E,this.sourceCaches,s,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(w)}querySourceFeatures(s,h){h&&h.filter&&this._validate(a.u.filter,"querySourceFeatures.filter",h.filter,null,h);const g=this.sourceCaches[s];return g?function(y,w){const E=y.getRenderableIds().map(Y=>y.getTileByID(Y)),B=[],j={};for(let Y=0;Y<E.length;Y++){const re=E[Y],ie=re.tileID.canonical.key;j[ie]||(j[ie]=!0,re.querySourceFeatures(B,w))}return B}(g,h):[]}getLight(){return this.light.getLight()}setLight(s,h={}){this._checkLoaded();const g=this.light.getLight();let y=!1;for(const E in s)if(!a.aE(s[E],g[E])){y=!0;break}if(!y)return;const w={now:v.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,h),this.light.updateTransitions(w)}getSky(){var s;return(s=this.stylesheet)===null||s===void 0?void 0:s.sky}setSky(s,h={}){const g=this.getSky();let y=!1;if(!s&&!g)return;if(s&&!g)y=!0;else if(!s&&g)y=!0;else for(const E in s)if(!a.aE(s[E],g[E])){y=!0;break}if(!y)return;const w={now:v.now(),transition:a.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=s,this.sky.setSky(s,h),this.sky.updateTransitions(w)}_validate(s,h,g,y,w={}){return(!w||w.validate!==!1)&&yo(this,s.call(a.u,a.e({key:h,style:this.serialize(),value:g,styleSpec:a.v},y)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),jr().off(vt,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const g=this.sourceCaches[h];g.setEventedParent(null),g.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const h in this.sourceCaches)this.sourceCaches[h].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,h,g,y,w=!1){let E=!1,B=!1;const j={};for(const Y of this._order){const re=this._layers[Y];if(re.type!=="symbol")continue;if(!j[re.source]){const _e=this.sourceCaches[re.source];j[re.source]=_e.getRenderableIds(!0).map(Ae=>_e.getTileByID(Ae)).sort((Ae,Se)=>Se.tileID.overscaledZ-Ae.tileID.overscaledZ||(Ae.tileID.isLessThan(Se.tileID)?-1:1))}const ie=this.crossTileSymbolIndex.addLayer(re,j[re.source],s.center.lng);E=E||ie}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((w=w||this._layerOrderChanged||g===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.now(),s.zoom))&&(this.pauseablePlacement=new Ga(s,this.map.terrain,this._order,w,h,g,y,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.now()),B=!0),E&&this.pauseablePlacement.placement.setStale()),B||E)for(const Y of this._order){const re=this._layers[Y];re.type==="symbol"&&this.placement.updateLayerOpacities(re,j[re.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,h){return a._(this,void 0,void 0,function*(){const g=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,h.icons),g})}getGlyphs(s,h){return a._(this,void 0,void 0,function*(){const g=yield this.glyphManager.getGlyphs(h.stacks),y=this.sourceCaches[h.source];return y&&y.setDependencies(h.tileID.key,h.type,[""]),g})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,h={}){this._checkLoaded(),s&&this._validate(a.u.glyphs,"glyphs",s,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,h,g={},y){this._checkLoaded();const w=[{id:s,url:h}],E=[...Q(this.stylesheet.sprite),...w];this._validate(a.u.sprite,"sprite",E,null,g)||(this.stylesheet.sprite=E,this._loadSprite(w,!0,y))}removeSprite(s){this._checkLoaded();const h=Q(this.stylesheet.sprite);if(h.find(g=>g.id===s)){if(this._spritesImagesIds[s])for(const g of this._spritesImagesIds[s])this.imageManager.removeImage(g),this._changedImages[g]=!0;h.splice(h.findIndex(g=>g.id===s),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new a.k("data",{dataType:"style"}))}else this.fire(new a.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Q(this.stylesheet.sprite)}setSprite(s,h={},g){this._checkLoaded(),s&&this._validate(a.u.sprite,"sprite",s,null,h)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,g):(this._unloadSprite(),g&&g(null)))}}var Ls=a.Y([{name:"a_pos",type:"Int16",components:2}]);const ms={prelude:ur(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ur(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ur(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ur(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ur("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ur(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:ur(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ur("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ur("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ur("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ur(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ur(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ur(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ur(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ur(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ur(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ur(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ur(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ur(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ur(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ur(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ur(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ur(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ur(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ur(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ur(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ur("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:ur("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:ur("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:ur("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function ur(x,s){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=s.match(/attribute ([\w]+) ([\w]+)/g),y=x.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=w?w.concat(y):y,B={};return{fragmentSource:x=x.replace(h,(j,Y,re,ie,_e)=>(B[_e]=!0,Y==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
varying ${re} ${ie} ${_e};
#else
uniform ${re} ${ie} u_${_e};
#endif
`:`
#ifdef HAS_UNIFORM_u_${_e}
    ${re} ${ie} ${_e} = u_${_e};
#endif
`)),vertexSource:s=s.replace(h,(j,Y,re,ie,_e)=>{const Ae=ie==="float"?"vec2":"vec4",Se=_e.match(/color/)?"color":Ae;return B[_e]?Y==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
uniform lowp float u_${_e}_t;
attribute ${re} ${Ae} a_${_e};
varying ${re} ${ie} ${_e};
#else
uniform ${re} ${ie} u_${_e};
#endif
`:Se==="vec4"?`
#ifndef HAS_UNIFORM_u_${_e}
    ${_e} = a_${_e};
#else
    ${re} ${ie} ${_e} = u_${_e};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_e}
    ${_e} = unpack_mix_${Se}(a_${_e}, u_${_e}_t);
#else
    ${re} ${ie} ${_e} = u_${_e};
#endif
`:Y==="define"?`
#ifndef HAS_UNIFORM_u_${_e}
uniform lowp float u_${_e}_t;
attribute ${re} ${Ae} a_${_e};
#else
uniform ${re} ${ie} u_${_e};
#endif
`:Se==="vec4"?`
#ifndef HAS_UNIFORM_u_${_e}
    ${re} ${ie} ${_e} = a_${_e};
#else
    ${re} ${ie} ${_e} = u_${_e};
#endif
`:`
#ifndef HAS_UNIFORM_u_${_e}
    ${re} ${ie} ${_e} = unpack_mix_${Se}(a_${_e}, u_${_e}_t);
#else
    ${re} ${ie} ${_e} = u_${_e};
#endif
`}),staticAttributes:g,staticUniforms:E}}class ic{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,h,g,y,w,E,B,j,Y){this.context=s;let re=this.boundPaintVertexBuffers.length!==y.length;for(let ie=0;!re&&ie<y.length;ie++)this.boundPaintVertexBuffers[ie]!==y[ie]&&(re=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==g||re||this.boundIndexBuffer!==w||this.boundVertexOffset!==E||this.boundDynamicVertexBuffer!==B||this.boundDynamicVertexBuffer2!==j||this.boundDynamicVertexBuffer3!==Y?this.freshBind(h,g,y,w,E,B,j,Y):(s.bindVertexArray.set(this.vao),B&&B.bind(),w&&w.dynamicDraw&&w.bind(),j&&j.bind(),Y&&Y.bind())}freshBind(s,h,g,y,w,E,B,j){const Y=s.numAttributes,re=this.context,ie=re.gl;this.vao&&this.destroy(),this.vao=re.createVertexArray(),re.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=y,this.boundVertexOffset=w,this.boundDynamicVertexBuffer=E,this.boundDynamicVertexBuffer2=B,this.boundDynamicVertexBuffer3=j,h.enableAttributes(ie,s);for(const _e of g)_e.enableAttributes(ie,s);E&&E.enableAttributes(ie,s),B&&B.enableAttributes(ie,s),j&&j.enableAttributes(ie,s),h.bind(),h.setVertexAttribPointers(ie,s,w);for(const _e of g)_e.bind(),_e.setVertexAttribPointers(ie,s,w);E&&(E.bind(),E.setVertexAttribPointers(ie,s,w)),y&&y.bind(),B&&(B.bind(),B.setVertexAttribPointers(ie,s,w)),j&&(j.bind(),j.setVertexAttribPointers(ie,s,w)),re.currentNumAttributes=Y}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const oc=(x,s,h,g,y)=>({u_matrix:x,u_texture:0,u_ele_delta:s,u_fog_matrix:h,u_fog_color:g?g.properties.get("fog-color"):a.aM.white,u_fog_ground_blend:g?g.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:g?g.calculateFogBlendOpacity(y):0,u_horizon_color:g?g.properties.get("horizon-color"):a.aM.white,u_horizon_fog_blend:g?g.properties.get("horizon-fog-blend"):1});function ra(x){const s=[];for(let h=0;h<x.length;h++){if(x[h]===null)continue;const g=x[h].split(" ");s.push(g.pop())}return s}class sc{constructor(s,h,g,y,w,E){const B=s.gl;this.program=B.createProgram();const j=ra(h.staticAttributes),Y=g?g.getBinderAttributes():[],re=j.concat(Y),ie=ms.prelude.staticUniforms?ra(ms.prelude.staticUniforms):[],_e=h.staticUniforms?ra(h.staticUniforms):[],Ae=g?g.getBinderUniforms():[],Se=ie.concat(_e).concat(Ae),ze=[];for(const nt of Se)ze.indexOf(nt)<0&&ze.push(nt);const Re=g?g.defines():[];w&&Re.push("#define OVERDRAW_INSPECTOR;"),E&&Re.push("#define TERRAIN3D;");const Be=Re.concat(ms.prelude.fragmentSource,h.fragmentSource).join(`
`),$e=Re.concat(ms.prelude.vertexSource,h.vertexSource).join(`
`),Ie=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(Ie,Be),B.compileShader(Ie),!B.getShaderParameter(Ie,B.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${B.getShaderInfoLog(Ie)}`);B.attachShader(this.program,Ie);const qe=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);if(B.shaderSource(qe,$e),B.compileShader(qe),!B.getShaderParameter(qe,B.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${B.getShaderInfoLog(qe)}`);B.attachShader(this.program,qe),this.attributes={};const We={};this.numAttributes=re.length;for(let nt=0;nt<this.numAttributes;nt++)re[nt]&&(B.bindAttribLocation(this.program,nt,re[nt]),this.attributes[re[nt]]=nt);if(B.linkProgram(this.program),!B.getProgramParameter(this.program,B.LINK_STATUS))throw new Error(`Program failed to link: ${B.getProgramInfoLog(this.program)}`);B.deleteShader(qe),B.deleteShader(Ie);for(let nt=0;nt<ze.length;nt++){const bt=ze[nt];if(bt&&!We[bt]){const Pt=B.getUniformLocation(this.program,bt);Pt&&(We[bt]=Pt)}}this.fixedUniforms=y(s,We),this.terrainUniforms=((nt,bt)=>({u_depth:new a.aH(nt,bt.u_depth),u_terrain:new a.aH(nt,bt.u_terrain),u_terrain_dim:new a.aI(nt,bt.u_terrain_dim),u_terrain_matrix:new a.aJ(nt,bt.u_terrain_matrix),u_terrain_unpack:new a.aK(nt,bt.u_terrain_unpack),u_terrain_exaggeration:new a.aI(nt,bt.u_terrain_exaggeration)}))(s,We),this.binderUniforms=g?g.getUniforms(s,We):[]}draw(s,h,g,y,w,E,B,j,Y,re,ie,_e,Ae,Se,ze,Re,Be,$e){const Ie=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(g),s.setStencilMode(y),s.setColorMode(w),s.setCullFace(E),j){s.activeTexture.set(Ie.TEXTURE2),Ie.bindTexture(Ie.TEXTURE_2D,j.depthTexture),s.activeTexture.set(Ie.TEXTURE3),Ie.bindTexture(Ie.TEXTURE_2D,j.texture);for(const We in this.terrainUniforms)this.terrainUniforms[We].set(j[We])}for(const We in this.fixedUniforms)this.fixedUniforms[We].set(B[We]);ze&&ze.setUniforms(s,this.binderUniforms,Ae,{zoom:Se});let qe=0;switch(h){case Ie.LINES:qe=2;break;case Ie.TRIANGLES:qe=3;break;case Ie.LINE_STRIP:qe=1}for(const We of _e.get()){const nt=We.vaos||(We.vaos={});(nt[Y]||(nt[Y]=new ic)).bind(s,this,re,ze?ze.getPaintVertexBuffers():[],ie,We.vertexOffset,Re,Be,$e),Ie.drawElements(h,We.primitiveLength*qe,Ie.UNSIGNED_SHORT,We.primitiveOffset*qe*2)}}}function zl(x,s,h){const g=1/Un(h,1,s.transform.tileZoom),y=Math.pow(2,h.tileID.overscaledZ),w=h.tileSize*Math.pow(2,s.transform.tileZoom)/y,E=w*(h.tileID.canonical.x+h.tileID.wrap*y),B=w*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[g,x.fromScale,x.toScale],u_fade:x.t,u_pixel_coord_upper:[E>>16,B>>16],u_pixel_coord_lower:[65535&E,65535&B]}}const Za=(x,s,h,g)=>{const y=s.style.light,w=y.properties.get("position"),E=[w.x,w.y,w.z],B=function(){var Y=new a.A(9);return a.A!=Float32Array&&(Y[1]=0,Y[2]=0,Y[3]=0,Y[5]=0,Y[6]=0,Y[7]=0),Y[0]=1,Y[4]=1,Y[8]=1,Y}();y.properties.get("anchor")==="viewport"&&function(Y,re){var ie=Math.sin(re),_e=Math.cos(re);Y[0]=_e,Y[1]=ie,Y[2]=0,Y[3]=-ie,Y[4]=_e,Y[5]=0,Y[6]=0,Y[7]=0,Y[8]=1}(B,-s.transform.angle),function(Y,re,ie){var _e=re[0],Ae=re[1],Se=re[2];Y[0]=_e*ie[0]+Ae*ie[3]+Se*ie[6],Y[1]=_e*ie[1]+Ae*ie[4]+Se*ie[7],Y[2]=_e*ie[2]+Ae*ie[5]+Se*ie[8]}(E,E,B);const j=y.properties.get("color");return{u_matrix:x,u_lightpos:E,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+h,u_opacity:g}},Dl=(x,s,h,g,y,w,E)=>a.e(Za(x,s,h,g),zl(w,s,E),{u_height_factor:-Math.pow(2,y.overscaledZ)/E.tileSize/8}),ia=x=>({u_matrix:x}),ch=(x,s,h,g)=>a.e(ia(x),zl(h,s,g)),fp=(x,s)=>({u_matrix:x,u_world:s}),fh=(x,s,h,g,y)=>a.e(ch(x,s,h,g),{u_world:y}),hp=(x,s,h,g)=>{const y=x.transform;let w,E;if(g.paint.get("circle-pitch-alignment")==="map"){const B=Un(h,1,y.zoom);w=!0,E=[B,B]}else w=!1,E=y.pixelsToGLUnits;return{u_camera_to_center_distance:y.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:x.translatePosMatrix(s.posMatrix,h,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+w,u_device_pixel_ratio:x.pixelRatio,u_extrude_scale:E}},Ps=(x,s,h)=>({u_matrix:x,u_inv_matrix:s,u_camera_to_center_distance:h.cameraToCenterDistance,u_viewport_size:[h.width,h.height]}),Ha=(x,s,h=1)=>({u_matrix:x,u_color:s,u_overlay:0,u_overlay_scale:h}),Oi=x=>({u_matrix:x}),Ni=(x,s,h,g)=>({u_matrix:x,u_extrude_scale:Un(s,1,h),u_intensity:g}),Rl=(x,s,h,g)=>{const y=a.H();a.aP(y,0,x.width,x.height,0,0,1);const w=x.context.gl;return{u_matrix:y,u_world:[w.drawingBufferWidth,w.drawingBufferHeight],u_image:h,u_color_ramp:g,u_opacity:s.paint.get("heatmap-opacity")}};function Bl(x,s){const h=Math.pow(2,s.canonical.z),g=s.canonical.y;return[new a.Z(0,g/h).toLngLat().lat,new a.Z(0,(g+1)/h).toLngLat().lat]}const Fl=(x,s,h,g)=>{const y=x.transform;return{u_matrix:ph(x,s,h,g),u_ratio:1/Un(s,1,y.zoom),u_device_pixel_ratio:x.pixelRatio,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},hh=(x,s,h,g,y)=>a.e(Fl(x,s,h,y),{u_image:0,u_image_height:g}),oa=(x,s,h,g,y)=>{const w=x.transform,E=dh(s,w);return{u_matrix:ph(x,s,h,y),u_texsize:s.imageAtlasTexture.size,u_ratio:1/Un(s,1,w.zoom),u_device_pixel_ratio:x.pixelRatio,u_image:0,u_scale:[E,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]]}},dp=(x,s,h,g,y,w)=>{const E=x.lineAtlas,B=dh(s,x.transform),j=h.layout.get("line-cap")==="round",Y=E.getDash(g.from,j),re=E.getDash(g.to,j),ie=Y.width*y.fromScale,_e=re.width*y.toScale;return a.e(Fl(x,s,h,w),{u_patternscale_a:[B/ie,-Y.height/2],u_patternscale_b:[B/_e,-re.height/2],u_sdfgamma:E.width/(256*Math.min(ie,_e)*x.pixelRatio)/2,u_image:0,u_tex_y_a:Y.y,u_tex_y_b:re.y,u_mix:y.t})};function dh(x,s){return 1/Un(x,1,s.tileZoom)}function ph(x,s,h,g){return x.translatePosMatrix(g?g.posMatrix:s.tileID.posMatrix,s,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const pp=(x,s,h,g,y)=>{return{u_matrix:x,u_tl_parent:s,u_scale_parent:h,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(E=y.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(w=y.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:mp(y.paint.get("raster-hue-rotate"))};var w,E};function mp(x){x*=Math.PI/180;const s=Math.sin(x),h=Math.cos(x);return[(2*h+1)/3,(-Math.sqrt(3)*s-h+1)/3,(Math.sqrt(3)*s-h+1)/3]}const mh=(x,s,h,g,y,w,E,B,j,Y,re,ie,_e,Ae)=>{const Se=E.transform;return{u_is_size_zoom_constant:+(x==="constant"||x==="source"),u_is_size_feature_constant:+(x==="constant"||x==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Se.cameraToCenterDistance,u_pitch:Se.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:Se.width/Se.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:B,u_label_plane_matrix:j,u_coord_matrix:Y,u_is_text:+ie,u_pitch_with_map:+g,u_is_along_line:y,u_is_variable_anchor:w,u_texsize:_e,u_texture:0,u_translation:re,u_pitched_scale:Ae}},Wa=(x,s,h,g,y,w,E,B,j,Y,re,ie,_e,Ae,Se)=>{const ze=E.transform;return a.e(mh(x,s,h,g,y,w,E,B,j,Y,re,ie,_e,Se),{u_gamma_scale:g?Math.cos(ze._pitch)*ze.cameraToCenterDistance:1,u_device_pixel_ratio:E.pixelRatio,u_is_halo:1})},ac=(x,s,h,g,y,w,E,B,j,Y,re,ie,_e,Ae)=>a.e(Wa(x,s,h,g,y,w,E,B,j,Y,re,!0,ie,!0,Ae),{u_texsize_icon:_e,u_texture_icon:1}),Ol=(x,s,h)=>({u_matrix:x,u_opacity:s,u_color:h}),lc=(x,s,h,g,y,w)=>a.e(function(E,B,j,Y){const re=j.imageManager.getPattern(E.from.toString()),ie=j.imageManager.getPattern(E.to.toString()),{width:_e,height:Ae}=j.imageManager.getPixelSize(),Se=Math.pow(2,Y.tileID.overscaledZ),ze=Y.tileSize*Math.pow(2,j.transform.tileZoom)/Se,Re=ze*(Y.tileID.canonical.x+Y.tileID.wrap*Se),Be=ze*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:re.tl,u_pattern_br_a:re.br,u_pattern_tl_b:ie.tl,u_pattern_br_b:ie.br,u_texsize:[_e,Ae],u_mix:B.t,u_pattern_size_a:re.displaySize,u_pattern_size_b:ie.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/Un(Y,1,j.transform.tileZoom),u_pixel_coord_upper:[Re>>16,Be>>16],u_pixel_coord_lower:[65535&Re,65535&Be]}}(g,w,h,y),{u_matrix:x,u_opacity:s}),uc={fillExtrusion:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_lightpos:new a.aN(x,s.u_lightpos),u_lightintensity:new a.aI(x,s.u_lightintensity),u_lightcolor:new a.aN(x,s.u_lightcolor),u_vertical_gradient:new a.aI(x,s.u_vertical_gradient),u_opacity:new a.aI(x,s.u_opacity)}),fillExtrusionPattern:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_lightpos:new a.aN(x,s.u_lightpos),u_lightintensity:new a.aI(x,s.u_lightintensity),u_lightcolor:new a.aN(x,s.u_lightcolor),u_vertical_gradient:new a.aI(x,s.u_vertical_gradient),u_height_factor:new a.aI(x,s.u_height_factor),u_image:new a.aH(x,s.u_image),u_texsize:new a.aO(x,s.u_texsize),u_pixel_coord_upper:new a.aO(x,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(x,s.u_pixel_coord_lower),u_scale:new a.aN(x,s.u_scale),u_fade:new a.aI(x,s.u_fade),u_opacity:new a.aI(x,s.u_opacity)}),fill:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix)}),fillPattern:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_image:new a.aH(x,s.u_image),u_texsize:new a.aO(x,s.u_texsize),u_pixel_coord_upper:new a.aO(x,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(x,s.u_pixel_coord_lower),u_scale:new a.aN(x,s.u_scale),u_fade:new a.aI(x,s.u_fade)}),fillOutline:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_world:new a.aO(x,s.u_world)}),fillOutlinePattern:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_world:new a.aO(x,s.u_world),u_image:new a.aH(x,s.u_image),u_texsize:new a.aO(x,s.u_texsize),u_pixel_coord_upper:new a.aO(x,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(x,s.u_pixel_coord_lower),u_scale:new a.aN(x,s.u_scale),u_fade:new a.aI(x,s.u_fade)}),circle:(x,s)=>({u_camera_to_center_distance:new a.aI(x,s.u_camera_to_center_distance),u_scale_with_map:new a.aH(x,s.u_scale_with_map),u_pitch_with_map:new a.aH(x,s.u_pitch_with_map),u_extrude_scale:new a.aO(x,s.u_extrude_scale),u_device_pixel_ratio:new a.aI(x,s.u_device_pixel_ratio),u_matrix:new a.aJ(x,s.u_matrix)}),collisionBox:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_pixel_extrude_scale:new a.aO(x,s.u_pixel_extrude_scale)}),collisionCircle:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_inv_matrix:new a.aJ(x,s.u_inv_matrix),u_camera_to_center_distance:new a.aI(x,s.u_camera_to_center_distance),u_viewport_size:new a.aO(x,s.u_viewport_size)}),debug:(x,s)=>({u_color:new a.aL(x,s.u_color),u_matrix:new a.aJ(x,s.u_matrix),u_overlay:new a.aH(x,s.u_overlay),u_overlay_scale:new a.aI(x,s.u_overlay_scale)}),clippingMask:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix)}),heatmap:(x,s)=>({u_extrude_scale:new a.aI(x,s.u_extrude_scale),u_intensity:new a.aI(x,s.u_intensity),u_matrix:new a.aJ(x,s.u_matrix)}),heatmapTexture:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_world:new a.aO(x,s.u_world),u_image:new a.aH(x,s.u_image),u_color_ramp:new a.aH(x,s.u_color_ramp),u_opacity:new a.aI(x,s.u_opacity)}),hillshade:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_image:new a.aH(x,s.u_image),u_latrange:new a.aO(x,s.u_latrange),u_light:new a.aO(x,s.u_light),u_shadow:new a.aL(x,s.u_shadow),u_highlight:new a.aL(x,s.u_highlight),u_accent:new a.aL(x,s.u_accent)}),hillshadePrepare:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_image:new a.aH(x,s.u_image),u_dimension:new a.aO(x,s.u_dimension),u_zoom:new a.aI(x,s.u_zoom),u_unpack:new a.aK(x,s.u_unpack)}),line:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_ratio:new a.aI(x,s.u_ratio),u_device_pixel_ratio:new a.aI(x,s.u_device_pixel_ratio),u_units_to_pixels:new a.aO(x,s.u_units_to_pixels)}),lineGradient:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_ratio:new a.aI(x,s.u_ratio),u_device_pixel_ratio:new a.aI(x,s.u_device_pixel_ratio),u_units_to_pixels:new a.aO(x,s.u_units_to_pixels),u_image:new a.aH(x,s.u_image),u_image_height:new a.aI(x,s.u_image_height)}),linePattern:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_texsize:new a.aO(x,s.u_texsize),u_ratio:new a.aI(x,s.u_ratio),u_device_pixel_ratio:new a.aI(x,s.u_device_pixel_ratio),u_image:new a.aH(x,s.u_image),u_units_to_pixels:new a.aO(x,s.u_units_to_pixels),u_scale:new a.aN(x,s.u_scale),u_fade:new a.aI(x,s.u_fade)}),lineSDF:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_ratio:new a.aI(x,s.u_ratio),u_device_pixel_ratio:new a.aI(x,s.u_device_pixel_ratio),u_units_to_pixels:new a.aO(x,s.u_units_to_pixels),u_patternscale_a:new a.aO(x,s.u_patternscale_a),u_patternscale_b:new a.aO(x,s.u_patternscale_b),u_sdfgamma:new a.aI(x,s.u_sdfgamma),u_image:new a.aH(x,s.u_image),u_tex_y_a:new a.aI(x,s.u_tex_y_a),u_tex_y_b:new a.aI(x,s.u_tex_y_b),u_mix:new a.aI(x,s.u_mix)}),raster:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_tl_parent:new a.aO(x,s.u_tl_parent),u_scale_parent:new a.aI(x,s.u_scale_parent),u_buffer_scale:new a.aI(x,s.u_buffer_scale),u_fade_t:new a.aI(x,s.u_fade_t),u_opacity:new a.aI(x,s.u_opacity),u_image0:new a.aH(x,s.u_image0),u_image1:new a.aH(x,s.u_image1),u_brightness_low:new a.aI(x,s.u_brightness_low),u_brightness_high:new a.aI(x,s.u_brightness_high),u_saturation_factor:new a.aI(x,s.u_saturation_factor),u_contrast_factor:new a.aI(x,s.u_contrast_factor),u_spin_weights:new a.aN(x,s.u_spin_weights)}),symbolIcon:(x,s)=>({u_is_size_zoom_constant:new a.aH(x,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(x,s.u_is_size_feature_constant),u_size_t:new a.aI(x,s.u_size_t),u_size:new a.aI(x,s.u_size),u_camera_to_center_distance:new a.aI(x,s.u_camera_to_center_distance),u_pitch:new a.aI(x,s.u_pitch),u_rotate_symbol:new a.aH(x,s.u_rotate_symbol),u_aspect_ratio:new a.aI(x,s.u_aspect_ratio),u_fade_change:new a.aI(x,s.u_fade_change),u_matrix:new a.aJ(x,s.u_matrix),u_label_plane_matrix:new a.aJ(x,s.u_label_plane_matrix),u_coord_matrix:new a.aJ(x,s.u_coord_matrix),u_is_text:new a.aH(x,s.u_is_text),u_pitch_with_map:new a.aH(x,s.u_pitch_with_map),u_is_along_line:new a.aH(x,s.u_is_along_line),u_is_variable_anchor:new a.aH(x,s.u_is_variable_anchor),u_texsize:new a.aO(x,s.u_texsize),u_texture:new a.aH(x,s.u_texture),u_translation:new a.aO(x,s.u_translation),u_pitched_scale:new a.aI(x,s.u_pitched_scale)}),symbolSDF:(x,s)=>({u_is_size_zoom_constant:new a.aH(x,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(x,s.u_is_size_feature_constant),u_size_t:new a.aI(x,s.u_size_t),u_size:new a.aI(x,s.u_size),u_camera_to_center_distance:new a.aI(x,s.u_camera_to_center_distance),u_pitch:new a.aI(x,s.u_pitch),u_rotate_symbol:new a.aH(x,s.u_rotate_symbol),u_aspect_ratio:new a.aI(x,s.u_aspect_ratio),u_fade_change:new a.aI(x,s.u_fade_change),u_matrix:new a.aJ(x,s.u_matrix),u_label_plane_matrix:new a.aJ(x,s.u_label_plane_matrix),u_coord_matrix:new a.aJ(x,s.u_coord_matrix),u_is_text:new a.aH(x,s.u_is_text),u_pitch_with_map:new a.aH(x,s.u_pitch_with_map),u_is_along_line:new a.aH(x,s.u_is_along_line),u_is_variable_anchor:new a.aH(x,s.u_is_variable_anchor),u_texsize:new a.aO(x,s.u_texsize),u_texture:new a.aH(x,s.u_texture),u_gamma_scale:new a.aI(x,s.u_gamma_scale),u_device_pixel_ratio:new a.aI(x,s.u_device_pixel_ratio),u_is_halo:new a.aH(x,s.u_is_halo),u_translation:new a.aO(x,s.u_translation),u_pitched_scale:new a.aI(x,s.u_pitched_scale)}),symbolTextAndIcon:(x,s)=>({u_is_size_zoom_constant:new a.aH(x,s.u_is_size_zoom_constant),u_is_size_feature_constant:new a.aH(x,s.u_is_size_feature_constant),u_size_t:new a.aI(x,s.u_size_t),u_size:new a.aI(x,s.u_size),u_camera_to_center_distance:new a.aI(x,s.u_camera_to_center_distance),u_pitch:new a.aI(x,s.u_pitch),u_rotate_symbol:new a.aH(x,s.u_rotate_symbol),u_aspect_ratio:new a.aI(x,s.u_aspect_ratio),u_fade_change:new a.aI(x,s.u_fade_change),u_matrix:new a.aJ(x,s.u_matrix),u_label_plane_matrix:new a.aJ(x,s.u_label_plane_matrix),u_coord_matrix:new a.aJ(x,s.u_coord_matrix),u_is_text:new a.aH(x,s.u_is_text),u_pitch_with_map:new a.aH(x,s.u_pitch_with_map),u_is_along_line:new a.aH(x,s.u_is_along_line),u_is_variable_anchor:new a.aH(x,s.u_is_variable_anchor),u_texsize:new a.aO(x,s.u_texsize),u_texsize_icon:new a.aO(x,s.u_texsize_icon),u_texture:new a.aH(x,s.u_texture),u_texture_icon:new a.aH(x,s.u_texture_icon),u_gamma_scale:new a.aI(x,s.u_gamma_scale),u_device_pixel_ratio:new a.aI(x,s.u_device_pixel_ratio),u_is_halo:new a.aH(x,s.u_is_halo),u_translation:new a.aO(x,s.u_translation),u_pitched_scale:new a.aI(x,s.u_pitched_scale)}),background:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_opacity:new a.aI(x,s.u_opacity),u_color:new a.aL(x,s.u_color)}),backgroundPattern:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_opacity:new a.aI(x,s.u_opacity),u_image:new a.aH(x,s.u_image),u_pattern_tl_a:new a.aO(x,s.u_pattern_tl_a),u_pattern_br_a:new a.aO(x,s.u_pattern_br_a),u_pattern_tl_b:new a.aO(x,s.u_pattern_tl_b),u_pattern_br_b:new a.aO(x,s.u_pattern_br_b),u_texsize:new a.aO(x,s.u_texsize),u_mix:new a.aI(x,s.u_mix),u_pattern_size_a:new a.aO(x,s.u_pattern_size_a),u_pattern_size_b:new a.aO(x,s.u_pattern_size_b),u_scale_a:new a.aI(x,s.u_scale_a),u_scale_b:new a.aI(x,s.u_scale_b),u_pixel_coord_upper:new a.aO(x,s.u_pixel_coord_upper),u_pixel_coord_lower:new a.aO(x,s.u_pixel_coord_lower),u_tile_units_to_pixels:new a.aI(x,s.u_tile_units_to_pixels)}),terrain:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_texture:new a.aH(x,s.u_texture),u_ele_delta:new a.aI(x,s.u_ele_delta),u_fog_matrix:new a.aJ(x,s.u_fog_matrix),u_fog_color:new a.aL(x,s.u_fog_color),u_fog_ground_blend:new a.aI(x,s.u_fog_ground_blend),u_fog_ground_blend_opacity:new a.aI(x,s.u_fog_ground_blend_opacity),u_horizon_color:new a.aL(x,s.u_horizon_color),u_horizon_fog_blend:new a.aI(x,s.u_horizon_fog_blend)}),terrainDepth:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_ele_delta:new a.aI(x,s.u_ele_delta)}),terrainCoords:(x,s)=>({u_matrix:new a.aJ(x,s.u_matrix),u_texture:new a.aH(x,s.u_texture),u_terrain_coords_id:new a.aI(x,s.u_terrain_coords_id),u_ele_delta:new a.aI(x,s.u_ele_delta)}),sky:(x,s)=>({u_sky_color:new a.aL(x,s.u_sky_color),u_horizon_color:new a.aL(x,s.u_horizon_color),u_horizon:new a.aI(x,s.u_horizon),u_sky_horizon_blend:new a.aI(x,s.u_sky_horizon_blend)})};class Fo{constructor(s,h,g){this.context=s;const y=s.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!g,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const gp={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class cc{constructor(s,h,g,y){this.length=h.length,this.attributes=g,this.itemSize=h.bytesPerElement,this.dynamicDraw=y,this.context=s;const w=s.gl;this.buffer=w.createBuffer(),s.bindVertexBuffer.set(this.buffer),w.bufferData(w.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,h){for(let g=0;g<this.attributes.length;g++){const y=h.attributes[this.attributes[g].name];y!==void 0&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,h,g){for(let y=0;y<this.attributes.length;y++){const w=this.attributes[y],E=h.attributes[w.name];E!==void 0&&s.vertexAttribPointer(E,w.components,s[gp[w.type]],!1,this.itemSize,w.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zs=new WeakMap;function gs(x){var s;if(zs.has(x))return zs.get(x);{const h=(s=x.getParameter(x.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return zs.set(x,h),h}}class pr{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Nl extends pr{getDefault(){return a.aM.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class _p extends pr{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class sa extends pr{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class yp extends pr{getDefault(){return[!0,!0,!0,!0]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class gh extends pr{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class bp extends pr{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class _h extends pr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const h=this.current;(s.func!==h.func||s.ref!==h.ref||s.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class fc extends pr{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class yh extends pr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=s,this.dirty=!1}}class bh extends pr{getDefault(){return[0,1]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class vh extends pr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=s,this.dirty=!1}}class wh extends pr{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class Ds extends pr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.BLEND):h.disable(h.BLEND),this.current=s,this.dirty=!1}}class xh extends pr{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class vp extends pr{getDefault(){return a.aM.transparent}set(s){const h=this.current;(s.r!==h.r||s.g!==h.g||s.b!==h.b||s.a!==h.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Ah extends pr{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Xa extends pr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;s?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=s,this.dirty=!1}}class wp extends pr{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class $l extends pr{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class xp extends pr{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Ap extends pr{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class kh extends pr{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const h=this.current;(s[0]!==h[0]||s[1]!==h[1]||s[2]!==h[2]||s[3]!==h[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Sh extends pr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Th extends pr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class hc extends pr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Ch extends pr{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class jl extends pr{getDefault(){return null}set(s){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class es extends pr{getDefault(){return null}set(s){var h;if(s===this.current&&!this.dirty)return;const g=this.gl;gs(g)?g.bindVertexArray(s):(h=g.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class dc extends pr{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class pc extends pr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class mc extends pr{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Ul extends pr{constructor(s,h){super(s),this.context=s,this.parent=h}getDefault(){return null}}class gc extends Ul{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Rs extends Ul{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class _c extends Ul{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class kp{constructor(s,h,g,y,w){this.context=s,this.width=h,this.height=g;const E=s.gl,B=this.framebuffer=E.createFramebuffer();if(this.colorAttachment=new gc(s,B),y)this.depthAttachment=w?new _c(s,B):new Rs(s,B);else if(w)throw new Error("Stencil cannot be set without depth");if(E.checkFramebufferStatus(E.FRAMEBUFFER)!==E.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,h=this.colorAttachment.get();if(h&&s.deleteTexture(h),this.depthAttachment){const g=this.depthAttachment.get();g&&s.deleteRenderbuffer(g)}s.deleteFramebuffer(this.framebuffer)}}class Hr{constructor(s,h,g){this.blendFunction=s,this.blendColor=h,this.mask=g}}Hr.Replace=[1,0],Hr.disabled=new Hr(Hr.Replace,a.aM.transparent,[!1,!1,!1,!1]),Hr.unblended=new Hr(Hr.Replace,a.aM.transparent,[!0,!0,!0,!0]),Hr.alphaBlended=new Hr([1,771],a.aM.transparent,[!0,!0,!0,!0]);class Sp{constructor(s){var h,g;if(this.gl=s,this.clearColor=new Nl(this),this.clearDepth=new _p(this),this.clearStencil=new sa(this),this.colorMask=new yp(this),this.depthMask=new gh(this),this.stencilMask=new bp(this),this.stencilFunc=new _h(this),this.stencilOp=new fc(this),this.stencilTest=new yh(this),this.depthRange=new bh(this),this.depthTest=new vh(this),this.depthFunc=new wh(this),this.blend=new Ds(this),this.blendFunc=new xh(this),this.blendColor=new vp(this),this.blendEquation=new Ah(this),this.cullFace=new Xa(this),this.cullFaceSide=new wp(this),this.frontFace=new $l(this),this.program=new xp(this),this.activeTexture=new Ap(this),this.viewport=new kh(this),this.bindFramebuffer=new Sh(this),this.bindRenderbuffer=new Th(this),this.bindTexture=new hc(this),this.bindVertexBuffer=new Ch(this),this.bindElementBuffer=new jl(this),this.bindVertexArray=new es(this),this.pixelStoreUnpack=new dc(this),this.pixelStoreUnpackPremultiplyAlpha=new pc(this),this.pixelStoreUnpackFlipY=new mc(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),gs(s)){this.HALF_FLOAT=s.HALF_FLOAT;const y=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=s.RGBA16F)!==null&&h!==void 0?h:y==null?void 0:y.RGBA16F_EXT,this.RGB16F=(g=s.RGB16F)!==null&&g!==void 0?g:y==null?void 0:y.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const y=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=y==null?void 0:y.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,h){return new Fo(this,s,h)}createVertexBuffer(s,h,g){return new cc(this,s,h,g)}createRenderbuffer(s,h,g){const y=this.gl,w=y.createRenderbuffer();return this.bindRenderbuffer.set(w),y.renderbufferStorage(y.RENDERBUFFER,s,h,g),this.bindRenderbuffer.set(null),w}createFramebuffer(s,h,g,y){return new kp(this,s,h,g,y)}clear({color:s,depth:h,stencil:g}){const y=this.gl;let w=0;s&&(w|=y.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(w|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),g!==void 0&&(w|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),y.clear(w)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){a.aE(s.blendFunction,Hr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return gs(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var h;return gs(this.gl)?this.gl.deleteVertexArray(s):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class Vn{constructor(s,h,g){this.func=s,this.mask=h,this.range=g}}Vn.ReadOnly=!1,Vn.ReadWrite=!0,Vn.disabled=new Vn(519,Vn.ReadOnly,[0,1]);const Vl=7680;class Ir{constructor(s,h,g,y,w,E){this.test=s,this.ref=h,this.mask=g,this.fail=y,this.depthFail=w,this.pass=E}}Ir.disabled=new Ir({func:519,mask:0},0,0,Vl,Vl,Vl);class vr{constructor(s,h,g){this.enable=s,this.mode=h,this.frontFace=g}}let Bs;function Ja(x,s,h,g,y){const w=x.context,E=w.gl,B=x.useProgram("collisionBox"),j=[];let Y=0,re=0;for(let Be=0;Be<g.length;Be++){const $e=g[Be],Ie=s.getTile($e).getBucket(h);if(!Ie)continue;const qe=y?Ie.textCollisionBox:Ie.iconCollisionBox,We=Ie.collisionCircleArray;if(We.length>0){const nt=a.H();a.aQ(nt,Ie.placementInvProjMatrix,x.transform.glCoordMatrix),a.aQ(nt,nt,Ie.placementViewportMatrix),j.push({circleArray:We,circleOffset:re,transform:$e.posMatrix,invTransform:nt,coord:$e}),Y+=We.length/4,re=Y}qe&&B.draw(w,E.LINES,Vn.disabled,Ir.disabled,x.colorModeForRenderPass(),vr.disabled,{u_matrix:$e.posMatrix,u_pixel_extrude_scale:[1/(ie=x.transform).width,1/ie.height]},x.style.map.terrain&&x.style.map.terrain.getTerrainData($e),h.id,qe.layoutVertexBuffer,qe.indexBuffer,qe.segments,null,x.transform.zoom,null,null,qe.collisionVertexBuffer)}var ie;if(!y||!j.length)return;const _e=x.useProgram("collisionCircle"),Ae=new a.aR;Ae.resize(4*Y),Ae._trim();let Se=0;for(const Be of j)for(let $e=0;$e<Be.circleArray.length/4;$e++){const Ie=4*$e,qe=Be.circleArray[Ie+0],We=Be.circleArray[Ie+1],nt=Be.circleArray[Ie+2],bt=Be.circleArray[Ie+3];Ae.emplace(Se++,qe,We,nt,bt,0),Ae.emplace(Se++,qe,We,nt,bt,1),Ae.emplace(Se++,qe,We,nt,bt,2),Ae.emplace(Se++,qe,We,nt,bt,3)}(!Bs||Bs.length<2*Y)&&(Bs=function(Be){const $e=2*Be,Ie=new a.aT;Ie.resize($e),Ie._trim();for(let qe=0;qe<$e;qe++){const We=6*qe;Ie.uint16[We+0]=4*qe+0,Ie.uint16[We+1]=4*qe+1,Ie.uint16[We+2]=4*qe+2,Ie.uint16[We+3]=4*qe+2,Ie.uint16[We+4]=4*qe+3,Ie.uint16[We+5]=4*qe+0}return Ie}(Y));const ze=w.createIndexBuffer(Bs,!0),Re=w.createVertexBuffer(Ae,a.aS.members,!0);for(const Be of j){const $e=Ps(Be.transform,Be.invTransform,x.transform);_e.draw(w,E.TRIANGLES,Vn.disabled,Ir.disabled,x.colorModeForRenderPass(),vr.disabled,$e,x.style.map.terrain&&x.style.map.terrain.getTerrainData(Be.coord),h.id,Re,ze,a.a0.simpleSegment(0,2*Be.circleOffset,Be.circleArray.length,Be.circleArray.length/2),null,x.transform.zoom,null,null,null)}Re.destroy(),ze.destroy()}vr.disabled=new vr(!1,1029,2305),vr.backCCW=new vr(!0,1029,2305);const Ka=a.an(new Float32Array(16));function yc(x,s,h,g,y,w){const{horizontalAlign:E,verticalAlign:B}=a.au(x);return new a.P((-(E-.5)*s/y+g[0])*w,(-(B-.5)*h/y+g[1])*w)}function Fs(x,s,h,g,y,w){const E=s.tileAnchorPoint.add(new a.P(s.translation[0],s.translation[1]));if(s.pitchWithMap){let B=g.mult(w);h||(B=B.rotate(-y));const j=E.add(B);return Ce(j.x,j.y,s.labelPlaneMatrix,s.getElevation).point}if(h){const B=ut(s.tileAnchorPoint.x+1,s.tileAnchorPoint.y,s).point.sub(x),j=Math.atan(B.y/B.x)+(B.x<0?Math.PI:0);return x.add(g.rotate(j))}return x.add(g)}function aa(x,s,h,g,y,w,E,B,j,Y,re,ie,_e,Ae){const Se=x.text.placedSymbolArray,ze=x.text.dynamicLayoutVertexArray,Re=x.icon.dynamicLayoutVertexArray,Be={};ze.clear();for(let $e=0;$e<Se.length;$e++){const Ie=Se.get($e),qe=Ie.hidden||!Ie.crossTileID||x.allowVerticalPlacement&&!Ie.placedOrientation?null:g[Ie.crossTileID];if(qe){const We=new a.P(Ie.anchorX,Ie.anchorY),nt={getElevation:Ae,width:y.width,height:y.height,labelPlaneMatrix:w,pitchWithMap:h,projection:re,tileAnchorPoint:We,translation:ie,unwrappedTileID:_e},bt=h?Ce(We.x,We.y,E,Ae):ut(We.x,We.y,nt),Pt=oe(y.cameraToCenterDistance,bt.signedDistanceFromCamera);let Vt=a.ai(x.textSizeData,j,Ie)*Pt/a.ap;h&&(Vt*=x.tilePixelRatio/B);const{width:Jt,height:Ot,anchor:Bt,textOffset:ln,textBoxScale:In}=qe,jt=yc(Bt,Jt,Ot,ln,In,Vt),Wt=re.getPitchedTextCorrection(y,We.add(new a.P(ie[0],ie[1])),_e),Mn=Fs(bt.point,nt,s,jt,y.angle,Wt),Dr=x.allowVerticalPlacement&&Ie.placedOrientation===a.ah.vertical?Math.PI/2:0;for(let $n=0;$n<Ie.numGlyphs;$n++)a.aj(ze,Mn,Dr);Y&&Ie.associatedIconIndex>=0&&(Be[Ie.associatedIconIndex]={shiftedAnchor:Mn,angle:Dr})}else mn(Ie.numGlyphs,ze)}if(Y){Re.clear();const $e=x.icon.placedSymbolArray;for(let Ie=0;Ie<$e.length;Ie++){const qe=$e.get(Ie);if(qe.hidden)mn(qe.numGlyphs,Re);else{const We=Be[Ie];if(We)for(let nt=0;nt<qe.numGlyphs;nt++)a.aj(Re,We.shiftedAnchor,We.angle);else mn(qe.numGlyphs,Re)}}x.icon.dynamicLayoutVertexBuffer.updateData(Re)}x.text.dynamicLayoutVertexBuffer.updateData(ze)}function eo(x,s,h){return h.iconsInText&&s?"symbolTextAndIcon":x?"symbolSDF":"symbolIcon"}function bc(x,s,h,g,y,w,E,B,j,Y,re,ie){const _e=x.context,Ae=_e.gl,Se=x.transform,ze=Hi(),Re=B==="map",Be=j==="map",$e=B!=="viewport"&&h.layout.get("symbol-placement")!=="point",Ie=Re&&!Be&&!$e,qe=!Be&&$e,We=!h.layout.get("symbol-sort-key").isConstant();let nt=!1;const bt=x.depthModeForSublayer(0,Vn.ReadOnly),Pt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Vt=[],Jt=ze.getCircleRadiusCorrection(Se);for(const Ot of g){const Bt=s.getTile(Ot),ln=Bt.getBucket(h);if(!ln)continue;const In=y?ln.text:ln.icon;if(!In||!In.segments.get().length||!In.hasVisibleVertices)continue;const jt=In.programConfigurations.get(h.id),Wt=y||ln.sdfIcons,Mn=y?ln.textSizeData:ln.iconSizeData,Dr=Be||Se.pitch!==0,$n=x.useProgram(eo(Wt,y,ln),jt),Hn=a.ag(Mn,Se.zoom),Rr=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Ot);let wi,wo,Br,$i,Li=[0,0],xi=null;if(y)wo=Bt.glyphAtlasTexture,Br=Ae.LINEAR,wi=Bt.glyphAtlasTexture.size,ln.iconsInText&&(Li=Bt.imageAtlasTexture.size,xi=Bt.imageAtlasTexture,$i=Dr||x.options.rotating||x.options.zooming||Mn.kind==="composite"||Mn.kind==="camera"?Ae.LINEAR:Ae.NEAREST);else{const Jn=h.layout.get("icon-size").constantOr(0)!==1||ln.iconsNeedLinear;wo=Bt.imageAtlasTexture,Br=Wt||x.options.rotating||x.options.zooming||Jn||Dr?Ae.LINEAR:Ae.NEAREST,wi=Bt.imageAtlasTexture.size}const Pi=Un(Bt,1,x.transform.zoom),$o=qe?Ot.posMatrix:Ka,xa=Gr($o,Be,Re,x.transform,Pi),lu=br($o,Be,Re,x.transform,Pi),Aa=br(Ot.posMatrix,Be,Re,x.transform,Pi),ro=ze.translatePosition(x.transform,Bt,w,E),uu=Pt&&ln.hasTextData(),qc=h.layout.get("icon-text-fit")!=="none"&&uu&&ln.hasIconData();if($e){const Jn=x.style.map.terrain?(ka,Sa)=>x.style.map.terrain.getElevation(Ot,ka,Sa):null,Us=h.layout.get("text-rotation-alignment")==="map";we(ln,Ot.posMatrix,x,y,xa,Aa,Be,Y,Us,ze,Ot.toUnwrapped(),Se.width,Se.height,ro,Jn)}const io=Ot.posMatrix,oo=y&&Pt||qc,_s=$e||oo?Ka:xa,xo=lu,mi=Wt&&h.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ai;Ai=Wt?ln.iconsInText?ac(Mn.kind,Hn,Ie,Be,$e,oo,x,io,_s,xo,ro,wi,Li,Jt):Wa(Mn.kind,Hn,Ie,Be,$e,oo,x,io,_s,xo,ro,y,wi,!0,Jt):mh(Mn.kind,Hn,Ie,Be,$e,oo,x,io,_s,xo,ro,y,wi,Jt);const Ji={program:$n,buffers:In,uniformValues:Ai,atlasTexture:wo,atlasTextureIcon:xi,atlasInterpolation:Br,atlasInterpolationIcon:$i,isSDF:Wt,hasHalo:mi};if(We&&ln.canOverlap){nt=!0;const Jn=In.segments.get();for(const Us of Jn)Vt.push({segments:new a.a0([Us]),sortKey:Us.sortKey,state:Ji,terrainData:Rr})}else Vt.push({segments:In.segments,sortKey:0,state:Ji,terrainData:Rr})}nt&&Vt.sort((Ot,Bt)=>Ot.sortKey-Bt.sortKey);for(const Ot of Vt){const Bt=Ot.state;if(_e.activeTexture.set(Ae.TEXTURE0),Bt.atlasTexture.bind(Bt.atlasInterpolation,Ae.CLAMP_TO_EDGE),Bt.atlasTextureIcon&&(_e.activeTexture.set(Ae.TEXTURE1),Bt.atlasTextureIcon&&Bt.atlasTextureIcon.bind(Bt.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE)),Bt.isSDF){const ln=Bt.uniformValues;Bt.hasHalo&&(ln.u_is_halo=1,vc(Bt.buffers,Ot.segments,h,x,Bt.program,bt,re,ie,ln,Ot.terrainData)),ln.u_is_halo=0}vc(Bt.buffers,Ot.segments,h,x,Bt.program,bt,re,ie,Bt.uniformValues,Ot.terrainData)}}function vc(x,s,h,g,y,w,E,B,j,Y){const re=g.context;y.draw(re,re.gl.TRIANGLES,w,E,B,vr.disabled,j,Y,h.id,x.layoutVertexBuffer,x.indexBuffer,s,h.paint,g.transform.zoom,x.programConfigurations.get(h.id),x.dynamicLayoutVertexBuffer,x.opacityVertexBuffer)}function wc(x,s,h,g){const y=x.context,w=y.gl,E=Ir.disabled,B=new Hr([w.ONE,w.ONE],a.aM.transparent,[!0,!0,!0,!0]),j=s.getBucket(h);if(!j)return;const Y=g.key;let re=h.heatmapFbos.get(Y);re||(re=Ya(y,s.tileSize,s.tileSize),h.heatmapFbos.set(Y,re)),y.bindFramebuffer.set(re.framebuffer),y.viewport.set([0,0,s.tileSize,s.tileSize]),y.clear({color:a.aM.transparent});const ie=j.programConfigurations.get(h.id),_e=x.useProgram("heatmap",ie),Ae=x.style.map.terrain.getTerrainData(g);_e.draw(y,w.TRIANGLES,Vn.disabled,E,B,vr.disabled,Ni(g.posMatrix,s,x.transform.zoom,h.paint.get("heatmap-intensity")),Ae,h.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,h.paint,x.transform.zoom,ie)}function Os(x,s,h){const g=x.context,y=g.gl;g.setColorMode(x.colorModeForRenderPass());const w=Qa(g,s),E=h.key,B=s.heatmapFbos.get(E);B&&(g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,B.colorAttachment.get()),g.activeTexture.set(y.TEXTURE1),w.bind(y.LINEAR,y.CLAMP_TO_EDGE),x.useProgram("heatmapTexture").draw(g,y.TRIANGLES,Vn.disabled,Ir.disabled,x.colorModeForRenderPass(),vr.disabled,Rl(x,s,0,1),null,s.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments,s.paint,x.transform.zoom),B.destroy(),s.heatmapFbos.delete(E))}function Ya(x,s,h){var g,y;const w=x.gl,E=w.createTexture();w.bindTexture(w.TEXTURE_2D,E),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MIN_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_2D,w.TEXTURE_MAG_FILTER,w.LINEAR);const B=(g=x.HALF_FLOAT)!==null&&g!==void 0?g:w.UNSIGNED_BYTE,j=(y=x.RGBA16F)!==null&&y!==void 0?y:w.RGBA;w.texImage2D(w.TEXTURE_2D,0,j,s,h,0,w.RGBA,B,null);const Y=x.createFramebuffer(s,h,!1,!1);return Y.colorAttachment.set(E),Y}function Qa(x,s){return s.colorRampTexture||(s.colorRampTexture=new F(x,s.colorRamp,x.gl.RGBA)),s.colorRampTexture}function la(x,s,h,g,y){if(!h||!g||!g.imageAtlas)return;const w=g.imageAtlas.patternPositions;let E=w[h.to.toString()],B=w[h.from.toString()];if(!E&&B&&(E=B),!B&&E&&(B=E),!E||!B){const j=y.getPaintProperty(s);E=w[j],B=w[j]}E&&B&&x.setConstantPatternPositions(E,B)}function el(x,s,h,g,y,w,E){const B=x.context.gl,j="fill-pattern",Y=h.paint.get(j),re=Y&&Y.constantOr(1),ie=h.getCrossfadeParameters();let _e,Ae,Se,ze,Re;E?(Ae=re&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",_e=B.LINES):(Ae=re?"fillPattern":"fill",_e=B.TRIANGLES);const Be=Y.constantOr(null);for(const $e of g){const Ie=s.getTile($e);if(re&&!Ie.patternsLoaded())continue;const qe=Ie.getBucket(h);if(!qe)continue;const We=qe.programConfigurations.get(h.id),nt=x.useProgram(Ae,We),bt=x.style.map.terrain&&x.style.map.terrain.getTerrainData($e);re&&(x.context.activeTexture.set(B.TEXTURE0),Ie.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),We.updatePaintBuffers(ie)),la(We,j,Be,Ie,h);const Pt=bt?$e:null,Vt=x.translatePosMatrix(Pt?Pt.posMatrix:$e.posMatrix,Ie,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(E){ze=qe.indexBuffer2,Re=qe.segments2;const Jt=[B.drawingBufferWidth,B.drawingBufferHeight];Se=Ae==="fillOutlinePattern"&&re?fh(Vt,x,ie,Ie,Jt):fp(Vt,Jt)}else ze=qe.indexBuffer,Re=qe.segments,Se=re?ch(Vt,x,ie,Ie):ia(Vt);nt.draw(x.context,_e,y,x.stencilModeForClipping($e),w,vr.disabled,Se,bt,h.id,qe.layoutVertexBuffer,ze,Re,h.paint,x.transform.zoom,We)}}function ql(x,s,h,g,y,w,E){const B=x.context,j=B.gl,Y="fill-extrusion-pattern",re=h.paint.get(Y),ie=re.constantOr(1),_e=h.getCrossfadeParameters(),Ae=h.paint.get("fill-extrusion-opacity"),Se=re.constantOr(null);for(const ze of g){const Re=s.getTile(ze),Be=Re.getBucket(h);if(!Be)continue;const $e=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ze),Ie=Be.programConfigurations.get(h.id),qe=x.useProgram(ie?"fillExtrusionPattern":"fillExtrusion",Ie);ie&&(x.context.activeTexture.set(j.TEXTURE0),Re.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Ie.updatePaintBuffers(_e)),la(Ie,Y,Se,Re,h);const We=x.translatePosMatrix(ze.posMatrix,Re,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),nt=h.paint.get("fill-extrusion-vertical-gradient"),bt=ie?Dl(We,x,nt,Ae,ze,_e,Re):Za(We,x,nt,Ae);qe.draw(B,B.gl.TRIANGLES,y,w,E,vr.backCCW,bt,$e,h.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,h.paint,x.transform.zoom,Ie,x.style.map.terrain&&Be.centroidVertexBuffer)}}function ua(x,s,h,g,y,w,E){const B=x.context,j=B.gl,Y=h.fbo;if(!Y)return;const re=x.useProgram("hillshade"),ie=x.style.map.terrain&&x.style.map.terrain.getTerrainData(s);B.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,Y.colorAttachment.get()),re.draw(B,j.TRIANGLES,y,w,E,vr.disabled,((_e,Ae,Se,ze)=>{const Re=Se.paint.get("hillshade-shadow-color"),Be=Se.paint.get("hillshade-highlight-color"),$e=Se.paint.get("hillshade-accent-color");let Ie=Se.paint.get("hillshade-illumination-direction")*(Math.PI/180);Se.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ie-=_e.transform.angle);const qe=!_e.options.moving;return{u_matrix:ze?ze.posMatrix:_e.transform.calculatePosMatrix(Ae.tileID.toUnwrapped(),qe),u_image:0,u_latrange:Bl(0,Ae.tileID),u_light:[Se.paint.get("hillshade-exaggeration"),Ie],u_shadow:Re,u_highlight:Be,u_accent:$e}})(x,h,g,ie?s:null),ie,g.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}function ca(x,s,h,g,y,w){const E=x.context,B=E.gl,j=s.dem;if(j&&j.data){const Y=j.dim,re=j.stride,ie=j.getPixels();if(E.activeTexture.set(B.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||x.getTileTexture(re),s.demTexture){const Ae=s.demTexture;Ae.update(ie,{premultiply:!1}),Ae.bind(B.NEAREST,B.CLAMP_TO_EDGE)}else s.demTexture=new F(E,ie,B.RGBA,{premultiply:!1}),s.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);E.activeTexture.set(B.TEXTURE0);let _e=s.fbo;if(!_e){const Ae=new F(E,{width:Y,height:Y,data:null},B.RGBA);Ae.bind(B.LINEAR,B.CLAMP_TO_EDGE),_e=s.fbo=E.createFramebuffer(Y,Y,!0,!1),_e.colorAttachment.set(Ae.texture)}E.bindFramebuffer.set(_e.framebuffer),E.viewport.set([0,0,Y,Y]),x.useProgram("hillshadePrepare").draw(E,B.TRIANGLES,g,y,w,vr.disabled,((Ae,Se)=>{const ze=Se.stride,Re=a.H();return a.aP(Re,0,a.X,-a.X,0,0,1),a.J(Re,Re,[0,-a.X,0]),{u_matrix:Re,u_image:1,u_dimension:[ze,ze],u_zoom:Ae.overscaledZ,u_unpack:Se.getUnpackVector()}})(s.tileID,j),null,h.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Mh(x,s,h,g,y,w){const E=g.paint.get("raster-fade-duration");if(!w&&E>0){const B=v.now(),j=(B-x.timeAdded)/E,Y=s?(B-s.timeAdded)/E:-1,re=h.getSource(),ie=y.coveringZoomLevel({tileSize:re.tileSize,roundZoom:re.roundZoom}),_e=!s||Math.abs(s.tileID.overscaledZ-ie)>Math.abs(x.tileID.overscaledZ-ie),Ae=_e&&x.refreshedUponExpiration?1:a.ac(_e?j:1-Y,0,1);return x.refreshedUponExpiration&&j>=1&&(x.refreshedUponExpiration=!1),s?{opacity:1,mix:1-Ae}:{opacity:Ae,mix:0}}return{opacity:1,mix:0}}const xc=new a.aM(1,0,0,1),sr=new a.aM(0,1,0,1),Gl=new a.aM(0,0,1,1),Tp=new a.aM(1,0,1,1),Eh=new a.aM(0,1,1,1);function fa(x,s,h,g){Zl(x,0,s+h/2,x.transform.width,h,g)}function Ih(x,s,h,g){Zl(x,s-h/2,0,h,x.transform.height,g)}function Zl(x,s,h,g,y,w){const E=x.context,B=E.gl;B.enable(B.SCISSOR_TEST),B.scissor(s*x.pixelRatio,h*x.pixelRatio,g*x.pixelRatio,y*x.pixelRatio),E.clear({color:w}),B.disable(B.SCISSOR_TEST)}function Lh(x,s,h){const g=x.context,y=g.gl,w=h.posMatrix,E=x.useProgram("debug"),B=Vn.disabled,j=Ir.disabled,Y=x.colorModeForRenderPass(),re="$debug",ie=x.style.map.terrain&&x.style.map.terrain.getTerrainData(h);g.activeTexture.set(y.TEXTURE0);const _e=s.getTileByID(h.key).latestRawTileData,Ae=Math.floor((_e&&_e.byteLength||0)/1024),Se=s.getTile(h).tileSize,ze=512/Math.min(Se,512)*(h.overscaledZ/x.transform.zoom)*.5;let Re=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Re+=` => ${h.overscaledZ}`),function(Be,$e){Be.initDebugOverlayCanvas();const Ie=Be.debugOverlayCanvas,qe=Be.context.gl,We=Be.debugOverlayCanvas.getContext("2d");We.clearRect(0,0,Ie.width,Ie.height),We.shadowColor="white",We.shadowBlur=2,We.lineWidth=1.5,We.strokeStyle="white",We.textBaseline="top",We.font="bold 36px Open Sans, sans-serif",We.fillText($e,5,5),We.strokeText($e,5,5),Be.debugOverlayTexture.update(Ie),Be.debugOverlayTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE)}(x,`${Re} ${Ae}kB`),E.draw(g,y.TRIANGLES,B,j,Hr.alphaBlended,vr.disabled,Ha(w,a.aM.transparent,ze),null,re,x.debugBuffer,x.quadTriangleIndexBuffer,x.debugSegments),E.draw(g,y.LINE_STRIP,B,j,Y,vr.disabled,Ha(w,a.aM.red),ie,re,x.debugBuffer,x.tileBorderIndexBuffer,x.debugSegments)}function Ph(x,s,h){const g=x.context,y=g.gl,w=x.colorModeForRenderPass(),E=new Vn(y.LEQUAL,Vn.ReadWrite,x.depthRangeFor3D),B=x.useProgram("terrain"),j=s.getTerrainMesh();g.bindFramebuffer.set(null),g.viewport.set([0,0,x.width,x.height]);for(const Y of h){const re=x.renderToTexture.getTexture(Y),ie=s.getTerrainData(Y.tileID);g.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,re.texture);const _e=x.transform.calculatePosMatrix(Y.tileID.toUnwrapped()),Ae=s.getMeshFrameDelta(x.transform.zoom),Se=x.transform.calculateFogMatrix(Y.tileID.toUnwrapped()),ze=oc(_e,Ae,Se,x.style.sky,x.transform.pitch);B.draw(g,y.TRIANGLES,E,Ir.disabled,w,vr.backCCW,ze,ie,"terrain",j.vertexBuffer,j.indexBuffer,j.segments)}}class Hl{constructor(s,h,g){this.vertexBuffer=s,this.indexBuffer=h,this.segments=g}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Wl{constructor(s,h){this.context=new Sp(s),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:a.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=pt.maxUnderzooming+pt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new rc}resize(s,h,g){if(this.width=Math.floor(s*g),this.height=Math.floor(h*g),this.pixelRatio=g,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style._order)this.style._layers[y].resize()}setup(){const s=this.context,h=new a.aX;h.emplaceBack(0,0),h.emplaceBack(a.X,0),h.emplaceBack(0,a.X),h.emplaceBack(a.X,a.X),this.tileExtentBuffer=s.createVertexBuffer(h,Ls.members),this.tileExtentSegments=a.a0.simpleSegment(0,0,4,2);const g=new a.aX;g.emplaceBack(0,0),g.emplaceBack(a.X,0),g.emplaceBack(0,a.X),g.emplaceBack(a.X,a.X),this.debugBuffer=s.createVertexBuffer(g,Ls.members),this.debugSegments=a.a0.simpleSegment(0,0,4,5);const y=new a.$;y.emplaceBack(0,0,0,0),y.emplaceBack(a.X,0,a.X,0),y.emplaceBack(0,a.X,0,a.X),y.emplaceBack(a.X,a.X,a.X,a.X),this.rasterBoundsBuffer=s.createVertexBuffer(y,Rn.members),this.rasterBoundsSegments=a.a0.simpleSegment(0,0,4,2);const w=new a.aX;w.emplaceBack(0,0),w.emplaceBack(1,0),w.emplaceBack(0,1),w.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(w,Ls.members),this.viewportSegments=a.a0.simpleSegment(0,0,4,2);const E=new a.aZ;E.emplaceBack(0),E.emplaceBack(1),E.emplaceBack(3),E.emplaceBack(2),E.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(E);const B=new a.aY;B.emplaceBack(0,1,2),B.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(B);const j=this.context.gl;this.stencilClearMode=new Ir({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO)}clearStencil(){const s=this.context,h=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const g=a.H();a.aP(g,0,this.width,this.height,0,0,1),a.K(g,g,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,h.TRIANGLES,Vn.disabled,this.stencilClearMode,Hr.disabled,vr.disabled,Oi(g),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,h){if(this.currentStencilSource===s.source||!s.isTileClipped()||!h||!h.length)return;this.currentStencilSource=s.source;const g=this.context,y=g.gl;this.nextStencilID+h.length>256&&this.clearStencil(),g.setColorMode(Hr.disabled),g.setDepthMode(Vn.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const E of h){const B=this._tileClippingMaskIDs[E.key]=this.nextStencilID++,j=this.style.map.terrain&&this.style.map.terrain.getTerrainData(E);w.draw(g,y.TRIANGLES,Vn.disabled,new Ir({func:y.ALWAYS,mask:0},B,255,y.KEEP,y.KEEP,y.REPLACE),Hr.disabled,vr.disabled,Oi(E.posMatrix),j,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,h=this.context.gl;return new Ir({func:h.NOTEQUAL,mask:255},s,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(s){const h=this.context.gl;return new Ir({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(s){const h=this.context.gl,g=s.sort((E,B)=>B.overscaledZ-E.overscaledZ),y=g[g.length-1].overscaledZ,w=g[0].overscaledZ-y+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const E={};for(let B=0;B<w;B++)E[B+y]=new Ir({func:h.GEQUAL,mask:255},B+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=w,[E,g]}return[{[y]:Ir.disabled},g]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new Hr([s.CONSTANT_COLOR,s.ONE],new a.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Hr.unblended:Hr.alphaBlended}depthModeForSublayer(s,h,g){if(!this.opaquePassEnabledForLayer())return Vn.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new Vn(g||this.context.gl.LEQUAL,h,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,h){this.style=s,this.options=h,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(v.now()),this.imageManager.beginFrame();const g=this.style._order,y=this.style.sourceCaches,w={},E={},B={};for(const j in y){const Y=y[j];Y.used&&Y.prepare(this.context),w[j]=Y.getVisibleCoordinates(),E[j]=w[j].slice().reverse(),B[j]=Y.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<g.length;j++)if(this.style._layers[g[j]].is3D()){this.opaquePassCutoff=j;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const j of g){const Y=this.style._layers[j];if(!Y.hasOffscreenPass()||Y.isHidden(this.transform.zoom))continue;const re=E[Y.source];(Y.type==="custom"||re.length)&&this.renderLayer(this,y[Y.source],Y,re)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?a.aM.black:a.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(j,Y){const re=j.context,ie=re.gl,_e=((Be,$e,Ie)=>({u_sky_color:Be.properties.get("sky-color"),u_horizon_color:Be.properties.get("horizon-color"),u_horizon:($e.height/2+$e.getHorizon())*Ie,u_sky_horizon_blend:Be.properties.get("sky-horizon-blend")*$e.height/2*Ie}))(Y,j.style.map.transform,j.pixelRatio),Ae=new Vn(ie.LEQUAL,Vn.ReadWrite,[0,1]),Se=Ir.disabled,ze=j.colorModeForRenderPass(),Re=j.useProgram("sky");if(!Y.mesh){const Be=new a.aX;Be.emplaceBack(-1,-1),Be.emplaceBack(1,-1),Be.emplaceBack(1,1),Be.emplaceBack(-1,1);const $e=new a.aY;$e.emplaceBack(0,1,2),$e.emplaceBack(0,2,3),Y.mesh=new Hl(re.createVertexBuffer(Be,Ls.members),re.createIndexBuffer($e),a.a0.simpleSegment(0,0,Be.length,$e.length))}Re.draw(re,ie.TRIANGLES,Ae,Se,ze,vr.disabled,_e,void 0,"sky",Y.mesh.vertexBuffer,Y.mesh.indexBuffer,Y.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[g[this.currentLayer]],Y=y[j.source],re=w[j.source];this._renderTileClippingMasks(j,re),this.renderLayer(this,Y,j,re)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const j=this.style._layers[g[this.currentLayer]],Y=y[j.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(j))continue;const re=(j.type==="symbol"?B:E)[j.source];this._renderTileClippingMasks(j,w[j.source]),this.renderLayer(this,Y,j,re)}if(this.options.showTileBoundaries){const j=function(Y,re){let ie=null;const _e=Object.values(Y._layers).flatMap(Re=>Re.source&&!Re.isHidden(re)?[Y.sourceCaches[Re.source]]:[]),Ae=_e.filter(Re=>Re.getSource().type==="vector"),Se=_e.filter(Re=>Re.getSource().type!=="vector"),ze=Re=>{(!ie||ie.getSource().maxzoom<Re.getSource().maxzoom)&&(ie=Re)};return Ae.forEach(Re=>ze(Re)),ie||Se.forEach(Re=>ze(Re)),ie}(this.style,this.transform.zoom);j&&function(Y,re,ie){for(let _e=0;_e<ie.length;_e++)Lh(Y,re,ie[_e])}(this,j,j.getVisibleCoordinates())}this.options.showPadding&&function(j){const Y=j.transform.padding;fa(j,j.transform.height-(Y.top||0),3,xc),fa(j,Y.bottom||0,3,sr),Ih(j,Y.left||0,3,Gl),Ih(j,j.transform.width-(Y.right||0),3,Tp);const re=j.transform.centerPoint;(function(ie,_e,Ae,Se){Zl(ie,_e-1,Ae-10,2,20,Se),Zl(ie,_e-10,Ae-1,20,2,Se)})(j,re.x,j.transform.height-re.y,Eh)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,g=this.transform.modelViewProjectionMatrix;let y=this.terrainFacilitator.dirty;y||(y=s?!a.a_(h,g):!a.a$(h,g)),y||(y=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),y&&(a.b0(h,g),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(w,E){const B=w.context,j=B.gl,Y=Hr.unblended,re=new Vn(j.LEQUAL,Vn.ReadWrite,[0,1]),ie=E.getTerrainMesh(),_e=E.sourceCache.getRenderableTiles(),Ae=w.useProgram("terrainDepth");B.bindFramebuffer.set(E.getFramebuffer("depth").framebuffer),B.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),B.clear({color:a.aM.transparent,depth:1});for(const Se of _e){const ze=E.getTerrainData(Se.tileID),Re={u_matrix:w.transform.calculatePosMatrix(Se.tileID.toUnwrapped()),u_ele_delta:E.getMeshFrameDelta(w.transform.zoom)};Ae.draw(B,j.TRIANGLES,re,Ir.disabled,Y,vr.backCCW,Re,ze,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments)}B.bindFramebuffer.set(null),B.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain),function(w,E){const B=w.context,j=B.gl,Y=Hr.unblended,re=new Vn(j.LEQUAL,Vn.ReadWrite,[0,1]),ie=E.getTerrainMesh(),_e=E.getCoordsTexture(),Ae=E.sourceCache.getRenderableTiles(),Se=w.useProgram("terrainCoords");B.bindFramebuffer.set(E.getFramebuffer("coords").framebuffer),B.viewport.set([0,0,w.width/devicePixelRatio,w.height/devicePixelRatio]),B.clear({color:a.aM.transparent,depth:1}),E.coordsIndex=[];for(const ze of Ae){const Re=E.getTerrainData(ze.tileID);B.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,_e.texture);const Be={u_matrix:w.transform.calculatePosMatrix(ze.tileID.toUnwrapped()),u_terrain_coords_id:(255-E.coordsIndex.length)/255,u_texture:0,u_ele_delta:E.getMeshFrameDelta(w.transform.zoom)};Se.draw(B,j.TRIANGLES,re,Ir.disabled,Y,vr.backCCW,Be,Re,"terrain",ie.vertexBuffer,ie.indexBuffer,ie.segments),E.coordsIndex.push(ze.tileID.key)}B.bindFramebuffer.set(null),B.viewport.set([0,0,w.width,w.height])}(this,this.style.map.terrain))}renderLayer(s,h,g,y){if(!g.isHidden(this.transform.zoom)&&(g.type==="background"||g.type==="custom"||(y||[]).length))switch(this.id=g.id,g.type){case"symbol":(function(w,E,B,j,Y){if(w.renderPass!=="translucent")return;const re=Ir.disabled,ie=w.colorModeForRenderPass();(B._unevaluatedLayout.hasValue("text-variable-anchor")||B._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(_e,Ae,Se,ze,Re,Be,$e,Ie,qe){const We=Ae.transform,nt=Hi(),bt=Re==="map",Pt=Be==="map";for(const Vt of _e){const Jt=ze.getTile(Vt),Ot=Jt.getBucket(Se);if(!Ot||!Ot.text||!Ot.text.segments.get().length)continue;const Bt=a.ag(Ot.textSizeData,We.zoom),ln=Un(Jt,1,Ae.transform.zoom),In=Gr(Vt.posMatrix,Pt,bt,Ae.transform,ln),jt=Se.layout.get("icon-text-fit")!=="none"&&Ot.hasIconData();if(Bt){const Wt=Math.pow(2,We.zoom-Jt.tileID.overscaledZ),Mn=Ae.style.map.terrain?($n,Hn)=>Ae.style.map.terrain.getElevation(Vt,$n,Hn):null,Dr=nt.translatePosition(We,Jt,$e,Ie);aa(Ot,bt,Pt,qe,We,In,Vt.posMatrix,Wt,Bt,jt,nt,Dr,Vt.toUnwrapped(),Mn)}}}(j,w,B,E,B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),Y),B.paint.get("icon-opacity").constantOr(1)!==0&&bc(w,E,B,j,!1,B.paint.get("icon-translate"),B.paint.get("icon-translate-anchor"),B.layout.get("icon-rotation-alignment"),B.layout.get("icon-pitch-alignment"),B.layout.get("icon-keep-upright"),re,ie),B.paint.get("text-opacity").constantOr(1)!==0&&bc(w,E,B,j,!0,B.paint.get("text-translate"),B.paint.get("text-translate-anchor"),B.layout.get("text-rotation-alignment"),B.layout.get("text-pitch-alignment"),B.layout.get("text-keep-upright"),re,ie),E.map.showCollisionBoxes&&(Ja(w,E,B,j,!0),Ja(w,E,B,j,!1))})(s,h,g,y,this.style.placement.variableOffsets);break;case"circle":(function(w,E,B,j){if(w.renderPass!=="translucent")return;const Y=B.paint.get("circle-opacity"),re=B.paint.get("circle-stroke-width"),ie=B.paint.get("circle-stroke-opacity"),_e=!B.layout.get("circle-sort-key").isConstant();if(Y.constantOr(1)===0&&(re.constantOr(1)===0||ie.constantOr(1)===0))return;const Ae=w.context,Se=Ae.gl,ze=w.depthModeForSublayer(0,Vn.ReadOnly),Re=Ir.disabled,Be=w.colorModeForRenderPass(),$e=[];for(let Ie=0;Ie<j.length;Ie++){const qe=j[Ie],We=E.getTile(qe),nt=We.getBucket(B);if(!nt)continue;const bt=nt.programConfigurations.get(B.id),Pt=w.useProgram("circle",bt),Vt=nt.layoutVertexBuffer,Jt=nt.indexBuffer,Ot=w.style.map.terrain&&w.style.map.terrain.getTerrainData(qe),Bt={programConfiguration:bt,program:Pt,layoutVertexBuffer:Vt,indexBuffer:Jt,uniformValues:hp(w,qe,We,B),terrainData:Ot};if(_e){const ln=nt.segments.get();for(const In of ln)$e.push({segments:new a.a0([In]),sortKey:In.sortKey,state:Bt})}else $e.push({segments:nt.segments,sortKey:0,state:Bt})}_e&&$e.sort((Ie,qe)=>Ie.sortKey-qe.sortKey);for(const Ie of $e){const{programConfiguration:qe,program:We,layoutVertexBuffer:nt,indexBuffer:bt,uniformValues:Pt,terrainData:Vt}=Ie.state;We.draw(Ae,Se.TRIANGLES,ze,Re,Be,vr.disabled,Pt,Vt,B.id,nt,bt,Ie.segments,B.paint,w.transform.zoom,qe)}})(s,h,g,y);break;case"heatmap":(function(w,E,B,j){if(B.paint.get("heatmap-opacity")===0)return;const Y=w.context;if(w.style.map.terrain){for(const re of j){const ie=E.getTile(re);E.hasRenderableParent(re)||(w.renderPass==="offscreen"?wc(w,ie,B,re):w.renderPass==="translucent"&&Os(w,B,re))}Y.viewport.set([0,0,w.width,w.height])}else w.renderPass==="offscreen"?function(re,ie,_e,Ae){const Se=re.context,ze=Se.gl,Re=Ir.disabled,Be=new Hr([ze.ONE,ze.ONE],a.aM.transparent,[!0,!0,!0,!0]);(function($e,Ie,qe){const We=$e.gl;$e.activeTexture.set(We.TEXTURE1),$e.viewport.set([0,0,Ie.width/4,Ie.height/4]);let nt=qe.heatmapFbos.get(a.aU);nt?(We.bindTexture(We.TEXTURE_2D,nt.colorAttachment.get()),$e.bindFramebuffer.set(nt.framebuffer)):(nt=Ya($e,Ie.width/4,Ie.height/4),qe.heatmapFbos.set(a.aU,nt))})(Se,re,_e),Se.clear({color:a.aM.transparent});for(let $e=0;$e<Ae.length;$e++){const Ie=Ae[$e];if(ie.hasRenderableParent(Ie))continue;const qe=ie.getTile(Ie),We=qe.getBucket(_e);if(!We)continue;const nt=We.programConfigurations.get(_e.id),bt=re.useProgram("heatmap",nt),{zoom:Pt}=re.transform;bt.draw(Se,ze.TRIANGLES,Vn.disabled,Re,Be,vr.disabled,Ni(Ie.posMatrix,qe,Pt,_e.paint.get("heatmap-intensity")),null,_e.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,_e.paint,re.transform.zoom,nt)}Se.viewport.set([0,0,re.width,re.height])}(w,E,B,j):w.renderPass==="translucent"&&function(re,ie){const _e=re.context,Ae=_e.gl;_e.setColorMode(re.colorModeForRenderPass());const Se=ie.heatmapFbos.get(a.aU);Se&&(_e.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,Se.colorAttachment.get()),_e.activeTexture.set(Ae.TEXTURE1),Qa(_e,ie).bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),re.useProgram("heatmapTexture").draw(_e,Ae.TRIANGLES,Vn.disabled,Ir.disabled,re.colorModeForRenderPass(),vr.disabled,Rl(re,ie,0,1),null,ie.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments,ie.paint,re.transform.zoom))}(w,B)})(s,h,g,y);break;case"line":(function(w,E,B,j){if(w.renderPass!=="translucent")return;const Y=B.paint.get("line-opacity"),re=B.paint.get("line-width");if(Y.constantOr(1)===0||re.constantOr(1)===0)return;const ie=w.depthModeForSublayer(0,Vn.ReadOnly),_e=w.colorModeForRenderPass(),Ae=B.paint.get("line-dasharray"),Se=B.paint.get("line-pattern"),ze=Se.constantOr(1),Re=B.paint.get("line-gradient"),Be=B.getCrossfadeParameters(),$e=ze?"linePattern":Ae?"lineSDF":Re?"lineGradient":"line",Ie=w.context,qe=Ie.gl;let We=!0;for(const nt of j){const bt=E.getTile(nt);if(ze&&!bt.patternsLoaded())continue;const Pt=bt.getBucket(B);if(!Pt)continue;const Vt=Pt.programConfigurations.get(B.id),Jt=w.context.program.get(),Ot=w.useProgram($e,Vt),Bt=We||Ot.program!==Jt,ln=w.style.map.terrain&&w.style.map.terrain.getTerrainData(nt),In=Se.constantOr(null);if(In&&bt.imageAtlas){const Mn=bt.imageAtlas,Dr=Mn.patternPositions[In.to.toString()],$n=Mn.patternPositions[In.from.toString()];Dr&&$n&&Vt.setConstantPatternPositions(Dr,$n)}const jt=ln?nt:null,Wt=ze?oa(w,bt,B,Be,jt):Ae?dp(w,bt,B,Ae,Be,jt):Re?hh(w,bt,B,Pt.lineClipsArray.length,jt):Fl(w,bt,B,jt);if(ze)Ie.activeTexture.set(qe.TEXTURE0),bt.imageAtlasTexture.bind(qe.LINEAR,qe.CLAMP_TO_EDGE),Vt.updatePaintBuffers(Be);else if(Ae&&(Bt||w.lineAtlas.dirty))Ie.activeTexture.set(qe.TEXTURE0),w.lineAtlas.bind(Ie);else if(Re){const Mn=Pt.gradients[B.id];let Dr=Mn.texture;if(B.gradientVersion!==Mn.version){let $n=256;if(B.stepInterpolant){const Hn=E.getSource().maxzoom,Rr=nt.canonical.z===Hn?Math.ceil(1<<w.transform.maxZoom-nt.canonical.z):1;$n=a.ac(a.aV(Pt.maxLineLength/a.X*1024*Rr),256,Ie.maxTextureSize)}Mn.gradient=a.aW({expression:B.gradientExpression(),evaluationKey:"lineProgress",resolution:$n,image:Mn.gradient||void 0,clips:Pt.lineClipsArray}),Mn.texture?Mn.texture.update(Mn.gradient):Mn.texture=new F(Ie,Mn.gradient,qe.RGBA),Mn.version=B.gradientVersion,Dr=Mn.texture}Ie.activeTexture.set(qe.TEXTURE0),Dr.bind(B.stepInterpolant?qe.NEAREST:qe.LINEAR,qe.CLAMP_TO_EDGE)}Ot.draw(Ie,qe.TRIANGLES,ie,w.stencilModeForClipping(nt),_e,vr.disabled,Wt,ln,B.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,B.paint,w.transform.zoom,Vt,Pt.layoutVertexBuffer2),We=!1}})(s,h,g,y);break;case"fill":(function(w,E,B,j){const Y=B.paint.get("fill-color"),re=B.paint.get("fill-opacity");if(re.constantOr(1)===0)return;const ie=w.colorModeForRenderPass(),_e=B.paint.get("fill-pattern"),Ae=w.opaquePassEnabledForLayer()&&!_e.constantOr(1)&&Y.constantOr(a.aM.transparent).a===1&&re.constantOr(0)===1?"opaque":"translucent";if(w.renderPass===Ae){const Se=w.depthModeForSublayer(1,w.renderPass==="opaque"?Vn.ReadWrite:Vn.ReadOnly);el(w,E,B,j,Se,ie,!1)}if(w.renderPass==="translucent"&&B.paint.get("fill-antialias")){const Se=w.depthModeForSublayer(B.getPaintProperty("fill-outline-color")?2:0,Vn.ReadOnly);el(w,E,B,j,Se,ie,!0)}})(s,h,g,y);break;case"fill-extrusion":(function(w,E,B,j){const Y=B.paint.get("fill-extrusion-opacity");if(Y!==0&&w.renderPass==="translucent"){const re=new Vn(w.context.gl.LEQUAL,Vn.ReadWrite,w.depthRangeFor3D);if(Y!==1||B.paint.get("fill-extrusion-pattern").constantOr(1))ql(w,E,B,j,re,Ir.disabled,Hr.disabled),ql(w,E,B,j,re,w.stencilModeFor3D(),w.colorModeForRenderPass());else{const ie=w.colorModeForRenderPass();ql(w,E,B,j,re,Ir.disabled,ie)}}})(s,h,g,y);break;case"hillshade":(function(w,E,B,j){if(w.renderPass!=="offscreen"&&w.renderPass!=="translucent")return;const Y=w.context,re=w.depthModeForSublayer(0,Vn.ReadOnly),ie=w.colorModeForRenderPass(),[_e,Ae]=w.renderPass==="translucent"?w.stencilConfigForOverlap(j):[{},j];for(const Se of Ae){const ze=E.getTile(Se);ze.needsHillshadePrepare!==void 0&&ze.needsHillshadePrepare&&w.renderPass==="offscreen"?ca(w,ze,B,re,Ir.disabled,ie):w.renderPass==="translucent"&&ua(w,Se,ze,B,re,_e[Se.overscaledZ],ie)}Y.viewport.set([0,0,w.width,w.height])})(s,h,g,y);break;case"raster":(function(w,E,B,j){if(w.renderPass!=="translucent"||B.paint.get("raster-opacity")===0||!j.length)return;const Y=w.context,re=Y.gl,ie=E.getSource(),_e=w.useProgram("raster"),Ae=w.colorModeForRenderPass(),[Se,ze]=ie instanceof fr?[{},j]:w.stencilConfigForOverlap(j),Re=ze[ze.length-1].overscaledZ,Be=!w.options.moving;for(const $e of ze){const Ie=w.depthModeForSublayer($e.overscaledZ-Re,B.paint.get("raster-opacity")===1?Vn.ReadWrite:Vn.ReadOnly,re.LESS),qe=E.getTile($e);qe.registerFadeDuration(B.paint.get("raster-fade-duration"));const We=E.findLoadedParent($e,0),nt=E.findLoadedSibling($e),bt=Mh(qe,We||nt||null,E,B,w.transform,w.style.map.terrain);let Pt,Vt;const Jt=B.paint.get("raster-resampling")==="nearest"?re.NEAREST:re.LINEAR;Y.activeTexture.set(re.TEXTURE0),qe.texture.bind(Jt,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),Y.activeTexture.set(re.TEXTURE1),We?(We.texture.bind(Jt,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),Pt=Math.pow(2,We.tileID.overscaledZ-qe.tileID.overscaledZ),Vt=[qe.tileID.canonical.x*Pt%1,qe.tileID.canonical.y*Pt%1]):qe.texture.bind(Jt,re.CLAMP_TO_EDGE,re.LINEAR_MIPMAP_NEAREST),qe.texture.useMipmap&&Y.extTextureFilterAnisotropic&&w.transform.pitch>20&&re.texParameterf(re.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const Ot=w.style.map.terrain&&w.style.map.terrain.getTerrainData($e),Bt=Ot?$e:null,ln=Bt?Bt.posMatrix:w.transform.calculatePosMatrix($e.toUnwrapped(),Be),In=pp(ln,Vt||[0,0],Pt||1,bt,B);ie instanceof fr?_e.draw(Y,re.TRIANGLES,Ie,Ir.disabled,Ae,vr.disabled,In,Ot,B.id,ie.boundsBuffer,w.quadTriangleIndexBuffer,ie.boundsSegments):_e.draw(Y,re.TRIANGLES,Ie,Se[$e.overscaledZ],Ae,vr.disabled,In,Ot,B.id,w.rasterBoundsBuffer,w.quadTriangleIndexBuffer,w.rasterBoundsSegments)}})(s,h,g,y);break;case"background":(function(w,E,B,j){const Y=B.paint.get("background-color"),re=B.paint.get("background-opacity");if(re===0)return;const ie=w.context,_e=ie.gl,Ae=w.transform,Se=Ae.tileSize,ze=B.paint.get("background-pattern");if(w.isPatternMissing(ze))return;const Re=!ze&&Y.a===1&&re===1&&w.opaquePassEnabledForLayer()?"opaque":"translucent";if(w.renderPass!==Re)return;const Be=Ir.disabled,$e=w.depthModeForSublayer(0,Re==="opaque"?Vn.ReadWrite:Vn.ReadOnly),Ie=w.colorModeForRenderPass(),qe=w.useProgram(ze?"backgroundPattern":"background"),We=j||Ae.coveringTiles({tileSize:Se,terrain:w.style.map.terrain});ze&&(ie.activeTexture.set(_e.TEXTURE0),w.imageManager.bind(w.context));const nt=B.getCrossfadeParameters();for(const bt of We){const Pt=j?bt.posMatrix:w.transform.calculatePosMatrix(bt.toUnwrapped()),Vt=ze?lc(Pt,re,w,ze,{tileID:bt,tileSize:Se},nt):Ol(Pt,re,Y),Jt=w.style.map.terrain&&w.style.map.terrain.getTerrainData(bt);qe.draw(ie,_e.TRIANGLES,$e,Be,Ie,vr.disabled,Vt,Jt,B.id,w.tileExtentBuffer,w.quadTriangleIndexBuffer,w.tileExtentSegments)}})(s,0,g,y);break;case"custom":(function(w,E,B){const j=w.context,Y=B.implementation;if(w.renderPass==="offscreen"){const re=Y.prerender;re&&(w.setCustomLayerDefaults(),j.setColorMode(w.colorModeForRenderPass()),re.call(Y,j.gl,w.transform.customLayerMatrix()),j.setDirty(),w.setBaseState())}else if(w.renderPass==="translucent"){w.setCustomLayerDefaults(),j.setColorMode(w.colorModeForRenderPass()),j.setStencilMode(Ir.disabled);const re=Y.renderingMode==="3d"?new Vn(w.context.gl.LEQUAL,Vn.ReadWrite,w.depthRangeFor3D):w.depthModeForSublayer(0,Vn.ReadOnly);j.setDepthMode(re),Y.render(j.gl,w.transform.customLayerMatrix(),{farZ:w.transform.farZ,nearZ:w.transform.nearZ,fov:w.transform._fov,modelViewProjectionMatrix:w.transform.modelViewProjectionMatrix,projectionMatrix:w.transform.projectionMatrix}),j.setDirty(),w.setBaseState(),j.bindFramebuffer.set(null)}})(s,0,g)}}translatePosMatrix(s,h,g,y,w){if(!g[0]&&!g[1])return s;const E=w?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(E){const Y=Math.sin(E),re=Math.cos(E);g=[g[0]*re-g[1]*Y,g[0]*Y+g[1]*re]}const B=[w?g[0]:Un(h,g[0],this.transform.zoom),w?g[1]:Un(h,g[1],this.transform.zoom),0],j=new Float32Array(16);return a.J(j,s,B),j}saveTileTexture(s){const h=this._tileTextures[s.size[0]];h?h.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const h=this._tileTextures[s];return h&&h.length>0?h.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const h=this.imageManager.getPattern(s.from.toString()),g=this.imageManager.getPattern(s.to.toString());return!h||!g}useProgram(s,h){this.cache=this.cache||{};const g=s+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[g]||(this.cache[g]=new sc(this.context,ms[s],h,uc[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[g]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new F(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:h}=this.context.gl;return this.width!==s||this.height!==h}}class ha{constructor(s,h){this.points=s,this.planes=h}static fromInvProjectionMatrix(s,h,g){const y=Math.pow(2,g),w=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(B=>{const j=1/(B=a.af([],B,s))[3]/h*y;return a.b1(B,B,[j,j,1/B[3],j])}),E=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(B=>{const j=function(_e,Ae){var Se=Ae[0],ze=Ae[1],Re=Ae[2],Be=Se*Se+ze*ze+Re*Re;return Be>0&&(Be=1/Math.sqrt(Be)),_e[0]=Ae[0]*Be,_e[1]=Ae[1]*Be,_e[2]=Ae[2]*Be,_e}([],function(_e,Ae,Se){var ze=Ae[0],Re=Ae[1],Be=Ae[2],$e=Se[0],Ie=Se[1],qe=Se[2];return _e[0]=Re*qe-Be*Ie,_e[1]=Be*$e-ze*qe,_e[2]=ze*Ie-Re*$e,_e}([],ue([],w[B[0]],w[B[1]]),ue([],w[B[2]],w[B[1]]))),Y=-((re=j)[0]*(ie=w[B[1]])[0]+re[1]*ie[1]+re[2]*ie[2]);var re,ie;return j.concat(Y)});return new ha(w,E)}}class da{constructor(s,h){this.min=s,this.max=h,this.center=function(g,y,w){return g[0]=.5*y[0],g[1]=.5*y[1],g[2]=.5*y[2],g}([],function(g,y,w){return g[0]=y[0]+w[0],g[1]=y[1]+w[1],g[2]=y[2]+w[2],g}([],this.min,this.max))}quadrant(s){const h=[s%2==0,s<2],g=ee(this.min),y=ee(this.max);for(let w=0;w<h.length;w++)g[w]=h[w]?this.min[w]:this.center[w],y[w]=h[w]?this.center[w]:this.max[w];return y[2]=this.max[2],new da(g,y)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let g=!0;for(let y=0;y<s.planes.length;y++){const w=s.planes[y];let E=0;for(let B=0;B<h.length;B++)a.b2(w,h[B])>=0&&E++;if(E===0)return 0;E!==h.length&&(g=!1)}if(g)return 2;for(let y=0;y<3;y++){let w=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(let B=0;B<s.points.length;B++){const j=s.points[B][y]-this.min[y];w=Math.min(w,j),E=Math.max(E,j)}if(E<0||w>this.max[y]-this.min[y])return 0}return 1}}class pa{constructor(s=0,h=0,g=0,y=0){if(isNaN(s)||s<0||isNaN(h)||h<0||isNaN(g)||g<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=h,this.left=g,this.right=y}interpolate(s,h,g){return h.top!=null&&s.top!=null&&(this.top=a.y.number(s.top,h.top,g)),h.bottom!=null&&s.bottom!=null&&(this.bottom=a.y.number(s.bottom,h.bottom,g)),h.left!=null&&s.left!=null&&(this.left=a.y.number(s.left,h.left,g)),h.right!=null&&s.right!=null&&(this.right=a.y.number(s.right,h.right,g)),this}getCenter(s,h){const g=a.ac((this.left+s-this.right)/2,0,s),y=a.ac((this.top+h-this.bottom)/2,0,h);return new a.P(g,y)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new pa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ac=85.051129;class ma{constructor(s,h,g,y,w){this.tileSize=512,this._renderWorldCopies=w===void 0||!!w,this._minZoom=s||0,this._maxZoom=h||22,this._minPitch=g??0,this._maxPitch=y??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new a.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new pa,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const s=new ma(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.lngRange=s.lngRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new a.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const h=-a.b3(s,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var g=new a.A(4);return a.A!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g}(),function(g,y,w){var E=y[0],B=y[1],j=y[2],Y=y[3],re=Math.sin(w),ie=Math.cos(w);g[0]=E*ie+j*re,g[1]=B*ie+Y*re,g[2]=E*-re+j*ie,g[3]=B*-re+Y*ie}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const h=a.ac(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const h=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,h,g){this._unmodified=!1,this._edgeInsets.interpolate(s,h,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const h=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(s){const h=[new a.b4(0,s)];if(this._renderWorldCopies){const g=this.pointCoordinate(new a.P(0,0)),y=this.pointCoordinate(new a.P(this.width,0)),w=this.pointCoordinate(new a.P(this.width,this.height)),E=this.pointCoordinate(new a.P(0,this.height)),B=Math.floor(Math.min(g.x,y.x,w.x,E.x)),j=Math.floor(Math.max(g.x,y.x,w.x,E.x)),Y=1;for(let re=B-Y;re<=j+Y;re++)re!==0&&h.push(new a.b4(re,s))}return h}coveringTiles(s){var h,g;let y=this.coveringZoomLevel(s);const w=y;if(s.minzoom!==void 0&&y<s.minzoom)return[];s.maxzoom!==void 0&&y>s.maxzoom&&(y=s.maxzoom);const E=this.pointCoordinate(this.getCameraPoint()),B=a.Z.fromLngLat(this.center),j=Math.pow(2,y),Y=[j*E.x,j*E.y,0],re=[j*B.x,j*B.y,0],ie=ha.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,y);let _e=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(_e=y);const Ae=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,Se=Ie=>({aabb:new da([Ie*j,0,0],[(Ie+1)*j,j,0]),zoom:0,x:0,y:0,wrap:Ie,fullyVisible:!1}),ze=[],Re=[],Be=y,$e=s.reparseOverscaled?w:y;if(this._renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)ze.push(Se(-Ie)),ze.push(Se(Ie));for(ze.push(Se(0));ze.length>0;){const Ie=ze.pop(),qe=Ie.x,We=Ie.y;let nt=Ie.fullyVisible;if(!nt){const Ot=Ie.aabb.intersects(ie);if(Ot===0)continue;nt=Ot===2}const bt=s.terrain?Y:re,Pt=Ie.aabb.distanceX(bt),Vt=Ie.aabb.distanceY(bt),Jt=Math.max(Math.abs(Pt),Math.abs(Vt));if(Ie.zoom===Be||Jt>Ae+(1<<Be-Ie.zoom)-2&&Ie.zoom>=_e){const Ot=Be-Ie.zoom,Bt=Y[0]-.5-(qe<<Ot),ln=Y[1]-.5-(We<<Ot);Re.push({tileID:new a.S(Ie.zoom===Be?$e:Ie.zoom,Ie.wrap,Ie.zoom,qe,We),distanceSq:$([re[0]-.5-qe,re[1]-.5-We]),tileDistanceToCamera:Math.sqrt(Bt*Bt+ln*ln)})}else for(let Ot=0;Ot<4;Ot++){const Bt=(qe<<1)+Ot%2,ln=(We<<1)+(Ot>>1),In=Ie.zoom+1;let jt=Ie.aabb.quadrant(Ot);if(s.terrain){const Wt=new a.S(In,Ie.wrap,In,Bt,ln),Mn=s.terrain.getMinMaxElevation(Wt),Dr=(h=Mn.minElevation)!==null&&h!==void 0?h:this.elevation,$n=(g=Mn.maxElevation)!==null&&g!==void 0?g:this.elevation;jt=new da([jt.min[0],jt.min[1],Dr],[jt.max[0],jt.max[1],$n])}ze.push({aabb:jt,zoom:In,x:Bt,y:ln,wrap:Ie.wrap,fullyVisible:nt})}}return Re.sort((Ie,qe)=>Ie.distanceSq-qe.distanceSq).map(Ie=>Ie.tileID)}resize(s,h){this.width=s,this.height=h,this.pixelsToGLUnits=[2/s,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const h=a.ac(s.lat,-85.051129,Ac);return new a.P(a.O(s.lng)*this.worldSize,a.Q(h)*this.worldSize)}unproject(s){return new a.Z(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const h=this.elevation,g=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,y=this.pointLocation(this.centerPoint,s),w=s.getElevationForLngLatZoom(y,this.tileZoom);if(!(this.elevation-w))return;const E=g+h-w,B=Math.cos(this._pitch)*this.cameraToCenterDistance/E/a.b5(1,y.lat),j=this.scaleZoom(B/this.tileSize);this._elevation=w,this._center=y,this.zoom=j}setLocationAtPoint(s,h){const g=this.pointCoordinate(h),y=this.pointCoordinate(this.centerPoint),w=this.locationCoordinate(s),E=new a.Z(w.x-(g.x-y.x),w.y-(g.y-y.y));this.center=this.coordinateLocation(E),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,h){return h?this.coordinatePoint(this.locationCoordinate(s),h.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,h){return this.coordinateLocation(this.pointCoordinate(s,h))}locationCoordinate(s){return a.Z.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,h){if(h){const _e=h.pointCoordinate(s);if(_e!=null)return _e}const g=[s.x,s.y,0,1],y=[s.x,s.y,1,1];a.af(g,g,this.pixelMatrixInverse),a.af(y,y,this.pixelMatrixInverse);const w=g[3],E=y[3],B=g[1]/w,j=y[1]/E,Y=g[2]/w,re=y[2]/E,ie=Y===re?0:(0-Y)/(re-Y);return new a.Z(a.y.number(g[0]/w,y[0]/E,ie)/this.worldSize,a.y.number(B,j,ie)/this.worldSize)}coordinatePoint(s,h=0,g=this.pixelMatrix){const y=[s.x*this.worldSize,s.y*this.worldSize,h,1];return a.af(y,y,g),new a.P(y[0]/y[3],y[1]/y[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Ge().extend(this.pointLocation(new a.P(0,s))).extend(this.pointLocation(new a.P(this.width,s))).extend(this.pointLocation(new a.P(this.width,this.height))).extend(this.pointLocation(new a.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Ge([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Ac])}calculateTileMatrix(s){const h=s.canonical,g=this.worldSize/this.zoomScale(h.z),y=h.x+Math.pow(2,h.z)*s.wrap,w=a.an(new Float64Array(16));return a.J(w,w,[y*g,h.y*g,0]),a.K(w,w,[g/a.X,g/a.X,1]),w}calculatePosMatrix(s,h=!1){const g=s.key,y=h?this._alignedPosMatrixCache:this._posMatrixCache;if(y[g])return y[g];const w=this.calculateTileMatrix(s);return a.L(w,h?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,w),y[g]=new Float32Array(w),y[g]}calculateFogMatrix(s){const h=s.key,g=this._fogMatrixCache;if(g[h])return g[h];const y=this.calculateTileMatrix(s);return a.L(y,this.fogMatrix,y),g[h]=new Float32Array(y),g[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(s,h){h=a.ac(+h,this.minZoom,this.maxZoom);const g={center:new a.N(s.lng,s.lat),zoom:h};let y=this.lngRange;if(!this._renderWorldCopies&&y===null){const Ie=179.9999999999;y=[-Ie,Ie]}const w=this.tileSize*this.zoomScale(g.zoom);let E=0,B=w,j=0,Y=w,re=0,ie=0;const{x:_e,y:Ae}=this.size;if(this.latRange){const Ie=this.latRange;E=a.Q(Ie[1])*w,B=a.Q(Ie[0])*w,B-E<Ae&&(re=Ae/(B-E))}y&&(j=a.b3(a.O(y[0])*w,0,w),Y=a.b3(a.O(y[1])*w,0,w),Y<j&&(Y+=w),Y-j<_e&&(ie=_e/(Y-j)));const{x:Se,y:ze}=this.project.call({worldSize:w},s);let Re,Be;const $e=Math.max(ie||0,re||0);if($e){const Ie=new a.P(ie?(Y+j)/2:Se,re?(B+E)/2:ze);return g.center=this.unproject.call({worldSize:w},Ie).wrap(),g.zoom+=this.scaleZoom($e),g}if(this.latRange){const Ie=Ae/2;ze-Ie<E&&(Be=E+Ie),ze+Ie>B&&(Be=B-Ie)}if(y){const Ie=(j+Y)/2;let qe=Se;this._renderWorldCopies&&(qe=a.b3(Se,Ie-w/2,Ie+w/2));const We=_e/2;qe-We<j&&(Re=j+We),qe+We>Y&&(Re=Y-We)}if(Re!==void 0||Be!==void 0){const Ie=new a.P(Re??Se,Be??ze);g.center=this.unproject.call({worldSize:w},Ie).wrap()}return g}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:h,zoom:g}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=g,this._unmodified=s,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,h=this.point.x,g=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=a.b5(1,this.center.lat)*this.worldSize;let y=a.an(new Float64Array(16));a.K(y,y,[this.width/2,-this.height/2,1]),a.J(y,y,[1,-1,0]),this.labelPlaneMatrix=y,y=a.an(new Float64Array(16)),a.K(y,y,[1,-1,1]),a.J(y,y,[-1,-1,0]),a.K(y,y,[2/this.width,2/this.height,1]),this.glCoordMatrix=y;const w=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),E=Math.min(this.elevation,this.minElevationForCurrentTile),B=w-E*this._pixelPerMeter/Math.cos(this._pitch),j=E<0?B:w,Y=Math.PI/2+this._pitch,re=this._fov*(.5+s.y/this.height),ie=Math.sin(re)*j/Math.sin(a.ac(Math.PI-Y-re,.01,Math.PI-.01)),_e=this.getHorizon(),Ae=2*Math.atan(_e/this.cameraToCenterDistance)*(.5+s.y/(2*_e)),Se=Math.sin(Ae)*j/Math.sin(a.ac(Math.PI-Y-Ae,.01,Math.PI-.01)),ze=Math.min(ie,Se);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*ze+j),this.nearZ=this.height/50,y=new Float64Array(16),a.b6(y,this._fov,this.width/this.height,this.nearZ,this.farZ),y[8]=2*-s.x/this.width,y[9]=2*s.y/this.height,this.projectionMatrix=a.ae(y),a.K(y,y,[1,-1,1]),a.J(y,y,[0,0,-this.cameraToCenterDistance]),a.b7(y,y,this._pitch),a.ad(y,y,this.angle),a.J(y,y,[-h,-g,0]),this.mercatorMatrix=a.K([],y,[this.worldSize,this.worldSize,this.worldSize]),a.K(y,y,[1,1,this._pixelPerMeter]),this.pixelMatrix=a.L(new Float64Array(16),this.labelPlaneMatrix,y),a.J(y,y,[0,0,-this.elevation]),this.modelViewProjectionMatrix=y,this.invModelViewProjectionMatrix=a.as([],y),this.fogMatrix=new Float64Array(16),a.b6(this.fogMatrix,this._fov,this.width/this.height,w,this.farZ),this.fogMatrix[8]=2*-s.x/this.width,this.fogMatrix[9]=2*s.y/this.height,a.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),a.b7(this.fogMatrix,this.fogMatrix,this._pitch),a.ad(this.fogMatrix,this.fogMatrix,this.angle),a.J(this.fogMatrix,this.fogMatrix,[-h,-g,0]),a.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),a.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=a.L(new Float64Array(16),this.labelPlaneMatrix,y);const Re=this.width%2/2,Be=this.height%2/2,$e=Math.cos(this.angle),Ie=Math.sin(this.angle),qe=h-Math.round(h)+$e*Re+Ie*Be,We=g-Math.round(g)+$e*Be+Ie*Re,nt=new Float64Array(y);if(a.J(nt,nt,[qe>.5?qe-1:qe,We>.5?We-1:We,0]),this.alignedModelViewProjectionMatrix=nt,y=a.as(new Float64Array(16),this.pixelMatrix),!y)throw new Error("failed to invert matrix");this.pixelMatrixInverse=y,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new a.P(0,0)),h=[s.x*this.worldSize,s.y*this.worldSize,0,1];return a.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new a.P(0,s))}getCameraQueryGeometry(s){const h=this.getCameraPoint();if(s.length===1)return[s[0],h];{let g=h.x,y=h.y,w=h.x,E=h.y;for(const B of s)g=Math.min(g,B.x),y=Math.min(y,B.y),w=Math.max(w,B.x),E=Math.max(E,B.y);return[new a.P(g,y),new a.P(w,y),new a.P(w,E),new a.P(g,E),new a.P(g,y)]}}lngLatToCameraDepth(s,h){const g=this.locationCoordinate(s),y=[g.x*this.worldSize,g.y*this.worldSize,h,1];return a.af(y,y,this.modelViewProjectionMatrix),y[2]/y[3]}}function tl(x,s){let h,g=!1,y=null,w=null;const E=()=>{y=null,g&&(x.apply(w,h),y=setTimeout(E,s),g=!1)};return(...B)=>(g=!0,w=this,h=B,y||E(),y)}class Xl{constructor(s){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let g;return h.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(g=y)}),(g&&g[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(g=>isNaN(g))){const g=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:g,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,h)},this._removeHash=()=>{const h=this._getCurrentHash();if(h.length===0)return;const g=h.join("/");let y=g;y.split("&").length>0&&(y=y.split("&")[0]),this._hashName&&(y=`${this._hashName}=${g}`);let w=window.location.hash.replace(y,"");w.startsWith("#&")?w=w.slice(0,1)+w.slice(2):w==="#"&&(w="");let E=window.location.href.replace(/(#.+)?$/,w);E=E.replace("&&","&"),window.history.replaceState(window.history.state,null,E)},this._updateHash=tl(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(s){const h=this._map.getCenter(),g=Math.round(100*this._map.getZoom())/100,y=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,y),E=Math.round(h.lng*w)/w,B=Math.round(h.lat*w)/w,j=this._map.getBearing(),Y=this._map.getPitch();let re="";if(re+=s?`/${E}/${B}/${g}`:`${g}/${B}/${E}`,(j||Y)&&(re+="/"+Math.round(10*j)/10),Y&&(re+=`/${Math.round(Y)}`),this._hashName){const ie=this._hashName;let _e=!1;const Ae=window.location.hash.slice(1).split("&").map(Se=>{const ze=Se.split("=")[0];return ze===ie?(_e=!0,`${ze}=${re}`):Se}).filter(Se=>Se);return _e||Ae.push(`${ie}=${re}`),`#${Ae.join("&")}`}return`#${re}`}}const Jl={linearity:.3,easing:a.b8(0,0,.3,1)},kc=a.e({deceleration:2500,maxSpeed:1400},Jl),Cp=a.e({deceleration:20,maxSpeed:1400},Jl),zh=a.e({deceleration:1e3,maxSpeed:360},Jl),Kl=a.e({deceleration:1e3,maxSpeed:90},Jl);class Sc{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,h=v.now();for(;s.length>0&&h-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new a.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)h.zoom+=w.zoomDelta||0,h.bearing+=w.bearingDelta||0,h.pitch+=w.pitchDelta||0,w.panDelta&&h.pan._add(w.panDelta),w.around&&(h.around=w.around),w.pinchAround&&(h.pinchAround=w.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(h.pan.mag()){const w=rl(h.pan.mag(),g,a.e({},kc,s||{}));y.offset=h.pan.mult(w.amount/h.pan.mag()),y.center=this._map.transform.center,nl(y,w)}if(h.zoom){const w=rl(h.zoom,g,Cp);y.zoom=this._map.transform.zoom+w.amount,nl(y,w)}if(h.bearing){const w=rl(h.bearing,g,zh);y.bearing=this._map.transform.bearing+a.ac(w.amount,-179,179),nl(y,w)}if(h.pitch){const w=rl(h.pitch,g,Kl);y.pitch=this._map.transform.pitch+w.amount,nl(y,w)}if(y.zoom||y.bearing){const w=h.pinchAround===void 0?h.around:h.pinchAround;y.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),a.e(y,{noMoveStart:!0})}}function nl(x,s){(!x.duration||x.duration<s.duration)&&(x.duration=s.duration,x.easing=s.easing)}function rl(x,s,h){const{maxSpeed:g,linearity:y,deceleration:w}=h,E=a.ac(x*y/(s/1e3),-g,g),B=Math.abs(E)/(w*y);return{easing:h.easing,duration:1e3*B,amount:E*(B/2)}}class vi extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g,y={}){const w=S.mousePos(h.getCanvas(),g),E=h.unproject(w);super(s,a.e({point:w,lngLat:E,originalEvent:g},y)),this._defaultPrevented=!1,this.target=h}}class Ns extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){const y=s==="touchend"?g.changedTouches:g.touches,w=S.touchPos(h.getCanvasContainer(),y),E=w.map(j=>h.unproject(j)),B=w.reduce((j,Y,re,ie)=>j.add(Y.div(ie.length)),new a.P(0,0));super(s,{points:w,point:B,lngLats:E,lngLat:h.unproject(B),originalEvent:g}),this._defaultPrevented=!1}}class Dh extends a.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,h,g){super(s,{originalEvent:g}),this._defaultPrevented=!1}}class Rh{constructor(s,h){this._map=s,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Dh(s.type,this._map,s))}mousedown(s,h){return this._mousedownPos=h,this._firePreventable(new vi(s.type,this._map,s))}mouseup(s){this._map.fire(new vi(s.type,this._map,s))}click(s,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new vi(s.type,this._map,s))}dblclick(s){return this._firePreventable(new vi(s.type,this._map,s))}mouseover(s){this._map.fire(new vi(s.type,this._map,s))}mouseout(s){this._map.fire(new vi(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ns(s.type,this._map,s))}touchmove(s){this._map.fire(new Ns(s.type,this._map,s))}touchend(s){this._map.fire(new Ns(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ns(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Wr{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new vi(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new vi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new vi(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bo{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(a.P.convert(s),this._map.terrain)}}class Wi{constructor(s,h){this._map=s,this._tr=new bo(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,h){this.isEnabled()&&s.shiftKey&&s.button===0&&(S.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(s,h){if(!this._active)return;const g=h;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const y=this._startPos;this._lastPos=g,this._box||(this._box=S.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const w=Math.min(y.x,g.x),E=Math.max(y.x,g.x),B=Math.min(y.y,g.y),j=Math.max(y.y,g.y);S.setTransform(this._box,`translate(${w}px,${B}px)`),this._box.style.width=E-w+"px",this._box.style.height=j-B+"px"}mouseupWindow(s,h){if(!this._active||s.button!==0)return;const g=this._startPos,y=h;if(this.reset(),S.suppressClick(),g.x!==y.x||g.y!==y.y)return this._map.fire(new a.k("boxzoomend",{originalEvent:s})),{cameraAnimation:w=>w.fitScreenCoordinates(g,y,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(S.remove(this._box),this._box=null),S.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,h){return this._map.fire(new a.k(s,{originalEvent:h}))}}function il(x,s){if(x.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${x.length}, points ${s.length}`);const h={};for(let g=0;g<x.length;g++)h[x[g].identifier]=s[g];return h}class Tc{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,h,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),g.length===this.numTouches&&(this.centroid=function(y){const w=new a.P(0,0);for(const E of y)w._add(E);return w.div(y.length)}(h),this.touches=il(g,h)))}touchmove(s,h,g){if(this.aborted||!this.centroid)return;const y=il(g,h);for(const w in this.touches){const E=y[w];(!E||E.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(s,h,g){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Yl{constructor(s){this.singleTap=new Tc(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,h,g){this.singleTap.touchstart(s,h,g)}touchmove(s,h,g){this.singleTap.touchmove(s,h,g)}touchend(s,h,g){const y=this.singleTap.touchend(s,h,g);if(y){const w=s.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(y)<30;if(w&&E||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class ga{constructor(s){this._tr=new bo(s),this._zoomIn=new Yl({numTouches:1,numTaps:2}),this._zoomOut=new Yl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,h,g){this._zoomIn.touchstart(s,h,g),this._zoomOut.touchstart(s,h,g)}touchmove(s,h,g){this._zoomIn.touchmove(s,h,g),this._zoomOut.touchmove(s,h,g)}touchend(s,h,g){const y=this._zoomIn.touchend(s,h,g),w=this._zoomOut.touchend(s,h,g),E=this._tr;return y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:E.zoom+1,around:E.unproject(y)},{originalEvent:s})}):w?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:B=>B.easeTo({duration:300,zoom:E.zoom-1,around:E.unproject(w)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ts{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const h=this._moveFunction(...s);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(s,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,h){if(!this.isEnabled())return;const g=this._lastPoint;if(!g)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const y=h.length?h[0]:h;return!this._moved&&y.dist(g)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=y,this._move(g,y))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&S.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Cc={0:1,2:2};class Ql{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const h=S.mouseButton(s);this._eventButton=h}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(h,g){const y=Cc[g];return h.buttons===void 0||(h.buttons&y)!==y}(s,this._eventButton)}isValidEndEvent(s){return S.mouseButton(s)===this._eventButton}}class Mc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const eu=x=>{x.mousedown=x.dragStart,x.mousemoveWindow=x.dragMove,x.mouseup=x.dragEnd,x.contextmenu=s=>{s.preventDefault()}},Ec=({enable:x,clickTolerance:s,bearingDegreesPerPixelMoved:h=.8})=>{const g=new Ql({checkCorrectEvent:y=>S.mouseButton(y)===0&&y.ctrlKey||S.mouseButton(y)===2});return new ts({clickTolerance:s,move:(y,w)=>({bearingDelta:(w.x-y.x)*h}),moveStateManager:g,enable:x,assignEvents:eu})},Ic=({enable:x,clickTolerance:s,pitchDegreesPerPixelMoved:h=-.5})=>{const g=new Ql({checkCorrectEvent:y=>S.mouseButton(y)===0&&y.ctrlKey||S.mouseButton(y)===2});return new ts({clickTolerance:s,move:(y,w)=>({pitchDelta:(w.y-y.y)*h}),moveStateManager:g,enable:x,assignEvents:eu})};class $s{constructor(s,h){this._clickTolerance=s.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new a.P(0,0)}_shouldBePrevented(s){return s<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(s,h,g){return this._calculateTransform(s,h,g)}touchmove(s,h,g){if(this._active){if(!this._shouldBePrevented(g.length))return s.preventDefault(),this._calculateTransform(s,h,g);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",s)}}touchend(s,h,g){this._calculateTransform(s,h,g),this._active&&this._shouldBePrevented(g.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,h,g){g.length>0&&(this._active=!0);const y=il(g,h),w=new a.P(0,0),E=new a.P(0,0);let B=0;for(const Y in y){const re=y[Y],ie=this._touches[Y];ie&&(w._add(re),E._add(re.sub(ie)),B++,y[Y]=re)}if(this._touches=y,this._shouldBePrevented(B)||!E.mag())return;const j=E.div(B);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(B),panDelta:j}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,h,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([h[0],h[1]]))}touchmove(s,h,g){if(!this._firstTwoTouches)return;s.preventDefault();const[y,w]=this._firstTwoTouches,E=ol(g,h,y),B=ol(g,h,w);if(!E||!B)return;const j=this._aroundCenter?null:E.add(B).div(2);return this._move([E,B],j,s)}touchend(s,h,g){if(!this._firstTwoTouches)return;const[y,w]=this._firstTwoTouches,E=ol(g,h,y),B=ol(g,h,w);E&&B||(this._active&&S.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function ol(x,s,h){for(let g=0;g<x.length;g++)if(x[g].identifier===h)return s[g]}function Lc(x,s){return Math.log(x/s)/Math.LN2}class Pc extends tu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,h){const g=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Lc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Lc(this._distance,g),pinchAround:h}}}function zc(x,s){return 180*x.angleWith(s)/Math.PI}class Dc extends tu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,h,g){const y=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:zc(this._vector,y),pinchAround:h}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const h=25/(Math.PI*this._minDiameter)*360,g=zc(s,this._startVector);return Math.abs(g)<h}}function nu(x){return Math.abs(x.y)>Math.abs(x.x)}class sl extends tu{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,h,g){super.touchstart(s,h,g),this._currentTouchCount=g.length}_start(s){this._lastPoints=s,nu(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,h,g){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const y=s[0].sub(this._lastPoints[0]),w=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(y,w,g.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(y.y+w.y)/2*-.5}):void 0}gestureBeginsVertically(s,h,g){if(this._valid!==void 0)return this._valid;const y=s.mag()>=2,w=h.mag()>=2;if(!y&&!w)return;if(!y||!w)return this._firstMove===void 0&&(this._firstMove=g),g-this._firstMove<100&&void 0;const E=s.y>0==h.y>0;return nu(s)&&nu(h)&&E}}const Bh={panStep:100,bearingStep:15,pitchStep:10};class to{constructor(s){this._tr=new bo(s);const h=Bh;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let h=0,g=0,y=0,w=0,E=0;switch(s.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:s.shiftKey?g=-1:(s.preventDefault(),w=-1);break;case 39:s.shiftKey?g=1:(s.preventDefault(),w=1);break;case 38:s.shiftKey?y=1:(s.preventDefault(),E=-1);break;case 40:s.shiftKey?y=-1:(s.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,y=0),{cameraAnimation:B=>{const j=this._tr;B.easeTo({duration:300,easeId:"keyboardHandler",easing:Oo,zoom:h?Math.round(j.zoom)+h*(s.shiftKey?2:1):j.zoom,bearing:j.bearing+g*this._bearingStep,pitch:j.pitch+y*this._pitchStep,offset:[-w*this._panStep,-E*this._panStep],center:j.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Oo(x){return x*(2-x)}const Rc=4.000244140625;class vo{constructor(s,h){this._onTimeout=g=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(g)},this._map=s,this._tr=new bo(s),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(s){return!!this._map.cooperativeGestures.isEnabled()&&!(s.ctrlKey||this._map.cooperativeGestures.isBypassed(s))}wheel(s){if(!this.isEnabled())return;if(this._shouldBePrevented(s))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",s);let h=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const g=v.now(),y=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,h!==0&&h%Rc==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),s.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=s,this._delta-=h,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=S.mousePos(this._map.getCanvas(),s),g=this._tr;this._around=h.y>g.transform.height/2-g.transform.getHorizon()?a.N.convert(this._aroundCenter?g.center:g.unproject(h)):a.N.convert(g.center),this._aroundPoint=g.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const j=this._type==="wheel"&&Math.abs(this._delta)>Rc?this._wheelZoomRate:this._defaultZoomRate;let Y=2/(1+Math.exp(-Math.abs(this._delta*j)));this._delta<0&&Y!==0&&(Y=1/Y);const re=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(re*Y))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,g=this._startZoom,y=this._easing;let w,E=!1;const B=v.now()-this._lastWheelEventTime;if(this._type==="wheel"&&g&&y&&B){const j=Math.min(B/200,1),Y=y(j);w=a.y.number(g,h,Y),j<1?this._frameId||(this._frameId=!0):E=!0}else w=h,E=!0;return this._active=!0,E&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!E,zoomDelta:w-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let h=a.b9;if(this._prevEase){const g=this._prevEase,y=(v.now()-g.start)/g.duration,w=g.easing(y+.01)-g.easing(y),E=.27/Math.sqrt(w*w+1e-4)*.01,B=Math.sqrt(.0729-E*E);h=a.b8(E,B,.25,1)}return this._prevEase={start:v.now(),duration:s,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class js{constructor(s,h){this._clickZoom=s,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Mp{constructor(s){this._tr=new bo(s),this.reset()}reset(){this._active=!1}dblclick(s,h){return s.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ep{constructor(){this._tap=new Yl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,h,g){if(!this._swipePoint)if(this._tapTime){const y=h[0],w=s.timeStamp-this._tapTime<500,E=this._tapPoint.dist(y)<30;w&&E?g.length>0&&(this._swipePoint=y,this._swipeTouch=g[0].identifier):this.reset()}else this._tap.touchstart(s,h,g)}touchmove(s,h,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const y=h[0],w=y.y-this._swipePoint.y;return this._swipePoint=y,s.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(s,h,g)}touchend(s,h,g){if(this._tapTime)this._swipePoint&&g.length===0&&this.reset();else{const y=this._tap.touchend(s,h,g);y&&(this._tapTime=s.timeStamp,this._tapPoint=y)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fh{constructor(s,h,g){this._el=s,this._mousePan=h,this._touchPan=g}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Oh{constructor(s,h,g){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=h,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Bc{constructor(s,h,g,y){this._el=s,this._touchZoom=h,this._touchRotate=g,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class _a{constructor(s,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=S.create("div","maplibregl-cooperative-gesture-screen",s);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const g=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),y=document.createElement("div");y.className="maplibregl-desktop-message",y.textContent=h,this._container.appendChild(y);const w=document.createElement("div");w.className="maplibregl-mobile-message",w.textContent=g,this._container.appendChild(w),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(S.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(s){return s[this._bypassKey]}notifyGestureBlocked(s,h){this._enabled&&(this._map.fire(new a.k("cooperativegestureprevented",{gestureType:s,originalEvent:h})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const no=x=>x.zoom||x.drag||x.pitch||x.rotate;class Yt extends a.k{}function ru(x){return x.panDelta&&x.panDelta.mag()||x.zoomDelta||x.bearingDelta||x.pitchDelta}class Fc{constructor(s,h){this.handleWindowEvent=y=>{this.handleEvent(y,`${y.type}Window`)},this.handleEvent=(y,w)=>{if(y.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const E=y.type==="renderFrame"?void 0:y,B={needsRenderFrame:!1},j={},Y={},re=y.touches,ie=re?this._getMapTouches(re):void 0,_e=ie?S.touchPos(this._map.getCanvas(),ie):S.mousePos(this._map.getCanvas(),y);for(const{handlerName:ze,handler:Re,allowed:Be}of this._handlers){if(!Re.isEnabled())continue;let $e;this._blockedByActive(Y,Be,ze)?Re.reset():Re[w||y.type]&&($e=Re[w||y.type](y,_e,ie),this.mergeHandlerResult(B,j,$e,ze,E),$e&&$e.needsRenderFrame&&this._triggerRenderFrame()),($e||Re.isActive())&&(Y[ze]=Re)}const Ae={};for(const ze in this._previousActiveHandlers)Y[ze]||(Ae[ze]=E);this._previousActiveHandlers=Y,(Object.keys(Ae).length||ru(B))&&(this._changes.push([B,j,Ae]),this._triggerRenderFrame()),(Object.keys(Y).length||ru(B))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Se}=B;Se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Se(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Sc(s),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,w,E]of this._listeners)S.addEventListener(y,w,y===document?this.handleWindowEvent:this.handleEvent,E)}destroy(){for(const[s,h,g]of this._listeners)S.removeEventListener(s,h,s===document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(s){const h=this._map,g=h.getCanvasContainer();this._add("mapEvent",new Rh(h,s));const y=h.boxZoom=new Wi(h,s);this._add("boxZoom",y),s.interactive&&s.boxZoom&&y.enable();const w=h.cooperativeGestures=new _a(h,s.cooperativeGestures);this._add("cooperativeGestures",w),s.cooperativeGestures&&w.enable();const E=new ga(h),B=new Mp(h);h.doubleClickZoom=new js(B,E),this._add("tapZoom",E),this._add("clickZoom",B),s.interactive&&s.doubleClickZoom&&h.doubleClickZoom.enable();const j=new Ep;this._add("tapDragZoom",j);const Y=h.touchPitch=new sl(h);this._add("touchPitch",Y),s.interactive&&s.touchPitch&&h.touchPitch.enable(s.touchPitch);const re=Ec(s),ie=Ic(s);h.dragRotate=new Oh(s,re,ie),this._add("mouseRotate",re,["mousePitch"]),this._add("mousePitch",ie,["mouseRotate"]),s.interactive&&s.dragRotate&&h.dragRotate.enable();const _e=(({enable:$e,clickTolerance:Ie})=>{const qe=new Ql({checkCorrectEvent:We=>S.mouseButton(We)===0&&!We.ctrlKey});return new ts({clickTolerance:Ie,move:(We,nt)=>({around:nt,panDelta:nt.sub(We)}),activateOnStart:!0,moveStateManager:qe,enable:$e,assignEvents:eu})})(s),Ae=new $s(s,h);h.dragPan=new Fh(g,_e,Ae),this._add("mousePan",_e),this._add("touchPan",Ae,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&h.dragPan.enable(s.dragPan);const Se=new Dc,ze=new Pc;h.touchZoomRotate=new Bc(g,ze,Se,j),this._add("touchRotate",Se,["touchPan","touchZoom"]),this._add("touchZoom",ze,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&h.touchZoomRotate.enable(s.touchZoomRotate);const Re=h.scrollZoom=new vo(h,()=>this._triggerRenderFrame());this._add("scrollZoom",Re,["mousePan"]),s.interactive&&s.scrollZoom&&h.scrollZoom.enable(s.scrollZoom);const Be=h.keyboard=new to(h);this._add("keyboard",Be),s.interactive&&s.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new Wr(h))}_add(s,h,g){this._handlers.push({handlerName:s,handler:h,allowed:g}),this._handlersById[s]=h}stop(s){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!no(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,h,g){for(const y in s)if(y!==g&&(!h||h.indexOf(y)<0))return!0;return!1}_getMapTouches(s){const h=[];for(const g of s)this._el.contains(g.target)&&h.push(g);return h}mergeHandlerResult(s,h,g,y,w){if(!g)return;a.e(s,g);const E={handlerName:y,originalEvent:g.originalEvent||w};g.zoomDelta!==void 0&&(h.zoom=E),g.panDelta!==void 0&&(h.drag=E),g.pitchDelta!==void 0&&(h.pitch=E),g.bearingDelta!==void 0&&(h.rotate=E)}_applyChanges(){const s={},h={},g={};for(const[y,w,E]of this._changes)y.panDelta&&(s.panDelta=(s.panDelta||new a.P(0,0))._add(y.panDelta)),y.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(s.around=y.around),y.pinchAround!==void 0&&(s.pinchAround=y.pinchAround),y.noInertia&&(s.noInertia=y.noInertia),a.e(h,w),a.e(g,E);this._updateMapTransform(s,h,g),this._changes=[]}_updateMapTransform(s,h,g){const y=this._map,w=y._getTransformForUpdate(),E=y.terrain;if(!(ru(s)||E&&this._terrainMovement))return this._fireEvents(h,g,!0);let{panDelta:B,zoomDelta:j,bearingDelta:Y,pitchDelta:re,around:ie,pinchAround:_e}=s;_e!==void 0&&(ie=_e),y._stop(!0),ie=ie||y.transform.centerPoint;const Ae=w.pointLocation(B?ie.sub(B):ie);Y&&(w.bearing+=Y),re&&(w.pitch+=re),j&&(w.zoom+=j),E?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?w.center=w.pointLocation(w.centerPoint.sub(B)):w.setLocationAtPoint(Ae,ie):(this._terrainMovement=!0,this._map._elevationFreeze=!0,w.setLocationAtPoint(Ae,ie)):w.setLocationAtPoint(Ae,ie),y._applyUpdatedTransform(w),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(h,g,!0)}_fireEvents(s,h,g){const y=no(this._eventsInProgress),w=no(s),E={};for(const ie in s){const{originalEvent:_e}=s[ie];this._eventsInProgress[ie]||(E[`${ie}start`]=_e),this._eventsInProgress[ie]=s[ie]}!y&&w&&this._fireEvent("movestart",w.originalEvent);for(const ie in E)this._fireEvent(ie,E[ie]);w&&this._fireEvent("move",w.originalEvent);for(const ie in s){const{originalEvent:_e}=s[ie];this._fireEvent(ie,_e)}const B={};let j;for(const ie in this._eventsInProgress){const{handlerName:_e,originalEvent:Ae}=this._eventsInProgress[ie];this._handlersById[_e].isActive()||(delete this._eventsInProgress[ie],j=h[_e]||Ae,B[`${ie}end`]=j)}for(const ie in B)this._fireEvent(ie,B[ie]);const Y=no(this._eventsInProgress),re=(y||w)&&!Y;if(re&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const ie=this._map._getTransformForUpdate();ie.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(ie)}if(g&&re){this._updatingCamera=!0;const ie=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),_e=Ae=>Ae!==0&&-this._bearingSnap<Ae&&Ae<this._bearingSnap;!ie||!ie.essential&&v.prefersReducedMotion?(this._map.fire(new a.k("moveend",{originalEvent:j})),_e(this._map.getBearing())&&this._map.resetNorth()):(_e(ie.bearing||this._map.getBearing())&&(ie.bearing=0),ie.freezeElevation=!0,this._map.easeTo(ie,{originalEvent:j})),this._updatingCamera=!1}}_fireEvent(s,h){this._map.fire(new a.k(s,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Yt("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Nh extends a.E{constructor(s,h){super(),this._renderFrameCallback=()=>{const g=Math.min((v.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(g)),g<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new a.N(this.transform.center.lng,this.transform.center.lat)}setCenter(s,h){return this.jumpTo({center:s},h)}panBy(s,h,g){return s=a.P.convert(s).mult(-1),this.panTo(this.transform.center,a.e({offset:s},h),g)}panTo(s,h,g){return this.easeTo(a.e({center:s},h),g)}getZoom(){return this.transform.zoom}setZoom(s,h){return this.jumpTo({zoom:s},h),this}zoomTo(s,h,g){return this.easeTo(a.e({zoom:s},h),g)}zoomIn(s,h){return this.zoomTo(this.getZoom()+1,s,h),this}zoomOut(s,h){return this.zoomTo(this.getZoom()-1,s,h),this}getBearing(){return this.transform.bearing}setBearing(s,h){return this.jumpTo({bearing:s},h),this}getPadding(){return this.transform.padding}setPadding(s,h){return this.jumpTo({padding:s},h),this}rotateTo(s,h,g){return this.easeTo(a.e({bearing:s},h),g)}resetNorth(s,h){return this.rotateTo(0,a.e({duration:1e3},s),h),this}resetNorthPitch(s,h){return this.easeTo(a.e({bearing:0,pitch:0,duration:1e3},s),h),this}snapToNorth(s,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,h):this}getPitch(){return this.transform.pitch}setPitch(s,h){return this.jumpTo({pitch:s},h),this}cameraForBounds(s,h){s=Ge.convert(s).adjustAntiMeridian();const g=h&&h.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),g,h)}_cameraForBoxAndBearing(s,h,g,y){const w={top:0,bottom:0,right:0,left:0};if(typeof(y=a.e({padding:w,offset:[0,0],maxZoom:this.transform.maxZoom},y)).padding=="number"){const Ot=y.padding;y.padding={top:Ot,bottom:Ot,right:Ot,left:Ot}}y.padding=a.e(w,y.padding);const E=this.transform,B=E.padding,j=new Ge(s,h),Y=E.project(j.getNorthWest()),re=E.project(j.getNorthEast()),ie=E.project(j.getSouthEast()),_e=E.project(j.getSouthWest()),Ae=a.ba(-g),Se=Y.rotate(Ae),ze=re.rotate(Ae),Re=ie.rotate(Ae),Be=_e.rotate(Ae),$e=new a.P(Math.max(Se.x,ze.x,Be.x,Re.x),Math.max(Se.y,ze.y,Be.y,Re.y)),Ie=new a.P(Math.min(Se.x,ze.x,Be.x,Re.x),Math.min(Se.y,ze.y,Be.y,Re.y)),qe=$e.sub(Ie),We=(E.width-(B.left+B.right+y.padding.left+y.padding.right))/qe.x,nt=(E.height-(B.top+B.bottom+y.padding.top+y.padding.bottom))/qe.y;if(nt<0||We<0)return void a.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const bt=Math.min(E.scaleZoom(E.scale*Math.min(We,nt)),y.maxZoom),Pt=a.P.convert(y.offset),Vt=new a.P((y.padding.left-y.padding.right)/2,(y.padding.top-y.padding.bottom)/2).rotate(a.ba(g)),Jt=Pt.add(Vt).mult(E.scale/E.zoomScale(bt));return{center:E.unproject(Y.add(ie).div(2).sub(Jt)),zoom:bt,bearing:g}}fitBounds(s,h,g){return this._fitInternal(this.cameraForBounds(s,h),h,g)}fitScreenCoordinates(s,h,g,y,w){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(a.P.convert(s)),this.transform.pointLocation(a.P.convert(h)),g,y),y,w)}_fitInternal(s,h,g){return s?(delete(h=a.e(s,h)).padding,h.linear?this.easeTo(h,g):this.flyTo(h,g)):this}jumpTo(s,h){this.stop();const g=this._getTransformForUpdate();let y=!1,w=!1,E=!1;return"zoom"in s&&g.zoom!==+s.zoom&&(y=!0,g.zoom=+s.zoom),s.center!==void 0&&(g.center=a.N.convert(s.center)),"bearing"in s&&g.bearing!==+s.bearing&&(w=!0,g.bearing=+s.bearing),"pitch"in s&&g.pitch!==+s.pitch&&(E=!0,g.pitch=+s.pitch),s.padding==null||g.isPaddingEqual(s.padding)||(g.padding=s.padding),this._applyUpdatedTransform(g),this.fire(new a.k("movestart",h)).fire(new a.k("move",h)),y&&this.fire(new a.k("zoomstart",h)).fire(new a.k("zoom",h)).fire(new a.k("zoomend",h)),w&&this.fire(new a.k("rotatestart",h)).fire(new a.k("rotate",h)).fire(new a.k("rotateend",h)),E&&this.fire(new a.k("pitchstart",h)).fire(new a.k("pitch",h)).fire(new a.k("pitchend",h)),this.fire(new a.k("moveend",h))}calculateCameraOptionsFromTo(s,h,g,y=0){const w=a.Z.fromLngLat(s,h),E=a.Z.fromLngLat(g,y),B=E.x-w.x,j=E.y-w.y,Y=E.z-w.z,re=Math.hypot(B,j,Y);if(re===0)throw new Error("Can't calculate camera options with same From and To");const ie=Math.hypot(B,j),_e=this.transform.scaleZoom(this.transform.cameraToCenterDistance/re/this.transform.tileSize),Ae=180*Math.atan2(B,-j)/Math.PI;let Se=180*Math.acos(ie/re)/Math.PI;return Se=Y<0?90-Se:90+Se,{center:E.toLngLat(),zoom:_e,pitch:Se,bearing:Ae}}easeTo(s,h){var g;this._stop(!1,s.easeId),((s=a.e({offset:[0,0],duration:500,easing:a.b9},s)).animate===!1||!s.essential&&v.prefersReducedMotion)&&(s.duration=0);const y=this._getTransformForUpdate(),w=y.zoom,E=y.bearing,B=y.pitch,j=y.padding,Y="bearing"in s?this._normalizeBearing(s.bearing,E):E,re="pitch"in s?+s.pitch:B,ie="padding"in s?s.padding:y.padding,_e=a.P.convert(s.offset);let Ae=y.centerPoint.add(_e);const Se=y.pointLocation(Ae),{center:ze,zoom:Re}=y.getConstrained(a.N.convert(s.center||Se),(g=s.zoom)!==null&&g!==void 0?g:w);this._normalizeCenter(ze,y);const Be=y.project(Se),$e=y.project(ze).sub(Be),Ie=y.zoomScale(Re-w);let qe,We;s.around&&(qe=a.N.convert(s.around),We=y.locationPoint(qe));const nt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Re!==w,this._rotating=this._rotating||E!==Y,this._pitching=this._pitching||re!==B,this._padding=!y.isPaddingEqual(ie),this._easeId=s.easeId,this._prepareEase(h,s.noMoveStart,nt),this.terrain&&this._prepareElevation(ze),this._ease(bt=>{if(this._zooming&&(y.zoom=a.y.number(w,Re,bt)),this._rotating&&(y.bearing=a.y.number(E,Y,bt)),this._pitching&&(y.pitch=a.y.number(B,re,bt)),this._padding&&(y.interpolatePadding(j,ie,bt),Ae=y.centerPoint.add(_e)),this.terrain&&!s.freezeElevation&&this._updateElevation(bt),qe)y.setLocationAtPoint(qe,We);else{const Pt=y.zoomScale(y.zoom-w),Vt=Re>w?Math.min(2,Ie):Math.max(.5,Ie),Jt=Math.pow(Vt,1-bt),Ot=y.unproject(Be.add($e.mult(bt*Jt)).mult(Pt));y.setLocationAtPoint(y.renderWorldCopies?Ot.wrap():Ot,Ae)}this._applyUpdatedTransform(y),this._fireMoveEvents(h)},bt=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(h,bt)},s),this}_prepareEase(s,h,g={}){this._moving=!0,h||g.moving||this.fire(new a.k("movestart",s)),this._zooming&&!g.zooming&&this.fire(new a.k("zoomstart",s)),this._rotating&&!g.rotating&&this.fire(new a.k("rotatestart",s)),this._pitching&&!g.pitching&&this.fire(new a.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&h!==this._elevationTarget){const g=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(g-(h-(g*s+this._elevationStart))/(1-s)),this._elevationTarget=h}this.transform.elevation=a.y.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(s){const h=s.getCameraPosition(),g=this.terrain.getElevationForLngLatZoom(h.lngLat,s.zoom);if(h.altitude<g){const y=this.calculateCameraOptionsFromTo(h.lngLat,g,s.center,s.elevation);return{pitch:y.pitch,zoom:y.zoom}}return{}}_applyUpdatedTransform(s){const h=[];if(this.terrain&&h.push(y=>this._elevateCameraIfInsideTerrain(y)),this.transformCameraUpdate&&h.push(y=>this.transformCameraUpdate(y)),!h.length)return;const g=s.clone();for(const y of h){const w=g.clone(),{center:E,zoom:B,pitch:j,bearing:Y,elevation:re}=y(w);E&&(w.center=E),B!==void 0&&(w.zoom=B),j!==void 0&&(w.pitch=j),Y!==void 0&&(w.bearing=Y),re!==void 0&&(w.elevation=re),g.apply(w)}this.transform.apply(g)}_fireMoveEvents(s){this.fire(new a.k("move",s)),this._zooming&&this.fire(new a.k("zoom",s)),this._rotating&&this.fire(new a.k("rotate",s)),this._pitching&&this.fire(new a.k("pitch",s))}_afterEase(s,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const g=this._zooming,y=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new a.k("zoomend",s)),y&&this.fire(new a.k("rotateend",s)),w&&this.fire(new a.k("pitchend",s)),this.fire(new a.k("moveend",s))}flyTo(s,h){var g;if(!s.essential&&v.prefersReducedMotion){const Wt=a.M(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Wt,h)}this.stop(),s=a.e({offset:[0,0],speed:1.2,curve:1.42,easing:a.b9},s);const y=this._getTransformForUpdate(),w=y.zoom,E=y.bearing,B=y.pitch,j=y.padding,Y="bearing"in s?this._normalizeBearing(s.bearing,E):E,re="pitch"in s?+s.pitch:B,ie="padding"in s?s.padding:y.padding,_e=a.P.convert(s.offset);let Ae=y.centerPoint.add(_e);const Se=y.pointLocation(Ae),{center:ze,zoom:Re}=y.getConstrained(a.N.convert(s.center||Se),(g=s.zoom)!==null&&g!==void 0?g:w);this._normalizeCenter(ze,y);const Be=y.zoomScale(Re-w),$e=y.project(Se),Ie=y.project(ze).sub($e);let qe=s.curve;const We=Math.max(y.width,y.height),nt=We/Be,bt=Ie.mag();if("minZoom"in s){const Wt=a.ac(Math.min(s.minZoom,w,Re),y.minZoom,y.maxZoom),Mn=We/y.zoomScale(Wt-w);qe=Math.sqrt(Mn/bt*2)}const Pt=qe*qe;function Vt(Wt){const Mn=(nt*nt-We*We+(Wt?-1:1)*Pt*Pt*bt*bt)/(2*(Wt?nt:We)*Pt*bt);return Math.log(Math.sqrt(Mn*Mn+1)-Mn)}function Jt(Wt){return(Math.exp(Wt)-Math.exp(-Wt))/2}function Ot(Wt){return(Math.exp(Wt)+Math.exp(-Wt))/2}const Bt=Vt(!1);let ln=function(Wt){return Ot(Bt)/Ot(Bt+qe*Wt)},In=function(Wt){return We*((Ot(Bt)*(Jt(Mn=Bt+qe*Wt)/Ot(Mn))-Jt(Bt))/Pt)/bt;var Mn},jt=(Vt(!0)-Bt)/qe;if(Math.abs(bt)<1e-6||!isFinite(jt)){if(Math.abs(We-nt)<1e-6)return this.easeTo(s,h);const Wt=nt<We?-1:1;jt=Math.abs(Math.log(nt/We))/qe,In=()=>0,ln=Mn=>Math.exp(Wt*qe*Mn)}return s.duration="duration"in s?+s.duration:1e3*jt/("screenSpeed"in s?+s.screenSpeed/qe:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=E!==Y,this._pitching=re!==B,this._padding=!y.isPaddingEqual(ie),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(ze),this._ease(Wt=>{const Mn=Wt*jt,Dr=1/ln(Mn);y.zoom=Wt===1?Re:w+y.scaleZoom(Dr),this._rotating&&(y.bearing=a.y.number(E,Y,Wt)),this._pitching&&(y.pitch=a.y.number(B,re,Wt)),this._padding&&(y.interpolatePadding(j,ie,Wt),Ae=y.centerPoint.add(_e)),this.terrain&&!s.freezeElevation&&this._updateElevation(Wt);const $n=Wt===1?ze:y.unproject($e.add(Ie.mult(In(Mn))).mult(Dr));y.setLocationAtPoint(y.renderWorldCopies?$n.wrap():$n,Ae),this._applyUpdatedTransform(y),this._fireMoveEvents(h)},()=>{this.terrain&&s.freezeElevation&&this._finalizeElevation(),this._afterEase(h)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,h){var g;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}return s||(g=this.handlers)===null||g===void 0||g.stop(!1),this}_ease(s,h,g){g.animate===!1||g.duration===0?(s(1),h()):(this._easeStart=v.now(),this._easeOptions=g,this._onEaseFrame=s,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,h){s=a.b3(s,-180,180);const g=Math.abs(s-h);return Math.abs(s-360-h)<g&&(s-=360),Math.abs(s+360-h)<g&&(s+=360),s}_normalizeCenter(s,h){if(!h.renderWorldCopies||h.lngRange)return;const g=s.lng-h.center.lng;s.lng+=g>180?-360:g<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(a.N.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const ya={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ba{constructor(s=ya){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=S.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=S.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=S.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){S.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,h){const g=this._map._getUIString(`AttributionControl.${h}`);s.title=g,s.setAttribute("aria-label",g)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(y=>typeof y!="string"?"":y)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const h=this._map.style.sourceCaches;for(const y in h){const w=h[y];if(w.used||w.usedForTerrain){const E=w.getSource();E.attribution&&s.indexOf(E.attribution)<0&&s.push(E.attribution)}}s=s.filter(y=>String(y).trim()),s.sort((y,w)=>y.length-w.length),s=s.filter((y,w)=>{for(let E=w+1;E<s.length;E++)if(s[E].indexOf(y)>=0)return!1;return!0});const g=s.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,s.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Oc{constructor(s={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const g=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&g.classList.add("maplibregl-compact"):g.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=S.create("div","maplibregl-ctrl");const h=S.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){S.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Xn{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const h=++this._id;return this._queue.push({callback:s,id:h,cancelled:!1}),h}remove(s){const h=this._currentlyRunning,g=h?this._queue.concat(h):this._queue;for(const y of g)if(y.id===s)return void(y.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const g of h)if(!g.cancelled&&(g.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Nc=a.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Ip extends a.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,h){this.sourceCache.update(s,h),this._renderableTilesKeys=[];const g={};for(const y of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))g[y.key]=!0,this._renderableTilesKeys.push(y.key),this._tiles[y.key]||(y.posMatrix=new Float64Array(16),a.aP(y.posMatrix,0,a.X,0,a.X,0,1),this._tiles[y.key]=new Nr(y,this.tileSize));for(const y in this._tiles)g[y]||delete this._tiles[y]}freeRtt(s){for(const h in this._tiles){const g=this._tiles[h];(!s||g.tileID.equals(s)||g.tileID.isChildOf(s)||s.isChildOf(g.tileID))&&(g.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const h={};for(const g of this._renderableTilesKeys){const y=this._tiles[g].tileID;if(y.canonical.equals(s.canonical)){const w=s.clone();w.posMatrix=new Float64Array(16),a.aP(w.posMatrix,0,a.X,0,a.X,0,1),h[g]=w}else if(y.canonical.isChildOf(s.canonical)){const w=s.clone();w.posMatrix=new Float64Array(16);const E=y.canonical.z-s.canonical.z,B=y.canonical.x-(y.canonical.x>>E<<E),j=y.canonical.y-(y.canonical.y>>E<<E),Y=a.X>>E;a.aP(w.posMatrix,0,Y,0,Y,0,1),a.J(w.posMatrix,w.posMatrix,[-B*Y,-j*Y,0]),h[g]=w}else if(s.canonical.isChildOf(y.canonical)){const w=s.clone();w.posMatrix=new Float64Array(16);const E=s.canonical.z-y.canonical.z,B=s.canonical.x-(s.canonical.x>>E<<E),j=s.canonical.y-(s.canonical.y>>E<<E),Y=a.X>>E;a.aP(w.posMatrix,0,a.X,0,a.X,0,1),a.J(w.posMatrix,w.posMatrix,[B*Y,j*Y,0]),a.K(w.posMatrix,w.posMatrix,[1/2**E,1/2**E,0]),h[g]=w}}return h}getSourceTile(s,h){const g=this.sourceCache._source;let y=s.overscaledZ-this.deltaZoom;if(y>g.maxzoom&&(y=g.maxzoom),y<g.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(y).key);let w=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!w||!w.dem)&&h)for(;y>=g.minzoom&&(!w||!w.dem);)w=this.sourceCache.getTileByID(s.scaledTo(y--).key);return w}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=s)}}class $c{constructor(s,h,g){this.painter=s,this.sourceCache=new Ip(h),this.options=g,this.exaggeration=typeof g.exaggeration=="number"?g.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,h,g,y=a.X){var w;if(!(h>=0&&h<y&&g>=0&&g<y))return 0;const E=this.getTerrainData(s),B=(w=E.tile)===null||w===void 0?void 0:w.dem;if(!B)return 0;const j=function(Se,ze,Re){var Be=ze[0],$e=ze[1];return Se[0]=Re[0]*Be+Re[4]*$e+Re[12],Se[1]=Re[1]*Be+Re[5]*$e+Re[13],Se}([],[h/y*a.X,g/y*a.X],E.u_terrain_matrix),Y=[j[0]*B.dim,j[1]*B.dim],re=Math.floor(Y[0]),ie=Math.floor(Y[1]),_e=Y[0]-re,Ae=Y[1]-ie;return B.get(re,ie)*(1-_e)*(1-Ae)+B.get(re+1,ie)*_e*(1-Ae)+B.get(re,ie+1)*(1-_e)*Ae+B.get(re+1,ie+1)*_e*Ae}getElevationForLngLatZoom(s,h){if(!a.bb(h,s.wrap()))return 0;const{tileID:g,mercatorX:y,mercatorY:w}=this._getOverscaledTileIDFromLngLatZoom(s,h);return this.getElevation(g,y%a.X,w%a.X,a.X)}getElevation(s,h,g,y=a.X){return this.getDEMElevation(s,h,g,y)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const y=this.painter.context,w=new a.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new F(y,w,y.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new F(y,new a.R({width:1,height:1}),y.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=a.an([])}const h=this.sourceCache.getSourceTile(s,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const y=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new F(y,h.dem.getPixels(),y.gl.RGBA,{premultiply:!1}),h.demTexture.bind(y.gl.NEAREST,y.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const g=h&&h+h.tileID.key+s.key;if(g&&!this._demMatrixCache[g]){const y=this.sourceCache.sourceCache._source.maxzoom;let w=s.canonical.z-h.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=y?w=s.canonical.z-y:a.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const E=s.canonical.x-(s.canonical.x>>w<<w),B=s.canonical.y-(s.canonical.y>>w<<w),j=a.bc(new Float64Array(16),[1/(a.X<<w),1/(a.X<<w),0]);a.J(j,j,[E*a.X,B*a.X,0]),this._demMatrixCache[s.key]={matrix:j,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:g?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(s){const h=this.painter,g=h.width/devicePixelRatio,y=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===g&&this._fbo.height===y||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new F(h.context,{width:g,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new F(h.context,{width:g,height:y,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(g,y,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,g,y))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let w=0,E=0;w<this._coordsTextureSize;w++)for(let B=0;B<this._coordsTextureSize;B++,E+=4)h[E+0]=255&B,h[E+1]=255&w,h[E+2]=B>>8<<4|w>>8,h[E+3]=0;const g=new a.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),y=new F(s,g,s.gl.RGBA,{premultiply:!1});return y.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=y,y}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),g=this.painter.context,y=g.gl,w=Math.round(s.x*this.painter.pixelRatio/devicePixelRatio),E=Math.round(s.y*this.painter.pixelRatio/devicePixelRatio),B=Math.round(this.painter.height/devicePixelRatio);g.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),y.readPixels(w,B-E-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),g.bindFramebuffer.set(null);const j=h[0]+(h[2]>>4<<8),Y=h[1]+((15&h[2])<<8),re=this.coordsIndex[255-h[3]],ie=re&&this.sourceCache.getTileByID(re);if(!ie)return null;const _e=this._coordsTextureSize,Ae=(1<<ie.tileID.canonical.z)*_e;return new a.Z((ie.tileID.canonical.x*_e+j)/Ae+ie.tileID.wrap,(ie.tileID.canonical.y*_e+Y)/Ae,this.getElevation(ie.tileID,j,Y,_e))}depthAtPoint(s){const h=new Uint8Array(4),g=this.painter.context,y=g.gl;return g.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),y.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,y.RGBA,y.UNSIGNED_BYTE,h),g.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,h=new a.bd,g=new a.aY,y=this.meshSize,w=a.X/y,E=y*y;for(let ie=0;ie<=y;ie++)for(let _e=0;_e<=y;_e++)h.emplaceBack(_e*w,ie*w,0);for(let ie=0;ie<E;ie+=y+1)for(let _e=0;_e<y;_e++)g.emplaceBack(_e+ie,y+_e+ie+1,y+_e+ie+2),g.emplaceBack(_e+ie,y+_e+ie+2,_e+ie+1);const B=h.length,j=B+2*(y+1);for(const ie of[0,1])for(let _e=0;_e<=y;_e++)for(const Ae of[0,1])h.emplaceBack(_e*w,ie*a.X,Ae);for(let ie=0;ie<2*y;ie+=2)g.emplaceBack(j+ie,j+ie+1,j+ie+3),g.emplaceBack(j+ie,j+ie+3,j+ie+2),g.emplaceBack(B+ie,B+ie+3,B+ie+1),g.emplaceBack(B+ie,B+ie+2,B+ie+3);const Y=h.length,re=Y+2*(y+1);for(const ie of[0,1])for(let _e=0;_e<=y;_e++)for(const Ae of[0,1])h.emplaceBack(ie*a.X,_e*w,Ae);for(let ie=0;ie<2*y;ie+=2)g.emplaceBack(Y+ie,Y+ie+1,Y+ie+3),g.emplaceBack(Y+ie,Y+ie+3,Y+ie+2),g.emplaceBack(re+ie,re+ie+3,re+ie+1),g.emplaceBack(re+ie,re+ie+2,re+ie+3);return this._mesh=new Hl(s.createVertexBuffer(h,Nc.members),s.createIndexBuffer(g),a.a0.simpleSegment(0,0,h.length,g.length)),this._mesh}getMeshFrameDelta(s){return 2*Math.PI*a.be/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,h){var g;const{tileID:y}=this._getOverscaledTileIDFromLngLatZoom(s,h);return(g=this.getMinMaxElevation(y).minElevation)!==null&&g!==void 0?g:0}getMinMaxElevation(s){const h=this.getTerrainData(s).tile,g={minElevation:null,maxElevation:null};return h&&h.dem&&(g.minElevation=h.dem.min*this.exaggeration,g.maxElevation=h.dem.max*this.exaggeration),g}_getOverscaledTileIDFromLngLatZoom(s,h){const g=a.Z.fromLngLat(s.wrap()),y=(1<<h)*a.X,w=g.x*y,E=g.y*y,B=Math.floor(w/a.X),j=Math.floor(E/a.X);return{tileID:new a.S(h,0,h,B,j),mercatorX:w,mercatorY:E}}}class Lp{constructor(s,h,g){this._context=s,this._size=h,this._tileSize=g,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),g=new F(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return g.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(g.texture),{id:s,fbo:h,texture:g,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>s.id!==h),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const va={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class $h{constructor(s,h){this.painter=s,this.terrain=h,this.pool=new Lp(s.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(g=>!s._layers[g].isHidden(h)),this._coordsDescendingInv={};for(const g in s.sourceCaches){this._coordsDescendingInv[g]={};const y=s.sourceCaches[g].getVisibleCoordinates();for(const w of y){const E=this.terrain.sourceCache.getTerrainCoords(w);for(const B in E)this._coordsDescendingInv[g][B]||(this._coordsDescendingInv[g][B]=[]),this._coordsDescendingInv[g][B].push(E[B])}}this._coordsDescendingInvStr={};for(const g of s._order){const y=s._layers[g],w=y.source;if(va[y.type]&&!this._coordsDescendingInvStr[w]){this._coordsDescendingInvStr[w]={};for(const E in this._coordsDescendingInv[w])this._coordsDescendingInvStr[w][E]=this._coordsDescendingInv[w][E].map(B=>B.key).sort().join()}}for(const g of this._renderableTiles)for(const y in this._coordsDescendingInvStr){const w=this._coordsDescendingInvStr[y][g.tileID.key];w&&w!==g.rttCoords[y]&&(g.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const h=s.type,g=this.painter,y=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(va[h]&&(this._prevType&&va[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(s.id),!y))return!0;if(va[this._prevType]||va[h]&&y){this._prevType=h;const w=this._stacks.length-1,E=this._stacks[w]||[];for(const B of this._renderableTiles){if(this.pool.isFull()&&(Ph(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(B),B.rtt[w]){const Y=this.pool.getObjectForId(B.rtt[w].id);if(Y.stamp===B.rtt[w].stamp){this.pool.useObject(Y);continue}}const j=this.pool.getOrCreateFreeObject();this.pool.useObject(j),this.pool.stampObject(j),B.rtt[w]={id:j.id,stamp:j.stamp},g.context.bindFramebuffer.set(j.fbo.framebuffer),g.context.clear({color:a.aM.transparent,stencil:0}),g.currentStencilSource=void 0;for(let Y=0;Y<E.length;Y++){const re=g.style._layers[E[Y]],ie=re.source?this._coordsDescendingInv[re.source][B.tileID.key]:[B.tileID];g.context.viewport.set([0,0,j.fbo.width,j.fbo.height]),g._renderTileClippingMasks(re,ie),g.renderLayer(g,g.style.sourceCaches[re.source],re,ie),re.source&&(B.rttCoords[re.source]=this._coordsDescendingInvStr[re.source][B.tileID.key])}}return Ph(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),va[h]}return!1}}const jc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},jh=d,Pp={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ya,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:a.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Uc=x=>{x.touchstart=x.dragStart,x.touchmoveWindow=x.dragMove,x.touchend=x.dragEnd},zp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Dp{constructor(s,h,g=!1){this.mousedown=E=>{this.startMouse(a.e({},E,{ctrlKey:!0,preventDefault:()=>E.preventDefault()}),S.mousePos(this.element,E)),S.addEventListener(window,"mousemove",this.mousemove),S.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=E=>{this.moveMouse(E,S.mousePos(this.element,E))},this.mouseup=E=>{this.mouseRotate.dragEnd(E),this.mousePitch&&this.mousePitch.dragEnd(E),this.offTemp()},this.touchstart=E=>{E.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=S.touchPos(this.element,E.targetTouches)[0],this.startTouch(E,this._startPos),S.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),S.addEventListener(window,"touchend",this.touchend))},this.touchmove=E=>{E.targetTouches.length!==1?this.reset():(this._lastPos=S.touchPos(this.element,E.targetTouches)[0],this.moveTouch(E,this._lastPos))},this.touchend=E=>{E.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const y=s.dragRotate._mouseRotate.getClickTolerance(),w=s.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Ec({clickTolerance:y,enable:!0}),this.touchRotate=(({enable:E,clickTolerance:B,bearingDegreesPerPixelMoved:j=.8})=>{const Y=new Mc;return new ts({clickTolerance:B,move:(re,ie)=>({bearingDelta:(ie.x-re.x)*j}),moveStateManager:Y,enable:E,assignEvents:Uc})})({clickTolerance:y,enable:!0}),this.map=s,g&&(this.mousePitch=Ic({clickTolerance:w,enable:!0}),this.touchPitch=(({enable:E,clickTolerance:B,pitchDegreesPerPixelMoved:j=-.5})=>{const Y=new Mc;return new ts({clickTolerance:B,move:(re,ie)=>({pitchDelta:(ie.y-re.y)*j}),moveStateManager:Y,enable:E,assignEvents:Uc})})({clickTolerance:w,enable:!0})),S.addEventListener(h,"mousedown",this.mousedown),S.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),S.addEventListener(h,"touchcancel",this.reset)}startMouse(s,h){this.mouseRotate.dragStart(s,h),this.mousePitch&&this.mousePitch.dragStart(s,h),S.disableDrag()}startTouch(s,h){this.touchRotate.dragStart(s,h),this.touchPitch&&this.touchPitch.dragStart(s,h),S.disableDrag()}moveMouse(s,h){const g=this.map,{bearingDelta:y}=this.mouseRotate.dragMove(s,h)||{};if(y&&g.setBearing(g.getBearing()+y),this.mousePitch){const{pitchDelta:w}=this.mousePitch.dragMove(s,h)||{};w&&g.setPitch(g.getPitch()+w)}}moveTouch(s,h){const g=this.map,{bearingDelta:y}=this.touchRotate.dragMove(s,h)||{};if(y&&g.setBearing(g.getBearing()+y),this.touchPitch){const{pitchDelta:w}=this.touchPitch.dragMove(s,h)||{};w&&g.setPitch(g.getPitch()+w)}}off(){const s=this.element;S.removeEventListener(s,"mousedown",this.mousedown),S.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),S.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),S.removeEventListener(window,"touchend",this.touchend),S.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){S.enableDrag(),S.removeEventListener(window,"mousemove",this.mousemove),S.removeEventListener(window,"mouseup",this.mouseup),S.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),S.removeEventListener(window,"touchend",this.touchend)}}let Xi;function zr(x,s,h){const g=new a.N(x.lng,x.lat);if(x=new a.N(x.lng,x.lat),s){const y=new a.N(x.lng-360,x.lat),w=new a.N(x.lng+360,x.lat),E=h.locationPoint(x).distSqr(s);h.locationPoint(y).distSqr(s)<E?x=y:h.locationPoint(w).distSqr(s)<E&&(x=w)}for(;Math.abs(x.lng-h.center.lng)>180;){const y=h.locationPoint(x);if(y.x>=0&&y.y>=0&&y.x<=h.width&&y.y<=h.height)break;x.lng>h.center.lng?x.lng-=360:x.lng+=360}return x.lng!==g.lng&&h.locationPoint(x).y>h.height/2-h.getHorizon()?x:g}const wa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function iu(x,s,h){const g=x.classList;for(const y in wa)g.remove(`maplibregl-${h}-anchor-${y}`);g.add(`maplibregl-${h}-anchor-${s}`)}class ou extends a.E{constructor(s){if(super(),this._onKeyPress=h=>{const g=h.code,y=h.charCode||h.keyCode;g!=="Space"&&g!=="Enter"&&y!==32&&y!==13||this.togglePopup()},this._onMapClick=h=>{const g=h.originalEvent.target,y=this._element;this._popup&&(g===y||y.contains(g))&&this.togglePopup()},this._update=h=>{var g;if(!this._map)return;const y=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!y)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?zr(this._lngLat,this._flatPos,this._map.transform):(g=this._lngLat)===null||g===void 0?void 0:g.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let w="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?w=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(w=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let E="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?E="rotateX(0deg)":this._pitchAlignment==="map"&&(E=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||h&&h.type!=="moveend"||(this._pos=this._pos.round()),S.setTransform(this._element,`${wa[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${E} ${w}`),v.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const g=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new a.k("dragstart"))),this.fire(new a.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new a.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._subpixelPositioning=s&&s.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=a.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=S.create("div");const h=S.createNS("http://www.w3.org/2000/svg","svg"),g=41,y=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${g}px`),h.setAttributeNS(null,"width",`${y}px`),h.setAttributeNS(null,"viewBox",`0 0 ${y} ${g}`);const w=S.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");const E=S.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");const B=S.createNS("http://www.w3.org/2000/svg","g");B.setAttributeNS(null,"transform","translate(3.0, 29.0)"),B.setAttributeNS(null,"fill","#000000");const j=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Be of j){const $e=S.createNS("http://www.w3.org/2000/svg","ellipse");$e.setAttributeNS(null,"opacity","0.04"),$e.setAttributeNS(null,"cx","10.5"),$e.setAttributeNS(null,"cy","5.80029008"),$e.setAttributeNS(null,"rx",Be.rx),$e.setAttributeNS(null,"ry",Be.ry),B.appendChild($e)}const Y=S.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"fill",this._color);const re=S.createNS("http://www.w3.org/2000/svg","path");re.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Y.appendChild(re);const ie=S.createNS("http://www.w3.org/2000/svg","g");ie.setAttributeNS(null,"opacity","0.25"),ie.setAttributeNS(null,"fill","#000000");const _e=S.createNS("http://www.w3.org/2000/svg","path");_e.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),ie.appendChild(_e);const Ae=S.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");const Se=S.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ze=S.createNS("http://www.w3.org/2000/svg","circle");ze.setAttributeNS(null,"fill","#000000"),ze.setAttributeNS(null,"opacity","0.25"),ze.setAttributeNS(null,"cx","5.5"),ze.setAttributeNS(null,"cy","5.5"),ze.setAttributeNS(null,"r","5.4999962");const Re=S.createNS("http://www.w3.org/2000/svg","circle");Re.setAttributeNS(null,"fill","#FFFFFF"),Re.setAttributeNS(null,"cx","5.5"),Re.setAttributeNS(null,"cy","5.5"),Re.setAttributeNS(null,"r","5.4999962"),Se.appendChild(ze),Se.appendChild(Re),E.appendChild(B),E.appendChild(Y),E.appendChild(ie),E.appendChild(Ae),E.appendChild(Se),h.appendChild(E),h.setAttributeNS(null,"height",g*this._scale+"px"),h.setAttributeNS(null,"width",y*this._scale+"px"),this._element.appendChild(h),this._offset=a.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),iu(this._element,this._anchor,"marker"),s&&s.className)for(const h of s.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(s){return this.remove(),this._map=s,this._element.setAttribute("aria-label",s._getUIString("Marker.Title")),s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),S.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=a.N.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const y=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(s){return this._subpixelPositioning=s,this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var h,g;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const y=this._map,w=y.terrain.depthAtPoint(this._pos),E=y.terrain.getElevationForLngLatZoom(this._lngLat,y.transform.tileZoom);if(y.transform.lngLatToCameraDepth(this._lngLat,E)-w<.006)return void(this._element.style.opacity=this._opacity);const B=-this._offset.y/y.transform._pixelPerMeter,j=Math.sin(y.getPitch()*Math.PI/180)*B,Y=y.terrain.depthAtPoint(new a.P(this._pos.x,this._pos.y-this._offset.y)),re=y.transform.lngLatToCameraDepth(this._lngLat,E+j)-Y>.006;!((g=this._popup)===null||g===void 0)&&g.isOpen()&&re&&this._popup.remove(),this._element.style.opacity=re?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=a.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,h){return s===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Uh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let al=0,ll=!1;const No={maxWidth:100,unit:"metric"};function ul(x,s,h){const g=h&&h.maxWidth||100,y=x._container.clientHeight/2,w=x.unproject([0,y]),E=x.unproject([g,y]),B=w.distanceTo(E);if(h&&h.unit==="imperial"){const j=3.2808*B;j>5280?an(s,g,j/5280,x._getUIString("ScaleControl.Miles")):an(s,g,j,x._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?an(s,g,B/1852,x._getUIString("ScaleControl.NauticalMiles")):B>=1e3?an(s,g,B/1e3,x._getUIString("ScaleControl.Kilometers")):an(s,g,B,x._getUIString("ScaleControl.Meters"))}function an(x,s,h,g){const y=function(w){const E=Math.pow(10,`${Math.floor(w)}`.length-1);let B=w/E;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:B>=1?1:function(j){const Y=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*Y)/Y}(B),E*B}(h);x.style.width=s*(y/h)+"px",x.innerHTML=`${y}&nbsp;${g}`}const An={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},su=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function au(x){if(x){if(typeof x=="number"){const s=Math.round(Math.abs(x)/Math.SQRT2);return{center:new a.P(0,0),top:new a.P(0,x),"top-left":new a.P(s,s),"top-right":new a.P(-s,s),bottom:new a.P(0,-x),"bottom-left":new a.P(s,-s),"bottom-right":new a.P(-s,-s),left:new a.P(x,0),right:new a.P(-x,0)}}if(x instanceof a.P||Array.isArray(x)){const s=a.P.convert(x);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:a.P.convert(x.center||[0,0]),top:a.P.convert(x.top||[0,0]),"top-left":a.P.convert(x["top-left"]||[0,0]),"top-right":a.P.convert(x["top-right"]||[0,0]),bottom:a.P.convert(x.bottom||[0,0]),"bottom-left":a.P.convert(x["bottom-left"]||[0,0]),"bottom-right":a.P.convert(x["bottom-right"]||[0,0]),left:a.P.convert(x.left||[0,0]),right:a.P.convert(x.right||[0,0])}}return au(new a.P(0,0))}const Vc=d;u.AJAXError=a.bh,u.Evented=a.E,u.LngLat=a.N,u.MercatorCoordinate=a.Z,u.Point=a.P,u.addProtocol=a.bi,u.config=a.a,u.removeProtocol=a.bj,u.AttributionControl=ba,u.BoxZoomHandler=Wi,u.CanvasSource=Dt,u.CooperativeGesturesHandler=_a,u.DoubleClickZoomHandler=js,u.DragPanHandler=Fh,u.DragRotateHandler=Oh,u.EdgeInsets=pa,u.FullscreenControl=class extends a.E{constructor(x={}){super(),this._onFullscreenChange=()=>{var s;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=h==null?void 0:h.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,x&&x.container&&(x.container instanceof HTMLElement?this._container=x.container:a.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(x){return this._map=x,this._container||(this._container=this._map.getContainer()),this._controlContainer=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){S.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const x=this._fullscreenButton=S.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);S.create("span","maplibregl-ctrl-icon",x).setAttribute("aria-hidden","true"),x.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const x=this._getTitle();this._fullscreenButton.setAttribute("aria-label",x),this._fullscreenButton.title=x}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new a.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new a.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=Tt,u.GeolocateControl=class extends a.E{constructor(x){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new a.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new a.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const h=new a.N(s.coords.longitude,s.coords.latitude),g=s.coords.accuracy,y=this._map.getBearing(),w=a.e({bearing:y},this.options.fitBoundsOptions),E=Ge.fromLngLat(h,g);this._map.fitBounds(E,w,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const h=new a.N(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&ll)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new a.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=S.create("button","maplibregl-ctrl-geolocate",this._container),S.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=s=>{if(this._map){if(s===!1){a.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=S.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new ou({element:this._dotElement}),this._circleElement=S.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ou({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new a.k("trackuserlocationend")),this.fire(new a.k("userlocationlostfocus")))})}},this.options=a.e({},Uh,x)}onAdd(x){return this._map=x,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return a._(this,arguments,void 0,function*(s=!1){if(Xi!==void 0&&!s)return Xi;if(window.navigator.permissions===void 0)return Xi=!!window.navigator.geolocation,Xi;try{Xi=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Xi=!!window.navigator.geolocation}return Xi})}().then(s=>this._finishSetupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),S.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,al=0,ll=!1}_isOutOfMapMaxBounds(x){const s=this._map.getMaxBounds(),h=x.coords;return s&&(h.longitude<s.getWest()||h.longitude>s.getEast()||h.latitude<s.getSouth()||h.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const x=this._map.getBounds(),s=x.getSouthEast(),h=x.getNorthEast(),g=s.distanceTo(h),y=Math.ceil(this._accuracy/(g/this._map._container.clientHeight)*2);this._circleElement.style.width=`${y}px`,this._circleElement.style.height=`${y}px`}trigger(){if(!this._setup)return a.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new a.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":al--,ll=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new a.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new a.k("trackuserlocationstart")),this.fire(new a.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let x;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),al++,al>1?(x={maximumAge:6e5,timeout:0},ll=!0):(x=this.options.positionOptions,ll=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,x)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=Xl,u.ImageSource=fr,u.KeyboardHandler=to,u.LngLatBounds=Ge,u.LogoControl=Oc,u.Map=class extends Nh{constructor(x){a.bf.mark(a.bg.create);const s=Object.assign(Object.assign({},Pp),x);if(s.minZoom!=null&&s.maxZoom!=null&&s.minZoom>s.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(s.minPitch!=null&&s.maxPitch!=null&&s.minPitch>s.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(s.minPitch!=null&&s.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(s.maxPitch!=null&&s.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ma(s.minZoom,s.maxZoom,s.minPitch,s.maxPitch,s.renderWorldCopies),{bearingSnap:s.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Xn,this._controls=[],this._mapId=a.a4(),this._contextLost=h=>{h.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new a.k("webglcontextlost",{originalEvent:h}))},this._contextRestored=h=>{this._setupPainter(),this.resize(),this._update(),this.fire(new a.k("webglcontextrestored",{originalEvent:h}))},this._onMapScroll=h=>{if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=s.interactive,this._maxTileCacheSize=s.maxTileCacheSize,this._maxTileCacheZoomLevels=s.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=s.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=s.preserveDrawingBuffer===!0,this._antialias=s.antialias===!0,this._trackResize=s.trackResize===!0,this._bearingSnap=s.bearingSnap,this._refreshExpiredTiles=s.refreshExpiredTiles===!0,this._fadeDuration=s.fadeDuration,this._crossSourceCollisions=s.crossSourceCollisions===!0,this._collectResourceTiming=s.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},jc),s.locale),this._clickTolerance=s.clickTolerance,this._overridePixelRatio=s.pixelRatio,this._maxCanvasSize=s.maxCanvasSize,this.transformCameraUpdate=s.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=s.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=U.addThrottleControl(()=>this.isMoving()),this._requestManager=new O(s.transformRequest),typeof s.container=="string"){if(this._container=document.getElementById(s.container),!this._container)throw new Error(`Container '${s.container}' not found.`)}else{if(!(s.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=s.container}if(s.maxBounds&&this.setMaxBounds(s.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let h=!1;const g=tl(y=>{this._trackResize&&!this._removed&&(this.resize(y),this.redraw())},50);this._resizeObserver=new ResizeObserver(y=>{h?g(y):h=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Fc(this,s),this._hash=s.hash&&new Xl(typeof s.hash=="string"&&s.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}),s.bounds&&(this.resize(),this.fitBounds(s.bounds,a.e({},s.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=s.localIdeographFontFamily,this._validateStyle=s.validateStyle,s.style&&this.setStyle(s.style,{localIdeographFontFamily:s.localIdeographFontFamily}),s.attributionControl&&this.addControl(new ba(typeof s.attributionControl=="boolean"?void 0:s.attributionControl)),s.maplibreLogo&&this.addControl(new Oc,s.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",h=>{this._update(h.dataType==="style"),this.fire(new a.k(`${h.dataType}data`,h))}),this.on("dataloading",h=>{this.fire(new a.k(`${h.dataType}dataloading`,h))}),this.on("dataabort",h=>{this.fire(new a.k("sourcedataabort",h))})}_getMapId(){return this._mapId}addControl(x,s){if(s===void 0&&(s=x.getDefaultPosition?x.getDefaultPosition():"top-right"),!x||!x.onAdd)return this.fire(new a.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=x.onAdd(this);this._controls.push(x);const g=this._controlPositions[s];return s.indexOf("bottom")!==-1?g.insertBefore(h,g.firstChild):g.appendChild(h),this}removeControl(x){if(!x||!x.onRemove)return this.fire(new a.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(x);return s>-1&&this._controls.splice(s,1),x.onRemove(this),this}hasControl(x){return this._controls.indexOf(x)>-1}calculateCameraOptionsFromTo(x,s,h,g){return g==null&&this.terrain&&(g=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(x,s,h,g)}resize(x){var s;const h=this._containerDimensions(),g=h[0],y=h[1],w=this._getClampedPixelRatio(g,y);if(this._resizeCanvas(g,y,w),this.painter.resize(g,y,w),this.painter.overLimit()){const B=this.painter.context.gl;this._maxCanvasSize=[B.drawingBufferWidth,B.drawingBufferHeight];const j=this._getClampedPixelRatio(g,y);this._resizeCanvas(g,y,j),this.painter.resize(g,y,j)}this.transform.resize(g,y),(s=this._requestedCameraState)===null||s===void 0||s.resize(g,y);const E=!this._moving;return E&&(this.stop(),this.fire(new a.k("movestart",x)).fire(new a.k("move",x))),this.fire(new a.k("resize",x)),E&&this.fire(new a.k("moveend",x)),this}_getClampedPixelRatio(x,s){const{0:h,1:g}=this._maxCanvasSize,y=this.getPixelRatio(),w=x*y,E=s*y;return Math.min(w>h?h/w:1,E>g?g/E:1)*y}getPixelRatio(){var x;return(x=this._overridePixelRatio)!==null&&x!==void 0?x:devicePixelRatio}setPixelRatio(x){this._overridePixelRatio=x,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(x){return this.transform.setMaxBounds(Ge.convert(x)),this._update()}setMinZoom(x){if((x=x??-2)>=-2&&x<=this.transform.maxZoom)return this.transform.minZoom=x,this._update(),this.getZoom()<x&&this.setZoom(x),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(x){if((x=x??22)>=this.transform.minZoom)return this.transform.maxZoom=x,this._update(),this.getZoom()>x&&this.setZoom(x),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(x){if((x=x??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(x>=0&&x<=this.transform.maxPitch)return this.transform.minPitch=x,this._update(),this.getPitch()<x&&this.setPitch(x),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(x){if((x=x??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(x>=this.transform.minPitch)return this.transform.maxPitch=x,this._update(),this.getPitch()>x&&this.setPitch(x),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(x){return this.transform.renderWorldCopies=x,this._update()}project(x){return this.transform.locationPoint(a.N.convert(x),this.style&&this.terrain)}unproject(x){return this.transform.pointLocation(a.P.convert(x),this.terrain)}isMoving(){var x;return this._moving||((x=this.handlers)===null||x===void 0?void 0:x.isMoving())}isZooming(){var x;return this._zooming||((x=this.handlers)===null||x===void 0?void 0:x.isZooming())}isRotating(){var x;return this._rotating||((x=this.handlers)===null||x===void 0?void 0:x.isRotating())}_createDelegatedListener(x,s,h){if(x==="mouseenter"||x==="mouseover"){let g=!1;return{layers:s,listener:h,delegates:{mousemove:w=>{const E=s.filter(j=>this.getLayer(j)),B=E.length!==0?this.queryRenderedFeatures(w.point,{layers:E}):[];B.length?g||(g=!0,h.call(this,new vi(x,this,w.originalEvent,{features:B}))):g=!1},mouseout:()=>{g=!1}}}}if(x==="mouseleave"||x==="mouseout"){let g=!1;return{layers:s,listener:h,delegates:{mousemove:E=>{const B=s.filter(j=>this.getLayer(j));(B.length!==0?this.queryRenderedFeatures(E.point,{layers:B}):[]).length?g=!0:g&&(g=!1,h.call(this,new vi(x,this,E.originalEvent)))},mouseout:E=>{g&&(g=!1,h.call(this,new vi(x,this,E.originalEvent)))}}}}{const g=y=>{const w=s.filter(B=>this.getLayer(B)),E=w.length!==0?this.queryRenderedFeatures(y.point,{layers:w}):[];E.length&&(y.features=E,h.call(this,y),delete y.features)};return{layers:s,listener:h,delegates:{[x]:g}}}}_saveDelegatedListener(x,s){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[x]=this._delegatedListeners[x]||[],this._delegatedListeners[x].push(s)}_removeDelegatedListener(x,s,h){if(!this._delegatedListeners||!this._delegatedListeners[x])return;const g=this._delegatedListeners[x];for(let y=0;y<g.length;y++){const w=g[y];if(w.listener===h&&w.layers.length===s.length&&w.layers.every(E=>s.includes(E))){for(const E in w.delegates)this.off(E,w.delegates[E]);return void g.splice(y,1)}}}on(x,s,h){if(h===void 0)return super.on(x,s);const g=this._createDelegatedListener(x,typeof s=="string"?[s]:s,h);this._saveDelegatedListener(x,g);for(const y in g.delegates)this.on(y,g.delegates[y]);return this}once(x,s,h){if(h===void 0)return super.once(x,s);const g=typeof s=="string"?[s]:s,y=this._createDelegatedListener(x,g,h);for(const w in y.delegates){const E=y.delegates[w];y.delegates[w]=(...B)=>{this._removeDelegatedListener(x,g,h),E(...B)}}this._saveDelegatedListener(x,y);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(x,s,h){return h===void 0?super.off(x,s):(this._removeDelegatedListener(x,typeof s=="string"?[s]:s,h),this)}queryRenderedFeatures(x,s){if(!this.style)return[];let h;const g=x instanceof a.P||Array.isArray(x),y=g?x:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(g?{}:x)||{},y instanceof a.P||typeof y[0]=="number")h=[a.P.convert(y)];else{const w=a.P.convert(y[0]),E=a.P.convert(y[1]);h=[w,new a.P(E.x,w.y),E,new a.P(w.x,E.y),w]}return this.style.queryRenderedFeatures(h,s,this.transform)}querySourceFeatures(x,s){return this.style.querySourceFeatures(x,s)}setStyle(x,s){return(s=a.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&x?(this._diffStyle(x,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(x,s))}setTransformRequest(x){return this._requestManager.setTransformRequest(x),this}_getUIString(x){const s=this._locale[x];if(s==null)throw new Error(`Missing UI string '${x}'`);return s}_updateStyle(x,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(x,s));const h=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!x)),x?(this.style=new Pl(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof x=="string"?this.style.loadURL(x,s,h):this.style.loadJSON(x,s,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Pl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(x,s){if(typeof x=="string"){const h=this._requestManager.transformRequest(x,"Style");a.h(h,new AbortController).then(g=>{this._updateDiff(g.data,s)}).catch(g=>{g&&this.fire(new a.j(g))})}else typeof x=="object"&&this._updateDiff(x,s)}_updateDiff(x,s){try{this.style.setState(x,s)&&this._update(!0)}catch(h){a.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(x,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():a.w("There is no style added to the map.")}addSource(x,s){return this._lazyInitEmptyStyle(),this.style.addSource(x,s),this._update(!0)}isSourceLoaded(x){const s=this.style&&this.style.sourceCaches[x];if(s!==void 0)return s.loaded();this.fire(new a.j(new Error(`There is no source with ID '${x}'`)))}setTerrain(x){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),x){const s=this.style.sourceCaches[x.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${x.source}`);this.terrain===null&&s.reload();for(const h in this.style._layers){const g=this.style._layers[h];g.type==="hillshade"&&g.source===x.source&&a.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new $c(this.painter,s,x),this.painter.renderToTexture=new $h(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==x.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new a.k("terrain",{terrain:x})),this}getTerrain(){var x,s;return(s=(x=this.terrain)===null||x===void 0?void 0:x.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const x=this.style&&this.style.sourceCaches;for(const s in x){const h=x[s]._tiles;for(const g in h){const y=h[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}removeSource(x){return this.style.removeSource(x),this._update(!0)}getSource(x){return this.style.getSource(x)}addImage(x,s,h={}){const{pixelRatio:g=1,sdf:y=!1,stretchX:w,stretchY:E,content:B,textFitWidth:j,textFitHeight:Y}=h;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||a.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:re,height:ie,data:_e}=s,Ae=s;return this.style.addImage(x,{data:new a.R({width:re,height:ie},new Uint8Array(_e)),pixelRatio:g,stretchX:w,stretchY:E,content:B,textFitWidth:j,textFitHeight:Y,sdf:y,version:0,userImage:Ae}),Ae.onAdd&&Ae.onAdd(this,x),this}}{const{width:re,height:ie,data:_e}=v.getImageData(s);this.style.addImage(x,{data:new a.R({width:re,height:ie},_e),pixelRatio:g,stretchX:w,stretchY:E,content:B,textFitWidth:j,textFitHeight:Y,sdf:y,version:0})}}updateImage(x,s){const h=this.style.getImage(x);if(!h)return this.fire(new a.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=s instanceof HTMLImageElement||a.b(s)?v.getImageData(s):s,{width:y,height:w,data:E}=g;if(y===void 0||w===void 0)return this.fire(new a.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==h.data.width||w!==h.data.height)return this.fire(new a.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const B=!(s instanceof HTMLImageElement||a.b(s));return h.data.replace(E,B),this.style.updateImage(x,h),this}getImage(x){return this.style.getImage(x)}hasImage(x){return x?!!this.style.getImage(x):(this.fire(new a.j(new Error("Missing required image id"))),!1)}removeImage(x){this.style.removeImage(x)}loadImage(x){return U.getImage(this._requestManager.transformRequest(x,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(x,s){return this._lazyInitEmptyStyle(),this.style.addLayer(x,s),this._update(!0)}moveLayer(x,s){return this.style.moveLayer(x,s),this._update(!0)}removeLayer(x){return this.style.removeLayer(x),this._update(!0)}getLayer(x){return this.style.getLayer(x)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(x,s,h){return this.style.setLayerZoomRange(x,s,h),this._update(!0)}setFilter(x,s,h={}){return this.style.setFilter(x,s,h),this._update(!0)}getFilter(x){return this.style.getFilter(x)}setPaintProperty(x,s,h,g={}){return this.style.setPaintProperty(x,s,h,g),this._update(!0)}getPaintProperty(x,s){return this.style.getPaintProperty(x,s)}setLayoutProperty(x,s,h,g={}){return this.style.setLayoutProperty(x,s,h,g),this._update(!0)}getLayoutProperty(x,s){return this.style.getLayoutProperty(x,s)}setGlyphs(x,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(x,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(x,s,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(x,s,h,g=>{g||this._update(!0)}),this}removeSprite(x){return this._lazyInitEmptyStyle(),this.style.removeSprite(x),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(x,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(x,s,h=>{h||this._update(!0)}),this}setLight(x,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(x,s),this._update(!0)}getLight(){return this.style.getLight()}setSky(x){return this._lazyInitEmptyStyle(),this.style.setSky(x),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(x,s){return this.style.setFeatureState(x,s),this._update()}removeFeatureState(x,s){return this.style.removeFeatureState(x,s),this._update()}getFeatureState(x){return this.style.getFeatureState(x)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let x=0,s=0;return this._container&&(x=this._container.clientWidth||400,s=this._container.clientHeight||300),[x,s]}_setupContainer(){const x=this._container;x.classList.add("maplibregl-map");const s=this._canvasContainer=S.create("div","maplibregl-canvas-container",x);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=S.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),g=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],g);const y=this._controlContainer=S.create("div","maplibregl-control-container",x),w=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{w[E]=S.create("div",`maplibregl-ctrl-${E} `,y)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(x,s,h){this._canvas.width=Math.floor(h*x),this._canvas.height=Math.floor(h*s),this._canvas.style.width=`${x}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const x={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",g=>{s={requestedAttributes:x},g&&(s.statusMessage=g.statusMessage,s.type=g.type)},{once:!0});const h=this._canvas.getContext("webgl2",x)||this._canvas.getContext("webgl",x);if(!h){const g="Failed to initialize WebGL";throw s?(s.message=g,new Error(JSON.stringify(s))):new Error(g)}this.painter=new Wl(h,this.transform),T.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(x){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||x,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(x){return this._update(),this._renderTaskQueue.add(x)}_cancelRenderFrame(x){this._renderTaskQueue.remove(x)}_render(x){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(x),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const y=this.transform.zoom,w=v.now();this.style.zoomHistory.update(y,w);const E=new a.z(y,{now:w,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),B=E.crossFadingFactor();B===1&&B===this._crossFadingFactor||(h=!0,this._crossFadingFactor=B),this.style.update(E)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new a.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.bf.mark(a.bg.load),this.fire(new a.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new a.k("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,a.bf.mark(a.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var x;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),U.removeThrottleControl(this._imageQueueHandle),(x=this._resizeObserver)===null||x===void 0||x.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s!=null&&s.loseContext&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),S.remove(this._canvasContainer),S.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),a.bf.clearMetrics(),this._removed=!0,this.fire(new a.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,v.frameAsync(this._frameRequest).then(x=>{a.bf.frame(x),this._frameRequest=null,this._render(x)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(x){this._showTileBoundaries!==x&&(this._showTileBoundaries=x,this._update())}get showPadding(){return!!this._showPadding}set showPadding(x){this._showPadding!==x&&(this._showPadding=x,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(x){this._showCollisionBoxes!==x&&(this._showCollisionBoxes=x,x?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(x){this._showOverdrawInspector!==x&&(this._showOverdrawInspector=x,this._update())}get repaint(){return!!this._repaint}set repaint(x){this._repaint!==x&&(this._repaint=x,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(x){this._vertices=x,this._update()}get version(){return jh}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=vi,u.MapTouchEvent=Ns,u.MapWheelEvent=Dh,u.Marker=ou,u.NavigationControl=class{constructor(x){this._updateZoomButtons=()=>{const s=this._map.getZoom(),h=s===this._map.getMaxZoom(),g=s===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,h)=>{const g=this._map._getUIString(`NavigationControl.${h}`);s.title=g,s.setAttribute("aria-label",g)},this.options=a.e({},zp,x),this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),S.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),S.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=S.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(x){return this._map=x,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Dp(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){S.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(x,s){const h=S.create("button",x,this._container);return h.type="button",h.addEventListener("click",s),h}},u.Popup=class extends a.E{constructor(x){super(),this.remove=()=>(this._content&&S.remove(this._content),this._container&&(S.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new a.k("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=S.create("div","maplibregl-popup",this._map.getContainer()),this._tip=S.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const B of this.options.className.split(" "))this._container.classList.add(B);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?zr(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!s)return;const g=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationPoint(this._lngLat));let y=this.options.anchor;const w=au(this.options.offset);if(!y){const B=this._container.offsetWidth,j=this._container.offsetHeight;let Y;Y=g.y+w.bottom.y<j?["top"]:g.y>this._map.transform.height-j?["bottom"]:[],g.x<B/2?Y.push("left"):g.x>this._map.transform.width-B/2&&Y.push("right"),y=Y.length===0?"bottom":Y.join("-")}let E=g.add(w[y]);this.options.subpixelPositioning||(E=E.round()),S.setTransform(this._container,`${wa[y]} translate(${E.x}px,${E.y}px)`),iu(this._container,y,"popup")},this._onClose=()=>{this.remove()},this.options=a.e(Object.create(An),x)}addTo(x){return this._map&&this.remove(),this._map=x,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new a.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(x){return this._lngLat=a.N.convert(x),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(x){return this.setDOMContent(document.createTextNode(x))}setHTML(x){const s=document.createDocumentFragment(),h=document.createElement("body");let g;for(h.innerHTML=x;g=h.firstChild,g;)s.appendChild(g);return this.setDOMContent(s)}getMaxWidth(){var x;return(x=this._container)===null||x===void 0?void 0:x.style.maxWidth}setMaxWidth(x){return this.options.maxWidth=x,this._update(),this}setDOMContent(x){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=S.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(x),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(x){return this._container&&this._container.classList.add(x),this}removeClassName(x){return this._container&&this._container.classList.remove(x),this}setOffset(x){return this.options.offset=x,this._update(),this}toggleClassName(x){if(this._container)return this._container.classList.toggle(x)}setSubpixelPositioning(x){this.options.subpixelPositioning=x}_createCloseButton(){this.options.closeButton&&(this._closeButton=S.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const x=this._container.querySelector(su);x&&x.focus()}},u.RasterDEMTileSource=Ft,u.RasterTileSource=Ye,u.ScaleControl=class{constructor(x){this._onMove=()=>{ul(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,ul(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},No),x)}getDefaultPosition(){return"bottom-left"}onAdd(x){return this._map=x,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-scale",x.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){S.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=vo,u.Style=Pl,u.TerrainControl=class{constructor(x){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=x}onAdd(x){return this._map=x,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=S.create("button","maplibregl-ctrl-terrain",this._container),S.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){S.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=sl,u.TwoFingersTouchRotateHandler=Dc,u.TwoFingersTouchZoomHandler=Pc,u.TwoFingersTouchZoomRotateHandler=Bc,u.VectorTileSource=nn,u.VideoSource=un,u.addSourceType=(x,s)=>a._(void 0,void 0,void 0,function*(){if(Vr(x))throw new Error(`A source type called "${x}" already exists.`);((h,g)=>{Mt[h]=g})(x,s)}),u.clearPrewarmedResources=function(){const x=Ct;x&&(x.isPreloaded()&&x.numActive()===1?(x.release(it),Ct=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return a.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return jr().getRTLTextPluginStatus()},u.getVersion=function(){return Vc},u.getWorkerCount=function(){return at.workerCount},u.getWorkerUrl=function(){return a.a.WORKER_URL},u.importScriptInWorkers=function(x){return tn().broadcast("IS",x)},u.prewarm=function(){It().acquire(it)},u.setMaxParallelImageRequests=function(x){a.a.MAX_PARALLEL_IMAGE_REQUESTS=x},u.setRTLTextPlugin=function(x,s){return jr().setRTLTextPlugin(x,s)},u.setWorkerCount=function(x){at.workerCount=x},u.setWorkerUrl=function(x){a.a.WORKER_URL=x}});var o=t;return o})})(_w);var Sl=_w.exports;const ui=mw(Sl);function Y0(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function zk(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function Dk(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function nr(r,e){return["case",["boolean",["feature-state","hover"],!1],e,r]}var Na=Rk;function Rk(r){var e,t,n;if(r){if(Array.isArray(r)){for(e=[],t=r.length,n=0;n<t;n++){var i=r[n];i!=null&&e.push(i)}return e}if(typeof r=="object"){e={};var o=Object.keys(r);for(t=o.length,n=0;n<t;n++){var u=o[n],a=r[u];a!=null&&(e[u]=a)}return e}}}function Q0(r){let e=r[0],t,n,i=ey(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&gt(e,e=o[0])?(Zt(),G(i,1,1,ht),Ht(),i=ey(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){G(i),n=!1},d(o){o&&H(t),i.d(o)}}}function ey(r){let e;const t=r[36].default,n=_n(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&yn(n,t,i,i[35],e?vn(t,i[35],o,null):bn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Bk(r){let e,t,n=r[0]&&Q0(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=Q0(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function Fk(r,e,t){let n,i,o,u,a,d,m,_,v,S,T,C,{$$slots:L={},$$scope:P}=e,{id:D=Ua("layer")}=e,{source:I=void 0}=e,{sourceLayer:U=void 0}=e,{beforeId:O=void 0}=e,{beforeLayerType:ee=void 0}=e,{type:X}=e,{paint:ue=void 0}=e,{layout:$=void 0}=e,{filter:Q=void 0}=e,{applyToClusters:ne=void 0}=e,{minzoom:F=void 0}=e,{maxzoom:Z=void 0}=e,{manageHoverState:J=!1}=e,{hovered:be=null}=e,{interactive:ke=!0}=e,{hoverCursor:ge=void 0}=e,{eventsIfTopMost:ve=!1}=e;const fe=ps(),{map:Pe,source:Ee,self:Fe,minzoom:ot,maxzoom:ct,eventTopMost:it,layerInfo:at}=dw();rt(r,Pe,Ue=>t(31,v=Ue)),rt(r,Ee,Ue=>t(32,S=Ue)),rt(r,Fe,Ue=>t(0,_=Ue)),rt(r,ot,Ue=>t(34,C=Ue)),rt(r,ct,Ue=>t(33,T=Ue)),ei(()=>{_&&v&&(at.delete(_),v==null||v.removeLayer(_))});let ft;function Ct(Ue){var et,nn;if(!ke||!_||!v||ve&&it(Ue)!==_)return;let Xe=Ue.features??[],qt=(nn=(et=Xe[0])==null?void 0:et.properties)==null?void 0:nn.cluster_id,Ge={event:Ue,map:v,clusterId:qt,layer:_,source:a,features:Xe};fe(Ue.type,Ge)}function xt(Ue){var et,nn;if(!ke||!_||!v||ve&&it(Ue)!==_)return;ge&&(v.getCanvas().style.cursor=ge);let Xe=Ue.features??[];t(6,be=Xe[0]??null);let qt=(nn=(et=Xe[0])==null?void 0:et.properties)==null?void 0:nn.cluster_id;fe("mouseenter",{event:Ue,map:v,clusterId:qt,layer:_,source:a,features:Xe})}function It(Ue){var et,nn,Ye;if(!ke||!v)return;if(ve&&it(Ue)!==_){t(6,be=null),J&&ft!==void 0&&(v==null||v.setFeatureState({source:a,sourceLayer:U,id:ft},{hover:!1}),ft=void 0);return}v.getCanvas().style.cursor=ge;let Xe=Ue.features??[],qt=(nn=(et=Xe[0])==null?void 0:et.properties)==null?void 0:nn.cluster_id,Ge=(Ye=Xe[0])==null?void 0:Ye.id;Ge!==ft&&(J&&(ft!==void 0&&(v==null||v.setFeatureState({source:a,id:ft,sourceLayer:U},{hover:!1})),v==null||v.setFeatureState({source:a,id:Ge,sourceLayer:U},{hover:!0})),ft=Ge,t(6,be=Xe[0]??null)),fe("mousemove",{event:Ue,map:v,clusterId:qt,layer:_,source:a,features:Xe})}function Qt(Ue){if(!(!ke||!_||!v)){if(ge&&(v.getCanvas().style.cursor=""),t(6,be=null),J&&ft!==void 0){const Xe={source:a,id:ft,sourceLayer:U};v==null||v.setFeatureState(Xe,{hover:!1}),ft=void 0}fe("mouseleave",{map:v,layer:_,source:a})}}let tn=!0;function rn(Ue){v&&(v.off("click",Ue,Ct),v.off("dblclick",Ue,Ct),v.off("contextmenu",Ue,Ct),v.off("mouseenter",Ue,xt),v.off("mousemove",Ue,It),v.off("mouseleave",Ue,Qt))}return ei(()=>{v&&_&&rn(_)}),r.$$set=Ue=>{"id"in Ue&&t(7,D=Ue.id),"source"in Ue&&t(8,I=Ue.source),"sourceLayer"in Ue&&t(9,U=Ue.sourceLayer),"beforeId"in Ue&&t(10,O=Ue.beforeId),"beforeLayerType"in Ue&&t(11,ee=Ue.beforeLayerType),"type"in Ue&&t(12,X=Ue.type),"paint"in Ue&&t(13,ue=Ue.paint),"layout"in Ue&&t(14,$=Ue.layout),"filter"in Ue&&t(15,Q=Ue.filter),"applyToClusters"in Ue&&t(16,ne=Ue.applyToClusters),"minzoom"in Ue&&t(17,F=Ue.minzoom),"maxzoom"in Ue&&t(18,Z=Ue.maxzoom),"manageHoverState"in Ue&&t(19,J=Ue.manageHoverState),"hovered"in Ue&&t(6,be=Ue.hovered),"interactive"in Ue&&t(20,ke=Ue.interactive),"hoverCursor"in Ue&&t(21,ge=Ue.hoverCursor),"eventsIfTopMost"in Ue&&t(22,ve=Ue.eventsIfTopMost),"$$scope"in Ue&&t(35,P=Ue.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=Dk(ne)),r.$$.dirty[0]&1073774592&&t(24,i=zk("all",n,Q)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=F??C),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=Z??T),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=I||S),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&v&&_!==D&&a){_&&(rn(_),at.delete(_));let Ue=O;if(!O&&ee){let Xe=v.getStyle().layers,qt=typeof ee=="function"?ee:et=>et.type===ee,Ge=Xe==null?void 0:Xe.find(qt);Ge&&(Ue=Ge.id)}on(Fe,_=D,_),v.addLayer(Na({id:_,type:X,source:a,"source-layer":U,filter:i,paint:ue,layout:$,minzoom:o,maxzoom:u}),Ue),t(23,tn=!0),v.on("click",_,Ct),v.on("dblclick",_,Ct),v.on("contextmenu",_,Ct),v.on("mouseenter",_,xt),v.on("mousemove",_,It),v.on("mouseleave",_,Qt)}r.$$.dirty[0]&1048577&&_&&at.set(_,{interactive:ke}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=_?Y0((Ue,Xe)=>{v!=null&&v.style._loaded?v.setPaintProperty(_,Ue,Xe):v==null||v.once("styledata",()=>v==null?void 0:v.setPaintProperty(_,Ue,Xe))}):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,m=_?Y0((Ue,Xe)=>{v!=null&&v.style._loaded?v.setLayoutProperty(_,Ue,Xe):v==null||v.once("styledata",()=>v==null?void 0:v.setLayoutProperty(_,Ue,Xe))}):void 0),r.$$.dirty[0]&268443648&&(d==null||d(ue)),r.$$.dirty[0]&134234112&&(m==null||m($)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&_&&(v==null||v.setLayerZoomRange(_,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&_&&(tn?t(23,tn=!1):v==null||v.setFilter(_,i))},[_,Pe,Ee,Fe,ot,ct,be,D,I,U,O,ee,X,ue,$,Q,ne,F,Z,J,ke,ge,ve,tn,i,u,o,m,d,a,n,v,S,T,C,P,L]}let Xf=class extends kt{constructor(e){super(),St(this,e,Fk,Bk,gt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function Ok(r){let e;const t=r[16].default,n=_n(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&yn(n,t,i,i[24],e?vn(t,i[24],o,null):bn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Nk(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[Ok]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Xf({props:o}),wn.push(()=>On(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.applyToClusters=u[9]),a&1024&&(d.minzoom=u[10]),a&2048&&(d.maxzoom=u[11]),a&4096&&(d.hoverCursor=u[12]),a&8192&&(d.manageHoverState=u[13]),a&16384&&(d.eventsIfTopMost=u[14]),a&32768&&(d.interactive=u[15]),a&16777216&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function $k(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ua("circle")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:_}=e,{layout:v=void 0}=e,{filter:S=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:D=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:O=!0}=e;function ee(Z){I=Z,t(0,I)}function X(Z){Pn.call(this,r,Z)}function ue(Z){Pn.call(this,r,Z)}function $(Z){Pn.call(this,r,Z)}function Q(Z){Pn.call(this,r,Z)}function ne(Z){Pn.call(this,r,Z)}function F(Z){Pn.call(this,r,Z)}return r.$$set=Z=>{"id"in Z&&t(1,o=Z.id),"source"in Z&&t(2,u=Z.source),"sourceLayer"in Z&&t(3,a=Z.sourceLayer),"beforeId"in Z&&t(4,d=Z.beforeId),"beforeLayerType"in Z&&t(5,m=Z.beforeLayerType),"paint"in Z&&t(6,_=Z.paint),"layout"in Z&&t(7,v=Z.layout),"filter"in Z&&t(8,S=Z.filter),"applyToClusters"in Z&&t(9,T=Z.applyToClusters),"minzoom"in Z&&t(10,C=Z.minzoom),"maxzoom"in Z&&t(11,L=Z.maxzoom),"hoverCursor"in Z&&t(12,P=Z.hoverCursor),"manageHoverState"in Z&&t(13,D=Z.manageHoverState),"hovered"in Z&&t(0,I=Z.hovered),"eventsIfTopMost"in Z&&t(14,U=Z.eventsIfTopMost),"interactive"in Z&&t(15,O=Z.interactive),"$$scope"in Z&&t(24,i=Z.$$scope)},[I,o,u,a,d,m,_,v,S,T,C,L,P,D,U,O,n,ee,X,ue,$,Q,ne,F,i]}let Ml=class extends kt{constructor(e){super(),St(this,e,$k,Nk,gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function jk(r){let e,t;const n=r[7].default,i=_n(n,r,r[6],null);return{c(){e=q("div"),i&&i.c(),ce(e,"class",r[1]),Nt(e,"maplibregl-ctrl",r[0])},m(o,u){W(o,e,u),i&&i.m(e,null),r[8](e),t=!0},p(o,[u]){i&&i.p&&(!t||u&64)&&yn(i,n,o,o[6],t?vn(n,o[6],u,null):bn(o[6]),null),(!t||u&2)&&ce(e,"class",o[1]),(!t||u&3)&&Nt(e,"maplibregl-ctrl",o[0])},i(o){t||(N(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&H(e),i&&i.d(o),r[8](null)}}}function Uk(r,e,t){let n,{$$slots:i={},$$scope:o}=e,{defaultStyling:u=!0}=e,{position:a="top-right"}=e,{class:d=void 0}=e;const{map:m}=Va();rt(r,m,T=>t(5,n=T));let _,v={onAdd(){return _},onRemove(){var T;(T=_==null?void 0:_.parentNode)==null||T.removeChild(_)}};ei(()=>{n==null||n.removeControl(v)});function S(T){wn[T?"unshift":"push"](()=>{_=T,t(2,_)})}return r.$$set=T=>{"defaultStyling"in T&&t(0,u=T.defaultStyling),"position"in T&&t(4,a=T.position),"class"in T&&t(1,d=T.class),"$$scope"in T&&t(6,o=T.$$scope)},r.$$.update=()=>{r.$$.dirty&52&&n&&_&&n.addControl(v,a)},[u,d,_,m,a,n,o,i,S]}class Um extends kt{constructor(e){super(),St(this,e,Uk,jk,gt,{defaultStyling:0,position:4,class:1})}}function Vk(r){let e,t,n,i,o,u;const a=r[5].default,d=_n(a,r,r[4],null);return{c(){e=q("button"),t=q("div"),d&&d.c(),ce(t,"class",n=Oa(r[3])+" svelte-1s83zbq"),Nt(t,"maplibregl-ctrl-icon",r[0]),Nt(t,"ctrl-btn-center",r[1]),ce(e,"type","button"),ce(e,"title",r[2])},m(m,_){W(m,e,_),z(e,t),d&&d.m(t,null),i=!0,o||(u=_t(e,"click",r[6]),o=!0)},p(m,[_]){d&&d.p&&(!i||_&16)&&yn(d,a,m,m[4],i?vn(a,m[4],_,null):bn(m[4]),null),(!i||_&8&&n!==(n=Oa(m[3])+" svelte-1s83zbq"))&&ce(t,"class",n),(!i||_&9)&&Nt(t,"maplibregl-ctrl-icon",m[0]),(!i||_&10)&&Nt(t,"ctrl-btn-center",m[1]),(!i||_&4)&&ce(e,"title",m[2])},i(m){i||(N(d,m),i=!0)},o(m){G(d,m),i=!1},d(m){m&&H(e),d&&d.d(m),o=!1,u()}}}function qk(r,e,t){let{$$slots:n={},$$scope:i}=e,{icon:o=!0}=e,{center:u=!0}=e,{title:a=void 0}=e,{class:d=void 0}=e;function m(_){Pn.call(this,r,_)}return r.$$set=_=>{"icon"in _&&t(0,o=_.icon),"center"in _&&t(1,u=_.center),"title"in _&&t(2,a=_.title),"class"in _&&t(3,d=_.class),"$$scope"in _&&t(4,i=_.$$scope)},[o,u,a,d,i,n,m]}class bw extends kt{constructor(e){super(),St(this,e,qk,Vk,gt,{icon:0,center:1,title:2,class:3})}}function Gk(r){let e,t,n;const i=r[2].default,o=_n(i,r,r[1],null);return{c(){e=q("div"),o&&o.c(),ce(e,"class",t="maplibregl-ctrl-group "+r[0])},m(u,a){W(u,e,a),o&&o.m(e,null),n=!0},p(u,[a]){o&&o.p&&(!n||a&2)&&yn(o,i,u,u[1],n?vn(i,u[1],a,null):bn(u[1]),null),(!n||a&1&&t!==(t="maplibregl-ctrl-group "+u[0]))&&ce(e,"class",t)},i(u){n||(N(o,u),n=!0)},o(u){G(o,u),n=!1},d(u){u&&H(e),o&&o.d(u)}}}function Zk(r,e,t){let{$$slots:n={},$$scope:i}=e,{class:o=""}=e;return r.$$set=u=>{"class"in u&&t(0,o=u.class),"$$scope"in u&&t(1,i=u.$$scope)},[o,i,n]}class vw extends kt{constructor(e){super(),St(this,e,Zk,Gk,gt,{class:0})}}function Hk(r){let e;const t=r[15].default,n=_n(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&yn(n,t,i,i[23],e?vn(t,i[23],o,null):bn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Wk(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[Hk]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Xf({props:o}),wn.push(()=>On(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function Xk(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ua("fill")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:_}=e,{layout:v=void 0}=e,{filter:S=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:C=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:P=!1}=e,{hovered:D=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:U=!0}=e;function O(F){D=F,t(0,D)}function ee(F){Pn.call(this,r,F)}function X(F){Pn.call(this,r,F)}function ue(F){Pn.call(this,r,F)}function $(F){Pn.call(this,r,F)}function Q(F){Pn.call(this,r,F)}function ne(F){Pn.call(this,r,F)}return r.$$set=F=>{"id"in F&&t(1,o=F.id),"source"in F&&t(2,u=F.source),"sourceLayer"in F&&t(3,a=F.sourceLayer),"beforeId"in F&&t(4,d=F.beforeId),"beforeLayerType"in F&&t(5,m=F.beforeLayerType),"paint"in F&&t(6,_=F.paint),"layout"in F&&t(7,v=F.layout),"filter"in F&&t(8,S=F.filter),"minzoom"in F&&t(9,T=F.minzoom),"maxzoom"in F&&t(10,C=F.maxzoom),"hoverCursor"in F&&t(11,L=F.hoverCursor),"manageHoverState"in F&&t(12,P=F.manageHoverState),"hovered"in F&&t(0,D=F.hovered),"eventsIfTopMost"in F&&t(13,I=F.eventsIfTopMost),"interactive"in F&&t(14,U=F.interactive),"$$scope"in F&&t(23,i=F.$$scope)},[D,o,u,a,d,m,_,v,S,T,C,L,P,I,U,n,O,ee,X,ue,$,Q,ne,i]}let Zi=class extends kt{constructor(e){super(),St(this,e,Xk,Wk,gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function Jk(r,e,t){let n;const{map:i}=Va();rt(r,i,d=>t(4,n=d));let{position:o="top-left"}=e,{container:u=void 0}=e,a=null;return ei(()=>{n!=null&&n.loaded()&&a&&n.removeControl(a)}),r.$$set=d=>{"position"in d&&t(1,o=d.position),"container"in d&&t(2,u=d.container)},r.$$.update=()=>{if(r.$$.dirty&30&&n&&!a){let d;typeof u=="string"?d=document.querySelector(u)??void 0:d=u,t(3,a=new ui.FullscreenControl({container:d})),n.addControl(a,o)}},[i,o,u,a,n]}class Kk extends kt{constructor(e){super(),St(this,e,Jk,null,gt,{position:1,container:2})}}function ww(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):u())};a()}else u()}function xw(r,e,t){tw().then(()=>{let n=li(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function ty(r){let e=r[0],t,n,i=ny(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&gt(e,e=o[0])?(Zt(),G(i,1,1,ht),Ht(),i=ny(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){G(i),n=!1},d(o){o&&H(t),i.d(o)}}}function ny(r){let e;const t=r[19].default,n=_n(t,r,r[18],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&262144)&&yn(n,t,i,i[18],e?vn(t,i[18],o,null):bn(i[18]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function Yk(r){let e,t,n=r[0]&&ty(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=ty(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function Qk(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e,{id:d=Ua("geojson")}=e,{data:m}=e,{generateId:_=!1}=e,{promoteId:v=void 0}=e,{filter:S=void 0}=e,{lineMetrics:T=void 0}=e,{cluster:C=void 0}=e,{maxzoom:L=void 0}=e,{attribution:P=void 0}=e,{buffer:D=void 0}=e,{tolerance:I=void 0}=e;const{map:U,cluster:O,self:ee}=hw();rt(r,U,$=>t(17,i=$)),rt(r,O,$=>t(20,o=$)),rt(r,ee,$=>t(0,n=$));let X,ue=!0;return ei(()=>{n&&X&&i&&(xw(U,n,X),on(ee,n=null,n),t(15,X=void 0))}),r.$$set=$=>{"id"in $&&t(4,d=$.id),"data"in $&&t(5,m=$.data),"generateId"in $&&t(6,_=$.generateId),"promoteId"in $&&t(7,v=$.promoteId),"filter"in $&&t(8,S=$.filter),"lineMetrics"in $&&t(9,T=$.lineMetrics),"cluster"in $&&t(10,C=$.cluster),"maxzoom"in $&&t(11,L=$.maxzoom),"attribution"in $&&t(12,P=$.attribution),"buffer"in $&&t(13,D=$.buffer),"tolerance"in $&&t(14,I=$.tolerance),"$$scope"in $&&t(18,a=$.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&on(O,o=C,o),r.$$.dirty&196593&&i&&n!==d&&(on(ee,n=d,n),ww(i,n,Na({type:"geojson",data:m,filter:S,lineMetrics:T,generateId:_,promoteId:v,cluster:!!C,clusterMinPoints:C==null?void 0:C.minPoints,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius,clusterProperties:C==null?void 0:C.properties,maxzoom:L,attribution:P,buffer:D,tolerance:I}),$=>i&&$===n,()=>{n&&(t(15,X=i==null?void 0:i.getSource(n)),t(16,ue=!0))})),r.$$.dirty&131088&&(i==null||i.on("style.load",()=>{t(15,X=i==null?void 0:i.getSource(d))})),r.$$.dirty&98336&&X&&(ue?t(16,ue=!1):X.setData(m)),r.$$.dirty&33792&&(X==null||X.setClusterOptions(Na({cluster:!!C,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius})))},[n,U,O,ee,d,m,_,v,S,T,C,L,P,D,I,X,ue,i,a,u]}let yr=class extends kt{constructor(e){super(),St(this,e,Qk,Yk,gt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function e4(r,e,t){let n;const{map:i}=Va();rt(r,i,S=>t(8,n=S));let{position:o="top-left"}=e,{positionOptions:u=void 0}=e,{fitBoundsOptions:a=void 0}=e,{trackUserLocation:d=!1}=e,{showAccuracyCircle:m=!0}=e,{showUserLocation:_=!0}=e,{control:v=null}=e;return ei(()=>{n!=null&&n.loaded()&&v&&n.removeControl(v)}),r.$$set=S=>{"position"in S&&t(2,o=S.position),"positionOptions"in S&&t(3,u=S.positionOptions),"fitBoundsOptions"in S&&t(4,a=S.fitBoundsOptions),"trackUserLocation"in S&&t(5,d=S.trackUserLocation),"showAccuracyCircle"in S&&t(6,m=S.showAccuracyCircle),"showUserLocation"in S&&t(7,_=S.showUserLocation),"control"in S&&t(1,v=S.control)},r.$$.update=()=>{r.$$.dirty&510&&n&&!v&&(t(1,v=new ui.GeolocateControl({positionOptions:u,fitBoundsOptions:a,trackUserLocation:d,showAccuracyCircle:m,showUserLocation:_})),n.addControl(v,o))},[i,v,o,u,a,d,m,_,n]}class t4 extends kt{constructor(e){super(),St(this,e,e4,null,gt,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function n4(r){let e;const t=r[15].default,n=_n(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&yn(n,t,i,i[23],e?vn(t,i[23],o,null):bn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function r4(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"heatmap",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[n4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Xf({props:o}),wn.push(()=>On(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function i4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ua("heatmap")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:_}=e,{layout:v=void 0}=e,{filter:S=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:C=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:P=!1}=e,{hovered:D=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:U=!0}=e;function O(F){D=F,t(0,D)}function ee(F){Pn.call(this,r,F)}function X(F){Pn.call(this,r,F)}function ue(F){Pn.call(this,r,F)}function $(F){Pn.call(this,r,F)}function Q(F){Pn.call(this,r,F)}function ne(F){Pn.call(this,r,F)}return r.$$set=F=>{"id"in F&&t(1,o=F.id),"source"in F&&t(2,u=F.source),"sourceLayer"in F&&t(3,a=F.sourceLayer),"beforeId"in F&&t(4,d=F.beforeId),"beforeLayerType"in F&&t(5,m=F.beforeLayerType),"paint"in F&&t(6,_=F.paint),"layout"in F&&t(7,v=F.layout),"filter"in F&&t(8,S=F.filter),"minzoom"in F&&t(9,T=F.minzoom),"maxzoom"in F&&t(10,C=F.maxzoom),"hoverCursor"in F&&t(11,L=F.hoverCursor),"manageHoverState"in F&&t(12,P=F.manageHoverState),"hovered"in F&&t(0,D=F.hovered),"eventsIfTopMost"in F&&t(13,I=F.eventsIfTopMost),"interactive"in F&&t(14,U=F.interactive),"$$scope"in F&&t(23,i=F.$$scope)},[D,o,u,a,d,m,_,v,S,T,C,L,P,I,U,n,O,ee,X,ue,$,Q,ne,i]}class o4 extends kt{constructor(e){super(),St(this,e,i4,r4,gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function s4(r,e,t){let n,i,{data:o}=e,{idCol:u}=e,{sourceLayer:a=void 0}=e,d=new Set;const{map:m,source:_}=dw();return rt(r,m,v=>t(6,n=v)),rt(r,_,v=>t(7,i=v)),r.$$set=v=>{"data"in v&&t(2,o=v.data),"idCol"in v&&t(3,u=v.idCol),"sourceLayer"in v&&t(4,a=v.sourceLayer)},r.$$.update=()=>{if(r.$$.dirty&252&&o&&n&&i){let v=new Set;for(const S of o){const T=S[u];if(!T)continue;d.delete(T),v.add(T);const C={id:T,source:i,sourceLayer:a},L=n.getFeatureState(C);let P=!1;for(const D of Object.keys(S))if(L[D]!==S[D]){P=!0;break}P&&n.setFeatureState(C,S)}for(const S of d){const T={id:S,source:i,sourceLayer:a},C=n.getFeatureState(T);for(const L of Object.keys(C))n.removeFeatureState(T,L)}t(5,d=v)}},[m,_,o,u,a,d,n,i]}class a4 extends kt{constructor(e){super(),St(this,e,s4,null,gt,{data:2,idCol:3,sourceLayer:4})}}function l4(r){let e;const t=r[15].default,n=_n(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&yn(n,t,i,i[23],e?vn(t,i[23],o,null):bn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function u4(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[l4]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Xf({props:o}),wn.push(()=>On(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function c4(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ua("line")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:_}=e,{layout:v=void 0}=e,{filter:S=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:C=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:P=!1}=e,{hovered:D=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:U=!0}=e;function O(F){D=F,t(0,D)}function ee(F){Pn.call(this,r,F)}function X(F){Pn.call(this,r,F)}function ue(F){Pn.call(this,r,F)}function $(F){Pn.call(this,r,F)}function Q(F){Pn.call(this,r,F)}function ne(F){Pn.call(this,r,F)}return r.$$set=F=>{"id"in F&&t(1,o=F.id),"source"in F&&t(2,u=F.source),"sourceLayer"in F&&t(3,a=F.sourceLayer),"beforeId"in F&&t(4,d=F.beforeId),"beforeLayerType"in F&&t(5,m=F.beforeLayerType),"paint"in F&&t(6,_=F.paint),"layout"in F&&t(7,v=F.layout),"filter"in F&&t(8,S=F.filter),"minzoom"in F&&t(9,T=F.minzoom),"maxzoom"in F&&t(10,C=F.maxzoom),"hoverCursor"in F&&t(11,L=F.hoverCursor),"manageHoverState"in F&&t(12,P=F.manageHoverState),"hovered"in F&&t(0,D=F.hovered),"eventsIfTopMost"in F&&t(13,I=F.eventsIfTopMost),"interactive"in F&&t(14,U=F.interactive),"$$scope"in F&&t(23,i=F.$$scope)},[D,o,u,a,d,m,_,v,S,T,C,L,P,I,U,n,O,ee,X,ue,$,Q,ne,i]}let gr=class extends kt{constructor(e){super(),St(this,e,c4,u4,gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function f4(r,e,t){let n;const i=ps();let{layer:o=void 0}=e;const{map:u}=Va();rt(r,u,_=>t(2,n=_));function a(_){i(_.type,{..._,map:u})}const d=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","contextmenu","mouseover","mouseout"],m=["click","dblclick","contextmenu","mousemove","movestart","moveend","zoomstart","zoom","zoomend"];return ei(()=>{if(n)if(o)for(const _ of d)n.off(_,o,a);else for(const _ of m)n.off(_,a)}),r.$$set=_=>{"layer"in _&&t(1,o=_.layer)},r.$$.update=()=>{if(r.$$.dirty&6&&n)if(o)for(const _ of d)n.on(_,o,a);else for(const _ of m)n.on(_,a)},[u,o,n]}class tp extends kt{constructor(e){super(),St(this,e,f4,null,gt,{layer:1})}}function h4(r){let e=r.getCenter(),t=Math.round(r.getZoom()*100)/100,n=Math.ceil((t*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,n),o=Math.round(e.lat*i)/i,u=Math.round(e.lng*i)/i,a=`${t}/${o}/${u}`,d=r.getBearing(),m=r.getPitch();return(d||m)&&(a+=`/${Math.round(d*10)/10}`),m&&(a+=`/${Math.round(m)}`),`#${a}`}function d4(r){return r.replace("#","").split("/").map(parseFloat)}var Tu=Bg;function Bg(r,e){return r===e||r!==r&&e!==e?!0:typeof r!=typeof e||{}.toString.call(r)!={}.toString.call(e)||r!==Object(r)||!r?!1:Array.isArray(r)?ry(r,e):{}.toString.call(r)=="[object Set]"?ry(Array.from(r),Array.from(e)):{}.toString.call(r)=="[object Object]"?m4(r,e):p4(r,e)}function p4(r,e){return r.toString()===e.toString()}function ry(r,e){var t=r.length;if(t!=e.length)return!1;for(var n=0;n<t;n++)if(!Bg(r[n],e[n]))return!1;return!0}function m4(r,e){var t=Object.keys(r),n=t.length;if(n!=Object.keys(e).length)return!1;for(var i=0;i<n;i++){var o=t[i];if(!(e.hasOwnProperty(o)&&Bg(r[o],e[o])))return!1}return!0}function g4(r,e,t){let n;const{map:i}=Va();rt(r,i,_=>t(6,n=_));let{position:o="top-left"}=e,{showCompass:u=!0}=e,{showZoom:a=!0}=e,{visualizePitch:d=!1}=e,m=null;return ei(()=>{n!=null&&n.loaded()&&m&&n.removeControl(m)}),r.$$set=_=>{"position"in _&&t(1,o=_.position),"showCompass"in _&&t(2,u=_.showCompass),"showZoom"in _&&t(3,a=_.showZoom),"visualizePitch"in _&&t(4,d=_.visualizePitch)},r.$$.update=()=>{r.$$.dirty&126&&n&&!m&&(t(5,m=new ui.NavigationControl({showCompass:u,showZoom:a,visualizePitch:d})),n.addControl(m,o))},[i,o,u,a,d,m,n]}class Aw extends kt{constructor(e){super(),St(this,e,g4,null,gt,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function _4(r,e,t){let n;const{map:i}=Va();rt(r,i,m=>t(5,n=m));let{position:o="bottom-left"}=e,{maxWidth:u=void 0}=e,{unit:a="metric"}=e,d=null;return ei(()=>{n!=null&&n.loaded()&&d&&n.removeControl(d)}),r.$$set=m=>{"position"in m&&t(1,o=m.position),"maxWidth"in m&&t(2,u=m.maxWidth),"unit"in m&&t(3,a=m.unit)},r.$$.update=()=>{r.$$.dirty&62&&n&&!d&&(t(4,d=new ui.ScaleControl({maxWidth:u,unit:a})),n.addControl(d,o))},[i,o,u,a,d,n]}class kw extends kt{constructor(e){super(),St(this,e,_4,null,gt,{position:1,maxWidth:2,unit:3})}}const{window:y4}=Lg,b4=r=>({map:r[0]&16,loadedImages:r[0]&32,allImagesLoaded:r[0]&64}),iy=r=>({map:r[4],loadedImages:r[5],allImagesLoaded:r[6]});function oy(r){let e,t,n=r[3]&&sy(r);const i=r[46].default,o=_n(i,r,r[45],iy);return{c(){n&&n.c(),e=ae(),o&&o.c()},m(u,a){n&&n.m(u,a),W(u,e,a),o&&o.m(u,a),t=!0},p(u,a){u[3]?n?(n.p(u,a),a[0]&8&&N(n,1)):(n=sy(u),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht()),o&&o.p&&(!t||a[0]&112|a[1]&16384)&&yn(o,i,u,u[45],t?vn(i,u[45],a,b4):bn(u[45]),iy)},i(u){t||(N(n),N(o,u),t=!0)},o(u){G(n),G(o,u),t=!1},d(u){u&&H(e),n&&n.d(u),o&&o.d(u)}}}function sy(r){let e,t,n,i,o,u,a,d;return e=new Aw({props:{position:r[7]}}),n=new t4({props:{position:r[7],fitBoundsOptions:{maxZoom:12}}}),o=new Kk({props:{position:r[7]}}),a=new kw({props:{position:r[7]}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),W(m,i,_),de(o,m,_),W(m,u,_),de(a,m,_),d=!0},p(m,_){const v={};_[0]&128&&(v.position=m[7]),e.$set(v);const S={};_[0]&128&&(S.position=m[7]),n.$set(S);const T={};_[0]&128&&(T.position=m[7]),o.$set(T);const C={};_[0]&128&&(C.position=m[7]),a.$set(C)},i(m){d||(N(e.$$.fragment,m),N(n.$$.fragment,m),N(o.$$.fragment,m),N(a.$$.fragment,m),d=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),G(o.$$.fragment,m),G(a.$$.fragment,m),d=!1},d(m){m&&(H(t),H(i),H(u)),he(e,m),he(n,m),he(o,m),he(a,m)}}}function v4(r){let e,t,n,i,o,u=r[4]&&r[0]&&oy(r);return{c(){e=q("div"),u&&u.c(),ce(e,"class",t=Oa(r[2])+" svelte-p00lfq"),ce(e,"data-testid","map-container"),Nt(e,"expand-map",!r[2])},m(a,d){W(a,e,d),u&&u.m(e,null),r[47](e),n=!0,i||(o=[_t(y4,"hashchange",r[11]),jm(r[10].call(null,e))],i=!0)},p(a,d){a[4]&&a[0]?u?(u.p(a,d),d[0]&17&&N(u,1)):(u=oy(a),u.c(),N(u,1),u.m(e,null)):u&&(Zt(),G(u,1,1,()=>{u=null}),Ht()),(!n||d[0]&4&&t!==(t=Oa(a[2])+" svelte-p00lfq"))&&ce(e,"class",t),(!n||d[0]&4)&&Nt(e,"expand-map",!a[2])},i(a){n||(N(u),n=!0)},o(a){G(u),n=!1},d(a){a&&H(e),u&&u.d(),r[47](null),i=!1,Er(o)}}}function w4(r,e,t){let n,i,o,u,{$$slots:a={},$$scope:d}=e,{map:m=null}=e,{mapContainer:_=void 0}=e,{class:v=void 0}=e,{style:S}=e,{diffStyleUpdates:T=!1}=e,{center:C=void 0}=e,{zoom:L=void 0}=e,{pitch:P=0}=e,{bearing:D=0}=e,{bounds:I=void 0}=e,{hash:U=!1}=e,{updateHash:O=Ye=>{window.history.replaceState(window.history.state,"",Ye)}}=e,{loaded:ee=!1}=e,{minZoom:X=0}=e,{maxZoom:ue=22}=e,{minPitch:$=0}=e,{maxPitch:Q=60}=e,{renderWorldCopies:ne=void 0}=e,{dragPan:F=void 0}=e,{dragRotate:Z=void 0}=e,{pitchWithRotate:J=void 0}=e,{antialias:be=void 0}=e,{zoomOnDoubleClick:ke=!0}=e,{locale:ge=void 0}=e,{interactive:ve=!0}=e,{attributionControl:fe=!0}=e,{cooperativeGestures:Pe=!1}=e,{preserveDrawingBuffer:Ee=!1}=e,{maxBounds:Fe=void 0}=e,{images:ot=[]}=e,{standardControls:ct=!1}=e,{filterLayers:it=void 0}=e,{transformRequest:at=void 0}=e;const ft=ps(),{map:Ct,loadedImages:xt}=Ek();rt(r,Ct,Ye=>t(4,o=Ye)),rt(r,xt,Ye=>t(5,u=Ye));let It=new Set;async function Qt(Ye,Ft=!1){if(o&&!(!o.loaded()&&!Ft))if("url"in Ye){It.add(Ye.id);try{let Tt=await o.loadImage(Ye.url);o==null||o.addImage(Ye.id,Tt.data,Ye.options),u.add(Ye.id),xt.set(u)}catch(Tt){ft("error",Tt)}finally{It.delete(Ye.id)}}else o.addImage(Ye.id,Ye.data,Ye.options),u.add(Ye.id),xt.set(u)}let tn,rn,Ue,Xe;function qt(Ye){return et(),on(Ct,o=new ui.Map(Na({container:Ye,style:S,locale:ge,center:C,zoom:L,pitch:P,bearing:D,minZoom:X,maxZoom:ue,minPitch:$,maxPitch:Q,renderWorldCopies:ne,dragPan:F,dragRotate:Z,pitchWithRotate:J,antialias:be,interactive:ve,preserveDrawingBuffer:Ee,maxBounds:Fe,bounds:I,attributionControl:fe,transformRequest:at,cooperativeGestures:Pe})),o),o.on("load",Ft=>{Ft.target.getContainer().setAttribute("data-testid","map"),Ft.target.getCanvas().setAttribute("data-testid","map-canvas"),t(0,ee=!0),ft("load",o)}),o.on("error",Ft=>ft("error",{...Ft,map:o})),o.on("movestart",Ft=>ft("movestart",{...Ft,map:o})),o.on("moveend",Ft=>{if(t(12,C=Ft.target.getCenter()),t(13,L=Ft.target.getZoom()),t(14,P=Ft.target.getPitch()),t(15,D=Ft.target.getBearing()),t(16,I=Ft.target.getBounds()),ft("moveend",{...Ft,map:o}),U){let Tt=new URL(window.location.href.replace(/(#.+)?$/,h4(o)));O(Tt)}}),o.on("click",Ft=>ft("click",{...Ft,map:o})),o.on("dblclick",Ft=>ft("dblclick",{...Ft,map:o})),o.on("contextmenu",Ft=>ft("contextmenu",{...Ft,map:o})),o.on("zoomstart",Ft=>ft("zoomstart",{...Ft,map:o})),o.on("zoom",Ft=>{ft("zoom",{...Ft,map:o})}),o.on("zoomend",Ft=>{ft("zoomend",{...Ft,map:o})}),o.on("style.load",()=>{if(o){const Ft=o.getStyle();if(t(42,tn=Ft.layers.map(Tt=>Tt.id)),t(43,rn=Object.keys(Ft.sources)),Xe)for(const[Tt,Rn]of Object.entries(Xe))o.addSource(Tt,Rn);if(Ue)for(const Tt of Ue)o.addLayer(Tt);for(const Tt of ot)Qt(Tt,!0)}}),o.on("styledata",Ft=>{if(o&&it){const Tt=o.getStyle().layers;if(Tt)for(let Rn of Tt)it(Rn)||o.setLayoutProperty(Rn.id,"visibility","none")}ft("styledata",{...Ft,map:o})}),{destroy(){t(0,ee=!1),o==null||o.remove(),on(Ct,o=null,o)}}}let Ge=S;function et(){if(U){let Ye=d4(window.location.hash);Ye.length>=3&&(t(13,L=Ye[0]),t(12,C=[Ye[2],Ye[1]])),Ye.length==5&&(t(15,D=Ye[3]),t(14,P=Ye[4]))}}function nn(Ye){wn[Ye?"unshift":"push"](()=>{_=Ye,t(1,_)})}return r.$$set=Ye=>{"map"in Ye&&t(17,m=Ye.map),"mapContainer"in Ye&&t(1,_=Ye.mapContainer),"class"in Ye&&t(2,v=Ye.class),"style"in Ye&&t(18,S=Ye.style),"diffStyleUpdates"in Ye&&t(19,T=Ye.diffStyleUpdates),"center"in Ye&&t(12,C=Ye.center),"zoom"in Ye&&t(13,L=Ye.zoom),"pitch"in Ye&&t(14,P=Ye.pitch),"bearing"in Ye&&t(15,D=Ye.bearing),"bounds"in Ye&&t(16,I=Ye.bounds),"hash"in Ye&&t(20,U=Ye.hash),"updateHash"in Ye&&t(21,O=Ye.updateHash),"loaded"in Ye&&t(0,ee=Ye.loaded),"minZoom"in Ye&&t(22,X=Ye.minZoom),"maxZoom"in Ye&&t(23,ue=Ye.maxZoom),"minPitch"in Ye&&t(24,$=Ye.minPitch),"maxPitch"in Ye&&t(25,Q=Ye.maxPitch),"renderWorldCopies"in Ye&&t(26,ne=Ye.renderWorldCopies),"dragPan"in Ye&&t(27,F=Ye.dragPan),"dragRotate"in Ye&&t(28,Z=Ye.dragRotate),"pitchWithRotate"in Ye&&t(29,J=Ye.pitchWithRotate),"antialias"in Ye&&t(30,be=Ye.antialias),"zoomOnDoubleClick"in Ye&&t(31,ke=Ye.zoomOnDoubleClick),"locale"in Ye&&t(32,ge=Ye.locale),"interactive"in Ye&&t(33,ve=Ye.interactive),"attributionControl"in Ye&&t(34,fe=Ye.attributionControl),"cooperativeGestures"in Ye&&t(35,Pe=Ye.cooperativeGestures),"preserveDrawingBuffer"in Ye&&t(36,Ee=Ye.preserveDrawingBuffer),"maxBounds"in Ye&&t(37,Fe=Ye.maxBounds),"images"in Ye&&t(38,ot=Ye.images),"standardControls"in Ye&&t(3,ct=Ye.standardControls),"filterLayers"in Ye&&t(39,it=Ye.filterLayers),"transformRequest"in Ye&&t(40,at=Ye.transformRequest),"$$scope"in Ye&&t(45,d=Ye.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&8&&t(7,n=typeof ct=="boolean"?void 0:ct),r.$$.dirty[0]&16&&t(17,m=o),r.$$.dirty[0]&786448|r.$$.dirty[1]&14336&&o&&!Tu(S,Ge)){const Ye=o.getStyle();if(tn&&(Ue=Ye.layers.filter(Ft=>!tn.includes(Ft.id))),rn){const Ft=Object.keys(Ye.sources).filter(Tt=>!rn.includes(Tt));Xe={};for(const Tt of Ft)Xe[Tt]=Ye.sources[Tt]}t(44,Ge=S),o.setStyle(S,{diff:T}),on(xt,u=new Set,u),t(41,It=new Set)}if(r.$$.dirty[0]&49|r.$$.dirty[1]&1152&&ee&&o!=null&&o.loaded())for(let Ye of ot)!u.has(Ye.id)&&!It.has(Ye.id)&&!o.hasImage(Ye.id)&&Qt(Ye);if(r.$$.dirty[0]&32|r.$$.dirty[1]&128&&t(6,i=ot.every(Ye=>u.has(Ye.id))),r.$$.dirty[0]&61456&&o){let Ye={};C!=null&&!Tu(C,o==null?void 0:o.getCenter())&&(Ye.center=C),L!=null&&!Tu(L,o==null?void 0:o.getZoom())&&(Ye.zoom=L),D!=null&&!Tu(D,o==null?void 0:o.getBearing())&&(Ye.bearing=D),P!=null&&!Tu(P,o==null?void 0:o.getPitch())&&(Ye.pitch=P),Object.keys(Ye).length&&o.easeTo(Ye)}r.$$.dirty[0]&65552&&I&&!Tu(I,o==null?void 0:o.getBounds())&&(o==null||o.fitBounds(I)),r.$$.dirty[0]&16|r.$$.dirty[1]&1&&(ke?o==null||o.doubleClickZoom.enable():o==null||o.doubleClickZoom.disable())},[ee,_,v,ct,o,u,i,n,Ct,xt,qt,et,C,L,P,D,I,m,S,T,U,O,X,ue,$,Q,ne,F,Z,J,be,ke,ge,ve,fe,Pe,Ee,Fe,ot,it,at,It,tn,rn,Ge,d,a,nn]}class x4 extends kt{constructor(e){super(),St(this,e,w4,v4,gt,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,minPitch:24,maxPitch:25,renderWorldCopies:26,dragPan:27,dragRotate:28,pitchWithRotate:29,antialias:30,zoomOnDoubleClick:31,locale:32,interactive:33,attributionControl:34,cooperativeGestures:35,preserveDrawingBuffer:36,maxBounds:37,images:38,standardControls:3,filterLayers:39,transformRequest:40},null,[-1,-1])}}const A4=r=>({marker:r&8}),ay=r=>({marker:r[3]});function k4(r){let e,t,n,i,o,u,a;const d=r[19].default,m=_n(d,r,r[18],ay);return{c(){e=q("div"),m&&m.c(),ce(e,"tabindex",t=r[1]?0:void 0),ce(e,"role",n=r[1]?"button":void 0),Ze(e,"z-index",r[2])},m(_,v){W(_,e,v),m&&m.m(e,null),o=!0,u||(a=[jm(r[7].call(null,e)),jm(i=S4.call(null,e,r[0])),_t(e,"click",Cf(r[20])),_t(e,"dblclick",Cf(r[21])),_t(e,"contextmenu",Cf(Mg(r[22]))),_t(e,"mouseenter",r[23]),_t(e,"mouseleave",r[24]),_t(e,"mousemove",r[25]),_t(e,"keydown",r[8])],u=!0)},p(_,[v]){m&&m.p&&(!o||v&262152)&&yn(m,d,_,_[18],o?vn(d,_[18],v,A4):bn(_[18]),ay),(!o||v&2&&t!==(t=_[1]?0:void 0))&&ce(e,"tabindex",t),(!o||v&2&&n!==(n=_[1]?"button":void 0))&&ce(e,"role",n),i&&Xu(i.update)&&v&1&&i.update.call(null,_[0]),v&4&&Ze(e,"z-index",_[2])},i(_){o||(N(m,_),o=!0)},o(_){G(m,_),o=!1},d(_){_&&H(e),m&&m.d(_),u=!1,Er(a)}}}function S4(r,e){const t=r.className;function n(i){i?r.className=`${t} ${i}`:r.className=t}return n(e),{update:n}}function T4(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e,{marker:d=void 0}=e,{lngLat:m}=e,{class:_=void 0}=e,{interactive:v=!0}=e,{asButton:S=!1}=e,{draggable:T=!1}=e,{feature:C=null}=e,{offset:L=void 0}=e,{zIndex:P=void 0}=e,{rotation:D=0}=e,{opacity:I=1}=e;const U=ps(),{map:O,layerEvent:ee,self:X,markerClickManager:ue}=Ik();rt(r,O,fe=>t(27,o=fe)),rt(r,ee,fe=>t(26,n=fe)),rt(r,X,fe=>t(3,i=fe));function $(fe){on(X,i=new ui.Marker({element:fe,rotation:D,draggable:T,offset:L,opacity:I.toString()}).setLngLat(m).addTo(o),i),t(11,d=i);const Pe=()=>F("dragstart"),Ee=()=>{Q(),F("drag")},Fe=()=>{Q(),F("dragend")};return T&&(i.on("dragstart",Pe),i.on("drag",Ee),i.on("dragend",Fe)),{destroy(){T&&(i==null||i.off("dragstart",Pe),i==null||i.off("drag",Ee),i==null||i.off("dragend",Fe)),t(11,d=void 0),i==null||i.remove()}}}function Q(){let fe=i==null?void 0:i.getLngLat();fe&&(Array.isArray(m)?t(10,m=[fe.lng,fe.lat]):m&&"lon"in m?t(10,m={lon:fe.lng,lat:fe.lat}):t(10,m=fe))}function ne(fe){fe.key===" "&&(fe.preventDefault(),fe.stopPropagation(),F("click"))}function F(fe){if(!v)return;let Pe=i==null?void 0:i.getLngLat();if(!Pe)return;const Ee=[Pe.lng,Pe.lat];let Fe={map:o,marker:i,lngLat:Ee,features:[{type:"Feature",properties:(C==null?void 0:C.properties)??{},geometry:{type:"Point",coordinates:Ee}}]};(fe==="click"||fe==="contextmenu")&&ue.handleClick(Fe),on(ee,n={...Fe,layerType:"marker",type:fe},n),U(fe,Fe)}const Z=()=>F("click"),J=()=>F("dblclick"),be=()=>{F("contextmenu")},ke=()=>{F("mouseenter")},ge=()=>{F("mouseleave")},ve=()=>F("mousemove");return r.$$set=fe=>{"marker"in fe&&t(11,d=fe.marker),"lngLat"in fe&&t(10,m=fe.lngLat),"class"in fe&&t(0,_=fe.class),"interactive"in fe&&t(12,v=fe.interactive),"asButton"in fe&&t(1,S=fe.asButton),"draggable"in fe&&t(13,T=fe.draggable),"feature"in fe&&t(14,C=fe.feature),"offset"in fe&&t(15,L=fe.offset),"zIndex"in fe&&t(2,P=fe.zIndex),"rotation"in fe&&t(16,D=fe.rotation),"opacity"in fe&&t(17,I=fe.opacity),"$$scope"in fe&&t(18,a=fe.$$scope)},r.$$.update=()=>{r.$$.dirty&1032&&(i==null||i.setLngLat(m)),r.$$.dirty&32776&&(i==null||i.setOffset(L??[0,0])),r.$$.dirty&65544&&(i==null||i.setRotation(D)),r.$$.dirty&131080&&(i==null||i.setOpacity(I.toString()))},[_,S,P,i,O,ee,X,$,ne,F,m,d,v,T,C,L,D,I,a,u,Z,J,be,ke,ge,ve]}class Ju extends kt{constructor(e){super(),St(this,e,T4,k4,gt,{marker:11,lngLat:10,class:0,interactive:12,asButton:1,draggable:13,feature:14,offset:15,zIndex:2,rotation:16,opacity:17})}}const C4=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),ly=r=>{var e;return{features:r[4],data:((e=r[4])==null?void 0:e[0])??null,map:r[2],close:r[31]}};function uy(r){var i;let e,t,n=(((i=r[4])==null?void 0:i.length)||r[3]instanceof ui.Marker)&&cy(r);return{c(){e=q("div"),n&&n.c()},m(o,u){W(o,e,u),n&&n.m(e,null),r[32](e),t=!0},p(o,u){var a;(a=o[4])!=null&&a.length||o[3]instanceof ui.Marker?n?(n.p(o,u),u[0]&24&&N(n,1)):(n=cy(o),n.c(),N(n,1),n.m(e,null)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(o){t||(N(n),t=!0)},o(o){G(n),t=!1},d(o){o&&H(e),n&&n.d(),r[32](null)}}}function cy(r){let e;const t=r[30].default,n=_n(t,r,r[29],ly);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&yn(n,t,i,i[29],e?vn(t,i[29],o,C4):bn(i[29]),ly)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function M4(r){let e,t,n=r[9].default&&uy(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=uy(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function E4(r,e,t){let n,i,o,u,a,d,{$$slots:m={},$$scope:_}=e;const v=Eg(m);let{closeButton:S=void 0}=e,{closeOnClickOutside:T=!0}=e,{closeOnClickInside:C=!1}=e,{closeOnMove:L=!1}=e,{openOn:P="click"}=e,{openIfTopMost:D=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:U=void 0}=e,{offset:O=void 0}=e,{popupClass:ee=void 0}=e,{maxWidth:X=void 0}=e,{lngLat:ue=void 0}=e,{html:$=void 0}=e,{open:Q=!1}=e;const ne=ps(),{map:F,popupTarget:Z,layerEvent:J,layer:be,eventTopMost:ke,markerClickManager:ge}=Va();rt(r,F,et=>t(2,o=et)),rt(r,Z,et=>t(3,a=et)),rt(r,J,et=>t(28,u=et)),rt(r,be,et=>t(35,d=et));const ve=["click","dblclick","contextmenu"];let fe,Pe=!1,Ee;function Fe(){if(!fe)return;let et=fe.getElement();!et||et===Ee||(Ee=et,P==="hover"&&(Ee.style.pointerEvents="none"),Ee.addEventListener("mouseenter",()=>{t(24,Pe=!0)},{passive:!0}),Ee.addEventListener("mouseleave",()=>{t(24,Pe=!1)},{passive:!0}),Ee.addEventListener("click",()=>{C&&t(0,Q=!1)},{passive:!0}))}Yo(()=>{if(o)return o.on("click",rn),o.on("contextmenu",rn),ge.add(Ue),typeof a=="string"&&(o.on("click",a,ft),o.on("dblclick",a,ft),o.on("contextmenu",a,ft),o.on("mousemove",a,tn),o.on("mouseleave",a,Qt),o.on("touchstart",a,xt),o.on("touchend",a,It)),()=>{o!=null&&o.loaded()&&(fe==null||fe.remove(),o.off("click",rn),o.off("contextmenu",rn),ge.remove(Ue),a instanceof ui.Marker?a.getPopup()===fe&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,ft),o.off("dblclick",a,ft),o.off("contextmenu",a,ft),o.off("mousemove",a,tn),o.off("mouseleave",a,Qt),o.off("touchstart",a,xt),o.off("touchend",a,It)))}});function ot(et){return D?!("marker"in et)&&!Lk(et)&&ke(et)!==d:!1}let ct=null,it="normal";function at(et){"layerType"in et&&et.layerType==="deckgl"?(t(10,ue=et.coordinate),t(4,ct=et.object?[et.object]:null)):(t(10,ue=et.lngLat),t(4,ct=et.features??[]))}function ft(et){et.type!==P||ot(et)||(at(et),setTimeout(()=>t(0,Q=!0)))}let Ct=null;function xt(et){Ct=et.point}function It(et){if(!Ct||P!=="hover")return;let nn=Ct.dist(et.point);Ct=null,nn<3&&(t(10,ue=et.lngLat),t(4,ct=et.features??[]),fe.isOpen()?t(25,it="justOpened"):(t(25,it="opening"),t(0,Q=!0)))}function Qt(et){P!=="hover"||Ct||it!=="normal"||(t(0,Q=!1),t(4,ct=null))}function tn(et){if(!(P!=="hover"||Ct||it!=="normal")){if(ot(et)){t(0,Q=!1),t(4,ct=null);return}t(0,Q=!0),t(4,ct=et.features??[]),t(10,ue=et.lngLat)}}function rn(et){if(it==="justOpened"){t(25,it="normal");return}if(!T)return;let nn=[Ee,a instanceof ui.Marker?a==null?void 0:a.getElement():null];Q&&fe.isOpen()&&!nn.some(Ye=>Ye==null?void 0:Ye.contains(et.originalEvent.target))&&(et.type==="contextmenu"&&P==="contextmenu"||et.type!=="contextmenu")&&t(0,Q=!1)}function Ue(et){T&&Q&&fe.isOpen()&&et.marker!==a&&t(0,Q=!1)}ei(()=>{o&&(fe!=null&&fe.isOpen())&&fe.remove()});let Xe;const qt=()=>t(0,Q=!1);function Ge(et){wn[et?"unshift":"push"](()=>{Xe=et,t(1,Xe)})}return r.$$set=et=>{"closeButton"in et&&t(11,S=et.closeButton),"closeOnClickOutside"in et&&t(12,T=et.closeOnClickOutside),"closeOnClickInside"in et&&t(13,C=et.closeOnClickInside),"closeOnMove"in et&&t(14,L=et.closeOnMove),"openOn"in et&&t(15,P=et.openOn),"openIfTopMost"in et&&t(16,D=et.openIfTopMost),"focusAfterOpen"in et&&t(17,I=et.focusAfterOpen),"anchor"in et&&t(18,U=et.anchor),"offset"in et&&t(19,O=et.offset),"popupClass"in et&&t(20,ee=et.popupClass),"maxWidth"in et&&t(21,X=et.maxWidth),"lngLat"in et&&t(10,ue=et.lngLat),"html"in et&&t(22,$=et.html),"open"in et&&t(0,Q=et.open),"$$scope"in et&&t(29,_=et.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=S??(!T&&!C)),r.$$.dirty[0]&146685952&&(fe||(t(23,fe=new ui.Popup({closeButton:n,closeOnClick:!1,closeOnMove:L,focusAfterOpen:I,maxWidth:X,className:ee,anchor:U,offset:O})),Ee=fe.getElement(),fe.on("open",()=>{t(0,Q=!0),Fe(),ne("open",fe)}),fe.on("close",()=>{t(0,Q=!1),ne("close",fe)}),fe.on("hover",()=>{ne("hover",fe)}))),r.$$.dirty[0]&8421384&&fe&&a instanceof ui.Marker&&(P==="click"?a.setPopup(fe):a.getPopup()===fe&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&ve.includes(P)&&(u==null?void 0:u.type)===P&&(ft(u),on(J,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=P==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&P==="hover"&&J&&(i&&u&&at(u),t(0,Q=(i||Pe)??!1)),r.$$.dirty[0]&12582914&&(Xe?fe.setDOMContent(Xe):$&&fe.setHTML($)),r.$$.dirty[0]&8389632&&ue&&fe.setLngLat(ue),r.$$.dirty[0]&41943045&&o){let et=fe.isOpen();Q&&!et?(fe.addTo(o),it==="opening"&&t(25,it="justOpened")):!Q&&et&&fe.remove()}},[Q,Xe,o,a,ct,F,Z,J,be,v,ue,S,T,C,L,P,D,I,U,O,ee,X,$,fe,Pe,it,i,n,u,_,m,qt,Ge]}let Fg=class extends kt{constructor(e){super(),St(this,e,E4,M4,gt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}};var Bu=Math.pow,Fi=(r,e,t)=>new Promise((n,i)=>{var o=d=>{try{a(t.next(d))}catch(m){i(m)}},u=d=>{try{a(t.throw(d))}catch(m){i(m)}},a=d=>d.done?n(d.value):Promise.resolve(d.value).then(o,u);a((t=t.apply(r,e)).next())}),Po=Uint8Array,Mf=Uint16Array,I4=Int32Array,Sw=new Po([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Tw=new Po([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),L4=new Po([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cw=function(r,e){for(var t=new Mf(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new I4(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)i[o]=o-t[n]<<5|n;return{b:t,r:i}},Mw=Cw(Sw,2),Ew=Mw.b,P4=Mw.r;Ew[28]=258,P4[258]=28;var z4=Cw(Tw,0),D4=z4.b,Iw=new Mf(32768);for(Ar=0;Ar<32768;++Ar)Hs=(Ar&43690)>>1|(Ar&21845)<<1,Hs=(Hs&52428)>>2|(Hs&13107)<<2,Hs=(Hs&61680)>>4|(Hs&3855)<<4,Iw[Ar]=((Hs&65280)>>8|(Hs&255)<<8)>>1;var Hs,Ar,Ef=function(r,e,t){for(var n=r.length,i=0,o=new Mf(e);i<n;++i)r[i]&&++o[r[i]-1];var u=new Mf(e);for(i=1;i<e;++i)u[i]=u[i-1]+o[i-1]<<1;var a;{a=new Mf(1<<e);var d=15-e;for(i=0;i<n;++i)if(r[i])for(var m=i<<4|r[i],_=e-r[i],v=u[r[i]-1]++<<_,S=v|(1<<_)-1;v<=S;++v)a[Iw[v]>>d]=m}return a},Jf=new Po(288);for(Ar=0;Ar<144;++Ar)Jf[Ar]=8;var Ar;for(Ar=144;Ar<256;++Ar)Jf[Ar]=9;var Ar;for(Ar=256;Ar<280;++Ar)Jf[Ar]=7;var Ar;for(Ar=280;Ar<288;++Ar)Jf[Ar]=8;var Ar,Lw=new Po(32);for(Ar=0;Ar<32;++Ar)Lw[Ar]=5;var Ar,R4=Ef(Jf,9),B4=Ef(Lw,5),Sm=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},os=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},Tm=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},F4=function(r){return(r+7)/8|0},O4=function(r,e,t){(t==null||t>r.length)&&(t=r.length);var n=new Po(t-e);return n.set(r.subarray(e,t)),n},N4=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Io=function(r,e,t){var n=new Error(e||N4[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,Io),!t)throw n;return n},Og=function(r,e,t,n){var i=r.length,o=0;if(!i||e.f&&!e.l)return t||new Po(0);var u=!t||e.i!=2,a=e.i;t||(t=new Po(i*3));var d=function(Qt){var tn=t.length;if(Qt>tn){var rn=new Po(Math.max(tn*2,Qt));rn.set(t),t=rn}},m=e.f||0,_=e.p||0,v=e.b||0,S=e.l,T=e.d,C=e.m,L=e.n,P=i*8;do{if(!S){m=os(r,_,1);var D=os(r,_+1,3);if(_+=3,D)if(D==1)S=R4,T=B4,C=9,L=5;else if(D==2){var ee=os(r,_,31)+257,X=os(r,_+10,15)+4,ue=ee+os(r,_+5,31)+1;_+=14;for(var $=new Po(ue),Q=new Po(19),ne=0;ne<X;++ne)Q[L4[ne]]=os(r,_+ne*3,7);_+=X*3;for(var F=Sm(Q),Z=(1<<F)-1,J=Ef(Q,F),ne=0;ne<ue;){var be=J[os(r,_,Z)];_+=be&15;var I=be>>4;if(I<16)$[ne++]=I;else{var ke=0,ge=0;for(I==16?(ge=3+os(r,_,3),_+=2,ke=$[ne-1]):I==17?(ge=3+os(r,_,7),_+=3):I==18&&(ge=11+os(r,_,127),_+=7);ge--;)$[ne++]=ke}}var ve=$.subarray(0,ee),fe=$.subarray(ee);C=Sm(ve),L=Sm(fe),S=Ef(ve,C),T=Ef(fe,L)}else Io(1);else{var I=F4(_)+4,U=r[I-4]|r[I-3]<<8,O=I+U;if(O>i){a&&Io(0);break}u&&d(v+U),t.set(r.subarray(I,O),v),e.b=v+=U,e.p=_=O*8,e.f=m;continue}if(_>P){a&&Io(0);break}}u&&d(v+131072);for(var Pe=(1<<C)-1,Ee=(1<<L)-1,Fe=_;;Fe=_){var ke=S[Tm(r,_)&Pe],ot=ke>>4;if(_+=ke&15,_>P){a&&Io(0);break}if(ke||Io(2),ot<256)t[v++]=ot;else if(ot==256){Fe=_,S=null;break}else{var ct=ot-254;if(ot>264){var ne=ot-257,it=Sw[ne];ct=os(r,_,(1<<it)-1)+Ew[ne],_+=it}var at=T[Tm(r,_)&Ee],ft=at>>4;at||Io(3),_+=at&15;var fe=D4[ft];if(ft>3){var it=Tw[ft];fe+=Tm(r,_)&(1<<it)-1,_+=it}if(_>P){a&&Io(0);break}u&&d(v+131072);var Ct=v+ct;if(v<fe){var xt=o-fe,It=Math.min(fe,Ct);for(xt+v<0&&Io(3);v<It;++v)t[v]=n[xt+v]}for(;v<Ct;v+=4)t[v]=t[v-fe],t[v+1]=t[v+1-fe],t[v+2]=t[v+2-fe],t[v+3]=t[v+3-fe];v=Ct}}e.l=S,e.p=Fe,e.b=v,e.f=m,S&&(m=1,e.m=C,e.d=T,e.n=L)}while(!m);return v==t.length?t:O4(t,0,v)},$4=new Po(0),j4=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&Io(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},U4=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},V4=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&Io(6,"invalid zlib data"),(r[1]>>5&1)==1&&Io(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function q4(r,e){return Og(r,{i:2},e,e)}function G4(r,e){var t=j4(r);return t+8>r.length&&Io(6,"invalid gzip data"),Og(r.subarray(t,-8),{i:2},new Po(U4(r)),e)}function Z4(r,e){return Og(r.subarray(V4(r),-4),{i:2},e,e)}function Vm(r,e){return r[0]==31&&r[1]==139&&r[2]==8?G4(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?q4(r,e):Z4(r,e)}var H4=typeof TextDecoder<"u"&&new TextDecoder,W4=0;try{H4.decode($4,{stream:!0}),W4=1}catch{}var Pw=(r,e)=>r*Bu(2,e),cf=(r,e)=>Math.floor(r/Bu(2,e)),Nd=(r,e)=>Pw(r.getUint16(e+1,!0),8)+r.getUint8(e),zw=(r,e)=>Pw(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),X4=(r,e,t,n,i)=>{if(r!==n.getUint8(i))return r-n.getUint8(i);const o=Nd(n,i+1);if(e!==o)return e-o;const u=Nd(n,i+4);return t!==u?t-u:0},J4=(r,e,t,n)=>{const i=Dw(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!0}:null},fy=(r,e,t,n)=>{const i=Dw(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],isDir:!1}:null},Dw=(r,e,t,n)=>{let i=0,o=r.byteLength/17-1;for(;i<=o;){const u=o+i>>1,a=X4(e,t,n,r,u*17);if(a>0)i=u+1;else if(a<0)o=u-1;else return[zw(r,u*17+7),r.getUint32(u*17+13,!0)]}return null},K4=(r,e)=>r.isDir&&!e.isDir?1:!r.isDir&&e.isDir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,Rw=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:Nd(r,e*17+1),y:Nd(r,e*17+4),offset:zw(r,e*17+7),length:r.getUint32(e*17+13,!0),isDir:t>>7===1}},hy=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(Rw(t,n));return Y4(e)},Y4=r=>{r.sort(K4);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let o=i.z;i.isDir&&(o=o|128),t[n*17]=o,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=cf(i.offset,8)&255,t[n*17+9]=cf(i.offset,16)&255,t[n*17+10]=cf(i.offset,24)&255,t[n*17+11]=cf(i.offset,32)&255,t[n*17+12]=cf(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},Q4=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=Rw(r,t-1);if(n.isDir){const i=n.z,o=e.z-i,u=Math.trunc(e.x/(1<<o)),a=Math.trunc(e.y/(1<<o));return{z:i,x:u,y:a}}return null};function eS(r){return Fi(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),o=new TextDecoder("utf-8"),u=JSON.parse(o.decode(new DataView(e.data,10,n)));let a=0;u.compression==="gzip"&&(a=2);let d=0;"minzoom"in u&&(d=+u.minzoom);let m=0;"maxzoom"in u&&(m=+u.maxzoom);let _=0,v=0,S=0,T=-180,C=-85,L=180,P=85;if(u.bounds){const I=u.bounds.split(",");T=+I[0],C=+I[1],L=+I[2],P=+I[3]}if(u.center){const I=u.center.split(",");_=+I[0],v=+I[1],S=+I[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:d,maxZoom:m,minLon:T,minLat:C,maxLon:L,maxLat:P,centerZoom:S,centerLon:_,centerLat:v,etag:e.etag}})}function tS(r,e,t,n,i,o,u){return Fi(this,null,function*(){let a=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=hy(a));const d=fy(new DataView(a),n,i,o);if(d){let v=(yield e.getBytes(d.offset,d.length,u)).data;const S=new DataView(v);return S.getUint8(0)===31&&S.getUint8(1)===139&&(v=Vm(new Uint8Array(v))),{data:v}}const m=Q4(new DataView(a),{z:n,x:i,y:o});if(m){const _=J4(new DataView(a),m.z,m.x,m.y);if(_){let v=yield t.getArrayBuffer(e,_.offset,_.length,r);r.specVersion===1&&(v=hy(v));const S=fy(new DataView(v),n,i,o);if(S){let C=(yield e.getBytes(S.offset,S.length,u)).data;const L=new DataView(C);return L.getUint8(0)===31&&L.getUint8(1)===139&&(C=Vm(new Uint8Array(C))),{data:C}}}}})}var Bw={getHeader:eS,getZxy:tS},nS=r=>(e,t)=>{if(t instanceof AbortController)return r(e,t);const n=new AbortController;return r(e,n).then(i=>t(void 0,i.data,i.cacheControl||"",i.expires||""),i=>t(i)).catch(i=>t(i)),{cancel:()=>n.abort()}},rS=class{constructor(r){this.tilev4=(e,t)=>Fi(this,null,function*(){if(e.type==="json"){const S=e.url.substr(10);let T=this.tiles.get(S);if(T||(T=new dy(S),this.tiles.set(S,T)),this.metadata)return{data:yield T.getTileJson(e.url)};const C=yield T.getHeader();return{data:{tiles:[`${e.url}/{z}/{x}/{y}`],minzoom:C.minZoom,maxzoom:C.maxZoom,bounds:[C.minLon,C.minLat,C.maxLon,C.maxLat]}}}const n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),i=e.url.match(n);if(!i)throw new Error("Invalid PMTiles protocol URL");const o=i[1];let u=this.tiles.get(o);u||(u=new dy(o),this.tiles.set(o,u));const a=i[2],d=i[3],m=i[4],_=yield u.getHeader(),v=yield u==null?void 0:u.getZxy(+a,+d,+m,t.signal);return v?{data:new Uint8Array(v.data),cacheControl:v.cacheControl,expires:v.expires}:_.tileType===1?{data:new Uint8Array}:{data:null}}),this.tile=nS(this.tilev4),this.tiles=new Map,this.metadata=(r==null?void 0:r.metadata)||!1}add(r){this.tiles.set(r.source.getKey(),r)}get(r){return this.tiles.get(r)}};function Cu(r,e){return(e>>>0)*4294967296+(r>>>0)}function iS(r,e){const t=e.buf;let n=t[e.pos++],i=(n&112)>>4;if(n<128||(n=t[e.pos++],i|=(n&127)<<3,n<128)||(n=t[e.pos++],i|=(n&127)<<10,n<128)||(n=t[e.pos++],i|=(n&127)<<17,n<128)||(n=t[e.pos++],i|=(n&127)<<24,n<128)||(n=t[e.pos++],i|=(n&1)<<31,n<128))return Cu(r,i);throw new Error("Expected varint not more than 10 bytes")}function ff(r){const e=r.buf;let t=e[r.pos++],n=t&127;return t<128||(t=e[r.pos++],n|=(t&127)<<7,t<128)||(t=e[r.pos++],n|=(t&127)<<14,t<128)||(t=e[r.pos++],n|=(t&127)<<21,t<128)?n:(t=e[r.pos],n|=(t&15)<<28,iS(n,r))}function oS(r,e,t,n){if(n===0){t===1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var sS=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function aS(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Bu(2,r)-1||t>Bu(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=sS[r],i=Bu(2,r);let o=0,u=0,a=0;const d=[e,t];let m=i/2;for(;m>0;)o=(d[0]&m)>0?1:0,u=(d[1]&m)>0?1:0,a+=m*m*(3*o^u),oS(m,d,o,u),m=m/2;return n+a}function Fw(r,e){return Fi(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Vm(new Uint8Array(r));const t=new Response(r).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")})}function lS(r){return r===1?".mvt":r===2?".png":r===3?".jpg":r===4?".webp":r===5?".avif":""}var uS=127;function cS(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,o=e-r[i].tileId;if(o>0)t=i+1;else if(o<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var fS=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e,this.mustReload=!1;let t="";"navigator"in globalThis&&(t=globalThis.navigator.userAgent||"");const n=t.indexOf("Windows")>-1,i=/Chrome|Chromium|Edg|OPR|Brave/.test(t);this.chromeWindowsNoCache=!1,n&&i&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t,n){return Fi(this,null,function*(){let i,o;t?o=t:(i=new AbortController,o=i.signal);const u=new Headers(this.customHeaders);u.set("range",`bytes=${r}-${r+e-1}`);let a;this.mustReload?a="reload":this.chromeWindowsNoCache&&(a="no-store");let d=yield fetch(this.url,{signal:o,cache:a,headers:u});if(r===0&&d.status===416){const S=d.headers.get("Content-Range");if(!S||!S.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const T=+S.substr(8);d=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:`bytes=0-${T-1}`}})}let m=d.headers.get("Etag");if(m!=null&&m.startsWith("W/")&&(m=null),d.status===416||n&&m&&m!==n)throw this.mustReload=!0,new qm(`Server returned non-matching ETag ${n} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(d.status>=300)throw Error(`Bad response code: ${d.status}`);const _=d.headers.get("Content-Length");if(d.status===200&&(!_||+_>e))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield d.arrayBuffer(),etag:m||void 0,cacheControl:d.headers.get("Cache-Control")||void 0,expires:d.headers.get("Expires")||void 0}})}};function ss(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Bu(2,32)+n}function hS(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:ss(t,8),rootDirectoryLength:ss(t,16),jsonMetadataOffset:ss(t,24),jsonMetadataLength:ss(t,32),leafDirectoryOffset:ss(t,40),leafDirectoryLength:ss(t,48),tileDataOffset:ss(t,56),tileDataLength:ss(t,64),numAddressedTiles:ss(t,72),numTileEntries:ss(t,80),numTileContents:ss(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function Ow(r){const e={buf:new Uint8Array(r),pos:0},t=ff(e),n=[];let i=0;for(let o=0;o<t;o++){const u=ff(e);n.push({tileId:i+u,offset:0,length:0,runLength:1}),i+=u}for(let o=0;o<t;o++)n[o].runLength=ff(e);for(let o=0;o<t;o++)n[o].length=ff(e);for(let o=0;o<t;o++){const u=ff(e);u===0&&o>0?n[o].offset=n[o-1].offset+n[o-1].length:n[o].offset=u-1}return n}function dS(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var qm=class extends Error{};function pS(r,e){return Fi(this,null,function*(){const t=yield r.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(dS(t.data)<3)return[yield Bw.getHeader(r)];const i=t.data.slice(0,uS),o=hS(i,t.etag),u=t.data.slice(o.rootDirectoryOffset,o.rootDirectoryOffset+o.rootDirectoryLength),a=`${r.getKey()}|${o.etag||""}|${o.rootDirectoryOffset}|${o.rootDirectoryLength}`,d=Ow(yield e(u,o.internalCompression));return[o,[a,d.length,d]]})}function mS(r,e,t,n,i){return Fi(this,null,function*(){const o=yield r.getBytes(t,n,void 0,i.etag),u=yield e(o.data,i.internalCompression),a=Ow(u);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var gS=class{constructor(r=100,e=!0,t=Fw){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=r,this.counter=1,this.decompress=t}getHeader(r){return Fi(this,null,function*(){const e=r.getKey(),t=this.cache.get(e);if(t)return t.lastUsed=this.counter++,yield t.data;const n=new Promise((i,o)=>{pS(r,this.decompress).then(u=>{u[1]&&this.cache.set(u[1][0],{lastUsed:this.counter++,data:Promise.resolve(u[1][2])}),i(u[0]),this.prune()}).catch(u=>{o(u)})});return this.cache.set(e,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Fi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((a,d)=>{mS(r,this.decompress,e,t,n).then(m=>{a(m),this.prune()}).catch(m=>{d(m)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}getArrayBuffer(r,e,t,n){return Fi(this,null,function*(){const i=`${r.getKey()}|${n.etag||""}|${e}|${t}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const u=new Promise((a,d)=>{r.getBytes(e,t,void 0,n.etag).then(m=>{a(m.data),this.cache.has(i),this.prune()}).catch(m=>{d(m)})});return this.cache.set(i,{lastUsed:this.counter++,data:u}),u})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r){return Fi(this,null,function*(){const e=r.getKey();if(this.invalidations.get(e))return yield this.invalidations.get(e);this.cache.delete(r.getKey());const t=new Promise((n,i)=>{this.getHeader(r).then(o=>{n(),this.invalidations.delete(e)}).catch(o=>{i(o)})});this.invalidations.set(e,t)})}},dy=class{constructor(r,e,t){typeof r=="string"?this.source=new fS(r):this.source=r,t?this.decompress=t:this.decompress=Fw,e?this.cache=e:this.cache=new gS}getHeader(){return Fi(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Fi(this,null,function*(){const i=aS(r,e,t),o=yield this.cache.getHeader(this.source);if(o.specVersion<3)return Bw.getZxy(o,this.source,this.cache,r,e,t,n);if(r<o.minZoom||r>o.maxZoom)return;let u=o.rootDirectoryOffset,a=o.rootDirectoryLength;for(let d=0;d<=3;d++){const m=yield this.cache.getDirectory(this.source,u,a,o),_=cS(m,i);if(_){if(_.runLength>0){const v=yield this.source.getBytes(o.tileDataOffset+_.offset,_.length,n,o.etag);return{data:yield this.decompress(v.data,o.tileCompression),cacheControl:v.cacheControl,expires:v.expires}}u=o.leafDirectoryOffset+_.offset,a=_.length}else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Fi(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof qm)return this.cache.invalidate(this.source),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Fi(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength,void 0,r.etag),t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Fi(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof qm)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw r}})}getTileJson(r){return Fi(this,null,function*(){const e=yield this.getHeader(),t=yield this.getMetadata(),n=lS(e.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${r}/{z}/{x}/{y}${n}`],vector_layers:t.vector_layers,attribution:t.attribution,description:t.description,name:t.name,version:t.version,bounds:[e.minLon,e.minLat,e.maxLon,e.maxLat],center:[e.centerLon,e.centerLat,e.centerZoom],minzoom:e.minZoom,maxzoom:e.maxZoom}})}};function _S(r){let e;const t=r[16].default,n=_n(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&yn(n,t,i,i[24],e?vn(t,i[24],o,null):bn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function yS(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"symbol",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[_S]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new Xf({props:o}),wn.push(()=>On(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.applyToClusters=u[9]),a&1024&&(d.minzoom=u[10]),a&2048&&(d.maxzoom=u[11]),a&4096&&(d.hoverCursor=u[12]),a&8192&&(d.manageHoverState=u[13]),a&16384&&(d.eventsIfTopMost=u[14]),a&32768&&(d.interactive=u[15]),a&16777216&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function bS(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=Ua("symbol")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:_=void 0}=e,{layout:v=void 0}=e,{filter:S=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:D=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:O=!0}=e;function ee(Z){I=Z,t(0,I)}function X(Z){Pn.call(this,r,Z)}function ue(Z){Pn.call(this,r,Z)}function $(Z){Pn.call(this,r,Z)}function Q(Z){Pn.call(this,r,Z)}function ne(Z){Pn.call(this,r,Z)}function F(Z){Pn.call(this,r,Z)}return r.$$set=Z=>{"id"in Z&&t(1,o=Z.id),"source"in Z&&t(2,u=Z.source),"sourceLayer"in Z&&t(3,a=Z.sourceLayer),"beforeId"in Z&&t(4,d=Z.beforeId),"beforeLayerType"in Z&&t(5,m=Z.beforeLayerType),"paint"in Z&&t(6,_=Z.paint),"layout"in Z&&t(7,v=Z.layout),"filter"in Z&&t(8,S=Z.filter),"applyToClusters"in Z&&t(9,T=Z.applyToClusters),"minzoom"in Z&&t(10,C=Z.minzoom),"maxzoom"in Z&&t(11,L=Z.maxzoom),"hoverCursor"in Z&&t(12,P=Z.hoverCursor),"manageHoverState"in Z&&t(13,D=Z.manageHoverState),"hovered"in Z&&t(0,I=Z.hovered),"eventsIfTopMost"in Z&&t(14,U=Z.eventsIfTopMost),"interactive"in Z&&t(15,O=Z.interactive),"$$scope"in Z&&t(24,i=Z.$$scope)},[I,o,u,a,d,m,_,v,S,T,C,L,P,D,U,O,n,ee,X,ue,$,Q,ne,F,i]}class Nu extends kt{constructor(e){super(),St(this,e,bS,yS,gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function py(r){let e=r[0],t,n,i=my(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&gt(e,e=o[0])?(Zt(),G(i,1,1,ht),Ht(),i=my(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){G(i),n=!1},d(o){o&&H(t),i.d(o)}}}function my(r){let e;const t=r[15].default,n=_n(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&yn(n,t,i,i[14],e?vn(t,i[14],o,null):bn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function vS(r){let e,t,n=r[0]&&py(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=py(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function wS(r,e,t){let n,i,{$$slots:o={},$$scope:u}=e,{id:a=Ua("vector")}=e,{url:d=null}=e,{tiles:m=null}=e,{promoteId:_=null}=e,{bounds:v=null}=e,{scheme:S=null}=e,{attribution:T=null}=e,{minzoom:C=null}=e,{maxzoom:L=null}=e,{volatile:P=null}=e;if(d&&d.includes("pmtiles://")&&!ui.config.REGISTERED_PROTOCOLS.hasOwnProperty("pmtiles")){let O=new rS;ui.addProtocol("pmtiles",O.tile)}const{map:D,self:I}=hw();rt(r,D,O=>t(13,i=O)),rt(r,I,O=>t(0,n=O));let U;return ei(()=>{n&&i&&(xw(D,n,U),on(I,n=null,n),U=void 0)}),r.$$set=O=>{"id"in O&&t(3,a=O.id),"url"in O&&t(4,d=O.url),"tiles"in O&&t(5,m=O.tiles),"promoteId"in O&&t(6,_=O.promoteId),"bounds"in O&&t(7,v=O.bounds),"scheme"in O&&t(8,S=O.scheme),"attribution"in O&&t(9,T=O.attribution),"minzoom"in O&&t(10,C=O.minzoom),"maxzoom"in O&&t(11,L=O.maxzoom),"volatile"in O&&t(12,P=O.volatile),"$$scope"in O&&t(14,u=O.$$scope)},r.$$.update=()=>{r.$$.dirty&16377&&i&&n!==a&&(on(I,n=a,n),ww(i,n,Na({type:"vector",url:d,tiles:m,promoteId:_,bounds:v,scheme:S,attribution:T,minzoom:C,maxzoom:L,volatile:P}),O=>i&&O===n,()=>{n&&(U=i==null?void 0:i.getSource(n))})),r.$$.dirty&8200&&(i==null||i.on("style.load",()=>{U=i==null?void 0:i.getSource(a)}))},[n,D,I,a,d,m,_,v,S,T,C,L,P,i,u,o]}class Kf extends kt{constructor(e){super(),St(this,e,wS,vS,gt,{id:3,url:4,tiles:5,promoteId:6,bounds:7,scheme:8,attribution:9,minzoom:10,maxzoom:11,volatile:12})}}function xS(r){let e,t,n,i,o;const u=r[5].default,a=_n(u,r,r[4],null);return{c(){e=q("dialog"),t=q("article"),a&&a.c()},m(d,m){W(d,e,m),z(e,t),a&&a.m(t,null),r[6](e),n=!0,i||(o=[_t(e,"click",Cf(r[1])),_t(e,"keydown",r[2])],i=!0)},p(d,[m]){a&&a.p&&(!n||m&16)&&yn(a,u,d,d[4],n?vn(u,d[4],m,null):bn(d[4]),null)},i(d){n||(N(a,d),n=!0)},o(d){G(a,d),n=!1},d(d){d&&H(e),a&&a.d(d),r[6](null),i=!1,Er(o)}}}function AS(r,e,t){let{$$slots:n={},$$scope:i}=e,{show:o=!1}=e,u;function a(_){_.target==u&&t(3,o=!1)}function d(_){(_.key=="Escape"||_.key=="Enter")&&(_.stopPropagation(),t(3,o=!1))}function m(_){wn[_?"unshift":"push"](()=>{u=_,t(0,u)})}return r.$$set=_=>{"show"in _&&t(3,o=_.show),"$$scope"in _&&t(4,i=_.$$scope)},r.$$.update=()=>{r.$$.dirty&9&&u&&(o?u.showModal():u.close())},[u,a,d,o,i,n,m]}class Ng extends kt{constructor(e){super(),St(this,e,AS,xS,gt,{show:3})}}function gy(r,e,t){const n=r.slice();return n[1]=e[t][0],n[2]=e[t][1],n}function _y(r){let e,t,n=r[1]+"",i,o,u,a=r[2]+"",d,m;return{c(){e=q("tr"),t=q("td"),i=Te(n),o=ae(),u=q("td"),d=Te(a),m=ae()},m(_,v){W(_,e,v),z(e,t),z(t,i),z(e,o),z(e,u),z(u,d),z(e,m)},p(_,v){v&1&&n!==(n=_[1]+"")&&yt(i,n),v&1&&a!==(a=_[2]+"")&&yt(d,a)},d(_){_&&H(e)}}}function kS(r){let e,t,n=zn(Object.entries(r[0])),i=[];for(let o=0;o<n.length;o+=1)i[o]=_y(gy(r,n,o));return{c(){e=q("table"),t=q("tbody");for(let o=0;o<i.length;o+=1)i[o].c();ce(e,"class","svelte-lh2o9l")},m(o,u){W(o,e,u),z(e,t);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(t,null)},p(o,[u]){if(u&1){n=zn(Object.entries(o[0]));let a;for(a=0;a<n.length;a+=1){const d=gy(o,n,a);i[a]?i[a].p(d,u):(i[a]=_y(d),i[a].c(),i[a].m(t,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}},i:ht,o:ht,d(o){o&&H(e),Jr(i,o)}}}function SS(r,e,t){let{properties:n}=e;return r.$$set=i=>{"properties"in i&&t(0,n=i.properties)},[n]}class Yf extends kt{constructor(e){super(),St(this,e,SS,kS,gt,{properties:0})}}function yy(r,e,t){const n=r.slice();return n[4]=e[t][0],n[5]=e[t][1],n}function by(r){let e,t,n,i,o=r[4]+"",u,a;return{c(){e=q("div"),t=q("span"),i=ae(),u=Te(o),a=ae(),ce(t,"class",n="color-swatch "+r[1]+" svelte-1enycr6"),Ze(t,"background",r[5]),Ze(e,"display","flex"),Ze(e,"align-items","center"),Ze(e,"gap","6px")},m(d,m){W(d,e,m),z(e,t),z(e,i),z(e,u),z(e,a)},p(d,m){m&2&&n!==(n="color-swatch "+d[1]+" svelte-1enycr6")&&ce(t,"class",n),m&1&&Ze(t,"background",d[5]),m&1&&o!==(o=d[4]+"")&&yt(u,o)},d(d){d&&H(e)}}}function TS(r){let e,t=zn(Object.entries(r[0])),n=[];for(let i=0;i<t.length;i+=1)n[i]=by(yy(r,t,i));return{c(){e=q("div");for(let i=0;i<n.length;i+=1)n[i].c();Ze(e,"display","grid"),Ze(e,"grid-template-columns","repeat(auto-fill, calc("+r[2]+" - 10px))"),Ze(e,"gap","10px")},m(i,o){W(i,e,o);for(let u=0;u<n.length;u+=1)n[u]&&n[u].m(e,null)},p(i,[o]){if(o&3){t=zn(Object.entries(i[0]));let u;for(u=0;u<t.length;u+=1){const a=yy(i,t,u);n[u]?n[u].p(a,o):(n[u]=by(a),n[u].c(),n[u].m(e,null))}for(;u<n.length;u+=1)n[u].d(1);n.length=t.length}o&4&&Ze(e,"grid-template-columns","repeat(auto-fill, calc("+i[2]+" - 10px))")},i:ht,o:ht,d(i){i&&H(e),Jr(n,i)}}}function CS(r,e,t){let n,{labelColors:i}=e,{swatchClass:o="rectangle"}=e,{itemsPerRow:u=2}=e;return r.$$set=a=>{"labelColors"in a&&t(0,i=a.labelColors),"swatchClass"in a&&t(1,o=a.swatchClass),"itemsPerRow"in a&&t(3,u=a.itemsPerRow)},r.$$.update=()=>{r.$$.dirty&8&&t(2,n=`${100/u}%`)},[i,o,n,u]}class $g extends kt{constructor(e){super(),St(this,e,CS,TS,gt,{labelColors:0,swatchClass:1,itemsPerRow:3})}}function vy(r,e,t){const n=r.slice();return n[4]=e[t],n}function wy(r,e,t){const n=r.slice();return n[7]=e[t],n}function xy(r){let e,t;return{c(){e=q("span"),t=Te(""),ce(e,"class","bucket svelte-3plrz9"),Ze(e,"background",r[7])},m(n,i){W(n,e,i),z(e,t)},p(n,i){i&1&&Ze(e,"background",n[7])},d(n){n&&H(e)}}}function Ay(r){let e,t=r[4]+"",n;return{c(){e=q("span"),n=Te(t),ce(e,"class","svelte-3plrz9")},m(i,o){W(i,e,o),z(e,n)},p(i,o){o&6&&t!==(t=i[4]+"")&&yt(n,t)},d(i){i&&H(e)}}}function MS(r){let e,t,n,i,o=zn(r[0]),u=[];for(let m=0;m<o.length;m+=1)u[m]=xy(wy(r,o,m));let a=zn(ky(r[1],r[2])),d=[];for(let m=0;m<a.length;m+=1)d[m]=Ay(vy(r,a,m));return{c(){e=q("div"),t=q("div");for(let m=0;m<u.length;m+=1)u[m].c();n=ae(),i=q("div");for(let m=0;m<d.length;m+=1)d[m].c();ce(t,"class","colors svelte-3plrz9"),ce(i,"class","labels svelte-3plrz9"),ce(e,"class","svelte-3plrz9"),Nt(e,"full-width-bucket-legend",r[3]),Nt(e,"bucketed",r[1].hasOwnProperty("buckets")),Nt(e,"limits",r[1].hasOwnProperty("limits"))},m(m,_){W(m,e,_),z(e,t);for(let v=0;v<u.length;v+=1)u[v]&&u[v].m(t,null);z(e,n),z(e,i);for(let v=0;v<d.length;v+=1)d[v]&&d[v].m(i,null)},p(m,[_]){if(_&1){o=zn(m[0]);let v;for(v=0;v<o.length;v+=1){const S=wy(m,o,v);u[v]?u[v].p(S,_):(u[v]=xy(S),u[v].c(),u[v].m(t,null))}for(;v<u.length;v+=1)u[v].d(1);u.length=o.length}if(_&6){a=zn(ky(m[1],m[2]));let v;for(v=0;v<a.length;v+=1){const S=vy(m,a,v);d[v]?d[v].p(S,_):(d[v]=Ay(S),d[v].c(),d[v].m(i,null))}for(;v<d.length;v+=1)d[v].d(1);d.length=a.length}_&8&&Nt(e,"full-width-bucket-legend",m[3]),_&2&&Nt(e,"bucketed",m[1].hasOwnProperty("buckets")),_&2&&Nt(e,"limits",m[1].hasOwnProperty("limits"))},i:ht,o:ht,d(m){m&&H(e),Jr(u,m),Jr(d,m)}}}function ky(r,e){return("limits"in r?r.limits:r.buckets).map(n=>typeof n=="number"?e>0?n.toFixed(e):n.toLocaleString():n)}function ES(r,e,t){let{colorScale:n}=e,{labels:i}=e,{decimalPlaces:o=0}=e,{fullWidthBucketLegend:u=!1}=e;return r.$$set=a=>{"colorScale"in a&&t(0,n=a.colorScale),"labels"in a&&t(1,i=a.labels),"decimalPlaces"in a&&t(2,o=a.decimalPlaces),"fullWidthBucketLegend"in a&&t(3,u=a.fullWidthBucketLegend)},[n,i,o,u]}class Qi extends kt{constructor(e){super(),St(this,e,ES,MS,gt,{colorScale:0,labels:1,decimalPlaces:2,fullWidthBucketLegend:3})}}function np(r,e){let t=document.createElement("a");t.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),t.setAttribute("download",r),document.body.appendChild(t),t.click(),document.body.removeChild(t)}function cr(r){if(r==null||r==null)throw new Error("Oops, notNull given something null");return r}async function IS(r,e){let t=await fetch(r);if(!t.ok)throw new Error(`${r} not OK: ${t.status}`);let n=t.body.getReader(),i=t.headers.get("Content-Length");if(!i)throw new Error(`No Content-Length header from ${r}`);let o=parseInt(i),u=0,a=[];for(;;){let{done:_,value:v}=await n.read();if(_)break;v&&(a.push(v),u+=v.length,e(100*u/o))}let d=new Uint8Array(u),m=0;for(let _ of a)d.set(_,m),m+=_.length;return d}var fo="top",Xo="bottom",Jo="right",ho="left",jg="auto",Qf=[fo,Xo,Jo,ho],$u="start",Of="end",LS="clippingParents",Nw="viewport",hf="popper",PS="reference",Sy=Qf.reduce(function(r,e){return r.concat([e+"-"+$u,e+"-"+Of])},[]),$w=[].concat(Qf,[jg]).reduce(function(r,e){return r.concat([e,e+"-"+$u,e+"-"+Of])},[]),zS="beforeRead",DS="read",RS="afterRead",BS="beforeMain",FS="main",OS="afterMain",NS="beforeWrite",$S="write",jS="afterWrite",US=[zS,DS,RS,BS,FS,OS,NS,$S,jS];function Es(r){return r?(r.nodeName||"").toLowerCase():null}function Ro(r){if(r==null)return window;if(r.toString()!=="[object Window]"){var e=r.ownerDocument;return e&&e.defaultView||window}return r}function Tl(r){var e=Ro(r).Element;return r instanceof e||r instanceof Element}function Wo(r){var e=Ro(r).HTMLElement;return r instanceof e||r instanceof HTMLElement}function Ug(r){if(typeof ShadowRoot>"u")return!1;var e=Ro(r).ShadowRoot;return r instanceof e||r instanceof ShadowRoot}function VS(r){var e=r.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},i=e.attributes[t]||{},o=e.elements[t];!Wo(o)||!Es(o)||(Object.assign(o.style,n),Object.keys(i).forEach(function(u){var a=i[u];a===!1?o.removeAttribute(u):o.setAttribute(u,a===!0?"":a)}))})}function qS(r){var e=r.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var i=e.elements[n],o=e.attributes[n]||{},u=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]),a=u.reduce(function(d,m){return d[m]="",d},{});!Wo(i)||!Es(i)||(Object.assign(i.style,a),Object.keys(o).forEach(function(d){i.removeAttribute(d)}))})}}const jw={name:"applyStyles",enabled:!0,phase:"write",fn:VS,effect:qS,requires:["computeStyles"]};function Ms(r){return r.split("-")[0]}var Al=Math.max,$d=Math.min,ju=Math.round;function Gm(){var r=navigator.userAgentData;return r!=null&&r.brands&&Array.isArray(r.brands)?r.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Uw(){return!/^((?!chrome|android).)*safari/i.test(Gm())}function Uu(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var n=r.getBoundingClientRect(),i=1,o=1;e&&Wo(r)&&(i=r.offsetWidth>0&&ju(n.width)/r.offsetWidth||1,o=r.offsetHeight>0&&ju(n.height)/r.offsetHeight||1);var u=Tl(r)?Ro(r):window,a=u.visualViewport,d=!Uw()&&t,m=(n.left+(d&&a?a.offsetLeft:0))/i,_=(n.top+(d&&a?a.offsetTop:0))/o,v=n.width/i,S=n.height/o;return{width:v,height:S,top:_,right:m+v,bottom:_+S,left:m,x:m,y:_}}function Vg(r){var e=Uu(r),t=r.offsetWidth,n=r.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:r.offsetLeft,y:r.offsetTop,width:t,height:n}}function Vw(r,e){var t=e.getRootNode&&e.getRootNode();if(r.contains(e))return!0;if(t&&Ug(t)){var n=e;do{if(n&&r.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Qs(r){return Ro(r).getComputedStyle(r)}function GS(r){return["table","td","th"].indexOf(Es(r))>=0}function qa(r){return((Tl(r)?r.ownerDocument:r.document)||window.document).documentElement}function rp(r){return Es(r)==="html"?r:r.assignedSlot||r.parentNode||(Ug(r)?r.host:null)||qa(r)}function Ty(r){return!Wo(r)||Qs(r).position==="fixed"?null:r.offsetParent}function ZS(r){var e=/firefox/i.test(Gm()),t=/Trident/i.test(Gm());if(t&&Wo(r)){var n=Qs(r);if(n.position==="fixed")return null}var i=rp(r);for(Ug(i)&&(i=i.host);Wo(i)&&["html","body"].indexOf(Es(i))<0;){var o=Qs(i);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return i;i=i.parentNode}return null}function eh(r){for(var e=Ro(r),t=Ty(r);t&&GS(t)&&Qs(t).position==="static";)t=Ty(t);return t&&(Es(t)==="html"||Es(t)==="body"&&Qs(t).position==="static")?e:t||ZS(r)||e}function qg(r){return["top","bottom"].indexOf(r)>=0?"x":"y"}function If(r,e,t){return Al(r,$d(e,t))}function HS(r,e,t){var n=If(r,e,t);return n>t?t:n}function qw(){return{top:0,right:0,bottom:0,left:0}}function Gw(r){return Object.assign({},qw(),r)}function Zw(r,e){return e.reduce(function(t,n){return t[n]=r,t},{})}var WS=function(e,t){return e=typeof e=="function"?e(Object.assign({},t.rects,{placement:t.placement})):e,Gw(typeof e!="number"?e:Zw(e,Qf))};function XS(r){var e,t=r.state,n=r.name,i=r.options,o=t.elements.arrow,u=t.modifiersData.popperOffsets,a=Ms(t.placement),d=qg(a),m=[ho,Jo].indexOf(a)>=0,_=m?"height":"width";if(!(!o||!u)){var v=WS(i.padding,t),S=Vg(o),T=d==="y"?fo:ho,C=d==="y"?Xo:Jo,L=t.rects.reference[_]+t.rects.reference[d]-u[d]-t.rects.popper[_],P=u[d]-t.rects.reference[d],D=eh(o),I=D?d==="y"?D.clientHeight||0:D.clientWidth||0:0,U=L/2-P/2,O=v[T],ee=I-S[_]-v[C],X=I/2-S[_]/2+U,ue=If(O,X,ee),$=d;t.modifiersData[n]=(e={},e[$]=ue,e.centerOffset=ue-X,e)}}function JS(r){var e=r.state,t=r.options,n=t.element,i=n===void 0?"[data-popper-arrow]":n;i!=null&&(typeof i=="string"&&(i=e.elements.popper.querySelector(i),!i)||Vw(e.elements.popper,i)&&(e.elements.arrow=i))}const KS={name:"arrow",enabled:!0,phase:"main",fn:XS,effect:JS,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Vu(r){return r.split("-")[1]}var YS={top:"auto",right:"auto",bottom:"auto",left:"auto"};function QS(r,e){var t=r.x,n=r.y,i=e.devicePixelRatio||1;return{x:ju(t*i)/i||0,y:ju(n*i)/i||0}}function Cy(r){var e,t=r.popper,n=r.popperRect,i=r.placement,o=r.variation,u=r.offsets,a=r.position,d=r.gpuAcceleration,m=r.adaptive,_=r.roundOffsets,v=r.isFixed,S=u.x,T=S===void 0?0:S,C=u.y,L=C===void 0?0:C,P=typeof _=="function"?_({x:T,y:L}):{x:T,y:L};T=P.x,L=P.y;var D=u.hasOwnProperty("x"),I=u.hasOwnProperty("y"),U=ho,O=fo,ee=window;if(m){var X=eh(t),ue="clientHeight",$="clientWidth";if(X===Ro(t)&&(X=qa(t),Qs(X).position!=="static"&&a==="absolute"&&(ue="scrollHeight",$="scrollWidth")),X=X,i===fo||(i===ho||i===Jo)&&o===Of){O=Xo;var Q=v&&X===ee&&ee.visualViewport?ee.visualViewport.height:X[ue];L-=Q-n.height,L*=d?1:-1}if(i===ho||(i===fo||i===Xo)&&o===Of){U=Jo;var ne=v&&X===ee&&ee.visualViewport?ee.visualViewport.width:X[$];T-=ne-n.width,T*=d?1:-1}}var F=Object.assign({position:a},m&&YS),Z=_===!0?QS({x:T,y:L},Ro(t)):{x:T,y:L};if(T=Z.x,L=Z.y,d){var J;return Object.assign({},F,(J={},J[O]=I?"0":"",J[U]=D?"0":"",J.transform=(ee.devicePixelRatio||1)<=1?"translate("+T+"px, "+L+"px)":"translate3d("+T+"px, "+L+"px, 0)",J))}return Object.assign({},F,(e={},e[O]=I?L+"px":"",e[U]=D?T+"px":"",e.transform="",e))}function e5(r){var e=r.state,t=r.options,n=t.gpuAcceleration,i=n===void 0?!0:n,o=t.adaptive,u=o===void 0?!0:o,a=t.roundOffsets,d=a===void 0?!0:a,m={placement:Ms(e.placement),variation:Vu(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Cy(Object.assign({},m,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:u,roundOffsets:d})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Cy(Object.assign({},m,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:d})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const t5={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:e5,data:{}};var hd={passive:!0};function n5(r){var e=r.state,t=r.instance,n=r.options,i=n.scroll,o=i===void 0?!0:i,u=n.resize,a=u===void 0?!0:u,d=Ro(e.elements.popper),m=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&m.forEach(function(_){_.addEventListener("scroll",t.update,hd)}),a&&d.addEventListener("resize",t.update,hd),function(){o&&m.forEach(function(_){_.removeEventListener("scroll",t.update,hd)}),a&&d.removeEventListener("resize",t.update,hd)}}const r5={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:n5,data:{}};var i5={left:"right",right:"left",bottom:"top",top:"bottom"};function Cd(r){return r.replace(/left|right|bottom|top/g,function(e){return i5[e]})}var o5={start:"end",end:"start"};function My(r){return r.replace(/start|end/g,function(e){return o5[e]})}function Gg(r){var e=Ro(r),t=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:t,scrollTop:n}}function Zg(r){return Uu(qa(r)).left+Gg(r).scrollLeft}function s5(r,e){var t=Ro(r),n=qa(r),i=t.visualViewport,o=n.clientWidth,u=n.clientHeight,a=0,d=0;if(i){o=i.width,u=i.height;var m=Uw();(m||!m&&e==="fixed")&&(a=i.offsetLeft,d=i.offsetTop)}return{width:o,height:u,x:a+Zg(r),y:d}}function a5(r){var e,t=qa(r),n=Gg(r),i=(e=r.ownerDocument)==null?void 0:e.body,o=Al(t.scrollWidth,t.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),u=Al(t.scrollHeight,t.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-n.scrollLeft+Zg(r),d=-n.scrollTop;return Qs(i||t).direction==="rtl"&&(a+=Al(t.clientWidth,i?i.clientWidth:0)-o),{width:o,height:u,x:a,y:d}}function Hg(r){var e=Qs(r),t=e.overflow,n=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+i+n)}function Hw(r){return["html","body","#document"].indexOf(Es(r))>=0?r.ownerDocument.body:Wo(r)&&Hg(r)?r:Hw(rp(r))}function Lf(r,e){var t;e===void 0&&(e=[]);var n=Hw(r),i=n===((t=r.ownerDocument)==null?void 0:t.body),o=Ro(n),u=i?[o].concat(o.visualViewport||[],Hg(n)?n:[]):n,a=e.concat(u);return i?a:a.concat(Lf(rp(u)))}function Zm(r){return Object.assign({},r,{left:r.x,top:r.y,right:r.x+r.width,bottom:r.y+r.height})}function l5(r,e){var t=Uu(r,!1,e==="fixed");return t.top=t.top+r.clientTop,t.left=t.left+r.clientLeft,t.bottom=t.top+r.clientHeight,t.right=t.left+r.clientWidth,t.width=r.clientWidth,t.height=r.clientHeight,t.x=t.left,t.y=t.top,t}function Ey(r,e,t){return e===Nw?Zm(s5(r,t)):Tl(e)?l5(e,t):Zm(a5(qa(r)))}function u5(r){var e=Lf(rp(r)),t=["absolute","fixed"].indexOf(Qs(r).position)>=0,n=t&&Wo(r)?eh(r):r;return Tl(n)?e.filter(function(i){return Tl(i)&&Vw(i,n)&&Es(i)!=="body"}):[]}function c5(r,e,t,n){var i=e==="clippingParents"?u5(r):[].concat(e),o=[].concat(i,[t]),u=o[0],a=o.reduce(function(d,m){var _=Ey(r,m,n);return d.top=Al(_.top,d.top),d.right=$d(_.right,d.right),d.bottom=$d(_.bottom,d.bottom),d.left=Al(_.left,d.left),d},Ey(r,u,n));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Ww(r){var e=r.reference,t=r.element,n=r.placement,i=n?Ms(n):null,o=n?Vu(n):null,u=e.x+e.width/2-t.width/2,a=e.y+e.height/2-t.height/2,d;switch(i){case fo:d={x:u,y:e.y-t.height};break;case Xo:d={x:u,y:e.y+e.height};break;case Jo:d={x:e.x+e.width,y:a};break;case ho:d={x:e.x-t.width,y:a};break;default:d={x:e.x,y:e.y}}var m=i?qg(i):null;if(m!=null){var _=m==="y"?"height":"width";switch(o){case $u:d[m]=d[m]-(e[_]/2-t[_]/2);break;case Of:d[m]=d[m]+(e[_]/2-t[_]/2);break}}return d}function Nf(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=n===void 0?r.placement:n,o=t.strategy,u=o===void 0?r.strategy:o,a=t.boundary,d=a===void 0?LS:a,m=t.rootBoundary,_=m===void 0?Nw:m,v=t.elementContext,S=v===void 0?hf:v,T=t.altBoundary,C=T===void 0?!1:T,L=t.padding,P=L===void 0?0:L,D=Gw(typeof P!="number"?P:Zw(P,Qf)),I=S===hf?PS:hf,U=r.rects.popper,O=r.elements[C?I:S],ee=c5(Tl(O)?O:O.contextElement||qa(r.elements.popper),d,_,u),X=Uu(r.elements.reference),ue=Ww({reference:X,element:U,placement:i}),$=Zm(Object.assign({},U,ue)),Q=S===hf?$:X,ne={top:ee.top-Q.top+D.top,bottom:Q.bottom-ee.bottom+D.bottom,left:ee.left-Q.left+D.left,right:Q.right-ee.right+D.right},F=r.modifiersData.offset;if(S===hf&&F){var Z=F[i];Object.keys(ne).forEach(function(J){var be=[Jo,Xo].indexOf(J)>=0?1:-1,ke=[fo,Xo].indexOf(J)>=0?"y":"x";ne[J]+=Z[ke]*be})}return ne}function f5(r,e){e===void 0&&(e={});var t=e,n=t.placement,i=t.boundary,o=t.rootBoundary,u=t.padding,a=t.flipVariations,d=t.allowedAutoPlacements,m=d===void 0?$w:d,_=Vu(n),v=_?a?Sy:Sy.filter(function(C){return Vu(C)===_}):Qf,S=v.filter(function(C){return m.indexOf(C)>=0});S.length===0&&(S=v);var T=S.reduce(function(C,L){return C[L]=Nf(r,{placement:L,boundary:i,rootBoundary:o,padding:u})[Ms(L)],C},{});return Object.keys(T).sort(function(C,L){return T[C]-T[L]})}function h5(r){if(Ms(r)===jg)return[];var e=Cd(r);return[My(r),e,My(e)]}function d5(r){var e=r.state,t=r.options,n=r.name;if(!e.modifiersData[n]._skip){for(var i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,a=u===void 0?!0:u,d=t.fallbackPlacements,m=t.padding,_=t.boundary,v=t.rootBoundary,S=t.altBoundary,T=t.flipVariations,C=T===void 0?!0:T,L=t.allowedAutoPlacements,P=e.options.placement,D=Ms(P),I=D===P,U=d||(I||!C?[Cd(P)]:h5(P)),O=[P].concat(U).reduce(function(it,at){return it.concat(Ms(at)===jg?f5(e,{placement:at,boundary:_,rootBoundary:v,padding:m,flipVariations:C,allowedAutoPlacements:L}):at)},[]),ee=e.rects.reference,X=e.rects.popper,ue=new Map,$=!0,Q=O[0],ne=0;ne<O.length;ne++){var F=O[ne],Z=Ms(F),J=Vu(F)===$u,be=[fo,Xo].indexOf(Z)>=0,ke=be?"width":"height",ge=Nf(e,{placement:F,boundary:_,rootBoundary:v,altBoundary:S,padding:m}),ve=be?J?Jo:ho:J?Xo:fo;ee[ke]>X[ke]&&(ve=Cd(ve));var fe=Cd(ve),Pe=[];if(o&&Pe.push(ge[Z]<=0),a&&Pe.push(ge[ve]<=0,ge[fe]<=0),Pe.every(function(it){return it})){Q=F,$=!1;break}ue.set(F,Pe)}if($)for(var Ee=C?3:1,Fe=function(at){var ft=O.find(function(Ct){var xt=ue.get(Ct);if(xt)return xt.slice(0,at).every(function(It){return It})});if(ft)return Q=ft,"break"},ot=Ee;ot>0;ot--){var ct=Fe(ot);if(ct==="break")break}e.placement!==Q&&(e.modifiersData[n]._skip=!0,e.placement=Q,e.reset=!0)}}const p5={name:"flip",enabled:!0,phase:"main",fn:d5,requiresIfExists:["offset"],data:{_skip:!1}};function Iy(r,e,t){return t===void 0&&(t={x:0,y:0}),{top:r.top-e.height-t.y,right:r.right-e.width+t.x,bottom:r.bottom-e.height+t.y,left:r.left-e.width-t.x}}function Ly(r){return[fo,Jo,Xo,ho].some(function(e){return r[e]>=0})}function m5(r){var e=r.state,t=r.name,n=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,u=Nf(e,{elementContext:"reference"}),a=Nf(e,{altBoundary:!0}),d=Iy(u,n),m=Iy(a,i,o),_=Ly(d),v=Ly(m);e.modifiersData[t]={referenceClippingOffsets:d,popperEscapeOffsets:m,isReferenceHidden:_,hasPopperEscaped:v},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":_,"data-popper-escaped":v})}const g5={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:m5};function _5(r,e,t){var n=Ms(r),i=[ho,fo].indexOf(n)>=0?-1:1,o=typeof t=="function"?t(Object.assign({},e,{placement:r})):t,u=o[0],a=o[1];return u=u||0,a=(a||0)*i,[ho,Jo].indexOf(n)>=0?{x:a,y:u}:{x:u,y:a}}function y5(r){var e=r.state,t=r.options,n=r.name,i=t.offset,o=i===void 0?[0,0]:i,u=$w.reduce(function(_,v){return _[v]=_5(v,e.rects,o),_},{}),a=u[e.placement],d=a.x,m=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=d,e.modifiersData.popperOffsets.y+=m),e.modifiersData[n]=u}const b5={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:y5};function v5(r){var e=r.state,t=r.name;e.modifiersData[t]=Ww({reference:e.rects.reference,element:e.rects.popper,placement:e.placement})}const w5={name:"popperOffsets",enabled:!0,phase:"read",fn:v5,data:{}};function x5(r){return r==="x"?"y":"x"}function A5(r){var e=r.state,t=r.options,n=r.name,i=t.mainAxis,o=i===void 0?!0:i,u=t.altAxis,a=u===void 0?!1:u,d=t.boundary,m=t.rootBoundary,_=t.altBoundary,v=t.padding,S=t.tether,T=S===void 0?!0:S,C=t.tetherOffset,L=C===void 0?0:C,P=Nf(e,{boundary:d,rootBoundary:m,padding:v,altBoundary:_}),D=Ms(e.placement),I=Vu(e.placement),U=!I,O=qg(D),ee=x5(O),X=e.modifiersData.popperOffsets,ue=e.rects.reference,$=e.rects.popper,Q=typeof L=="function"?L(Object.assign({},e.rects,{placement:e.placement})):L,ne=typeof Q=="number"?{mainAxis:Q,altAxis:Q}:Object.assign({mainAxis:0,altAxis:0},Q),F=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,Z={x:0,y:0};if(X){if(o){var J,be=O==="y"?fo:ho,ke=O==="y"?Xo:Jo,ge=O==="y"?"height":"width",ve=X[O],fe=ve+P[be],Pe=ve-P[ke],Ee=T?-$[ge]/2:0,Fe=I===$u?ue[ge]:$[ge],ot=I===$u?-$[ge]:-ue[ge],ct=e.elements.arrow,it=T&&ct?Vg(ct):{width:0,height:0},at=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:qw(),ft=at[be],Ct=at[ke],xt=If(0,ue[ge],it[ge]),It=U?ue[ge]/2-Ee-xt-ft-ne.mainAxis:Fe-xt-ft-ne.mainAxis,Qt=U?-ue[ge]/2+Ee+xt+Ct+ne.mainAxis:ot+xt+Ct+ne.mainAxis,tn=e.elements.arrow&&eh(e.elements.arrow),rn=tn?O==="y"?tn.clientTop||0:tn.clientLeft||0:0,Ue=(J=F==null?void 0:F[O])!=null?J:0,Xe=ve+It-Ue-rn,qt=ve+Qt-Ue,Ge=If(T?$d(fe,Xe):fe,ve,T?Al(Pe,qt):Pe);X[O]=Ge,Z[O]=Ge-ve}if(a){var et,nn=O==="x"?fo:ho,Ye=O==="x"?Xo:Jo,Ft=X[ee],Tt=ee==="y"?"height":"width",Rn=Ft+P[nn],fr=Ft-P[Ye],un=[fo,ho].indexOf(D)!==-1,Dt=(et=F==null?void 0:F[ee])!=null?et:0,Mt=un?Rn:Ft-ue[Tt]-$[Tt]-Dt+ne.altAxis,Vr=un?Ft+ue[Tt]+$[Tt]-Dt-ne.altAxis:fr,vt=T&&un?HS(Mt,Ft,Vr):If(T?Mt:Rn,Ft,T?Vr:fr);X[ee]=vt,Z[ee]=vt-Ft}e.modifiersData[n]=Z}}const k5={name:"preventOverflow",enabled:!0,phase:"main",fn:A5,requiresIfExists:["offset"]};function S5(r){return{scrollLeft:r.scrollLeft,scrollTop:r.scrollTop}}function T5(r){return r===Ro(r)||!Wo(r)?Gg(r):S5(r)}function C5(r){var e=r.getBoundingClientRect(),t=ju(e.width)/r.offsetWidth||1,n=ju(e.height)/r.offsetHeight||1;return t!==1||n!==1}function M5(r,e,t){t===void 0&&(t=!1);var n=Wo(e),i=Wo(e)&&C5(e),o=qa(e),u=Uu(r,i,t),a={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(n||!n&&!t)&&((Es(e)!=="body"||Hg(o))&&(a=T5(e)),Wo(e)?(d=Uu(e,!0),d.x+=e.clientLeft,d.y+=e.clientTop):o&&(d.x=Zg(o))),{x:u.left+a.scrollLeft-d.x,y:u.top+a.scrollTop-d.y,width:u.width,height:u.height}}function E5(r){var e=new Map,t=new Set,n=[];r.forEach(function(o){e.set(o.name,o)});function i(o){t.add(o.name);var u=[].concat(o.requires||[],o.requiresIfExists||[]);u.forEach(function(a){if(!t.has(a)){var d=e.get(a);d&&i(d)}}),n.push(o)}return r.forEach(function(o){t.has(o.name)||i(o)}),n}function I5(r){var e=E5(r);return US.reduce(function(t,n){return t.concat(e.filter(function(i){return i.phase===n}))},[])}function L5(r){var e;return function(){return e||(e=new Promise(function(t){Promise.resolve().then(function(){e=void 0,t(r())})})),e}}function P5(r){var e=r.reduce(function(t,n){var i=t[n.name];return t[n.name]=i?Object.assign({},i,n,{options:Object.assign({},i.options,n.options),data:Object.assign({},i.data,n.data)}):n,t},{});return Object.keys(e).map(function(t){return e[t]})}var Py={placement:"bottom",modifiers:[],strategy:"absolute"};function zy(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function z5(r){r===void 0&&(r={});var e=r,t=e.defaultModifiers,n=t===void 0?[]:t,i=e.defaultOptions,o=i===void 0?Py:i;return function(a,d,m){m===void 0&&(m=o);var _={placement:"bottom",orderedModifiers:[],options:Object.assign({},Py,o),modifiersData:{},elements:{reference:a,popper:d},attributes:{},styles:{}},v=[],S=!1,T={state:_,setOptions:function(D){var I=typeof D=="function"?D(_.options):D;L(),_.options=Object.assign({},o,_.options,I),_.scrollParents={reference:Tl(a)?Lf(a):a.contextElement?Lf(a.contextElement):[],popper:Lf(d)};var U=I5(P5([].concat(n,_.options.modifiers)));return _.orderedModifiers=U.filter(function(O){return O.enabled}),C(),T.update()},forceUpdate:function(){if(!S){var D=_.elements,I=D.reference,U=D.popper;if(zy(I,U)){_.rects={reference:M5(I,eh(U),_.options.strategy==="fixed"),popper:Vg(U)},_.reset=!1,_.placement=_.options.placement,_.orderedModifiers.forEach(function(ne){return _.modifiersData[ne.name]=Object.assign({},ne.data)});for(var O=0;O<_.orderedModifiers.length;O++){if(_.reset===!0){_.reset=!1,O=-1;continue}var ee=_.orderedModifiers[O],X=ee.fn,ue=ee.options,$=ue===void 0?{}:ue,Q=ee.name;typeof X=="function"&&(_=X({state:_,options:$,name:Q,instance:T})||_)}}}},update:L5(function(){return new Promise(function(P){T.forceUpdate(),P(_)})}),destroy:function(){L(),S=!0}};if(!zy(a,d))return T;T.setOptions(m).then(function(P){!S&&m.onFirstUpdate&&m.onFirstUpdate(P)});function C(){_.orderedModifiers.forEach(function(P){var D=P.name,I=P.options,U=I===void 0?{}:I,O=P.effect;if(typeof O=="function"){var ee=O({state:_,name:D,instance:T,options:U}),X=function(){};v.push(ee||X)}})}function L(){v.forEach(function(P){return P()}),v=[]}return T}}var D5=[r5,w5,t5,jw,b5,p5,k5,KS,g5],R5=z5({defaultModifiers:D5}),B5="tippy-box",Xw="tippy-content",F5="tippy-backdrop",Jw="tippy-arrow",Kw="tippy-svg-arrow",vl={passive:!0,capture:!0},Yw=function(){return document.body};function Cm(r,e,t){if(Array.isArray(r)){var n=r[e];return n??(Array.isArray(t)?t[e]:t)}return r}function Wg(r,e){var t={}.toString.call(r);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function Qw(r,e){return typeof r=="function"?r.apply(void 0,e):r}function Dy(r,e){if(e===0)return r;var t;return function(n){clearTimeout(t),t=setTimeout(function(){r(n)},e)}}function O5(r){return r.split(/\s+/).filter(Boolean)}function Lu(r){return[].concat(r)}function Ry(r,e){r.indexOf(e)===-1&&r.push(e)}function N5(r){return r.filter(function(e,t){return r.indexOf(e)===t})}function $5(r){return r.split("-")[0]}function jd(r){return[].slice.call(r)}function By(r){return Object.keys(r).reduce(function(e,t){return r[t]!==void 0&&(e[t]=r[t]),e},{})}function Pf(){return document.createElement("div")}function ip(r){return["Element","Fragment"].some(function(e){return Wg(r,e)})}function j5(r){return Wg(r,"NodeList")}function U5(r){return Wg(r,"MouseEvent")}function V5(r){return!!(r&&r._tippy&&r._tippy.reference===r)}function q5(r){return ip(r)?[r]:j5(r)?jd(r):Array.isArray(r)?r:jd(document.querySelectorAll(r))}function Mm(r,e){r.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function Fy(r,e){r.forEach(function(t){t&&t.setAttribute("data-state",e)})}function G5(r){var e,t=Lu(r),n=t[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function Z5(r,e){var t=e.clientX,n=e.clientY;return r.every(function(i){var o=i.popperRect,u=i.popperState,a=i.props,d=a.interactiveBorder,m=$5(u.placement),_=u.modifiersData.offset;if(!_)return!0;var v=m==="bottom"?_.top.y:0,S=m==="top"?_.bottom.y:0,T=m==="right"?_.left.x:0,C=m==="left"?_.right.x:0,L=o.top-n+v>d,P=n-o.bottom-S>d,D=o.left-t+T>d,I=t-o.right-C>d;return L||P||D||I})}function Em(r,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){r[n](i,t)})}function Oy(r,e){for(var t=e;t;){var n;if(r.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var Ts={isTouch:!1},Ny=0;function H5(){Ts.isTouch||(Ts.isTouch=!0,window.performance&&document.addEventListener("mousemove",e2))}function e2(){var r=performance.now();r-Ny<20&&(Ts.isTouch=!1,document.removeEventListener("mousemove",e2)),Ny=r}function W5(){var r=document.activeElement;if(V5(r)){var e=r._tippy;r.blur&&!e.state.isVisible&&r.blur()}}function X5(){document.addEventListener("touchstart",H5,vl),window.addEventListener("blur",W5)}var J5=typeof window<"u"&&typeof document<"u",K5=J5?!!window.msCrypto:!1,Y5={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Q5={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},us=Object.assign({appendTo:Yw,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Y5,Q5),eT=Object.keys(us),tT=function(e){var t=Object.keys(e);t.forEach(function(n){us[n]=e[n]})};function t2(r){var e=r.plugins||[],t=e.reduce(function(n,i){var o=i.name,u=i.defaultValue;if(o){var a;n[o]=r[o]!==void 0?r[o]:(a=us[o])!=null?a:u}return n},{});return Object.assign({},r,t)}function nT(r,e){var t=e?Object.keys(t2(Object.assign({},us,{plugins:e}))):eT,n=t.reduce(function(i,o){var u=(r.getAttribute("data-tippy-"+o)||"").trim();if(!u)return i;if(o==="content")i[o]=u;else try{i[o]=JSON.parse(u)}catch{i[o]=u}return i},{});return n}function $y(r,e){var t=Object.assign({},e,{content:Qw(e.content,[r])},e.ignoreAttributes?{}:nT(r,e.plugins));return t.aria=Object.assign({},us.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}var rT=function(){return"innerHTML"};function Hm(r,e){r[rT()]=e}function jy(r){var e=Pf();return r===!0?e.className=Jw:(e.className=Kw,ip(r)?e.appendChild(r):Hm(e,r)),e}function Uy(r,e){ip(e.content)?(Hm(r,""),r.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Hm(r,e.content):r.textContent=e.content)}function Wm(r){var e=r.firstElementChild,t=jd(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(Xw)}),arrow:t.find(function(n){return n.classList.contains(Jw)||n.classList.contains(Kw)}),backdrop:t.find(function(n){return n.classList.contains(F5)})}}function n2(r){var e=Pf(),t=Pf();t.className=B5,t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=Pf();n.className=Xw,n.setAttribute("data-state","hidden"),Uy(n,r.props),e.appendChild(t),t.appendChild(n),i(r.props,r.props);function i(o,u){var a=Wm(e),d=a.box,m=a.content,_=a.arrow;u.theme?d.setAttribute("data-theme",u.theme):d.removeAttribute("data-theme"),typeof u.animation=="string"?d.setAttribute("data-animation",u.animation):d.removeAttribute("data-animation"),u.inertia?d.setAttribute("data-inertia",""):d.removeAttribute("data-inertia"),d.style.maxWidth=typeof u.maxWidth=="number"?u.maxWidth+"px":u.maxWidth,u.role?d.setAttribute("role",u.role):d.removeAttribute("role"),(o.content!==u.content||o.allowHTML!==u.allowHTML)&&Uy(m,r.props),u.arrow?_?o.arrow!==u.arrow&&(d.removeChild(_),d.appendChild(jy(u.arrow))):d.appendChild(jy(u.arrow)):_&&d.removeChild(_)}return{popper:e,onUpdate:i}}n2.$$tippy=!0;var iT=1,dd=[],Im=[];function oT(r,e){var t=$y(r,Object.assign({},us,t2(By(e)))),n,i,o,u=!1,a=!1,d=!1,m=!1,_,v,S,T=[],C=Dy(Xe,t.interactiveDebounce),L,P=iT++,D=null,I=N5(t.plugins),U={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},O={id:P,reference:r,popper:Pf(),popperInstance:D,props:t,state:U,plugins:I,clearDelayTimeouts:Mt,setProps:Vr,setContent:vt,show:Cn,hide:Zn,hideWithInteractivity:jr,enable:un,disable:Dt,unmount:Nr,destroy:Lt};if(!t.render)return O;var ee=t.render(O),X=ee.popper,ue=ee.onUpdate;X.setAttribute("data-tippy-root",""),X.id="tippy-"+O.id,O.popper=X,r._tippy=O,X._tippy=O;var $=I.map(function(tt){return tt.fn(O)}),Q=r.hasAttribute("aria-expanded");return tn(),Ee(),ve(),fe("onCreate",[O]),t.showOnCreate&&Rn(),X.addEventListener("mouseenter",function(){O.props.interactive&&O.state.isVisible&&O.clearDelayTimeouts()}),X.addEventListener("mouseleave",function(){O.props.interactive&&O.props.trigger.indexOf("mouseenter")>=0&&be().addEventListener("mousemove",C)}),O;function ne(){var tt=O.props.touch;return Array.isArray(tt)?tt:[tt,0]}function F(){return ne()[0]==="hold"}function Z(){var tt;return!!((tt=O.props.render)!=null&&tt.$$tippy)}function J(){return L||r}function be(){var tt=J().parentNode;return tt?G5(tt):document}function ke(){return Wm(X)}function ge(tt){return O.state.isMounted&&!O.state.isVisible||Ts.isTouch||_&&_.type==="focus"?0:Cm(O.props.delay,tt?0:1,us.delay)}function ve(tt){tt===void 0&&(tt=!1),X.style.pointerEvents=O.props.interactive&&!tt?"":"none",X.style.zIndex=""+O.props.zIndex}function fe(tt,pt,$t){if($t===void 0&&($t=!0),$.forEach(function(zt){zt[tt]&&zt[tt].apply(zt,pt)}),$t){var Bn;(Bn=O.props)[tt].apply(Bn,pt)}}function Pe(){var tt=O.props.aria;if(tt.content){var pt="aria-"+tt.content,$t=X.id,Bn=Lu(O.props.triggerTarget||r);Bn.forEach(function(zt){var hr=zt.getAttribute(pt);if(O.state.isVisible)zt.setAttribute(pt,hr?hr+" "+$t:$t);else{var ir=hr&&hr.replace($t,"").trim();ir?zt.setAttribute(pt,ir):zt.removeAttribute(pt)}})}}function Ee(){if(!(Q||!O.props.aria.expanded)){var tt=Lu(O.props.triggerTarget||r);tt.forEach(function(pt){O.props.interactive?pt.setAttribute("aria-expanded",O.state.isVisible&&pt===J()?"true":"false"):pt.removeAttribute("aria-expanded")})}}function Fe(){be().removeEventListener("mousemove",C),dd=dd.filter(function(tt){return tt!==C})}function ot(tt){if(!(Ts.isTouch&&(d||tt.type==="mousedown"))){var pt=tt.composedPath&&tt.composedPath()[0]||tt.target;if(!(O.props.interactive&&Oy(X,pt))){if(Lu(O.props.triggerTarget||r).some(function($t){return Oy($t,pt)})){if(Ts.isTouch||O.state.isVisible&&O.props.trigger.indexOf("click")>=0)return}else fe("onClickOutside",[O,tt]);O.props.hideOnClick===!0&&(O.clearDelayTimeouts(),O.hide(),a=!0,setTimeout(function(){a=!1}),O.state.isMounted||ft())}}}function ct(){d=!0}function it(){d=!1}function at(){var tt=be();tt.addEventListener("mousedown",ot,!0),tt.addEventListener("touchend",ot,vl),tt.addEventListener("touchstart",it,vl),tt.addEventListener("touchmove",ct,vl)}function ft(){var tt=be();tt.removeEventListener("mousedown",ot,!0),tt.removeEventListener("touchend",ot,vl),tt.removeEventListener("touchstart",it,vl),tt.removeEventListener("touchmove",ct,vl)}function Ct(tt,pt){It(tt,function(){!O.state.isVisible&&X.parentNode&&X.parentNode.contains(X)&&pt()})}function xt(tt,pt){It(tt,pt)}function It(tt,pt){var $t=ke().box;function Bn(zt){zt.target===$t&&(Em($t,"remove",Bn),pt())}if(tt===0)return pt();Em($t,"remove",v),Em($t,"add",Bn),v=Bn}function Qt(tt,pt,$t){$t===void 0&&($t=!1);var Bn=Lu(O.props.triggerTarget||r);Bn.forEach(function(zt){zt.addEventListener(tt,pt,$t),T.push({node:zt,eventType:tt,handler:pt,options:$t})})}function tn(){F()&&(Qt("touchstart",Ue,{passive:!0}),Qt("touchend",qt,{passive:!0})),O5(O.props.trigger).forEach(function(tt){if(tt!=="manual")switch(Qt(tt,Ue),tt){case"mouseenter":Qt("mouseleave",qt);break;case"focus":Qt(K5?"focusout":"blur",Ge);break;case"focusin":Qt("focusout",Ge);break}})}function rn(){T.forEach(function(tt){var pt=tt.node,$t=tt.eventType,Bn=tt.handler,zt=tt.options;pt.removeEventListener($t,Bn,zt)}),T=[]}function Ue(tt){var pt,$t=!1;if(!(!O.state.isEnabled||et(tt)||a)){var Bn=((pt=_)==null?void 0:pt.type)==="focus";_=tt,L=tt.currentTarget,Ee(),!O.state.isVisible&&U5(tt)&&dd.forEach(function(zt){return zt(tt)}),tt.type==="click"&&(O.props.trigger.indexOf("mouseenter")<0||u)&&O.props.hideOnClick!==!1&&O.state.isVisible?$t=!0:Rn(tt),tt.type==="click"&&(u=!$t),$t&&!Bn&&fr(tt)}}function Xe(tt){var pt=tt.target,$t=J().contains(pt)||X.contains(pt);if(!(tt.type==="mousemove"&&$t)){var Bn=Tt().concat(X).map(function(zt){var hr,ir=zt._tippy,Gr=(hr=ir.popperInstance)==null?void 0:hr.state;return Gr?{popperRect:zt.getBoundingClientRect(),popperState:Gr,props:t}:null}).filter(Boolean);Z5(Bn,tt)&&(Fe(),fr(tt))}}function qt(tt){var pt=et(tt)||O.props.trigger.indexOf("click")>=0&&u;if(!pt){if(O.props.interactive){O.hideWithInteractivity(tt);return}fr(tt)}}function Ge(tt){O.props.trigger.indexOf("focusin")<0&&tt.target!==J()||O.props.interactive&&tt.relatedTarget&&X.contains(tt.relatedTarget)||fr(tt)}function et(tt){return Ts.isTouch?F()!==tt.type.indexOf("touch")>=0:!1}function nn(){Ye();var tt=O.props,pt=tt.popperOptions,$t=tt.placement,Bn=tt.offset,zt=tt.getReferenceClientRect,hr=tt.moveTransition,ir=Z()?Wm(X).arrow:null,Gr=zt?{getBoundingClientRect:zt,contextElement:zt.contextElement||J()}:r,br={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(le){var we=le.state;if(Z()){var Me=ke(),Ne=Me.box;["placement","reference-hidden","escaped"].forEach(function(Ve){Ve==="placement"?Ne.setAttribute("data-placement",we.placement):we.attributes.popper["data-popper-"+Ve]?Ne.setAttribute("data-"+Ve,""):Ne.removeAttribute("data-"+Ve)}),we.attributes.popper={}}}},Ce=[{name:"offset",options:{offset:Bn}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!hr}},br];Z()&&ir&&Ce.push({name:"arrow",options:{element:ir,padding:3}}),Ce.push.apply(Ce,(pt==null?void 0:pt.modifiers)||[]),O.popperInstance=R5(Gr,X,Object.assign({},pt,{placement:$t,onFirstUpdate:S,modifiers:Ce}))}function Ye(){O.popperInstance&&(O.popperInstance.destroy(),O.popperInstance=null)}function Ft(){var tt=O.props.appendTo,pt,$t=J();O.props.interactive&&tt===Yw||tt==="parent"?pt=$t.parentNode:pt=Qw(tt,[$t]),pt.contains(X)||pt.appendChild(X),O.state.isMounted=!0,nn()}function Tt(){return jd(X.querySelectorAll("[data-tippy-root]"))}function Rn(tt){O.clearDelayTimeouts(),tt&&fe("onTrigger",[O,tt]),at();var pt=ge(!0),$t=ne(),Bn=$t[0],zt=$t[1];Ts.isTouch&&Bn==="hold"&&zt&&(pt=zt),pt?n=setTimeout(function(){O.show()},pt):O.show()}function fr(tt){if(O.clearDelayTimeouts(),fe("onUntrigger",[O,tt]),!O.state.isVisible){ft();return}if(!(O.props.trigger.indexOf("mouseenter")>=0&&O.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(tt.type)>=0&&u)){var pt=ge(!1);pt?i=setTimeout(function(){O.state.isVisible&&O.hide()},pt):o=requestAnimationFrame(function(){O.hide()})}}function un(){O.state.isEnabled=!0}function Dt(){O.hide(),O.state.isEnabled=!1}function Mt(){clearTimeout(n),clearTimeout(i),cancelAnimationFrame(o)}function Vr(tt){if(!O.state.isDestroyed){fe("onBeforeUpdate",[O,tt]),rn();var pt=O.props,$t=$y(r,Object.assign({},pt,By(tt),{ignoreAttributes:!0}));O.props=$t,tn(),pt.interactiveDebounce!==$t.interactiveDebounce&&(Fe(),C=Dy(Xe,$t.interactiveDebounce)),pt.triggerTarget&&!$t.triggerTarget?Lu(pt.triggerTarget).forEach(function(Bn){Bn.removeAttribute("aria-expanded")}):$t.triggerTarget&&r.removeAttribute("aria-expanded"),Ee(),ve(),ue&&ue(pt,$t),O.popperInstance&&(nn(),Tt().forEach(function(Bn){requestAnimationFrame(Bn._tippy.popperInstance.forceUpdate)})),fe("onAfterUpdate",[O,tt])}}function vt(tt){O.setProps({content:tt})}function Cn(){var tt=O.state.isVisible,pt=O.state.isDestroyed,$t=!O.state.isEnabled,Bn=Ts.isTouch&&!O.props.touch,zt=Cm(O.props.duration,0,us.duration);if(!(tt||pt||$t||Bn)&&!J().hasAttribute("disabled")&&(fe("onShow",[O],!1),O.props.onShow(O)!==!1)){if(O.state.isVisible=!0,Z()&&(X.style.visibility="visible"),ve(),at(),O.state.isMounted||(X.style.transition="none"),Z()){var hr=ke(),ir=hr.box,Gr=hr.content;Mm([ir,Gr],0)}S=function(){var Ce;if(!(!O.state.isVisible||m)){if(m=!0,X.offsetHeight,X.style.transition=O.props.moveTransition,Z()&&O.props.animation){var oe=ke(),le=oe.box,we=oe.content;Mm([le,we],zt),Fy([le,we],"visible")}Pe(),Ee(),Ry(Im,O),(Ce=O.popperInstance)==null||Ce.forceUpdate(),fe("onMount",[O]),O.props.animation&&Z()&&xt(zt,function(){O.state.isShown=!0,fe("onShown",[O])})}},Ft()}}function Zn(){var tt=!O.state.isVisible,pt=O.state.isDestroyed,$t=!O.state.isEnabled,Bn=Cm(O.props.duration,1,us.duration);if(!(tt||pt||$t)&&(fe("onHide",[O],!1),O.props.onHide(O)!==!1)){if(O.state.isVisible=!1,O.state.isShown=!1,m=!1,u=!1,Z()&&(X.style.visibility="hidden"),Fe(),ft(),ve(!0),Z()){var zt=ke(),hr=zt.box,ir=zt.content;O.props.animation&&(Mm([hr,ir],Bn),Fy([hr,ir],"hidden"))}Pe(),Ee(),O.props.animation?Z()&&Ct(Bn,O.unmount):O.unmount()}}function jr(tt){be().addEventListener("mousemove",C),Ry(dd,C),C(tt)}function Nr(){O.state.isVisible&&O.hide(),O.state.isMounted&&(Ye(),Tt().forEach(function(tt){tt._tippy.unmount()}),X.parentNode&&X.parentNode.removeChild(X),Im=Im.filter(function(tt){return tt!==O}),O.state.isMounted=!1,fe("onHidden",[O]))}function Lt(){O.state.isDestroyed||(O.clearDelayTimeouts(),O.unmount(),rn(),delete r._tippy,O.state.isDestroyed=!0,fe("onDestroy",[O]))}}function th(r,e){e===void 0&&(e={});var t=us.plugins.concat(e.plugins||[]);X5();var n=Object.assign({},e,{plugins:t}),i=q5(r),o=i.reduce(function(u,a){var d=a&&oT(a,n);return d&&u.push(d),u},[]);return ip(r)?o[0]:o}th.defaultProps=us;th.setDefaultProps=tT;th.currentInput=Ts;Object.assign({},jw,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});th.setDefaultProps({render:n2});let dn;const r2=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&r2.decode();let bf=null;function zf(){return(bf===null||bf.byteLength===0)&&(bf=new Uint8Array(dn.memory.buffer)),bf}function Ho(r,e){return r=r>>>0,r2.decode(zf().subarray(r,r+e))}const Js=new Array(128).fill(void 0);Js.push(void 0,null,!0,!1);let Df=Js.length;function ni(r){Df===Js.length&&Js.push(Js.length+1);const e=Df;return Df=Js[e],Js[e]=r,e}function Kn(r){return Js[r]}function sT(r){r<132||(Js[r]=Df,Df=r)}function Pu(r){const e=Kn(r);return sT(r),e}function Lm(r){return r==null}let vf=null;function aT(){return(vf===null||vf.byteLength===0)&&(vf=new Float64Array(dn.memory.buffer)),vf}let wf=null;function lr(){return(wf===null||wf.byteLength===0)&&(wf=new Int32Array(dn.memory.buffer)),wf}let Fa=0;const Md=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},lT=typeof Md.encodeInto=="function"?function(r,e){return Md.encodeInto(r,e)}:function(r,e){const t=Md.encode(r);return e.set(t),{read:r.length,written:t.length}};function pd(r,e,t){if(t===void 0){const a=Md.encode(r),d=e(a.length,1)>>>0;return zf().subarray(d,d+a.length).set(a),Fa=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=zf();let u=0;for(;u<n;u++){const a=r.charCodeAt(u);if(a>127)break;o[i+u]=a}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const a=zf().subarray(i+u,i+n),d=lT(r,a);u+=d.written}return Fa=u,i}function Xm(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Xm(r[0]));for(let u=1;u<i;u++)o+=", "+Xm(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function uT(r,e){const t=e(r.length*1,1)>>>0;return zf().set(r,t/1),Fa=r.length,t}function Pm(r,e){try{return r.apply(this,e)}catch(t){dn.__wbindgen_exn_store(ni(t))}}class Ud{static __wrap(e){e=e>>>0;const t=Object.create(Ud.prototype);return t.__wbg_ptr=e,t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();dn.__wbg_jsroutesnapper_free(e)}constructor(e){try{const o=dn.__wbindgen_add_to_stack_pointer(-16),u=uT(e,dn.__wbindgen_malloc),a=Fa;dn.jsroutesnapper_new(o,u,a);var t=lr()[o/4+0],n=lr()[o/4+1],i=lr()[o/4+2];if(i)throw Pu(n);return Ud.__wrap(t)}finally{dn.__wbindgen_add_to_stack_pointer(16)}}setRouteConfig(e){dn.jsroutesnapper_setRouteConfig(this.__wbg_ptr,ni(e))}setAreaMode(){dn.jsroutesnapper_setAreaMode(this.__wbg_ptr)}getConfig(){let e,t;try{const o=dn.__wbindgen_add_to_stack_pointer(-16);dn.jsroutesnapper_getConfig(o,this.__wbg_ptr);var n=lr()[o/4+0],i=lr()[o/4+1];return e=n,t=i,Ho(n,i)}finally{dn.__wbindgen_add_to_stack_pointer(16),dn.__wbindgen_free(e,t,1)}}toFinalFeature(){try{const n=dn.__wbindgen_add_to_stack_pointer(-16);dn.jsroutesnapper_toFinalFeature(n,this.__wbg_ptr);var e=lr()[n/4+0],t=lr()[n/4+1];let i;return e!==0&&(i=Ho(e,t).slice(),dn.__wbindgen_free(e,t*1)),i}finally{dn.__wbindgen_add_to_stack_pointer(16)}}renderGeojson(){let e,t;try{const o=dn.__wbindgen_add_to_stack_pointer(-16);dn.jsroutesnapper_renderGeojson(o,this.__wbg_ptr);var n=lr()[o/4+0],i=lr()[o/4+1];return e=n,t=i,Ho(n,i)}finally{dn.__wbindgen_add_to_stack_pointer(16),dn.__wbindgen_free(e,t,1)}}toggleSnapMode(){dn.jsroutesnapper_toggleSnapMode(this.__wbg_ptr)}onMouseMove(e,t,n){return dn.jsroutesnapper_onMouseMove(this.__wbg_ptr,e,t,n)!==0}onClick(){dn.jsroutesnapper_onClick(this.__wbg_ptr)}onDragStart(){return dn.jsroutesnapper_onDragStart(this.__wbg_ptr)!==0}onMouseUp(){return dn.jsroutesnapper_onMouseUp(this.__wbg_ptr)!==0}clearState(){dn.jsroutesnapper_clearState(this.__wbg_ptr)}editExisting(e){try{const i=dn.__wbindgen_add_to_stack_pointer(-16);dn.jsroutesnapper_editExisting(i,this.__wbg_ptr,ni(e));var t=lr()[i/4+0],n=lr()[i/4+1];if(n)throw Pu(t)}finally{dn.__wbindgen_add_to_stack_pointer(16)}}debugRenderGraph(){let e,t;try{const o=dn.__wbindgen_add_to_stack_pointer(-16);dn.jsroutesnapper_debugRenderGraph(o,this.__wbg_ptr);var n=lr()[o/4+0],i=lr()[o/4+1];return e=n,t=i,Ho(n,i)}finally{dn.__wbindgen_add_to_stack_pointer(16),dn.__wbindgen_free(e,t,1)}}debugSnappableNodes(){let e,t;try{const o=dn.__wbindgen_add_to_stack_pointer(-16);dn.jsroutesnapper_debugSnappableNodes(o,this.__wbg_ptr);var n=lr()[o/4+0],i=lr()[o/4+1];return e=n,t=i,Ho(n,i)}finally{dn.__wbindgen_add_to_stack_pointer(16),dn.__wbindgen_free(e,t,1)}}routeNameForWaypoints(e){let t,n;try{const _=dn.__wbindgen_add_to_stack_pointer(-16);dn.jsroutesnapper_routeNameForWaypoints(_,this.__wbg_ptr,ni(e));var i=lr()[_/4+0],o=lr()[_/4+1],u=lr()[_/4+2],a=lr()[_/4+3],d=i,m=o;if(a)throw d=0,m=0,Pu(u);return t=d,n=m,Ho(d,m)}finally{dn.__wbindgen_add_to_stack_pointer(16),dn.__wbindgen_free(t,n,1)}}addSnappedWaypoint(e,t){dn.jsroutesnapper_addSnappedWaypoint(this.__wbg_ptr,e,t)}undo(){dn.jsroutesnapper_undo(this.__wbg_ptr)}calculateRoute(e){let t,n;try{const _=dn.__wbindgen_add_to_stack_pointer(-16);dn.jsroutesnapper_calculateRoute(_,this.__wbg_ptr,ni(e));var i=lr()[_/4+0],o=lr()[_/4+1],u=lr()[_/4+2],a=lr()[_/4+3],d=i,m=o;if(a)throw d=0,m=0,Pu(u);return t=d,n=m,Ho(d,m)}finally{dn.__wbindgen_add_to_stack_pointer(16),dn.__wbindgen_free(t,n,1)}}getExtraNodes(e,t){let n,i;try{const v=dn.__wbindgen_add_to_stack_pointer(-16);dn.jsroutesnapper_getExtraNodes(v,this.__wbg_ptr,ni(e),ni(t));var o=lr()[v/4+0],u=lr()[v/4+1],a=lr()[v/4+2],d=lr()[v/4+3],m=o,_=u;if(d)throw m=0,_=0,Pu(a);return n=m,i=_,Ho(m,_)}finally{dn.__wbindgen_add_to_stack_pointer(16),dn.__wbindgen_free(n,i,1)}}}async function cT(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function fT(){const r={};return r.wbg={},r.wbg.__wbindgen_string_new=function(e,t){const n=Ho(e,t);return ni(n)},r.wbg.__wbindgen_object_drop_ref=function(e){Pu(e)},r.wbg.__wbindgen_error_new=function(e,t){const n=new Error(Ho(e,t));return ni(n)},r.wbg.__wbindgen_number_get=function(e,t){const n=Kn(t),i=typeof n=="number"?n:void 0;aT()[e/8+1]=Lm(i)?0:i,lr()[e/4+0]=!Lm(i)},r.wbg.__wbindgen_is_object=function(e){const t=Kn(e);return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return Kn(e)===void 0},r.wbg.__wbindgen_in=function(e,t){return Kn(e)in Kn(t)},r.wbg.__wbindgen_boolean_get=function(e){const t=Kn(e);return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return Kn(e)==Kn(t)},r.wbg.__wbindgen_string_get=function(e,t){const n=Kn(t),i=typeof n=="string"?n:void 0;var o=Lm(i)?0:pd(i,dn.__wbindgen_malloc,dn.__wbindgen_realloc),u=Fa;lr()[e/4+1]=u,lr()[e/4+0]=o},r.wbg.__wbg_String_4370c5505c674d30=function(e,t){const n=String(Kn(t)),i=pd(n,dn.__wbindgen_malloc,dn.__wbindgen_realloc),o=Fa;lr()[e/4+1]=o,lr()[e/4+0]=i},r.wbg.__wbindgen_object_clone_ref=function(e){const t=Kn(e);return ni(t)},r.wbg.__wbg_getwithrefkey_d1f0d12f1f1b63ea=function(e,t){const n=Kn(e)[Kn(t)];return ni(n)},r.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return ni(e)},r.wbg.__wbg_stack_658279fe44541cf6=function(e,t){const n=Kn(t).stack,i=pd(n,dn.__wbindgen_malloc,dn.__wbindgen_realloc),o=Fa;lr()[e/4+1]=o,lr()[e/4+0]=i},r.wbg.__wbg_error_f851667af71bcfc6=function(e,t){let n,i;try{n=e,i=t,console.error(Ho(e,t))}finally{dn.__wbindgen_free(n,i,1)}},r.wbg.__wbg_debug_9a6b3243fbbebb61=function(e){console.debug(Kn(e))},r.wbg.__wbg_error_788ae33f81d3b84b=function(e){console.error(Kn(e))},r.wbg.__wbg_info_2e30e8204b29d91d=function(e){console.info(Kn(e))},r.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(Kn(e))},r.wbg.__wbg_warn_d60e832f9882c1b2=function(e){console.warn(Kn(e))},r.wbg.__wbg_get_44be0491f933a435=function(e,t){const n=Kn(e)[t>>>0];return ni(n)},r.wbg.__wbg_length_fff51ee6522a1a18=function(e){return Kn(e).length},r.wbg.__wbindgen_is_function=function(e){return typeof Kn(e)=="function"},r.wbg.__wbg_next_526fc47e980da008=function(e){const t=Kn(e).next;return ni(t)},r.wbg.__wbg_next_ddb3312ca1c4e32a=function(){return Pm(function(e){const t=Kn(e).next();return ni(t)},arguments)},r.wbg.__wbg_done_5c1f01fb660d73b5=function(e){return Kn(e).done},r.wbg.__wbg_value_1695675138684bd5=function(e){const t=Kn(e).value;return ni(t)},r.wbg.__wbg_iterator_97f0c81209c6c35a=function(){return ni(Symbol.iterator)},r.wbg.__wbg_get_97b561fb56f034b5=function(){return Pm(function(e,t){const n=Reflect.get(Kn(e),Kn(t));return ni(n)},arguments)},r.wbg.__wbg_call_cb65541d95d71282=function(){return Pm(function(e,t){const n=Kn(e).call(Kn(t));return ni(n)},arguments)},r.wbg.__wbg_isArray_4c24b343cb13cfb1=function(e){return Array.isArray(Kn(e))},r.wbg.__wbg_instanceof_ArrayBuffer_39ac22089b74fddb=function(e){let t;try{t=Kn(e)instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_buffer_085ec1f694018c4f=function(e){const t=Kn(e).buffer;return ni(t)},r.wbg.__wbg_new_8125e318e6245eed=function(e){const t=new Uint8Array(Kn(e));return ni(t)},r.wbg.__wbg_set_5cf90238115182c3=function(e,t,n){Kn(e).set(Kn(t),n>>>0)},r.wbg.__wbg_length_72e2208bbc0efc61=function(e){return Kn(e).length},r.wbg.__wbg_instanceof_Uint8Array_d8d9cb2b8e8ac1d4=function(e){let t;try{t=Kn(e)instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbindgen_debug_string=function(e,t){const n=Xm(Kn(t)),i=pd(n,dn.__wbindgen_malloc,dn.__wbindgen_realloc),o=Fa;lr()[e/4+1]=o,lr()[e/4+0]=i},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Ho(e,t))},r.wbg.__wbindgen_memory=function(){const e=dn.memory;return ni(e)},r}function hT(r,e){return dn=r.exports,i2.__wbindgen_wasm_module=e,vf=null,wf=null,bf=null,dn}async function i2(r){if(dn!==void 0)return dn;typeof r>"u"&&(r=new URL("/ltn/assets/route_snapper_bg-CaN5p6v7.wasm",import.meta.url));const e=fT();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await cT(await r,e);return hT(t,n)}function Vd(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Mu(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Vy(r[0])||!Vy(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Vd(n,e,t)}function Ru(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return Vd(n,e,t)}function Vy(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function o2(r){return!!r&&r.constructor===Object}function Ku(r,e,t){if(r!==null)for(var n,i,o,u,a,d,m,_=0,v=0,S,T=r.type,C=T==="FeatureCollection",L=T==="Feature",P=C?r.features.length:1,D=0;D<P;D++){m=C?r.features[D].geometry:L?r.geometry:r,S=m?m.type==="GeometryCollection":!1,a=S?m.geometries.length:1;for(var I=0;I<a;I++){var U=0,O=0;if(u=S?m.geometries[I]:m,u!==null){d=u.coordinates;var ee=u.type;switch(_=t&&(ee==="Polygon"||ee==="MultiPolygon")?1:0,ee){case null:break;case"Point":if(e(d,v,D,U,O)===!1)return!1;v++,U++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],v,D,U,O)===!1)return!1;v++,ee==="MultiPoint"&&U++}ee==="LineString"&&U++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-_;i++){if(e(d[n][i],v,D,U,O)===!1)return!1;v++}ee==="MultiLineString"&&U++,ee==="Polygon"&&O++}ee==="Polygon"&&U++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(O=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-_;o++){if(e(d[n][i][o],v,D,U,O)===!1)return!1;v++}O++}U++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(Ku(u.geometries[n],e,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function dT(r,e,t,n){var i=t;return Ku(r,function(o,u,a,d,m){u===0&&t===void 0?i=o:i=e(i,o,u,a,d,m)},n),i}function s2(r,e){var t;switch(r.type){case"FeatureCollection":for(t=0;t<r.features.length&&e(r.features[t].properties,t)!==!1;t++);break;case"Feature":e(r.properties,0);break}}function pT(r,e,t){var n=t;return s2(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function qd(r,e){if(r.type==="Feature")e(r,0);else if(r.type==="FeatureCollection")for(var t=0;t<r.features.length&&e(r.features[t],t)!==!1;t++);}function mT(r,e,t){var n=t;return qd(r,function(i,o){o===0&&t===void 0?n=i:n=e(n,i,o)}),n}function gT(r){var e=[];return Ku(r,function(t){e.push(t)}),e}function Xg(r,e){var t,n,i,o,u,a,d,m,_,v,S=0,T=r.type==="FeatureCollection",C=r.type==="Feature",L=T?r.features.length:1;for(t=0;t<L;t++){for(a=T?r.features[t].geometry:C?r.geometry:r,m=T?r.features[t].properties:C?r.properties:{},_=T?r.features[t].bbox:C?r.bbox:void 0,v=T?r.features[t].id:C?r.id:void 0,d=a?a.type==="GeometryCollection":!1,u=d?a.geometries.length:1,i=0;i<u;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,S,m,_,v)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,S,m,_,v)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],S,m,_,v)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}S++}}function _T(r,e,t){var n=t;return Xg(r,function(i,o,u,a,d){o===0&&t===void 0?n=i:n=e(n,i,o,u,a,d)}),n}function Yu(r,e){Xg(r,function(t,n,i,o,u){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(Vd(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var m=0;m<t.coordinates.length;m++){var _=t.coordinates[m],v={type:d,coordinates:_};if(e(Vd(v,i),n,m)===!1)return!1}})}function yT(r,e,t){var n=t;return Yu(r,function(i,o,u){o===0&&u===0&&t===void 0?n=i:n=e(n,i,o,u)}),n}function a2(r,e){Yu(r,function(t,n,i){var o=0;if(t.geometry){var u=t.geometry.type;if(!(u==="Point"||u==="MultiPoint")){var a,d=0,m=0,_=0;if(Ku(t,function(v,S,T,C,L){if(a===void 0||n>d||C>m||L>_){a=v,d=n,m=C,_=L,o=0;return}var P=Ru([a,v],t.properties);if(e(P,n,i,L,o)===!1)return!1;o++,a=v})===!1)return!1}}})}function bT(r,e,t){var n=t,i=!1;return a2(r,function(o,u,a,d,m){i===!1&&t===void 0?n=o:n=e(n,o,u,a,d,m),i=!0}),n}function l2(r,e){if(!r)throw new Error("geojson is required");Yu(r,function(t,n,i){if(t.geometry!==null){var o=t.geometry.type,u=t.geometry.coordinates;switch(o){case"LineString":if(e(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var a=0;a<u.length;a++)if(e(Ru(u[a],t.properties),n,i,a)===!1)return!1;break}}})}function vT(r,e,t){var n=t;return l2(r,function(i,o,u,a){o===0&&t===void 0?n=i:n=e(n,i,o,u,a)}),n}function wT(r,e){if(e=e||{},!o2(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.segmentIndex||0,u=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":u=u||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":case"MultiPoint":return null;case"LineString":return o<0&&(o=d.length+o-1),Ru([d[o],d[o+1]],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o-1),Ru([d[i][o],d[i][o+1]],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o-1),Ru([d[n][o],d[n][o+1]],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o-1),Ru([d[n][i][o],d[n][i][o+1]],u,e)}throw new Error("geojson is invalid")}function xT(r,e){if(e=e||{},!o2(e))throw new Error("options is invalid");var t=e.featureIndex||0,n=e.multiFeatureIndex||0,i=e.geometryIndex||0,o=e.coordIndex||0,u=e.properties,a;switch(r.type){case"FeatureCollection":t<0&&(t=r.features.length+t),u=u||r.features[t].properties,a=r.features[t].geometry;break;case"Feature":u=u||r.properties,a=r.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":a=r;break;default:throw new Error("geojson is invalid")}if(a===null)return null;var d=a.coordinates;switch(a.type){case"Point":return Mu(d,u,e);case"MultiPoint":return n<0&&(n=d.length+n),Mu(d[n],u,e);case"LineString":return o<0&&(o=d.length+o),Mu(d[o],u,e);case"Polygon":return i<0&&(i=d.length+i),o<0&&(o=d[i].length+o),Mu(d[i][o],u,e);case"MultiLineString":return n<0&&(n=d.length+n),o<0&&(o=d[n].length+o),Mu(d[n][o],u,e);case"MultiPolygon":return n<0&&(n=d.length+n),i<0&&(i=d[n].length+i),o<0&&(o=d[n][i].length-o),Mu(d[n][i][o],u,e)}throw new Error("geojson is invalid")}const AT=Object.freeze(Object.defineProperty({__proto__:null,coordAll:gT,coordEach:Ku,coordReduce:dT,featureEach:qd,featureReduce:mT,findPoint:xT,findSegment:wT,flattenEach:Yu,flattenReduce:yT,geomEach:Xg,geomReduce:_T,lineEach:l2,lineReduce:vT,propEach:s2,propReduce:pT,segmentEach:a2,segmentReduce:bT},Symbol.toStringTag,{value:"Module"}));var ao=63710088e-1,u2={centimeters:ao*100,centimetres:ao*100,degrees:ao/111325,feet:ao*3.28084,inches:ao*39.37,kilometers:ao/1e3,kilometres:ao/1e3,meters:ao,metres:ao,miles:ao/1609.344,millimeters:ao*1e3,millimetres:ao*1e3,nauticalmiles:ao/1852,radians:1,yards:ao*1.0936};function c2(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function Ed(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Gy(r[0])||!Gy(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return c2(n,e,t)}function qy(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return c2(n,e,t)}function kT(r,e){e===void 0&&(e="kilometers");var t=u2[e];if(!t)throw new Error(e+" units is invalid");return r*t}function ST(r,e){e===void 0&&(e="kilometers");var t=u2[e];if(!t)throw new Error(e+" units is invalid");return r/t}function Jm(r){var e=r%(2*Math.PI);return e*180/Math.PI}function cs(r){var e=r%360;return e*Math.PI/180}function Gy(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function $f(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return r.geometry.coordinates;if(r.type==="Point")return r.coordinates}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return r;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function TT(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function f2(r,e,t){if(t===void 0&&(t={}),t.final===!0)return CT(r,e);var n=$f(r),i=$f(e),o=cs(n[0]),u=cs(i[0]),a=cs(n[1]),d=cs(i[1]),m=Math.sin(u-o)*Math.cos(d),_=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(u-o);return Jm(Math.atan2(m,_))}function CT(r,e){var t=f2(e,r);return t=(t+180)%360,t}function df(r,e,t){t===void 0&&(t={});var n=$f(r),i=$f(e),o=cs(i[1]-n[1]),u=cs(i[0]-n[0]),a=cs(n[1]),d=cs(i[1]),m=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(a)*Math.cos(d);return kT(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),t.units)}function Zy(r,e,t,n){n===void 0&&(n={});var i=$f(r),o=cs(i[0]),u=cs(i[1]),a=cs(t),d=ST(e,n.units),m=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(a)),_=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(m)),v=Jm(_),S=Jm(m);return Ed([v,S],n.properties)}function Km(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties={},n.geometry=r,n}function MT(r,e,t){if(t===void 0&&(t={}),!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Wy(r[0])||!Wy(r[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:r};return Km(n,e,t)}function Hy(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Wy(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}function Ym(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ET(r,e,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function IT(r,e,t){if(t===void 0&&(t={}),r.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:r};return ET(n,e,t)}function LT(r,e){e===void 0&&(e={});var t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function Xy(r){if(Array.isArray(r))return r;if(r.type==="Feature"){if(r.geometry!==null)return r.geometry.coordinates}else if(r.coordinates)return r.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Jy(r){if(!r)throw new Error("geojson is required");var e=[];return Yu(r,function(t){PT(t,e)}),LT(e)}function PT(r,e){var t=[],n=r.geometry;if(n!==null){switch(n.type){case"Polygon":t=Xy(n);break;case"LineString":t=[Xy(n)]}t.forEach(function(i){var o=zT(i,r.properties);o.forEach(function(u){u.id=e.length,e.push(u)})})}}function zT(r,e){var t=[];return r.reduce(function(n,i){var o=IT([n,i],e);return o.bbox=DT(n,i),t.push(o),i}),t}function DT(r,e){var t=r[0],n=r[1],i=e[0],o=e[1],u=t<i?t:i,a=n<o?n:o,d=t>i?t:i,m=n>o?n:o;return[u,a,d,m]}var Jg={exports:{}},h2={exports:{}};(function(r,e){(function(t,n){r.exports=n()})(pw,function(){function t(I,U,O,ee,X){(function ue($,Q,ne,F,Z){for(;F>ne;){if(F-ne>600){var J=F-ne+1,be=Q-ne+1,ke=Math.log(J),ge=.5*Math.exp(2*ke/3),ve=.5*Math.sqrt(ke*ge*(J-ge)/J)*(be-J/2<0?-1:1),fe=Math.max(ne,Math.floor(Q-be*ge/J+ve)),Pe=Math.min(F,Math.floor(Q+(J-be)*ge/J+ve));ue($,Q,fe,Pe,Z)}var Ee=$[Q],Fe=ne,ot=F;for(n($,ne,Q),Z($[F],Ee)>0&&n($,ne,F);Fe<ot;){for(n($,Fe,ot),Fe++,ot--;Z($[Fe],Ee)<0;)Fe++;for(;Z($[ot],Ee)>0;)ot--}Z($[ne],Ee)===0?n($,ne,ot):n($,++ot,F),ot<=Q&&(ne=ot+1),Q<=ot&&(F=ot-1)}})(I,U,O||0,ee||I.length-1,X||i)}function n(I,U,O){var ee=I[U];I[U]=I[O],I[O]=ee}function i(I,U){return I<U?-1:I>U?1:0}var o=function(I){I===void 0&&(I=9),this._maxEntries=Math.max(4,I),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function u(I,U,O){if(!O)return U.indexOf(I);for(var ee=0;ee<U.length;ee++)if(O(I,U[ee]))return ee;return-1}function a(I,U){d(I,0,I.children.length,U,I)}function d(I,U,O,ee,X){X||(X=P(null)),X.minX=1/0,X.minY=1/0,X.maxX=-1/0,X.maxY=-1/0;for(var ue=U;ue<O;ue++){var $=I.children[ue];m(X,I.leaf?ee($):$)}return X}function m(I,U){return I.minX=Math.min(I.minX,U.minX),I.minY=Math.min(I.minY,U.minY),I.maxX=Math.max(I.maxX,U.maxX),I.maxY=Math.max(I.maxY,U.maxY),I}function _(I,U){return I.minX-U.minX}function v(I,U){return I.minY-U.minY}function S(I){return(I.maxX-I.minX)*(I.maxY-I.minY)}function T(I){return I.maxX-I.minX+(I.maxY-I.minY)}function C(I,U){return I.minX<=U.minX&&I.minY<=U.minY&&U.maxX<=I.maxX&&U.maxY<=I.maxY}function L(I,U){return U.minX<=I.maxX&&U.minY<=I.maxY&&U.maxX>=I.minX&&U.maxY>=I.minY}function P(I){return{children:I,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function D(I,U,O,ee,X){for(var ue=[U,O];ue.length;)if(!((O=ue.pop())-(U=ue.pop())<=ee)){var $=U+Math.ceil((O-U)/ee/2)*ee;t(I,$,U,O,X),ue.push(U,$,$,O)}}return o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(I){var U=this.data,O=[];if(!L(I,U))return O;for(var ee=this.toBBox,X=[];U;){for(var ue=0;ue<U.children.length;ue++){var $=U.children[ue],Q=U.leaf?ee($):$;L(I,Q)&&(U.leaf?O.push($):C(I,Q)?this._all($,O):X.push($))}U=X.pop()}return O},o.prototype.collides=function(I){var U=this.data;if(!L(I,U))return!1;for(var O=[];U;){for(var ee=0;ee<U.children.length;ee++){var X=U.children[ee],ue=U.leaf?this.toBBox(X):X;if(L(I,ue)){if(U.leaf||C(I,ue))return!0;O.push(X)}}U=O.pop()}return!1},o.prototype.load=function(I){if(!I||!I.length)return this;if(I.length<this._minEntries){for(var U=0;U<I.length;U++)this.insert(I[U]);return this}var O=this._build(I.slice(),0,I.length-1,0);if(this.data.children.length)if(this.data.height===O.height)this._splitRoot(this.data,O);else{if(this.data.height<O.height){var ee=this.data;this.data=O,O=ee}this._insert(O,this.data.height-O.height-1,!0)}else this.data=O;return this},o.prototype.insert=function(I){return I&&this._insert(I,this.data.height-1),this},o.prototype.clear=function(){return this.data=P([]),this},o.prototype.remove=function(I,U){if(!I)return this;for(var O,ee,X,ue=this.data,$=this.toBBox(I),Q=[],ne=[];ue||Q.length;){if(ue||(ue=Q.pop(),ee=Q[Q.length-1],O=ne.pop(),X=!0),ue.leaf){var F=u(I,ue.children,U);if(F!==-1)return ue.children.splice(F,1),Q.push(ue),this._condense(Q),this}X||ue.leaf||!C(ue,$)?ee?(O++,ue=ee.children[O],X=!1):ue=null:(Q.push(ue),ne.push(O),O=0,ee=ue,ue=ue.children[0])}return this},o.prototype.toBBox=function(I){return I},o.prototype.compareMinX=function(I,U){return I.minX-U.minX},o.prototype.compareMinY=function(I,U){return I.minY-U.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(I){return this.data=I,this},o.prototype._all=function(I,U){for(var O=[];I;)I.leaf?U.push.apply(U,I.children):O.push.apply(O,I.children),I=O.pop();return U},o.prototype._build=function(I,U,O,ee){var X,ue=O-U+1,$=this._maxEntries;if(ue<=$)return a(X=P(I.slice(U,O+1)),this.toBBox),X;ee||(ee=Math.ceil(Math.log(ue)/Math.log($)),$=Math.ceil(ue/Math.pow($,ee-1))),(X=P([])).leaf=!1,X.height=ee;var Q=Math.ceil(ue/$),ne=Q*Math.ceil(Math.sqrt($));D(I,U,O,ne,this.compareMinX);for(var F=U;F<=O;F+=ne){var Z=Math.min(F+ne-1,O);D(I,F,Z,Q,this.compareMinY);for(var J=F;J<=Z;J+=Q){var be=Math.min(J+Q-1,Z);X.children.push(this._build(I,J,be,ee-1))}}return a(X,this.toBBox),X},o.prototype._chooseSubtree=function(I,U,O,ee){for(;ee.push(U),!U.leaf&&ee.length-1!==O;){for(var X=1/0,ue=1/0,$=void 0,Q=0;Q<U.children.length;Q++){var ne=U.children[Q],F=S(ne),Z=(J=I,be=ne,(Math.max(be.maxX,J.maxX)-Math.min(be.minX,J.minX))*(Math.max(be.maxY,J.maxY)-Math.min(be.minY,J.minY))-F);Z<ue?(ue=Z,X=F<X?F:X,$=ne):Z===ue&&F<X&&(X=F,$=ne)}U=$||U.children[0]}var J,be;return U},o.prototype._insert=function(I,U,O){var ee=O?I:this.toBBox(I),X=[],ue=this._chooseSubtree(ee,this.data,U,X);for(ue.children.push(I),m(ue,ee);U>=0&&X[U].children.length>this._maxEntries;)this._split(X,U),U--;this._adjustParentBBoxes(ee,X,U)},o.prototype._split=function(I,U){var O=I[U],ee=O.children.length,X=this._minEntries;this._chooseSplitAxis(O,X,ee);var ue=this._chooseSplitIndex(O,X,ee),$=P(O.children.splice(ue,O.children.length-ue));$.height=O.height,$.leaf=O.leaf,a(O,this.toBBox),a($,this.toBBox),U?I[U-1].children.push($):this._splitRoot(O,$)},o.prototype._splitRoot=function(I,U){this.data=P([I,U]),this.data.height=I.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(I,U,O){for(var ee,X,ue,$,Q,ne,F,Z=1/0,J=1/0,be=U;be<=O-U;be++){var ke=d(I,0,be,this.toBBox),ge=d(I,be,O,this.toBBox),ve=(X=ke,ue=ge,$=void 0,Q=void 0,ne=void 0,F=void 0,$=Math.max(X.minX,ue.minX),Q=Math.max(X.minY,ue.minY),ne=Math.min(X.maxX,ue.maxX),F=Math.min(X.maxY,ue.maxY),Math.max(0,ne-$)*Math.max(0,F-Q)),fe=S(ke)+S(ge);ve<Z?(Z=ve,ee=be,J=fe<J?fe:J):ve===Z&&fe<J&&(J=fe,ee=be)}return ee||O-U},o.prototype._chooseSplitAxis=function(I,U,O){var ee=I.leaf?this.compareMinX:_,X=I.leaf?this.compareMinY:v;this._allDistMargin(I,U,O,ee)<this._allDistMargin(I,U,O,X)&&I.children.sort(ee)},o.prototype._allDistMargin=function(I,U,O,ee){I.children.sort(ee);for(var X=this.toBBox,ue=d(I,0,U,X),$=d(I,O-U,O,X),Q=T(ue)+T($),ne=U;ne<O-U;ne++){var F=I.children[ne];m(ue,I.leaf?X(F):F),Q+=T(ue)}for(var Z=O-U-1;Z>=U;Z--){var J=I.children[Z];m($,I.leaf?X(J):J),Q+=T($)}return Q},o.prototype._adjustParentBBoxes=function(I,U,O){for(var ee=O;ee>=0;ee--)m(U[ee],I)},o.prototype._condense=function(I){for(var U=I.length-1,O=void 0;U>=0;U--)I[U].children.length===0?U>0?(O=I[U-1].children).splice(O.indexOf(I[U]),1):this.clear():a(I[U],this.toBBox)},o})})(h2);var RT=h2.exports,d2={};(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.earthRadius=63710088e-1,r.factors={centimeters:r.earthRadius*100,centimetres:r.earthRadius*100,degrees:r.earthRadius/111325,feet:r.earthRadius*3.28084,inches:r.earthRadius*39.37,kilometers:r.earthRadius/1e3,kilometres:r.earthRadius/1e3,meters:r.earthRadius,metres:r.earthRadius,miles:r.earthRadius/1609.344,millimeters:r.earthRadius*1e3,millimetres:r.earthRadius*1e3,nauticalmiles:r.earthRadius/1852,radians:1,yards:r.earthRadius*1.0936},r.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/r.earthRadius,yards:1.0936133},r.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function e(F,Z,J){J===void 0&&(J={});var be={type:"Feature"};return(J.id===0||J.id)&&(be.id=J.id),J.bbox&&(be.bbox=J.bbox),be.properties=Z||{},be.geometry=F,be}r.feature=e;function t(F,Z,J){switch(F){case"Point":return n(Z).geometry;case"LineString":return a(Z).geometry;case"Polygon":return o(Z).geometry;case"MultiPoint":return v(Z).geometry;case"MultiLineString":return _(Z).geometry;case"MultiPolygon":return S(Z).geometry;default:throw new Error(F+" is invalid")}}r.geometry=t;function n(F,Z,J){if(J===void 0&&(J={}),!F)throw new Error("coordinates is required");if(!Array.isArray(F))throw new Error("coordinates must be an Array");if(F.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ue(F[0])||!ue(F[1]))throw new Error("coordinates must contain numbers");var be={type:"Point",coordinates:F};return e(be,Z,J)}r.point=n;function i(F,Z,J){return J===void 0&&(J={}),m(F.map(function(be){return n(be,Z)}),J)}r.points=i;function o(F,Z,J){J===void 0&&(J={});for(var be=0,ke=F;be<ke.length;be++){var ge=ke[be];if(ge.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var ve=0;ve<ge[ge.length-1].length;ve++)if(ge[ge.length-1][ve]!==ge[0][ve])throw new Error("First and last Position are not equivalent.")}var fe={type:"Polygon",coordinates:F};return e(fe,Z,J)}r.polygon=o;function u(F,Z,J){return J===void 0&&(J={}),m(F.map(function(be){return o(be,Z)}),J)}r.polygons=u;function a(F,Z,J){if(J===void 0&&(J={}),F.length<2)throw new Error("coordinates must be an array of two or more positions");var be={type:"LineString",coordinates:F};return e(be,Z,J)}r.lineString=a;function d(F,Z,J){return J===void 0&&(J={}),m(F.map(function(be){return a(be,Z)}),J)}r.lineStrings=d;function m(F,Z){Z===void 0&&(Z={});var J={type:"FeatureCollection"};return Z.id&&(J.id=Z.id),Z.bbox&&(J.bbox=Z.bbox),J.features=F,J}r.featureCollection=m;function _(F,Z,J){J===void 0&&(J={});var be={type:"MultiLineString",coordinates:F};return e(be,Z,J)}r.multiLineString=_;function v(F,Z,J){J===void 0&&(J={});var be={type:"MultiPoint",coordinates:F};return e(be,Z,J)}r.multiPoint=v;function S(F,Z,J){J===void 0&&(J={});var be={type:"MultiPolygon",coordinates:F};return e(be,Z,J)}r.multiPolygon=S;function T(F,Z,J){J===void 0&&(J={});var be={type:"GeometryCollection",geometries:F};return e(be,Z,J)}r.geometryCollection=T;function C(F,Z){if(Z===void 0&&(Z=0),Z&&!(Z>=0))throw new Error("precision must be a positive number");var J=Math.pow(10,Z||0);return Math.round(F*J)/J}r.round=C;function L(F,Z){Z===void 0&&(Z="kilometers");var J=r.factors[Z];if(!J)throw new Error(Z+" units is invalid");return F*J}r.radiansToLength=L;function P(F,Z){Z===void 0&&(Z="kilometers");var J=r.factors[Z];if(!J)throw new Error(Z+" units is invalid");return F/J}r.lengthToRadians=P;function D(F,Z){return U(P(F,Z))}r.lengthToDegrees=D;function I(F){var Z=F%360;return Z<0&&(Z+=360),Z}r.bearingToAzimuth=I;function U(F){var Z=F%(2*Math.PI);return Z*180/Math.PI}r.radiansToDegrees=U;function O(F){var Z=F%360;return Z*Math.PI/180}r.degreesToRadians=O;function ee(F,Z,J){if(Z===void 0&&(Z="kilometers"),J===void 0&&(J="kilometers"),!(F>=0))throw new Error("length must be a positive number");return L(P(F,Z),J)}r.convertLength=ee;function X(F,Z,J){if(Z===void 0&&(Z="meters"),J===void 0&&(J="kilometers"),!(F>=0))throw new Error("area must be a positive number");var be=r.areaFactors[Z];if(!be)throw new Error("invalid original units");var ke=r.areaFactors[J];if(!ke)throw new Error("invalid final units");return F/be*ke}r.convertArea=X;function ue(F){return!isNaN(F)&&F!==null&&!Array.isArray(F)}r.isNumber=ue;function $(F){return!!F&&F.constructor===Object}r.isObject=$;function Q(F){if(!F)throw new Error("bbox is required");if(!Array.isArray(F))throw new Error("bbox must be an Array");if(F.length!==4&&F.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");F.forEach(function(Z){if(!ue(Z))throw new Error("bbox must only contain numbers")})}r.validateBBox=Q;function ne(F){if(!F)throw new Error("id is required");if(["string","number"].indexOf(typeof F)===-1)throw new Error("id must be a number or a string")}r.validateId=ne})(d2);const BT=gw(AT);function Qm(r){var e=[1/0,1/0,-1/0,-1/0];return Ku(r,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}Qm.default=Qm;const FT=Object.freeze(Object.defineProperty({__proto__:null,default:Qm},Symbol.toStringTag,{value:"Module"})),OT=gw(FT);var As=RT,p2=d2,m2=BT,Eu=OT.default,NT=m2.featureEach;m2.coordEach;p2.polygon;var Ky=p2.featureCollection;function g2(r){var e=new As(r);return e.insert=function(t){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Eu(t),As.prototype.insert.call(this,t)},e.load=function(t){var n=[];return Array.isArray(t)?t.forEach(function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Eu(i),n.push(i)}):NT(t,function(i){if(i.type!=="Feature")throw new Error("invalid features");i.bbox=i.bbox?i.bbox:Eu(i),n.push(i)}),As.prototype.load.call(this,n)},e.remove=function(t,n){if(t.type!=="Feature")throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:Eu(t),As.prototype.remove.call(this,t,n)},e.clear=function(){return As.prototype.clear.call(this)},e.search=function(t){var n=As.prototype.search.call(this,this.toBBox(t));return Ky(n)},e.collides=function(t){return As.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=As.prototype.all.call(this);return Ky(t)},e.toJSON=function(){return As.prototype.toJSON.call(this)},e.fromJSON=function(t){return As.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var n;if(t.bbox)n=t.bbox;else if(Array.isArray(t)&&t.length===4)n=t;else if(Array.isArray(t)&&t.length===6)n=[t[0],t[1],t[3],t[4]];else if(t.type==="Feature")n=Eu(t);else if(t.type==="FeatureCollection")n=Eu(t);else throw new Error("invalid geojson");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}},e}Jg.exports=g2;Jg.exports.default=g2;var $T=Jg.exports;const jT=mw($T);function UT(r,e){var t={},n=[];if(r.type==="LineString"&&(r=Km(r)),e.type==="LineString"&&(e=Km(e)),r.type==="Feature"&&e.type==="Feature"&&r.geometry!==null&&e.geometry!==null&&r.geometry.type==="LineString"&&e.geometry.type==="LineString"&&r.geometry.coordinates.length===2&&e.geometry.coordinates.length===2){var i=Yy(r,e);return i&&n.push(i),Hy(n)}var o=jT();return o.load(Jy(e)),qd(Jy(r),function(u){qd(o.search(u),function(a){var d=Yy(u,a);if(d){var m=Ym(d).join(",");t[m]||(t[m]=!0,n.push(d))}})}),Hy(n)}function Yy(r,e){var t=Ym(r),n=Ym(e);if(t.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(n.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=t[0][0],o=t[0][1],u=t[1][0],a=t[1][1],d=n[0][0],m=n[0][1],_=n[1][0],v=n[1][1],S=(v-m)*(u-i)-(_-d)*(a-o),T=(_-d)*(o-m)-(v-m)*(i-d),C=(u-i)*(o-m)-(a-o)*(i-d);if(S===0)return null;var L=T/S,P=C/S;if(L>=0&&L<=1&&P>=0&&P<=1){var D=i+L*(u-i),I=o+L*(a-o);return MT([D,I])}return null}function VT(r,e,t){t===void 0&&(t={});var n=Ed([1/0,1/0],{dist:1/0}),i=0;return Yu(r,function(o){for(var u=TT(o),a=0;a<u.length-1;a++){var d=Ed(u[a]);d.properties.dist=df(e,d,t);var m=Ed(u[a+1]);m.properties.dist=df(e,m,t);var _=df(d,m,t),v=Math.max(d.properties.dist,m.properties.dist),S=f2(d,m),T=Zy(e,v,S+90,t),C=Zy(e,v,S-90,t),L=UT(qy([T.geometry.coordinates,C.geometry.coordinates]),qy([d.geometry.coordinates,m.geometry.coordinates])),P=null;L.features.length>0&&(P=L.features[0],P.properties.dist=df(e,P,t),P.properties.location=i+df(d,P,t)),d.properties.dist<n.properties.dist&&(n=d,n.properties.index=a,n.properties.location=i),m.properties.dist<n.properties.dist&&(n=m,n.properties.index=a+1,n.properties.location=i+_),P&&P.properties.dist<n.properties.dist&&(n=P,n.properties.index=a),i+=_}}),n}const qT=30;class GT{constructor(e,t,n,i,o){this.onMouseMove=u=>{if(!this.active)return;const a=[u.point.x-qT,u.point.y],d=this.map.unproject(u.point).distanceTo(this.map.unproject(a));this.inner.onMouseMove(u.lngLat.lng,u.lngLat.lat,d)&&(this.redraw(),this.dataUpdated())},this.onClick=()=>{this.active&&(this.inner.onClick(),this.redraw(),this.dataUpdated())},this.onDoubleClick=u=>{this.active&&(u.preventDefault(),this.inner.onClick(),this.finish())},this.onDragStart=()=>{this.active&&this.inner.onDragStart()&&this.map.dragPan.disable()},this.onMouseUp=()=>{this.active&&this.inner.onMouseUp()&&this.map.dragPan.enable()},this.onKeyDown=u=>{if(!this.active)return;let a=u.target.tagName;a=="INPUT"||a=="TEXTAREA"||u.key=="Escape"&&(u.stopPropagation(),this.cancel())},this.onKeyPress=u=>{if(!this.active)return;let a=u.target.tagName;a=="INPUT"||a=="TEXTAREA"||(u.key=="Enter"?(u.stopPropagation(),this.finish()):u.key=="s"||u.key=="S"?(u.stopPropagation(),this.inner.toggleSnapMode(),this.redraw()):u.key=="z"&&u.ctrlKey&&this.undo())},this.map=e,console.time("Deserialize and setup JsRouteSnapper"),this.inner=new Ud(t),console.timeEnd("Deserialize and setup JsRouteSnapper"),this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.routeToolGj=n,this.snapMode=i,this.undoLength=o,this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("dragstart",this.onDragStart),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown),document.addEventListener("keypress",this.onKeyPress)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("dragstart",this.onDragStart),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keydown",this.onKeyDown),document.removeEventListener("keypress",this.onKeyPress)}startRoute(){this.active||(this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}startArea(){this.active||(this.inner.setAreaMode(),this.active=!0,this.map.boxZoom.disable(),this.map.doubleClickZoom.disable())}stop(){this.active=!1,this.inner.clearState(),this.redraw(),this.map.boxZoom.enable(),this.map.doubleClickZoom.enable()}editExistingRoute(e){this.active&&window.alert("Bug: editExistingRoute called when tool is already active"),e.properties.waypoints||(e.properties.waypoints=[{lon:e.geometry.coordinates[0][0],lat:e.geometry.coordinates[0][1],snapped:!0},{lon:e.geometry.coordinates[e.geometry.coordinates.length-1][0],lat:e.geometry.coordinates[e.geometry.coordinates.length-1][1],snapped:!0}]),this.startRoute(),this.inner.editExisting(e.properties.waypoints),this.redraw()}editExistingArea(e){this.active&&window.alert("Bug: editExistingArea called when tool is already active"),e.properties.waypoints||window.alert("Bug: editExistingArea called for a polygon not produced by the route-snapper"),this.startArea(),this.inner.editExisting(e.properties.waypoints),this.redraw()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}isActive(){return this.active}finish(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersSuccess)t(JSON.parse(e));else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){this.inner.clearState(),this.finish()}setRouteConfig(e){this.inner.setRouteConfig(e),this.redraw()}addSnappedWaypoint(e){this.inner.addSnappedWaypoint(e[0],e[1]),this.redraw()}undo(){this.inner.undo(),this.redraw()}toggleSnapMode(){this.inner.toggleSnapMode(),this.redraw()}redraw(){let e=JSON.parse(this.inner.renderGeojson());this.routeToolGj.set(e),this.map.getCanvas().style.cursor=e.cursor,this.snapMode.set(e.snap_mode),this.undoLength.set(e.undo_length)}dataUpdated(){let e=this.inner.toFinalFeature();if(e)for(let t of this.eventListenersUpdated)t(JSON.parse(e))}}class ZT{constructor(){mr(this,"rootKey","ltn")}get schemaVersionKey(){return`${this.rootKey}/_meta/schema-version`}get storedSchemaVersion(){let e,t=window.localStorage.getItem(this.schemaVersionKey);return t?(e=parseInt(t),Number.isNaN(e)&&(e=0)):e=0,e}ensureMigrated(){if(localStorage.length==0){console.log("localStorage is empty  nothing to migrate."),window.localStorage.setItem(this.schemaVersionKey,"2");return}if(this.storedSchemaVersion==2){console.debug("Schema is already up to date.");return}if(this.storedSchemaVersion<1){console.log(`Migrating storage from version ${this.storedSchemaVersion} to 2`);for(const t of["cnt","global"]){const n=t,i=new zm(n,1,Id);for(const[o,u]of HT(n))for(const{projectKey:a,projectName:d}of u){let m=window.localStorage.getItem(a);if(!m){console.warn(`Project features not found for ${a}, skipping migration`);continue}let _=JSON.parse(m);_.app_focus=n,_.study_area_name=o,_.project_name=d,console.log(`migrating project ${a}`);let v=i.createProject(_);console.log(`Successfully migrated v0->v1 project ${a} -> ${i.projectKey(v)}`),window.localStorage.removeItem(a)}}}if(this.storedSchemaVersion<2)for(const t of["cnt","global"]){const n=t,i=new zm(n,2,Id);for(const[o,u]of i.projects()){if(u.db_schema_version>=2){console.log(`skipping previously migrated project: ${o}`);continue}u.db_schema_version=2,i.saveProject(o,u),console.log(`Successfully migrated v1->v2 project: ${i.projectKey(o)}`)}}window.localStorage.setItem(this.schemaVersionKey,"2"),console.debug("Completed migrating database to v2")}projectStorage(e){return this.ensureMigrated(),new zm(e,this.storedSchemaVersion,Id)}}const Id=Symbol("internal_method_token");class zm{constructor(e,t,n){mr(this,"appFocus");mr(this,"dbSchemaVersion");if(n!==Id)throw new Error("ProjectStorage must be created via Database.projectStorage()");this.appFocus=e,this.dbSchemaVersion=t}get collectionKey(){return"ltn/projects"}projectKey(e){if(!e)throw new Error("Cannot get project. ProjectID was blank/missing.");return`${this.collectionKey}/${e}`}projectName(e){return this.project(e).project_name}projectNameAlreadyExists(e){for(const[t,n]of this.projects())if(n.project_name==e)return!0;return!1}nextAvailableProjectName(e){if(this.projectNameAlreadyExists(e)){let t=e,n=2;do e=`${t} (${n})`,n++;while(this.projectNameAlreadyExists(e))}return e}nextAvailableNeighbourhoodName(e){let t="My neighbourhood",i=this.project(e).features.filter(a=>{var d;return((d=a.properties)==null?void 0:d.kind)=="boundary"}),o=t,u=1;for(;i.some(a=>{var d;return((d=a.properties)==null?void 0:d.name)==o});)u++,o=`${t} #${u}`;return o}createEmptyProject(e,t){const n={type:"FeatureCollection",features:[],study_area_name:t,project_name:e,app_focus:this.appFocus};return this.createProject(n)}createProject(e){if(this.projectNameAlreadyExists(e.project_name))throw new Error(`Project name already taken: ${e.project_name}`);e.db_schema_version||(e.db_schema_version=this.dbSchemaVersion);let t=crypto.randomUUID();return this.saveProject(t,e),t}studyAreaProjects(){let e=new Map;for(const[t,n]of this.projects()){const i=n.study_area_name;e.has(i)||e.set(i,[]),e.get(i).push({projectID:t,projectName:n.project_name})}for(const[t,n]of e.entries())n.sort((i,o)=>i.projectName.localeCompare(o.projectName));return Array.from(e.entries()).sort((t,n)=>t[0]==null?1:n[0]==null?-1:t[0].localeCompare(n[0]))}projectIDFromKey(e){let t=e.match(/ltn\/projects\/([a-z0-9-]+)/);if(!t)return;let n=t[1];if(n)return n}projects(){return this.allProjectKeys().map(e=>{let t=this.projectIDFromKey(e);if(!t)throw new Error(`Cannot get project: no projectID parsed from ${e}`);let n=window.localStorage.getItem(e);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return i.app_focus!=this.appFocus?null:[t,i]}).filter(e=>e!==null)}allProjectKeys(){const e=this.collectionKey;let t=[];for(let n=0;n<localStorage.length;n++){const i=localStorage.key(n);i&&i.startsWith(e)&&t.push(i)}return t}saveProject(e,t){let n=this.projectKey(e);t.study_area_name||delete t.study_area_name,window.localStorage.setItem(n,JSON.stringify(t))}removeProject(e){let t=this.projectKey(e);window.localStorage.removeItem(t)}renameProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot rename project: no existing project found for ${e}`);if(n.project_name==t){console.debug("Ignoring rename, since it's the same name.");return}if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);n.project_name=t,this.saveProject(e,n)}copyProject(e,t){let n=this.project(e);if(!n)throw new Error(`Cannot copy project: no existing project found for ${e}`);if(this.projectNameAlreadyExists(t))throw new Error(`Project name ${t} already taken. Choose a different name.`);let i=crypto.randomUUID();return n.project_name=t,this.saveProject(i,n),i}project(e){let t=this.projectKey(e),n=window.localStorage.getItem(t);if(!n)throw new Error(`Cannot get project: no project found for ${e}`);let i=JSON.parse(n);return console.assert(i.study_area_name||i.app_focus!="cnt","missing study area name for cnt project"),console.assert(i.project_name,"missing project name"),i}}function HT(r){let e=new Map,t=[];for(let i=0;i<window.localStorage.length;i++){let o=window.localStorage.key(i);if(o.startsWith("ltn_cnt/")){if(r!="cnt")continue;try{let[u,a,d]=o.split("/");e.has(a)||e.set(a,[]),e.get(a).push({projectKey:o,projectName:d})}catch(u){console.log(`error loading cnt project: ${o}`,u)}}else if(o.startsWith("ltn_")){if(r!="global")continue;let u=o.split("ltn_"),a=u[u.length-1],d="";try{d=JSON.parse(window.localStorage.getItem(o)).study_area_name}catch(m){console.log(`error loading global project: ${o}`,m)}d&&d.length>0?(e.has(d)||e.set(d,[]),e.get(d).push({projectKey:o,projectName:a})):t.push({projectKey:o,projectName:a})}}let n=[...e.entries()];return n.sort((i,o)=>i[0].localeCompare(o[0])),t.length>0&&n.push([void 0,t]),n}const _2="MZEJTanw3WpxRvt7qDfo";let Ko=Dn(null),Bo=Dn("global"),zo=Dn(void 0),y2=fw(zo,r=>{if(r)return li(ta).project(r)}),Ba=Dn(void 0),b2=new ZT,ta=fw(Bo,r=>b2.projectStorage(r)),Qy=Dn(!0),Cr=Dn(null),Qu=Dn({population_density:[0,1,2,3,4,5],collision_density:[0,1,2,3,4,5],poi_density:[0,1,2,3,4,5]}),Rf=Dn(new Sl.LngLat(0,0)),Bf=Dn(new Sl.LngLat(0,0)),md=Dn(new Sl.LngLat(0,0)),e1=Dn(1),ri=Dn(1),or=Dn({mode:"title",firstLoad:!0}),eg=Dn(!1),jf=Dn(!1),tg=Dn("streets-v2"),ng=Dn("walk_cycle_only"),t1=Dn(!1),rg=Dn(!0),Gd=Dn(!0),Zd=Dn("shortcuts"),ig=Dn(!1),og=Dn(!0),n1=Dn(500);function Uf(){const r=li(zo);try{li(ta).saveProject(r,li(Cr).toSavefile())}catch(e){window.alert(`Autosave failed: ${e}`)}}let sg=Dn(!1);function fs(r){return li(sg)?`/${r}`:r.startsWith("cnt/")?`https://assets.cnt.scot/${Wd(r,"cnt/")}`:r.startsWith("england/")?`https://assets.od2net.org/ltn/${r}`:`https://assets.od2net.org/${r}`}function ag(r){var n;function e(i){const o=i.getEast()-i.getWest();let u=i.getWest()+Math.random()*o;const a=i.getNorth()-i.getSouth();let d=i.getSouth()+Math.random()*a;return new Sl.LngLat(u,d)}const t=(n=li(Ko))==null?void 0:n.getBounds();if(!t){console.assert(!1,"missing map bounds");return}t.contains(li(r))||r.set(e(t))}const WT=r=>({}),r1=r=>({}),XT=r=>({}),i1=r=>({});function o1(r){let e,t,n;return t=new ec({props:{$$slots:{default:[JT]},$$scope:{ctx:r}}}),{c(){e=q("span"),pe(t.$$.fragment),Ze(e,"margin-left","auto")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p(i,o){const u={};o&128&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function JT(r){let e,t;const n=r[4].help,i=_n(n,r,r[7],i1);return{c(){e=q("div"),i&&i.c(),ce(e,"class","context-layer-help-content")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&128)&&yn(i,n,o,o[7],t?vn(n,o[7],u,XT):bn(o[7]),i1)},i(o){t||(N(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function s1(r){let e,t;const n=r[4].legend,i=_n(n,r,r[7],r1);return{c(){e=q("div"),i&&i.c(),ce(e,"class","legend svelte-14vnnlu")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&128)&&yn(i,n,o,o[7],t?vn(n,o[7],u,WT):bn(o[7]),r1)},i(o){t||(N(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function KT(r){let e,t,n,i,o,u,a,d,m,_,v=r[3].help&&o1(r),S=r[0]&&r[3].legend&&s1(r);return{c(){e=q("button"),t=q("input"),n=ae(),i=Te(r[1]),o=ae(),v&&v.c(),u=ae(),S&&S.c(),a=rr(),Ze(t,"aspect-ratio","1.0"),ce(t,"type","checkbox"),ce(e,"class","context-control svelte-14vnnlu")},m(T,C){W(T,e,C),z(e,t),t.checked=r[0],z(e,n),z(e,i),z(e,o),v&&v.m(e,null),W(T,u,C),S&&S.m(T,C),W(T,a,C),d=!0,m||(_=[_t(t,"change",r[5]),_t(t,"change",function(){Xu(r[2])&&r[2].apply(this,arguments)}),_t(e,"click",r[6])],m=!0)},p(T,[C]){r=T,C&1&&(t.checked=r[0]),(!d||C&2)&&yt(i,r[1]),r[3].help?v?(v.p(r,C),C&8&&N(v,1)):(v=o1(r),v.c(),N(v,1),v.m(e,null)):v&&(Zt(),G(v,1,1,()=>{v=null}),Ht()),r[0]&&r[3].legend?S?(S.p(r,C),C&9&&N(S,1)):(S=s1(r),S.c(),N(S,1),S.m(a.parentNode,a)):S&&(Zt(),G(S,1,1,()=>{S=null}),Ht())},i(T){d||(N(v),N(S),d=!0)},o(T){G(v),G(S),d=!1},d(T){T&&(H(e),H(u),H(a)),v&&v.d(),S&&S.d(T),m=!1,Er(_)}}}function YT(r,e,t){let{$$slots:n={},$$scope:i}=e;const o=Eg(n);let{label:u}=e,{show:a=!1}=e,{onChange:d=()=>{}}=e;function m(){a=this.checked,t(0,a)}const _=()=>{t(0,a=!a),d()};return r.$$set=v=>{"label"in v&&t(1,u=v.label),"show"in v&&t(0,a=v.show),"onChange"in v&&t(2,d=v.onChange),"$$scope"in v&&t(7,i=v.$$scope)},[a,u,d,o,n,m,_,i]}class Do extends kt{constructor(e){super(),St(this,e,YT,KT,gt,{label:1,show:0,onChange:2})}}let Ld=Dn(!0);function QT(r){let e,t;return e=new Zi({props:{paint:{"fill-color":"black","fill-opacity":0},layout:{visibility:r[0]?"none":"visible"}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.layout={visibility:n[0]?"none":"visible"}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function eC(r){let e,t;return e=new yr({props:{data:r[1],$$slots:{default:[QT]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&5&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function tC(r,e,t){let n;return rt(r,Ld,o=>t(0,n=o)),[n,{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]}}]}class nC extends kt{constructor(e){super(),St(this,e,tC,eC,gt,{})}}function rC(r){let e,t;return e=new Ju({props:{lngLat:r[0],$$slots:{default:[oC]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.lngLat=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function iC(r){let e,t,n;function i(u){r[3](u)}let o={draggable:!0,$$slots:{default:[sC]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.lngLat=r[0]),e=new Ju({props:o}),wn.push(()=>On(e,"lngLat",i)),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,a){const d={};a&16&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.lngLat=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function oC(r){let e,t;const n=r[2].default,i=_n(n,r,r[4],null);return{c(){e=q("span"),i&&i.c(),ce(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&yn(i,n,o,o[4],t?vn(n,o[4],u,null):bn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function sC(r){let e,t;const n=r[2].default,i=_n(n,r,r[4],null);return{c(){e=q("span"),i&&i.c(),ce(e,"class","dot svelte-nb4dgc")},m(o,u){W(o,e,u),i&&i.m(e,null),t=!0},p(o,u){i&&i.p&&(!t||u&16)&&yn(i,n,o,o[4],t?vn(n,o[4],u,null):bn(o[4]),null)},i(o){t||(N(i,o),t=!0)},o(o){G(i,o),t=!1},d(o){o&&H(e),i&&i.d(o)}}}function aC(r){let e,t,n,i;const o=[iC,rC],u=[];function a(d,m){return d[1]?0:1}return e=a(r),t=u[e]=o[e](r),{c(){t.c(),n=rr()},m(d,m){u[e].m(d,m),W(d,n,m),i=!0},p(d,[m]){let _=e;e=a(d),e===_?u[e].p(d,m):(Zt(),G(u[_],1,1,()=>{u[_]=null}),Ht(),t=u[e],t?t.p(d,m):(t=u[e]=o[e](d),t.c()),N(t,1),t.m(n.parentNode,n))},i(d){i||(N(t),i=!0)},o(d){G(t),i=!1},d(d){d&&H(n),u[e].d(d)}}}function lC(r,e,t){let{$$slots:n={},$$scope:i}=e,{lngLat:o}=e,{draggable:u=!1}=e;function a(d){o=d,t(0,o)}return r.$$set=d=>{"lngLat"in d&&t(0,o=d.lngLat),"draggable"in d&&t(1,u=d.draggable),"$$scope"in d&&t(4,i=d.$$scope)},[o,u,n,a,i]}class Cl extends kt{constructor(e){super(),St(this,e,lC,aC,gt,{lngLat:0,draggable:1})}}function uC(r){let e,t,n;const i=r[2].default,o=_n(i,r,r[5],null);return{c(){e=q("h2"),e.textContent="Help",t=ae(),o&&o.c()},m(u,a){W(u,e,a),W(u,t,a),o&&o.m(u,a),n=!0},p(u,a){o&&o.p&&(!n||a&32)&&yn(o,i,u,u[5],n?vn(i,u[5],a,null):bn(u[5]),null)},i(u){n||(N(o,u),n=!0)},o(u){G(o,u),n=!1},d(u){u&&(H(e),H(t)),o&&o.d(u)}}}function cC(r){let e,t,n,i,o,u,a,d;t=new aw({props:{color:r[0]}});function m(v){r[4](v)}let _={$$slots:{default:[uC]},$$scope:{ctx:r}};return r[1]!==void 0&&(_.show=r[1]),i=new Ng({props:_}),wn.push(()=>On(i,"show",m)),{c(){e=q("button"),pe(t.$$.fragment),n=ae(),pe(i.$$.fragment),ce(e,"class","icon-btn help svelte-14uxddv"),ce(e,"title","Help")},m(v,S){W(v,e,S),de(t,e,null),W(v,n,S),de(i,v,S),u=!0,a||(d=_t(e,"click",Cf(r[3])),a=!0)},p(v,[S]){const T={};S&1&&(T.color=v[0]),t.$set(T);const C={};S&32&&(C.$$scope={dirty:S,ctx:v}),!o&&S&2&&(o=!0,C.show=v[1],Nn(()=>o=!1)),i.$set(C)},i(v){u||(N(t.$$.fragment,v),N(i.$$.fragment,v),u=!0)},o(v){G(t.$$.fragment,v),G(i.$$.fragment,v),u=!1},d(v){v&&(H(e),H(n)),he(t),he(i,v),a=!1,d()}}}function fC(r,e,t){let{$$slots:n={},$$scope:i}=e,o=!1,{color:u="black"}=e;const a=()=>t(1,o=!0);function d(m){o=m,t(1,o)}return r.$$set=m=>{"color"in m&&t(0,u=m.color),"$$scope"in m&&t(5,i=m.$$scope)},[u,o,n,a,d,i]}class ec extends kt{constructor(e){super(),St(this,e,fC,cC,gt,{color:0})}}function hC(r){let e,t,n,i;const o=r[1].default,u=_n(o,r,r[0],null);return{c(){e=q("a"),u&&u.c(),ce(e,"href","#")},m(a,d){W(a,e,d),u&&u.m(e,null),t=!0,n||(i=_t(e,"click",Mg(r[2])),n=!0)},p(a,[d]){u&&u.p&&(!t||d&1)&&yn(u,o,a,a[0],t?vn(o,a[0],d,null):bn(a[0]),null)},i(a){t||(N(u,a),t=!0)},o(a){G(u,a),t=!1},d(a){a&&H(e),u&&u.d(a),n=!1,i()}}}function dC(r,e,t){let{$$slots:n={},$$scope:i}=e;function o(u){Pn.call(this,r,u)}return r.$$set=u=>{"$$scope"in u&&t(0,i=u.$$scope)},[i,n,o]}class nh extends kt{constructor(e){super(),St(this,e,dC,hC,gt,{})}}function a1(r){let e,t,n,i,o=r[1]!=null&&l1(r);return{c(){e=q("div"),t=q("div"),n=Te(r[0]),i=ae(),o&&o.c(),ce(t,"class","background svelte-s4mabc"),ce(e,"class","cover svelte-s4mabc")},m(u,a){W(u,e,a),z(e,t),z(t,n),z(t,i),o&&o.m(t,null)},p(u,a){a&1&&yt(n,u[0]),u[1]!=null?o?o.p(u,a):(o=l1(u),o.c(),o.m(t,null)):o&&(o.d(1),o=null)},d(u){u&&H(e),o&&o.d()}}}function l1(r){let e;function t(o,u){return o[1]==100?mC:pC}let n=t(r),i=n(r);return{c(){e=q("div"),i.c()},m(o,u){W(o,e,u),i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},d(o){o&&H(e),i.d()}}}function pC(r){let e;return{c(){e=q("progress"),e.value=r[1],ce(e,"max","100"),Ze(e,"width","100%")},m(t,n){W(t,e,n)},p(t,n){n&2&&(e.value=t[1])},d(t){t&&H(e)}}}function mC(r){let e;return{c(){e=q("progress"),Ze(e,"width","100%")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function gC(r){let e,t=r[0]&&a1(r);return{c(){t&&t.c(),e=rr()},m(n,i){t&&t.m(n,i),W(n,e,i)},p(n,[i]){n[0]?t?t.p(n,i):(t=a1(n),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:ht,o:ht,d(n){n&&H(e),t&&t.d(n)}}}function _C(r,e,t){let{loading:n}=e,{progress:i=null}=e,o,u;return r.$$set=a=>{"loading"in a&&t(0,n=a.loading),"progress"in a&&t(1,i=a.progress)},r.$$.update=()=>{if(r.$$.dirty&13){if(n&&!o)t(2,o=Date.now()),t(3,u=n);else if(!n&&o){const a=Date.now()-o;console.log(`Loading "${u}" took ${a}ms`),t(2,o=void 0)}}},[n,i,o,u]}class qu extends kt{constructor(e){super(),St(this,e,_C,gC,gt,{loading:0,progress:1})}}function Mr(r){var e;switch(r){case"title":return"Choose project";case"new-project":return"New project";case"pick-neighbourhood":return((e=li(y2))==null?void 0:e.project_name)||"Pick neighbourhood";case"set-boundary":return"Adjust boundary";case"add-neighbourhood":return"Add a neighbourhood";case"neighbourhood":return li(Ba)||"Editing";case"view-shortcuts":return"Shortcuts";case"impact-one-destination":return"Impact on one destination";case"route":return"Route";case"predict-impact":return"Predict impact";case"impact-detail":return"Impact detail";case"debug-intersections":return"Debug intersections";case"debug-neighbourhood":return"Debug neighbourhood";case"debug-demand":return"Explore origin/destination demand data"}}function yC(r){let e,t=Mr(r[0].mode)+"",n;return{c(){e=q("span"),n=Te(t),ce(e,"class","page-title svelte-1o8s136")},m(i,o){W(i,e,o),z(e,n)},p(i,o){o&1&&t!==(t=Mr(i[0].mode)+"")&&yt(n,t)},d(i){i&&H(e)}}}function bC(r){let e;const t=r[2].default,n=_n(t,r,r[4],null),i=n||yC(r);return{c(){i&&i.c()},m(o,u){i&&i.m(o,u),e=!0},p(o,u){n?n.p&&(!e||u&16)&&yn(n,t,o,o[4],e?vn(t,o[4],u,null):bn(o[4]),null):i&&i.p&&(!e||u&1)&&i.p(o,e?u:-1)},i(o){e||(N(i,o),e=!0)},o(o){G(i,o),e=!1},d(o){i&&i.d(o)}}}function vC(r){let e,t;return e=new nh({props:{$$slots:{default:[bC]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&17&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function wC(r,e,t){let n;rt(r,or,d=>t(1,n=d));let{$$slots:i={},$$scope:o}=e,{mode:u}=e;const a=()=>on(or,n=u,n);return r.$$set=d=>{"mode"in d&&t(0,u=d.mode),"$$scope"in d&&t(4,o=d.$$scope)},[u,n,i,a,o]}class jn extends kt{constructor(e){super(),St(this,e,wC,vC,gt,{mode:0})}}function xC(r){let e,t,n,i,o,u=r[0]+1+"",a,d,m=r[1].length+"",_,v,S,T,C,L,P;return{c(){e=q("div"),t=q("button"),n=Te("Previous"),o=ae(),a=Te(u),d=Te(" / "),_=Te(m),v=ae(),S=q("button"),T=Te("Next"),t.disabled=i=r[0]==0,ce(t,"data-tippy-content","Left"),S.disabled=C=r[0]==r[1].length-1,ce(S,"data-tippy-content","Right"),Ze(e,"display","flex"),Ze(e,"justify-content","space-between"),Ze(e,"align-items","center")},m(D,I){W(D,e,I),z(e,t),z(t,n),z(e,o),z(e,a),z(e,d),z(e,_),z(e,v),z(e,S),z(S,T),L||(P=[_t(window,"keydown",r[2]),_t(t,"click",r[3]),_t(S,"click",r[4])],L=!0)},p(D,[I]){I&1&&i!==(i=D[0]==0)&&(t.disabled=i),I&1&&u!==(u=D[0]+1+"")&&yt(a,u),I&2&&m!==(m=D[1].length+"")&&yt(_,m),I&3&&C!==(C=D[0]==D[1].length-1)&&(S.disabled=C)},i:ht,o:ht,d(D){D&&H(e),L=!1,Er(P)}}}function AC(r,e,t){let n;rt(r,Ko,m=>t(5,n=m));let{list:i}=e,{idx:o=0}=e;Yo(()=>{n==null||n.keyboard.disable(),r_()}),ei(()=>{n==null||n.keyboard.enable()});function u(m){m.key=="ArrowLeft"&&(m.stopPropagation(),a()),m.key=="ArrowRight"&&(m.stopPropagation(),d())}function a(){o!=0&&t(0,o--,o)}function d(){o!=i.length-1&&t(0,o++,o)}return r.$$set=m=>{"list"in m&&t(1,i=m.list),"idx"in m&&t(0,o=m.idx)},[o,i,u,a,d]}class op extends kt{constructor(e){super(),St(this,e,AC,xC,gt,{list:1,idx:0})}}function kC(r,e){let t=new Set(r.getStyle().layers.filter(n=>n.type=="line").map(n=>n.id));return e=="dataviz"?["Road network","Path"].filter(n=>t.has(n)):e=="hybrid"?["Path","Road","Tunnel"].filter(n=>t.has(n)):e=="streets-v2"?r.getStyle().layers.filter(n=>n["source-layer"]=="transportation"&&n.type=="line").map(n=>n.id):e=="uk-openzoomstack-light"?r.getStyle().layers.filter(n=>n["source-layer"]=="roads"&&n.type=="line").map(n=>n.id):[]}const{window:SC}=Lg;function TC(r){let e,t;return e=new B3({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function CC(r){let e,t;return e=new P3({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function u1(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I;return P=Ig(r[9][0]),{c(){e=q("div"),t=Te(`Click the map to see street view
      `),n=q("br"),i=ae(),o=q("br"),u=ae(),a=q("b"),a.textContent="Street view source",d=ae(),m=q("label"),_=q("input"),v=Te(`
        Google Street View`),S=ae(),T=q("label"),C=q("input"),L=Te(`
        Bing Streetside`),ce(_,"type","radio"),_.__value="google",Gn(_,_.__value),ce(_,"class","svelte-1kgc7zz"),ce(m,"class","svelte-1kgc7zz"),ce(C,"type","radio"),C.__value="bing",Gn(C,C.__value),ce(C,"class","svelte-1kgc7zz"),ce(T,"class","svelte-1kgc7zz"),ce(e,"class","street-view-control-source svelte-1kgc7zz"),Nt(e,"expanded",r[0]),P.p(_,C)},m(U,O){W(U,e,O),z(e,t),z(e,n),z(e,i),z(e,o),z(e,u),z(e,a),z(e,d),z(e,m),z(m,_),_.checked=_.__value===r[1],z(m,v),z(e,S),z(e,T),z(T,C),C.checked=C.__value===r[1],z(T,L),D||(I=[_t(_,"change",r[8]),_t(C,"change",r[10])],D=!0)},p(U,O){O&2&&(_.checked=_.__value===U[1]),O&2&&(C.checked=C.__value===U[1]),O&1&&Nt(e,"expanded",U[0])},d(U){U&&H(e),P.r(),D=!1,Er(I)}}}function MC(r){let e,t,n,i,o,u,a,d,m;const _=[CC,TC],v=[];function S(C,L){return C[0]?0:1}n=S(r),i=v[n]=_[n](r);let T=r[0]&&u1(r);return{c(){e=q("button"),t=q("div"),i.c(),o=ae(),T&&T.c(),u=rr(),ce(t,"class","ltn-map-btn"),ce(e,"title","Street view")},m(C,L){W(C,e,L),z(e,t),v[n].m(t,null),W(C,o,L),T&&T.m(C,L),W(C,u,L),a=!0,d||(m=_t(e,"click",r[7]),d=!0)},p(C,L){let P=n;n=S(C),n!==P&&(Zt(),G(v[P],1,1,()=>{v[P]=null}),Ht(),i=v[n],i||(i=v[n]=_[n](C),i.c()),N(i,1),i.m(t,null)),C[0]?T?T.p(C,L):(T=u1(C),T.c(),T.m(u.parentNode,u)):T&&(T.d(1),T=null)},i(C){a||(N(i),a=!0)},o(C){G(i),a=!1},d(C){C&&(H(e),H(o),H(u)),v[n].d(),T&&T.d(C),d=!1,m()}}}function EC(r){let e,t,n,i;return e=new bw({props:{$$slots:{default:[MC]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0,n||(i=_t(SC,"keydown",r[4]),n=!0)},p(o,[u]){const a={};u&16387&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o),n=!1,i()}}}function IC(r,e,t){let n;rt(r,Ld,D=>t(12,n=D));let{map:i}=e,{maptilerBasemap:o}=e,u=!1,a="google",d=[];function m(){on(Ld,n=!1,n),i.on("click",v),i.getCanvas().style.cursor="crosshair";for(let D of kC(i,o))d.push([D,i.getPaintProperty(D,"line-color")]),i.setPaintProperty(D,"line-color","cyan")}function _(){on(Ld,n=!0,n),i.off("click",v),i.getCanvas().style.cursor="inherit";for(let[D,I]of d)i.setPaintProperty(D,"line-color",I);d=[]}ei(_);function v(D){let I=D.lngLat.lng,U=D.lngLat.lat;a=="google"?window.open(`http://maps.google.com/maps?q=&layer=c&cbll=${U},${I}&cbp=11,0,0,0,0`,"_blank"):a=="bing"&&window.open(`https://www.bing.com/maps?cp=${U}~${I}&style=x`,"_blank")}function S(D){!n&&D.key=="Escape"&&(D.stopPropagation(),_())}const T=[[]],C=()=>{t(0,u=!u),u?m():_()};function L(){a=this.__value,t(1,a)}function P(){a=this.__value,t(1,a)}return r.$$set=D=>{"map"in D&&t(5,i=D.map),"maptilerBasemap"in D&&t(6,o=D.maptilerBasemap)},[u,a,m,_,S,i,o,C,L,T,P]}class LC extends kt{constructor(e){super(),St(this,e,IC,EC,gt,{map:5,maptilerBasemap:6})}}function sn(r,e=!0){return{id:r,beforeId:PC(r),eventsIfTopMost:e}}function PC(r){let e=li(Ko);if(!e){console.warn(`getBeforeId(${r}) called before map is ready. Z-ordering may be incorrect.`);return}let t,n=!1;for(let i=c1.length-1;i>=0;i--){let o=c1[i];if(o==r){n=!0;break}e.getLayer(o)&&(t=o)}if(!n)throw new Error(`Layer ID ${r} not defined in layerZorder`);return t}let Dm=r=>r,Rm=r=>r;const c1=[Dm(Rm("Background")),"neighbourhood-boundaries",Dm("Ferry line"),"neighbourhood-boundaries-outline","neighbourhood-boundaries-selected-outline-base","neighbourhood-boundaries-selected-outline","debug-borders","debug-filters","cells","before-edits-cells","interior-roads-outlines","before-edits-interior-roads-outlines","interior-roads","before-edits-interior-roads","main-roads-outlines","before-edits-main-roads-outlines","main-roads","before-edits-main-roads","turn-restriction-targets","debug-intersections","debug-movements-outline","debug-movements-fill","debug-editable-intersections","editable-intersections","intersection-filters","before-edits-intersection-filters","border-entries","before-edits-border-entries","compare-route","shortcuts","shortcuts-focus","predict-impact-outline","predict-impact",Rm("Building"),"draw-area-lines","draw-area-area","draw-area-lines-preview","draw-route-lines","draw-route-preview","debug-demand-fill","debug-demand-outline","one-ways","before-edits-one-ways","context-population-car-ownership","context-simd","context-population-density","context-population-outline","context-traffic","context-los","context-existing-infra","context-route-network","context-bus-routes","context-pois","context-railway-stations","context-stats19-heatmap","context-stats19-points",Rm("Road labels"),Dm("road_label"),"animate-shortcuts","modal-filters","before-edits-modal-filters","turn-restrictions","before-edits-turn-restrictions","turn-restrictions-debug-arrows","before-edits-turn-restrictions-debug-arrows","boundary","neighbourhood-boundary","freehand-line","edit-polygon-fill","edit-polygon-lines","edit-polygon-vertices"];let v2=["#8a9a5b","#ffc300","#cc5500","#c70039","#900c3f","#581845"],w2=[20,30,40,50,60,70],El=["#080C54","#186290","#1F9EB7","#80C6A3","#CDE594"],rh=El,ih=[0,20,40,60,80,100],Gu=El.toReversed(),Pd=El.toReversed(),Kg=[0,.25,.5,1,1.5,2],Yg=["#F8E4AF","#9ECC4E","#00BB44","#4ACD8B","#B9E9E9"],Qg=El.toReversed(),e_=El.toReversed(),oh=[0,20,40,60,80,100],sh=El,t_=[1,2,3,4,5],n_=El.toReversed();function x2(r){let e=[];for(let t=1;t<r.length;t++)e.push(t);return e}const zC="#0C793A",co={mapFeature:{hover:{backgroundColor:"rgb(72, 96, 202)"}}};function r_(){th("[data-tippy-content]")}function Xs(r){return["interpolate",["linear"],["zoom"],5,.5+r,10,1+r,12,gd(1.5+r,1+r),14,gd(4+r,2+r),16,gd(7+r,4+r),20,gd(24+r,16+r)]}function gd(r,e){return["match",["get","road_kind"],["private","pedestrian","service"],e,r]}function $a(r){return r<1e3?Math.round(r)+"m":(r/1e3).toFixed(1)+"km"}function ja(r){if(r<60)return Math.round(r)+"s";let e=Math.floor(r/60),t=Math.round(r-e*60);return`${e}m${t}s`}function Zu(r,e){return e===0?"0%":`${Math.round(r/e*100)}%`}function Hd(r){if(!r)return"custom area";let e=li(Bo);return e=="cnt"||e=="england"?Wd(r,"LAD_"):r}function A2(r){let e=li(ta).project(r),t=new Date().toISOString().split("T")[0],n=`${e.project_name}-${t}.geojson`;np(n,JSON.stringify(e))}function lg(r,e=4){return["interpolate",["exponential",2],["zoom"],0,["max",["/",r,15654.303392],e],22,["max",["/",r,.0597164283],e]]}async function ug(r){let e=await fetch(r);if(!e.ok)throw new Error(`${r} not OK: ${e.status}`);return e}function f1(r){return r.reduce((e,t)=>e+t,0)}function Wd(r,e){return r.startsWith(e)?r.slice(e.length):r}function h1(r,e){return r.endsWith(e)?r.slice(0,-e.length):r}async function sp(){await new Promise(r=>{requestAnimationFrame(()=>{requestAnimationFrame(r)})})}function DC(r){let e;return{c(){e=q("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:route%3Dbus" target="_blank">bus routes</a>
    according to OpenStreetMap.`,ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function RC(r){let e,t;const n=[sn("context-bus-routes"),{sourceLayer:"bus_routes"},{paint:{"line-color":"blue","line-width":Xs(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a=u&1?Tn(n,[n[0],n[1],n[2],{layout:{visibility:o[0]?"visible":"none"}}]):{};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function BC(r){let e,t,n,i,o;function u(d){r[1](d)}let a={label:"Bus routes",$$slots:{help:[DC]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new Do({props:a}),wn.push(()=>On(e,"show",u)),i=new Kf({props:{url:`pmtiles://${fs("cnt/layers/bus_routes.pmtiles")}`,$$slots:{default:[RC]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),n=ae(),pe(i.$$.fragment)},m(d,m){de(e,d,m),W(d,n,m),de(i,d,m),o=!0},p(d,[m]){const _={};m&4&&(_.$$scope={dirty:m,ctx:d}),!t&&m&1&&(t=!0,_.show=d[0],Nn(()=>t=!1)),e.$set(_);const v={};m&5&&(v.$$scope={dirty:m,ctx:d}),i.$set(v)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){G(e.$$.fragment,d),G(i.$$.fragment,d),o=!1},d(d){d&&H(n),he(e,d),he(i,d)}}}function FC(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class OC extends kt{constructor(e){super(),St(this,e,FC,BC,gt,{})}}var Mo=63710088e-1,k2={centimeters:Mo*100,centimetres:Mo*100,degrees:360/(2*Math.PI),feet:Mo*3.28084,inches:Mo*39.37,kilometers:Mo/1e3,kilometres:Mo/1e3,meters:Mo,metres:Mo,miles:Mo/1609.344,millimeters:Mo*1e3,millimetres:Mo*1e3,nauticalmiles:Mo/1852,radians:1,yards:Mo*1.0936};function NC(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function cg(r,e,t={}){if(!r)throw new Error("coordinates is required");if(!Array.isArray(r))throw new Error("coordinates must be an Array");if(r.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!d1(r[0])||!d1(r[1]))throw new Error("coordinates must contain numbers");return NC({type:"Point",coordinates:r},e,t)}function $C(r,e="kilometers"){const t=k2[e];if(!t)throw new Error(e+" units is invalid");return r*t}function jC(r,e="kilometers"){const t=k2[e];if(!t)throw new Error(e+" units is invalid");return r/t}function fg(r){return r%(2*Math.PI)*180/Math.PI}function hs(r){return r%360*Math.PI/180}function d1(r){return!isNaN(r)&&r!==null&&!Array.isArray(r)}var UC=Object.defineProperty,VC=(r,e,t)=>e in r?UC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,kn=(r,e,t)=>VC(r,typeof e!="symbol"?e+"":e,t);function Vf(){}function S2(r){return r()}function p1(){return Object.create(null)}function ap(r){r.forEach(S2)}function T2(r){return typeof r=="function"}function qC(r,e){return r!=r?e==e:r!==e||r&&typeof r=="object"||typeof r=="function"}function GC(r){return Object.keys(r).length===0}function ZC(r,e){r.appendChild(e)}function HC(r,e,t){r.insertBefore(e,t||null)}function C2(r){r.parentNode&&r.parentNode.removeChild(r)}function m1(r){return document.createElementNS("http://www.w3.org/2000/svg",r)}function Da(r,e,t){t==null?r.removeAttribute(e):r.getAttribute(e)!==t&&r.setAttribute(e,t)}function WC(r){return Array.from(r.childNodes)}function _d(r,e,t){r.classList.toggle(e,!!t)}let i_;function Ff(r){i_=r}const zu=[],g1=[];let Fu=[];const _1=[],XC=Promise.resolve();let hg=!1;function JC(){hg||(hg=!0,XC.then(M2))}function dg(r){Fu.push(r)}const Bm=new Set;let Iu=0;function M2(){if(Iu!==0)return;const r=i_;do{try{for(;Iu<zu.length;){const e=zu[Iu];Iu++,Ff(e),KC(e.$$)}}catch(e){throw zu.length=0,Iu=0,e}for(Ff(null),zu.length=0,Iu=0;g1.length;)g1.pop()();for(let e=0;e<Fu.length;e+=1){const t=Fu[e];Bm.has(t)||(Bm.add(t),t())}Fu.length=0}while(zu.length);for(;_1.length;)_1.pop()();hg=!1,Bm.clear(),Ff(r)}function KC(r){if(r.fragment!==null){r.update(),ap(r.before_update);const e=r.dirty;r.dirty=[-1],r.fragment&&r.fragment.p(r.ctx,e),r.after_update.forEach(dg)}}function YC(r){const e=[],t=[];Fu.forEach(n=>r.indexOf(n)===-1?e.push(n):t.push(n)),t.forEach(n=>n()),Fu=e}const QC=new Set;function eM(r,e){r&&r.i&&(QC.delete(r),r.i(e))}function tM(r,e,t){const{fragment:n,after_update:i}=r.$$;n&&n.m(e,t),dg(()=>{const o=r.$$.on_mount.map(S2).filter(T2);r.$$.on_destroy?r.$$.on_destroy.push(...o):ap(o),r.$$.on_mount=[]}),i.forEach(dg)}function nM(r,e){const t=r.$$;t.fragment!==null&&(YC(t.after_update),ap(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function rM(r,e){r.$$.dirty[0]===-1&&(zu.push(r),JC(),r.$$.dirty.fill(0)),r.$$.dirty[e/31|0]|=1<<e%31}function iM(r,e,t,n,i,o,u=null,a=[-1]){const d=i_;Ff(r);const m=r.$$={fragment:null,ctx:[],props:o,update:Vf,not_equal:i,bound:p1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(d?d.$$.context:[])),callbacks:p1(),dirty:a,skip_bound:!1,root:e.target||d.$$.root};u&&u(m.root);let _=!1;if(m.ctx=t?t(r,e.props||{},(v,S,...T)=>{const C=T.length?T[0]:S;return m.ctx&&i(m.ctx[v],m.ctx[v]=C)&&(!m.skip_bound&&m.bound[v]&&m.bound[v](C),_&&rM(r,v)),S}):[],m.update(),_=!0,ap(m.before_update),m.fragment=n?n(m.ctx):!1,e.target){if(e.hydrate){const v=WC(e.target);m.fragment&&m.fragment.l(v),v.forEach(C2)}else m.fragment&&m.fragment.c();e.intro&&eM(r.$$.fragment),tM(r,e.target,e.anchor),M2()}Ff(d)}class oM{constructor(){kn(this,"$$"),kn(this,"$$set")}$destroy(){nM(this,1),this.$destroy=Vf}$on(e,t){if(!T2(t))return Vf;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const i=n.indexOf(t);i!==-1&&n.splice(i,1)}}$set(e){this.$$set&&!GC(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const sM="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(sM);function aM(r){let e,t,n;return{c(){e=m1("svg"),t=m1("path"),Da(t,"stroke-width","4"),Da(t,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),Da(t,"class","svelte-gzo3ar"),Da(e,"width",n=r[0]==="list"?20:void 0),Da(e,"viewBox","0 0 70 85"),Da(e,"fill","none"),Da(e,"class","svelte-gzo3ar"),_d(e,"in-map",r[0]!=="list"),_d(e,"list-icon",r[0]==="list")},m(i,o){HC(i,e,o),ZC(e,t)},p(i,[o]){o&1&&n!==(n=i[0]==="list"?20:void 0)&&Da(e,"width",n),o&1&&_d(e,"in-map",i[0]!=="list"),o&1&&_d(e,"list-icon",i[0]==="list")},i:Vf,o:Vf,d(i){i&&C2(e)}}}function lM(r,e,t){let{displayIn:n}=e;return r.$$set=i=>{"displayIn"in i&&t(0,n=i.displayIn)},[n]}class uM extends oM{constructor(e){super(),iM(this,e,lM,aM,qC,{displayIn:0})}}function y1(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}const cM=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],fM={decimalLatitude:40.123,decimalLongitude:-74.123},hM=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],dM=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function pM(){const r=[];return cM.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...fM})}),[...r,...hM,...dM]}const mM=pM();mM.map(r=>r.verbatimCoordinates);function qf(r,e,t={}){const n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=e||{},n.geometry=r,n}function o_(r,e,t={}){for(const n of r){if(n.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(n[n.length-1].length!==n[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<n[n.length-1].length;i++)if(n[n.length-1][i]!==n[0][i])throw new Error("First and last Position are not equivalent.")}return qf({type:"Polygon",coordinates:r},e,t)}function Gf(r,e={}){const t={type:"FeatureCollection"};return e.id&&(t.id=e.id),e.bbox&&(t.bbox=e.bbox),t.features=r,t}function E2(r,e,t={}){return qf({type:"MultiPolygon",coordinates:r},e,t)}var gM=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Fm=Math.ceil,Go=Math.floor,lo="[BigNumber Error] ",b1=lo+"Number primitive has more than 15 significant digits: ",as=1e14,qn=14,v1=9007199254740991,Om=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Ra=1e7,Eo=1e9;function I2(r){var e,t,n,i=I.prototype={constructor:I,toString:null,valueOf:null},o=new I(1),u=20,a=4,d=-7,m=21,_=-1e7,v=1e7,S=!1,T=1,C=0,L={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"",suffix:""},P="0123456789abcdefghijklmnopqrstuvwxyz",D=!0;function I($,Q){var ne,F,Z,J,be,ke,ge,ve,fe=this;if(!(fe instanceof I))return new I($,Q);if(Q==null){if($&&$._isBigNumber===!0){fe.s=$.s,!$.c||$.e>v?fe.c=fe.e=null:$.e<_?fe.c=[fe.e=0]:(fe.e=$.e,fe.c=$.c.slice());return}if((ke=typeof $=="number")&&$*0==0){if(fe.s=1/$<0?($=-$,-1):1,$===~~$){for(J=0,be=$;be>=10;be/=10,J++);J>v?fe.c=fe.e=null:(fe.e=J,fe.c=[$]);return}ve=String($)}else{if(!gM.test(ve=String($)))return n(fe,ve,ke);fe.s=ve.charCodeAt(0)==45?(ve=ve.slice(1),-1):1}(J=ve.indexOf("."))>-1&&(ve=ve.replace(".","")),(be=ve.search(/e/i))>0?(J<0&&(J=be),J+=+ve.slice(be+1),ve=ve.substring(0,be)):J<0&&(J=ve.length)}else{if(Qr(Q,2,P.length,"Base"),Q==10&&D)return fe=new I($),X(fe,u+fe.e+1,a);if(ve=String($),ke=typeof $=="number"){if($*0!=0)return n(fe,ve,ke,Q);if(fe.s=1/$<0?(ve=ve.slice(1),-1):1,I.DEBUG&&ve.replace(/^0\.0*|\./,"").length>15)throw Error(b1+$)}else fe.s=ve.charCodeAt(0)===45?(ve=ve.slice(1),-1):1;for(ne=P.slice(0,Q),J=be=0,ge=ve.length;be<ge;be++)if(ne.indexOf(F=ve.charAt(be))<0){if(F=="."){if(be>J){J=ge;continue}}else if(!Z&&(ve==ve.toUpperCase()&&(ve=ve.toLowerCase())||ve==ve.toLowerCase()&&(ve=ve.toUpperCase()))){Z=!0,be=-1,J=0;continue}return n(fe,String($),ke,Q)}ke=!1,ve=t(ve,Q,10,fe.s),(J=ve.indexOf("."))>-1?ve=ve.replace(".",""):J=ve.length}for(be=0;ve.charCodeAt(be)===48;be++);for(ge=ve.length;ve.charCodeAt(--ge)===48;);if(ve=ve.slice(be,++ge)){if(ge-=be,ke&&I.DEBUG&&ge>15&&($>v1||$!==Go($)))throw Error(b1+fe.s*$);if((J=J-be-1)>v)fe.c=fe.e=null;else if(J<_)fe.c=[fe.e=0];else{if(fe.e=J,fe.c=[],be=(J+1)%qn,J<0&&(be+=qn),be<ge){for(be&&fe.c.push(+ve.slice(0,be)),ge-=qn;be<ge;)fe.c.push(+ve.slice(be,be+=qn));be=qn-(ve=ve.slice(be)).length}else be-=ge;for(;be--;ve+="0");fe.c.push(+ve)}}else fe.c=[fe.e=0]}I.clone=I2,I.ROUND_UP=0,I.ROUND_DOWN=1,I.ROUND_CEIL=2,I.ROUND_FLOOR=3,I.ROUND_HALF_UP=4,I.ROUND_HALF_DOWN=5,I.ROUND_HALF_EVEN=6,I.ROUND_HALF_CEIL=7,I.ROUND_HALF_FLOOR=8,I.EUCLID=9,I.config=I.set=function($){var Q,ne;if($!=null)if(typeof $=="object"){if($.hasOwnProperty(Q="DECIMAL_PLACES")&&(ne=$[Q],Qr(ne,0,Eo,Q),u=ne),$.hasOwnProperty(Q="ROUNDING_MODE")&&(ne=$[Q],Qr(ne,0,8,Q),a=ne),$.hasOwnProperty(Q="EXPONENTIAL_AT")&&(ne=$[Q],ne&&ne.pop?(Qr(ne[0],-1e9,0,Q),Qr(ne[1],0,Eo,Q),d=ne[0],m=ne[1]):(Qr(ne,-1e9,Eo,Q),d=-(m=ne<0?-ne:ne))),$.hasOwnProperty(Q="RANGE"))if(ne=$[Q],ne&&ne.pop)Qr(ne[0],-1e9,-1,Q),Qr(ne[1],1,Eo,Q),_=ne[0],v=ne[1];else if(Qr(ne,-1e9,Eo,Q),ne)_=-(v=ne<0?-ne:ne);else throw Error(lo+Q+" cannot be zero: "+ne);if($.hasOwnProperty(Q="CRYPTO"))if(ne=$[Q],ne===!!ne)if(ne)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))S=ne;else throw S=!ne,Error(lo+"crypto unavailable");else S=ne;else throw Error(lo+Q+" not true or false: "+ne);if($.hasOwnProperty(Q="MODULO_MODE")&&(ne=$[Q],Qr(ne,0,9,Q),T=ne),$.hasOwnProperty(Q="POW_PRECISION")&&(ne=$[Q],Qr(ne,0,Eo,Q),C=ne),$.hasOwnProperty(Q="FORMAT"))if(ne=$[Q],typeof ne=="object")L=ne;else throw Error(lo+Q+" not an object: "+ne);if($.hasOwnProperty(Q="ALPHABET"))if(ne=$[Q],typeof ne=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(ne))D=ne.slice(0,10)=="0123456789",P=ne;else throw Error(lo+Q+" invalid: "+ne)}else throw Error(lo+"Object expected: "+$);return{DECIMAL_PLACES:u,ROUNDING_MODE:a,EXPONENTIAL_AT:[d,m],RANGE:[_,v],CRYPTO:S,MODULO_MODE:T,POW_PRECISION:C,FORMAT:L,ALPHABET:P}},I.isBigNumber=function($){if(!$||$._isBigNumber!==!0)return!1;if(!I.DEBUG)return!0;var Q,ne,F=$.c,Z=$.e,J=$.s;e:if({}.toString.call(F)=="[object Array]"){if((J===1||J===-1)&&Z>=-1e9&&Z<=Eo&&Z===Go(Z)){if(F[0]===0){if(Z===0&&F.length===1)return!0;break e}if(Q=(Z+1)%qn,Q<1&&(Q+=qn),String(F[0]).length==Q){for(Q=0;Q<F.length;Q++)if(ne=F[Q],ne<0||ne>=as||ne!==Go(ne))break e;if(ne!==0)return!0}}}else if(F===null&&Z===null&&(J===null||J===1||J===-1))return!0;throw Error(lo+"Invalid BigNumber: "+$)},I.maximum=I.max=function(){return O(arguments,-1)},I.minimum=I.min=function(){return O(arguments,1)},I.random=function(){var $=9007199254740992,Q=Math.random()*$&2097151?function(){return Go(Math.random()*$)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(ne){var F,Z,J,be,ke,ge=0,ve=[],fe=new I(o);if(ne==null?ne=u:Qr(ne,0,Eo),be=Fm(ne/qn),S)if(crypto.getRandomValues){for(F=crypto.getRandomValues(new Uint32Array(be*=2));ge<be;)ke=F[ge]*131072+(F[ge+1]>>>11),ke>=9e15?(Z=crypto.getRandomValues(new Uint32Array(2)),F[ge]=Z[0],F[ge+1]=Z[1]):(ve.push(ke%1e14),ge+=2);ge=be/2}else if(crypto.randomBytes){for(F=crypto.randomBytes(be*=7);ge<be;)ke=(F[ge]&31)*281474976710656+F[ge+1]*1099511627776+F[ge+2]*4294967296+F[ge+3]*16777216+(F[ge+4]<<16)+(F[ge+5]<<8)+F[ge+6],ke>=9e15?crypto.randomBytes(7).copy(F,ge):(ve.push(ke%1e14),ge+=7);ge=be/7}else throw S=!1,Error(lo+"crypto unavailable");if(!S)for(;ge<be;)ke=Q(),ke<9e15&&(ve[ge++]=ke%1e14);for(be=ve[--ge],ne%=qn,be&&ne&&(ke=Om[qn-ne],ve[ge]=Go(be/ke)*ke);ve[ge]===0;ve.pop(),ge--);if(ge<0)ve=[J=0];else{for(J=-1;ve[0]===0;ve.splice(0,1),J-=qn);for(ge=1,ke=ve[0];ke>=10;ke/=10,ge++);ge<qn&&(J-=qn-ge)}return fe.e=J,fe.c=ve,fe}}(),I.sum=function(){for(var $=1,Q=arguments,ne=new I(Q[0]);$<Q.length;)ne=ne.plus(Q[$++]);return ne},t=function(){var $="0123456789";function Q(ne,F,Z,J){for(var be,ke=[0],ge,ve=0,fe=ne.length;ve<fe;){for(ge=ke.length;ge--;ke[ge]*=F);for(ke[0]+=J.indexOf(ne.charAt(ve++)),be=0;be<ke.length;be++)ke[be]>Z-1&&(ke[be+1]==null&&(ke[be+1]=0),ke[be+1]+=ke[be]/Z|0,ke[be]%=Z)}return ke.reverse()}return function(ne,F,Z,J,be){var ke,ge,ve,fe,Pe,Ee,Fe,ot,ct=ne.indexOf("."),it=u,at=a;for(ct>=0&&(fe=C,C=0,ne=ne.replace(".",""),ot=new I(F),Ee=ot.pow(ne.length-ct),C=fe,ot.c=Q(Ws(Vo(Ee.c),Ee.e,"0"),10,Z,$),ot.e=ot.c.length),Fe=Q(ne,F,Z,be?(ke=P,$):(ke=$,P)),ve=fe=Fe.length;Fe[--fe]==0;Fe.pop());if(!Fe[0])return ke.charAt(0);if(ct<0?--ve:(Ee.c=Fe,Ee.e=ve,Ee.s=J,Ee=e(Ee,ot,it,at,Z),Fe=Ee.c,Pe=Ee.r,ve=Ee.e),ge=ve+it+1,ct=Fe[ge],fe=Z/2,Pe=Pe||ge<0||Fe[ge+1]!=null,Pe=at<4?(ct!=null||Pe)&&(at==0||at==(Ee.s<0?3:2)):ct>fe||ct==fe&&(at==4||Pe||at==6&&Fe[ge-1]&1||at==(Ee.s<0?8:7)),ge<1||!Fe[0])ne=Pe?Ws(ke.charAt(1),-it,ke.charAt(0)):ke.charAt(0);else{if(Fe.length=ge,Pe)for(--Z;++Fe[--ge]>Z;)Fe[ge]=0,ge||(++ve,Fe=[1].concat(Fe));for(fe=Fe.length;!Fe[--fe];);for(ct=0,ne="";ct<=fe;ne+=ke.charAt(Fe[ct++]));ne=Ws(ne,ve,ke.charAt(0))}return ne}}(),e=function(){function $(F,Z,J){var be,ke,ge,ve,fe=0,Pe=F.length,Ee=Z%Ra,Fe=Z/Ra|0;for(F=F.slice();Pe--;)ge=F[Pe]%Ra,ve=F[Pe]/Ra|0,be=Fe*ge+ve*Ee,ke=Ee*ge+be%Ra*Ra+fe,fe=(ke/J|0)+(be/Ra|0)+Fe*ve,F[Pe]=ke%J;return fe&&(F=[fe].concat(F)),F}function Q(F,Z,J,be){var ke,ge;if(J!=be)ge=J>be?1:-1;else for(ke=ge=0;ke<J;ke++)if(F[ke]!=Z[ke]){ge=F[ke]>Z[ke]?1:-1;break}return ge}function ne(F,Z,J,be){for(var ke=0;J--;)F[J]-=ke,ke=F[J]<Z[J]?1:0,F[J]=ke*be+F[J]-Z[J];for(;!F[0]&&F.length>1;F.splice(0,1));}return function(F,Z,J,be,ke){var ge,ve,fe,Pe,Ee,Fe,ot,ct,it,at,ft,Ct,xt,It,Qt,tn,rn,Ue=F.s==Z.s?1:-1,Xe=F.c,qt=Z.c;if(!Xe||!Xe[0]||!qt||!qt[0])return new I(!F.s||!Z.s||(Xe?qt&&Xe[0]==qt[0]:!qt)?NaN:Xe&&Xe[0]==0||!qt?Ue*0:Ue/0);for(ct=new I(Ue),it=ct.c=[],ve=F.e-Z.e,Ue=J+ve+1,ke||(ke=as,ve=Zo(F.e/qn)-Zo(Z.e/qn),Ue=Ue/qn|0),fe=0;qt[fe]==(Xe[fe]||0);fe++);if(qt[fe]>(Xe[fe]||0)&&ve--,Ue<0)it.push(1),Pe=!0;else{for(It=Xe.length,tn=qt.length,fe=0,Ue+=2,Ee=Go(ke/(qt[0]+1)),Ee>1&&(qt=$(qt,Ee,ke),Xe=$(Xe,Ee,ke),tn=qt.length,It=Xe.length),xt=tn,at=Xe.slice(0,tn),ft=at.length;ft<tn;at[ft++]=0);rn=qt.slice(),rn=[0].concat(rn),Qt=qt[0],qt[1]>=ke/2&&Qt++;do{if(Ee=0,ge=Q(qt,at,tn,ft),ge<0){if(Ct=at[0],tn!=ft&&(Ct=Ct*ke+(at[1]||0)),Ee=Go(Ct/Qt),Ee>1)for(Ee>=ke&&(Ee=ke-1),Fe=$(qt,Ee,ke),ot=Fe.length,ft=at.length;Q(Fe,at,ot,ft)==1;)Ee--,ne(Fe,tn<ot?rn:qt,ot,ke),ot=Fe.length,ge=1;else Ee==0&&(ge=Ee=1),Fe=qt.slice(),ot=Fe.length;if(ot<ft&&(Fe=[0].concat(Fe)),ne(at,Fe,ft,ke),ft=at.length,ge==-1)for(;Q(qt,at,tn,ft)<1;)Ee++,ne(at,tn<ft?rn:qt,ft,ke),ft=at.length}else ge===0&&(Ee++,at=[0]);it[fe++]=Ee,at[0]?at[ft++]=Xe[xt]||0:(at=[Xe[xt]],ft=1)}while((xt++<It||at[0]!=null)&&Ue--);Pe=at[0]!=null,it[0]||it.splice(0,1)}if(ke==as){for(fe=1,Ue=it[0];Ue>=10;Ue/=10,fe++);X(ct,J+(ct.e=fe+ve*qn-1)+1,be,Pe)}else ct.e=ve,ct.r=+Pe;return ct}}();function U($,Q,ne,F){var Z,J,be,ke,ge;if(ne==null?ne=a:Qr(ne,0,8),!$.c)return $.toString();if(Z=$.c[0],be=$.e,Q==null)ge=Vo($.c),ge=F==1||F==2&&(be<=d||be>=m)?bd(ge,be):Ws(ge,be,"0");else if($=X(new I($),Q,ne),J=$.e,ge=Vo($.c),ke=ge.length,F==1||F==2&&(Q<=J||J<=d)){for(;ke<Q;ge+="0",ke++);ge=bd(ge,J)}else if(Q-=be,ge=Ws(ge,J,"0"),J+1>ke){if(--Q>0)for(ge+=".";Q--;ge+="0");}else if(Q+=J-ke,Q>0)for(J+1==ke&&(ge+=".");Q--;ge+="0");return $.s<0&&Z?"-"+ge:ge}function O($,Q){for(var ne,F,Z=1,J=new I($[0]);Z<$.length;Z++)F=new I($[Z]),(!F.s||(ne=yl(J,F))===Q||ne===0&&J.s===Q)&&(J=F);return J}function ee($,Q,ne){for(var F=1,Z=Q.length;!Q[--Z];Q.pop());for(Z=Q[0];Z>=10;Z/=10,F++);return(ne=F+ne*qn-1)>v?$.c=$.e=null:ne<_?$.c=[$.e=0]:($.e=ne,$.c=Q),$}n=function(){var $=/^(-?)0([xbo])(?=\w[\w.]*$)/i,Q=/^([^.]+)\.$/,ne=/^\.([^.]+)$/,F=/^-?(Infinity|NaN)$/,Z=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(J,be,ke,ge){var ve,fe=ke?be:be.replace(Z,"");if(F.test(fe))J.s=isNaN(fe)?null:fe<0?-1:1;else{if(!ke&&(fe=fe.replace($,function(Pe,Ee,Fe){return ve=(Fe=Fe.toLowerCase())=="x"?16:Fe=="b"?2:8,!ge||ge==ve?Ee:Pe}),ge&&(ve=ge,fe=fe.replace(Q,"$1").replace(ne,"0.$1")),be!=fe))return new I(fe,ve);if(I.DEBUG)throw Error(lo+"Not a"+(ge?" base "+ge:"")+" number: "+be);J.s=null}J.c=J.e=null}}();function X($,Q,ne,F){var Z,J,be,ke,ge,ve,fe,Pe=$.c,Ee=Om;if(Pe){e:{for(Z=1,ke=Pe[0];ke>=10;ke/=10,Z++);if(J=Q-Z,J<0)J+=qn,be=Q,ge=Pe[ve=0],fe=Go(ge/Ee[Z-be-1]%10);else if(ve=Fm((J+1)/qn),ve>=Pe.length)if(F){for(;Pe.length<=ve;Pe.push(0));ge=fe=0,Z=1,J%=qn,be=J-qn+1}else break e;else{for(ge=ke=Pe[ve],Z=1;ke>=10;ke/=10,Z++);J%=qn,be=J-qn+Z,fe=be<0?0:Go(ge/Ee[Z-be-1]%10)}if(F=F||Q<0||Pe[ve+1]!=null||(be<0?ge:ge%Ee[Z-be-1]),F=ne<4?(fe||F)&&(ne==0||ne==($.s<0?3:2)):fe>5||fe==5&&(ne==4||F||ne==6&&(J>0?be>0?ge/Ee[Z-be]:0:Pe[ve-1])%10&1||ne==($.s<0?8:7)),Q<1||!Pe[0])return Pe.length=0,F?(Q-=$.e+1,Pe[0]=Ee[(qn-Q%qn)%qn],$.e=-Q||0):Pe[0]=$.e=0,$;if(J==0?(Pe.length=ve,ke=1,ve--):(Pe.length=ve+1,ke=Ee[qn-J],Pe[ve]=be>0?Go(ge/Ee[Z-be]%Ee[be])*ke:0),F)for(;;)if(ve==0){for(J=1,be=Pe[0];be>=10;be/=10,J++);for(be=Pe[0]+=ke,ke=1;be>=10;be/=10,ke++);J!=ke&&($.e++,Pe[0]==as&&(Pe[0]=1));break}else{if(Pe[ve]+=ke,Pe[ve]!=as)break;Pe[ve--]=0,ke=1}for(J=Pe.length;Pe[--J]===0;Pe.pop());}$.e>v?$.c=$.e=null:$.e<_&&($.c=[$.e=0])}return $}function ue($){var Q,ne=$.e;return ne===null?$.toString():(Q=Vo($.c),Q=ne<=d||ne>=m?bd(Q,ne):Ws(Q,ne,"0"),$.s<0?"-"+Q:Q)}return i.absoluteValue=i.abs=function(){var $=new I(this);return $.s<0&&($.s=1),$},i.comparedTo=function($,Q){return yl(this,new I($,Q))},i.decimalPlaces=i.dp=function($,Q){var ne,F,Z,J=this;if($!=null)return Qr($,0,Eo),Q==null?Q=a:Qr(Q,0,8),X(new I(J),$+J.e+1,Q);if(!(ne=J.c))return null;if(F=((Z=ne.length-1)-Zo(this.e/qn))*qn,Z=ne[Z])for(;Z%10==0;Z/=10,F--);return F<0&&(F=0),F},i.dividedBy=i.div=function($,Q){return e(this,new I($,Q),u,a)},i.dividedToIntegerBy=i.idiv=function($,Q){return e(this,new I($,Q),0,1)},i.exponentiatedBy=i.pow=function($,Q){var ne,F,Z,J,be,ke,ge,ve,fe,Pe=this;if($=new I($),$.c&&!$.isInteger())throw Error(lo+"Exponent not an integer: "+ue($));if(Q!=null&&(Q=new I(Q)),ke=$.e>14,!Pe.c||!Pe.c[0]||Pe.c[0]==1&&!Pe.e&&Pe.c.length==1||!$.c||!$.c[0])return fe=new I(Math.pow(+ue(Pe),ke?$.s*(2-yd($)):+ue($))),Q?fe.mod(Q):fe;if(ge=$.s<0,Q){if(Q.c?!Q.c[0]:!Q.s)return new I(NaN);F=!ge&&Pe.isInteger()&&Q.isInteger(),F&&(Pe=Pe.mod(Q))}else{if($.e>9&&(Pe.e>0||Pe.e<-1||(Pe.e==0?Pe.c[0]>1||ke&&Pe.c[1]>=24e7:Pe.c[0]<8e13||ke&&Pe.c[0]<=9999975e7)))return J=Pe.s<0&&yd($)?-0:0,Pe.e>-1&&(J=1/J),new I(ge?1/J:J);C&&(J=Fm(C/qn+2))}for(ke?(ne=new I(.5),ge&&($.s=1),ve=yd($)):(Z=Math.abs(+ue($)),ve=Z%2),fe=new I(o);;){if(ve){if(fe=fe.times(Pe),!fe.c)break;J?fe.c.length>J&&(fe.c.length=J):F&&(fe=fe.mod(Q))}if(Z){if(Z=Go(Z/2),Z===0)break;ve=Z%2}else if($=$.times(ne),X($,$.e+1,1),$.e>14)ve=yd($);else{if(Z=+ue($),Z===0)break;ve=Z%2}Pe=Pe.times(Pe),J?Pe.c&&Pe.c.length>J&&(Pe.c.length=J):F&&(Pe=Pe.mod(Q))}return F?fe:(ge&&(fe=o.div(fe)),Q?fe.mod(Q):J?X(fe,C,a,be):fe)},i.integerValue=function($){var Q=new I(this);return $==null?$=a:Qr($,0,8),X(Q,Q.e+1,$)},i.isEqualTo=i.eq=function($,Q){return yl(this,new I($,Q))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function($,Q){return yl(this,new I($,Q))>0},i.isGreaterThanOrEqualTo=i.gte=function($,Q){return(Q=yl(this,new I($,Q)))===1||Q===0},i.isInteger=function(){return!!this.c&&Zo(this.e/qn)>this.c.length-2},i.isLessThan=i.lt=function($,Q){return yl(this,new I($,Q))<0},i.isLessThanOrEqualTo=i.lte=function($,Q){return(Q=yl(this,new I($,Q)))===-1||Q===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function($,Q){var ne,F,Z,J,be=this,ke=be.s;if($=new I($,Q),Q=$.s,!ke||!Q)return new I(NaN);if(ke!=Q)return $.s=-Q,be.plus($);var ge=be.e/qn,ve=$.e/qn,fe=be.c,Pe=$.c;if(!ge||!ve){if(!fe||!Pe)return fe?($.s=-Q,$):new I(Pe?be:NaN);if(!fe[0]||!Pe[0])return Pe[0]?($.s=-Q,$):new I(fe[0]?be:a==3?-0:0)}if(ge=Zo(ge),ve=Zo(ve),fe=fe.slice(),ke=ge-ve){for((J=ke<0)?(ke=-ke,Z=fe):(ve=ge,Z=Pe),Z.reverse(),Q=ke;Q--;Z.push(0));Z.reverse()}else for(F=(J=(ke=fe.length)<(Q=Pe.length))?ke:Q,ke=Q=0;Q<F;Q++)if(fe[Q]!=Pe[Q]){J=fe[Q]<Pe[Q];break}if(J&&(Z=fe,fe=Pe,Pe=Z,$.s=-$.s),Q=(F=Pe.length)-(ne=fe.length),Q>0)for(;Q--;fe[ne++]=0);for(Q=as-1;F>ke;){if(fe[--F]<Pe[F]){for(ne=F;ne&&!fe[--ne];fe[ne]=Q);--fe[ne],fe[F]+=as}fe[F]-=Pe[F]}for(;fe[0]==0;fe.splice(0,1),--ve);return fe[0]?ee($,fe,ve):($.s=a==3?-1:1,$.c=[$.e=0],$)},i.modulo=i.mod=function($,Q){var ne,F,Z=this;return $=new I($,Q),!Z.c||!$.s||$.c&&!$.c[0]?new I(NaN):!$.c||Z.c&&!Z.c[0]?new I(Z):(T==9?(F=$.s,$.s=1,ne=e(Z,$,0,3),$.s=F,ne.s*=F):ne=e(Z,$,0,T),$=Z.minus(ne.times($)),!$.c[0]&&T==1&&($.s=Z.s),$)},i.multipliedBy=i.times=function($,Q){var ne,F,Z,J,be,ke,ge,ve,fe,Pe,Ee,Fe,ot,ct,it,at=this,ft=at.c,Ct=($=new I($,Q)).c;if(!ft||!Ct||!ft[0]||!Ct[0])return!at.s||!$.s||ft&&!ft[0]&&!Ct||Ct&&!Ct[0]&&!ft?$.c=$.e=$.s=null:($.s*=at.s,!ft||!Ct?$.c=$.e=null:($.c=[0],$.e=0)),$;for(F=Zo(at.e/qn)+Zo($.e/qn),$.s*=at.s,ge=ft.length,Pe=Ct.length,ge<Pe&&(ot=ft,ft=Ct,Ct=ot,Z=ge,ge=Pe,Pe=Z),Z=ge+Pe,ot=[];Z--;ot.push(0));for(ct=as,it=Ra,Z=Pe;--Z>=0;){for(ne=0,Ee=Ct[Z]%it,Fe=Ct[Z]/it|0,be=ge,J=Z+be;J>Z;)ve=ft[--be]%it,fe=ft[be]/it|0,ke=Fe*ve+fe*Ee,ve=Ee*ve+ke%it*it+ot[J]+ne,ne=(ve/ct|0)+(ke/it|0)+Fe*fe,ot[J--]=ve%ct;ot[J]=ne}return ne?++F:ot.splice(0,1),ee($,ot,F)},i.negated=function(){var $=new I(this);return $.s=-$.s||null,$},i.plus=function($,Q){var ne,F=this,Z=F.s;if($=new I($,Q),Q=$.s,!Z||!Q)return new I(NaN);if(Z!=Q)return $.s=-Q,F.minus($);var J=F.e/qn,be=$.e/qn,ke=F.c,ge=$.c;if(!J||!be){if(!ke||!ge)return new I(Z/0);if(!ke[0]||!ge[0])return ge[0]?$:new I(ke[0]?F:Z*0)}if(J=Zo(J),be=Zo(be),ke=ke.slice(),Z=J-be){for(Z>0?(be=J,ne=ge):(Z=-Z,ne=ke),ne.reverse();Z--;ne.push(0));ne.reverse()}for(Z=ke.length,Q=ge.length,Z-Q<0&&(ne=ge,ge=ke,ke=ne,Q=Z),Z=0;Q;)Z=(ke[--Q]=ke[Q]+ge[Q]+Z)/as|0,ke[Q]=as===ke[Q]?0:ke[Q]%as;return Z&&(ke=[Z].concat(ke),++be),ee($,ke,be)},i.precision=i.sd=function($,Q){var ne,F,Z,J=this;if($!=null&&$!==!!$)return Qr($,1,Eo),Q==null?Q=a:Qr(Q,0,8),X(new I(J),$,Q);if(!(ne=J.c))return null;if(Z=ne.length-1,F=Z*qn+1,Z=ne[Z]){for(;Z%10==0;Z/=10,F--);for(Z=ne[0];Z>=10;Z/=10,F++);}return $&&J.e+1>F&&(F=J.e+1),F},i.shiftedBy=function($){return Qr($,-9007199254740991,v1),this.times("1e"+$)},i.squareRoot=i.sqrt=function(){var $,Q,ne,F,Z,J=this,be=J.c,ke=J.s,ge=J.e,ve=u+4,fe=new I("0.5");if(ke!==1||!be||!be[0])return new I(!ke||ke<0&&(!be||be[0])?NaN:be?J:1/0);if(ke=Math.sqrt(+ue(J)),ke==0||ke==1/0?(Q=Vo(be),(Q.length+ge)%2==0&&(Q+="0"),ke=Math.sqrt(+Q),ge=Zo((ge+1)/2)-(ge<0||ge%2),ke==1/0?Q="5e"+ge:(Q=ke.toExponential(),Q=Q.slice(0,Q.indexOf("e")+1)+ge),ne=new I(Q)):ne=new I(ke+""),ne.c[0]){for(ge=ne.e,ke=ge+ve,ke<3&&(ke=0);;)if(Z=ne,ne=fe.times(Z.plus(e(J,Z,ve,1))),Vo(Z.c).slice(0,ke)===(Q=Vo(ne.c)).slice(0,ke))if(ne.e<ge&&--ke,Q=Q.slice(ke-3,ke+1),Q=="9999"||!F&&Q=="4999"){if(!F&&(X(Z,Z.e+u+2,0),Z.times(Z).eq(J))){ne=Z;break}ve+=4,ke+=4,F=1}else{(!+Q||!+Q.slice(1)&&Q.charAt(0)=="5")&&(X(ne,ne.e+u+2,1),$=!ne.times(ne).eq(J));break}}return X(ne,ne.e+u+1,a,$)},i.toExponential=function($,Q){return $!=null&&(Qr($,0,Eo),$++),U(this,$,Q,1)},i.toFixed=function($,Q){return $!=null&&(Qr($,0,Eo),$=$+this.e+1),U(this,$,Q)},i.toFormat=function($,Q,ne){var F,Z=this;if(ne==null)$!=null&&Q&&typeof Q=="object"?(ne=Q,Q=null):$&&typeof $=="object"?(ne=$,$=Q=null):ne=L;else if(typeof ne!="object")throw Error(lo+"Argument not an object: "+ne);if(F=Z.toFixed($,Q),Z.c){var J,be=F.split("."),ke=+ne.groupSize,ge=+ne.secondaryGroupSize,ve=ne.groupSeparator||"",fe=be[0],Pe=be[1],Ee=Z.s<0,Fe=Ee?fe.slice(1):fe,ot=Fe.length;if(ge&&(J=ke,ke=ge,ge=J,ot-=J),ke>0&&ot>0){for(J=ot%ke||ke,fe=Fe.substr(0,J);J<ot;J+=ke)fe+=ve+Fe.substr(J,ke);ge>0&&(fe+=ve+Fe.slice(J)),Ee&&(fe="-"+fe)}F=Pe?fe+(ne.decimalSeparator||"")+((ge=+ne.fractionGroupSize)?Pe.replace(new RegExp("\\d{"+ge+"}\\B","g"),"$&"+(ne.fractionGroupSeparator||"")):Pe):fe}return(ne.prefix||"")+F+(ne.suffix||"")},i.toFraction=function($){var Q,ne,F,Z,J,be,ke,ge,ve,fe,Pe,Ee,Fe=this,ot=Fe.c;if($!=null&&(ke=new I($),!ke.isInteger()&&(ke.c||ke.s!==1)||ke.lt(o)))throw Error(lo+"Argument "+(ke.isInteger()?"out of range: ":"not an integer: ")+ue(ke));if(!ot)return new I(Fe);for(Q=new I(o),ve=ne=new I(o),F=ge=new I(o),Ee=Vo(ot),J=Q.e=Ee.length-Fe.e-1,Q.c[0]=Om[(be=J%qn)<0?qn+be:be],$=!$||ke.comparedTo(Q)>0?J>0?Q:ve:ke,be=v,v=1/0,ke=new I(Ee),ge.c[0]=0;fe=e(ke,Q,0,1),Z=ne.plus(fe.times(F)),Z.comparedTo($)!=1;)ne=F,F=Z,ve=ge.plus(fe.times(Z=ve)),ge=Z,Q=ke.minus(fe.times(Z=Q)),ke=Z;return Z=e($.minus(ne),F,0,1),ge=ge.plus(Z.times(ve)),ne=ne.plus(Z.times(F)),ge.s=ve.s=Fe.s,J=J*2,Pe=e(ve,F,J,a).minus(Fe).abs().comparedTo(e(ge,ne,J,a).minus(Fe).abs())<1?[ve,F]:[ge,ne],v=be,Pe},i.toNumber=function(){return+ue(this)},i.toPrecision=function($,Q){return $!=null&&Qr($,1,Eo),U(this,$,Q,2)},i.toString=function($){var Q,ne=this,F=ne.s,Z=ne.e;return Z===null?F?(Q="Infinity",F<0&&(Q="-"+Q)):Q="NaN":($==null?Q=Z<=d||Z>=m?bd(Vo(ne.c),Z):Ws(Vo(ne.c),Z,"0"):$===10&&D?(ne=X(new I(ne),u+Z+1,a),Q=Ws(Vo(ne.c),ne.e,"0")):(Qr($,2,P.length,"Base"),Q=t(Ws(Vo(ne.c),Z,"0"),10,$,F,!0)),F<0&&ne.c[0]&&(Q="-"+Q)),Q},i.valueOf=i.toJSON=function(){return ue(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,r!=null&&I.set(r),I}function Zo(r){var e=r|0;return r>0||r===e?e:e-1}function Vo(r){for(var e,t,n=1,i=r.length,o=r[0]+"";n<i;){for(e=r[n++]+"",t=qn-e.length;t--;e="0"+e);o+=e}for(i=o.length;o.charCodeAt(--i)===48;);return o.slice(0,i+1||1)}function yl(r,e){var t,n,i=r.c,o=e.c,u=r.s,a=e.s,d=r.e,m=e.e;if(!u||!a)return null;if(t=i&&!i[0],n=o&&!o[0],t||n)return t?n?0:-a:u;if(u!=a)return u;if(t=u<0,n=d==m,!i||!o)return n?0:!i^t?1:-1;if(!n)return d>m^t?1:-1;for(a=(d=i.length)<(m=o.length)?d:m,u=0;u<a;u++)if(i[u]!=o[u])return i[u]>o[u]^t?1:-1;return d==m?0:d>m^t?1:-1}function Qr(r,e,t,n){if(r<e||r>t||r!==Go(r))throw Error(lo+(n||"Argument")+(typeof r=="number"?r<e||r>t?" out of range: ":" not an integer: ":" not a primitive number: ")+String(r))}function yd(r){var e=r.c.length-1;return Zo(r.e/qn)==e&&r.c[e]%2!=0}function bd(r,e){return(r.length>1?r.charAt(0)+"."+r.slice(1):r)+(e<0?"e":"e+")+e}function Ws(r,e,t){var n,i;if(e<0){for(i=t+".";++e;i+=t);r=i+r}else if(n=r.length,++e>n){for(i=t,e-=n;--e;i+=t);r+=i}else e<n&&(r=r.slice(0,e)+"."+r.slice(e));return r}var Cs=I2(),_M=class{constructor(r){kn(this,"key"),kn(this,"left",null),kn(this,"right",null),this.key=r}},pf=class extends _M{constructor(r){super(r)}},yM=class{constructor(){kn(this,"size",0),kn(this,"modificationCount",0),kn(this,"splayCount",0)}splay(r){const e=this.root;if(e==null)return this.compare(r,r),-1;let t=null,n=null,i=null,o=null,u=e;const a=this.compare;let d;for(;;)if(d=a(u.key,r),d>0){let m=u.left;if(m==null||(d=a(m.key,r),d>0&&(u.left=m.right,m.right=u,u=m,m=u.left,m==null)))break;t==null?n=u:t.left=u,t=u,u=m}else if(d<0){let m=u.right;if(m==null||(d=a(m.key,r),d<0&&(u.right=m.left,m.left=u,u=m,m=u.right,m==null)))break;i==null?o=u:i.right=u,i=u,u=m}else break;return i!=null&&(i.right=u.left,u.left=o),t!=null&&(t.left=u.right,u.right=n),this.root!==u&&(this.root=u,this.splayCount++),d}splayMin(r){let e=r,t=e.left;for(;t!=null;){const n=t;e.left=n.right,n.right=e,e=n,t=e.left}return e}splayMax(r){let e=r,t=e.right;for(;t!=null;){const n=t;e.right=n.left,n.left=e,e=n,t=e.right}return e}_delete(r){if(this.root==null||this.splay(r)!=0)return null;let e=this.root;const t=e,n=e.left;if(this.size--,n==null)this.root=e.right;else{const i=e.right;e=this.splayMax(n),e.right=i,this.root=e}return this.modificationCount++,t}addNewRoot(r,e){this.size++,this.modificationCount++;const t=this.root;if(t==null){this.root=r;return}e<0?(r.left=t,r.right=t.right,t.right=null):(r.right=t,r.left=t.left,t.left=null),this.root=r}_first(){const r=this.root;return r==null?null:(this.root=this.splayMin(r),this.root)}_last(){const r=this.root;return r==null?null:(this.root=this.splayMax(r),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(r){return this.validKey(r)&&this.splay(r)==0}defaultCompare(){return(r,e)=>r<e?-1:r>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:r=>{this.root=r},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:r=>{this.splayCount=r},splay:r=>this.splay(r),has:r=>this.has(r)}}},w1,x1,Xd=class xf extends yM{constructor(e,t){super(),kn(this,"root",null),kn(this,"compare"),kn(this,"validKey"),kn(this,w1,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=t??(n=>n!=null&&n!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let n;for(;n=t.next(),!n.done;)e(n.value,n.value,this)}add(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new pf(e),t),this}addAndReturn(e){const t=this.splay(e);return t!=0&&this.addNewRoot(new pf(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let t=this.root.left;if(t==null)return null;let n=t.right;for(;n!=null;)t=n,n=t.right;return t.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let t=this.root.right;if(t==null)return null;let n=t.left;for(;n!=null;)t=n,n=t.left;return t.key}retainAll(e){const t=new xf(this.compare,this.validKey),n=this.modificationCount;for(const i of e){if(n!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(i)&&this.splay(i)==0&&t.add(this.root.key)}t.size!=this.size&&(this.root=t.root,this.size=t.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const t=new xf(this.compare,this.validKey);for(const n of this)e.has(n)&&t.add(n);return t}difference(e){const t=new xf(this.compare,this.validKey);for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=this.clone();return t.addAll(e),t}clone(){const e=new xf(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function t(i,o){let u,a;do{if(u=i.left,a=i.right,u!=null){const d=new pf(u.key);o.left=d,t(u,d)}if(a!=null){const d=new pf(a.key);o.right=d,i=a,o=d}}while(a!=null)}const n=new pf(e.key);return t(e,n),n}toSet(){return this.clone()}entries(){return new vM(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(x1=Symbol.iterator,w1=Symbol.toStringTag,x1)](){return new bM(this.wrap())}},L2=class{constructor(r){kn(this,"tree"),kn(this,"path",new Array),kn(this,"modificationCount",null),kn(this,"splayCount"),this.tree=r,this.splayCount=r.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const r=this.path[this.path.length-1];return this.getValue(r)}rebuildPath(r){this.path.splice(0,this.path.length),this.tree.splay(r),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(r){for(;r!=null;)this.path.push(r),r=r.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let t=this.tree.getRoot();for(;t!=null;)this.path.push(t),t=t.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let r=this.path[this.path.length-1],e=r.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===r;)r=this.path.pop();return this.path.length>0}},bM=class extends L2{getValue(r){return r.key}},vM=class extends L2{getValue(r){return[r.key,r.key]}},P2=r=>()=>r,pg=r=>{const e=r?(t,n)=>n.minus(t).abs().isLessThanOrEqualTo(r):P2(!1);return(t,n)=>e(t,n)?0:t.comparedTo(n)};function wM(r){const e=r?(t,n,i,o,u)=>t.exponentiatedBy(2).isLessThanOrEqualTo(o.minus(n).exponentiatedBy(2).plus(u.minus(i).exponentiatedBy(2)).times(r)):P2(!1);return(t,n,i)=>{const o=t.x,u=t.y,a=i.x,d=i.y,m=u.minus(d).times(n.x.minus(a)).minus(o.minus(a).times(n.y.minus(d)));return e(m,o,u,a,d)?0:m.comparedTo(0)}}var xM=r=>r,AM=r=>{if(r){const e=new Xd(pg(r)),t=new Xd(pg(r)),n=(o,u)=>u.addAndReturn(o),i=o=>({x:n(o.x,e),y:n(o.y,t)});return i({x:new Cs(0),y:new Cs(0)}),i}return xM},mg=r=>({set:e=>{ea=mg(e)},reset:()=>mg(r),compare:pg(r),snap:AM(r),orient:wM(r)}),ea=mg(),mf=(r,e)=>r.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(r.ur.x)&&r.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(r.ur.y),gg=(r,e)=>{if(e.ur.x.isLessThan(r.ll.x)||r.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(r.ll.y)||r.ur.y.isLessThan(e.ll.y))return null;const t=r.ll.x.isLessThan(e.ll.x)?e.ll.x:r.ll.x,n=r.ur.x.isLessThan(e.ur.x)?r.ur.x:e.ur.x,i=r.ll.y.isLessThan(e.ll.y)?e.ll.y:r.ll.y,o=r.ur.y.isLessThan(e.ur.y)?r.ur.y:e.ur.y;return{ll:{x:t,y:i},ur:{x:n,y:o}}},zd=(r,e)=>r.x.times(e.y).minus(r.y.times(e.x)),z2=(r,e)=>r.x.times(e.x).plus(r.y.times(e.y)),Jd=r=>z2(r,r).sqrt(),kM=(r,e,t)=>{const n={x:e.x.minus(r.x),y:e.y.minus(r.y)},i={x:t.x.minus(r.x),y:t.y.minus(r.y)};return zd(i,n).div(Jd(i)).div(Jd(n))},SM=(r,e,t)=>{const n={x:e.x.minus(r.x),y:e.y.minus(r.y)},i={x:t.x.minus(r.x),y:t.y.minus(r.y)};return z2(i,n).div(Jd(i)).div(Jd(n))},A1=(r,e,t)=>e.y.isZero()?null:{x:r.x.plus(e.x.div(e.y).times(t.minus(r.y))),y:t},k1=(r,e,t)=>e.x.isZero()?null:{x:t,y:r.y.plus(e.y.div(e.x).times(t.minus(r.x)))},TM=(r,e,t,n)=>{if(e.x.isZero())return k1(t,n,r.x);if(n.x.isZero())return k1(r,e,t.x);if(e.y.isZero())return A1(t,n,r.y);if(n.y.isZero())return A1(r,e,t.y);const i=zd(e,n);if(i.isZero())return null;const o={x:t.x.minus(r.x),y:t.y.minus(r.y)},u=zd(o,e).div(i),a=zd(o,n).div(i),d=r.x.plus(a.times(e.x)),m=t.x.plus(u.times(n.x)),_=r.y.plus(a.times(e.y)),v=t.y.plus(u.times(n.y)),S=d.plus(m).div(2),T=_.plus(v).div(2);return{x:S,y:T}},Ss=class D2{constructor(e,t){kn(this,"point"),kn(this,"isLeft"),kn(this,"segment"),kn(this,"otherSE"),kn(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}static compare(e,t){const n=D2.comparePoints(e.point,t.point);return n!==0?n:(e.point!==t.point&&e.link(t),e.isLeft!==t.isLeft?e.isLeft?1:-1:Yd.compare(e.segment,t.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let n=0,i=t.length;n<i;n++){const o=t[n];this.point.events.push(o),o.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(n.segment.consumedBy===void 0)for(let i=t+1;i<e;i++){const o=this.point.events[i];o.consumedBy===void 0&&n.otherSE.point.events===o.otherSE.point.events&&n.segment.consume(o.segment)}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const i=this.point.events[t];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const t=new Map,n=i=>{const o=i.otherSE;t.set(i,{sine:kM(this.point,e.point,o.point),cosine:SM(this.point,e.point,o.point)})};return(i,o)=>{t.has(i)||n(i),t.has(o)||n(o);const{sine:u,cosine:a}=t.get(i),{sine:d,cosine:m}=t.get(o);return u.isGreaterThanOrEqualTo(0)&&d.isGreaterThanOrEqualTo(0)?a.isLessThan(m)?1:a.isGreaterThan(m)?-1:0:u.isLessThan(0)&&d.isLessThan(0)?a.isLessThan(m)?-1:a.isGreaterThan(m)?1:0:d.isLessThan(u)?-1:d.isGreaterThan(u)?1:0}}},CM=class _g{constructor(e){kn(this,"events"),kn(this,"poly"),kn(this,"_isExteriorRing"),kn(this,"_enclosingRing"),this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}static factory(e){const t=[];for(let n=0,i=e.length;n<i;n++){const o=e[n];if(!o.isInResult()||o.ringOut)continue;let u=null,a=o.leftSE,d=o.rightSE;const m=[a],_=a.point,v=[];for(;u=a,a=d,m.push(a),a.point!==_;)for(;;){const S=a.getAvailableLinkedEvents();if(S.length===0){const L=m[0].point,P=m[m.length-1].point;throw new Error(`Unable to complete output ring starting at [${L.x}, ${L.y}]. Last matching segment found ends at [${P.x}, ${P.y}].`)}if(S.length===1){d=S[0].otherSE;break}let T=null;for(let L=0,P=v.length;L<P;L++)if(v[L].point===a.point){T=L;break}if(T!==null){const L=v.splice(T)[0],P=m.splice(L.index);P.unshift(P[0].otherSE),t.push(new _g(P.reverse()));continue}v.push({index:m.length,point:a.point});const C=a.getLeftmostComparator(u);d=S.sort(C)[0].otherSE;break}t.push(new _g(m))}return t}getGeom(){let e=this.events[0].point;const t=[e];for(let m=1,_=this.events.length-1;m<_;m++){const v=this.events[m].point,S=this.events[m+1].point;ea.orient(v,e,S)!==0&&(t.push(v),e=v)}if(t.length===1)return null;const n=t[0],i=t[1];ea.orient(n,e,i)===0&&t.shift(),t.push(t[0]);const o=this.isExteriorRing()?1:-1,u=this.isExteriorRing()?0:t.length-1,a=this.isExteriorRing()?t.length:-1,d=[];for(let m=u;m!=a;m+=o)d.push([t[m].x.toNumber(),t[m].y.toNumber()]);return d}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var e,t;let n=this.events[0];for(let u=1,a=this.events.length;u<a;u++){const d=this.events[u];Ss.compare(n,d)>0&&(n=d)}let i=n.segment.prevInResult(),o=i?i.prevInResult():null;for(;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return((e=o.ringOut)==null?void 0:e.enclosingRing())!==i.ringOut?i.ringOut:(t=i.ringOut)==null?void 0:t.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}},S1=class{constructor(r){kn(this,"exteriorRing"),kn(this,"interiorRings"),this.exteriorRing=r,r.poly=this,this.interiorRings=[]}addInterior(r){this.interiorRings.push(r),r.poly=this}getGeom(){const r=this.exteriorRing.getGeom();if(r===null)return null;const e=[r];for(let t=0,n=this.interiorRings.length;t<n;t++){const i=this.interiorRings[t].getGeom();i!==null&&e.push(i)}return e}},MM=class{constructor(r){kn(this,"rings"),kn(this,"polys"),this.rings=r,this.polys=this._composePolys(r)}getGeom(){const r=[];for(let e=0,t=this.polys.length;e<t;e++){const n=this.polys[e].getGeom();n!==null&&r.push(n)}return r}_composePolys(r){var e;const t=[];for(let n=0,i=r.length;n<i;n++){const o=r[n];if(!o.poly)if(o.isExteriorRing())t.push(new S1(o));else{const u=o.enclosingRing();u!=null&&u.poly||t.push(new S1(u)),(e=u==null?void 0:u.poly)==null||e.addInterior(o)}}return t}},EM=class{constructor(r,e=Yd.compare){kn(this,"queue"),kn(this,"tree"),kn(this,"segments"),this.queue=r,this.tree=new Xd(e),this.segments=[]}process(r){const e=r.segment,t=[];if(r.consumedBy)return r.isLeft?this.queue.delete(r.otherSE):this.tree.delete(e),t;r.isLeft&&this.tree.add(e);let n=e,i=e;do n=this.tree.lastBefore(n);while(n!=null&&n.consumedBy!=null);do i=this.tree.firstAfter(i);while(i!=null&&i.consumedBy!=null);if(r.isLeft){let o=null;if(n){const a=n.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(o=a),!n.isAnEndpoint(a))){const d=this._splitSafely(n,a);for(let m=0,_=d.length;m<_;m++)t.push(d[m])}}let u=null;if(i){const a=i.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(u=a),!i.isAnEndpoint(a))){const d=this._splitSafely(i,a);for(let m=0,_=d.length;m<_;m++)t.push(d[m])}}if(o!==null||u!==null){let a=null;o===null?a=u:u===null?a=o:a=Ss.comparePoints(o,u)<=0?o:u,this.queue.delete(e.rightSE),t.push(e.rightSE);const d=e.split(a);for(let m=0,_=d.length;m<_;m++)t.push(d[m])}t.length>0?(this.tree.delete(e),t.push(r)):(this.segments.push(e),e.prev=n)}else{if(n&&i){const o=n.getIntersection(i);if(o!==null){if(!n.isAnEndpoint(o)){const u=this._splitSafely(n,o);for(let a=0,d=u.length;a<d;a++)t.push(u[a])}if(!i.isAnEndpoint(o)){const u=this._splitSafely(i,o);for(let a=0,d=u.length;a<d;a++)t.push(u[a])}}}this.tree.delete(e)}return t}_splitSafely(r,e){this.tree.delete(r);const t=r.rightSE;this.queue.delete(t);const n=r.split(e);return n.push(t),r.consumedBy===void 0&&this.tree.add(r),n}},IM=class{constructor(){kn(this,"type"),kn(this,"numMultiPolys")}run(r,e,t){Af.type=r;const n=[new C1(e,!0)];for(let d=0,m=t.length;d<m;d++)n.push(new C1(t[d],!1));if(Af.numMultiPolys=n.length,Af.type==="difference"){const d=n[0];let m=1;for(;m<n.length;)gg(n[m].bbox,d.bbox)!==null?m++:n.splice(m,1)}if(Af.type==="intersection")for(let d=0,m=n.length;d<m;d++){const _=n[d];for(let v=d+1,S=n.length;v<S;v++)if(gg(_.bbox,n[v].bbox)===null)return[]}const i=new Xd(Ss.compare);for(let d=0,m=n.length;d<m;d++){const _=n[d].getSweepEvents();for(let v=0,S=_.length;v<S;v++)i.add(_[v])}const o=new EM(i);let u=null;for(i.size!=0&&(u=i.first(),i.delete(u));u;){const d=o.process(u);for(let m=0,_=d.length;m<_;m++){const v=d[m];v.consumedBy===void 0&&i.add(v)}i.size!=0?(u=i.first(),i.delete(u)):u=null}ea.reset();const a=CM.factory(o.segments);return new MM(a).getGeom()}},Af=new IM,Kd=Af,LM=0,Yd=class Dd{constructor(e,t,n,i){kn(this,"id"),kn(this,"leftSE"),kn(this,"rightSE"),kn(this,"rings"),kn(this,"windings"),kn(this,"ringOut"),kn(this,"consumedBy"),kn(this,"prev"),kn(this,"_prevInResult"),kn(this,"_beforeState"),kn(this,"_afterState"),kn(this,"_isInResult"),this.id=++LM,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=i}static compare(e,t){const n=e.leftSE.point.x,i=t.leftSE.point.x,o=e.rightSE.point.x,u=t.rightSE.point.x;if(u.isLessThan(n))return 1;if(o.isLessThan(i))return-1;const a=e.leftSE.point.y,d=t.leftSE.point.y,m=e.rightSE.point.y,_=t.rightSE.point.y;if(n.isLessThan(i)){if(d.isLessThan(a)&&d.isLessThan(m))return 1;if(d.isGreaterThan(a)&&d.isGreaterThan(m))return-1;const v=e.comparePoint(t.leftSE.point);if(v<0)return 1;if(v>0)return-1;const S=t.comparePoint(e.rightSE.point);return S!==0?S:-1}if(n.isGreaterThan(i)){if(a.isLessThan(d)&&a.isLessThan(_))return-1;if(a.isGreaterThan(d)&&a.isGreaterThan(_))return 1;const v=t.comparePoint(e.leftSE.point);if(v!==0)return v;const S=e.comparePoint(t.rightSE.point);return S<0?1:S>0?-1:1}if(a.isLessThan(d))return-1;if(a.isGreaterThan(d))return 1;if(o.isLessThan(u)){const v=t.comparePoint(e.rightSE.point);if(v!==0)return v}if(o.isGreaterThan(u)){const v=e.comparePoint(t.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(!o.eq(u)){const v=m.minus(a),S=o.minus(n),T=_.minus(d),C=u.minus(i);if(v.isGreaterThan(S)&&T.isLessThan(C))return 1;if(v.isLessThan(S)&&T.isGreaterThan(C))return-1}return o.isGreaterThan(u)?1:o.isLessThan(u)||m.isLessThan(_)?-1:m.isGreaterThan(_)?1:e.id<t.id?-1:e.id>t.id?1:0}static fromRing(e,t,n){let i,o,u;const a=Ss.comparePoints(e,t);if(a<0)i=e,o=t,u=1;else if(a>0)i=t,o=e,u=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const d=new Ss(i,!0),m=new Ss(o,!1);return new Dd(d,m,[n],[u])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return ea.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),n=e.bbox(),i=gg(t,n);if(i===null)return null;const o=this.leftSE.point,u=this.rightSE.point,a=e.leftSE.point,d=e.rightSE.point,m=mf(t,a)&&this.comparePoint(a)===0,_=mf(n,o)&&e.comparePoint(o)===0,v=mf(t,d)&&this.comparePoint(d)===0,S=mf(n,u)&&e.comparePoint(u)===0;if(_&&m)return S&&!v?u:!S&&v?d:null;if(_)return v&&o.x.eq(d.x)&&o.y.eq(d.y)?null:o;if(m)return S&&u.x.eq(a.x)&&u.y.eq(a.y)?null:a;if(S&&v)return null;if(S)return u;if(v)return d;const T=TM(o,this.vector(),a,e.vector());return T===null||!mf(i,T)?null:ea.snap(T)}split(e){const t=[],n=e.events!==void 0,i=new Ss(e,!0),o=new Ss(e,!1),u=this.rightSE;this.replaceRightSE(o),t.push(o),t.push(i);const a=new Dd(i,u,this.rings.slice(),this.windings.slice());return Ss.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),Ss.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),n&&(i.checkForConsuming(),o.checkForConsuming()),t}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}consume(e){let t=this,n=e;for(;t.consumedBy;)t=t.consumedBy;for(;n.consumedBy;)n=n.consumedBy;const i=Dd.compare(t,n);if(i!==0){if(i>0){const o=t;t=n,n=o}if(t.prev===n){const o=t;t=n,n=o}for(let o=0,u=n.rings.length;o<u;o++){const a=n.rings[o],d=n.windings[o],m=t.rings.indexOf(a);m===-1?(t.rings.push(a),t.windings.push(d)):t.windings[m]+=d}n.rings=null,n.windings=null,n.consumedBy=t,n.leftSE.consumedBy=t.leftSE,n.rightSE.consumedBy=t.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,d=this.rings.length;a<d;a++){const m=this.rings[a],_=this.windings[a],v=t.indexOf(m);v===-1?(t.push(m),n.push(_)):n[v]+=_}const o=[],u=[];for(let a=0,d=t.length;a<d;a++){if(n[a]===0)continue;const m=t[a],_=m.poly;if(u.indexOf(_)===-1)if(m.isExterior)o.push(_);else{u.indexOf(_)===-1&&u.push(_);const v=o.indexOf(m.poly);v!==-1&&o.splice(v,1)}}for(let a=0,d=o.length;a<d;a++){const m=o[a].multiPoly;i.indexOf(m)===-1&&i.push(m)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Kd.type){case"union":{const n=e.length===0,i=t.length===0;this._isInResult=n!==i;break}case"intersection":{let n,i;e.length<t.length?(n=e.length,i=t.length):(n=t.length,i=e.length),this._isInResult=i===Kd.numMultiPolys&&n<i;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2===1;break}case"difference":{const n=i=>i.length===1&&i[0].isSubject;this._isInResult=n(e)!==n(t);break}}return this._isInResult}},T1=class{constructor(r,e,t){if(kn(this,"poly"),kn(this,"isExterior"),kn(this,"segments"),kn(this,"bbox"),!Array.isArray(r)||r.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=t,this.segments=[],typeof r[0][0]!="number"||typeof r[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=ea.snap({x:new Cs(r[0][0]),y:new Cs(r[0][1])});this.bbox={ll:{x:n.x,y:n.y},ur:{x:n.x,y:n.y}};let i=n;for(let o=1,u=r.length;o<u;o++){if(typeof r[o][0]!="number"||typeof r[o][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=ea.snap({x:new Cs(r[o][0]),y:new Cs(r[o][1])});a.x.eq(i.x)&&a.y.eq(i.y)||(this.segments.push(Yd.fromRing(i,a,this)),a.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.x),a.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.y),a.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.x),a.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.y),i=a)}(!n.x.eq(i.x)||!n.y.eq(i.y))&&this.segments.push(Yd.fromRing(i,n,this))}getSweepEvents(){const r=[];for(let e=0,t=this.segments.length;e<t;e++){const n=this.segments[e];r.push(n.leftSE),r.push(n.rightSE)}return r}},PM=class{constructor(r,e){if(kn(this,"multiPoly"),kn(this,"exteriorRing"),kn(this,"interiorRings"),kn(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new T1(r[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,n=r.length;t<n;t++){const i=new T1(r[t],this,!1);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=e}getSweepEvents(){const r=this.exteriorRing.getSweepEvents();for(let e=0,t=this.interiorRings.length;e<t;e++){const n=this.interiorRings[e].getSweepEvents();for(let i=0,o=n.length;i<o;i++)r.push(n[i])}return r}},C1=class{constructor(r,e){if(kn(this,"isSubject"),kn(this,"polys"),kn(this,"bbox"),!Array.isArray(r))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof r[0][0][0]=="number"&&(r=[r])}catch{}this.polys=[],this.bbox={ll:{x:new Cs(Number.POSITIVE_INFINITY),y:new Cs(Number.POSITIVE_INFINITY)},ur:{x:new Cs(Number.NEGATIVE_INFINITY),y:new Cs(Number.NEGATIVE_INFINITY)}};for(let t=0,n=r.length;t<n;t++){const i=new PM(r[t],this);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=e}getSweepEvents(){const r=[];for(let e=0,t=this.polys.length;e<t;e++){const n=this.polys[e].getSweepEvents();for(let i=0,o=n.length;i<o;i++)r.push(n[i])}return r}},zM=(r,...e)=>Kd.run("union",r,e),DM=(r,...e)=>Kd.run("difference",r,e);ea.set;function R2(r,e,t){if(r!==null)for(var n,i,o,u,a,d,m,_=0,v=0,S,T=r.type,C=T==="FeatureCollection",L=T==="Feature",P=C?r.features.length:1,D=0;D<P;D++){m=C?r.features[D].geometry:L?r.geometry:r,S=m?m.type==="GeometryCollection":!1,a=S?m.geometries.length:1;for(var I=0;I<a;I++){var U=0,O=0;if(u=S?m.geometries[I]:m,u!==null){d=u.coordinates;var ee=u.type;switch(_=0,ee){case null:break;case"Point":if(e(d,v,D,U,O)===!1)return!1;v++,U++;break;case"LineString":case"MultiPoint":for(n=0;n<d.length;n++){if(e(d[n],v,D,U,O)===!1)return!1;v++,ee==="MultiPoint"&&U++}ee==="LineString"&&U++;break;case"Polygon":case"MultiLineString":for(n=0;n<d.length;n++){for(i=0;i<d[n].length-_;i++){if(e(d[n][i],v,D,U,O)===!1)return!1;v++}ee==="MultiLineString"&&U++,ee==="Polygon"&&O++}ee==="Polygon"&&U++;break;case"MultiPolygon":for(n=0;n<d.length;n++){for(O=0,i=0;i<d[n].length;i++){for(o=0;o<d[n][i].length-_;o++){if(e(d[n][i][o],v,D,U,O)===!1)return!1;v++}O++}U++}break;case"GeometryCollection":for(n=0;n<u.geometries.length;n++)if(R2(u.geometries[n],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function s_(r,e){var t,n,i,o,u,a,d,m,_,v,S=0,T=r.type==="FeatureCollection",C=r.type==="Feature",L=T?r.features.length:1;for(t=0;t<L;t++){for(a=T?r.features[t].geometry:C?r.geometry:r,m=T?r.features[t].properties:C?r.properties:{},_=T?r.features[t].bbox:C?r.bbox:void 0,v=T?r.features[t].id:C?r.id:void 0,d=a?a.type==="GeometryCollection":!1,u=d?a.geometries.length:1,i=0;i<u;i++){if(o=d?a.geometries[i]:a,o===null){if(e(null,S,m,_,v)===!1)return!1;continue}switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(o,S,m,_,v)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<o.geometries.length;n++)if(e(o.geometries[n],S,m,_,v)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}S++}}function RM(r,e){s_(r,function(t,n,i,o,u){var a=t===null?null:t.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(qf(t,i,{bbox:o,id:u}),n,0)===!1?!1:void 0}var d;switch(a){case"MultiPoint":d="Point";break;case"MultiLineString":d="LineString";break;case"MultiPolygon":d="Polygon";break}for(var m=0;m<t.coordinates.length;m++){var _=t.coordinates[m],v={type:d,coordinates:_};if(e(qf(v,i),n,m)===!1)return!1}})}function BM(r,e={}){const t=[];if(s_(r,i=>{t.push(i.coordinates)}),t.length<2)throw new Error("Must have at least 2 geometries");const n=zM(t[0],...t.slice(1));return n.length===0?null:n.length===1?o_(n[0],e.properties):E2(n,e.properties)}var B2=BM;function FM(r,e={}){if(r.bbox!=null&&e.recompute!==!0)return r.bbox;const t=[1/0,1/0,-1/0,-1/0];return R2(r,n=>{t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}var M1=FM;function OM(r){const e=[];if(s_(r,i=>{e.push(i.coordinates)}),e.length<2)throw new Error("Must have at least two features");const t=r.features[0].properties||{},n=DM(e[0],...e.slice(1));return n.length===0?null:n.length===1?o_(n[0],t):E2(n,t)}var NM=OM;function $M(r){if(!r)throw new Error("geojson is required");var e=[];return RM(r,function(t){e.push(t)}),Gf(e)}var jM=$M;function E1(r,e){const t=NM(Gf([o_([[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]),r]));if(!t)return;t.properties={isMask:!0};const n=y1(M1(r)),i=(n[2]-n[0])/360/1e3,o=n[0]<-180,u=n[2]>180,a=jM(r);if(a.features.length>1&&(o||u))for(const d of a.features){const m=y1(M1(d));if(u&&m[0]<-180+i)for(const _ of d.geometry.coordinates)for(const v of _)v[0]+=360-i;if(o&&m[2]>180-i)for(const _ of d.geometry.coordinates)for(const v of _)v[0]-=360-i}e(Gf([a.features.length<2?r:B2(a)??r,t]))}const I1={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}},vd="mtlr-gc-full-geom",L1="mtlr-gc-full-geom-fill",P1="mtlr-gc-full-geom-line";function UM(r,e,t=!0,n=!0,i={},o={},u=I1){let a;const d=[];let m,_,v;function S(){if(!r.loaded){r.once("load",S);return}const P=u?u===!0?I1:u:void 0;if(!(P!=null&&P.fill)&&!(P!=null&&P.line))return;const D=r.getSource(vd);if(D)D.setData(v??Gf([]));else if(v)r.addSource(vd,{type:"geojson",data:v});else return;!r.getLayer(L1)&&P!=null&&P.fill&&r.addLayer({...P==null?void 0:P.fill,id:L1,type:"fill",source:vd}),!r.getLayer(P1)&&P!=null&&P.line&&r.addLayer({...P==null?void 0:P.line,id:P1,type:"line",source:vd})}function T(P){v=P,S()}r.on("styledata",()=>{setTimeout(()=>{v&&S()})});const C=P=>{a==null||a({type:"mapClick",coordinates:[P.lngLat.lng,P.lngLat.lat]})};function L(P=!1){if(!e)throw new Error;const D=document.createElement("div");return P&&D.classList.add("marker-interactive"),new uM({props:{displayIn:"maplibre"},target:D}),new e.Marker({element:D,offset:[1,-13]})}return{setEventHandler(P){P?(a=P,r.on("click",C)):(a=void 0,r.off("click",C))},flyTo(P,D){r.flyTo({center:P,...D?{zoom:D}:{},...i})},fitBounds(P,D,I){r.fitBounds([[P[0],P[1]],[P[2],P[3]]],{padding:D,...I?{maxZoom:I}:{},...o})},indicateReverse(P){r.getCanvasContainer().style.cursor=P?"crosshair":""},setReverseMarker(P){!e||!t||(_?P?_.setLngLat(P):(_.remove(),_=void 0):P&&(t instanceof Function?_=t(r)??void 0:(_=(typeof t=="object"?new e.Marker(t):L()).setLngLat(P).addTo(r),_.getElement().classList.add("marker-reverse"))))},setFeatures(P,D,I){for(const U of d)U.remove();if(d.length=0,T(void 0),!!e){e:if(D){let U=!1;if(D.geometry.type==="GeometryCollection"){const O=D.geometry.geometries.filter(ee=>ee.type==="Polygon"||ee.type==="MultiPolygon");t:if(O.length>0){const ee=B2(Gf(O.map(X=>qf(X))));if(!ee)break t;E1({...D,geometry:ee.geometry},T),U=!0}else{const ee=D.geometry.geometries.filter(X=>X.type==="LineString"||X.type==="MultiLineString");ee.length>0&&(T({...D,geometry:{type:"GeometryCollection",geometries:ee}}),U=!0)}}if(!U){if(D.geometry.type==="Polygon"||D.geometry.type==="MultiPolygon")E1(D,T);else if(D.geometry.type==="LineString"||D.geometry.type==="MultiLineString"){T(D);break e}}if(!I&&!D.geometry.type.endsWith("Point"))break e;if(t instanceof Function){const O=t(r,D);O&&d.push(O)}else t&&d.push(typeof t=="object"?new e.Marker(t):L().setLngLat(D.center).addTo(r))}if(n)for(const U of P??[]){if(U===D)continue;let O;if(n instanceof Function){if(O=n(r,U),!O)continue}else O=(typeof n=="object"?new e.Marker(n):L(!0)).setLngLat(U.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(U.place_type[0]==="reverse"?U.place_name:U.place_name.replace(/,.*/,""))).addTo(r);const ee=O.getElement();ee.addEventListener("click",X=>{X.stopPropagation(),a==null||a({type:"markerClick",id:U.id})}),ee.addEventListener("mouseenter",()=>{a==null||a({type:"markerMouseEnter",id:U.id}),O.togglePopup()}),ee.addEventListener("mouseleave",()=>{a==null||a({type:"markerMouseLeave",id:U.id}),O.togglePopup()}),d.push(O)}}},setSelectedMarker(P){m&&m.getElement().classList.toggle("marker-selected",!1),m=P>-1?d[P]:void 0,m==null||m.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const P=r.getCenter();return[r.getZoom(),P.lng,P.lat]}}}function VM(r){let e,t;return{c(){e=ds("svg"),t=ds("path"),ce(t,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),ce(e,"viewBox","0 0 14 14"),ce(e,"width","13"),ce(e,"height","13"),ce(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),z(e,t)},p:ht,i:ht,o:ht,d(n){n&&H(e)}}}class F2 extends kt{constructor(e){super(),St(this,e,null,VM,gt,{})}}function qM(r){let e,t;return{c(){e=ds("svg"),t=ds("path"),ce(t,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),ce(e,"viewBox","0 0 30 30"),ce(e,"fill","none"),ce(e,"xmlns","http://www.w3.org/2000/svg"),ce(e,"class","svelte-d2loi5")},m(n,i){W(n,e,i),z(e,t)},p:ht,i:ht,o:ht,d(n){n&&H(e)}}}class O2 extends kt{constructor(e){super(),St(this,e,null,qM,gt,{})}}function GM(r){let e,t;return{c(){e=q("img"),Or(e.src,t=r[3]+"area.svg")||ce(e,"src",t),ce(e,"alt",r[7]),ce(e,"title",r[7]),ce(e,"class","svelte-w9y5n9")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Or(e.src,t=n[3]+"area.svg")&&ce(e,"src",t),i&128&&ce(e,"alt",n[7]),i&128&&ce(e,"title",n[7])},d(n){n&&H(e)}}}function ZM(r){let e,t;return{c(){e=q("img"),Or(e.src,t=r[3]+"reverse.svg")||ce(e,"src",t),ce(e,"alt",r[7]),ce(e,"title",r[7]),ce(e,"class","svelte-w9y5n9")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Or(e.src,t=n[3]+"reverse.svg")&&ce(e,"src",t),i&128&&ce(e,"alt",n[7]),i&128&&ce(e,"title",n[7])},d(n){n&&H(e)}}}function HM(r){let e,t;return{c(){e=q("img"),Or(e.src,t=r[3]+"poi.svg")||ce(e,"src",t),ce(e,"alt",r[7]),ce(e,"title",r[7]),ce(e,"class","svelte-w9y5n9")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Or(e.src,t=n[3]+"poi.svg")&&ce(e,"src",t),i&128&&ce(e,"alt",n[7]),i&128&&ce(e,"title",n[7])},d(n){n&&H(e)}}}function WM(r){let e,t;return{c(){e=q("img"),Or(e.src,t=r[3]+"postal_code.svg")||ce(e,"src",t),ce(e,"alt",r[7]),ce(e,"title",r[7]),ce(e,"class","svelte-w9y5n9")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Or(e.src,t=n[3]+"postal_code.svg")&&ce(e,"src",t),i&128&&ce(e,"alt",n[7]),i&128&&ce(e,"title",n[7])},d(n){n&&H(e)}}}function XM(r){let e,t;return{c(){e=q("img"),Or(e.src,t=r[3]+"street.svg")||ce(e,"src",t),ce(e,"alt",r[7]),ce(e,"title",r[7]),ce(e,"class","svelte-w9y5n9")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Or(e.src,t=n[3]+"street.svg")&&ce(e,"src",t),i&128&&ce(e,"alt",n[7]),i&128&&ce(e,"title",n[7])},d(n){n&&H(e)}}}function JM(r){let e,t;return{c(){e=q("img"),Or(e.src,t=r[3]+"road.svg")||ce(e,"src",t),ce(e,"alt",r[7]),ce(e,"title",r[7]),ce(e,"class","svelte-w9y5n9")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Or(e.src,t=n[3]+"road.svg")&&ce(e,"src",t),i&128&&ce(e,"alt",n[7]),i&128&&ce(e,"title",n[7])},d(n){n&&H(e)}}}function KM(r){let e,t;return{c(){e=q("img"),Or(e.src,t=r[3]+"housenumber.svg")||ce(e,"src",t),ce(e,"alt",r[7]),ce(e,"title",r[7]),ce(e,"class","svelte-w9y5n9")},m(n,i){W(n,e,i)},p(n,i){i&8&&!Or(e.src,t=n[3]+"housenumber.svg")&&ce(e,"src",t),i&128&&ce(e,"alt",n[7]),i&128&&ce(e,"title",n[7])},d(n){n&&H(e)}}}function YM(r){let e,t,n,i;return{c(){e=q("img"),Or(e.src,t=r[5])||ce(e,"src",t),ce(e,"alt",r[4]),ce(e,"title",r[7]),ce(e,"class","svelte-w9y5n9")},m(o,u){W(o,e,u),n||(i=_t(e,"error",r[14]),n=!0)},p(o,u){u&32&&!Or(e.src,t=o[5])&&ce(e,"src",t),u&16&&ce(e,"alt",o[4]),u&128&&ce(e,"title",o[7])},d(o){o&&H(e),n=!1,i()}}}function QM(r){let e,t;return{c(){e=q("div"),ce(e,"class","sprite-icon svelte-w9y5n9"),ce(e,"style",t=`
        width: ${r[6].width/qo}px;
        height: ${r[6].height/qo}px;
        background-image: url(${r[3]}sprite${yg}.png);
        background-position: -${r[6].x/qo}px -${r[6].y/qo}px;
        background-size: ${ls.width/qo}px ${ls.height/qo}px;
      `),ce(e,"title",r[7])},m(n,i){W(n,e,i)},p(n,i){i&72&&t!==(t=`
        width: ${n[6].width/qo}px;
        height: ${n[6].height/qo}px;
        background-image: url(${n[3]}sprite${yg}.png);
        background-position: -${n[6].x/qo}px -${n[6].y/qo}px;
        background-size: ${ls.width/qo}px ${ls.height/qo}px;
      `)&&ce(e,"style",t),i&128&&ce(e,"title",n[7])},d(n){n&&H(e)}}}function z1(r){let e,t;return{c(){e=q("span"),t=Te(r[7]),ce(e,"class","secondary svelte-w9y5n9")},m(n,i){W(n,e,i),z(e,t)},p(n,i){i&128&&yt(t,n[7])},d(n){n&&H(e)}}}function eE(r){let e,t,n,i,o,u,a,d,m,_=(r[8]?r[0].place_name:r[0].place_name.replace(/,.*/,""))+"",v,S,T=r[2]==="always"||r[2]!=="never"&&!r[0].address&&!r[0].id.startsWith("road.")&&!r[0].id.startsWith("address.")&&!r[0].id.startsWith("postal_code.")&&(!r[0].id.startsWith("poi.")||!r[5])&&!r[8],C,L,P=(r[8]?"":r[0].place_name.replace(/[^,]*,?\s*/,""))+"",D,I,U,O,ee,X;function ue(F,Z){return Z&1&&(t=null),Z&1&&(n=null),Z&1&&(i=null),Z&1&&(o=null),ls&&F[6]?QM:F[5]?YM:F[0].address?KM:(t==null&&(t=!!F[0].id.startsWith("road.")),t?JM:(n==null&&(n=!!F[0].id.startsWith("address.")),n?XM:(i==null&&(i=!!F[0].id.startsWith("postal_code.")),i?WM:(o==null&&(o=!!F[0].id.startsWith("poi.")),o?HM:F[8]?ZM:GM))))}let $=ue(r,-1),Q=$(r),ne=T&&z1(r);return{c(){e=q("li"),Q.c(),u=ae(),a=q("span"),d=q("span"),m=q("span"),v=Te(_),S=ae(),ne&&ne.c(),C=ae(),L=q("span"),D=Te(P),ce(m,"class","primary svelte-w9y5n9"),ce(d,"class","svelte-w9y5n9"),ce(L,"class","line2 svelte-w9y5n9"),ce(a,"class","texts svelte-w9y5n9"),ce(e,"tabindex","-1"),ce(e,"role","option"),ce(e,"aria-selected",I=r[1]==="selected"),ce(e,"aria-checked",U=r[1]==="picked"),ce(e,"class",O=Oa(r[1])+" svelte-w9y5n9")},m(F,Z){W(F,e,Z),Q.m(e,null),z(e,u),z(e,a),z(a,d),z(d,m),z(m,v),z(d,S),ne&&ne.m(d,null),z(a,C),z(a,L),z(L,D),ee||(X=[_t(e,"mouseenter",r[13]),_t(e,"focus",r[15]),_t(e,"click",r[16])],ee=!0)},p(F,[Z]){$===($=ue(F,Z))&&Q?Q.p(F,Z):(Q.d(1),Q=$(F),Q&&(Q.c(),Q.m(e,u))),Z&257&&_!==(_=(F[8]?F[0].place_name:F[0].place_name.replace(/,.*/,""))+"")&&yt(v,_),Z&293&&(T=F[2]==="always"||F[2]!=="never"&&!F[0].address&&!F[0].id.startsWith("road.")&&!F[0].id.startsWith("address.")&&!F[0].id.startsWith("postal_code.")&&(!F[0].id.startsWith("poi.")||!F[5])&&!F[8]),T?ne?ne.p(F,Z):(ne=z1(F),ne.c(),ne.m(d,null)):ne&&(ne.d(1),ne=null),Z&257&&P!==(P=(F[8]?"":F[0].place_name.replace(/[^,]*,?\s*/,""))+"")&&yt(D,P),Z&2&&I!==(I=F[1]==="selected")&&ce(e,"aria-selected",I),Z&2&&U!==(U=F[1]==="picked")&&ce(e,"aria-checked",U),Z&2&&O!==(O=Oa(F[1])+" svelte-w9y5n9")&&ce(e,"class",O)},i:ht,o:ht,d(F){F&&H(e),Q.d(),ne&&ne.d(),ee=!1,Er(X)}}}const N2=typeof devicePixelRatio>"u"?1:devicePixelRatio>1.25,yg=N2?"@2x":"",qo=N2?2:1;let ls,wd;function tE(r,e,t){let n,i,o,{feature:u}=e,{style:a="default"}=e,{showPlaceType:d}=e,{missingIconsCache:m}=e,{iconsBaseUrl:_}=e;const v=ps();let S,T,C,L;function P(){wd??(wd=fetch(`${_}sprite${yg}.json`).then($=>$.json()).then($=>{ls=$}).catch(()=>{ls=null}))}function D(){T&&m.add(T),I()}function I(){ls!==void 0?U():(P(),wd==null||wd.then(U))}function U(){do{if(L--,t(4,S=n==null?void 0:n[L]),t(6,C=S?ls==null?void 0:ls.icons[S]:void 0),C)break;t(5,T=S?_+S.replace(/ /g,"_")+".svg":void 0)}while(L>-1&&(!T||m.has(T)))}function O($){Pn.call(this,r,$)}const ee=()=>D(),X=()=>v("select",void 0),ue=$=>{document.activeElement!==$.target&&v("select",void 0)};return r.$$set=$=>{"feature"in $&&t(0,u=$.feature),"style"in $&&t(1,a=$.style),"showPlaceType"in $&&t(2,d=$.showPlaceType),"missingIconsCache"in $&&t(11,m=$.missingIconsCache),"iconsBaseUrl"in $&&t(3,_=$.iconsBaseUrl)},r.$$.update=()=>{var $,Q,ne,F,Z;r.$$.dirty&1&&t(12,n=($=u.properties)==null?void 0:$.categories),r.$$.dirty&1&&t(8,i=u.place_type[0]==="reverse"),r.$$.dirty&1&&t(7,o=((ne=(Q=u.properties)==null?void 0:Q.categories)==null?void 0:ne.join(", "))??((Z=(F=u.properties)==null?void 0:F.place_type_name)==null?void 0:Z[0])??u.place_type[0]),r.$$.dirty&4096&&(L=(n==null?void 0:n.length)??0,I())},[u,a,d,_,S,T,C,o,i,v,D,m,n,O,ee,X,ue]}class nE extends kt{constructor(e){super(),St(this,e,tE,eE,gt,{feature:0,style:1,showPlaceType:2,missingIconsCache:11,iconsBaseUrl:3})}}function rE(r){let e;return{c(){e=q("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="loading-icon svelte-1ocfouu"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',ce(e,"class","svelte-1ocfouu")},m(t,n){W(t,e,n)},p:ht,i:ht,o:ht,d(t){t&&H(e)}}}class iE extends kt{constructor(e){super(),St(this,e,null,rE,gt,{})}}function oE(r){let e,t;return{c(){e=ds("svg"),t=ds("path"),ce(t,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),ce(e,"viewBox","0 0 60.006 21.412"),ce(e,"width","14"),ce(e,"height","20"),ce(e,"class","svelte-en2qvf")},m(n,i){W(n,e,i),z(e,t)},p:ht,i:ht,o:ht,d(n){n&&H(e)}}}class sE extends kt{constructor(e){super(),St(this,e,null,oE,gt,{})}}function aE(r){let e,t,n;return{c(){e=ds("svg"),t=ds("circle"),n=ds("path"),ce(t,"cx","4.789"),ce(t,"cy","4.787"),ce(t,"r","3.85"),ce(t,"class","svelte-1aq105l"),ce(n,"d","M12.063 12.063 7.635 7.635"),ce(n,"class","svelte-1aq105l"),ce(e,"xmlns","http://www.w3.org/2000/svg"),ce(e,"width","13"),ce(e,"height","13"),ce(e,"viewBox","0 0 13 13"),ce(e,"class","svelte-1aq105l")},m(i,o){W(i,e,o),z(e,t),z(e,n)},p:ht,i:ht,o:ht,d(i){i&&H(e)}}}class lE extends kt{constructor(e){super(),St(this,e,null,aE,gt,{})}}function uE(r,e,t){const n=e[1],i=e[0],o=n-i;return r===n&&t?r:((r-i)%o+o)%o+i}function D1(r){const e=[...r];return e[2]<e[0]&&(Math.abs((e[0]+e[2]+360)/2)>Math.abs((e[0]-360+e[2])/2)?e[0]-=360:e[2]+=360),e}let gf;async function cE(r,e,t){const n=r==null?void 0:r.getCenterAndZoom();for(const i of e??[])if(!(n&&(i.minZoom!=null&&i.minZoom>n[0]||i.maxZoom!=null&&i.maxZoom<n[0]))){if(i.type==="fixed")return i.coordinates.join(",");e:if(i.type==="client-geolocation"){if(gf&&i.cachedLocationExpiry&&gf.time+i.cachedLocationExpiry>Date.now()){if(!gf.coords)break e;return gf.coords}let o;try{return o=await new Promise((u,a)=>{t.signal.addEventListener("abort",()=>{a(Error("aborted"))}),navigator.geolocation.getCurrentPosition(d=>{u([d.coords.longitude,d.coords.latitude].map(m=>m.toFixed(6)).join(","))},d=>{a(d)},i)}),o}catch{}finally{i.cachedLocationExpiry&&(gf={time:Date.now(),coords:o})}if(t.signal.aborted)return}if(i.type==="server-geolocation")return"ip";if(n&&i.type==="map-center")return n[1].toFixed(6)+","+n[2].toFixed(6)}}const fE=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([6-9][0-9])\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*(EAST|WEST|[EW])?$/i,R1=/^([+-]?[0-8]?[0-9])\s+([0-5]?[0-9]\.\d{3,})[\s,]{1,}([+-]?[0-1]?[0-9]?[0-9])\s+([0-5]?[0-9]\.\d{3,})$/,B1=/^(NORTH|SOUTH|[NS])?[\s]*([+-]?[0-8]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(NORTH|SOUTH|[NS])?[\s]*[,/;]?[\s]*(EAST|WEST|[EW])?[\s]*([+-]?[0-1]?[0-9]?[0-9](?:[\.,]\d{3,}))[\s]*([]?)[\s]*(EAST|WEST|[EW])?$/i,F1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(\.)\s*([0-5]?[0-9])\s*(\.)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(EAST|WEST|[EW])?$/i,O1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*(D(?:EG)?(?:REES)?)\s*([0-5]?[0-9])\s*(M(?:IN)?(?:UTES)?)\s*((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(S(?:EC)?(?:ONDS)?)\s*(EAST|WEST|[EW])?$/i,N1=/^(NORTH|SOUTH|[NS])?\s*([+-]?[0-8]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(NORTH|SOUTH|[NS])?(?:\s*[,/;]\s*|\s*)(EAST|WEST|[EW])?\s*([+-]?[0-1]?[0-9]?[0-9])\s*([\.:]|D(?:EG)?(?:REES)?)?\s*,?([0-5]?[0-9](?:[\.,]\d{1,})?)?\s*(['\.:]|M(?:IN)?(?:UTES)?)?\s*,?((?:[0-5]?[0-9])(?:[\.,]\d{1,3})?)?\s*(''||||["\.])?\s*(EAST|WEST|[EW])?$/i;function hE(r){if(!["DMS","DM","DD"].includes(r))throw new Error("invalid format specified");if(this.decimalCoordinates&&this.decimalCoordinates.trim()){const e=this.decimalCoordinates.split(",").map(T=>Number(T.trim())),t=Number(e[0]),n=Number(e[1]),i=Math.abs(t),o=Math.abs(n),u=t>0?"N":"S",a=n>0?"E":"W";let d;r=="DD"&&(d=`${i} ${u}, ${o} ${a}`);const m=Math.floor(i),_=Math.floor(o),v=(i-m)*60,S=(o-_)*60;if(r=="DM"){let T=$1(v,3).toFixed(3).padStart(6,"0"),C=$1(S,3).toFixed(3).padStart(6,"0");T.endsWith(".000")&&C.endsWith(".000")&&(T=T.replace(/\.000$/,""),C=C.replace(/\.000$/,"")),d=`${m} ${T}' ${u}, ${_} ${C}' ${a}`}if(r=="DMS"){const T=Math.floor(v),C=Math.floor(S);let L=((v-T)*60).toFixed(1).padStart(4,"0"),P=((S-C)*60).toFixed(1).padStart(4,"0");const D=T.toString().padStart(2,"0"),I=C.toString().padStart(2,"0");L.endsWith(".0")&&P.endsWith(".0")&&(L=L.replace(/\.0$/,""),P=P.replace(/\.0$/,"")),d=`${m} ${D}' ${L}" ${u}, ${_} ${I}' ${P}" ${a}`}return d}else throw new Error("no decimal coordinates to convert")}function $1(r,e){const t=Math.pow(10,e);return Math.round((r+Number.EPSILON)*t)/t}function a_(r,e){e||(e=5),r=r.replace(/\s+/g," ").trim();let t=null,n=null,i="",o="",u=null,a=[],d=!1;if(fE.test(r))throw new Error("invalid coordinate value");if(R1.test(r))if(a=R1.exec(r),d=_f(a),d)t=Math.abs(a[1])+a[2]/60,Number(a[1])<0&&(t*=-1),n=Math.abs(a[3])+a[4]/60,Number(a[3])<0&&(n*=-1),u="DM";else throw new Error("invalid coordinate format");else if(B1.test(r))if(a=B1.exec(r),d=_f(a),d){if(t=a[2],n=a[6],t.includes(",")&&(t=t.replace(",",".")),n.includes(",")&&(n=n.replace(",",".")),u="DD",Number(Math.round(t))==Number(t))throw new Error("integer only coordinate provided");if(Number(Math.round(n))==Number(n))throw new Error("integer only coordinate provided");a[1]?(i=a[1],o=a[5]):a[4]&&(i=a[4],o=a[8])}else throw new Error("invalid decimal coordinate format");else if(F1.test(r))if(a=F1.exec(r),d=_f(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[9])),a[11]&&(n+=a[11]/60),a[13]&&(n+=a[13].replace(",",".")/3600),parseInt(a[9])<0&&(n=-1*n),a[1]?(i=a[1],o=a[8]):a[7]&&(i=a[7],o=a[14]);else throw new Error("invalid DMS coordinates format");else if(O1.test(r))if(a=O1.exec(r),d=_f(a),d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4]/60,u="DM"),a[6]&&(t+=a[6]/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12]/60),a[14]&&(n+=a[14]/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid DMS coordinates format");else if(N1.test(r)){if(a=N1.exec(r),d=_f(a),a.filter(m=>m).length<=5)throw new Error("invalid coordinates format");if(d)t=Math.abs(parseInt(a[2])),a[4]&&(t+=a[4].replace(",",".")/60,u="DM"),a[6]&&(t+=a[6].replace(",",".")/3600,u="DMS"),parseInt(a[2])<0&&(t=-1*t),n=Math.abs(parseInt(a[10])),a[12]&&(n+=a[12].replace(",",".")/60),a[14]&&(n+=a[14].replace(",",".")/3600),parseInt(a[10])<0&&(n=-1*n),a[1]?(i=a[1],o=a[9]):a[8]&&(i=a[8],o=a[16]);else throw new Error("invalid coordinates format")}if(d){if(Math.abs(n)>=180)throw new Error("invalid longitude value");if(Math.abs(t)>=90)throw new Error("invalid latitude value");if(i&&!o||!i&&o)throw new Error("invalid coordinates value");if(i&&i==o)throw new Error("invalid coordinates format");t.toString().includes(",")&&(t=t.replace(",",".")),n.toString().includes(",")&&(n=n.replace(",","."));let m=/S|SOUTH/i;m.test(i)&&t>0&&(t=-1*t),m=/W|WEST/i,m.test(o)&&n>0&&(n=-1*n);const _=a[0].trim();let v,S;const T=/[,/;\u0020]/g,C=_.match(T);if(C==null){const D=Math.floor(r.length/2);v=_.substring(0,D).trim(),S=_.substring(D).trim()}else{let D;C.length%2==1?D=Math.floor(C.length/2):D=C.length/2-1;let I=0;if(D==0)I=_.indexOf(C[0]),v=_.substring(0,I).trim(),S=_.substring(I+1).trim();else{let U=0,O=0;for(;U<=D;)I=_.indexOf(C[U],O),O=I+1,U++;v=_.substring(0,I).trim(),S=_.substring(I+1).trim()}}const L=v.split(".");if(L.length==2&&L[1]==0&&L[1].length!=2)throw new Error("invalid coordinates format");const P=S.split(".");if(P.length==2&&P[1]==0&&P[1].length!=2)throw new Error("invalid coordinates format");if(/^\d+$/.test(v)||/^\d+$/.test(S))throw new Error("degree only coordinate/s provided");return t=Number(Number(t).toFixed(e)),n=Number(Number(n).toFixed(e)),Object.freeze({verbatimCoordinates:_,verbatimLatitude:v,verbatimLongitude:S,decimalLatitude:t,decimalLongitude:n,decimalCoordinates:`${t},${n}`,originalFormat:u,closeEnough:dE,toCoordinateFormat:hE})}else throw new Error("coordinates pattern match failed")}function _f(r){if(!isNaN(r[0]))return!1;const e=[...r];if(e.shift(),e.length%2>0)return!1;const t=/^[-+]?\d+([\.,]\d+)?$/,n=/[eastsouthnorthwest]+/i,i=e.length/2;for(let o=0;o<i;o++){const u=e[o],a=e[o+i],d=t.test(u)&&t.test(a),m=n.test(u)&&n.test(a),_=u==a;if(!(u==null&&a==null)){if(u==null||a==null)return!1;if(d||m||_)continue;return!1}}return!0}function j1(r,e){const t=Math.abs(r-e);return Number(t.toFixed(6))<=1e-5}function dE(r){if(!r)throw new Error("coords must be provided");if(r.includes(",")){const e=r.split(",");if(Number(e[0])==NaN||Number(e[1])==NaN)throw new Error("coords are not valid decimals");return j1(this.decimalLatitude,Number(e[0]))&&j1(this.decimalLongitude,e[1])}else throw new Error("coords being tested must be separated by a comma")}const pE=Object.freeze({DMS:"DMS",DM:"DM",DD:"DD"});a_.to=pE;const mE=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:"40.123 N 74.123 W",verbatimLatitude:"40.123 N",verbatimLongitude:"74.123 W"},{verbatimCoordinates:'40 7 22.8" N 74 7 22.8" W',verbatimLatitude:'40 7 22.8" N',verbatimLongitude:'74 7 22.8" W'},{verbatimCoordinates:"40 7.38 , -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"N40722.8, W74722.8",verbatimLatitude:"N40722.8",verbatimLongitude:"W74722.8"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:`407'22.8"N, 747'22.8"W`,verbatimLatitude:`407'22.8"N`,verbatimLongitude:`747'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123,-74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40722.8"N, 74722.8"W',verbatimLatitude:'40722.8"N',verbatimLongitude:'74722.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40723"N 74723"W',verbatimLatitude:'40723"N',verbatimLongitude:'74723"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40723"S 74723"E',verbatimLatitude:'40723"S',verbatimLongitude:'74723"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40723" -74723"',verbatimLatitude:'40723"',verbatimLongitude:'-74723"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7 23" N 74d 7 23" W',verbatimLatitude:'40d 7 23" N',verbatimLongitude:'74d 7 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7.38, -74 7.38",verbatimLatitude:"40 7.38",verbatimLongitude:"-74 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],gE={decimalLatitude:40.123,decimalLongitude:-74.123},_E=[{verbatimCoordinates:`504'17.698"south, 1424'2.826"east`,verbatimLatitude:`504'17.698"south`,verbatimLongitude:`1424'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"402647N 795836W",verbatimLatitude:"402647N",verbatimLongitude:"795836W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26 47 N 79d 58 36 W",verbatimLatitude:"40d 26 47 N",verbatimLongitude:"79d 58 36 W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195 79,948862",verbatimLatitude:"40,446195",verbatimLongitude:"79,948862",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40 26.7717, -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"1824S 2245E",verbatimLatitude:"1824S",verbatimLongitude:"2245E",decimalLatitude:-18.4,decimalLongitude:22.75}],yE=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245 S / 28.2344 E",verbatimLatitude:"-23.3245 S",verbatimLongitude:"28.2344 E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40 26.7717 -79 56.93172",verbatimLatitude:"40 26.7717",verbatimLongitude:"-79 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563   E22.45634 ",verbatimLatitude:"S23.43563 ",verbatimLongitude:"E22.45634 ",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372 S 23,07771 E",verbatimLatitude:"27,71372 S",verbatimLongitude:"23,07771 E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"53 16.3863,4 52.8171",verbatimLatitude:"53 16.3863",verbatimLongitude:"4 52.8171",decimalLatitude:53.273105,decimalLongitude:4.88029},{verbatimCoordinates:"50 8.2914,-5 2.4447",verbatimLatitude:"50 8.2914",verbatimLongitude:"-5 2.4447",decimalLatitude:50.13819,decimalLongitude:-5.040745},{verbatimCoordinates:"N 48 30,6410', E 18 57,4583'",verbatimLatitude:"N 48 30,6410'",verbatimLongitude:"E 18 57,4583'",decimalLatitude:48.51068,decimalLongitude:18.95764},{verbatimCoordinates:"1.23456, 18.33453",verbatimLatitude:"1.23456",verbatimLongitude:"18.33453",decimalLatitude:1.23456,decimalLongitude:18.33453}];function bE(){const r=[];return mE.forEach(e=>{e.decimalLatitude?r.push(e):r.push({...e,...gE})}),[...r,..._E,...yE]}const vE=bE();a_.formats=vE.map(r=>r.verbatimCoordinates);const wE=a_;function U1(r,e,t){const n=r.slice();return n[97]=e[t],n[99]=t,n}function V1(r){let e,t,n,i,o;return t=new F2({}),{c(){e=q("button"),pe(t.$$.fragment),ce(e,"type","button"),ce(e,"title",r[3]),ce(e,"class","svelte-bz0zu3")},m(u,a){W(u,e,a),de(t,e,null),n=!0,i||(o=_t(e,"click",r[78]),i=!0)},p(u,a){(!n||a[0]&8)&&ce(e,"title",u[3])},i(u){n||(N(t.$$.fragment,u),n=!0)},o(u){G(t.$$.fragment,u),n=!1},d(u){u&&H(e),he(t),i=!1,o()}}}function q1(r){let e,t;return e=new iE({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function G1(r){let e,t,n,i,o;return t=new sE({}),{c(){e=q("button"),pe(t.$$.fragment),ce(e,"type","button"),ce(e,"title",r[10]),ce(e,"class","svelte-bz0zu3"),Nt(e,"active",r[0])},m(u,a){W(u,e,a),de(t,e,null),n=!0,i||(o=_t(e,"click",r[79]),i=!0)},p(u,a){(!n||a[0]&1024)&&ce(e,"title",u[10]),(!n||a[0]&1)&&Nt(e,"active",u[0])},i(u){n||(N(t.$$.fragment,u),n=!0)},o(u){G(t.$$.fragment,u),n=!1},d(u){u&&H(e),he(t),i=!1,o()}}}function xE(r){let e,t=[],n=new Map,i,o,u,a=zn(r[13]);const d=m=>m[97].id+(m[97].address?","+m[97].address:"");for(let m=0;m<a.length;m+=1){let _=U1(r,a,m),v=d(_);n.set(v,t[m]=Z1(v,_))}return{c(){e=q("ul");for(let m=0;m<t.length;m+=1)t[m].c();ce(e,"class","options svelte-bz0zu3"),ce(e,"role","listbox")},m(m,_){W(m,e,_);for(let v=0;v<t.length;v+=1)t[v]&&t[v].m(e,null);i=!0,o||(u=[_t(e,"mouseleave",r[27]),_t(e,"blur",r[83]),_t(e,"keydown",r[23])],o=!0)},p(m,_){_[0]&102823936&&(a=zn(m[13]),Zt(),t=e3(t,_,d,1,m,a,n,e,t3,Z1,null,U1),Ht())},i(m){if(!i){for(let _=0;_<a.length;_+=1)N(t[_]);i=!0}},o(m){for(let _=0;_<t.length;_+=1)G(t[_]);i=!1},d(m){m&&H(e);for(let _=0;_<t.length;_+=1)t[_].d();o=!1,Er(u)}}}function AE(r){let e,t,n,i,o,u;return t=new O2({}),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("div"),o=Te(r[8]),ce(i,"class","svelte-bz0zu3"),ce(e,"class","no-results svelte-bz0zu3")},m(a,d){W(a,e,d),de(t,e,null),z(e,n),z(e,i),z(i,o),u=!0},p(a,d){(!u||d[0]&256)&&yt(o,a[8])},i(a){u||(N(t.$$.fragment,a),u=!0)},o(a){G(t.$$.fragment,a),u=!1},d(a){a&&H(e),he(t)}}}function kE(r){let e="",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p:ht,i:ht,o:ht,d(n){n&&H(t)}}}function SE(r){let e,t,n,i,o,u,a,d,m,_,v;return t=new O2({}),d=new F2({}),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("div"),o=Te(r[7]),u=ae(),a=q("button"),pe(d.$$.fragment),ce(i,"class","svelte-bz0zu3"),ce(a,"class","svelte-bz0zu3"),ce(e,"class","error svelte-bz0zu3")},m(S,T){W(S,e,T),de(t,e,null),z(e,n),z(e,i),z(i,o),z(e,u),z(e,a),de(d,a,null),m=!0,_||(v=_t(a,"click",r[80]),_=!0)},p(S,T){(!m||T[0]&128)&&yt(o,S[7])},i(S){m||(N(t.$$.fragment,S),N(d.$$.fragment,S),m=!0)},o(S){G(t.$$.fragment,S),G(d.$$.fragment,S),m=!1},d(S){S&&H(e),he(t),he(d),_=!1,v()}}}function Z1(r,e){var a;let t,n,i;function o(){return e[81](e[99])}function u(){return e[82](e[97])}return n=new nE({props:{feature:e[97],showPlaceType:e[11],style:e[15]===e[99]?"selected":((a=e[14])==null?void 0:a.id)===e[97].id?"picked":"default",missingIconsCache:e[21],iconsBaseUrl:e[12]}}),n.$on("mouseenter",o),n.$on("select",u),{key:r,first:null,c(){t=rr(),pe(n.$$.fragment),this.first=t},m(d,m){W(d,t,m),de(n,d,m),i=!0},p(d,m){var v;e=d;const _={};m[0]&8192&&(_.feature=e[97]),m[0]&2048&&(_.showPlaceType=e[11]),m[0]&57344&&(_.style=e[15]===e[99]?"selected":((v=e[14])==null?void 0:v.id)===e[97].id?"picked":"default"),m[0]&4096&&(_.iconsBaseUrl=e[12]),n.$set(_)},i(d){i||(N(n.$$.fragment,d),i=!0)},o(d){G(n.$$.fragment,d),i=!1},d(d){d&&H(t),he(n,d)}}}function TE(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U,O=!1;o=new lE({});let ee=!r[20]&&V1(r),X=r[20]&&q1(),ue=r[6]==="button"&&G1(r);const $=r[70].default,Q=_n($,r,r[69],null),ne=[SE,kE,AE,xE],F=[];function Z(J,be){var ke,ge;return J[19]?0:!J[16]&&!J[4]?1:((ke=J[13])==null?void 0:ke.length)===0?2:(ge=J[13])!=null&&ge.length&&(J[16]||J[4])?3:-1}return~(C=Z(r))&&(L=F[C]=ne[C](r)),{c(){e=ae(),t=q("form"),n=q("div"),i=q("button"),pe(o.$$.fragment),u=ae(),a=q("input"),d=ae(),m=q("div"),ee&&ee.c(),_=ae(),X&&X.c(),v=ae(),ue&&ue.c(),S=ae(),Q&&Q.c(),T=ae(),L&&L.c(),ce(i,"class","search-button svelte-bz0zu3"),ce(i,"type","button"),ce(a,"placeholder",r[9]),ce(a,"aria-label",r[9]),ce(a,"class","svelte-bz0zu3"),ce(m,"class","clear-button-container svelte-bz0zu3"),Nt(m,"displayable",r[1]!==""),ce(n,"class","input-group svelte-bz0zu3"),ce(t,"class",P=Oa(r[2])+" svelte-bz0zu3"),Nt(t,"can-collapse",r[5]&&r[1]==="")},m(J,be){W(J,e,be),W(J,t,be),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),r[72](a),Gn(a,r[1]),z(n,d),z(n,m),ee&&ee.m(m,null),z(m,_),X&&X.m(m,null),z(n,v),ue&&ue.m(n,null),z(n,S),Q&&Q.m(n,null),z(t,T),~C&&F[C].m(t,null),D=!0,I||(U=[_t(i,"click",r[71]),_t(a,"input",r[73]),_t(a,"focus",r[74]),_t(a,"blur",r[75]),_t(a,"click",r[76]),_t(a,"keydown",r[23]),_t(a,"input",r[24]),_t(a,"change",r[77]),_t(t,"submit",Mg(r[22]))],I=!0)},p(J,be){(!D||be[0]&512)&&ce(a,"placeholder",J[9]),(!D||be[0]&512)&&ce(a,"aria-label",J[9]),be[0]&2&&a.value!==J[1]&&Gn(a,J[1]),J[20]?ee&&(Zt(),G(ee,1,1,()=>{ee=null}),Ht()):ee?(ee.p(J,be),be[0]&1048576&&N(ee,1)):(ee=V1(J),ee.c(),N(ee,1),ee.m(m,_)),J[20]?X?be[0]&1048576&&N(X,1):(X=q1(),X.c(),N(X,1),X.m(m,null)):X&&(Zt(),G(X,1,1,()=>{X=null}),Ht()),(!D||be[0]&2)&&Nt(m,"displayable",J[1]!==""),J[6]==="button"?ue?(ue.p(J,be),be[0]&64&&N(ue,1)):(ue=G1(J),ue.c(),N(ue,1),ue.m(n,S)):ue&&(Zt(),G(ue,1,1,()=>{ue=null}),Ht()),Q&&Q.p&&(!D||be[2]&128)&&yn(Q,$,J,J[69],D?vn($,J[69],be,null):bn(J[69]),null);let ke=C;C=Z(J),C===ke?~C&&F[C].p(J,be):(L&&(Zt(),G(F[ke],1,1,()=>{F[ke]=null}),Ht()),~C?(L=F[C],L?L.p(J,be):(L=F[C]=ne[C](J),L.c()),N(L,1),L.m(t,null)):L=null),(!D||be[0]&4&&P!==(P=Oa(J[2])+" svelte-bz0zu3"))&&ce(t,"class",P),(!D||be[0]&38)&&Nt(t,"can-collapse",J[5]&&J[1]==="")},i(J){D||(N(O),N(o.$$.fragment,J),N(ee),N(X),N(ue),N(Q,J),N(L),D=!0)},o(J){G(O),G(o.$$.fragment,J),G(ee),G(X),G(ue),G(Q,J),G(L),D=!1},d(J){J&&(H(e),H(t)),he(o),r[72](null),ee&&ee.d(),X&&X.d(),ue&&ue.d(),Q&&Q.d(J),~C&&F[C].d(),I=!1,Er(U)}}}function CE(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e;const d={continental_marine:4,country:4,major_landform:8,region:5,subregion:6,county:7,joint_municipality:8,joint_submunicipality:9,municipality:10,municipal_district:11,locality:12,neighbourhood:13,place:14,postal_code:14,road:16,poi:17,address:18,"poi.peak":15,"poi.shop":18,"poi.cafe":18,"poi.restaurant":18,"poi.aerodrome":13};let{class:m=void 0}=e,{apiKey:_=void 0}=e,{bbox:v=void 0}=e,{clearButtonTitle:S="clear"}=e,{clearOnBlur:T=!1}=e,{clearListOnPick:C=!1}=e,{keepListOpen:L=!1}=e,{collapsed:P=!1}=e,{country:D=void 0}=e,{debounceSearch:I=200}=e,{enableReverse:U="never"}=e,{errorMessage:O="Something went wrong"}=e,{filter:ee=()=>!0}=e,{flyTo:X=!0}=e,{fuzzyMatch:ue=!0}=e,{language:$=void 0}=e,{limit:Q=void 0}=e;const ne=41415112612;let{reverseGeocodingLimit:F=ne}=e,{mapController:Z=void 0}=e,{minLength:J=2}=e,{noResultsMessage:be="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:ke="Search"}=e,{proximity:ge=[{type:"server-geolocation"}]}=e,{reverseActive:ve=U==="always"}=e,{reverseButtonTitle:fe="toggle reverse geocoding"}=e,{searchValue:Pe=""}=e,{pickedResultStyle:Ee="full-geometry"}=e,{showPlaceType:Fe="if-needed"}=e,{showResultsWhileTyping:ot=!0}=e,{selectFirst:ct=!0}=e,{flyToSelected:it=!1}=e,{markerOnSelected:at=!0}=e,{types:ft=void 0}=e;const Ct=[];let{reverseGeocodingTypes:xt=Ct}=e,{exhaustiveReverseGeocoding:It=!1}=e,{excludeTypes:Qt=!1}=e;const tn=void 0;let{reverseGeocodingExcludeTypes:rn=tn}=e,{zoom:Ue=d}=e,{apiUrl:Xe="https://api.maptiler.com/geocoding"}=e,{fetchParameters:qt={}}=e,{iconsBaseUrl:Ge="https://cdn.maptiler.com/maptiler-geocoding-control/v2.1.7/icons/"}=e,{adjustUrlQuery:et=()=>{}}=e,{adjustUrl:nn=()=>{}}=e;function Ye(He){vt.focus(He)}function Ft(){vt.blur()}function Tt(He,Sn=!0,Fn=!1){t(1,Pe=He),Sn?(t(15,Cn=-1),hr()):(Me(void 0,!Fn,Fn),setTimeout(()=>{vt.focus(),vt.select()}))}function Rn(){t(13,un=void 0),t(14,Mt=void 0),t(15,Cn=-1)}function fr(){t(64,Dt=[]),t(14,Mt=void 0)}let un,Dt,Mt,Vr="",vt,Cn=-1,Zn,jr=[],Nr,Lt,tt,pt,$t=!1;const Bn=new Set,zt=ps();ei(()=>{Z&&(Z.setEventHandler(void 0),Z.indicateReverse(!1),Z.setSelectedMarker(-1),Z.setFeatures(void 0,void 0,!1))});function hr(He){if(t(17,$t=!1),Lt&&(clearTimeout(Lt),Lt=void 0),Cn>-1&&un)t(14,Mt=un[Cn]),t(1,Pe=Mt.place_type[0]==="reverse"?Mt.place_name:Mt.place_name.replace(/,.*/,"")),t(19,Zn=void 0),t(64,Dt=void 0),t(15,Cn=-1);else if(Pe){const Sn=He||!ir(Pe);Gr(Pe,{exact:!0}).then(()=>{t(64,Dt=un),t(14,Mt=void 0),Sn&&br()}).catch(Fn=>t(19,Zn=Fn))}}function ir(He){try{return wE(He,6)}catch{return!1}}async function Gr(He,{byId:Sn=!1,exact:Fn=!1}={}){var _r,Pr,Ei;t(19,Zn=void 0),Nr==null||Nr.abort();const dr=new AbortController;t(20,Nr=dr);try{const gn=ir(He),Qo=new URL(Xe+"/"+encodeURIComponent(gn?gn.decimalLongitude+","+gn.decimalLatitude:He)+".json"),bi=Qo.searchParams;$!==void 0&&bi.set("language",Array.isArray($)?$.join(","):$??"");const[pi]=(Z==null?void 0:Z.getCenterAndZoom())??[];let Ur=(_r=!gn||xt===Ct?ft:xt)==null?void 0:_r.map(tr=>typeof tr=="string"?tr:pi===void 0||(tr[0]??0)<=pi&&pi<(tr[1]??1/0)?tr[2]:void 0).filter(tr=>tr!==void 0);Ur&&(Ur=[...new Set(Ur)],bi.set("types",Ur.join(",")));const Il=!gn||rn===tn?Qt:rn;if(Il&&bi.set("excludeTypes",String(Il)),v&&bi.set("bbox",v.map(tr=>tr.toFixed(6)).join(",")),D&&bi.set("country",Array.isArray(D)?D.join(","):D),!Sn&&!gn){const tr=await cE(Z,ge,dr);tr&&bi.set("proximity",tr),(Fn||!ot)&&bi.set("autocomplete","false"),bi.set("fuzzyMatch",String(ue))}const ci=F===ne?Q:F;ci!==void 0&&ci>1&&(Ur==null?void 0:Ur.length)!==1&&console.warn("For reverse geocoding when limit > 1 then types must contain single value."),gn?(ci===1||ci!==void 0&&(It||(Ur==null?void 0:Ur.length)===1))&&bi.set("limit",String(ci)):Q!==void 0&&bi.set("limit",String(Q)),_&&bi.set("key",_),et(bi),nn(Qo);const Ii=Qo.searchParams.get("types")===""&&Qo.searchParams.get("excludeTypes")!=="true",mo=Qo.toString();if(mo===Vr){Sn?(C&&t(13,un=void 0),t(14,Mt=jr[0])):(t(13,un=jr),((Pr=un[Cn])==null?void 0:Pr.id)!==(i==null?void 0:i.id)&&t(15,Cn=-1));return}Vr=mo;let Hi;if(Ii)Hi={type:"FeatureCollection",features:[]};else{const tr=await fetch(mo,{signal:dr.signal,...qt});if(!tr.ok)throw new Error(await tr.text());Hi=await tr.json()}zt("response",{url:mo,featureCollection:Hi}),Sn?(C&&t(13,un=void 0),t(14,Mt=Hi.features[0]),jr=[Mt]):(t(13,un=Hi.features.filter(ee)),gn&&un.unshift({type:"Feature",properties:{},id:"reverse_"+gn.decimalLongitude+"_"+gn.decimalLatitude,text:gn.decimalLatitude+", "+gn.decimalLongitude,place_name:gn.decimalLatitude+", "+gn.decimalLongitude,place_type:["reverse"],center:[gn.decimalLongitude,gn.decimalLatitude],bbox:[gn.decimalLongitude,gn.decimalLatitude,gn.decimalLongitude,gn.decimalLatitude],geometry:{type:"Point",coordinates:[gn.decimalLongitude,gn.decimalLatitude]}}),jr=un,((Ei=un[Cn])==null?void 0:Ei.id)!==(i==null?void 0:i.id)&&t(15,Cn=-1),gn&&vt.focus())}catch(gn){if(gn&&typeof gn=="object"&&"name"in gn&&gn.name==="AbortError")return;throw gn}finally{dr===Nr&&t(20,Nr=void 0)}}function br(){var dr;if(!(Dt!=null&&Dt.length)||!X)return;const He=[180,90,-180,-90],Sn=!Dt.some(_r=>!_r.matching_text);let Fn;for(const _r of Dt){const Pr=oe(_r);if(Fn=Fn===void 0?Pr:Pr===void 0?Fn:Math.max(Fn,Pr),Sn||!_r.matching_text)for(const Ei of[0,1,2,3])He[Ei]=Math[Ei<2?"min":"max"](He[Ei],((dr=_r.bbox)==null?void 0:dr[Ei])??_r.center[Ei%2])}Z&&Dt.length>0&&(Mt&&He[0]===He[2]&&He[1]===He[3]?Z.flyTo(Mt.center,oe(Mt)):Z.fitBounds(D1(He),50,Fn))}function Ce(){!Mt||!Z||(!Mt.bbox||Mt.bbox[0]===Mt.bbox[2]&&Mt.bbox[1]===Mt.bbox[3]?Z.flyTo(Mt.center,oe(Mt)):Z.fitBounds(D1(Mt.bbox),50,oe(Mt)))}function oe(He){var Fn;if(!He.bbox||He.bbox[0]!==He.bbox[2]&&He.bbox[1]!==He.bbox[3])return;const Sn=He.id.replace(/\..*/,"");return(Array.isArray((Fn=He.properties)==null?void 0:Fn.categories)?He.properties.categories.reduce((dr,_r)=>{const Pr=Ue[Sn+"."+_r];return dr===void 0?Pr:Pr===void 0?dr:Math.max(dr,Pr)},void 0):void 0)??Ue[Sn]}function le(He){t(0,ve=U==="always"),t(13,un=void 0),t(14,Mt=void 0),t(15,Cn=-1),Tt(He[1].toFixed(6)+", "+uE(He[0],[-180,180],!0).toFixed(6),!1,!0)}function we(He){if(!un)return;let Sn=He.key==="ArrowDown"?1:He.key==="ArrowUp"?-1:0;Sn&&(vt.focus(),t(17,$t=!0),He.preventDefault(),Mt&&Cn===-1&&t(15,Cn=un.findIndex(Fn=>Fn.id===(Mt==null?void 0:Mt.id))),Cn===(Mt||ct?0:-1)&&Sn===-1&&t(15,Cn=un.length),t(15,Cn+=Sn),Cn>=un.length&&t(15,Cn=-1),Cn<0&&(Mt||ct)&&t(15,Cn=0))}function Me(He,Sn=!0,Fn=!1){if(t(19,Zn=void 0),t(14,Mt=void 0),t(17,$t=!0),ot||Fn){if(Lt&&clearTimeout(Lt),Pe.length<J)return;const dr=Pe;Lt=window.setTimeout(()=>{Gr(dr).catch(_r=>t(19,Zn=_r))},Sn?I:0)}else t(13,un=void 0),t(19,Zn=void 0)}function Ne(He){Mt&&(Mt==null?void 0:Mt.id)===(He==null?void 0:He.id)?Ce():(t(14,Mt=He),t(1,Pe=He.place_name))}function Ve(He){t(15,Cn=He)}function Ke(){(!ct||Mt)&&t(15,Cn=-1),it&&Ce()}const Oe=()=>vt.focus();function ut(He){wn[He?"unshift":"push"](()=>{vt=He,t(18,vt)})}function At(){Pe=this.value,t(1,Pe),t(17,$t),t(31,T),t(16,tt)}const st=()=>t(17,$t=!0),Rt=()=>t(17,$t=!1),hn=()=>t(17,$t=!0),mn=()=>t(14,Mt=void 0),Qn=()=>{t(1,Pe=""),t(14,Mt=void 0),vt.focus()},Ln=()=>t(0,ve=!ve),er=()=>t(19,Zn=void 0),Un=He=>Ve(He),Zr=He=>Ne(He),$r=()=>{};return r.$$set=He=>{"class"in He&&t(2,m=He.class),"apiKey"in He&&t(29,_=He.apiKey),"bbox"in He&&t(30,v=He.bbox),"clearButtonTitle"in He&&t(3,S=He.clearButtonTitle),"clearOnBlur"in He&&t(31,T=He.clearOnBlur),"clearListOnPick"in He&&t(32,C=He.clearListOnPick),"keepListOpen"in He&&t(4,L=He.keepListOpen),"collapsed"in He&&t(5,P=He.collapsed),"country"in He&&t(33,D=He.country),"debounceSearch"in He&&t(34,I=He.debounceSearch),"enableReverse"in He&&t(6,U=He.enableReverse),"errorMessage"in He&&t(7,O=He.errorMessage),"filter"in He&&t(35,ee=He.filter),"flyTo"in He&&t(36,X=He.flyTo),"fuzzyMatch"in He&&t(37,ue=He.fuzzyMatch),"language"in He&&t(38,$=He.language),"limit"in He&&t(39,Q=He.limit),"reverseGeocodingLimit"in He&&t(40,F=He.reverseGeocodingLimit),"mapController"in He&&t(41,Z=He.mapController),"minLength"in He&&t(42,J=He.minLength),"noResultsMessage"in He&&t(8,be=He.noResultsMessage),"placeholder"in He&&t(9,ke=He.placeholder),"proximity"in He&&t(43,ge=He.proximity),"reverseActive"in He&&t(0,ve=He.reverseActive),"reverseButtonTitle"in He&&t(10,fe=He.reverseButtonTitle),"searchValue"in He&&t(1,Pe=He.searchValue),"pickedResultStyle"in He&&t(44,Ee=He.pickedResultStyle),"showPlaceType"in He&&t(11,Fe=He.showPlaceType),"showResultsWhileTyping"in He&&t(45,ot=He.showResultsWhileTyping),"selectFirst"in He&&t(46,ct=He.selectFirst),"flyToSelected"in He&&t(47,it=He.flyToSelected),"markerOnSelected"in He&&t(48,at=He.markerOnSelected),"types"in He&&t(49,ft=He.types),"reverseGeocodingTypes"in He&&t(50,xt=He.reverseGeocodingTypes),"exhaustiveReverseGeocoding"in He&&t(51,It=He.exhaustiveReverseGeocoding),"excludeTypes"in He&&t(52,Qt=He.excludeTypes),"reverseGeocodingExcludeTypes"in He&&t(53,rn=He.reverseGeocodingExcludeTypes),"zoom"in He&&t(54,Ue=He.zoom),"apiUrl"in He&&t(55,Xe=He.apiUrl),"fetchParameters"in He&&t(56,qt=He.fetchParameters),"iconsBaseUrl"in He&&t(12,Ge=He.iconsBaseUrl),"adjustUrlQuery"in He&&t(57,et=He.adjustUrlQuery),"adjustUrl"in He&&t(58,nn=He.adjustUrl),"$$scope"in He&&t(69,a=He.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&64&&t(0,ve=U==="always"),r.$$.dirty[0]&16384|r.$$.dirty[1]&8192&&Ee!=="marker-only"&&Mt&&!Mt.address&&Mt.geometry.type==="Point"&&Mt.place_type[0]!=="reverse"&&Gr(Mt.id,{byId:!0}).catch(He=>t(19,Zn=He)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1058|r.$$.dirty[2]&8&&(Z&&Mt&&Mt.id!==pt&&X&&(Ce(),C&&t(13,un=void 0),t(64,Dt=void 0),t(15,Cn=-1)),t(65,pt=Mt==null?void 0:Mt.id)),r.$$.dirty[0]&196608|r.$$.dirty[1]&1&&setTimeout(()=>{t(16,tt=$t),T&&!tt&&t(1,Pe="")}),r.$$.dirty[0]&8194|r.$$.dirty[1]&2048&&Pe.length<J&&(t(13,un=void 0),t(19,Zn=void 0),t(64,Dt=un)),r.$$.dirty[0]&57344|r.$$.dirty[1]&32768&&ct&&un!=null&&un.length&&Cn==-1&&!Mt&&t(15,Cn=0),r.$$.dirty[0]&8192|r.$$.dirty[2]&4&&Dt!==un&&t(64,Dt=void 0),r.$$.dirty[0]&73729|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&Z&&Z.setEventHandler(He=>{switch(He.type){case"mapClick":ve&&le(He.coordinates);break;case"markerClick":{const Sn=un==null?void 0:un.find(Fn=>Fn.id===He.id);Sn&&Ne(Sn)}break;case"markerMouseEnter":Dt&&t(15,Cn=tt?(un==null?void 0:un.findIndex(Sn=>Sn.id===He.id))??-1:-1);break;case"markerMouseLeave":Dt&&t(15,Cn=-1);break}}),r.$$.dirty[0]&40960&&t(66,i=un==null?void 0:un[Cn]),r.$$.dirty[1]&66592|r.$$.dirty[2]&16&&Z&&i&&X&&it&&Z.flyTo(i.center,oe(i)),r.$$.dirty[1]&8192&&t(68,n=Ee==="full-geometry-including-polygon-center-marker"),r.$$.dirty[1]&132096|r.$$.dirty[2]&64&&(at||Z==null||Z.setFeatures(void 0,void 0,n)),r.$$.dirty[0]&16384|r.$$.dirty[1]&132096|r.$$.dirty[2]&84&&Z&&at&&!Dt&&(Z.setFeatures(i?[i]:void 0,Mt,n),Z.setSelectedMarker(i?0:-1)),r.$$.dirty[0]&16384|r.$$.dirty[1]&1024|r.$$.dirty[2]&68&&Z&&Z.setFeatures(Dt,Mt,n),r.$$.dirty[0]&32768|r.$$.dirty[1]&1024|r.$$.dirty[2]&4&&Dt&&Z&&Z.setSelectedMarker(Cn),r.$$.dirty[0]&2|r.$$.dirty[1]&1024&&Z){const He=ir(Pe);Z.setReverseMarker(He?[He.decimalLongitude,He.decimalLatitude]:void 0)}r.$$.dirty[2]&16&&zt("select",{feature:i}),r.$$.dirty[0]&16384&&zt("pick",{feature:Mt}),r.$$.dirty[0]&73744&&t(67,o=!!(un!=null&&un.length)&&(tt||L)),r.$$.dirty[2]&32&&zt("optionsvisibilitychange",{optionsVisible:o}),r.$$.dirty[0]&8192&&zt("featureslisted",{features:un}),r.$$.dirty[2]&4&&zt("featuresmarked",{features:Dt}),r.$$.dirty[0]&1&&zt("reversetoggle",{reverse:ve}),r.$$.dirty[0]&2&&zt("querychange",{query:Pe}),r.$$.dirty[0]&1|r.$$.dirty[1]&1024&&Z&&Z.indicateReverse(ve)},[ve,Pe,m,S,L,P,U,O,be,ke,fe,Fe,Ge,un,Mt,Cn,tt,$t,vt,Zn,Nr,Bn,hr,we,Me,Ne,Ve,Ke,d,_,v,T,C,D,I,ee,X,ue,$,Q,F,Z,J,ge,Ee,ot,ct,it,at,ft,xt,It,Qt,rn,Ue,Xe,qt,et,nn,Ye,Ft,Tt,Rn,fr,Dt,pt,i,o,n,a,u,Oe,ut,At,st,Rt,hn,mn,Qn,Ln,er,Un,Zr,$r]}class ME extends kt{constructor(e){super(),St(this,e,CE,TE,gt,{ZOOM_DEFAULTS:28,class:2,apiKey:29,bbox:30,clearButtonTitle:3,clearOnBlur:31,clearListOnPick:32,keepListOpen:4,collapsed:5,country:33,debounceSearch:34,enableReverse:6,errorMessage:7,filter:35,flyTo:36,fuzzyMatch:37,language:38,limit:39,reverseGeocodingLimit:40,mapController:41,minLength:42,noResultsMessage:8,placeholder:9,proximity:43,reverseActive:0,reverseButtonTitle:10,searchValue:1,pickedResultStyle:44,showPlaceType:11,showResultsWhileTyping:45,selectFirst:46,flyToSelected:47,markerOnSelected:48,types:49,reverseGeocodingTypes:50,exhaustiveReverseGeocoding:51,excludeTypes:52,reverseGeocodingExcludeTypes:53,zoom:54,apiUrl:55,fetchParameters:56,iconsBaseUrl:12,adjustUrlQuery:57,adjustUrl:58,focus:59,blur:60,setQuery:61,clearList:62,clearMap:63},null,[-1,-1,-1,-1])}get ZOOM_DEFAULTS(){return this.$$.ctx[28]}get focus(){return this.$$.ctx[59]}get blur(){return this.$$.ctx[60]}get setQuery(){return this.$$.ctx[61]}get clearList(){return this.$$.ctx[62]}get clearMap(){return this.$$.ctx[63]}}function H1(r){let e,t,n;return t=new ME({props:{mapController:r[2],apiKey:r[0],country:r[1],types:r[3],proximity:[{type:"map-center"}]}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"class","svelte-ixhnie")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p(i,o){const u={};o&4&&(u.mapController=i[2]),o&1&&(u.apiKey=i[0]),o&2&&(u.country=i[1]),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function EE(r){let e,t,n=r[2]&&H1(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[2]?n?(n.p(i,o),o&4&&N(n,1)):(n=H1(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function IE(r,e,t){let n,{apiKey:i}=e,{map:o}=e,{country:u}=e,a=["continental_marine","country","major_landform","region","subregion","county","joint_municipality","joint_submunicipality","municipality","municipal_district","locality","neighbourhood","place","postal_code","address","road","poi"];function d(m){return m?UM(m,ui,!0,!0,{duration:1e3},{duration:1e3}):null}return r.$$set=m=>{"apiKey"in m&&t(0,i=m.apiKey),"map"in m&&t(4,o=m.map),"country"in m&&t(1,u=m.country)},r.$$.update=()=>{r.$$.dirty&16&&t(2,n=d(o))},[i,u,n,a,o]}class LE extends kt{constructor(e){super(),St(this,e,IE,EE,gt,{apiKey:0,map:4,country:1})}}const PE=Symbol.for("svelte-maplibre");function zE(){return Wf(PE)}function DE(r){return"layerType"in r&&r.layerType==="deckgl"}const RE=r=>({features:r[0]&16,data:r[0]&16,map:r[0]&4,close:r[0]&1}),W1=r=>{var e;return{features:r[4],data:(e=r[4])==null?void 0:e[0],map:r[2],close:r[31]}};function X1(r){let e,t,n=(r[4]||r[3]instanceof ui.Marker)&&J1(r);return{c(){e=q("div"),n&&n.c()},m(i,o){W(i,e,o),n&&n.m(e,null),r[32](e),t=!0},p(i,o){i[4]||i[3]instanceof ui.Marker?n?(n.p(i,o),o[0]&24&&N(n,1)):(n=J1(i),n.c(),N(n,1),n.m(e,null)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(),r[32](null)}}}function J1(r){let e;const t=r[30].default,n=_n(t,r,r[29],W1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[0]&536870933)&&yn(n,t,i,i[29],e?vn(t,i[29],o,RE):bn(i[29]),W1)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function BE(r){let e,t,n=r[9].default&&X1(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[9].default?n?(n.p(i,o),o[0]&512&&N(n,1)):(n=X1(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function FE(r,e,t){let n,i,o,u,a,d,{$$slots:m={},$$scope:_}=e;const v=Eg(m);let{closeButton:S=void 0}=e,{closeOnClickOutside:T=!0}=e,{closeOnClickInside:C=!1}=e,{closeOnMove:L=!1}=e,{openOn:P="click"}=e,{openIfTopMost:D=!0}=e,{focusAfterOpen:I=!0}=e,{anchor:U=void 0}=e,{offset:O=void 0}=e,{popupClass:ee=void 0}=e,{maxWidth:X=void 0}=e,{lngLat:ue=void 0}=e,{html:$=void 0}=e,{open:Q=!1}=e;const ne=ps(),{map:F,popupTarget:Z,layerEvent:J,layer:be,eventTopMost:ke}=zE();rt(r,F,Xe=>t(2,o=Xe)),rt(r,Z,Xe=>t(3,a=Xe)),rt(r,J,Xe=>t(28,u=Xe)),rt(r,be,Xe=>t(35,d=Xe));const ge=["click","dblclick","contextmenu"];let ve,fe=!1,Pe;function Ee(){if(!ve)return;let Xe=ve.getElement();!Xe||Xe===Pe||(Pe=Xe,P==="hover"&&(Pe.style.pointerEvents="none"),Pe.addEventListener("mouseenter",()=>{t(24,fe=!0)},{passive:!0}),Pe.addEventListener("mouseleave",()=>{t(24,fe=!1)},{passive:!0}),Pe.addEventListener("click",()=>{C&&t(0,Q=!1)},{passive:!0}))}Yo(()=>{if(o)return o.on("click",Qt),o.on("contextmenu",Qt),typeof a=="string"&&(o.on("click",a,it),o.on("dblclick",a,it),o.on("contextmenu",a,it),o.on("mousemove",a,It),o.on("mouseleave",a,xt),o.on("touchstart",a,ft),o.on("touchend",a,Ct)),()=>{o!=null&&o.loaded()&&(ve==null||ve.remove(),o.off("click",Qt),o.off("contextmenu",Qt),a instanceof ui.Marker?a.getPopup()===ve&&a.setPopup(void 0):typeof a=="string"&&(o.off("click",a,it),o.off("dblclick",a,it),o.off("contextmenu",a,it),o.off("mousemove",a,It),o.off("mouseleave",a,xt),o.off("touchstart",a,ft),o.off("touchend",a,Ct)))}});function Fe(Xe){return D?!("marker"in Xe)&&!DE(Xe)&&ke(Xe)!==d:!1}let ot=null,ct="normal";function it(Xe){Xe.type===P&&(Fe(Xe)||("layerType"in Xe?Xe.layerType==="deckgl"?(t(10,ue=Xe.coordinate),t(4,ot=Xe.object?[Xe.object]:null)):(t(10,ue=Xe.lngLat),t(4,ot=Xe.features??[])):(t(10,ue=Xe.lngLat),t(4,ot=Xe.features??[])),setTimeout(()=>t(0,Q=!0))))}let at=null;function ft(Xe){at=Xe.point}function Ct(Xe){if(!at||P!=="hover")return;let qt=at.dist(Xe.point);at=null,qt<3&&(t(10,ue=Xe.lngLat),t(4,ot=Xe.features??[]),ve.isOpen()?t(25,ct="justOpened"):(t(25,ct="opening"),t(0,Q=!0)))}function xt(Xe){P!=="hover"||at||ct!=="normal"||(t(0,Q=!1),t(4,ot=null))}function It(Xe){if(!(P!=="hover"||at||ct!=="normal")){if(Fe(Xe)){t(0,Q=!1),t(4,ot=null);return}t(0,Q=!0),t(4,ot=Xe.features??[]),t(10,ue=Xe.lngLat)}}function Qt(Xe){if(ct==="justOpened"){t(25,ct="normal");return}if(!T)return;let qt=[Pe,a instanceof ui.Marker?a==null?void 0:a.getElement():null];Q&&ve.isOpen()&&!qt.some(Ge=>Ge==null?void 0:Ge.contains(Xe.originalEvent.target))&&(Xe.type==="contextmenu"&&P==="contextmenu"||Xe.type!=="contextmenu")&&t(0,Q=!1)}ei(()=>{o&&(ve!=null&&ve.isOpen())&&ve.remove()});let tn;const rn=()=>t(0,Q=!1);function Ue(Xe){wn[Xe?"unshift":"push"](()=>{tn=Xe,t(1,tn)})}return r.$$set=Xe=>{"closeButton"in Xe&&t(11,S=Xe.closeButton),"closeOnClickOutside"in Xe&&t(12,T=Xe.closeOnClickOutside),"closeOnClickInside"in Xe&&t(13,C=Xe.closeOnClickInside),"closeOnMove"in Xe&&t(14,L=Xe.closeOnMove),"openOn"in Xe&&t(15,P=Xe.openOn),"openIfTopMost"in Xe&&t(16,D=Xe.openIfTopMost),"focusAfterOpen"in Xe&&t(17,I=Xe.focusAfterOpen),"anchor"in Xe&&t(18,U=Xe.anchor),"offset"in Xe&&t(19,O=Xe.offset),"popupClass"in Xe&&t(20,ee=Xe.popupClass),"maxWidth"in Xe&&t(21,X=Xe.maxWidth),"lngLat"in Xe&&t(10,ue=Xe.lngLat),"html"in Xe&&t(22,$=Xe.html),"open"in Xe&&t(0,Q=Xe.open),"$$scope"in Xe&&t(29,_=Xe.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&14336&&t(27,n=S??(!T&&!C)),r.$$.dirty[0]&146685952&&(ve||(t(23,ve=new ui.Popup({closeButton:n,closeOnClick:!1,closeOnMove:L,focusAfterOpen:I,maxWidth:X,className:ee,anchor:U,offset:O})),Pe=ve.getElement(),ve.on("open",()=>{t(0,Q=!0),Ee(),ne("open",ve)}),ve.on("close",()=>{t(0,Q=!1),ne("close",ve)}),ve.on("hover",()=>{ne("hover",ve)}))),r.$$.dirty[0]&8421384&&ve&&a instanceof ui.Marker&&(P==="click"?a.setPopup(ve):a.getPopup()===ve&&a.setPopup(void 0)),r.$$.dirty[0]&268468224&&ge.includes(P)&&(u==null?void 0:u.type)===P&&(it(u),on(J,u=null,u)),r.$$.dirty[0]&268468224&&t(26,i=P==="hover"&&((u==null?void 0:u.type)==="mousemove"||(u==null?void 0:u.type)==="mouseenter")),r.$$.dirty[0]&352354304&&P==="hover"&&J&&(i&&u&&(u.layerType==="deckgl"?(t(10,ue=u.coordinate),t(4,ot=u.object?[u.object]:null)):(t(10,ue=u.lngLat),t(4,ot=u.features??[]))),t(0,Q=(i||fe)??!1)),r.$$.dirty[0]&12582914&&(tn?ve.setDOMContent(tn):$&&ve.setHTML($)),r.$$.dirty[0]&8389632&&ue&&ve.setLngLat(ue),r.$$.dirty[0]&41943045&&o){let Xe=ve.isOpen();Q&&!Xe?(ve.addTo(o),ct==="opening"&&t(25,ct="justOpened")):!Q&&Xe&&ve.remove()}},[Q,tn,o,a,ot,F,Z,J,be,v,ue,S,T,C,L,P,D,I,U,O,ee,X,$,ve,fe,ct,i,n,u,_,m,rn,Ue]}class OE extends kt{constructor(e){super(),St(this,e,FE,BE,gt,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const NE=r=>({props:r&8}),K1=r=>({props:UE(r[3])});function $E(r){let e;const t=r[1].default,n=_n(t,r,r[2],K1);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&12)&&yn(n,t,i,i[2],e?vn(t,i[2],o,NE):bn(i[2]),K1)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function jE(r){let e,t;return e=new OE({props:{openOn:r[0],$$slots:{default:[$E,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.openOn=n[0]),i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function UE(r){return r?r[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function VE(r,e,t){let{$$slots:n={},$$scope:i}=e,{openOn:o="hover"}=e;return r.$$set=u=>{"openOn"in u&&t(0,o=u.openOn),"$$scope"in u&&t(2,i=u.$$scope)},[o,n,i]}class oi extends kt{constructor(e){super(),St(this,e,VE,jE,gt,{openOn:0})}}function Lo(r,e,t){let n=["match",r];for(let[i,o]of Object.entries(e))n.push(i),n.push(o);return n.push(t),n}function Bi(r,e,t){let n=["step",r];for(let i=1;i<e.length;i++)n.push(t[i-1]),n.push(e[i]);return n.push(t[t.length-1]),n}function ii(){return{type:"FeatureCollection",features:[]}}function Y1(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function Q1(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function eb(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function tb(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function nb(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function rb(r,e,t){const n=r.slice();return n[18]=e[t][0],n[19]=e[t][1],n}function qE(r){let e;return{c(){e=q("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#routenetwork" target="_blank">Data from NPT</a>',ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function ib(r){let e,t=r[19]+"",n;return{c(){e=q("option"),n=Te(t),e.__value=r[18],Gn(e,e.__value)},m(i,o){W(i,e,o),z(e,n)},p:ht,d(i){i&&H(e)}}}function ob(r){let e,t=r[19]+"",n;return{c(){e=q("option"),n=Te(t),e.__value=r[18],Gn(e,e.__value)},m(i,o){W(i,e,o),z(e,n)},p:ht,d(i){i&&H(e)}}}function sb(r){let e,t=r[19]+"",n;return{c(){e=q("option"),n=Te(t),e.__value=r[18],Gn(e,e.__value)},m(i,o){W(i,e,o),z(e,n)},p:ht,d(i){i&&H(e)}}}function ab(r){let e,t=r[19]+"",n;return{c(){e=q("option"),n=Te(t),e.__value=r[18],Gn(e,e.__value)},m(i,o){W(i,e,o),z(e,n)},p:ht,d(i){i&&H(e)}}}function GE(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U=zn(r[7]),O=[];for(let F=0;F<U.length;F+=1)O[F]=ib(rb(r,U,F));let ee=zn(r[8]),X=[];for(let F=0;F<ee.length;F+=1)X[F]=ob(nb(r,ee,F));let ue=zn(r[9]),$=[];for(let F=0;F<ue.length;F+=1)$[F]=sb(tb(r,ue,F));let Q=zn(r[10]),ne=[];for(let F=0;F<Q.length;F+=1)ne[F]=ab(eb(r,Q,F));return{c(){e=q("div"),t=q("label"),n=Te(`Trip purpose:
      `),i=q("select");for(let F=0;F<O.length;F+=1)O[F].c();o=ae(),u=q("label"),a=Te(`Scenario:
      `),d=q("select");for(let F=0;F<X.length;F+=1)X[F].c();m=ae(),_=q("label"),v=Te(`Network type:
      `),S=q("select");for(let F=0;F<$.length;F+=1)$[F].c();T=ae(),C=q("label"),L=Te(`Color by:
      `),P=q("select");for(let F=0;F<ne.length;F+=1)ne[F].c();r[0]===void 0&&Ks(()=>r[11].call(i)),r[1]===void 0&&Ks(()=>r[12].call(d)),r[2]===void 0&&Ks(()=>r[13].call(S)),r[3]===void 0&&Ks(()=>r[14].call(P)),ce(e,"slot","legend")},m(F,Z){W(F,e,Z),z(e,t),z(t,n),z(t,i);for(let J=0;J<O.length;J+=1)O[J]&&O[J].m(i,null);Mi(i,r[0],!0),z(e,o),z(e,u),z(u,a),z(u,d);for(let J=0;J<X.length;J+=1)X[J]&&X[J].m(d,null);Mi(d,r[1],!0),z(e,m),z(e,_),z(_,v),z(_,S);for(let J=0;J<$.length;J+=1)$[J]&&$[J].m(S,null);Mi(S,r[2],!0),z(e,T),z(e,C),z(C,L),z(C,P);for(let J=0;J<ne.length;J+=1)ne[J]&&ne[J].m(P,null);Mi(P,r[3],!0),D||(I=[_t(i,"change",r[11]),_t(d,"change",r[12]),_t(S,"change",r[13]),_t(P,"change",r[14])],D=!0)},p(F,Z){if(Z[0]&128){U=zn(F[7]);let J;for(J=0;J<U.length;J+=1){const be=rb(F,U,J);O[J]?O[J].p(be,Z):(O[J]=ib(be),O[J].c(),O[J].m(i,null))}for(;J<O.length;J+=1)O[J].d(1);O.length=U.length}if(Z[0]&129&&Mi(i,F[0]),Z[0]&256){ee=zn(F[8]);let J;for(J=0;J<ee.length;J+=1){const be=nb(F,ee,J);X[J]?X[J].p(be,Z):(X[J]=ob(be),X[J].c(),X[J].m(d,null))}for(;J<X.length;J+=1)X[J].d(1);X.length=ee.length}if(Z[0]&258&&Mi(d,F[1]),Z[0]&512){ue=zn(F[9]);let J;for(J=0;J<ue.length;J+=1){const be=tb(F,ue,J);$[J]?$[J].p(be,Z):($[J]=sb(be),$[J].c(),$[J].m(S,null))}for(;J<$.length;J+=1)$[J].d(1);$.length=ue.length}if(Z[0]&516&&Mi(S,F[2]),Z[0]&1024){Q=zn(F[10]);let J;for(J=0;J<Q.length;J+=1){const be=eb(F,Q,J);ne[J]?ne[J].p(be,Z):(ne[J]=ab(be),ne[J].c(),ne[J].m(P,null))}for(;J<ne.length;J+=1)ne[J].d(1);ne.length=Q.length}Z[0]&1032&&Mi(P,F[3])},d(F){F&&H(e),Jr(O,F),Jr(X,F),Jr($,F),Jr(ne,F),D=!1,Er(I)}}}function lb(r){let e,t,n,i,o=r[17][`${r[18]}_fastest_bicycle`].toLocaleString()+"",u,a,d,m=r[17][`${r[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"",_,v,S,T=r[17][`${r[18]}_fastest_bicycle_ebike`].toLocaleString()+"",C,L;return{c(){e=q("tr"),t=q("th"),t.textContent=`${r[19]}`,n=ae(),i=q("td"),u=Te(o),a=ae(),d=q("td"),_=Te(m),v=ae(),S=q("td"),C=Te(T),L=ae()},m(P,D){W(P,e,D),z(e,t),z(e,n),z(e,i),z(i,u),z(e,a),z(e,d),z(d,_),z(e,v),z(e,S),z(S,C),z(e,L)},p(P,D){D[0]&131072&&o!==(o=P[17][`${P[18]}_fastest_bicycle`].toLocaleString()+"")&&yt(u,o),D[0]&131072&&m!==(m=P[17][`${P[18]}_fastest_bicycle_go_dutch`].toLocaleString()+"")&&yt(_,m),D[0]&131072&&T!==(T=P[17][`${P[18]}_fastest_bicycle_ebike`].toLocaleString()+"")&&yt(C,T)},d(P){P&&H(e)}}}function ub(r){let e,t,n,i,o=r[17][`${r[18]}_quietest_bicycle`].toLocaleString()+"",u,a,d,m=r[17][`${r[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"",_,v,S,T=r[17][`${r[18]}_quietest_bicycle_ebike`].toLocaleString()+"",C,L;return{c(){e=q("tr"),t=q("th"),t.textContent=`${r[19]}`,n=ae(),i=q("td"),u=Te(o),a=ae(),d=q("td"),_=Te(m),v=ae(),S=q("td"),C=Te(T),L=ae()},m(P,D){W(P,e,D),z(e,t),z(e,n),z(e,i),z(i,u),z(e,a),z(e,d),z(d,_),z(e,v),z(e,S),z(S,C),z(e,L)},p(P,D){D[0]&131072&&o!==(o=P[17][`${P[18]}_quietest_bicycle`].toLocaleString()+"")&&yt(u,o),D[0]&131072&&m!==(m=P[17][`${P[18]}_quietest_bicycle_go_dutch`].toLocaleString()+"")&&yt(_,m),D[0]&131072&&T!==(T=P[17][`${P[18]}_quietest_bicycle_ebike`].toLocaleString()+"")&&yt(C,T)},d(P){P&&H(e)}}}function ZE(r){let e,t,n,i=r[17][r[4]].toLocaleString()+"",o,u,a,d,m=r[17].gradient+"",_,v,S,T,C,L=r[17].quietness+"",P,D,I,U,O,ee,X,ue,$,Q,ne,F,Z,J,be,ke,ge,ve=zn(r[7]),fe=[];for(let Fe=0;Fe<ve.length;Fe+=1)fe[Fe]=lb(Q1(r,ve,Fe));let Pe=zn(r[7]),Ee=[];for(let Fe=0;Fe<Pe.length;Fe+=1)Ee[Fe]=ub(Y1(r,Pe,Fe));return{c(){e=q("div"),t=q("p"),n=Te("Cyclists: "),o=Te(i),u=ae(),a=q("p"),d=Te("Gradient: "),_=Te(m),v=Te("%"),S=ae(),T=q("p"),C=Te("Cycle-friendliness: "),P=Te(L),D=Te("%"),I=ae(),U=q("details"),O=q("summary"),O.textContent="All network details",ee=ae(),X=q("p"),X.textContent="Fast/Direct network",ue=ae(),$=q("table"),Q=q("tr"),Q.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",ne=ae();for(let Fe=0;Fe<fe.length;Fe+=1)fe[Fe].c();F=ae(),Z=q("p"),Z.textContent="Quiet/Indirect network",J=ae(),be=q("table"),ke=q("tr"),ke.innerHTML="<td></td> <th>Baseline</th> <th>Go Dutch</th> <th>E-bikes</th>",ge=ae();for(let Fe=0;Fe<Ee.length;Fe+=1)Ee[Fe].c();Ze(e,"max-width","30vw"),Ze(e,"max-height","60vh"),Ze(e,"overflow","auto")},m(Fe,ot){W(Fe,e,ot),z(e,t),z(t,n),z(t,o),z(e,u),z(e,a),z(a,d),z(a,_),z(a,v),z(e,S),z(e,T),z(T,C),z(T,P),z(T,D),z(e,I),z(e,U),z(U,O),z(U,ee),z(U,X),z(U,ue),z(U,$),z($,Q),z($,ne);for(let ct=0;ct<fe.length;ct+=1)fe[ct]&&fe[ct].m($,null);z(U,F),z(U,Z),z(U,J),z(U,be),z(be,ke),z(be,ge);for(let ct=0;ct<Ee.length;ct+=1)Ee[ct]&&Ee[ct].m(be,null)},p(Fe,ot){if(ot[0]&131088&&i!==(i=Fe[17][Fe[4]].toLocaleString()+"")&&yt(o,i),ot[0]&131072&&m!==(m=Fe[17].gradient+"")&&yt(_,m),ot[0]&131072&&L!==(L=Fe[17].quietness+"")&&yt(P,L),ot[0]&131200){ve=zn(Fe[7]);let ct;for(ct=0;ct<ve.length;ct+=1){const it=Q1(Fe,ve,ct);fe[ct]?fe[ct].p(it,ot):(fe[ct]=lb(it),fe[ct].c(),fe[ct].m($,null))}for(;ct<fe.length;ct+=1)fe[ct].d(1);fe.length=ve.length}if(ot[0]&131200){Pe=zn(Fe[7]);let ct;for(ct=0;ct<Pe.length;ct+=1){const it=Y1(Fe,Pe,ct);Ee[ct]?Ee[ct].p(it,ot):(Ee[ct]=ub(it),Ee[ct].c(),Ee[ct].m(be,null))}for(;ct<Ee.length;ct+=1)Ee[ct].d(1);Ee.length=Pe.length}},d(Fe){Fe&&H(e),Jr(fe,Fe),Jr(Ee,Fe)}}}function HE(r){let e,t;return e=new oi({props:{openOn:"click",$$slots:{default:[ZE,({props:n})=>({17:n}),({props:n})=>[n?131072:0]]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i[0]&131088|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function WE(r){let e,t;const n=[sn("context-route-network"),{sourceLayer:"rnet"},{paint:{"line-color":r[6],"line-width":cb(["get",r[4]])}},{layout:{visibility:r[5]?"visible":"none"}},{hoverCursor:"pointer"}];let i={$$slots:{default:[HE]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a=u[0]&112?Tn(n,[n[0],n[1],u[0]&80&&{paint:{"line-color":o[6],"line-width":cb(["get",o[4]])}},u[0]&32&&{layout:{visibility:o[5]?"visible":"none"}},n[4]]):{};u[0]&16|u[1]&2&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function XE(r){let e,t,n,i,o;function u(d){r[15](d)}let a={label:"Estimated cycling demand",$$slots:{legend:[GE],help:[qE]},$$scope:{ctx:r}};return r[5]!==void 0&&(a.show=r[5]),e=new Do({props:a}),wn.push(()=>On(e,"show",u)),i=new Kf({props:{url:`pmtiles://${fs("cnt/layers/route_network.pmtiles")}`,$$slots:{default:[WE]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),n=ae(),pe(i.$$.fragment)},m(d,m){de(e,d,m),W(d,n,m),de(i,d,m),o=!0},p(d,m){const _={};m[0]&15|m[1]&2&&(_.$$scope={dirty:m,ctx:d}),!t&&m[0]&32&&(t=!0,_.show=d[5],Nn(()=>t=!1)),e.$set(_);const v={};m[0]&112|m[1]&2&&(v.$$scope={dirty:m,ctx:d}),i.$set(v)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){G(e.$$.fragment,d),G(i.$$.fragment,d),o=!1},d(d){d&&H(n),he(e,d),he(i,d)}}}function cb(r){return["let","base",["+",.3,["/",3,["+",1,["^",2.718,["-",2.94,["*",r,.0021]]]]]],["interpolate",["linear"],["zoom"],12,["*",2.1,["var","base"]],14,["*",5.25,["var","base"]],15,["*",7.5,["var","base"]],16,["*",18,["var","base"]],18,["*",52.5,["var","base"]]]]}function JE(r){return["step",r,"rgba(0,0,0,0)",1,"#9C9C9C",50,"#FFFF73",100,"#AFFF00",250,"#00FFFF",500,"#30B0FF",1e3,"#2E5FFF",2e3,"#0000FF",3e3,"#FF00C5"]}function KE(r,e,t){let n,i,o=!1,u="all",a="bicycle_go_dutch",d="fastest",m="flow",_=[["all","All"],["commute","Commute"],["primary","Primary School"],["secondary","Secondary"],["utility","Other everyday"]],v=[["bicycle","Baseline"],["bicycle_go_dutch","Go Dutch"],["bicycle_ebike","E-bike"]],S=[["fastest","Fast/Direct"],["quietest","Quiet/Indirect"]],T=[["none","None"],["flow","People cycling per day"],["quietness","Cycle friendliness"],["gradient","Gradient"]],C={colorScale:["#59ee19","#37a009","#FFC300","#C70039","#581845","#000000"],limits:[3,5,7,10,100]};function L(){u=Ys(this),t(0,u),t(7,_)}function P(){a=Ys(this),t(1,a),t(8,v)}function D(){d=Ys(this),t(2,d),t(9,S)}function I(){m=Ys(this),t(3,m),t(10,T)}function U(O){o=O,t(5,o)}return r.$$.update=()=>{r.$$.dirty[0]&7&&t(4,n=`${u}_${d}_${a}`),r.$$.dirty[0]&24&&t(6,i={none:"#304ce7",flow:JE(["get",n]),quietness:["step",["get","quietness"],"#882255",25,"#CC6677",50,"#44AA99",75,"#117733",101,"#000000"],gradient:Bi(["abs",["get","gradient"]],C.limits,C.colorScale)}[m])},[u,a,d,m,n,o,i,_,v,S,T,L,P,D,I,U]}class YE extends kt{constructor(e){super(),St(this,e,KE,XE,gt,{},null,[-1,-1])}}function QE(r){let e,t,n;return t=new $g({props:{labelColors:r[5]}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","legend")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p:ht,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function eI(r){let e;return{c(){e=q("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function tI(r){let e,t,n;return t=new Qi({props:{colorScale:Object.values(r[4]),labels:{buckets:Object.keys(r[4])},fullWidthBucketLegend:!0}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","legend")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p:ht,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function nI(r){let e;return{c(){e=q("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function rI(r){let e,t,n;return t=new Qi({props:{colorScale:r[3].colorScale,labels:{limits:r[3].limits}}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","legend")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p:ht,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function iI(r){let e;return{c(){e=q("p"),e.innerHTML='<a href="https://nptscot.github.io/manual/#infrastructureandtraffic" target="_blank">Data from NPT</a>',ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function oI(r){let e,t,n,i,o,u;const a=[sn("context-traffic"),{sourceLayer:"cbd_layer"},{filter:["has","Traffic volume category"]},{paint:{"line-color":Lo(["get","Traffic volume category"],{"0 to 1999":r[3].colorScale[0],"2000 to 3999":r[3].colorScale[1],"4000+":r[3].colorScale[2]},"cyan"),"line-width":Xs(0)}},{layout:{visibility:r[0]?"visible":"none"}}];let d={};for(let T=0;T<a.length;T+=1)d=wt(d,a[T]);e=new gr({props:d});const m=[sn("context-los"),{sourceLayer:"cbd_layer"},{paint:{"line-color":Lo(["get","Level of Service"],r[4],"cyan"),"line-width":Xs(1)}},{layout:{visibility:r[1]?"visible":"none"}}];let _={};for(let T=0;T<m.length;T+=1)_=wt(_,m[T]);n=new gr({props:_});const v=[sn("context-existing-infra"),{sourceLayer:"cbd_layer"},{filter:["!=",["get","Infrastructure type"],"Mixed Traffic Street"]},{paint:{"line-color":Lo(["get","Infrastructure type"],r[5],"cyan"),"line-width":Xs(1)}},{layout:{visibility:r[2]?"visible":"none"}}];let S={};for(let T=0;T<v.length;T+=1)S=wt(S,v[T]);return o=new gr({props:S}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment)},m(T,C){de(e,T,C),W(T,t,C),de(n,T,C),W(T,i,C),de(o,T,C),u=!0},p(T,C){const L=C&9?Tn(a,[a[0],a[1],a[2],C&8&&{paint:{"line-color":Lo(["get","Traffic volume category"],{"0 to 1999":T[3].colorScale[0],"2000 to 3999":T[3].colorScale[1],"4000+":T[3].colorScale[2]},"cyan"),"line-width":Xs(0)}},C&1&&{layout:{visibility:T[0]?"visible":"none"}}]):{};e.$set(L);const P=C&18?Tn(m,[m[0],m[1],C&16&&{paint:{"line-color":Lo(["get","Level of Service"],T[4],"cyan"),"line-width":Xs(1)}},C&2&&{layout:{visibility:T[1]?"visible":"none"}}]):{};n.$set(P);const D=C&36?Tn(v,[v[0],v[1],v[2],C&32&&{paint:{"line-color":Lo(["get","Infrastructure type"],T[5],"cyan"),"line-width":Xs(1)}},C&4&&{layout:{visibility:T[2]?"visible":"none"}}]):{};o.$set(D)},i(T){u||(N(e.$$.fragment,T),N(n.$$.fragment,T),N(o.$$.fragment,T),u=!0)},o(T){G(e.$$.fragment,T),G(n.$$.fragment,T),G(o.$$.fragment,T),u=!1},d(T){T&&(H(t),H(i)),he(e,T),he(n,T),he(o,T)}}}function sI(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L;function P(X){r[6](X)}let D={label:"Existing cycling infrastructure",$$slots:{help:[eI],legend:[QE]},$$scope:{ctx:r}};r[2]!==void 0&&(D.show=r[2]),e=new Do({props:D}),wn.push(()=>On(e,"show",P));function I(X){r[7](X)}let U={label:"Cycling safety Level of Service",$$slots:{help:[nI],legend:[tI]},$$scope:{ctx:r}};r[1]!==void 0&&(U.show=r[1]),i=new Do({props:U}),wn.push(()=>On(i,"show",I)),a=new YE({});function O(X){r[8](X)}let ee={label:"Estimated traffic",$$slots:{help:[iI],legend:[rI]},$$scope:{ctx:r}};return r[0]!==void 0&&(ee.show=r[0]),v=new Do({props:ee}),wn.push(()=>On(v,"show",O)),C=new Kf({props:{url:`pmtiles://${fs("cnt/layers/cbd.pmtiles")}`,$$slots:{default:[oI]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),n=ae(),pe(i.$$.fragment),u=ae(),pe(a.$$.fragment),d=ae(),m=q("div"),m.textContent="Other",_=ae(),pe(v.$$.fragment),T=ae(),pe(C.$$.fragment),ce(m,"class","layer-group")},m(X,ue){de(e,X,ue),W(X,n,ue),de(i,X,ue),W(X,u,ue),de(a,X,ue),W(X,d,ue),W(X,m,ue),W(X,_,ue),de(v,X,ue),W(X,T,ue),de(C,X,ue),L=!0},p(X,[ue]){const $={};ue&512&&($.$$scope={dirty:ue,ctx:X}),!t&&ue&4&&(t=!0,$.show=X[2],Nn(()=>t=!1)),e.$set($);const Q={};ue&512&&(Q.$$scope={dirty:ue,ctx:X}),!o&&ue&2&&(o=!0,Q.show=X[1],Nn(()=>o=!1)),i.$set(Q);const ne={};ue&512&&(ne.$$scope={dirty:ue,ctx:X}),!S&&ue&1&&(S=!0,ne.show=X[0],Nn(()=>S=!1)),v.$set(ne);const F={};ue&519&&(F.$$scope={dirty:ue,ctx:X}),C.$set(F)},i(X){L||(N(e.$$.fragment,X),N(i.$$.fragment,X),N(a.$$.fragment,X),N(v.$$.fragment,X),N(C.$$.fragment,X),L=!0)},o(X){G(e.$$.fragment,X),G(i.$$.fragment,X),G(a.$$.fragment,X),G(v.$$.fragment,X),G(C.$$.fragment,X),L=!1},d(X){X&&(H(n),H(u),H(d),H(m),H(_),H(T)),he(e,X),he(i,X),he(a,X),he(v,X),he(C,X)}}}function aI(r,e,t){let n=!1,i=!1,o=!1,u={colorScale:["#27918d","#ffaa33","#440154"],limits:[0,2e3,4e3,1e4]},a={High:"mediumseagreen",Medium:"orange",Low:"red","Should not be used":"brown"},d={"Segregated Track (wide)":"#054d05","Off Road Cycleway":"#3a9120","Segregated Track (narrow)":"#87d668","Shared Footway":"#ffbf00","Painted Cycle Lane":"#7faedd"};function m(S){o=S,t(2,o)}function _(S){i=S,t(1,i)}function v(S){n=S,t(0,n)}return[n,i,o,u,a,d,m,_,v]}class lI extends kt{constructor(e){super(),St(this,e,aI,sI,gt,{})}}function uI(r){let e,t,n;return t=new $g({props:{labelColors:r[2],swatchClass:"circle"}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","legend")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p:ht,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function cI(r){let e;return{c(){e=q("p"),e.innerHTML=`See Scottish data sources for
    <a href="https://www.data.gov.uk/dataset/9a6f9d86-9698-4a5d-a2c8-89f3b212c52c/scottish-school-roll-and-locations" target="_blank">schools</a>
    ,
    <a href="https://data.spatialhub.scot/dataset/gp_practices-is" target="_blank">GP practices</a>
    , and
    <a href="https://data.spatialhub.scot/dataset/nhs_hospitals-is" target="_blank">hospitals</a>
    . Other data is from
    <a href="https://www.openstreetmap.org/about" target="_blank">OpenStreetMap</a>
    .`,ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function fb(r){let e,t;return e=new yr({props:{data:r[1].getPOIs(),generateId:!0,$$slots:{default:[dI]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.data=n[1].getPOIs()),i&33&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function fI(r){let e=(r[4].name||`unnamed ${r[4].kind}`)+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i&16&&e!==(e=(n[4].name||`unnamed ${n[4].kind}`)+"")&&yt(t,e)},d(n){n&&H(t)}}}function hI(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[fI,({props:n})=>({4:n}),({props:n})=>n?16:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&48&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function dI(r){let e,t;const n=[sn("context-pois"),{paint:{"circle-color":Lo(["get","kind"],r[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},{layout:{visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[hI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Ml({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a=u&5?Tn(n,[n[0],u&4&&{paint:{"circle-color":Lo(["get","kind"],o[2],"black"),"circle-radius":10,"circle-stroke-color":"black","circle-stroke-width":1,"circle-opacity":.8}},u&1&&{layout:{visibility:o[0]?"visible":"none"}}]):{};u&32&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function pI(r){let e,t,n,i,o;function u(m){r[3](m)}let a={label:"POIs",$$slots:{help:[cI],legend:[uI]},$$scope:{ctx:r}};r[0]!==void 0&&(a.show=r[0]),e=new Do({props:a}),wn.push(()=>On(e,"show",u));let d=r[1]&&fb(r);return{c(){pe(e.$$.fragment),n=ae(),d&&d.c(),i=rr()},m(m,_){de(e,m,_),W(m,n,_),d&&d.m(m,_),W(m,i,_),o=!0},p(m,[_]){const v={};_&32&&(v.$$scope={dirty:_,ctx:m}),!t&&_&1&&(t=!0,v.show=m[0],Nn(()=>t=!1)),e.$set(v),m[1]?d?(d.p(m,_),_&2&&N(d,1)):(d=fb(m),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Zt(),G(d,1,1,()=>{d=null}),Ht())},i(m){o||(N(e.$$.fragment,m),N(d),o=!0)},o(m){G(e.$$.fragment,m),G(d),o=!1},d(m){m&&(H(n),H(i)),he(e,m),d&&d.d(m)}}}function mI(r,e,t){let n;rt(r,Cr,a=>t(1,n=a));let i=!1,o={School:"#7fc97f",GP:"#beaed4",Hospital:"#fdc086",Grocery:"#386cb0",CommunityCenter:"#ffff99",Recreation:"#f0027f"};function u(a){i=a,t(0,i)}return[i,n,o,u]}class gI extends kt{constructor(e){super(),St(this,e,mI,pI,gt,{})}}function _I(r){let e,t,n,i,o;return t=new Qi({props:{colorScale:rh.toReversed(),labels:{buckets:x2(ih).toReversed()}}}),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("div"),i.innerHTML="<span>Less deprived</span> <span>More deprived</span>",Ze(i,"display","flex"),Ze(i,"justify-content","space-between"),ce(e,"slot","legend")},m(u,a){W(u,e,a),de(t,e,null),z(e,n),z(e,i),o=!0},p:ht,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),o=!1},d(u){u&&H(e),he(t)}}}function yI(r){let e;return{c(){e=q("p"),e.innerHTML=`This shows the Scottish Index of Multiple Deprivation (SIMD) from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    . SIMD combines different domains: income; employment; health; education, skills
    and training; geographic access to services; crime; and housing.`,ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function bI(r){let e,t,n,i,o;return t=new Qi({props:{colorScale:Gu,labels:{limits:r[3].population_density}}}),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("div"),i.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",Ze(i,"display","flex"),Ze(i,"justify-content","space-between"),ce(e,"slot","legend")},m(u,a){W(u,e,a),de(t,e,null),z(e,n),z(e,i),o=!0},p(u,a){const d={};a&8&&(d.labels={limits:u[3].population_density}),t.$set(d)},i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),o=!1},d(u){u&&H(e),he(t)}}}function vI(r){let e;return{c(){e=q("p"),e.innerHTML=`This shows population data from <a href="https://www.data.gov.uk/dataset/1102bf85-ed49-440a-b211-da87e8d752eb/scottish-index-of-multiple-deprivation-simd-2020" target="_blank">2020 data</a>
    .`,ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function wI(r){let e,t,n,i,o;return t=new Qi({props:{colorScale:sh.toReversed(),labels:{limits:oh.toReversed().map(LI)}}}),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("div"),i.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ze(i,"display","flex"),Ze(i,"justify-content","space-between"),ce(e,"slot","legend")},m(u,a){W(u,e,a),de(t,e,null),z(e,n),z(e,i),o=!0},p:ht,i(u){o||(N(t.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),o=!1},d(u){u&&H(e),he(t)}}}function xI(r){let e;return{c(){e=q("p"),e.textContent="Show households from the Scottish census with at least one car.",ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function AI(r){let e,t,n=r[10].id+"",i,o,u=r[10].population.toLocaleString()+"",a,d,m=r[10].imd_rank+"",_,v,S=r[10].imd_percentile+"",T,C;return{c(){e=q("p"),t=Te("Data zone "),i=Te(n),o=Te(`
        has `),a=Te(u),d=Te(`
        people, and a SIMD rank of `),_=Te(m),v=Te(`, making it less deprived
        than `),T=Te(S),C=Te("% of data zones.")},m(L,P){W(L,e,P),z(e,t),z(e,i),z(e,o),z(e,a),z(e,d),z(e,_),z(e,v),z(e,T),z(e,C)},p(L,P){P&1024&&n!==(n=L[10].id+"")&&yt(i,n),P&1024&&u!==(u=L[10].population.toLocaleString()+"")&&yt(a,u),P&1024&&m!==(m=L[10].imd_rank+"")&&yt(_,m),P&1024&&S!==(S=L[10].imd_percentile+"")&&yt(T,S)},d(L){L&&H(e)}}}function kI(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[AI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function SI(r){let e,t,n=r[10].id+"",i,o,u=Zu(r[10].households_with_cars_or_vans,r[10].total_households)+"",a,d,m=r[10].total_households.toLocaleString()+"",_,v;return{c(){e=q("p"),t=Te("In data zone "),i=Te(n),o=ae(),a=Te(u),d=Te(" of approximately "),_=Te(m),v=Te(`
        households have at least one car or van.`)},m(S,T){W(S,e,T),z(e,t),z(e,i),z(e,o),z(e,a),z(e,d),z(e,_),z(e,v)},p(S,T){T&1024&&n!==(n=S[10].id+"")&&yt(i,n),T&1024&&u!==(u=Zu(S[10].households_with_cars_or_vans,S[10].total_households)+"")&&yt(a,u),T&1024&&m!==(m=S[10].total_households.toLocaleString()+"")&&yt(_,m)},d(S){S&&H(e)}}}function TI(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[SI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function CI(r){let e,t,n=r[10].id+"",i,o,u=r[10].population.toLocaleString()+"",a,d,m=Math.round(r[10].population/(r[10].area/1e6)).toLocaleString()+"",_,v;return{c(){e=q("p"),t=Te("Data zone "),i=Te(n),o=Te(`
        has `),a=Te(u),d=Te(`
        people, with a density of `),_=Te(m),v=Te(" people per square kilometer")},m(S,T){W(S,e,T),z(e,t),z(e,i),z(e,o),z(e,a),z(e,d),z(e,_),z(e,v)},p(S,T){T&1024&&n!==(n=S[10].id+"")&&yt(i,n),T&1024&&u!==(u=S[10].population.toLocaleString()+"")&&yt(a,u),T&1024&&m!==(m=Math.round(S[10].population/(S[10].area/1e6)).toLocaleString()+"")&&yt(_,m)},d(S){S&&H(e)}}}function MI(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[CI,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&3072&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function EI(r){let e,t,n,i,o,u,a,d;const m=[sn("context-simd"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Bi(["get","imd_percentile"],ih,rh),"fill-opacity":nr(.7,.9)}},{layout:{visibility:r[0]?"visible":"none"}}];let _={$$slots:{default:[kI]},$$scope:{ctx:r}};for(let D=0;D<m.length;D+=1)_=wt(_,m[D]);e=new Zi({props:_});const v=[sn("context-population-car-ownership"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Bi(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],oh,sh),"fill-opacity":nr(.7,.9)}},{layout:{visibility:r[2]?"visible":"none"}}];let S={$$slots:{default:[TI]},$$scope:{ctx:r}};for(let D=0;D<v.length;D+=1)S=wt(S,v[D]);n=new Zi({props:S});const T=[sn("context-population-density"),{sourceLayer:"population"},{manageHoverState:!0},{paint:{"fill-color":Bi(["/",["get","population"],["/",["get","area"],1e6]],r[3].population_density,Gu),"fill-opacity":nr(.7,.9)}},{layout:{visibility:r[1]?"visible":"none"}}];let C={$$slots:{default:[MI]},$$scope:{ctx:r}};for(let D=0;D<T.length;D+=1)C=wt(C,T[D]);o=new Zi({props:C});const L=[sn("context-population-outline"),{sourceLayer:"population"},{paint:{"line-color":"black","line-width":1}},{layout:{visibility:r[0]||r[1]||r[2]?"visible":"none"}}];let P={};for(let D=0;D<L.length;D+=1)P=wt(P,L[D]);return a=new gr({props:P}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment)},m(D,I){de(e,D,I),W(D,t,I),de(n,D,I),W(D,i,I),de(o,D,I),W(D,u,I),de(a,D,I),d=!0},p(D,I){const U=I&1?Tn(m,[m[0],m[1],m[2],m[3],{layout:{visibility:D[0]?"visible":"none"}}]):{};I&2048&&(U.$$scope={dirty:I,ctx:D}),e.$set(U);const O=I&4?Tn(v,[v[0],v[1],v[2],v[3],{layout:{visibility:D[2]?"visible":"none"}}]):{};I&2048&&(O.$$scope={dirty:I,ctx:D}),n.$set(O);const ee=I&10?Tn(T,[T[0],T[1],T[2],I&8&&{paint:{"fill-color":Bi(["/",["get","population"],["/",["get","area"],1e6]],D[3].population_density,Gu),"fill-opacity":nr(.7,.9)}},I&2&&{layout:{visibility:D[1]?"visible":"none"}}]):{};I&2048&&(ee.$$scope={dirty:I,ctx:D}),o.$set(ee);const X=I&7?Tn(L,[L[0],L[1],L[2],{layout:{visibility:D[0]||D[1]||D[2]?"visible":"none"}}]):{};a.$set(X)},i(D){d||(N(e.$$.fragment,D),N(n.$$.fragment,D),N(o.$$.fragment,D),N(a.$$.fragment,D),d=!0)},o(D){G(e.$$.fragment,D),G(n.$$.fragment,D),G(o.$$.fragment,D),G(a.$$.fragment,D),d=!1},d(D){D&&(H(t),H(i),H(u)),he(e,D),he(n,D),he(o,D),he(a,D)}}}function II(r){let e,t,n,i,o,u,a,d,m,_,v;function S(I){r[5](I)}let T={label:"SIMD",onChange:r[4],$$slots:{help:[yI],legend:[_I]},$$scope:{ctx:r}};r[0]!==void 0&&(T.show=r[0]),e=new Do({props:T}),wn.push(()=>On(e,"show",S));function C(I){r[7](I)}let L={label:"Population density",onChange:r[6],$$slots:{help:[vI],legend:[bI]},$$scope:{ctx:r}};r[1]!==void 0&&(L.show=r[1]),i=new Do({props:L}),wn.push(()=>On(i,"show",C));function P(I){r[9](I)}let D={label:"Car ownership",onChange:r[8],$$slots:{help:[xI],legend:[wI]},$$scope:{ctx:r}};return r[2]!==void 0&&(D.show=r[2]),a=new Do({props:D}),wn.push(()=>On(a,"show",P)),_=new Kf({props:{url:`pmtiles://${fs("cnt/layers/population.pmtiles")}`,$$slots:{default:[EI]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),n=ae(),pe(i.$$.fragment),u=ae(),pe(a.$$.fragment),m=ae(),pe(_.$$.fragment)},m(I,U){de(e,I,U),W(I,n,U),de(i,I,U),W(I,u,U),de(a,I,U),W(I,m,U),de(_,I,U),v=!0},p(I,[U]){const O={};U&7&&(O.onChange=I[4]),U&2048&&(O.$$scope={dirty:U,ctx:I}),!t&&U&1&&(t=!0,O.show=I[0],Nn(()=>t=!1)),e.$set(O);const ee={};U&7&&(ee.onChange=I[6]),U&2056&&(ee.$$scope={dirty:U,ctx:I}),!o&&U&2&&(o=!0,ee.show=I[1],Nn(()=>o=!1)),i.$set(ee);const X={};U&7&&(X.onChange=I[8]),U&2048&&(X.$$scope={dirty:U,ctx:I}),!d&&U&4&&(d=!0,X.show=I[2],Nn(()=>d=!1)),a.$set(X);const ue={};U&2063&&(ue.$$scope={dirty:U,ctx:I}),_.$set(ue)},i(I){v||(N(e.$$.fragment,I),N(i.$$.fragment,I),N(a.$$.fragment,I),N(_.$$.fragment,I),v=!0)},o(I){G(e.$$.fragment,I),G(i.$$.fragment,I),G(a.$$.fragment,I),G(_.$$.fragment,I),v=!1},d(I){I&&(H(n),H(u),H(m)),he(e,I),he(i,I),he(a,I),he(_,I)}}}const LI=r=>`${r}%`;function PI(r,e,t){let n;rt(r,Qu,T=>t(3,n=T));let i=!1,o=!1,u=!1;const a=()=>{i&&(t(1,o=!1),t(2,u=!1))};function d(T){i=T,t(0,i)}const m=()=>{o&&(t(0,i=!1),t(2,u=!1))};function _(T){o=T,t(1,o)}const v=()=>{u&&(t(0,i=!1),t(1,o=!1))};function S(T){u=T,t(2,u)}return[i,o,u,n,a,d,m,_,v,S]}class zI extends kt{constructor(e){super(),St(this,e,PI,II,gt,{})}}function DI(r){let e;return{c(){e=q("div"),e.innerHTML=`<img src="${sw}" alt="National Rail logo"/>
    Station`,ce(e,"slot","legend"),Ze(e,"display","flex"),Ze(e,"gap","8px"),Ze(e,"align-items","center")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function RI(r){let e;return{c(){e=q("p"),e.innerHTML=`These are all <a href="https://wiki.openstreetmap.org/wiki/Tag:railway%3Dstation" target="_blank">railway stations</a>
    according to OpenStreetMap.`,ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function BI(r){let e,t=(r[2].name??"Unnamed railway station")+"",n;return{c(){e=q("p"),n=Te(t)},m(i,o){W(i,e,o),z(e,n)},p(i,o){o&4&&t!==(t=(i[2].name??"Unnamed railway station")+"")&&yt(n,t)},d(i){i&&H(e)}}}function FI(r){let e,t;return e=new oi({props:{$$slots:{default:[BI,({props:n})=>({2:n}),({props:n})=>n?4:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&12&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function OI(r){let e,t;const n=[sn("context-railway-stations"),{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:r[0]?"visible":"none"}}];let i={$$slots:{default:[FI]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Nu({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a=u&1?Tn(n,[n[0],{layout:{"icon-image":"national_rail","icon-size":1,"icon-allow-overlap":!0,visibility:o[0]?"visible":"none"}}]):{};u&8&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function NI(r){let e,t,n,i,o;function u(d){r[1](d)}let a={label:"Railway stations",$$slots:{help:[RI],legend:[DI]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new Do({props:a}),wn.push(()=>On(e,"show",u)),i=new yr({props:{data:fs("cnt/layers/railways.geojson"),generateId:!0,$$slots:{default:[OI]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),n=ae(),pe(i.$$.fragment)},m(d,m){de(e,d,m),W(d,n,m),de(i,d,m),o=!0},p(d,[m]){const _={};m&8&&(_.$$scope={dirty:m,ctx:d}),!t&&m&1&&(t=!0,_.show=d[0],Nn(()=>t=!1)),e.$set(_);const v={};m&9&&(v.$$scope={dirty:m,ctx:d}),i.$set(v)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){G(e.$$.fragment,d),G(i.$$.fragment,d),o=!1},d(d){d&&H(n),he(e,d),he(i,d)}}}function $I(r,e,t){let n=!1;function i(o){n=o,t(0,n)}return[n,i]}class jI extends kt{constructor(e){super(),St(this,e,$I,NI,gt,{})}}function UI(r){let e;return{c(){e=q("div"),e.innerHTML=`<p>This layer shows collisions recorded in the <a href="https://www.data.gov.uk/dataset/cb7ae6f0-4be6-4935-9277-47e5ce24a11f/road-safety-data" target="_blank">DfT stats19</a>
      dataset, as of 30 September 2024. Please note these limitations:</p> <ul><li>Only collisions between 2017 and 2023 are included</li> <li>This tool is intended to be used when zoomed into the map, while
        inspecting a scheme or development area. Not all points are shown when
        zoomed out and showing large areas. Do not use this to look for trends
        across a city or region scale.</li> <li>Approximately 150 collisions from the source data aren&#39;t included, due
        to problems with the recorded location</li> <li>The &quot;pedestrians&quot; category also include mobility scooters</li> <li>All limitations <a href="https://www.gov.uk/guidance/road-accident-and-safety-statistics-guidance" target="_blank">documented by DfT</a>
        also apply. Not all collisions or near misses are reported. There&#39;s nuance
        with the severity categories.</li></ul> <p>You can click a point to open the full report, thanks to CycleStreets.</p> <p>License: <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/" target="_blank">Open Government License</a>
      . Contains OS data  Crown copyright and database right 2025.</p>`,ce(e,"slot","help")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function VI(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U,O,ee,X,ue;return O=new $g({props:{labelColors:r[6],swatchClass:"circle",itemsPerRow:3}}),{c(){e=q("div"),t=q("fieldset"),n=q("label"),i=q("input"),o=Te(`
        Pedestrians`),u=ae(),a=q("label"),d=q("input"),m=Te(`
        Cyclists`),_=ae(),v=q("fieldset"),S=q("label"),T=Te(`From
        `),C=q("input"),L=ae(),P=q("label"),D=Te(`To
        `),I=q("input"),U=ae(),pe(O.$$.fragment),ce(i,"type","checkbox"),ce(i,"class","svelte-rvrx5w"),ce(d,"type","checkbox"),ce(d,"class","svelte-rvrx5w"),Ze(t,"display","flex"),Ze(t,"gap","3em"),ce(t,"class","svelte-rvrx5w"),ce(C,"type","number"),ce(C,"min",2017),ce(C,"max",2023),ce(C,"class","svelte-rvrx5w"),ce(I,"type","number"),ce(I,"min",2017),ce(I,"max",2023),ce(I,"class","svelte-rvrx5w"),ce(v,"class","year-filter svelte-rvrx5w"),ce(e,"slot","legend")},m($,Q){W($,e,Q),z(e,t),z(t,n),z(n,i),i.checked=r[1].pedestrians,z(n,o),z(t,u),z(t,a),z(a,d),d.checked=r[1].cyclists,z(a,m),z(e,_),z(e,v),z(v,S),z(S,T),z(S,C),Gn(C,r[1].minYear),z(v,L),z(v,P),z(P,D),z(P,I),Gn(I,r[1].maxYear),z(e,U),de(O,e,null),ee=!0,X||(ue=[_t(i,"change",r[7]),_t(d,"change",r[8]),_t(C,"input",r[9]),_t(I,"input",r[10])],X=!0)},p($,Q){Q&2&&(i.checked=$[1].pedestrians),Q&2&&(d.checked=$[1].cyclists),Q&2&&kl(C.value)!==$[1].minYear&&Gn(C,$[1].minYear),Q&2&&kl(I.value)!==$[1].maxYear&&Gn(I,$[1].maxYear)},i($){ee||(N(O.$$.fragment,$),ee=!0)},o($){G(O.$$.fragment,$),ee=!1},d($){$&&H(e),he(O),X=!1,Er(ue)}}}function hb(r){let e,t,n,i=r[3][r[12].pedestrian_location]+"",o;return{c(){e=q("p"),t=Te("Pedestrian location: "),n=q("b"),o=Te(i)},m(u,a){W(u,e,a),z(e,t),z(e,n),z(n,o)},p(u,a){a&4096&&i!==(i=u[3][u[12].pedestrian_location]+"")&&yt(o,i)},d(u){u&&H(e)}}}function db(r){let e,t,n,i=r[4][r[12].pedestrian_movement]+"",o;return{c(){e=q("p"),t=Te("Pedestrian movement: "),n=q("b"),o=Te(i)},m(u,a){W(u,e,a),z(e,t),z(e,n),z(n,o)},p(u,a){a&4096&&i!==(i=u[4][u[12].pedestrian_movement]+"")&&yt(o,i)},d(u){u&&H(e)}}}function qI(r){let e,t,n,i=r[12].year+"",o,u,a,d,m,_=r[5][r[12].severity]+"",v,S,T,C,L,P=pb(r[12])+"",D,I,U,O,ee,X=r[12].pedestrian_location&&hb(r),ue=r[12].pedestrian_movement&&db(r);return{c(){e=q("p"),t=Te("Year: "),n=q("b"),o=Te(i),u=ae(),a=q("p"),d=Te("Severity: "),m=q("b"),v=Te(_),S=ae(),T=q("p"),C=Te("Casualties: "),L=q("b"),D=Te(P),I=ae(),X&&X.c(),U=ae(),ue&&ue.c(),O=ae(),ee=q("p"),ee.textContent="Click to open full report in CycleStreets"},m($,Q){W($,e,Q),z(e,t),z(e,n),z(n,o),W($,u,Q),W($,a,Q),z(a,d),z(a,m),z(m,v),W($,S,Q),W($,T,Q),z(T,C),z(T,L),z(L,D),W($,I,Q),X&&X.m($,Q),W($,U,Q),ue&&ue.m($,Q),W($,O,Q),W($,ee,Q)},p($,Q){Q&4096&&i!==(i=$[12].year+"")&&yt(o,i),Q&4096&&_!==(_=$[5][$[12].severity]+"")&&yt(v,_),Q&4096&&P!==(P=pb($[12])+"")&&yt(D,P),$[12].pedestrian_location?X?X.p($,Q):(X=hb($),X.c(),X.m(U.parentNode,U)):X&&(X.d(1),X=null),$[12].pedestrian_movement?ue?ue.p($,Q):(ue=db($),ue.c(),ue.m(O.parentNode,O)):ue&&(ue.d(1),ue=null)},d($){$&&(H(e),H(u),H(a),H(S),H(T),H(I),H(U),H(O),H(ee)),X&&X.d($),ue&&ue.d($)}}}function GI(r){let e,t;return e=new oi({props:{$$slots:{default:[qI,({props:n})=>({12:n}),({props:n})=>n?4096:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&12288&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function ZI(r){let e,t,n,i;const o=[sn("context-stats19-heatmap"),{sourceLayer:"stats19"},{maxzoom:13},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{paint:{"heatmap-radius":["interpolate",["linear"],["zoom"],0,2,9,15]}}];let u={};for(let m=0;m<o.length;m+=1)u=wt(u,o[m]);e=new o4({props:u});const a=[sn("context-stats19-points"),{sourceLayer:"stats19"},{minzoom:13},{paint:{"circle-color":Bi(["get","severity"],[1,2,3],[bg,vg,wg]),"circle-opacity":.9,"circle-radius":13,"circle-stroke-color":"black","circle-stroke-width":.1}},{filter:r[2](r[1])},{layout:{visibility:r[0]?"visible":"none"}},{hoverCursor:"pointer"}];let d={$$slots:{default:[GI]},$$scope:{ctx:r}};for(let m=0;m<a.length;m+=1)d=wt(d,a[m]);return n=new Ml({props:d}),n.$on("click",WI),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),i=!0},p(m,_){const v=_&7?Tn(o,[o[0],o[1],o[2],_&6&&{filter:m[2](m[1])},_&1&&{layout:{visibility:m[0]?"visible":"none"}},o[5]]):{};e.$set(v);const S=_&7?Tn(a,[a[0],a[1],a[2],_&0&&{paint:{"circle-color":Bi(["get","severity"],[1,2,3],[bg,vg,wg]),"circle-opacity":.9,"circle-radius":13,"circle-stroke-color":"black","circle-stroke-width":.1}},_&6&&{filter:m[2](m[1])},_&1&&{layout:{visibility:m[0]?"visible":"none"}},a[6]]):{};_&8192&&(S.$$scope={dirty:_,ctx:m}),n.$set(S)},i(m){i||(N(e.$$.fragment,m),N(n.$$.fragment,m),i=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),i=!1},d(m){m&&H(t),he(e,m),he(n,m)}}}function HI(r){let e,t,n,i,o;function u(d){r[11](d)}let a={label:"Collisions",$$slots:{legend:[VI],help:[UI]},$$scope:{ctx:r}};return r[0]!==void 0&&(a.show=r[0]),e=new Do({props:a}),wn.push(()=>On(e,"show",u)),i=new Kf({props:{url:`pmtiles://${fs("cnt/layers/stats19.pmtiles")}`,$$slots:{default:[ZI]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),n=ae(),pe(i.$$.fragment)},m(d,m){de(e,d,m),W(d,n,m),de(i,d,m),o=!0},p(d,[m]){const _={};m&8194&&(_.$$scope={dirty:m,ctx:d}),!t&&m&1&&(t=!0,_.show=d[0],Nn(()=>t=!1)),e.$set(_);const v={};m&8195&&(v.$$scope={dirty:m,ctx:d}),i.$set(v)},i(d){o||(N(e.$$.fragment,d),N(i.$$.fragment,d),o=!0)},o(d){G(e.$$.fragment,d),G(i.$$.fragment,d),o=!1},d(d){d&&H(n),he(e,d),he(i,d)}}}let bg="#080C54",vg="#1F9EB7",wg="#CDE594";function pb(r){let e=[];return r.pedestrian&&e.push("pedestrian"),r.cyclist&&e.push("cyclist"),e.join(", ")}function WI(r){window.open(`https://www.cyclestreets.net/collisions/reports/${r.detail.features[0].properties.accident_index}`,"_blank")}function XI(r,e,t){let n=!1,i={pedestrians:!0,cyclists:!0,minYear:2017,maxYear:2023};function o(L){let P=["any"];return i.pedestrians&&P.push(["get","pedestrian"]),i.cyclists&&P.push(["get","cyclist"]),["all",[">=",["get","year"],i.minYear],["<=",["get","year"],i.maxYear],P]}let u={1:"Crossing on pedestrian crossing facility",2:"Crossing in zig-zag approach lines",3:"Crossing in zig-zag exit lines",4:"Crossing elsewhere within 50m. of pedestrian crossing",5:"In carriageway, crossing elsewhere",6:"On footway or verge",7:"On refuge, central island or central reservation",8:"In centre of carriageway - not on refuge, island or central reservation",9:"In carriageway, not crossing"},a={1:"Crossing from driver's nearside",2:"Crossing from nearside - masked by parked or stationary vehicle",3:"Crossing from driver's offside",4:"Crossing from offside - masked by parked or stationary vehicle",5:"In carriageway, stationary - not crossing (standing or playing)",6:"In carriageway, stationary - not crossing (standing or playing - masked by parked or stationary vehicle)",7:"Walking along in carriageway, facing traffic",8:"Walking along in carriageway, back to traffic"},d={1:"Fatal",2:"Serious",3:"Slight"},m={Slight:wg,Serious:vg,Fatal:bg};function _(){i.pedestrians=this.checked,t(1,i)}function v(){i.cyclists=this.checked,t(1,i)}function S(){i.minYear=kl(this.value),t(1,i)}function T(){i.maxYear=kl(this.value),t(1,i)}function C(L){n=L,t(0,n)}return[n,i,o,u,a,d,m,_,v,S,T,C]}class JI extends kt{constructor(e){super(),St(this,e,XI,HI,gt,{})}}function mb(r){let e;return{c(){e=Te("Layers")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function gb(r){let e,t,n,i,o;function u(m){r[7](m)}let a={label:"Existing modal filters and turn restrictions"};r[2]!==void 0&&(a.show=r[2]),e=new Do({props:a}),wn.push(()=>On(e,"show",u));let d=r[3]=="cnt"&&_b();return{c(){pe(e.$$.fragment),n=ae(),d&&d.c(),i=rr()},m(m,_){de(e,m,_),W(m,n,_),d&&d.m(m,_),W(m,i,_),o=!0},p(m,_){const v={};!t&&_&4&&(t=!0,v.show=m[2],Nn(()=>t=!1)),e.$set(v),m[3]=="cnt"?d?_&8&&N(d,1):(d=_b(),d.c(),N(d,1),d.m(i.parentNode,i)):d&&(Zt(),G(d,1,1,()=>{d=null}),Ht())},i(m){o||(N(e.$$.fragment,m),N(d),o=!0)},o(m){G(e.$$.fragment,m),G(d),o=!1},d(m){m&&(H(n),H(i)),he(e,m),d&&d.d(m)}}}function _b(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I;return n=new zI({}),o=new gI({}),a=new JI({}),v=new jI({}),T=new OC({}),D=new lI({}),{c(){e=q("div"),e.textContent="Metrics",t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment),d=ae(),m=q("div"),m.textContent="Public transport integration",_=ae(),pe(v.$$.fragment),S=ae(),pe(T.$$.fragment),C=ae(),L=q("div"),L.textContent="Active travel",P=ae(),pe(D.$$.fragment),ce(e,"class","layer-group"),ce(m,"class","layer-group"),ce(L,"class","layer-group")},m(U,O){W(U,e,O),W(U,t,O),de(n,U,O),W(U,i,O),de(o,U,O),W(U,u,O),de(a,U,O),W(U,d,O),W(U,m,O),W(U,_,O),de(v,U,O),W(U,S,O),de(T,U,O),W(U,C,O),W(U,L,O),W(U,P,O),de(D,U,O),I=!0},i(U){I||(N(n.$$.fragment,U),N(o.$$.fragment,U),N(a.$$.fragment,U),N(v.$$.fragment,U),N(T.$$.fragment,U),N(D.$$.fragment,U),I=!0)},o(U){G(n.$$.fragment,U),G(o.$$.fragment,U),G(a.$$.fragment,U),G(v.$$.fragment,U),G(T.$$.fragment,U),G(D.$$.fragment,U),I=!1},d(U){U&&(H(e),H(t),H(i),H(u),H(d),H(m),H(_),H(S),H(C),H(L),H(P)),he(n,U),he(o,U),he(a,U),he(v,U),he(T,U),he(D,U)}}}function KI(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U,O,ee,X,ue;i=new tk({props:{color:"#333"}});let $=r[0]&&mb(),Q=r[1]&&gb(r);function ne(Z){r[9](Z)}let F={label:"Debugging tools"};return r[5]!==void 0&&(F.show=r[5]),U=new Do({props:F}),wn.push(()=>On(U,"show",ne)),{c(){e=q("div"),t=q("button"),n=q("div"),pe(i.$$.fragment),o=ae(),$&&$.c(),a=ae(),d=q("div"),Q&&Q.c(),m=ae(),_=q("div"),v=q("span"),v.textContent="Basemap",S=ae(),T=q("select"),C=q("option"),C.textContent="MapTiler Dataviz",L=q("option"),L.textContent="MapTiler Streets",P=q("option"),P.textContent="MapTiler Satellite",D=q("option"),D.textContent="OS Open Zoomstack",I=ae(),pe(U.$$.fragment),Ze(n,"display","flex"),Ze(n,"gap","12px"),Ze(n,"color","#333"),Ze(n,"align-items","center"),Ze(n,"justify-content","center"),ce(t,"class",u="show-layers-button icon-btn "+(r[0]?"expanded":"")+" svelte-1skef0p"),ce(t,"aria-label","Layers"),Ze(v,"font-size","20px"),Ze(v,"margin-left","8px"),Ze(v,"margin-top","4px"),C.__value="dataviz",Gn(C,C.__value),L.__value="streets-v2",Gn(L,L.__value),P.__value="hybrid",Gn(P,P.__value),D.__value="uk-openzoomstack-light",Gn(D,D.__value),Ze(T,"width","auto"),Ze(T,"font-size","20px"),Ze(T,"margin","8px"),Ze(T,"padding","8px"),Ze(T,"text-overflow","ellipsis"),r[4]===void 0&&Ks(()=>r[8].call(T)),ce(_,"class","context-control"),ce(d,"class","contextual-layer-controls svelte-1skef0p"),Ze(d,"flex-direction","column"),Ze(d,"display",r[0]?"flex":"none"),ce(e,"class","pico contextual-layers svelte-1skef0p"),Ze(e,"display","flex"),Ze(e,"flex-direction","column"),Ze(e,"border-radius","5px"),Ze(e,"width",r[0]?"300px":"auto")},m(Z,J){W(Z,e,J),z(e,t),z(t,n),de(i,n,null),z(n,o),$&&$.m(n,null),z(e,a),z(e,d),Q&&Q.m(d,null),z(d,m),z(d,_),z(_,v),z(_,S),z(_,T),z(T,C),z(T,L),z(T,P),z(T,D),Mi(T,r[4],!0),z(_,I),de(U,_,null),ee=!0,X||(ue=[_t(t,"click",r[6]),_t(T,"change",r[8])],X=!0)},p(Z,J){Z[0]?$||($=mb(),$.c(),$.m(n,null)):$&&($.d(1),$=null),(!ee||J&1&&u!==(u="show-layers-button icon-btn "+(Z[0]?"expanded":"")+" svelte-1skef0p"))&&ce(t,"class",u),Z[1]?Q?(Q.p(Z,J),J&2&&N(Q,1)):(Q=gb(Z),Q.c(),N(Q,1),Q.m(d,m)):Q&&(Zt(),G(Q,1,1,()=>{Q=null}),Ht()),J&16&&Mi(T,Z[4]);const be={};!O&&J&32&&(O=!0,be.show=Z[5],Nn(()=>O=!1)),U.$set(be),J&1&&Ze(d,"display",Z[0]?"flex":"none"),J&1&&Ze(e,"width",Z[0]?"300px":"auto")},i(Z){ee||(N(i.$$.fragment,Z),N(Q),N(U.$$.fragment,Z),ee=!0)},o(Z){G(i.$$.fragment,Z),G(Q),G(U.$$.fragment,Z),ee=!1},d(Z){Z&&H(e),he(i),$&&$.d(),Q&&Q.d(),he(U),X=!1,Er(ue)}}}function YI(r){let e,t;return e=new Um({props:{defaultStyling:!0,$$slots:{default:[KI]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&1087&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function QI(r,e,t){let n,i,o,u,a;rt(r,Cr,T=>t(1,n=T)),rt(r,Gd,T=>t(2,i=T)),rt(r,Bo,T=>t(3,o=T)),rt(r,tg,T=>t(4,u=T)),rt(r,jf,T=>t(5,a=T));let d=!1;const m=()=>t(0,d=!d);function _(T){i=T,Gd.set(i)}function v(){u=Ys(this),tg.set(u)}function S(T){a=T,jf.set(a)}return[d,n,i,o,u,a,m,_,v,S]}class e6 extends kt{constructor(e){super(),St(this,e,QI,YI,gt,{})}}const t6=r=>({}),yb=r=>({}),n6=r=>({}),bb=r=>({}),r6=r=>({}),vb=r=>({});function i6(r){let e,t,n,i,o,u,a,d;const m=r[1].top,_=_n(m,r,r[0],vb),v=r[1].left,S=_n(v,r,r[0],bb),T=r[1].main,C=_n(T,r,r[0],yb);return{c(){e=q("div"),t=q("div"),_&&_.c(),n=ae(),i=q("div"),o=q("div"),S&&S.c(),u=ae(),a=q("div"),C&&C.c(),ce(t,"class","top svelte-29q570"),ce(o,"class","left svelte-29q570"),ce(a,"class","main svelte-29q570"),ce(i,"class","content svelte-29q570"),ce(e,"class","flex-container svelte-29q570")},m(L,P){W(L,e,P),z(e,t),_&&_.m(t,null),z(e,n),z(e,i),z(i,o),S&&S.m(o,null),z(i,u),z(i,a),C&&C.m(a,null),d=!0},p(L,[P]){_&&_.p&&(!d||P&1)&&yn(_,m,L,L[0],d?vn(m,L[0],P,r6):bn(L[0]),vb),S&&S.p&&(!d||P&1)&&yn(S,v,L,L[0],d?vn(v,L[0],P,n6):bn(L[0]),bb),C&&C.p&&(!d||P&1)&&yn(C,T,L,L[0],d?vn(T,L[0],P,t6):bn(L[0]),yb)},i(L){d||(N(_,L),N(S,L),N(C,L),d=!0)},o(L){G(_,L),G(S,L),G(C,L),d=!1},d(L){L&&H(e),_&&_.d(L),S&&S.d(L),C&&C.d(L)}}}function o6(r,e,t){let{$$slots:n={},$$scope:i}=e;return r.$$set=o=>{"$$scope"in o&&t(0,i=o.$$scope)},[i,n]}class s6 extends kt{constructor(e){super(),St(this,e,o6,i6,gt,{})}}const a6=r=>({}),wb=r=>({}),l6=r=>({}),xb=r=>({}),u6=r=>({}),Ab=r=>({});function c6(r){let e,t,n,i,o,u;const a=r[4].top,d=_n(a,r,r[3],Ab),m=r[4].sidebar,_=_n(m,r,r[3],xb),v=r[4].map,S=_n(v,r,r[3],wb);return{c(){e=q("div"),d&&d.c(),t=ae(),n=q("div"),_&&_.c(),i=ae(),o=q("div"),S&&S.c()},m(T,C){W(T,e,C),d&&d.m(e,null),r[5](e),W(T,t,C),W(T,n,C),_&&_.m(n,null),r[6](n),W(T,i,C),W(T,o,C),S&&S.m(o,null),r[7](o),u=!0},p(T,[C]){d&&d.p&&(!u||C&8)&&yn(d,a,T,T[3],u?vn(a,T[3],C,u6):bn(T[3]),Ab),_&&_.p&&(!u||C&8)&&yn(_,m,T,T[3],u?vn(m,T[3],C,l6):bn(T[3]),xb),S&&S.p&&(!u||C&8)&&yn(S,v,T,T[3],u?vn(v,T[3],C,a6):bn(T[3]),wb)},i(T){u||(N(d,T),N(_,T),N(S,T),u=!0)},o(T){G(d,T),G(_,T),G(S,T),u=!1},d(T){T&&(H(e),H(t),H(n),H(i),H(o)),d&&d.d(T),r[5](null),_&&_.d(T),r[6](null),S&&S.d(T),r[7](null)}}}function f6(r,e,t){let n,i,o;rt(r,xg,v=>t(0,n=v)),rt(r,Ag,v=>t(1,i=v)),rt(r,kg,v=>t(2,o=v));let{$$slots:u={},$$scope:a}=e;function d(v){wn[v?"unshift":"push"](()=>{n=v,xg.set(n)})}function m(v){wn[v?"unshift":"push"](()=>{i=v,Ag.set(i)})}function _(v){wn[v?"unshift":"push"](()=>{o=v,kg.set(o)})}return r.$$set=v=>{"$$scope"in v&&t(3,a=v.$$scope)},[n,i,o,a,u,d,m,_]}class po extends kt{constructor(e){super(),St(this,e,f6,c6,gt,{})}}let xg=Dn(null),Ag=Dn(null),kg=Dn(null),mt;function h6(r){const e=mt.__externref_table_alloc();return mt.__wbindgen_export_2.set(e,r),e}function bl(r,e){try{return r.apply(this,e)}catch(t){const n=h6(t);mt.__wbindgen_exn_store(n)}}const $2=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&$2.decode();let kf=null;function Ou(){return(kf===null||kf.byteLength===0)&&(kf=new Uint8Array(mt.memory.buffer)),kf}function Sr(r,e){return r=r>>>0,$2.decode(Ou().subarray(r,r+e))}let ai=0;const Rd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},d6=typeof Rd.encodeInto=="function"?function(r,e){return Rd.encodeInto(r,e)}:function(r,e){const t=Rd.encode(r);return e.set(t),{read:r.length,written:t.length}};function uo(r,e,t){if(t===void 0){const a=Rd.encode(r),d=e(a.length,1)>>>0;return Ou().subarray(d,d+a.length).set(a),ai=a.length,d}let n=r.length,i=e(n,1)>>>0;const o=Ou();let u=0;for(;u<n;u++){const a=r.charCodeAt(u);if(a>127)break;o[i+u]=a}if(u!==n){u!==0&&(r=r.slice(u)),i=t(i,n,n=u+r.length*3,1)>>>0;const a=Ou().subarray(i+u,i+n),d=d6(r,a);u+=d.written,i=t(i,n,u,1)>>>0}return ai=u,i}let wl=null;function ks(){return(wl===null||wl.buffer.detached===!0||wl.buffer.detached===void 0&&wl.buffer!==mt.memory.buffer)&&(wl=new DataView(mt.memory.buffer)),wl}function Du(r){return r==null}function Sg(r){const e=typeof r;if(e=="number"||e=="boolean"||r==null)return`${r}`;if(e=="string")return`"${r}"`;if(e=="symbol"){const i=r.description;return i==null?"Symbol":`Symbol(${i})`}if(e=="function"){const i=r.name;return typeof i=="string"&&i.length>0?`Function(${i})`:"Function"}if(Array.isArray(r)){const i=r.length;let o="[";i>0&&(o+=Sg(r[0]));for(let u=1;u<i;u++)o+=", "+Sg(r[u]);return o+="]",o}const t=/\[object ([^\]]+)\]/.exec(toString.call(r));let n;if(t&&t.length>1)n=t[1];else return toString.call(r);if(n=="Object")try{return"Object("+JSON.stringify(r)+")"}catch{return"Object"}return r instanceof Error?`${r.name}: ${r.message}
${r.stack}`:n}function kb(r,e){const t=e(r.length*1,1)>>>0;return Ou().set(r,t/1),ai=r.length,t}function Wn(r){const e=mt.__wbindgen_export_2.get(r);return mt.__externref_table_dealloc(r),e}let Sf=null;function p6(){return(Sf===null||Sf.byteLength===0)&&(Sf=new Float64Array(mt.memory.buffer)),Sf}function m6(r,e){return r=r>>>0,p6().subarray(r/8,r/8+e)}function g6(r,e){return r=r>>>0,Ou().subarray(r/1,r/1+e)}let Tf=null;function _6(){return(Tf===null||Tf.byteLength===0)&&(Tf=new Uint32Array(mt.memory.buffer)),Tf}function y6(r,e){const t=e(r.length*4,4)>>>0;return _6().set(r,t/4),ai=r.length,t}const Sb=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(r=>mt.__wbg_ltn_free(r>>>0,1));class b6{__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,Sb.unregister(this),e}free(){const e=this.__destroy_into_raw();mt.__wbg_ltn_free(e,0)}constructor(e,t,n,i,o,u,a){const d=kb(e,mt.__wbindgen_malloc),m=ai,_=kb(t,mt.__wbindgen_malloc),v=ai,S=uo(i,mt.__wbindgen_malloc,mt.__wbindgen_realloc),T=ai;var C=Du(o)?0:uo(o,mt.__wbindgen_malloc,mt.__wbindgen_realloc),L=ai;const P=uo(u,mt.__wbindgen_malloc,mt.__wbindgen_realloc),D=ai,I=mt.ltn_new(d,m,_,v,n,S,T,C,L,P,D,a);if(I[2])throw Wn(I[1]);return this.__wbg_ptr=I[0]>>>0,Sb.register(this,this.__wbg_ptr,this),this}getInvertedBoundary(){let e,t;try{const o=mt.ltn_getInvertedBoundary(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}getBounds(){const e=mt.ltn_getBounds(this.__wbg_ptr);var t=m6(e[0],e[1]).slice();return mt.__wbindgen_free(e[0],e[1]*8,8),t}toRouteSnapper(){const e=mt.ltn_toRouteSnapper(this.__wbg_ptr);var t=g6(e[0],e[1]).slice();return mt.__wbindgen_free(e[0],e[1]*1,1),t}toRouteSnapperGj(){let e,t;try{const o=mt.ltn_toRouteSnapperGj(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}renderModalFilters(){let e,t;try{const o=mt.ltn_renderModalFilters(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}renderModalFiltersBeforeEdits(){let e,t;try{const o=mt.ltn_renderModalFiltersBeforeEdits(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}renderTurnRestrictions(){let e,t;try{const o=mt.ltn_renderTurnRestrictions(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}renderTurnRestrictionsBeforeEdits(){let e,t;try{const o=mt.ltn_renderTurnRestrictionsBeforeEdits(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}renderNeighbourhood(){let e,t;try{const o=mt.ltn_renderNeighbourhood(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}renderNeighbourhoodBeforeEdits(){let e,t;try{const o=mt.ltn_renderNeighbourhoodBeforeEdits(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}generatedBoundaries(){let e,t;try{const o=mt.ltn_generatedBoundaries(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}generateMergedBoundary(e){let t,n;try{const u=mt.ltn_generateMergedBoundary(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Wn(u[2]);return t=i,n=o,Sr(i,o)}finally{mt.__wbindgen_free(t,n,1)}}extractWaypointsFromRing(e){let t,n;try{const u=mt.ltn_extractWaypointsFromRing(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Wn(u[2]);return t=i,n=o,Sr(i,o)}finally{mt.__wbindgen_free(t,n,1)}}setCurrentNeighbourhoodBoundary(e,t){const n=uo(e,mt.__wbindgen_malloc,mt.__wbindgen_realloc),i=ai,o=mt.ltn_setCurrentNeighbourhoodBoundary(this.__wbg_ptr,n,i,t);if(o[1])throw Wn(o[0])}deleteNeighbourhoodBoundary(e){const t=uo(e,mt.__wbindgen_malloc,mt.__wbindgen_realloc),n=ai;mt.ltn_deleteNeighbourhoodBoundary(this.__wbg_ptr,t,n)}renameNeighbourhoodBoundary(e,t){const n=uo(e,mt.__wbindgen_malloc,mt.__wbindgen_realloc),i=ai,o=uo(t,mt.__wbindgen_malloc,mt.__wbindgen_realloc),u=ai;mt.ltn_renameNeighbourhoodBoundary(this.__wbg_ptr,n,i,o,u)}setCurrentNeighbourhood(e){const t=uo(e,mt.__wbindgen_malloc,mt.__wbindgen_realloc),n=ai,i=mt.ltn_setCurrentNeighbourhood(this.__wbg_ptr,t,n);if(i[1])throw Wn(i[0])}addModalFilter(e,t){const n=uo(t,mt.__wbindgen_malloc,mt.__wbindgen_realloc),i=ai,o=mt.ltn_addModalFilter(this.__wbg_ptr,e,n,i);if(o[1])throw Wn(o[0])}addManyModalFilters(e,t){const n=uo(t,mt.__wbindgen_malloc,mt.__wbindgen_realloc),i=ai,o=mt.ltn_addManyModalFilters(this.__wbg_ptr,e,n,i);if(o[1])throw Wn(o[0])}deleteModalFilter(e){mt.ltn_deleteModalFilter(this.__wbg_ptr,e)}addDiagonalFilter(e){const t=mt.ltn_addDiagonalFilter(this.__wbg_ptr,e);if(t[1])throw Wn(t[0])}rotateDiagonalFilter(e){const t=mt.ltn_rotateDiagonalFilter(this.__wbg_ptr,e);if(t[1])throw Wn(t[0])}deleteDiagonalFilter(e){const t=mt.ltn_deleteDiagonalFilter(this.__wbg_ptr,e);if(t[1])throw Wn(t[0])}addTurnRestriction(e,t){const n=mt.ltn_addTurnRestriction(this.__wbg_ptr,e,t);if(n[1])throw Wn(n[0])}deleteTurnRestriction(e,t,n){const i=mt.ltn_deleteTurnRestriction(this.__wbg_ptr,e,t,n);if(i[1])throw Wn(i[0])}getTurnRestrictionTargets(e){let t,n;try{const u=mt.ltn_getTurnRestrictionTargets(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Wn(u[2]);return t=i,n=o,Sr(i,o)}finally{mt.__wbindgen_free(t,n,1)}}toggleTravelFlow(e){mt.ltn_toggleTravelFlow(this.__wbg_ptr,e)}toggleMainRoad(e){const t=mt.ltn_toggleMainRoad(this.__wbg_ptr,e);if(t[1])throw Wn(t[0])}setMainRoads(e,t){const n=y6(e,mt.__wbindgen_malloc),i=ai,o=mt.ltn_setMainRoads(this.__wbg_ptr,n,i,t);if(o[1])throw Wn(o[0])}eraseAllMainRoads(){const e=mt.ltn_eraseAllMainRoads(this.__wbg_ptr);if(e[1])throw Wn(e[0])}undo(){const e=mt.ltn_undo(this.__wbg_ptr);if(e[1])throw Wn(e[0])}redo(){const e=mt.ltn_redo(this.__wbg_ptr);if(e[1])throw Wn(e[0])}getShortcutsCrossingRoad(e){let t,n;try{const u=mt.ltn_getShortcutsCrossingRoad(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Wn(u[2]);return t=i,n=o,Sr(i,o)}finally{mt.__wbindgen_free(t,n,1)}}getAllShortcuts(){let e,t;try{const o=mt.ltn_getAllShortcuts(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}getAllShortcutsBeforeEdits(){let e,t;try{const o=mt.ltn_getAllShortcutsBeforeEdits(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}toSavefile(){let e,t;try{const o=mt.ltn_toSavefile(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}loadSavefile(e){const t=mt.ltn_loadSavefile(this.__wbg_ptr,e);if(t[1])throw Wn(t[0])}changeProjectName(e){const t=uo(e,mt.__wbindgen_malloc,mt.__wbindgen_realloc),n=ai;mt.ltn_changeProjectName(this.__wbg_ptr,t,n)}compareRoute(e,t,n,i,o){let u,a;try{const _=mt.ltn_compareRoute(this.__wbg_ptr,e,t,n,i,o);var d=_[0],m=_[1];if(_[3])throw d=0,m=0,Wn(_[2]);return u=d,a=m,Sr(d,m)}finally{mt.__wbindgen_free(u,a,1)}}impactToOneDestination(e,t){let n,i;try{const a=mt.ltn_impactToOneDestination(this.__wbg_ptr,e,t);var o=a[0],u=a[1];if(a[3])throw o=0,u=0,Wn(a[2]);return n=o,i=u,Sr(o,u)}finally{mt.__wbindgen_free(n,i,1)}}predictImpact(e){let t,n;try{const u=mt.ltn_predictImpact(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Wn(u[2]);return t=i,n=o,Sr(i,o)}finally{mt.__wbindgen_free(t,n,1)}}getImpactsOnRoad(e,t){let n,i;try{const a=mt.ltn_getImpactsOnRoad(this.__wbg_ptr,e,t);var o=a[0],u=a[1];if(a[3])throw o=0,u=0,Wn(a[2]);return n=o,i=u,Sr(o,u)}finally{mt.__wbindgen_free(n,i,1)}}getAllIntersections(){let e,t;try{const o=mt.ltn_getAllIntersections(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}getMovements(e){let t,n;try{const u=mt.ltn_getMovements(this.__wbg_ptr,e);var i=u[0],o=u[1];if(u[3])throw i=0,o=0,Wn(u[2]);return t=i,n=o,Sr(i,o)}finally{mt.__wbindgen_free(t,n,1)}}getDemandModel(){let e,t;try{const o=mt.ltn_getDemandModel(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}getPOIs(){let e,t;try{const o=mt.ltn_getPOIs(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}getMetricBuckets(){let e,t;try{const o=mt.ltn_getMetricBuckets(this.__wbg_ptr);var n=o[0],i=o[1];if(o[3])throw n=0,i=0,Wn(o[2]);return e=n,t=i,Sr(n,i)}finally{mt.__wbindgen_free(e,t,1)}}getOsmTimestamp(){const e=mt.ltn_getOsmTimestamp(this.__wbg_ptr);return e[0]===0?void 0:e[1]}}async function v6(r,e){if(typeof Response=="function"&&r instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(r,e)}catch(n){if(r.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=await r.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(r,e);return t instanceof WebAssembly.Instance?{instance:t,module:r}:t}}function w6(){const r={};return r.wbg={},r.wbg.__wbg_buffer_0e2c274546535a84=function(e){return e.buffer},r.wbg.__wbg_call_3a8ceff4c9f12325=function(){return bl(function(e,t){return e.call(t)},arguments)},r.wbg.__wbg_debug_809501eb69aeeef4=function(e){console.debug(e)},r.wbg.__wbg_done_60e5165eca70220e=function(e){return e.done},r.wbg.__wbg_entries_85a648a6a5215287=function(e){return Object.entries(e)},r.wbg.__wbg_error_1c3d6d32fc1361cc=function(e){console.error(e)},r.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let n,i;try{n=e,i=t,console.error(Sr(e,t))}finally{mt.__wbindgen_free(n,i,1)}},r.wbg.__wbg_get_9c5338635800e15f=function(){return bl(function(e,t){return Reflect.get(e,t)},arguments)},r.wbg.__wbg_get_d749e505e6746136=function(e,t){return e[t>>>0]},r.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){return e[t]},r.wbg.__wbg_globalThis_d0fa1c7e1465604c=function(){return bl(function(){return globalThis.globalThis},arguments)},r.wbg.__wbg_global_23a7926f0ad701bc=function(){return bl(function(){return global.global},arguments)},r.wbg.__wbg_info_26a1a6efb20c9f43=function(e){console.info(e)},r.wbg.__wbg_instanceof_ArrayBuffer_c632aa9cfefb45b9=function(e){let t;try{t=e instanceof ArrayBuffer}catch{t=!1}return t},r.wbg.__wbg_instanceof_Map_212855790ec94f3b=function(e){let t;try{t=e instanceof Map}catch{t=!1}return t},r.wbg.__wbg_instanceof_Uint8Array_aa04d9da2a05b974=function(e){let t;try{t=e instanceof Uint8Array}catch{t=!1}return t},r.wbg.__wbg_isArray_b7133b5e9a258525=function(e){return Array.isArray(e)},r.wbg.__wbg_isSafeInteger_f6d409cd7a7eb81d=function(e){return Number.isSafeInteger(e)},r.wbg.__wbg_iterator_0210e004ec06fb30=function(){return Symbol.iterator},r.wbg.__wbg_length_bc129fab12fd2a9c=function(e){return e.length},r.wbg.__wbg_length_ee1bca74ed444cce=function(e){return e.length},r.wbg.__wbg_log_91785a95194156ea=function(e){console.log(e)},r.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},r.wbg.__wbg_new_cf66b35fe5443282=function(e){return new Uint8Array(e)},r.wbg.__wbg_newnoargs_1143e0b74be16ea9=function(e,t){return new Function(Sr(e,t))},r.wbg.__wbg_next_4d092fa9da3ba108=function(e){return e.next},r.wbg.__wbg_next_7b79803d4b7a1b68=function(){return bl(function(e){return e.next()},arguments)},r.wbg.__wbg_now_882dd9fbc163f00d=function(e){return e.now()},r.wbg.__wbg_performance_686bdd9b0415bed6=function(e){return e.performance},r.wbg.__wbg_self_3a2c444cba620c12=function(){return bl(function(){return self.self},arguments)},r.wbg.__wbg_set_2611eb16b9ac5ca9=function(e,t,n){e.set(t,n>>>0)},r.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){const n=t.stack,i=uo(n,mt.__wbindgen_malloc,mt.__wbindgen_realloc),o=ai;ks().setInt32(e+4*1,o,!0),ks().setInt32(e+4*0,i,!0)},r.wbg.__wbg_value_fdfbba27b1fcaf65=function(e){return e.value},r.wbg.__wbg_warn_8fc67512df65ef55=function(e){console.warn(e)},r.wbg.__wbg_window_a27f90073150a6bf=function(){return bl(function(){return window.window},arguments)},r.wbg.__wbindgen_bigint_from_i64=function(e){return e},r.wbg.__wbindgen_bigint_from_u64=function(e){return BigInt.asUintN(64,e)},r.wbg.__wbindgen_bigint_get_as_i64=function(e,t){const n=t,i=typeof n=="bigint"?n:void 0;ks().setBigInt64(e+8*1,Du(i)?BigInt(0):i,!0),ks().setInt32(e+4*0,!Du(i),!0)},r.wbg.__wbindgen_boolean_get=function(e){const t=e;return typeof t=="boolean"?t?1:0:2},r.wbg.__wbindgen_debug_string=function(e,t){const n=Sg(t),i=uo(n,mt.__wbindgen_malloc,mt.__wbindgen_realloc),o=ai;ks().setInt32(e+4*1,o,!0),ks().setInt32(e+4*0,i,!0)},r.wbg.__wbindgen_error_new=function(e,t){return new Error(Sr(e,t))},r.wbg.__wbindgen_in=function(e,t){return e in t},r.wbg.__wbindgen_init_externref_table=function(){const e=mt.__wbindgen_export_2,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},r.wbg.__wbindgen_is_bigint=function(e){return typeof e=="bigint"},r.wbg.__wbindgen_is_function=function(e){return typeof e=="function"},r.wbg.__wbindgen_is_object=function(e){const t=e;return typeof t=="object"&&t!==null},r.wbg.__wbindgen_is_undefined=function(e){return e===void 0},r.wbg.__wbindgen_jsval_eq=function(e,t){return e===t},r.wbg.__wbindgen_jsval_loose_eq=function(e,t){return e==t},r.wbg.__wbindgen_memory=function(){return mt.memory},r.wbg.__wbindgen_number_get=function(e,t){const n=t,i=typeof n=="number"?n:void 0;ks().setFloat64(e+8*1,Du(i)?0:i,!0),ks().setInt32(e+4*0,!Du(i),!0)},r.wbg.__wbindgen_string_get=function(e,t){const n=t,i=typeof n=="string"?n:void 0;var o=Du(i)?0:uo(i,mt.__wbindgen_malloc,mt.__wbindgen_realloc),u=ai;ks().setInt32(e+4*1,u,!0),ks().setInt32(e+4*0,o,!0)},r.wbg.__wbindgen_string_new=function(e,t){return Sr(e,t)},r.wbg.__wbindgen_throw=function(e,t){throw new Error(Sr(e,t))},r}function x6(r,e){return mt=r.exports,j2.__wbindgen_wasm_module=e,wl=null,Sf=null,Tf=null,kf=null,mt.__wbindgen_start(),mt}async function j2(r){if(mt!==void 0)return mt;typeof r<"u"&&(Object.getPrototypeOf(r)===Object.prototype?{module_or_path:r}=r:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof r>"u"&&(r=new URL("/ltn/assets/backend_bg-CoMJBH8t.wasm",import.meta.url));const e=w6();(typeof r=="string"||typeof Request=="function"&&r instanceof Request||typeof URL=="function"&&r instanceof URL)&&(r=fetch(r));const{instance:t,module:n}=await v6(await r,e);return x6(t,n)}const A6="/ltn/assets/streets-v2-style-CzuG29E5.json";function k6(r){let e;return{c(){e=Te("Back")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function S6(r){let e,t,n,i;return e=new nh({props:{$$slots:{default:[k6]},$$scope:{ctx:r}}}),e.$on("click",r[3]),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0,n||(i=_t(window,"keydown",r[2]),n=!0)},p(o,[u]){const a={};u&16&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o),n=!1,i()}}}function T6(r,e,t){let n;rt(r,or,a=>t(1,n=a));let{mode:i}=e;function o(a){a.key=="Escape"&&(a.stopPropagation(),on(or,n=i,n))}const u=()=>on(or,n=i,n);return r.$$set=a=>{"mode"in a&&t(0,i=a.mode)},[i,n,o,u]}class Is extends kt{constructor(e){super(),St(this,e,T6,S6,gt,{mode:0})}}let Zf=Dn(null);function Tb(r,e,t){const n=r.slice();return n[37]=e[t],n[38]=e,n[39]=t,n}function Cb(r,e,t){const n=r.slice();return n[40]=e[t],n[41]=e,n[42]=t,n}function C6(r){let e,t=r[6].length+"",n,i;return{c(){e=Te("Undo ("),n=Te(t),i=Te(")")},m(o,u){W(o,e,u),W(o,n,u),W(o,i,u)},p(o,u){u[0]&64&&t!==(t=o[6].length+"")&&yt(n,t)},d(o){o&&(H(e),H(n),H(i))}}}function M6(r){let e;return{c(){e=Te("Undo")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function E6(r){let e;return{c(){e=q("span"),ce(e,"class","dot svelte-11yzwwb"),Nt(e,"snapped-node",r[40].snapped),Nt(e,"free-node",!r[40].snapped),Nt(e,"hide",r[4])},m(t,n){W(t,e,n)},p(t,n){n[0]&128&&Nt(e,"snapped-node",t[40].snapped),n[0]&128&&Nt(e,"free-node",!t[40].snapped),n[0]&16&&Nt(e,"hide",t[4])},d(t){t&&H(e)}}}function Mb(r){let e,t,n;function i(m){r[23](m,r[40])}function o(){return r[24](r[40])}function u(){return r[25](r[40])}function a(){return r[26](r[40])}let d={draggable:!0,zIndex:0,$$slots:{default:[E6]},$$scope:{ctx:r}};return r[40].point!==void 0&&(d.lngLat=r[40].point),e=new Ju({props:d}),wn.push(()=>On(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",u),e.$on("dragend",r[16]),e.$on("click",a),{c(){pe(e.$$.fragment)},m(m,_){de(e,m,_),n=!0},p(m,_){r=m;const v={};_[0]&144|_[1]&4096&&(v.$$scope={dirty:_,ctx:r}),!t&&_[0]&128&&(t=!0,v.lngLat=r[40].point,Nn(()=>t=!1)),e.$set(v)},i(m){n||(N(e.$$.fragment,m),n=!0)},o(m){G(e.$$.fragment,m),n=!1},d(m){he(e,m)}}}function I6(r){let e;return{c(){e=q("ul"),e.innerHTML=`<li><b>Click and drag</b>
          to move</li> <li><b>Click</b>
          to toggle snapping</li> <li><b>Right click</b>
          to delete</li>`,Ze(e,"padding-right","0"),Ze(e,"padding-left","20px"),Ze(e,"margin","0")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function L6(r){let e,t,n,i;return n=new Fg({props:{openOn:"hover",popupClass:"edit-waypoint-popup",$$slots:{default:[I6]},$$scope:{ctx:r}}}),{c(){e=q("span"),e.textContent=`${r[39]+1}`,t=ae(),pe(n.$$.fragment),ce(e,"class","dot svelte-11yzwwb"),Nt(e,"snapped",r[37].snapped)},m(o,u){W(o,e,u),W(o,t,u),de(n,o,u),i=!0},p(o,u){(!i||u[0]&1)&&Nt(e,"snapped",o[37].snapped);const a={};u[1]&4096&&(a.$$scope={dirty:u,ctx:o}),n.$set(a)},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){G(n.$$.fragment,o),i=!1},d(o){o&&(H(e),H(t)),he(n,o)}}}function Eb(r){let e,t,n;function i(d){r[27](d,r[37])}function o(){return r[28](r[39])}function u(){return r[29](r[39])}let a={draggable:!0,zIndex:1,$$slots:{default:[L6]},$$scope:{ctx:r}};return r[37].point!==void 0&&(a.lngLat=r[37].point),e=new Ju({props:a}),wn.push(()=>On(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",u),e.$on("mouseenter",r[30]),e.$on("mouseleave",r[31]),e.$on("dragstart",r[17]),e.$on("dragend",r[32]),{c(){pe(e.$$.fragment)},m(d,m){de(e,d,m),n=!0},p(d,m){r=d;const _={};m[0]&1|m[1]&4096&&(_.$$scope={dirty:m,ctx:r}),!t&&m[0]&1&&(t=!0,_.lngLat=r[37].point,Nn(()=>t=!1)),e.$set(_)},i(d){n||(N(e.$$.fragment,d),n=!0)},o(d){G(e.$$.fragment,d),n=!1},d(d){he(e,d)}}}function P6(r){let e,t,n,i;const o=[sn("draw-area-lines"),{paint:{"line-color":"black","line-width":10}}];let u={};for(let m=0;m<o.length;m+=1)u=wt(u,o[m]);e=new gr({props:u});const a=[sn("draw-area-area"),{paint:{"fill-color":"grey","fill-opacity":.5}}];let d={};for(let m=0;m<a.length;m+=1)d=wt(d,a[m]);return n=new Zi({props:d}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),i=!0},p(m,_){const v={};e.$set(v);const S={};n.$set(S)},i(m){i||(N(e.$$.fragment,m),N(n.$$.fragment,m),i=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),i=!1},d(m){m&&H(t),he(e,m),he(n,m)}}}function z6(r){let e,t;const n=[sn("draw-area-lines-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function D6(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U,O,ee,X;function ue(ge,ve){return ge[6].length==0?M6:C6}let $=ue(r),Q=$(r);S=new tp({}),S.$on("click",r[10]),S.$on("mousemove",r[11]);let ne=zn(r[7]),F=[];for(let ge=0;ge<ne.length;ge+=1)F[ge]=Mb(Cb(r,ne,ge));const Z=ge=>G(F[ge],1,1,()=>{F[ge]=null});let J=zn(r[0]),be=[];for(let ge=0;ge<J.length;ge+=1)be[ge]=Eb(Tb(r,J,ge));const ke=ge=>G(be[ge],1,1,()=>{be[ge]=null});return P=new yr({props:{data:r[1]||ii(),generateId:!0,$$slots:{default:[P6]},$$scope:{ctx:r}}}),I=new yr({props:{data:r[8],$$slots:{default:[z6]},$$scope:{ctx:r}}}),O=Ig(r[22][0]),{c(){e=q("p"),e.textContent="Click the map to add three points. Then adjust the points or add more.",t=ae(),n=q("div"),i=q("label"),o=q("input"),a=Te(`
    Snap boundary to roads`),d=ae(),m=q("button"),Q.c(),v=ae(),pe(S.$$.fragment),T=ae();for(let ge=0;ge<F.length;ge+=1)F[ge].c();C=ae();for(let ge=0;ge<be.length;ge+=1)be[ge].c();L=ae(),pe(P.$$.fragment),D=ae(),pe(I.$$.fragment),o.disabled=u=r[0].length>=3,ce(o,"type","checkbox"),o.__value="snap",Gn(o,o.__value),ce(m,"class","secondary"),m.disabled=_=r[6].length==0,Ze(n,"display","flex"),Ze(n,"gap","16px"),O.p(o)},m(ge,ve){W(ge,e,ve),W(ge,t,ve),W(ge,n,ve),z(n,i),z(i,o),o.checked=~(r[5]||[]).indexOf(o.__value),z(i,a),z(n,d),z(n,m),Q.m(m,null),W(ge,v,ve),de(S,ge,ve),W(ge,T,ve);for(let fe=0;fe<F.length;fe+=1)F[fe]&&F[fe].m(ge,ve);W(ge,C,ve);for(let fe=0;fe<be.length;fe+=1)be[fe]&&be[fe].m(ge,ve);W(ge,L,ve),de(P,ge,ve),W(ge,D,ve),de(I,ge,ve),U=!0,ee||(X=[_t(o,"change",r[21]),_t(m,"click",r[9])],ee=!0)},p(ge,ve){if((!U||ve[0]&1&&u!==(u=ge[0].length>=3))&&(o.disabled=u),ve[0]&32&&(o.checked=~(ge[5]||[]).indexOf(o.__value)),$===($=ue(ge))&&Q?Q.p(ge,ve):(Q.d(1),Q=$(ge),Q&&(Q.c(),Q.m(m,null))),(!U||ve[0]&64&&_!==(_=ge[6].length==0))&&(m.disabled=_),ve[0]&114832){ne=zn(ge[7]);let Ee;for(Ee=0;Ee<ne.length;Ee+=1){const Fe=Cb(ge,ne,Ee);F[Ee]?(F[Ee].p(Fe,ve),N(F[Ee],1)):(F[Ee]=Mb(Fe),F[Ee].c(),N(F[Ee],1),F[Ee].m(C.parentNode,C))}for(Zt(),Ee=ne.length;Ee<F.length;Ee+=1)Z(Ee);Ht()}if(ve[0]&143373){J=zn(ge[0]);let Ee;for(Ee=0;Ee<J.length;Ee+=1){const Fe=Tb(ge,J,Ee);be[Ee]?(be[Ee].p(Fe,ve),N(be[Ee],1)):(be[Ee]=Eb(Fe),be[Ee].c(),N(be[Ee],1),be[Ee].m(L.parentNode,L))}for(Zt(),Ee=J.length;Ee<be.length;Ee+=1)ke(Ee);Ht()}const fe={};ve[0]&2&&(fe.data=ge[1]||ii()),ve[1]&4096&&(fe.$$scope={dirty:ve,ctx:ge}),P.$set(fe);const Pe={};ve[0]&256&&(Pe.data=ge[8]),ve[1]&4096&&(Pe.$$scope={dirty:ve,ctx:ge}),I.$set(Pe)},i(ge){if(!U){N(S.$$.fragment,ge);for(let ve=0;ve<ne.length;ve+=1)N(F[ve]);for(let ve=0;ve<J.length;ve+=1)N(be[ve]);N(P.$$.fragment,ge),N(I.$$.fragment,ge),U=!0}},o(ge){G(S.$$.fragment,ge),F=F.filter(Boolean);for(let ve=0;ve<F.length;ve+=1)G(F[ve]);be=be.filter(Boolean);for(let ve=0;ve<be.length;ve+=1)G(be[ve]);G(P.$$.fragment,ge),G(I.$$.fragment,ge),U=!1},d(ge){ge&&(H(e),H(t),H(n),H(v),H(T),H(C),H(L),H(D)),Q.d(),he(S,ge),Jr(F,ge),Jr(be,ge),he(P,ge),he(I,ge),O.r(),ee=!1,Er(X)}}}function R6(r,e){if(e.length<3)return JSON.parse(r.inner.calculateRoute(e));let t=JSON.parse(JSON.stringify(e));t.push(t[0]);let n=JSON.parse(r.inner.calculateRoute(t));return n.properties.waypoints.pop(),n.geometry.type="Polygon",n.geometry.coordinates=[n.geometry.coordinates],n}function B6(r,e,t){let n,i;rt(r,Zf,it=>t(20,i=it));let{map:o}=e,{waypoints:u}=e,{drawnShapeOut:a=void 0}=e;ei(()=>{i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let d="snap",m=[],_=[],v=null,S=!1,T=!1,C=!1;function L(it){let at=it.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=at}function P(){let it=m.pop();t(6,m),it&&t(0,u=it)}function D(){m.length==100&&m.shift(),t(6,m=[...m,JSON.parse(JSON.stringify(u))])}function I(it){u.length>=3||(D(),u.push({point:it.detail.lngLat.toArray(),snapped:d=="snap"}),t(0,u))}function U(it){t(19,v={point:it.detail.lngLat.toArray(),snapped:d=="snap"})}function O(it){D(),t(0,u[it].snapped=!u[it].snapped,u),t(0,u)}function ee(it){D(),u.splice(it,1),t(0,u),t(2,S=!1)}function X(it,at,ft,Ct){if(Ct||at.length>=3)return ii();try{if(it&&at.length>0&&ft)return JSON.parse(it.inner.calculateRoute([at[at.length-1],ft]))}catch{}return ii()}function ue(it,at,ft){if(ft)return;if(!it||at.length<3){t(7,_=[]);return}let Ct=[],xt=1,It=JSON.parse(JSON.stringify(at));It.push(It[0]);for(let Qt=0;Qt<It.length-1;Qt++){let tn=JSON.parse(it.inner.getExtraNodes(It[Qt],It[Qt+1]));for(let[rn,Ue,Xe]of tn)Ct.push({point:[rn,Ue],snapped:Xe,insertIdx:xt});xt++}t(7,_=Ct)}function $(it){D(),u.splice(it.insertIdx,0,{point:it.point,snapped:it.snapped}),t(0,u),t(4,C=!0)}function Q(it){t(0,u[it.insertIdx].point=it.point,u),t(0,u)}function ne(){t(4,C=!1)}function F(){D(),t(3,T=!0)}const Z=[[]];function J(){d=n3(Z[0],this.__value,this.checked),t(5,d)}function be(it,at){r.$$.not_equal(at.point,it)&&(at.point=it,t(7,_))}const ke=it=>$(it),ge=it=>Q(it),ve=it=>{$(it),t(4,C=!1)};function fe(it,at){r.$$.not_equal(at.point,it)&&(at.point=it,t(0,u))}const Pe=it=>O(it),Ee=it=>ee(it),Fe=()=>t(2,S=!0),ot=()=>t(2,S=!1),ct=()=>t(3,T=!1);return r.$$set=it=>{"map"in it&&t(18,o=it.map),"waypoints"in it&&t(0,u=it.waypoints),"drawnShapeOut"in it&&t(1,a=it.drawnShapeOut)},r.$$.update=()=>{if(r.$$.dirty[0]&1048577)try{i&&t(1,a=R6(i,u))}catch(it){console.log("error drawing shape",it),t(1,a=void 0)}r.$$.dirty[0]&1048593&&ue(i,u,C),r.$$.dirty[0]&1572877&&t(8,n=X(i,u,v,S||T)),r.$$.dirty[0]&1&&L(u)},[u,a,S,T,C,d,m,_,n,P,I,U,O,ee,$,Q,ne,F,o,v,i,J,Z,be,ke,ge,ve,fe,Pe,Ee,Fe,ot,ct]}class U2 extends kt{constructor(e){super(),St(this,e,B6,D6,gt,{map:18,waypoints:0,drawnShapeOut:1},null,[-1,-1])}}function Ib(r,e,t){const n=r.slice();return n[4]=e[t],n[6]=t,n}function Lb(r){let e,t,n,i,o,u,a;return o=new p3({props:{strokeWidth:"4px",size:"14px"}}),{c(){e=q("div"),t=q("div"),n=ae(),i=q("div"),pe(o.$$.fragment),u=ae(),ce(t,"class","bucket-color svelte-lqjxv2"),Ze(t,"background",r[4]),ce(i,"class","bucket-indicator svelte-lqjxv2"),ce(e,"class","bucket svelte-lqjxv2"),Nt(e,"selected",r[6]==r[1])},m(d,m){W(d,e,m),z(e,t),z(e,n),z(e,i),de(o,i,null),z(e,u),a=!0},p(d,m){m&1&&Ze(t,"background",d[4]),(!a||m&2)&&Nt(e,"selected",d[6]==d[1])},i(d){a||(N(o.$$.fragment,d),a=!0)},o(d){G(o.$$.fragment,d),a=!1},d(d){d&&H(e),he(o)}}}function F6(r){let e,t,n=zn(r[0]),i=[];for(let u=0;u<n.length;u+=1)i[u]=Lb(Ib(r,n,u));const o=u=>G(i[u],1,1,()=>{i[u]=null});return{c(){e=q("div");for(let u=0;u<i.length;u+=1)i[u].c();ce(e,"class","colors svelte-lqjxv2")},m(u,a){W(u,e,a);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(e,null);t=!0},p(u,[a]){if(a&3){n=zn(u[0]);let d;for(d=0;d<n.length;d+=1){const m=Ib(u,n,d);i[d]?(i[d].p(m,a),N(i[d],1)):(i[d]=Lb(m),i[d].c(),N(i[d],1),i[d].m(e,null))}for(Zt(),d=n.length;d<i.length;d+=1)o(d);Ht()}},i(u){if(!t){for(let a=0;a<n.length;a+=1)N(i[a]);t=!0}},o(u){i=i.filter(Boolean);for(let a=0;a<i.length;a+=1)G(i[a]);t=!1},d(u){u&&H(e),Jr(i,u)}}}function O6(r,e){let t=0;for(let n of r.slice(1,-1)){if(e<n)break;t++}return t}function N6(r,e,t){let n,{colorScale:i}=e,{limits:o}=e,{value:u}=e;return r.$$set=a=>{"colorScale"in a&&t(0,i=a.colorScale),"limits"in a&&t(2,o=a.limits),"value"in a&&t(3,u=a.value)},r.$$.update=()=>{r.$$.dirty&12&&t(1,n=O6(o,u))},[i,n,o,u]}class xl extends kt{constructor(e){super(),St(this,e,N6,F6,gt,{colorScale:0,limits:2,value:3})}}function Pb(r){let e,t,n,i,o,u,a,d=1+Math.floor(r[0].properties.simd/20)+"",m,_,v,S,T,C,L,P,D=Math.round(r[0].properties.population/r[0].properties.area_km2).toLocaleString()+"",I,U,O,ee,X,ue,$,Q,ne,F=Zu(r[0].properties.households_with_cars_or_vans,r[0].properties.total_households)+"",Z,J,be,ke,ge,ve,fe,Pe,Ee,Fe=(r[0].properties.number_pois/r[0].properties.area_km2).toFixed(1)+"",ot,ct,it,at,ft,Ct,xt,It,Qt,tn=(r[0].properties.number_stats19_collisions/r[0].properties.area_km2).toFixed(1)+"",rn,Ue,Xe,qt,Ge,et,nn,Ye,Ft,Tt=r[0].properties.combined_score+"",Rn,fr,un;return i=new xl({props:{colorScale:rh.toReversed(),limits:ih,value:100-r[0].properties.simd}}),C=new xl({props:{colorScale:Gu,limits:r[2].population_density,value:r[0].properties.population/r[0].properties.area_km2}}),$=new xl({props:{colorScale:sh.toReversed(),limits:oh,value:100*(1-r[0].properties.households_with_cars_or_vans/r[0].properties.total_households)}}),fe=new xl({props:{colorScale:e_,limits:r[2].poi_density,value:r[0].properties.number_pois/r[0].properties.area_km2}}),xt=new xl({props:{colorScale:Qg,limits:r[2].collision_density,value:r[0].properties.number_stats19_collisions/r[0].properties.area_km2}}),nn=new xl({props:{colorScale:n_,limits:t_,value:r[0].properties.combined_score}}),{c(){e=q("tr"),t=q("th"),n=Te(`SIMD
        `),pe(i.$$.fragment),o=ae(),u=q("td"),a=Te("quintile "),m=Te(d),_=ae(),v=q("tr"),S=q("th"),T=Te(`Population density
        `),pe(C.$$.fragment),L=ae(),P=q("td"),I=Te(D),U=Te(" people / km"),O=ae(),ee=q("tr"),X=q("th"),ue=Te(`Car ownership
        `),pe($.$$.fragment),Q=ae(),ne=q("td"),Z=Te(F),J=Te(" of households"),be=ae(),ke=q("tr"),ge=q("th"),ve=Te(`POI density
        `),pe(fe.$$.fragment),Pe=ae(),Ee=q("td"),ot=Te(Fe),ct=Te(" / km"),it=ae(),at=q("tr"),ft=q("th"),Ct=Te(`Collision density
        `),pe(xt.$$.fragment),It=ae(),Qt=q("td"),rn=Te(tn),Ue=Te(" / km"),Xe=ae(),qt=q("tr"),Ge=q("th"),et=Te(`Overall prioritisation score
        `),pe(nn.$$.fragment),Ye=ae(),Ft=q("td"),Rn=Te(Tt),fr=Te(" / 5")},m(Dt,Mt){W(Dt,e,Mt),z(e,t),z(t,n),de(i,t,null),z(e,o),z(e,u),z(u,a),z(u,m),W(Dt,_,Mt),W(Dt,v,Mt),z(v,S),z(S,T),de(C,S,null),z(v,L),z(v,P),z(P,I),z(P,U),W(Dt,O,Mt),W(Dt,ee,Mt),z(ee,X),z(X,ue),de($,X,null),z(ee,Q),z(ee,ne),z(ne,Z),z(ne,J),W(Dt,be,Mt),W(Dt,ke,Mt),z(ke,ge),z(ge,ve),de(fe,ge,null),z(ke,Pe),z(ke,Ee),z(Ee,ot),z(Ee,ct),W(Dt,it,Mt),W(Dt,at,Mt),z(at,ft),z(ft,Ct),de(xt,ft,null),z(at,It),z(at,Qt),z(Qt,rn),z(Qt,Ue),W(Dt,Xe,Mt),W(Dt,qt,Mt),z(qt,Ge),z(Ge,et),de(nn,Ge,null),z(qt,Ye),z(qt,Ft),z(Ft,Rn),z(Ft,fr),un=!0},p(Dt,Mt){const Vr={};Mt&1&&(Vr.value=100-Dt[0].properties.simd),i.$set(Vr),(!un||Mt&1)&&d!==(d=1+Math.floor(Dt[0].properties.simd/20)+"")&&yt(m,d);const vt={};Mt&4&&(vt.limits=Dt[2].population_density),Mt&1&&(vt.value=Dt[0].properties.population/Dt[0].properties.area_km2),C.$set(vt),(!un||Mt&1)&&D!==(D=Math.round(Dt[0].properties.population/Dt[0].properties.area_km2).toLocaleString()+"")&&yt(I,D);const Cn={};Mt&1&&(Cn.value=100*(1-Dt[0].properties.households_with_cars_or_vans/Dt[0].properties.total_households)),$.$set(Cn),(!un||Mt&1)&&F!==(F=Zu(Dt[0].properties.households_with_cars_or_vans,Dt[0].properties.total_households)+"")&&yt(Z,F);const Zn={};Mt&4&&(Zn.limits=Dt[2].poi_density),Mt&1&&(Zn.value=Dt[0].properties.number_pois/Dt[0].properties.area_km2),fe.$set(Zn),(!un||Mt&1)&&Fe!==(Fe=(Dt[0].properties.number_pois/Dt[0].properties.area_km2).toFixed(1)+"")&&yt(ot,Fe);const jr={};Mt&4&&(jr.limits=Dt[2].collision_density),Mt&1&&(jr.value=Dt[0].properties.number_stats19_collisions/Dt[0].properties.area_km2),xt.$set(jr),(!un||Mt&1)&&tn!==(tn=(Dt[0].properties.number_stats19_collisions/Dt[0].properties.area_km2).toFixed(1)+"")&&yt(rn,tn);const Nr={};Mt&1&&(Nr.value=Dt[0].properties.combined_score),nn.$set(Nr),(!un||Mt&1)&&Tt!==(Tt=Dt[0].properties.combined_score+"")&&yt(Rn,Tt)},i(Dt){un||(N(i.$$.fragment,Dt),N(C.$$.fragment,Dt),N($.$$.fragment,Dt),N(fe.$$.fragment,Dt),N(xt.$$.fragment,Dt),N(nn.$$.fragment,Dt),un=!0)},o(Dt){G(i.$$.fragment,Dt),G(C.$$.fragment,Dt),G($.$$.fragment,Dt),G(fe.$$.fragment,Dt),G(xt.$$.fragment,Dt),G(nn.$$.fragment,Dt),un=!1},d(Dt){Dt&&(H(e),H(_),H(v),H(O),H(ee),H(be),H(ke),H(it),H(at),H(Xe),H(qt)),he(i),he(C),he($),he(fe),he(xt),he(nn)}}}function $6(r){let e,t,n,i,o,u,a,d=r[0].properties.area_km2.toFixed(1)+"",m,_,v,S;o=new xl({props:{colorScale:Yg,limits:Kg,value:r[0].properties.area_km2}});let T=r[1]=="cnt"&&Pb(r);return{c(){e=q("table"),t=q("tr"),n=q("th"),i=Te(`Area
      `),pe(o.$$.fragment),u=ae(),a=q("td"),m=Te(d),_=Te(" km"),v=ae(),T&&T.c(),ce(e,"class","svelte-1kpsyee")},m(C,L){W(C,e,L),z(e,t),z(t,n),z(n,i),de(o,n,null),z(t,u),z(t,a),z(a,m),z(a,_),z(e,v),T&&T.m(e,null),S=!0},p(C,[L]){const P={};L&1&&(P.value=C[0].properties.area_km2),o.$set(P),(!S||L&1)&&d!==(d=C[0].properties.area_km2.toFixed(1)+"")&&yt(m,d),C[1]=="cnt"?T?(T.p(C,L),L&2&&N(T,1)):(T=Pb(C),T.c(),N(T,1),T.m(e,null)):T&&(Zt(),G(T,1,1,()=>{T=null}),Ht())},i(C){S||(N(o.$$.fragment,C),N(T),S=!0)},o(C){G(o.$$.fragment,C),G(T),S=!1},d(C){C&&H(e),he(o),T&&T.d()}}}function j6(r,e,t){let n,i;rt(r,Bo,u=>t(1,n=u)),rt(r,Qu,u=>t(2,i=u));let{neighbourhoodBoundary:o}=e;return r.$$set=u=>{"neighbourhoodBoundary"in u&&t(0,o=u.neighbourhoodBoundary)},[o,n,i]}class V2 extends kt{constructor(e){super(),St(this,e,j6,$6,gt,{neighbourhoodBoundary:0})}}function q2(r,e,t){let n=new Set(r.toSavefile().features.filter(i=>i.properties.kind=="boundary").map(i=>i.properties.name));for(;;){let i=window.prompt(e,t);if(i===null)return null;if(i=i.trim(),i==="")window.alert("Neighbourhood cannot be blank; please pick a name or cancel");else if(n.has(i))window.alert(`There is already a neighbourhood called ${i}; please pick another name`);else return i}}function U6(r){let e,t,n,i,o,u,a,d;return e=new Qi({props:{colorScale:n_,labels:{buckets:t_}}}),{c(){pe(e.$$.fragment),t=ae(),n=q("div"),n.innerHTML="<span>Least important</span> <span>Most important</span>",i=ae(),o=q("br"),u=ae(),a=q("p"),a.textContent="This score averages the other five metrics, on the 1-5 scale.",ce(n,"class","sub-labels svelte-3xhwrh")},m(m,_){de(e,m,_),W(m,t,_),W(m,n,_),W(m,i,_),W(m,o,_),W(m,u,_),W(m,a,_),d=!0},p:ht,i(m){d||(N(e.$$.fragment,m),d=!0)},o(m){G(e.$$.fragment,m),d=!1},d(m){m&&(H(t),H(n),H(i),H(o),H(u),H(a)),he(e,m)}}}function V6(r){let e,t,n,i;return e=new Qi({props:{colorScale:e_,labels:{limits:r[1].poi_density}}}),{c(){pe(e.$$.fragment),t=ae(),n=q("div"),n.textContent="POIs / km",Ze(n,"text-align","center")},m(o,u){de(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const a={};u&2&&(a.labels={limits:o[1].poi_density}),e.$set(a)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),he(e,o)}}}function q6(r){let e,t,n,i;return e=new Qi({props:{colorScale:Qg,labels:{limits:r[1].collision_density}}}),{c(){pe(e.$$.fragment),t=ae(),n=q("div"),n.textContent="collisions / km",Ze(n,"text-align","center")},m(o,u){de(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const a={};u&2&&(a.labels={limits:o[1].collision_density}),e.$set(a)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),he(e,o)}}}function G6(r){let e,t,n,i;return e=new Qi({props:{colorScale:rh.toReversed(),labels:{buckets:x2(ih).toReversed()}}}),{c(){pe(e.$$.fragment),t=ae(),n=q("div"),n.innerHTML="<span>Less deprived</span> <span>More deprived</span>",ce(n,"class","sub-labels svelte-3xhwrh")},m(o,u){de(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:ht,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),he(e,o)}}}function Z6(r){let e,t,n,i;return e=new Qi({props:{colorScale:sh.toReversed(),labels:{limits:oh.toReversed().map(J6)}}}),{c(){pe(e.$$.fragment),t=ae(),n=q("div"),n.innerHTML='<span style="text-align: center; width: 100%">Households with at least one car or van</span>',Ze(n,"display","flex"),Ze(n,"justify-content","space-between")},m(o,u){de(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:ht,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),he(e,o)}}}function H6(r){let e,t,n,i;return e=new Qi({props:{colorScale:Gu,labels:{limits:r[1].population_density}}}),{c(){pe(e.$$.fragment),t=ae(),n=q("div"),n.innerHTML="<span>Less dense</span> <span>people / km</span> <span>More dense</span>",ce(n,"class","sub-labels svelte-3xhwrh")},m(o,u){de(e,o,u),W(o,t,u),W(o,n,u),i=!0},p(o,u){const a={};u&2&&(a.labels={limits:o[1].population_density}),e.$set(a)},i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),he(e,o)}}}function W6(r){let e,t,n,i;return e=new Qi({props:{colorScale:Yg,labels:{limits:Kg}}}),{c(){pe(e.$$.fragment),t=ae(),n=q("div"),n.innerHTML="<span></span> <span>km</span> <span></span>",ce(n,"class","sub-labels svelte-3xhwrh")},m(o,u){de(e,o,u),W(o,t,u),W(o,n,u),i=!0},p:ht,i(o){i||(N(e.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),i=!1},d(o){o&&(H(t),H(n)),he(e,o)}}}function X6(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U;const O=[W6,H6,Z6,G6,q6,V6,U6],ee=[];function X(ue,$){return ue[0]=="area"?0:ue[0]=="population_density"?1:ue[0]=="car_ownership"?2:ue[0]=="simd"?3:ue[0]=="stats19"?4:ue[0]=="pois"?5:ue[0]=="combined"?6:-1}return~(C=X(r))&&(L=ee[C]=O[C](r)),{c(){e=q("div"),t=q("label"),t.textContent="Metric",n=ae(),i=q("select"),o=q("option"),o.textContent="None",u=q("option"),u.textContent="Area",a=q("option"),a.textContent="SIMD",d=q("option"),d.textContent="Population density",m=q("option"),m.textContent="Car ownership",_=q("option"),_.textContent="Points of interest",v=q("option"),v.textContent="Collisions",S=q("option"),S.textContent="Overall prioritisation score",T=ae(),L&&L.c(),P=rr(),Ze(t,"margin","0"),Ze(t,"padding","0"),ce(t,"for","prioritization-selection"),o.__value="none",Gn(o,o.__value),u.__value="area",Gn(u,u.__value),a.__value="simd",Gn(a,a.__value),d.__value="population_density",Gn(d,d.__value),m.__value="car_ownership",Gn(m,m.__value),_.__value="pois",Gn(_,_.__value),v.__value="stats19",Gn(v,v.__value),S.__value="combined",Gn(S,S.__value),ce(i,"id","prioritization-selection"),r[0]===void 0&&Ks(()=>r[2].call(i)),Ze(e,"display","flex"),Ze(e,"gap","16px"),Ze(e,"align-items","center"),Ze(e,"width","fit-content")},m(ue,$){W(ue,e,$),z(e,t),z(e,n),z(e,i),z(i,o),z(i,u),z(i,a),z(i,d),z(i,m),z(i,_),z(i,v),z(i,S),Mi(i,r[0],!0),W(ue,T,$),~C&&ee[C].m(ue,$),W(ue,P,$),D=!0,I||(U=_t(i,"change",r[2]),I=!0)},p(ue,[$]){$&1&&Mi(i,ue[0]);let Q=C;C=X(ue),C===Q?~C&&ee[C].p(ue,$):(L&&(Zt(),G(ee[Q],1,1,()=>{ee[Q]=null}),Ht()),~C?(L=ee[C],L?L.p(ue,$):(L=ee[C]=O[C](ue),L.c()),N(L,1),L.m(P.parentNode,P)):L=null)},i(ue){D||(N(L),D=!0)},o(ue){G(L),D=!1},d(ue){ue&&(H(e),H(T),H(P)),~C&&ee[C].d(ue),I=!1,U()}}}const J6=r=>`${r}%`;function K6(r,e,t){let n,i;rt(r,Bo,d=>t(3,n=d)),rt(r,Qu,d=>t(1,i=d));let{selectedPrioritization:o}=e;function u(){let d=new URL(window.location.href).searchParams.get("prioritisationMetric");d=="area"?t(0,o="area"):d=="population_density"?t(0,o="population_density"):d=="simd"?t(0,o="simd"):d=="stats19"?t(0,o="stats19"):d=="pois"?t(0,o="pois"):d=="car_ownership"?t(0,o="car_ownership"):d=="combined"&&t(0,o="combined")}n=="cnt"?u():o="none";function a(){o=Ys(this),t(0,o)}return r.$$set=d=>{"selectedPrioritization"in d&&t(0,o=d.selectedPrioritization)},r.$$.update=()=>{if(r.$$.dirty&1){const d=new URL(window.location.href);o=="none"?d.searchParams.delete("prioritisationMetric"):d.searchParams.set("prioritisationMetric",o),history.replaceState({},"",d)}},[o,i,a]}class G2 extends kt{constructor(e){super(),St(this,e,K6,X6,gt,{selectedPrioritization:0})}}function Z2(r,e,t){return{none:r.none,area:Bi(["get","area_km2"],Kg,Yg),car_ownership:Bi(["*",100,["/",["get","households_with_cars_or_vans"],["get","total_households"]]],oh,sh),population_density:Bi(["/",["get","population"],["get","area_km2"]],t.population_density,Gu),pois:Bi(["/",["get","number_pois"],["get","area_km2"]],t.poi_density,e_),simd:Bi(["get","simd"],ih,rh),stats19:Bi(["/",["get","number_stats19_collisions"],["get","area_km2"]],t.collision_density,Qg),combined:Bi(["get","combined_score"],t_,n_)}[e]}const{window:Y6}=Lg;function Q6(r){let e,t,n,i,o,u,a,d,m,_,v=Mr(r[8].mode)+"",S,T;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),_=q("li"),S=Te(v),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(C,L){W(C,e,L),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),z(n,_),z(_,S),T=!0},p(C,L){(!T||L[0]&256)&&v!==(v=Mr(C[8].mode)+"")&&yt(S,v)},i(C){T||(N(o.$$.fragment,C),N(d.$$.fragment,C),T=!0)},o(C){G(o.$$.fragment,C),G(d.$$.fragment,C),T=!1},d(C){C&&H(e),he(o),he(d)}}}function zb(r){let e,t,n,i,o,u,a;function d(_){r[21](_)}let m={};return r[4]!==void 0&&(m.selectedPrioritization=r[4]),o=new G2({props:m}),wn.push(()=>On(o,"selectedPrioritization",d)),{c(){e=q("h3"),e.textContent="Prioritisation",t=ae(),n=q("p"),n.textContent=`Compare the prioritisation or individual metrics across candidate
        neighbourhoods.`,i=ae(),pe(o.$$.fragment)},m(_,v){W(_,e,v),W(_,t,v),W(_,n,v),W(_,i,v),de(o,_,v),a=!0},p(_,v){const S={};!u&&v[0]&16&&(u=!0,S.selectedPrioritization=_[4],Nn(()=>u=!1)),o.$set(S)},i(_){a||(N(o.$$.fragment,_),a=!0)},o(_){G(o.$$.fragment,_),a=!1},d(_){_&&(H(e),H(t),H(n),H(i)),he(o,_)}}}function Db(r){let e;return{c(){e=q("p"),e.textContent="The colors are arbitrary, just to distinguish better."},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function eL(r){let e,t,n,i,o,u,a,d;function m(S){r[24](S)}function _(S){r[25](S)}let v={map:cr(r[10])};return r[6]!==void 0&&(v.waypoints=r[6]),r[1]!==void 0&&(v.drawnShapeOut=r[1]),n=new U2({props:v}),wn.push(()=>On(n,"waypoints",m)),wn.push(()=>On(n,"drawnShapeOut",_)),{c(){e=q("div"),e.innerHTML='<h3 class="svelte-iaefgo">1. Draw your neighbourhood</h3>',t=ae(),pe(n.$$.fragment),u=ae(),a=q("div"),a.innerHTML=`<h3 class="svelte-iaefgo">2. Refine your boundary</h3> <p>Continue to add, delete, and move points until you&#39;re happy with
            your neighbourhood boundary. Don&#39;t worry, you can always adjust the
            boundary more later.</p>`,ce(e,"class","step svelte-iaefgo"),Nt(e,"active",!r[7]),Nt(e,"complete",r[7]),ce(a,"class","step svelte-iaefgo"),Ze(a,"margin-top","16px"),Nt(a,"active",r[7]),Nt(a,"complete",r[5].size>1)},m(S,T){W(S,e,T),W(S,t,T),de(n,S,T),W(S,u,T),W(S,a,T),d=!0},p(S,T){(!d||T[0]&128)&&Nt(e,"active",!S[7]),(!d||T[0]&128)&&Nt(e,"complete",S[7]);const C={};T[0]&1024&&(C.map=cr(S[10])),!i&&T[0]&64&&(i=!0,C.waypoints=S[6],Nn(()=>i=!1)),!o&&T[0]&2&&(o=!0,C.drawnShapeOut=S[1],Nn(()=>o=!1)),n.$set(C),(!d||T[0]&128)&&Nt(a,"active",S[7]),(!d||T[0]&32)&&Nt(a,"complete",S[5].size>1)},i(S){d||(N(n.$$.fragment,S),d=!0)},o(S){G(n.$$.fragment,S),d=!1},d(S){S&&(H(e),H(t),H(u),H(a)),he(n,S)}}}function tL(r){let e,t,n;return{c(){e=q("div"),e.innerHTML=`<h3 class="svelte-iaefgo">1. Click an area to start your neighbourhood</h3> <p>These particular boundaries are suggested by finding roads,
            railways, and water that form severances.</p>`,t=ae(),n=q("div"),n.innerHTML='<h3 class="svelte-iaefgo">2. Include additional areas</h3> <p>Click any adjacent areas you&#39;d like to add to your boundary.</p>',ce(e,"class","step svelte-iaefgo"),Nt(e,"active",!r[7]),Nt(e,"complete",r[7]),ce(n,"class","step svelte-iaefgo"),Nt(n,"active",r[7]),Nt(n,"complete",r[5].size>1)},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o[0]&128&&Nt(e,"active",!i[7]),o[0]&128&&Nt(e,"complete",i[7]),o[0]&128&&Nt(n,"active",i[7]),o[0]&32&&Nt(n,"complete",i[5].size>1)},i:ht,o:ht,d(i){i&&(H(e),H(t),H(n))}}}function nL(r){let e;function t(o,u){if(o[0]=="choose-area")return oL;if(o[0]=="draw-area")return iL}let n=t(r),i=n&&n(r);return{c(){e=q("span"),i&&i.c(),Ze(e,"text-align","center")},m(o,u){W(o,e,u),i&&i.m(e,null)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e,null)))},i:ht,o:ht,d(o){o&&H(e),i&&i.d()}}}function rL(r){let e,t;return e=new V2({props:{neighbourhoodBoundary:r[7]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.neighbourhoodBoundary=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function iL(r){let e;function t(o,u){return o[6].length<3?aL:sL}let n=t(r),i=n(r);return{c(){i.c(),e=rr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i.d(o)}}}function oL(r){let e;return{c(){e=Te("Empty so far. Click a colored area to get started.")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function sL(r){let e;return{c(){e=Te(`Not a valid shape yet  try dragging the points into a box
                around your neighbourhood. Note the ordering of the points.`)},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function aL(r){let e;return{c(){e=Te(`Empty so far. Click the map to add points around your
                neighborhood to get started.`)},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function lL(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U,O,ee,X,ue,$,Q,ne,F,Z,J,be,ke,ge,ve,fe,Pe,Ee,Fe,ot,ct,it,at,ft,Ct,xt;t=new Is({props:{mode:{mode:"pick-neighbourhood"}}});let It=r[9]=="cnt"&&zb(r),Qt=r[4]=="none"&&Db();v=new cw({}),L=new zg({});const tn=[tL,eL],rn=[];function Ue(et,nn){return et[0]=="choose-area"?0:et[0]=="draw-area"?1:-1}~(I=Ue(r))&&(U=rn[I]=tn[I](r)),J=new ep({});const Xe=[rL,nL],qt=[];function Ge(et,nn){return et[7]?0:1}return Ee=Ge(r),Fe=qt[Ee]=Xe[Ee](r),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),It&&It.c(),i=ae(),Qt&&Qt.c(),o=ae(),u=q("hr"),a=ae(),d=q("div"),m=q("div"),_=q("button"),pe(v.$$.fragment),S=Te(`
          Choose area`),T=Te(`
        or
        `),C=q("button"),pe(L.$$.fragment),P=Te(`
          Draw area`),D=ae(),U&&U.c(),O=ae(),ee=q("div"),ee.innerHTML='<h3 class="svelte-iaefgo">3. Finished?</h3> <p>When you&#39;re done, click &quot;Create&quot;.</p>',X=ae(),ue=q("div"),$=q("button"),Q=Te("Create neighborhood"),F=ae(),Z=q("button"),pe(J.$$.fragment),be=Te(" Start over"),ge=ae(),ve=q("h3"),ve.textContent="Your neighbourhood overall",fe=ae(),Pe=q("div"),Fe.c(),ot=ae(),ct=q("hr"),it=ae(),at=q("button"),at.textContent="Export metrics to GeoJSON",Nt(_,"active",r[0]=="choose-area"),Nt(C,"active",r[0]=="draw-area"),ce(m,"class","tool-palette svelte-iaefgo"),Ze(m,"display","flex"),Ze(m,"align-items","center"),Ze(m,"gap","16px"),ce(ee,"class","step svelte-iaefgo"),Nt(ee,"active",r[7]),$.disabled=ne=!r[7],ce(Z,"class","destructive"),Ze(Z,"display","flex"),Ze(Z,"gap","8px"),Ze(Z,"align-items","center"),Z.disabled=ke=!(r[7]||r[0]=="draw-area"&&r[6].length>0),Ze(ue,"display","flex"),Ze(ue,"gap","16px"),Ze(ue,"justify-content","space-between"),Ze(ue,"margin-bottom","16px"),ce(Pe,"class","neighbourhood-boundary-summary svelte-iaefgo"),ce(at,"class","secondary"),ce(e,"slot","sidebar")},m(et,nn){W(et,e,nn),de(t,e,null),z(e,n),It&&It.m(e,null),z(e,i),Qt&&Qt.m(e,null),z(e,o),z(e,u),z(e,a),z(e,d),z(d,m),z(m,_),de(v,_,null),z(_,S),z(m,T),z(m,C),de(L,C,null),z(C,P),z(d,D),~I&&rn[I].m(d,null),z(d,O),z(d,ee),z(d,X),z(d,ue),z(ue,$),z($,Q),z(ue,F),z(ue,Z),de(J,Z,null),z(Z,be),z(d,ge),z(d,ve),z(d,fe),z(d,Pe),qt[Ee].m(Pe,null),z(e,ot),z(e,ct),z(e,it),z(e,at),ft=!0,Ct||(xt=[_t(_,"click",r[22]),_t(C,"click",r[23]),_t($,"click",r[26]),_t(Z,"click",r[16]),_t(at,"click",r[13])],Ct=!0)},p(et,nn){et[9]=="cnt"?It?(It.p(et,nn),nn[0]&512&&N(It,1)):(It=zb(et),It.c(),N(It,1),It.m(e,i)):It&&(Zt(),G(It,1,1,()=>{It=null}),Ht()),et[4]=="none"?Qt||(Qt=Db(),Qt.c(),Qt.m(e,o)):Qt&&(Qt.d(1),Qt=null),(!ft||nn[0]&1)&&Nt(_,"active",et[0]=="choose-area"),(!ft||nn[0]&1)&&Nt(C,"active",et[0]=="draw-area");let Ye=I;I=Ue(et),I===Ye?~I&&rn[I].p(et,nn):(U&&(Zt(),G(rn[Ye],1,1,()=>{rn[Ye]=null}),Ht()),~I?(U=rn[I],U?U.p(et,nn):(U=rn[I]=tn[I](et),U.c()),N(U,1),U.m(d,O)):U=null),(!ft||nn[0]&128)&&Nt(ee,"active",et[7]),(!ft||nn[0]&128&&ne!==(ne=!et[7]))&&($.disabled=ne),(!ft||nn[0]&193&&ke!==(ke=!(et[7]||et[0]=="draw-area"&&et[6].length>0)))&&(Z.disabled=ke);let Ft=Ee;Ee=Ge(et),Ee===Ft?qt[Ee].p(et,nn):(Zt(),G(qt[Ft],1,1,()=>{qt[Ft]=null}),Ht(),Fe=qt[Ee],Fe?Fe.p(et,nn):(Fe=qt[Ee]=Xe[Ee](et),Fe.c()),N(Fe,1),Fe.m(Pe,null))},i(et){ft||(N(t.$$.fragment,et),N(It),N(v.$$.fragment,et),N(L.$$.fragment,et),N(U),N(J.$$.fragment,et),N(Fe),ft=!0)},o(et){G(t.$$.fragment,et),G(It),G(v.$$.fragment,et),G(L.$$.fragment,et),G(U),G(J.$$.fragment,et),G(Fe),ft=!1},d(et){et&&H(e),he(t),It&&It.d(),Qt&&Qt.d(),he(v),he(L),~I&&rn[I].d(),he(J),qt[Ee].d(),Ct=!1,Er(xt)}}}function Rb(r){let e,t;return e=new yr({props:{data:{type:"FeatureCollection",features:[r[7]]},$$slots:{default:[uL]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i[0]&128&&(o.data={type:"FeatureCollection",features:[n[7]]}),i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function uL(r){let e,t,n,i;const o=[sn("neighbourhood-boundaries-selected-outline",!1),{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let u={};for(let m=0;m<o.length;m+=1)u=wt(u,o[m]);e=new gr({props:u});const a=[sn("neighbourhood-boundaries-selected-outline-base",!1),{paint:{"line-color":"white","line-width":8}}];let d={};for(let m=0;m<a.length;m+=1)d=wt(d,a[m]);return n=new gr({props:d}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),i=!0},p(m,_){const v={};e.$set(v);const S={};n.$set(S)},i(m){i||(N(e.$$.fragment,m),N(n.$$.fragment,m),i=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),i=!1},d(m){m&&H(t),he(e,m),he(n,m)}}}function Bb(r){let e,t;return e=new yr({props:{data:r[3],generateId:!0,$$slots:{default:[yL]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i[0]&8&&(o.data=n[3]),i[0]&16|i[1]&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Fb(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[gL,({props:n})=>({31:n}),({props:n})=>[0,n?1:0]]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i[0]&16|i[1]&3&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function cL(r){let e,t,n,i,o=r[31].combined_score+"",u;return{c(){e=q("b"),e.textContent="Combined score",t=ae(),n=q("br"),i=ae(),u=Te(o)},m(a,d){W(a,e,d),W(a,t,d),W(a,n,d),W(a,i,d),W(a,u,d)},p(a,d){d[1]&1&&o!==(o=a[31].combined_score+"")&&yt(u,o)},d(a){a&&(H(e),H(t),H(n),H(i),H(u))}}}function fL(r){let e,t,n,i,o=(r[31].number_pois/r[31].area_km2).toFixed(1)+"",u,a;return{c(){e=q("b"),e.textContent="Points of interest",t=ae(),n=q("br"),i=ae(),u=Te(o),a=Te(" / km")},m(d,m){W(d,e,m),W(d,t,m),W(d,n,m),W(d,i,m),W(d,u,m),W(d,a,m)},p(d,m){m[1]&1&&o!==(o=(d[31].number_pois/d[31].area_km2).toFixed(1)+"")&&yt(u,o)},d(d){d&&(H(e),H(t),H(n),H(i),H(u),H(a))}}}function hL(r){let e,t,n,i,o=(r[31].number_stats19_collisions/r[31].area_km2).toFixed(1)+"",u,a;return{c(){e=q("b"),e.textContent="Pedestrian and cyclist collisions",t=ae(),n=q("br"),i=ae(),u=Te(o),a=Te(` /
                km`)},m(d,m){W(d,e,m),W(d,t,m),W(d,n,m),W(d,i,m),W(d,u,m),W(d,a,m)},p(d,m){m[1]&1&&o!==(o=(d[31].number_stats19_collisions/d[31].area_km2).toFixed(1)+"")&&yt(u,o)},d(d){d&&(H(e),H(t),H(n),H(i),H(u),H(a))}}}function dL(r){let e,t,n,i,o=Math.round(r[31].population/r[31].area_km2).toLocaleString()+"",u,a;return{c(){e=q("b"),e.textContent="Population density",t=ae(),n=q("br"),i=ae(),u=Te(o),a=Te(`
                people / km`)},m(d,m){W(d,e,m),W(d,t,m),W(d,n,m),W(d,i,m),W(d,u,m),W(d,a,m)},p(d,m){m[1]&1&&o!==(o=Math.round(d[31].population/d[31].area_km2).toLocaleString()+"")&&yt(u,o)},d(d){d&&(H(e),H(t),H(n),H(i),H(u),H(a))}}}function pL(r){let e,t,n,i,o=Zu(r[31].households_with_cars_or_vans,r[31].total_households)+"",u,a,d=r[31].total_households.toLocaleString()+"",m,_;return{c(){e=q("b"),e.textContent="Car or van ownership",t=ae(),n=q("br"),i=ae(),u=Te(o),a=Te(" of approximately "),m=Te(d),_=Te(`
                households have at least one car or van.`)},m(v,S){W(v,e,S),W(v,t,S),W(v,n,S),W(v,i,S),W(v,u,S),W(v,a,S),W(v,m,S),W(v,_,S)},p(v,S){S[1]&1&&o!==(o=Zu(v[31].households_with_cars_or_vans,v[31].total_households)+"")&&yt(u,o),S[1]&1&&d!==(d=v[31].total_households.toLocaleString()+"")&&yt(m,d)},d(v){v&&(H(e),H(t),H(n),H(i),H(u),H(a),H(m),H(_))}}}function mL(r){let e,t,n=r[31].area_km2.toFixed(1)+"",i,o;return{c(){e=q("b"),e.textContent="Area:",t=ae(),i=Te(n),o=Te(" km")},m(u,a){W(u,e,a),W(u,t,a),W(u,i,a),W(u,o,a)},p(u,a){a[1]&1&&n!==(n=u[31].area_km2.toFixed(1)+"")&&yt(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function gL(r){let e;function t(o,u){if(o[4]=="none"||o[4]=="area")return mL;if(o[4]=="car_ownership")return pL;if(o[4]=="population_density")return dL;if(o[4]=="stats19")return hL;if(o[4]=="pois")return fL;if(o[4]=="combined")return cL}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=rr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i&&i.d(o)}}}function _L(r){let e,t,n=r[4]!="simd"&&Fb(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[4]!="simd"?n?(n.p(i,o),o[0]&16&&N(n,1)):(n=Fb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function yL(r){let e,t,n,i;const o=[sn("neighbourhood-boundaries",!1),{paint:{"fill-color":r[14](r[4]),"fill-opacity":r[15](r[4])}},{manageHoverState:!0},{hoverCursor:"pointer"}];let u={$$slots:{default:[_L]},$$scope:{ctx:r}};for(let m=0;m<o.length;m+=1)u=wt(u,o[m]);e=new Zi({props:u}),e.$on("click",r[11]);const a=[sn("neighbourhood-boundaries-outline",!1),{paint:{"line-color":"black","line-width":1}}];let d={};for(let m=0;m<a.length;m+=1)d=wt(d,a[m]);return n=new gr({props:d}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),i=!0},p(m,_){const v=_[0]&49168?Tn(o,[o[0],{paint:{"fill-color":m[14](m[4]),"fill-opacity":m[15](m[4])}},o[2],o[3]]):{};_[0]&16|_[1]&2&&(v.$$scope={dirty:_,ctx:m}),e.$set(v);const S={};n.$set(S)},i(m){i||(N(e.$$.fragment,m),N(n.$$.fragment,m),i=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),i=!1},d(m){m&&H(t),he(e,m),he(n,m)}}}function bL(r){let e,t,n,i=r[7]&&Rb(r),o=r[0]=="choose-area"&&Bb(r);return{c(){e=q("div"),i&&i.c(),t=ae(),o&&o.c(),ce(e,"slot","map")},m(u,a){W(u,e,a),i&&i.m(e,null),z(e,t),o&&o.m(e,null),n=!0},p(u,a){u[7]?i?(i.p(u,a),a[0]&128&&N(i,1)):(i=Rb(u),i.c(),N(i,1),i.m(e,t)):i&&(Zt(),G(i,1,1,()=>{i=null}),Ht()),u[0]=="choose-area"?o?(o.p(u,a),a[0]&1&&N(o,1)):(o=Bb(u),o.c(),N(o,1),o.m(e,null)):o&&(Zt(),G(o,1,1,()=>{o=null}),Ht())},i(u){n||(N(i),N(o),n=!0)},o(u){G(i),G(o),n=!1},d(u){u&&H(e),i&&i.d(),o&&o.d()}}}function vL(r){let e,t,n,i,o,u;return e=new qu({props:{loading:r[2]}}),n=new po({props:{$$slots:{map:[bL],sidebar:[lL],top:[Q6]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(a,d){de(e,a,d),W(a,t,d),de(n,a,d),i=!0,o||(u=_t(Y6,"keydown",r[17]),o=!0)},p(a,d){const m={};d[0]&4&&(m.loading=a[2]),e.$set(m);const _={};d[0]&2043|d[1]&2&&(_.$$scope={dirty:d,ctx:a}),n.$set(_)},i(a){i||(N(e.$$.fragment,a),N(n.$$.fragment,a),i=!0)},o(a){G(e.$$.fragment,a),G(n.$$.fragment,a),i=!1},d(a){a&&H(t),he(e,a),he(n,a),o=!1,u()}}}function wL(r,e,t){let n,i,o,u,a,d,m,_;rt(r,Qu,fe=>t(27,n=fe)),rt(r,or,fe=>t(8,i=fe)),rt(r,Ba,fe=>t(28,o=fe)),rt(r,Cr,fe=>t(20,u=fe)),rt(r,zo,fe=>t(29,a=fe)),rt(r,ta,fe=>t(30,d=fe)),rt(r,Bo,fe=>t(9,m=fe)),rt(r,Ko,fe=>t(10,_=fe));let v="Generating severance boundaries...",S=ii(),T="choose-area",C=m=="cnt"?"combined":"none",L=null,P=new Map,D=[],I,U=null,O=null;Yo(async()=>{await sp(),t(3,S=u.generatedBoundaries()),t(2,v="")});function ee(fe){let Pe=fe.detail.features[0].id,Ee=S.features[Pe],Fe=new Map(P);if(Fe.has(Pe)?Fe.delete(Pe):Fe.set(Pe,Ee),Fe.size===0)t(18,L=null),t(5,P=Fe);else if(Fe.size===1)t(18,L=Fe.values().next().value),t(5,P=Fe);else{let ot={type:"FeatureCollection",features:Array.from(Fe.values())};try{t(18,L=u.generateMergedBoundary(ot)),t(5,P=Fe)}catch(ct){console.log(`error merging boundaries: ${ct}`),window.alert(`Sorry, the boundaries you selected cannot be merged.
Error: ${ct}`)}}}function X(fe){var Fe;let Pe=d.nextAvailableNeighbourhoodName(a),Ee=q2(u,"What do you want to name the neighbourhood?",Pe);if(Ee)try{const ot={};T=="draw-area"&&((Fe=I==null?void 0:I.properties)!=null&&Fe.waypoints)&&(ot.waypoints=I.properties.waypoints);let ct={type:"Feature",properties:ot,geometry:fe.geometry};u.setCurrentNeighbourhoodBoundary(Ee,ct),on(Ba,o=Ee,o),Uf(),on(or,i={mode:"neighbourhood"},i)}catch(ot){window.alert(`Sorry, this boundary is invalid: ${ot}`)}}function ue(){np("auto_boundaries.geojson",JSON.stringify(S,null,"  "))}function $(fe){return Z2({none:["match",["%",["id"],5],0,"blue",1,"yellow",2,"green",3,"purple",4,"orange","black"]},fe,n)}function Q(fe){return{none:nr(.3,.5),area:nr(.7,.9),car_ownership:nr(.7,.9),population_density:nr(.7,.9),pois:nr(.7,.9),simd:nr(.7,.9),stats19:nr(.7,.9),combined:nr(.7,.9)}[fe]}function ne(){t(18,L=null),P.clear(),t(5,P),t(6,D=[]),t(19,U=null),t(7,O=null)}function F(fe){fe.key=="Enter"&&O&&X(O)}function Z(fe){C=fe,t(4,C)}const J=()=>t(0,T="choose-area"),be=()=>t(0,T="draw-area");function ke(fe){D=fe,t(6,D)}function ge(fe){I=fe,t(1,I)}const ve=()=>X(cr(O));return r.$$.update=()=>{if(r.$$.dirty[0]&1048578){let fe=null;if(I&&I.geometry.coordinates[0].length>3){let Pe={type:"FeatureCollection",features:[I]};try{fe=u.generateMergedBoundary(Pe)}catch(Ee){console.log(`error merging boundaries: ${Ee}`)}}t(19,U=fe)}r.$$.dirty[0]&786433&&(T=="draw-area"?t(7,O=U):t(7,O=L))},[T,I,v,S,C,P,D,O,i,m,_,ee,X,ue,$,Q,ne,F,L,U,u,Z,J,be,ke,ge,ve]}class xL extends kt{constructor(e){super(),St(this,e,wL,vL,gt,{},null,[-1,-1])}}const AL="/ltn/assets/bus_gate_icon-uqLuLB7T.gif",kL="/ltn/assets/bus_gate-Dqp8PR-8.gif",SL="/ltn/assets/no_entry_icon-C0369Zpr.gif",TL="/ltn/assets/no_entry-t5FpsRr-.gif",CL="/ltn/assets/school_street_icon-Dc8MrJ0F.gif",ML="/ltn/assets/school_street-C6xhQwM-.gif",EL="/ltn/assets/walk_cycle_only_icon-Cx19XghM.gif",IL="/ltn/assets/walk_cycle_only-4uLhWa-f.gif",_i=class _i{constructor(e,t,n,i,o){mr(this,"filterType");mr(this,"label");mr(this,"description");mr(this,"imageUrl");mr(this,"iconUrl");this.filterType=e,this.label=t,this.description=n,this.imageUrl=i,this.iconUrl=o}get iconURL(){return this.iconUrl}get largeImageURL(){return this.imageUrl}static getFilter(e){switch(e){case"walk_cycle_only":return _i.walkCycleOnly;case"no_entry":return _i.noEntry;case"bus_gate":return _i.busGate;case"school_street":return _i.schoolStreet;default:console.assert(`unknown filter type: "${e}"`);return}}};mr(_i,"walkCycleOnly",new _i("walk_cycle_only","Walking/cycling only","A physical barrier that only allows people walking, cycling, and rolling to pass. Often planters or bollards. Larger vehicles cannot enter.",IL,EL)),mr(_i,"noEntry",new _i("no_entry","No entry","An alternative sign to indicate vehicles are not allowed to enter the street. Only people walking, cycling, and rolling may pass through.",TL,SL)),mr(_i,"busGate",new _i("bus_gate","Bus gate","A bus gate sign and traffic cameras are installed to allow buses, pedestrians, and cyclists to pass. There is no physical barrier.",kL,AL)),mr(_i,"schoolStreet",new _i("school_street","School street","A closure during school hours only. The barrier usually allows teachers and staff to access the school.",ML,CL)),mr(_i,"allTypes",[_i.walkCycleOnly,_i.noEntry,_i.busGate,_i.schoolStreet]);let Ri=_i;function LL(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C=Mr(r[7].mode)+"",L,P;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),v=new jn({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),_=q("li"),pe(v.$$.fragment),S=ae(),T=q("li"),L=Te(C),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(D,I){W(D,e,I),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),z(n,_),de(v,_,null),z(n,S),z(n,T),z(T,L),P=!0},p(D,I){(!P||I&128)&&C!==(C=Mr(D[7].mode)+"")&&yt(L,C)},i(D){P||(N(o.$$.fragment,D),N(d.$$.fragment,D),N(v.$$.fragment,D),P=!0)},o(D){G(o.$$.fragment,D),G(d.$$.fragment,D),G(v.$$.fragment,D),P=!1},d(D){D&&H(e),he(o),he(d),he(v)}}}function PL(r){let e;return{c(){e=q("p"),e.textContent="Hover on a zone"},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function zL(r){let e,t=r[6].properties.name+"",n,i,o,u,a=r[6].properties.sum_from.toLocaleString()+"",d,m,_,v,S=r[6].properties.sum_to.toLocaleString()+"",T,C,L,P,D=r[6].properties.counts_from[r[3]]+"",I;return{c(){e=q("u"),n=Te(t),i=ae(),o=q("p"),u=Te("Total trips from here: "),d=Te(a),m=ae(),_=q("p"),v=Te("Total trips to here: "),T=Te(S),C=ae(),L=q("p"),P=Te("Total intra-zonal trips starting and ending here: "),I=Te(D)},m(U,O){W(U,e,O),z(e,n),W(U,i,O),W(U,o,O),z(o,u),z(o,d),W(U,m,O),W(U,_,O),z(_,v),z(_,T),W(U,C,O),W(U,L,O),z(L,P),z(L,I)},p(U,O){O&64&&t!==(t=U[6].properties.name+"")&&yt(n,t),O&64&&a!==(a=U[6].properties.sum_from.toLocaleString()+"")&&yt(d,a),O&64&&S!==(S=U[6].properties.sum_to.toLocaleString()+"")&&yt(T,S),O&72&&D!==(D=U[6].properties.counts_from[U[3]]+"")&&yt(I,D)},d(U){U&&(H(e),H(i),H(o),H(m),H(_),H(C),H(L))}}}function DL(r){let e,t,n,i,o,u=r[0].features.length.toLocaleString()+"",a,d,m,_,v,S,T,C,L,P,D=r[1]?"from":"to",I,U,O=r[3]==null?"each zone":"this zone",ee,X,ue,$,Q,ne,F,Z,J,be;t=new Is({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}}),$=new Qi({props:{colorScale:Pd,labels:{limits:r[5]}}});function ke(fe,Pe){return fe[6]&&fe[3]!=null?zL:PL}let ge=ke(r),ve=ge(r);return{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("p"),o=Te("Trips begin and end in "),a=Te(u),d=Te(" zones"),m=ae(),_=q("label"),v=Te(`Trips from
      `),S=q("input"),T=Te(`
      Trips to`),C=ae(),L=q("p"),P=Te("Trips "),I=Te(D),U=ae(),ee=Te(O),X=Te(":"),ue=ae(),pe($.$$.fragment),Q=ae(),ne=q("hr"),F=ae(),ve.c(),ce(S,"type","checkbox"),ce(S,"role","switch"),ce(e,"slot","sidebar")},m(fe,Pe){W(fe,e,Pe),de(t,e,null),z(e,n),z(e,i),z(i,o),z(i,a),z(i,d),z(e,m),z(e,_),z(_,v),z(_,S),S.checked=r[1],z(_,T),z(e,C),z(e,L),z(L,P),z(L,I),z(L,U),z(L,ee),z(L,X),z(e,ue),de($,e,null),z(e,Q),z(e,ne),z(e,F),ve.m(e,null),Z=!0,J||(be=_t(S,"change",r[9]),J=!0)},p(fe,Pe){(!Z||Pe&1)&&u!==(u=fe[0].features.length.toLocaleString()+"")&&yt(a,u),Pe&2&&(S.checked=fe[1]),(!Z||Pe&2)&&D!==(D=fe[1]?"from":"to")&&yt(I,D),(!Z||Pe&8)&&O!==(O=fe[3]==null?"each zone":"this zone")&&yt(ee,O);const Ee={};Pe&32&&(Ee.labels={limits:fe[5]}),$.$set(Ee),ge===(ge=ke(fe))&&ve?ve.p(fe,Pe):(ve.d(1),ve=ge(fe),ve&&(ve.c(),ve.m(e,null)))},i(fe){Z||(N(t.$$.fragment,fe),N($.$$.fragment,fe),Z=!0)},o(fe){G(t.$$.fragment,fe),G($.$$.fragment,fe),Z=!1},d(fe){fe&&H(e),he(t),he($),ve.d(),J=!1,be()}}}function RL(r){let e,t,n,i,o;const u=[sn("debug-demand-fill"),{paint:{"fill-color":r[4],"fill-opacity":nr(.5,.1)}},{manageHoverState:!0}];function a(v){r[8](v)}let d={};for(let v=0;v<u.length;v+=1)d=wt(d,u[v]);r[2]!==void 0&&(d.hovered=r[2]),e=new Zi({props:d}),wn.push(()=>On(e,"hovered",a));const m=[sn("debug-demand-outline"),{paint:{"line-width":2,"line-color":"black"}}];let _={};for(let v=0;v<m.length;v+=1)_=wt(_,m[v]);return i=new gr({props:_}),{c(){pe(e.$$.fragment),n=ae(),pe(i.$$.fragment)},m(v,S){de(e,v,S),W(v,n,S),de(i,v,S),o=!0},p(v,S){const T=S&16?Tn(u,[u[0],{paint:{"fill-color":v[4],"fill-opacity":nr(.5,.1)}},u[2]]):{};!t&&S&4&&(t=!0,T.hovered=v[2],Nn(()=>t=!1)),e.$set(T);const C={};i.$set(C)},i(v){o||(N(e.$$.fragment,v),N(i.$$.fragment,v),o=!0)},o(v){G(e.$$.fragment,v),G(i.$$.fragment,v),o=!1},d(v){v&&H(n),he(e,v),he(i,v)}}}function BL(r){let e,t,n;return t=new yr({props:{data:r[0],generateId:!0,$$slots:{default:[RL]},$$scope:{ctx:r}}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","map")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p(i,o){const u={};o&1&&(u.data=i[0]),o&8212&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function FL(r){let e,t;return e=new po({props:{$$slots:{map:[BL],sidebar:[DL],top:[LL]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&8447&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function OL(r,e,t){let n,i,o,u,a,d;rt(r,or,P=>t(7,a=P)),rt(r,Cr,P=>t(10,d=P));let m=ii();try{m=d.getDemandModel()}catch{window.alert("No demand model for this area"),on(or,a={mode:"pick-neighbourhood"},a)}let _=!1,v=null;function S(P,D){if(P==null){let I=D?"sum_to":"sum_from",U=Math.max(...m.features.map(ee=>ee.properties[I])),O=T(U);return[O,Bi(["get",I],O,Pd)]}else{let I=D?"counts_to":"counts_from",U=[...m.features.map(X=>X.properties[I][P])],O=Math.max(...U),ee=T(O);return[ee,Bi(["at",["id"],["literal",U]],ee,Pd)]}}function T(P){let D=Pd.length+1;return Array.from(Array(D).keys()).map(I=>Math.round(P/(D-1)*I))}function C(P){v=P,t(2,v)}function L(){_=this.checked,t(1,_)}return r.$$.update=()=>{r.$$.dirty&4&&t(3,n=v==null?null:v.id),r.$$.dirty&9&&t(6,i=n!=null?m.features[n]:null),r.$$.dirty&10&&t(5,[o,u]=S(n,_),o,(t(4,u),t(3,n),t(1,_),t(2,v)))},[m,_,v,n,u,o,i,a,C,L]}class NL extends kt{constructor(e){super(),St(this,e,OL,FL,gt,{})}}function $L(r){let e,t,n,i,o,u,a,d,m,_,v=Mr(r[4].mode)+"",S,T;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),_=q("li"),S=Te(v),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(C,L){W(C,e,L),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),z(n,_),z(_,S),T=!0},p(C,L){(!T||L&16)&&v!==(v=Mr(C[4].mode)+"")&&yt(S,v)},i(C){T||(N(o.$$.fragment,C),N(d.$$.fragment,C),T=!0)},o(C){G(o.$$.fragment,C),G(d.$$.fragment,C),T=!1},d(C){C&&H(e),he(o),he(d)}}}function Ob(r){let e,t,n,i,o,u,a;function d(_){r[7](_)}let m={list:r[1].features};return r[2]!==void 0&&(m.idx=r[2]),n=new op({props:m}),wn.push(()=>On(n,"idx",d)),{c(){e=q("button"),e.textContent="Pick another intersection",t=ae(),pe(n.$$.fragment),ce(e,"class","secondary")},m(_,v){W(_,e,v),W(_,t,v),de(n,_,v),o=!0,u||(a=_t(e,"click",r[6]),u=!0)},p(_,v){const S={};v&2&&(S.list=_[1].features),!i&&v&4&&(i=!0,S.idx=_[2],Nn(()=>i=!1)),n.$set(S)},i(_){o||(N(n.$$.fragment,_),o=!0)},o(_){G(n.$$.fragment,_),o=!1},d(_){_&&(H(e),H(t)),he(n,_),u=!1,a()}}}function Nb(r){let e,t;return{c(){e=q("a"),t=Te("Open OSM"),ce(e,"href",r[0]),ce(e,"target","_blank")},m(n,i){W(n,e,i),z(e,t)},p(n,i){i&1&&ce(e,"href",n[0])},d(n){n&&H(e)}}}function jL(r){let e,t,n,i,o,u,a;t=new Is({props:{mode:{mode:"pick-neighbourhood"}}});let d=r[1].features.length>0&&Ob(r),m=r[0]&&Nb(r);return{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("p"),i.textContent="Purple intersections have some kind of turn restriction.",o=ae(),d&&d.c(),u=ae(),m&&m.c(),ce(e,"slot","sidebar")},m(_,v){W(_,e,v),de(t,e,null),z(e,n),z(e,i),z(e,o),d&&d.m(e,null),z(e,u),m&&m.m(e,null),a=!0},p(_,v){_[1].features.length>0?d?(d.p(_,v),v&2&&N(d,1)):(d=Ob(_),d.c(),N(d,1),d.m(e,u)):d&&(Zt(),G(d,1,1,()=>{d=null}),Ht()),_[0]?m?m.p(_,v):(m=Nb(_),m.c(),m.m(e,null)):m&&(m.d(1),m=null)},i(_){a||(N(t.$$.fragment,_),N(d),a=!0)},o(_){G(t.$$.fragment,_),G(d),a=!1},d(_){_&&H(e),he(t),d&&d.d(),m&&m.d()}}}function UL(r){let e,t;const n=[sn("debug-intersections"),{paint:{"circle-radius":15,"circle-color":["case",["get","has_turn_restrictions"],"purple","black"]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Ml({props:i}),e.$on("click",r[5]),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function VL(r){let e,t,n,i;const o=[sn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let m=0;m<o.length;m+=1)u=wt(u,o[m]);e=new gr({props:u});const a=[sn("debug-movements-fill"),{filter:["==",["id"],r[2]]},{paint:{"fill-color":"cyan"}}];let d={};for(let m=0;m<a.length;m+=1)d=wt(d,a[m]);return n=new Zi({props:d}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),i=!0},p(m,_){const v={};e.$set(v);const S=_&4?Tn(a,[a[0],{filter:["==",["id"],m[2]]},a[2]]):{};n.$set(S)},i(m){i||(N(e.$$.fragment,m),N(n.$$.fragment,m),i=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),i=!1},d(m){m&&H(t),he(e,m),he(n,m)}}}function qL(r){let e,t,n,i,o;return t=new yr({props:{data:cr(r[3]).getAllIntersections(),generateId:!0,$$slots:{default:[UL]},$$scope:{ctx:r}}}),i=new yr({props:{data:r[1],generateId:!0,$$slots:{default:[VL]},$$scope:{ctx:r}}}),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),pe(i.$$.fragment),ce(e,"slot","map")},m(u,a){W(u,e,a),de(t,e,null),z(e,n),de(i,e,null),o=!0},p(u,a){const d={};a&8&&(d.data=cr(u[3]).getAllIntersections()),a&256&&(d.$$scope={dirty:a,ctx:u}),t.$set(d);const m={};a&2&&(m.data=u[1]),a&260&&(m.$$scope={dirty:a,ctx:u}),i.$set(m)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),G(i.$$.fragment,u),o=!1},d(u){u&&H(e),he(t),he(i)}}}function GL(r){let e,t;return e=new po({props:{$$slots:{map:[qL],sidebar:[jL],top:[$L]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&287&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function ZL(r,e,t){let n,i;rt(r,Cr,v=>t(3,n=v)),rt(r,or,v=>t(4,i=v));let o=null,u=ii(),a=0;function d(v){t(0,o=v.detail.features[0].properties.osm),t(1,u=n.getMovements(v.detail.features[0].id)),t(2,a=0)}const m=()=>t(1,u=ii());function _(v){a=v,t(2,a)}return[o,u,a,n,i,d,m,_]}class HL extends kt{constructor(e){super(),St(this,e,ZL,GL,gt,{})}}function WL(r){let e,t,n,i;const o=[sn(r[1]+"cells"),{filter:["==",["get","kind"],"cell"]},{layout:{visibility:!r[0]||r[2]=="cells"?"none":"visible"}},{paint:{"fill-color":Bd(),"fill-opacity":.5,"fill-outline-color":"hsla(0, 0%, 0%, 0.3)"}}];let u={};for(let m=0;m<o.length;m+=1)u=wt(u,o[m]);e=new Zi({props:u});const a=[sn(r[1]+"border-entries"),{filter:["==",["get","kind"],"border_entry"]},{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":xd(1),"icon-offset":$b(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:r[0]&&r[3]?"visible":"none"}},{paint:{"icon-color":Bd(),"icon-halo-color":"black","icon-opacity":jb(),"icon-halo-width":xd(1.5),"icon-halo-blur":0}},{minzoom:13},{interactive:!1}];let d={};for(let m=0;m<a.length;m+=1)d=wt(d,a[m]);return n=new Nu({props:d}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),i=!0},p(m,[_]){const v=_&7?Tn(o,[_&2&&Tr(sn(m[1]+"cells")),o[1],_&5&&{layout:{visibility:!m[0]||m[2]=="cells"?"none":"visible"}},o[3]]):{};e.$set(v);const S=_&11?Tn(a,[_&2&&Tr(sn(m[1]+"border-entries")),a[1],_&9&&{layout:{"icon-image":"border_entry_arrow","icon-rotate":["get","bearing_upon_entry"],"icon-allow-overlap":!0,"icon-size":xd(1),"icon-offset":$b(1),"symbol-sort-key":["get","bearing_upon_entry"],visibility:m[0]&&m[3]?"visible":"none"}},_&0&&{paint:{"icon-color":Bd(),"icon-halo-color":"black","icon-opacity":jb(),"icon-halo-width":xd(1.5),"icon-halo-blur":0}},a[4],a[5]]):{};n.$set(S)},i(m){i||(N(e.$$.fragment,m),N(n.$$.fragment,m),i=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),i=!1},d(m){m&&H(t),he(e,m),he(n,m)}}}function xd(r){return["interpolate",["linear"],["zoom"],14,.08*r,22,.7*r]}function $b(r){return[0,-50*r]}function jb(){return["interpolate",["linear"],["zoom"],14,1,22,.7]}function XL(r,e,t){let n,i;rt(r,Zd,a=>t(2,n=a)),rt(r,rg,a=>t(3,i=a));let{show:o=!0}=e,{prefix:u=""}=e;return r.$$set=a=>{"show"in a&&t(0,o=a.show),"prefix"in a&&t(1,u=a.prefix)},[o,u,n,i]}class ah extends kt{constructor(e){super(),St(this,e,XL,WL,gt,{show:0,prefix:1})}}function JL(r){let e,t;const n=[sn("neighbourhood-boundary"),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Zi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}class lp extends kt{constructor(e){super(),St(this,e,null,JL,gt,{})}}const KL=r=>({}),Ub=r=>({}),YL=r=>({}),Vb=r=>({});function qb(r){let e;const t=r[9]["line-popup"],n=_n(t,r,r[12],Vb);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&4096)&&yn(n,t,i,i[12],e?vn(t,i[12],o,YL):bn(i[12]),Vb)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function QL(r){let e,t,n=r[0]&&qb(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=qb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function Gb(r){let e;const t=r[9]["line-popup"],n=_n(t,r,r[12],Ub);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&4096)&&yn(n,t,i,i[12],e?vn(t,i[12],o,KL):bn(i[12]),Ub)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function e8(r){let e,t,n=r[0]&&Gb(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Gb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function t8(r){let e,t,n,i,o,u,a,d;const m=[sn(r[3]+"interior-roads-outlines"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[8](r[4],r[6].maxShortcuts,1),"line-color":"black"}},{layout:{visibility:r[2]?"visible":"none"}},{minzoom:13}];let _={};for(let D=0;D<m.length;D+=1)_=wt(_,m[D]);e=new gr({props:_});const v=[sn(r[3]+"interior-roads"),{filter:["==",["get","kind"],"interior_road"]},{paint:{"line-width":r[8](r[4],r[6].maxShortcuts,0),"line-color":r[7](r[5],r[6].maxShortcuts),"line-opacity":nr(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"],visibility:r[2]?"visible":"none"}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let S={$$slots:{default:[QL]},$$scope:{ctx:r}};for(let D=0;D<v.length;D+=1)S=wt(S,v[D]);n=new gr({props:S}),n.$on("click",r[10]);const T=[sn(r[3]+"main-roads-outlines"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[8](r[4],r[6].maxShortcuts,6),"line-color":"black"}},{layout:{visibility:r[2]?"visible":"none"}},{minzoom:13}];let C={};for(let D=0;D<T.length;D+=1)C=wt(C,T[D]);o=new gr({props:C});const L=[sn(r[3]+"main-roads"),{filter:["==",["get","kind"],"main_road"]},{paint:{"line-width":r[8](r[4],r[6].maxShortcuts,4),"line-color":nr("gray",co.mapFeature.hover.backgroundColor),"line-opacity":nr(1,.5)}},{layout:{"line-sort-key":["get","shortcuts"],visibility:r[2]?"visible":"none"}},{minzoom:13},{manageHoverState:r[0]},{hoverCursor:r[0]?"pointer":void 0}];let P={$$slots:{default:[e8]},$$scope:{ctx:r}};for(let D=0;D<L.length;D+=1)P=wt(P,L[D]);return a=new gr({props:P}),a.$on("click",r[11]),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment)},m(D,I){de(e,D,I),W(D,t,I),de(n,D,I),W(D,i,I),de(o,D,I),W(D,u,I),de(a,D,I),d=!0},p(D,[I]){const U=I&348?Tn(m,[I&8&&Tr(sn(D[3]+"interior-roads-outlines")),m[1],I&336&&{paint:{"line-width":D[8](D[4],D[6].maxShortcuts,1),"line-color":"black"}},I&4&&{layout:{visibility:D[2]?"visible":"none"}},m[4]]):{};e.$set(U);const O=I&509?Tn(v,[I&8&&Tr(sn(D[3]+"interior-roads")),v[1],I&496&&{paint:{"line-width":D[8](D[4],D[6].maxShortcuts,0),"line-color":D[7](D[5],D[6].maxShortcuts),"line-opacity":nr(1,.5)}},I&4&&{layout:{"line-sort-key":["get","shortcuts"],visibility:D[2]?"visible":"none"}},v[4],I&1&&{manageHoverState:D[0]},I&1&&{hoverCursor:D[0]?"pointer":void 0}]):{};I&4097&&(O.$$scope={dirty:I,ctx:D}),n.$set(O);const ee=I&348?Tn(T,[I&8&&Tr(sn(D[3]+"main-roads-outlines")),T[1],I&336&&{paint:{"line-width":D[8](D[4],D[6].maxShortcuts,6),"line-color":"black"}},I&4&&{layout:{visibility:D[2]?"visible":"none"}},T[4]]):{};o.$set(ee);const X=I&349?Tn(L,[I&8&&Tr(sn(D[3]+"main-roads")),L[1],I&336&&{paint:{"line-width":D[8](D[4],D[6].maxShortcuts,4),"line-color":nr("gray",co.mapFeature.hover.backgroundColor),"line-opacity":nr(1,.5)}},I&4&&{layout:{"line-sort-key":["get","shortcuts"],visibility:D[2]?"visible":"none"}},L[4],I&1&&{manageHoverState:D[0]},I&1&&{hoverCursor:D[0]?"pointer":void 0}]):{};I&4097&&(X.$$scope={dirty:I,ctx:D}),a.$set(X)},i(D){d||(N(e.$$.fragment,D),N(n.$$.fragment,D),N(o.$$.fragment,D),N(a.$$.fragment,D),d=!0)},o(D){G(e.$$.fragment,D),G(n.$$.fragment,D),G(o.$$.fragment,D),G(a.$$.fragment,D),d=!1},d(D){D&&(H(t),H(i),H(u)),he(e,D),he(n,D),he(o,D),he(a,D)}}}function n8(r,e,t){let n,i;rt(r,ig,P=>t(4,n=P)),rt(r,Zd,P=>t(5,i=P));let{$$slots:o={},$$scope:u}=e,a=Wf("neighbourhoodGj"),{interactive:d=!0}=e,{onClickLine:m=(P,D)=>{}}=e,{show:_=!0}=e,{prefix:v=""}=e;function S(P,D){return P=="cells"?Bd():P=="edits"?nr(["case",["get","edited"],zC,"white"],co.mapFeature.hover.backgroundColor):P=="speeds"?Bi(["get","speed_mph"],w2,v2):D<=2?nr("white","blue"):(console.assert(P=="shortcuts"),nr(["interpolate-hcl",["linear"],["get","shortcuts"],0,"white",1,"#F19A93",D,"#A32015"],co.mapFeature.hover.backgroundColor))}function T(P,D,I){return!P||D<=2?Xs(I):["interpolate",["linear"],["get","shortcuts"],0,5+I,D,25+I]}const C=P=>d&&m(P.detail.features[0],P.detail.event.lngLat),L=P=>d&&m(P.detail.features[0],P.detail.event.lngLat);return r.$$set=P=>{"interactive"in P&&t(0,d=P.interactive),"onClickLine"in P&&t(1,m=P.onClickLine),"show"in P&&t(2,_=P.show),"prefix"in P&&t(3,v=P.prefix),"$$scope"in P&&t(12,u=P.$$scope)},[d,m,_,v,n,i,a,S,T,o,C,L,u]}class tc extends kt{constructor(e){super(),St(this,e,n8,t8,gt,{interactive:0,onClickLine:1,show:2,prefix:3})}}function r8(r){let e;const t=r[10].default,n=_n(t,r,r[12],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&4096)&&yn(n,t,i,i[12],e?vn(t,i[12],o,null):bn(i[12]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function i8(r){let e,t,n;const i=[sn(r[2]+"turn-restrictions"),{minzoom:13},{filter:r[7]?void 0:["get","edited"]},{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05,visibility:r[1]?"visible":"none"}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];function o(a){r[11](a)}let u={$$slots:{default:[r8]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)u=wt(u,i[a]);return r[4]!==void 0&&(u.hovered=r[4]),e=new Nu({props:u}),wn.push(()=>On(e,"hovered",o)),e.$on("click",function(){Xu(r[3])&&r[3].apply(this,arguments)}),{c(){pe(e.$$.fragment)},m(a,d){de(e,a,d),n=!0},p(a,d){r=a;const m=d&134?Tn(i,[d&4&&Tr(sn(r[2]+"turn-restrictions")),i[1],d&128&&{filter:r[7]?void 0:["get","edited"]},d&2&&{layout:{"icon-image":["concat","no_",["get","kind"],"_turn"],"icon-rotate":["get","icon_angle"],"icon-allow-overlap":!0,"icon-size":.05,visibility:r[1]?"visible":"none"}},i[4]]):{};d&4096&&(m.$$scope={dirty:d,ctx:r}),!t&&d&16&&(t=!0,m.hovered=r[4],Nn(()=>t=!1)),e.$set(m)},i(a){n||(N(e.$$.fragment,a),n=!0)},o(a){G(e.$$.fragment,a),n=!1},d(a){he(e,a)}}}function o8(r){let e,t;const n=[sn(r[2]+"turn-restrictions-debug-arrows"),{interactive:!1},{paint:{"line-width":4,"line-color":"red"}},{layout:{visibility:r[1]?"visible":"none"}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a=u&6?Tn(n,[u&4&&Tr(sn(o[2]+"turn-restrictions-debug-arrows")),n[1],n[2],u&2&&{layout:{visibility:o[1]?"visible":"none"}}]):{};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function s8(r){let e,t,n,i;return e=new yr({props:{data:r[0]||r[5],generateId:!0,$$slots:{default:[i8]},$$scope:{ctx:r}}}),n=new yr({props:{data:r[6],$$slots:{default:[o8]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(o,u){de(e,o,u),W(o,t,u),de(n,o,u),i=!0},p(o,[u]){const a={};u&33&&(a.data=o[0]||o[5]),u&4254&&(a.$$scope={dirty:u,ctx:o}),e.$set(a);const d={};u&64&&(d.data=o[6]),u&4102&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&H(t),he(e,o),he(n,o)}}}function a8(r,e,t){let n,i,o,u,a;rt(r,Cr,P=>t(8,o=P)),rt(r,ri,P=>t(9,u=P)),rt(r,Gd,P=>t(7,a=P));let{$$slots:d={},$$scope:m}=e,{turnRestrictionGj:_=null}=e,{show:v=!0}=e,{prefix:S=""}=e,{onClickTurnRestriction:T=()=>{}}=e,C=null;function L(P){C=P,t(4,C)}return r.$$set=P=>{"turnRestrictionGj"in P&&t(0,_=P.turnRestrictionGj),"show"in P&&t(1,v=P.show),"prefix"in P&&t(2,S=P.prefix),"onClickTurnRestriction"in P&&t(3,T=P.onClickTurnRestriction),"$$scope"in P&&t(12,m=P.$$scope)},r.$$.update=()=>{r.$$.dirty&16&&t(6,n=C==null?ii():{type:"FeatureCollection",features:[{type:"Feature",geometry:JSON.parse(C.properties.from_geometry),properties:{}},{type:"Feature",geometry:JSON.parse(C.properties.to_geometry),properties:{}}]}),r.$$.dirty&769&&t(5,i=u>0&&_==null?o.renderTurnRestrictions():ii())},[_,v,S,T,C,i,n,a,o,u,d,L,m]}class l8 extends kt{constructor(e){super(),St(this,e,a8,s8,gt,{turnRestrictionGj:0,show:1,prefix:2,onClickTurnRestriction:3})}}const u8=r=>({}),Zb=r=>({}),c8=r=>({}),Hb=r=>({});function f8(r){let e;const t=r[11]["modal-filter"],n=_n(t,r,r[12],Hb);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&4096)&&yn(n,t,i,i[12],e?vn(t,i[12],o,c8):bn(i[12]),Hb)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function h8(r){let e,t,n,i;const o=[sn(r[6]+"modal-filters"),{interactive:r[4]},{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[8]?["literal",!0]:["get","edited"]]},{minzoom:Ad},{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1,visibility:r[5]?"visible":"none"}},{paint:{"icon-opacity":["case",["get","edited"],1,.5]}}];let u={$$slots:{default:[f8]},$$scope:{ctx:r}};for(let m=0;m<o.length;m+=1)u=wt(u,o[m]);e=new Nu({props:u}),e.$on("click",function(){Xu(r[2])&&r[2].apply(this,arguments)});const a=[sn(r[6]+"intersection-filters"),{filter:["==",["get","filter_kind"],"diagonal_filter"]},{minzoom:Ad},{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07,visibility:r[5]?"visible":"none"}},{interactive:!1}];let d={};for(let m=0;m<a.length;m+=1)d=wt(d,a[m]);return n=new Nu({props:d}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),i=!0},p(m,_){r=m;const v=_&368?Tn(o,[_&64&&Tr(sn(r[6]+"modal-filters")),_&16&&{interactive:r[4]},_&256&&{filter:["all",["!=",["get","filter_kind"],"diagonal_filter"],r[8]?["literal",!0]:["get","edited"]]},_&0&&{minzoom:Ad},_&32&&{layout:{"icon-image":["get","filter_kind"],"icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-size":.1,visibility:r[5]?"visible":"none"}},o[5]]):{};_&4096&&(v.$$scope={dirty:_,ctx:r}),e.$set(v);const S=_&96?Tn(a,[_&64&&Tr(sn(r[6]+"intersection-filters")),a[1],_&0&&{minzoom:Ad},_&32&&{layout:{"icon-image":"diagonal_filter","icon-rotate":["get","angle",["get","filter"]],"icon-allow-overlap":!0,"icon-size":.07,visibility:r[5]?"visible":"none"}},a[4]]):{};n.$set(S)},i(m){i||(N(e.$$.fragment,m),N(n.$$.fragment,m),i=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),i=!1},d(m){m&&H(t),he(e,m),he(n,m)}}}function d8(r){let e;const t=r[11]["turn-restriction"],n=_n(t,r,r[12],Zb);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&4096)&&yn(n,t,i,i[12],e?vn(t,i[12],o,u8):bn(i[12]),Zb)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function p8(r){let e,t,n,i;return e=new yr({props:{data:r[0]||r[7],generateId:!0,$$slots:{default:[h8]},$$scope:{ctx:r}}}),n=new l8({props:{show:r[5],prefix:r[6],turnRestrictionGj:r[1],onClickTurnRestriction:r[3],$$slots:{default:[d8]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(o,u){de(e,o,u),W(o,t,u),de(n,o,u),i=!0},p(o,[u]){const a={};u&129&&(a.data=o[0]||o[7]),u&4468&&(a.$$scope={dirty:u,ctx:o}),e.$set(a);const d={};u&32&&(d.show=o[5]),u&64&&(d.prefix=o[6]),u&2&&(d.turnRestrictionGj=o[1]),u&8&&(d.onClickTurnRestriction=o[3]),u&4096&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&H(t),he(e,o),he(n,o)}}}let Ad=13;function m8(r,e,t){let n,i,o,u;rt(r,Cr,P=>t(9,i=P)),rt(r,ri,P=>t(10,o=P)),rt(r,Gd,P=>t(8,u=P));let{$$slots:a={},$$scope:d}=e,{modalFilterGj:m=null}=e,{turnRestrictionGj:_=null}=e,{onClickModalFilter:v=()=>{}}=e,{onClickTurnRestriction:S=()=>{}}=e,{interactive:T}=e,{show:C=!0}=e,{prefix:L=""}=e;return r.$$set=P=>{"modalFilterGj"in P&&t(0,m=P.modalFilterGj),"turnRestrictionGj"in P&&t(1,_=P.turnRestrictionGj),"onClickModalFilter"in P&&t(2,v=P.onClickModalFilter),"onClickTurnRestriction"in P&&t(3,S=P.onClickTurnRestriction),"interactive"in P&&t(4,T=P.interactive),"show"in P&&t(5,C=P.show),"prefix"in P&&t(6,L=P.prefix),"$$scope"in P&&t(12,d=P.$$scope)},r.$$.update=()=>{r.$$.dirty&1537&&t(7,n=o>0&&m==null?i.renderModalFilters():ii())},[m,_,v,S,T,C,L,n,u,i,o,a,d]}class na extends kt{constructor(e){super(),St(this,e,m8,p8,gt,{modalFilterGj:0,turnRestrictionGj:1,onClickModalFilter:2,onClickTurnRestriction:3,interactive:4,show:5,prefix:6})}}function g8(r){let e,t;const n=[sn(r[1]+"one-ways"),{filter:["all",["in",["get","kind"],["literal",["interior_road","main_road"]]],["!=",["get","travel_flow"],"both"]]},{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180],visibility:r[0]?"visible":"none"}},{paint:{"icon-opacity":["case",["get","travel_flow_edited"],1,.5]}},{minzoom:13},{interactive:!1}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Nu({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&3?Tn(n,[u&2&&Tr(sn(o[1]+"one-ways")),n[1],u&1&&{layout:{"icon-image":"oneway_arrow","icon-size":1,"symbol-placement":"line","symbol-spacing":50,"icon-allow-overlap":!0,"icon-rotate":["case",["==",["get","travel_flow"],"forwards"],0,180],visibility:o[0]?"visible":"none"}},n[3],n[4],n[5]]):{};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function _8(r,e,t){let{show:n=!0}=e,{prefix:i=""}=e;return r.$$set=o=>{"show"in o&&t(0,n=o.show),"prefix"in o&&t(1,i=o.prefix)},[n,i]}class lh extends kt{constructor(e){super(),St(this,e,_8,g8,gt,{show:0,prefix:1})}}function y8(r){let e;const t=r[3].default,n=_n(t,r,r[4],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16)&&yn(n,t,i,i[4],e?vn(t,i[4],o,null):bn(i[4]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function b8(r){let e,t;return e=new yr({props:{data:r[0],generateId:!0,$$slots:{default:[y8]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&16&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function v8(r,e,t){let n,i;rt(r,Cr,d=>t(2,i=d));let{$$slots:o={},$$scope:u}=e,{input:a=null}=e;return r.$$set=d=>{"input"in d&&t(1,a=d.input),"$$scope"in d&&t(4,u=d.$$scope)},r.$$.update=()=>{r.$$.dirty&6&&t(0,n=a||i.renderNeighbourhood()),r.$$.dirty&1&&Qd("neighbourhoodGj",n)},[n,a,i,o,u]}class nc extends kt{constructor(e){super(),St(this,e,v8,b8,gt,{input:1})}}function Bd(){return["match",["get","cell_color"],"disconnected","red","pedestrianized","#dddde8",["let","index",["%",["to-number",["get","cell_color"]],10],["match",["var","index"],0,"#8dd3c7",1,"#ffffb3",2,"#bebada",3,"#80b1d3",4,"#fdb462",5,"#b3de69",6,"#fccde5",7,"#bc80bd",8,"#ccebc5",9,"#ffed6f","blue"]]]}function w8(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C=Mr(r[2].mode)+"",L,P;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),v=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),_=q("li"),pe(v.$$.fragment),S=ae(),T=q("li"),L=Te(C),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(D,I){W(D,e,I),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),z(n,_),de(v,_,null),z(n,S),z(n,T),z(T,L),P=!0},p(D,I){(!P||I&4)&&C!==(C=Mr(D[2].mode)+"")&&yt(L,C)},i(D){P||(N(o.$$.fragment,D),N(d.$$.fragment,D),N(v.$$.fragment,D),P=!0)},o(D){G(o.$$.fragment,D),G(d.$$.fragment,D),G(v.$$.fragment,D),P=!1},d(D){D&&H(e),he(o),he(d),he(v)}}}function Wb(r){let e,t,n;return{c(){e=q("button"),e.textContent="",ce(e,"class","close-btn svelte-khnvno")},m(i,o){W(i,e,o),t||(n=_t(e,"click",r[5]),t=!0)},p:ht,d(i){i&&H(e),t=!1,n()}}}function x8(r){let e;return{c(){e=q("p"),e.textContent="Click an intersection to inspect its movements."},m(t,n){W(t,e,n)},p:ht,i:ht,o:ht,d(t){t&&H(e)}}}function A8(r){let e,t,n,i,o,u,a;e=new Yf({props:{properties:r[0].feature.properties}});function d(_){r[6](_)}let m={list:r[0].movements.features};return r[0].movementIdx!==void 0&&(m.idx=r[0].movementIdx),o=new op({props:m}),wn.push(()=>On(o,"idx",d)),{c(){pe(e.$$.fragment),t=ae(),n=q("h5"),n.textContent="Turn restrictions:",i=ae(),pe(o.$$.fragment)},m(_,v){de(e,_,v),W(_,t,v),W(_,n,v),W(_,i,v),de(o,_,v),a=!0},p(_,v){const S={};v&1&&(S.properties=_[0].feature.properties),e.$set(S);const T={};v&1&&(T.list=_[0].movements.features),!u&&v&1&&(u=!0,T.idx=_[0].movementIdx,Nn(()=>u=!1)),o.$set(T)},i(_){a||(N(e.$$.fragment,_),N(o.$$.fragment,_),a=!0)},o(_){G(e.$$.fragment,_),G(o.$$.fragment,_),a=!1},d(_){_&&(H(t),H(n),H(i)),he(e,_),he(o,_)}}}function k8(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C;t=new Is({props:{mode:{mode:"neighbourhood"}}});let L=r[0]&&Wb(r);const P=[A8,x8],D=[];function I(U,O){return U[0]?0:1}return S=I(r),T=D[S]=P[S](r),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("h4"),i.textContent="Roads",o=ae(),u=q("p"),u.textContent="Click a road to visit its OSM object.",a=ae(),d=q("div"),m=q("h4"),m.textContent="Intersections",_=ae(),L&&L.c(),v=ae(),T.c(),Ze(d,"display","flex"),Ze(d,"align-items","start"),Ze(d,"justify-content","space-between"),ce(e,"slot","sidebar")},m(U,O){W(U,e,O),de(t,e,null),z(e,n),z(e,i),z(e,o),z(e,u),z(e,a),z(e,d),z(d,m),z(d,_),L&&L.m(d,null),z(e,v),D[S].m(e,null),C=!0},p(U,O){U[0]?L?L.p(U,O):(L=Wb(U),L.c(),L.m(d,null)):L&&(L.d(1),L=null);let ee=S;S=I(U),S===ee?D[S].p(U,O):(Zt(),G(D[ee],1,1,()=>{D[ee]=null}),Ht(),T=D[S],T?T.p(U,O):(T=D[S]=P[S](U),T.c()),N(T,1),T.m(e,null))},i(U){C||(N(t.$$.fragment,U),N(T),C=!0)},o(U){G(t.$$.fragment,U),G(T),C=!1},d(U){U&&H(e),he(t),L&&L.d(),D[S].d()}}}function S8(r){let e,t;return e=new Yf({props:{properties:r[7]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function T8(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[S8,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function C8(r){let e,t;return e=new Yf({props:{properties:r[7]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function M8(r){let e,t,n;return t=new oi({props:{openOn:"hover",$$slots:{default:[C8,({props:i})=>({7:i}),({props:i})=>i?128:0]},$$scope:{ctx:r}}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","line-popup")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p(i,o){const u={};o&384&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function E8(r){let e,t,n,i,o,u,a,d,m,_;e=new lp({}),n=new ah({}),o=new lh({});const v=[sn("debug-borders"),{filter:["==",["get","kind"],"border_intersection"]},{paint:{"circle-radius":15,"circle-color":"green"}}];let S={$$slots:{default:[T8]},$$scope:{ctx:r}};for(let T=0;T<v.length;T+=1)S=wt(S,v[T]);return a=new Ml({props:S}),m=new tc({props:{interactive:!0,onClickLine:r[4],$$slots:{"line-popup":[M8]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment),d=ae(),pe(m.$$.fragment)},m(T,C){de(e,T,C),W(T,t,C),de(n,T,C),W(T,i,C),de(o,T,C),W(T,u,C),de(a,T,C),W(T,d,C),de(m,T,C),_=!0},p(T,C){const L={};C&256&&(L.$$scope={dirty:C,ctx:T}),a.$set(L);const P={};C&256&&(P.$$scope={dirty:C,ctx:T}),m.$set(P)},i(T){_||(N(e.$$.fragment,T),N(n.$$.fragment,T),N(o.$$.fragment,T),N(a.$$.fragment,T),N(m.$$.fragment,T),_=!0)},o(T){G(e.$$.fragment,T),G(n.$$.fragment,T),G(o.$$.fragment,T),G(a.$$.fragment,T),G(m.$$.fragment,T),_=!1},d(T){T&&(H(t),H(i),H(u),H(d)),he(e,T),he(n,T),he(o,T),he(a,T),he(m,T)}}}function I8(r){let e,t;return e=new Yf({props:{properties:r[7]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function L8(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[I8,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function P8(r){let e,t;return e=new Yf({props:{properties:r[7]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.properties=n[7]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function z8(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[P8,({props:n})=>({7:n}),({props:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function D8(r){var o,u,a;let e,t;const n=[sn("debug-intersections"),{paint:{"circle-radius":lg(30),"circle-color":co.mapFeature.hover.backgroundColor,"circle-stroke-color":co.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":nr(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((a=(u=(o=r[0])==null?void 0:o.feature)==null?void 0:u.properties)==null?void 0:a.intersection_id)??-1],.3,nr(0,.5)]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[z8]},$$scope:{ctx:r}};for(let d=0;d<n.length;d+=1)i=wt(i,n[d]);return e=new Ml({props:i}),e.$on("click",r[3]),{c(){pe(e.$$.fragment)},m(d,m){de(e,d,m),t=!0},p(d,m){var v,S,T;const _=m&1?Tn(n,[n[0],{paint:{"circle-radius":lg(30),"circle-color":co.mapFeature.hover.backgroundColor,"circle-stroke-color":co.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":nr(0,3),"circle-opacity":["case",["==",["get","intersection_id"],((T=(S=(v=d[0])==null?void 0:v.feature)==null?void 0:S.properties)==null?void 0:T.intersection_id)??-1],.3,nr(0,.5)]}},n[2],n[3]]):{};m&256&&(_.$$scope={dirty:m,ctx:d}),e.$set(_)},i(d){t||(N(e.$$.fragment,d),t=!0)},o(d){G(e.$$.fragment,d),t=!1},d(d){he(e,d)}}}function Xb(r){let e,t;return e=new yr({props:{data:r[0].movements,generateId:!0,$$slots:{default:[R8]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0].movements),i&257&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function R8(r){let e,t,n,i;const o=[sn("debug-movements-outline"),{paint:{"line-width":2,"line-color":"red"}}];let u={};for(let m=0;m<o.length;m+=1)u=wt(u,o[m]);e=new gr({props:u});const a=[sn("debug-movements-fill"),{filter:["==",["id"],r[0].movementIdx]},{paint:{"fill-color":"cyan"}}];let d={};for(let m=0;m<a.length;m+=1)d=wt(d,a[m]);return n=new Zi({props:d}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),i=!0},p(m,_){const v={};e.$set(v);const S=_&1?Tn(a,[a[0],{filter:["==",["id"],m[0].movementIdx]},a[2]]):{};n.$set(S)},i(m){i||(N(e.$$.fragment,m),N(n.$$.fragment,m),i=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),i=!1},d(m){m&&H(t),he(e,m),he(n,m)}}}function B8(r){let e,t,n,i,o,u,a,d;t=new nc({props:{$$slots:{default:[E8]},$$scope:{ctx:r}}}),i=new na({props:{interactive:!0,$$slots:{default:[L8]},$$scope:{ctx:r}}}),u=new yr({props:{data:cr(r[1]).getAllIntersections(),generateId:!0,$$slots:{default:[D8]},$$scope:{ctx:r}}});let m=r[0]&&Xb(r);return{c(){e=q("div"),pe(t.$$.fragment),n=ae(),pe(i.$$.fragment),o=ae(),pe(u.$$.fragment),a=ae(),m&&m.c(),ce(e,"slot","map")},m(_,v){W(_,e,v),de(t,e,null),z(e,n),de(i,e,null),z(e,o),de(u,e,null),z(e,a),m&&m.m(e,null),d=!0},p(_,v){const S={};v&256&&(S.$$scope={dirty:v,ctx:_}),t.$set(S);const T={};v&256&&(T.$$scope={dirty:v,ctx:_}),i.$set(T);const C={};v&2&&(C.data=cr(_[1]).getAllIntersections()),v&257&&(C.$$scope={dirty:v,ctx:_}),u.$set(C),_[0]?m?(m.p(_,v),v&1&&N(m,1)):(m=Xb(_),m.c(),N(m,1),m.m(e,null)):m&&(Zt(),G(m,1,1,()=>{m=null}),Ht())},i(_){d||(N(t.$$.fragment,_),N(i.$$.fragment,_),N(u.$$.fragment,_),N(m),d=!0)},o(_){G(t.$$.fragment,_),G(i.$$.fragment,_),G(u.$$.fragment,_),G(m),d=!1},d(_){_&&H(e),he(t),he(i),he(u),m&&m.d()}}}function F8(r){let e,t;return e=new po({props:{$$slots:{map:[B8],sidebar:[k8],top:[w8]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&263&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function O8(r,e,t){let n,i;rt(r,Cr,_=>t(1,n=_)),rt(r,or,_=>t(2,i=_));let o=null;function u(_){let v=_.detail.features[0],S=n.getMovements(v.properties.intersection_id);t(0,o={feature:v,movements:S,movementIdx:0})}const a=(_,v)=>window.open(cr(_.properties).way,"_blank"),d=()=>t(0,o=null);function m(_){r.$$.not_equal(o.movementIdx,_)&&(o.movementIdx=_,t(0,o))}return[o,n,i,u,a,d,m]}class N8 extends kt{constructor(e){super(),St(this,e,O8,F8,gt,{})}}const $8="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='lucide%20lucide-eraser-icon%20lucide-eraser'%20version='1.1'%20id='svg3'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs3'%20/%3e%3cpath%20d='m7%2021-4.3-4.3c-1-1-1-2.5%200-3.4l9.6-9.6c1-1%202.5-1%203.4%200l5.6%205.6c1%201%201%202.5%200%203.4L13%2021'%20id='path1'%20/%3e%3cpath%20d='M22%2021H7'%20id='path2'%20/%3e%3cpath%20d='m5%2011%209%209'%20id='path3'%20/%3e%3cpath%20style='fill:%23ffffff;stroke:%23ff533e;stroke-width:0.0194348;fill-opacity:1'%20d='M%2010.210757,14.752002%206.459622,11.000548%209.8160254,7.6426783%20C%2012.367029,5.0905596%2013.239386,4.2512757%2013.451467,4.1450647%20c%200.349597,-0.1750803%200.789698,-0.1876196%201.091224,-0.031091%200.115256,0.059832%201.582424,1.4856537%203.265247,3.1732297%203.019567,3.0280936%203.057066,3.0684746%203.149916,3.3920116%200.07937,0.276581%200.08343,0.372957%200.02609,0.620542%20-0.06661,0.287624%20-0.13239,0.357763%20-3.515539,3.748403%20-1.896214,1.900412%20-3.460904,3.455295%20-3.477088,3.455295%20-0.01619,0%20-1.717438,-1.688155%20-3.780562,-3.751453%20z'%20id='path4'%20/%3e%3cpath%20style='fill:%23ffffff;fill-opacity:1;stroke:%23ff533e;stroke-width:0.0194348'%20d='M%205.321794,17.868809%20C%204.1705931,16.713048%203.1848808,15.680805%203.131322,15.574936%203.077763,15.469067%203.0207033,15.236442%203.004522,15.057992%202.959692,14.563595%203.080751,14.37604%204.1030807,13.356012%20l%200.8902675,-0.888263%203.7509032,3.751221%203.7509036,3.751222%20H%209.9550205%207.4148864%20Z'%20id='path5'%20/%3e%3c/svg%3e",j8="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20stroke='currentColor'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'%20class='lucide%20lucide-paintbrush-icon%20lucide-paintbrush'%20version='1.1'%20id='svg3'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs3'%20/%3e%3cpath%20d='m14.622%2017.897-10.68-2.913'%20id='path1'%20/%3e%3cpath%20d='M18.376%202.622a1%201%200%201%201%203.002%203.002L17.36%209.643a.5.5%200%200%200%200%20.707l.944.944a2.41%202.41%200%200%201%200%203.408l-.944.944a.5.5%200%200%201-.707%200L8.354%207.348a.5.5%200%200%201%200-.707l.944-.944a2.41%202.41%200%200%201%203.408%200l.944.944a.5.5%200%200%200%20.707%200z'%20id='path2'%20/%3e%3cpath%20d='M9%208c-1.804%202.71-3.97%203.46-6.583%203.948a.507.507%200%200%200-.302.819l7.32%208.883a1%201%200%200%200%201.185.204C12.735%2020.405%2016%2016.792%2016%2015'%20id='path3'%20/%3e%3cpath%20style='fill:%23ffffff;stroke:%23ff533e;stroke-width:0.00941713'%20d='M%2013.216364,10.769138%209.4441913,6.9961356%209.8268793,6.6205315%20C%2010.053748,6.3978626%2010.26605,6.2149074%2010.348288,6.1711993%20c%200.393818,-0.2093087%200.914655,-0.2092623%201.30798,1.172e-4%200.09062,0.048241%200.356713,0.2875083%200.767422,0.6900596%200.345786,0.338918%200.691198,0.6557984%200.767583,0.7041789%200.216015,0.1368197%200.430512,0.2013581%200.722288,0.2173241%200.316089,0.017296%200.499892,-0.017578%200.768527,-0.1458202%200.194182,-0.092699%200.283143,-0.1774989%202.37486,-2.2637553%202.357603,-2.3514493%202.273297,-2.2768061%202.645598,-2.3423855%200.33614,-0.05921%200.694848,0.059949%200.950717,0.3158186%200.253238,0.2532377%200.374946,0.6150471%200.31719,0.9429318%20-0.0673,0.3820937%200.01738,0.2862242%20-2.343684,2.6533839%20-2.086365,2.0917555%20-2.171127,2.1806742%20-2.263828,2.3748599%20-0.127718,0.2675385%20-0.162966,0.4524174%20-0.14652,0.7685267%200.01524,0.292912%200.09451,0.540519%200.242982,0.758947%200.04844,0.07126%200.360914,0.406322%200.694399,0.744591%200.41818,0.424179%200.627762,0.657447%200.675382,0.751709%200.212723,0.421072%200.212671,0.891705%20-1.46e-4,1.312073%20-0.04338,0.08569%20-0.207187,0.276887%20-0.439097,0.512528%20-0.203448,0.20672%20-0.376992,0.375854%20-0.385655,0.375854%20-0.0087,0%20-1.713228,-1.697851%20-3.787922,-3.773003%20z'%20id='path4'%20/%3e%3cpath%20style='fill:%23ffffff;stroke:%23ff533e;stroke-width:0.00941713;fill-opacity:1'%20d='M%209.349188,15.407794%204.525255,14.090285%203.9850003,13.435502%203.4447455,12.780718%203.9569969,12.649282%20C%206.0202821,12.119873%207.4294884,11.334333%208.7020764,10.004212%208.8652116,9.8337017%209.0246733,9.6590433%209.0564355,9.6160824%20l%200.05775,-0.078111%202.9032955,2.9031996%202.903295,2.9032%20-0.06256,0.166083%20c%20-0.122687,0.325724%20-0.617409,1.223308%20-0.670589,1.216662%20-0.008,-9.97e-4%20-2.18528,-0.594692%20-4.8384428,-1.319322%20z'%20id='path5'%20/%3e%3cpath%20style='fill:%23000000;fill-opacity:1;stroke:%23000000;stroke-width:0.00941713;stroke-opacity:1'%20d='M%208.4622824,18.869673%20C%207.5370363,17.746854%206.7832695,16.824931%206.7872451,16.820955%20c%200.00525,-0.0052%205.8629439,1.583356%206.0455299,1.639545%200.04062,0.0125%20-1.405633,1.450684%20-1.775827,1.765924%20-0.389041,0.331289%20-0.845683,0.684738%20-0.884654,0.684738%20-0.01526,0%20-0.7847654,-0.91867%20-1.7100116,-2.041489%20z'%20id='path6'%20/%3e%3c/svg%3e",Jb="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3csvg%20width='200'%20height='200'%20viewBox='0%200%20208%20208'%20version='1.1'%20id='svg4'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:svg='http://www.w3.org/2000/svg'%3e%3cdefs%20id='defs4'%20/%3e%3cg%20id='g2'%20transform='translate(-0.5,-587.21484)'%20style='display:inline'%3e%3cpath%20fill='none'%20stroke-width='10'%20stroke-linecap='butt'%20stroke-linejoin='miter'%20stroke='%231476c6'%20stroke-opacity='1'%20stroke-miterlimit='4'%20d='m%201026.4453,2047.8516%20c%20564.1016,0%201021.4063,-457.3047%201021.4063,-1021.4063%20C%202047.8516,462.34375%201590.5469,5%201026.4453,5%20462.30469,5%205,462.34375%205,1026.4453%205,1590.5469%20462.30469,2047.8516%201026.4453,2047.8516%20Z%20m%200,0'%20transform='matrix(0.1,0,0,-0.1,0,792)'%20id='path2'%20/%3e%3c/g%3e%3cpath%20fill-rule='nonzero'%20fill='%231476c6'%20fill-opacity='1'%20d='m%20102.14453,4.207026%20c%2054.08594,0%2097.93359,43.84766%2097.93359,97.933604%200,54.08984%20-43.84765,97.9375%20-97.93359,97.9375%20-54.089842,0%20-97.937499,-43.84766%20-97.937499,-97.9375%200,-54.085944%2043.847657,-97.933604%2097.937499,-97.933604'%20id='path3'%20style='display:inline'%20/%3e%3cpath%20fill-rule='nonzero'%20fill='%23ffffff'%20fill-opacity='1'%20d='M%20185.51172,115.58985%20H%2069.265625%20l%2027.648437,27.65234%20H%2056.015625%20L%2014.816406,102.04297%2056.015625,60.843746%20H%2096.914062%20L%2069.265625,88.492186%20H%20185.51172%20v%2027.097664'%20id='path4'%20style='display:inline'%20/%3e%3c/svg%3e",U8="/ltn/assets/traffic_1-MHHbc4qO.svg";function Hf(r){if(!r)throw new Error("coord is required");if(!Array.isArray(r)){if(r.type==="Feature"&&r.geometry!==null&&r.geometry.type==="Point")return[...r.geometry.coordinates];if(r.type==="Point")return[...r.coordinates]}if(Array.isArray(r)&&r.length>=2&&!Array.isArray(r[0])&&!Array.isArray(r[1]))return[...r];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function V8(r){return r.type==="Feature"?r.geometry:r}function H2(r,e,t={}){if(t.final===!0)return q8(r,e);const n=Hf(r),i=Hf(e),o=hs(n[0]),u=hs(i[0]),a=hs(n[1]),d=hs(i[1]),m=Math.sin(u-o)*Math.cos(d),_=Math.cos(a)*Math.sin(d)-Math.sin(a)*Math.cos(d)*Math.cos(u-o);return fg(Math.atan2(m,_))}function q8(r,e){let t=H2(e,r);return t=(t+180)%360,t}function G8(r,e,t,n={}){const i=Hf(r),o=hs(i[0]),u=hs(i[1]),a=hs(t),d=jC(e,n.units),m=Math.asin(Math.sin(u)*Math.cos(d)+Math.cos(u)*Math.sin(d)*Math.cos(a)),_=o+Math.atan2(Math.sin(a)*Math.sin(d)*Math.cos(u),Math.cos(d)-Math.sin(u)*Math.sin(m)),v=fg(_),S=fg(m);return cg([v,S],n.properties)}function W2(r,e,t={}){var n=Hf(r),i=Hf(e),o=hs(i[1]-n[1]),u=hs(i[0]-n[0]),a=hs(n[1]),d=hs(i[1]),m=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(u/2),2)*Math.cos(a)*Math.cos(d);return $C(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)),t.units)}var Z8=W2;function H8(r,e,t={}){const i=V8(r).coordinates;let o=0;for(let u=0;u<i.length&&!(e>=o&&u===i.length-1);u++)if(o>=e){const a=e-o;if(a){const d=H2(i[u],i[u-1])-180;return G8(i[u],a,d,t)}else return cg(i[u])}else o+=W2(i[u],i[u+1],t);return cg(i[i.length-1])}var W8=H8;function X8(r){let e,t;const n=[sn("animate-shortcuts"),{paint:{"circle-radius":10,"circle-color":"purple","circle-stroke-color":"black","circle-stroke-width":1}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Ml({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function J8(r){let e,t;return e=new yr({props:{data:r[0],$$slots:{default:[X8]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&1024&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}let K8=50,Y8=100,Q8=.01;function eP(r,e,t){let{paths:n}=e,i=d(),o=m(),u=v(),a=setInterval(S,Y8);ei(()=>clearInterval(a));function d(){return n.features.map(T=>1/T.properties.directness).reduce((T,C)=>T+C,0)}function m(){return n.features.length==0?[]:Array.from({length:K8},_)}function _(){let T=Math.random()*i,C=0;for(let[L,P]of n.features.entries())if(C+=1/P.properties.directness,T<C)return{idx:L,distance:0};throw new Error(`didnt pick dot, totalDirectness is ${i}`)}function v(){return{type:"FeatureCollection",features:o.map(({idx:T,distance:C})=>W8(n.features[T],C,{units:"kilometers"}))}}function S(){for(let[T,C]of o.entries())C.distance+=Q8,C.distance>=n.features[C.idx].properties.length_meters/1e3&&(o[T]=_());t(0,u=v())}return r.$$set=T=>{"paths"in T&&t(1,n=T.paths)},r.$$.update=()=>{r.$$.dirty&2&&n&&(i=d(),o=m())},[u,n]}class tP extends kt{constructor(e){super(),St(this,e,eP,J8,gt,{paths:1})}}class nP{constructor(e){mr(this,"feature");this.feature=e}get intersectionId(){return this.feature.properties.intersection_id}get filter(){return this.feature.properties.filter}get filterAngle(){var e;return(e=this.feature.properties.filter)==null?void 0:e.angle}get hasRotatedFilter(){var e;return((e=this.feature.properties.filter)==null?void 0:e.is_rotated)??!1}}const l_="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAMAAADDpiTIAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAAAAlwSFlzAAAOwwAADsMBx2+oZAAAALRQTFRFR3BMemc7uV08rWA9gmc9wlw9+1M8/1c6XGw7rWA8yFs9Tm47d2g8RXA7lmM8N3I6bGo7g2Y8u108wl097lY9vV08pmE9pGE8IHY7/3YajWU8hWc811o+nmI87VU7L3M73Fo+K3Q62Fs+s189kWQ8gGc7iGU8e2g7x1pAC3k6////X6d+H4RKTJ1vjcCjEHg6F3c6HnY6+Pv6NJBbWaR5FX5C4vDoHINIQZZlfbiWmMaszuTYcGgFiwAAACl0Uk5TAMN7grBaDAXjiU7r0O+f9dvJdmUgbZSi/AKouC+zGPg3+yV8wbuzwESr5F6DAAAFwklEQVR42u3ax1rbQACF0STGvRsXMJieMqTICqS//3tlkS8LgpNgSZsZnf8R7hysgp49kyRJkiRJkqQ0mzdn141HvVhctGyTese95clkmIddZZedwXp2ZqR0u1oOLsO/y/qvFm1LJdnpqh+e0nZwjUB6tZZPO/5fBJoGS6zeIAt7NF65IUyq7jDsVza9sFoytVdHYe86PcOlcv6bbShQ341AIq0KnX8IQ78BSbTMQ8E6p9aLv+Y4FG7qWSD6rjrFzz9kKwPG3iaUaew2IPYLwHkpAGHqrXDcTcudf8gXNoz6B+CyJIAwPbZixJ2UPf9w5HVQxM37pQGEtRnjrVv+/EPHu4B4e1kBgO2hHWOt1akAQBgZMtZ6eRUAnhsy1hpVnH+YeBCMtVElAMZzS0baQRXnn+X+H1Df10AeA6LudSUAwsySkfa8GgAvLAmAABAAAkAACADFDuDL+4d9/QRAnQC8/Xj7R5/vAKgPgHePzv/29gcA9QFwf7ujTwDUBsDbXQDeAQAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAABAAAkAACAABIAAEgAAQAAJAAAgAASAABIAAEAACQAAIAAEgAASAAAAAAAAAAAAAAAAAAAAAfne/C8AXAGoD4G7H+X8OANQGQPj+6Pw/3gNQIwDh/YeHfbsLANQJwD4BAICi7HU1AGaWjLSXlZx/dmjJSDuoBEDes2SkjSoBMD61ZKR1KwHQaVsy0g63VQAYGDLWzvpVAFgbstYvAjJPgfG2rABAf27HaLsYlwdwYsZ4Oy5/Ddi6AsTcrPRzwKRlxYhrD8reAnaNGHXXuR8AdwHFO1qYMPLeDMsAuDFg9HWPSlwAruwX/0VgkxU9/2HTfAnUuil4/ufXxkuis2mx8/cEmIyAmwJXgXHDcOlcBTZ73wl2fAmYVI39Pg3YTn0Hllinm8s9/vy7PgNLr8X0ideB/trjf5pvBA5P/n8hyCcjx59u8+6ryflfHwny4WDU9OOfeO2LRXe0Xh/80Xq0bDTPzCNJkiRJkqQk+wnTOFu90krtLAAAAABJRU5ErkJggg==";function rP(r){let e,t,n,i,o;return{c(){e=q("div"),e.textContent="+",t=ae(),n=q("img"),o=Te(`
    Add diagonal filter`),Ze(e,"font-size","200%"),Ze(e,"margin-top","-12px"),ce(e,"class","icon"),Or(n.src,i=l_)||ce(n,"src",i),ce(n,"alt","Add diagonal filter"),Ze(n,"transform","rotate(135deg)"),ce(n,"class","svelte-j2s60j")},m(u,a){W(u,e,a),W(u,t,a),W(u,n,a),W(u,o,a)},p:ht,d(u){u&&(H(e),H(t),H(n),H(o))}}}function iP(r){let e;function t(o,u){return o[0].hasRotatedFilter?sP:oP}let n=t(r),i=n(r);return{c(){i.c(),e=rr()},m(o,u){i.m(o,u),W(o,e,u)},p(o,u){n!==(n=t(o))&&(i.d(1),i=n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i.d(o)}}}function oP(r){let e,t,n,i,o;return{c(){e=q("div"),e.textContent="",t=ae(),n=q("img"),o=Te(`
      Rotate diagonal filter`),Ze(e,"font-size","200%"),Ze(e,"padding-bottom","4px"),ce(e,"class","icon"),Or(n.src,i=l_)||ce(n,"src",i),ce(n,"alt","Rotate diagonal filter"),Ze(n,"transform","rotate(45deg)"),ce(n,"class","svelte-j2s60j")},m(u,a){W(u,e,a),W(u,t,a),W(u,n,a),W(u,o,a)},d(u){u&&(H(e),H(t),H(n),H(o))}}}function sP(r){let e,t,n,i,o;return{c(){e=q("div"),e.textContent="",t=ae(),n=q("img"),o=Te(`
      Delete diagonal filter`),ce(e,"class","icon"),Or(n.src,i=l_)||ce(n,"src",i),ce(n,"alt","Remove diagonal filter"),Ze(n,"transform","rotate(45deg)"),ce(n,"class","svelte-j2s60j")},m(u,a){W(u,e,a),W(u,t,a),W(u,n,a),W(u,o,a)},d(u){u&&(H(e),H(t),H(n),H(o))}}}function aP(r){let e;function t(o,u){return o[0].filter?iP:rP}let n=t(r),i=n(r);return{c(){e=q("div"),i.c(),Ze(e,"display","flex"),Ze(e,"align-items","center")},m(o,u){W(o,e,u),i.m(e,null)},p(o,[u]){n===(n=t(o))&&i?i.p(o,u):(i.d(1),i=n(o),i&&(i.c(),i.m(e,null)))},i:ht,o:ht,d(o){o&&H(e),i.d()}}}function lP(r,e,t){let{intersection:n}=e;return r.$$set=i=>{"intersection"in i&&t(0,n=i.intersection)},[n]}class uP extends kt{constructor(e){super(),St(this,e,lP,aP,gt,{intersection:0})}}function cP(r){let e,t;return e=new uP({props:{intersection:r[3](r[7])}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.intersection=n[3](n[7])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function fP(r){let e,t;return e=new Fg({props:{openOn:"hover",$$slots:{default:[cP,({features:n})=>({7:n}),({features:n})=>n?128:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&384&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function hP(r){let e,t;const n=[sn("editable-intersections"),{filter:["==",["get","kind"],"editable_intersection"]},{paint:{"circle-radius":lg(30),"circle-color":co.mapFeature.hover.backgroundColor,"circle-opacity":nr(0,.5),"circle-stroke-color":co.mapFeature.hover.backgroundColor,"circle-stroke-opacity":.8,"circle-stroke-width":nr(0,3)}},{layout:{visibility:r[2]?"visible":"none"}},{minzoom:13},{interactive:r[1]},{manageHoverState:!0},{hoverCursor:"pointer"}];let i={$$slots:{default:[fP]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Ml({props:i}),e.$on("click",r[5]),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,[u]){const a=u&6?Tn(n,[n[0],n[1],n[2],u&4&&{layout:{visibility:o[2]?"visible":"none"}},n[4],u&2&&{interactive:o[1]},n[6],n[7]]):{};u&256&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function dP(r,e,t){let{neighbourhood:n=Wf("neighbourhoodGj")}=e,{onClickIntersection:i=_=>{}}=e,{interactive:o=!1}=e,{show:u=!0}=e;function a(_){let v=n.features[_];return new nP(v)}function d(_){return a(_[0].id)}const m=_=>i(d(_.detail.features));return r.$$set=_=>{"neighbourhood"in _&&t(4,n=_.neighbourhood),"onClickIntersection"in _&&t(0,i=_.onClickIntersection),"interactive"in _&&t(1,o=_.interactive),"show"in _&&t(2,u=_.show)},[i,o,u,d,n,m]}class pP extends kt{constructor(e){super(),St(this,e,dP,hP,gt,{neighbourhood:4,onClickIntersection:0,interactive:1,show:2})}}function Kb(r,e,t){const n=r.slice();return n[6]=e[t],n}function Yb(r){let e,t,n,i,o,u,a=r[6].label+"",d,m,_,v,S;function T(){return r[3](r[6])}return{c(){e=q("button"),t=q("img"),i=ae(),o=q("br"),u=ae(),d=Te(a),m=ae(),Or(t.src,n=r[6].iconURL)||ce(t,"src",n),ce(t,"width","80"),ce(t,"alt",r[6].label),ce(e,"class","outline"),Ze(e,"width","100%"),e.disabled=_=r[1]==r[6].filterType},m(C,L){W(C,e,L),z(e,t),z(e,i),z(e,o),z(e,u),z(e,d),z(e,m),v||(S=_t(e,"click",T),v=!0)},p(C,L){r=C,L&2&&_!==(_=r[1]==r[6].filterType)&&(e.disabled=_)},d(C){C&&H(e),v=!1,S()}}}function mP(r){let e,t,n,i,o,u,a,d,m,_,v,S,T=r[2].description+"",C,L,P,D,I,U,O=zn(Ri.allTypes),ee=[];for(let X=0;X<O.length;X+=1)ee[X]=Yb(Kb(r,O,X));return{c(){e=q("h3"),e.textContent="Choose a modal filter to place on streets",t=ae(),n=q("table"),i=q("tr"),o=q("td");for(let X=0;X<ee.length;X+=1)ee[X].c();u=ae(),a=q("td"),d=q("img"),v=ae(),S=q("p"),C=Te(T),L=ae(),P=q("center"),D=q("button"),D.textContent="Confirm",Or(d.src,m=r[2].largeImageURL)||ce(d,"src",m),ce(d,"height","300"),ce(d,"alt",_=r[2].label)},m(X,ue){W(X,e,ue),W(X,t,ue),W(X,n,ue),z(n,i),z(i,o);for(let $=0;$<ee.length;$+=1)ee[$]&&ee[$].m(o,null);z(i,u),z(i,a),z(a,d),z(a,v),z(a,S),z(S,C),W(X,L,ue),W(X,P,ue),z(P,D),I||(U=_t(D,"click",r[4]),I=!0)},p(X,ue){if(ue&2){O=zn(Ri.allTypes);let $;for($=0;$<O.length;$+=1){const Q=Kb(X,O,$);ee[$]?ee[$].p(Q,ue):(ee[$]=Yb(Q),ee[$].c(),ee[$].m(o,null))}for(;$<ee.length;$+=1)ee[$].d(1);ee.length=O.length}ue&4&&!Or(d.src,m=X[2].largeImageURL)&&ce(d,"src",m),ue&4&&_!==(_=X[2].label)&&ce(d,"alt",_),ue&4&&T!==(T=X[2].description+"")&&yt(C,T)},d(X){X&&(H(e),H(t),H(n),H(L),H(P)),Jr(ee,X),I=!1,U()}}}function gP(r){let e,t,n;function i(u){r[5](u)}let o={$$slots:{default:[mP]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.show=r[0]),e=new Ng({props:o}),wn.push(()=>On(e,"show",i)),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,[a]){const d={};a&519&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.show=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function _P(r,e,t){let n,i;rt(r,ng,m=>t(1,i=m));let{show:o}=e;const u=m=>on(ng,i=m.filterType,i),a=()=>t(0,o=!1);function d(m){o=m,t(0,o)}return r.$$set=m=>{"show"in m&&t(0,o=m.show)},r.$$.update=()=>{r.$$.dirty&2&&t(2,n=Ri.allTypes.find(m=>m.filterType==i))},[o,i,n,u,a,d]}class yP extends kt{constructor(e){super(),St(this,e,_P,gP,gt,{show:0})}}function Qb(r){let e,t;return e=new yr({props:{data:r[0],$$slots:{default:[bP]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.data=n[0]),i&64&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function bP(r){let e,t;const n=[sn("freehand-line"),{paint:{"line-width":5,"line-color":"red"}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function vP(r){let e,t,n=r[0]&&Qb(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Qb(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function wP(r,e,t){let{map:n}=e,i=null;const o=ps();n.on("dragstart",u),n.on("mousemove",a),n.on("mouseup",d),ei(()=>{n.dragPan.enable(),n.off("dragstart",u),n.off("mousemove",a),n.off("mouseup",d)});function u(){n.dragPan.disable(),t(0,i={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}})}function a(m){if(i){let _=m.lngLat.toArray(),v=i.geometry.coordinates.at(-1);if(v&&Z8(v,_)*1e3<.5)return;i.geometry.coordinates.push(_),t(0,i),i.geometry.coordinates.length%10==0&&o("progress",i)}}function d(){!i||i.geometry.coordinates.length==0?o("done",null):o("done",i),t(0,i=null),n.dragPan.enable()}return r.$$set=m=>{"map"in m&&t(1,n=m.map)},[i,n]}class xP extends kt{constructor(e){super(),St(this,e,wP,vP,gt,{map:1})}}function ev(r){let e,t;return e=new nc({props:{input:r[0],$$slots:{default:[CP]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.input=n[0]),i&66&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function AP(r){let e,t,n=(r[5].name??"unnamed road")+"",i,o,u=Math.round(r[5].speed_mph)+"",a,d;return{c(){e=q("p"),t=Te("Main road: "),i=Te(n),o=Te(`
              (`),a=Te(u),d=Te(" mph)")},m(m,_){W(m,e,_),z(e,t),z(e,i),z(e,o),z(e,a),z(e,d)},p(m,_){_&32&&n!==(n=(m[5].name??"unnamed road")+"")&&yt(i,n),_&32&&u!==(u=Math.round(m[5].speed_mph)+"")&&yt(a,u)},d(m){m&&H(e)}}}function kP(r){let e,t=r[5].shortcuts+"",n,i,o=(r[5].name??"unnamed road")+"",u,a,d=Math.round(r[5].speed_mph)+"",m,_;return{c(){e=q("p"),n=Te(t),i=Te(" shortcuts through "),u=Te(o),a=Te(`
              (`),m=Te(d),_=Te(" mph)")},m(v,S){W(v,e,S),z(e,n),z(e,i),z(e,u),z(e,a),z(e,m),z(e,_)},p(v,S){S&32&&t!==(t=v[5].shortcuts+"")&&yt(n,t),S&32&&o!==(o=(v[5].name??"unnamed road")+"")&&yt(u,o),S&32&&d!==(d=Math.round(v[5].speed_mph)+"")&&yt(m,d)},d(v){v&&H(e)}}}function SP(r){let e;function t(o,u){if(o[5].kind=="interior_road")return kP;if(o[5].kind=="main_road")return AP}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=rr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i&&i.d(o)}}}function TP(r){let e,t,n;return t=new oi({props:{openOn:"hover",$$slots:{default:[SP,({props:i})=>({5:i}),({props:i})=>i?32:0]},$$scope:{ctx:r}}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","line-popup")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p(i,o){const u={};o&96&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function CP(r){let e,t,n,i,o,u;return e=new ah({props:{show:r[1],prefix:Fd}}),n=new lh({props:{show:r[1],prefix:Fd}}),o=new tc({props:{show:r[1],prefix:Fd,interactive:!0,$$slots:{"line-popup":[TP]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment)},m(a,d){de(e,a,d),W(a,t,d),de(n,a,d),W(a,i,d),de(o,a,d),u=!0},p(a,d){const m={};d&2&&(m.show=a[1]),e.$set(m);const _={};d&2&&(_.show=a[1]),n.$set(_);const v={};d&2&&(v.show=a[1]),d&64&&(v.$$scope={dirty:d,ctx:a}),o.$set(v)},i(a){u||(N(e.$$.fragment,a),N(n.$$.fragment,a),N(o.$$.fragment,a),u=!0)},o(a){G(e.$$.fragment,a),G(n.$$.fragment,a),G(o.$$.fragment,a),u=!1},d(a){a&&(H(t),H(i)),he(e,a),he(n,a),he(o,a)}}}function tv(r){let e,t;return e=new na({props:{prefix:Fd,show:r[1],interactive:!1,modalFilterGj:r[2],turnRestrictionGj:r[3]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&2&&(o.show=n[1]),i&4&&(o.modalFilterGj=n[2]),i&8&&(o.turnRestrictionGj=n[3]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function MP(r){let e,t,n,i=r[0]&&ev(r),o=r[2]&&r[3]&&tv(r);return{c(){i&&i.c(),e=ae(),o&&o.c(),t=rr()},m(u,a){i&&i.m(u,a),W(u,e,a),o&&o.m(u,a),W(u,t,a),n=!0},p(u,[a]){u[0]?i?(i.p(u,a),a&1&&N(i,1)):(i=ev(u),i.c(),N(i,1),i.m(e.parentNode,e)):i&&(Zt(),G(i,1,1,()=>{i=null}),Ht()),u[2]&&u[3]?o?(o.p(u,a),a&12&&N(o,1)):(o=tv(u),o.c(),N(o,1),o.m(t.parentNode,t)):o&&(Zt(),G(o,1,1,()=>{o=null}),Ht())},i(u){n||(N(i),N(o),n=!0)},o(u){G(i),G(o),n=!1},d(u){u&&(H(e),H(t)),i&&i.d(u),o&&o.d(u)}}}let Fd="before-edits-";function EP(r,e,t){let n,i;rt(r,Cr,d=>t(4,n=d)),rt(r,eg,d=>t(1,i=d));let o=null,u=null,a=null;return r.$$.update=()=>{r.$$.dirty&19&&i&&o==null&&(t(0,o=n.renderNeighbourhoodBeforeEdits()),t(2,u=n.renderModalFiltersBeforeEdits()),t(3,a=n.renderTurnRestrictionsBeforeEdits()))},[o,i,u,a,n]}class IP extends kt{constructor(e){super(),St(this,e,EP,MP,gt,{})}}function nv(r,e,t){const n=r.slice();return n[33]=e[t],n[34]=e,n[35]=t,n}function rv(r,e,t){const n=r.slice();return n[36]=e[t],n[37]=e,n[38]=t,n}function LP(r){let e;return{c(){e=q("span"),ce(e,"class","dot svelte-1krym78"),Nt(e,"snapped-node",r[36].snapped),Nt(e,"free-node",!r[36].snapped),Nt(e,"hide",r[3])},m(t,n){W(t,e,n)},p(t,n){n[0]&32&&Nt(e,"snapped-node",t[36].snapped),n[0]&32&&Nt(e,"free-node",!t[36].snapped),n[0]&8&&Nt(e,"hide",t[3])},d(t){t&&H(e)}}}function iv(r){let e,t,n;function i(d){r[20](d,r[36])}function o(){return r[21](r[36])}function u(){return r[22](r[36])}let a={draggable:!0,zIndex:0,$$slots:{default:[LP]},$$scope:{ctx:r}};return r[36].point!==void 0&&(a.lngLat=r[36].point),e=new Ju({props:a}),wn.push(()=>On(e,"lngLat",i)),e.$on("dragstart",o),e.$on("drag",u),e.$on("dragend",r[12]),{c(){pe(e.$$.fragment)},m(d,m){de(e,d,m),n=!0},p(d,m){r=d;const _={};m[0]&40|m[1]&256&&(_.$$scope={dirty:m,ctx:r}),!t&&m[0]&32&&(t=!0,_.lngLat=r[36].point,Nn(()=>t=!1)),e.$set(_)},i(d){n||(N(e.$$.fragment,d),n=!0)},o(d){G(e.$$.fragment,d),n=!1},d(d){he(e,d)}}}function ov(r){let e;return{c(){e=q("li"),e.innerHTML="<b>Click</b> to reclassify everything highlighted"},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function PP(r){let e,t,n,i,o,u=r[0].length>1&&r[35]==r[0].length-1&&ov();return{c(){e=q("ul"),t=q("li"),t.innerHTML=`<b>Click and drag</b>
          to move`,n=ae(),i=q("li"),i.innerHTML=`<b>Right click</b>
          to delete`,o=ae(),u&&u.c(),Ze(e,"padding-right","0"),Ze(e,"padding-left","20px"),Ze(e,"margin","0")},m(a,d){W(a,e,d),z(e,t),z(e,n),z(e,i),z(e,o),u&&u.m(e,null)},p(a,d){a[0].length>1&&a[35]==a[0].length-1?u||(u=ov(),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},d(a){a&&H(e),u&&u.d()}}}function zP(r){let e,t,n,i;return n=new Fg({props:{openOn:"hover",popupClass:"waypoint-popup",$$slots:{default:[PP]},$$scope:{ctx:r}}}),{c(){e=q("span"),e.textContent=`${r[35]+1}`,t=ae(),pe(n.$$.fragment),ce(e,"class","dot svelte-1krym78"),Nt(e,"snapped",r[33].snapped)},m(o,u){W(o,e,u),W(o,t,u),de(n,o,u),i=!0},p(o,u){(!i||u[0]&1)&&Nt(e,"snapped",o[33].snapped);const a={};u[0]&1|u[1]&256&&(a.$$scope={dirty:u,ctx:o}),n.$set(a)},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){G(n.$$.fragment,o),i=!1},d(o){o&&(H(e),H(t)),he(n,o)}}}function sv(r){let e,t,n;function i(d){r[23](d,r[33])}function o(){return r[24](r[35])}function u(){return r[25](r[35])}let a={draggable:!0,zIndex:1,$$slots:{default:[zP]},$$scope:{ctx:r}};return r[33].point!==void 0&&(a.lngLat=r[33].point),e=new Ju({props:a}),wn.push(()=>On(e,"lngLat",i)),e.$on("click",o),e.$on("contextmenu",u),e.$on("mouseenter",r[26]),e.$on("mouseleave",r[27]),e.$on("dragstart",r[13]),e.$on("dragend",r[28]),{c(){pe(e.$$.fragment)},m(d,m){de(e,d,m),n=!0},p(d,m){r=d;const _={};m[0]&1|m[1]&256&&(_.$$scope={dirty:m,ctx:r}),!t&&m[0]&1&&(t=!0,_.lngLat=r[33].point,Nn(()=>t=!1)),e.$set(_)},i(d){n||(N(e.$$.fragment,d),n=!0)},o(d){G(e.$$.fragment,d),n=!1},d(d){he(e,d)}}}function DP(r){let e,t;const n=[sn("draw-route-lines"),{paint:{"line-color":"purple","line-width":10}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function RP(r){let e,t;const n=[sn("draw-route-preview"),{paint:{"line-color":"black","line-width":3}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function BP(r){let e,t,n,i,o,u,a,d,m,_;e=new tp({}),e.$on("click",r[7]),e.$on("mousemove",r[8]);let v=zn(r[5]),S=[];for(let D=0;D<v.length;D+=1)S[D]=iv(rv(r,v,D));const T=D=>G(S[D],1,1,()=>{S[D]=null});let C=zn(r[0]),L=[];for(let D=0;D<C.length;D+=1)L[D]=sv(nv(r,C,D));const P=D=>G(L[D],1,1,()=>{L[D]=null});return o=new yr({props:{data:Tg(r[4],r[0])||ii(),generateId:!0,$$slots:{default:[DP]},$$scope:{ctx:r}}}),a=new yr({props:{data:r[6],$$slots:{default:[RP]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae();for(let D=0;D<S.length;D+=1)S[D].c();n=ae();for(let D=0;D<L.length;D+=1)L[D].c();i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment)},m(D,I){de(e,D,I),W(D,t,I);for(let U=0;U<S.length;U+=1)S[U]&&S[U].m(D,I);W(D,n,I);for(let U=0;U<L.length;U+=1)L[U]&&L[U].m(D,I);W(D,i,I),de(o,D,I),W(D,u,I),de(a,D,I),d=!0,m||(_=_t(window,"keydown",r[14]),m=!0)},p(D,I){if(I[0]&7208){v=zn(D[5]);let ee;for(ee=0;ee<v.length;ee+=1){const X=rv(D,v,ee);S[ee]?(S[ee].p(X,I),N(S[ee],1)):(S[ee]=iv(X),S[ee].c(),N(S[ee],1),S[ee].m(n.parentNode,n))}for(Zt(),ee=v.length;ee<S.length;ee+=1)T(ee);Ht()}if(I[0]&41479){C=zn(D[0]);let ee;for(ee=0;ee<C.length;ee+=1){const X=nv(D,C,ee);L[ee]?(L[ee].p(X,I),N(L[ee],1)):(L[ee]=sv(X),L[ee].c(),N(L[ee],1),L[ee].m(i.parentNode,i))}for(Zt(),ee=C.length;ee<L.length;ee+=1)P(ee);Ht()}const U={};I[0]&17&&(U.data=Tg(D[4],D[0])||ii()),I[1]&256&&(U.$$scope={dirty:I,ctx:D}),o.$set(U);const O={};I[0]&64&&(O.data=D[6]),I[1]&256&&(O.$$scope={dirty:I,ctx:D}),a.$set(O)},i(D){if(!d){N(e.$$.fragment,D);for(let I=0;I<v.length;I+=1)N(S[I]);for(let I=0;I<C.length;I+=1)N(L[I]);N(o.$$.fragment,D),N(a.$$.fragment,D),d=!0}},o(D){G(e.$$.fragment,D),S=S.filter(Boolean);for(let I=0;I<S.length;I+=1)G(S[I]);L=L.filter(Boolean);for(let I=0;I<L.length;I+=1)G(L[I]);G(o.$$.fragment,D),G(a.$$.fragment,D),d=!1},d(D){D&&(H(t),H(n),H(i),H(u)),he(e,D),Jr(S,D),Jr(L,D),he(o,D),he(a,D),m=!1,_()}}}let av=!0;function Tg(r,e){try{if(r)return JSON.parse(r.inner.calculateRoute(e))}catch{}return null}function FP(r,e,t){let n,i;rt(r,Zf,Ee=>t(4,i=Ee));let{map:o}=e,{waypoints:u}=e,{finish:a}=e,{cancel:d}=e;ei(()=>{t(0,u=[]),i==null||i.stop(),o.getCanvas().style.cursor="inherit"});let m=[],_=null,v=!1,S=!1,T=!1;function C(Ee){let Fe=Ee.length==0?"crosshair":"inherit";o.getCanvas().style.cursor=Fe}function L(Ee){u.push({point:Ee.detail.lngLat.toArray(),snapped:av}),t(0,u)}function P(Ee){t(19,_={point:Ee.detail.lngLat.toArray(),snapped:av})}function D(Ee){u.splice(Ee,1),t(0,u),t(1,v=!1)}function I(Ee,Fe,ot,ct){if(ct)return ii();try{if(Ee&&Fe.length>0&&ot)return JSON.parse(Ee.inner.calculateRoute([Fe[Fe.length-1],ot]))}catch{}return ii()}function U(Ee,Fe,ot){if(ot)return;if(!Ee){t(5,m=[]);return}let ct=[],it=1;for(let at=0;at<Fe.length-1;at++){let ft=JSON.parse(Ee.inner.getExtraNodes(Fe[at],Fe[at+1]));for(let[Ct,xt,It]of ft)ct.push({point:[Ct,xt],snapped:It,insertIdx:it});it++}t(5,m=ct)}function O(Ee){u.splice(Ee.insertIdx,0,{point:Ee.point,snapped:Ee.snapped}),t(0,u),t(3,T=!0)}function ee(Ee){t(0,u[Ee.insertIdx].point=Ee.point,u),t(0,u)}function X(){t(3,T=!1)}function ue(){t(2,S=!0)}function $(Ee){Ee.key=="Escape"&&d(),Ee.key=="Enter"&&u.length>1&&ne()}function Q(Ee){u.length>1&&Ee==u.length-1&&ne()}function ne(){let Ee=Tg(i,u);Ee?(a(Ee.properties.full_path.map(Fe=>Fe.snapped)),t(0,u=[])):d()}function F(Ee,Fe){r.$$.not_equal(Fe.point,Ee)&&(Fe.point=Ee,t(5,m))}const Z=Ee=>O(Ee),J=Ee=>ee(Ee);function be(Ee,Fe){r.$$.not_equal(Fe.point,Ee)&&(Fe.point=Ee,t(0,u))}const ke=Ee=>Q(Ee),ge=Ee=>D(Ee),ve=()=>t(1,v=!0),fe=()=>t(1,v=!1),Pe=()=>t(2,S=!1);return r.$$set=Ee=>{"map"in Ee&&t(16,o=Ee.map),"waypoints"in Ee&&t(0,u=Ee.waypoints),"finish"in Ee&&t(17,a=Ee.finish),"cancel"in Ee&&t(18,d=Ee.cancel)},r.$$.update=()=>{r.$$.dirty[0]&25&&U(i,u,T),r.$$.dirty[0]&524311&&t(6,n=I(i,u,_,v||S)),r.$$.dirty[0]&1&&C(u)},[u,v,S,T,i,m,n,L,P,D,O,ee,X,ue,$,Q,o,a,d,_,F,Z,J,be,ke,ge,ve,fe,Pe]}class OP extends kt{constructor(e){super(),St(this,e,FP,BP,gt,{map:16,waypoints:0,finish:17,cancel:18},null,[-1,-1])}}function lv(r){let e,t,n;return t=new jn({props:{mode:{mode:"debug-neighbourhood"},$$slots:{default:[NP]},$$scope:{ctx:r}}}),{c(){e=q("li"),pe(t.$$.fragment)},m(i,o){W(i,e,o),de(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function NP(r){let e;return{c(){e=Te("Debug")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function $P(r){let e,t,n,i,o,u,a,d,m,_,v=Mr(r[15].mode)+"",S,T,C,L,P,D,I,U,O,ee,X,ue,$,Q,ne,F,Z,J,be,ke;o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),D=new jn({props:{mode:{mode:"view-shortcuts"}}}),O=new jn({props:{mode:{mode:"route",prevMode:"neighbourhood"}}}),ue=new jn({props:{mode:{mode:"predict-impact",prevMode:"neighbourhood"}}}),ne=new jn({props:{mode:{mode:"impact-one-destination"}}}),J=new jn({props:{mode:{mode:"set-boundary",name:cr(r[7]).properties.name,existing:cr(r[7])}}});let ge=r[16]&&lv(r);return{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),_=q("li"),S=Te(v),T=ae(),C=q("nav"),L=q("ul"),P=q("li"),pe(D.$$.fragment),I=ae(),U=q("li"),pe(O.$$.fragment),ee=ae(),X=q("li"),pe(ue.$$.fragment),$=ae(),Q=q("li"),pe(ne.$$.fragment),F=ae(),Z=q("li"),pe(J.$$.fragment),be=ae(),ge&&ge.c(),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top"),Ze(e,"display","flex"),Ze(e,"justify-content","space-between")},m(ve,fe){W(ve,e,fe),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),z(n,_),z(_,S),z(e,T),z(e,C),z(C,L),z(L,P),de(D,P,null),z(L,I),z(L,U),de(O,U,null),z(L,ee),z(L,X),de(ue,X,null),z(L,$),z(L,Q),de(ne,Q,null),z(L,F),z(L,Z),de(J,Z,null),z(L,be),ge&&ge.m(L,null),ke=!0},p(ve,fe){(!ke||fe[0]&32768)&&v!==(v=Mr(ve[15].mode)+"")&&yt(S,v);const Pe={};fe[0]&128&&(Pe.mode={mode:"set-boundary",name:cr(ve[7]).properties.name,existing:cr(ve[7])}),J.$set(Pe),ve[16]?ge?fe[0]&65536&&N(ge,1):(ge=lv(ve),ge.c(),N(ge,1),ge.m(L,null)):ge&&(Zt(),G(ge,1,1,()=>{ge=null}),Ht())},i(ve){ke||(N(o.$$.fragment,ve),N(d.$$.fragment,ve),N(D.$$.fragment,ve),N(O.$$.fragment,ve),N(ue.$$.fragment,ve),N(ne.$$.fragment,ve),N(J.$$.fragment,ve),N(ge),ke=!0)},o(ve){G(o.$$.fragment,ve),G(d.$$.fragment,ve),G(D.$$.fragment,ve),G(O.$$.fragment,ve),G(ue.$$.fragment,ve),G(ne.$$.fragment,ve),G(J.$$.fragment,ve),G(ge),ke=!1},d(ve){ve&&H(e),he(o),he(d),he(D),he(O),he(ue),he(ne),he(J),ge&&ge.d()}}}function jP(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U,O,ee,X,ue,$,Q,ne,F,Z,J,be,ke,ge,ve;return _=new cw({}),P=new bk({}),X=new M3({}),Z=new ep({}),{c(){e=q("h3"),e.textContent="Reclassify main roads",t=ae(),n=q("p"),n.innerHTML=`<i>Main roads</i>, drawn in grey, were classified automatically
            using data from
            <a href="https://openstreetmap.org/about" target="_blank">OpenStreetMap</a>, but you can reclassify a road segment by clicking on it.`,i=ae(),o=q("p"),o.textContent=`Main roads are typically better suited to support higher levels of
            traffic than neighbourhood roads.`,u=ae(),a=q("div"),d=q("button"),m=q("div"),pe(_.$$.fragment),v=ae(),S=q("span"),S.textContent="Toggle segment",T=ae(),C=q("button"),L=q("div"),pe(P.$$.fragment),D=ae(),I=q("span"),I.textContent="Mark as main along a route",U=ae(),O=q("button"),ee=q("div"),pe(X.$$.fragment),ue=ae(),$=q("span"),$.textContent="Erase main classification",Q=ae(),ne=q("button"),F=q("div"),pe(Z.$$.fragment),J=ae(),be=q("span"),be.textContent="Erase all main roads",Ze(m,"display","flex"),Ze(m,"align-items","center"),Ze(m,"gap","8px"),ce(d,"data-tippy-content","Click a road to reclassify it"),Nt(d,"active",r[0].tool=="toggle"),Nt(d,"outline",r[0].tool!="toggle"),Ze(L,"display","flex"),Ze(L,"align-items","center"),Ze(L,"gap","8px"),ce(C,"data-tippy-content","Reclassify multiple roads by drawing a route crossing them"),Nt(C,"active",r[0].tool=="snap-route-main"),Nt(C,"outline",r[0].tool!="snap-route-main"),Ze(ee,"display","flex"),Ze(ee,"align-items","center"),Ze(ee,"gap","8px"),ce(O,"data-tippy-content","Reclassify multiple roads by drawing a route crossing them"),Nt(O,"active",r[0].tool=="snap-route-erase"),Nt(O,"outline",r[0].tool!="snap-route-erase"),Ze(F,"display","flex"),Ze(F,"align-items","center"),Ze(F,"gap","8px"),Nt(ne,"outline",!0),ce(a,"class","classification-buttons svelte-1syh48b"),Ze(a,"display","flex"),Ze(a,"flex-direction","column"),Ze(a,"gap","8px"),Ze(a,"justify-content","left")},m(fe,Pe){W(fe,e,Pe),W(fe,t,Pe),W(fe,n,Pe),W(fe,i,Pe),W(fe,o,Pe),W(fe,u,Pe),W(fe,a,Pe),z(a,d),z(d,m),de(_,m,null),z(m,v),z(m,S),z(a,T),z(a,C),z(C,L),de(P,L,null),z(L,D),z(L,I),z(a,U),z(a,O),z(O,ee),de(X,ee,null),z(ee,ue),z(ee,$),z(a,Q),z(a,ne),z(ne,F),de(Z,F,null),z(F,J),z(F,be),ke=!0,ge||(ve=[_t(d,"click",r[43]),_t(C,"click",r[44]),_t(O,"click",r[45]),_t(ne,"click",r[28])],ge=!0)},p(fe,Pe){(!ke||Pe[0]&1)&&Nt(d,"active",fe[0].tool=="toggle"),(!ke||Pe[0]&1)&&Nt(d,"outline",fe[0].tool!="toggle"),(!ke||Pe[0]&1)&&Nt(C,"active",fe[0].tool=="snap-route-main"),(!ke||Pe[0]&1)&&Nt(C,"outline",fe[0].tool!="snap-route-main"),(!ke||Pe[0]&1)&&Nt(O,"active",fe[0].tool=="snap-route-erase"),(!ke||Pe[0]&1)&&Nt(O,"outline",fe[0].tool!="snap-route-erase")},i(fe){ke||(N(_.$$.fragment,fe),N(P.$$.fragment,fe),N(X.$$.fragment,fe),N(Z.$$.fragment,fe),ke=!0)},o(fe){G(_.$$.fragment,fe),G(P.$$.fragment,fe),G(X.$$.fragment,fe),G(Z.$$.fragment,fe),ke=!1},d(fe){fe&&(H(e),H(t),H(n),H(i),H(o),H(u),H(a)),he(_),he(P),he(X),he(Z),ge=!1,Er(ve)}}}function UP(r){let e,t,n;return{c(){e=q("h3"),e.textContent="Restrict turns",t=ae(),n=q("p"),n.textContent=`To restrict certain turns, first click on the source road, then the
            destination road. Traffic will no longer be able to turn from the
            source road to the destination road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:ht,i:ht,o:ht,d(i){i&&(H(e),H(t),H(n))}}}function VP(r){let e,t,n;return{c(){e=q("h3"),e.textContent="Toggle one-way",t=ae(),n=q("p"),n.textContent=`Click on a road segment to toggle its direction. This will change
            the direction of traffic flow on that road.`},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p:ht,i:ht,o:ht,d(i){i&&(H(e),H(t),H(n))}}}function qP(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I;function U(ee){r[39](ee)}let O={};return r[4]!==void 0&&(O.show=r[4]),o=new yP({props:O}),wn.push(()=>On(o,"show",U)),T=new ok({}),{c(){e=q("h3"),e.textContent="Add modal filter",t=ae(),n=q("p"),n.textContent=`Modal filters restrict what kind of traffic can pass through a road
            segment. Place them strategically to deter shortcuts through your
            neighbourhood.`,i=ae(),pe(o.$$.fragment),a=ae(),d=q("div"),m=q("button"),m.textContent="Change modal filter type",_=ae(),v=q("button"),S=q("div"),pe(T.$$.fragment),C=ae(),L=q("span"),L.textContent="Add along a line",ce(m,"class","outline"),Ze(S,"display","flex"),Ze(S,"align-items","center"),Ze(S,"gap","8px"),ce(v,"data-tippy-content","Add many modal filters along a line"),Nt(v,"active",r[0].freehand),Nt(v,"outline",!r[0].freehand),Ze(d,"display","flex"),Ze(d,"gap","8px"),Ze(d,"align-items","leading"),Ze(d,"flex-direction","column"),Ze(d,"width","fit-content")},m(ee,X){W(ee,e,X),W(ee,t,X),W(ee,n,X),W(ee,i,X),de(o,ee,X),W(ee,a,X),W(ee,d,X),z(d,m),z(d,_),z(d,v),z(v,S),de(T,S,null),z(S,C),z(S,L),P=!0,D||(I=[_t(m,"click",r[40]),_t(v,"click",function(){Xu(r[0].freehand?r[41]:r[42])&&(r[0].freehand?r[41]:r[42]).apply(this,arguments)})],D=!0)},p(ee,X){r=ee;const ue={};!u&&X[0]&16&&(u=!0,ue.show=r[4],Nn(()=>u=!1)),o.$set(ue),(!P||X[0]&1)&&Nt(v,"active",r[0].freehand),(!P||X[0]&1)&&Nt(v,"outline",!r[0].freehand)},i(ee){P||(N(o.$$.fragment,ee),N(T.$$.fragment,ee),P=!0)},o(ee){G(o.$$.fragment,ee),G(T.$$.fragment,ee),P=!1},d(ee){ee&&(H(e),H(t),H(n),H(i),H(a),H(d)),he(o,ee),he(T),D=!1,Er(I)}}}function uv(r){let e;return{c(){e=q("mark"),e.textContent=`Some parts of the neighbourhood aren't reachable by drivers, shown in
          red`},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function cv(r){let e,t;return e=new Qi({props:{colorScale:v2,labels:{limits:w2}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function GP(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U,O,ee,X,ue,$,Q,ne,F,Z,J,be,ke,ge,ve,fe,Pe,Ee,Fe,ot,ct,it,at,ft,Ct,xt,It,Qt,tn,rn,Ue,Xe,qt,Ge,et,nn,Ye,Ft,Tt,Rn,fr,un,Dt,Mt,Vr,vt,Cn,Zn,jr,Nr,Lt,tt,pt,$t,Bn,zt;Q=new Tk({}),be=new mk({});const hr=[qP,VP,UP,jP],ir=[];function Gr(oe,le){return oe[0].kind=="filter"?0:oe[0].kind=="oneway"?1:oe[0].kind=="turn_restriction"?2:oe[0].kind=="main-roads"?3:-1}~(Pe=Gr(r))&&(Ee=ir[Pe]=hr[Pe](r));let br=r[9]>0&&uv(),Ce=r[14]=="speeds"&&cv();return pt=new V2({props:{neighbourhoodBoundary:cr(r[7])}}),{c(){e=q("div"),t=q("div"),n=q("h2"),n.textContent="Editing tools",i=ae(),o=q("label"),u=q("input"),d=Te(`
        Show before edits`),m=ae(),_=q("div"),v=q("div"),S=q("div"),T=q("button"),C=q("img"),P=ae(),D=q("button"),D.innerHTML=`<div style="height: 100%; width: 100%; position: relative;"><img style="position: absolute; width: 60%; height: 60%; top: -1px; left: -1px;" src="${Jb}" alt="Reverse directions"/> <img style="position: absolute; width: 60%; height: 60%; bottom: -1px; right: -1px; transform: rotate(180deg);" src="${Jb}" alt="Reverse directions"/></div>`,I=ae(),U=q("button"),U.innerHTML=`<img src="${Pg}" alt="Restrict turns"/>`,O=ae(),ee=q("button"),ee.innerHTML=`<img src="${U8}" alt="Change main/minor roads"/>`,X=ae(),ue=q("div"),$=q("button"),pe(Q.$$.fragment),Z=ae(),J=q("button"),pe(be.$$.fragment),ve=ae(),fe=q("div"),Ee&&Ee.c(),Fe=ae(),br&&br.c(),ot=ae(),ct=q("h2"),ct.textContent="Map style",it=ae(),at=q("label"),ft=q("input"),Ct=Te(`
      Animate shortcuts`),xt=q("span"),It=Te("1"),Qt=ae(),tn=q("label"),rn=q("input"),Ue=Te(`
      Show entries into cells`),Xe=q("span"),qt=Te("2"),Ge=ae(),et=q("label"),nn=q("input"),Ye=Te(`
      Road thickness depends on shortcuts`),Ft=q("span"),Tt=Te("1"),Rn=ae(),fr=q("label"),un=q("span"),un.textContent="Draw roads:",Dt=ae(),Mt=q("select"),Vr=q("option"),Vr.textContent="Worst shortcuts",vt=q("option"),vt.textContent="Cell",Cn=q("option"),Cn.textContent="Edits (either filter or direction)",Zn=q("option"),Zn.textContent="Speed limit",jr=ae(),Ce&&Ce.c(),Nr=ae(),Lt=q("h2"),Lt.textContent="Neighbourhood stats",tt=ae(),pe(pt.$$.fragment),ce(u,"type","checkbox"),ce(u,"role","switch"),u.disabled=a=Cg(r[0]),Ze(t,"display","flex"),Ze(t,"justify-content","space-between"),Ze(t,"align-items","center"),Or(C.src,L=cr(Ri.getFilter(r[10])).iconURL)||ce(C,"src",L),ce(C,"alt","Add a modal filter"),ce(T,"class","icon-btn"),ce(T,"data-tippy-content","Add a modal filter (hotkey 1)"),Nt(T,"active",r[0].kind=="filter"),ce(D,"class","icon-btn"),ce(D,"data-tippy-content","Toggle one-way (hotkey 2)"),Nt(D,"active",r[0].kind=="oneway"),ce(U,"class","icon-btn"),ce(U,"data-tippy-content","Restrict turns (hotkey 3)"),Nt(U,"active",r[0].kind=="turn_restriction"),ce(ee,"class","icon-btn"),ce(ee,"data-tippy-content","Reclassify main roads (hotkey 4)"),Nt(ee,"active",r[0].kind=="main-roads"),Ze(S,"height","50px"),Ze(S,"display","flex"),Ze(S,"justify-content","left"),Ze(S,"gap","6px"),ce($,"class","outline icon-btn"),$.disabled=ne=r[5]==0,ce($,"data-tippy-content",F=r[5]==0?"Undo Ctrl+Z":`Undo (${r[5]}) Ctrl+Z`),ce(J,"class","outline icon-btn"),J.disabled=ke=r[6]==0,ce(J,"data-tippy-content",ge=r[6]==0?"Redo Ctrl+Y":`Redo (${r[6]}) Ctrl+Y`),Ze(ue,"height","50px"),Ze(ue,"display","flex"),Ze(ue,"justify-content","right"),Ze(ue,"gap","6px"),ce(v,"class","tool-palette"),Ze(v,"display","flex"),Ze(v,"justify-content","space-between"),Ze(v,"flex-wrap","wrap"),Ze(v,"gap","6px"),Ze(fe,"min-height","200px"),Ze(fe,"padding-bottom","16px"),Ze(fe,"border-bottom","solid var(--pico-muted-border-color) 1px"),ce(_,"class","svelte-1syh48b"),Nt(_,"edits-disabled",r[11]),ce(ft,"type","checkbox"),ce(xt,"class","footnote-ref svelte-1syh48b"),ce(xt,"data-tippy-content",dv),ce(rn,"type","checkbox"),ce(Xe,"class","footnote-ref svelte-1syh48b"),ce(Xe,"data-tippy-content",hz),ce(nn,"type","checkbox"),ce(Ft,"class","footnote-ref svelte-1syh48b"),ce(Ft,"data-tippy-content",dv),Ze(un,"text-wrap","nowrap"),Vr.__value="shortcuts",Gn(Vr,Vr.__value),vt.__value="cells",Gn(vt,vt.__value),Cn.__value="edits",Gn(Cn,Cn.__value),Zn.__value="speeds",Gn(Zn,Zn.__value),Ze(Mt,"margin","0"),Ze(Mt,"padding","8px"),Ze(Mt,"width","auto"),r[14]===void 0&&Ks(()=>r[49].call(Mt)),Ze(fr,"display","flex"),Ze(fr,"align-items","center"),Ze(fr,"gap","8px"),Ze(fr,"flex-wrap","wrap"),ce(e,"slot","sidebar")},m(oe,le){W(oe,e,le),z(e,t),z(t,n),z(t,i),z(t,o),z(o,u),u.checked=r[11],z(o,d),z(e,m),z(e,_),z(_,v),z(v,S),z(S,T),z(T,C),z(S,P),z(S,D),z(S,I),z(S,U),z(S,O),z(S,ee),z(v,X),z(v,ue),z(ue,$),de(Q,$,null),z(ue,Z),z(ue,J),de(be,J,null),z(_,ve),z(_,fe),~Pe&&ir[Pe].m(fe,null),z(_,Fe),br&&br.m(_,null),z(e,ot),z(e,ct),z(e,it),z(e,at),z(at,ft),ft.checked=r[3],z(at,Ct),z(at,xt),z(xt,It),z(e,Qt),z(e,tn),z(tn,rn),rn.checked=r[12],z(tn,Ue),z(tn,Xe),z(Xe,qt),z(e,Ge),z(e,et),z(et,nn),nn.checked=r[13],z(et,Ye),z(et,Ft),z(Ft,Tt),z(e,Rn),z(e,fr),z(fr,un),z(fr,Dt),z(fr,Mt),z(Mt,Vr),z(Mt,vt),z(Mt,Cn),z(Mt,Zn),Mi(Mt,r[14],!0),z(e,jr),Ce&&Ce.m(e,null),z(e,Nr),z(e,Lt),z(e,tt),de(pt,e,null),$t=!0,Bn||(zt=[_t(u,"change",r[34]),_t(T,"click",r[35]),_t(D,"click",r[36]),_t(U,"click",r[37]),_t(ee,"click",r[38]),_t($,"click",r[25]),_t(J,"click",r[26]),_t(ft,"change",r[46]),_t(rn,"change",r[47]),_t(nn,"change",r[48]),_t(Mt,"change",r[49])],Bn=!0)},p(oe,le){(!$t||le[0]&1&&a!==(a=Cg(oe[0])))&&(u.disabled=a),le[0]&2048&&(u.checked=oe[11]),(!$t||le[0]&1024&&!Or(C.src,L=cr(Ri.getFilter(oe[10])).iconURL))&&ce(C,"src",L),(!$t||le[0]&1)&&Nt(T,"active",oe[0].kind=="filter"),(!$t||le[0]&1)&&Nt(D,"active",oe[0].kind=="oneway"),(!$t||le[0]&1)&&Nt(U,"active",oe[0].kind=="turn_restriction"),(!$t||le[0]&1)&&Nt(ee,"active",oe[0].kind=="main-roads"),(!$t||le[0]&32&&ne!==(ne=oe[5]==0))&&($.disabled=ne),(!$t||le[0]&32&&F!==(F=oe[5]==0?"Undo Ctrl+Z":`Undo (${oe[5]}) Ctrl+Z`))&&ce($,"data-tippy-content",F),(!$t||le[0]&64&&ke!==(ke=oe[6]==0))&&(J.disabled=ke),(!$t||le[0]&64&&ge!==(ge=oe[6]==0?"Redo Ctrl+Y":`Redo (${oe[6]}) Ctrl+Y`))&&ce(J,"data-tippy-content",ge);let we=Pe;Pe=Gr(oe),Pe===we?~Pe&&ir[Pe].p(oe,le):(Ee&&(Zt(),G(ir[we],1,1,()=>{ir[we]=null}),Ht()),~Pe?(Ee=ir[Pe],Ee?Ee.p(oe,le):(Ee=ir[Pe]=hr[Pe](oe),Ee.c()),N(Ee,1),Ee.m(fe,null)):Ee=null),oe[9]>0?br||(br=uv(),br.c(),br.m(_,null)):br&&(br.d(1),br=null),(!$t||le[0]&2048)&&Nt(_,"edits-disabled",oe[11]),le[0]&8&&(ft.checked=oe[3]),le[0]&4096&&(rn.checked=oe[12]),le[0]&8192&&(nn.checked=oe[13]),le[0]&16384&&Mi(Mt,oe[14]),oe[14]=="speeds"?Ce?le[0]&16384&&N(Ce,1):(Ce=cv(),Ce.c(),N(Ce,1),Ce.m(e,Nr)):Ce&&(Zt(),G(Ce,1,1,()=>{Ce=null}),Ht());const Me={};le[0]&128&&(Me.neighbourhoodBoundary=cr(oe[7])),pt.$set(Me)},i(oe){$t||(N(Q.$$.fragment,oe),N(be.$$.fragment,oe),N(Ee),N(Ce),N(pt.$$.fragment,oe),$t=!0)},o(oe){G(Q.$$.fragment,oe),G(be.$$.fragment,oe),G(Ee),G(Ce),G(pt.$$.fragment,oe),$t=!1},d(oe){oe&&H(e),he(Q),he(be),~Pe&&ir[Pe].d(),br&&br.d(),Ce&&Ce.d(),he(pt),Bn=!1,Er(zt)}}}function ZP(r){let e,t,n=(r[54].name??"unnamed road")+"",i,o,u=Math.round(r[54].speed_mph)+"",a,d;return{c(){e=q("p"),t=Te("Main road: "),i=Te(n),o=Te(`
                (`),a=Te(u),d=Te(" mph)")},m(m,_){W(m,e,_),z(e,t),z(e,i),z(e,o),z(e,a),z(e,d)},p(m,_){_[1]&8388608&&n!==(n=(m[54].name??"unnamed road")+"")&&yt(i,n),_[1]&8388608&&u!==(u=Math.round(m[54].speed_mph)+"")&&yt(a,u)},d(m){m&&H(e)}}}function HP(r){let e,t=r[54].shortcuts+"",n,i,o=(r[54].name??"unnamed road")+"",u,a,d=Math.round(r[54].speed_mph)+"",m,_;return{c(){e=q("p"),n=Te(t),i=Te(" shortcuts through "),u=Te(o),a=Te(`
                (`),m=Te(d),_=Te(" mph)")},m(v,S){W(v,e,S),z(e,n),z(e,i),z(e,u),z(e,a),z(e,m),z(e,_)},p(v,S){S[1]&8388608&&t!==(t=v[54].shortcuts+"")&&yt(n,t),S[1]&8388608&&o!==(o=(v[54].name??"unnamed road")+"")&&yt(u,o),S[1]&8388608&&d!==(d=Math.round(v[54].speed_mph)+"")&&yt(m,d)},d(v){v&&H(e)}}}function WP(r){let e;return{c(){e=q("p"),e.textContent="Click to create a turn restriction from here"},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function XP(r){let e;return{c(){e=q("p"),e.textContent="Click to designate a main road or not"},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function JP(r){let e;return{c(){e=q("p"),e.textContent="Click to change direction"},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function KP(r){let e,t,n,i;return{c(){e=q("div"),t=q("img"),i=Te(`
                Click to add modal filter`),Or(t.src,n=cr(Ri.getFilter(r[10])).iconURL)||ce(t,"src",n),ce(t,"width","20"),ce(t,"alt","Add modal filter")},m(o,u){W(o,e,u),z(e,t),z(e,i)},p(o,u){u[0]&1024&&!Or(t.src,n=cr(Ri.getFilter(o[10])).iconURL)&&ce(t,"src",n)},d(o){o&&H(e)}}}function YP(r){let e,t;function n(m,_){if(m[54].kind=="interior_road")return HP;if(m[54].kind=="main_road")return ZP}let i=n(r),o=i&&i(r);function u(m,_){if(m[0].kind=="filter")return KP;if(m[0].kind=="oneway")return JP;if(m[0].kind=="main-roads"&&m[0].tool=="toggle")return XP;if(m[0].kind=="turn_restriction")return WP}let a=u(r),d=a&&a(r);return{c(){o&&o.c(),e=ae(),d&&d.c(),t=rr()},m(m,_){o&&o.m(m,_),W(m,e,_),d&&d.m(m,_),W(m,t,_)},p(m,_){i===(i=n(m))&&o?o.p(m,_):(o&&o.d(1),o=i&&i(m),o&&(o.c(),o.m(e.parentNode,e))),a===(a=u(m))&&d?d.p(m,_):(d&&d.d(1),d=a&&a(m),d&&(d.c(),d.m(t.parentNode,t)))},d(m){m&&(H(e),H(t)),o&&o.d(m),d&&d.d(m)}}}function QP(r){let e,t,n;return t=new oi({props:{openOn:"hover",$$slots:{default:[YP,({props:i})=>({54:i}),({props:i})=>[0,i?8388608:0]]},$$scope:{ctx:r}}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","line-popup")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p(i,o){const u={};o[0]&1025|o[1]&25165824&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function ez(r){let e,t,n,i,o,u,a,d,m,_;return e=new lp({}),n=new ah({props:{show:!r[11]}}),o=new lh({props:{show:!r[11]}}),a=new tc({props:{show:!r[11],interactive:r[0].kind=="filter"&&!r[0].freehand||r[0].kind=="oneway"||r[0].kind=="main-roads"&&r[0].tool=="toggle"||r[0].kind=="turn_restriction"&&r[0].from_road_id==null,onClickLine:r[18],$$slots:{"line-popup":[QP]},$$scope:{ctx:r}}}),m=new pP({props:{show:!r[11],interactive:r[0].kind=="filter",neighbourhood:r[1],onClickIntersection:r[23]}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment),d=ae(),pe(m.$$.fragment)},m(v,S){de(e,v,S),W(v,t,S),de(n,v,S),W(v,i,S),de(o,v,S),W(v,u,S),de(a,v,S),W(v,d,S),de(m,v,S),_=!0},p(v,S){const T={};S[0]&2048&&(T.show=!v[11]),n.$set(T);const C={};S[0]&2048&&(C.show=!v[11]),o.$set(C);const L={};S[0]&2048&&(L.show=!v[11]),S[0]&1&&(L.interactive=v[0].kind=="filter"&&!v[0].freehand||v[0].kind=="oneway"||v[0].kind=="main-roads"&&v[0].tool=="toggle"||v[0].kind=="turn_restriction"&&v[0].from_road_id==null),S[0]&1025|S[1]&16777216&&(L.$$scope={dirty:S,ctx:v}),a.$set(L);const P={};S[0]&2048&&(P.show=!v[11]),S[0]&1&&(P.interactive=v[0].kind=="filter"),S[0]&2&&(P.neighbourhood=v[1]),m.$set(P)},i(v){_||(N(e.$$.fragment,v),N(n.$$.fragment,v),N(o.$$.fragment,v),N(a.$$.fragment,v),N(m.$$.fragment,v),_=!0)},o(v){G(e.$$.fragment,v),G(n.$$.fragment,v),G(o.$$.fragment,v),G(a.$$.fragment,v),G(m.$$.fragment,v),_=!1},d(v){v&&(H(t),H(i),H(u),H(d)),he(e,v),he(n,v),he(o,v),he(a,v),he(m,v)}}}function fv(r){let e,t;return e=new tP({props:{paths:r[8]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i[0]&256&&(o.paths=n[8]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function tz(r){let e;return{c(){e=Te("Click to delete filter")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function nz(r){let e,t,n;return t=new oi({props:{openOn:"hover",$$slots:{default:[tz]},$$scope:{ctx:r}}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","modal-filter")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p(i,o){const u={};o[1]&16777216&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function rz(r){let e;return{c(){e=Te("Click to delete turn restriction")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function iz(r){let e,t,n;return t=new oi({props:{openOn:"hover",$$slots:{default:[rz]},$$scope:{ctx:r}}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","turn-restriction")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p(i,o){const u={};o[1]&16777216&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function oz(r){let e,t,n;function i(u){r[33](u)}let o={map:cr(r[2]),finish:r[29],cancel:r[32]};return r[0].waypoints!==void 0&&(o.waypoints=r[0].waypoints),e=new OP({props:o}),wn.push(()=>On(e,"waypoints",i)),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,a){const d={};a[0]&4&&(d.map=cr(u[2])),a[0]&1&&(d.cancel=u[32]),!t&&a[0]&1&&(t=!0,d.waypoints=u[0].waypoints,Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function sz(r){let e,t;return e=new xP({props:{map:cr(r[2])}}),e.$on("done",r[27]),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i[0]&4&&(o.map=cr(n[2])),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function hv(r){let e,t;return e=new yr({props:{data:r[0].possible_targets||ii(),generateId:!0,$$slots:{default:[uz]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i[0]&1&&(o.data=n[0].possible_targets||ii()),i[0]&1|i[1]&16777216&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function az(r){let e,t,n,i,o=r[0].from_road_name+"",u,a,d=(r[54].name||"unnamed road")+"",m;return{c(){e=q("div"),t=q("img"),i=Te(`

              Create a turn restriction from `),u=Te(o),a=Te(" to "),m=Te(d),Or(t.src,n=r[30][r[54].kind])||ce(t,"src",n),ce(t,"width","20"),ce(t,"alt","Add turn restriction")},m(_,v){W(_,e,v),z(e,t),z(e,i),z(e,u),z(e,a),z(e,m)},p(_,v){v[1]&8388608&&!Or(t.src,n=_[30][_[54].kind])&&ce(t,"src",n),v[0]&1&&o!==(o=_[0].from_road_name+"")&&yt(u,o),v[1]&8388608&&d!==(d=(_[54].name||"unnamed road")+"")&&yt(m,d)},d(_){_&&H(e)}}}function lz(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[az,({props:n})=>({54:n}),({props:n})=>[0,n?8388608:0]]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i[0]&1|i[1]&25165824&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function uz(r){let e,t;const n=[sn("turn-restriction-targets"),{manageHoverState:!0},{paint:{"line-color":"yellow","line-opacity":nr(.5,1),"line-width":Xs(1)}}];let i={$$slots:{default:[lz]},$$scope:{ctx:r}};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),e.$on("click",r[20]),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};u[0]&1|u[1]&16777216&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function cz(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C;t=new tp({}),t.$on("click",r[19]),i=new IP({}),u=new nc({props:{input:r[1],$$slots:{default:[ez]},$$scope:{ctx:r}}});let L=r[3]&&fv(r);m=new na({props:{show:!r[11],onClickModalFilter:r[21],onClickTurnRestriction:r[22],interactive:r[0].kind=="filter",$$slots:{"turn-restriction":[iz],"modal-filter":[nz]},$$scope:{ctx:r}}});const P=[sz,oz],D=[];function I(O,ee){return O[0].kind=="filter"&&O[0].freehand?0:O[0].kind=="main-roads"&&O[0].tool!="toggle"?1:-1}~(v=I(r))&&(S=D[v]=P[v](r));let U=r[0].kind=="turn_restriction"&&hv(r);return{c(){e=q("div"),pe(t.$$.fragment),n=ae(),pe(i.$$.fragment),o=ae(),pe(u.$$.fragment),a=ae(),L&&L.c(),d=ae(),pe(m.$$.fragment),_=ae(),S&&S.c(),T=ae(),U&&U.c(),ce(e,"slot","map")},m(O,ee){W(O,e,ee),de(t,e,null),z(e,n),de(i,e,null),z(e,o),de(u,e,null),z(e,a),L&&L.m(e,null),z(e,d),de(m,e,null),z(e,_),~v&&D[v].m(e,null),z(e,T),U&&U.m(e,null),C=!0},p(O,ee){const X={};ee[0]&2&&(X.input=O[1]),ee[0]&3075|ee[1]&16777216&&(X.$$scope={dirty:ee,ctx:O}),u.$set(X),O[3]?L?(L.p(O,ee),ee[0]&8&&N(L,1)):(L=fv(O),L.c(),N(L,1),L.m(e,d)):L&&(Zt(),G(L,1,1,()=>{L=null}),Ht());const ue={};ee[0]&2048&&(ue.show=!O[11]),ee[0]&1&&(ue.interactive=O[0].kind=="filter"),ee[1]&16777216&&(ue.$$scope={dirty:ee,ctx:O}),m.$set(ue);let $=v;v=I(O),v===$?~v&&D[v].p(O,ee):(S&&(Zt(),G(D[$],1,1,()=>{D[$]=null}),Ht()),~v?(S=D[v],S?S.p(O,ee):(S=D[v]=P[v](O),S.c()),N(S,1),S.m(e,T)):S=null),O[0].kind=="turn_restriction"?U?(U.p(O,ee),ee[0]&1&&N(U,1)):(U=hv(O),U.c(),N(U,1),U.m(e,null)):U&&(Zt(),G(U,1,1,()=>{U=null}),Ht())},i(O){C||(N(t.$$.fragment,O),N(i.$$.fragment,O),N(u.$$.fragment,O),N(L),N(m.$$.fragment,O),N(S),N(U),C=!0)},o(O){G(t.$$.fragment,O),G(i.$$.fragment,O),G(u.$$.fragment,O),G(L),G(m.$$.fragment,O),G(S),G(U),C=!1},d(O){O&&H(e),he(t),he(i),he(u),L&&L.d(),he(m),~v&&D[v].d(),U&&U.d()}}}function fz(r){let e,t,n,i;return e=new po({props:{$$slots:{map:[cz],sidebar:[GP],top:[$P]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0,n||(i=_t(window,"keydown",r[24]),n=!0)},p(o,u){const a={};u[0]&131071|u[1]&16777216&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o),n=!1,i()}}}let dv="Shortcuts are routes from one main road to another, which cut through the neighborhood's interior.",hz="Cells are the colored area reachable without travelling along a main road.";function Cg(r){return!!(r.kind=="filter"&&r.freehand||r.kind=="main-roads"&&r.tool!="toggle"&&r.waypoints.length>0||r.kind=="turn_restriction"&&r.from_road_id!=null)}function dz(r,e,t){let n,i,o,u,a,d,m,_,v,S,T,C;rt(r,ri,Tt=>t(31,i=Tt)),rt(r,Cr,Tt=>t(51,o=Tt)),rt(r,ng,Tt=>t(10,u=Tt)),rt(r,eg,Tt=>t(11,a=Tt)),rt(r,Ko,Tt=>t(2,d=Tt)),rt(r,t1,Tt=>t(3,m=Tt)),rt(r,rg,Tt=>t(12,_=Tt)),rt(r,ig,Tt=>t(13,v=Tt)),rt(r,Zd,Tt=>t(14,S=Tt)),rt(r,or,Tt=>t(15,T=Tt)),rt(r,jf,Tt=>t(16,C=Tt));function L(){return{kind:"turn_restriction",from_road_id:null,from_road_name:"",possible_targets:ii()}}let P={kind:"filter",freehand:!1},D=!1,I=0,U=0,O,ee,X=ii(),ue=0;Yo(()=>{r_()}),ei(()=>{d.doubleClickZoom.enable()});function $(Tt){t(1,ee=o.renderNeighbourhood()),t(7,O=ee.features.find(Rn=>Rn.properties.kind=="boundary")),t(5,I=ee.undo_length),t(6,U=ee.redo_length),Uf()}function Q(Tt,Rn){i==ue||!Rn||(t(8,X=o.getAllShortcuts()),ue=i)}function ne(Tt,Rn){P.kind=="filter"?(o.addModalFilter(Rn,u),on(ri,i++,i)):P.kind=="oneway"?(o.toggleTravelFlow(Tt.properties.road),on(ri,i++,i)):P.kind=="main-roads"&&P.tool=="toggle"?(o.toggleMainRoad(Tt.properties.road),on(ri,i++,i)):P.kind=="turn_restriction"&&(t(0,P.from_road_id=Tt.properties.road,P),t(0,P.from_road_name=Tt.properties.name||"unnamed road",P),t(0,P.possible_targets=o.getTurnRestrictionTargets(Tt.properties.road),P))}function F(Tt){P.kind=="turn_restriction"&&(d.queryRenderedFeatures(Tt.detail.point,{layers:["interior-roads","turn-restriction-targets"]}).length>0||t(0,P=L()))}function Z(Tt){if(P.kind=="turn_restriction"&&P.from_road_id!=null){let Rn=Tt.detail.features[0].properties.road;o.addTurnRestriction(P.from_road_id,Rn),on(ri,i++,i)}t(0,P=L())}function J(Tt){let Rn=Tt.detail.features[0];o.deleteModalFilter(Rn.properties.road),on(ri,i++,i)}function be(Tt){let Rn=Tt.detail.features[0];o.deleteTurnRestriction(Rn.properties.intersection,Rn.properties.from_road,Rn.properties.to_road),on(ri,i++,i)}function ke(Tt){if(P.kind!="filter"){console.assert(!1,`this shouldn't happen - intersections should only be clickable when in 'filter' mode, not ${P.kind}`);return}Tt.hasRotatedFilter?(o.deleteDiagonalFilter(Tt),on(ri,i++,i)):Tt.filter?(o.rotateDiagonalFilter(Tt),on(ri,i++,i)):(o.addDiagonalFilter(Tt),on(ri,i++,i))}function ge(Tt){a||Tt.target.tagName!="INPUT"&&(Cg(P)||(Tt.ctrlKey&&Tt.key=="z"&&ve(),Tt.ctrlKey&&Tt.key=="y"&&fe(),Tt.key=="1"&&t(0,P={kind:"filter",freehand:!1}),Tt.key=="2"&&t(0,P={kind:"oneway"}),Tt.key=="3"&&t(0,P=L()),Tt.key=="4"&&t(0,P={kind:"main-roads",tool:"toggle",waypoints:[]})))}function ve(){o.undo(),on(ri,i++,i)}function fe(){o.redo(),on(ri,i++,i)}function Pe(Tt){let Rn=Tt.detail;Rn&&(o.addManyModalFilters(Rn,u),on(ri,i++,i)),t(0,P={kind:"filter",freehand:!1})}function Ee(){o.eraseAllMainRoads(),on(ri,i++,i)}function Fe(Tt){let Rn=P.kind=="main-roads"&&P.tool=="snap-route-main";o.setMainRoads(Tt,Rn),on(ri,i++,i)}let ot={left:nw,right:Pg,straight:rw,u_left_to_right:ow,u_right_to_left:iw};const ct=()=>t(0,P={kind:"main-roads",tool:"toggle",waypoints:[]});function it(Tt){r.$$.not_equal(P.waypoints,Tt)&&(P.waypoints=Tt,t(0,P))}function at(){a=this.checked,eg.set(a)}const ft=()=>t(0,P={kind:"filter",freehand:!1}),Ct=()=>t(0,P={kind:"oneway"}),xt=()=>t(0,P=L()),It=()=>t(0,P={kind:"main-roads",tool:"toggle",waypoints:[]});function Qt(Tt){D=Tt,t(4,D)}const tn=()=>t(4,D=!0),rn=()=>t(0,P={kind:"filter",freehand:!1}),Ue=()=>t(0,P={kind:"filter",freehand:!0}),Xe=()=>{t(0,P={kind:"main-roads",tool:"toggle",waypoints:[]})},qt=()=>{t(0,P={kind:"main-roads",tool:"snap-route-main",waypoints:[]})},Ge=()=>{t(0,P={kind:"main-roads",tool:"snap-route-erase",waypoints:[]})};function et(){m=this.checked,t1.set(m)}function nn(){_=this.checked,rg.set(_)}function Ye(){v=this.checked,ig.set(v)}function Ft(){S=Ys(this),Zd.set(S)}return r.$$.update=()=>{r.$$.dirty[0]&5&&(P.kind=="oneway"||P.kind=="main-roads"?d.doubleClickZoom.disable():d.doubleClickZoom.enable()),r.$$.dirty[0]&5&&(P.kind=="filter"&&P.freehand?d.getCanvas().style.cursor=`url(${j8}) 8 22, cell`:P.kind=="main-roads"&&P.tool=="snap-route-erase"?d.getCanvas().style.cursor=`url(${$8}) 8 22, cell`:d.getCanvas().style.cursor=""),r.$$.dirty[1]&1&&$(),r.$$.dirty[0]&8|r.$$.dirty[1]&1&&Q(i,m),r.$$.dirty[0]&2&&t(9,n=ee.features.filter(Tt=>Tt.properties.kind=="cell"&&Tt.properties.cell_color=="disconnected").length)},[P,ee,d,m,D,I,U,O,X,n,u,a,_,v,S,T,C,L,ne,F,Z,J,be,ke,ge,ve,fe,Pe,Ee,Fe,ot,i,ct,it,at,ft,Ct,xt,It,Qt,tn,rn,Ue,Xe,qt,Ge,et,nn,Ye,Ft]}class pz extends kt{constructor(e){super(),St(this,e,dz,fz,gt,{},null,[-1,-1])}}function pv(r){let e,t,n;return t=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=q("li"),pe(t.$$.fragment)},m(i,o){W(i,e,o),de(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function mz(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L=Mr(r[5].mode)+"",P,D;o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}});let I=r[0]=="neighbourhood"&&pv();return S=new jn({props:{mode:{mode:"predict-impact",prevMode:r[0]}}}),{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),I&&I.c(),_=ae(),v=q("li"),pe(S.$$.fragment),T=ae(),C=q("li"),P=Te(L),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(U,O){W(U,e,O),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),I&&I.m(n,null),z(n,_),z(n,v),de(S,v,null),z(n,T),z(n,C),z(C,P),D=!0},p(U,O){U[0]=="neighbourhood"?I?O&1&&N(I,1):(I=pv(),I.c(),N(I,1),I.m(n,_)):I&&(Zt(),G(I,1,1,()=>{I=null}),Ht());const ee={};O&1&&(ee.mode={mode:"predict-impact",prevMode:U[0]}),S.$set(ee),(!D||O&32)&&L!==(L=Mr(U[5].mode)+"")&&yt(P,L)},i(U){D||(N(o.$$.fragment,U),N(d.$$.fragment,U),N(I),N(S.$$.fragment,U),D=!0)},o(U){G(o.$$.fragment,U),G(d.$$.fragment,U),G(I),G(S.$$.fragment,U),D=!1},d(U){U&&H(e),he(o),he(d),I&&I.d(),he(S)}}}function mv(r){let e,t,n,i,o,u,a;function d(T){r[10](T)}let m={list:r[2]};r[3]!==void 0&&(m.idx=r[3]),e=new op({props:m}),wn.push(()=>On(e,"idx",d));let _=r[2][r[3]].count>1&&gv(r),v=r[2][r[3]].before==null&&_v(),S=r[2][r[3]].after==null&&yv();return{c(){pe(e.$$.fragment),n=ae(),_&&_.c(),i=ae(),v&&v.c(),o=ae(),S&&S.c(),u=rr()},m(T,C){de(e,T,C),W(T,n,C),_&&_.m(T,C),W(T,i,C),v&&v.m(T,C),W(T,o,C),S&&S.m(T,C),W(T,u,C),a=!0},p(T,C){const L={};C&4&&(L.list=T[2]),!t&&C&8&&(t=!0,L.idx=T[3],Nn(()=>t=!1)),e.$set(L),T[2][T[3]].count>1?_?_.p(T,C):(_=gv(T),_.c(),_.m(i.parentNode,i)):_&&(_.d(1),_=null),T[2][T[3]].before==null?v||(v=_v(),v.c(),v.m(o.parentNode,o)):v&&(v.d(1),v=null),T[2][T[3]].after==null?S||(S=yv(),S.c(),S.m(u.parentNode,u)):S&&(S.d(1),S=null)},i(T){a||(N(e.$$.fragment,T),a=!0)},o(T){G(e.$$.fragment,T),a=!1},d(T){T&&(H(n),H(i),H(o),H(u)),he(e,T),_&&_.d(T),v&&v.d(T),S&&S.d(T)}}}function gv(r){let e,t,n=r[2][r[3]].count.toLocaleString()+"",i,o,u,a;return{c(){e=q("p"),t=Te(`The routes are currently sampled, to speed things up. This one sample
          route represents `),i=Te(n),o=Te(` trips between the
          same points.`),u=ae(),a=q("i"),a.textContent=`Note: if these don't sum to the total above, that's likely a known
          software bug`},m(d,m){W(d,e,m),z(e,t),z(e,i),z(e,o),W(d,u,m),W(d,a,m)},p(d,m){m&12&&n!==(n=d[2][d[3]].count.toLocaleString()+"")&&yt(i,n)},d(d){d&&(H(e),H(u),H(a))}}}function _v(r){let e;return{c(){e=q("p"),e.innerHTML=`No possible route before changes (
          <i>This is usually a known software bug</i>`,Ze(e,"color","red")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function yv(r){let e;return{c(){e=q("p"),e.innerHTML=`No possible route after changes (
          <i>This is usually a known software bug</i>`,Ze(e,"color","blue")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function gz(r){let e,t,n,i,o=r[1].before.toLocaleString()+"",u,a,d,m,_=r[1].after.toLocaleString()+"",v,S,T,C,L=Math.round(100*r[1].after/r[1].before)+"",P,D,I,U;t=new Is({props:{mode:{mode:"predict-impact",prevMode:r[0]}}});let O=r[2].length>0&&mv(r);return{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("p"),u=Te(o),a=Te(` routes cross here
      `),d=q("span"),d.textContent="before your changes",m=Te(`
      , and `),v=Te(_),S=ae(),T=q("span"),T.textContent="after your changes",C=Te(`
      . That's
      `),P=Te(L),D=Te("% of the original traffic."),I=ae(),O&&O.c(),Ze(d,"color","red"),Ze(T,"color","blue"),ce(e,"slot","sidebar")},m(ee,X){W(ee,e,X),de(t,e,null),z(e,n),z(e,i),z(i,u),z(i,a),z(i,d),z(i,m),z(i,v),z(i,S),z(i,T),z(i,C),z(i,P),z(i,D),z(e,I),O&&O.m(e,null),U=!0},p(ee,X){const ue={};X&1&&(ue.mode={mode:"predict-impact",prevMode:ee[0]}),t.$set(ue),(!U||X&2)&&o!==(o=ee[1].before.toLocaleString()+"")&&yt(u,o),(!U||X&2)&&_!==(_=ee[1].after.toLocaleString()+"")&&yt(v,_),(!U||X&2)&&L!==(L=Math.round(100*ee[1].after/ee[1].before)+"")&&yt(P,L),ee[2].length>0?O?(O.p(ee,X),X&4&&N(O,1)):(O=mv(ee),O.c(),N(O,1),O.m(e,null)):O&&(Zt(),G(O,1,1,()=>{O=null}),Ht())},i(ee){U||(N(t.$$.fragment,ee),N(O),U=!0)},o(ee){G(t.$$.fragment,ee),G(O),U=!1},d(ee){ee&&H(e),he(t),O&&O.d()}}}function bv(r){let e,t,n,i,o,u;return e=new yr({props:{data:r[6](r[3]),$$slots:{default:[_z]},$$scope:{ctx:r}}}),n=new Cl({props:{lngLat:r[7](r[3]),$$slots:{default:[yz]},$$scope:{ctx:r}}}),o=new Cl({props:{lngLat:r[8](r[3]),$$slots:{default:[bz]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment)},m(a,d){de(e,a,d),W(a,t,d),de(n,a,d),W(a,i,d),de(o,a,d),u=!0},p(a,d){const m={};d&8&&(m.data=a[6](a[3])),d&8192&&(m.$$scope={dirty:d,ctx:a}),e.$set(m);const _={};d&8&&(_.lngLat=a[7](a[3])),d&8192&&(_.$$scope={dirty:d,ctx:a}),n.$set(_);const v={};d&8&&(v.lngLat=a[8](a[3])),d&8192&&(v.$$scope={dirty:d,ctx:a}),o.$set(v)},i(a){u||(N(e.$$.fragment,a),N(n.$$.fragment,a),N(o.$$.fragment,a),u=!0)},o(a){G(e.$$.fragment,a),G(n.$$.fragment,a),G(o.$$.fragment,a),u=!1},d(a){a&&(H(t),H(i)),he(e,a),he(n,a),he(o,a)}}}function _z(r){let e,t;const n=[sn("predict-impact"),{paint:{"line-width":Lo(["get","kind"],{focus:8},5),"line-color":Lo(["get","kind"],{focus:"black",before:"red",after:"blue"},"cyan"),"line-opacity":Lo(["get","kind"],{focus:1},.5)}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function yz(r){let e;return{c(){e=Te("A")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function bz(r){let e;return{c(){e=Te("B")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function vz(r){let e,t,n,i,o=r[2].length>0&&bv(r);return n=new na({props:{interactive:!1}}),{c(){e=q("div"),o&&o.c(),t=ae(),pe(n.$$.fragment),ce(e,"slot","map")},m(u,a){W(u,e,a),o&&o.m(e,null),z(e,t),de(n,e,null),i=!0},p(u,a){u[2].length>0?o?(o.p(u,a),a&4&&N(o,1)):(o=bv(u),o.c(),N(o,1),o.m(e,t)):o&&(Zt(),G(o,1,1,()=>{o=null}),Ht())},i(u){i||(N(o),N(n.$$.fragment,u),i=!0)},o(u){G(o),G(n.$$.fragment,u),i=!1},d(u){u&&H(e),o&&o.d(),he(n)}}}function wz(r){let e,t,n,i;return e=new qu({props:{loading:r[4]}}),n=new po({props:{$$slots:{map:[vz],sidebar:[gz],top:[mz]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(o,u){de(e,o,u),W(o,t,u),de(n,o,u),i=!0},p(o,[u]){const a={};u&16&&(a.loading=o[4]),e.$set(a);const d={};u&8239&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&H(t),he(e,o),he(n,o)}}}function xz(r,e,t){let n,i,o;rt(r,or,P=>t(5,n=P)),rt(r,og,P=>t(11,i=P)),rt(r,Cr,P=>t(12,o=P));let{road:u}=e,{prevPrevMode:a}=e,d=u.properties;d.kind="focus";let m=[],_=0,v="Finding changes to this road";Yo(async()=>{await sp(),t(2,m=o.getImpactsOnRoad(d.id,i)),t(4,v=""),m.length==0&&(window.alert("No routes over this road change. (This is a bug in progress of being fixed.)"),on(or,n={mode:"predict-impact",prevMode:a},n))});function S(P){return{type:"FeatureCollection",features:[m[P].before,m[P].after,u].filter(D=>D!=null)}}function T(P){return m[P].before!=null?m[P].before.geometry.coordinates[0]:m[P].after.geometry.coordinates[0]}function C(P){let D=m[P].before!=null?m[P].before.geometry.coordinates:m[P].after.geometry.coordinates;return D[D.length-1]}function L(P){_=P,t(3,_)}return r.$$set=P=>{"road"in P&&t(9,u=P.road),"prevPrevMode"in P&&t(0,a=P.prevPrevMode)},[a,d,m,_,v,n,S,T,C,u,L]}class Az extends kt{constructor(e){super(),St(this,e,xz,wz,gt,{road:9,prevPrevMode:0})}}function kz(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C=Mr(r[6].mode)+"",L,P;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),v=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),_=q("li"),pe(v.$$.fragment),S=ae(),T=q("li"),L=Te(C),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(D,I){W(D,e,I),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),z(n,_),de(v,_,null),z(n,S),z(n,T),z(T,L),P=!0},p(D,I){(!P||I&64)&&C!==(C=Mr(D[6].mode)+"")&&yt(L,C)},i(D){P||(N(o.$$.fragment,D),N(d.$$.fragment,D),N(v.$$.fragment,D),P=!0)},o(D){G(o.$$.fragment,D),G(d.$$.fragment,D),G(v.$$.fragment,D),P=!1},d(D){D&&H(e),he(o),he(d),he(v)}}}function Sz(r){let e;return{c(){e=q("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function Tz(r){let e;return{c(){e=q("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function Cz(r){let e,t=$a(r[4].properties.distance)+"",n,i,o=ja(r[4].properties.time)+"",u;return{c(){e=q("p"),n=Te(t),i=Te(", "),u=Te(o)},m(a,d){W(a,e,d),z(e,n),z(e,i),z(e,u)},p(a,d){d&16&&t!==(t=$a(a[4].properties.distance)+"")&&yt(n,t),d&16&&o!==(o=ja(a[4].properties.time)+"")&&yt(u,o)},d(a){a&&H(e)}}}function Mz(r){let e;return{c(){e=q("p"),e.textContent="Hover on a road to compare"},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function Ez(r){let e;return{c(){e=q("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function Iz(r){let e,t=$a(r[3].properties.distance)+"",n,i,o=ja(r[3].properties.time)+"",u;return{c(){e=q("p"),n=Te(t),i=Te(", "),u=Te(o)},m(a,d){W(a,e,d),z(e,n),z(e,i),z(e,u)},p(a,d){d&8&&t!==(t=$a(a[3].properties.distance)+"")&&yt(n,t),d&8&&o!==(o=ja(a[3].properties.time)+"")&&yt(u,o)},d(a){a&&H(e)}}}function Lz(r){let e,t,n,i,o,u,a,d,m,_,v;t=new Is({props:{mode:{mode:"neighbourhood"}}});function S(I,U){return I[4]?Cz:I[3]?Tz:Sz}let T=S(r),C=T(r);function L(I,U){return I[3]?Iz:I[4]?Ez:Mz}let P=L(r),D=P(r);return{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("p"),i.textContent=`This shows the change in driving time to one destination from everywhere
      within the neighbourhood. Drag the pin around to change that destination.`,o=ae(),u=q("u"),u.textContent="Route before changes",a=ae(),C.c(),d=ae(),m=q("u"),m.textContent="Route after changes",_=ae(),D.c(),Ze(u,"color","red"),Ze(m,"color","blue"),ce(e,"slot","sidebar")},m(I,U){W(I,e,U),de(t,e,null),z(e,n),z(e,i),z(e,o),z(e,u),z(e,a),C.m(e,null),z(e,d),z(e,m),z(e,_),D.m(e,null),v=!0},p(I,U){T===(T=S(I))&&C?C.p(I,U):(C.d(1),C=T(I),C&&(C.c(),C.m(e,d))),P===(P=L(I))&&D?D.p(I,U):(D.d(1),D=P(I),D&&(D.c(),D.m(e,null)))},i(I){v||(N(t.$$.fragment,I),v=!0)},o(I){G(t.$$.fragment,I),v=!1},d(I){I&&H(e),he(t),C.d(),D.d()}}}function Pz(r){let e,t;const n=[sn("cells"),{filter:["==",["get","kind"],"cell"]},{paint:{"fill-color":["get","color"],"fill-opacity":.6}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Zi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function zz(r){let e,t,n=(r[16].time_after/r[16].time_before).toFixed(1)+"",i;return{c(){e=q("p"),t=Te("Time ratio: "),i=Te(n)},m(o,u){W(o,e,u),z(e,t),z(e,i)},p(o,u){u&65536&&n!==(n=(o[16].time_after/o[16].time_before).toFixed(1)+"")&&yt(i,n)},d(o){o&&H(e)}}}function Dz(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[zz,({props:n})=>({16:n}),({props:n})=>n?65536:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&196608&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function Rz(r){let e,t,n;const i=[sn("interior-roads"),{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(r[5].highest_time_ratio,1.1),"red"],"line-width":5}},{manageHoverState:!0}];function o(a){r[10](a)}let u={$$slots:{default:[Dz]},$$scope:{ctx:r}};for(let a=0;a<i.length;a+=1)u=wt(u,i[a]);return r[0]!==void 0&&(u.hovered=r[0]),e=new gr({props:u}),wn.push(()=>On(e,"hovered",o)),e.$on("click",r[11]),{c(){pe(e.$$.fragment)},m(a,d){de(e,a,d),n=!0},p(a,d){const m=d&32?Tn(i,[i[0],{paint:{"line-color":["interpolate-hcl",["linear"],["/",["get","time_after"],["get","time_before"]],1,"white",Math.max(a[5].highest_time_ratio,1.1),"red"],"line-width":5}},i[2]]):{};d&131072&&(m.$$scope={dirty:d,ctx:a}),!t&&d&1&&(t=!0,m.hovered=a[0],Nn(()=>t=!1)),e.$set(m)},i(a){n||(N(e.$$.fragment,a),n=!0)},o(a){G(e.$$.fragment,a),n=!1},d(a){he(e,a)}}}function Bz(r){let e,t;const n=[sn("compare-route"),{interactive:!1},{paint:{"line-width":10,"line-color":Lo(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function Fz(r){let e;return{c(){e=Te("X")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function Oz(r){let e,t,n,i,o,u,a,d,m,_,v,S;t=new nc({props:{$$slots:{default:[Pz]},$$scope:{ctx:r}}}),i=new yr({props:{data:r[5],generateId:!0,$$slots:{default:[Rz]},$$scope:{ctx:r}}}),u=new yr({props:{data:r[1],$$slots:{default:[Bz]},$$scope:{ctx:r}}}),d=new na({props:{interactive:!1}});function T(L){r[12](L)}let C={draggable:!0,$$slots:{default:[Fz]},$$scope:{ctx:r}};return r[2]!==void 0&&(C.lngLat=r[2]),_=new Cl({props:C}),wn.push(()=>On(_,"lngLat",T)),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),pe(i.$$.fragment),o=ae(),pe(u.$$.fragment),a=ae(),pe(d.$$.fragment),m=ae(),pe(_.$$.fragment),ce(e,"slot","map")},m(L,P){W(L,e,P),de(t,e,null),z(e,n),de(i,e,null),z(e,o),de(u,e,null),z(e,a),de(d,e,null),z(e,m),de(_,e,null),S=!0},p(L,P){const D={};P&131072&&(D.$$scope={dirty:P,ctx:L}),t.$set(D);const I={};P&32&&(I.data=L[5]),P&131105&&(I.$$scope={dirty:P,ctx:L}),i.$set(I);const U={};P&2&&(U.data=L[1]),P&131072&&(U.$$scope={dirty:P,ctx:L}),u.$set(U);const O={};P&131072&&(O.$$scope={dirty:P,ctx:L}),!v&&P&4&&(v=!0,O.lngLat=L[2],Nn(()=>v=!1)),_.$set(O)},i(L){S||(N(t.$$.fragment,L),N(i.$$.fragment,L),N(u.$$.fragment,L),N(d.$$.fragment,L),N(_.$$.fragment,L),S=!0)},o(L){G(t.$$.fragment,L),G(i.$$.fragment,L),G(u.$$.fragment,L),G(d.$$.fragment,L),G(_.$$.fragment,L),S=!1},d(L){L&&H(e),he(t),he(i),he(u),he(d),he(_)}}}function Nz(r){let e,t,n,i;return e=new tp({}),e.$on("contextmenu",r[8]),n=new po({props:{$$slots:{map:[Oz],sidebar:[Lz],top:[kz]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(o,u){de(e,o,u),W(o,t,u),de(n,o,u),i=!0},p(o,[u]){const a={};u&131199&&(a.$$scope={dirty:u,ctx:o}),n.$set(a)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&H(t),he(e,o),he(n,o)}}}function $z(r,e,t){let n,i,o,u,a,d,m,_,v;rt(r,md,U=>t(2,a=U)),rt(r,or,U=>t(6,d=U)),rt(r,Bf,U=>t(13,m=U)),rt(r,Rf,U=>t(14,_=U)),rt(r,Cr,U=>t(9,v=U));let S=null;Yo(()=>{setTimeout(()=>{a&&ag(md)},10)});function T(U){return U?v.compareRoute(new Sl.LngLat(U.properties.pt1_x,U.properties.pt1_y),a,1):ii()}function C(U){on(Rf,_=new Sl.LngLat(U.properties.pt1_x,U.properties.pt1_y),_),on(Bf,m=a,m),on(or,d={mode:"route",prevMode:"impact-one-destination"},d)}function L(U){on(md,a=U.detail.lngLat,a)}function P(U){S=U,t(0,S)}const D=U=>C(U.detail.features[0]);function I(U){a=U,md.set(a)}return r.$$.update=()=>{r.$$.dirty&516&&t(5,n=v.impactToOneDestination(a)),r.$$.dirty&1&&t(1,i=T(S)),r.$$.dirty&2&&t(4,o=i.features.find(U=>U.properties.kind=="before")),r.$$.dirty&2&&t(3,u=i.features.find(U=>U.properties.kind=="after"))},[S,i,a,u,o,n,d,C,L,v,P,D,I]}class jz extends kt{constructor(e){super(),St(this,e,$z,Nz,gt,{})}}function vv(r,e,t){const n=r.slice();return n[19]=e[t],n}function wv(r){let e,t,n,i,o,u,a,d,m,_;n=new V3({});let v=zn(r[2]),S=[];for(let C=0;C<v.length;C+=1)S[C]=xv(vv(r,v,C));const T=C=>G(S[C],1,1,()=>{S[C]=null});return{c(){e=q("details"),t=q("summary"),pe(n.$$.fragment),i=ae(),o=q("span"),o.textContent="Open another project",u=ae(),a=q("ul");for(let C=0;C<S.length;C+=1)S[C].c();Ze(o,"margin-left","2px"),ce(t,"role","button"),ce(t,"class","contrast outline"),ce(e,"class","dropdown"),Ze(e,"display","inline-block"),Ze(e,"margin-top","8px")},m(C,L){W(C,e,L),z(e,t),de(n,t,null),z(t,i),z(t,o),z(e,u),z(e,a);for(let P=0;P<S.length;P+=1)S[P]&&S[P].m(a,null);e.open=r[1],d=!0,m||(_=_t(e,"toggle",r[14]),m=!0)},p(C,L){if(L&260){v=zn(C[2]);let P;for(P=0;P<v.length;P+=1){const D=vv(C,v,P);S[P]?(S[P].p(D,L),N(S[P],1)):(S[P]=xv(D),S[P].c(),N(S[P],1),S[P].m(a,null))}for(Zt(),P=v.length;P<S.length;P+=1)T(P);Ht()}L&2&&(e.open=C[1])},i(C){if(!d){N(n.$$.fragment,C);for(let L=0;L<v.length;L+=1)N(S[L]);d=!0}},o(C){G(n.$$.fragment,C),S=S.filter(Boolean);for(let L=0;L<S.length;L+=1)G(S[L]);d=!1},d(C){C&&H(e),he(n),Jr(S,C),m=!1,_()}}}function Uz(r){let e=r[19].projectName+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i&4&&e!==(e=n[19].projectName+"")&&yt(t,e)},d(n){n&&H(t)}}}function xv(r){let e,t,n,i;function o(){return r[13](r[19])}return t=new nh({props:{$$slots:{default:[Uz]},$$scope:{ctx:r}}}),t.$on("click",o),{c(){e=q("li"),pe(t.$$.fragment),n=ae()},m(u,a){W(u,e,a),de(t,e,null),z(e,n),i=!0},p(u,a){r=u;const d={};a&4194308&&(d.$$scope={dirty:a,ctx:r}),t.$set(d)},i(u){i||(N(t.$$.fragment,u),i=!0)},o(u){G(t.$$.fragment,u),i=!1},d(u){u&&H(e),he(t)}}}function Vz(r){let e,t,n,i,o;return i=new ec({props:{$$slots:{default:[qz]},$$scope:{ctx:r}}}),{c(){e=q("div"),t=q("i"),t.textContent=`Map data is from ${r[6].toDateString()}`,n=ae(),pe(i.$$.fragment),Ze(e,"display","flex")},m(u,a){W(u,e,a),z(e,t),z(e,n),de(i,e,null),o=!0},p(u,a){const d={};a&4194304&&(d.$$scope={dirty:a,ctx:u}),i.$set(d)},i(u){o||(N(i.$$.fragment,u),o=!0)},o(u){G(i.$$.fragment,u),o=!1},d(u){u&&H(e),he(i)}}}function qz(r){let e;return{c(){e=q("p"),e.innerHTML='If this area has changed since then, please contact <a href="mailto:dabreegster@gmail.com">dabreegster@gmail.com</a> to use newer OpenStreetMap data.'},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function Av(r){let e,t,n;return{c(){e=q("button"),e.textContent="Debug route-snapper",ce(e,"class","secondary")},m(i,o){W(i,e,o),t||(n=_t(e,"click",r[9]),t=!0)},p:ht,d(i){i&&H(e),t=!1,n()}}}function Gz(r){let e,t,n=cr(r[4]).project_name+"",i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U=cr(r[4]).study_area_name&&r[2].length>0,O,ee,X=r[3].modalFilters+"",ue,$,Q,ne,F=r[3].deletedModalFilters+"",Z,J,be,ke,ge=r[3].travelFlows+"",ve,fe,Pe,Ee,Fe,ot,ct,it;m=new uw({}),L=new lw({});let at=U&&wv(r),ft=r[6]&&Vz(r),Ct=r[5]&&Av(r);return{c(){e=q("h2"),t=Te("Project: "),i=Te(n),o=ae(),u=q("div"),a=q("button"),d=q("div"),pe(m.$$.fragment),_=ae(),v=q("span"),v.textContent="Export",S=ae(),T=q("button"),C=q("div"),pe(L.$$.fragment),P=ae(),D=q("span"),D.textContent="Copy project",I=ae(),at&&at.c(),O=ae(),ee=q("p"),ue=Te(X),$=Te(" new modal filter(s) added"),Q=ae(),ne=q("p"),Z=Te(F),J=Te(`
  existing modal filter(s) removed`),be=ae(),ke=q("p"),ve=Te(ge),fe=Te(" road segment direction(s) changed"),Pe=ae(),ft&&ft.c(),Ee=ae(),Ct&&Ct.c(),Fe=rr(),Ze(v,"margin-right","2px"),Ze(d,"display","flex"),Ze(d,"align-items","center"),Ze(d,"gap","8px"),Ze(d,"color","black"),ce(a,"class","outline"),Ze(a,"margin-right","8px"),ce(a,"title","Download project as GeoJSON"),Ze(D,"margin-right","2px"),Ze(C,"display","flex"),Ze(C,"align-items","center"),Ze(C,"gap","8px"),Ze(C,"color","black"),ce(T,"class","outline"),Ze(T,"margin-right","8px"),ce(T,"title","Make a copy of this project"),Ze(u,"display","flex"),Ze(u,"gap","8px")},m(xt,It){W(xt,e,It),z(e,t),z(e,i),W(xt,o,It),W(xt,u,It),z(u,a),z(a,d),de(m,d,null),z(d,_),z(d,v),z(u,S),z(u,T),z(T,C),de(L,C,null),z(C,P),z(C,D),W(xt,I,It),at&&at.m(xt,It),W(xt,O,It),W(xt,ee,It),z(ee,ue),z(ee,$),W(xt,Q,It),W(xt,ne,It),z(ne,Z),z(ne,J),W(xt,be,It),W(xt,ke,It),z(ke,ve),z(ke,fe),W(xt,Pe,It),ft&&ft.m(xt,It),W(xt,Ee,It),Ct&&Ct.m(xt,It),W(xt,Fe,It),ot=!0,ct||(it=[_t(a,"click",r[11]),_t(T,"click",r[12])],ct=!0)},p(xt,[It]){(!ot||It&16)&&n!==(n=cr(xt[4]).project_name+"")&&yt(i,n),It&20&&(U=cr(xt[4]).study_area_name&&xt[2].length>0),U?at?(at.p(xt,It),It&20&&N(at,1)):(at=wv(xt),at.c(),N(at,1),at.m(O.parentNode,O)):at&&(Zt(),G(at,1,1,()=>{at=null}),Ht()),(!ot||It&8)&&X!==(X=xt[3].modalFilters+"")&&yt(ue,X),(!ot||It&8)&&F!==(F=xt[3].deletedModalFilters+"")&&yt(Z,F),(!ot||It&8)&&ge!==(ge=xt[3].travelFlows+"")&&yt(ve,ge),xt[6]&&ft.p(xt,It),xt[5]?Ct?Ct.p(xt,It):(Ct=Av(xt),Ct.c(),Ct.m(Fe.parentNode,Fe)):Ct&&(Ct.d(1),Ct=null)},i(xt){ot||(N(m.$$.fragment,xt),N(L.$$.fragment,xt),N(at),N(ft),ot=!0)},o(xt){G(m.$$.fragment,xt),G(L.$$.fragment,xt),G(at),G(ft),ot=!1},d(xt){xt&&(H(e),H(o),H(u),H(I),H(O),H(ee),H(Q),H(ne),H(be),H(ke),H(Pe),H(Ee),H(Fe)),he(m),he(L),at&&at.d(xt),ft&&ft.d(xt),Ct&&Ct.d(xt),ct=!1,Er(it)}}}function Zz(r){let e=0,t=0,n=0;for(let i of r.features)i.properties.kind=="modal_filter"?e++:i.properties.kind=="deleted_existing_modal_filter"?t++:i.properties.kind=="travel_flow"&&n++;return{modalFilters:e,deletedModalFilters:t,travelFlows:n}}function Hz(r,e,t){let n,i,o,u,a,d,m,_;rt(r,Cr,X=>t(15,o=X)),rt(r,ri,X=>t(16,u=X)),rt(r,zo,X=>t(0,a=X)),rt(r,ta,X=>t(17,d=X)),rt(r,y2,X=>t(4,m=X)),rt(r,jf,X=>t(5,_=X));let{projectGj:v}=e,S=!1,T=o.getOsmTimestamp();function C(X){for(let[ue,$]of d.studyAreaProjects())if(ue==m.study_area_name)return $.filter(Q=>Q.projectID!=X);return[]}function L(){let X=m.project_name,ue=window.prompt(`Please name this copy of project ${X}`,d.nextAvailableProjectName(X));if(ue)try{let $=d.copyProject(a,ue);on(zo,a=$,a),o.changeProjectName(ue);let Q=new URL(window.location.href);Q.searchParams.set("project",$),window.history.replaceState(null,"",Q.toString()),window.alert(`Done, you are now working on project ${ue}`)}catch($){window.alert(`Couldn't copy project: ${$}`)}}function P(X){t(1,S=!1);let ue=d.project(X);o.loadSavefile(ue),on(zo,a=X,a),on(ri,u++,u);let $=new URL(window.location.href);$.searchParams.set("project",X),window.history.replaceState(null,"",$.toString())}function D(){np("debug_route_snapper.geojson",o.toRouteSnapperGj())}const I=()=>A2(cr(a)),U=()=>L(),O=X=>P(X.projectID);function ee(){S=this.open,t(1,S)}return r.$$set=X=>{"projectGj"in X&&t(10,v=X.projectGj)},r.$$.update=()=>{r.$$.dirty&1024&&t(3,n=Zz(v)),r.$$.dirty&1&&t(2,i=C(cr(a)))},[a,S,i,n,m,_,T,L,P,D,v,I,U,O,ee]}class Wz extends kt{constructor(e){super(),St(this,e,Hz,Gz,gt,{projectGj:10})}}function kv(r,e,t){const n=r.slice();return n[27]=e[t].properties.name,n}function Sv(r){let e=Mr(r[5].mode)+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i&32&&e!==(e=Mr(n[5].mode)+"")&&yt(t,e)},d(n){n&&H(t)}}}function Tv(r){let e,t,n;return t=new jn({props:{mode:{mode:"debug-intersections"}}}),{c(){e=q("li"),pe(t.$$.fragment)},m(i,o){W(i,e,o),de(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function Xz(r){let e,t,n,i,o,u,a,d=r[7],m,_,v,S,T,C,L,P,D,I;o=new jn({props:{mode:{mode:"title"}}});let U=Sv(r);T=new jn({props:{mode:{mode:"route",prevMode:"pick-neighbourhood"}}}),P=new jn({props:{mode:{mode:"predict-impact",prevMode:"pick-neighbourhood"}}});let O=r[8]&&Tv();return{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),U.c(),m=ae(),_=q("nav"),v=q("ul"),S=q("li"),pe(T.$$.fragment),C=ae(),L=q("li"),pe(P.$$.fragment),D=ae(),O&&O.c(),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top"),Ze(e,"display","flex"),Ze(e,"justify-content","space-between")},m(ee,X){W(ee,e,X),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),U.m(a,null),z(e,m),z(e,_),z(_,v),z(v,S),de(T,S,null),z(v,C),z(v,L),de(P,L,null),z(v,D),O&&O.m(v,null),I=!0},p(ee,X){X&128&&gt(d,d=ee[7])?(U.d(1),U=Sv(ee),U.c(),U.m(a,null)):U.p(ee,X),ee[8]?O?X&256&&N(O,1):(O=Tv(),O.c(),N(O,1),O.m(v,null)):O&&(Zt(),G(O,1,1,()=>{O=null}),Ht())},i(ee){I||(N(o.$$.fragment,ee),N(T.$$.fragment,ee),N(P.$$.fragment,ee),N(O),I=!0)},o(ee){G(o.$$.fragment,ee),G(T.$$.fragment,ee),G(P.$$.fragment,ee),G(O),I=!1},d(ee){ee&&H(e),he(o),U.d(ee),he(T),he(P),O&&O.d()}}}function Jz(r){let e=r[27]+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i&1&&e!==(e=n[27]+"")&&yt(t,e)},d(n){n&&H(t)}}}function Cv(r){let e,t,n,i,o,u,a,d,m,_,v,S,T;function C(){return r[18](r[27])}n=new nh({props:{$$slots:{default:[Jz]},$$scope:{ctx:r}}}),n.$on("click",C),a=new zg({props:{color:"black"}});function L(){return r[19](r[27])}_=new ep({props:{color:"white"}});function P(){return r[20](r[27])}function D(){return r[21](r[27])}return{c(){var I;e=q("li"),t=q("h3"),pe(n.$$.fragment),i=ae(),o=q("span"),u=q("button"),pe(a.$$.fragment),d=ae(),m=q("button"),pe(_.$$.fragment),ce(u,"class","outline icon-btn"),ce(u,"title","Rename neighbourhood"),ce(m,"class","icon-btn destructive"),ce(m,"title","Delete neighbourhood"),ce(o,"class","actions"),ce(e,"class","actionable-cell svelte-qhjp0j"),Nt(e,"highlighted",((I=r[4])==null?void 0:I.properties.name)==r[27]||r[3]==r[27])},m(I,U){W(I,e,U),z(e,t),de(n,t,null),z(e,i),z(e,o),z(o,u),de(a,u,null),z(o,d),z(o,m),de(_,m,null),v=!0,S||(T=[_t(u,"click",L),_t(m,"click",P),_t(e,"mouseenter",D),_t(e,"mouseleave",r[22])],S=!0)},p(I,U){var ee;r=I;const O={};U&1073741825&&(O.$$scope={dirty:U,ctx:r}),n.$set(O),(!v||U&25)&&Nt(e,"highlighted",((ee=r[4])==null?void 0:ee.properties.name)==r[27]||r[3]==r[27])},i(I){v||(N(n.$$.fragment,I),N(a.$$.fragment,I),N(_.$$.fragment,I),v=!0)},o(I){G(n.$$.fragment,I),G(a.$$.fragment,I),G(_.$$.fragment,I),v=!1},d(I){I&&H(e),he(n),he(a),he(_),S=!1,Er(T)}}}function Kz(r){let e,t,n;return e=new y3({}),{c(){pe(e.$$.fragment),t=Te(`
          Add a new neighbourhood`)},m(i,o){de(e,i,o),W(i,t,o),n=!0},i(i){n||(N(e.$$.fragment,i),n=!0)},o(i){G(e.$$.fragment,i),n=!1},d(i){i&&H(t),he(e,i)}}}function Mv(r){let e,t,n,i,o,u,a,d,m;function _(S){r[23](S)}let v={};return r[2]!==void 0&&(v.selectedPrioritization=r[2]),o=new G2({props:v}),wn.push(()=>On(o,"selectedPrioritization",_)),{c(){e=q("h3"),e.textContent="Prioritisation",t=ae(),n=q("p"),n.textContent=`Compare the prioritisation or individual metrics across your
        neighbourhoods.`,i=ae(),pe(o.$$.fragment),a=ae(),d=q("hr")},m(S,T){W(S,e,T),W(S,t,T),W(S,n,T),W(S,i,T),de(o,S,T),W(S,a,T),W(S,d,T),m=!0},p(S,T){const C={};!u&&T&4&&(u=!0,C.selectedPrioritization=S[2],Nn(()=>u=!1)),o.$set(C)},i(S){m||(N(o.$$.fragment,S),m=!0)},o(S){G(o.$$.fragment,S),m=!1},d(S){S&&(H(e),H(t),H(n),H(i),H(a),H(d)),he(o,S)}}}function Yz(r){let e,t,n,i,o,u,a,d,m,_,v,S=zn(r[0].features),T=[];for(let P=0;P<S.length;P+=1)T[P]=Cv(kv(r,S,P));const C=P=>G(T[P],1,1,()=>{T[P]=null});a=new jn({props:{mode:{mode:"add-neighbourhood"},$$slots:{default:[Kz]},$$scope:{ctx:r}}});let L=r[6]=="cnt"&&Mv(r);return _=new Wz({props:{projectGj:r[1]}}),{c(){e=q("div"),t=q("h2"),t.textContent="Neighbourhoods",n=ae(),i=q("ul");for(let P=0;P<T.length;P+=1)T[P].c();o=ae(),u=q("li"),pe(a.$$.fragment),d=ae(),L&&L.c(),m=ae(),pe(_.$$.fragment),ce(i,"class","navigable-list"),ce(e,"slot","sidebar")},m(P,D){W(P,e,D),z(e,t),z(e,n),z(e,i);for(let I=0;I<T.length;I+=1)T[I]&&T[I].m(i,null);z(i,o),z(i,u),de(a,u,null),z(e,d),L&&L.m(e,null),z(e,m),de(_,e,null),v=!0},p(P,D){if(D&3609){S=zn(P[0].features);let O;for(O=0;O<S.length;O+=1){const ee=kv(P,S,O);T[O]?(T[O].p(ee,D),N(T[O],1)):(T[O]=Cv(ee),T[O].c(),N(T[O],1),T[O].m(i,o))}for(Zt(),O=S.length;O<T.length;O+=1)C(O);Ht()}const I={};D&1073741824&&(I.$$scope={dirty:D,ctx:P}),a.$set(I),P[6]=="cnt"?L?(L.p(P,D),D&64&&N(L,1)):(L=Mv(P),L.c(),N(L,1),L.m(e,m)):L&&(Zt(),G(L,1,1,()=>{L=null}),Ht());const U={};D&2&&(U.projectGj=P[1]),_.$set(U)},i(P){if(!v){for(let D=0;D<S.length;D+=1)N(T[D]);N(a.$$.fragment,P),N(L),N(_.$$.fragment,P),v=!0}},o(P){T=T.filter(Boolean);for(let D=0;D<T.length;D+=1)G(T[D]);G(a.$$.fragment,P),G(L),G(_.$$.fragment,P),v=!1},d(P){P&&H(e),Jr(T,P),he(a),L&&L.d(),he(_)}}}function Qz(r){let e,t,n=(r[26].number_pois/r[26].area_km2).toFixed(1)+"",i,o;return{c(){e=q("b"),e.textContent="Points of interest:",t=ae(),i=Te(n),o=Te(" / km")},m(u,a){W(u,e,a),W(u,t,a),W(u,i,a),W(u,o,a)},p(u,a){a&67108864&&n!==(n=(u[26].number_pois/u[26].area_km2).toFixed(1)+"")&&yt(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function e7(r){let e,t,n=(r[26].number_stats19_collisions/r[26].area_km2).toFixed(1)+"",i,o;return{c(){e=q("b"),e.textContent="Pedestrian and cyclist collisions:",t=ae(),i=Te(n),o=Te(" / km")},m(u,a){W(u,e,a),W(u,t,a),W(u,i,a),W(u,o,a)},p(u,a){a&67108864&&n!==(n=(u[26].number_stats19_collisions/u[26].area_km2).toFixed(1)+"")&&yt(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function t7(r){let e,t,n=Math.round(r[26].population/r[26].area_km2).toLocaleString()+"",i,o;return{c(){e=q("b"),e.textContent="Population density:",t=ae(),i=Te(n),o=Te(` people
            / km`)},m(u,a){W(u,e,a),W(u,t,a),W(u,i,a),W(u,o,a)},p(u,a){a&67108864&&n!==(n=Math.round(u[26].population/u[26].area_km2).toLocaleString()+"")&&yt(i,n)},d(u){u&&(H(e),H(t),H(i),H(o))}}}function n7(r){let e,t=r[26].name+"",n,i,o;function u(m,_){if(m[2]=="population_density")return t7;if(m[2]=="stats19")return e7;if(m[2]=="pois")return Qz}let a=u(r),d=a&&a(r);return{c(){e=q("h2"),n=Te(t),i=ae(),d&&d.c(),o=rr()},m(m,_){W(m,e,_),z(e,n),W(m,i,_),d&&d.m(m,_),W(m,o,_)},p(m,_){_&67108864&&t!==(t=m[26].name+"")&&yt(n,t),a===(a=u(m))&&d?d.p(m,_):(d&&d.d(1),d=a&&a(m),d&&(d.c(),d.m(o.parentNode,o)))},d(m){m&&(H(e),H(i),H(o)),d&&d.d(m)}}}function r7(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[n7,({props:n})=>({26:n}),({props:n})=>n?67108864:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&1140850692&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function i7(r){let e,t,n,i,o,u,a,d,m;e=new a4({props:{data:r[3]?[{name:r[3],highlight:"yes"}]:[],idCol:"name"}});const _=[{filter:["==",["get","kind"],"boundary"]},sn("neighbourhood-boundaries-selected-outline",!1),{manageHoverState:!1},{paint:{"line-color":"black","line-width":4,"line-dasharray":[2,2]}}];let v={};for(let D=0;D<_.length;D+=1)v=wt(v,_[D]);n=new gr({props:v});const S=[{filter:["==",["get","kind"],"boundary"]},sn("neighbourhood-boundaries-selected-outline-base",!1),{manageHoverState:!1},{paint:{"line-color":"white","line-width":8,"line-opacity":.7}}];let T={};for(let D=0;D<S.length;D+=1)T=wt(T,S[D]);o=new gr({props:T});const C=[sn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":r[12](r[2]),"fill-opacity":r[13](r[2])}},{manageHoverState:!0},{hoverCursor:"pointer"}];function L(D){r[16](D)}let P={$$slots:{default:[r7]},$$scope:{ctx:r}};for(let D=0;D<C.length;D+=1)P=wt(P,C[D]);return r[4]!==void 0&&(P.hovered=r[4]),a=new Zi({props:P}),wn.push(()=>On(a,"hovered",L)),a.$on("click",r[17]),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment)},m(D,I){de(e,D,I),W(D,t,I),de(n,D,I),W(D,i,I),de(o,D,I),W(D,u,I),de(a,D,I),m=!0},p(D,I){const U={};I&8&&(U.data=D[3]?[{name:D[3],highlight:"yes"}]:[]),e.$set(U);const O={};n.$set(O);const ee={};o.$set(ee);const X=I&12292?Tn(C,[C[0],C[1],{paint:{"fill-color":D[12](D[2]),"fill-opacity":D[13](D[2])}},C[3],C[4]]):{};I&1073741828&&(X.$$scope={dirty:I,ctx:D}),!d&&I&16&&(d=!0,X.hovered=D[4],Nn(()=>d=!1)),a.$set(X)},i(D){m||(N(e.$$.fragment,D),N(n.$$.fragment,D),N(o.$$.fragment,D),N(a.$$.fragment,D),m=!0)},o(D){G(e.$$.fragment,D),G(n.$$.fragment,D),G(o.$$.fragment,D),G(a.$$.fragment,D),m=!1},d(D){D&&(H(t),H(i),H(u)),he(e,D),he(n,D),he(o,D),he(a,D)}}}function o7(r){let e,t,n,i,o;return t=new yr({props:{data:r[0],promoteId:"name",$$slots:{default:[i7]},$$scope:{ctx:r}}}),i=new na({props:{interactive:!1}}),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),pe(i.$$.fragment),ce(e,"slot","map")},m(u,a){W(u,e,a),de(t,e,null),z(e,n),de(i,e,null),o=!0},p(u,a){const d={};a&1&&(d.data=u[0]),a&1073741852&&(d.$$scope={dirty:a,ctx:u}),t.$set(d)},i(u){o||(N(t.$$.fragment,u),N(i.$$.fragment,u),o=!0)},o(u){G(t.$$.fragment,u),G(i.$$.fragment,u),o=!1},d(u){u&&H(e),he(t),he(i)}}}function s7(r){let e,t;return e=new po({props:{$$slots:{map:[o7],sidebar:[Yz],top:[Xz]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&1073742335&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function a7(r,e,t){let n,i,o,u,a,d,m,_,v,S;rt(r,Qu,J=>t(24,o=J)),rt(r,ri,J=>t(14,u=J)),rt(r,Ba,J=>t(25,a=J)),rt(r,Cr,J=>t(15,d=J)),rt(r,or,J=>t(5,m=J)),rt(r,Bo,J=>t(6,_=J)),rt(r,zo,J=>t(7,v=J)),rt(r,jf,J=>t(8,S=J));let T=_=="cnt"?"combined":"none",C=null,L=null;on(Ba,a=void 0,a);function P(J){d.setCurrentNeighbourhood(J),on(Ba,a=J,a),on(or,m={mode:"neighbourhood"},m)}function D(J){window.confirm(`Really delete neighbourhood ${J}? You can't undo this.`)&&(d.deleteNeighbourhoodBoundary(J),console.assert(!Ba),Uf(),on(ri,u++,u))}function I(J){let be=q2(d,`Rename neighbourhood ${J} to what?`,J);be&&(d.renameNeighbourhoodBoundary(J,be),on(Ba,a=be,a),Uf(),on(ri,u++,u))}function U(J){let be=co.mapFeature.hover.backgroundColor,ke=Z2({none:be},J,o);return["case",["==",["feature-state","highlight"],"yes"],be,ke]}function O(J){let be=.7;return{none:["case",["==",["feature-state","highlight"],"yes"],be,nr(.3,be)],area:nr(.7,.9),population_density:nr(.7,.9),simd:nr(.7,.9),stats19:nr(.7,.9),pois:nr(.7,.9),car_ownership:nr(.7,.9),combined:nr(.7,.9)}[J]}function ee(J){L=J,t(4,L)}const X=J=>P(cr(J.detail.features[0].properties).name),ue=J=>P(J),$=J=>I(J),Q=J=>D(J),ne=J=>t(3,C=J),F=()=>t(3,C=null);function Z(J){T=J,t(2,T)}return r.$$.update=()=>{r.$$.dirty&49152&&t(1,n=u>0?d.toSavefile():ii()),r.$$.dirty&2&&t(0,i={type:"FeatureCollection",features:n.features.filter(J=>J.properties.kind=="boundary")}),r.$$.dirty&1&&i.features.length==0&&on(or,m={mode:"add-neighbourhood"},m)},[i,n,T,C,L,m,_,v,S,P,D,I,U,O,u,d,ee,X,ue,$,Q,ne,F,Z]}class l7 extends kt{constructor(e){super(),St(this,e,a7,s7,gt,{})}}function Ev(r){let e,t,n;return t=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=q("li"),pe(t.$$.fragment)},m(i,o){W(i,e,o),de(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function u7(r){let e,t,n,i,o,u,a,d,m,_,v,S=Mr(r[4].mode)+"",T,C;o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}});let L=r[0]=="neighbourhood"&&Ev();return{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),L&&L.c(),_=ae(),v=q("li"),T=Te(S),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(P,D){W(P,e,D),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),L&&L.m(n,null),z(n,_),z(n,v),z(v,T),C=!0},p(P,D){P[0]=="neighbourhood"?L?D&1&&N(L,1):(L=Ev(),L.c(),N(L,1),L.m(n,_)):L&&(Zt(),G(L,1,1,()=>{L=null}),Ht()),(!C||D&16)&&S!==(S=Mr(P[4].mode)+"")&&yt(T,S)},i(P){C||(N(o.$$.fragment,P),N(d.$$.fragment,P),N(L),C=!0)},o(P){G(o.$$.fragment,P),G(d.$$.fragment,P),G(L),C=!1},d(P){P&&H(e),he(o),he(d),L&&L.d()}}}function c7(r){let e;return{c(){e=Te("Explore the origin/destination demand data used")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function f7(r){let e,t,n,i;return n=new ec({props:{$$slots:{default:[p7]},$$scope:{ctx:r}}}),{c(){e=q("b"),e.textContent="About the fake origin/destination data",t=ae(),pe(n.$$.fragment)},m(o,u){W(o,e,u),W(o,t,u),de(n,o,u),i=!0},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){G(n.$$.fragment,o),i=!1},d(o){o&&(H(e),H(t)),he(n,o)}}}function h7(r){let e,t,n,i;return n=new ec({props:{$$slots:{default:[m7]},$$scope:{ctx:r}}}),{c(){e=q("span"),e.textContent="About the 2021 home to work data",t=ae(),pe(n.$$.fragment)},m(o,u){W(o,e,u),W(o,t,u),de(n,o,u),i=!0},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){G(n.$$.fragment,o),i=!1},d(o){o&&(H(e),H(t)),he(n,o)}}}function d7(r){let e,t,n,i;return n=new ec({props:{$$slots:{default:[g7]},$$scope:{ctx:r}}}),{c(){e=q("span"),e.textContent="About the 2011 home to work data",t=ae(),pe(n.$$.fragment)},m(o,u){W(o,e,u),W(o,t,u),de(n,o,u),i=!0},i(o){i||(N(n.$$.fragment,o),i=!0)},o(o){G(n.$$.fragment,o),i=!1},d(o){o&&(H(e),H(t)),he(n,o)}}}function p7(r){let e;return{c(){e=q("p"),e.innerHTML=`This region has no available origin/destination data about travel
            patterns, so a <b>completely random</b> small set of trips are
            modelled. Contact Dustin at
            <a href="mailto:dabreegster@gmail.com">dabreegster@gmail.com</a> to set
            up real data in your region.`},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function m7(r){let e;return{c(){e=q("p"),e.innerHTML=`This region uses the <a href="https://www.nomisweb.co.uk/sources/census_2021_od" target="_blank">ODWP01EW</a>
            census dataset, with trips from home to work. It was taken during COVID-19,
            so
            <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/methodologies/userguidetocensus2021origindestinationdataenglandandwales" target="_blank">workplace travel patterns have major caveats</a>. Trips to work are just one purpose, representing a small percent
            of all trips and with strong spatial biases. This dataset does not
            distinguish by trip mode, so trips could be made by driving, public
            transit, cycling, walking, etc.`},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function g7(r){let e;return{c(){e=q("p"),e.innerHTML=`This region uses preprocessed census data from the <a href="https://nptscot.github.io/data/" target="_blank">NPT project</a>. The data is very outdated. Trips to work are just one purpose,
            representing a small percent of all trips and with strong spatial
            biases.`},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function _7(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U,O,ee,X,ue,$,Q,ne,F,Z,J,be,ke,ge,ve;t=new Is({props:{mode:{mode:r[0]}}}),u=new jn({props:{mode:{mode:"debug-demand"},$$slots:{default:[c7]},$$scope:{ctx:r}}});const fe=[d7,h7,f7],Pe=[];function Ee(Fe,ot){return Fe[6]=="cnt"?0:Fe[6]=="england"?1:2}return m=Ee(r),_=Pe[m]=fe[m](r),J=new Qi({props:{colorScale:r[7],labels:{limits:["0%","50%","same","150%","200%"]}}}),ke=Ig(r[14][0]),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("p"),o=Te(`This mode estimates the impact of all your changes on traffic around the
      entire area. It's based on many assumptions and must be interpreted very
      carefully. `),pe(u.$$.fragment),a=ae(),d=q("div"),_.c(),v=ae(),S=q("hr"),T=ae(),C=q("fieldset"),L=q("label"),P=q("input"),D=Te(`
        Calculate quickly`),I=ae(),U=q("label"),O=q("input"),ee=Te(`
        Calculate more accurately`),X=ae(),ue=q("p"),ue.textContent=`Red roads have increased traffic, and green roads have decreased. Thicker
      roads have more traffic after edits. If hovering on a road doesn't show
      anything, there was no change there. Click a road to see example routes
      through it that've changed.`,$=ae(),Q=q("label"),ne=Te(`Only show roads with at least this many daily trips before or after
      `),F=q("input"),Z=ae(),pe(J.$$.fragment),Ze(d,"display","flex"),ce(P,"type","radio"),P.__value="fast",Gn(P,P.__value),ce(O,"type","radio"),O.__value="accurate",Gn(O,O.__value),ce(F,"type","number"),ce(F,"min",0),ce(e,"slot","sidebar"),ke.p(P,O)},m(Fe,ot){W(Fe,e,ot),de(t,e,null),z(e,n),z(e,i),z(i,o),de(u,i,null),z(e,a),z(e,d),Pe[m].m(d,null),z(e,v),z(e,S),z(e,T),z(e,C),z(C,L),z(L,P),P.checked=P.__value===r[3],z(L,D),z(C,I),z(C,U),z(U,O),O.checked=O.__value===r[3],z(U,ee),z(e,X),z(e,ue),z(e,$),z(e,Q),z(Q,ne),z(Q,F),Gn(F,r[5]),z(e,Z),de(J,e,null),be=!0,ge||(ve=[_t(P,"change",r[13]),_t(P,"change",r[10]),_t(O,"change",r[15]),_t(O,"change",r[10]),_t(F,"input",r[16])],ge=!0)},p(Fe,ot){const ct={};ot&1&&(ct.mode={mode:Fe[0]}),t.$set(ct);const it={};ot&1048576&&(it.$$scope={dirty:ot,ctx:Fe}),u.$set(it);let at=m;m=Ee(Fe),m!==at&&(Zt(),G(Pe[at],1,1,()=>{Pe[at]=null}),Ht(),_=Pe[m],_||(_=Pe[m]=fe[m](Fe),_.c()),N(_,1),_.m(d,null)),ot&8&&(P.checked=P.__value===Fe[3]),ot&8&&(O.checked=O.__value===Fe[3]),ot&32&&kl(F.value)!==Fe[5]&&Gn(F,Fe[5])},i(Fe){be||(N(t.$$.fragment,Fe),N(u.$$.fragment,Fe),N(_),N(J.$$.fragment,Fe),be=!0)},o(Fe){G(t.$$.fragment,Fe),G(u.$$.fragment,Fe),G(_),G(J.$$.fragment,Fe),be=!1},d(Fe){Fe&&H(e),he(t),he(u),Pe[m].d(),he(J),ke.r(),ge=!1,Er(ve)}}}function y7(r){let e,t;const n=[sn("neighbourhood-boundaries",!1),{filter:["==",["get","kind"],"boundary"]},{paint:{"fill-color":"grey","fill-opacity":.5}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Zi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function b7(r){let e,t=r[19].before.toLocaleString()+"",n,i,o=r[19].after.toLocaleString()+"",u,a,d,m,_=Math.round(100*r[19].after/r[19].before)+"",v,S;return{c(){e=q("p"),n=Te(t),i=Te(" before, "),u=Te(o),a=Te(`
            after`),d=ae(),m=q("p"),v=Te(_),S=Te("%")},m(T,C){W(T,e,C),z(e,n),z(e,i),z(e,u),z(e,a),W(T,d,C),W(T,m,C),z(m,v),z(m,S)},p(T,C){C&524288&&t!==(t=T[19].before.toLocaleString()+"")&&yt(n,t),C&524288&&o!==(o=T[19].after.toLocaleString()+"")&&yt(u,o),C&524288&&_!==(_=Math.round(100*T[19].after/T[19].before)+"")&&yt(v,_)},d(T){T&&(H(e),H(d),H(m))}}}function v7(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[b7,({props:n})=>({19:n}),({props:n})=>n?524288:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&1572864&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function w7(r){let e,t,n,i;const o=[sn("predict-impact-outline"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*kd,r[2].max_count,1.5*Sd],"line-color":"black"}}];let u={};for(let m=0;m<o.length;m+=1)u=wt(u,o[m]);e=new gr({props:u});const a=[sn("predict-impact"),{filter:[">=",["max",["get","before"],["get","after"]],r[5]]},{paint:{"line-width":["interpolate",["linear"],["get","after"],0,kd,r[2].max_count,Sd],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,r[7][0],50,r[7][1],100,r[7][2],150,r[7][3],200,r[7][4]]]}},{manageHoverState:!0},{hoverCursor:"pointer"}];let d={$$slots:{default:[v7]},$$scope:{ctx:r}};for(let m=0;m<a.length;m+=1)d=wt(d,a[m]);return n=new gr({props:d}),n.$on("click",r[12]),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),i=!0},p(m,_){const v=_&36?Tn(o,[o[0],_&32&&{filter:[">=",["max",["get","before"],["get","after"]],m[5]]},_&4&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,1.5*kd,m[2].max_count,1.5*Sd],"line-color":"black"}}]):{};e.$set(v);const S=_&164?Tn(a,[a[0],_&32&&{filter:[">=",["max",["get","before"],["get","after"]],m[5]]},_&132&&{paint:{"line-width":["interpolate",["linear"],["get","after"],0,kd,m[2].max_count,Sd],"line-color":["let","ratio",["*",100,["/",["get","after"],["get","before"]]],["interpolate-hcl",["linear"],["var","ratio"],0,m[7][0],50,m[7][1],100,m[7][2],150,m[7][3],200,m[7][4]]]}},a[3],a[4]]):{};_&1048576&&(S.$$scope={dirty:_,ctx:m}),n.$set(S)},i(m){i||(N(e.$$.fragment,m),N(n.$$.fragment,m),i=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),i=!1},d(m){m&&H(t),he(e,m),he(n,m)}}}function x7(r){let e,t,n,i,o,u,a;return t=new yr({props:{data:r[8],$$slots:{default:[y7]},$$scope:{ctx:r}}}),i=new yr({props:{data:r[2],generateId:!0,$$slots:{default:[w7]},$$scope:{ctx:r}}}),u=new na({props:{interactive:!1}}),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),pe(i.$$.fragment),o=ae(),pe(u.$$.fragment),ce(e,"slot","map")},m(d,m){W(d,e,m),de(t,e,null),z(e,n),de(i,e,null),z(e,o),de(u,e,null),a=!0},p(d,m){const _={};m&1048576&&(_.$$scope={dirty:m,ctx:d}),t.$set(_);const v={};m&4&&(v.data=d[2]),m&1048612&&(v.$$scope={dirty:m,ctx:d}),i.$set(v)},i(d){a||(N(t.$$.fragment,d),N(i.$$.fragment,d),N(u.$$.fragment,d),a=!0)},o(d){G(t.$$.fragment,d),G(i.$$.fragment,d),G(u.$$.fragment,d),a=!1},d(d){d&&H(e),he(t),he(i),he(u)}}}function A7(r){let e,t,n,i;return e=new qu({props:{loading:r[1]}}),n=new po({props:{$$slots:{map:[x7],sidebar:[_7],top:[u7]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(o,u){de(e,o,u),W(o,t,u),de(n,o,u),i=!0},p(o,[u]){const a={};u&2&&(a.loading=o[1]),e.$set(a);const d={};u&1048701&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&H(t),he(e,o),he(n,o)}}}let kd=3,Sd=10;function k7(r,e,t){let n,i,o,u,a;rt(r,og,X=>t(11,n=X)),rt(r,Cr,X=>t(17,i=X)),rt(r,or,X=>t(4,o=X)),rt(r,n1,X=>t(5,u=X)),rt(r,Bo,X=>t(6,a=X));let{prevMode:d}=e,m=["#1a9641","#a6d96a","white","#fdae61","#d7191c"],_="",v={type:"FeatureCollection",features:[],max_count:1},S=i.toSavefile();function T(X){on(or,o={mode:"impact-detail",road:X,prevPrevMode:d},o)}async function C(X){t(1,_="Calculating impact"),await sp(),t(2,v=i.predictImpact(X)),t(1,_="")}let L=n?"fast":"accurate";function P(){on(og,n=L=="fast",n)}const D=[[]],I=X=>T(X.detail.features[0]);function U(){L=this.__value,t(3,L)}function O(){L=this.__value,t(3,L)}function ee(){u=kl(this.value),n1.set(u)}return r.$$set=X=>{"prevMode"in X&&t(0,d=X.prevMode)},r.$$.update=()=>{r.$$.dirty&2048&&C(n)},[d,_,v,L,o,u,a,m,S,T,P,n,I,U,D,O,ee]}class S7 extends kt{constructor(e){super(),St(this,e,k7,A7,gt,{prevMode:0})}}function Iv(r){let e,t,n;return t=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=q("li"),pe(t.$$.fragment)},m(i,o){W(i,e,o),de(t,e,null),n=!0},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function T7(r){let e,t,n,i,o,u,a,d,m,_,v,S=Mr(r[7].mode)+"",T,C;o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}});let L=r[0]=="neighbourhood"&&Iv();return{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),L&&L.c(),_=ae(),v=q("li"),T=Te(S),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(P,D){W(P,e,D),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),L&&L.m(n,null),z(n,_),z(n,v),z(v,T),C=!0},p(P,D){P[0]=="neighbourhood"?L?D&1&&N(L,1):(L=Iv(),L.c(),N(L,1),L.m(n,_)):L&&(Zt(),G(L,1,1,()=>{L=null}),Ht()),(!C||D&128)&&S!==(S=Mr(P[7].mode)+"")&&yt(T,S)},i(P){C||(N(o.$$.fragment,P),N(d.$$.fragment,P),N(L),C=!0)},o(P){G(o.$$.fragment,P),G(d.$$.fragment,P),G(L),C=!1},d(P){P&&H(e),he(o),he(d),L&&L.d()}}}function C7(r){let e;return{c(){e=q("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function M7(r){let e,t=$a(r[6].properties.distance)+"",n,i,o=ja(r[6].properties.time)+"",u;return{c(){e=q("p"),n=Te(t),i=Te(", "),u=Te(o)},m(a,d){W(a,e,d),z(e,n),z(e,i),z(e,u)},p(a,d){d&64&&t!==(t=$a(a[6].properties.distance)+"")&&yt(n,t),d&64&&o!==(o=ja(a[6].properties.time)+"")&&yt(u,o)},d(a){a&&H(e)}}}function E7(r){let e;return{c(){e=q("p"),e.innerHTML=`No possible route (
        <i>This is usually a known software bug</i>
        )`},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function I7(r){let e,t=$a(r[5].properties.distance)+"",n,i,o=ja(r[5].properties.time)+"",u;return{c(){e=q("p"),n=Te(t),i=Te(", "),u=Te(o)},m(a,d){W(a,e,d),z(e,n),z(e,i),z(e,u)},p(a,d){d&32&&t!==(t=$a(a[5].properties.distance)+"")&&yt(n,t),d&32&&o!==(o=ja(a[5].properties.time)+"")&&yt(u,o)},d(a){a&&H(e)}}}function L7(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U,O,ee;t=new Is({props:{mode:{mode:r[0]}}});function X(Z,J){return Z[6]?M7:C7}let ue=X(r),$=ue(r);function Q(Z,J){return Z[5]?I7:E7}let ne=Q(r),F=ne(r);return{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("p"),i.textContent="Drag markers for a route",o=ae(),u=q("u"),u.textContent="Route before changes",a=ae(),$.c(),d=ae(),m=q("u"),m.textContent="Route after changes",_=ae(),F.c(),v=ae(),S=q("label"),T=Te("Slow-down factor for main roads: "),C=Te(r[2]),L=ae(),P=q("input"),D=ae(),I=q("i"),I.textContent=`Increase to see how drivers may detour in heavy traffic. 1 means
      free-flow.`,Ze(u,"color","red"),Ze(m,"color","blue"),ce(P,"type","range"),ce(P,"min","1.0"),ce(P,"max","5.0"),ce(P,"step","0.1"),ce(e,"slot","sidebar")},m(Z,J){W(Z,e,J),de(t,e,null),z(e,n),z(e,i),z(e,o),z(e,u),z(e,a),$.m(e,null),z(e,d),z(e,m),z(e,_),F.m(e,null),z(e,v),z(e,S),z(S,T),z(S,C),z(S,L),z(S,P),Gn(P,r[2]),z(e,D),z(e,I),U=!0,O||(ee=[_t(P,"change",r[11]),_t(P,"input",r[11])],O=!0)},p(Z,J){const be={};J&1&&(be.mode={mode:Z[0]}),t.$set(be),ue===(ue=X(Z))&&$?$.p(Z,J):($.d(1),$=ue(Z),$&&($.c(),$.m(e,d))),ne===(ne=Q(Z))&&F?F.p(Z,J):(F.d(1),F=ne(Z),F&&(F.c(),F.m(e,v))),(!U||J&4)&&yt(C,Z[2]),J&4&&Gn(P,Z[2])},i(Z){U||(N(t.$$.fragment,Z),U=!0)},o(Z){G(t.$$.fragment,Z),U=!1},d(Z){Z&&H(e),he(t),$.d(),F.d(),O=!1,Er(ee)}}}function Lv(r){let e,t;return e=new nc({props:{$$slots:{default:[P7]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function P7(r){let e,t,n,i,o,u,a,d;return e=new lp({}),n=new ah({}),o=new lh({}),a=new tc({props:{interactive:!1}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),W(m,i,_),de(o,m,_),W(m,u,_),de(a,m,_),d=!0},p:ht,i(m){d||(N(e.$$.fragment,m),N(n.$$.fragment,m),N(o.$$.fragment,m),N(a.$$.fragment,m),d=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),G(o.$$.fragment,m),G(a.$$.fragment,m),d=!1},d(m){m&&(H(t),H(i),H(u)),he(e,m),he(n,m),he(o,m),he(a,m)}}}function z7(r){let e,t;const n=[sn("compare-route"),{paint:{"line-width":10,"line-color":Lo(["get","kind"],{before:"red",after:"blue"},"red")}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function D7(r){let e;return{c(){e=Te("A")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function R7(r){let e;return{c(){e=Te("B")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function B7(r){let e,t,n,i,o,u,a,d,m,_,v,S,T=r[0]=="neighbourhood"&&Lv(r);n=new na({props:{interactive:!1}}),o=new yr({props:{data:r[1],$$slots:{default:[z7]},$$scope:{ctx:r}}});function C(I){r[9](I)}let L={draggable:!0,$$slots:{default:[D7]},$$scope:{ctx:r}};r[4]!==void 0&&(L.lngLat=r[4]),a=new Cl({props:L}),wn.push(()=>On(a,"lngLat",C));function P(I){r[10](I)}let D={draggable:!0,$$slots:{default:[R7]},$$scope:{ctx:r}};return r[3]!==void 0&&(D.lngLat=r[3]),_=new Cl({props:D}),wn.push(()=>On(_,"lngLat",P)),{c(){e=q("div"),T&&T.c(),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment),m=ae(),pe(_.$$.fragment),ce(e,"slot","map")},m(I,U){W(I,e,U),T&&T.m(e,null),z(e,t),de(n,e,null),z(e,i),de(o,e,null),z(e,u),de(a,e,null),z(e,m),de(_,e,null),S=!0},p(I,U){I[0]=="neighbourhood"?T?U&1&&N(T,1):(T=Lv(I),T.c(),N(T,1),T.m(e,t)):T&&(Zt(),G(T,1,1,()=>{T=null}),Ht());const O={};U&2&&(O.data=I[1]),U&4096&&(O.$$scope={dirty:U,ctx:I}),o.$set(O);const ee={};U&4096&&(ee.$$scope={dirty:U,ctx:I}),!d&&U&16&&(d=!0,ee.lngLat=I[4],Nn(()=>d=!1)),a.$set(ee);const X={};U&4096&&(X.$$scope={dirty:U,ctx:I}),!v&&U&8&&(v=!0,X.lngLat=I[3],Nn(()=>v=!1)),_.$set(X)},i(I){S||(N(T),N(n.$$.fragment,I),N(o.$$.fragment,I),N(a.$$.fragment,I),N(_.$$.fragment,I),S=!0)},o(I){G(T),G(n.$$.fragment,I),G(o.$$.fragment,I),G(a.$$.fragment,I),G(_.$$.fragment,I),S=!1},d(I){I&&H(e),T&&T.d(),he(n),he(o),he(a),he(_)}}}function F7(r){let e,t;return e=new po({props:{$$slots:{map:[B7],sidebar:[L7],top:[T7]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&4351&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function O7(r,e,t){let n,i,o,u,a,d,m,_;rt(r,e1,L=>t(2,u=L)),rt(r,Bf,L=>t(3,a=L)),rt(r,Rf,L=>t(4,d=L)),rt(r,Cr,L=>t(8,m=L)),rt(r,or,L=>t(7,_=L));let{prevMode:v}=e;Yo(()=>{setTimeout(()=>{ag(Rf),ag(Bf)},10)});function S(L){d=L,Rf.set(d)}function T(L){a=L,Bf.set(a)}function C(){u=kl(this.value),e1.set(u)}return r.$$set=L=>{"prevMode"in L&&t(0,v=L.prevMode)},r.$$.update=()=>{r.$$.dirty&284&&t(1,n=m.compareRoute(d,a,u)),r.$$.dirty&2&&t(6,i=n.features.find(L=>L.properties.kind=="before")),r.$$.dirty&2&&t(5,o=n.features.find(L=>L.properties.kind=="after"))},[v,n,u,a,d,o,i,_,m,S,T,C]}class N7 extends kt{constructor(e){super(),St(this,e,O7,F7,gt,{prevMode:0})}}function $7(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C=Mr(r[2].mode)+"",L,P;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),v=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),_=q("li"),pe(v.$$.fragment),S=ae(),T=q("li"),L=Te(C),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(D,I){W(D,e,I),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),z(n,_),de(v,_,null),z(n,S),z(n,T),z(T,L),P=!0},p(D,I){(!P||I&4)&&C!==(C=Mr(D[2].mode)+"")&&yt(L,C)},i(D){P||(N(o.$$.fragment,D),N(d.$$.fragment,D),N(v.$$.fragment,D),P=!0)},o(D){G(o.$$.fragment,D),G(d.$$.fragment,D),G(v.$$.fragment,D),P=!1},d(D){D&&H(e),he(o),he(d),he(v)}}}function j7(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I;t=new Is({props:{mode:{mode:"neighbourhood"}}});function U(X){r[8](X)}function O(X){r[9](X)}let ee={map:cr(r[3])};return r[0]!==void 0&&(ee.waypoints=r[0]),r[1]!==void 0&&(ee.drawnShapeOut=r[1]),u=new U2({props:ee}),wn.push(()=>On(u,"waypoints",U)),wn.push(()=>On(u,"drawnShapeOut",O)),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),i=q("h1"),i.textContent="Adjust boundary",o=ae(),pe(u.$$.fragment),m=ae(),_=q("div"),v=q("button"),S=Te("Finish"),C=ae(),L=q("button"),L.textContent="Cancel",v.disabled=T=r[0].length<3,ce(L,"class","secondary"),Ze(_,"display","flex"),Ze(_,"gap","16px"),ce(e,"slot","sidebar")},m(X,ue){W(X,e,ue),de(t,e,null),z(e,n),z(e,i),z(e,o),de(u,e,null),z(e,m),z(e,_),z(_,v),z(v,S),z(_,C),z(_,L),P=!0,D||(I=[_t(v,"click",r[4]),_t(L,"click",r[5])],D=!0)},p(X,ue){const $={};ue&8&&($.map=cr(X[3])),!a&&ue&1&&(a=!0,$.waypoints=X[0],Nn(()=>a=!1)),!d&&ue&2&&(d=!0,$.drawnShapeOut=X[1],Nn(()=>d=!1)),u.$set($),(!P||ue&1&&T!==(T=X[0].length<3))&&(v.disabled=T)},i(X){P||(N(t.$$.fragment,X),N(u.$$.fragment,X),P=!0)},o(X){G(t.$$.fragment,X),G(u.$$.fragment,X),P=!1},d(X){X&&H(e),he(t),he(u),D=!1,Er(I)}}}function U7(r){let e,t;return e=new po({props:{$$slots:{sidebar:[j7],top:[$7]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&4111&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function V7(r,e,t){let n,i,o;rt(r,or,L=>t(2,n=L)),rt(r,Cr,L=>t(11,i=L)),rt(r,Ko,L=>t(3,o=L));let{name:u}=e,{existing:a}=e,d=[],m,_=a.properties.waypoints;if(!_){let L={type:"LineString",coordinates:a.geometry.coordinates[1]};_=i.extractWaypointsFromRing(L)}d=_.map(L=>({point:[L.lon,L.lat],snapped:L.snapped}));function v(){if(m)try{i.setCurrentNeighbourhoodBoundary(u,m),Uf(),on(or,n={mode:"neighbourhood"},n)}catch(L){window.alert(`Sorry, this boundary is invalid: ${L}`),S()}}function S(){on(or,n={mode:"neighbourhood"},n)}function T(L){d=L,t(0,d)}function C(L){m=L,t(1,m)}return r.$$set=L=>{"name"in L&&t(6,u=L.name),"existing"in L&&t(7,a=L.existing)},[d,m,n,o,v,S,u,a,T,C]}class q7 extends kt{constructor(e){super(),St(this,e,V7,U7,gt,{name:6,existing:7})}}const G7=["==",["geometry-type"],"Polygon"],Z7=["==",["geometry-type"],"LineString"],H7=["==",["geometry-type"],"Point"];function X2(){return{type:"FeatureCollection",features:[]}}function Nm(r){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:J2(r)}}}function J2(r){return[Math.round(r[0]*1e7)/1e7,Math.round(r[1]*1e7)/1e7]}const K2=Dn(X2()),Y2=Dn(0),W7=100;class X7{constructor(e){mr(this,"map");mr(this,"active");mr(this,"eventListenersSuccess");mr(this,"eventListenersUpdated");mr(this,"eventListenersFailure");mr(this,"points");mr(this,"cursor");mr(this,"hover");mr(this,"dragFrom");mr(this,"previousStates");mr(this,"onMouseMove",e=>{if(this.active&&!this.dragFrom)this.recalculateHovering(e);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let t=this.dragFrom[0]-e.lngLat.lng,n=this.dragFrom[1]-e.lngLat.lat;for(let i of this.points)i[0]-=t,i[1]-=n}else this.points[this.hover]=e.lngLat.toArray();this.dragFrom=e.lngLat.toArray(),this.redraw()}});mr(this,"onClick",e=>{if(this.beforeUpdate(),this.active&&this.cursor){let t=[];if(Pv(this.points).forEach((n,i)=>{t.push([i+1,VT(n,this.cursor).properties.dist])}),t.sort((n,i)=>n[1]-i[1]),t.length>0){let n=t[0][0];this.points.splice(n,0,this.cursor.geometry.coordinates),this.hover=n}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(e))});mr(this,"onDoubleClick",e=>{this.active&&(e.preventDefault(),this.cursor=Nm(e.lngLat.toArray()),this.onClick(e),this.finish())});mr(this,"onMouseDown",e=>{this.active&&!this.dragFrom&&this.hover!=null&&(e.preventDefault(),this.cursor=null,this.dragFrom=e.lngLat.toArray(),this.beforeUpdate(),this.redraw())});mr(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});mr(this,"onKeypress",e=>{this.active&&(e.key=="Enter"?(e.stopPropagation(),this.finish()):e.key=="z"&&e.ctrlKey&&this.undo())});mr(this,"onKeyDown",e=>{this.active&&e.key=="Escape"&&(e.stopPropagation(),this.cancel())});this.map=e,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersSuccess)t(e);else for(let t of this.eventListenersFailure)t();this.stop()}cancel(){for(let e of this.eventListenersFailure)e();this.stop()}addEventListenerSuccess(e){this.eventListenersSuccess.push(e)}addEventListenerUpdated(e){this.eventListenersUpdated.push(e)}addEventListenerFailure(e){this.eventListenersFailure.push(e)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(e){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(e.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let e=X2();this.points.forEach((i,o)=>{let u=Nm(i);u.properties.hover=this.hover==o,u.properties.idx=o,e.features.push(u)}),e.features=e.features.concat(Pv(this.points));let t=this.polygonFeature();t&&(t.properties.hover=this.hover=="polygon",e.features.push(t)),K2.set(e);let n="crosshair";this.hover!=null&&(n=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=n,Y2.set(this.previousStates.length)}pointsUpdated(){let e=this.polygonFeature();if(e)for(let t of this.eventListenersUpdated)t(e)}recalculateHovering(e){this.cursor=null,this.hover=null;for(let t of this.map.queryRenderedFeatures(e.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(t.geometry.type=="Polygon"){this.hover="polygon";break}else if(t.geometry.type=="Point"&&Object.hasOwn(t.properties,"idx")){this.hover=t.properties.idx;break}this.hover==null&&(this.cursor=Nm(e.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let e=this.points.map(J2),t=[JSON.parse(JSON.stringify(e))];return t[0].push(JSON.parse(JSON.stringify(t[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:t},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>W7&&this.previousStates.shift()}}function Pv(r){let e=[];for(let t=0;t<r.length-1;t++)e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[t],r[t+1]]},properties:{}});return r.length>=3&&e.push({type:"Feature",geometry:{type:"LineString",coordinates:[r[r.length-1],r[0]]},properties:{}}),e}function J7(r){let e,t,n;return{c(){e=Te("Undo ("),t=Te(r[1]),n=Te(")")},m(i,o){W(i,e,o),W(i,t,o),W(i,n,o)},p(i,o){o&2&&yt(t,i[1])},d(i){i&&(H(e),H(t),H(n))}}}function K7(r){let e;return{c(){e=Te("Undo")},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function Y7(r){let e,t,n,i,o,u,a,d,m,_,v;function S(L,P){return L[1]==0?K7:J7}let T=S(r),C=T(r);return{c(){e=q("div"),t=q("button"),t.textContent="Finish",n=ae(),i=q("button"),i.textContent="Cancel",o=ae(),u=q("button"),C.c(),d=ae(),m=q("ul"),m.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,u.disabled=a=r[1]==0,Ze(e,"display","flex"),Ze(e,"justify-content","space-between")},m(L,P){W(L,e,P),z(e,t),z(e,n),z(e,i),z(e,o),z(e,u),C.m(u,null),W(L,d,P),W(L,m,P),_||(v=[_t(t,"click",r[2]),_t(i,"click",r[3]),_t(u,"click",r[4])],_=!0)},p(L,[P]){T===(T=S(L))&&C?C.p(L,P):(C.d(1),C=T(L),C&&(C.c(),C.m(u,null))),P&2&&a!==(a=L[1]==0)&&(u.disabled=a)},i:ht,o:ht,d(L){L&&(H(e),H(d),H(m)),C.d(),_=!1,Er(v)}}}function Q7(r,e,t){let n;rt(r,Y2,d=>t(1,n=d));let{polygonTool:i}=e;const o=()=>i.finish(),u=()=>i.cancel(),a=()=>i.undo();return r.$$set=d=>{"polygonTool"in d&&t(0,i=d.polygonTool)},[i,n,o,u,a]}class eD extends kt{constructor(e){super(),St(this,e,Q7,Y7,gt,{polygonTool:0})}}let tD=Date.now();function uh(r){return`${r}-${tD++}`}const Q2=Symbol.for("svelte-maplibre");function nD(){return Wf(Q2)}function zv(r){return{subscribe:r.subscribe}}function ex({key:r,setPopupTarget:e=!1,setCluster:t=!1,setMouseEvent:n=!1}){let i=nD(),o=Dn(null),u=zv(o),a={...i,[r]:zv(o)};if(e&&(a.popupTarget=u),n){let d=Dn(null);a.layerEvent=d,i.layerEvent=d}return t&&(a.cluster=Dn()),Qd(Q2,a),{...i,self:o}}function rD(){return ex({key:"source",setCluster:!0})}function iD(r=!0){return ex({key:"layer",setPopupTarget:r,setMouseEvent:r})}function Dv(r){let e;return t=>{if(t)for(let n in t){let i=e==null?void 0:e[n],o=t[n];i!==o&&r(n,o,i)}else if(e)for(let n in e)r(n,void 0,e[n]);e=t}}function oD(r,...e){let t=[r];for(let n of e)if(n)Array.isArray(n)&&n[0]===r?t.push(...n.slice(1)):t.push(n);else continue;if(t.length!==1)return t.length===2?t[1]:t}function sD(r){return r===!0?["has","point_count"]:r===!1?["!",["has","point_count"]]:void 0}function Rv(r){let e=r[0],t,n,i=Bv(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u[0]&1&&gt(e,e=o[0])?(Zt(),G(i,1,1,ht),Ht(),i=Bv(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){G(i),n=!1},d(o){o&&H(t),i.d(o)}}}function Bv(r){let e;const t=r[36].default,n=_n(t,r,r[35],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o[1]&16)&&yn(n,t,i,i[35],e?vn(t,i[35],o,null):bn(i[35]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function aD(r){let e,t,n=r[0]&&Rv(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,o){i[0]?n?(n.p(i,o),o[0]&1&&N(n,1)):(n=Rv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function lD(r,e,t){let n,i,o,u,a,d,m,_,v,S,T,C,{$$slots:L={},$$scope:P}=e,{id:D=uh("layer")}=e,{source:I=void 0}=e,{sourceLayer:U=void 0}=e,{beforeId:O=void 0}=e,{beforeLayerType:ee=void 0}=e,{type:X}=e,{paint:ue=void 0}=e,{layout:$=void 0}=e,{filter:Q=void 0}=e,{applyToClusters:ne=void 0}=e,{minzoom:F=void 0}=e,{maxzoom:Z=void 0}=e,{manageHoverState:J=!1}=e,{hovered:be=null}=e,{interactive:ke=!0}=e,{hoverCursor:ge=void 0}=e,{eventsIfTopMost:ve=!1}=e;const fe=ps(),{map:Pe,source:Ee,self:Fe,minzoom:ot,maxzoom:ct,eventTopMost:it,layerInfo:at}=iD();rt(r,Pe,Ue=>t(31,v=Ue)),rt(r,Ee,Ue=>t(32,S=Ue)),rt(r,Fe,Ue=>t(0,_=Ue)),rt(r,ot,Ue=>t(34,C=Ue)),rt(r,ct,Ue=>t(33,T=Ue)),ei(()=>{_&&v&&(at.delete(_),v==null||v.removeLayer(_))});let ft;function Ct(Ue){var et,nn;if(!ke||!_||!v||ve&&it(Ue)!==_)return;let Xe=Ue.features??[],qt=(nn=(et=Xe[0])==null?void 0:et.properties)==null?void 0:nn.cluster_id,Ge={event:Ue,map:v,clusterId:qt,layer:_,source:a,features:Xe};fe(Ue.type,Ge)}function xt(Ue){var et,nn;if(!ke||!_||!v||ve&&it(Ue)!==_)return;ge&&(v.getCanvas().style.cursor=ge);let Xe=Ue.features??[];t(6,be=Xe[0]??null);let qt=(nn=(et=Xe[0])==null?void 0:et.properties)==null?void 0:nn.cluster_id;fe("mouseenter",{event:Ue,map:v,clusterId:qt,layer:_,source:a,features:Xe})}function It(Ue){var et,nn,Ye;if(!ke||!v)return;if(ve&&it(Ue)!==_){t(6,be=null),J&&ft!==void 0&&(v==null||v.setFeatureState({source:a,sourceLayer:U,id:ft},{hover:!1}),ft=void 0);return}v.getCanvas().style.cursor=ge;let Xe=Ue.features??[],qt=(nn=(et=Xe[0])==null?void 0:et.properties)==null?void 0:nn.cluster_id,Ge=(Ye=Xe[0])==null?void 0:Ye.id;Ge!==ft&&(J&&(ft!==void 0&&(v==null||v.setFeatureState({source:a,id:ft,sourceLayer:U},{hover:!1})),v==null||v.setFeatureState({source:a,id:Ge,sourceLayer:U},{hover:!0})),ft=Ge,t(6,be=Xe[0]??null)),fe("mousemove",{event:Ue,map:v,clusterId:qt,layer:_,source:a,features:Xe})}function Qt(Ue){if(!(!ke||!_||!v)){if(ge&&(v.getCanvas().style.cursor=""),t(6,be=null),J&&ft!==void 0){const Xe={source:a,id:ft,sourceLayer:U};v==null||v.setFeatureState(Xe,{hover:!1}),ft=void 0}fe("mouseleave",{map:v,layer:_,source:a})}}let tn=!0;function rn(Ue){v&&(v.off("click",Ue,Ct),v.off("dblclick",Ue,Ct),v.off("contextmenu",Ue,Ct),v.off("mouseenter",Ue,xt),v.off("mousemove",Ue,It),v.off("mouseleave",Ue,Qt))}return ei(()=>{v&&_&&rn(_)}),r.$$set=Ue=>{"id"in Ue&&t(7,D=Ue.id),"source"in Ue&&t(8,I=Ue.source),"sourceLayer"in Ue&&t(9,U=Ue.sourceLayer),"beforeId"in Ue&&t(10,O=Ue.beforeId),"beforeLayerType"in Ue&&t(11,ee=Ue.beforeLayerType),"type"in Ue&&t(12,X=Ue.type),"paint"in Ue&&t(13,ue=Ue.paint),"layout"in Ue&&t(14,$=Ue.layout),"filter"in Ue&&t(15,Q=Ue.filter),"applyToClusters"in Ue&&t(16,ne=Ue.applyToClusters),"minzoom"in Ue&&t(17,F=Ue.minzoom),"maxzoom"in Ue&&t(18,Z=Ue.maxzoom),"manageHoverState"in Ue&&t(19,J=Ue.manageHoverState),"hovered"in Ue&&t(6,be=Ue.hovered),"interactive"in Ue&&t(20,ke=Ue.interactive),"hoverCursor"in Ue&&t(21,ge=Ue.hoverCursor),"eventsIfTopMost"in Ue&&t(22,ve=Ue.eventsIfTopMost),"$$scope"in Ue&&t(35,P=Ue.$$scope)},r.$$.update=()=>{if(r.$$.dirty[0]&65536&&t(30,n=sD(ne)),r.$$.dirty[0]&1073774592&&t(24,i=oD("all",n,Q)),r.$$.dirty[0]&131072|r.$$.dirty[1]&8&&t(26,o=F??C),r.$$.dirty[0]&262144|r.$$.dirty[1]&4&&t(25,u=Z??T),r.$$.dirty[0]&256|r.$$.dirty[1]&2&&t(29,a=I||S),r.$$.dirty[0]&654343809|r.$$.dirty[1]&1&&v&&_!==D&&a){_&&(rn(_),at.delete(_));let Ue=O;if(!O&&ee){let Xe=v.getStyle().layers,qt=typeof ee=="function"?ee:et=>et.type===ee,Ge=Xe==null?void 0:Xe.find(qt);Ge&&(Ue=Ge.id)}on(Fe,_=D,_),v.addLayer(Na({id:_,type:X,source:a,"source-layer":U,filter:i,paint:ue,layout:$,minzoom:o,maxzoom:u}),Ue),t(23,tn=!0),v.on("click",_,Ct),v.on("dblclick",_,Ct),v.on("contextmenu",_,Ct),v.on("mouseenter",_,xt),v.on("mousemove",_,It),v.on("mouseleave",_,Qt)}r.$$.dirty[0]&1048577&&_&&at.set(_,{interactive:ke}),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(28,d=_?Dv((Ue,Xe)=>v==null?void 0:v.setPaintProperty(_,Ue,Xe)):void 0),r.$$.dirty[0]&1|r.$$.dirty[1]&1&&t(27,m=_?Dv((Ue,Xe)=>v==null?void 0:v.setLayoutProperty(_,Ue,Xe)):void 0),r.$$.dirty[0]&268443648&&(d==null||d(ue)),r.$$.dirty[0]&134234112&&(m==null||m($)),r.$$.dirty[0]&100663297|r.$$.dirty[1]&1&&_&&(v==null||v.setLayerZoomRange(_,o,u)),r.$$.dirty[0]&25165825|r.$$.dirty[1]&1&&_&&(tn?t(23,tn=!1):v==null||v.setFilter(_,i))},[_,Pe,Ee,Fe,ot,ct,be,D,I,U,O,ee,X,ue,$,Q,ne,F,Z,J,ke,ge,ve,tn,i,u,o,m,d,a,n,v,S,T,C,P,L]}class u_ extends kt{constructor(e){super(),St(this,e,lD,aD,gt,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function uD(r){let e;const t=r[16].default,n=_n(t,r,r[24],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16777216)&&yn(n,t,i,i[24],e?vn(t,i[24],o,null):bn(i[24]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function cD(r){let e,t,n;function i(u){r[17](u)}let o={id:r[1],type:"circle",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],applyToClusters:r[9],minzoom:r[10],maxzoom:r[11],hoverCursor:r[12],manageHoverState:r[13],eventsIfTopMost:r[14],interactive:r[15],$$slots:{default:[uD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new u_({props:o}),wn.push(()=>On(e,"hovered",i)),e.$on("click",r[18]),e.$on("dblclick",r[19]),e.$on("contextmenu",r[20]),e.$on("mouseenter",r[21]),e.$on("mousemove",r[22]),e.$on("mouseleave",r[23]),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.applyToClusters=u[9]),a&1024&&(d.minzoom=u[10]),a&2048&&(d.maxzoom=u[11]),a&4096&&(d.hoverCursor=u[12]),a&8192&&(d.manageHoverState=u[13]),a&16384&&(d.eventsIfTopMost=u[14]),a&32768&&(d.interactive=u[15]),a&16777216&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function fD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=uh("circle")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:_}=e,{layout:v=void 0}=e,{filter:S=void 0}=e,{applyToClusters:T=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:P=void 0}=e,{manageHoverState:D=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:O=!0}=e;function ee(Z){I=Z,t(0,I)}function X(Z){Pn.call(this,r,Z)}function ue(Z){Pn.call(this,r,Z)}function $(Z){Pn.call(this,r,Z)}function Q(Z){Pn.call(this,r,Z)}function ne(Z){Pn.call(this,r,Z)}function F(Z){Pn.call(this,r,Z)}return r.$$set=Z=>{"id"in Z&&t(1,o=Z.id),"source"in Z&&t(2,u=Z.source),"sourceLayer"in Z&&t(3,a=Z.sourceLayer),"beforeId"in Z&&t(4,d=Z.beforeId),"beforeLayerType"in Z&&t(5,m=Z.beforeLayerType),"paint"in Z&&t(6,_=Z.paint),"layout"in Z&&t(7,v=Z.layout),"filter"in Z&&t(8,S=Z.filter),"applyToClusters"in Z&&t(9,T=Z.applyToClusters),"minzoom"in Z&&t(10,C=Z.minzoom),"maxzoom"in Z&&t(11,L=Z.maxzoom),"hoverCursor"in Z&&t(12,P=Z.hoverCursor),"manageHoverState"in Z&&t(13,D=Z.manageHoverState),"hovered"in Z&&t(0,I=Z.hovered),"eventsIfTopMost"in Z&&t(14,U=Z.eventsIfTopMost),"interactive"in Z&&t(15,O=Z.interactive),"$$scope"in Z&&t(24,i=Z.$$scope)},[I,o,u,a,d,m,_,v,S,T,C,L,P,D,U,O,n,ee,X,ue,$,Q,ne,F,i]}class hD extends kt{constructor(e){super(),St(this,e,fD,cD,gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function dD(r){let e;const t=r[15].default,n=_n(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&yn(n,t,i,i[23],e?vn(t,i[23],o,null):bn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function pD(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"fill",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[dD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new u_({props:o}),wn.push(()=>On(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function mD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=uh("fill")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:_}=e,{layout:v=void 0}=e,{filter:S=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:C=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:P=!1}=e,{hovered:D=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:U=!0}=e;function O(F){D=F,t(0,D)}function ee(F){Pn.call(this,r,F)}function X(F){Pn.call(this,r,F)}function ue(F){Pn.call(this,r,F)}function $(F){Pn.call(this,r,F)}function Q(F){Pn.call(this,r,F)}function ne(F){Pn.call(this,r,F)}return r.$$set=F=>{"id"in F&&t(1,o=F.id),"source"in F&&t(2,u=F.source),"sourceLayer"in F&&t(3,a=F.sourceLayer),"beforeId"in F&&t(4,d=F.beforeId),"beforeLayerType"in F&&t(5,m=F.beforeLayerType),"paint"in F&&t(6,_=F.paint),"layout"in F&&t(7,v=F.layout),"filter"in F&&t(8,S=F.filter),"minzoom"in F&&t(9,T=F.minzoom),"maxzoom"in F&&t(10,C=F.maxzoom),"hoverCursor"in F&&t(11,L=F.hoverCursor),"manageHoverState"in F&&t(12,P=F.manageHoverState),"hovered"in F&&t(0,D=F.hovered),"eventsIfTopMost"in F&&t(13,I=F.eventsIfTopMost),"interactive"in F&&t(14,U=F.interactive),"$$scope"in F&&t(23,i=F.$$scope)},[D,o,u,a,d,m,_,v,S,T,C,L,P,I,U,n,O,ee,X,ue,$,Q,ne,i]}class gD extends kt{constructor(e){super(),St(this,e,mD,pD,gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function _D(r,e,t,n,i){let o=!1;r.getSource(e)&&(o=!0,r.removeSource(e));const u=()=>{n(e)&&(r.addSource(e,t),i())};if(o){const a=()=>{e&&(r.getSource(e)?setTimeout(a,1):u())};a()}else u()}function yD(r,e,t){tw().then(()=>{let n=li(r);if(!n)return;n.getSource(e)===t&&n.removeSource(e)})}function Fv(r){let e=r[0],t,n,i=Ov(r);return{c(){i.c(),t=rr()},m(o,u){i.m(o,u),W(o,t,u),n=!0},p(o,u){u&1&&gt(e,e=o[0])?(Zt(),G(i,1,1,ht),Ht(),i=Ov(o),i.c(),N(i,1),i.m(t.parentNode,t)):i.p(o,u)},i(o){n||(N(i),n=!0)},o(o){G(i),n=!1},d(o){o&&H(t),i.d(o)}}}function Ov(r){let e;const t=r[15].default,n=_n(t,r,r[14],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&16384)&&yn(n,t,i,i[14],e?vn(t,i[14],o,null):bn(i[14]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function bD(r){let e,t,n=r[0]&&Fv(r);return{c(){n&&n.c(),e=rr()},m(i,o){n&&n.m(i,o),W(i,e,o),t=!0},p(i,[o]){i[0]?n?(n.p(i,o),o&1&&N(n,1)):(n=Fv(i),n.c(),N(n,1),n.m(e.parentNode,e)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d(i)}}}function vD(r,e,t){let n,i,o,{$$slots:u={},$$scope:a}=e,{id:d=uh("geojson")}=e,{data:m}=e,{generateId:_=!1}=e,{promoteId:v=void 0}=e,{filter:S=void 0}=e,{lineMetrics:T=void 0}=e,{cluster:C=void 0}=e;const{map:L,cluster:P,self:D}=rD();rt(r,L,O=>t(13,i=O)),rt(r,P,O=>t(16,o=O)),rt(r,D,O=>t(0,n=O));let I,U=!0;return ei(()=>{n&&I&&i&&(yD(L,n,I),on(D,n=null,n),t(11,I=void 0))}),r.$$set=O=>{"id"in O&&t(4,d=O.id),"data"in O&&t(5,m=O.data),"generateId"in O&&t(6,_=O.generateId),"promoteId"in O&&t(7,v=O.promoteId),"filter"in O&&t(8,S=O.filter),"lineMetrics"in O&&t(9,T=O.lineMetrics),"cluster"in O&&t(10,C=O.cluster),"$$scope"in O&&t(14,a=O.$$scope)},r.$$.update=()=>{r.$$.dirty&1024&&on(P,o=C,o),r.$$.dirty&12273&&i&&n!==d&&(on(D,n=d,n),_D(i,n,Na({type:"geojson",data:m,filter:S,lineMetrics:T,generateId:_,promoteId:v,cluster:!!C,clusterMinPoints:C==null?void 0:C.minPoints,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius,clusterProperties:C==null?void 0:C.properties}),O=>i&&O===n,()=>{n&&(t(11,I=i==null?void 0:i.getSource(n)),t(12,U=!0))})),r.$$.dirty&8208&&(i==null||i.on("style.load",()=>{t(11,I=i==null?void 0:i.getSource(d))})),r.$$.dirty&6176&&I&&(U?t(12,U=!1):I.setData(m)),r.$$.dirty&3072&&(I==null||I.setClusterOptions(Na({cluster:!!C,clusterMaxZoom:C==null?void 0:C.maxZoom,clusterRadius:C==null?void 0:C.radius})))},[n,L,P,D,d,m,_,v,S,T,C,I,U,i,a,u]}class wD extends kt{constructor(e){super(),St(this,e,vD,bD,gt,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function xD(r){let e;const t=r[15].default,n=_n(t,r,r[23],null);return{c(){n&&n.c()},m(i,o){n&&n.m(i,o),e=!0},p(i,o){n&&n.p&&(!e||o&8388608)&&yn(n,t,i,i[23],e?vn(t,i[23],o,null):bn(i[23]),null)},i(i){e||(N(n,i),e=!0)},o(i){G(n,i),e=!1},d(i){n&&n.d(i)}}}function AD(r){let e,t,n;function i(u){r[16](u)}let o={id:r[1],type:"line",source:r[2],sourceLayer:r[3],beforeId:r[4],beforeLayerType:r[5],paint:r[6],layout:r[7],filter:r[8],minzoom:r[9],maxzoom:r[10],hoverCursor:r[11],manageHoverState:r[12],eventsIfTopMost:r[13],interactive:r[14],$$slots:{default:[xD]},$$scope:{ctx:r}};return r[0]!==void 0&&(o.hovered=r[0]),e=new u_({props:o}),wn.push(()=>On(e,"hovered",i)),e.$on("click",r[17]),e.$on("dblclick",r[18]),e.$on("contextmenu",r[19]),e.$on("mouseenter",r[20]),e.$on("mousemove",r[21]),e.$on("mouseleave",r[22]),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,[a]){const d={};a&2&&(d.id=u[1]),a&4&&(d.source=u[2]),a&8&&(d.sourceLayer=u[3]),a&16&&(d.beforeId=u[4]),a&32&&(d.beforeLayerType=u[5]),a&64&&(d.paint=u[6]),a&128&&(d.layout=u[7]),a&256&&(d.filter=u[8]),a&512&&(d.minzoom=u[9]),a&1024&&(d.maxzoom=u[10]),a&2048&&(d.hoverCursor=u[11]),a&4096&&(d.manageHoverState=u[12]),a&8192&&(d.eventsIfTopMost=u[13]),a&16384&&(d.interactive=u[14]),a&8388608&&(d.$$scope={dirty:a,ctx:u}),!t&&a&1&&(t=!0,d.hovered=u[0],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function kD(r,e,t){let{$$slots:n={},$$scope:i}=e,{id:o=uh("line")}=e,{source:u=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:d=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:_}=e,{layout:v=void 0}=e,{filter:S=void 0}=e,{minzoom:T=void 0}=e,{maxzoom:C=void 0}=e,{hoverCursor:L=void 0}=e,{manageHoverState:P=!1}=e,{hovered:D=null}=e,{eventsIfTopMost:I=!1}=e,{interactive:U=!0}=e;function O(F){D=F,t(0,D)}function ee(F){Pn.call(this,r,F)}function X(F){Pn.call(this,r,F)}function ue(F){Pn.call(this,r,F)}function $(F){Pn.call(this,r,F)}function Q(F){Pn.call(this,r,F)}function ne(F){Pn.call(this,r,F)}return r.$$set=F=>{"id"in F&&t(1,o=F.id),"source"in F&&t(2,u=F.source),"sourceLayer"in F&&t(3,a=F.sourceLayer),"beforeId"in F&&t(4,d=F.beforeId),"beforeLayerType"in F&&t(5,m=F.beforeLayerType),"paint"in F&&t(6,_=F.paint),"layout"in F&&t(7,v=F.layout),"filter"in F&&t(8,S=F.filter),"minzoom"in F&&t(9,T=F.minzoom),"maxzoom"in F&&t(10,C=F.maxzoom),"hoverCursor"in F&&t(11,L=F.hoverCursor),"manageHoverState"in F&&t(12,P=F.manageHoverState),"hovered"in F&&t(0,D=F.hovered),"eventsIfTopMost"in F&&t(13,I=F.eventsIfTopMost),"interactive"in F&&t(14,U=F.interactive),"$$scope"in F&&t(23,i=F.$$scope)},[D,o,u,a,d,m,_,v,S,T,C,L,P,I,U,n,O,ee,X,ue,$,Q,ne,i]}class SD extends kt{constructor(e){super(),St(this,e,kD,AD,gt,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function TD(r){let e,t,n,i,o,u;return e=new gD({props:{id:"edit-polygon-fill",filter:G7,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),n=new SD({props:{id:"edit-polygon-lines",filter:Z7,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),o=new hD({props:{id:"edit-polygon-vertices",filter:H7,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment)},m(a,d){de(e,a,d),W(a,t,d),de(n,a,d),W(a,i,d),de(o,a,d),u=!0},p:ht,i(a){u||(N(e.$$.fragment,a),N(n.$$.fragment,a),N(o.$$.fragment,a),u=!0)},o(a){G(e.$$.fragment,a),G(n.$$.fragment,a),G(o.$$.fragment,a),u=!1},d(a){a&&(H(t),H(i)),he(e,a),he(n,a),he(o,a)}}}function CD(r){let e,t;return e=new wD({props:{data:r[0],$$slots:{default:[TD]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&1&&(o.data=n[0]),i&2&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function MD(r,e,t){let n;return rt(r,K2,i=>t(0,n=i)),[n]}class ED extends kt{constructor(e){super(),St(this,e,MD,CD,gt,{})}}function ID(r){let e,t,n,i,o,u,a;return{c(){e=q("button"),e.textContent="Import current view",t=ae(),n=q("i"),n.textContent="or...",i=ae(),o=q("button"),o.textContent="Draw an area to import on the map",ce(e,"type","button"),ce(o,"type","button")},m(d,m){W(d,e,m),W(d,t,m),W(d,n,m),W(d,i,m),W(d,o,m),u||(a=[_t(e,"click",r[2]),_t(o,"click",r[3])],u=!0)},p:ht,i:ht,o:ht,d(d){d&&(H(e),H(t),H(n),H(i),H(o)),u=!1,Er(a)}}}function LD(r){let e,t;return e=new eD({props:{polygonTool:r[0]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&1&&(o.polygonTool=n[0]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function PD(r){let e,t,n,i,o,u,a,d,m;const _=[LD,ID],v=[];function S(T,C){return T[0]?0:1}return e=S(r),t=v[e]=_[e](r),{c(){t.c(),n=ae(),i=q("label"),o=q("input"),u=Te(`Save a copy of the osm.xml
  after importing`),ce(o,"type","checkbox")},m(T,C){v[e].m(T,C),W(T,n,C),W(T,i,C),z(i,o),o.checked=r[1],z(i,u),a=!0,d||(m=_t(o,"change",r[5]),d=!0)},p(T,[C]){let L=e;e=S(T),e===L?v[e].p(T,C):(Zt(),G(v[L],1,1,()=>{v[L]=null}),Ht(),t=v[e],t?t.p(T,C):(t=v[e]=_[e](T),t.c()),N(t,1),t.m(n.parentNode,n)),C&2&&(o.checked=T[1])},i(T){a||(N(t),a=!0)},o(T){G(t),a=!1},d(T){T&&(H(n),H(i)),v[e].d(T),d=!1,m()}}}function yf(r){return[r.lng,r.lat]}function zD(r,e,t){let{map:n}=e;const i=ps();let o=null,u=!1;async function a(S){try{i("loading","Loading from Overpass");let C=await(await fetch(tx(S))).text();u&&np("osm.xml",C),i("gotXml",{xml:C,boundary:S})}catch(T){i("error",T.toString())}}function d(){let S=n.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[yf(S.getSouthWest()),yf(S.getNorthWest()),yf(S.getNorthEast()),yf(S.getSouthEast()),yf(S.getSouthWest())]],type:"Polygon"}}}async function m(){if(n){if(n.getZoom()<13){i("error","Zoom in more to import");return}await a(d())}}function _(){n&&(t(0,o=new X7(n)),o.startNew(),o.addEventListenerSuccess(async S=>{t(0,o=null),await a(S)}),o.addEventListenerFailure(()=>{t(0,o=null)}))}function v(){u=this.checked,t(1,u)}return r.$$set=S=>{"map"in S&&t(4,n=S.map)},[o,u,m,_,n,v]}class DD extends kt{constructor(e){super(),St(this,e,zD,PD,gt,{map:4})}}function tx(r){let e='poly:"';if(r.geometry.type=="Polygon")for(let[n,i]of r.geometry.coordinates[0])e+=`${i} ${n} `;else if(r.geometry.type=="MultiPolygon")for(let[n,i]of r.geometry.coordinates[0][0])e+=`${i} ${n} `;else throw new Error("overpassQueryForPolygon needs a Polygon or MultiPolygon");return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}class nx{constructor(e,t,n,i,o,u,a){mr(this,"inner");this.inner=new b6(e||new Uint8Array,t||new Uint8Array,n,i,o,u,a)}getInvertedBoundary(){return JSON.parse(this.inner.getInvertedBoundary())}getBounds(){return Array.from(this.inner.getBounds())}toRouteSnapper(){return this.inner.toRouteSnapper()}toRouteSnapperGj(){return this.inner.toRouteSnapperGj()}renderModalFilters(){return JSON.parse(this.inner.renderModalFilters())}renderModalFiltersBeforeEdits(){return JSON.parse(this.inner.renderModalFiltersBeforeEdits())}renderTurnRestrictions(){return JSON.parse(this.inner.renderTurnRestrictions())}renderTurnRestrictionsBeforeEdits(){return JSON.parse(this.inner.renderTurnRestrictionsBeforeEdits())}renderNeighbourhood(){let e=JSON.parse(this.inner.renderNeighbourhood());return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}renderNeighbourhoodBeforeEdits(){let e=JSON.parse(this.inner.renderNeighbourhoodBeforeEdits());return e.maxShortcuts=Math.max(...e.features.map(t=>t.properties.kind=="interior_road"?t.properties.shortcuts:0))??0,e}generatedBoundaries(){return JSON.parse(this.inner.generatedBoundaries())}generateMergedBoundary(e){let t=this.inner.generateMergedBoundary(e);return JSON.parse(t)}setCurrentNeighbourhoodBoundary(e,t){this.inner.setCurrentNeighbourhoodBoundary(e,t)}extractWaypointsFromRing(e){let t=this.inner.extractWaypointsFromRing(e);return JSON.parse(t)}deleteNeighbourhoodBoundary(e){this.inner.deleteNeighbourhoodBoundary(e)}renameNeighbourhoodBoundary(e,t){this.inner.renameNeighbourhoodBoundary(e,t)}setCurrentNeighbourhood(e){this.inner.setCurrentNeighbourhood(e)}addModalFilter(e,t){this.inner.addModalFilter(e,t)}addManyModalFilters(e,t){this.inner.addManyModalFilters(e,t)}deleteModalFilter(e){this.inner.deleteModalFilter(e)}addDiagonalFilter(e){this.inner.addDiagonalFilter(e.intersectionId)}rotateDiagonalFilter(e){this.inner.rotateDiagonalFilter(e.intersectionId)}deleteDiagonalFilter(e){this.inner.deleteDiagonalFilter(e.intersectionId)}toggleTravelFlow(e){this.inner.toggleTravelFlow(e)}toggleMainRoad(e){this.inner.toggleMainRoad(e)}setMainRoads(e,t){this.inner.setMainRoads(new Uint32Array(e),t)}addTurnRestriction(e,t){this.inner.addTurnRestriction(e,t)}deleteTurnRestriction(e,t,n){this.inner.deleteTurnRestriction(e,t,n)}getTurnRestrictionTargets(e){return JSON.parse(this.inner.getTurnRestrictionTargets(e))}undo(){this.inner.undo()}redo(){this.inner.redo()}getShortcutsCrossingRoad(e){return JSON.parse(this.inner.getShortcutsCrossingRoad(e))}getAllShortcuts(){return JSON.parse(this.inner.getAllShortcuts())}getAllShortcutsBeforeEdits(){return JSON.parse(this.inner.getAllShortcutsBeforeEdits())}toSavefile(){return JSON.parse(this.inner.toSavefile())}loadSavefile(e){this.inner.loadSavefile(e)}changeProjectName(e){this.inner.changeProjectName(e)}compareRoute(e,t,n){return JSON.parse(this.inner.compareRoute(e.lng,e.lat,t.lng,t.lat,n))}impactToOneDestination(e){return JSON.parse(this.inner.impactToOneDestination(e.lng,e.lat))}predictImpact(e){return JSON.parse(this.inner.predictImpact(e))}getImpactsOnRoad(e,t){return JSON.parse(this.inner.getImpactsOnRoad(e,t)).map(n=>{let[i,o,u]=n;return{count:i,before:o,after:u}})}getAllIntersections(){return JSON.parse(this.inner.getAllIntersections())}getMovements(e){return JSON.parse(this.inner.getMovements(e))}getDemandModel(){let e=JSON.parse(this.inner.getDemandModel());for(let t of e.features)t.properties.sum_from=f1(t.properties.counts_from),t.properties.sum_to=f1(t.properties.counts_to);return e}getPOIs(){return JSON.parse(this.inner.getPOIs())}getMetricBuckets(){try{return JSON.parse(this.inner.getMetricBuckets())}catch{return null}}eraseAllMainRoads(){this.inner.eraseAllMainRoads()}getOsmTimestamp(){let e=this.inner.getOsmTimestamp();return e?new Date(1e3*Number(e)):null}}let Hu=Dn(""),Wu=Dn(null);async function up(r){let e=li(ta).project(r);try{console.time("get input files");let{osmBuffer:t,boundary:n,mapModelBuffer:i}=await RD(e);console.timeEnd("get input files"),Hu.set("Download finished, setting up project"),Wu.set(100),await sp(),console.time("load"),Cr.set(new nx(i?new Uint8Array(i):void 0,t?new Uint8Array(t):void 0,n,e.app_focus,e.study_area_name,e.project_name,e.db_schema_version)),li(Cr).loadSavefile(e),zo.set(r),console.timeEnd("load"),rx(r)}catch(t){window.alert(`Couldn't open project: ${t}`),zo.set(void 0)}Hu.set(""),Wu.set(null)}async function RD(r){if(r.app_focus=="cnt")return{mapModelBuffer:await $m(fs(`cnt/maps_v3/${r.study_area_name}.bin.gz`))};if(r.app_focus=="england")return{mapModelBuffer:await $m(fs(`england/maps_v3/${r.study_area_name}.bin.gz`))};if(r.study_area_name){let e=await $m(fs(`severance_pbfs/v2/${r.study_area_name}.osm.pbf`)),n=await(await ug(fs(`boundaries/${r.study_area_name}.geojson`))).json();return{osmBuffer:e,boundary:n}}else{Hu.set("Grabbing OSM data from Overpass"),Wu.set(100);let e=r.features.find(i=>i.properties.kind=="study_area_boundary");return{osmBuffer:await(await ug(tx(e))).arrayBuffer(),boundary:e}}}async function $m(r){return console.log(`Grabbing ${r}`),Hu.set(`Downloading ${r}`),await IS(r,e=>Wu.set(e))}function rx(r){Zf.set(new GT(li(Ko),li(Cr).toRouteSnapper(),Dn(ii()),Dn(!0),Dn(0))),li(Ko).fitBounds(li(Cr).getBounds(),{duration:500});let e=li(Cr).getMetricBuckets();e&&Qu.set(e);let t=new URL(window.location.href);t.searchParams.set("project",r),window.history.replaceState(null,"",t.toString())}function Nv(r,e,t){const n=r.slice();return n[19]=e[t][0],n[20]=e[t][1],n}function $v(r,e,t){const n=r.slice();return n[23]=e[t][0],n[24]=e[t][1],n}function BD(r){let e,t,n,i,o,u,a,d=Mr(r[5].mode)+"",m,_;return o=new jn({props:{mode:{mode:"title"}}}),{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),m=Te(d),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(v,S){W(v,e,S),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),z(a,m),_=!0},p(v,S){(!_||S&32)&&d!==(d=Mr(v[5].mode)+"")&&yt(m,d)},i(v){_||(N(o.$$.fragment,v),_=!0)},o(v){G(o.$$.fragment,v),_=!1},d(v){v&&H(e),he(o)}}}function jv(r){let e,t,n,i,o,u,a,d,m,_,v,S,T=zn(r[3]),C=[];for(let L=0;L<T.length;L+=1)C[L]=Vv(Nv(r,T,L));return m=new DD({props:{map:r[8]}}),m.$on("gotXml",r[9]),m.$on("loading",r[13]),m.$on("error",r[14]),{c(){e=q("label"),t=Te(`Load a built-in area:
        `),n=q("select"),i=q("option");for(let L=0;L<C.length;L+=1)C[L].c();o=ae(),u=q("i"),u.textContent="or...",a=ae(),d=q("div"),pe(m.$$.fragment),i.__value="",Gn(i,i.__value),r[2]===void 0&&Ks(()=>r[11].call(n))},m(L,P){W(L,e,P),z(e,t),z(e,n),z(n,i);for(let D=0;D<C.length;D+=1)C[D]&&C[D].m(n,null);Mi(n,r[2],!0),W(L,o,P),W(L,u,P),W(L,a,P),W(L,d,P),de(m,d,null),_=!0,v||(S=[_t(n,"change",r[11]),_t(n,"change",r[12])],v=!0)},p(L,P){if(P&8){T=zn(L[3]);let I;for(I=0;I<T.length;I+=1){const U=Nv(L,T,I);C[I]?C[I].p(U,P):(C[I]=Vv(U),C[I].c(),C[I].m(n,null))}for(;I<C.length;I+=1)C[I].d(1);C.length=T.length}P&12&&Mi(n,L[2]);const D={};P&256&&(D.map=L[8]),m.$set(D)},i(L){_||(N(m.$$.fragment,L),_=!0)},o(L){G(m.$$.fragment,L),_=!1},d(L){L&&(H(e),H(o),H(u),H(a),H(d)),Jr(C,L),he(m),v=!1,Er(S)}}}function Uv(r){let e,t=r[24]+"",n,i;return{c(){e=q("option"),n=Te(t),e.__value=i=r[23],Gn(e,e.__value)},m(o,u){W(o,e,u),z(e,n)},p(o,u){u&8&&t!==(t=o[24]+"")&&yt(n,t),u&8&&i!==(i=o[23])&&(e.__value=i,Gn(e,e.__value))},d(o){o&&H(e)}}}function Vv(r){let e,t,n=zn(r[20]),i=[];for(let o=0;o<n.length;o+=1)i[o]=Uv($v(r,n,o));return{c(){e=q("optgroup");for(let o=0;o<i.length;o+=1)i[o].c();ce(e,"label",t=r[19])},m(o,u){W(o,e,u);for(let a=0;a<i.length;a+=1)i[a]&&i[a].m(e,null)},p(o,u){if(u&8){n=zn(o[20]);let a;for(a=0;a<n.length;a+=1){const d=$v(o,n,a);i[a]?i[a].p(d,u):(i[a]=Uv(d),i[a].c(),i[a].m(e,null))}for(;a<i.length;a+=1)i[a].d(1);i.length=n.length}u&8&&t!==(t=o[19])&&ce(e,"label",t)},d(o){o&&H(e),Jr(i,o)}}}function FD(r){let e,t,n,i,o,u,a,d,m,_=r[1]&&jv(r);return{c(){e=q("div"),t=q("div"),n=q("label"),i=Te(`Project name:
        `),o=q("input"),u=ae(),_&&_.c(),ce(o,"type","text"),ce(e,"slot","sidebar")},m(v,S){W(v,e,S),z(e,t),z(t,n),z(n,i),z(n,o),Gn(o,r[1]),z(e,u),_&&_.m(e,null),a=!0,d||(m=_t(o,"input",r[10]),d=!0)},p(v,S){S&2&&o.value!==v[1]&&Gn(o,v[1]),v[1]?_?(_.p(v,S),S&2&&N(_,1)):(_=jv(v),_.c(),N(_,1),_.m(e,null)):_&&(Zt(),G(_,1,1,()=>{_=null}),Ht())},i(v){a||(N(_),a=!0)},o(v){G(_),a=!1},d(v){v&&H(e),_&&_.d(),d=!1,m()}}}function OD(r){let e,t,n;return t=new ED({}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","map")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p:ht,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function ND(r){let e,t,n,i,o,u;return e=new qu({props:{loading:r[4],progress:100}}),n=new qu({props:{loading:r[6],progress:r[7]}}),o=new po({props:{$$slots:{map:[OD],sidebar:[FD],top:[BD]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment)},m(a,d){de(e,a,d),W(a,t,d),de(n,a,d),W(a,i,d),de(o,a,d),u=!0},p(a,[d]){const m={};d&16&&(m.loading=a[4]),e.$set(m);const _={};d&64&&(_.loading=a[6]),d&128&&(_.progress=a[7]),n.$set(_);const v={};d&134218046&&(v.$$scope={dirty:d,ctx:a}),o.$set(v)},i(a){u||(N(e.$$.fragment,a),N(n.$$.fragment,a),N(o.$$.fragment,a),u=!0)},o(a){G(e.$$.fragment,a),G(n.$$.fragment,a),G(o.$$.fragment,a),u=!1},d(a){a&&(H(t),H(i)),he(e,a),he(n,a),he(o,a)}}}function $D(r,e,t){let n,i,o,u,a,d,m,_;rt(r,or,X=>t(5,n=X)),rt(r,ta,X=>t(15,i=X)),rt(r,zo,X=>t(16,o=X)),rt(r,Cr,X=>t(17,u=X)),rt(r,Bo,X=>t(18,a=X)),rt(r,Hu,X=>t(6,d=X)),rt(r,Wu,X=>t(7,m=X)),rt(r,Ko,X=>t(8,_=X));let v="",S=null,T=[],C="";Yo(async()=>{let X=await ug(fs("severance_pbfs/areas.json"));t(3,T=await X.json())});async function L(X){t(4,C="Loading OSM");try{let ue;on(Cr,u=new nx(void 0,new TextEncoder().encode(X.detail.xml),X.detail.boundary,a,ue,v,i.dbSchemaVersion),u);const $=i.createProject(u.toSavefile());on(zo,o=$,o),rx($),on(or,n={mode:"add-neighbourhood"},n)}catch(ue){window.alert(`Couldn't import from Overpass: ${ue}`)}t(4,C="")}async function P(){if(!S)return;let X;try{X=i.createEmptyProject(v,S)}catch(ue){t(2,S=null),window.alert(`Couldn't create project: ${ue}`);return}await up(X),on(or,n={mode:"add-neighbourhood"},n)}function D(){v=this.value,t(1,v)}function I(){S=Ys(this),t(2,S),t(3,T)}return[P,v,S,T,C,n,d,m,_,L,D,I,()=>P(),X=>t(4,C=X.detail),X=>window.alert(X.detail)]}class jD extends kt{constructor(e){super(),St(this,e,$D,ND,gt,{loadExample:0})}get loadExample(){return this.$$.ctx[0]}}const UD="/ltn/assets/boundaries-BnmDCWUr.geojson",VD="/ltn/assets/boundaries-Ddt_iXWy.geojson";function qD(r){let e;return{c(){e=q("p"),e.innerHTML=`The LTN tool can be used anywhere in the world. Some regions have extra
      datasets. If you&#39;d like to specialize the tool, please email Dustin at <a href="mailto:dabreegster@gmail.com">dabreegster@gmail.com</a>.`},m(t,n){W(t,e,n)},p:ht,d(t){t&&H(e)}}}function GD(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D;return n=new H3({props:{color:"black"}}),C=new ec({props:{$$slots:{default:[qD]},$$scope:{ctx:r}}}),{c(){e=q("span"),t=q("button"),pe(n.$$.fragment),o=ae(),u=q("button"),a=q("span"),m=ae(),_=q("button"),v=q("span"),T=ae(),pe(C.$$.fragment),ce(t,"class","outline icon-btn"),ce(t,"data-tippy-content","Global version"),t.disabled=i=r[0]=="global",ce(a,"class","fi fi-gb-sct"),ce(u,"class","outline icon-btn"),ce(u,"data-tippy-content","Scotland"),u.disabled=d=r[0]=="cnt",ce(v,"class","fi fi-gb-eng"),ce(_,"class","outline icon-btn"),ce(_,"data-tippy-content","England"),_.disabled=S=r[0]=="england",Ze(e,"display","flex"),Ze(e,"flex-direction","row"),Ze(e,"height","80%"),Ze(e,"gap","4px")},m(I,U){W(I,e,U),z(e,t),de(n,t,null),z(e,o),z(e,u),z(u,a),z(e,m),z(e,_),z(_,v),z(e,T),de(C,e,null),L=!0,P||(D=[_t(t,"click",r[1]),_t(u,"click",r[2]),_t(_,"click",r[3])],P=!0)},p(I,[U]){(!L||U&1&&i!==(i=I[0]=="global"))&&(t.disabled=i),(!L||U&1&&d!==(d=I[0]=="cnt"))&&(u.disabled=d),(!L||U&1&&S!==(S=I[0]=="england"))&&(_.disabled=S);const O={};U&16&&(O.$$scope={dirty:U,ctx:I}),C.$set(O)},i(I){L||(N(n.$$.fragment,I),N(C.$$.fragment,I),L=!0)},o(I){G(n.$$.fragment,I),G(C.$$.fragment,I),L=!1},d(I){I&&H(e),he(n),he(C),P=!1,Er(D)}}}function ZD(r,e,t){let n;return rt(r,Bo,a=>t(0,n=a)),Yo(r_),[n,()=>window.location.href=".",()=>window.location.href="cnt.html",()=>window.location.href="england.html"]}class HD extends kt{constructor(e){super(),St(this,e,ZD,GD,gt,{})}}function qv(r,e,t){const n=r.slice();return n[11]=e[t],n}function Gv(r){let e,t=r[11]+"",n,i;return{c(){e=q("option"),n=Te(t),e.__value=i=r[11],Gn(e,e.__value)},m(o,u){W(o,e,u),z(e,n)},p(o,u){u&2&&t!==(t=o[11]+"")&&yt(n,t),u&2&&i!==(i=o[11])&&(e.__value=i,Gn(e,e.__value))},d(o){o&&H(e)}}}function WD(r){let e,t,n=r[10].name+"",i;return{c(){e=q("p"),t=Te("Click to start a new project in "),i=Te(n)},m(o,u){W(o,e,u),z(e,t),z(e,i)},p(o,u){u&1024&&n!==(n=o[10].name+"")&&yt(i,n)},d(o){o&&H(e)}}}function XD(r){let e,t;return e=new oi({props:{openOn:"hover",$$slots:{default:[WD,({props:n})=>({10:n}),({props:n})=>n?1024:0]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&17408&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function JD(r){let e,t,n,i;return e=new Zi({props:{paint:{"fill-color":co.mapFeature.hover.backgroundColor,"fill-outline-color":co.mapFeature.hover.backgroundColor,"fill-opacity":nr(0,.5)},beforeId:"Road labels",manageHoverState:!0,hoverCursor:"pointer",$$slots:{default:[XD]},$$scope:{ctx:r}}}),e.$on("click",r[3]),n=new gr({props:{paint:{"line-color":co.mapFeature.hover.backgroundColor,"line-width":2.5},beforeId:"Road labels",manageHoverState:!1}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(o,u){de(e,o,u),W(o,t,u),de(n,o,u),i=!0},p(o,u){const a={};u&16384&&(a.$$scope={dirty:u,ctx:o}),e.$set(a)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&H(t),he(e,o),he(n,o)}}}function KD(r){let e,t,n,i,o,u,a,d,m,_=zn(r[1]),v=[];for(let S=0;S<_.length;S+=1)v[S]=Gv(qv(r,_,S));return u=new yr({props:{data:r[0],generateId:!0,$$slots:{default:[JD]},$$scope:{ctx:r}}}),{c(){e=q("p"),e.textContent="Choose a boundary below or on the map to begin:",t=ae(),n=q("select"),i=q("option");for(let S=0;S<v.length;S+=1)v[S].c();o=ae(),pe(u.$$.fragment),i.__value="",Gn(i,i.__value),Ze(n,"width","90%"),r[2]===void 0&&Ks(()=>r[6].call(n))},m(S,T){W(S,e,T),W(S,t,T),W(S,n,T),z(n,i);for(let C=0;C<v.length;C+=1)v[C]&&v[C].m(n,null);Mi(n,r[2],!0),W(S,o,T),de(u,S,T),a=!0,d||(m=[_t(n,"change",r[6]),_t(n,"change",r[4])],d=!0)},p(S,[T]){if(T&2){_=zn(S[1]);let L;for(L=0;L<_.length;L+=1){const P=qv(S,_,L);v[L]?v[L].p(P,T):(v[L]=Gv(P),v[L].c(),v[L].m(n,null))}for(;L<v.length;L+=1)v[L].d(1);v.length=_.length}T&6&&Mi(n,S[2]);const C={};T&1&&(C.data=S[0]),T&16384&&(C.$$scope={dirty:T,ctx:S}),u.$set(C)},i(S){a||(N(u.$$.fragment,S),a=!0)},o(S){G(u.$$.fragment,S),a=!1},d(S){S&&(H(e),H(t),H(n),H(o)),Jr(v,S),he(u,S),d=!1,Er(m)}}}function YD(r,e,t){let n,i;rt(r,or,T=>t(7,n=T)),rt(r,ta,T=>t(8,i=T));let{boundariesUrl:o}=e,u={type:"FeatureCollection",features:[]},a=[],d="";Yo(async()=>{let T=await fetch(o);t(0,u=await T.json());for(let C of u.features)a.push(C.properties.name);a.sort(),t(1,a)});function m(T){let C=T.detail.features[0].properties;_(`${C.kind}_${C.name}`)}async function _(T){let C,L=!1;for(;!L;){let P=C||i.nextAvailableProjectName(Hd(T));if(C=window.prompt(`Please pick a project name to create in ${Hd(T)}`,P),C===null)return;if(C=C.trim(),C===""){window.alert("Project name cannot be blank; Please pick a name or cancel.");continue}try{let D=i.createEmptyProject(C,T);await up(D),on(or,n={mode:"add-neighbourhood"},n),L=!0}catch(D){window.alert(D)}}}function v(){d&&_(`LAD_${d}`)}function S(){d=Ys(this),t(2,d),t(1,a)}return r.$$set=T=>{"boundariesUrl"in T&&t(5,o=T.boundariesUrl)},[u,a,d,m,v,o,S]}class ix extends kt{constructor(e){super(),St(this,e,YD,KD,gt,{boundariesUrl:5})}}function QD(r){let e,t,n,i,o,u;return{c(){e=q("label"),t=q("strong"),t.textContent="Load a project from a file",n=ae(),i=q("input"),ce(i,"type","file"),Ze(e,"margin-top","16px")},m(a,d){W(a,e,d),z(e,t),z(e,n),z(e,i),r[2](i),o||(u=_t(i,"change",r[1]),o=!0)},p:ht,i:ht,o:ht,d(a){a&&H(e),r[2](null),o=!1,u()}}}function eR(r,e,t){let n;rt(r,or,a=>t(3,n=a));let i;async function o(a){let d=i.files[0].name,m=await i.files[0].text(),_=JSON.parse(m),v,S,T;_.app_focus&&(console.assert(_.app_focus=="global"||_.app_focus=="cnt"||_.app_focus=="england"),v=_.app_focus),_.study_area_name&&(S=_.study_area_name),_.project_name&&(T=_.project_name),(!_.app_focus||!_.project_name)&&(_.study_area_name&&_.study_area_name.startsWith("LAD_")?(v="cnt",T=h1(Wd(d,`ltn_cnt_${_.study_area_name}_`),".geojson")):(v="global",T=h1(Wd(d,"ltn_"),".geojson"))),T=T,v=v;let C=b2.projectStorage(v);T=C.nextAvailableProjectName(T),_.project_name=T,_.app_focus=v,_.study_area_name=S;let L=C.createProject(_);await up(L),on(or,n={mode:"pick-neighbourhood"},n)}function u(a){wn[a?"unshift":"push"](()=>{i=a,t(0,i)})}return[i,o,u]}class tR extends kt{constructor(e){super(),St(this,e,eR,QD,gt,{})}}function Zv(r,e,t){const n=r.slice();return n[23]=e[t][0],n[24]=e[t][1],n}function Hv(r,e,t){const n=r.slice();return n[27]=e[t].projectID,n[28]=e[t].projectName,n}function nR(r){let e,t,n,i,o=Mr(r[2].mode)+"",u;return{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),u=Te(o),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(a,d){W(a,e,d),z(e,t),z(t,n),z(n,i),z(i,u)},p(a,d){d[0]&4&&o!==(o=Mr(a[2].mode)+"")&&yt(u,o)},d(a){a&&H(e)}}}function rR(r){let e;return{c(){e=q("p"),e.textContent="Waiting for MapLibre and WASM to load..."},m(t,n){W(t,e,n)},p:ht,i:ht,o:ht,d(t){t&&H(e)}}}function iR(r){let e,t,n,i,o,u,a,d,m,_,v,S,T;const C=[sR,oR],L=[];function P(ee,X){return ee[4]=="cnt"?0:1}e=P(r),t=L[e]=C[e](r);let D=r[1].length>0&&Wv(r);const I=[cR,uR,lR],U=[];function O(ee,X){return ee[4]=="global"?0:ee[4]=="cnt"?1:ee[4]=="england"?2:-1}return~(m=O(r))&&(_=U[m]=I[m](r)),S=new tR({}),{c(){t.c(),n=ae(),i=q("a"),i.textContent="Read the user guide",o=ae(),D&&D.c(),u=ae(),a=q("h2"),a.textContent="Start a new project",d=ae(),_&&_.c(),v=ae(),pe(S.$$.fragment),ce(i,"href","user_guide.html"),ce(i,"target","_blank")},m(ee,X){L[e].m(ee,X),W(ee,n,X),W(ee,i,X),W(ee,o,X),D&&D.m(ee,X),W(ee,u,X),W(ee,a,X),W(ee,d,X),~m&&U[m].m(ee,X),W(ee,v,X),de(S,ee,X),T=!0},p(ee,X){let ue=e;e=P(ee),e!==ue&&(Zt(),G(L[ue],1,1,()=>{L[ue]=null}),Ht(),t=L[e],t||(t=L[e]=C[e](ee),t.c()),N(t,1),t.m(n.parentNode,n)),ee[1].length>0?D?(D.p(ee,X),X[0]&2&&N(D,1)):(D=Wv(ee),D.c(),N(D,1),D.m(u.parentNode,u)):D&&(Zt(),G(D,1,1,()=>{D=null}),Ht());let $=m;m=O(ee),m===$?~m&&U[m].p(ee,X):(_&&(Zt(),G(U[$],1,1,()=>{U[$]=null}),Ht()),~m?(_=U[m],_?_.p(ee,X):(_=U[m]=I[m](ee),_.c()),N(_,1),_.m(v.parentNode,v)):_=null)},i(ee){T||(N(t),N(D),N(_),N(S.$$.fragment,ee),T=!0)},o(ee){G(t),G(D),G(_),G(S.$$.fragment,ee),T=!1},d(ee){ee&&(H(n),H(i),H(o),H(u),H(a),H(d),H(v)),L[e].d(ee),D&&D.d(ee),~m&&U[m].d(ee),he(S,ee)}}}function oR(r){let e,t,n,i,o;return i=new HD({}),{c(){e=q("div"),t=q("h1"),t.textContent="The LTN Tool",n=ae(),pe(i.$$.fragment),Ze(e,"display","flex"),Ze(e,"justify-content","space-between"),Ze(e,"align-items","center")},m(u,a){W(u,e,a),z(e,t),z(e,n),de(i,e,null),o=!0},i(u){o||(N(i.$$.fragment,u),o=!0)},o(u){G(i.$$.fragment,u),o=!1},d(u){u&&H(e),he(i)}}}function sR(r){let e;return{c(){e=q("h1"),e.textContent="The Connected Neighbourhoods Tool"},m(t,n){W(t,e,n)},i:ht,o:ht,d(t){t&&H(e)}}}function Wv(r){let e,t,n,i,o=zn(r[1]),u=[];for(let d=0;d<o.length;d+=1)u[d]=Jv(Zv(r,o,d));const a=d=>G(u[d],1,1,()=>{u[d]=null});return{c(){e=q("h2"),e.textContent="Your projects",t=ae(),n=q("div");for(let d=0;d<u.length;d+=1)u[d].c();ce(n,"class","project-list svelte-fjn90u")},m(d,m){W(d,e,m),W(d,t,m),W(d,n,m);for(let _=0;_<u.length;_+=1)u[_]&&u[_].m(n,null);i=!0},p(d,m){if(m[0]&1922){o=zn(d[1]);let _;for(_=0;_<o.length;_+=1){const v=Zv(d,o,_);u[_]?(u[_].p(v,m),N(u[_],1)):(u[_]=Jv(v),u[_].c(),N(u[_],1),u[_].m(n,null))}for(Zt(),_=o.length;_<u.length;_+=1)a(_);Ht()}},i(d){if(!i){for(let m=0;m<o.length;m+=1)N(u[m]);i=!0}},o(d){u=u.filter(Boolean);for(let m=0;m<u.length;m+=1)G(u[m]);i=!1},d(d){d&&(H(e),H(t),H(n)),Jr(u,d)}}}function aR(r){let e=r[28]+"",t;return{c(){t=Te(e)},m(n,i){W(n,t,i)},p(n,i){i[0]&2&&e!==(e=n[28]+"")&&yt(t,e)},d(n){n&&H(t)}}}function Xv(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D,I,U;function O(){return r[11](r[27])}n=new nh({props:{$$slots:{default:[aR]},$$scope:{ctx:r}}}),n.$on("click",O),a=new uw({props:{color:"black"}});function ee(){return r[12](r[27])}_=new zg({props:{color:"black"}});function X(){return r[13](r[27],r[28])}T=new lw({props:{color:"black"}});function ue(){return r[14](r[27],r[28])}P=new ep({props:{color:"white"}});function $(){return r[15](r[27],r[28])}return{c(){e=q("li"),t=q("h3"),pe(n.$$.fragment),i=ae(),o=q("span"),u=q("button"),pe(a.$$.fragment),d=ae(),m=q("button"),pe(_.$$.fragment),v=ae(),S=q("button"),pe(T.$$.fragment),C=ae(),L=q("button"),pe(P.$$.fragment),ce(t,"class","project-name svelte-fjn90u"),ce(u,"class","outline icon-btn"),ce(u,"title","Download project as GeoJSON"),ce(m,"class","outline icon-btn"),ce(m,"title","Rename project"),ce(S,"class","outline icon-btn"),ce(S,"title","Copy project"),ce(L,"class","icon-btn destructive"),ce(L,"title","Delete project"),ce(o,"class","actions"),ce(e,"class","actionable-cell svelte-fjn90u")},m(Q,ne){W(Q,e,ne),z(e,t),de(n,t,null),z(e,i),z(e,o),z(o,u),de(a,u,null),z(o,d),z(o,m),de(_,m,null),z(o,v),z(o,S),de(T,S,null),z(o,C),z(o,L),de(P,L,null),D=!0,I||(U=[_t(u,"click",ee),_t(m,"click",X),_t(S,"click",ue),_t(L,"click",$)],I=!0)},p(Q,ne){r=Q;const F={};ne[0]&2|ne[1]&1&&(F.$$scope={dirty:ne,ctx:r}),n.$set(F)},i(Q){D||(N(n.$$.fragment,Q),N(a.$$.fragment,Q),N(_.$$.fragment,Q),N(T.$$.fragment,Q),N(P.$$.fragment,Q),D=!0)},o(Q){G(n.$$.fragment,Q),G(a.$$.fragment,Q),G(_.$$.fragment,Q),G(T.$$.fragment,Q),G(P.$$.fragment,Q),D=!1},d(Q){Q&&H(e),he(n),he(a),he(_),he(T),he(P),I=!1,Er(U)}}}function Jv(r){let e,t=Hd(r[23])+"",n,i,o,u,a,d=zn(r[24]),m=[];for(let v=0;v<d.length;v+=1)m[v]=Xv(Hv(r,d,v));const _=v=>G(m[v],1,1,()=>{m[v]=null});return{c(){e=q("h3"),n=Te(t),i=ae(),o=q("ul");for(let v=0;v<m.length;v+=1)m[v].c();u=ae(),ce(e,"class","study-area-name svelte-fjn90u"),ce(o,"class","navigable-list")},m(v,S){W(v,e,S),z(e,n),W(v,i,S),W(v,o,S);for(let T=0;T<m.length;T+=1)m[T]&&m[T].m(o,null);z(o,u),a=!0},p(v,S){if((!a||S[0]&2)&&t!==(t=Hd(v[23])+"")&&yt(n,t),S[0]&1922){d=zn(v[24]);let T;for(T=0;T<d.length;T+=1){const C=Hv(v,d,T);m[T]?(m[T].p(C,S),N(m[T],1)):(m[T]=Xv(C),m[T].c(),N(m[T],1),m[T].m(o,u))}for(Zt(),T=d.length;T<m.length;T+=1)_(T);Ht()}},i(v){if(!a){for(let S=0;S<d.length;S+=1)N(m[S]);a=!0}},o(v){m=m.filter(Boolean);for(let S=0;S<m.length;S+=1)G(m[S]);a=!1},d(v){v&&(H(e),H(i),H(o)),Jr(m,v)}}}function lR(r){let e,t;return e=new ix({props:{boundariesUrl:VD}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function uR(r){let e,t;return e=new ix({props:{boundariesUrl:UD}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function cR(r){let e,t,n;return{c(){e=q("button"),e.textContent="New project"},m(i,o){W(i,e,o),t||(n=_t(e,"click",r[16]),t=!0)},p:ht,i:ht,o:ht,d(i){i&&H(e),t=!1,n()}}}function fR(r){let e,t,n,i;const o=[iR,rR],u=[];function a(d,m){return d[3]&&d[0]?0:1}return t=a(r),n=u[t]=o[t](r),{c(){e=q("div"),n.c(),ce(e,"slot","sidebar")},m(d,m){W(d,e,m),u[t].m(e,null),i=!0},p(d,m){let _=t;t=a(d),t===_?u[t].p(d,m):(Zt(),G(u[_],1,1,()=>{u[_]=null}),Ht(),n=u[t],n?n.p(d,m):(n=u[t]=o[t](d),n.c()),N(n,1),n.m(e,null))},i(d){i||(N(n),i=!0)},o(d){G(n),i=!1},d(d){d&&H(e),u[t].d()}}}function hR(r){let e,t,n,i;return e=new qu({props:{loading:r[5],progress:r[6]}}),n=new po({props:{$$slots:{sidebar:[fR],top:[nR]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(o,u){de(e,o,u),W(o,t,u),de(n,o,u),i=!0},p(o,u){const a={};u[0]&32&&(a.loading=o[5]),u[0]&64&&(a.progress=o[6]),e.$set(a);const d={};u[0]&31|u[1]&1&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&H(t),he(e,o),he(n,o)}}}function dR(r,e,t){let n,i,o,u,a,d,m,_,v,S;rt(r,or,ne=>t(2,n=ne)),rt(r,ta,ne=>t(17,i=ne)),rt(r,Ko,ne=>t(3,o=ne)),rt(r,Bo,ne=>t(4,u=ne)),rt(r,Qy,ne=>t(18,a=ne)),rt(r,zo,ne=>t(19,d=ne)),rt(r,Zf,ne=>t(20,m=ne)),rt(r,Cr,ne=>t(21,_=ne)),rt(r,Hu,ne=>t(5,v=ne)),rt(r,Wu,ne=>t(6,S=ne));let{wasmReady:T}=e;if(on(Cr,_=null,_),on(Zf,m=null,m),on(zo,d=void 0,d),a){let F=new URLSearchParams(window.location.search).get("project");F&&L(F),on(Qy,a=!1,a)}else{let ne=new URL(window.location.href);ne.searchParams.delete("project"),window.history.replaceState(null,"",ne.toString())}if(o&&!a){let ne=[-180,-90,180,90];u=="cnt"?ne=[-8.943,54.631,-.901,59.489]:u=="england"&&(ne=[-5.96,49.89,2.31,55.94]),o.fitBounds(ne,{duration:500})}let C=i.studyAreaProjects();function L(ne){let F=ne;try{U(F)}catch{console.error(`Error trying to fetch project from URL: ${F}`)}}function P(ne,F){window.confirm(`Really delete project ${F}? You can't undo this.`)&&(i.removeProject(ne),t(1,C=i.studyAreaProjects()))}function D(ne,F){let Z=window.prompt(`Rename project ${F} to what?`,F);if(Z){try{i.renameProject(ne,Z)}catch(J){window.alert(`Couldn't rename project: ${J}`)}t(1,C=i.studyAreaProjects())}}function I(ne,F){let Z=window.prompt(`Please name this copy of project ${F}`,i.nextAvailableProjectName(F));if(Z){try{i.copyProject(ne,Z)}catch(J){window.alert(`Couldn't copy project: ${J}`)}t(1,C=i.studyAreaProjects())}}async function U(ne){await up(ne),on(or,n={mode:"pick-neighbourhood"},n)}const O=ne=>U(ne),ee=ne=>A2(ne),X=(ne,F)=>D(ne,F),ue=(ne,F)=>I(ne,F),$=(ne,F)=>P(ne,F),Q=()=>on(or,n={mode:"new-project"},n);return r.$$set=ne=>{"wasmReady"in ne&&t(0,T=ne.wasmReady)},[T,C,n,o,u,v,S,P,D,I,U,O,ee,X,ue,$,Q]}class pR extends kt{constructor(e){super(),St(this,e,dR,hR,gt,{wasmReady:0},null,[-1,-1])}}function mR(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C=Mr(r[1].mode)+"",L,P;return o=new jn({props:{mode:{mode:"title"}}}),d=new jn({props:{mode:{mode:"pick-neighbourhood"}}}),v=new jn({props:{mode:{mode:"neighbourhood"}}}),{c(){e=q("div"),t=q("nav"),n=q("ul"),i=q("li"),pe(o.$$.fragment),u=ae(),a=q("li"),pe(d.$$.fragment),m=ae(),_=q("li"),pe(v.$$.fragment),S=ae(),T=q("li"),L=Te(C),ce(t,"aria-label","breadcrumb"),ce(e,"slot","top")},m(D,I){W(D,e,I),z(e,t),z(t,n),z(n,i),de(o,i,null),z(n,u),z(n,a),de(d,a,null),z(n,m),z(n,_),de(v,_,null),z(n,S),z(n,T),z(T,L),P=!0},p(D,I){(!P||I&2)&&C!==(C=Mr(D[1].mode)+"")&&yt(L,C)},i(D){P||(N(o.$$.fragment,D),N(d.$$.fragment,D),N(v.$$.fragment,D),P=!0)},o(D){G(o.$$.fragment,D),G(d.$$.fragment,D),G(v.$$.fragment,D),P=!1},d(D){D&&H(e),he(o),he(d),he(v)}}}function gR(r){let e,t,n,i,o,u,a,d,m,_,v=cr(r[0].gj.features[r[0].shortcutIndex].properties).directness.toFixed(1)+"",S,T,C,L,P,D;function I(O){r[4](O)}let U={list:r[0].gj.features};return r[0].shortcutIndex!==void 0&&(U.idx=r[0].shortcutIndex),o=new op({props:U}),wn.push(()=>On(o,"idx",I)),{c(){e=q("p"),e.textContent=`This shows all possible shortcuts crossing the blue road you've chosen.
        A shortcut is defined as a route starting and ending on main (busy)
        roads, then cutting through smaller streets. It might not actually be
        considered a "good shortcut" in practice -- this tool doesn't know any
        real traffic patterns; it's just looking for any possible path. This
        view lets you understand the limits of this assumption.`,t=ae(),n=q("button"),n.textContent="Pick a different road",i=ae(),pe(o.$$.fragment),a=ae(),d=q("p"),m=Te("This shortcut is "),_=q("b"),S=Te(v),T=Te("x"),C=Te(`
        the length of the shortest route using all roads, not just this neighbourhood`)},m(O,ee){W(O,e,ee),W(O,t,ee),W(O,n,ee),W(O,i,ee),de(o,O,ee),W(O,a,ee),W(O,d,ee),z(d,m),z(d,_),z(_,S),z(_,T),z(d,C),L=!0,P||(D=_t(n,"click",r[3]),P=!0)},p(O,ee){const X={};ee&1&&(X.list=O[0].gj.features),!u&&ee&1&&(u=!0,X.idx=O[0].shortcutIndex,Nn(()=>u=!1)),o.$set(X),(!L||ee&1)&&v!==(v=cr(O[0].gj.features[O[0].shortcutIndex].properties).directness.toFixed(1)+"")&&yt(S,v)},i(O){L||(N(o.$$.fragment,O),L=!0)},o(O){G(o.$$.fragment,O),L=!1},d(O){O&&(H(e),H(t),H(n),H(i),H(a),H(d)),he(o,O),P=!1,D()}}}function _R(r){let e;return{c(){e=q("p"),e.textContent="Click a road to see shortcuts"},m(t,n){W(t,e,n)},p:ht,i:ht,o:ht,d(t){t&&H(e)}}}function yR(r){let e,t,n,i,o,u;t=new Is({props:{mode:{mode:"neighbourhood"}}});const a=[_R,gR],d=[];function m(_,v){return _[0].state=="neutral"?0:_[0].state=="chose-road"?1:-1}return~(i=m(r))&&(o=d[i]=a[i](r)),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),o&&o.c(),ce(e,"slot","sidebar")},m(_,v){W(_,e,v),de(t,e,null),z(e,n),~i&&d[i].m(e,null),u=!0},p(_,v){let S=i;i=m(_),i===S?~i&&d[i].p(_,v):(o&&(Zt(),G(d[S],1,1,()=>{d[S]=null}),Ht()),~i?(o=d[i],o?o.p(_,v):(o=d[i]=a[i](_),o.c()),N(o,1),o.m(e,null)):o=null)},i(_){u||(N(t.$$.fragment,_),N(o),u=!0)},o(_){G(t.$$.fragment,_),G(o),u=!1},d(_){_&&H(e),he(t),~i&&d[i].d()}}}function bR(r){let e,t;return e=new tc({props:{interactive:!1}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function vR(r){let e,t;return e=new tc({props:{onClickLine:r[2],$$slots:{"line-popup":[kR]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&128&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function wR(r){let e,t,n=(r[6].name??"unnamed road")+"",i;return{c(){e=q("p"),t=Te("Main road: "),i=Te(n)},m(o,u){W(o,e,u),z(e,t),z(e,i)},p(o,u){u&64&&n!==(n=(o[6].name??"unnamed road")+"")&&yt(i,n)},d(o){o&&H(e)}}}function xR(r){let e,t=r[6].shortcuts+"",n,i,o=(r[6].name??"unnamed road")+"",u;return{c(){e=q("p"),n=Te(t),i=Te(" shortcuts through "),u=Te(o)},m(a,d){W(a,e,d),z(e,n),z(e,i),z(e,u)},p(a,d){d&64&&t!==(t=a[6].shortcuts+"")&&yt(n,t),d&64&&o!==(o=(a[6].name??"unnamed road")+"")&&yt(u,o)},d(a){a&&H(e)}}}function AR(r){let e;function t(o,u){if(o[6].kind=="interior_road")return xR;if(o[6].kind=="main_road")return wR}let n=t(r),i=n&&n(r);return{c(){i&&i.c(),e=rr()},m(o,u){i&&i.m(o,u),W(o,e,u)},p(o,u){n===(n=t(o))&&i?i.p(o,u):(i&&i.d(1),i=n&&n(o),i&&(i.c(),i.m(e.parentNode,e)))},d(o){o&&H(e),i&&i.d(o)}}}function kR(r){let e,t,n;return t=new oi({props:{openOn:"hover",$$slots:{default:[AR,({props:i})=>({6:i}),({props:i})=>i?64:0]},$$scope:{ctx:r}}}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"slot","line-popup")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p(i,o){const u={};o&192&&(u.$$scope={dirty:o,ctx:i}),t.$set(u)},i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function SR(r){let e,t,n,i,o,u,a,d,m,_;e=new lp({}),n=new ah({}),o=new lh({});const v=[vR,bR],S=[];function T(C,L){return C[0].state=="neutral"?0:C[0].state=="chose-road"?1:-1}return~(a=T(r))&&(d=S[a]=v[a](r)),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),d&&d.c(),m=rr()},m(C,L){de(e,C,L),W(C,t,L),de(n,C,L),W(C,i,L),de(o,C,L),W(C,u,L),~a&&S[a].m(C,L),W(C,m,L),_=!0},p(C,L){let P=a;a=T(C),a===P?~a&&S[a].p(C,L):(d&&(Zt(),G(S[P],1,1,()=>{S[P]=null}),Ht()),~a?(d=S[a],d?d.p(C,L):(d=S[a]=v[a](C),d.c()),N(d,1),d.m(m.parentNode,m)):d=null)},i(C){_||(N(e.$$.fragment,C),N(n.$$.fragment,C),N(o.$$.fragment,C),N(d),_=!0)},o(C){G(e.$$.fragment,C),G(n.$$.fragment,C),G(o.$$.fragment,C),G(d),_=!1},d(C){C&&(H(t),H(i),H(u),H(m)),he(e,C),he(n,C),he(o,C),~a&&S[a].d(C)}}}function Kv(r){let e,t,n,i,o,u,a,d;return e=new yr({props:{data:r[0].gj.features[r[0].shortcutIndex],$$slots:{default:[TR]},$$scope:{ctx:r}}}),n=new yr({props:{data:r[0].roadGj,$$slots:{default:[CR]},$$scope:{ctx:r}}}),o=new Cl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[0],$$slots:{default:[MR]},$$scope:{ctx:r}}}),a=new Cl({props:{lngLat:r[0].gj.features[r[0].shortcutIndex].geometry.coordinates[r[0].gj.features[r[0].shortcutIndex].geometry.coordinates.length-1],$$slots:{default:[ER]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment),i=ae(),pe(o.$$.fragment),u=ae(),pe(a.$$.fragment)},m(m,_){de(e,m,_),W(m,t,_),de(n,m,_),W(m,i,_),de(o,m,_),W(m,u,_),de(a,m,_),d=!0},p(m,_){const v={};_&1&&(v.data=m[0].gj.features[m[0].shortcutIndex]),_&128&&(v.$$scope={dirty:_,ctx:m}),e.$set(v);const S={};_&1&&(S.data=m[0].roadGj),_&128&&(S.$$scope={dirty:_,ctx:m}),n.$set(S);const T={};_&1&&(T.lngLat=m[0].gj.features[m[0].shortcutIndex].geometry.coordinates[0]),_&128&&(T.$$scope={dirty:_,ctx:m}),o.$set(T);const C={};_&1&&(C.lngLat=m[0].gj.features[m[0].shortcutIndex].geometry.coordinates[m[0].gj.features[m[0].shortcutIndex].geometry.coordinates.length-1]),_&128&&(C.$$scope={dirty:_,ctx:m}),a.$set(C)},i(m){d||(N(e.$$.fragment,m),N(n.$$.fragment,m),N(o.$$.fragment,m),N(a.$$.fragment,m),d=!0)},o(m){G(e.$$.fragment,m),G(n.$$.fragment,m),G(o.$$.fragment,m),G(a.$$.fragment,m),d=!1},d(m){m&&(H(t),H(i),H(u)),he(e,m),he(n,m),he(o,m),he(a,m)}}}function TR(r){let e,t;const n=[sn("shortcuts"),{paint:{"line-width":10,"line-color":"cyan"}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function CR(r){let e,t;const n=[sn("shortcuts-focus"),{paint:{"line-width":5,"line-color":"blue"}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new gr({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function MR(r){let e;return{c(){e=Te("A")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function ER(r){let e;return{c(){e=Te("B")},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function IR(r){let e,t,n,i,o,u;t=new nc({props:{$$slots:{default:[SR]},$$scope:{ctx:r}}});let a=r[0].state=="chose-road"&&Kv(r);return o=new na({props:{interactive:!1}}),{c(){e=q("div"),pe(t.$$.fragment),n=ae(),a&&a.c(),i=ae(),pe(o.$$.fragment),ce(e,"slot","map")},m(d,m){W(d,e,m),de(t,e,null),z(e,n),a&&a.m(e,null),z(e,i),de(o,e,null),u=!0},p(d,m){const _={};m&129&&(_.$$scope={dirty:m,ctx:d}),t.$set(_),d[0].state=="chose-road"?a?(a.p(d,m),m&1&&N(a,1)):(a=Kv(d),a.c(),N(a,1),a.m(e,i)):a&&(Zt(),G(a,1,1,()=>{a=null}),Ht())},i(d){u||(N(t.$$.fragment,d),N(a),N(o.$$.fragment,d),u=!0)},o(d){G(t.$$.fragment,d),G(a),G(o.$$.fragment,d),u=!1},d(d){d&&H(e),he(t),a&&a.d(),he(o)}}}function LR(r){let e,t;return e=new po({props:{$$slots:{map:[IR],sidebar:[yR],top:[mR]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,[i]){const o={};i&131&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function PR(r,e,t){let n,i;rt(r,Cr,m=>t(5,n=m)),rt(r,or,m=>t(1,i=m));let o={state:"neutral"};function u(m,_){let v=n.getShortcutsCrossingRoad(m.properties.id);if(v.features.length==0){window.alert("No shortcuts here");return}t(0,o={state:"chose-road",roadGj:m,gj:v,shortcutIndex:0})}const a=()=>t(0,o={state:"neutral"});function d(m){r.$$.not_equal(o.shortcutIndex,m)&&(o.shortcutIndex=m,t(0,o))}return[o,i,u,a,d]}class zR extends kt{constructor(e){super(),St(this,e,PR,LR,gt,{})}}function DR(r){let e;return{c(){e=q("h1"),e.textContent="The Low-Traffic Neighbourhood (LTN) tool, v2"},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function RR(r){let e;return{c(){e=q("h1"),e.textContent="The Connected Neighbourhoods Tool"},m(t,n){W(t,e,n)},d(t){t&&H(e)}}}function BR(r){let e,t,n;function i(a,d){return a[0]=="cnt"?RR:DR}let o=i(r),u=o(r);return t=new r3({}),{c(){u.c(),e=ae(),pe(t.$$.fragment)},m(a,d){u.m(a,d),W(a,e,d),de(t,a,d),n=!0},p(a,d){o!==(o=i(a))&&(u.d(1),u=o(a),u&&(u.c(),u.m(e.parentNode,e)))},i(a){n||(N(t.$$.fragment,a),n=!0)},o(a){G(t.$$.fragment,a),n=!1},d(a){a&&H(e),u.d(a),he(t,a)}}}function FR(r){let e,t,n,i,o,u,a,d,m,_;return a=new aw({props:{color:"black"}}),{c(){e=q("div"),t=q("button"),t.innerHTML=`<img src="${l3}" style="height: 32px;" alt="A/B Street logo"/>`,n=ae(),i=q("span"),o=ae(),u=q("button"),pe(a.$$.fragment),ce(t,"class","outline"),Ze(i,"width","100%"),ce(u,"class","icon-btn"),ce(u,"title","User guide"),ce(e,"slot","top"),ce(e,"class","pico"),Ze(e,"display","flex"),Ze(e,"align-items","center"),Ze(e,"gap","8px")},m(v,S){W(v,e,S),z(e,t),z(e,n),z(e,i),r[25](i),z(e,o),z(e,u),de(a,u,null),d=!0,m||(_=[_t(t,"click",r[24]),_t(u,"click",r[26])],m=!0)},p:ht,i(v){d||(N(a.$$.fragment,v),d=!0)},o(v){G(a.$$.fragment,v),d=!1},d(v){v&&H(e),r[25](null),he(a),m=!1,Er(_)}}}function OR(r){let e,t;return{c(){e=q("div"),t=q("div"),ce(e,"class","pico"),ce(e,"slot","left")},m(n,i){W(n,e,i),z(e,t),r[23](t)},p:ht,d(n){n&&H(e),r[23](null)}}}function Yv(r){let e,t,n;function i(u){r[21](u)}let o={style:r[8],hash:!0,bounds:r[7],maxZoom:19,images:[{id:Ri.walkCycleOnly.filterType,url:Ri.walkCycleOnly.iconURL},{id:Ri.noEntry.filterType,url:Ri.noEntry.iconURL},{id:Ri.busGate.filterType,url:Ri.busGate.iconURL},{id:Ri.schoolStreet.filterType,url:Ri.schoolStreet.iconURL},{id:"diagonal_filter",url:a3},{id:"no_straight_turn",url:rw},{id:"no_left_turn",url:nw},{id:"no_right_turn",url:Pg},{id:"no_u_left_to_right_turn",url:ow},{id:"no_u_right_to_left_turn",url:iw},{id:"oneway_arrow",url:o3},{id:"border_entry_arrow",url:i3,options:{sdf:!0}},{id:"national_rail",url:sw}],$$slots:{default:[o9]},$$scope:{ctx:r}};return r[1]!==void 0&&(o.map=r[1]),e=new x4({props:o}),wn.push(()=>On(e,"map",i)),e.$on("error",r[22]),{c(){pe(e.$$.fragment)},m(u,a){de(e,u,a),n=!0},p(u,a){const d={};a&256&&(d.style=u[8]),a&128&&(d.bounds=u[7]),a&536882290&&(d.$$scope={dirty:a,ctx:u}),!t&&a&2&&(t=!0,d.map=u[1],Nn(()=>t=!1)),e.$set(d)},i(u){n||(N(e.$$.fragment,u),n=!0)},o(u){G(e.$$.fragment,u),n=!1},d(u){he(e,u)}}}function Qv(r){let e,t,n,i;return e=new Um({props:{position:"top-left",$$slots:{default:[jR]},$$scope:{ctx:r}}}),n=new Um({props:{position:"top-left",$$slots:{default:[VR]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment),t=ae(),pe(n.$$.fragment)},m(o,u){de(e,o,u),W(o,t,u),de(n,o,u),i=!0},p(o,u){const a={};u&536870912&&(a.$$scope={dirty:u,ctx:o}),e.$set(a);const d={};u&536872992&&(d.$$scope={dirty:u,ctx:o}),n.$set(d)},i(o){i||(N(e.$$.fragment,o),N(n.$$.fragment,o),i=!0)},o(o){G(e.$$.fragment,o),G(n.$$.fragment,o),i=!1},d(o){o&&H(t),he(e,o),he(n,o)}}}function NR(r){let e,t,n;return t=new K3({}),{c(){e=q("div"),pe(t.$$.fragment),ce(e,"class","ltn-map-btn zoom-to-fit-btn")},m(i,o){W(i,e,o),de(t,e,null),n=!0},p:ht,i(i){n||(N(t.$$.fragment,i),n=!0)},o(i){G(t.$$.fragment,i),n=!1},d(i){i&&H(e),he(t)}}}function $R(r){let e,t;return e=new bw({props:{title:"Zoom to fit study area",$$slots:{default:[NR]},$$scope:{ctx:r}}}),e.$on("click",r[19]),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&536870912&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function jR(r){let e,t;return e=new vw({props:{$$slots:{default:[$R]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&536870912&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function UR(r){let e,t;return e=new LC({props:{map:cr(r[11]),maptilerBasemap:r[5]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&2048&&(o.map=cr(n[11])),i&32&&(o.maptilerBasemap=n[5]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function VR(r){let e,t;return e=new vw({props:{$$slots:{default:[UR]},$$scope:{ctx:r}}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&536872992&&(o.$$scope={dirty:i,ctx:n}),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function qR(r){let e,t;return e=new jD({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function GR(r){let e,t;return e=new pR({props:{wasmReady:r[6]}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&64&&(o.wasmReady=n[6]),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function ew(r){let e,t,n,i,o,u;e=new yr({props:{data:r[10].getInvertedBoundary(),$$slots:{default:[ZR]},$$scope:{ctx:r}}});const a=[i9,r9,n9,t9,e9,QR,YR,KR,JR,XR,WR,HR],d=[];function m(_,v){return _[13].mode=="pick-neighbourhood"?0:_[13].mode=="set-boundary"?1:_[13].mode=="add-neighbourhood"?2:_[13].mode=="neighbourhood"?3:_[13].mode=="view-shortcuts"?4:_[13].mode=="impact-one-destination"?5:_[13].mode=="route"?6:_[13].mode=="predict-impact"?7:_[13].mode=="impact-detail"?8:_[13].mode=="debug-neighbourhood"?9:_[13].mode=="debug-intersections"?10:_[13].mode=="debug-demand"?11:-1}return~(n=m(r))&&(i=d[n]=a[n](r)),{c(){pe(e.$$.fragment),t=ae(),i&&i.c(),o=rr()},m(_,v){de(e,_,v),W(_,t,v),~n&&d[n].m(_,v),W(_,o,v),u=!0},p(_,v){const S={};v&1024&&(S.data=_[10].getInvertedBoundary()),v&536870912&&(S.$$scope={dirty:v,ctx:_}),e.$set(S);let T=n;n=m(_),n===T?~n&&d[n].p(_,v):(i&&(Zt(),G(d[T],1,1,()=>{d[T]=null}),Ht()),~n?(i=d[n],i?i.p(_,v):(i=d[n]=a[n](_),i.c()),N(i,1),i.m(o.parentNode,o)):i=null)},i(_){u||(N(e.$$.fragment,_),N(i),u=!0)},o(_){G(e.$$.fragment,_),G(i),u=!1},d(_){_&&(H(t),H(o)),he(e,_),~n&&d[n].d(_)}}}function ZR(r){let e,t;const n=[sn("boundary"),{paint:{"fill-color":"black","fill-opacity":.3}}];let i={};for(let o=0;o<n.length;o+=1)i=wt(i,n[o]);return e=new Zi({props:i}),{c(){pe(e.$$.fragment)},m(o,u){de(e,o,u),t=!0},p(o,u){const a={};e.$set(a)},i(o){t||(N(e.$$.fragment,o),t=!0)},o(o){G(e.$$.fragment,o),t=!1},d(o){he(e,o)}}}function HR(r){let e,t;return e=new NL({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function WR(r){let e,t;return e=new HL({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function XR(r){let e,t;return e=new N8({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function JR(r){let e,t;return e=new Az({props:{road:r[13].road,prevPrevMode:r[13].prevPrevMode}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&8192&&(o.road=n[13].road),i&8192&&(o.prevPrevMode=n[13].prevPrevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function KR(r){let e,t;return e=new S7({props:{prevMode:r[13].prevMode}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&8192&&(o.prevMode=n[13].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function YR(r){let e,t;return e=new N7({props:{prevMode:r[13].prevMode}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&8192&&(o.prevMode=n[13].prevMode),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function QR(r){let e,t;return e=new jz({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function e9(r){let e,t;return e=new zR({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function t9(r){let e,t;return e=new pz({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function n9(r){let e,t;return e=new xL({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function r9(r){let e,t;return e=new q7({props:{name:r[13].name,existing:r[13].existing}}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p(n,i){const o={};i&8192&&(o.name=n[13].name),i&8192&&(o.existing=n[13].existing),e.$set(o)},i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function i9(r){let e,t;return e=new l7({}),{c(){pe(e.$$.fragment)},m(n,i){de(e,n,i),t=!0},p:ht,i(n){t||(N(e.$$.fragment,n),t=!0)},o(n){G(e.$$.fragment,n),t=!1},d(n){he(e,n)}}}function o9(r){let e,t,n,i,o,u,a,d,m,_,v,S,T,C,L,P,D;e=new Aw({props:{showCompass:!1}});let I=r[10]&&Qv(r);i=new LE({props:{map:r[1],apiKey:_2,country:void 0}}),u=new kw({});const U=[GR,qR],O=[];function ee(ue,$){return ue[13].mode=="title"?0:ue[13].mode=="new-project"?1:-1}~(_=ee(r))&&(v=O[_]=U[_](r)),T=new e6({});let X=r[10]&&ew(r);return P=new nC({}),{c(){pe(e.$$.fragment),t=ae(),I&&I.c(),n=ae(),pe(i.$$.fragment),o=ae(),pe(u.$$.fragment),a=ae(),d=q("div"),m=ae(),v&&v.c(),S=ae(),pe(T.$$.fragment),C=ae(),X&&X.c(),L=ae(),pe(P.$$.fragment)},m(ue,$){de(e,ue,$),W(ue,t,$),I&&I.m(ue,$),W(ue,n,$),de(i,ue,$),W(ue,o,$),de(u,ue,$),W(ue,a,$),W(ue,d,$),r[20](d),W(ue,m,$),~_&&O[_].m(ue,$),W(ue,S,$),de(T,ue,$),W(ue,C,$),X&&X.m(ue,$),W(ue,L,$),de(P,ue,$),D=!0},p(ue,$){ue[10]?I?(I.p(ue,$),$&1024&&N(I,1)):(I=Qv(ue),I.c(),N(I,1),I.m(n.parentNode,n)):I&&(Zt(),G(I,1,1,()=>{I=null}),Ht());const Q={};$&2&&(Q.map=ue[1]),i.$set(Q);let ne=_;_=ee(ue),_===ne?~_&&O[_].p(ue,$):(v&&(Zt(),G(O[ne],1,1,()=>{O[ne]=null}),Ht()),~_?(v=O[_],v?v.p(ue,$):(v=O[_]=U[_](ue),v.c()),N(v,1),v.m(S.parentNode,S)):v=null),ue[10]?X?(X.p(ue,$),$&1024&&N(X,1)):(X=ew(ue),X.c(),N(X,1),X.m(L.parentNode,L)):X&&(Zt(),G(X,1,1,()=>{X=null}),Ht())},i(ue){D||(N(e.$$.fragment,ue),N(I),N(i.$$.fragment,ue),N(u.$$.fragment,ue),N(v),N(T.$$.fragment,ue),N(X),N(P.$$.fragment,ue),D=!0)},o(ue){G(e.$$.fragment,ue),G(I),G(i.$$.fragment,ue),G(u.$$.fragment,ue),G(v),G(T.$$.fragment,ue),G(X),G(P.$$.fragment,ue),D=!1},d(ue){ue&&(H(t),H(n),H(o),H(a),H(d),H(m),H(S),H(C),H(L)),he(e,ue),I&&I.d(ue),he(i,ue),he(u,ue),r[20](null),~_&&O[_].d(ue),he(T,ue),X&&X.d(ue),he(P,ue)}}}function s9(r){let e,t,n=r[8]&&Yv(r);return{c(){e=q("div"),n&&n.c(),ce(e,"slot","main"),Ze(e,"position","relative"),Ze(e,"width","100%"),Ze(e,"height","100%")},m(i,o){W(i,e,o),n&&n.m(e,null),t=!0},p(i,o){i[8]?n?(n.p(i,o),o&256&&N(n,1)):(n=Yv(i),n.c(),N(n,1),n.m(e,null)):n&&(Zt(),G(n,1,1,()=>{n=null}),Ht())},i(i){t||(N(n),t=!0)},o(i){G(n),t=!1},d(i){i&&H(e),n&&n.d()}}}function a9(r){let e,t,n,i,o,u,a,d,m,_;function v(T){r[18](T)}let S={$$slots:{default:[BR]},$$scope:{ctx:r}};return r[9]!==void 0&&(S.show=r[9]),i=new Ng({props:S}),wn.push(()=>On(i,"show",v)),d=new s6({props:{$$slots:{main:[s9],left:[OR],top:[FR]},$$scope:{ctx:r}}}),{c(){e=q("link"),t=ae(),n=q("div"),pe(i.$$.fragment),u=ae(),a=q("div"),pe(d.$$.fragment),ce(e,"rel","icon"),ce(e,"type","image/x-icon"),ce(e,"href",s3),ce(n,"class","pico"),ce(a,"class",m="app-focus-"+r[12])},m(T,C){z(document.head,e),W(T,t,C),W(T,n,C),de(i,n,null),W(T,u,C),W(T,a,C),de(d,a,null),_=!0},p(T,[C]){const L={};C&536870913&&(L.$$scope={dirty:C,ctx:T}),!o&&C&512&&(o=!0,L.show=T[9],Nn(()=>o=!1)),i.$set(L);const P={};C&536883198&&(P.$$scope={dirty:C,ctx:T}),d.$set(P),(!_||C&4096&&m!==(m="app-focus-"+T[12]))&&ce(a,"class",m)},i(T){_||(N(i.$$.fragment,T),N(d.$$.fragment,T),_=!0)},o(T){G(i.$$.fragment,T),G(d.$$.fragment,T),_=!1},d(T){T&&(H(t),H(n),H(u),H(a)),H(e),he(i),he(d)}}}function l9(r,e,t){let n,i,o,u,a,d,m,_,v;rt(r,tg,ge=>t(5,n=ge)),rt(r,kg,ge=>t(15,i=ge)),rt(r,Ag,ge=>t(16,o=ge)),rt(r,xg,ge=>t(17,u=ge)),rt(r,Cr,ge=>t(10,a=ge)),rt(r,Ko,ge=>t(11,d=ge)),rt(r,sg,ge=>t(27,m=ge)),rt(r,Bo,ge=>t(12,_=ge)),rt(r,or,ge=>t(13,v=ge));let{appFocus:S}=e;Bo.set(S);let T=!1;Yo(async()=>{await j2(),await i2(),t(6,T=!0);try{(await fetch("/severance_pbfs/areas.json")).ok&&(on(sg,m=!0,m),console.log("Using local asset files"))}catch{}});let C=null;function L(ge){d.fitBounds(a.getBounds(),{animate:ge})}let P,D,I,U;S=="cnt"&&(U=[-8.943,54.631,-.901,59.489]);let O=null;async function ee(ge){ge=="streets-v2"?t(8,O=A6):t(8,O=`https://api.maptiler.com/maps/${ge}/style.json?key=${_2}`)}let X=!1;function ue(ge){X=ge,t(9,X)}const $=()=>L(!0);function Q(ge){wn[ge?"unshift":"push"](()=>{I=ge,t(4,I),t(15,i)})}function ne(ge){C=ge,t(1,C)}const F=ge=>{console.log(ge.detail.error)};function Z(ge){wn[ge?"unshift":"push"](()=>{D=ge,t(3,D),t(16,o)})}const J=()=>t(9,X=!0);function be(ge){wn[ge?"unshift":"push"](()=>{P=ge,t(2,P),t(17,u)})}const ke=()=>window.open("user_guide.html","_blank");return r.$$set=ge=>{"appFocus"in ge&&t(0,S=ge.appFocus)},r.$$.update=()=>{r.$$.dirty&2&&C&&(C.keyboard.disableRotation(),C.dragRotate.disable(),C.touchZoomRotate.disableRotation(),Ko.set(C)),r.$$.dirty&131076&&P&&u&&(t(2,P.innerHTML="",P),P.appendChild(u)),r.$$.dirty&65544&&D&&o&&(t(3,D.innerHTML="",D),D.appendChild(o)),r.$$.dirty&32784&&I&&i&&(t(4,I.innerHTML="",I),I.appendChild(i)),r.$$.dirty&32&&ee(n)},[S,C,P,D,I,n,T,U,O,X,a,d,_,v,L,i,o,u,ue,$,Q,ne,F,Z,J,be,ke]}class _9 extends kt{constructor(e){super(),St(this,e,l9,a9,gt,{appFocus:0})}}export{_9 as A};
